var jw=Object.defineProperty;var Uw=Object.getPrototypeOf;var qw=Reflect.get;var Ox=f=>{throw TypeError(f)};var Zw=(f,o,g)=>o in f?jw(f,o,{enumerable:!0,configurable:!0,writable:!0,value:g}):f[o]=g;var Ue=(f,o,g)=>Zw(f,typeof o!="symbol"?o+"":o,g),ey=(f,o,g)=>o.has(f)||Ox("Cannot "+g);var I=(f,o,g)=>(ey(f,o,"read from private field"),g?g.call(f):o.get(f)),X=(f,o,g)=>o.has(f)?Ox("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(f):o.set(f,g),qe=(f,o,g,v)=>(ey(f,o,"write to private field"),v?v.call(f,g):o.set(f,g),g),Zr=(f,o,g)=>(ey(f,o,"access private method"),g);var Hu=(f,o,g,v)=>({set _(T){qe(f,o,T,g)},get _(){return I(f,o,v)}}),Fx=(f,o,g)=>qw(Uw(f),g,o);import{c as Gw,p as Ww,a as we,q as Hw,l as tt,t as Rt,m as gs,g as k0,s as my}from"../chunks/legacy.Dm4gyfrH.js";import{a7 as Xw,W as Kw,a0 as Jw,x as ys,j as Bx,k as ty,J as Yw,K as $w,w as Qw,g as e2,v as t2,e as Nx,h as Vx,y as i2,aR as My,L as r2,aa as n2,aC as s2,M as o2,C as Vi,N as M0,G as a2,V as l2,aw as c2,U as Oe,p as At,t as $t,a as Et,c as Kt,f as Be,s as ni,r as Wt,F as R,an as kg,T as ei,I as Pe,av as Ye,B as Pt,au as Mg,_ as Ip,aS as z0,$ as zy,aT as D0,aU as u2,a2 as Ks,u as h2,aV as Kn,aW as d2,aX as p2}from"../chunks/runtime.B76Vjo_i.js";import{m as f2,u as jx,s as _s}from"../chunks/render.DC6ny83U.js";import{l as fn,p as ee,s as Qt,r as Jt,i as gi,a as Ze,o as R0,b as zg}from"../chunks/index-client.BrO4ukPi.js";import{e as eh,s as Tn,i as th,q as Ot,k as L0,r as m2,b as g2}from"../chunks/mode.CHMDlCvN.js";import{c as ai,b as Is}from"../chunks/this.QRC2F710.js";import{s as _2,h as y2,a as v2}from"../chunks/store.BvVuv4PB.js";import{g as Cp,c as ji,r as x2,s as Gf}from"../chunks/index.DKNLSslk.js";import{i as b2}from"../chunks/lifecycle.CU51bgik.js";const w2=[];function O0(f,o=!1){return Uf(f,new Map,"",w2)}function Uf(f,o,g,v,T=null){if(typeof f=="object"&&f!==null){const w=o.get(f);if(w!==void 0)return w;if(f instanceof Map)return new Map(f);if(f instanceof Set)return new Set(f);if(Xw(f)){const c=[];o.set(f,c),T!==null&&o.set(T,c);for(let U=0;U<f.length;U+=1)c.push(Uf(f[U],o,g,v));return c}if(Kw(f)===Jw){const c={};o.set(f,c),T!==null&&o.set(T,c);for(var E in f)c[E]=Uf(f[E],o,g,v);return c}if(f instanceof Date)return structuredClone(f);if(typeof f.toJSON=="function")return Uf(f.toJSON(),o,g,v,f)}if(f instanceof EventTarget)return f;try{return structuredClone(f)}catch{return f}}function F0(f,o,g,v,T,E){let w=ys;ys&&Bx();var c,U,W=null;ys&&ty.nodeType===1&&(W=ty,Bx());var K=ys?ty:f,j;Yw(()=>{const V=o()||null;var ne=g||V==="svg"?My:null;V!==c&&(j&&(V===null?r2(j,()=>{j=null,U=null}):V===U?n2(j):s2(j)),V&&V!==U&&(j=Qw(()=>{if(W=ys?W:ne?document.createElementNS(ne,V):document.createElement(V),Gw(W,W),v){var oe=ys?e2(W):W.appendChild(t2());ys&&(oe===null?Nx(!1):Vx(oe)),v(W,oe)}i2.nodes_end=W,K.before(W)})),c=V,c&&(U=c))},$w),w&&(Nx(!0),Vx(K))}function gy(f,o,g){o2(()=>{var v=Vi(()=>o(f,g==null?void 0:g())||{});if(g&&(v!=null&&v.update)){var T=!1,E={};M0(()=>{var w=g();a2(w),T&&l2(E,w)&&(E=w,v.update(w))}),T=!0}if(v!=null&&v.destroy)return()=>v.destroy()})}function B0(f,o){var g=f.__className,v=S2(o);ys&&f.className===v?f.__className=v:(g!==v||ys&&f.className!==v)&&(o==null?f.removeAttribute("class"):f.className=v,f.__className=v)}function S2(f){return f??""}function P2(f,o,g){if(g){if(f.classList.contains(o))return;f.classList.add(o)}else{if(!f.classList.contains(o))return;f.classList.remove(o)}}function T2(f,o,g,v){var T=f.__styles??(f.__styles={});T[o]!==g&&(T[o]=g,g==null?f.style.removeProperty(o):f.style.setProperty(o,g,""))}function I2(f,o,g=o){var v=c2();Ww(f,"input",T=>{var E=T?f.defaultValue:f.value;E=iy(f)?ry(E):E,g(E),v&&E!==(E=o())&&(f.value=E??"")}),(ys&&f.defaultValue!==f.value||Vi(o)==null&&f.value)&&g(iy(f)?ry(f.value):f.value),M0(()=>{var T=o();iy(f)&&T===ry(f.value)||f.type==="date"&&!T&&!f.value||T!==f.value&&(f.value=T??"")})}function iy(f){var o=f.type;return o==="number"||o==="range"}function ry(f){return f===""?null:+f}function Vo(f){Oe(f,f.v+1)}const Ux="LYsosKTbN7Q5Pq1NzJI1";/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var A2=Hw("<svg><!><!></svg>");function jn(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]),v=fn(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);At(o,!1);let T=ee(o,"name",8,void 0),E=ee(o,"color",8,"currentColor"),w=ee(o,"size",8,24),c=ee(o,"strokeWidth",8,2),U=ee(o,"absoluteStrokeWidth",8,!1),W=ee(o,"iconNode",24,()=>[]);const K=(..._e)=>_e.filter((ke,Ne,De)=>!!ke&&De.indexOf(ke)===Ne).join(" "),j=Cp(),[V,ne]=j;b2();var oe=A2();let ce;var fe=Kt(oe);eh(fe,1,W,th,(_e,ke)=>{let Ne=()=>R(ke)[0],De=()=>R(ke)[1];var Xe=tt(),it=Be(Xe);const Ct=kg(()=>`${Ne()}`=="button"?ne({...De()},[{attribute_name:"formaction"}]):`${Ne()}`=="form"?ne({...De()},[{attribute_name:"action"}]):`${Ne()}`=="a"?ne({...De()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...De()});F0(it,Ne,!0,(Je,St)=>{let dt;$t(()=>dt=ji(Je,dt,{...R(Ct)},void 0,Je.namespaceURI===My,Je.nodeName.includes("-")))}),we(_e,Xe)});var Ie=ni(fe);Tn(Ie,o,"default",{}),Wt(oe),$t(()=>ce=ji(oe,ce,{...C2,...v,width:w(),height:w(),stroke:E(),"stroke-width":U()?Number(c())*24/Number(w()):c(),class:K("lucide-icon","lucide",T()?`lucide-${T()}`:"",g.class)},void 0,!0)),we(f,oe),Et()}function E2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"box"},()=>g,{iconNode:[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"}],["path",{d:"m3.3 7 8.7 5 8.7-5"}],["path",{d:"M12 22V12"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function k2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function M2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function z2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"computer"},()=>g,{iconNode:[["rect",{width:"14",height:"8",x:"5",y:"2",rx:"2"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2"}],["path",{d:"M6 18h2"}],["path",{d:"M12 18h6"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function D2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"corner-down-right"},()=>g,{iconNode:[["polyline",{points:"15 10 20 15 15 20"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function R2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"droplet"},()=>g,{iconNode:[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function L2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"external-link"},()=>g,{iconNode:[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function O2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function F2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"plug"},()=>g,{iconNode:[["path",{d:"M12 22v-5"}],["path",{d:"M9 8V2"}],["path",{d:"M15 8V2"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function B2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"printer"},()=>g,{iconNode:[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function N2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function V2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function j2(f,o){const g=fn(o,["children","$$slots","$$events","$$legacy"]);jn(f,Qt({name:"wifi"},()=>g,{iconNode:[["path",{d:"M12 20h.01"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}]],children:(T,E)=>{var w=tt(),c=Be(w);Tn(c,o,"default",{}),we(T,w)},$$slots:{default:!0}}))}function U2(f,o){let g=ee(o,"amenity",8);const v={Computers:z2,Outlets:F2,Printing:B2,Rooms:E2,"Water Fountains":R2,WiFi:j2};var T=tt(),E=Be(T);ai(E,()=>v[g()]??D2,(w,c)=>{c(w,{class:"h-fit w-fit scale-75"})}),we(f,T)}var qx=f=>typeof f=="boolean"?`${f}`:f===0?"0":f,Pn=f=>!f||typeof f!="object"||Object.keys(f).length===0,q2=(f,o)=>JSON.stringify(f)===JSON.stringify(o);function N0(f,o){f.forEach(function(g){Array.isArray(g)?N0(g,o):o.push(g)})}function V0(f){let o=[];return N0(f,o),o}var j0=(...f)=>V0(f).filter(Boolean),U0=(f,o)=>{let g={},v=Object.keys(f),T=Object.keys(o);for(let E of v)if(T.includes(E)){let w=f[E],c=o[E];Array.isArray(w)||Array.isArray(c)?g[E]=j0(c,w):typeof w=="object"&&typeof c=="object"?g[E]=U0(w,c):g[E]=c+" "+w}else g[E]=f[E];for(let E of T)v.includes(E)||(g[E]=o[E]);return g},Zx=f=>!f||typeof f!="string"?f:f.replace(/\s+/g," ").trim();const Dy="-",Z2=f=>{const o=W2(f),{conflictingClassGroups:g,conflictingClassGroupModifiers:v}=f;return{getClassGroupId:w=>{const c=w.split(Dy);return c[0]===""&&c.length!==1&&c.shift(),q0(c,o)||G2(w)},getConflictingClassGroupIds:(w,c)=>{const U=g[w]||[];return c&&v[w]?[...U,...v[w]]:U}}},q0=(f,o)=>{var w;if(f.length===0)return o.classGroupId;const g=f[0],v=o.nextPart.get(g),T=v?q0(f.slice(1),v):void 0;if(T)return T;if(o.validators.length===0)return;const E=f.join(Dy);return(w=o.validators.find(({validator:c})=>c(E)))==null?void 0:w.classGroupId},Gx=/^\[(.+)\]$/,G2=f=>{if(Gx.test(f)){const o=Gx.exec(f)[1],g=o==null?void 0:o.substring(0,o.indexOf(":"));if(g)return"arbitrary.."+g}},W2=f=>{const{theme:o,prefix:g}=f,v={nextPart:new Map,validators:[]};return X2(Object.entries(f.classGroups),g).forEach(([E,w])=>{_y(w,v,E,o)}),v},_y=(f,o,g,v)=>{f.forEach(T=>{if(typeof T=="string"){const E=T===""?o:Wx(o,T);E.classGroupId=g;return}if(typeof T=="function"){if(H2(T)){_y(T(v),o,g,v);return}o.validators.push({validator:T,classGroupId:g});return}Object.entries(T).forEach(([E,w])=>{_y(w,Wx(o,E),g,v)})})},Wx=(f,o)=>{let g=f;return o.split(Dy).forEach(v=>{g.nextPart.has(v)||g.nextPart.set(v,{nextPart:new Map,validators:[]}),g=g.nextPart.get(v)}),g},H2=f=>f.isThemeGetter,X2=(f,o)=>o?f.map(([g,v])=>{const T=v.map(E=>typeof E=="string"?o+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([w,c])=>[o+w,c])):E);return[g,T]}):f,K2=f=>{if(f<1)return{get:()=>{},set:()=>{}};let o=0,g=new Map,v=new Map;const T=(E,w)=>{g.set(E,w),o++,o>f&&(o=0,v=g,g=new Map)};return{get(E){let w=g.get(E);if(w!==void 0)return w;if((w=v.get(E))!==void 0)return T(E,w),w},set(E,w){g.has(E)?g.set(E,w):T(E,w)}}},Z0="!",J2=f=>{const{separator:o,experimentalParseClassName:g}=f,v=o.length===1,T=o[0],E=o.length,w=c=>{const U=[];let W=0,K=0,j;for(let fe=0;fe<c.length;fe++){let Ie=c[fe];if(W===0){if(Ie===T&&(v||c.slice(fe,fe+E)===o)){U.push(c.slice(K,fe)),K=fe+E;continue}if(Ie==="/"){j=fe;continue}}Ie==="["?W++:Ie==="]"&&W--}const V=U.length===0?c:c.substring(K),ne=V.startsWith(Z0),oe=ne?V.substring(1):V,ce=j&&j>K?j-K:void 0;return{modifiers:U,hasImportantModifier:ne,baseClassName:oe,maybePostfixModifierPosition:ce}};return g?c=>g({className:c,parseClassName:w}):w},Y2=f=>{if(f.length<=1)return f;const o=[];let g=[];return f.forEach(v=>{v[0]==="["?(o.push(...g.sort(),v),g=[]):g.push(v)}),o.push(...g.sort()),o},$2=f=>({cache:K2(f.cacheSize),parseClassName:J2(f),...Z2(f)}),Q2=/\s+/,eS=(f,o)=>{const{parseClassName:g,getClassGroupId:v,getConflictingClassGroupIds:T}=o,E=[],w=f.trim().split(Q2);let c="";for(let U=w.length-1;U>=0;U-=1){const W=w[U],{modifiers:K,hasImportantModifier:j,baseClassName:V,maybePostfixModifierPosition:ne}=g(W);let oe=!!ne,ce=v(oe?V.substring(0,ne):V);if(!ce){if(!oe){c=W+(c.length>0?" "+c:c);continue}if(ce=v(V),!ce){c=W+(c.length>0?" "+c:c);continue}oe=!1}const fe=Y2(K).join(":"),Ie=j?fe+Z0:fe,_e=Ie+ce;if(E.includes(_e))continue;E.push(_e);const ke=T(ce,oe);for(let Ne=0;Ne<ke.length;++Ne){const De=ke[Ne];E.push(Ie+De)}c=W+(c.length>0?" "+c:c)}return c};function tS(){let f=0,o,g,v="";for(;f<arguments.length;)(o=arguments[f++])&&(g=G0(o))&&(v&&(v+=" "),v+=g);return v}const G0=f=>{if(typeof f=="string")return f;let o,g="";for(let v=0;v<f.length;v++)f[v]&&(o=G0(f[v]))&&(g&&(g+=" "),g+=o);return g};function yy(f,...o){let g,v,T,E=w;function w(U){const W=o.reduce((K,j)=>j(K),f());return g=$2(W),v=g.cache.get,T=g.cache.set,E=c,c(U)}function c(U){const W=v(U);if(W)return W;const K=eS(U,g);return T(U,K),K}return function(){return E(tS.apply(null,arguments))}}const Qi=f=>{const o=g=>g[f]||[];return o.isThemeGetter=!0,o},W0=/^\[(?:([a-z-]+):)?(.+)\]$/i,iS=/^\d+\/\d+$/,rS=new Set(["px","full","screen"]),nS=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,sS=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,oS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,aS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,lS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ws=f=>Ul(f)||rS.has(f)||iS.test(f),Fo=f=>Rc(f,"length",gS),Ul=f=>!!f&&!Number.isNaN(Number(f)),ny=f=>Rc(f,"number",Ul),Xu=f=>!!f&&Number.isInteger(Number(f)),cS=f=>f.endsWith("%")&&Ul(f.slice(0,-1)),ri=f=>W0.test(f),Bo=f=>nS.test(f),uS=new Set(["length","size","percentage"]),hS=f=>Rc(f,uS,H0),dS=f=>Rc(f,"position",H0),pS=new Set(["image","url"]),fS=f=>Rc(f,pS,yS),mS=f=>Rc(f,"",_S),Ku=()=>!0,Rc=(f,o,g)=>{const v=W0.exec(f);return v?v[1]?typeof o=="string"?v[1]===o:o.has(v[1]):g(v[2]):!1},gS=f=>sS.test(f)&&!oS.test(f),H0=()=>!1,_S=f=>aS.test(f),yS=f=>lS.test(f),vy=()=>{const f=Qi("colors"),o=Qi("spacing"),g=Qi("blur"),v=Qi("brightness"),T=Qi("borderColor"),E=Qi("borderRadius"),w=Qi("borderSpacing"),c=Qi("borderWidth"),U=Qi("contrast"),W=Qi("grayscale"),K=Qi("hueRotate"),j=Qi("invert"),V=Qi("gap"),ne=Qi("gradientColorStops"),oe=Qi("gradientColorStopPositions"),ce=Qi("inset"),fe=Qi("margin"),Ie=Qi("opacity"),_e=Qi("padding"),ke=Qi("saturate"),Ne=Qi("scale"),De=Qi("sepia"),Xe=Qi("skew"),it=Qi("space"),Ct=Qi("translate"),Je=()=>["auto","contain","none"],St=()=>["auto","hidden","clip","visible","scroll"],dt=()=>["auto",ri,o],Ge=()=>[ri,o],Fe=()=>["",Ws,Fo],Ee=()=>["auto",Ul,ri],Le=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ke=()=>["solid","dashed","dotted","double","none"],pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],yt=()=>["start","end","center","between","around","evenly","stretch"],lt=()=>["","0",ri],ut=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ft=()=>[Ul,ri];return{cacheSize:500,separator:":",theme:{colors:[Ku],spacing:[Ws,Fo],blur:["none","",Bo,ri],brightness:Ft(),borderColor:[f],borderRadius:["none","","full",Bo,ri],borderSpacing:Ge(),borderWidth:Fe(),contrast:Ft(),grayscale:lt(),hueRotate:Ft(),invert:lt(),gap:Ge(),gradientColorStops:[f],gradientColorStopPositions:[cS,Fo],inset:dt(),margin:dt(),opacity:Ft(),padding:Ge(),saturate:Ft(),scale:Ft(),sepia:lt(),skew:Ft(),space:Ge(),translate:Ge()},classGroups:{aspect:[{aspect:["auto","square","video",ri]}],container:["container"],columns:[{columns:[Bo]}],"break-after":[{"break-after":ut()}],"break-before":[{"break-before":ut()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Le(),ri]}],overflow:[{overflow:St()}],"overflow-x":[{"overflow-x":St()}],"overflow-y":[{"overflow-y":St()}],overscroll:[{overscroll:Je()}],"overscroll-x":[{"overscroll-x":Je()}],"overscroll-y":[{"overscroll-y":Je()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ce]}],"inset-x":[{"inset-x":[ce]}],"inset-y":[{"inset-y":[ce]}],start:[{start:[ce]}],end:[{end:[ce]}],top:[{top:[ce]}],right:[{right:[ce]}],bottom:[{bottom:[ce]}],left:[{left:[ce]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Xu,ri]}],basis:[{basis:dt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ri]}],grow:[{grow:lt()}],shrink:[{shrink:lt()}],order:[{order:["first","last","none",Xu,ri]}],"grid-cols":[{"grid-cols":[Ku]}],"col-start-end":[{col:["auto",{span:["full",Xu,ri]},ri]}],"col-start":[{"col-start":Ee()}],"col-end":[{"col-end":Ee()}],"grid-rows":[{"grid-rows":[Ku]}],"row-start-end":[{row:["auto",{span:[Xu,ri]},ri]}],"row-start":[{"row-start":Ee()}],"row-end":[{"row-end":Ee()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ri]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ri]}],gap:[{gap:[V]}],"gap-x":[{"gap-x":[V]}],"gap-y":[{"gap-y":[V]}],"justify-content":[{justify:["normal",...yt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...yt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...yt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_e]}],px:[{px:[_e]}],py:[{py:[_e]}],ps:[{ps:[_e]}],pe:[{pe:[_e]}],pt:[{pt:[_e]}],pr:[{pr:[_e]}],pb:[{pb:[_e]}],pl:[{pl:[_e]}],m:[{m:[fe]}],mx:[{mx:[fe]}],my:[{my:[fe]}],ms:[{ms:[fe]}],me:[{me:[fe]}],mt:[{mt:[fe]}],mr:[{mr:[fe]}],mb:[{mb:[fe]}],ml:[{ml:[fe]}],"space-x":[{"space-x":[it]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[it]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ri,o]}],"min-w":[{"min-w":[ri,o,"min","max","fit"]}],"max-w":[{"max-w":[ri,o,"none","full","min","max","fit","prose",{screen:[Bo]},Bo]}],h:[{h:[ri,o,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ri,o,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ri,o,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ri,o,"auto","min","max","fit"]}],"font-size":[{text:["base",Bo,Fo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ny]}],"font-family":[{font:[Ku]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ri]}],"line-clamp":[{"line-clamp":["none",Ul,ny]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ws,ri]}],"list-image":[{"list-image":["none",ri]}],"list-style-type":[{list:["none","disc","decimal",ri]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[f]}],"placeholder-opacity":[{"placeholder-opacity":[Ie]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[f]}],"text-opacity":[{"text-opacity":[Ie]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ke(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ws,Fo]}],"underline-offset":[{"underline-offset":["auto",Ws,ri]}],"text-decoration-color":[{decoration:[f]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ge()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ri]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ri]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Ie]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Le(),dS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",hS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},fS]}],"bg-color":[{bg:[f]}],"gradient-from-pos":[{from:[oe]}],"gradient-via-pos":[{via:[oe]}],"gradient-to-pos":[{to:[oe]}],"gradient-from":[{from:[ne]}],"gradient-via":[{via:[ne]}],"gradient-to":[{to:[ne]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Ie]}],"border-style":[{border:[...Ke(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Ie]}],"divide-style":[{divide:Ke()}],"border-color":[{border:[T]}],"border-color-x":[{"border-x":[T]}],"border-color-y":[{"border-y":[T]}],"border-color-s":[{"border-s":[T]}],"border-color-e":[{"border-e":[T]}],"border-color-t":[{"border-t":[T]}],"border-color-r":[{"border-r":[T]}],"border-color-b":[{"border-b":[T]}],"border-color-l":[{"border-l":[T]}],"divide-color":[{divide:[T]}],"outline-style":[{outline:["",...Ke()]}],"outline-offset":[{"outline-offset":[Ws,ri]}],"outline-w":[{outline:[Ws,Fo]}],"outline-color":[{outline:[f]}],"ring-w":[{ring:Fe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[f]}],"ring-opacity":[{"ring-opacity":[Ie]}],"ring-offset-w":[{"ring-offset":[Ws,Fo]}],"ring-offset-color":[{"ring-offset":[f]}],shadow:[{shadow:["","inner","none",Bo,mS]}],"shadow-color":[{shadow:[Ku]}],opacity:[{opacity:[Ie]}],"mix-blend":[{"mix-blend":[...pt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":pt()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[v]}],contrast:[{contrast:[U]}],"drop-shadow":[{"drop-shadow":["","none",Bo,ri]}],grayscale:[{grayscale:[W]}],"hue-rotate":[{"hue-rotate":[K]}],invert:[{invert:[j]}],saturate:[{saturate:[ke]}],sepia:[{sepia:[De]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[v]}],"backdrop-contrast":[{"backdrop-contrast":[U]}],"backdrop-grayscale":[{"backdrop-grayscale":[W]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[K]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[Ie]}],"backdrop-saturate":[{"backdrop-saturate":[ke]}],"backdrop-sepia":[{"backdrop-sepia":[De]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ri]}],duration:[{duration:Ft()}],ease:[{ease:["linear","in","out","in-out",ri]}],delay:[{delay:Ft()}],animate:[{animate:["none","spin","ping","pulse","bounce",ri]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ne]}],"scale-x":[{"scale-x":[Ne]}],"scale-y":[{"scale-y":[Ne]}],rotate:[{rotate:[Xu,ri]}],"translate-x":[{"translate-x":[Ct]}],"translate-y":[{"translate-y":[Ct]}],"skew-x":[{"skew-x":[Xe]}],"skew-y":[{"skew-y":[Xe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ri]}],accent:[{accent:["auto",f]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ri]}],"caret-color":[{caret:[f]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ge()}],"scroll-mx":[{"scroll-mx":Ge()}],"scroll-my":[{"scroll-my":Ge()}],"scroll-ms":[{"scroll-ms":Ge()}],"scroll-me":[{"scroll-me":Ge()}],"scroll-mt":[{"scroll-mt":Ge()}],"scroll-mr":[{"scroll-mr":Ge()}],"scroll-mb":[{"scroll-mb":Ge()}],"scroll-ml":[{"scroll-ml":Ge()}],"scroll-p":[{"scroll-p":Ge()}],"scroll-px":[{"scroll-px":Ge()}],"scroll-py":[{"scroll-py":Ge()}],"scroll-ps":[{"scroll-ps":Ge()}],"scroll-pe":[{"scroll-pe":Ge()}],"scroll-pt":[{"scroll-pt":Ge()}],"scroll-pr":[{"scroll-pr":Ge()}],"scroll-pb":[{"scroll-pb":Ge()}],"scroll-pl":[{"scroll-pl":Ge()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ri]}],fill:[{fill:[f,"none"]}],"stroke-w":[{stroke:[Ws,Fo,ny]}],stroke:[{stroke:[f,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},vS=(f,{cacheSize:o,prefix:g,separator:v,experimentalParseClassName:T,extend:E={},override:w={}})=>{ih(f,"cacheSize",o),ih(f,"prefix",g),ih(f,"separator",v),ih(f,"experimentalParseClassName",T);for(const c in w)xS(f[c],w[c]);for(const c in E)bS(f[c],E[c]);return f},ih=(f,o,g)=>{g!==void 0&&(f[o]=g)},xS=(f,o)=>{if(o)for(const g in o)ih(f,g,o[g])},bS=(f,o)=>{if(o)for(const g in o){const v=o[g];v!==void 0&&(f[g]=(f[g]||[]).concat(v))}},wS=(f,...o)=>typeof f=="function"?yy(vy,f,...o):yy(()=>vS(vy(),f),...o),X0=yy(vy);var SS={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},K0=f=>f||void 0,nh=(...f)=>K0(V0(f).filter(Boolean).join(" ")),sy=null,Xs={},xy=!1,Ju=(...f)=>o=>o.twMerge?((!sy||xy)&&(xy=!1,sy=Pn(Xs)?X0:wS({...Xs,extend:{theme:Xs.theme,classGroups:Xs.classGroups,conflictingClassGroupModifiers:Xs.conflictingClassGroupModifiers,conflictingClassGroups:Xs.conflictingClassGroups,...Xs.extend}})),K0(sy(nh(f)))):nh(f),Hx=(f,o)=>{for(let g in o)f.hasOwnProperty(g)?f[g]=nh(f[g],o[g]):f[g]=o[g];return f},J0=(f,o)=>{let{extend:g=null,slots:v={},variants:T={},compoundVariants:E=[],compoundSlots:w=[],defaultVariants:c={}}=f,U={...SS,...o},W=g!=null&&g.base?nh(g.base,f==null?void 0:f.base):f==null?void 0:f.base,K=g!=null&&g.variants&&!Pn(g.variants)?U0(T,g.variants):T,j=g!=null&&g.defaultVariants&&!Pn(g.defaultVariants)?{...g.defaultVariants,...c}:c;!Pn(U.twMergeConfig)&&!q2(U.twMergeConfig,Xs)&&(xy=!0,Xs=U.twMergeConfig);let V=Pn(g==null?void 0:g.slots),ne=Pn(v)?{}:{base:nh(f==null?void 0:f.base,V&&(g==null?void 0:g.base)),...v},oe=V?ne:Hx({...g==null?void 0:g.slots},Pn(ne)?{base:f==null?void 0:f.base}:ne),ce=Pn(g==null?void 0:g.compoundVariants)?E:j0(g==null?void 0:g.compoundVariants,E),fe=_e=>{if(Pn(K)&&Pn(v)&&V)return Ju(W,_e==null?void 0:_e.class,_e==null?void 0:_e.className)(U);if(ce&&!Array.isArray(ce))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof ce}`);if(w&&!Array.isArray(w))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof w}`);let ke=(Ge,Fe,Ee=[],Le)=>{let Ke=Ee;if(typeof Fe=="string")Ke=Ke.concat(Zx(Fe).split(" ").map(pt=>`${Ge}:${pt}`));else if(Array.isArray(Fe))Ke=Ke.concat(Fe.reduce((pt,yt)=>pt.concat(`${Ge}:${yt}`),[]));else if(typeof Fe=="object"&&typeof Le=="string"){for(let pt in Fe)if(Fe.hasOwnProperty(pt)&&pt===Le){let yt=Fe[pt];if(yt&&typeof yt=="string"){let lt=Zx(yt);Ke[Le]?Ke[Le]=Ke[Le].concat(lt.split(" ").map(ut=>`${Ge}:${ut}`)):Ke[Le]=lt.split(" ").map(ut=>`${Ge}:${ut}`)}else Array.isArray(yt)&&yt.length>0&&(Ke[Le]=yt.reduce((lt,ut)=>lt.concat(`${Ge}:${ut}`),[]))}}return Ke},Ne=(Ge,Fe=K,Ee=null,Le=null)=>{var Ke;let pt=Fe[Ge];if(!pt||Pn(pt))return null;let yt=(Ke=Le==null?void 0:Le[Ge])!=null?Ke:_e==null?void 0:_e[Ge];if(yt===null)return null;let lt=qx(yt),ut=Array.isArray(U.responsiveVariants)&&U.responsiveVariants.length>0||U.responsiveVariants===!0,Ft=j==null?void 0:j[Ge],qt=[];if(typeof lt=="object"&&ut)for(let[Si,_i]of Object.entries(lt)){let yi=pt[_i];if(Si==="initial"){Ft=_i;continue}Array.isArray(U.responsiveVariants)&&!U.responsiveVariants.includes(Si)||(qt=ke(Si,yi,qt,Ee))}let fi=lt!=null&&typeof lt!="object"?lt:qx(Ft),li=pt[fi||"false"];return typeof qt=="object"&&typeof Ee=="string"&&qt[Ee]?Hx(qt,li):qt.length>0?(qt.push(li),Ee==="base"?qt.join(" "):qt):li},De=()=>K?Object.keys(K).map(Ge=>Ne(Ge,K)):null,Xe=(Ge,Fe)=>{if(!K||typeof K!="object")return null;let Ee=new Array;for(let Le in K){let Ke=Ne(Le,K,Ge,Fe),pt=Ge==="base"&&typeof Ke=="string"?Ke:Ke&&Ke[Ge];pt&&(Ee[Ee.length]=pt)}return Ee},it={};for(let Ge in _e)_e[Ge]!==void 0&&(it[Ge]=_e[Ge]);let Ct=(Ge,Fe)=>{var Ee;let Le=typeof(_e==null?void 0:_e[Ge])=="object"?{[Ge]:(Ee=_e[Ge])==null?void 0:Ee.initial}:{};return{...j,...it,...Le,...Fe}},Je=(Ge=[],Fe)=>{let Ee=[];for(let{class:Le,className:Ke,...pt}of Ge){let yt=!0;for(let[lt,ut]of Object.entries(pt)){let Ft=Ct(lt,Fe)[lt];if(Array.isArray(ut)){if(!ut.includes(Ft)){yt=!1;break}}else{let qt=fi=>fi==null||fi===!1;if(qt(ut)&&qt(Ft))continue;if(Ft!==ut){yt=!1;break}}}yt&&(Le&&Ee.push(Le),Ke&&Ee.push(Ke))}return Ee},St=Ge=>{let Fe=Je(ce,Ge);if(!Array.isArray(Fe))return Fe;let Ee={};for(let Le of Fe)if(typeof Le=="string"&&(Ee.base=Ju(Ee.base,Le)(U)),typeof Le=="object")for(let[Ke,pt]of Object.entries(Le))Ee[Ke]=Ju(Ee[Ke],pt)(U);return Ee},dt=Ge=>{if(w.length<1)return null;let Fe={};for(let{slots:Ee=[],class:Le,className:Ke,...pt}of w){if(!Pn(pt)){let yt=!0;for(let lt of Object.keys(pt)){let ut=Ct(lt,Ge)[lt];if(ut===void 0||(Array.isArray(pt[lt])?!pt[lt].includes(ut):pt[lt]!==ut)){yt=!1;break}}if(!yt)continue}for(let yt of Ee)Fe[yt]=Fe[yt]||[],Fe[yt].push([Le,Ke])}return Fe};if(!Pn(v)||!V){let Ge={};if(typeof oe=="object"&&!Pn(oe))for(let Fe of Object.keys(oe))Ge[Fe]=Ee=>{var Le,Ke;return Ju(oe[Fe],Xe(Fe,Ee),((Le=St(Ee))!=null?Le:[])[Fe],((Ke=dt(Ee))!=null?Ke:[])[Fe],Ee==null?void 0:Ee.class,Ee==null?void 0:Ee.className)(U)};return Ge}return Ju(W,De(),Je(ce),_e==null?void 0:_e.class,_e==null?void 0:_e.className)(U)},Ie=()=>{if(!(!K||typeof K!="object"))return Object.keys(K)};return fe.variantKeys=Ie(),fe.extend=g,fe.base=W,fe.slots=oe,fe.variants=K,fe.defaultVariants=j,fe.compoundSlots=w,fe.compoundVariants=ce,fe};function Y0(f){var o,g,v="";if(typeof f=="string"||typeof f=="number")v+=f;else if(typeof f=="object")if(Array.isArray(f)){var T=f.length;for(o=0;o<T;o++)f[o]&&(g=Y0(f[o]))&&(v&&(v+=" "),v+=g)}else for(g in f)f[g]&&(v&&(v+=" "),v+=g);return v}function $0(){for(var f,o,g=0,v="",T=arguments.length;g<T;g++)(f=arguments[g])&&(o=Y0(f))&&(v&&(v+=" "),v+=o);return v}const Xx=30;function Di(...f){return X0($0(f))}function oy(f){const[o,g]=f.split(":").map(Number);return o*60+g}function Kx(f,o,g=new Date){if(f===void 0)return"Closed";if(f.alwaysOpen)return"Open";const v={weekday:"long",hour:"2-digit",minute:"2-digit",hourCycle:"h23"},E=new Intl.DateTimeFormat("en-US",v).formatToParts(g);let w,c,U;for(const K of E)K.type==="weekday"?w=K.value.toLowerCase():K.type==="hour"?c=K.value:K.type==="minute"&&(U=K.value);if(!w||!c||!U)throw new Error("Failed to parse current time information.");const W=oy(`${c}:${U}`);for(const K of f.hours[w]||[]){const j=oy(K.open),V=oy(K.close);if(W>=j&&W<V)return V-W<=Xx?"Closing Soon":"Open";if(W<j)return j-W<=Xx?"Opening Soon":"Closed"}return"Closed"}const Lf=J0({base:"focus:ring-ring inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80 border-transparent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border-transparent",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80 border-transparent",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Of(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"variant",3,"default"),T=Jt(o,["$$slots","$$events","$$legacy","ref","href","class","variant","children"]);const E=Cp(),[w,c]=E;var U=tt(),W=Be(U);const K=Pe(()=>`${o.href?"a":"span"}`=="button"?c({href:o.href,class:Di(Lf({variant:v(),className:o.class})),...T},[{attribute_name:"formaction"}]):`${o.href?"a":"span"}`=="form"?c({href:o.href,class:Di(Lf({variant:v(),className:o.class})),...T},[{attribute_name:"action"}]):`${o.href?"a":"span"}`=="a"?c({href:o.href,class:Di(Lf({variant:v(),className:o.class})),...T},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{href:o.href,class:Di(Lf({variant:v(),className:o.class})),...T});F0(W,()=>o.href?"a":"span",!1,(j,V)=>{Is(j,fe=>g(fe),()=>g());let ne;$t(()=>ne=ji(j,ne,{...R(K)},void 0,j.namespaceURI===My,j.nodeName.includes("-")));var oe=tt(),ce=Be(oe);Ot(ce,()=>o.children??ei),we(V,oe)}),we(f,U),Et()}const Jx=J0({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var PS=Rt("<a><!></a>"),TS=Rt("<button><!></button>");function Yx(f,o){At(o,!0);let g=ee(o,"variant",3,"default"),v=ee(o,"size",3,"default"),T=ee(o,"ref",15,null),E=ee(o,"href",3,void 0),w=ee(o,"type",3,"button"),c=Jt(o,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const U=Cp(),[W,K]=U;var j=tt(),V=Be(j);{var ne=ce=>{var fe=PS();const Ie=Pe(()=>K({class:Di(Jx({variant:g(),size:v(),className:o.class})),href:E(),...c},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let _e;var ke=Kt(fe);Ot(ke,()=>o.children??ei),Wt(fe),Is(fe,Ne=>T(Ne),()=>T()),$t(()=>_e=ji(fe,_e,{...R(Ie)})),we(ce,fe)},oe=ce=>{var fe=TS();const Ie=Pe(()=>K({class:Di(Jx({variant:g(),size:v(),className:o.class})),type:w(),...c},[{attribute_name:"formaction"}]));let _e;var ke=Kt(fe);Ot(ke,()=>o.children??ei),Wt(fe),Is(fe,Ne=>T(Ne),()=>T()),$t(()=>_e=ji(fe,_e,{...R(Ie)})),we(ce,fe)};gi(V,ce=>{E()?ce(ne):ce(oe,!1)})}we(f,j),Et()}var IS=Rt("<div><!></div>");function CS(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children"]);var T=IS();let E;var w=Kt(T);Ot(w,()=>o.children??ei),Wt(T),Is(T,c=>g(c),()=>g()),$t(()=>E=ji(T,E,{class:Di("p-6",o.class),...v})),we(f,T),Et()}var AS=Rt("<p><!></p>");function ES(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children"]);var T=AS();let E;var w=Kt(T);Ot(w,()=>o.children??ei),Wt(T),Is(T,c=>g(c),()=>g()),$t(()=>E=ji(T,E,{class:Di("text-sm text-muted-foreground",o.class),...v})),we(f,T),Et()}var kS=Rt("<div><!></div>");function MS(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children"]);var T=kS();let E;var w=Kt(T);Ot(w,()=>o.children??ei),Wt(T),Is(T,c=>g(c),()=>g()),$t(()=>E=ji(T,E,{class:Di("flex flex-col space-y-1.5 p-6 pb-0",o.class),...v})),we(f,T),Et()}var zS=Rt("<div><!></div>");function DS(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"level",3,3),T=Jt(o,["$$slots","$$events","$$legacy","ref","class","level","children"]);var E=zS();let w;var c=Kt(E);Ot(c,()=>o.children??ei),Wt(E),Is(E,U=>g(U),()=>g()),$t(()=>w=ji(E,w,{role:"heading","aria-level":v(),class:Di("text-2xl font-semibold leading-none tracking-tight",o.class),...T})),we(f,E),Et()}var RS=Rt("<div><!></div>");function LS(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children"]);var T=RS();let E;var w=Kt(T);Ot(w,()=>o.children??ei),Wt(T),Is(T,c=>g(c),()=>g()),$t(()=>E=ji(T,E,{class:Di("rounded-lg border bg-card text-card-foreground shadow-sm",o.class),...v})),we(f,T),Et()}function OS(f){return typeof f=="function"}function FS(f){return f!==null&&typeof f=="object"}const sh=Symbol("box"),Ry=Symbol("is-writable");function BS(f){return FS(f)&&sh in f}function NS(f){return Se.isBox(f)&&Ry in f}function Se(f){let o=Ye(Ze(f));return{[sh]:!0,[Ry]:!0,get current(){return R(o)},set current(g){Oe(o,Ze(g))}}}function VS(f,o){const g=Pe(f);return o?{[sh]:!0,[Ry]:!0,get current(){return R(g)},set current(v){o(v)}}:{[sh]:!0,get current(){return f()}}}function jS(f){return Se.isBox(f)?f:OS(f)?Se.with(f):Se(f)}function US(f){return Object.entries(f).reduce((o,[g,v])=>Se.isBox(v)?(Se.isWritableBox(v)?Object.defineProperty(o,g,{get(){return v.current},set(T){v.current=T}}):Object.defineProperty(o,g,{get(){return v.current}}),o):Object.assign(o,{[g]:v}),{})}function qS(f){return Se.isWritableBox(f)?{[sh]:!0,get current(){return f.current}}:f}Se.from=jS;Se.with=VS;Se.flatten=US;Se.readonly=qS;Se.isBox=BS;Se.isWritableBox=NS;function Q0(...f){return function(o){var g;for(const v of f)if(v){if(o.defaultPrevented)return;typeof v=="function"?v.call(this,o):(g=v.current)==null||g.call(this,o)}}}function eb(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Vl={},ay,$x;function ZS(){if($x)return ay;$x=1;var f=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,o=/\n/g,g=/^\s*/,v=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,T=/^:\s*/,E=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,w=/^[;\s]*/,c=/^\s+|\s+$/g,U=`
`,W="/",K="*",j="",V="comment",ne="declaration";ay=function(ce,fe){if(typeof ce!="string")throw new TypeError("First argument must be a string");if(!ce)return[];fe=fe||{};var Ie=1,_e=1;function ke(Fe){var Ee=Fe.match(o);Ee&&(Ie+=Ee.length);var Le=Fe.lastIndexOf(U);_e=~Le?Fe.length-Le:_e+Fe.length}function Ne(){var Fe={line:Ie,column:_e};return function(Ee){return Ee.position=new De(Fe),Ct(),Ee}}function De(Fe){this.start=Fe,this.end={line:Ie,column:_e},this.source=fe.source}De.prototype.content=ce;function Xe(Fe){var Ee=new Error(fe.source+":"+Ie+":"+_e+": "+Fe);if(Ee.reason=Fe,Ee.filename=fe.source,Ee.line=Ie,Ee.column=_e,Ee.source=ce,!fe.silent)throw Ee}function it(Fe){var Ee=Fe.exec(ce);if(Ee){var Le=Ee[0];return ke(Le),ce=ce.slice(Le.length),Ee}}function Ct(){it(g)}function Je(Fe){var Ee;for(Fe=Fe||[];Ee=St();)Ee!==!1&&Fe.push(Ee);return Fe}function St(){var Fe=Ne();if(!(W!=ce.charAt(0)||K!=ce.charAt(1))){for(var Ee=2;j!=ce.charAt(Ee)&&(K!=ce.charAt(Ee)||W!=ce.charAt(Ee+1));)++Ee;if(Ee+=2,j===ce.charAt(Ee-1))return Xe("End of comment missing");var Le=ce.slice(2,Ee-2);return _e+=2,ke(Le),ce=ce.slice(Ee),_e+=2,Fe({type:V,comment:Le})}}function dt(){var Fe=Ne(),Ee=it(v);if(Ee){if(St(),!it(T))return Xe("property missing ':'");var Le=it(E),Ke=Fe({type:ne,property:oe(Ee[0].replace(f,j)),value:Le?oe(Le[0].replace(f,j)):j});return it(w),Ke}}function Ge(){var Fe=[];Je(Fe);for(var Ee;Ee=dt();)Ee!==!1&&(Fe.push(Ee),Je(Fe));return Fe}return Ct(),Ge()};function oe(ce){return ce?ce.replace(c,j):j}return ay}var Qx;function GS(){if(Qx)return Vl;Qx=1;var f=Vl&&Vl.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(Vl,"__esModule",{value:!0}),Vl.default=g;var o=f(ZS());function g(v,T){var E=null;if(!v||typeof v!="string")return E;var w=(0,o.default)(v),c=typeof T=="function";return w.forEach(function(U){if(U.type==="declaration"){var W=U.property,K=U.value;c?T(W,K,U):K&&(E=E||{},E[W]=K)}}),E}return Vl}var WS=GS();const e0=eb(WS),HS=e0.default||e0,XS=/\d/,KS=["-","_","/","."];function JS(f=""){if(!XS.test(f))return f!==f.toLowerCase()}function YS(f){const o=[];let g="",v,T;for(const E of f){const w=KS.includes(E);if(w===!0){o.push(g),g="",v=void 0;continue}const c=JS(E);if(T===!1){if(v===!1&&c===!0){o.push(g),g=E,v=c;continue}if(v===!0&&c===!1&&g.length>1){const U=g.at(-1);o.push(g.slice(0,Math.max(0,g.length-1))),g=U+E,v=c;continue}}g+=E,v=c,T=w}return o.push(g),o}function tb(f){return f?YS(f).map(o=>QS(o)).join(""):""}function $S(f){return eP(tb(f||""))}function QS(f){return f?f[0].toUpperCase()+f.slice(1):""}function eP(f){return f?f[0].toLowerCase()+f.slice(1):""}function rh(f){if(!f)return{};const o={};function g(v,T){if(v.startsWith("-moz-")||v.startsWith("-webkit-")||v.startsWith("-ms-")||v.startsWith("-o-")){o[tb(v)]=T;return}if(v.startsWith("--")){o[v]=T;return}o[$S(v)]=T}return HS(f,g),o}function ql(...f){return(...o)=>{for(const g of f)typeof g=="function"&&g(...o)}}function tP(f,o){const g=RegExp(f,"g");return v=>{if(typeof v!="string")throw new TypeError(`expected an argument of type string, but got ${typeof v}`);return v.match(g)?v.replace(g,o):v}}const iP=tP(/[A-Z]/,f=>`-${f.toLowerCase()}`);function rP(f){if(!f||typeof f!="object"||Array.isArray(f))throw new TypeError(`expected an argument of type object, but got ${typeof f}`);return Object.keys(f).map(o=>`${iP(o)}: ${f[o]};`).join(`
`)}function Ly(f={}){return rP(f).replace(`
`," ")}const ib={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};Ly(ib);function nP(f){var o;return f.length>2&&f.startsWith("on")&&f[2]===((o=f[2])==null?void 0:o.toLowerCase())}function er(...f){const o={...f[0]};for(let g=1;g<f.length;g++){const v=f[g];for(const T in v){const E=o[T],w=v[T],c=typeof E=="function",U=typeof w=="function";if(c&&nP(T)){const W=E,K=w;o[T]=Q0(W,K)}else if(c&&U)o[T]=ql(E,w);else if(T==="class"&&typeof E=="string"&&typeof w=="string")o[T]=$0(E,w);else if(T==="style"){const W=typeof E=="object",K=typeof w=="object",j=typeof E=="string",V=typeof w=="string";if(W&&K)o[T]={...E,...w};else if(W&&V){const ne=rh(w);o[T]={...E,...ne}}else if(j&&K){const ne=rh(E);o[T]={...ne,...w}}else if(j&&V){const ne=rh(E),oe=rh(w);o[T]={...ne,...oe}}else W?o[T]=E:K&&(o[T]=w)}else o[T]=w!==void 0?w:E}}return typeof o.style=="object"&&(o.style=Ly(o.style).replaceAll(`
`," ")),o.hidden!==!0&&(o.hidden=void 0),o.disabled!==!0&&(o.disabled=void 0),o}function _r({id:f,ref:o,deps:g=()=>!0,onRefChange:v=()=>{},getRootNode:T=()=>typeof document<"u"?document:void 0}){const E=Pe(()=>g()),w=Pe(()=>T());Pt(()=>(f.current,R(E),R(w),Vi(()=>{var U;const c=(U=R(w))==null?void 0:U.getElementById(f.current);c?o.current=c:o.current=null,v(o.current)}))),Pt(()=>()=>{o.current=null,v(null)})}function sP(f){Pt(()=>()=>{f()})}function Ap(f,o){setTimeout(o,f)}function Mc(f){Mg().then(f)}function Oy(f){return f?"open":"closed"}function oP(f){return f?"true":"false"}function rb(f){return f?"true":"false"}function aP(f){return f?"":void 0}function lP(f){return f?"true":"false"}function cP(f){return f?"":void 0}const uP="ArrowDown",hP="ArrowUp",dP="End",nb="Enter",pP="Escape",fP="Home",mP=" ",gP="Tab",_P="p",yP="n",vP="j",xP="k",Fy=typeof document<"u",t0=bP();function bP(){var f,o;return Fy&&((f=window==null?void 0:window.navigator)==null?void 0:f.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((o=window==null?void 0:window.navigator)==null?void 0:o.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function Wf(f){return f instanceof HTMLElement}function wP(f){return f instanceof Element}function SP(f){return f!==null}function PP(f){return f instanceof HTMLInputElement&&"select"in f}function TP(f,o){if(getComputedStyle(f).visibility==="hidden")return!0;for(;f;){if(o!==void 0&&f===o)return!1;if(getComputedStyle(f).display==="none")return!0;f=f.parentElement}return!1}function i0(f,o){return Ip(f,o)}function IP(f,o){const g=f,v=typeof f=="symbol"?f.description:f;if(!z0(g)){if(o===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return o}return zy(f)}function CP(f,o){return typeof f=="string"&&o===void 0?`${f}Context`:Array.isArray(f)&&o===void 0?`${f[0]}Context`:`${f}Context`}function Ga(f,o,g=!0){const v=CP(f,o),T=Symbol.for(`bits-ui.${v}`),E=v;function w(U){const W=IP(g?T:E,U);if(W===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(f)?`one of the following components: ${f.join(", ")}`:`\`${f}\``}`);return W}function c(U){return i0(g?T:E,U)}return[c,w]}let r0=0;function Ar(f="bits"){return r0++,`${f}-${r0}`}function ur(){}var Gl,lh,jo,Ra,na,by,wy,E0;let AP=(E0=class{constructor(o,g){X(this,na);X(this,Gl,Ye());X(this,lh);X(this,jo,0);X(this,Ra,null);I(this,Gl).v=Ze(o),qe(this,lh,g)}get current(){return D0()?Pt(()=>(Hu(this,jo)._++,I(this,jo)===1&&Zr(this,na,by).call(this,!0),()=>{Mg().then(()=>{Hu(this,jo)._--,I(this,jo)===0&&Zr(this,na,wy).call(this)})})):I(this,jo)===0&&(Zr(this,na,by).call(this,!1),Zr(this,na,wy).call(this)),R(I(this,Gl))}},Gl=new WeakMap,lh=new WeakMap,jo=new WeakMap,Ra=new WeakMap,na=new WeakSet,by=function(o){qe(this,Ra,I(this,lh).call(this,g=>{Oe(I(this,Gl),Ze(g))},o)??null)},wy=function(){I(this,Ra)!==null&&(I(this,Ra).call(this),qe(this,Ra,null))},E0);new AP(null,(f,o)=>{function g(){f(document.activeElement)}if(g(),!!o)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function EP(f){return typeof f=="function"}function kP(f){return EP(f)?f():f}var Uo;class MP{constructor(o,g={box:"border-box"}){X(this,Uo,Ye(Ze({width:0,height:0})));var v,T;I(this,Uo).v=Ze({width:((v=g.initialSize)==null?void 0:v.width)??0,height:((T=g.initialSize)==null?void 0:T.height)??0}),Pt(()=>{const E=kP(o);if(!E)return;const w=new ResizeObserver(c=>{for(const U of c){const W=g.box==="content-box"?U.contentBoxSize:U.borderBoxSize,K=Array.isArray(W)?W:[W];R(I(this,Uo)).width=K.reduce((j,V)=>Math.max(j,V.inlineSize),0),R(I(this,Uo)).height=K.reduce((j,V)=>Math.max(j,V.blockSize),0)}});return w.observe(E),()=>{w.disconnect()}})}get width(){return R(I(this,Uo)).width}get height(){return R(I(this,Uo)).height}}Uo=new WeakMap;var ch,uh;class zP{constructor(o){X(this,ch,Ye());X(this,uh);Pt(()=>{Oe(I(this,ch),Ze(I(this,uh))),qe(this,uh,o())})}get current(){return R(I(this,ch))}}ch=new WeakMap,uh=new WeakMap;function DP(f,o){const g=Se(f);function v(E){return o[g.current][E]??g.current}return{state:g,dispatch:E=>{g.current=v(E)}}}function RP(f,o){let g=Ye(Ze({})),v=Ye("none");const T=f.current?"mounted":"unmounted";let E=Ye(null);const w=new zP(()=>f.current);Pt(()=>{o.current&&f.current&&Mc(()=>{Oe(E,Ze(document.getElementById(o.current)))})});const{state:c,dispatch:U}=DP(T,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Pt(()=>{const V=f.current;Vi(()=>{if(R(E)||Oe(E,Ze(document.getElementById(o.current))),!R(E)||!(V!==w.current))return;const oe=R(v),ce=Ff(R(E));V?U("MOUNT"):ce==="none"||R(g).display==="none"?U("UNMOUNT"):U(w&&oe!==ce?"ANIMATION_OUT":"UNMOUNT")})});function W(V){if(R(E)||Oe(E,Ze(document.getElementById(o.current))),!R(E))return;const ne=Ff(R(E)),oe=ne.includes(V.animationName)||ne==="none";V.target===R(E)&&oe&&U("ANIMATION_END")}function K(V){R(E)||Oe(E,Ze(document.getElementById(o.current))),R(E)&&V.target===R(E)&&Oe(v,Ze(Ff(R(E))))}Pt(()=>{c.current,Vi(()=>{if(R(E)||Oe(E,Ze(document.getElementById(o.current))),!R(E))return;const V=Ff(R(E));Oe(v,Ze(c.current==="mounted"?V:"none"))})}),Pt(()=>{if(R(E))return Oe(g,Ze(getComputedStyle(R(E)))),R(E).addEventListener("animationstart",K),R(E).addEventListener("animationcancel",W),R(E).addEventListener("animationend",W),()=>{var V,ne,oe;(V=R(E))==null||V.removeEventListener("animationstart",K),(ne=R(E))==null||ne.removeEventListener("animationcancel",W),(oe=R(E))==null||oe.removeEventListener("animationend",W)}});const j=Pe(()=>["mounted","unmountSuspended"].includes(c.current));return{get current(){return R(j)}}}function Ff(f){return f&&getComputedStyle(f).animationName||"none"}function By(f,o){At(o,!0);const g=RP(Se.with(()=>o.present),Se.with(()=>o.id));var v=tt(),T=Be(v);{var E=w=>{var c=tt(),U=Be(c);Ot(U,()=>o.presence??ei,()=>({present:g})),we(w,c)};gi(T,w=>{(o.forceMount||o.present||g.current)&&w(E)})}we(f,v),Et()}function LP(f){return{content:`data-${f}-content`,trigger:`data-${f}-trigger`,overlay:`data-${f}-overlay`,title:`data-${f}-title`,description:`data-${f}-description`,close:`data-${f}-close`,cancel:`data-${f}-cancel`,action:`data-${f}-action`}}var hh,dh,ph,fh,mh,gh,_h,yh,vh,Yf,$f;class OP{constructor(o){Ue(this,"open");Ue(this,"variant");X(this,hh,Ye(null));X(this,dh,Ye(null));X(this,ph,Ye(null));X(this,fh,Ye(null));X(this,mh,Ye(void 0));X(this,gh,Ye(void 0));X(this,_h,Ye(void 0));X(this,yh,Ye(void 0));X(this,vh,Ye(null));X(this,Yf,Pe(()=>LP(this.variant.current)));Ue(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});Ue(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});X(this,$f,Pe(()=>({"data-state":Oy(this.open.current)})));this.open=o.open,this.variant=o.variant}get triggerNode(){return R(I(this,hh))}set triggerNode(o){Oe(I(this,hh),Ze(o))}get titleNode(){return R(I(this,dh))}set titleNode(o){Oe(I(this,dh),Ze(o))}get contentNode(){return R(I(this,ph))}set contentNode(o){Oe(I(this,ph),Ze(o))}get descriptionNode(){return R(I(this,fh))}set descriptionNode(o){Oe(I(this,fh),Ze(o))}get contentId(){return R(I(this,mh))}set contentId(o){Oe(I(this,mh),Ze(o))}get titleId(){return R(I(this,gh))}set titleId(o){Oe(I(this,gh),Ze(o))}get triggerId(){return R(I(this,_h))}set triggerId(o){Oe(I(this,_h),Ze(o))}get descriptionId(){return R(I(this,yh))}set descriptionId(o){Oe(I(this,yh),Ze(o))}get cancelNode(){return R(I(this,vh))}set cancelNode(o){Oe(I(this,vh),Ze(o))}get attrs(){return R(I(this,Yf))}get sharedProps(){return R(I(this,$f))}}hh=new WeakMap,dh=new WeakMap,ph=new WeakMap,fh=new WeakMap,mh=new WeakMap,gh=new WeakMap,_h=new WeakMap,yh=new WeakMap,vh=new WeakMap,Yf=new WeakMap,$f=new WeakMap;var Wl,xh,Js,bh,Qf;class FP{constructor(o,g){X(this,Wl);X(this,xh);X(this,Js);X(this,bh);X(this,Qf,Pe(()=>({id:I(this,Wl).current,role:"heading","aria-level":I(this,bh).current,[I(this,Js).attrs.title]:"",...I(this,Js).sharedProps})));qe(this,Wl,o.id),qe(this,Js,g),qe(this,xh,o.ref),qe(this,bh,o.level),_r({id:I(this,Wl),ref:I(this,xh),onRefChange:v=>{I(this,Js).titleNode=v,I(this,Js).titleId=v==null?void 0:v.id},deps:()=>I(this,Js).open.current})}get props(){return R(I(this,Qf))}}Wl=new WeakMap,xh=new WeakMap,Js=new WeakMap,bh=new WeakMap,Qf=new WeakMap;var Hl,wh,Ys,em;class BP{constructor(o,g){X(this,Hl);X(this,wh);X(this,Ys);X(this,em,Pe(()=>({id:I(this,Hl).current,[I(this,Ys).attrs.description]:"",...I(this,Ys).sharedProps})));qe(this,Hl,o.id),qe(this,Ys,g),qe(this,wh,o.ref),_r({id:I(this,Hl),ref:I(this,wh),deps:()=>I(this,Ys).open.current,onRefChange:v=>{I(this,Ys).descriptionNode=v,I(this,Ys).descriptionId=v==null?void 0:v.id}})}get props(){return R(I(this,em))}}Hl=new WeakMap,wh=new WeakMap,Ys=new WeakMap,em=new WeakMap;var Xl,Sh,tm,im;class NP{constructor(o,g){X(this,Xl);X(this,Sh);Ue(this,"root");X(this,tm,Pe(()=>({open:this.root.open.current})));X(this,im,Pe(()=>({id:I(this,Xl).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));qe(this,Xl,o.id),this.root=g,qe(this,Sh,o.ref),_r({id:I(this,Xl),ref:I(this,Sh),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return R(I(this,tm))}get props(){return R(I(this,im))}}Xl=new WeakMap,Sh=new WeakMap,tm=new WeakMap,im=new WeakMap;var Kl,Ph,rm,nm;class VP{constructor(o,g){X(this,Kl);X(this,Ph);Ue(this,"root");X(this,rm,Pe(()=>({open:this.root.open.current})));X(this,nm,Pe(()=>({id:I(this,Kl).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));qe(this,Kl,o.id),qe(this,Ph,o.ref),this.root=g,_r({id:I(this,Kl),ref:I(this,Ph),deps:()=>this.root.open.current})}get snippetProps(){return R(I(this,rm))}get props(){return R(I(this,nm))}}Kl=new WeakMap,Ph=new WeakMap,rm=new WeakMap,nm=new WeakMap;const[jP,Dg]=Ga("Dialog.Root");function UP(f){return jP(new OP(f))}function qP(f){return new FP(f,Dg())}function ZP(f){return new NP(f,Dg())}function GP(f){return new VP(f,Dg())}function WP(f){return new BP(f,Dg())}var HP=Rt("<div><!></div>");function XP(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"level",3,2),E=Jt(o,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const w=qP({id:Se.with(()=>g()),level:Se.with(()=>T()),ref:Se.with(()=>v(),V=>v(V))}),c=Pe(()=>er(E,w.props));var U=tt(),W=Be(U);{var K=V=>{var ne=tt(),oe=Be(ne);Ot(oe,()=>o.child,()=>({props:R(c)})),we(V,ne)},j=V=>{var ne=HP();let oe;var ce=Kt(ne);Ot(ce,()=>o.children??ei),Wt(ne),$t(()=>oe=ji(ne,oe,{...R(c)})),we(V,ne)};gi(W,V=>{o.child?V(K):V(j,!1)})}we(f,U),Et()}function KP(f,o){At(o,!0);var g=tt(),v=Be(g);L0(v,()=>o.children,T=>{var E=tt(),w=Be(E);Ot(w,()=>o.children??ei),we(T,E)}),we(f,g),Et()}function sb(f,o){At(o,!0);let g=ee(o,"to",3,"body");const v=u2();let T=Pe(E);function E(){if(!Fy||o.disabled)return null;let K=null;return typeof g()=="string"?K=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(K=g()),K}let w;Pt(()=>{if(!R(T)||o.disabled){w&&(jx(w),w=null);return}return Vi(()=>w=f2(KP,{target:R(T),props:{children:o.children},context:v})),()=>{w&&(jx(w),w=null)}});var c=tt(),U=Be(c);{var W=K=>{var j=tt(),V=Be(j);Ot(V,()=>o.children??ei),we(K,j)};gi(U,K=>{o.disabled&&K(W)})}we(f,c),Et()}function Ps(f,o,g,v){const T=Array.isArray(o)?o:[o];return T.forEach(E=>f.addEventListener(E,g,v)),()=>{T.forEach(E=>f.removeEventListener(E,g,v))}}function n0(f,o=500){let g=null;const v=(...T)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{f(...T)},o)};return v.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},v}function Ny(f,o){return f===o||f.contains(o)}function ob(f){return(f==null?void 0:f.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var Jl,La,qo,Yl,Zo,$l,Ql,Th,Ih,Ch,$s,sm,Dc,ab,om,ec,am,lm,cm,um,Ah,lb,hm,dm;class JP{constructor(o){X(this,Dc);X(this,Jl);X(this,La);X(this,qo,{pointerdown:!1});X(this,Yl,!1);Ue(this,"node",Se(null));X(this,Zo);X(this,$l);X(this,Ql,Ye(!1));X(this,Th);X(this,Ih,Ye(null));X(this,Ch);X(this,$s,ur);X(this,sm,o=>{o.defaultPrevented||this.currNode&&Mc(()=>{var g,v;!this.currNode||I(this,um).call(this,o.target)||o.target&&!R(I(this,Ql))&&((v=(g=I(this,Th)).current)==null||v.call(g,o))})});X(this,om,o=>{let g=o;g.defaultPrevented&&(g=s0(o)),I(this,Jl).current(o)});X(this,ec,n0(o=>{if(!this.currNode){I(this,$s).call(this);return}const g=I(this,Ch).current(o,this.currNode)||eT(o,this.currNode);if(!I(this,Yl)||Zr(this,Dc,lb).call(this)||!g){I(this,$s).call(this);return}let v=o;if(v.defaultPrevented&&(v=s0(v)),I(this,La).current!=="close"&&I(this,La).current!=="defer-otherwise-close"){I(this,$s).call(this);return}o.pointerType==="touch"?(I(this,$s).call(this),qe(this,$s,Ps(I(this,Zo),"click",I(this,om),{once:!0}))):I(this,Jl).current(v)},10));X(this,am,o=>{I(this,qo)[o.type]=!0});X(this,lm,o=>{I(this,qo)[o.type]=!1});X(this,cm,()=>{this.node.current&&qe(this,Yl,QP(this.node.current))});X(this,um,o=>this.node.current?Ny(this.node.current,o):!1);X(this,Ah,n0(()=>{for(const o in I(this,qo))I(this,qo)[o]=!1;qe(this,Yl,!1)},20));X(this,hm,()=>{Oe(I(this,Ql),!0)});X(this,dm,()=>{Oe(I(this,Ql),!1)});Ue(this,"props",{onfocuscapture:I(this,hm),onblurcapture:I(this,dm)});qe(this,$l,o.enabled),qe(this,Ch,o.isValidEvent),_r({id:o.id,ref:this.node,deps:()=>I(this,$l).current,onRefChange:T=>{this.currNode=T}}),qe(this,La,o.interactOutsideBehavior),qe(this,Jl,o.onInteractOutside),qe(this,Th,o.onFocusOutside),Pt(()=>{qe(this,Zo,ob(this.currNode))});let g=ur;const v=()=>{I(this,Ah).call(this),globalThis.bitsDismissableLayers.delete(this),I(this,ec).destroy(),g()};Pt(()=>(I(this,$l).current&&this.currNode&&Ap(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,Vi(()=>I(this,La))),g(),g=Zr(this,Dc,ab).call(this))}),()=>{v()})),sP(()=>{I(this,Ah).destroy(),globalThis.bitsDismissableLayers.delete(this),I(this,ec).destroy(),I(this,$s).call(this),g()})}get currNode(){return R(I(this,Ih))}set currNode(o){Oe(I(this,Ih),Ze(o))}}Jl=new WeakMap,La=new WeakMap,qo=new WeakMap,Yl=new WeakMap,Zo=new WeakMap,$l=new WeakMap,Ql=new WeakMap,Th=new WeakMap,Ih=new WeakMap,Ch=new WeakMap,$s=new WeakMap,sm=new WeakMap,Dc=new WeakSet,ab=function(){return ql(Ps(I(this,Zo),"pointerdown",ql(I(this,am),I(this,cm)),!0),Ps(I(this,Zo),"pointerdown",ql(I(this,lm),I(this,ec))),Ps(I(this,Zo),"focusin",I(this,sm)))},om=new WeakMap,ec=new WeakMap,am=new WeakMap,lm=new WeakMap,cm=new WeakMap,um=new WeakMap,Ah=new WeakMap,lb=function(){return Object.values(I(this,qo)).some(Boolean)},hm=new WeakMap,dm=new WeakMap;function YP(f){return new JP(f)}function $P(f){return f.findLast(([o,{current:g}])=>g==="close"||g==="ignore")}function QP(f){const o=[...globalThis.bitsDismissableLayers],g=$P(o);if(g)return g[0].node.current===f;const[v]=o[0];return v.node.current===f}function eT(f,o){if("button"in f&&f.button>0)return!1;const g=f.target;return wP(g)?ob(g).documentElement.contains(g)&&!Ny(o,g):!1}function s0(f){const o=f.currentTarget,g=f.target;let v;f instanceof PointerEvent?v=new PointerEvent(f.type,f):v=new PointerEvent("pointerdown",f);let T=!1;return new Proxy(v,{get:(w,c)=>c==="currentTarget"?o:c==="target"?g:c==="preventDefault"?()=>{T=!0,typeof w.preventDefault=="function"&&w.preventDefault()}:c==="defaultPrevented"?T:c in w?w[c]:f[c]})}function cb(f,o){At(o,!0);let g=ee(o,"interactOutsideBehavior",3,"close"),v=ee(o,"onInteractOutside",3,ur),T=ee(o,"onFocusOutside",3,ur),E=ee(o,"isValidEvent",3,()=>!1);const w=YP({id:Se.with(()=>o.id),interactOutsideBehavior:Se.with(()=>g()),onInteractOutside:Se.with(()=>v()),enabled:Se.with(()=>o.enabled),onFocusOutside:Se.with(()=>T()),isValidEvent:Se.with(()=>E())});var c=tt(),U=Be(c);Ot(U,()=>o.children??ei,()=>({props:w.props})),we(f,c),Et()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var Eh,tc,kh,pm,fm;class tT{constructor(o){X(this,Eh);X(this,tc);X(this,kh);X(this,pm,()=>Ps(document,"keydown",I(this,fm),{passive:!1}));X(this,fm,o=>{if(o.key!==pP||!rT(this))return;const g=new KeyboardEvent(o.type,o);o.preventDefault();const v=I(this,tc).current;v!=="close"&&v!=="defer-otherwise-close"||I(this,Eh).current(g)});qe(this,tc,o.escapeKeydownBehavior),qe(this,Eh,o.onEscapeKeydown),qe(this,kh,o.enabled);let g=ur;Pt(()=>(I(this,kh).current&&(globalThis.bitsEscapeLayers.set(this,Vi(()=>I(this,tc))),g=I(this,pm).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}Eh=new WeakMap,tc=new WeakMap,kh=new WeakMap,pm=new WeakMap,fm=new WeakMap;function iT(f){return new tT(f)}function rT(f){const o=[...globalThis.bitsEscapeLayers],g=o.findLast(([T,{current:E}])=>E==="close"||E==="ignore");if(g)return g[0]===f;const[v]=o[0];return v===f}function ub(f,o){At(o,!0);let g=ee(o,"escapeKeydownBehavior",3,"close"),v=ee(o,"onEscapeKeydown",3,ur);iT({escapeKeydownBehavior:Se.with(()=>g()),onEscapeKeydown:Se.with(()=>v()),enabled:Se.with(()=>o.enabled)});var T=tt(),E=Be(T);Ot(E,()=>o.children??ei),we(f,T),Et()}const nT=Se([]);function sT(){const f=nT;return{add(o){const g=f.current[0];o.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),f.current=o0(f.current,o),f.current.unshift(o)},remove(o){var g;f.current=o0(f.current,o),(g=f.current[0])==null||g.resume()}}}function oT(){let f=Ye(!1);return{id:Ar(),get paused(){return R(f)},pause(){Oe(f,!0)},resume(){Oe(f,!1)}}}function o0(f,o){return[...f].filter(g=>g.id!==o.id)}function aT(f){return f.filter(o=>o.tagName!=="A")}function No(f,{select:o=!1}={}){if(!(f&&f.focus))return;const g=document.activeElement;f.focus({preventScroll:!0}),f!==g&&PP(f)&&o&&f.select()}function lT(f,{select:o=!1}={}){const g=document.activeElement;for(const v of f)if(No(v,{select:o}),document.activeElement!==g)return!0}function a0(f,o){for(const g of f)if(!TP(g,o))return g}function hb(f){const o=[],g=document.createTreeWalker(f,NodeFilter.SHOW_ELEMENT,{acceptNode:v=>{const T=v.tagName==="INPUT"&&v.type==="hidden";return v.disabled||v.hidden||T?NodeFilter.FILTER_SKIP:v.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)o.push(g.currentNode);return o}function cT(f){const o=hb(f),g=a0(o,f),v=a0(o.reverse(),f);return[g,v]}const uT="focusScope.autoFocusOnMount",hT="focusScope.autoFocusOnDestroy",l0={bubbles:!1,cancelable:!0};function dT({id:f,loop:o,enabled:g,onOpenAutoFocus:v,onCloseAutoFocus:T,forceMount:E}){const w=sT(),c=oT(),U=Se(null);_r({id:f,ref:U,deps:()=>g.current});let W=Ye(null);Pt(()=>{const oe=U.current;if(!oe||!g.current)return;function ce(_e){if(c.paused||!oe)return;const ke=_e.target;Wf(ke)&&(oe.contains(ke)?Oe(W,Ze(ke)):No(R(W),{select:!0}))}function fe(_e){if(c.paused||!oe)return;const ke=_e.relatedTarget;Wf(ke)&&ke!==null&&(oe.contains(ke)||No(R(W),{select:!0}))}function Ie(_e){(oe==null?void 0:oe.contains(R(W)))||No(oe)}return Vi(()=>{const _e=ql(Ps(document,"focusin",ce),Ps(document,"focusout",fe)),ke=new MutationObserver(Ie);return ke.observe(oe,{childList:!0,subtree:!0}),()=>{_e(),ke.disconnect()}})}),Pt(()=>{if(E.current)return;let oe=U.current;const ce=document.activeElement;return Vi(()=>{K(oe,ce)}),()=>{oe&&j(ce)}}),Pt(()=>{if(!E.current)return;g.current;const oe=U.current,ce=document.activeElement;return Vi(()=>{K(oe,ce)}),()=>{oe&&j(ce)}});function K(oe,ce){if(oe||(oe=document.getElementById(f.current)),!oe)return;if(w.add(c),!oe.contains(ce)){const Ie=new CustomEvent(uT,l0);v.current(Ie),Ie.defaultPrevented||Mc(()=>{oe&&(lT(aT(hb(oe)),{select:!0}),document.activeElement===ce&&No(oe))})}}function j(oe){const ce=new CustomEvent(hT,l0);T.current(ce),setTimeout(()=>{!ce.defaultPrevented&&oe&&No(oe??document.body,{select:!0}),w.remove(c)},0)}function V(oe){if(!g.current||!o.current&&!g.current||c.paused)return;const ce=oe.key===gP&&!oe.ctrlKey&&!oe.altKey&&!oe.metaKey,fe=document.activeElement;if(!(ce&&fe))return;const Ie=U.current;if(!Ie)return;const[_e,ke]=cT(Ie);_e&&ke?!oe.shiftKey&&fe===ke?(oe.preventDefault(),o.current&&No(_e,{select:!0})):oe.shiftKey&&fe===_e&&(oe.preventDefault(),o.current&&No(ke,{select:!0})):fe===Ie&&oe.preventDefault()}const ne=Pe(()=>({id:f.current,tabindex:-1,onkeydown:V}));return{get props(){return R(ne)}}}function db(f,o){At(o,!0);let g=ee(o,"trapFocus",3,!1),v=ee(o,"loop",3,!1),T=ee(o,"onCloseAutoFocus",3,ur),E=ee(o,"onOpenAutoFocus",3,ur),w=ee(o,"forceMount",3,!1);const c=dT({enabled:Se.with(()=>g()),loop:Se.with(()=>v()),onCloseAutoFocus:Se.with(()=>T()),onOpenAutoFocus:Se.with(()=>E()),id:Se.with(()=>o.id),forceMount:Se.with(()=>w())});var U=tt(),W=Be(U);Ot(W,()=>o.focusScope??ei,()=>({props:c.props})),we(f,U),Et()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Mh,zh,Dh,Go,ic,Rh,mm,pb,gm,Lh;class pT{constructor(o){X(this,mm);X(this,Mh);X(this,zh);X(this,Dh);X(this,Go);X(this,ic,ur);X(this,Rh,Se(null));X(this,gm,o=>{const g=I(this,Rh).current,v=o.target;!Wf(g)||!Wf(v)||!I(this,Go).current||!gT(this)||!Ny(g,v)||(I(this,zh).current(o),!o.defaultPrevented&&qe(this,ic,mT(g)))});X(this,Lh,()=>{I(this,ic).call(this),qe(this,ic,ur)});qe(this,Mh,o.id),qe(this,Go,o.preventOverflowTextSelection),qe(this,zh,o.onPointerDown),qe(this,Dh,o.onPointerUp),_r({id:I(this,Mh),ref:I(this,Rh),deps:()=>I(this,Go).current});let g=ur;Pt(()=>(I(this,Go).current&&(globalThis.bitsTextSelectionLayers.set(this,Vi(()=>I(this,Go))),g=Zr(this,mm,pb).call(this)),()=>{g(),I(this,Lh).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Mh=new WeakMap,zh=new WeakMap,Dh=new WeakMap,Go=new WeakMap,ic=new WeakMap,Rh=new WeakMap,mm=new WeakSet,pb=function(){return ql(Ps(document,"pointerdown",I(this,gm)),Ps(document,"pointerup",Q0(I(this,Lh),I(this,Dh))))},gm=new WeakMap,Lh=new WeakMap;function fT(f){return new pT(f)}const c0=f=>f.style.userSelect||f.style.webkitUserSelect;function mT(f){const o=document.body,g=c0(o),v=c0(f);return Bf(o,"none"),Bf(f,"text"),()=>{Bf(o,g),Bf(f,v)}}function Bf(f,o){f.style.userSelect=o,f.style.webkitUserSelect=o}function gT(f){const o=[...globalThis.bitsTextSelectionLayers];if(!o.length)return!1;const g=o.at(-1);return g?g[0]===f:!1}function fb(f,o){At(o,!0);let g=ee(o,"preventOverflowTextSelection",3,!0),v=ee(o,"onPointerDown",3,ur),T=ee(o,"onPointerUp",3,ur);fT({id:Se.with(()=>o.id),preventOverflowTextSelection:Se.with(()=>g()),onPointerDown:Se.with(()=>v()),onPointerUp:Se.with(()=>T()),enabled:Se.with(()=>o.enabled)});var E=tt(),w=Be(E);Ot(w,()=>o.children??ei),we(f,E),Et()}var _T=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],yT=["difference","intersection","symmetricDifference","union"],u0=!1,rc,rs,Wo,_m,mb;const ym=class ym extends Set{constructor(g){super();X(this,_m);X(this,rc,new Map);X(this,rs,Ks(0));X(this,Wo,Ks(0));if(g){for(var v of g)super.add(v);I(this,Wo).v=super.size}u0||Zr(this,_m,mb).call(this)}has(g){var v=super.has(g),T=I(this,rc),E=T.get(g);if(E===void 0){if(!v)return R(I(this,rs)),!1;E=Ks(!0),T.set(g,E)}return R(E),v}add(g){return super.has(g)||(super.add(g),Oe(I(this,Wo),super.size),Vo(I(this,rs))),this}delete(g){var v=super.delete(g),T=I(this,rc),E=T.get(g);return E!==void 0&&(T.delete(g),Oe(E,!1)),v&&(Oe(I(this,Wo),super.size),Vo(I(this,rs))),v}clear(){if(super.size!==0){super.clear();var g=I(this,rc);for(var v of g.values())Oe(v,!1);g.clear(),Oe(I(this,Wo),0),Vo(I(this,rs))}}keys(){return this.values()}values(){return R(I(this,rs)),super.values()}entries(){return R(I(this,rs)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return R(I(this,Wo))}};rc=new WeakMap,rs=new WeakMap,Wo=new WeakMap,_m=new WeakSet,mb=function(){u0=!0;var g=ym.prototype,v=Set.prototype;for(const T of _T)g[T]=function(...E){return R(I(this,rs)),v[T].apply(this,E)};for(const T of yT)g[T]=function(...E){R(I(this,rs));var w=v[T].apply(this,E);return new ym(w)}};let Sy=ym;var vs,xs,Qs,nc,qf;const $y=class $y extends Map{constructor(g){super();X(this,nc);X(this,vs,new Map);X(this,xs,Ks(0));X(this,Qs,Ks(0));if(g){for(var[v,T]of g)super.set(v,T);I(this,Qs).v=super.size}}has(g){var v=I(this,vs),T=v.get(g);if(T===void 0){var E=super.get(g);if(E!==void 0)T=Ks(0),v.set(g,T);else return R(I(this,xs)),!1}return R(T),!0}forEach(g,v){Zr(this,nc,qf).call(this),super.forEach(g,v)}get(g){var v=I(this,vs),T=v.get(g);if(T===void 0){var E=super.get(g);if(E!==void 0)T=Ks(0),v.set(g,T);else{R(I(this,xs));return}}return R(T),super.get(g)}set(g,v){var j;var T=I(this,vs),E=T.get(g),w=super.get(g),c=super.set(g,v),U=I(this,xs);if(E===void 0)T.set(g,Ks(0)),Oe(I(this,Qs),super.size),Vo(U);else if(w!==v){Vo(E);var W=U.reactions===null?null:new Set(U.reactions),K=W===null||!((j=E.reactions)!=null&&j.every(V=>W.has(V)));K&&Vo(U)}return c}delete(g){var v=I(this,vs),T=v.get(g),E=super.delete(g);return T!==void 0&&(v.delete(g),Oe(I(this,Qs),super.size),Oe(T,-1),Vo(I(this,xs))),E}clear(){if(super.size!==0){super.clear();var g=I(this,vs);Oe(I(this,Qs),0);for(var v of g.values())Oe(v,-1);Vo(I(this,xs)),g.clear()}}keys(){return R(I(this,xs)),super.keys()}values(){return Zr(this,nc,qf).call(this),super.values()}entries(){return Zr(this,nc,qf).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return R(I(this,Qs)),super.size}};vs=new WeakMap,xs=new WeakMap,Qs=new WeakMap,nc=new WeakSet,qf=function(){R(I(this,xs));var g=I(this,vs);if(I(this,Qs).v!==g.size)for(var v of Fx($y.prototype,this,"keys").call(this))g.has(v)||g.set(v,Ks(0));for(var[,T]of I(this,vs))R(T)};let Py=$y;function vT(f){let o=0,g=Ye(void 0),v;function T(){o-=1,v&&o<=0&&(v(),Oe(g,void 0),v=void 0)}return(...E)=>(o+=1,R(g)===void 0&&(v=h2(()=>{Oe(g,Ze(f(...E)))})),Pt(()=>()=>{T()}),R(g))}const xT=vT(()=>{const f=new Py,o=Pe(()=>{for(const E of f.values())if(E)return!0;return!1});let g=Ze({}),v=null;function T(){Fy&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",t0&&(v==null||v()))}return Pt(()=>{const E=R(o);return Vi(()=>{if(!E)return;const w=getComputedStyle(document.body);g.overflow=w.overflow,g.paddingRight=w.paddingRight,g.marginRight=w.marginRight,g.pointerEvents=w.pointerEvents;const c=window.innerWidth-document.documentElement.clientWidth,W={padding:Number.parseInt(g.paddingRight??"0",10)+c,margin:Number.parseInt(g.marginRight??"0",10)};c>0&&(document.body.style.paddingRight=`${W.padding}px`,document.body.style.marginRight=`${W.margin}px`,document.body.style.setProperty("--scrollbar-width",`${c}px`),document.body.style.overflow="hidden"),t0&&(v=Ps(document,"touchmove",K=>{K.target===document.documentElement&&(K.touches.length>1||K.preventDefault())},{passive:!1})),Mc(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Pt(()=>()=>{v==null||v()}),{get map(){return f},resetBodyStyle:T}});function bT(f,o=()=>null){const g=Ar(),v=xT(),T=Pe(o);v.map.set(g,f??!1);const E=Se.with(()=>v.map.get(g)??!1,w=>v.map.set(g,w));return Pt(()=>()=>{v.map.delete(g),!wT(v.map)&&(R(T)===null?requestAnimationFrame(()=>v.resetBodyStyle()):Ap(R(T),()=>v.resetBodyStyle()))}),E}function wT(f){for(const[o,g]of f)if(g)return!0;return!1}function Hf(f,o){At(o,!0);let g=ee(o,"preventScroll",3,!0),v=ee(o,"restoreScrollDelay",3,null);bT(g(),()=>v()),Et()}function ST({forceMount:f,present:o,trapFocus:g,open:v}){return f?v&&g:o&&g&&v}var PT=Rt("<div><!></div>");function TT(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"forceMount",3,!1),T=ee(o,"ref",15,null),E=Jt(o,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const w=GP({id:Se.with(()=>g()),ref:Se.with(()=>T(),W=>T(W))}),c=Pe(()=>er(E,w.props));var U=Pe(()=>w.root.open.current||v());By(f,{get id(){return g()},get present(){return R(U)},presence:K=>{var j=tt(),V=Be(j);{var ne=ce=>{var fe=tt(),Ie=Be(fe),_e=kg(()=>({props:er(R(c)),...w.snippetProps}));Ot(Ie,()=>o.child,()=>R(_e)),we(ce,fe)},oe=ce=>{var fe=PT();const Ie=Pe(()=>er(R(c)));let _e;var ke=Kt(fe);Ot(ke,()=>o.children??ei,()=>w.snippetProps),Wt(fe),$t(()=>_e=ji(fe,_e,{...R(Ie)})),we(ce,fe)};gi(V,ce=>{o.child?ce(ne):ce(oe,!1)})}we(K,j)},$$slots:{presence:!0}}),Et()}var IT=Rt("<div><!></div>");function CT(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","children","child","ref"]);const E=WP({id:Se.with(()=>g()),ref:Se.with(()=>v(),j=>v(j))}),w=Pe(()=>er(T,E.props));var c=tt(),U=Be(c);{var W=j=>{var V=tt(),ne=Be(V);Ot(ne,()=>o.child,()=>({props:R(w)})),we(j,V)},K=j=>{var V=IT();let ne;var oe=Kt(V);Ot(oe,()=>o.children??ei),Wt(V),$t(()=>ne=ji(V,ne,{...R(w)})),we(j,V)};gi(U,j=>{o.child?j(W):j(K,!1)})}we(f,c),Et()}const AT=["top","right","bottom","left"],ta=Math.min,Nn=Math.max,Xf=Math.round,Nf=Math.floor,Ts=f=>({x:f,y:f}),ET={left:"right",right:"left",bottom:"top",top:"bottom"},kT={start:"end",end:"start"};function Ty(f,o,g){return Nn(f,ta(o,g))}function eo(f,o){return typeof f=="function"?f(o):f}function to(f){return f.split("-")[0]}function Lc(f){return f.split("-")[1]}function Vy(f){return f==="x"?"y":"x"}function jy(f){return f==="y"?"height":"width"}function ia(f){return["top","bottom"].includes(to(f))?"y":"x"}function Uy(f){return Vy(ia(f))}function MT(f,o,g){g===void 0&&(g=!1);const v=Lc(f),T=Uy(f),E=jy(T);let w=T==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return o.reference[E]>o.floating[E]&&(w=Kf(w)),[w,Kf(w)]}function zT(f){const o=Kf(f);return[Iy(f),o,Iy(o)]}function Iy(f){return f.replace(/start|end/g,o=>kT[o])}function DT(f,o,g){const v=["left","right"],T=["right","left"],E=["top","bottom"],w=["bottom","top"];switch(f){case"top":case"bottom":return g?o?T:v:o?v:T;case"left":case"right":return o?E:w;default:return[]}}function RT(f,o,g,v){const T=Lc(f);let E=DT(to(f),g==="start",v);return T&&(E=E.map(w=>w+"-"+T),o&&(E=E.concat(E.map(Iy)))),E}function Kf(f){return f.replace(/left|right|bottom|top/g,o=>ET[o])}function LT(f){return{top:0,right:0,bottom:0,left:0,...f}}function gb(f){return typeof f!="number"?LT(f):{top:f,right:f,bottom:f,left:f}}function Jf(f){const{x:o,y:g,width:v,height:T}=f;return{width:v,height:T,top:g,left:o,right:o+v,bottom:g+T,x:o,y:g}}function h0(f,o,g){let{reference:v,floating:T}=f;const E=ia(o),w=Uy(o),c=jy(w),U=to(o),W=E==="y",K=v.x+v.width/2-T.width/2,j=v.y+v.height/2-T.height/2,V=v[c]/2-T[c]/2;let ne;switch(U){case"top":ne={x:K,y:v.y-T.height};break;case"bottom":ne={x:K,y:v.y+v.height};break;case"right":ne={x:v.x+v.width,y:j};break;case"left":ne={x:v.x-T.width,y:j};break;default:ne={x:v.x,y:v.y}}switch(Lc(o)){case"start":ne[w]-=V*(g&&W?-1:1);break;case"end":ne[w]+=V*(g&&W?-1:1);break}return ne}const OT=async(f,o,g)=>{const{placement:v="bottom",strategy:T="absolute",middleware:E=[],platform:w}=g,c=E.filter(Boolean),U=await(w.isRTL==null?void 0:w.isRTL(o));let W=await w.getElementRects({reference:f,floating:o,strategy:T}),{x:K,y:j}=h0(W,v,U),V=v,ne={},oe=0;for(let ce=0;ce<c.length;ce++){const{name:fe,fn:Ie}=c[ce],{x:_e,y:ke,data:Ne,reset:De}=await Ie({x:K,y:j,initialPlacement:v,placement:V,strategy:T,middlewareData:ne,rects:W,platform:w,elements:{reference:f,floating:o}});K=_e??K,j=ke??j,ne={...ne,[fe]:{...ne[fe],...Ne}},De&&oe<=50&&(oe++,typeof De=="object"&&(De.placement&&(V=De.placement),De.rects&&(W=De.rects===!0?await w.getElementRects({reference:f,floating:o,strategy:T}):De.rects),{x:K,y:j}=h0(W,V,U)),ce=-1)}return{x:K,y:j,placement:V,strategy:T,middlewareData:ne}};async function oh(f,o){var g;o===void 0&&(o={});const{x:v,y:T,platform:E,rects:w,elements:c,strategy:U}=f,{boundary:W="clippingAncestors",rootBoundary:K="viewport",elementContext:j="floating",altBoundary:V=!1,padding:ne=0}=eo(o,f),oe=gb(ne),fe=c[V?j==="floating"?"reference":"floating":j],Ie=Jf(await E.getClippingRect({element:(g=await(E.isElement==null?void 0:E.isElement(fe)))==null||g?fe:fe.contextElement||await(E.getDocumentElement==null?void 0:E.getDocumentElement(c.floating)),boundary:W,rootBoundary:K,strategy:U})),_e=j==="floating"?{x:v,y:T,width:w.floating.width,height:w.floating.height}:w.reference,ke=await(E.getOffsetParent==null?void 0:E.getOffsetParent(c.floating)),Ne=await(E.isElement==null?void 0:E.isElement(ke))?await(E.getScale==null?void 0:E.getScale(ke))||{x:1,y:1}:{x:1,y:1},De=Jf(E.convertOffsetParentRelativeRectToViewportRelativeRect?await E.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:_e,offsetParent:ke,strategy:U}):_e);return{top:(Ie.top-De.top+oe.top)/Ne.y,bottom:(De.bottom-Ie.bottom+oe.bottom)/Ne.y,left:(Ie.left-De.left+oe.left)/Ne.x,right:(De.right-Ie.right+oe.right)/Ne.x}}const FT=f=>({name:"arrow",options:f,async fn(o){const{x:g,y:v,placement:T,rects:E,platform:w,elements:c,middlewareData:U}=o,{element:W,padding:K=0}=eo(f,o)||{};if(W==null)return{};const j=gb(K),V={x:g,y:v},ne=Uy(T),oe=jy(ne),ce=await w.getDimensions(W),fe=ne==="y",Ie=fe?"top":"left",_e=fe?"bottom":"right",ke=fe?"clientHeight":"clientWidth",Ne=E.reference[oe]+E.reference[ne]-V[ne]-E.floating[oe],De=V[ne]-E.reference[ne],Xe=await(w.getOffsetParent==null?void 0:w.getOffsetParent(W));let it=Xe?Xe[ke]:0;(!it||!await(w.isElement==null?void 0:w.isElement(Xe)))&&(it=c.floating[ke]||E.floating[oe]);const Ct=Ne/2-De/2,Je=it/2-ce[oe]/2-1,St=ta(j[Ie],Je),dt=ta(j[_e],Je),Ge=St,Fe=it-ce[oe]-dt,Ee=it/2-ce[oe]/2+Ct,Le=Ty(Ge,Ee,Fe),Ke=!U.arrow&&Lc(T)!=null&&Ee!==Le&&E.reference[oe]/2-(Ee<Ge?St:dt)-ce[oe]/2<0,pt=Ke?Ee<Ge?Ee-Ge:Ee-Fe:0;return{[ne]:V[ne]+pt,data:{[ne]:Le,centerOffset:Ee-Le-pt,...Ke&&{alignmentOffset:pt}},reset:Ke}}}),BT=function(f){return f===void 0&&(f={}),{name:"flip",options:f,async fn(o){var g,v;const{placement:T,middlewareData:E,rects:w,initialPlacement:c,platform:U,elements:W}=o,{mainAxis:K=!0,crossAxis:j=!0,fallbackPlacements:V,fallbackStrategy:ne="bestFit",fallbackAxisSideDirection:oe="none",flipAlignment:ce=!0,...fe}=eo(f,o);if((g=E.arrow)!=null&&g.alignmentOffset)return{};const Ie=to(T),_e=ia(c),ke=to(c)===c,Ne=await(U.isRTL==null?void 0:U.isRTL(W.floating)),De=V||(ke||!ce?[Kf(c)]:zT(c)),Xe=oe!=="none";!V&&Xe&&De.push(...RT(c,ce,oe,Ne));const it=[c,...De],Ct=await oh(o,fe),Je=[];let St=((v=E.flip)==null?void 0:v.overflows)||[];if(K&&Je.push(Ct[Ie]),j){const Ee=MT(T,w,Ne);Je.push(Ct[Ee[0]],Ct[Ee[1]])}if(St=[...St,{placement:T,overflows:Je}],!Je.every(Ee=>Ee<=0)){var dt,Ge;const Ee=(((dt=E.flip)==null?void 0:dt.index)||0)+1,Le=it[Ee];if(Le)return{data:{index:Ee,overflows:St},reset:{placement:Le}};let Ke=(Ge=St.filter(pt=>pt.overflows[0]<=0).sort((pt,yt)=>pt.overflows[1]-yt.overflows[1])[0])==null?void 0:Ge.placement;if(!Ke)switch(ne){case"bestFit":{var Fe;const pt=(Fe=St.filter(yt=>{if(Xe){const lt=ia(yt.placement);return lt===_e||lt==="y"}return!0}).map(yt=>[yt.placement,yt.overflows.filter(lt=>lt>0).reduce((lt,ut)=>lt+ut,0)]).sort((yt,lt)=>yt[1]-lt[1])[0])==null?void 0:Fe[0];pt&&(Ke=pt);break}case"initialPlacement":Ke=c;break}if(T!==Ke)return{reset:{placement:Ke}}}return{}}}};function d0(f,o){return{top:f.top-o.height,right:f.right-o.width,bottom:f.bottom-o.height,left:f.left-o.width}}function p0(f){return AT.some(o=>f[o]>=0)}const NT=function(f){return f===void 0&&(f={}),{name:"hide",options:f,async fn(o){const{rects:g}=o,{strategy:v="referenceHidden",...T}=eo(f,o);switch(v){case"referenceHidden":{const E=await oh(o,{...T,elementContext:"reference"}),w=d0(E,g.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:p0(w)}}}case"escaped":{const E=await oh(o,{...T,altBoundary:!0}),w=d0(E,g.floating);return{data:{escapedOffsets:w,escaped:p0(w)}}}default:return{}}}}};async function VT(f,o){const{placement:g,platform:v,elements:T}=f,E=await(v.isRTL==null?void 0:v.isRTL(T.floating)),w=to(g),c=Lc(g),U=ia(g)==="y",W=["left","top"].includes(w)?-1:1,K=E&&U?-1:1,j=eo(o,f);let{mainAxis:V,crossAxis:ne,alignmentAxis:oe}=typeof j=="number"?{mainAxis:j,crossAxis:0,alignmentAxis:null}:{mainAxis:j.mainAxis||0,crossAxis:j.crossAxis||0,alignmentAxis:j.alignmentAxis};return c&&typeof oe=="number"&&(ne=c==="end"?oe*-1:oe),U?{x:ne*K,y:V*W}:{x:V*W,y:ne*K}}const jT=function(f){return f===void 0&&(f=0),{name:"offset",options:f,async fn(o){var g,v;const{x:T,y:E,placement:w,middlewareData:c}=o,U=await VT(o,f);return w===((g=c.offset)==null?void 0:g.placement)&&(v=c.arrow)!=null&&v.alignmentOffset?{}:{x:T+U.x,y:E+U.y,data:{...U,placement:w}}}}},UT=function(f){return f===void 0&&(f={}),{name:"shift",options:f,async fn(o){const{x:g,y:v,placement:T}=o,{mainAxis:E=!0,crossAxis:w=!1,limiter:c={fn:fe=>{let{x:Ie,y:_e}=fe;return{x:Ie,y:_e}}},...U}=eo(f,o),W={x:g,y:v},K=await oh(o,U),j=ia(to(T)),V=Vy(j);let ne=W[V],oe=W[j];if(E){const fe=V==="y"?"top":"left",Ie=V==="y"?"bottom":"right",_e=ne+K[fe],ke=ne-K[Ie];ne=Ty(_e,ne,ke)}if(w){const fe=j==="y"?"top":"left",Ie=j==="y"?"bottom":"right",_e=oe+K[fe],ke=oe-K[Ie];oe=Ty(_e,oe,ke)}const ce=c.fn({...o,[V]:ne,[j]:oe});return{...ce,data:{x:ce.x-g,y:ce.y-v,enabled:{[V]:E,[j]:w}}}}}},qT=function(f){return f===void 0&&(f={}),{options:f,fn(o){const{x:g,y:v,placement:T,rects:E,middlewareData:w}=o,{offset:c=0,mainAxis:U=!0,crossAxis:W=!0}=eo(f,o),K={x:g,y:v},j=ia(T),V=Vy(j);let ne=K[V],oe=K[j];const ce=eo(c,o),fe=typeof ce=="number"?{mainAxis:ce,crossAxis:0}:{mainAxis:0,crossAxis:0,...ce};if(U){const ke=V==="y"?"height":"width",Ne=E.reference[V]-E.floating[ke]+fe.mainAxis,De=E.reference[V]+E.reference[ke]-fe.mainAxis;ne<Ne?ne=Ne:ne>De&&(ne=De)}if(W){var Ie,_e;const ke=V==="y"?"width":"height",Ne=["top","left"].includes(to(T)),De=E.reference[j]-E.floating[ke]+(Ne&&((Ie=w.offset)==null?void 0:Ie[j])||0)+(Ne?0:fe.crossAxis),Xe=E.reference[j]+E.reference[ke]+(Ne?0:((_e=w.offset)==null?void 0:_e[j])||0)-(Ne?fe.crossAxis:0);oe<De?oe=De:oe>Xe&&(oe=Xe)}return{[V]:ne,[j]:oe}}}},ZT=function(f){return f===void 0&&(f={}),{name:"size",options:f,async fn(o){var g,v;const{placement:T,rects:E,platform:w,elements:c}=o,{apply:U=()=>{},...W}=eo(f,o),K=await oh(o,W),j=to(T),V=Lc(T),ne=ia(T)==="y",{width:oe,height:ce}=E.floating;let fe,Ie;j==="top"||j==="bottom"?(fe=j,Ie=V===(await(w.isRTL==null?void 0:w.isRTL(c.floating))?"start":"end")?"left":"right"):(Ie=j,fe=V==="end"?"top":"bottom");const _e=ce-K.top-K.bottom,ke=oe-K.left-K.right,Ne=ta(ce-K[fe],_e),De=ta(oe-K[Ie],ke),Xe=!o.middlewareData.shift;let it=Ne,Ct=De;if((g=o.middlewareData.shift)!=null&&g.enabled.x&&(Ct=ke),(v=o.middlewareData.shift)!=null&&v.enabled.y&&(it=_e),Xe&&!V){const St=Nn(K.left,0),dt=Nn(K.right,0),Ge=Nn(K.top,0),Fe=Nn(K.bottom,0);ne?Ct=oe-2*(St!==0||dt!==0?St+dt:Nn(K.left,K.right)):it=ce-2*(Ge!==0||Fe!==0?Ge+Fe:Nn(K.top,K.bottom))}await U({...o,availableWidth:Ct,availableHeight:it});const Je=await w.getDimensions(c.floating);return oe!==Je.width||ce!==Je.height?{reset:{rects:!0}}:{}}}};function Rg(){return typeof window<"u"}function Oc(f){return _b(f)?(f.nodeName||"").toLowerCase():"#document"}function Vn(f){var o;return(f==null||(o=f.ownerDocument)==null?void 0:o.defaultView)||window}function As(f){var o;return(o=(_b(f)?f.ownerDocument:f.document)||window.document)==null?void 0:o.documentElement}function _b(f){return Rg()?f instanceof Node||f instanceof Vn(f).Node:!1}function ss(f){return Rg()?f instanceof Element||f instanceof Vn(f).Element:!1}function Cs(f){return Rg()?f instanceof HTMLElement||f instanceof Vn(f).HTMLElement:!1}function f0(f){return!Rg()||typeof ShadowRoot>"u"?!1:f instanceof ShadowRoot||f instanceof Vn(f).ShadowRoot}function Ep(f){const{overflow:o,overflowX:g,overflowY:v,display:T}=os(f);return/auto|scroll|overlay|hidden|clip/.test(o+v+g)&&!["inline","contents"].includes(T)}function GT(f){return["table","td","th"].includes(Oc(f))}function Lg(f){return[":popover-open",":modal"].some(o=>{try{return f.matches(o)}catch{return!1}})}function qy(f){const o=Zy(),g=ss(f)?os(f):f;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!o&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!o&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(v=>(g.willChange||"").includes(v))||["paint","layout","strict","content"].some(v=>(g.contain||"").includes(v))}function WT(f){let o=ra(f);for(;Cs(o)&&!zc(o);){if(qy(o))return o;if(Lg(o))return null;o=ra(o)}return null}function Zy(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function zc(f){return["html","body","#document"].includes(Oc(f))}function os(f){return Vn(f).getComputedStyle(f)}function Og(f){return ss(f)?{scrollLeft:f.scrollLeft,scrollTop:f.scrollTop}:{scrollLeft:f.scrollX,scrollTop:f.scrollY}}function ra(f){if(Oc(f)==="html")return f;const o=f.assignedSlot||f.parentNode||f0(f)&&f.host||As(f);return f0(o)?o.host:o}function yb(f){const o=ra(f);return zc(o)?f.ownerDocument?f.ownerDocument.body:f.body:Cs(o)&&Ep(o)?o:yb(o)}function ah(f,o,g){var v;o===void 0&&(o=[]),g===void 0&&(g=!0);const T=yb(f),E=T===((v=f.ownerDocument)==null?void 0:v.body),w=Vn(T);if(E){const c=Cy(w);return o.concat(w,w.visualViewport||[],Ep(T)?T:[],c&&g?ah(c):[])}return o.concat(T,ah(T,[],g))}function Cy(f){return f.parent&&Object.getPrototypeOf(f.parent)?f.frameElement:null}function vb(f){const o=os(f);let g=parseFloat(o.width)||0,v=parseFloat(o.height)||0;const T=Cs(f),E=T?f.offsetWidth:g,w=T?f.offsetHeight:v,c=Xf(g)!==E||Xf(v)!==w;return c&&(g=E,v=w),{width:g,height:v,$:c}}function Gy(f){return ss(f)?f:f.contextElement}function Zl(f){const o=Gy(f);if(!Cs(o))return Ts(1);const g=o.getBoundingClientRect(),{width:v,height:T,$:E}=vb(o);let w=(E?Xf(g.width):g.width)/v,c=(E?Xf(g.height):g.height)/T;return(!w||!Number.isFinite(w))&&(w=1),(!c||!Number.isFinite(c))&&(c=1),{x:w,y:c}}const HT=Ts(0);function xb(f){const o=Vn(f);return!Zy()||!o.visualViewport?HT:{x:o.visualViewport.offsetLeft,y:o.visualViewport.offsetTop}}function XT(f,o,g){return o===void 0&&(o=!1),!g||o&&g!==Vn(f)?!1:o}function Za(f,o,g,v){o===void 0&&(o=!1),g===void 0&&(g=!1);const T=f.getBoundingClientRect(),E=Gy(f);let w=Ts(1);o&&(v?ss(v)&&(w=Zl(v)):w=Zl(f));const c=XT(E,g,v)?xb(E):Ts(0);let U=(T.left+c.x)/w.x,W=(T.top+c.y)/w.y,K=T.width/w.x,j=T.height/w.y;if(E){const V=Vn(E),ne=v&&ss(v)?Vn(v):v;let oe=V,ce=Cy(oe);for(;ce&&v&&ne!==oe;){const fe=Zl(ce),Ie=ce.getBoundingClientRect(),_e=os(ce),ke=Ie.left+(ce.clientLeft+parseFloat(_e.paddingLeft))*fe.x,Ne=Ie.top+(ce.clientTop+parseFloat(_e.paddingTop))*fe.y;U*=fe.x,W*=fe.y,K*=fe.x,j*=fe.y,U+=ke,W+=Ne,oe=Vn(ce),ce=Cy(oe)}}return Jf({width:K,height:j,x:U,y:W})}function Wy(f,o){const g=Og(f).scrollLeft;return o?o.left+g:Za(As(f)).left+g}function bb(f,o,g){g===void 0&&(g=!1);const v=f.getBoundingClientRect(),T=v.left+o.scrollLeft-(g?0:Wy(f,v)),E=v.top+o.scrollTop;return{x:T,y:E}}function KT(f){let{elements:o,rect:g,offsetParent:v,strategy:T}=f;const E=T==="fixed",w=As(v),c=o?Lg(o.floating):!1;if(v===w||c&&E)return g;let U={scrollLeft:0,scrollTop:0},W=Ts(1);const K=Ts(0),j=Cs(v);if((j||!j&&!E)&&((Oc(v)!=="body"||Ep(w))&&(U=Og(v)),Cs(v))){const ne=Za(v);W=Zl(v),K.x=ne.x+v.clientLeft,K.y=ne.y+v.clientTop}const V=w&&!j&&!E?bb(w,U,!0):Ts(0);return{width:g.width*W.x,height:g.height*W.y,x:g.x*W.x-U.scrollLeft*W.x+K.x+V.x,y:g.y*W.y-U.scrollTop*W.y+K.y+V.y}}function JT(f){return Array.from(f.getClientRects())}function YT(f){const o=As(f),g=Og(f),v=f.ownerDocument.body,T=Nn(o.scrollWidth,o.clientWidth,v.scrollWidth,v.clientWidth),E=Nn(o.scrollHeight,o.clientHeight,v.scrollHeight,v.clientHeight);let w=-g.scrollLeft+Wy(f);const c=-g.scrollTop;return os(v).direction==="rtl"&&(w+=Nn(o.clientWidth,v.clientWidth)-T),{width:T,height:E,x:w,y:c}}function $T(f,o){const g=Vn(f),v=As(f),T=g.visualViewport;let E=v.clientWidth,w=v.clientHeight,c=0,U=0;if(T){E=T.width,w=T.height;const W=Zy();(!W||W&&o==="fixed")&&(c=T.offsetLeft,U=T.offsetTop)}return{width:E,height:w,x:c,y:U}}function QT(f,o){const g=Za(f,!0,o==="fixed"),v=g.top+f.clientTop,T=g.left+f.clientLeft,E=Cs(f)?Zl(f):Ts(1),w=f.clientWidth*E.x,c=f.clientHeight*E.y,U=T*E.x,W=v*E.y;return{width:w,height:c,x:U,y:W}}function m0(f,o,g){let v;if(o==="viewport")v=$T(f,g);else if(o==="document")v=YT(As(f));else if(ss(o))v=QT(o,g);else{const T=xb(f);v={x:o.x-T.x,y:o.y-T.y,width:o.width,height:o.height}}return Jf(v)}function wb(f,o){const g=ra(f);return g===o||!ss(g)||zc(g)?!1:os(g).position==="fixed"||wb(g,o)}function eI(f,o){const g=o.get(f);if(g)return g;let v=ah(f,[],!1).filter(c=>ss(c)&&Oc(c)!=="body"),T=null;const E=os(f).position==="fixed";let w=E?ra(f):f;for(;ss(w)&&!zc(w);){const c=os(w),U=qy(w);!U&&c.position==="fixed"&&(T=null),(E?!U&&!T:!U&&c.position==="static"&&!!T&&["absolute","fixed"].includes(T.position)||Ep(w)&&!U&&wb(f,w))?v=v.filter(K=>K!==w):T=c,w=ra(w)}return o.set(f,v),v}function tI(f){let{element:o,boundary:g,rootBoundary:v,strategy:T}=f;const w=[...g==="clippingAncestors"?Lg(o)?[]:eI(o,this._c):[].concat(g),v],c=w[0],U=w.reduce((W,K)=>{const j=m0(o,K,T);return W.top=Nn(j.top,W.top),W.right=ta(j.right,W.right),W.bottom=ta(j.bottom,W.bottom),W.left=Nn(j.left,W.left),W},m0(o,c,T));return{width:U.right-U.left,height:U.bottom-U.top,x:U.left,y:U.top}}function iI(f){const{width:o,height:g}=vb(f);return{width:o,height:g}}function rI(f,o,g){const v=Cs(o),T=As(o),E=g==="fixed",w=Za(f,!0,E,o);let c={scrollLeft:0,scrollTop:0};const U=Ts(0);if(v||!v&&!E)if((Oc(o)!=="body"||Ep(T))&&(c=Og(o)),v){const V=Za(o,!0,E,o);U.x=V.x+o.clientLeft,U.y=V.y+o.clientTop}else T&&(U.x=Wy(T));const W=T&&!v&&!E?bb(T,c):Ts(0),K=w.left+c.scrollLeft-U.x-W.x,j=w.top+c.scrollTop-U.y-W.y;return{x:K,y:j,width:w.width,height:w.height}}function ly(f){return os(f).position==="static"}function g0(f,o){if(!Cs(f)||os(f).position==="fixed")return null;if(o)return o(f);let g=f.offsetParent;return As(f)===g&&(g=g.ownerDocument.body),g}function Sb(f,o){const g=Vn(f);if(Lg(f))return g;if(!Cs(f)){let T=ra(f);for(;T&&!zc(T);){if(ss(T)&&!ly(T))return T;T=ra(T)}return g}let v=g0(f,o);for(;v&&GT(v)&&ly(v);)v=g0(v,o);return v&&zc(v)&&ly(v)&&!qy(v)?g:v||WT(f)||g}const nI=async function(f){const o=this.getOffsetParent||Sb,g=this.getDimensions,v=await g(f.floating);return{reference:rI(f.reference,await o(f.floating),f.strategy),floating:{x:0,y:0,width:v.width,height:v.height}}};function sI(f){return os(f).direction==="rtl"}const oI={convertOffsetParentRelativeRectToViewportRelativeRect:KT,getDocumentElement:As,getClippingRect:tI,getOffsetParent:Sb,getElementRects:nI,getClientRects:JT,getDimensions:iI,getScale:Zl,isElement:ss,isRTL:sI};function aI(f,o){let g=null,v;const T=As(f);function E(){var c;clearTimeout(v),(c=g)==null||c.disconnect(),g=null}function w(c,U){c===void 0&&(c=!1),U===void 0&&(U=1),E();const{left:W,top:K,width:j,height:V}=f.getBoundingClientRect();if(c||o(),!j||!V)return;const ne=Nf(K),oe=Nf(T.clientWidth-(W+j)),ce=Nf(T.clientHeight-(K+V)),fe=Nf(W),_e={rootMargin:-ne+"px "+-oe+"px "+-ce+"px "+-fe+"px",threshold:Nn(0,ta(1,U))||1};let ke=!0;function Ne(De){const Xe=De[0].intersectionRatio;if(Xe!==U){if(!ke)return w();Xe?w(!1,Xe):v=setTimeout(()=>{w(!1,1e-7)},1e3)}ke=!1}try{g=new IntersectionObserver(Ne,{..._e,root:T.ownerDocument})}catch{g=new IntersectionObserver(Ne,_e)}g.observe(f)}return w(!0),E}function lI(f,o,g,v){v===void 0&&(v={});const{ancestorScroll:T=!0,ancestorResize:E=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:U=!1}=v,W=Gy(f),K=T||E?[...W?ah(W):[],...ah(o)]:[];K.forEach(Ie=>{T&&Ie.addEventListener("scroll",g,{passive:!0}),E&&Ie.addEventListener("resize",g)});const j=W&&c?aI(W,g):null;let V=-1,ne=null;w&&(ne=new ResizeObserver(Ie=>{let[_e]=Ie;_e&&_e.target===W&&ne&&(ne.unobserve(o),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var ke;(ke=ne)==null||ke.observe(o)})),g()}),W&&!U&&ne.observe(W),ne.observe(o));let oe,ce=U?Za(f):null;U&&fe();function fe(){const Ie=Za(f);ce&&(Ie.x!==ce.x||Ie.y!==ce.y||Ie.width!==ce.width||Ie.height!==ce.height)&&g(),ce=Ie,oe=requestAnimationFrame(fe)}return g(),()=>{var Ie;K.forEach(_e=>{T&&_e.removeEventListener("scroll",g),E&&_e.removeEventListener("resize",g)}),j==null||j(),(Ie=ne)==null||Ie.disconnect(),ne=null,U&&cancelAnimationFrame(oe)}}const cI=jT,uI=UT,hI=BT,dI=ZT,pI=NT,fI=FT,mI=qT,gI=(f,o,g)=>{const v=new Map,T={platform:oI,...g},E={...T.platform,_c:v};return OT(f,o,{...T,platform:E})};function Yu(f){return typeof f=="function"?f():f}function Pb(f){return typeof window>"u"?1:(f.ownerDocument.defaultView||window).devicePixelRatio||1}function _0(f,o){const g=Pb(f);return Math.round(o*g)/g}function y0(f){return{[`--bits-${f}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${f}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${f}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${f}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${f}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function _I(f){const o=f.whileElementsMounted,g=Pe(()=>Yu(f.open)??!0),v=Pe(()=>Yu(f.middleware)),T=Pe(()=>Yu(f.transform)??!0),E=Pe(()=>Yu(f.placement)??"bottom"),w=Pe(()=>Yu(f.strategy)??"absolute"),c=f.reference;let U=Ye(0),W=Ye(0);const K=Se(null);let j=Ye(Ze(R(w))),V=Ye(Ze(R(E))),ne=Ye(Ze({})),oe=Ye(!1);const ce=Pe(()=>{const De={position:R(j),left:"0",top:"0"};if(!K.current)return De;const Xe=_0(K.current,R(U)),it=_0(K.current,R(W));return R(T)?{...De,transform:`translate(${Xe}px, ${it}px)`,...Pb(K.current)>=1.5&&{willChange:"transform"}}:{position:R(j),left:`${Xe}px`,top:`${it}px`}});let fe;function Ie(){c.current===null||K.current===null||gI(c.current,K.current,{middleware:R(v),placement:R(E),strategy:R(w)}).then(De=>{Oe(U,Ze(De.x)),Oe(W,Ze(De.y)),Oe(j,Ze(De.strategy)),Oe(V,Ze(De.placement)),Oe(ne,Ze(De.middlewareData)),Oe(oe,!0)})}function _e(){typeof fe=="function"&&(fe(),fe=void 0)}function ke(){if(_e(),o===void 0){Ie();return}c.current===null||K.current===null||(fe=o(c.current,K.current,Ie))}function Ne(){R(g)||Oe(oe,!1)}return Pt(Ie),Pt(ke),Pt(Ne),Pt(()=>_e),{floating:K,reference:c,get strategy(){return R(j)},get placement(){return R(V)},get middlewareData(){return R(ne)},get isPositioned(){return R(oe)},get floatingStyles(){return R(ce)},get update(){return Ie}}}const yI={top:"bottom",right:"left",bottom:"top",left:"right"};class vI{constructor(){Ue(this,"anchorNode",Se(null));Ue(this,"customAnchorNode",Se(null));Ue(this,"triggerNode",Se(null));Pt(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Oh,Fh,Bh,Nh,sc,Vh,jh,oc,Oa,Uh,qh,Zh,Gh,Wh,Hh,vm,Xh,xm,Kh,bm,wm,Jh,Yh,$h,Qh,Sm,Pm,Tm,Im,Cm,Am,ed,Em,km,Mm,zm;class xI{constructor(o,g){Ue(this,"root");Ue(this,"contentRef",Se(null));Ue(this,"wrapperRef",Se(null));Ue(this,"arrowRef",Se(null));Ue(this,"arrowId",Se(Ar()));Ue(this,"id");Ue(this,"wrapperId");Ue(this,"style");X(this,Oh,Pe(()=>{if(typeof this.style=="string")return rh(this.style);if(!this.style)return{}}));X(this,Fh);X(this,Bh);X(this,Nh);X(this,sc);X(this,Vh);X(this,jh);X(this,oc);X(this,Oa);X(this,Uh);X(this,qh);X(this,Zh);X(this,Gh);X(this,Wh);Ue(this,"onPlaced");Ue(this,"enabled");X(this,Hh,new MP(()=>this.arrowRef.current??void 0));X(this,vm,Pe(()=>{var o;return((o=I(this,Hh))==null?void 0:o.width)??0}));X(this,Xh,Pe(()=>{var o;return((o=I(this,Hh))==null?void 0:o.height)??0}));X(this,xm,Pe(()=>{var o;return((o=I(this,Bh))==null?void 0:o.current)+(I(this,sc).current!=="center"?`-${I(this,sc).current}`:"")}));X(this,Kh,Pe(()=>Array.isArray(I(this,Oa).current)?I(this,Oa).current:[I(this,Oa).current]));X(this,bm,Pe(()=>R(I(this,Kh)).length>0));X(this,wm,Pe(()=>({padding:I(this,Uh).current,boundary:R(I(this,Kh)).filter(SP),altBoundary:this.hasExplicitBoundaries})));X(this,Jh,Ye(void 0));X(this,Yh,Ye(void 0));X(this,$h,Ye(void 0));X(this,Qh,Ye(void 0));X(this,Sm,Pe(()=>[cI({mainAxis:I(this,Nh).current+R(I(this,Xh)),alignmentAxis:I(this,Vh).current}),I(this,oc)&&uI({mainAxis:!0,crossAxis:!1,limiter:I(this,qh).current==="partial"?mI():void 0,...this.detectOverflowOptions}),I(this,oc)&&hI({...this.detectOverflowOptions}),dI({...this.detectOverflowOptions,apply:({rects:o,availableWidth:g,availableHeight:v})=>{const{width:T,height:E}=o.reference;Oe(I(this,Jh),Ze(g)),Oe(I(this,Yh),Ze(v)),Oe(I(this,$h),Ze(T)),Oe(I(this,Qh),Ze(E))}}),this.arrowRef.current&&fI({element:this.arrowRef.current,padding:I(this,jh).current}),CI({arrowWidth:R(I(this,vm)),arrowHeight:R(I(this,Xh))}),I(this,Zh).current&&pI({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Ue(this,"floating");X(this,Pm,Pe(()=>AI(this.floating.placement)));X(this,Tm,Pe(()=>EI(this.floating.placement)));X(this,Im,Pe(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.x)??0}));X(this,Cm,Pe(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.y)??0}));X(this,Am,Pe(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.centerOffset)!==0}));X(this,ed,Ye());X(this,Em,Pe(()=>yI[this.placedSide]));X(this,km,Pe(()=>{var o,g,v;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(o=this.floating.middlewareData.transformOrigin)==null?void 0:o.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${R(I(this,Jh))}px`,"--bits-floating-available-height":`${R(I(this,Yh))}px`,"--bits-floating-anchor-width":`${R(I(this,$h))}px`,"--bits-floating-anchor-height":`${R(I(this,Qh))}px`,...((v=this.floating.middlewareData.hide)==null?void 0:v.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...R(I(this,Oh))},dir:I(this,Fh).current}}));X(this,Mm,Pe(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:Ly({...R(I(this,Oh))})})));X(this,zm,Pe(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=o.id,qe(this,Bh,o.side),qe(this,Nh,o.sideOffset),qe(this,sc,o.align),qe(this,Vh,o.alignOffset),qe(this,jh,o.arrowPadding),qe(this,oc,o.avoidCollisions),qe(this,Oa,o.collisionBoundary),qe(this,Uh,o.collisionPadding),qe(this,qh,o.sticky),qe(this,Zh,o.hideWhenDetached),qe(this,Wh,o.updatePositionStrategy),this.onPlaced=o.onPlaced,qe(this,Gh,o.strategy),qe(this,Fh,o.dir),this.style=o.style,this.root=g,this.enabled=o.enabled,this.wrapperId=o.wrapperId,o.customAnchor&&(this.root.customAnchorNode.current=o.customAnchor.current),Pt(()=>{o.customAnchor.current,Vi(()=>{this.root.customAnchorNode.current=o.customAnchor.current})}),_r({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),_r({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=_I({strategy:()=>I(this,Gh).current,placement:()=>R(I(this,xm)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...v)=>{var E;return lI(...v,{animationFrame:((E=I(this,Wh))==null?void 0:E.current)==="always"})},open:()=>this.enabled.current}),Pt(()=>{var v;this.floating.isPositioned&&((v=this.onPlaced)==null||v.current())}),Pt(()=>{const v=this.contentRef.current;v&&Vi(()=>{this.contentZIndex=window.getComputedStyle(v).zIndex})}),Pt(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return R(I(this,bm))}get detectOverflowOptions(){return R(I(this,wm))}get middleware(){return R(I(this,Sm))}get placedSide(){return R(I(this,Pm))}get placedAlign(){return R(I(this,Tm))}get arrowX(){return R(I(this,Im))}get arrowY(){return R(I(this,Cm))}get cannotCenterArrow(){return R(I(this,Am))}get contentZIndex(){return R(I(this,ed))}set contentZIndex(o){Oe(I(this,ed),Ze(o))}get arrowBaseSide(){return R(I(this,Em))}get wrapperProps(){return R(I(this,km))}get props(){return R(I(this,Mm))}get arrowStyle(){return R(I(this,zm))}}Oh=new WeakMap,Fh=new WeakMap,Bh=new WeakMap,Nh=new WeakMap,sc=new WeakMap,Vh=new WeakMap,jh=new WeakMap,oc=new WeakMap,Oa=new WeakMap,Uh=new WeakMap,qh=new WeakMap,Zh=new WeakMap,Gh=new WeakMap,Wh=new WeakMap,Hh=new WeakMap,vm=new WeakMap,Xh=new WeakMap,xm=new WeakMap,Kh=new WeakMap,bm=new WeakMap,wm=new WeakMap,Jh=new WeakMap,Yh=new WeakMap,$h=new WeakMap,Qh=new WeakMap,Sm=new WeakMap,Pm=new WeakMap,Tm=new WeakMap,Im=new WeakMap,Cm=new WeakMap,Am=new WeakMap,ed=new WeakMap,Em=new WeakMap,km=new WeakMap,Mm=new WeakMap,zm=new WeakMap;class bI{constructor(o,g){Ue(this,"ref",Se(null));o.virtualEl&&o.virtualEl.current?g.triggerNode=Se.from(o.virtualEl.current):_r({id:o.id,ref:this.ref,onRefChange:v=>{g.triggerNode.current=v}})}}const[wI,Tb]=Ga("Floating.Root"),[SI,Rk]=Ga("Floating.Content");function PI(){return wI(new vI)}function TI(f){return SI(new xI(f,Tb()))}function II(f){return new bI(f,Tb())}function CI(f){return{name:"transformOrigin",options:f,fn(o){var fe,Ie,_e;const{placement:g,rects:v,middlewareData:T}=o,w=((fe=T.arrow)==null?void 0:fe.centerOffset)!==0,c=w?0:f.arrowWidth,U=w?0:f.arrowHeight,[W,K]=Hy(g),j={start:"0%",center:"50%",end:"100%"}[K],V=(((Ie=T.arrow)==null?void 0:Ie.x)??0)+c/2,ne=(((_e=T.arrow)==null?void 0:_e.y)??0)+U/2;let oe="",ce="";return W==="bottom"?(oe=w?j:`${V}px`,ce=`${-U}px`):W==="top"?(oe=w?j:`${V}px`,ce=`${v.floating.height+U}px`):W==="right"?(oe=`${-U}px`,ce=w?j:`${ne}px`):W==="left"&&(oe=`${v.floating.width+U}px`,ce=w?j:`${ne}px`),{data:{x:oe,y:ce}}}}}function Hy(f){const[o,g="center"]=f.split("-");return[o,g]}function AI(f){return Hy(f)[0]}function EI(f){return Hy(f)[1]}function kI(f,o){At(o,!0),PI();var g=tt(),v=Be(g);Ot(v,()=>o.children??ei),we(f,g),Et()}function MI(f,o){At(o,!0),II({id:Se.with(()=>o.id),virtualEl:Se.with(()=>o.virtualEl)});var g=tt(),v=Be(g);Ot(v,()=>o.children??ei),we(f,g),Et()}var zI=Rt("<div><!></div>");function DI(f,o){At(o,!0);let g=ee(o,"side",3,"bottom"),v=ee(o,"sideOffset",3,0),T=ee(o,"align",3,"center"),E=ee(o,"alignOffset",3,0),w=ee(o,"arrowPadding",3,0),c=ee(o,"avoidCollisions",3,!0),U=ee(o,"collisionBoundary",19,()=>[]),W=ee(o,"collisionPadding",3,0),K=ee(o,"hideWhenDetached",3,!1),j=ee(o,"onPlaced",3,()=>{}),V=ee(o,"sticky",3,"partial"),ne=ee(o,"updatePositionStrategy",3,"optimized"),oe=ee(o,"strategy",3,"fixed"),ce=ee(o,"dir",3,"ltr"),fe=ee(o,"style",19,()=>({})),Ie=ee(o,"wrapperId",19,Ar),_e=ee(o,"customAnchor",3,null);const ke=TI({side:Se.with(()=>g()),sideOffset:Se.with(()=>v()),align:Se.with(()=>T()),alignOffset:Se.with(()=>E()),id:Se.with(()=>o.id),arrowPadding:Se.with(()=>w()),avoidCollisions:Se.with(()=>c()),collisionBoundary:Se.with(()=>U()),collisionPadding:Se.with(()=>W()),hideWhenDetached:Se.with(()=>K()),onPlaced:Se.with(()=>j()),sticky:Se.with(()=>V()),updatePositionStrategy:Se.with(()=>ne()),strategy:Se.with(()=>oe()),dir:Se.with(()=>ce()),style:Se.with(()=>fe()),enabled:Se.with(()=>!1),wrapperId:Se.with(()=>Ie()),customAnchor:Se.with(()=>_e())}),Ne=Pe(()=>er(ke.wrapperProps,{style:{pointerEvents:"auto"}}));var De=zI();let Xe;var it=Kt(De);Ot(it,()=>o.content??ei,()=>({props:ke.props})),Wt(De),$t(()=>Xe=ji(De,Xe,{...R(Ne)})),we(f,De),Et()}function RI(f,o){At(o,!0),R0(()=>{var T;(T=o.onPlaced)==null||T.call(o)});var g=tt(),v=Be(g);Ot(v,()=>o.content??ei,()=>({props:{}})),we(f,g),Et()}function LI(f,o){let g=ee(o,"isStatic",3,!1),v=Jt(o,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var T=tt(),E=Be(T);{var w=U=>{RI(U,{get content(){return o.content},get onPlaced(){return o.onPlaced}})},c=U=>{DI(U,Qt({get content(){return o.content},get onPlaced(){return o.onPlaced}},()=>v))};gi(E,U=>{g()?U(w):U(c,!1)})}we(f,T)}var OI=Rt("<!> <!>",1);function Ib(f,o){At(o,!0);let g=ee(o,"interactOutsideBehavior",3,"close"),v=ee(o,"trapFocus",3,!0),T=ee(o,"isValidEvent",3,()=>!1),E=ee(o,"customAnchor",3,null),w=ee(o,"isStatic",3,!1),c=Jt(o,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);LI(f,{get isStatic(){return w()},get id(){return o.id},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},content:(W,K)=>{let j=()=>K==null?void 0:K().props;var V=OI(),ne=Be(V);{var oe=_e=>{Hf(_e,{get preventScroll(){return o.preventScroll}})},ce=_e=>{var ke=tt(),Ne=Be(ke);{var De=Xe=>{Hf(Xe,{get preventScroll(){return o.preventScroll}})};gi(Ne,Xe=>{o.forceMount||Xe(De)},!0)}we(_e,ke)};gi(ne,_e=>{o.forceMount&&o.enabled?_e(oe):_e(ce,!1)})}var fe=ni(ne,2),Ie=Pe(()=>o.enabled&&v());db(fe,{get id(){return o.id},get onOpenAutoFocus(){return o.onOpenAutoFocus},get onCloseAutoFocus(){return o.onCloseAutoFocus},get loop(){return o.loop},get trapFocus(){return R(Ie)},get forceMount(){return o.forceMount},focusScope:(ke,Ne)=>{let De=()=>Ne==null?void 0:Ne().props;ub(ke,{get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get enabled(){return o.enabled},children:(Xe,it)=>{cb(Xe,{get id(){return o.id},get onInteractOutside(){return o.onInteractOutside},get onFocusOutside(){return o.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return T()},get enabled(){return o.enabled},children:(Je,St)=>{let dt=()=>St==null?void 0:St().props;fb(Je,{get id(){return o.id},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get enabled(){return o.enabled},children:(Ge,Fe)=>{var Ee=tt(),Le=Be(Ee),Ke=kg(()=>({props:er(c,j(),dt(),De(),{style:{pointerEvents:"auto"}})}));Ot(Le,()=>o.popper??ei,()=>R(Ke)),we(Ge,Ee)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),we(W,V)},$$slots:{content:!0}}),Et()}function FI(f,o){let g=ee(o,"interactOutsideBehavior",3,"close"),v=ee(o,"trapFocus",3,!0),T=ee(o,"isValidEvent",3,()=>!1),E=ee(o,"customAnchor",3,null),w=ee(o,"isStatic",3,!1),c=Jt(o,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);By(f,Qt({get id(){return o.id},get present(){return o.present}},()=>c,{presence:(W,K)=>{let j=()=>K==null?void 0:K().present;Ib(W,Qt({get popper(){return o.popper},get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get id(){return o.id},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get preventScroll(){return o.preventScroll},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return j().current},get onInteractOutside(){return o.onInteractOutside},get onCloseAutoFocus(){return o.onCloseAutoFocus},get onOpenAutoFocus(){return o.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return o.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return o.onFocusOutside},forceMount:!1},()=>c))},$$slots:{presence:!0}}))}function BI(f,o){let g=ee(o,"interactOutsideBehavior",3,"close"),v=ee(o,"trapFocus",3,!0),T=ee(o,"isValidEvent",3,()=>!1),E=ee(o,"customAnchor",3,null),w=ee(o,"isStatic",3,!1),c=Jt(o,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);Ib(f,Qt({get popper(){return o.popper},get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get id(){return o.id},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get preventScroll(){return o.preventScroll},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return o.enabled},get onInteractOutside(){return o.onInteractOutside},get onCloseAutoFocus(){return o.onCloseAutoFocus},get onOpenAutoFocus(){return o.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return o.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return o.onFocusOutside}},()=>c,{forceMount:!0}))}function NI(f,o){let g=f.nextElementSibling;for(;g;){if(g.matches(o))return g;g=g.nextElementSibling}}function VI(f,o){let g=f.previousElementSibling;for(;g;){if(g.matches(o))return g;g=g.previousElementSibling}}const v0=1,jI=.9,UI=.8,qI=.17,cy=.1,uy=.999,ZI=.9999,GI=.99,WI=/[\\/_+.#"@[({&]/,HI=/[\\/_+.#"@[({&]/g,XI=/[\s-]/,Cb=/[\s-]/g;function Ay(f,o,g,v,T,E,w){if(E===o.length)return T===f.length?v0:GI;const c=`${T},${E}`;if(w[c]!==void 0)return w[c];const U=v.charAt(E);let W=g.indexOf(U,T),K=0,j,V,ne,oe;for(;W>=0;)j=Ay(f,o,g,v,W+1,E+1,w),j>K&&(W===T?j*=v0:WI.test(f.charAt(W-1))?(j*=UI,ne=f.slice(T,W-1).match(HI),ne&&T>0&&(j*=uy**ne.length)):XI.test(f.charAt(W-1))?(j*=jI,oe=f.slice(T,W-1).match(Cb),oe&&T>0&&(j*=uy**oe.length)):(j*=qI,T>0&&(j*=uy**(W-T))),f.charAt(W)!==o.charAt(E)&&(j*=ZI)),(j<cy&&g.charAt(W-1)===v.charAt(E+1)||v.charAt(E+1)===v.charAt(E)&&g.charAt(W-1)!==v.charAt(E))&&(V=Ay(f,o,g,v,W+1,E+2,w),V*cy>j&&(j=V*cy)),j>K&&(K=j),W=g.indexOf(U,W+1);return w[c]=K,K}function x0(f){return f.toLowerCase().replace(Cb," ")}function KI(f,o,g){return f=g&&g.length>0?`${`${f} ${g==null?void 0:g.join(" ")}`}`:f,Ay(f,o,x0(f),x0(o),0,0,{})}function JI(f){if(!f)return null;for(const o of f.childNodes)if(o.nodeType!==Node.COMMENT_NODE)return o;return null}const YI="data-command-root",$I="data-command-list",QI="data-command-input",eC="data-command-empty",Ab="data-command-group",Eb="data-command-group-items",kb="data-command-group-heading",Mb="data-command-item",Da="data-value",tC="data-command-input-label",$u=`[${Ab}]`,hy=`[${Eb}]`,iC=`[${kb}]`,zb=`[${Mb}]`,dy=`${zb}:not([aria-disabled="true"])`;function Db(f,o,g){return KI(f,o,g)}const[rC,Fc]=Ga("Command.Root"),[nC,Lk]=Ga("Command.List"),[sC,Fg]=Ga("Command.Group");var td,id,rd,nd,ac,sd,od,ad,lc,cc,uc,Ho,Xo,Dm,hc,dc,ld,cd,ud,hd,Rm,Lm;class oC{constructor(o){Ue(this,"allItems",new Set);Ue(this,"allGroups",new Map);Ue(this,"allIds",new Map);Ue(this,"id");Ue(this,"ref");Ue(this,"filter");Ue(this,"shouldFilter");Ue(this,"loop");X(this,td,Ye(0));X(this,id,Ye(null));X(this,rd,Ye(null));X(this,nd,Ye(null));Ue(this,"valueProp");X(this,ac);Ue(this,"disablePointerSelection");X(this,sd,Ye(null));X(this,od,Ye(null));Ue(this,"snapshot",()=>this._commandState);Ue(this,"setState",(o,g,v)=>{Object.is(this._commandState[o],g)||(this._commandState[o]=g,o==="search"?(I(this,uc).call(this),I(this,lc).call(this),I(this,cc).call(this)):o==="value"&&(v||I(this,Dm).call(this)),this.emit())});Ue(this,"emit",()=>{this.commandState=O0(this._commandState)});X(this,ad,(o,g)=>{const v=this.filter.current??Db;return o?v(o,this._commandState.search,g):0});X(this,lc,()=>{var w;if(!this._commandState.search||this.shouldFilter.current===!1)return;const o=this._commandState.filtered.items,g=[];for(const c of this._commandState.filtered.groups){const U=this.allGroups.get(c);let W=0;if(!U){g.push([c,W]);continue}for(const K of U){const j=o.get(K);W=Math.max(j??0,W)}g.push([c,W])}const v=this.viewportNode,T=I(this,Ho).call(this).sort((c,U)=>{const W=c.getAttribute("id"),K=U.getAttribute("id"),j=o.get(W)??0;return(o.get(K)??0)-j});for(const c of T){const U=c.closest(hy);if(U){const W=c.parentElement===U?c:c.closest(`${hy} > *`);W&&U.appendChild(W)}else{const W=c.parentElement===v?c:c.closest(`${hy} > *`);W&&(v==null||v.appendChild(W))}}const E=g.sort((c,U)=>U[1]-c[1]);for(const c of E){const U=v==null?void 0:v.querySelector(`${$u}[${Da}="${encodeURIComponent(c[0])}"]`);(w=U==null?void 0:U.parentElement)==null||w.appendChild(U)}});Ue(this,"setValue",(o,g)=>{o!==this.valueProp.current&&o===""&&Mc(()=>{this.key++}),this.setState("value",o,g),this.valueProp.current=o});X(this,cc,()=>{Mc(()=>{const o=I(this,Ho).call(this).find(v=>v.getAttribute("aria-disabled")!=="true"),g=o==null?void 0:o.getAttribute(Da);this.setValue(g||"")})});X(this,uc,()=>{var g,v;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let o=0;for(const T of this.allItems){const E=((g=this.allIds.get(T))==null?void 0:g.value)??"",w=((v=this.allIds.get(T))==null?void 0:v.keywords)??[],c=I(this,ad).call(this,E,w);this._commandState.filtered.items.set(T,c),c>0&&o++}for(const[T,E]of this.allGroups)for(const w of E){const c=this._commandState.filtered.items.get(w);if(c&&c>0){this._commandState.filtered.groups.add(T);break}}this._commandState.filtered.count=o});X(this,Ho,()=>{const o=this.ref.current;return o?Array.from(o.querySelectorAll(dy)).filter(v=>!!v):[]});X(this,Xo,()=>{const o=this.ref.current;if(!o)return;const g=o.querySelector(`${dy}[aria-selected="true"]`);if(g)return g});X(this,Dm,()=>{Ap(1,()=>{var T,E,w,c,U;const o=I(this,Xo).call(this);if(!o)return;const g=(T=o.parentElement)==null?void 0:T.parentElement;if(!g)return;const v=JI(g);if(v&&((E=v.dataset)==null?void 0:E.value)===((w=o.dataset)==null?void 0:w.value)){(U=(c=o==null?void 0:o.closest($u))==null?void 0:c.querySelector(iC))==null||U.scrollIntoView({block:"nearest"});return}o.scrollIntoView({block:"nearest"})})});X(this,hc,o=>{const v=I(this,Ho).call(this)[o];v&&this.setValue(v.getAttribute(Da)??"")});X(this,dc,o=>{const g=I(this,Xo).call(this),v=I(this,Ho).call(this),T=v.findIndex(w=>w===g);let E=v[T+o];this.loop.current&&(E=T+o<0?v[v.length-1]:T+o===v.length?v[0]:v[T+o]),E&&this.setValue(E.getAttribute(Da)??"")});X(this,ld,o=>{const g=I(this,Xo).call(this);let v=g==null?void 0:g.closest($u),T;for(;v&&!T;)v=o>0?NI(v,$u):VI(v,$u),T=v==null?void 0:v.querySelector(dy);T?this.setValue(T.getAttribute(Da)??""):I(this,dc).call(this,o)});Ue(this,"registerValue",(o,g,v)=>{var T;if(g!==((T=this.allIds.get(o))==null?void 0:T.value))return this.allIds.set(o,{value:g,keywords:v}),this._commandState.filtered.items.set(o,I(this,ad).call(this,g,v)),I(this,lc).call(this),this.emit(),()=>{this.allIds.delete(o)}});Ue(this,"registerItem",(o,g)=>(this.allItems.add(o),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(o):this.allGroups.set(g,new Set([o]))),I(this,uc).call(this),I(this,lc).call(this),this.commandState.value||I(this,cc).call(this),this.emit(),()=>{this.allIds.delete(o),this.allItems.delete(o),this.commandState.filtered.items.delete(o);const v=I(this,Xo).call(this);I(this,uc).call(this),(v==null?void 0:v.getAttribute("id"))===o&&I(this,cc).call(this),this.emit()}));Ue(this,"registerGroup",o=>(this.allGroups.has(o)||this.allGroups.set(o,new Set),()=>{this.allIds.delete(o),this.allGroups.delete(o)}));X(this,cd,()=>I(this,hc).call(this,I(this,Ho).call(this).length-1));X(this,ud,o=>{o.preventDefault(),o.metaKey?I(this,cd).call(this):o.altKey?I(this,ld).call(this,1):I(this,dc).call(this,1)});X(this,hd,o=>{o.preventDefault(),o.metaKey?I(this,hc).call(this,0):o.altKey?I(this,ld).call(this,-1):I(this,dc).call(this,-1)});X(this,Rm,o=>{switch(o.key){case yP:case vP:{I(this,ac).current&&o.ctrlKey&&I(this,ud).call(this,o);break}case uP:I(this,ud).call(this,o);break;case _P:case xP:{I(this,ac).current&&o.ctrlKey&&I(this,hd).call(this,o);break}case hP:I(this,hd).call(this,o);break;case fP:o.preventDefault(),I(this,hc).call(this,0);break;case dP:o.preventDefault(),I(this,cd).call(this);break;case nb:if(!o.isComposing&&o.keyCode!==229){o.preventDefault();const g=I(this,Xo).call(this);g&&(g==null||g.click())}}});X(this,Lm,Pe(()=>({id:this.id.current,role:"application",[YI]:"",tabindex:-1,onkeydown:I(this,Rm)})));this.id=o.id,this.ref=o.ref,this.filter=o.filter,this.shouldFilter=o.shouldFilter,this.loop=o.loop,this.valueProp=o.value,qe(this,ac,o.vimBindings),this.disablePointerSelection=o.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,_r({id:this.id,ref:this.ref})}get key(){return R(I(this,td))}set key(o){Oe(I(this,td),Ze(o))}get viewportNode(){return R(I(this,id))}set viewportNode(o){Oe(I(this,id),Ze(o))}get inputNode(){return R(I(this,rd))}set inputNode(o){Oe(I(this,rd),Ze(o))}get labelNode(){return R(I(this,nd))}set labelNode(o){Oe(I(this,nd),Ze(o))}get commandState(){return R(I(this,sd))}set commandState(o){Oe(I(this,sd),o)}get _commandState(){return R(I(this,od))}set _commandState(o){Oe(I(this,od),Ze(o))}get props(){return R(I(this,Lm))}}td=new WeakMap,id=new WeakMap,rd=new WeakMap,nd=new WeakMap,ac=new WeakMap,sd=new WeakMap,od=new WeakMap,ad=new WeakMap,lc=new WeakMap,cc=new WeakMap,uc=new WeakMap,Ho=new WeakMap,Xo=new WeakMap,Dm=new WeakMap,hc=new WeakMap,dc=new WeakMap,ld=new WeakMap,cd=new WeakMap,ud=new WeakMap,hd=new WeakMap,Rm=new WeakMap,Lm=new WeakMap;var dd,pc,pd,fd,md,Om,Fm;class aC{constructor(o,g){X(this,dd);X(this,pc);X(this,pd);X(this,fd);X(this,md,!0);X(this,Om,Pe(()=>I(this,pd)._commandState.filtered.count===0&&I(this,md)===!1||I(this,fd).current));X(this,Fm,Pe(()=>({id:I(this,pc).current,role:"presentation",[eC]:""})));qe(this,dd,o.ref),qe(this,pc,o.id),qe(this,pd,g),qe(this,fd,o.forceMount),Pt(()=>{qe(this,md,!1)}),_r({id:I(this,pc),ref:I(this,dd),deps:()=>this.shouldRender})}get shouldRender(){return R(I(this,Om))}get props(){return R(I(this,Fm))}}dd=new WeakMap,pc=new WeakMap,pd=new WeakMap,fd=new WeakMap,md=new WeakMap,Om=new WeakMap,Fm=new WeakMap;var Fa,Ba,ns,gd,Bm,_d,Nm;class lC{constructor(o,g){X(this,Fa);Ue(this,"id");Ue(this,"forceMount");X(this,Ba);X(this,ns);X(this,gd,Ye(null));X(this,Bm,Pe(()=>this.forceMount.current||I(this,ns).shouldFilter.current===!1||!I(this,ns).commandState.search?!0:I(this,ns).commandState.filtered.groups.has(this.id.current)));X(this,_d,Ye(""));X(this,Nm,Pe(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[Ab]:""})));qe(this,Fa,o.ref),this.id=o.id,qe(this,ns,g),this.forceMount=o.forceMount,qe(this,Ba,o.value),this.trueValue=o.value.current,_r({id:this.id,ref:I(this,Fa),deps:()=>this.shouldRender}),Pt(()=>I(this,ns).registerGroup(this.id.current)),Pt(()=>{var v;if(I(this,Ba).current)return this.trueValue=I(this,Ba).current,I(this,ns).registerValue(this.id.current,I(this,Ba).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),I(this,ns).registerValue(this.id.current,this.trueValue);if((v=I(this,Fa).current)!=null&&v.textContent)return this.trueValue=I(this,Fa).current.textContent.trim().toLowerCase(),I(this,ns).registerValue(this.id.current,this.trueValue)})}get headingNode(){return R(I(this,gd))}set headingNode(o){Oe(I(this,gd),Ze(o))}get shouldRender(){return R(I(this,Bm))}get trueValue(){return R(I(this,_d))}set trueValue(o){Oe(I(this,_d),Ze(o))}get props(){return R(I(this,Nm))}createGroupHeading(o){return new Rb(o,this)}createGroupItems(o){return new Lb(o,this)}}Fa=new WeakMap,Ba=new WeakMap,ns=new WeakMap,gd=new WeakMap,Bm=new WeakMap,_d=new WeakMap,Nm=new WeakMap;var yd,fc,vd,Vm;class Rb{constructor(o,g){X(this,yd);X(this,fc);X(this,vd);X(this,Vm,Pe(()=>({id:I(this,fc).current,[kb]:""})));qe(this,yd,o.ref),qe(this,fc,o.id),qe(this,vd,g),_r({id:I(this,fc),ref:I(this,yd),onRefChange:v=>{I(this,vd).headingNode=v}})}get props(){return R(I(this,Vm))}}yd=new WeakMap,fc=new WeakMap,vd=new WeakMap,Vm=new WeakMap;var xd,mc,bd,jm;class Lb{constructor(o,g){X(this,xd);X(this,mc);X(this,bd);X(this,jm,Pe(()=>{var o;return{id:I(this,mc).current,role:"group",[Eb]:"","aria-labelledby":((o=I(this,bd).headingNode)==null?void 0:o.id)??void 0}}));qe(this,xd,o.ref),qe(this,mc,o.id),qe(this,bd,g),_r({id:I(this,mc),ref:I(this,xd)})}get props(){return R(I(this,jm))}}xd=new WeakMap,mc=new WeakMap,bd=new WeakMap,jm=new WeakMap;var gc,_c,bs,Ko,wd,Um,qm;class cC{constructor(o,g){X(this,gc);X(this,_c);X(this,bs);X(this,Ko);X(this,wd);X(this,Um,Pe(()=>{var g;const o=(g=I(this,bs).viewportNode)==null?void 0:g.querySelector(`${zb}[${Da}="${encodeURIComponent(I(this,Ko).current)}"]`);if(o)return(o==null?void 0:o.getAttribute("id"))??void 0}));X(this,qm,Pe(()=>{var o,g;return{id:I(this,_c).current,type:"text",[QI]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":rb(!0),"aria-controls":((o=I(this,bs).viewportNode)==null?void 0:o.id)??void 0,"aria-labelledby":((g=I(this,bs).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":R(I(this,Um))}}));qe(this,gc,o.ref),qe(this,_c,o.id),qe(this,bs,g),qe(this,Ko,o.value),qe(this,wd,o.autofocus),_r({id:I(this,_c),ref:I(this,gc),onRefChange:v=>{I(this,bs).inputNode=v}}),Pt(()=>{const v=I(this,gc).current;Vi(()=>{v&&I(this,wd).current&&Ap(10,()=>v.focus())})}),Pt(()=>{I(this,Ko).current,Vi(()=>{I(this,bs).commandState.search!==I(this,Ko).current&&I(this,bs).setState("search",I(this,Ko).current)})})}get props(){return R(I(this,qm))}}gc=new WeakMap,_c=new WeakMap,bs=new WeakMap,Ko=new WeakMap,wd=new WeakMap,Um=new WeakMap,qm=new WeakMap;var yc,Sd,ws,Pd,vc,Na,Zm,Td,Gm,Wm,Hm,Id,Xm,Km,Jm;class uC{constructor(o,g){X(this,yc);Ue(this,"id");Ue(this,"root");X(this,Sd);X(this,ws);X(this,Pd);X(this,vc);X(this,Na,null);X(this,Zm,Pe(()=>{var o;return I(this,vc).current||((o=I(this,Na))==null?void 0:o.forceMount.current)===!0}));X(this,Td,Ye(""));X(this,Gm,Pe(()=>{if(R(I(this,Zm))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const o=this.root.commandState.filtered.items.get(this.id.current);return o===void 0?!1:o>0}));X(this,Wm,Pe(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));X(this,Hm,()=>{var o;I(this,ws).current||(I(this,Id).call(this),(o=I(this,Pd))==null||o.current())});X(this,Id,()=>{I(this,ws).current||this.root.setValue(this.trueValue,!0)});X(this,Xm,()=>{I(this,ws).current||this.root.disablePointerSelection.current||I(this,Id).call(this)});X(this,Km,()=>{I(this,ws).current||I(this,Hm).call(this)});X(this,Jm,Pe(()=>({id:this.id.current,"aria-disabled":oP(I(this,ws).current),"aria-selected":lP(this.isSelected),"data-disabled":aP(I(this,ws).current),"data-selected":cP(this.isSelected),[Mb]:"",role:"option",onpointermove:I(this,Xm),onclick:I(this,Km)})));qe(this,yc,o.ref),this.id=o.id,this.root=g,qe(this,Sd,o.value),qe(this,ws,o.disabled),qe(this,Pd,o.onSelect),qe(this,vc,o.forceMount),qe(this,Na,Fg(null)),this.trueValue=o.value.current,_r({id:this.id,ref:I(this,yc),deps:()=>!!this.root.commandState.search}),Pt(()=>{var v;if(this.id.current,(v=I(this,Na))==null||v.id.current,!I(this,vc).current)return Vi(()=>{var T;return this.root.registerItem(this.id.current,(T=I(this,Na))==null?void 0:T.id.current)})}),Pt(()=>{const v=I(this,Sd).current,T=I(this,yc).current;T&&(!v&&T.textContent&&(this.trueValue=T.textContent.trim()),Vi(()=>{this.root.registerValue(this.id.current,this.trueValue,o.keywords.current.map(E=>E.trim())),T.setAttribute(Da,this.trueValue)}))})}get trueValue(){return R(I(this,Td))}set trueValue(o){Oe(I(this,Td),Ze(o))}get shouldRender(){return R(I(this,Gm))}get isSelected(){return R(I(this,Wm))}get props(){return R(I(this,Jm))}}yc=new WeakMap,Sd=new WeakMap,ws=new WeakMap,Pd=new WeakMap,vc=new WeakMap,Na=new WeakMap,Zm=new WeakMap,Td=new WeakMap,Gm=new WeakMap,Wm=new WeakMap,Hm=new WeakMap,Id=new WeakMap,Xm=new WeakMap,Km=new WeakMap,Jm=new WeakMap;var xc,Cd,Ym;class hC{constructor(o,g){Ue(this,"ref");X(this,xc);X(this,Cd);Ue(this,"root");X(this,Ym,Pe(()=>({id:I(this,xc).current,role:"listbox","aria-label":I(this,Cd).current,[$I]:""})));this.ref=o.ref,qe(this,xc,o.id),this.root=g,qe(this,Cd,o.ariaLabel),_r({id:I(this,xc),ref:this.ref})}get props(){return R(I(this,Ym))}}xc=new WeakMap,Cd=new WeakMap,Ym=new WeakMap;var Ad,bc,Ed,kd,$m;class dC{constructor(o,g){X(this,Ad);X(this,bc);X(this,Ed);X(this,kd);X(this,$m,Pe(()=>{var o;return{id:I(this,bc).current,[tC]:"",for:(o=I(this,kd))==null?void 0:o.current,style:ib}}));qe(this,Ad,o.ref),qe(this,bc,o.id),qe(this,Ed,g),qe(this,kd,o.for),_r({id:I(this,bc),ref:I(this,Ad),onRefChange:v=>{I(this,Ed).labelNode=v}})}get props(){return R(I(this,$m))}}Ad=new WeakMap,bc=new WeakMap,Ed=new WeakMap,kd=new WeakMap,$m=new WeakMap;function pC(f){return rC(new oC(f))}function fC(f){const o=Fc();return new aC(f,o)}function mC(f){const o=Fc();return new uC(f,o)}function gC(f){const o=Fc();return sC(new lC(f,o))}function _C(f){const o=Fg();return new Rb(f,o)}function yC(f){const o=Fg();return new Lb(f,o)}function vC(f){const o=Fc();return new cC(f,o)}function xC(f){const o=Fc();return nC(new hC(f,o))}function bC(f){const o=Fc();return new dC(f,o)}var wC=Rt("<label><!></label>");function SC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","ref","children"]);const E=bC({id:Se.with(()=>g()),ref:Se.with(()=>v(),K=>v(K))}),w=Pe(()=>er(T,E.props));var c=wC();let U;var W=Kt(c);Ot(W,()=>o.children??ei),Wt(c),$t(()=>U=ji(c,U,{...R(w)})),we(f,c),Et()}var PC=Rt("<!> <!>",1),TC=Rt("<div><!> <!></div>");function IC(f,o){At(o,!0);const g=De=>{SC(De,{children:(Xe,it)=>{Kn();var Ct=gs();$t(()=>_s(Ct,K())),we(Xe,Ct)},$$slots:{default:!0}})};let v=ee(o,"id",19,Ar),T=ee(o,"ref",15,null),E=ee(o,"value",15,""),w=ee(o,"onValueChange",3,ur),c=ee(o,"loop",3,!1),U=ee(o,"shouldFilter",3,!0),W=ee(o,"filter",3,Db),K=ee(o,"label",3,""),j=ee(o,"vimBindings",3,!0),V=ee(o,"disablePointerSelection",3,!1),ne=ee(o,"controlledValue",3,!1),oe=Jt(o,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const ce=pC({id:Se.with(()=>v()),ref:Se.with(()=>T(),De=>T(De)),filter:Se.with(()=>W()),shouldFilter:Se.with(()=>U()),loop:Se.with(()=>c()),value:Se.with(()=>E(),De=>{ne()||E(De),w()(De)}),vimBindings:Se.with(()=>j()),disablePointerSelection:Se.with(()=>V())}),fe=Pe(()=>er(oe,ce.props));var Ie=tt(),_e=Be(Ie);{var ke=De=>{var Xe=PC(),it=Be(Xe);g(it);var Ct=ni(it,2);Ot(Ct,()=>o.child,()=>({props:R(fe)})),we(De,Xe)},Ne=De=>{var Xe=TC();let it;var Ct=Kt(Xe);g(Ct);var Je=ni(Ct,2);Ot(Je,()=>o.children??ei),Wt(Xe),$t(()=>it=ji(Xe,it,{...R(fe)})),we(De,Xe)};gi(_e,De=>{o.child?De(ke):De(Ne,!1)})}we(f,Ie),Et()}var CC=Rt("<div><!></div>");function AC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"forceMount",3,!1),E=Jt(o,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const w=fC({id:Se.with(()=>g()),ref:Se.with(()=>v(),j=>v(j)),forceMount:Se.with(()=>T())}),c=Pe(()=>er(w.props,E));var U=tt(),W=Be(U);{var K=j=>{var V=tt(),ne=Be(V);{var oe=fe=>{var Ie=tt(),_e=Be(Ie);Ot(_e,()=>o.child,()=>({props:R(c)})),we(fe,Ie)},ce=fe=>{var Ie=CC();let _e;var ke=Kt(Ie);Ot(ke,()=>o.children??ei),Wt(Ie),$t(()=>_e=ji(Ie,_e,{...R(c)})),we(fe,Ie)};gi(ne,fe=>{o.child?fe(oe):fe(ce,!1)})}we(j,V)};gi(W,j=>{w.shouldRender&&j(K)})}we(f,U),Et()}var EC=Rt("<div><!></div>");function kC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"value",3,""),E=ee(o,"forceMount",3,!1),w=Jt(o,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const c=gC({id:Se.with(()=>g()),ref:Se.with(()=>v(),ne=>v(ne)),forceMount:Se.with(()=>E()),value:Se.with(()=>T())}),U=Pe(()=>er(w,c.props));var W=tt(),K=Be(W);{var j=ne=>{var oe=tt(),ce=Be(oe);Ot(ce,()=>o.child,()=>({props:R(U)})),we(ne,oe)},V=ne=>{var oe=EC();let ce;var fe=Kt(oe);Ot(fe,()=>o.children??ei),Wt(oe),$t(()=>ce=ji(oe,ce,{...R(U)})),we(ne,oe)};gi(K,ne=>{o.child?ne(j):ne(V,!1)})}we(f,W),Et()}var MC=Rt("<div><!></div>");function zC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=_C({id:Se.with(()=>g()),ref:Se.with(()=>v(),j=>v(j))}),w=Pe(()=>er(T,E.props));var c=tt(),U=Be(c);{var W=j=>{var V=tt(),ne=Be(V);Ot(ne,()=>o.child,()=>({props:R(w)})),we(j,V)},K=j=>{var V=MC();let ne;var oe=Kt(V);Ot(oe,()=>o.children??ei),Wt(V),$t(()=>ne=ji(V,ne,{...R(w)})),we(j,V)};gi(U,j=>{o.child?j(W):j(K,!1)})}we(f,c),Et()}var DC=Rt("<div><!></div>"),RC=Rt('<div style="display: contents;"><!></div>');function LC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=yC({id:Se.with(()=>g()),ref:Se.with(()=>v(),j=>v(j))}),w=Pe(()=>er(T,E.props));var c=RC(),U=Kt(c);{var W=j=>{var V=tt(),ne=Be(V);Ot(ne,()=>o.child,()=>({props:R(w)})),we(j,V)},K=j=>{var V=DC();let ne;var oe=Kt(V);Ot(oe,()=>o.children??ei),Wt(V),$t(()=>ne=ji(V,ne,{...R(w)})),we(j,V)};gi(U,j=>{o.child?j(W):j(K,!1)})}Wt(c),we(f,c),Et()}var OC=Rt("<input>");function FC(f,o){At(o,!0);let g=ee(o,"value",15,""),v=ee(o,"autofocus",3,!1),T=ee(o,"id",19,Ar),E=ee(o,"ref",15,null),w=Jt(o,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const c=vC({id:Se.with(()=>T()),ref:Se.with(()=>E(),ne=>E(ne)),value:Se.with(()=>g(),ne=>{g(ne)}),autofocus:Se.with(()=>v()??!1)}),U=Pe(()=>er(w,c.props));var W=tt(),K=Be(W);{var j=ne=>{var oe=tt(),ce=Be(oe);Ot(ce,()=>o.child,()=>({props:R(U)})),we(ne,oe)},V=ne=>{var oe=OC();x2(oe);let ce;$t(()=>ce=ji(oe,ce,{...R(U)})),I2(oe,g),we(ne,oe)};gi(K,ne=>{o.child?ne(j):ne(V,!1)})}we(f,W),Et()}var BC=Rt("<div><!></div>"),NC=Rt('<div style="display: contents;" data-item-wrapper=""><!></div>');function VC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"value",3,""),E=ee(o,"disabled",3,!1),w=ee(o,"onSelect",3,ur),c=ee(o,"forceMount",3,!1),U=ee(o,"keywords",19,()=>[]),W=Jt(o,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=Fg(null),j=mC({id:Se.with(()=>g()),ref:Se.with(()=>v(),ce=>v(ce)),value:Se.with(()=>T()),disabled:Se.with(()=>E()),onSelect:Se.with(()=>w()),forceMount:Se.with(()=>c()),keywords:Se.with(()=>U()),group:K}),V=Pe(()=>er(W,j.props));var ne=tt(),oe=Be(ne);L0(oe,()=>j.root.key,ce=>{var fe=NC(),Ie=Kt(fe);{var _e=ke=>{var Ne=tt(),De=Be(Ne);{var Xe=Ct=>{var Je=tt(),St=Be(Je);Ot(St,()=>o.child,()=>({props:R(V)})),we(Ct,Je)},it=Ct=>{var Je=BC();let St;var dt=Kt(Je);Ot(dt,()=>o.children??ei),Wt(Je),$t(()=>St=ji(Je,St,{...R(V)})),we(Ct,Je)};gi(De,Ct=>{o.child?Ct(Xe):Ct(it,!1)})}we(ke,Ne)};gi(Ie,ke=>{j.shouldRender&&ke(_e)})}Wt(fe),$t(()=>Gf(fe,"data-value",T())),we(ce,fe)}),we(f,ne),Et()}var jC=Rt("<div><!></div>");function UC(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const E=xC({id:Se.with(()=>g()),ref:Se.with(()=>v(),j=>v(j)),ariaLabel:Se.with(()=>o["aria-label"]??"Suggestions...")}),w=Pe(()=>er(T,E.props));var c=tt(),U=Be(c);{var W=j=>{var V=tt(),ne=Be(V);Ot(ne,()=>o.child,()=>({props:R(w)})),we(j,V)},K=j=>{var V=jC();let ne;var oe=Kt(V);Ot(oe,()=>o.children??ei),Wt(V),$t(()=>ne=ji(V,ne,{...R(w)})),we(j,V)};gi(U,j=>{o.child?j(W):j(K,!1)})}we(f,c),Et()}var Md,zd,Dd;class qC{constructor(o){Ue(this,"open");X(this,Md,Ye(null));X(this,zd,Ye(void 0));X(this,Dd,Ye(null));Ue(this,"toggleOpen",()=>{this.open.current=!this.open.current});Ue(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=o.open}get contentNode(){return R(I(this,Md))}set contentNode(o){Oe(I(this,Md),Ze(o))}get contentId(){return R(I(this,zd))}set contentId(o){Oe(I(this,zd),Ze(o))}get triggerNode(){return R(I(this,Dd))}set triggerNode(o){Oe(I(this,Dd),Ze(o))}}Md=new WeakMap,zd=new WeakMap,Dd=new WeakMap;var wc,Rd,Jo,Bn,Qm,eg,tg,ig,rg;class ZC{constructor(o,g){X(this,wc);X(this,Rd);X(this,Jo);X(this,Bn);X(this,Qm,o=>{if(!I(this,Jo).current){if(o.pointerType==="touch"||o.button!==0)return o.preventDefault();I(this,Bn).toggleOpen()}});X(this,eg,o=>{I(this,Jo).current||o.pointerType==="touch"&&(o.preventDefault(),I(this,Bn).toggleOpen())});X(this,tg,o=>{I(this,Jo).current||(o.key===nb||o.key===mP)&&(o.preventDefault(),I(this,Bn).toggleOpen())});X(this,ig,()=>{if(I(this,Bn).open.current&&I(this,Bn).contentId)return I(this,Bn).contentId});X(this,rg,Pe(()=>({id:I(this,wc).current,"aria-haspopup":"dialog","aria-expanded":rb(I(this,Bn).open.current),"data-state":Oy(I(this,Bn).open.current),"aria-controls":I(this,ig).call(this),"data-popover-trigger":"",disabled:I(this,Jo).current,onpointerdown:I(this,Qm),onkeydown:I(this,tg),onpointerup:I(this,eg)})));qe(this,wc,o.id),qe(this,Bn,g),qe(this,Rd,o.ref),qe(this,Jo,o.disabled),_r({id:I(this,wc),ref:I(this,Rd),onRefChange:v=>{I(this,Bn).triggerNode=v}})}get props(){return R(I(this,rg))}}wc=new WeakMap,Rd=new WeakMap,Jo=new WeakMap,Bn=new WeakMap,Qm=new WeakMap,eg=new WeakMap,tg=new WeakMap,ig=new WeakMap,rg=new WeakMap;var Sc,Ld,ng,sg;class GC{constructor(o,g){X(this,Sc);X(this,Ld);Ue(this,"root");X(this,ng,Pe(()=>({open:this.root.open.current})));X(this,sg,Pe(()=>({id:I(this,Sc).current,tabindex:-1,"data-state":Oy(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));qe(this,Sc,o.id),this.root=g,qe(this,Ld,o.ref),_r({id:I(this,Sc),ref:I(this,Ld),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return R(I(this,ng))}get props(){return R(I(this,sg))}}Sc=new WeakMap,Ld=new WeakMap,ng=new WeakMap,sg=new WeakMap;const[WC,Ob]=Ga("Popover.Root");function HC(f){return WC(new qC(f))}function XC(f){return new ZC(f,Ob())}function KC(f){return new GC(f,Ob())}var JC=Rt("<div><!></div>"),YC=Rt("<div><!></div>");function $C(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"id",19,Ar),T=ee(o,"forceMount",3,!1),E=ee(o,"onCloseAutoFocus",3,ur),w=ee(o,"onEscapeKeydown",3,ur),c=ee(o,"onInteractOutside",3,ur),U=ee(o,"trapFocus",3,!0),W=ee(o,"preventScroll",3,!1),K=Jt(o,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const j=KC({id:Se.with(()=>v()),ref:Se.with(()=>g(),Ne=>g(Ne))}),V=Pe(()=>er(K,j.props));function ne(Ne){c()(Ne),!Ne.defaultPrevented&&j.root.close()}function oe(Ne){w()(Ne),!Ne.defaultPrevented&&j.root.close()}function ce(Ne){var De;E()(Ne),!Ne.defaultPrevented&&(Ne.preventDefault(),(De=j.root.triggerNode)==null||De.focus())}var fe=tt(),Ie=Be(fe);{var _e=Ne=>{BI(Ne,Qt(()=>R(V),{get enabled(){return j.root.open.current},get id(){return v()},onInteractOutside:ne,onEscapeKeydown:oe,onCloseAutoFocus:ce,get trapFocus(){return U()},get preventScroll(){return W()},loop:!0,forceMount:!0,popper:(Xe,it)=>{let Ct=()=>it==null?void 0:it().props;var Je=tt();const St=Pe(()=>er(Ct(),{style:y0("popover")}));var dt=Be(Je);{var Ge=Ee=>{var Le=tt(),Ke=Be(Le);Ot(Ke,()=>o.child,()=>({props:R(St),...j.snippetProps})),we(Ee,Le)},Fe=Ee=>{var Le=JC();let Ke;var pt=Kt(Le);Ot(pt,()=>o.children??ei),Wt(Le),$t(()=>Ke=ji(Le,Ke,{...R(St)})),we(Ee,Le)};gi(dt,Ee=>{o.child?Ee(Ge):Ee(Fe,!1)})}we(Xe,Je)},$$slots:{popper:!0}}))},ke=Ne=>{var De=tt(),Xe=Be(De);{var it=Ct=>{FI(Ct,Qt(()=>R(V),{get present(){return j.root.open.current},get id(){return v()},onInteractOutside:ne,onEscapeKeydown:oe,onCloseAutoFocus:ce,get trapFocus(){return U()},get preventScroll(){return W()},loop:!0,forceMount:!1,popper:(St,dt)=>{let Ge=()=>dt==null?void 0:dt().props;var Fe=tt();const Ee=Pe(()=>er(Ge(),{style:y0("popover")}));var Le=Be(Fe);{var Ke=yt=>{var lt=tt(),ut=Be(lt);Ot(ut,()=>o.child,()=>({props:R(Ee),...j.snippetProps})),we(yt,lt)},pt=yt=>{var lt=YC();let ut;var Ft=Kt(lt);Ot(Ft,()=>o.children??ei),Wt(lt),$t(()=>ut=ji(lt,ut,{...R(Ee)})),we(yt,lt)};gi(Le,yt=>{o.child?yt(Ke):yt(pt,!1)})}we(St,Fe)},$$slots:{popper:!0}}))};gi(Xe,Ct=>{T()||Ct(it)},!0)}we(Ne,De)};gi(Ie,Ne=>{T()?Ne(_e):Ne(ke,!1)})}we(f,fe),Et()}var QC=Rt("<button><!></button>");function eA(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"type",3,"button"),E=ee(o,"disabled",3,!1),w=Jt(o,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const c=XC({id:Se.with(()=>g()),ref:Se.with(()=>v(),V=>v(V)),disabled:Se.with(()=>!!E())}),U=Pe(()=>er(w,c.props,{type:T()})),W=Cp(),[K,j]=W;MI(f,{get id(){return g()},children:(V,ne)=>{var oe=tt(),ce=Be(oe);{var fe=_e=>{var ke=tt(),Ne=Be(ke);Ot(Ne,()=>o.child,()=>({props:R(U)})),we(_e,ke)},Ie=_e=>{var ke=QC();const Ne=Pe(()=>j({...R(U)},[{attribute_name:"formaction"}]));let De;var Xe=Kt(ke);Ot(Xe,()=>o.children??ei),Wt(ke),$t(()=>De=ji(ke,De,{...R(Ne)})),we(_e,ke)};gi(ce,_e=>{o.child?_e(fe):_e(Ie,!1)})}we(V,oe)},$$slots:{default:!0}}),Et()}function tA(f,o){At(o,!0);let g=ee(o,"open",15,!1),v=ee(o,"onOpenChange",3,ur),T=ee(o,"controlledOpen",3,!1);UP({variant:Se.with(()=>"dialog"),open:Se.with(()=>g(),c=>{T()||g(c),v()(c)})});var E=tt(),w=Be(E);Ot(w,()=>o.children??ei),we(f,E),Et()}var iA=Rt("<!> <!>",1),rA=Rt("<!> <div><!></div>",1);function nA(f,o){At(o,!0);let g=ee(o,"id",19,Ar),v=ee(o,"ref",15,null),T=ee(o,"forceMount",3,!1),E=ee(o,"onCloseAutoFocus",3,ur),w=ee(o,"onEscapeKeydown",3,ur),c=ee(o,"onInteractOutside",3,ur),U=ee(o,"trapFocus",3,!0),W=ee(o,"preventScroll",3,!0),K=ee(o,"restoreScrollDelay",3,null),j=Jt(o,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const V=ZP({id:Se.with(()=>g()),ref:Se.with(()=>v(),ce=>v(ce))}),ne=Pe(()=>er(j,V.props));var oe=Pe(()=>V.root.open.current||T());By(f,Qt(()=>R(ne),{get forceMount(){return T()},get present(){return R(oe)},presence:(fe,Ie)=>{let _e=()=>Ie==null?void 0:Ie().present;var ke=Pe(()=>ST({forceMount:T(),present:_e().current,trapFocus:U(),open:V.root.open.current}));db(fe,Qt({loop:!0,get trapFocus(){return R(ke)}},()=>R(ne),{onCloseAutoFocus:De=>{var Xe;E()(De),!De.defaultPrevented&&((Xe=V.root.triggerNode)==null||Xe.focus())},focusScope:(De,Xe)=>{let it=()=>Xe==null?void 0:Xe().props;ub(De,Qt(()=>R(ne),{get enabled(){return _e().current},onEscapeKeydown:Ct=>{w()(Ct),!Ct.defaultPrevented&&V.root.handleClose()},children:(Ct,Je)=>{cb(Ct,Qt(()=>R(ne),{get enabled(){return _e().current},onInteractOutside:St=>{c()(St),!St.defaultPrevented&&V.root.handleClose()},children:(St,dt)=>{fb(St,Qt(()=>R(ne),{get enabled(){return _e().current},children:(Ge,Fe)=>{var Ee=tt(),Le=Be(Ee);{var Ke=yt=>{var lt=iA(),ut=Be(lt);{var Ft=li=>{Hf(li,{get preventScroll(){return W()},get restoreScrollDelay(){return K()}})};gi(ut,li=>{V.root.open.current&&li(Ft)})}var qt=ni(ut,2),fi=kg(()=>({props:er(R(ne),it()),...V.snippetProps}));Ot(qt,()=>o.child,()=>R(fi)),we(yt,lt)},pt=yt=>{var lt=rA(),ut=Be(lt);Hf(ut,{get preventScroll(){return W()}});var Ft=ni(ut,2);const qt=Pe(()=>er(R(ne),it()));let fi;var li=Kt(Ft);Ot(li,()=>o.children??ei),Wt(Ft),$t(()=>fi=ji(Ft,fi,{...R(qt)})),we(yt,lt)};gi(Le,yt=>{o.child?yt(Ke):yt(pt,!1)})}we(Ge,Ee)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),Et()}function sA(f,o){At(o,!0);let g=ee(o,"open",15,!1),v=ee(o,"onOpenChange",3,ur),T=ee(o,"controlledOpen",3,!1);HC({open:Se.with(()=>g(),E=>{T()||g(E),v()(E)})}),kI(f,{children:(E,w)=>{var c=tt(),U=Be(c);Ot(U,()=>o.children??ei),we(E,c)},$$slots:{default:!0}}),Et()}function oA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"value",15,""),T=Jt(o,["$$slots","$$events","$$legacy","ref","value","class"]);var E=tt(),w=Be(E),c=Pe(()=>Di("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",o.class));ai(w,()=>IC,(U,W)=>{W(U,Qt({get class(){return R(c)},get value(){return v()},set value(K){v(K)},get ref(){return g()},set ref(K){g(K)}},()=>T))}),we(f,E),Et()}function aA(f,o){At(o,!0),ee(o,"ref",11,null);let g=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var v=tt(),T=Be(v),E=Pe(()=>Di("py-6 text-center text-sm",o.class));ai(T,()=>AC,(w,c)=>{c(w,Qt({get class(){return R(E)}},()=>g))}),we(f,v),Et()}var lA=Rt("<!> <!>",1);function cA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var T=tt(),E=Be(T),w=Pe(()=>Di("overflow-hidden p-1 text-foreground",o.class));ai(E,()=>kC,(c,U)=>{U(c,Qt({get class(){return R(w)},get ref(){return g()},set ref(W){g(W)}},()=>v,{children:(W,K)=>{var j=lA(),V=Be(j);{var ne=ce=>{var fe=tt(),Ie=Be(fe);ai(Ie,()=>zC,(_e,ke)=>{ke(_e,{class:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:(Ne,De)=>{Kn();var Xe=gs();$t(()=>_s(Xe,o.heading)),we(Ne,Xe)},$$slots:{default:!0}})}),we(ce,fe)};gi(V,ce=>{o.heading&&ce(ne)})}var oe=ni(V,2);ai(oe,()=>LC,(ce,fe)=>{fe(ce,{get children(){return o.children}})}),we(W,j)},$$slots:{default:!0}}))}),we(f,T),Et()}var uA=Rt('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function hA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"value",15,""),T=Jt(o,["$$slots","$$events","$$legacy","ref","class","value"]);var E=uA(),w=Kt(E);N2(w,{class:"mr-2 size-4 shrink-0 opacity-50"});var c=ni(w,2),U=Pe(()=>Di("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",o.class));ai(c,()=>FC,(W,K)=>{K(W,Qt({get class(){return R(U)},get ref(){return g()},set ref(j){g(j)}},()=>T,{get value(){return v()},set value(j){v(j)}}))}),Wt(E),we(f,E),Et()}function dA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var T=tt(),E=Be(T),w=Pe(()=>Di("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",o.class));ai(E,()=>VC,(c,U)=>{U(c,Qt({get class(){return R(w)},get ref(){return g()},set ref(W){g(W)}},()=>v))}),we(f,T),Et()}function pA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var T=tt(),E=Be(T),w=Pe(()=>Di("max-h-[300px] overflow-y-auto overflow-x-hidden",o.class));ai(E,()=>UC,(c,U)=>{U(c,Qt({get class(){return R(w)}},()=>v,{get ref(){return g()},set ref(W){g(W)}}))}),we(f,T),Et()}function Cr(){}const fA=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),mA=typeof document<"u";function gA(f){return f instanceof HTMLInputElement&&!fA.has(f.type)||f instanceof HTMLTextAreaElement||f instanceof HTMLElement&&f.isContentEditable}function Hr(f){switch(f){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return f}}const or={DURATION:.5,EASE:[.32,.72,0,1]},Fb=.4,_A=.25,yA=100,Bb=8,za=16,Xy=26,py="vaul-dragging",Nb=new WeakMap;function Ir(f,o,g=!1){if(!f||!(f instanceof HTMLElement))return;const v={};Object.entries(o).forEach(([T,E])=>{if(T.startsWith("--")){f.style.setProperty(T,E);return}v[T]=f.style[T],f.style[T]=E}),!g&&Nb.set(f,v)}function vA(f,o){if(!f||!(f instanceof HTMLElement))return;const g=Nb.get(f);g&&(f.style[o]=g[o])}function xA(){return Ky(/^Mac/)}function Ky(f){return typeof window<"u"&&window.navigator!=null?f.test(window.navigator.platform):void 0}function bA(){return Ky(/^iPhone/)}function b0(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function wA(){return Ky(/^iPad/)||xA()&&navigator.maxTouchPoints>1}function SA(){return bA()||wA()}function w0(f){switch(f){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return f}}function Vf(f,o){if(!f)return null;const g=window.getComputedStyle(f),v=g.transform||g.webkitTransform||g.mozTransform;let T=v.match(/^matrix3d\((.+)\)$/);return T?Number.parseFloat(T[1].split(", ")[w0(o)?13:12]):(T=v.match(/^matrix\((.+)\)$/),T?Number.parseFloat(T[1].split(", ")[w0(o)?5:4]):null)}function fy(f,o){if(!f)return()=>{};const g=f.style.cssText;return Object.assign(f.style,o),()=>{f.style.cssText=g}}let Qu=null;var Ss,Va,ja,Pc,Od,og,Fd,ag,lg;class PA{constructor(o){X(this,Ss);X(this,Va,Ye(Ze(typeof window<"u"?window.location.href:"")));X(this,ja,Ye(0));X(this,Pc,Pe(()=>I(this,Ss).open.current));X(this,Od,Pe(()=>I(this,Ss).noBodyStyles.current));X(this,og,Pe(()=>I(this,Ss).preventScrollRestoration.current));X(this,Fd,Pe(()=>I(this,Ss).modal.current));X(this,ag,Pe(()=>I(this,Ss).nested.current));X(this,lg,Pe(()=>I(this,Ss).hasBeenOpened));Ue(this,"setPositionFixed",()=>{if(b0()&&Qu===null&&R(I(this,Pc))&&!R(I(this,Od))){Qu={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:o,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-R(I(this,ja))}px`,left:`${-o}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const v=g-window.innerHeight;v&&R(I(this,ja))>=g&&(document.body.style.top=`${-(R(I(this,ja))+v)}px`)}),300)}});Ue(this,"restorePositionSetting",()=>{if(b0()&&Qu!==null&&!R(I(this,Od))){const o=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,Qu),window.requestAnimationFrame(()=>{if(R(I(this,og))&&R(I(this,Va))!==window.location.href){Oe(I(this,Va),Ze(window.location.href));return}window.scrollTo(g,o)}),Qu=null}});qe(this,Ss,o),Pt(()=>Vi(()=>{const g=()=>{Oe(I(this,ja),Ze(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),Pt(()=>{if(R(I(this,Va)),!!R(I(this,Fd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),Pt(()=>{R(I(this,Pc));const g=R(I(this,Fd)),v=R(I(this,lg)),T=R(I(this,ag));R(I(this,Va)),Vi(()=>{T||!v||(R(I(this,Pc))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}Ss=new WeakMap,Va=new WeakMap,ja=new WeakMap,Pc=new WeakMap,Od=new WeakMap,og=new WeakMap,Fd=new WeakMap,ag=new WeakMap,lg=new WeakMap;function S0(f,o){return Ip(f,o)}function TA(f,o){const g=f,v=typeof f=="symbol"?f.description:f;if(!z0(g)){if(o===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return o}return zy(f)}function IA(f,o){return`${f}Context`}function CA(f,o,g=!0){const v=IA(f),T=Symbol(v),E=v;function w(U){const W=TA(g?T:E,U);if(W===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(f)?`one of the following components: ${f.join(", ")}`:`\`${f}\``}`);return W}function c(U){return S0(g?T:E,U)}return[c,w]}var nn,Gr,Tc,Wr,cg,ug,Ic,Bd,Nd,Vd,hg,dg,pg,fg,mg,jd;class AA{constructor(o){X(this,nn);X(this,Gr,Pe(()=>I(this,nn).direction.current));X(this,Tc,Pe(()=>I(this,nn).container.current));X(this,Wr,Pe(()=>I(this,nn).snapPoints.current??[]));X(this,cg,Pe(()=>I(this,nn).activeSnapPoint.current));X(this,ug,Pe(()=>I(this,nn).fadeFromIndex.current));X(this,Ic,Pe(()=>I(this,nn).overlayNode));X(this,Bd,Pe(()=>I(this,nn).drawerNode));X(this,Nd,Pe(()=>I(this,nn).snapToSequentialPoint.current));X(this,Vd,Ye(mA?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));X(this,hg,Pe(()=>{var o;return this.activeSnapPoint===((o=R(I(this,Wr)))==null?void 0:o[R(I(this,Wr)).length-1])||null}));X(this,dg,Pe(()=>{var o;return(o=R(I(this,Wr)))==null?void 0:o.findIndex(g=>g===this.activeSnapPoint)}));X(this,pg,Pe(()=>R(I(this,Wr))&&R(I(this,Wr)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&R(I(this,Wr))[this.fadeFromIndex]===this.activeSnapPoint||!R(I(this,Wr))));X(this,fg,Pe(()=>{var v;this.windowDimensions,I(this,nn).open.current;const o=R(I(this,Tc))?{width:R(I(this,Tc)).getBoundingClientRect().width,height:R(I(this,Tc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((v=R(I(this,Wr)))==null?void 0:v.map(T=>{const E=typeof T=="string";let w=0;if(E&&(w=Number.parseInt(T,10)),Hr(R(I(this,Gr)))){const U=E?w:this.windowDimensions?T*o.height:0;return this.windowDimensions?R(I(this,Gr))==="bottom"?o.height-U:-o.height+U:U}const c=E?w:this.windowDimensions?T*o.width:0;return this.windowDimensions?R(I(this,Gr))==="right"?o.width-c:-o.width+c:c}))??[]}));X(this,mg,Pe(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));X(this,jd,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});Ue(this,"snapToPoint",o=>{var v;const g=this.snapPointsOffset.findIndex(T=>T===o)??null;I(this,nn).onSnapPointChange(g),Ir(R(I(this,Bd)),{transition:`transform ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,transform:Hr(R(I(this,Gr)))?`translate3d(0, ${o}px, 0)`:`translate3d(${o}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?Ir(R(I(this,Ic)),{transition:`opacity ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,opacity:"0"}):Ir(R(I(this,Ic)),{transition:`opacity ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,opacity:"1"}),I(this,nn).setActiveSnapPoint((v=R(I(this,Wr)))==null?void 0:v[Math.max(g,0)])});Ue(this,"onRelease",o=>{var U;if(this.fadeFromIndex===void 0)return;const g=R(I(this,Gr))==="bottom"||R(I(this,Gr))==="right"?(this.activeSnapPointOffset??0)-o.draggedDistance:(this.activeSnapPointOffset??0)+o.draggedDistance,v=this.activeSnapPointIndex===this.fadeFromIndex-1,T=this.activeSnapPointIndex===0,E=o.draggedDistance>0;if(v&&Ir(R(I(this,Ic)),{transition:`opacity ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`}),!R(I(this,Nd))&&o.velocity>2&&!E){o.dismissible?o.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!R(I(this,Nd))&&o.velocity>2&&E&&this.snapPointsOffset&&R(I(this,Wr))){this.snapToPoint(this.snapPointsOffset[R(I(this,Wr)).length-1]);return}const w=(U=this.snapPointsOffset)==null?void 0:U.reduce((W,K)=>typeof W!="number"||typeof K!="number"?W:Math.abs(K-g)<Math.abs(W-g)?K:W),c=Hr(R(I(this,Gr)))?window.innerHeight:window.innerWidth;if(o.velocity>Fb&&Math.abs(o.draggedDistance)<c*.4){const W=E?1:-1;if(W>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[R(I(this,Wr)).length-1]);return}if(T&&W<0&&o.dismissible&&I(this,nn).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+W]);return}this.snapToPoint(w)});Ue(this,"onDrag",o=>{if(this.activeSnapPointOffset===null)return;const g=R(I(this,Gr))==="bottom"||R(I(this,Gr))==="right"?this.activeSnapPointOffset-o.draggedDistance:this.activeSnapPointOffset+o.draggedDistance;(R(I(this,Gr))==="bottom"||R(I(this,Gr))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(R(I(this,Gr))==="top"||R(I(this,Gr))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||Ir(R(I(this,Bd)),{transform:Hr(R(I(this,Gr)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});Ue(this,"getPercentageDragged",(o,g)=>{if(!R(I(this,Wr)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const v=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(v&&!g)return 1;if(!this.shouldFade&&!v)return null;const E=v?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,w=v?this.snapPointsOffset[E]-this.snapPointsOffset[E-1]:this.snapPointsOffset[E+1]-this.snapPointsOffset[E],c=o/Math.abs(w);return v?1-c:c});qe(this,nn,o),Pt(()=>Vi(()=>(window.addEventListener("resize",I(this,jd)),()=>window.removeEventListener("resize",I(this,jd))))),Pt(()=>{const g=this.activeSnapPoint,v=R(I(this,Wr)),T=this.snapPointsOffset;Vi(()=>{if(g){const E=(v==null?void 0:v.findIndex(w=>w===g))??-1;T&&E!==-1&&typeof T[E]=="number"&&this.snapToPoint(T[E])}})})}get activeSnapPoint(){return R(I(this,cg))}get fadeFromIndex(){return R(I(this,ug))}get windowDimensions(){return R(I(this,Vd))}set windowDimensions(o){Oe(I(this,Vd),o)}get isLastSnapPoint(){return R(I(this,hg))}get activeSnapPointIndex(){return R(I(this,dg))}get shouldFade(){return R(I(this,pg))}get snapPointsOffset(){return R(I(this,fg))}get activeSnapPointOffset(){return R(I(this,mg))}}nn=new WeakMap,Gr=new WeakMap,Tc=new WeakMap,Wr=new WeakMap,cg=new WeakMap,ug=new WeakMap,Ic=new WeakMap,Bd=new WeakMap,Nd=new WeakMap,Vd=new WeakMap,hg=new WeakMap,dg=new WeakMap,pg=new WeakMap,fg=new WeakMap,mg=new WeakMap,jd=new WeakMap;function EA(...f){return(...o)=>{for(const g of f)typeof g=="function"&&g(...o)}}function kA(f){const o=Pe(()=>f.direction.current),g=Pe(()=>f.open.current),v=Pe(()=>f.shouldScaleBackground.current),T=Pe(()=>f.setBackgroundColorOnScale.current),E=Pe(()=>f.noBodyStyles.current);let w=Ye(null),c=Ye("");function U(){return(window.innerWidth-Xy)/window.innerWidth}Pt(()=>{Vi(()=>{Oe(c,Ze(document.body.style.backgroundColor))})}),Pt(()=>(R(g),R(v),R(T),Vi(()=>{if(R(g)&&R(v)){R(w)&&window.clearTimeout(R(w));const W=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!W)return;EA(R(T)&&!R(E)?fy(document.body,{background:"black"}):Cr,fy(W,{transformOrigin:Hr(R(o))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${or.DURATION}s`,transitionTimingFunction:`cubic-bezier(${or.EASE.join(",")})`}));const K=fy(W,{borderRadius:`${Bb}px`,overflow:"hidden",...Hr(R(o))?{transform:`scale(${U()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${U()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{K(),Oe(w,Ze(window.setTimeout(()=>{R(c)?document.body.style.background=R(c):document.body.style.removeProperty("background")},or.DURATION*1e3)))}}})))}var Ud,qd,Zd,Gd,Wd,Hd,Xd,Kd,Jd,Yd,$d,Qd,ep,tp,ip,rp,np,gg;class MA{constructor(o){Ue(this,"open");Ue(this,"activeSnapPoint");Ue(this,"closeThreshold");Ue(this,"shouldScaleBackground");Ue(this,"scrollLockTimeout");Ue(this,"snapPoints");Ue(this,"fadeFromIndex");Ue(this,"fixed");Ue(this,"dismissible");Ue(this,"direction");Ue(this,"onDragProp");Ue(this,"onReleaseProp");Ue(this,"nested");Ue(this,"onCloseProp");Ue(this,"backgroundColor");Ue(this,"modal");Ue(this,"handleOnly");Ue(this,"noBodyStyles");Ue(this,"preventScrollRestoration");Ue(this,"setBackgroundColorOnScale");Ue(this,"container");Ue(this,"snapToSequentialPoint");Ue(this,"repositionInputs");Ue(this,"autoFocus");X(this,Ud,Ye(!1));X(this,qd,Ye(!1));X(this,Zd,Ye(!1));X(this,Gd,Ye(null));X(this,Wd,Ye(null));X(this,Hd,Ye(null));X(this,Xd,Ye(null));X(this,Kd,Ye(null));X(this,Jd,Ye(!1));X(this,Yd,Ye(null));X(this,$d,Ye(0));X(this,Qd,Ye(!1));X(this,ep,Ye(0));X(this,tp,Ye(null));X(this,ip,Ye(0));X(this,rp,Ye(0));X(this,np,Ye(0));Ue(this,"snapPointsState");X(this,gg,Pe(()=>this.snapPointsState.snapPointsOffset));Ue(this,"positionFixedState");Ue(this,"setActiveSnapPoint",o=>{this.activeSnapPoint.current=o});Ue(this,"onSnapPointChange",o=>{this.snapPoints.current&&o===this.snapPointsOffset.length-1&&(this.openTime=new Date)});Ue(this,"onPress",o=>{var v;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(o.target))return;const g=(v=this.drawerNode)==null?void 0:v.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,SA()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),o.target.setPointerCapture(o.pointerId),this.pointerStart=Hr(this.direction.current)?o.pageY:o.pageX});Ue(this,"shouldDrag",(o,g)=>{var c;if(o===null)return!1;let v=o;const T=(c=window.getSelection())==null?void 0:c.toString(),E=this.drawerNode?Vf(this.drawerNode,this.direction.current):null,w=new Date;if(v.hasAttribute("data-vaul-no-drag")||v.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&w.getTime()-this.openTime.getTime()<500)return!1;if(E!==null&&(this.direction.current==="bottom"?E>0:E<0))return!0;if(T&&T.length>0)return!1;if(this.lastTimeDragPrevented!==null&&w.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&E===0)return this.lastTimeDragPrevented=w,!1;if(g)return this.lastTimeDragPrevented=w,!1;for(;v;){if(v.scrollHeight>v.clientHeight){if(v.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(v.getAttribute("role")==="dialog")return!0}v=v.parentNode}return!0});Ue(this,"onDrag",o=>{var V,ne;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,v=(this.pointerStart-(Hr(this.direction.current)?o.pageY:o.pageX))*g,T=v>0,E=this.snapPoints.current&&!this.dismissible.current&&!T;if(E&&this.snapPointsState.activeSnapPointIndex===0)return;const w=Math.abs(v),c=document.querySelector("[data-vaul-drawer-wrapper]"),U=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let W=w/U;const K=this.snapPointsState.getPercentageDragged(w,T);if(K!==null&&(W=K),E&&W>=1||!this.isAllowedToDrag&&!this.shouldDrag(o.target,T))return;if(this.drawerNode.classList.add(py),this.isAllowedToDrag=!0,Ir(this.drawerNode,{transition:"none"}),Ir(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:v}),T&&!this.snapPoints.current){const oe=VA(v),ce=Math.min(oe*-1,0)*g;Ir(this.drawerNode,{transform:Hr(this.direction.current)?`translate3d(0, ${ce}px, 0)`:`translate3d(${ce}px, 0, 0)`});return}const j=1-W;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((ne=(V=this.onDragProp).current)==null||ne.call(V,o,W),Ir(this.overlayNode,{opacity:`${j}`,transition:"none"},!0)),c&&this.overlayNode&&this.shouldScaleBackground.current){const oe=Math.min(jf()+W*(1-jf()),1),ce=8-W*8,fe=Math.max(0,14-W*14);Ir(c,{borderRadius:`${ce}px`,transform:Hr(this.direction.current)?`scale(${oe}) translate3d(0, ${fe}px, 0)`:`scale(${oe}) translate3d(${fe}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const oe=w*g;Ir(this.drawerNode,{transform:Hr(this.direction.current)?`translate3d(0, ${oe}px, 0)`:`translate3d(${oe}px, 0, 0)`})}});Ue(this,"closeDrawer",o=>{var g,v;this.cancelDrag(),(v=(g=this.onCloseProp).current)==null||v.call(g),o||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},or.DURATION*1e3)});Ue(this,"resetDrawer",()=>{if(!this.drawerNode)return;const o=document.querySelector("[data-vaul-drawer-wrapper]"),g=Vf(this.drawerNode,this.direction.current);Ir(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`}),Ir(this.overlayNode,{transition:`opacity ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&Ir(o,{borderRadius:`${Bb}px`,overflow:"hidden",...Hr(this.direction.current)?{transform:`scale(${jf()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${jf()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${or.DURATION}s`,transitionTimingFunction:`cubic-bezier(${or.EASE.join(",")})`},!0)});Ue(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(py),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});Ue(this,"onRelease",o=>{var W,K,j,V,ne,oe,ce,fe,Ie,_e;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(py),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=Vf(this.drawerNode,this.direction.current);if(!this.shouldDrag(o.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const v=this.dragEndTime.getTime()-this.dragStartTime.getTime(),T=this.pointerStart-(Hr(this.direction.current)?o.pageY:o.pageX),E=Math.abs(T)/v;if(E>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const ke=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:T*ke,closeDrawer:this.closeDrawer,velocity:E,dismissible:this.dismissible.current}),(K=(W=this.onReleaseProp).current)==null||K.call(W,o,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?T>0:T<0){this.resetDrawer(),(V=(j=this.onReleaseProp).current)==null||V.call(j,o,!0);return}if(E>Fb){this.closeDrawer(),(oe=(ne=this.onReleaseProp).current)==null||oe.call(ne,o,!1);return}const w=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),c=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),U=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(U?c:w)*this.closeThreshold.current){this.closeDrawer(),(fe=(ce=this.onReleaseProp).current)==null||fe.call(ce,o,!1);return}(_e=(Ie=this.onReleaseProp).current)==null||_e.call(Ie,o,!0),this.resetDrawer()});Ue(this,"onNestedOpenChange",o=>{const g=o?(window.innerWidth-za)/window.innerWidth:1,v=o?-za:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),Ir(this.drawerNode,{transition:`transform ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${v}px, 0)`}),!o&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const T=Vf(this.drawerNode,this.direction.current);Ir(this.drawerNode,{transition:"none",transform:Hr(this.direction.current)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))});Ue(this,"onNestedDrag",(o,g)=>{if(g<0)return;const v=(window.innerWidth-za)/window.innerWidth,T=v+g*(1-v),E=-za+g*za;Ir(this.drawerNode,{transform:Hr(this.direction.current)?`scale(${T}) translate3d(0, ${E}px, 0)`:`scale(${T}) translate3d(${E}px, 0, 0)`,transition:"none"})});Ue(this,"onNestedRelease",(o,g)=>{const v=Hr(this.direction.current)?window.innerHeight:window.innerWidth,T=g?(v-za)/v:1,E=g?-za:0;g&&Ir(this.drawerNode,{transition:`transform ${or.DURATION}s cubic-bezier(${or.EASE.join(",")})`,transform:Hr(this.direction.current)?`scale(${T}) translate3d(0, ${E}px, 0)`:`scale(${T}) translate3d(${E}px, 0, 0)`})});Ue(this,"onDialogOpenChange",o=>{!this.dismissible.current&&!this.open.current||(o?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=o)});this.open=o.open,this.activeSnapPoint=o.activeSnapPoint,this.closeThreshold=o.closeThreshold,this.shouldScaleBackground=o.shouldScaleBackground,this.scrollLockTimeout=o.scrollLockTimeout,this.snapPoints=o.snapPoints,this.fadeFromIndex=o.fadeFromIndex,this.fixed=o.fixed,this.dismissible=o.dismissible,this.direction=o.direction,this.onDragProp=o.onDrag,this.onReleaseProp=o.onRelease,this.nested=o.nested,this.onCloseProp=o.onClose,this.backgroundColor=o.backgroundColor,this.modal=o.modal,this.handleOnly=o.handleOnly,this.noBodyStyles=o.noBodyStyles,this.preventScrollRestoration=o.preventScrollRestoration,this.setBackgroundColorOnScale=o.setBackgroundColorOnScale,this.container=o.container,this.snapToSequentialPoint=o.snapToSequentialPoint,this.repositionInputs=o.repositionInputs,this.autoFocus=o.autoFocus,this.snapPointsState=new AA(this),this.positionFixedState=new PA(this),Pt(()=>{const g=this.snapPointsState.activeSnapPointIndex,v=this.snapPoints.current,T=this.snapPointsState.snapPointsOffset;return this.drawerNode,Vi(()=>{var w;const E=()=>{var U;if(!this.drawerNode||!this.repositionInputs.current)return;const c=document.activeElement;if(gA(c)||this.keyboardIsOpen){const W=((U=window.visualViewport)==null?void 0:U.height)||0,K=window.innerHeight;let j=K-W;const V=this.drawerNode.getBoundingClientRect().height||0,ne=V>K*.8;this.initialDrawerHeight||(this.initialDrawerHeight=V);const oe=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-j)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),v&&v.length>0&&T&&g){const ce=T[g]||0;j+=ce}if(this.previousDiffFromInitial=j,V>W||this.keyboardIsOpen){const ce=this.drawerNode.getBoundingClientRect().height;let fe=ce;ce>W&&(fe=W-(ne?oe:Xy)),this.fixed.current?this.drawerNode.style.height=`${ce-Math.max(j,0)}px`:this.drawerNode.style.height=`${Math.max(fe,W-oe)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;v&&v.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(j,0)}px`}};return(w=window.visualViewport)==null||w.addEventListener("resize",E),()=>{var c;return(c=window.visualViewport)==null?void 0:c.removeEventListener("resize",E)}})}),Pt(()=>{const g=this.open.current;return Vi(()=>(g&&(Ir(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{vA(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return R(I(this,Ud))}set hasBeenOpened(o){Oe(I(this,Ud),Ze(o))}get isDragging(){return R(I(this,qd))}set isDragging(o){Oe(I(this,qd),Ze(o))}get justReleased(){return R(I(this,Zd))}set justReleased(o){Oe(I(this,Zd),Ze(o))}get overlayNode(){return R(I(this,Gd))}set overlayNode(o){Oe(I(this,Gd),Ze(o))}get openTime(){return R(I(this,Wd))}set openTime(o){Oe(I(this,Wd),Ze(o))}get dragStartTime(){return R(I(this,Hd))}set dragStartTime(o){Oe(I(this,Hd),Ze(o))}get dragEndTime(){return R(I(this,Xd))}set dragEndTime(o){Oe(I(this,Xd),Ze(o))}get lastTimeDragPrevented(){return R(I(this,Kd))}set lastTimeDragPrevented(o){Oe(I(this,Kd),Ze(o))}get isAllowedToDrag(){return R(I(this,Jd))}set isAllowedToDrag(o){Oe(I(this,Jd),Ze(o))}get nestedOpenChangeTimer(){return R(I(this,Yd))}set nestedOpenChangeTimer(o){Oe(I(this,Yd),Ze(o))}get pointerStart(){return R(I(this,$d))}set pointerStart(o){Oe(I(this,$d),Ze(o))}get keyboardIsOpen(){return R(I(this,Qd))}set keyboardIsOpen(o){Oe(I(this,Qd),Ze(o))}get previousDiffFromInitial(){return R(I(this,ep))}set previousDiffFromInitial(o){Oe(I(this,ep),Ze(o))}get drawerNode(){return R(I(this,tp))}set drawerNode(o){Oe(I(this,tp),Ze(o))}get drawerHeight(){return R(I(this,ip))}set drawerHeight(o){Oe(I(this,ip),Ze(o))}get drawerWidth(){return R(I(this,rp))}set drawerWidth(o){Oe(I(this,rp),Ze(o))}get initialDrawerHeight(){return R(I(this,np))}set initialDrawerHeight(o){Oe(I(this,np),Ze(o))}get snapPointsOffset(){return R(I(this,gg))}}Ud=new WeakMap,qd=new WeakMap,Zd=new WeakMap,Gd=new WeakMap,Wd=new WeakMap,Hd=new WeakMap,Xd=new WeakMap,Kd=new WeakMap,Jd=new WeakMap,Yd=new WeakMap,$d=new WeakMap,Qd=new WeakMap,ep=new WeakMap,tp=new WeakMap,ip=new WeakMap,rp=new WeakMap,np=new WeakMap,gg=new WeakMap;var Jn,Cc,sp,op,_g,yg,vg;class zA{constructor(o,g){X(this,Jn);X(this,Cc);X(this,sp);X(this,op,Ye(!1));X(this,_g,Pe(()=>I(this,Jn).snapPoints.current&&I(this,Jn).snapPoints.current.length>0));X(this,yg,o=>{I(this,Jn).onRelease(o)});X(this,vg,Pe(()=>({id:I(this,Cc).current,"data-vaul-overlay":"","data-vaul-snap-points":I(this,Jn).open.current&&R(I(this,_g))?"true":"false","data-vaul-snap-points-overlay":I(this,Jn).open.current&&I(this,Jn).snapPointsState.shouldFade?"true":"false",onmouseup:I(this,yg)})));qe(this,Jn,g),qe(this,Cc,o.id),qe(this,sp,o.ref),Vb({id:I(this,Cc),ref:I(this,sp),onRefChange:v=>{this.mounted?I(this,Jn).overlayNode=v:I(this,Jn).overlayNode=null},deps:()=>this.mounted})}get mounted(){return R(I(this,op))}set mounted(o){Oe(I(this,op),Ze(o))}get props(){return R(I(this,vg))}}Jn=new WeakMap,Cc=new WeakMap,sp=new WeakMap,op=new WeakMap,_g=new WeakMap,yg=new WeakMap,vg=new WeakMap;var Hi,Ac,ap,lp,cp,up,hp,dp,pp,fp,mp,gp,_p,yp,xg,vp,bg,wg,Sg,Pg,Tg,Ig,Cg;class DA{constructor(o,g){X(this,Hi);X(this,Ac);X(this,ap);X(this,lp);X(this,cp);X(this,up);X(this,hp);X(this,dp);X(this,pp);X(this,fp);X(this,mp,Ye(!1));X(this,gp,Ye(null));X(this,_p,Ye(null));X(this,yp,Ye(!1));X(this,xg,Pe(()=>I(this,Hi).snapPoints.current&&I(this,Hi).snapPoints.current.length>0));X(this,vp,Ye(!1));Ue(this,"isDeltaInDirection",(o,g,v=0)=>{if(this.wasBeyondThePoint)return!0;const T=Math.abs(o.y),E=Math.abs(o.x),w=E>T,c=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(o.x*c<0)&&E>=0&&E<=v)return w}else if(!(o.y*c<0)&&T>=0&&T<=v)return!w;return this.wasBeyondThePoint=!0,!0});Ue(this,"handleOnPointerUp",o=>{this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,Hi).onRelease(o)});Ue(this,"onOpenAutoFocus",o=>{I(this,fp).current(o)});Ue(this,"onInteractOutside",o=>{if(I(this,lp).current(o),!I(this,Hi).modal.current||o.defaultPrevented){o.preventDefault();return}I(this,Hi).keyboardIsOpen&&(I(this,Hi).keyboardIsOpen=!1)});Ue(this,"onFocusOutside",o=>{I(this,Hi).modal.current||o.preventDefault()});X(this,bg,o=>{if(this.lastKnownPointerEvent=o,I(this,Hi).handleOnly.current||(I(this,up).current(o),!this.pointerStart))return;const g=o.pageY-this.pointerStart.y,v=o.pageX-this.pointerStart.x,T=o.pointerType==="touch"?10:2,E={x:v,y:g};this.isDeltaInDirection(E,I(this,Hi).direction.current,T)?I(this,Hi).onDrag(o):(Math.abs(v)>T||Math.abs(g)>T)&&(this.pointerStart=null)});X(this,wg,o=>{I(this,hp).current(o),this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,Hi).onRelease(o)});X(this,Sg,o=>{I(this,dp).current(o),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,Pg,o=>{I(this,pp).current(o),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,Tg,o=>{I(this,Hi).handleOnly.current||(I(this,cp).current(o),this.pointerStart={x:o.pageX,y:o.pageY},I(this,Hi).onPress(o))});X(this,Ig,Pe(()=>O0(I(this,Hi).snapPointsState.snapPointsOffset)));X(this,Cg,Pe(()=>({id:I(this,Ac).current,"data-vaul-drawer-direction":I(this,Hi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":I(this,Hi).container.current?"true":"false","data-vaul-snap-points":I(this,Hi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:I(this,Tg),onpointermove:I(this,bg),onpointerup:I(this,wg),onpointerout:I(this,Sg),oncontextmenu:I(this,Pg)})));qe(this,Hi,g),qe(this,Ac,o.id),qe(this,ap,o.ref),qe(this,lp,o.onInteractOutside),qe(this,cp,o.onPointerDown),qe(this,up,o.onPointerMove),qe(this,hp,o.onPointerUp),qe(this,dp,o.onPointerOut),qe(this,pp,o.onContextMenu),qe(this,fp,o.onOpenAutoFocus),Vb({id:I(this,Ac),ref:I(this,ap),onRefChange:v=>{this.mounted?I(this,Hi).drawerNode=v:I(this,Hi).drawerNode=null},deps:()=>this.mounted&&I(this,Hi).open.current}),kA(I(this,Hi)),Pt(()=>{this.hasSnapPoints&&I(this,Hi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return R(I(this,mp))}set delayedSnapPoints(o){Oe(I(this,mp),Ze(o))}get pointerStart(){return R(I(this,gp))}set pointerStart(o){Oe(I(this,gp),Ze(o))}get lastKnownPointerEvent(){return R(I(this,_p))}set lastKnownPointerEvent(o){Oe(I(this,_p),Ze(o))}get wasBeyondThePoint(){return R(I(this,yp))}set wasBeyondThePoint(o){Oe(I(this,yp),Ze(o))}get hasSnapPoints(){return R(I(this,xg))}get mounted(){return R(I(this,vp))}set mounted(o){Oe(I(this,vp),Ze(o))}get snapPointsOffset(){return R(I(this,Ig))}get props(){return R(I(this,Cg))}}Hi=new WeakMap,Ac=new WeakMap,ap=new WeakMap,lp=new WeakMap,cp=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,mp=new WeakMap,gp=new WeakMap,_p=new WeakMap,yp=new WeakMap,xg=new WeakMap,vp=new WeakMap,bg=new WeakMap,wg=new WeakMap,Sg=new WeakMap,Pg=new WeakMap,Tg=new WeakMap,Ig=new WeakMap,Cg=new WeakMap;var Ec,Ag;class RA{constructor(o){X(this,Ec);X(this,Ag,Pe(()=>({to:I(this,Ec).container.current?I(this,Ec).container.current:void 0})));qe(this,Ec,o)}get props(){return R(I(this,Ag))}}Ec=new WeakMap,Ag=new WeakMap;const[LA,Jy]=CA("Drawer.Root");function OA(f){return LA(new MA(f))}function FA(f){const o=Jy();return new DA(f,o)}function BA(f){const o=Jy();return new zA(f,o)}function NA(){const f=Jy();return new RA(f)}function jf(){return(window.innerWidth-Xy)/window.innerWidth}function VA(f){return 8*(Math.log(f+1)-2)}function Vb({id:f,ref:o,deps:g=()=>!0,onRefChange:v=()=>{}}){const T=Pe(()=>g());Pt(()=>(f.current,R(T),Vi(()=>{const E=document.getElementById(f.current);return o.current=E,v(o.current),()=>{v(null)}}))),Pt(()=>()=>{o.current=null,v(null)})}function jA(f,o){At(o,!0);let g=ee(o,"open",15,!1),v=ee(o,"onOpenChange",3,Cr),T=ee(o,"closeThreshold",3,_A),E=ee(o,"scrollLockTimeout",3,yA),w=ee(o,"fadeFromIndex",19,()=>o.snapPoints&&o.snapPoints.length-1),c=ee(o,"backgroundColor",3,"black"),U=ee(o,"nested",3,!1),W=ee(o,"shouldScaleBackground",3,!1),K=ee(o,"activeSnapPoint",15,null),j=ee(o,"onActiveSnapPointChange",3,Cr),V=ee(o,"onRelease",3,Cr),ne=ee(o,"onDrag",3,Cr),oe=ee(o,"onClose",3,Cr),ce=ee(o,"dismissible",3,!0),fe=ee(o,"direction",3,"bottom"),Ie=ee(o,"fixed",3,!1),_e=ee(o,"handleOnly",3,!1),ke=ee(o,"noBodyStyles",3,!1),Ne=ee(o,"preventScrollRestoration",3,!0),De=ee(o,"setBackgroundColorOnScale",3,!0),Xe=ee(o,"onAnimationEnd",3,Cr),it=ee(o,"controlledOpen",3,!1),Ct=ee(o,"repositionInputs",3,!0),Je=ee(o,"autoFocus",3,!1),St=ee(o,"snapToSequentialPoint",3,!1),dt=ee(o,"container",3,null),Ge=ee(o,"controlledActiveSnapPoint",3,!1),Fe=ee(o,"modal",3,!0),Ee=Jt(o,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const Le=OA({open:Se.with(()=>g(),ut=>{it()?pt(g()):(g(ut),pt(ut))}),closeThreshold:Se.with(()=>T()),scrollLockTimeout:Se.with(()=>E()),snapPoints:Se.with(()=>o.snapPoints),fadeFromIndex:Se.with(()=>w()),backgroundColor:Se.with(()=>c()),nested:Se.with(()=>U()),shouldScaleBackground:Se.with(()=>W()),activeSnapPoint:Se.with(()=>K(),ut=>{Ge()||K(ut),j()(ut)}),onRelease:Se.with(()=>V()),onDrag:Se.with(()=>ne()),onClose:Se.with(()=>oe()),dismissible:Se.with(()=>ce()),direction:Se.with(()=>fe()),fixed:Se.with(()=>Ie()),modal:Se.with(()=>Fe()),handleOnly:Se.with(()=>_e()),noBodyStyles:Se.with(()=>ke()),preventScrollRestoration:Se.with(()=>Ne()),setBackgroundColorOnScale:Se.with(()=>De()),repositionInputs:Se.with(()=>Ct()),autoFocus:Se.with(()=>Je()),snapToSequentialPoint:Se.with(()=>St()),container:Se.with(()=>dt())});let Ke;function pt(ut){var Ft;(Ft=v())==null||Ft(ut),ut&&!U()?Ke=document.body.style.cssText:!ut&&!U()&&Ap(or.DURATION*1e3,()=>{document.body.style.cssText=Ke}),!ut&&!U()&&Le.positionFixedState.restorePositionSetting(),setTimeout(()=>{var qt;(qt=Xe())==null||qt(ut)},or.DURATION*1e3),ut&&!Fe()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),ut||(document.body.style.pointerEvents="auto")}Pt(()=>()=>{U()||(document.body.style.cssText=Ke)});var yt=tt(),lt=Be(yt);ai(lt,()=>tA,(ut,Ft)=>{Ft(ut,Qt({controlledOpen:!0,get open(){return Le.open.current},onOpenChange:qt=>{Le.onDialogOpenChange(qt),pt(qt)}},()=>Ee))}),we(f,yt),Et()}function jb(f,o){At(o,!0),R0(()=>(o.onMounted(!0),()=>{o.onMounted(!1)})),Et()}class UA{constructor(o=0){Ue(this,"value",0);this.value=o}}const qA=new UA(0);function Ub(){return`vaul-${qA.value++}`}var ZA=Rt("<!> <!>",1);function GA(f,o){At(o,!0);let g=ee(o,"id",19,Ub),v=ee(o,"ref",15,null),T=ee(o,"onOpenAutoFocus",3,Cr),E=ee(o,"onInteractOutside",3,Cr),w=ee(o,"oncontextmenu",3,Cr),c=ee(o,"onpointerdown",3,Cr),U=ee(o,"onpointerup",3,Cr),W=ee(o,"onpointerout",3,Cr),K=ee(o,"onpointermove",3,Cr),j=ee(o,"preventScroll",3,!0),V=Jt(o,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const ne=FA({id:Se.with(()=>g()),ref:Se.with(()=>v(),Ie=>v(Ie)),onContextMenu:Se.with(()=>w()??Cr),onInteractOutside:Se.with(()=>E()),onPointerDown:Se.with(()=>c()??Cr),onPointerMove:Se.with(()=>K()??Cr),onPointerOut:Se.with(()=>W()??Cr),onPointerUp:Se.with(()=>U()??Cr),onOpenAutoFocus:Se.with(()=>T())}),oe=Pe(()=>er(V,ne.props));var ce=tt(),fe=Be(ce);ai(fe,()=>nA,(Ie,_e)=>{_e(Ie,Qt(()=>R(oe),{get preventScroll(){return j()},get onInteractOutside(){return ne.onInteractOutside},get onFocusOutside(){return ne.onFocusOutside},get onOpenAutoFocus(){return ne.onOpenAutoFocus},children:(ke,Ne)=>{var De=ZA(),Xe=Be(De);Ot(Xe,()=>o.children??ei);var it=ni(Xe,2);jb(it,{onMounted:Ct=>ne.mounted=Ct}),we(ke,De)},$$slots:{default:!0}}))}),we(f,ce),Et()}var WA=Rt("<!> <!>",1);function HA(f,o){At(o,!0);let g=ee(o,"id",19,Ub),v=ee(o,"ref",15,null),T=Jt(o,["$$slots","$$events","$$legacy","id","ref","children"]);const E=BA({id:Se.with(()=>g()),ref:Se.with(()=>v(),W=>v(W))}),w=Pe(()=>er(T,E.props));var c=tt(),U=Be(c);ai(U,()=>TT,(W,K)=>{K(W,Qt({get ref(){return v()},set ref(j){v(j)}},()=>R(w),{children:(j,V)=>{var ne=WA(),oe=Be(ne);jb(oe,{onMounted:fe=>{E.mounted=fe}});var ce=ni(oe,2);Ot(ce,()=>o.children??ei),we(j,ne)},$$slots:{default:!0}}))}),we(f,c),Et()}function XA(f,o){At(o,!0);const g=NA();let v=ee(o,"to",19,()=>g.props.to),T=Jt(o,["$$slots","$$events","$$legacy","to"]);var E=tt(),w=Be(E);ai(w,()=>sb,(c,U)=>{U(c,Qt({get to(){return v()}},()=>T))}),we(f,E),Et()}const KA=XP,JA=CT;function YA(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var T=tt(),E=Be(T),w=Pe(()=>Di("fixed inset-0 z-50 bg-black/80",o.class));ai(E,()=>HA,(c,U)=>{U(c,Qt({get ref(){return g()},set ref(W){g(W)},get class(){return R(w)}},()=>v))}),we(f,T),Et()}var $A=Rt('<div class="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"></div> <!>',1),QA=Rt("<!> <!>",1);function eE(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=tt(),E=Be(T);ai(E,()=>XA,(w,c)=>{c(w,Qt(()=>o.portalProps,{children:(U,W)=>{var K=QA(),j=Be(K);YA(j,{});var V=ni(j,2),ne=Pe(()=>Di("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",o.class));ai(V,()=>GA,(oe,ce)=>{ce(oe,Qt({get ref(){return g()},set ref(fe){g(fe)},get class(){return R(ne)}},()=>v,{children:(fe,Ie)=>{var _e=$A(),ke=ni(Be(_e),2);Ot(ke,()=>o.children??ei),we(fe,_e)},$$slots:{default:!0}}))}),we(U,K)},$$slots:{default:!0}}))}),we(f,T),Et()}function tE(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var T=tt(),E=Be(T),w=Pe(()=>Di("text-sm text-muted-foreground",o.class));ai(E,()=>JA,(c,U)=>{U(c,Qt({get ref(){return g()},set ref(W){g(W)},get class(){return R(w)}},()=>v))}),we(f,T),Et()}var iE=Rt("<div><!></div>");function rE(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class","children"]);var T=iE();let E;var w=Kt(T);Ot(w,()=>o.children??ei),Wt(T),Is(T,c=>g(c),()=>g()),$t(()=>E=ji(T,E,{class:Di("grid gap-1.5 p-4 text-center sm:text-left",o.class),...v})),we(f,T),Et()}function nE(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=Jt(o,["$$slots","$$events","$$legacy","ref","class"]);var T=tt(),E=Be(T),w=Pe(()=>Di("text-lg font-semibold leading-none tracking-tight",o.class));ai(E,()=>KA,(c,U)=>{U(c,Qt({get ref(){return g()},set ref(W){g(W)},get class(){return R(w)}},()=>v))}),we(f,T),Et()}function sE(f,o){let g=ee(o,"shouldScaleBackground",3,!0),v=ee(o,"open",15,!1),T=ee(o,"activeSnapPoint",15,null),E=Jt(o,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var w=tt(),c=Be(w);ai(c,()=>jA,(U,W)=>{W(U,Qt({get shouldScaleBackground(){return g()},get open(){return v()},set open(K){v(K)},get activeSnapPoint(){return T()},set activeSnapPoint(K){T(K)}},()=>E))}),we(f,w)}function oE(f,o){At(o,!0);let g=ee(o,"ref",15,null),v=ee(o,"sideOffset",3,4),T=ee(o,"align",3,"center"),E=Jt(o,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var w=tt(),c=Be(w);ai(c,()=>sb,(U,W)=>{W(U,Qt(()=>o.portalProps,{children:(K,j)=>{var V=tt(),ne=Be(V),oe=Pe(()=>Di("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o.class));ai(ne,()=>$C,(ce,fe)=>{fe(ce,Qt({get ref(){return g()},set ref(Ie){g(Ie)},get sideOffset(){return v()},get align(){return T()},get class(){return R(oe)}},()=>E))}),we(K,V)},$$slots:{default:!0}}))}),we(f,w),Et()}const aE=sA,lE=eA,cE=[{value:"architecture-fine-arts-library",label:"Architecture/Fine Arts Library",description:"The Architecture/Fine Arts Library supports the teaching and research requirements of the Faculty of Architecture, which includes programs in Architecture, City Planning, Interior Design and Landscape Architecture, as well as the School of Art with programs in Fine Arts and Art History.",location:{lat:49.80815612216234,lng:-97.13530152378586},hours:{monday:[{open:"08:30",close:"17:30"}],tuesday:[{open:"08:30",close:"17:30"}],wednesday:[{open:"08:30",close:"17:30"}],thursday:[{open:"08:30",close:"17:30"}],friday:[{open:"08:30",close:"17:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/CFbxpALxC7HpwdBx8"}},{value:"donald-craik-engineering-library",label:"Donald W. Craik Engineering Library",description:"The Donald W. Craik Engineering Library serves engineeirng resources, including books, journals, and electronic databases, to support academic and research needs of students and faculty.",location:{lat:49.80835859585458,lng:-97.13445434076718},alwaysOpen:!0,metadata:{amenities:["WiFi"]}},{value:"e-k-williams-law-library",label:"E. K. Williams Law Library",description:"E.K. Williams Law Library primarily serves the teaching and research needs of the Faculty of Law and the University. The library is also an integral part of the legal resources of Manitoba, where it plays a prominent role in the delivery of legal information to the members of the legal profession, the judiciary, other professional groups, and the general public.",location:{lat:49.81194940624498,lng:-97.13047415092316},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/NzVn21YBon12p11e8"}},{value:"eckhardt-gramatte-music-library",label:"Eckhardt Gramatté Music Library",description:"The Eckhardt Gramatté Music Library supports study, research, and performance at the University of Manitoba. As a unit of the University of Manitoba Libraries, the Music Library provides a vast range of print, recorded and electronic resources to students, faculty and staff of the University as well as members of the public.",location:{lat:49.808042975950016,lng:-97.1321825540353},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/BkewBe4p6jjSWEgb7"}},{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/pq5cGKjbKwuJFan86"}},{value:"father-harold-drake-library",label:"St. Paul's College",description:"The Fr. Harold Drake Library at St. Paul's College focuses on supporting the teaching and research needs of staff and students at St. Paul's College including the Jesuit Centre for Catholic Studies and Arthur V. Mauro Institute for Peace and Justice.",location:{lat:49.81045700369361,lng:-97.13799926192738},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/JGQEwkeyEtG1cDCbA"}},{value:"jim-peebles-science-and-technology-library",label:"Jim Peebles Science and Technology Library",description:"The Jim Peebles Science and Technology Library serves the research, study, and teaching requirements of the Faculties of Science, Engineering, Agricultural and Food Sciences, and Environment, Earth, and Resources.",location:{lat:49.81151151579056,lng:-97.13336330797407},hours:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/48NVXVD6kGeSoEue9"}}],uE=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46990996120006,lng:-80.54232110658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amenities:["WiFi"]}}],P0=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.133},spaces:cE,metadata:{timezone:"America/Winnipeg"}},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:uE,metadata:{timezone:"America/Toronto"}}];var Zf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var hE=Zf.exports,T0;function dE(){return T0||(T0=1,function(f,o){(function(g,v){f.exports=v()})(hE,function(){var g={},v={};function T(w,c,U){if(v[w]=U,w==="index"){var W="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",K={};return v.shared(K),v.index(g,K),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),g}}T("shared",["exports"],function(w){function c(i,t,r,s){return new(r||(r=Promise))(function(u,p){function m(P){try{x(s.next(P))}catch(C){p(C)}}function _(P){try{x(s.throw(P))}catch(C){p(C)}}function x(P){var C;P.done?u(P.value):(C=P.value,C instanceof r?C:new r(function(k){k(C)})).then(m,_)}x((s=s.apply(i,t||[])).next())})}function U(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var W=K;function K(i,t){this.x=i,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),u=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(i){return i instanceof K?i:Array.isArray(i)?new K(i[0],i[1]):i};var j=U(W),V=ne;function ne(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}ne.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=u/p}var m=0,_=1;for(r=i,s=0;s<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));s++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var oe=U(V);let ce,fe;function Ie(){return ce==null&&(ce=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ce}function _e(){if(fe==null&&(fe=!1,Ie())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const u=4*s;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){fe=!0;break}}}return fe||!1}function ke(i,t,r,s){const u=new oe(i,t,r,s);return p=>u.solve(p)}const Ne=ke(.25,.1,.25,1);function De(i,t,r){return Math.min(r,Math.max(t,i))}function Xe(i,t,r){const s=r-t,u=((i-t)%s+s)%s+t;return u===t?r:u}function it(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let Ct=1;function Je(i,t,r){const s={};for(const u in i)s[u]=t.call(this,i[u],u,i);return s}function St(i,t,r){const s={};for(const u in i)t.call(this,i[u],u,i)&&(s[u]=i[u]);return s}function dt(i){return Array.isArray(i)?i.map(dt):typeof i=="object"&&i?Je(i,dt):i}const Ge={};function Fe(i){Ge[i]||(typeof console<"u"&&console.warn(i),Ge[i]=!0)}function Ee(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Le(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ke=null;function pt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function lt(i,t,r,s,u){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const m=p==null?void 0:p.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const _=m.startsWith("BGR"),x=new Uint8ClampedArray(s*u*4);if(yield p.copyTo(x,function(P,C,k,D,F){const N=4*Math.max(-C,0),q=(Math.max(0,k)-k)*D*4+N,Y=4*D,ie=Math.max(0,C),xe=Math.max(0,k);return{rect:{x:ie,y:xe,width:Math.min(P.width,C+D)-ie,height:Math.min(P.height,k+F)-xe},layout:[{offset:q,stride:Y}]}}(i,t,r,s,u)),_)for(let P=0;P<x.length;P+=4){const C=x[P];x[P]=x[P+2],x[P+2]=C}return x}finally{p.close()}})}let ut,Ft;const qt="AbortError";function fi(){return new Error(qt)}const li={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Si(i){return li.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const _i="global-dispatcher";class yi extends Error{constructor(t,r,s,u){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=u}}const Pi=()=>Le(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ui=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=Si(i.url);if(s)return s(i,t);if(Le(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:_i},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Pi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,u){return c(this,void 0,void 0,function*(){const p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:Pi(),signal:u.signal});s.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");const m=yield fetch(p);if(!m.ok){const P=yield m.blob();throw new yi(m.status,m.statusText,s.url,P)}let _;_=s.type==="arrayBuffer"||s.type==="image"?m.arrayBuffer():s.type==="json"?m.json():m.text();const x=yield _;if(u.signal.aborted)throw fi();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(Le(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:_i},t)}var r;return function(s,u){return new Promise((p,m)=>{var _;const x=new XMLHttpRequest;x.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(x.responseType="arraybuffer");for(const P in s.headers)x.setRequestHeader(P,s.headers[P]);s.type==="json"&&(x.responseType="text",!((_=s.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=s.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let P=x.response;if(s.type==="json")try{P=JSON.parse(x.response)}catch(C){return void m(C)}p({data:P,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const P=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new yi(x.status,x.statusText,s.url,P))}},u.signal.addEventListener("abort",()=>{x.abort(),m(fi())}),x.send(s.body)})}(i,t)};function qi(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Zi(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Xi(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class Ei{constructor(t,r={}){it(this,r),this.type=t}}class mt extends Ei{constructor(t,r={}){super("error",it({error:t},r))}}class kt{on(t,r){return this._listeners=this._listeners||{},Zi(t,r,this._listeners),this}off(t,r){return Xi(t,r,this._listeners),Xi(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Zi(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new Ei(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of u)_.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of p)Xi(s,_,this._oneTimeListeners),_.call(this,t);const m=this._eventedParent;m&&(it(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof mt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ri=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function sn(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Ri.forEach(s=>{s in t&&(r[s]=t[s])}),r}function Ht(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Ht(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Ht(i[r],t[r]))return!1;return!0}return i===t}function vi(i,t){i.push(t)}function Ki(i,t,r){vi(r,{command:"addSource",args:[i,t[i]]})}function xi(i,t,r){vi(t,{command:"removeSource",args:[i]}),r[i]=!0}function tr(i,t,r,s){xi(i,r,s),Ki(i,t,r)}function ar(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Ht(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!Ht(i[r][s],t[r][s]))return!1;return!0}function ir(i,t,r,s,u,p){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||r.push({command:p,args:[s,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||r.push({command:p,args:[s,m,t[m],u]}))}function hr(i){return i.id}function Er(i,t){return i[t.id]=t,i}class Ve{constructor(t,r,s,u){this.message=(t?`${t}: `:"")+s,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ji(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class Wi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class kr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,u]of r)this.bindings[s]=u}concat(t){return new kr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const wr={kind:"null"},We={kind:"number"},Bt={kind:"string"},Mt={kind:"boolean"},dr={kind:"color"},Xr={kind:"object"},Ut={kind:"value"},mn={kind:"collator"},Yn={kind:"formatted"},as={kind:"padding"},Un={kind:"resolvedImage"},te={kind:"variableAnchorOffsetCollection"};function O(i,t){return{kind:"array",itemType:i,N:t}}function L(i){if(i.kind==="array"){const t=L(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const G=[wr,We,Bt,Mt,dr,Yn,Xr,O(Ut),as,Un,te];function $(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!$(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of G)if(!$(r,t))return null}}return`Expected ${L(i)} but found ${L(t)} instead.`}function he(i,t){return t.some(r=>r.kind===i.kind)}function pe(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ve(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const ae=.96422,Ae=.82521,Re=4/29,Te=6/29,$e=3*Te*Te,It=Te*Te*Te,zt=Math.PI/180,ci=180/Math.PI;function Zt(i){return(i%=360)<0&&(i+=360),i}function ui([i,t,r,s]){let u,p;const m=pr((.2225045*(i=ti(i))+.7168786*(t=ti(t))+.0606169*(r=ti(r)))/1);i===t&&t===r?u=p=m:(u=pr((.4360747*i+.3850649*t+.1430804*r)/ae),p=pr((.0139322*i+.0971045*t+.7141733*r)/Ae));const _=116*m-16;return[_<0?0:_,500*(u-m),200*(m-p),s]}function ti(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function pr(i){return i>It?Math.pow(i,1/3):i/$e+Re}function Yi([i,t,r,s]){let u=(i+16)/116,p=isNaN(t)?u:u+t/500,m=isNaN(r)?u:u-r/200;return u=1*bi(u),p=ae*bi(p),m=Ae*bi(m),[Xt(3.1338561*p-1.6168667*u-.4906146*m),Xt(-.9787684*p+1.9161415*u+.033454*m),Xt(.0719453*p-.2289914*u+1.4052427*m),s]}function Xt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function bi(i){return i>Te?i*i*i:$e*(i-Re)}function Gi(i){return parseInt(i.padEnd(2,i),16)/255}function yr(i,t){return Sr(t?i/100:i,0,1)}function Sr(i,t,r){return Math.min(Math.max(t,i),r)}function Nr(i){return!i.some(Number.isNaN)}const io={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class wi{constructor(t,r,s,u=1,p=!0){this.r=t,this.g=r,this.b=s,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,r,s,u]))}static parse(t){if(t instanceof wi)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=io[s];if(u){const[m,_,x]=u;return[m/255,_/255,x/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const m=s.length<6?1:2;let _=1;return[Gi(s.slice(_,_+=m)),Gi(s.slice(_,_+=m)),Gi(s.slice(_,_+=m)),Gi(s.slice(_,_+m)||"ff")]}if(s.startsWith("rgb")){const m=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,x,P,C,k,D,F,N,q,Y,ie,xe]=m,ue=[C||" ",F||" ",Y].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const ge=[P,D,q].join(""),Ce=ge==="%%%"?100:ge===""?255:0;if(Ce){const je=[Sr(+x/Ce,0,1),Sr(+k/Ce,0,1),Sr(+N/Ce,0,1),ie?yr(+ie,xe):1];if(Nr(je))return je}}return}}const p=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,_,x,P,C,k,D,F,N]=p,q=[x||" ",C||" ",D].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const Y=[+_,Sr(+P,0,100),Sr(+k,0,100),F?yr(+F,N):1];if(Nr(Y))return function([ie,xe,ue,ge]){function Ce(je){const ct=(je+ie/30)%12,Dt=xe*Math.min(ue,1-ue);return ue-Dt*Math.max(-1,Math.min(ct-3,9-ct,1))}return ie=Zt(ie),xe/=100,ue/=100,[Ce(0),Ce(8),Ce(4),ge]}(Y)}}}(t);return r?new wi(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[t/p,r/p,s/p,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,u,p]=ui(t),m=Math.sqrt(s*s+u*u);return[Math.round(1e4*m)?Zt(Math.atan2(u,s)*ci):NaN,m,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ui(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,u]=this.rgb;return`rgba(${[t,r,s].map(p=>Math.round(255*p)).join(",")},${u})`}}wi.black=new wi(0,0,0,1),wi.white=new wi(1,1,1,1),wi.transparent=new wi(0,0,0,0),wi.red=new wi(1,0,0,1);class Nc{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vc{constructor(t,r,s,u,p){this.text=t,this.image=r,this.scale=s,this.fontStack=u,this.textColor=p}}class on{constructor(t){this.sections=t}static fromString(t){return new on([new Vc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof on?t:on.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class an{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof an)return t;if(typeof t=="number")return new an([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new an(t)}}toString(){return JSON.stringify(this.values)}}const Ng=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],u=t[r+1];if(typeof s!="string"||!Ng.has(s)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new gn(t)}}toString(){return JSON.stringify(this.values)}}class ln{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new ln({name:t,available:!1}):null}}function ro(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Es(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof wi||i instanceof Nc||i instanceof on||i instanceof an||i instanceof gn||i instanceof ln)return!0;if(Array.isArray(i)){for(const t of i)if(!Es(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Es(i[t]))return!1;return!0}return!1}function fr(i){if(i===null)return wr;if(typeof i=="string")return Bt;if(typeof i=="boolean")return Mt;if(typeof i=="number")return We;if(i instanceof wi)return dr;if(i instanceof Nc)return mn;if(i instanceof on)return Yn;if(i instanceof an)return as;if(i instanceof gn)return te;if(i instanceof ln)return Un;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const u=fr(s);if(r){if(r===u)continue;r=Ut;break}r=u}return O(r||Ut,t)}return Xr}function oa(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof wi||i instanceof on||i instanceof an||i instanceof gn||i instanceof ln?i.toString():JSON.stringify(i)}class In{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Es(t[1]))return r.error("invalid value");const s=t[1];let u=fr(s);const p=r.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new In(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class lr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Wa={string:Bt,number:We,boolean:Mt,object:Xr};class Cn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,u=1;const p=t[0];if(p==="array"){let _,x;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Wa)||P==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Wa[P],u++}else _=Ut;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}s=O(_,x)}else{if(!Wa[p])throw new Error(`Types doesn't contain name = ${p}`);s=Wa[p]}const m=[];for(;u<t.length;u++){const _=r.parse(t[u],u,Ut);if(!_)return null;m.push(_)}return new Cn(s,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!$(this.type,fr(s)))return s;if(r===this.args.length-1)throw new lr(`Expected value to be of type ${L(this.type)}, but found ${L(fr(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const jc={"to-boolean":Mt,"to-color":dr,"to-number":We,"to-string":Bt};class An{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!jc[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const u=jc[s],p=[];for(let m=1;m<t.length;m++){const _=r.parse(t[m],m,Ut);if(!_)return null;p.push(_)}return new An(u,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const u of this.args){if(r=u.evaluate(t),s=null,r instanceof wi)return r;if(typeof r=="string"){const p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ro(r[0],r[1],r[2],r[3]),!s))return new wi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new lr(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const u=an.parse(r);if(u)return u}throw new lr(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const u=gn.parse(r);if(u)return u}throw new lr(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new lr(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return on.fromString(oa(this.args[0].evaluate(t)));case"resolvedImage":return ln.fromString(oa(this.args[0].evaluate(t)));default:return oa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Vg=["Unknown","Point","LineString","Polygon"];class Ha{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=wi.parse(t)),r}}class ks{constructor(t,r,s=[],u,p=new kr,m=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=m,this.expectedType=u,this._isConstant=r}parse(t,r,s,u,p={}){return r?this.concat(r,s,u)._parse(t,p):this._parse(t,p)}_parse(t,r){function s(u,p,m){return m==="assert"?new Cn(p,[u]):m==="coerce"?new An(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let m=p.parse(t,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,x=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else m=s(m,_,r.typeAnnotation||"coerce");else m=s(m,_,r.typeAnnotation||"coerce");else m=s(m,_,r.typeAnnotation||"coerce");else m=s(m,_,r.typeAnnotation||"assert")}if(!(m instanceof In)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const _=new Ha;try{m=new In(m.type,m.evaluate(_))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const u=typeof t=="number"?this.path.concat(t):this.path,p=s?this.scope.concat(s):this.scope;return new ks(this.registry,this._isConstant,u,r||null,p,this.errors)}error(t,...r){const s=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Wi(s,t))}checkSubtype(t,r){const s=$(t,r);return s&&this.error(s),s}}class ls{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let p=1;p<t.length-1;p+=2){const m=t[p];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const _=r.parse(t[p+1],p+1);if(!_)return null;s.push([m,_])}const u=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return u?new ls(s,u):null}outputDefined(){return this.result.outputDefined()}}class pi{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new pi(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Uc{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,We),u=r.parse(t[2],2,O(r.expectedType||Ut));return s&&u?new Uc(u.type.itemType,s,u):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new lr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new lr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new lr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class qc{constructor(t,r){this.type=Mt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ut),u=r.parse(t[2],2,Ut);return s&&u?he(s.type,[Mt,Bt,We,wr,Ut])?new qc(s,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!pe(r,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${L(fr(r))} instead.`);if(!pe(s,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${L(fr(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class no{constructor(t,r,s){this.type=We,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ut),u=r.parse(t[2],2,Ut);if(!s||!u)return null;if(!he(s.type,[Mt,Bt,We,wr,Ut]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(s.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,We);return p?new no(s,u,p):null}return new no(s,u)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!pe(r,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${L(fr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),pe(s,["string"])){const p=s.indexOf(r,u);return p===-1?-1:[...s.slice(0,p)].length}if(pe(s,["array"]))return s.indexOf(r,u);throw new lr(`Expected second argument to be of type array or string, but found ${L(fr(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Zc{constructor(t,r,s,u,p,m){this.inputType=t,this.type=r,this.input=s,this.cases=u,this.outputs=p,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p={},m=[];for(let P=2;P<t.length-1;P+=2){let C=t[P];const k=t[P+1];Array.isArray(C)||(C=[C]);const D=r.concat(P);if(C.length===0)return D.error("Expected at least one branch label.");for(const N of C){if(typeof N!="number"&&typeof N!="string")return D.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,fr(N)))return null}else s=fr(N);if(p[String(N)]!==void 0)return D.error("Branch labels must be unique.");p[String(N)]=m.length}const F=r.parse(k,P,u);if(!F)return null;u=u||F.type,m.push(F)}const _=r.parse(t[1],1,Ut);if(!_)return null;const x=r.parse(t[t.length-1],t.length-1,u);return x?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new Zc(s,u,_,p,m,x):null}evaluate(t){const r=this.input.evaluate(t);return(fr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Xa{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const _=r.parse(t[m],m,Mt);if(!_)return null;const x=r.parse(t[m+1],m+1,s);if(!x)return null;u.push([_,x]),s=s||x.type}const p=r.parse(t[t.length-1],t.length-1,s);if(!p)return null;if(!s)throw new Error("Can't infer output type");return new Xa(s,u,p)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class aa{constructor(t,r,s,u){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Ut),u=r.parse(t[2],2,We);if(!s||!u)return null;if(!he(s.type,[O(Ut),Bt,Ut]))return r.error(`Expected first argument to be of type array or string, but found ${L(s.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,We);return p?new aa(s.type,s,u,p):null}return new aa(s.type,s,u)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),pe(r,["string"]))return[...r].slice(s,u).join("");if(pe(r,["array"]))return r.slice(s,u);throw new lr(`Expected first argument to be of type array or string, but found ${L(fr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ka(i,t){const r=i.length-1;let s,u,p=0,m=r,_=0;for(;p<=m;)if(_=Math.floor((p+m)/2),s=i[_],u=i[_+1],s<=t){if(_===r||t<u)return _;p=_+1}else{if(!(s>t))throw new lr("Input is not a number.");m=_-1}return 0}class so{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[u,p]of s)this.labels.push(u),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,We);if(!s)return null;const u=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let m=1;m<t.length;m+=2){const _=m===1?-1/0:t[m],x=t[m+1],P=m,C=m+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const k=r.parse(x,C,p);if(!k)return null;p=p||k.type,u.push([_,k])}return new so(p,s,u)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return s[0].evaluate(t);const p=r.length;return u>=r[p-1]?s[p-1].evaluate(t):s[Ka(r,u)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function zp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var jg=Dp;function Dp(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}Dp.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=u/p}var m=0,_=1;for(r=i,s=0;s<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));s++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Ug=zp(jg);function Ms(i,t,r){return i+r*(t-i)}function la(i,t,r){return i.map((s,u)=>Ms(s,t[u],r))}const Kr={number:Ms,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[u,p,m,_]=la(i.rgb,t.rgb,r);return new wi(u,p,m,_,!1)}case"hcl":{const[u,p,m,_]=i.hcl,[x,P,C,k]=t.hcl;let D,F;if(isNaN(u)||isNaN(x))isNaN(u)?isNaN(x)?D=NaN:(D=x,m!==1&&m!==0||(F=P)):(D=u,C!==1&&C!==0||(F=p));else{let xe=x-u;x>u&&xe>180?xe-=360:x<u&&u-x>180&&(xe+=360),D=u+r*xe}const[N,q,Y,ie]=function([xe,ue,ge,Ce]){return xe=isNaN(xe)?0:xe*zt,Yi([ge,Math.cos(xe)*ue,Math.sin(xe)*ue,Ce])}([D,F??Ms(p,P,r),Ms(m,C,r),Ms(_,k,r)]);return new wi(N,q,Y,ie,!1)}case"lab":{const[u,p,m,_]=Yi(la(i.lab,t.lab,r));return new wi(u,p,m,_,!1)}}},array:la,padding:function(i,t,r){return new an(la(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,u=t.values;if(s.length!==u.length)throw new lr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const p=[];for(let m=0;m<s.length;m+=2){if(s[m]!==u[m])throw new lr(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${s[m]}, to[${m}]: ${u[m]}`);p.push(s[m]);const[_,x]=s[m+1],[P,C]=u[m+1];p.push([Ms(_,P,r),Ms(x,C,r)])}return new gn(p)}};class Jr{constructor(t,r,s,u,p){this.type=t,this.operator=r,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of p)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(t,r,s,u){let p=0;if(t.name==="exponential")p=Ja(r,t.base,s,u);else if(t.name==="linear")p=Ja(r,1,s,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;p=new Ug(m[0],m[1],m[2],m[3]).solve(Ja(r,1,s,u))}return p}static parse(t,r){let[s,u,p,...m]=t;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const P=u[1];if(typeof P!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:P}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const P=u.slice(1);if(P.length!==4||P.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,We),!p)return null;const _=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=dr:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let P=0;P<m.length;P+=2){const C=m[P],k=m[P+1],D=P+3,F=P+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const N=r.parse(k,F,x);if(!N)return null;x=x||N.type,_.push([C,N])}return ve(x,We)||ve(x,dr)||ve(x,as)||ve(x,te)||ve(x,O(We))?new Jr(x,s,u,p,_):r.error(`Type ${L(x)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return s[0].evaluate(t);const p=r.length;if(u>=r[p-1])return s[p-1].evaluate(t);const m=Ka(r,u),_=Jr.interpolationFactor(this.interpolation,u,r[m],r[m+1]),x=s[m].evaluate(t),P=s[m+1].evaluate(t);switch(this.operator){case"interpolate":return Kr[this.type.kind](x,P,_);case"interpolate-hcl":return Kr.color(x,P,_,"hcl");case"interpolate-lab":return Kr.color(x,P,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ja(i,t,r,s){const u=s-r,p=i-r;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}class Ya{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const u=r.expectedType;u&&u.kind!=="value"&&(s=u);const p=[];for(const _ of t.slice(1)){const x=r.parse(_,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,p.push(x)}if(!s)throw new Error("No output type");const m=u&&p.some(_=>$(u,_.type));return new Ya(m?Ut:s,p)}evaluate(t){let r,s=null,u=0;for(const p of this.args)if(u++,s=p.evaluate(t),s&&s instanceof ln&&!s.available&&(r||(r=s.name),s=null,u===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function $a(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Rp(i,t,r,s){return s.compare(t,r)===0}function oo(i,t,r){const s=i!=="=="&&i!=="!=";return class qb{constructor(p,m,_){this.type=Mt,this.lhs=p,this.rhs=m,this.collator=_,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const _=p[0];let x=m.parse(p[1],1,Ut);if(!x)return null;if(!$a(_,x.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${L(x.type)}'.`);let P=m.parse(p[2],2,Ut);if(!P)return null;if(!$a(_,P.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${L(P.type)}'.`);if(x.type.kind!==P.type.kind&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${L(x.type)}' and '${L(P.type)}'.`);s&&(x.type.kind==="value"&&P.type.kind!=="value"?x=new Cn(P.type,[x]):x.type.kind!=="value"&&P.type.kind==="value"&&(P=new Cn(x.type,[P])));let C=null;if(p.length===4){if(x.type.kind!=="string"&&P.type.kind!=="string"&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(p[3],3,mn),!C)return null}return new qb(x,P,C)}evaluate(p){const m=this.lhs.evaluate(p),_=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const x=fr(m),P=fr(_);if(x.kind!==P.kind||x.kind!=="string"&&x.kind!=="number")throw new lr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${P.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=fr(m),P=fr(_);if(x.kind!=="string"||P.kind!=="string")return t(p,m,_)}return this.collator?r(p,m,_,this.collator.evaluate(p)):t(p,m,_)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const qg=oo("==",function(i,t,r){return t===r},Rp),Lp=oo("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!Rp(0,t,r,s)}),Op=oo("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),Zg=oo(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),Gg=oo("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),Fp=oo(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class ca{constructor(t,r,s){this.type=mn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const u=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Mt);if(!u)return null;const p=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Mt);if(!p)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,Bt),!m)?null:new ca(u,p,m)}evaluate(t){return new Nc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Gc{constructor(t,r,s,u,p){this.type=Bt,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,We);if(!s)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=r.parse(u.locale,1,Bt),!p))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,Bt),!m))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,We),!_))return null;let x=null;return u["max-fraction-digits"]&&(x=r.parse(u["max-fraction-digits"],1,We),!x)?null:new Gc(s,p,m,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Qa{constructor(t){this.type=Yn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=t.length-1;++m){const _=t[m];if(p&&typeof _=="object"&&!Array.isArray(_)){p=!1;let x=null;if(_["font-scale"]&&(x=r.parse(_["font-scale"],1,We),!x))return null;let P=null;if(_["text-font"]&&(P=r.parse(_["text-font"],1,O(Bt)),!P))return null;let C=null;if(_["text-color"]&&(C=r.parse(_["text-color"],1,dr),!C))return null;const k=u[u.length-1];k.scale=x,k.font=P,k.textColor=C}else{const x=r.parse(t[m],1,Ut);if(!x)return null;const P=x.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new Qa(u)}evaluate(t){return new on(this.sections.map(r=>{const s=r.content.evaluate(t);return fr(s)===Un?new Vc("",s,null,null,null):new Vc(oa(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Wc{constructor(t){this.type=Un,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Bt);return s?new Wc(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=ln.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Hc{constructor(t){this.type=We,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${L(s.type)} instead.`):new Hc(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new lr(`Expected value to be of type string or array, but found ${L(fr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const qn=8192;function Wg(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(r*u*qn),Math.round(s*u*qn)]}function Xc(i,t){const r=Math.pow(2,t.z);return[(u=(i[0]/qn+t.x)/r,360*u-180),(s=(i[1]/qn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,u}function zs(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function cs(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function mi(i,t,r){const s=i[0]-t[0],u=i[1]-t[1],p=i[0]-r[0],m=i[1]-r[1];return s*m-p*u==0&&s*p<=0&&u*m<=0}function el(i,t,r,s){return(u=[s[0]-r[0],s[1]-r[1]])[0]*(p=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*p[0]!=0&&!(!Np(i,t,r,s)||!Np(r,s,i,t));var u,p}function Hg(i,t,r){for(const s of r)for(let u=0;u<s.length-1;++u)if(el(i,t,s[u],s[u+1]))return!0;return!1}function ao(i,t,r=!1){let s=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(mi(i,_[x],_[x+1]))return r;(p=_[x])[1]>(u=i)[1]!=(m=_[x+1])[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(s=!s)}var u,p,m;return s}function Xg(i,t){for(const r of t)if(ao(i,r))return!0;return!1}function Bp(i,t){for(const r of i)if(!ao(r,t))return!1;for(let r=0;r<i.length-1;++r)if(Hg(i[r],i[r+1],t))return!1;return!0}function Kg(i,t){for(const r of t)if(Bp(i,r))return!0;return!1}function Np(i,t,r,s){const u=s[0]-r[0],p=s[1]-r[1],m=(i[0]-r[0])*p-u*(i[1]-r[1]),_=(t[0]-r[0])*p-u*(t[1]-r[1]);return m>0&&_<0||m<0&&_>0}function Kc(i,t,r){const s=[];for(let u=0;u<i.length;u++){const p=[];for(let m=0;m<i[u].length;m++){const _=Wg(i[u][m],r);zs(t,_),p.push(_)}s.push(p)}return s}function Vp(i,t,r){const s=[];for(let u=0;u<i.length;u++){const p=Kc(i[u],t,r);s.push(p)}return s}function jp(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const u=.5*s;let p=i[0]-r[0]>u?-s:r[0]-i[0]>u?s:0;p===0&&(p=i[0]-r[2]>u?-s:r[2]-i[0]>u?s:0),i[0]+=p}zs(t,i)}function Up(i,t,r,s){const u=Math.pow(2,s.z)*qn,p=[s.x*qn,s.y*qn],m=[];for(const _ of i)for(const x of _){const P=[x.x+p[0],x.y+p[1]];jp(P,t,r,u),m.push(P)}return m}function qp(i,t,r,s){const u=Math.pow(2,s.z)*qn,p=[s.x*qn,s.y*qn],m=[];for(const x of i){const P=[];for(const C of x){const k=[C.x+p[0],C.y+p[1]];zs(t,k),P.push(k)}m.push(P)}if(t[2]-t[0]<=u/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of m)for(const P of x)jp(P,t,r,u)}var _;return m}class Ds{constructor(t,r){this.type=Mt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const u=[];for(const p of s.features){const{type:m,coordinates:_}=p.geometry;m==="Polygon"&&u.push(_),m==="MultiPolygon"&&u.push(..._)}if(u.length)return new Ds(s,{type:"MultiPolygon",coordinates:u})}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ds(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Ds(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const _=Kc(s.coordinates,p,m),x=Up(r.geometry(),u,p,m);if(!cs(u,p))return!1;for(const P of x)if(!ao(P,_))return!1}if(s.type==="MultiPolygon"){const _=Vp(s.coordinates,p,m),x=Up(r.geometry(),u,p,m);if(!cs(u,p))return!1;for(const P of x)if(!Xg(P,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const _=Kc(s.coordinates,p,m),x=qp(r.geometry(),u,p,m);if(!cs(u,p))return!1;for(const P of x)if(!Bp(P,_))return!1}if(s.type==="MultiPolygon"){const _=Vp(s.coordinates,p,m),x=qp(r.geometry(),u,p,m);if(!cs(u,p))return!1;for(const P of x)if(!Kg(P,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Zp=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const u=i-1>>1,p=t[u];if(r(s,p)>=0)break;t[i]=p,i=u}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,u=t[i];for(;i<s;){let p=1+(i<<1);const m=p+1;if(m<this.length&&r(t[m],t[p])<0&&(p=m),r(t[p],u)>=0)break;t[i]=t[p],i=p}t[i]=u}};function Jg(i,t,r,s,u){Gp(i,t,r,s||i.length-1,u||Yg)}function Gp(i,t,r,s,u){for(;s>r;){if(s-r>600){var p=s-r+1,m=t-r+1,_=Math.log(p),x=.5*Math.exp(2*_/3),P=.5*Math.sqrt(_*x*(p-x)/p)*(m-p/2<0?-1:1);Gp(i,t,Math.max(r,Math.floor(t-m*x/p+P)),Math.min(s,Math.floor(t+(p-m)*x/p+P)),u)}var C=i[t],k=r,D=s;for(ua(i,r,t),u(i[s],C)>0&&ua(i,r,s);k<D;){for(ua(i,k,D),k++,D--;u(i[k],C)<0;)k++;for(;u(i[D],C)>0;)D--}u(i[r],C)===0?ua(i,r,D):ua(i,++D,s),D<=t&&(r=D+1),t<=D&&(s=D-1)}}function ua(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function Yg(i,t){return i<t?-1:i>t?1:0}function tl(i,t){if(i.length<=1)return[i];const r=[];let s,u;for(const p of i){const m=Qg(p);m!==0&&(p.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(s&&r.push(s),s=[p]):s.push(p))}if(s&&r.push(s),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(Jg(r[p],t,1,r[p].length-1,$g),r[p]=r[p].slice(0,t));return r}function $g(i,t){return t.area-i.area}function Qg(i){let t=0;for(let r,s,u=0,p=i.length,m=p-1;u<p;m=u++)r=i[u],s=i[m],t+=(s.x-r.x)*(r.y+s.y);return t}const Wp=1/298.257223563,Hp=Wp*(2-Wp),Xp=Math.PI/180;class Jc{constructor(t){const r=6378.137*Xp*1e3,s=Math.cos(t*Xp),u=1/(1-Hp*(1-s*s)),p=Math.sqrt(u);this.kx=r*p*s,this.ky=r*p*u*(1-Hp)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,u=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+u*u)}pointOnLine(t,r){let s,u,p,m,_=1/0;for(let x=0;x<t.length-1;x++){let P=t[x][0],C=t[x][1],k=this.wrap(t[x+1][0]-P)*this.kx,D=(t[x+1][1]-C)*this.ky,F=0;k===0&&D===0||(F=(this.wrap(r[0]-P)*this.kx*k+(r[1]-C)*this.ky*D)/(k*k+D*D),F>1?(P=t[x+1][0],C=t[x+1][1]):F>0&&(P+=k/this.kx*F,C+=D/this.ky*F)),k=this.wrap(r[0]-P)*this.kx,D=(r[1]-C)*this.ky;const N=k*k+D*D;N<_&&(_=N,s=P,u=C,p=x,m=F)}return{point:[s,u],index:p,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Kp(i,t){return t[0]-i[0]}function il(i){return i[1]-i[0]+1}function $n(i,t){return i[1]>=i[0]&&i[1]<t}function Yc(i,t){if(i[0]>i[1])return[null,null];const r=il(i);if(t){if(r===2)return[i,null];const u=Math.floor(r/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function $c(i,t){if(!$n(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)zs(r,i[s]);return r}function Qc(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)zs(t,s);return t}function rl(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function eu(i,t,r){if(!rl(i)||!rl(t))return NaN;let s=0,u=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),r.distance([0,0],[s,u])}function Rs(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function tu(i,t,r,s,u){const p=Math.min(Rs(i,[r,s],u),Rs(t,[r,s],u)),m=Math.min(Rs(r,[i,t],u),Rs(s,[i,t],u));return Math.min(p,m)}function e_(i,t,r,s,u){if(!$n(t,i.length)||!$n(s,r.length))return 1/0;let p=1/0;for(let m=t[0];m<t[1];++m){const _=i[m],x=i[m+1];for(let P=s[0];P<s[1];++P){const C=r[P],k=r[P+1];if(el(_,x,C,k))return 0;p=Math.min(p,tu(_,x,C,k,u))}}return p}function rr(i,t,r,s,u){if(!$n(t,i.length)||!$n(s,r.length))return NaN;let p=1/0;for(let m=t[0];m<=t[1];++m)for(let _=s[0];_<=s[1];++_)if(p=Math.min(p,u.distance(i[m],r[_])),p===0)return p;return p}function t_(i,t,r){if(ao(i,t,!0))return 0;let s=1/0;for(const u of t){const p=u[0],m=u[u.length-1];if(p!==m&&(s=Math.min(s,Rs(i,[m,p],r)),s===0))return s;const _=r.pointOnLine(u,i);if(s=Math.min(s,r.distance(i,_.point)),s===0)return s}return s}function Yt(i,t,r,s){if(!$n(t,i.length))return NaN;for(let p=t[0];p<=t[1];++p)if(ao(i[p],r,!0))return 0;let u=1/0;for(let p=t[0];p<t[1];++p){const m=i[p],_=i[p+1];for(const x of r)for(let P=0,C=x.length,k=C-1;P<C;k=P++){const D=x[k],F=x[P];if(el(m,_,D,F))return 0;u=Math.min(u,tu(m,_,D,F,s))}}return u}function nl(i,t){for(const r of i)for(const s of r)if(ao(s,t,!0))return!0;return!1}function Mi(i,t,r,s=1/0){const u=Qc(i),p=Qc(t);if(s!==1/0&&eu(u,p,r)>=s)return s;if(cs(u,p)){if(nl(i,t))return 0}else if(nl(t,i))return 0;let m=1/0;for(const _ of i)for(let x=0,P=_.length,C=P-1;x<P;C=x++){const k=_[C],D=_[x];for(const F of t)for(let N=0,q=F.length,Y=q-1;N<q;Y=N++){const ie=F[Y],xe=F[N];if(el(k,D,ie,xe))return 0;m=Math.min(m,tu(k,D,ie,xe,r))}}return m}function Ti(i,t,r,s,u,p){if(!p)return;const m=eu($c(s,p),u,r);m<t&&i.push([m,p,[0,0]])}function Ls(i,t,r,s,u,p,m){if(!p||!m)return;const _=eu($c(s,p),$c(u,m),r);_<t&&i.push([_,p,m])}function ha(i,t,r,s,u=1/0){let p=Math.min(s.distance(i[0],r[0][0]),u);if(p===0)return p;const m=new Zp([[0,[0,i.length-1],[0,0]]],Kp),_=Qc(r);for(;m.length>0;){const x=m.pop();if(x[0]>=p)continue;const P=x[1],C=t?50:100;if(il(P)<=C){if(!$n(P,i.length))return NaN;if(t){const k=Yt(i,P,r,s);if(isNaN(k)||k===0)return k;p=Math.min(p,k)}else for(let k=P[0];k<=P[1];++k){const D=t_(i[k],r,s);if(p=Math.min(p,D),p===0)return 0}}else{const k=Yc(P,t);Ti(m,p,s,i,_,k[0]),Ti(m,p,s,i,_,k[1])}}return p}function da(i,t,r,s,u,p=1/0){let m=Math.min(p,u.distance(i[0],r[0]));if(m===0)return m;const _=new Zp([[0,[0,i.length-1],[0,r.length-1]]],Kp);for(;_.length>0;){const x=_.pop();if(x[0]>=m)continue;const P=x[1],C=x[2],k=t?50:100,D=s?50:100;if(il(P)<=k&&il(C)<=D){if(!$n(P,i.length)&&$n(C,r.length))return NaN;let F;if(t&&s)F=e_(i,P,r,C,u),m=Math.min(m,F);else if(t&&!s){const N=i.slice(P[0],P[1]+1);for(let q=C[0];q<=C[1];++q)if(F=Rs(r[q],N,u),m=Math.min(m,F),m===0)return m}else if(!t&&s){const N=r.slice(C[0],C[1]+1);for(let q=P[0];q<=P[1];++q)if(F=Rs(i[q],N,u),m=Math.min(m,F),m===0)return m}else F=rr(i,P,r,C,u),m=Math.min(m,F)}else{const F=Yc(P,t),N=Yc(C,s);Ls(_,m,u,i,r,F[0],N[0]),Ls(_,m,u,i,r,F[0],N[1]),Ls(_,m,u,i,r,F[1],N[0]),Ls(_,m,u,i,r,F[1],N[1])}}return m}function iu(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Os{constructor(t,r){this.type=We,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new Os(s,s.features.map(u=>iu(u.geometry)).flat());if(s.type==="Feature")return new Os(s,iu(s.geometry));if("type"in s&&"coordinates"in s)return new Os(s,iu(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const u=r.geometry(),p=u.flat().map(x=>Xc([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new Jc(p[0][1]);let _=1/0;for(const x of s){switch(x.type){case"Point":_=Math.min(_,da(p,!1,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,da(p,!1,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,ha(p,!1,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const u=r.geometry(),p=u.flat().map(x=>Xc([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new Jc(p[0][1]);let _=1/0;for(const x of s){switch(x.type){case"Point":_=Math.min(_,da(p,!0,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,da(p,!0,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,ha(p,!0,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const p=tl(u,0).map(x=>x.map(P=>P.map(C=>Xc([C.x,C.y],r.canonical)))),m=new Jc(p[0][0][0][1]);let _=1/0;for(const x of s)for(const P of p){switch(x.type){case"Point":_=Math.min(_,ha([x.coordinates],!1,P,m,_));break;case"LineString":_=Math.min(_,ha(x.coordinates,!0,P,m,_));break;case"Polygon":_=Math.min(_,Mi(P,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const lo={"==":qg,"!=":Lp,">":Zg,"<":Op,">=":Fp,"<=":Gg,array:Cn,at:Uc,boolean:Cn,case:Xa,coalesce:Ya,collator:ca,format:Qa,image:Wc,in:qc,"index-of":no,interpolate:Jr,"interpolate-hcl":Jr,"interpolate-lab":Jr,length:Hc,let:ls,literal:In,match:Zc,number:Cn,"number-format":Gc,object:Cn,slice:aa,step:so,string:Cn,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:pi,within:Ds,distance:Os};class _n{constructor(t,r,s,u){this.name=t,this.type=r,this._evaluate=s,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],u=_n.definitions[s];if(!u)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=m.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let x=null;for(const[P,C]of _){x=new ks(r.registry,pa,r.path,null,r.scope);const k=[];let D=!1;for(let F=1;F<t.length;F++){const N=t[F],q=Array.isArray(P)?P[F-1]:P.type,Y=x.parse(N,1+k.length,q);if(!Y){D=!0;break}k.push(Y)}if(!D)if(Array.isArray(P)&&P.length!==k.length)x.error(`Expected ${P.length} arguments, but found ${k.length} instead.`);else{for(let F=0;F<k.length;F++){const N=Array.isArray(P)?P[F]:P.type,q=k[F];x.concat(F+1).checkSubtype(N,q.type)}if(x.errors.length===0)return new _n(s,p,C,k)}}if(_.length===1)r.errors.push(...x.errors);else{const P=(_.length?_:m).map(([k])=>{return D=k,Array.isArray(D)?`(${D.map(L).join(", ")})`:`(${L(D.type)}...)`;var D}).join(" | "),C=[];for(let k=1;k<t.length;k++){const D=r.parse(t[k],1+C.length);if(!D)return null;C.push(L(D.type))}r.error(`Expected arguments of type ${P}, but found (${C.join(", ")}) instead.`)}return null}static register(t,r){_n.definitions=r;for(const s in r)t[s]=_n}}function ru(i,[t,r,s,u]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const p=u?u.evaluate(i):1,m=ro(t,r,s,p);if(m)throw new lr(m);return new wi(t/255,r/255,s/255,p,!1)}function nu(i,t){return i in t}function su(i,t){const r=t[i];return r===void 0?null:r}function Fs(i){return{type:i}}function pa(i){if(i instanceof pi)return pa(i.boundExpression);if(i instanceof _n&&i.name==="error"||i instanceof ca||i instanceof Ds||i instanceof Os)return!1;const t=i instanceof An||i instanceof Cn;let r=!0;return i.eachChild(s=>{r=t?r&&pa(s):r&&s instanceof In}),!!r&&fa(i)&&ma(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fa(i){if(i instanceof _n&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ds||i instanceof Os)return!1;let t=!0;return i.eachChild(r=>{t&&!fa(r)&&(t=!1)}),t}function co(i){if(i instanceof _n&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!co(r)&&(t=!1)}),t}function ma(i,t){if(i instanceof _n&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!ma(s,t)&&(r=!1)}),r}function sl(i){return{result:"success",value:i}}function uo(i){return{result:"error",value:i}}function ho(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Jp(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ou(i){return!!i.expression&&i.expression.interpolated}function hi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ol(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function i_(i){return i}function Yp(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",u=s||!(s||i.property!==void 0),p=i.type||(ou(t)?"exponential":"interval");if(r||t.type==="padding"){const C=r?wi.parse:an.parse;(i=Ji({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],C(k[1])])),i.default=C(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let _,x,P;if(p==="exponential")_=Qp;else if(p==="interval")_=al;else if(p==="categorical"){_=$p,x=Object.create(null);for(const C of i.stops)x[C[0]]=C[1];P=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=ef}if(s){const C={},k=[];for(let N=0;N<i.stops.length;N++){const q=i.stops[N],Y=q[0].zoom;C[Y]===void 0&&(C[Y]={zoom:Y,type:i.type,property:i.property,default:i.default,stops:[]},k.push(Y)),C[Y].stops.push([q[0].value,q[1]])}const D=[];for(const N of k)D.push([C[N].zoom,Yp(C[N],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Jr.interpolationFactor.bind(void 0,F),zoomStops:D.map(N=>N[0]),evaluate:({zoom:N},q)=>Qp({stops:D,base:i.base},t,N).evaluate(N,q)}}if(u){const C=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Jr.interpolationFactor.bind(void 0,C),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>_(i,t,k,x,P)}}return{kind:"source",evaluate(C,k){const D=k&&k.properties?k.properties[i.property]:void 0;return D===void 0?po(i.default,t.default):_(i,t,D,x,P)}}}function po(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function $p(i,t,r,s,u){return po(typeof r===u?s[r]:void 0,i.default,t.default)}function al(i,t,r){if(hi(r)!=="number")return po(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const u=Ka(i.stops.map(p=>p[0]),r);return i.stops[u][1]}function Qp(i,t,r){const s=i.base!==void 0?i.base:1;if(hi(r)!=="number")return po(i.default,t.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const p=Ka(i.stops.map(C=>C[0]),r),m=function(C,k,D,F){const N=F-D,q=C-D;return N===0?0:k===1?q/N:(Math.pow(k,q)-1)/(Math.pow(k,N)-1)}(r,s,i.stops[p][0],i.stops[p+1][0]),_=i.stops[p][1],x=i.stops[p+1][1],P=Kr[t.type]||i_;return typeof _.evaluate=="function"?{evaluate(...C){const k=_.evaluate.apply(void 0,C),D=x.evaluate.apply(void 0,C);if(k!==void 0&&D!==void 0)return P(k,D,m,i.colorSpace)}}:P(_,x,m,i.colorSpace)}function ef(i,t,r){switch(t.type){case"color":r=wi.parse(r);break;case"formatted":r=on.fromString(r.toString());break;case"resolvedImage":r=ln.fromString(r.toString());break;case"padding":r=an.parse(r);break;default:hi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return po(r,i.default,t.default)}_n.register(lo,{error:[{kind:"error"},[Bt],(i,[t])=>{throw new lr(t.evaluate(i))}],typeof:[Bt,[Ut],(i,[t])=>L(fr(t.evaluate(i)))],"to-rgba":[O(We,4),[dr],(i,[t])=>{const[r,s,u,p]=t.evaluate(i).rgb;return[255*r,255*s,255*u,p]}],rgb:[dr,[We,We,We],ru],rgba:[dr,[We,We,We,We],ru],has:{type:Mt,overloads:[[[Bt],(i,[t])=>nu(t.evaluate(i),i.properties())],[[Bt,Xr],(i,[t,r])=>nu(t.evaluate(i),r.evaluate(i))]]},get:{type:Ut,overloads:[[[Bt],(i,[t])=>su(t.evaluate(i),i.properties())],[[Bt,Xr],(i,[t,r])=>su(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ut,[Bt],(i,[t])=>su(t.evaluate(i),i.featureState||{})],properties:[Xr,[],i=>i.properties()],"geometry-type":[Bt,[],i=>i.geometryType()],id:[Ut,[],i=>i.id()],zoom:[We,[],i=>i.globals.zoom],"heatmap-density":[We,[],i=>i.globals.heatmapDensity||0],"line-progress":[We,[],i=>i.globals.lineProgress||0],accumulated:[Ut,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[We,Fs(We),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[We,Fs(We),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:We,overloads:[[[We,We],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[We],(i,[t])=>-t.evaluate(i)]]},"/":[We,[We,We],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[We,[We,We],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[We,[We],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[We,[We],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[We,[We],(i,[t])=>Math.log(t.evaluate(i))],log2:[We,[We],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[We,[We],(i,[t])=>Math.sin(t.evaluate(i))],cos:[We,[We],(i,[t])=>Math.cos(t.evaluate(i))],tan:[We,[We],(i,[t])=>Math.tan(t.evaluate(i))],asin:[We,[We],(i,[t])=>Math.asin(t.evaluate(i))],acos:[We,[We],(i,[t])=>Math.acos(t.evaluate(i))],atan:[We,[We],(i,[t])=>Math.atan(t.evaluate(i))],min:[We,Fs(We),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[We,Fs(We),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[We,[We],(i,[t])=>Math.abs(t.evaluate(i))],round:[We,[We],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[We,[We],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[We,[We],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Mt,[Bt,Ut],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Mt,[Ut],(i,[t])=>i.id()===t.value],"filter-type-==":[Mt,[Bt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Mt,[Bt,Ut],(i,[t,r])=>{const s=i.properties()[t.value],u=r.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Mt,[Ut],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Mt,[Bt,Ut],(i,[t,r])=>{const s=i.properties()[t.value],u=r.value;return typeof s==typeof u&&s>u}],"filter-id->":[Mt,[Ut],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Mt,[Bt,Ut],(i,[t,r])=>{const s=i.properties()[t.value],u=r.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Mt,[Ut],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Mt,[Bt,Ut],(i,[t,r])=>{const s=i.properties()[t.value],u=r.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Mt,[Ut],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Mt,[Ut],(i,[t])=>t.value in i.properties()],"filter-has-id":[Mt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Mt,[O(Bt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Mt,[O(Ut)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Mt,[Bt,O(Ut)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Mt,[Bt,O(Ut)],(i,[t,r])=>function(s,u,p,m){for(;p<=m;){const _=p+m>>1;if(u[_]===s)return!0;u[_]>s?m=_-1:p=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Fs(Mt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Fs(Mt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Mt,[Mt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Mt,[Bt],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Bt,[Bt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Bt,[Bt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Bt,Fs(Ut),(i,t)=>t.map(r=>oa(r.evaluate(i))).join("")],"resolved-locale":[Bt,[mn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class ll{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new Ha,this._defaultValue=r?(s=r).type==="color"&&ol(s.default)?new wi(0,0,0,0):s.type==="color"?wi.parse(s.default)||null:s.type==="padding"?an.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?gn.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,u,p,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,u,p,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new lr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function cl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in lo}function fo(i,t){const r=new ks(lo,pa,[],t?function(u){const p={color:dr,string:Bt,number:We,enum:Bt,boolean:Mt,formatted:Yn,padding:as,resolvedImage:Un,variableAnchorOffsetCollection:te};return u.type==="array"?O(p[u.value]||Ut,u.length):p[u.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?sl(new ll(s,t)):uo(r.errors)}class mo{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!co(r.expression)}evaluateWithoutErrorHandling(t,r,s,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,u,p,m)}evaluate(t,r,s,u,p,m){return this._styleExpression.evaluate(t,r,s,u,p,m)}}class go{constructor(t,r,s,u){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!co(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,r,s,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,u,p,m)}evaluate(t,r,s,u,p,m){return this._styleExpression.evaluate(t,r,s,u,p,m)}interpolationFactor(t,r,s){return this.interpolationType?Jr.interpolationFactor(this.interpolationType,t,r,s):0}}function au(i,t){const r=fo(i,t);if(r.result==="error")return r;const s=r.value.expression,u=fa(s);if(!u&&!ho(t))return uo([new Wi("","data expressions not supported")]);const p=ma(s,["zoom"]);if(!p&&!Jp(t))return uo([new Wi("","zoom expressions not supported")]);const m=ga(s);return m||p?m instanceof Wi?uo([m]):m instanceof Jr&&!ou(t)?uo([new Wi("",'"interpolate" expressions cannot be used with this property')]):sl(m?new go(u?"camera":"composite",r.value,m.labels,m instanceof Jr?m.interpolation:void 0):new mo(u?"constant":"source",r.value)):uo([new Wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _o{constructor(t,r){this._parameters=t,this._specification=r,Ji(this,Yp(this._parameters,this._specification))}static deserialize(t){return new _o(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ga(i){let t=null;if(i instanceof ls)t=ga(i.result);else if(i instanceof Ya){for(const r of i.args)if(t=ga(r),t)break}else(i instanceof so||i instanceof Jr)&&i.input instanceof _n&&i.input.name==="zoom"&&(t=i);return t instanceof Wi||i.eachChild(r=>{const s=ga(r);s instanceof Wi?t=s:!t&&s?t=new Wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new Wi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ul(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ul(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const hl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function lu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ul(i)||(i=dl(i));const t=fo(i,hl);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,u)=>t.value.evaluate(r,s,{},u),needGeometry:tf(i)}}function r_(i,t){return i<t?-1:i>t?1:0}function tf(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(tf(i[t]))return!0;return!1}function dl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?cu(i[1],i[2],"=="):t==="!="?Mr(cu(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?cu(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(dl))):t==="all"?["all"].concat(i.slice(1).map(dl)):t==="none"?["all"].concat(i.slice(1).map(dl).map(Mr)):t==="in"?_a(i[1],i.slice(2)):t==="!in"?Mr(_a(i[1],i.slice(2))):t==="has"?ya(i[1]):t!=="!has"||Mr(ya(i[1]));var r}function cu(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function _a(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(r_)]]:["filter-in-small",i,["literal",t]]}}function ya(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Mr(i){return["!",i]}function Bs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const p of i)u+=`${Bs(p)},`;return`${u}]`}const r=Object.keys(i).sort();let s="{";for(let u=0;u<r.length;u++)s+=`${JSON.stringify(r[u])}:${Bs(i[r[u]])},`;return`${s}}`}function rf(i){let t="";for(const r of Ri)t+=`/${Bs(i[r])}`;return t}function nf(i){const t=i.value;return t?[new Ve(i.key,t,"constants have been deprecated as of v8")]:[]}function nr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function En(i){if(Array.isArray(i))return i.map(En);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=En(i[r]);return t}return nr(i)}function cn(i){const t=i.key,r=i.value,s=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,m=i.styleSpec,_=i.validateSpec;let x=[];const P=hi(r);if(P!=="object")return[new Ve(t,r,`object expected, ${P} found`)];for(const C in r){const k=C.split(".")[0],D=s[k]||s["*"];let F;if(u[k])F=u[k];else if(s[k])F=_;else if(u["*"])F=u["*"];else{if(!s["*"]){x.push(new Ve(t,r[C],`unknown property "${C}"`));continue}F=_}x=x.concat(F({key:(t&&`${t}.`)+C,value:r[C],valueSpec:D,style:p,styleSpec:m,object:r,objectKey:C,validateSpec:_},r))}for(const C in s)u[C]||s[C].required&&s[C].default===void 0&&r[C]===void 0&&x.push(new Ve(t,r,`missing required property "${C}"`));return x}function va(i){const t=i.value,r=i.valueSpec,s=i.style,u=i.styleSpec,p=i.key,m=i.arrayElementValidator||i.validateSpec;if(hi(t)!=="array")return[new Ve(p,t,`array expected, ${hi(t)} found`)];if(r.length&&t.length!==r.length)return[new Ve(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Ve(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),hi(r.value)==="object"&&(_=r.value);let x=[];for(let P=0;P<t.length;P++)x=x.concat(m({array:t,arrayIndex:P,value:t[P],valueSpec:_,validateSpec:i.validateSpec,style:s,styleSpec:u,key:`${p}[${P}]`}));return x}function uu(i){const t=i.key,r=i.value,s=i.valueSpec;let u=hi(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Ve(t,r,`number expected, ${u} found`)]:"minimum"in s&&r<s.minimum?[new Ve(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new Ve(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function pl(i){const t=i.valueSpec,r=nr(i.value.type);let s,u,p,m={};const _=r!=="categorical"&&i.value.property===void 0,x=!_,P=hi(i.value.stops)==="array"&&hi(i.value.stops[0])==="array"&&hi(i.value.stops[0][0])==="object",C=cn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Ve(F.key,F.value,'identity function may not have a "stops" property')];let N=[];const q=F.value;return N=N.concat(va({key:F.key,value:q,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),hi(q)==="array"&&q.length===0&&N.push(new Ve(F.key,q,"array must have at least one stop")),N},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&_&&C.push(new Ve(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||C.push(new Ve(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ou(i.valueSpec)&&C.push(new Ve(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!ho(i.valueSpec)?C.push(new Ve(i.key,i.value,"property functions not supported")):_&&!Jp(i.valueSpec)&&C.push(new Ve(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!P||i.value.property!==void 0||C.push(new Ve(i.key,i.value,'"property" property is required')),C;function k(F){let N=[];const q=F.value,Y=F.key;if(hi(q)!=="array")return[new Ve(Y,q,`array expected, ${hi(q)} found`)];if(q.length!==2)return[new Ve(Y,q,`array length 2 expected, length ${q.length} found`)];if(P){if(hi(q[0])!=="object")return[new Ve(Y,q,`object expected, ${hi(q[0])} found`)];if(q[0].zoom===void 0)return[new Ve(Y,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Ve(Y,q,"object stop key must have value")];if(p&&p>nr(q[0].zoom))return[new Ve(Y,q[0].zoom,"stop zoom values must appear in ascending order")];nr(q[0].zoom)!==p&&(p=nr(q[0].zoom),u=void 0,m={}),N=N.concat(cn({key:`${Y}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:uu,value:D}}))}else N=N.concat(D({key:`${Y}[0]`,value:q[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},q));return cl(En(q[1]))?N.concat([new Ve(`${Y}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat(F.validateSpec({key:`${Y}[1]`,value:q[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,N){const q=hi(F.value),Y=nr(F.value),ie=F.value!==null?F.value:N;if(s){if(q!==s)return[new Ve(F.key,ie,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Ve(F.key,ie,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let xe=`number expected, ${q} found`;return ho(t)&&r===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(F.key,ie,xe)]}return r!=="categorical"||q!=="number"||isFinite(Y)&&Math.floor(Y)===Y?r!=="categorical"&&q==="number"&&u!==void 0&&Y<u?[new Ve(F.key,ie,"stop domain values must appear in ascending order")]:(u=Y,r==="categorical"&&Y in m?[new Ve(F.key,ie,"stop domain values must be unique")]:(m[Y]=!0,[])):[new Ve(F.key,ie,`integer expected, found ${Y}`)]}}function yo(i){const t=(i.expressionContext==="property"?au:fo)(En(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new Ve(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ve(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!co(r))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!co(r))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ma(r,["zoom","feature-state"]))return[new Ve(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!fa(r))return[new Ve(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qn(i){const t=i.key,r=i.value,s=i.valueSpec,u=[];return Array.isArray(s.values)?s.values.indexOf(nr(r))===-1&&u.push(new Ve(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(nr(r))===-1&&u.push(new Ve(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function hu(i){return ul(En(i.value))?yo(Ji({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):fl(i)}function fl(i){const t=i.value,r=i.key;if(hi(t)!=="array")return[new Ve(r,t,`array expected, ${hi(t)} found`)];const s=i.styleSpec;let u,p=[];if(t.length<1)return[new Ve(r,t,"filter array must have at least 1 element")];switch(p=p.concat(Qn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),nr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&nr(t[1])==="$type"&&p.push(new Ve(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Ve(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=hi(t[1]),u!=="string"&&p.push(new Ve(`${r}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=hi(t[m]),nr(t[1])==="$type"?p=p.concat(Qn({key:`${r}[${m}]`,value:t[m],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Ve(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)p=p.concat(fl({key:`${r}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=hi(t[1]),t.length!==2?p.push(new Ve(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Ve(`${r}[1]`,t[1],`string expected, ${u} found`))}return p}function du(i,t){const r=i.key,s=i.validateSpec,u=i.style,p=i.styleSpec,m=i.value,_=i.objectKey,x=p[`${t}_${i.layerType}`];if(!x)return[];const P=_.match(/^(.*)-transition$/);if(t==="paint"&&P&&x[P[1]]&&x[P[1]].transition)return s({key:r,value:m,valueSpec:p.transition,style:u,styleSpec:p});const C=i.valueSpec||x[_];if(!C)return[new Ve(r,m,`unknown property "${_}"`)];let k;if(hi(m)==="string"&&ho(C)&&!C.tokens&&(k=/^{([^}]+)}$/.exec(m)))return[new Ve(r,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&D.push(new Ve(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&ol(En(m))&&nr(m.type)==="identity"&&D.push(new Ve(r,m,'"text-font" does not support identity functions'))),D.concat(s({key:i.key,value:m,valueSpec:C,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:_}))}function ml(i){return du(i,"paint")}function pu(i){return du(i,"layout")}function fu(i){let t=[];const r=i.value,s=i.key,u=i.style,p=i.styleSpec;r.type||r.ref||t.push(new Ve(s,r,'either "type" or "ref" is required'));let m=nr(r.type);const _=nr(r.ref);if(r.id){const x=nr(r.id);for(let P=0;P<i.arrayIndex;P++){const C=u.layers[P];nr(C.id)===x&&t.push(new Ve(s,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new Ve(s,r[P],`"${P}" is prohibited for ref layers`))}),u.layers.forEach(P=>{nr(P.id)===_&&(x=P)}),x?x.ref?t.push(new Ve(s,r.ref,"ref cannot reference another ref layer")):m=nr(x.type):t.push(new Ve(s,r.ref,`ref layer "${_}" not found`))}else if(m!=="background")if(r.source){const x=u.sources&&u.sources[r.source],P=x&&nr(x.type);x?P==="vector"&&m==="raster"?t.push(new Ve(s,r.source,`layer "${r.id}" requires a raster source`)):P!=="raster-dem"&&m==="hillshade"?t.push(new Ve(s,r.source,`layer "${r.id}" requires a raster-dem source`)):P==="raster"&&m!=="raster"?t.push(new Ve(s,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&m!=="hillshade"?t.push(new Ve(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||P==="geojson"&&x.lineMetrics||t.push(new Ve(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ve(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Ve(s,r.source,`source "${r.source}" not found`))}else t.push(new Ve(s,r,'missing required property "source"'));return t=t.concat(cn({key:s,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:hu,layout:x=>cn({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>pu(Ji({layerType:m},P))}}),paint:x=>cn({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>ml(Ji({layerType:m},P))}})}})),t}function Ns(i){const t=i.value,r=i.key,s=hi(t);return s!=="string"?[new Ve(r,t,`string expected, ${s} found`)]:[]}const gl={promoteId:function({key:i,value:t}){if(hi(t)==="string")return Ns({key:i,value:t});{const r=[];for(const s in t)r.push(...Ns({key:`${i}.${s}`,value:t[s]}));return r}}};function xa(i){const t=i.value,r=i.key,s=i.styleSpec,u=i.style,p=i.validateSpec;if(!t.type)return[new Ve(r,t,'"type" is required')];const m=nr(t.type);let _;switch(m){case"vector":case"raster":return _=cn({key:r,value:t,valueSpec:s[`source_${m.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:gl,validateSpec:p}),_;case"raster-dem":return _=function(x){var P;const C=(P=x.sourceName)!==null&&P!==void 0?P:"",k=x.value,D=x.styleSpec,F=D.source_raster_dem,N=x.style;let q=[];const Y=hi(k);if(k===void 0)return q;if(Y!=="object")return q.push(new Ve("source_raster_dem",k,`object expected, ${Y} found`)),q;const ie=nr(k.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],ue=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ge in k)!ie&&xe.includes(ge)?q.push(new Ve(ge,k[ge],`In "${C}": "${ge}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):F[ge]?q=q.concat(x.validateSpec({key:ge,value:k[ge],valueSpec:F[ge],validateSpec:x.validateSpec,style:N,styleSpec:D})):q.push(new Ve(ge,k[ge],`unknown property "${ge}"`));return q}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:p}),_;case"geojson":if(_=cn({key:r,value:t,valueSpec:s.source_geojson,style:u,styleSpec:s,validateSpec:p,objectElementValidators:gl}),t.cluster)for(const x in t.clusterProperties){const[P,C]=t.clusterProperties[x],k=typeof P=="string"?[P,["accumulated"],["get",x]]:P;_.push(...yo({key:`${r}.${x}.map`,value:C,validateSpec:p,expressionContext:"cluster-map"})),_.push(...yo({key:`${r}.${x}.reduce`,value:k,validateSpec:p,expressionContext:"cluster-reduce"}))}return _;case"video":return cn({key:r,value:t,valueSpec:s.source_video,style:u,validateSpec:p,styleSpec:s});case"image":return cn({key:r,value:t,valueSpec:s.source_image,style:u,validateSpec:p,styleSpec:s});case"canvas":return[new Ve(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:p,styleSpec:s})}}function mu(i){const t=i.value,r=i.styleSpec,s=r.light,u=i.style;let p=[];const m=hi(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Ve("light",t,`object expected, ${m} found`)]),p;for(const _ in t){const x=_.match(/^(.*)-transition$/);p=p.concat(x&&s[x[1]]&&s[x[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ve(_,t[_],`unknown property "${_}"`)])}return p}function gu(i){const t=i.value,r=i.styleSpec,s=r.sky,u=i.style,p=hi(t);if(t===void 0)return[];if(p!=="object")return[new Ve("sky",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:u,styleSpec:r}):[new Ve(_,t[_],`unknown property "${_}"`)]);return m}function _u(i){const t=i.value,r=i.styleSpec,s=r.terrain,u=i.style;let p=[];const m=hi(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Ve("terrain",t,`object expected, ${m} found`)]),p;for(const _ in t)p=p.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ve(_,t[_],`unknown property "${_}"`)]);return p}function yu(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const u=[],p=[];for(const m in r)r[m].id&&u.includes(r[m].id)&&t.push(new Ve(s,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),u.push(r[m].id),r[m].url&&p.includes(r[m].url)&&t.push(new Ve(s,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),p.push(r[m].url),t=t.concat(cn({key:`${s}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ns({key:s,value:r})}const _l={"*":()=>[],array:va,boolean:function(i){const t=i.value,r=i.key,s=hi(t);return s!=="boolean"?[new Ve(r,t,`boolean expected, ${s} found`)]:[]},number:uu,color:function(i){const t=i.key,r=i.value,s=hi(r);return s!=="string"?[new Ve(t,r,`color expected, ${s} found`)]:wi.parse(String(r))?[]:[new Ve(t,r,`color expected, "${r}" found`)]},constants:nf,enum:Qn,filter:hu,function:pl,layer:fu,object:cn,source:xa,light:mu,sky:gu,terrain:_u,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,u=i.style,p=hi(t);if(t===void 0)return[];if(p!=="object")return[new Ve("projection",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:u,styleSpec:r}):[new Ve(_,t[_],`unknown property "${_}"`)]);return m},string:Ns,formatted:function(i){return Ns(i).length===0?[]:yo(i)},resolvedImage:function(i){return Ns(i).length===0?[]:yo(i)},padding:function(i){const t=i.key,r=i.value;if(hi(r)==="array"){if(r.length<1||r.length>4)return[new Ve(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let u=[];for(let p=0;p<r.length;p++)u=u.concat(i.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:s}));return u}return uu({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=hi(r),u=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new Ve(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let m=0;m<r.length;m+=2)p=p.concat(Qn({key:`${t}[${m}]`,value:r[m],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(va({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return p},sprite:yu};function vo(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=vo,r.expression&&ol(nr(t))?pl(i):r.expression&&cl(En(t))?yo(i):r.type&&_l[r.type]?_l[r.type](i):cn(Ji({},i,{valueSpec:r.type?s[r.type]:r}))}function sf(i){const t=i.value,r=i.key,s=Ns(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new Ve(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new Ve(r,t,'"glyphs" url must include a "{range}" token'))),s}function yn(i,t=ye){let r=[];return r=r.concat(vo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:vo,objectElementValidators:{glyphs:sf,"*":()=>[]}})),i.constants&&(r=r.concat(nf({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:vo}))),vu(r)}function Zn(i){return function(t){return i({...t,validateSpec:vo})}}function vu(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function kn(i){return function(...t){return vu(i.apply(this,t))}}yn.source=kn(Zn(xa)),yn.sprite=kn(Zn(yu)),yn.glyphs=kn(Zn(sf)),yn.light=kn(Zn(mu)),yn.sky=kn(Zn(gu)),yn.terrain=kn(Zn(_u)),yn.layer=kn(Zn(fu)),yn.filter=kn(Zn(hu)),yn.paintProperty=kn(Zn(ml)),yn.layoutProperty=kn(Zn(pu));const Vs=yn,n_=Vs.light,s_=Vs.sky,of=Vs.paintProperty,af=Vs.layoutProperty;function xu(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new mt(new Error(s.message))),r=!0;return r}class xo{constructor(t,r,s){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(s=m[2]);for(let x=0;x<this.d*this.d;x++){const P=m[3+x],C=m[3+x+1];u.push(P===C?null:m.subarray(P,C))}const _=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const p=s/r*t;this.min=-p,this.max=t+p}insert(t,r,s,u,p){this._forEachCell(r,s,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,u,p,m){this.cells[p].push(m)}query(t,r,s,u,p){const m=this.min,_=this.max;if(t<=m&&r<=m&&_<=s&&_<=u&&!p)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,r,s,u,this._queryCell,x,{},p),x}}_queryCell(t,r,s,u,p,m,_,x){const P=this.cells[p];if(P!==null){const C=this.keys,k=this.bboxes;for(let D=0;D<P.length;D++){const F=P[D];if(_[F]===void 0){const N=4*F;(x?x(k[N+0],k[N+1],k[N+2],k[N+3]):t<=k[N+2]&&r<=k[N+3]&&s>=k[N+0]&&u>=k[N+1])?(_[F]=!0,m.push(C[F])):_[F]=!1}}}}_forEachCell(t,r,s,u,p,m,_,x){const P=this._convertToCellCoord(t),C=this._convertToCellCoord(r),k=this._convertToCellCoord(s),D=this._convertToCellCoord(u);for(let F=P;F<=k;F++)for(let N=C;N<=D;N++){const q=this.d*N+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(N),this._convertFromCellCoord(F+1),this._convertFromCellCoord(N+1)))&&p.call(this,t,r,s,u,q,m,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let m=0;m<this.cells.length;m++)s+=this.cells[m].length;const u=new Int32Array(r+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=r;for(let m=0;m<t.length;m++){const _=t[m];u[3+m]=p,u.set(_,p),p+=_.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new xo(t.buffer)}}const vn={};function gt(i,t,r={}){if(vn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),vn[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}gt("Object",Object),gt("TransferableGridIndex",xo),gt("Color",wi),gt("Error",Error),gt("AJAXError",yi),gt("ResolvedImage",ln),gt("StylePropertyFunction",_o),gt("StyleExpression",ll,{omit:["_evaluator"]}),gt("ZoomDependentExpression",go),gt("ZoomConstantExpression",mo),gt("CompoundExpression",_n,{omit:["_evaluate"]});for(const i in lo)lo[i]._classRegistryKey||gt(`Expression_${i}`,lo[i]);function yl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function bu(i){return i.$name||i.constructor._classRegistryKey}function lf(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=bu(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||yl(i)||pt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function bo(i,t){if(lf(i))return(yl(i)||pt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const m of i)p.push(bo(m,t));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=bu(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!vn[r])throw new Error(`${r} is not registered.`);const{klass:s}=vn[r],u=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||vn[r].omit.indexOf(p)>=0)continue;const m=i[p];u[p]=vn[r].shallow.indexOf(p)>=0?m:bo(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function wo(i){if(lf(i))return i;if(Array.isArray(i))return i.map(wo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=bu(i)||"Object";if(!vn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=vn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];s[u]=vn[t].shallow.indexOf(u)>=0?p:wo(p)}return s}class wu{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const si={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Su(i){for(const t of i)if(Tu(t.charCodeAt(0)))return!0;return!1}function o_(i){for(const t of i)if(!So(t.charCodeAt(0)))return!1;return!0}function Pu(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const a_=Pu(["Arab","Dupl","Mong","Ougr","Syrc"]);function So(i){return!a_.test(String.fromCodePoint(i))}const cf=Pu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Tu(i){return!(i!==746&&i!==747&&(i<4352||!(si["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||si["CJK Compatibility"](i)||si["CJK Strokes"](i)||!(!si["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||si["Enclosed CJK Letters and Months"](i)||si["Ideographic Description Characters"](i)||si.Kanbun(i)||si.Katakana(i)&&i!==12540||!(!si["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!si["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||si["Vertical Forms"](i)||si["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||cf.test(String.fromCodePoint(i)))))}function uf(i){return!(Tu(i)||function(t){return!!(si["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||si["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||si["Letterlike Symbols"](t)||si["Number Forms"](t)||si["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||si["Control Pictures"](t)&&t!==9251||si["Optical Character Recognition"](t)||si["Enclosed Alphanumerics"](t)||si["Geometric Shapes"](t)||si["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||si["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||si["CJK Symbols and Punctuation"](t)||si.Katakana(t)||si["Private Use Area"](t)||si["CJK Compatibility Forms"](t)||si["Small Form Variants"](t)||si["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const l_=Pu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Iu(i){return l_.test(String.fromCodePoint(i))}function c_(i,t){return!(!t&&Iu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||si.Khmer(i))}function u_(i){for(const t of i)if(Iu(t.charCodeAt(0)))return!0;return!1}const un=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Li{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wu,this.transition={})}isSupportedScript(t){return function(r,s){for(const u of r)if(!c_(u.charCodeAt(0),s))return!1;return!0}(t,un.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Po{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,u){if(ol(s))return new _o(s,u);if(cl(s)){const p=au(s,u);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=s;return u.type==="color"&&typeof s=="string"?p=wi.parse(s):u.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(p=gn.parse(s)):p=an.parse(s),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class vl{constructor(t){this.property=t,this.value=new Po(t,void 0)}transitioned(t,r){return new hf(this.property,this.value,r,it({},t.transition,this.transition),t.now)}untransitioned(){return new hf(this.property,this.value,null,{},0)}}class xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return dt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new vl(this._values[t].property)),this._values[t].value=new Po(this._values[t].property,r===null?void 0:dt(r))}getTransition(t){return dt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new vl(this._values[t].property)),this._values[t].transition=dt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const u=this.getTransition(r);u!==void 0&&(t[`${r}-transition`]=u)}return t}transitioned(t,r){const s=new ba(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(t,r._values[u]);return s}untransitioned(){const t=new ba(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class hf{constructor(t,r,s,u,p){this.property=t,this.value=r,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const u=t.now||0,p=this.value.possiblyEvaluate(t,r,s),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(t,r,s);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,s),p,function(x){if(x<=0)return 0;if(x>=1)return 1;const P=x*x,C=P*x;return 4*(x<.5?C:3*(x-P)+C-.75)}(_))}}return p}}class ba{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const u=new Sa(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,r,s);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class wa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return dt(this._values[t].value)}setValue(t,r){this._values[t]=new Po(this._values[t].property,r===null?void 0:dt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const u=new Sa(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,r,s);return u}}class Gn{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,u){return this.property.evaluate(this.value,this.parameters,t,r,s,u)}}class Sa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class vt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const u=Kr[this.specification.type];return u?u(t,r,s):t}}class Lt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,u){return new Gn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,u)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Gn(this,{kind:"constant",value:void 0},t.parameters);const u=Kr[this.specification.type];if(u){const p=u(t.value.value,r.value.value,s);return new Gn(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,s,u,p,m){return t.kind==="constant"?t.value:t.evaluate(r,s,u,p,m)}}class bl extends Lt{possiblyEvaluate(t,r,s,u){if(t.value===void 0)return new Gn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},s,u),m=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,_=this._calculate(m,m,m,r);return new Gn(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Gn(this,{kind:"constant",value:p},r)}return new Gn(this,t.expression,r)}evaluate(t,r,s,u,p,m){if(t.kind==="source"){const _=t.evaluate(r,s,u,p,m);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,u),t.evaluate({zoom:Math.floor(r.zoom)},s,u),t.evaluate({zoom:Math.floor(r.zoom)+1},s,u),r):t.value}_calculate(t,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class wl{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},s,u);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new Li(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Li(Math.floor(r.zoom),r)),t.expression.evaluate(new Li(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Cu{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,u){return!!t.expression.evaluate(r,null,{},s,u)}interpolate(){return!1}}class d{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Po(s,void 0),p=this.defaultTransitionablePropertyValues[r]=new vl(s);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}gt("DataDrivenProperty",Lt),gt("DataConstantProperty",vt),gt("CrossFadedDataDrivenProperty",bl),gt("CrossFadedProperty",wl),gt("ColorRampProperty",Cu);const e="-transition";class n extends kt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new wa(r.layout)),r.paint)){this._transitionablePaint=new xl(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(af,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(of,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),St(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,u,p={}){return(!p||p.validate!==!1)&&xu(this,t.call(Vs,{key:r,layerType:this.type,objectKey:s,value:u,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Gn&&ho(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function y(i,t=1){let r=0,s=0;return{members:i.map(u=>{const p=a[u.type].BYTES_PER_ELEMENT,m=r=b(r,Math.max(t,p)),_=u.components||1;return s=Math.max(s,p),r+=p*_,{name:u.name,type:u.type,components:_,offset:m}}),size:b(r,Math.max(s,t)),alignment:t}}function b(i,t){return Math.ceil(i/t)*t}class S extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const u=2*t;return this.int16[u+0]=r,this.int16[u+1]=s,t}}S.prototype.bytesPerElement=4,gt("StructArrayLayout2i4",S);class A extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s)}emplace(t,r,s,u){const p=3*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=u,t}}A.prototype.bytesPerElement=6,gt("StructArrayLayout3i6",A);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,u)}emplace(t,r,s,u,p){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=u,this.int16[m+3]=p,t}}M.prototype.bytesPerElement=8,gt("StructArrayLayout4i8",M);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,u,p,m)}emplace(t,r,s,u,p,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=s,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=m,this.int16[x+5]=_,t}}z.prototype.bytesPerElement=12,gt("StructArrayLayout2i4i12",z);class B extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,u,p,m)}emplace(t,r,s,u,p,m,_){const x=4*t,P=8*t;return this.int16[x+0]=r,this.int16[x+1]=s,this.uint8[P+4]=u,this.uint8[P+5]=p,this.uint8[P+6]=m,this.uint8[P+7]=_,t}}B.prototype.bytesPerElement=8,gt("StructArrayLayout2i4ub8",B);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const u=2*t;return this.float32[u+0]=r,this.float32[u+1]=s,t}}Z.prototype.bytesPerElement=8,gt("StructArrayLayout2f8",Z);class H extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m,_,x,P,C){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,s,u,p,m,_,x,P,C)}emplace(t,r,s,u,p,m,_,x,P,C,k){const D=10*t;return this.uint16[D+0]=r,this.uint16[D+1]=s,this.uint16[D+2]=u,this.uint16[D+3]=p,this.uint16[D+4]=m,this.uint16[D+5]=_,this.uint16[D+6]=x,this.uint16[D+7]=P,this.uint16[D+8]=C,this.uint16[D+9]=k,t}}H.prototype.bytesPerElement=20,gt("StructArrayLayout10ui20",H);class Q extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m,_,x,P,C,k,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,s,u,p,m,_,x,P,C,k,D)}emplace(t,r,s,u,p,m,_,x,P,C,k,D,F){const N=12*t;return this.int16[N+0]=r,this.int16[N+1]=s,this.int16[N+2]=u,this.int16[N+3]=p,this.uint16[N+4]=m,this.uint16[N+5]=_,this.uint16[N+6]=x,this.uint16[N+7]=P,this.int16[N+8]=C,this.int16[N+9]=k,this.int16[N+10]=D,this.int16[N+11]=F,t}}Q.prototype.bytesPerElement=24,gt("StructArrayLayout4i4ui4i24",Q);class re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s)}emplace(t,r,s,u){const p=3*t;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=u,t}}re.prototype.bytesPerElement=12,gt("StructArrayLayout3f12",re);class se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}se.prototype.bytesPerElement=4,gt("StructArrayLayout1ul4",se);class le extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m,_,x,P){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,s,u,p,m,_,x,P)}emplace(t,r,s,u,p,m,_,x,P,C){const k=10*t,D=5*t;return this.int16[k+0]=r,this.int16[k+1]=s,this.int16[k+2]=u,this.int16[k+3]=p,this.int16[k+4]=m,this.int16[k+5]=_,this.uint32[D+3]=x,this.uint16[k+8]=P,this.uint16[k+9]=C,t}}le.prototype.bytesPerElement=20,gt("StructArrayLayout6i1ul2ui20",le);class J extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,u,p,m)}emplace(t,r,s,u,p,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=s,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=m,this.int16[x+5]=_,t}}J.prototype.bytesPerElement=12,gt("StructArrayLayout2i2i2i12",J);class de extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,u,p)}emplace(t,r,s,u,p,m){const _=4*t,x=8*t;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=u,this.int16[x+6]=p,this.int16[x+7]=m,t}}de.prototype.bytesPerElement=16,gt("StructArrayLayout2f1f2i16",de);class me extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,u,p,m)}emplace(t,r,s,u,p,m,_){const x=16*t,P=4*t,C=8*t;return this.uint8[x+0]=r,this.uint8[x+1]=s,this.float32[P+1]=u,this.float32[P+2]=p,this.int16[C+6]=m,this.int16[C+7]=_,t}}me.prototype.bytesPerElement=16,gt("StructArrayLayout2ub2f2i16",me);class be extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s)}emplace(t,r,s,u){const p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=u,t}}be.prototype.bytesPerElement=6,gt("StructArrayLayout3ui6",be);class ze extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie)}emplace(t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie,xe){const ue=24*t,ge=12*t,Ce=48*t;return this.int16[ue+0]=r,this.int16[ue+1]=s,this.uint16[ue+2]=u,this.uint16[ue+3]=p,this.uint32[ge+2]=m,this.uint32[ge+3]=_,this.uint32[ge+4]=x,this.uint16[ue+10]=P,this.uint16[ue+11]=C,this.uint16[ue+12]=k,this.float32[ge+7]=D,this.float32[ge+8]=F,this.uint8[Ce+36]=N,this.uint8[Ce+37]=q,this.uint8[Ce+38]=Y,this.uint32[ge+10]=ie,this.int16[ue+22]=xe,t}}ze.prototype.bytesPerElement=48,gt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ze);class He extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie,xe,ue,ge,Ce,je,ct,Dt,ot,nt,wt,_t){const ft=this.length;return this.resize(ft+1),this.emplace(ft,t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie,xe,ue,ge,Ce,je,ct,Dt,ot,nt,wt,_t)}emplace(t,r,s,u,p,m,_,x,P,C,k,D,F,N,q,Y,ie,xe,ue,ge,Ce,je,ct,Dt,ot,nt,wt,_t,ft){const Me=32*t,Tt=16*t;return this.int16[Me+0]=r,this.int16[Me+1]=s,this.int16[Me+2]=u,this.int16[Me+3]=p,this.int16[Me+4]=m,this.int16[Me+5]=_,this.int16[Me+6]=x,this.int16[Me+7]=P,this.uint16[Me+8]=C,this.uint16[Me+9]=k,this.uint16[Me+10]=D,this.uint16[Me+11]=F,this.uint16[Me+12]=N,this.uint16[Me+13]=q,this.uint16[Me+14]=Y,this.uint16[Me+15]=ie,this.uint16[Me+16]=xe,this.uint16[Me+17]=ue,this.uint16[Me+18]=ge,this.uint16[Me+19]=Ce,this.uint16[Me+20]=je,this.uint16[Me+21]=ct,this.uint16[Me+22]=Dt,this.uint32[Tt+12]=ot,this.float32[Tt+13]=nt,this.float32[Tt+14]=wt,this.uint16[Me+30]=_t,this.uint16[Me+31]=ft,t}}He.prototype.bytesPerElement=64,gt("StructArrayLayout8i15ui1ul2f2ui64",He);class st extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}st.prototype.bytesPerElement=4,gt("StructArrayLayout1f4",st);class ht extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s)}emplace(t,r,s,u){const p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=s,this.float32[p+2]=u,t}}ht.prototype.bytesPerElement=12,gt("StructArrayLayout1ui2f12",ht);class et extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,s)}emplace(t,r,s,u){const p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=s,this.uint16[p+3]=u,t}}et.prototype.bytesPerElement=8,gt("StructArrayLayout1ul2ui8",et);class Qe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const u=2*t;return this.uint16[u+0]=r,this.uint16[u+1]=s,t}}Qe.prototype.bytesPerElement=4,gt("StructArrayLayout2ui4",Qe);class xt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}xt.prototype.bytesPerElement=2,gt("StructArrayLayout1ui2",xt);class jt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,u)}emplace(t,r,s,u,p){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=u,this.float32[m+3]=p,t}}jt.prototype.bytesPerElement=16,gt("StructArrayLayout4f16",jt);class rt extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new j(this.anchorPointX,this.anchorPointY)}}rt.prototype.size=20;class at extends le{get(t){return new rt(this,t)}}gt("CollisionBoxArray",at);class Nt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Nt.prototype.size=48;class Oi extends ze{get(t){return new Nt(this,t)}}gt("PlacedSymbolArray",Oi);class Gt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Gt.prototype.size=64;class ii extends He{get(t){return new Gt(this,t)}}gt("SymbolInstanceArray",ii);class Fi extends st{getoffsetX(t){return this.float32[1*t+0]}}gt("GlyphOffsetArray",Fi);class zr extends A{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}gt("SymbolLineVertexArray",zr);class Mn extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Mn.prototype.size=12;class Bi extends ht{get(t){return new Mn(this,t)}}gt("TextAnchorOffsetArray",Bi);class Yr extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Yr.prototype.size=8;class Vr extends et{get(t){return new Yr(this,t)}}gt("FeatureIndexArray",Vr);class Dr extends S{}class jr extends S{}class Wn extends S{}class To extends z{}class Sl extends B{}class Io extends Z{}class xn extends H{}class Pl extends Q{}class Au extends re{}class bn extends se{}class wn extends J{}class us extends me{}class zn extends be{}class Pr extends Qe{}const Rr=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:hn}=Rr;class oi{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,u){let p=this.segments[this.segments.length-1];return t>oi.MAX_VERTEX_ARRAY_LENGTH&&Fe(`Max vertices per segment is ${oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>oi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,u){return new oi([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function js(i,t){return 256*(i=De(Math.floor(i),0,255))+De(Math.floor(t),0,255)}oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gt("SegmentVector",oi);const Co=y([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ao={exports:{}},df={exports:{}};df.exports=function(i,t){var r,s,u,p,m,_,x,P;for(s=i.length-(r=3&i.length),u=t,m=3432918353,_=461845907,P=0;P<s;)x=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,u=27492+(65535&(p=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&i.charCodeAt(P+2))<<16;case 2:x^=(255&i.charCodeAt(P+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(P)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var h_=df.exports,pf={exports:{}};pf.exports=function(i,t){for(var r,s=i.length,u=t^s,p=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:u^=(255&i.charCodeAt(p+2))<<16;case 2:u^=(255&i.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var hs=h_,ff=pf.exports;Ao.exports=hs,Ao.exports.murmur3=hs,Ao.exports.murmur2=ff;var Tl=U(Ao.exports);class Pa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,u){this.ids.push(Il(t)),this.positions.push(r,s,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Il(t);let s=0,u=this.ids.length-1;for(;s<u;){const m=s+u>>1;this.ids[m]>=r?u=m:s=m+1}const p=[];for(;this.ids[s]===r;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(t,r){const s=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Cl(s,u,0,s.length-1),r&&r.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(t){const r=new Pa;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Il(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Tl(String(i))}function Cl(i,t,r,s){for(;r<s;){const u=i[r+s>>1];let p=r-1,m=s+1;for(;;){do p++;while(i[p]<u);do m--;while(i[m]>u);if(p>=m)break;Eo(i,p,m),Eo(t,3*p,3*m),Eo(t,3*p+1,3*m+1),Eo(t,3*p+2,3*m+2)}m-r<s-m?(Cl(i,t,r,m),r=m+1):(Cl(i,t,m+1,s),s=m)}}function Eo(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}gt("FeaturePositionMap",Pa);class Ta{constructor(t,r){this.gl=t.gl,this.location=r}}class mf extends Ta{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Qy extends Ta{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ev extends Ta{constructor(t,r){super(t,r),this.current=wi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Kb=new Float32Array(16);function d_(i){return[js(255*i.r,255*i.g),js(255*i.b,255*i.a)]}class Eu{constructor(t,r,s){this.value=t,this.uniformNames=r.map(u=>`u_${u}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new ev(t,r):new mf(t,r)}}class Al{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,u){const p=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new Qy(t,r):new mf(t,r)}}class Us{constructor(t,r,s,u){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,r,s,u,p){const m=this.paintVertexArray.length,_=this.expression.evaluate(new Li(0),r,{},u,[],p);this.paintVertexArray.resize(t),this._setPaintValue(m,t,_)}updatePaintArray(t,r,s,u){const p=this.expression.evaluate({zoom:0},s,u);this._setPaintValue(t,r,p)}_setPaintValue(t,r,s){if(this.type==="color"){const u=d_(s);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class es{constructor(t,r,s,u,p,m){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,s,u,p){const m=this.expression.evaluate(new Li(this.zoom),r,{},u,[],p),_=this.expression.evaluate(new Li(this.zoom+1),r,{},u,[],p),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,_)}updatePaintArray(t,r,s,u){const p=this.expression.evaluate({zoom:this.zoom},s,u),m=this.expression.evaluate({zoom:this.zoom+1},s,u);this._setPaintValue(t,r,p,m)}_setPaintValue(t,r,s,u){if(this.type==="color"){const p=d_(s),m=d_(u);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,p[0],p[1],m[0],m[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=De(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,r,s){return new mf(t,r)}}class ko{constructor(t,r,s,u,p,m){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,s){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,u,p){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(t,r,s,u){if(!u||!s)return;const{min:p,mid:m,max:_}=s,x=u[p],P=u[m],C=u[_];if(x&&P&&C)for(let k=t;k<r;k++)this.zoomInPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],P.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Co.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Co.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tv{constructor(t,r,s){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!s(p))continue;const m=t.paint.get(p);if(!(m instanceof Gn&&ho(m.property.specification)))continue;const _=Jb(p,t.type),x=m.value,P=m.property.specification.type,C=m.property.useIntegerZoom,k=m.property.specification["property-type"],D=k==="cross-faded"||k==="cross-faded-data-driven";if(x.kind==="constant")this.binders[p]=D?new Al(x.value,_):new Eu(x.value,_,P),u.push(`/u_${p}`);else if(x.kind==="source"||D){const F=iv(p,P,"source");this.binders[p]=D?new ko(x,P,C,r,F,t.id):new Us(x,_,P,F),u.push(`/a_${p}`)}else{const F=iv(p,P,"composite");this.binders[p]=new es(x,_,P,C,r,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Us||r instanceof es?r.maxValue:0}populatePaintArrays(t,r,s,u,p){for(const m in this.binders){const _=this.binders[m];(_ instanceof Us||_ instanceof es||_ instanceof ko)&&_.populatePaintArray(t,r,s,u,p)}}setConstantPatternPositions(t,r){for(const s in this.binders){const u=this.binders[s];u instanceof Al&&u.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,u,p){let m=!1;for(const _ in t){const x=r.getPositions(_);for(const P of x){const C=s.feature(P.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof Us||D instanceof es||D instanceof ko)&&D.expression.isStateDependent===!0){const F=u.paint.get(k);D.expression=F.value,D.updatePaintArray(P.start,P.end,C,t[_],p),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Eu||s instanceof Al)&&t.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Us||s instanceof es)for(let u=0;u<s.paintVertexAttributes.length;u++)t.push(s.paintVertexAttributes[u].name);else if(s instanceof ko)for(let u=0;u<Co.members.length;u++)t.push(Co.members[u].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Eu||s instanceof Al||s instanceof es)for(const u of s.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Eu||p instanceof Al||p instanceof es){for(const m of p.uniformNames)if(r[m]){const _=p.getBinding(t,r[m],m);s.push({name:m,property:u,binding:_})}}}return s}setUniforms(t,r,s,u){for(const{name:p,property:m,binding:_}of r)this.binders[m].setUniform(_,u,s.get(m),p)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof ko){const u=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(s instanceof Us||s instanceof es)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof Us||s instanceof es||s instanceof ko)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Us||r instanceof es||r instanceof ko)&&r.destroy()}}}class Ia{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new tv(u,r,s);this.needsUpload=!1,this._featureMap=new Pa,this._bufferOffset=0}populatePaintArrays(t,r,s,u,p,m){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,u,p,m);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,u){for(const p of s)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Jb(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function iv(i,t,r){const s={color:{source:Z,composite:jt},number:{source:st,composite:Z}},u=function(p){return{"line-pattern":{source:xn,composite:xn},"fill-pattern":{source:xn,composite:xn},"fill-extrusion-pattern":{source:xn,composite:xn}}[p]}(i);return u&&u[r]||s[t][r]}gt("ConstantBinder",Eu),gt("CrossFadedConstantBinder",Al),gt("SourceExpressionBinder",Us),gt("CrossFadedCompositeBinder",ko),gt("CompositeExpressionBinder",es),gt("ProgramConfiguration",tv,{omit:["_buffers"]}),gt("ProgramConfigurationSet",Ia);const mr=8192,p_=Math.pow(2,14)-1,rv=-p_-1;function Ca(i){const t=mr/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const u=r[s];for(let p=0;p<u.length;p++){const m=u[p],_=Math.round(m.x*t),x=Math.round(m.y*t);m.x=De(_,rv,p_),m.y=De(x,rv,p_),(_<m.x||_>m.x+1||x<m.y||x>m.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Aa(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Ca(i):[]}}function gf(i,t,r,s,u){i.emplaceBack(2*t+(s+1)/2,2*r+(u+1)/2)}class f_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new jr,this.indexArray=new zn,this.segments=new oi,this.programConfigurations=new Ia(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const u=this.layers[0],p=[];let m=null,_=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),_=!m.isConstant());for(const{feature:x,id:P,index:C,sourceLayerIndex:k}of t){const D=this.layers[0]._featureFilter.needGeometry,F=Aa(x,D);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),F,s))continue;const N=_?m.evaluate(F,{},s):void 0,q={id:P,properties:x.properties,type:x.type,sourceLayerIndex:k,index:C,geometry:D?F.geometry:Ca(x),patterns:{},sortKey:N};p.push(q)}_&&p.sort((x,P)=>x.sortKey-P.sortKey);for(const x of p){const{geometry:P,index:C,sourceLayerIndex:k}=x,D=t[C].feature;this.addFeature(x,P,C,s),r.featureIndex.insert(D,P,C,k,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,u){for(const p of r)for(const m of p){const _=m.x,x=m.y;if(_<0||_>=mr||x<0||x>=mr)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),C=P.vertexLength;gf(this.layoutVertexArray,_,x,-1,-1),gf(this.layoutVertexArray,_,x,1,-1),gf(this.layoutVertexArray,_,x,1,1),gf(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+3,C+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},u)}}function nv(i,t){for(let r=0;r<i.length;r++)if(El(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(El(i,t[r]))return!0;return!!m_(i,t)}function Yb(i,t,r){return!!El(i,t)||!!g_(t,i,r)}function sv(i,t){if(i.length===1)return av(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let u=0;u<s.length;u++)if(El(i,s[u]))return!0}for(let r=0;r<i.length;r++)if(av(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(m_(i,t[r]))return!0;return!1}function $b(i,t,r){if(i.length>1){if(m_(i,t))return!0;for(let s=0;s<t.length;s++)if(g_(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(g_(i[s],t,r))return!0;return!1}function m_(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],u=i[r+1];for(let p=0;p<t.length-1;p++)if(Qb(s,u,t[p],t[p+1]))return!0}return!1}function Qb(i,t,r,s){return Ee(i,r,s)!==Ee(t,r,s)&&Ee(i,t,r)!==Ee(i,t,s)}function g_(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let u=1;u<t.length;u++)if(ov(i,t[u-1],t[u])<s)return!0;return!1}function ov(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const u=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(u<0?t:u>1?r:r.sub(t)._mult(u)._add(t))}function av(i,t){let r,s,u,p=!1;for(let m=0;m<i.length;m++){r=i[m];for(let _=0,x=r.length-1;_<r.length;x=_++)s=r[_],u=r[x],s.y>t.y!=u.y>t.y&&t.x<(u.x-s.x)*(t.y-s.y)/(u.y-s.y)+s.x&&(p=!p)}return p}function El(i,t){let r=!1;for(let s=0,u=i.length-1;s<i.length;u=s++){const p=i[s],m=i[u];p.y>t.y!=m.y>t.y&&t.x<(m.x-p.x)*(t.y-p.y)/(m.y-p.y)+p.x&&(r=!r)}return r}function e1(i,t,r){const s=r[0],u=r[2];if(i.x<s.x&&t.x<s.x||i.x>u.x&&t.x>u.x||i.y<s.y&&t.y<s.y||i.y>u.y&&t.y>u.y)return!1;const p=Ee(i,t,r[0]);return p!==Ee(i,t,r[1])||p!==Ee(i,t,r[2])||p!==Ee(i,t,r[3])}function ku(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function _f(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function yf(i,t,r,s,u){if(!t[0]&&!t[1])return i;const p=j.convert(t)._mult(u);r==="viewport"&&p._rotate(-s);const m=[];for(let _=0;_<i.length;_++)m.push(i[_].sub(p));return m}let lv,cv;gt("CircleBucket",f_,{omit:["layers"]});var t1={get paint(){return cv=cv||new d({"circle-radius":new Lt(ye.paint_circle["circle-radius"]),"circle-color":new Lt(ye.paint_circle["circle-color"]),"circle-blur":new Lt(ye.paint_circle["circle-blur"]),"circle-opacity":new Lt(ye.paint_circle["circle-opacity"]),"circle-translate":new vt(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new vt(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new vt(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new vt(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lt(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lt(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lt(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return lv=lv||new d({"circle-sort-key":new Lt(ye.layout_circle["circle-sort-key"])})}},$r=1e-6,kl=typeof Float32Array<"u"?Float32Array:Array;function __(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function uv(i,t,r){var s=t[0],u=t[1],p=t[2],m=t[3],_=t[4],x=t[5],P=t[6],C=t[7],k=t[8],D=t[9],F=t[10],N=t[11],q=t[12],Y=t[13],ie=t[14],xe=t[15],ue=r[0],ge=r[1],Ce=r[2],je=r[3];return i[0]=ue*s+ge*_+Ce*k+je*q,i[1]=ue*u+ge*x+Ce*D+je*Y,i[2]=ue*p+ge*P+Ce*F+je*ie,i[3]=ue*m+ge*C+Ce*N+je*xe,i[4]=(ue=r[4])*s+(ge=r[5])*_+(Ce=r[6])*k+(je=r[7])*q,i[5]=ue*u+ge*x+Ce*D+je*Y,i[6]=ue*p+ge*P+Ce*F+je*ie,i[7]=ue*m+ge*C+Ce*N+je*xe,i[8]=(ue=r[8])*s+(ge=r[9])*_+(Ce=r[10])*k+(je=r[11])*q,i[9]=ue*u+ge*x+Ce*D+je*Y,i[10]=ue*p+ge*P+Ce*F+je*ie,i[11]=ue*m+ge*C+Ce*N+je*xe,i[12]=(ue=r[12])*s+(ge=r[13])*_+(Ce=r[14])*k+(je=r[15])*q,i[13]=ue*u+ge*x+Ce*D+je*Y,i[14]=ue*p+ge*P+Ce*F+je*ie,i[15]=ue*m+ge*C+Ce*N+je*xe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Mu,i1=uv;function vf(i,t,r){var s=t[0],u=t[1],p=t[2],m=t[3];return i[0]=r[0]*s+r[4]*u+r[8]*p+r[12]*m,i[1]=r[1]*s+r[5]*u+r[9]*p+r[13]*m,i[2]=r[2]*s+r[6]*u+r[10]*p+r[14]*m,i[3]=r[3]*s+r[7]*u+r[11]*p+r[15]*m,i}Mu=new kl(4),kl!=Float32Array&&(Mu[0]=0,Mu[1]=0,Mu[2]=0,Mu[3]=0);class r1 extends n{constructor(t){super(t,t1)}createBucket(t){return new f_(t)}queryRadius(t){const r=t;return ku("circle-radius",this,r)+ku("circle-stroke-width",this,r)+_f(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,u,p,m,_,x){const P=yf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,_),C=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),k=this.paint.get("circle-pitch-alignment")==="map",D=k?P:function(N,q){return N.map(Y=>hv(Y,q))}(P,x),F=k?C*_:C;for(const N of u)for(const q of N){const Y=k?q:hv(q,x);let ie=F;const xe=vf([],[q.x,q.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=xe[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=m.cameraToCenterDistance/xe[3]),Yb(D,Y,ie))return!0}return!1}}function hv(i,t){const r=vf([],[i.x,i.y,0,1],t);return new j(r[0]/r[3],r[1]/r[3])}class dv extends f_{}let pv;gt("HeatmapBucket",dv,{omit:["layers"]});var n1={get paint(){return pv=pv||new d({"heatmap-radius":new Lt(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lt(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new vt(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cu(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new vt(ye.paint_heatmap["heatmap-opacity"])})}};function y_(i,{width:t,height:r},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*r*s}`)}else u=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=u,i}function fv(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const u=y_({},{width:t,height:r},s);v_(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=u.data}function v_(i,t,r,s,u,p){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||s.x>t.width-u.width||s.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,_=t.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const P=((r.y+x)*i.width+r.x)*p,C=((s.y+x)*t.width+s.x)*p;for(let k=0;k<u.width*p;k++)_[C+k]=m[P+k]}return t}class zu{constructor(t,r){y_(this,t,1,r)}resize(t){fv(this,t,1)}clone(){return new zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,u,p){v_(t,r,s,u,p,1)}}class Dn{constructor(t,r){y_(this,t,4,r)}resize(t){fv(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Dn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,u,p){v_(t,r,s,u,p,4)}}function mv(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,u=i.image||new Dn({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(m,_,x)=>{t[i.evaluationKey]=x;const P=i.expression.evaluate(t);u.data[m+_+0]=Math.floor(255*P.r/P.a),u.data[m+_+1]=Math.floor(255*P.g/P.a),u.data[m+_+2]=Math.floor(255*P.b/P.a),u.data[m+_+3]=Math.floor(255*P.a)};if(i.clips)for(let m=0,_=0;m<s;++m,_+=4*r)for(let x=0,P=0;x<r;x++,P+=4){const C=x/(r-1),{start:k,end:D}=i.clips[m];p(_,P,k*(1-C)+D*C)}else for(let m=0,_=0;m<r;m++,_+=4)p(0,_,m/(r-1));return u}gt("AlphaImage",zu),gt("RGBAImage",Dn);const x_="big-fb";class s1 extends n{createBucket(t){return new dv(t)}constructor(t){super(t,n1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(x_)&&this.heatmapFbos.delete(x_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let gv;var o1={get paint(){return gv=gv||new d({"hillshade-illumination-direction":new vt(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new vt(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new vt(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new vt(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new vt(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new vt(ye.paint_hillshade["hillshade-accent-color"])})}};class a1 extends n{constructor(t){super(t,o1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const l1=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:c1}=l1;function _v(i,t,r=2){const s=t&&t.length,u=s?t[0]*r:i.length;let p=yv(i,0,u,r,!0);const m=[];if(!p||p.next===p.prev)return m;let _,x,P;if(s&&(p=function(C,k,D,F){const N=[];for(let q=0,Y=k.length;q<Y;q++){const ie=yv(C,k[q]*F,q<Y-1?k[q+1]*F:C.length,F,!1);ie===ie.next&&(ie.steiner=!0),N.push(_1(ie))}N.sort(f1);for(let q=0;q<N.length;q++)D=m1(N[q],D);return D}(i,t,p,r)),i.length>80*r){_=1/0,x=1/0;let C=-1/0,k=-1/0;for(let D=r;D<u;D+=r){const F=i[D],N=i[D+1];F<_&&(_=F),N<x&&(x=N),F>C&&(C=F),N>k&&(k=N)}P=Math.max(C-_,k-x),P=P!==0?32767/P:0}return Du(p,m,r,_,x,P,0),m}function yv(i,t,r,s,u){let p;if(u===function(m,_,x,P){let C=0;for(let k=_,D=x-P;k<x;k+=P)C+=(m[D]-m[k])*(m[k+1]+m[D+1]),D=k;return C}(i,t,r,s)>0)for(let m=t;m<r;m+=s)p=bv(m/s|0,i[m],i[m+1],p);else for(let m=r-s;m>=t;m-=s)p=bv(m/s|0,i[m],i[m+1],p);return p&&xf(p,p.next)&&(Lu(p),p=p.next),p}function Ea(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!xf(s,s.next)&&cr(s.prev,s,s.next)!==0)s=s.next;else{if(Lu(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function Du(i,t,r,s,u,p,m){if(!i)return;!m&&p&&function(x,P,C,k){let D=x;do D.z===0&&(D.z=b_(D.x,D.y,P,C,k)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(F){let N,q=1;do{let Y,ie=F;F=null;let xe=null;for(N=0;ie;){N++;let ue=ie,ge=0;for(let je=0;je<q&&(ge++,ue=ue.nextZ,ue);je++);let Ce=q;for(;ge>0||Ce>0&&ue;)ge!==0&&(Ce===0||!ue||ie.z<=ue.z)?(Y=ie,ie=ie.nextZ,ge--):(Y=ue,ue=ue.nextZ,Ce--),xe?xe.nextZ=Y:F=Y,Y.prevZ=xe,xe=Y;ie=ue}xe.nextZ=null,q*=2}while(N>1)}(D)}(i,s,u,p);let _=i;for(;i.prev!==i.next;){const x=i.prev,P=i.next;if(p?h1(i,s,u,p):u1(i))t.push(x.i,i.i,P.i),Lu(i),i=P.next,_=P.next;else if((i=P)===_){m?m===1?Du(i=d1(Ea(i),t),t,r,s,u,p,2):m===2&&p1(i,t,r,s,u,p):Du(Ea(i),t,r,s,u,p,1);break}}}function u1(i){const t=i.prev,r=i,s=i.next;if(cr(t,r,s)>=0)return!1;const u=t.x,p=r.x,m=s.x,_=t.y,x=r.y,P=s.y,C=u<p?u<m?u:m:p<m?p:m,k=_<x?_<P?_:P:x<P?x:P,D=u>p?u>m?u:m:p>m?p:m,F=_>x?_>P?_:P:x>P?x:P;let N=s.next;for(;N!==t;){if(N.x>=C&&N.x<=D&&N.y>=k&&N.y<=F&&Ml(u,_,p,x,m,P,N.x,N.y)&&cr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function h1(i,t,r,s){const u=i.prev,p=i,m=i.next;if(cr(u,p,m)>=0)return!1;const _=u.x,x=p.x,P=m.x,C=u.y,k=p.y,D=m.y,F=_<x?_<P?_:P:x<P?x:P,N=C<k?C<D?C:D:k<D?k:D,q=_>x?_>P?_:P:x>P?x:P,Y=C>k?C>D?C:D:k>D?k:D,ie=b_(F,N,t,r,s),xe=b_(q,Y,t,r,s);let ue=i.prevZ,ge=i.nextZ;for(;ue&&ue.z>=ie&&ge&&ge.z<=xe;){if(ue.x>=F&&ue.x<=q&&ue.y>=N&&ue.y<=Y&&ue!==u&&ue!==m&&Ml(_,C,x,k,P,D,ue.x,ue.y)&&cr(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,ge.x>=F&&ge.x<=q&&ge.y>=N&&ge.y<=Y&&ge!==u&&ge!==m&&Ml(_,C,x,k,P,D,ge.x,ge.y)&&cr(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;ue&&ue.z>=ie;){if(ue.x>=F&&ue.x<=q&&ue.y>=N&&ue.y<=Y&&ue!==u&&ue!==m&&Ml(_,C,x,k,P,D,ue.x,ue.y)&&cr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;ge&&ge.z<=xe;){if(ge.x>=F&&ge.x<=q&&ge.y>=N&&ge.y<=Y&&ge!==u&&ge!==m&&Ml(_,C,x,k,P,D,ge.x,ge.y)&&cr(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function d1(i,t){let r=i;do{const s=r.prev,u=r.next.next;!xf(s,u)&&vv(s,r,r.next,u)&&Ru(s,u)&&Ru(u,s)&&(t.push(s.i,r.i,u.i),Lu(r),Lu(r.next),r=i=u),r=r.next}while(r!==i);return Ea(r)}function p1(i,t,r,s,u,p){let m=i;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&y1(m,_)){let x=xv(m,_);return m=Ea(m,m.next),x=Ea(x,x.next),Du(m,t,r,s,u,p,0),void Du(x,t,r,s,u,p,0)}_=_.next}m=m.next}while(m!==i)}function f1(i,t){return i.x-t.x}function m1(i,t){const r=function(u,p){let m=p;const _=u.x,x=u.y;let P,C=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const q=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(q<=_&&q>C&&(C=q,P=m.x<m.next.x?m:m.next,q===_))return P}m=m.next}while(m!==p);if(!P)return null;const k=P,D=P.x,F=P.y;let N=1/0;m=P;do{if(_>=m.x&&m.x>=D&&_!==m.x&&Ml(x<F?_:C,x,D,F,x<F?C:_,x,m.x,m.y)){const q=Math.abs(x-m.y)/(_-m.x);Ru(m,u)&&(q<N||q===N&&(m.x>P.x||m.x===P.x&&g1(P,m)))&&(P=m,N=q)}m=m.next}while(m!==k);return P}(i,t);if(!r)return t;const s=xv(r,i);return Ea(s,s.next),Ea(r,r.next)}function g1(i,t){return cr(i.prev,i,t.prev)<0&&cr(t.next,i,i.next)<0}function b_(i,t,r,s,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _1(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Ml(i,t,r,s,u,p,m,_){return(u-m)*(t-_)>=(i-m)*(p-_)&&(i-m)*(s-_)>=(r-m)*(t-_)&&(r-m)*(p-_)>=(u-m)*(s-_)}function y1(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==s.i&&u.next.i!==s.i&&vv(u,u.next,r,s))return!0;u=u.next}while(u!==r);return!1}(i,t)&&(Ru(i,t)&&Ru(t,i)&&function(r,s){let u=r,p=!1;const m=(r.x+s.x)/2,_=(r.y+s.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==r);return p}(i,t)&&(cr(i.prev,i,t.prev)||cr(i,t.prev,t))||xf(i,t)&&cr(i.prev,i,i.next)>0&&cr(t.prev,t,t.next)>0)}function cr(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function xf(i,t){return i.x===t.x&&i.y===t.y}function vv(i,t,r,s){const u=wf(cr(i,t,r)),p=wf(cr(i,t,s)),m=wf(cr(r,s,i)),_=wf(cr(r,s,t));return u!==p&&m!==_||!(u!==0||!bf(i,r,t))||!(p!==0||!bf(i,s,t))||!(m!==0||!bf(r,i,s))||!(_!==0||!bf(r,t,s))}function bf(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function wf(i){return i>0?1:i<0?-1:0}function Ru(i,t){return cr(i.prev,i,i.next)<0?cr(i,t,i.next)>=0&&cr(i,i.prev,t)>=0:cr(i,t,i.prev)<0||cr(i,i.next,t)<0}function xv(i,t){const r=w_(i.i,i.x,i.y),s=w_(t.i,t.x,t.y),u=i.next,p=t.prev;return i.next=t,t.prev=i,r.next=u,u.prev=r,s.next=r,r.prev=s,p.next=s,s.prev=p,s}function bv(i,t,r,s){const u=w_(i,t,r);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Lu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function w_(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function S_(i,t,r){const s=r.patternDependencies;let u=!1;for(const p of t){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const _=m.constantOr(null);_&&(u=!0,s[_.to]=!0,s[_.from]=!0)}return u}function P_(i,t,r,s,u){const p=u.patternDependencies;for(const m of t){const _=m.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:s-1},r,{},u.availableImages),P=_.evaluate({zoom:s},r,{},u.availableImages),C=_.evaluate({zoom:s+1},r,{},u.availableImages);x=x&&x.name?x.name:x,P=P&&P.name?P.name:P,C=C&&C.name?C.name:C,p[x]=!0,p[P]=!0,p[C]=!0,r.patterns[m.id]={min:x,mid:P,max:C}}}return r}class T_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wn,this.indexArray=new zn,this.indexArray2=new Pr,this.programConfigurations=new Ia(t.layers,t.zoom),this.segments=new oi,this.segments2=new oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=S_("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:C}of t){const k=this.layers[0]._featureFilter.needGeometry,D=Aa(_,k);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),D,s))continue;const F=p?u.evaluate(D,{},s,r.availableImages):void 0,N={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:P,geometry:k?D.geometry:Ca(_),patterns:{},sortKey:F};m.push(N)}p&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:C}=_;if(this.hasPattern){const k=P_("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,x,P,s,{});r.featureIndex.insert(t[P].feature,x,P,C,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,c1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,u,p){for(const m of tl(r,500)){let _=0;for(const F of m)_+=F.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),P=x.vertexLength,C=[],k=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&k.push(C.length/2);const N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(q+F.length-1,q),C.push(F[0].x),C.push(F[0].y);for(let Y=1;Y<F.length;Y++)this.layoutVertexArray.emplaceBack(F[Y].x,F[Y].y),this.indexArray2.emplaceBack(q+Y-1,q+Y),C.push(F[Y].x),C.push(F[Y].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}const D=_v(C,k);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(P+D[F],P+D[F+1],P+D[F+2]);x.vertexLength+=_,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,u)}}let wv,Sv;gt("FillBucket",T_,{omit:["layers","patternFeatures"]});var v1={get paint(){return Sv=Sv||new d({"fill-antialias":new vt(ye.paint_fill["fill-antialias"]),"fill-opacity":new Lt(ye.paint_fill["fill-opacity"]),"fill-color":new Lt(ye.paint_fill["fill-color"]),"fill-outline-color":new Lt(ye.paint_fill["fill-outline-color"]),"fill-translate":new vt(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new vt(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new bl(ye.paint_fill["fill-pattern"])})},get layout(){return wv=wv||new d({"fill-sort-key":new Lt(ye.layout_fill["fill-sort-key"])})}};class x1 extends n{constructor(t){super(t,v1)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new T_(t)}queryRadius(){return _f(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,u,p,m,_){return sv(yf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,_),u)}isTileClipped(){return!0}}const b1=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),w1=y([{name:"a_centroid",components:2,type:"Int16"}],4),{members:S1}=b1;var Mo={},P1=W,Pv=zl;function zl(i,t,r,s,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=u,i.readFields(T1,this,t)}function T1(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,u){for(var p=s.readVarint()+s.pos;s.pos<p;){var m=u._keys[s.readVarint()],_=u._values[s.readVarint()];u.properties[m]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function I1(i){for(var t,r,s=0,u=0,p=i.length,m=p-1;u<p;m=u++)s+=((r=i[m]).x-(t=i[u]).x)*(t.y+r.y);return s}zl.types=["Unknown","Point","LineString","Polygon"],zl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,u=0,p=0,m=0,_=[];i.pos<r;){if(u<=0){var x=i.readVarint();s=7&x,u=x>>3}if(u--,s===1||s===2)p+=i.readSVarint(),m+=i.readSVarint(),s===1&&(t&&_.push(t),t=[]),t.push(new P1(p,m));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&_.push(t),_},zl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,u=0,p=0,m=1/0,_=-1/0,x=1/0,P=-1/0;i.pos<t;){if(s<=0){var C=i.readVarint();r=7&C,s=C>>3}if(s--,r===1||r===2)(u+=i.readSVarint())<m&&(m=u),u>_&&(_=u),(p+=i.readSVarint())<x&&(x=p),p>P&&(P=p);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,_,P]},zl.prototype.toGeoJSON=function(i,t,r){var s,u,p=this.extent*Math.pow(2,r),m=this.extent*i,_=this.extent*t,x=this.loadGeometry(),P=zl.types[this.type];function C(F){for(var N=0;N<F.length;N++){var q=F[N];F[N]=[360*(q.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+_)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(s=0;s<x.length;s++)k[s]=x[s][0];C(x=k);break;case 2:for(s=0;s<x.length;s++)C(x[s]);break;case 3:for(x=function(F){var N=F.length;if(N<=1)return[F];for(var q,Y,ie=[],xe=0;xe<N;xe++){var ue=I1(F[xe]);ue!==0&&(Y===void 0&&(Y=ue<0),Y===ue<0?(q&&ie.push(q),q=[F[xe]]):q.push(F[xe]))}return q&&ie.push(q),ie}(x),s=0;s<x.length;s++)for(u=0;u<x[s].length;u++)C(x[s][u])}x.length===1?x=x[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var C1=Pv,Tv=Iv;function Iv(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(A1,this,t),this.length=this._features.length}function A1(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var u=null,p=s.readVarint()+s.pos;s.pos<p;){var m=s.readVarint()>>3;u=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}return u}(r))}Iv.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new C1(this._pbf,t,this.extent,this._keys,this._values)};var E1=Tv;function k1(i,t,r){if(i===3){var s=new E1(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}Mo.VectorTile=function(i,t){this.layers=i.readFields(k1,{},t)},Mo.VectorTileFeature=Pv,Mo.VectorTileLayer=Tv;const M1=Mo.VectorTileFeature.types,I_=Math.pow(2,13);function Ou(i,t,r,s,u,p,m,_){i.emplaceBack(t,r,2*Math.floor(s*I_)+m,u*I_*2,p*I_*2,Math.round(_))}class C_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new To,this.centroidVertexArray=new Dr,this.indexArray=new zn,this.programConfigurations=new Ia(t.layers,t.zoom),this.segments=new oi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=S_("fill-extrusion",this.layers,r);for(const{feature:u,id:p,index:m,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,P=Aa(u,x);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),P,s))continue;const C={id:p,sourceLayerIndex:_,index:m,geometry:x?P.geometry:Ca(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(P_("fill-extrusion",this.layers,C,this.zoom,r)):this.addFeature(C,C.geometry,m,s,{}),r.featureIndex.insert(u,C.geometry,m,_,this.index,!0)}}addFeatures(t,r,s){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,S1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,w1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,u,p){for(const m of tl(r,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const N of m)x+=N.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of m){if(N.length===0||D1(N))continue;let q=0;for(let Y=0;Y<N.length;Y++){const ie=N[Y];if(Y>=1){const xe=N[Y-1];if(!z1(ie,xe)){P.vertexLength+4>oi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=ie.sub(xe)._perp()._unit(),ge=xe.dist(ie);q+ge>32768&&(q=0),Ou(this.layoutVertexArray,ie.x,ie.y,ue.x,ue.y,0,0,q),Ou(this.layoutVertexArray,ie.x,ie.y,ue.x,ue.y,0,1,q),_.x+=2*ie.x,_.y+=2*ie.y,_.vertexCount+=2,q+=ge,Ou(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,0,q),Ou(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,1,q),_.x+=2*xe.x,_.y+=2*xe.y,_.vertexCount+=2;const Ce=P.vertexLength;this.indexArray.emplaceBack(Ce,Ce+2,Ce+1),this.indexArray.emplaceBack(Ce+1,Ce+2,Ce+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+x>oi.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),M1[t.type]!=="Polygon")continue;const C=[],k=[],D=P.vertexLength;for(const N of m)if(N.length!==0){N!==m[0]&&k.push(C.length/2);for(let q=0;q<N.length;q++){const Y=N[q];Ou(this.layoutVertexArray,Y.x,Y.y,0,0,1,1,0),_.x+=Y.x,_.y+=Y.y,_.vertexCount+=1,C.push(Y.x),C.push(Y.y)}}const F=_v(C,k);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(D+F[N],D+F[N+2],D+F[N+1]);P.primitiveLength+=F.length/3,P.vertexLength+=x;for(let N=0;N<_.vertexCount;N++){const q=Math.floor(_.x/_.vertexCount),Y=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(q,Y)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,u)}}function z1(i,t){return i.x===t.x&&(i.x<0||i.x>mr)||i.y===t.y&&(i.y<0||i.y>mr)}function D1(i){return i.every(t=>t.x<0)||i.every(t=>t.x>mr)||i.every(t=>t.y<0)||i.every(t=>t.y>mr)}let Cv;gt("FillExtrusionBucket",C_,{omit:["layers","features"]});var R1={get paint(){return Cv=Cv||new d({"fill-extrusion-opacity":new vt(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lt(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new vt(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new vt(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bl(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Lt(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lt(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new vt(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L1 extends n{constructor(t){super(t,R1)}createBucket(t){return new C_(t)}queryRadius(){return _f(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,u,p,m,_,x){const P=yf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,_),C=this.paint.get("fill-extrusion-height").evaluate(r,s),k=this.paint.get("fill-extrusion-base").evaluate(r,s),D=function(N,q,Y,ie){const xe=[];for(const ue of N){const ge=[ue.x,ue.y,0,1];vf(ge,ge,q),xe.push(new j(ge[0]/ge[3],ge[1]/ge[3]))}return xe}(P,x),F=function(N,q,Y,ie){const xe=[],ue=[],ge=ie[8]*q,Ce=ie[9]*q,je=ie[10]*q,ct=ie[11]*q,Dt=ie[8]*Y,ot=ie[9]*Y,nt=ie[10]*Y,wt=ie[11]*Y;for(const _t of N){const ft=[],Me=[];for(const Tt of _t){const bt=Tt.x,Vt=Tt.y,ki=ie[0]*bt+ie[4]*Vt+ie[12],Ci=ie[1]*bt+ie[5]*Vt+ie[13],vr=ie[2]*bt+ie[6]*Vt+ie[14],Hn=ie[3]*bt+ie[7]*Vt+ie[15],Or=vr+je,xr=Hn+ct,Qr=ki+Dt,en=Ci+ot,tn=vr+nt,sr=Hn+wt,br=new j((ki+ge)/xr,(Ci+Ce)/xr);br.z=Or/xr,ft.push(br);const Ur=new j(Qr/sr,en/sr);Ur.z=tn/sr,Me.push(Ur)}xe.push(ft),ue.push(Me)}return[xe,ue]}(u,k,C,x);return function(N,q,Y){let ie=1/0;sv(Y,q)&&(ie=Av(Y,q[0]));for(let xe=0;xe<q.length;xe++){const ue=q[xe],ge=N[xe];for(let Ce=0;Ce<ue.length-1;Ce++){const je=ue[Ce],ct=[je,ue[Ce+1],ge[Ce+1],ge[Ce],je];nv(Y,ct)&&(ie=Math.min(ie,Av(Y,ct)))}}return ie!==1/0&&ie}(F[0],F[1],D)}}function Fu(i,t){return i.x*t.x+i.y*t.y}function Av(i,t){if(i.length===1){let r=0;const s=t[r++];let u;for(;!u||s.equals(u);)if(u=t[r++],!u)return 1/0;for(;r<t.length;r++){const p=t[r],m=i[0],_=u.sub(s),x=p.sub(s),P=m.sub(s),C=Fu(_,_),k=Fu(_,x),D=Fu(x,x),F=Fu(P,_),N=Fu(P,x),q=C*D-k*k,Y=(D*F-k*N)/q,ie=(C*N-k*F)/q,xe=s.z*(1-Y-ie)+u.z*Y+p.z*ie;if(isFinite(xe))return xe}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const O1=y([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:F1}=O1,B1=y([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:N1}=B1,V1=Mo.VectorTileFeature.types,j1=Math.cos(Math.PI/180*37.5),Ev=Math.pow(2,14)/.5;class A_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Sl,this.layoutVertexArray2=new Io,this.indexArray=new zn,this.programConfigurations=new Ia(t.layers,t.zoom),this.segments=new oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=S_("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:C}of t){const k=this.layers[0]._featureFilter.needGeometry,D=Aa(_,k);if(!this.layers[0]._featureFilter.filter(new Li(this.zoom),D,s))continue;const F=p?u.evaluate(D,{},s):void 0,N={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:P,geometry:k?D.geometry:Ca(_),patterns:{},sortKey:F};m.push(N)}p&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:C}=_;if(this.hasPattern){const k=P_("line",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,x,P,s,{});r.featureIndex.insert(t[P].feature,x,P,C,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,N1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,F1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,u,p){const m=this.layers[0].layout,_=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),P=m.get("line-miter-limit"),C=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of r)this.addLine(k,t,_,x,P,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,u)}addLine(t,r,s,u,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=V1[r.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let P=0;for(;P<x-1&&t[P].equals(t[P+1]);)P++;if(x<(_?3:2))return;s==="bevel"&&(p=1.05);const C=this.overscaling<=16?15*mr/(512*this.overscaling):0,k=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,F,N,q,Y;this.e1=this.e2=-1,_&&(D=t[x-2],Y=t[P].sub(D)._unit()._perp());for(let ie=P;ie<x;ie++){if(N=ie===x-1?_?t[P+1]:void 0:t[ie+1],N&&t[ie].equals(N))continue;Y&&(q=Y),D&&(F=D),D=t[ie],Y=N?N.sub(D)._unit()._perp():q,q=q||Y;let xe=q.add(Y);xe.x===0&&xe.y===0||xe._unit();const ue=q.x*Y.x+q.y*Y.y,ge=xe.x*Y.x+xe.y*Y.y,Ce=ge!==0?1/ge:1/0,je=2*Math.sqrt(2-2*ge),ct=ge<j1&&F&&N,Dt=q.x*Y.y-q.y*Y.x>0;if(ct&&ie>P){const wt=D.dist(F);if(wt>2*C){const _t=D.sub(D.sub(F)._mult(C/wt)._round());this.updateDistance(F,_t),this.addCurrentVertex(_t,q,0,0,k),F=_t}}const ot=F&&N;let nt=ot?s:_?"butt":u;if(ot&&nt==="round"&&(Ce<m?nt="miter":Ce<=2&&(nt="fakeround")),nt==="miter"&&Ce>p&&(nt="bevel"),nt==="bevel"&&(Ce>2&&(nt="flipbevel"),Ce<p&&(nt="miter")),F&&this.updateDistance(F,D),nt==="miter")xe._mult(Ce),this.addCurrentVertex(D,xe,0,0,k);else if(nt==="flipbevel"){if(Ce>100)xe=Y.mult(-1);else{const wt=Ce*q.add(Y).mag()/q.sub(Y).mag();xe._perp()._mult(wt*(Dt?-1:1))}this.addCurrentVertex(D,xe,0,0,k),this.addCurrentVertex(D,xe.mult(-1),0,0,k)}else if(nt==="bevel"||nt==="fakeround"){const wt=-Math.sqrt(Ce*Ce-1),_t=Dt?wt:0,ft=Dt?0:wt;if(F&&this.addCurrentVertex(D,q,_t,ft,k),nt==="fakeround"){const Me=Math.round(180*je/Math.PI/20);for(let Tt=1;Tt<Me;Tt++){let bt=Tt/Me;if(bt!==.5){const ki=bt-.5;bt+=bt*ki*(bt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*ki*ki+(.848013+ue*(.215638*ue-1.06021)))}const Vt=Y.sub(q)._mult(bt)._add(q)._unit()._mult(Dt?-1:1);this.addHalfVertex(D,Vt.x,Vt.y,!1,Dt,0,k)}}N&&this.addCurrentVertex(D,Y,-_t,-ft,k)}else if(nt==="butt")this.addCurrentVertex(D,xe,0,0,k);else if(nt==="square"){const wt=F?1:-1;this.addCurrentVertex(D,xe,wt,wt,k)}else nt==="round"&&(F&&(this.addCurrentVertex(D,q,0,0,k),this.addCurrentVertex(D,q,1,1,k,!0)),N&&(this.addCurrentVertex(D,Y,-1,-1,k,!0),this.addCurrentVertex(D,Y,0,0,k)));if(ct&&ie<x-1){const wt=D.dist(N);if(wt>2*C){const _t=D.add(N.sub(D)._mult(C/wt)._round());this.updateDistance(D,_t),this.addCurrentVertex(_t,Y,0,0,k),D=_t}}}}addCurrentVertex(t,r,s,u,p,m=!1){const _=r.y*u-r.x,x=-r.y-r.x*u;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,m,!1,s,p),this.addHalfVertex(t,_,x,m,!0,-u,p),this.distance>Ev/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,u,p,m))}addHalfVertex({x:t,y:r},s,u,p,m,_,x){const P=.5*(this.lineClips?this.scaledDistance*(Ev-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const C=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),x.primitiveLength++),m?this.e2=C:this.e1=C}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let kv,Mv;gt("LineBucket",A_,{omit:["layers","patternFeatures"]});var zv={get paint(){return Mv=Mv||new d({"line-opacity":new Lt(ye.paint_line["line-opacity"]),"line-color":new Lt(ye.paint_line["line-color"]),"line-translate":new vt(ye.paint_line["line-translate"]),"line-translate-anchor":new vt(ye.paint_line["line-translate-anchor"]),"line-width":new Lt(ye.paint_line["line-width"]),"line-gap-width":new Lt(ye.paint_line["line-gap-width"]),"line-offset":new Lt(ye.paint_line["line-offset"]),"line-blur":new Lt(ye.paint_line["line-blur"]),"line-dasharray":new wl(ye.paint_line["line-dasharray"]),"line-pattern":new bl(ye.paint_line["line-pattern"]),"line-gradient":new Cu(ye.paint_line["line-gradient"])})},get layout(){return kv=kv||new d({"line-cap":new vt(ye.layout_line["line-cap"]),"line-join":new Lt(ye.layout_line["line-join"]),"line-miter-limit":new vt(ye.layout_line["line-miter-limit"]),"line-round-limit":new vt(ye.layout_line["line-round-limit"]),"line-sort-key":new Lt(ye.layout_line["line-sort-key"])})}};class U1 extends Lt{possiblyEvaluate(t,r){return r=new Li(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,u){return r=it({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,u)}}let Sf;class q1 extends n{constructor(t){super(t,zv),this.gradientVersion=0,Sf||(Sf=new U1(zv.paint.properties["line-width"].specification),Sf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof so,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Sf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new A_(t)}queryRadius(t){const r=t,s=Dv(ku("line-width",this,r),ku("line-gap-width",this,r)),u=ku("line-offset",this,r);return s/2+Math.abs(u)+_f(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,u,p,m,_){const x=yf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,_),P=_/2*Dv(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),C=this.paint.get("line-offset").evaluate(r,s);return C&&(u=function(k,D){const F=[];for(let N=0;N<k.length;N++){const q=k[N],Y=[];for(let ie=0;ie<q.length;ie++){const xe=q[ie-1],ue=q[ie],ge=q[ie+1],Ce=ie===0?new j(0,0):ue.sub(xe)._unit()._perp(),je=ie===q.length-1?new j(0,0):ge.sub(ue)._unit()._perp(),ct=Ce._add(je)._unit(),Dt=ct.x*je.x+ct.y*je.y;Dt!==0&&ct._mult(1/Dt),Y.push(ct._mult(D)._add(ue))}F.push(Y)}return F}(u,C*_)),function(k,D,F){for(let N=0;N<D.length;N++){const q=D[N];if(k.length>=3){for(let Y=0;Y<q.length;Y++)if(El(k,q[Y]))return!0}if($b(k,q,F))return!0}return!1}(x,u,P)}isTileClipped(){return!0}}function Dv(i,t){return t>0?t+2*i:i}const Z1=y([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),G1=y([{name:"a_projected_pos",components:3,type:"Float32"}],4);y([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const W1=y([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);y([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rv=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),H1=y([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function X1(i,t,r){return i.sections.forEach(s=>{s.text=function(u,p,m){const _=p.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),un.applyArabicShaping&&(u=un.applyArabicShaping(u)),u}(s.text,t,r)}),i}y([{name:"triangle",components:3,type:"Uint16"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),y([{type:"Float32",name:"offsetX"}]),y([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),y([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Bu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var gr=24,Lv=Ii,Ov=function(i,t,r,s,u){var p,m,_=8*u-s-1,x=(1<<_)-1,P=x>>1,C=-7,k=u-1,D=-1,F=i[t+k];for(k+=D,p=F&(1<<-C)-1,F>>=-C,C+=_;C>0;p=256*p+i[t+k],k+=D,C-=8);for(m=p&(1<<-C)-1,p>>=-C,C+=s;C>0;m=256*m+i[t+k],k+=D,C-=8);if(p===0)p=1-P;else{if(p===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,s),p-=P}return(F?-1:1)*m*Math.pow(2,p-s)},Fv=function(i,t,r,s,u,p){var m,_,x,P=8*p-u-1,C=(1<<P)-1,k=C>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,N=1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,m=C):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+k>=1?D/x:D*Math.pow(2,1-k))*x>=2&&(m++,x/=2),m+k>=C?(_=0,m=C):m+k>=1?(_=(t*x-1)*Math.pow(2,u),m+=k):(_=t*Math.pow(2,k-1)*Math.pow(2,u),m=0));u>=8;i[r+F]=255&_,F+=N,_/=256,u-=8);for(m=m<<u|_,P+=u;P>0;i[r+F]=255&m,F+=N,m/=256,P-=8);i[r+F-N]|=128*q};function Ii(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ii.Varint=0,Ii.Fixed64=1,Ii.Bytes=2,Ii.Fixed32=5;var E_=4294967296,Bv=1/E_,Nv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function qs(i){return i.type===Ii.Bytes?i.readVarint()+i.pos:i.pos+1}function Dl(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Vv(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var u=r.pos-1;u>=i;u--)r.buf[u+s]=r.buf[u]}function K1(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function J1(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function Y1(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function $1(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function Q1(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function ew(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function tw(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function iw(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function rw(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Pf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Rl(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function jv(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ii.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),u=s>>3,p=this.pos;this.type=7&s,i(u,t,this),this.pos===p&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Pf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=jv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Pf(this.buf,this.pos)+Pf(this.buf,this.pos+4)*E_;return this.pos+=8,i},readSFixed64:function(){var i=Pf(this.buf,this.pos)+jv(this.buf,this.pos+4)*E_;return this.pos+=8,i},readFloat:function(){var i=Ov(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Ov(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(u,p,m){var _,x,P=m.buf;if(_=(112&(x=P[m.pos++]))>>4,x<128||(_|=(127&(x=P[m.pos++]))<<3,x<128)||(_|=(127&(x=P[m.pos++]))<<10,x<128)||(_|=(127&(x=P[m.pos++]))<<17,x<128)||(_|=(127&(x=P[m.pos++]))<<24,x<128)||(_|=(1&(x=P[m.pos++]))<<31,x<128))return Dl(u,_,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Nv?function(r,s,u){return Nv.decode(r.subarray(s,u))}(this.buf,t,i):function(r,s,u){for(var p="",m=s;m<u;){var _,x,P,C=r[m],k=null,D=C>239?4:C>223?3:C>191?2:1;if(m+D>u)break;D===1?C<128&&(k=C):D===2?(192&(_=r[m+1]))==128&&(k=(31&C)<<6|63&_)<=127&&(k=null):D===3?(x=r[m+2],(192&(_=r[m+1]))==128&&(192&x)==128&&((k=(15&C)<<12|(63&_)<<6|63&x)<=2047||k>=55296&&k<=57343)&&(k=null)):D===4&&(x=r[m+2],P=r[m+3],(192&(_=r[m+1]))==128&&(192&x)==128&&(192&P)==128&&((k=(15&C)<<18|(63&_)<<12|(63&x)<<6|63&P)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,D=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),m+=D}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ii.Bytes)return i.push(this.readVarint(t));var r=qs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ii.Bytes)return i.push(this.readSVarint());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ii.Bytes)return i.push(this.readBoolean());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ii.Bytes)return i.push(this.readFloat());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ii.Bytes)return i.push(this.readDouble());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ii.Bytes)return i.push(this.readFixed32());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ii.Bytes)return i.push(this.readSFixed32());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ii.Bytes)return i.push(this.readFixed64());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ii.Bytes)return i.push(this.readSFixed64());var t=qs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ii.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ii.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ii.Fixed32)this.pos+=4;else{if(t!==Ii.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Rl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Rl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Rl(this.buf,-1&i,this.pos),Rl(this.buf,Math.floor(i*Bv),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Rl(this.buf,-1&i,this.pos),Rl(this.buf,Math.floor(i*Bv),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,u;if(t>=0?(s=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,m,_){_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,_.buf[_.pos]=127&(p>>>=7)}(s,0,r),function(p,m){var _=(7&p)<<4;m.buf[m.pos++]|=_|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,u,p){for(var m,_,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!_){m>56319||x+1===u.length?(s[p++]=239,s[p++]=191,s[p++]=189):_=m;continue}if(m<56320){s[p++]=239,s[p++]=191,s[p++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(s[p++]=239,s[p++]=191,s[p++]=189,_=null);m<128?s[p++]=m:(m<2048?s[p++]=m>>6|192:(m<65536?s[p++]=m>>12|224:(s[p++]=m>>18|240,s[p++]=m>>12&63|128),s[p++]=m>>6&63|128),s[p++]=63&m|128)}return p}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Vv(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Fv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Fv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&Vv(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,Ii.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,K1,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,J1,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Q1,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Y1,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,$1,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,ew,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,tw,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,iw,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,rw,t)},writeBytesField:function(i,t){this.writeTag(i,Ii.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ii.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ii.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ii.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ii.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ii.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ii.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ii.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ii.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ii.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var k_=U(Lv);const M_=3;function nw(i,t,r){i===1&&r.readMessage(sw,t)}function sw(i,t,r){if(i===3){const{id:s,bitmap:u,width:p,height:m,left:_,top:x,advance:P}=r.readMessage(ow,{});t.push({id:s,bitmap:new zu({width:p+2*M_,height:m+2*M_},u),metrics:{width:p,height:m,left:_,top:x,advance:P}})}}function ow(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const Uv=M_;function qv(i){let t=0,r=0;for(const m of i)t+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,_)=>_.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let u=0,p=0;for(const m of i)for(let _=s.length-1;_>=0;_--){const x=s[_];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const P=s.pop();_<s.length&&(s[_]=P)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(s.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}const dn=1;class z_{constructor(t,{pixelRatio:r,version:s,stretchX:u,stretchY:p,content:m,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=u,this.stretchY=p,this.content=m,this.version=s,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+dn,this.paddedRect.y+dn]}get br(){return[this.paddedRect.x+this.paddedRect.w-dn,this.paddedRect.y+this.paddedRect.h-dn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*dn)/this.pixelRatio,(this.paddedRect.h-2*dn)/this.pixelRatio]}}class Zv{constructor(t,r){const s={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,s,p),this.addImages(r,u,p);const{w:m,h:_}=qv(p),x=new Dn({width:m||1,height:_||1});for(const P in t){const C=t[P],k=s[P].paddedRect;Dn.copy(C.data,x,{x:0,y:0},{x:k.x+dn,y:k.y+dn},C.data)}for(const P in r){const C=r[P],k=u[P].paddedRect,D=k.x+dn,F=k.y+dn,N=C.data.width,q=C.data.height;Dn.copy(C.data,x,{x:0,y:0},{x:D,y:F},C.data),Dn.copy(C.data,x,{x:0,y:q-1},{x:D,y:F-1},{width:N,height:1}),Dn.copy(C.data,x,{x:0,y:0},{x:D,y:F+q},{width:N,height:1}),Dn.copy(C.data,x,{x:N-1,y:0},{x:D-1,y:F},{width:1,height:q}),Dn.copy(C.data,x,{x:0,y:0},{x:D+N,y:F},{width:1,height:q})}this.image=x,this.iconPositions=s,this.patternPositions=u}addImages(t,r,s){for(const u in t){const p=t[u],m={x:0,y:0,w:p.data.width+2*dn,h:p.data.height+2*dn};s.push(m),r[u]=new z_(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[u,p]=t.tl;s.update(r.data,void 0,{x:u,y:p})}}var zo;gt("ImagePosition",z_),gt("ImageAtlas",Zv),w.ah=void 0,(zo=w.ah||(w.ah={}))[zo.none=0]="none",zo[zo.horizontal=1]="horizontal",zo[zo.vertical=2]="vertical",zo[zo.horizontalOnly=3]="horizontalOnly";const Nu=-17;class Vu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Vu;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Vu;return r.imageName=t,r}}class Ll{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Ll;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?s.addImageSection(p):s.addTextSection(p,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const u=t.charCodeAt(s+1)||null,p=t.charCodeAt(s-1)||null;r+=u&&uf(u)&&!Bu[t[s+1]]||p&&uf(p)&&!Bu[t[s-1]]||!Bu[t[s]]?t[s]:Bu[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&If[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&If[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Ll;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Vu.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Fe("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Vu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tf(i,t,r,s,u,p,m,_,x,P,C,k,D,F,N){const q=Ll.fromFeature(i,u);let Y;k===w.ah.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:xe}=un;if(ie&&q.sections.length===1){Y=[];const Ce=ie(q.toString(),D_(q,P,p,t,s,F));for(const je of Ce){const ct=new Ll;ct.text=je,ct.sections=q.sections;for(let Dt=0;Dt<je.length;Dt++)ct.sectionIndex.push(0);Y.push(ct)}}else if(xe){Y=[];const Ce=xe(q.text,q.sectionIndex,D_(q,P,p,t,s,F));for(const je of Ce){const ct=new Ll;ct.text=je[0],ct.sectionIndex=je[1],ct.sections=q.sections,Y.push(ct)}}else Y=function(Ce,je){const ct=[],Dt=Ce.text;let ot=0;for(const nt of je)ct.push(Ce.substring(ot,nt)),ot=nt;return ot<Dt.length&&ct.push(Ce.substring(ot,Dt.length)),ct}(q,D_(q,P,p,t,s,F));const ue=[],ge={positionedLines:ue,text:q.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Ce,je,ct,Dt,ot,nt,wt,_t,ft,Me,Tt,bt){let Vt=0,ki=Nu,Ci=0,vr=0;const Hn=_t==="right"?1:_t==="left"?0:.5;let Or=0;for(const sr of ot){sr.trim();const br=sr.getMaxScale(),Ur=(br-1)*gr,Fr={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[Or]=Fr;const rn=Fr.positionedGlyphs;let Br=0;if(!sr.length()){ki+=nt,++Or;continue}for(let pn=0;pn<sr.length();pn++){const di=sr.getSection(pn),zi=sr.getSectionIndex(pn),Ni=sr.getCharCode(pn);let Sn=0,$i=null,Nl=null,ps=null,fs=gr;const Xn=!(ft===w.ah.horizontal||!Tt&&!Tu(Ni)||Tt&&(If[Ni]||(xr=Ni,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(xr)))));if(di.imageName){const On=Dt[di.imageName];if(!On)continue;ps=di.imageName,Ce.iconsInText=Ce.iconsInText||!0,Nl=On.paddedRect;const Tr=On.displaySize;di.scale=di.scale*gr/bt,$i={width:Tr[0],height:Tr[1],left:dn,top:-Uv,advance:Xn?Tr[1]:Tr[0]},Sn=Ur+(gr-Tr[1]*di.scale),fs=$i.advance;const Zs=Xn?Tr[0]*di.scale-gr*br:Tr[1]*di.scale-gr*br;Zs>0&&Zs>Br&&(Br=Zs)}else{const On=ct[di.fontStack],Tr=On&&On[Ni];if(Tr&&Tr.rect)Nl=Tr.rect,$i=Tr.metrics;else{const Zs=je[di.fontStack],Wu=Zs&&Zs[Ni];if(!Wu)continue;$i=Wu.metrics}Sn=(br-di.scale)*gr}Xn?(Ce.verticalizable=!0,rn.push({glyph:Ni,imageName:ps,x:Vt,y:ki+Sn,vertical:Xn,scale:di.scale,fontStack:di.fontStack,sectionIndex:zi,metrics:$i,rect:Nl}),Vt+=fs*di.scale+Me):(rn.push({glyph:Ni,imageName:ps,x:Vt,y:ki+Sn,vertical:Xn,scale:di.scale,fontStack:di.fontStack,sectionIndex:zi,metrics:$i,rect:Nl}),Vt+=$i.advance*di.scale+Me)}rn.length!==0&&(Ci=Math.max(Vt-Me,Ci),uw(rn,0,rn.length-1,Hn,Br)),Vt=0;const Ln=nt*br+Br;Fr.lineOffset=Math.max(Br,Ur),ki+=Ln,vr=Math.max(Ln,vr),++Or}var xr;const Qr=ki-Nu,{horizontalAlign:en,verticalAlign:tn}=R_(wt);(function(sr,br,Ur,Fr,rn,Br,Ln,pn,di){const zi=(br-Ur)*rn;let Ni=0;Ni=Br!==Ln?-pn*Fr-Nu:(-Fr*di+.5)*Ln;for(const Sn of sr)for(const $i of Sn.positionedGlyphs)$i.x+=zi,$i.y+=Ni})(Ce.positionedLines,Hn,en,tn,Ci,vr,nt,Qr,ot.length),Ce.top+=-tn*Qr,Ce.bottom=Ce.top+Qr,Ce.left+=-en*Ci,Ce.right=Ce.left+Ci}(ge,t,r,s,Y,m,_,x,k,P,D,N),!function(Ce){for(const je of Ce)if(je.positionedGlyphs.length!==0)return!1;return!0}(ue)&&ge}const If={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},aw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},lw={40:!0};function Gv(i,t,r,s,u,p){if(t.imageName){const m=s[t.imageName];return m?m.displaySize[0]*t.scale*gr/p+u:0}{const m=r[t.fontStack],_=m&&m[i];return _?_.metrics.advance*t.scale+u:0}}function Wv(i,t,r,s){const u=Math.pow(i-t,2);return s?i<t?u/2:2*u:u+Math.abs(r)*r}function cw(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function Hv(i,t,r,s,u,p){let m=null,_=Wv(t,r,u,p);for(const x of s){const P=Wv(t-x.x,r,u,p)+x.badness;P<=_&&(m=x,_=P)}return{index:i,x:t,priorBreak:m,badness:_}}function Xv(i){return i?Xv(i.priorBreak).concat(i.index):[]}function D_(i,t,r,s,u,p){if(!i)return[];const m=[],_=function(k,D,F,N,q,Y){let ie=0;for(let xe=0;xe<k.length();xe++){const ue=k.getSection(xe);ie+=Gv(k.getCharCode(xe),ue,N,q,D,Y)}return ie/Math.max(1,Math.ceil(ie/F))}(i,t,r,s,u,p),x=i.text.indexOf("​")>=0;let P=0;for(let k=0;k<i.length();k++){const D=i.getSection(k),F=i.getCharCode(k);if(If[F]||(P+=Gv(F,D,s,u,t,p)),k<i.length()-1){const N=!((C=F)<11904)&&(!!si["CJK Compatibility Forms"](C)||!!si["CJK Compatibility"](C)||!!si["CJK Strokes"](C)||!!si["CJK Symbols and Punctuation"](C)||!!si["Enclosed CJK Letters and Months"](C)||!!si["Halfwidth and Fullwidth Forms"](C)||!!si["Ideographic Description Characters"](C)||!!si["Vertical Forms"](C)||cf.test(String.fromCodePoint(C)));(aw[F]||N||D.imageName||k!==i.length()-2&&lw[i.getCharCode(k+1)])&&m.push(Hv(k+1,P,_,m,cw(F,i.getCharCode(k+1),N&&x),!1))}}var C;return Xv(Hv(i.length(),P,_,m,0,!0))}function R_(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function uw(i,t,r,s,u){if(!s&&!u)return;const p=i[r],m=(i[r].x+p.metrics.advance*p.scale)*s;for(let _=t;_<=r;_++)i[_].x-=m,i[_].y+=u}function hw(i,t,r){const{horizontalAlign:s,verticalAlign:u}=R_(r),p=t[0]-i.displaySize[0]*s,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Kv(i){var t,r;let s=i.left,u=i.top,p=i.right-s,m=i.bottom-u;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&p/m<P||_==="proportional"){const C=Math.ceil(m*P);s*=C/p,p=C}}else if(_==="proportional"&&x==="stretchOnly"&&P!==0&&p/m>P){const C=Math.ceil(p/P);u*=C/m,m=C}return{x1:s,y1:u,x2:s+p,y2:u+m}}function Jv(i,t,r,s,u,p){const m=i.image;let _;if(m.content){const Y=m.content,ie=m.pixelRatio||1;_=[Y[0]/ie,Y[1]/ie,m.displaySize[0]-Y[2]/ie,m.displaySize[1]-Y[3]/ie]}const x=t.left*p,P=t.right*p;let C,k,D,F;r==="width"||r==="both"?(F=u[0]+x-s[3],k=u[0]+P+s[1]):(F=u[0]+(x+P-m.displaySize[0])/2,k=F+m.displaySize[0]);const N=t.top*p,q=t.bottom*p;return r==="height"||r==="both"?(C=u[1]+N-s[0],D=u[1]+q+s[2]):(C=u[1]+(N+q-m.displaySize[1])/2,D=C+m.displaySize[1]),{image:m,top:C,right:k,bottom:D,left:F,collisionPadding:_}}const ju=255,ds=128,Do=ju*ds;function Yv(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Li(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=r;let p=0;for(;p<s.length&&s[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<s.length&&s[m]<i+1;)m++;m=Math.min(s.length-1,m);const _=s[p],x=s[m];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:x,minSize:r.evaluate(new Li(_)),maxSize:r.evaluate(new Li(x)),interpolationType:u}}}function L_(i,t,r){let s="never";const u=i.get(t);return u?s=u:i.get(r)&&(s="always"),s}const dw=Mo.VectorTileFeature.types,pw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Cf(i,t,r,s,u,p,m,_,x,P,C,k,D){const F=_?Math.min(Do,Math.round(_[0])):0,N=_?Math.min(Do,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*u),p,m,(F<<1)+(x?1:0),N,16*P,16*C,256*k,256*D)}function O_(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function fw(i){for(const t of i.sections)if(u_(t.text))return!0;return!1}class F_{constructor(t){this.layoutVertexArray=new Pl,this.indexArray=new zn,this.programConfigurations=t,this.segments=new oi,this.dynamicLayoutVertexArray=new Au,this.opacityVertexArray=new bn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Oi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Z1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,G1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,pw,!0),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}gt("SymbolBuffers",F_);class B_{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new oi,this.collisionVertexArray=new us}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,W1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}gt("CollisionBuffers",B_);class Ol{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=__([]),this.placementViewportMatrix=__([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yv(this.zoom,r["text-size"]),this.iconSizeData=Yv(this.zoom,r["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=L_(s,"text-overlap","text-allow-overlap")!=="never"||L_(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(m=>w.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new F_(new Ia(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new F_(new Ia(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Fi,this.lineVertexArray=new zr,this.symbolInstances=new ii,this.textAnchorOffsets=new Bi}calculateGlyphDependencies(t,r,s,u,p){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(s||u)&&p){const _=Bu[t.charAt(m)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,s){const u=this.layers[0],p=u.layout,m=p.get("text-font"),_=p.get("text-field"),x=p.get("icon-image"),P=(_.value.kind!=="constant"||_.value.value instanceof on&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),C=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!P&&!C)return;const D=r.iconDependencies,F=r.glyphDependencies,N=r.availableImages,q=new Li(this.zoom);for(const{feature:Y,id:ie,index:xe,sourceLayerIndex:ue}of t){const ge=u._featureFilter.needGeometry,Ce=Aa(Y,ge);if(!u._featureFilter.filter(q,Ce,s))continue;let je,ct;if(ge||(Ce.geometry=Ca(Y)),P){const ot=u.getValueAndResolveTokens("text-field",Ce,s,N),nt=on.factory(ot),wt=this.hasRTLText=this.hasRTLText||fw(nt);(!wt||un.getRTLTextPluginStatus()==="unavailable"||wt&&un.isParsed())&&(je=X1(nt,u,Ce))}if(C){const ot=u.getValueAndResolveTokens("icon-image",Ce,s,N);ct=ot instanceof ln?ot:ln.fromString(ot)}if(!je&&!ct)continue;const Dt=this.sortFeaturesByKey?k.evaluate(Ce,{},s):void 0;if(this.features.push({id:ie,text:je,icon:ct,index:xe,sourceLayerIndex:ue,geometry:Ce.geometry,properties:Y.properties,type:dw[Y.type],sortKey:Dt}),ct&&(D[ct.name]=!0),je){const ot=m.evaluate(Ce,{},s).join(","),nt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const wt of je.sections)if(wt.image)D[wt.image.name]=!0;else{const _t=Su(je.toString()),ft=wt.fontStack||ot,Me=F[ft]=F[ft]||{};this.calculateGlyphDependencies(wt.text,Me,nt,this.allowVerticalPlacement,_t)}}}p.get("symbol-placement")==="line"&&(this.features=function(Y){const ie={},xe={},ue=[];let ge=0;function Ce(ot){ue.push(Y[ot]),ge++}function je(ot,nt,wt){const _t=xe[ot];return delete xe[ot],xe[nt]=_t,ue[_t].geometry[0].pop(),ue[_t].geometry[0]=ue[_t].geometry[0].concat(wt[0]),_t}function ct(ot,nt,wt){const _t=ie[nt];return delete ie[nt],ie[ot]=_t,ue[_t].geometry[0].shift(),ue[_t].geometry[0]=wt[0].concat(ue[_t].geometry[0]),_t}function Dt(ot,nt,wt){const _t=wt?nt[0][nt[0].length-1]:nt[0][0];return`${ot}:${_t.x}:${_t.y}`}for(let ot=0;ot<Y.length;ot++){const nt=Y[ot],wt=nt.geometry,_t=nt.text?nt.text.toString():null;if(!_t){Ce(ot);continue}const ft=Dt(_t,wt),Me=Dt(_t,wt,!0);if(ft in xe&&Me in ie&&xe[ft]!==ie[Me]){const Tt=ct(ft,Me,wt),bt=je(ft,Me,ue[Tt].geometry);delete ie[ft],delete xe[Me],xe[Dt(_t,ue[bt].geometry,!0)]=bt,ue[Tt].geometry=null}else ft in xe?je(ft,Me,wt):Me in ie?ct(ft,Me,wt):(Ce(ot),ie[ft]=ge-1,xe[Me]=ge-1)}return ue.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,ie)=>Y.sortKey-ie.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]);const m={};for(let _=t.segment+1;_<r.length;_++)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const x=m[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,u,p,m,_,x,P,C,k,D){const F=t.indexArray,N=t.layoutVertexArray,q=t.segments.prepareSegment(4*r.length,N,F,this.canOverlap?m.sortKey:void 0),Y=this.glyphOffsetArray.length,ie=q.vertexLength,xe=this.allowVerticalPlacement&&_===w.ah.vertical?Math.PI/2:0,ue=m.text&&m.text.sections;for(let ge=0;ge<r.length;ge++){const{tl:Ce,tr:je,bl:ct,br:Dt,tex:ot,pixelOffsetTL:nt,pixelOffsetBR:wt,minFontScaleX:_t,minFontScaleY:ft,glyphOffset:Me,isSDF:Tt,sectionIndex:bt}=r[ge],Vt=q.vertexLength,ki=Me[1];Cf(N,x.x,x.y,Ce.x,ki+Ce.y,ot.x,ot.y,s,Tt,nt.x,nt.y,_t,ft),Cf(N,x.x,x.y,je.x,ki+je.y,ot.x+ot.w,ot.y,s,Tt,wt.x,nt.y,_t,ft),Cf(N,x.x,x.y,ct.x,ki+ct.y,ot.x,ot.y+ot.h,s,Tt,nt.x,wt.y,_t,ft),Cf(N,x.x,x.y,Dt.x,ki+Dt.y,ot.x+ot.w,ot.y+ot.h,s,Tt,wt.x,wt.y,_t,ft),O_(t.dynamicLayoutVertexArray,x,xe),F.emplaceBack(Vt,Vt+1,Vt+2),F.emplaceBack(Vt+1,Vt+2,Vt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Me[0]),ge!==r.length-1&&bt===r[ge+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,m,m.index,{},D,ue&&ue[bt])}t.placedSymbolArray.emplaceBack(x.x,x.y,Y,this.glyphOffsetArray.length-Y,ie,P,C,x.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],_,0,!1,0,k)}_addCollisionDebugVertex(t,r,s,u,p,m){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,u,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,s,u,p,m,_){const x=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),P=x.vertexLength,C=p.layoutVertexArray,k=p.collisionVertexArray,D=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(C,k,m,D,F,new j(t,r)),this._addCollisionDebugVertex(C,k,m,D,F,new j(s,r)),this._addCollisionDebugVertex(C,k,m,D,F,new j(s,u)),this._addCollisionDebugVertex(C,k,m,D,F,new j(t,u)),x.vertexLength+=4;const N=p.indexArray;N.emplaceBack(P,P+1),N.emplaceBack(P+1,P+2),N.emplaceBack(P+2,P+3),N.emplaceBack(P+3,P),x.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,u){for(let p=t;p<r;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new B_(wn,Rv.members,Pr),this.iconCollisionBox=new B_(wn,Rv.members,Pr);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,u,p,m,_,x,P){const C={};for(let k=r;k<s;k++){const D=t.get(k);C.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.textFeatureIndex=D.featureIndex;break}for(let k=u;k<p;k++){const D=t.get(k);C.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.verticalTextFeatureIndex=D.featureIndex;break}for(let k=m;k<_;k++){const D=t.get(k);C.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.iconFeatureIndex=D.featureIndex;break}for(let k=x;k<P;k++){const D=t.get(k);C.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},C.verticalIconFeatureIndex=D.featureIndex;break}return C}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),u=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),u=[],p=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const x=this.symbolInstances.get(_);u.push(0|Math.round(r*x.anchorX+s*x.anchorY)),p.push(x.featureIndex)}return m.sort((_,x)=>u[_]-u[x]||p[x]-p[_]),m}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((u,p,m)=>{u>=0&&m.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let $v,Qv;gt("SymbolBucket",Ol,{omit:["layers","collisionBoxArray","features","compareText"]}),Ol.MAX_GLYPHS=65535,Ol.addDynamicAttributes=O_;var N_={get paint(){return Qv=Qv||new d({"icon-opacity":new Lt(ye.paint_symbol["icon-opacity"]),"icon-color":new Lt(ye.paint_symbol["icon-color"]),"icon-halo-color":new Lt(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lt(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lt(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new vt(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new vt(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new Lt(ye.paint_symbol["text-opacity"]),"text-color":new Lt(ye.paint_symbol["text-color"],{runtimeType:dr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Lt(ye.paint_symbol["text-halo-color"]),"text-halo-width":new Lt(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Lt(ye.paint_symbol["text-halo-blur"]),"text-translate":new vt(ye.paint_symbol["text-translate"]),"text-translate-anchor":new vt(ye.paint_symbol["text-translate-anchor"])})},get layout(){return $v=$v||new d({"symbol-placement":new vt(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new vt(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new vt(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lt(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new vt(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new vt(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new vt(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new vt(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new vt(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new vt(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lt(ye.layout_symbol["icon-size"]),"icon-text-fit":new vt(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vt(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lt(ye.layout_symbol["icon-image"]),"icon-rotate":new Lt(ye.layout_symbol["icon-rotate"]),"icon-padding":new Lt(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new vt(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Lt(ye.layout_symbol["icon-offset"]),"icon-anchor":new Lt(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new vt(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new vt(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new vt(ye.layout_symbol["text-rotation-alignment"]),"text-field":new Lt(ye.layout_symbol["text-field"]),"text-font":new Lt(ye.layout_symbol["text-font"]),"text-size":new Lt(ye.layout_symbol["text-size"]),"text-max-width":new Lt(ye.layout_symbol["text-max-width"]),"text-line-height":new vt(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Lt(ye.layout_symbol["text-letter-spacing"]),"text-justify":new Lt(ye.layout_symbol["text-justify"]),"text-radial-offset":new Lt(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new vt(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Lt(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Lt(ye.layout_symbol["text-anchor"]),"text-max-angle":new vt(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new vt(ye.layout_symbol["text-writing-mode"]),"text-rotate":new Lt(ye.layout_symbol["text-rotate"]),"text-padding":new vt(ye.layout_symbol["text-padding"]),"text-keep-upright":new vt(ye.layout_symbol["text-keep-upright"]),"text-transform":new Lt(ye.layout_symbol["text-transform"]),"text-offset":new Lt(ye.layout_symbol["text-offset"]),"text-allow-overlap":new vt(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new vt(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new vt(ye.layout_symbol["text-ignore-placement"]),"text-optional":new vt(ye.layout_symbol["text-optional"])})}};class ex{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:wr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gt("FormatSectionOverride",ex,{omit:["defaultValue"]});class Af extends n{constructor(t){super(t,N_)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const p of s)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,u){const p=this.layout.get(t).evaluate(r,{},s,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||cl(m.value)||!p?p:function(_,x){return x.replace(/{([^{}]+)}/g,(P,C)=>_&&C in _?String(_[C]):"")}(r.properties,p)}createBucket(t){return new Ol(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of N_.paint.overridableProperties){if(!Af.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new ex(r),u=new ll(s,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new mo("source",u):new go("composite",u,r.value.zoomStops),this.paint._values[t]=new Gn(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Af.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),u=N_.paint.properties[r];let p=!1;const m=_=>{for(const x of _)if(u.overrides&&u.overrides.hasOverride(x))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof on)m(s.value.value.sections);else if(s.value.kind==="source"){const _=P=>{p||(P instanceof In&&fr(P.value)===Yn?m(P.value.sections):P instanceof Qa?m(P.sections):P.eachChild(_))},x=s.value;x._styleExpression&&_(x._styleExpression.expression)}return p}}let tx;var mw={get paint(){return tx=tx||new d({"background-color":new vt(ye.paint_background["background-color"]),"background-pattern":new wl(ye.paint_background["background-pattern"]),"background-opacity":new vt(ye.paint_background["background-opacity"])})}};class gw extends n{constructor(t){super(t,mw)}}let ix;var _w={get paint(){return ix=ix||new d({"raster-opacity":new vt(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new vt(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new vt(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new vt(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new vt(ye.paint_raster["raster-saturation"]),"raster-contrast":new vt(ye.paint_raster["raster-contrast"]),"raster-resampling":new vt(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new vt(ye.paint_raster["raster-fade-duration"])})}};class yw extends n{constructor(t){super(t,_w)}}class vw extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xw{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const V_=63710088e-1;class Ro{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ro(Xe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,u=t.lat*r,p=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((t.lng-this.lng)*r);return V_*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof Ro)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ro(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ro(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rx=2*Math.PI*V_;function nx(i){return rx*Math.cos(i*Math.PI/180)}function sx(i){return(180+i)/360}function ox(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ax(i,t){return i/nx(t)}function j_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Uu{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Ro.convert(t);return new Uu(sx(s.lng),ox(s.lat),ax(r,s.lat))}toLngLat(){return new Ro(360*this.x-180,j_(this.y))}toAltitude(){return this.z*nx(j_(this.y))}meterInMercatorCoordinateUnits(){return 1/rx*(t=j_(this.y),1/Math.cos(t*Math.PI/180));var t}}function lx(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class U_{constructor(t,r,s){if(!function(u,p,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=qu(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const u=(m=this.y,_=this.z,x=lx(256*(p=this.x),256*(m=Math.pow(2,_)-m-1),_),P=lx(256*(p+1),256*(m+1),_),x[0]+","+x[1]+","+P[0]+","+P[1]);var p,m,_,x,P;const C=function(k,D,F){let N,q="";for(let Y=k;Y>0;Y--)N=1<<Y-1,q+=(D&N?1:0)+(F&N?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,C).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new j((t.x*r-this.x)*mr,(t.y*r-this.y)*mr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cx{constructor(t,r){this.wrap=t,this.canonical=r,this.key=qu(t,r.z,r.z,r.x,r.y)}}class Rn{constructor(t,r,s,u,p){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new U_(s,+u,+p),this.key=qu(r,t,s,u,p)}clone(){return new Rn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Rn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?qu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):qu(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Rn(r,this.wrap,r,s,u),new Rn(r,this.wrap,r,s+1,u),new Rn(r,this.wrap,r,s,u+1),new Rn(r,this.wrap,r,s+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Uu(t.x-this.wrap,t.y))}}function qu(i,t,r,s,u){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*u+s).toString(36)+r.toString(36)+t.toString(36)}gt("CanonicalTileID",U_),gt("OverscaledTileID",Rn,{omit:["posMatrix"]});class ux{constructor(t,r,s,u=1,p=1,m=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Fe(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const x=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=m,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<x;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(x,P)]=this.data[this._idx(x-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,x)]=this.data[this._idx(P,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<x;P++)for(let C=0;C<x;C++){const k=this.get(P,C);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,r){const s=new Uint8Array(this.data.buffer),u=4*this._idx(t,r);return this.unpack(s[u],s[u+1],s[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Dn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,p=r*this.dim+this.dim,m=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:u=p-1;break;case 1:p=u+1}switch(s){case-1:m=_-1;break;case 1:_=m+1}const x=-r*this.dim,P=-s*this.dim;for(let C=m;C<_;C++)for(let k=u;k<p;k++)this.data[this._idx(k,C)]=t.data[this._idx(k+x,C+P)]}}gt("DEMData",ux);class hx{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class dx{constructor(t,r,s,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class px{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xo(mr,16,0),this.grid3D=new xo(mr,16,0),this.featureIndexArray=new Vr,this.promoteId=r}insert(t,r,s,u,p,m){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,p);const x=m?this.grid3D:this.grid;for(let P=0;P<r.length;P++){const C=r[P],k=[1/0,1/0,-1/0,-1/0];for(let D=0;D<C.length;D++){const F=C[D];k[0]=Math.min(k[0],F.x),k[1]=Math.min(k[1],F.y),k[2]=Math.max(k[2],F.x),k[3]=Math.max(k[3],F.y)}k[0]<mr&&k[1]<mr&&k[2]>=0&&k[3]>=0&&x.insert(_,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Mo.VectorTile(new k_(this.rawTileData)).layers,this.sourceLayerCoder=new hx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,u){this.loadVTLayers();const p=t.params||{},m=mr/t.tileSize/t.scale,_=lu(p.filter),x=t.queryGeometry,P=t.queryPadding*m,C=mx(x),k=this.grid.query(C.minX-P,C.minY-P,C.maxX+P,C.maxY+P),D=mx(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(Y,ie,xe,ue)=>function(ge,Ce,je,ct,Dt){for(const nt of ge)if(Ce<=nt.x&&je<=nt.y&&ct>=nt.x&&Dt>=nt.y)return!0;const ot=[new j(Ce,je),new j(Ce,Dt),new j(ct,Dt),new j(ct,je)];if(ge.length>2){for(const nt of ot)if(El(ge,nt))return!0}for(let nt=0;nt<ge.length-1;nt++)if(e1(ge[nt],ge[nt+1],ot))return!0;return!1}(t.cameraQueryGeometry,Y-P,ie-P,xe+P,ue+P));for(const Y of F)k.push(Y);k.sort(bw);const N={};let q;for(let Y=0;Y<k.length;Y++){const ie=k[Y];if(ie===q)continue;q=ie;const xe=this.featureIndexArray.get(ie);let ue=null;this.loadMatchingFeature(N,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,_,p.layers,p.availableImages,r,s,u,(ge,Ce,je)=>(ue||(ue=Ca(ge)),Ce.queryIntersectsFeature(x,ge,je,ue,this.z,t.transform,m,t.pixelPosMatrix)))}return N}loadMatchingFeature(t,r,s,u,p,m,_,x,P,C,k){const D=this.bucketLayerIDs[r];if(m&&!function(Y,ie){for(let xe=0;xe<Y.length;xe++)if(ie.indexOf(Y[xe])>=0)return!0;return!1}(m,D))return;const F=this.sourceLayerCoder.decode(s),N=this.vtLayers[F].feature(u);if(p.needGeometry){const Y=Aa(N,!0);if(!p.filter(new Li(this.tileID.overscaledZ),Y,this.tileID.canonical))return}else if(!p.filter(new Li(this.tileID.overscaledZ),N))return;const q=this.getId(N,F);for(let Y=0;Y<D.length;Y++){const ie=D[Y];if(m&&m.indexOf(ie)<0)continue;const xe=x[ie];if(!xe)continue;let ue={};q&&C&&(ue=C.getState(xe.sourceLayer||"_geojsonTileLayer",q));const ge=it({},P[ie]);ge.paint=fx(ge.paint,xe.paint,N,ue,_),ge.layout=fx(ge.layout,xe.layout,N,ue,_);const Ce=!k||k(N,xe,ue);if(!Ce)continue;const je=new dx(N,this.z,this.x,this.y,q);je.layer=ge;let ct=t[ie];ct===void 0&&(ct=t[ie]=[]),ct.push({featureIndex:u,feature:je,intersectionZ:Ce})}}lookupSymbolFeatures(t,r,s,u,p,m,_,x){const P={};this.loadVTLayers();const C=lu(p);for(const k of t)this.loadMatchingFeature(P,s,u,k,C,m,_,x,r);return P}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function fx(i,t,r,s,u){return Je(i,(p,m)=>{const _=t instanceof Sa?t.get(m):null;return _&&_.evaluate?_.evaluate(r,s,u):_})}function mx(i){let t=1/0,r=1/0,s=-1/0,u=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return{minX:t,minY:r,maxX:s,maxY:u}}function bw(i,t){return t-i}function gx(i,t,r,s,u){const p=[];for(let m=0;m<i.length;m++){const _=i[m];let x;for(let P=0;P<_.length-1;P++){let C=_[P],k=_[P+1];C.x<t&&k.x<t||(C.x<t?C=new j(t,C.y+(t-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x<t&&(k=new j(t,C.y+(t-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y<r&&k.y<r||(C.y<r?C=new j(C.x+(r-C.y)/(k.y-C.y)*(k.x-C.x),r)._round():k.y<r&&(k=new j(C.x+(r-C.y)/(k.y-C.y)*(k.x-C.x),r)._round()),C.x>=s&&k.x>=s||(C.x>=s?C=new j(s,C.y+(s-C.x)/(k.x-C.x)*(k.y-C.y))._round():k.x>=s&&(k=new j(s,C.y+(s-C.x)/(k.x-C.x)*(k.y-C.y))._round()),C.y>=u&&k.y>=u||(C.y>=u?C=new j(C.x+(u-C.y)/(k.y-C.y)*(k.x-C.x),u)._round():k.y>=u&&(k=new j(C.x+(u-C.y)/(k.y-C.y)*(k.x-C.x),u)._round()),x&&C.equals(x[x.length-1])||(x=[C],p.push(x)),x.push(k)))))}}return p}gt("FeatureIndex",px,{omit:["rawTileData","sourceLayerCoder"]});class Lo extends j{constructor(t,r,s,u){super(t,r),this.angle=s,u!==void 0&&(this.segment=u)}clone(){return new Lo(this.x,this.y,this.angle,this.segment)}}function _x(i,t,r,s,u){if(t.segment===void 0||r===0)return!0;let p=t,m=t.segment+1,_=0;for(;_>-r/2;){if(m--,m<0)return!1;_-=i[m].dist(p),p=i[m]}_+=i[m].dist(i[m+1]),m++;const x=[];let P=0;for(;_<r/2;){const C=i[m],k=i[m+1];if(!k)return!1;let D=i[m-1].angleTo(C)-C.angleTo(k);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:D}),P+=D;_-x[0].distance>s;)P-=x.shift().angleDelta;if(P>u)return!1;m++,_+=C.dist(k)}return!0}function yx(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function vx(i,t,r){return i?.6*t*r:0}function xx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function ww(i,t,r,s,u,p){const m=vx(r,u,p),_=xx(r,s)*p;let x=0;const P=yx(i)/2;for(let C=0;C<i.length-1;C++){const k=i[C],D=i[C+1],F=k.dist(D);if(x+F>P){const N=(P-x)/F,q=Kr.number(k.x,D.x,N),Y=Kr.number(k.y,D.y,N),ie=new Lo(q,Y,D.angleTo(k),C);return ie._round(),!m||_x(i,ie,_,m,t)?ie:void 0}x+=F}}function Sw(i,t,r,s,u,p,m,_,x){const P=vx(s,p,m),C=xx(s,u),k=C*m,D=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-k<t/4&&(t=k+t/4),bx(i,D?t/2*_%t:(C/2+2*p)*m*_%t,t,P,r,k,D,!1,x)}function bx(i,t,r,s,u,p,m,_,x){const P=p/2,C=yx(i);let k=0,D=t-r,F=[];for(let N=0;N<i.length-1;N++){const q=i[N],Y=i[N+1],ie=q.dist(Y),xe=Y.angleTo(q);for(;D+r<k+ie;){D+=r;const ue=(D-k)/ie,ge=Kr.number(q.x,Y.x,ue),Ce=Kr.number(q.y,Y.y,ue);if(ge>=0&&ge<x&&Ce>=0&&Ce<x&&D-P>=0&&D+P<=C){const je=new Lo(ge,Ce,xe,N);je._round(),s&&!_x(i,je,p,s,u)||F.push(je)}}k+=ie}return _||F.length||m||(F=bx(i,k/2,r,s,u,p,m,!0,x)),F}gt("Anchor",Lo);const Fl=dn;function wx(i,t,r,s){const u=[],p=i.image,m=p.pixelRatio,_=p.paddedRect.w-2*Fl,x=p.paddedRect.h-2*Fl;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const C=p.stretchX||[[0,_]],k=p.stretchY||[[0,x]],D=(Me,Tt)=>Me+Tt[1]-Tt[0],F=C.reduce(D,0),N=k.reduce(D,0),q=_-F,Y=x-N;let ie=0,xe=F,ue=0,ge=N,Ce=0,je=q,ct=0,Dt=Y;if(p.content&&s){const Me=p.content,Tt=Me[2]-Me[0],bt=Me[3]-Me[1];(p.textFitWidth||p.textFitHeight)&&(P=Kv(i)),ie=Ef(C,0,Me[0]),ue=Ef(k,0,Me[1]),xe=Ef(C,Me[0],Me[2]),ge=Ef(k,Me[1],Me[3]),Ce=Me[0]-ie,ct=Me[1]-ue,je=Tt-xe,Dt=bt-ge}const ot=P.x1,nt=P.y1,wt=P.x2-ot,_t=P.y2-nt,ft=(Me,Tt,bt,Vt)=>{const ki=kf(Me.stretch-ie,xe,wt,ot),Ci=Mf(Me.fixed-Ce,je,Me.stretch,F),vr=kf(Tt.stretch-ue,ge,_t,nt),Hn=Mf(Tt.fixed-ct,Dt,Tt.stretch,N),Or=kf(bt.stretch-ie,xe,wt,ot),xr=Mf(bt.fixed-Ce,je,bt.stretch,F),Qr=kf(Vt.stretch-ue,ge,_t,nt),en=Mf(Vt.fixed-ct,Dt,Vt.stretch,N),tn=new j(ki,vr),sr=new j(Or,vr),br=new j(Or,Qr),Ur=new j(ki,Qr),Fr=new j(Ci/m,Hn/m),rn=new j(xr/m,en/m),Br=t*Math.PI/180;if(Br){const di=Math.sin(Br),zi=Math.cos(Br),Ni=[zi,-di,di,zi];tn._matMult(Ni),sr._matMult(Ni),Ur._matMult(Ni),br._matMult(Ni)}const Ln=Me.stretch+Me.fixed,pn=Tt.stretch+Tt.fixed;return{tl:tn,tr:sr,bl:Ur,br,tex:{x:p.paddedRect.x+Fl+Ln,y:p.paddedRect.y+Fl+pn,w:bt.stretch+bt.fixed-Ln,h:Vt.stretch+Vt.fixed-pn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fr,pixelOffsetBR:rn,minFontScaleX:je/m/wt,minFontScaleY:Dt/m/_t,isSDF:r}};if(s&&(p.stretchX||p.stretchY)){const Me=Sx(C,q,F),Tt=Sx(k,Y,N);for(let bt=0;bt<Me.length-1;bt++){const Vt=Me[bt],ki=Me[bt+1];for(let Ci=0;Ci<Tt.length-1;Ci++)u.push(ft(Vt,Tt[Ci],ki,Tt[Ci+1]))}}else u.push(ft({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return u}function Ef(i,t,r){let s=0;for(const u of i)s+=Math.max(t,Math.min(r,u[1]))-Math.max(t,Math.min(r,u[0]));return s}function Sx(i,t,r){const s=[{fixed:-Fl,stretch:0}];for(const[u,p]of i){const m=s[s.length-1];s.push({fixed:u-m.stretch,stretch:m.stretch}),s.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return s.push({fixed:t+Fl,stretch:r}),s}function kf(i,t,r,s){return i/t*r+s}function Mf(i,t,r,s){return i-t*r/s}class zf{constructor(t,r,s,u,p,m,_,x,P,C){var k;if(this.boxStartIndex=t.length,P){let D=m.top,F=m.bottom;const N=m.collisionPadding;N&&(D-=N[1],F+=N[3]);let q=F-D;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const D=!((k=m.image)===null||k===void 0)&&k.content&&(m.image.textFitWidth||m.image.textFitHeight)?Kv(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*_-x[0],D.y2=D.y2*_+x[2],D.x1=D.x1*_-x[3],D.x2=D.x2*_+x[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*_,D.y1-=F[1]*_,D.x2+=F[2]*_,D.y2+=F[3]*_),C){const N=new j(D.x1,D.y1),q=new j(D.x2,D.y1),Y=new j(D.x1,D.y2),ie=new j(D.x2,D.y2),xe=C*Math.PI/180;N._rotate(xe),q._rotate(xe),Y._rotate(xe),ie._rotate(xe),D.x1=Math.min(N.x,q.x,Y.x,ie.x),D.x2=Math.max(N.x,q.x,Y.x,ie.x),D.y1=Math.min(N.y,q.y,Y.y,ie.y),D.y2=Math.max(N.y,q.y,Y.y,ie.y)}t.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,s,u,p)}this.boxEndIndex=t.length}}class Pw{constructor(t=[],r=(s,u)=>s<u?-1:s>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,u=r[t];for(;t>0;){const p=t-1>>1,m=r[p];if(s(u,m)>=0)break;r[t]=m,t=p}r[t]=u}_down(t){const{data:r,compare:s}=this,u=this.length>>1,p=r[t];for(;t<u;){let m=1+(t<<1);const _=m+1;if(_<this.length&&s(r[_],r[m])<0&&(m=_),s(r[m],p)>=0)break;r[t]=r[m],t=m}r[t]=p}}function Tw(i,t=1,r=!1){let s=1/0,u=1/0,p=-1/0,m=-1/0;const _=i[0];for(let F=0;F<_.length;F++){const N=_[F];(!F||N.x<s)&&(s=N.x),(!F||N.y<u)&&(u=N.y),(!F||N.x>p)&&(p=N.x),(!F||N.y>m)&&(m=N.y)}const x=Math.min(p-s,m-u);let P=x/2;const C=new Pw([],Iw);if(x===0)return new j(s,u);for(let F=s;F<p;F+=x)for(let N=u;N<m;N+=x)C.push(new Bl(F+P,N+P,P,i));let k=function(F){let N=0,q=0,Y=0;const ie=F[0];for(let xe=0,ue=ie.length,ge=ue-1;xe<ue;ge=xe++){const Ce=ie[xe],je=ie[ge],ct=Ce.x*je.y-je.x*Ce.y;q+=(Ce.x+je.x)*ct,Y+=(Ce.y+je.y)*ct,N+=3*ct}return new Bl(q/N,Y/N,0,F)}(i),D=C.length;for(;C.length;){const F=C.pop();(F.d>k.d||!k.d)&&(k=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-k.d<=t||(P=F.h/2,C.push(new Bl(F.p.x-P,F.p.y-P,P,i)),C.push(new Bl(F.p.x+P,F.p.y-P,P,i)),C.push(new Bl(F.p.x-P,F.p.y+P,P,i)),C.push(new Bl(F.p.x+P,F.p.y+P,P,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${k.d}`)),k.p}function Iw(i,t){return t.max-i.max}function Bl(i,t,r,s){this.p=new j(i,t),this.h=r,this.d=function(u,p){let m=!1,_=1/0;for(let x=0;x<p.length;x++){const P=p[x];for(let C=0,k=P.length,D=k-1;C<k;D=C++){const F=P[C],N=P[D];F.y>u.y!=N.y>u.y&&u.x<(N.x-F.x)*(u.y-F.y)/(N.y-F.y)+F.x&&(m=!m),_=Math.min(_,ov(u,F,N))}}return(m?1:-1)*Math.sqrt(_)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Lr;w.aq=void 0,(Lr=w.aq||(w.aq={}))[Lr.center=1]="center",Lr[Lr.left=2]="left",Lr[Lr.right=3]="right",Lr[Lr.top=4]="top",Lr[Lr.bottom=5]="bottom",Lr[Lr["top-left"]=6]="top-left",Lr[Lr["top-right"]=7]="top-right",Lr[Lr["bottom-left"]=8]="bottom-left",Lr[Lr["bottom-right"]=9]="bottom-right";const Oo=7,q_=Number.POSITIVE_INFINITY;function Px(i,t){return t[1]!==q_?function(r,s,u){let p=0,m=0;switch(s=Math.abs(s),u=Math.abs(u),r){case"top-right":case"top-left":case"top":m=u-Oo;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Oo}switch(r){case"top-right":case"bottom-right":case"right":p=-s;break;case"top-left":case"bottom-left":case"left":p=s}return[p,m]}(i,t[0],t[1]):function(r,s){let u=0,p=0;s<0&&(s=0);const m=s/Math.SQRT2;switch(r){case"top-right":case"top-left":p=m-Oo;break;case"bottom-right":case"bottom-left":p=-m+Oo;break;case"bottom":p=-s+Oo;break;case"top":p=s-Oo}switch(r){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=s;break;case"right":u=-s}return[u,p]}(i,t[0])}function Tx(i,t,r){var s;const u=i.layout,p=(s=u.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(p){const _=p.values,x=[];for(let P=0;P<_.length;P+=2){const C=x[P]=_[P],k=_[P+1].map(D=>D*gr);C.startsWith("top")?k[1]-=Oo:C.startsWith("bottom")&&(k[1]+=Oo),x[P+1]=k}return new gn(x)}const m=u.get("text-variable-anchor");if(m){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},r)*gr,q_]:u.get("text-offset").evaluate(t,{},r).map(P=>P*gr);const x=[];for(const P of m)x.push(P,Px(P,_));return new gn(x)}return null}function Z_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cw(i,t,r,s,u,p,m,_,x,P,C){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=m);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},C),N=Cx(r.horizontal),q=m/24,Y=i.tilePixelRatio*q,ie=i.tilePixelRatio*k/24,xe=i.tilePixelRatio*_,ue=i.tilePixelRatio*D.get("symbol-spacing"),ge=D.get("text-padding")*i.tilePixelRatio,Ce=function(Me,Tt,bt,Vt=1){const ki=Me.get("icon-padding").evaluate(Tt,{},bt),Ci=ki&&ki.values;return[Ci[0]*Vt,Ci[1]*Vt,Ci[2]*Vt,Ci[3]*Vt]}(D,t,C,i.tilePixelRatio),je=D.get("text-max-angle")/180*Math.PI,ct=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Dt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ot=D.get("symbol-placement"),nt=ue/2,wt=D.get("icon-text-fit");let _t;s&&wt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(_t=Jv(s,r.vertical,wt,D.get("icon-text-fit-padding"),F,q)),N&&(s=Jv(s,N,wt,D.get("icon-text-fit-padding"),F,q)));const ft=(Me,Tt)=>{Tt.x<0||Tt.x>=mr||Tt.y<0||Tt.y>=mr||function(bt,Vt,ki,Ci,vr,Hn,Or,xr,Qr,en,tn,sr,br,Ur,Fr,rn,Br,Ln,pn,di,zi,Ni,Sn,$i,Nl){const ps=bt.addToLineVertexArray(Vt,ki);let fs,Xn,On,Tr,Zs=0,Wu=0,Mx=0,zx=0,$_=-1,Q_=-1;const Gs={};let Dx=Tl("");if(bt.allowVerticalPlacement&&Ci.vertical){const qr=xr.layout.get("text-rotate").evaluate(zi,{},$i)+90;On=new zf(Qr,Vt,en,tn,sr,Ci.vertical,br,Ur,Fr,qr),Or&&(Tr=new zf(Qr,Vt,en,tn,sr,Or,Br,Ln,Fr,qr))}if(vr){const qr=xr.layout.get("icon-rotate").evaluate(zi,{}),Fn=xr.layout.get("icon-text-fit")!=="none",ka=wx(vr,qr,Sn,Fn),is=Or?wx(Or,qr,Sn,Fn):void 0;Xn=new zf(Qr,Vt,en,tn,sr,vr,Br,Ln,!1,qr),Zs=4*ka.length;const Ma=bt.iconSizeData;let ms=null;Ma.kind==="source"?(ms=[ds*xr.layout.get("icon-size").evaluate(zi,{})],ms[0]>Do&&Fe(`${bt.layerIds[0]}: Value for "icon-size" is >= ${ju}. Reduce your "icon-size".`)):Ma.kind==="composite"&&(ms=[ds*Ni.compositeIconSizes[0].evaluate(zi,{},$i),ds*Ni.compositeIconSizes[1].evaluate(zi,{},$i)],(ms[0]>Do||ms[1]>Do)&&Fe(`${bt.layerIds[0]}: Value for "icon-size" is >= ${ju}. Reduce your "icon-size".`)),bt.addSymbols(bt.icon,ka,ms,di,pn,zi,w.ah.none,Vt,ps.lineStartIndex,ps.lineLength,-1,$i),$_=bt.icon.placedSymbolArray.length-1,is&&(Wu=4*is.length,bt.addSymbols(bt.icon,is,ms,di,pn,zi,w.ah.vertical,Vt,ps.lineStartIndex,ps.lineLength,-1,$i),Q_=bt.icon.placedSymbolArray.length-1)}const Rx=Object.keys(Ci.horizontal);for(const qr of Rx){const Fn=Ci.horizontal[qr];if(!fs){Dx=Tl(Fn.text);const is=xr.layout.get("text-rotate").evaluate(zi,{},$i);fs=new zf(Qr,Vt,en,tn,sr,Fn,br,Ur,Fr,is)}const ka=Fn.positionedLines.length===1;if(Mx+=Ix(bt,Vt,Fn,Hn,xr,Fr,zi,rn,ps,Ci.vertical?w.ah.horizontal:w.ah.horizontalOnly,ka?Rx:[qr],Gs,$_,Ni,$i),ka)break}Ci.vertical&&(zx+=Ix(bt,Vt,Ci.vertical,Hn,xr,Fr,zi,rn,ps,w.ah.vertical,["vertical"],Gs,Q_,Ni,$i));const kw=fs?fs.boxStartIndex:bt.collisionBoxArray.length,Mw=fs?fs.boxEndIndex:bt.collisionBoxArray.length,zw=On?On.boxStartIndex:bt.collisionBoxArray.length,Dw=On?On.boxEndIndex:bt.collisionBoxArray.length,Rw=Xn?Xn.boxStartIndex:bt.collisionBoxArray.length,Lw=Xn?Xn.boxEndIndex:bt.collisionBoxArray.length,Ow=Tr?Tr.boxStartIndex:bt.collisionBoxArray.length,Fw=Tr?Tr.boxEndIndex:bt.collisionBoxArray.length;let ts=-1;const Rf=(qr,Fn)=>qr&&qr.circleDiameter?Math.max(qr.circleDiameter,Fn):Fn;ts=Rf(fs,ts),ts=Rf(On,ts),ts=Rf(Xn,ts),ts=Rf(Tr,ts);const Lx=ts>-1?1:0;Lx&&(ts*=Nl/gr),bt.glyphOffsetArray.length>=Ol.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zi.sortKey!==void 0&&bt.addToSortKeyRanges(bt.symbolInstances.length,zi.sortKey);const Bw=Tx(xr,zi,$i),[Nw,Vw]=function(qr,Fn){const ka=qr.length,is=Fn==null?void 0:Fn.values;if((is==null?void 0:is.length)>0)for(let Ma=0;Ma<is.length;Ma+=2){const ms=is[Ma+1];qr.emplaceBack(w.aq[is[Ma]],ms[0],ms[1])}return[ka,qr.length]}(bt.textAnchorOffsets,Bw);bt.symbolInstances.emplaceBack(Vt.x,Vt.y,Gs.right>=0?Gs.right:-1,Gs.center>=0?Gs.center:-1,Gs.left>=0?Gs.left:-1,Gs.vertical||-1,$_,Q_,Dx,kw,Mw,zw,Dw,Rw,Lw,Ow,Fw,en,Mx,zx,Zs,Wu,Lx,0,br,ts,Nw,Vw)}(i,Tt,Me,r,s,u,_t,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Y,[ge,ge,ge,ge],ct,x,xe,Ce,Dt,F,t,p,P,C,m)};if(ot==="line")for(const Me of gx(t.geometry,0,0,mr,mr)){const Tt=Sw(Me,ue,je,r.vertical||N,s,24,ie,i.overscaling,mr);for(const bt of Tt)N&&Aw(i,N.text,nt,bt)||ft(Me,bt)}else if(ot==="line-center"){for(const Me of t.geometry)if(Me.length>1){const Tt=ww(Me,je,r.vertical||N,s,24,ie);Tt&&ft(Me,Tt)}}else if(t.type==="Polygon")for(const Me of tl(t.geometry,0)){const Tt=Tw(Me,16);ft(Me[0],new Lo(Tt.x,Tt.y,0))}else if(t.type==="LineString")for(const Me of t.geometry)ft(Me,new Lo(Me[0].x,Me[0].y,0));else if(t.type==="Point")for(const Me of t.geometry)for(const Tt of Me)ft([Tt],new Lo(Tt.x,Tt.y,0))}function Ix(i,t,r,s,u,p,m,_,x,P,C,k,D,F,N){const q=function(xe,ue,ge,Ce,je,ct,Dt,ot){const nt=Ce.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,wt=[];for(const _t of ue.positionedLines)for(const ft of _t.positionedGlyphs){if(!ft.rect)continue;const Me=ft.rect||{};let Tt=Uv+1,bt=!0,Vt=1,ki=0;const Ci=(je||ot)&&ft.vertical,vr=ft.metrics.advance*ft.scale/2;if(ot&&ue.verticalizable&&(ki=_t.lineOffset/2-(ft.imageName?-(gr-ft.metrics.width*ft.scale)/2:(ft.scale-1)*gr)),ft.imageName){const di=Dt[ft.imageName];bt=di.sdf,Vt=di.pixelRatio,Tt=dn/Vt}const Hn=je?[ft.x+vr,ft.y]:[0,0];let Or=je?[0,0]:[ft.x+vr+ge[0],ft.y+ge[1]-ki],xr=[0,0];Ci&&(xr=Or,Or=[0,0]);const Qr=ft.metrics.isDoubleResolution?2:1,en=(ft.metrics.left-Tt)*ft.scale-vr+Or[0],tn=(-ft.metrics.top-Tt)*ft.scale+Or[1],sr=en+Me.w/Qr*ft.scale/Vt,br=tn+Me.h/Qr*ft.scale/Vt,Ur=new j(en,tn),Fr=new j(sr,tn),rn=new j(en,br),Br=new j(sr,br);if(Ci){const di=new j(-vr,vr-Nu),zi=-Math.PI/2,Ni=gr/2-vr,Sn=new j(5-Nu-Ni,-(ft.imageName?Ni:0)),$i=new j(...xr);Ur._rotateAround(zi,di)._add(Sn)._add($i),Fr._rotateAround(zi,di)._add(Sn)._add($i),rn._rotateAround(zi,di)._add(Sn)._add($i),Br._rotateAround(zi,di)._add(Sn)._add($i)}if(nt){const di=Math.sin(nt),zi=Math.cos(nt),Ni=[zi,-di,di,zi];Ur._matMult(Ni),Fr._matMult(Ni),rn._matMult(Ni),Br._matMult(Ni)}const Ln=new j(0,0),pn=new j(0,0);wt.push({tl:Ur,tr:Fr,bl:rn,br:Br,tex:Me,writingMode:ue.writingMode,glyphOffset:Hn,sectionIndex:ft.sectionIndex,isSDF:bt,pixelOffsetTL:Ln,pixelOffsetBR:pn,minFontScaleX:0,minFontScaleY:0})}return wt}(0,r,_,u,p,m,s,i.allowVerticalPlacement),Y=i.textSizeData;let ie=null;Y.kind==="source"?(ie=[ds*u.layout.get("text-size").evaluate(m,{})],ie[0]>Do&&Fe(`${i.layerIds[0]}: Value for "text-size" is >= ${ju}. Reduce your "text-size".`)):Y.kind==="composite"&&(ie=[ds*F.compositeTextSizes[0].evaluate(m,{},N),ds*F.compositeTextSizes[1].evaluate(m,{},N)],(ie[0]>Do||ie[1]>Do)&&Fe(`${i.layerIds[0]}: Value for "text-size" is >= ${ju}. Reduce your "text-size".`)),i.addSymbols(i.text,q,ie,_,p,m,P,t,x.lineStartIndex,x.lineLength,D,N);for(const xe of C)k[xe]=i.text.placedSymbolArray.length-1;return 4*q.length}function Cx(i){for(const t in i)return i[t];return null}function Aw(i,t,r,s){const u=i.compareText;if(t in u){const p=u[t];for(let m=p.length-1;m>=0;m--)if(s.dist(p[m])<r)return!0}else u[t]=[];return u[t].push(s),!1}const Ax=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class G_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=Ax[15&s];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new G_(_,m,p,t)}constructor(t,r=64,s=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=Ax.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return W_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:_}=this,x=[0,p.length-1,0],P=[];for(;x.length;){const C=x.pop()||0,k=x.pop()||0,D=x.pop()||0;if(k-D<=_){for(let Y=D;Y<=k;Y++){const ie=m[2*Y],xe=m[2*Y+1];ie>=t&&ie<=s&&xe>=r&&xe<=u&&P.push(p[Y])}continue}const F=D+k>>1,N=m[2*F],q=m[2*F+1];N>=t&&N<=s&&q>=r&&q<=u&&P.push(p[F]),(C===0?t<=N:r<=q)&&(x.push(D),x.push(F-1),x.push(1-C)),(C===0?s>=N:u>=q)&&(x.push(F+1),x.push(k),x.push(1-C))}return P}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,_=[0,u.length-1,0],x=[],P=s*s;for(;_.length;){const C=_.pop()||0,k=_.pop()||0,D=_.pop()||0;if(k-D<=m){for(let Y=D;Y<=k;Y++)kx(p[2*Y],p[2*Y+1],t,r)<=P&&x.push(u[Y]);continue}const F=D+k>>1,N=p[2*F],q=p[2*F+1];kx(N,q,t,r)<=P&&x.push(u[F]),(C===0?t-s<=N:r-s<=q)&&(_.push(D),_.push(F-1),_.push(1-C)),(C===0?t+s>=N:r+s>=q)&&(_.push(F+1),_.push(k),_.push(1-C))}return x}}function W_(i,t,r,s,u,p){if(u-s<=r)return;const m=s+u>>1;Ex(i,t,m,s,u,p),W_(i,t,r,s,m-1,1-p),W_(i,t,r,m+1,u,1-p)}function Ex(i,t,r,s,u,p){for(;u>s;){if(u-s>600){const P=u-s+1,C=r-s+1,k=Math.log(P),D=.5*Math.exp(2*k/3),F=.5*Math.sqrt(k*D*(P-D)/P)*(C-P/2<0?-1:1);Ex(i,t,r,Math.max(s,Math.floor(r-C*D/P+F)),Math.min(u,Math.floor(r+(P-C)*D/P+F)),p)}const m=t[2*r+p];let _=s,x=u;for(Zu(i,t,s,r),t[2*u+p]>m&&Zu(i,t,s,u);_<x;){for(Zu(i,t,_,x),_++,x--;t[2*_+p]<m;)_++;for(;t[2*x+p]>m;)x--}t[2*s+p]===m?Zu(i,t,s,x):(x++,Zu(i,t,x,u)),x<=r&&(s=x+1),r<=x&&(u=x-1)}}function Zu(i,t,r,s){H_(i,r,s),H_(t,2*r,2*s),H_(t,2*r+1,2*s+1)}function H_(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function kx(i,t,r,s){const u=i-r,p=t-s;return u*u+p*p}var X_;w.bg=void 0,(X_=w.bg||(w.bg={})).create="create",X_.load="load",X_.fullLoad="fullLoad";let Df=null,Gu=[];const K_=1e3/60,J_="loadTime",Y_="fullLoadTime",Ew={mark(i){performance.mark(i)},frame(i){const t=i;Df!=null&&Gu.push(t-Df),Df=t},clearMetrics(){Df=null,Gu=[],performance.clearMeasures(J_),performance.clearMeasures(Y_);for(const i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(J_,w.bg.create,w.bg.load),performance.measure(Y_,w.bg.create,w.bg.fullLoad);const i=performance.getEntriesByName(J_)[0].duration,t=performance.getEntriesByName(Y_)[0].duration,r=Gu.length,s=1/(Gu.reduce((p,m)=>p+m,0)/r/1e3),u=Gu.filter(p=>p>K_).reduce((p,m)=>p+(m-K_)/K_,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};w.$=class extends M{},w.A=kl,w.B=s_,w.C=function(i){if(Ke==null){const t=i.navigator?i.navigator.userAgent:null;Ke=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Ke},w.D=vt,w.E=kt,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xw(()=>this.process()),this.subscription=function(r,s,u,p){return r.addEventListener(s,u,!1),{unsubscribe:()=>{r.removeEventListener(s,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Le(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const p=[],m=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:bo(i.data,p)});this.target.postMessage(m,{transfer:p})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Le(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(wo(t.error)):u.resolve(wo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=wo(t.data),s=new AbortController;this.abortControllers[i]=s;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?bo(t):null,data:bo(r,s)};this.target.postMessage(u,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=_i,w.H=function(){var i=new kl(16);return kl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=z_,w.J=function(i,t,r){var s,u,p,m,_,x,P,C,k,D,F,N,q=r[0],Y=r[1],ie=r[2];return t===i?(i[12]=t[0]*q+t[4]*Y+t[8]*ie+t[12],i[13]=t[1]*q+t[5]*Y+t[9]*ie+t[13],i[14]=t[2]*q+t[6]*Y+t[10]*ie+t[14],i[15]=t[3]*q+t[7]*Y+t[11]*ie+t[15]):(u=t[1],p=t[2],m=t[3],_=t[4],x=t[5],P=t[6],C=t[7],k=t[8],D=t[9],F=t[10],N=t[11],i[0]=s=t[0],i[1]=u,i[2]=p,i[3]=m,i[4]=_,i[5]=x,i[6]=P,i[7]=C,i[8]=k,i[9]=D,i[10]=F,i[11]=N,i[12]=s*q+_*Y+k*ie+t[12],i[13]=u*q+x*Y+D*ie+t[13],i[14]=p*q+P*Y+F*ie+t[14],i[15]=m*q+C*Y+N*ie+t[15]),i},w.K=function(i,t,r){var s=r[0],u=r[1],p=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=uv,w.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const u=t[s];u in i&&(r[u]=i[u])}return r},w.N=Ro,w.O=sx,w.P=j,w.Q=ox,w.R=Dn,w.S=Rn,w.T=xl,w.U=Ie,w.V=_e,w.W=lt,w.X=mr,w.Y=y,w.Z=Uu,w._=c,w.a=li,w.a$=function(i,t){var r=i[0],s=i[1],u=i[2],p=i[3],m=i[4],_=i[5],x=i[6],P=i[7],C=i[8],k=i[9],D=i[10],F=i[11],N=i[12],q=i[13],Y=i[14],ie=i[15],xe=t[0],ue=t[1],ge=t[2],Ce=t[3],je=t[4],ct=t[5],Dt=t[6],ot=t[7],nt=t[8],wt=t[9],_t=t[10],ft=t[11],Me=t[12],Tt=t[13],bt=t[14],Vt=t[15];return Math.abs(r-xe)<=$r*Math.max(1,Math.abs(r),Math.abs(xe))&&Math.abs(s-ue)<=$r*Math.max(1,Math.abs(s),Math.abs(ue))&&Math.abs(u-ge)<=$r*Math.max(1,Math.abs(u),Math.abs(ge))&&Math.abs(p-Ce)<=$r*Math.max(1,Math.abs(p),Math.abs(Ce))&&Math.abs(m-je)<=$r*Math.max(1,Math.abs(m),Math.abs(je))&&Math.abs(_-ct)<=$r*Math.max(1,Math.abs(_),Math.abs(ct))&&Math.abs(x-Dt)<=$r*Math.max(1,Math.abs(x),Math.abs(Dt))&&Math.abs(P-ot)<=$r*Math.max(1,Math.abs(P),Math.abs(ot))&&Math.abs(C-nt)<=$r*Math.max(1,Math.abs(C),Math.abs(nt))&&Math.abs(k-wt)<=$r*Math.max(1,Math.abs(k),Math.abs(wt))&&Math.abs(D-_t)<=$r*Math.max(1,Math.abs(D),Math.abs(_t))&&Math.abs(F-ft)<=$r*Math.max(1,Math.abs(F),Math.abs(ft))&&Math.abs(N-Me)<=$r*Math.max(1,Math.abs(N),Math.abs(Me))&&Math.abs(q-Tt)<=$r*Math.max(1,Math.abs(q),Math.abs(Tt))&&Math.abs(Y-bt)<=$r*Math.max(1,Math.abs(Y),Math.abs(bt))&&Math.abs(ie-Vt)<=$r*Math.max(1,Math.abs(ie),Math.abs(Vt))},w.a0=oi,w.a1=U_,w.a2=Ve,w.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const u=window.document.createElement("source");qi(s)||(t.crossOrigin="Anonymous"),u.src=s,t.appendChild(u)}})},w.a4=function(){return Ct++},w.a5=at,w.a6=Ol,w.a7=lu,w.a8=Aa,w.a9=dx,w.aA=function(i){if(i.type==="custom")return new vw(i);switch(i.type){case"background":return new gw(i);case"circle":return new r1(i);case"fill":return new x1(i);case"fill-extrusion":return new L1(i);case"heatmap":return new s1(i);case"hillshade":return new a1(i);case"line":return new q1(i);case"raster":return new yw(i);case"symbol":return new Af(i)}},w.aB=dt,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Ht(i.version,t.version))return[{command:"setStyle",args:[t]}];Ht(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Ht(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Ht(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Ht(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Ht(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Ht(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Ht(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Ht(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Ht(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Ht(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Ht(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},u=[];(function(m,_,x,P){let C;for(C in _=_||{},m=m||{})Object.prototype.hasOwnProperty.call(m,C)&&(Object.prototype.hasOwnProperty.call(_,C)||xi(C,x,P));for(C in _)Object.prototype.hasOwnProperty.call(_,C)&&(Object.prototype.hasOwnProperty.call(m,C)?Ht(m[C],_[C])||(m[C].type==="geojson"&&_[C].type==="geojson"&&ar(m,_,C)?vi(x,{command:"setGeoJSONSourceData",args:[C,_[C].data]}):tr(C,_,x,P)):Ki(C,_,x))})(i.sources,t.sources,u,s);const p=[];i.layers&&i.layers.forEach(m=>{"source"in m&&s[m.source]?r.push({command:"removeLayer",args:[m.id]}):p.push(m)}),r=r.concat(u),function(m,_,x){_=_||[];const P=(m=m||[]).map(hr),C=_.map(hr),k=m.reduce(Er,{}),D=_.reduce(Er,{}),F=P.slice(),N=Object.create(null);let q,Y,ie,xe,ue;for(let ge=0,Ce=0;ge<P.length;ge++)q=P[ge],Object.prototype.hasOwnProperty.call(D,q)?Ce++:(vi(x,{command:"removeLayer",args:[q]}),F.splice(F.indexOf(q,Ce),1));for(let ge=0,Ce=0;ge<C.length;ge++)q=C[C.length-1-ge],F[F.length-1-ge]!==q&&(Object.prototype.hasOwnProperty.call(k,q)?(vi(x,{command:"removeLayer",args:[q]}),F.splice(F.lastIndexOf(q,F.length-Ce),1)):Ce++,xe=F[F.length-ge],vi(x,{command:"addLayer",args:[D[q],xe]}),F.splice(F.length-ge,0,q),N[q]=!0);for(let ge=0;ge<C.length;ge++)if(q=C[ge],Y=k[q],ie=D[q],!N[q]&&!Ht(Y,ie))if(Ht(Y.source,ie.source)&&Ht(Y["source-layer"],ie["source-layer"])&&Ht(Y.type,ie.type)){for(ue in ir(Y.layout,ie.layout,x,q,null,"setLayoutProperty"),ir(Y.paint,ie.paint,x,q,null,"setPaintProperty"),Ht(Y.filter,ie.filter)||vi(x,{command:"setFilter",args:[q,ie.filter]}),Ht(Y.minzoom,ie.minzoom)&&Ht(Y.maxzoom,ie.maxzoom)||vi(x,{command:"setLayerZoomRange",args:[q,ie.minzoom,ie.maxzoom]}),Y)Object.prototype.hasOwnProperty.call(Y,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ir(Y[ue],ie[ue],x,q,ue.slice(6),"setPaintProperty"):Ht(Y[ue],ie[ue])||vi(x,{command:"setLayerProperty",args:[q,ue,ie[ue]]}));for(ue in ie)Object.prototype.hasOwnProperty.call(ie,ue)&&!Object.prototype.hasOwnProperty.call(Y,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ir(Y[ue],ie[ue],x,q,ue.slice(6),"setPaintProperty"):Ht(Y[ue],ie[ue])||vi(x,{command:"setLayerProperty",args:[q,ue,ie[ue]]}))}else vi(x,{command:"removeLayer",args:[q]}),xe=F[F.lastIndexOf(q)+1],vi(x,{command:"addLayer",args:[ie,xe]})}(p,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},w.aF=Je,w.aG=St,w.aH=class extends Ta{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=mf,w.aJ=class extends Ta{constructor(i,t){super(i,t),this.current=Kb}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=Qy,w.aL=ev,w.aM=wi,w.aN=class extends Ta{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends Ta{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,s,u,p,m){var _=1/(t-r),x=1/(s-u),P=1/(p-m);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+r)*_,i[13]=(u+s)*x,i[14]=(m+p)*P,i[15]=1,i},w.aQ=i1,w.aR=class extends de{},w.aS=H1,w.aT=class extends be{},w.aU=x_,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=mv,w.aX=Dr,w.aY=zn,w.aZ=class extends xt{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,u,p)=>{const m=u||p;return t[s]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},w.ac=De,w.ad=function(i,t,r){var s=Math.sin(r),u=Math.cos(r),p=t[0],m=t[1],_=t[2],x=t[3],P=t[4],C=t[5],k=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*u+P*s,i[1]=m*u+C*s,i[2]=_*u+k*s,i[3]=x*u+D*s,i[4]=P*u-p*s,i[5]=C*u-m*s,i[6]=k*u-_*s,i[7]=D*u-x*s,i},w.ae=function(i){var t=new kl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=vf,w.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:m}=i,_=u?De(Jr.interpolationFactor(u,t,p,m),0,1):0;i.kind==="camera"?s=Kr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:s}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:u}){return i.kind==="source"?s/ds:i.kind==="composite"?Kr.number(s/ds,u/ds,r):t},w.aj=O_,w.ak=function(i,t,r,s){const u=t.y-i.y,p=t.x-i.x,m=s.y-r.y,_=s.x-r.x,x=m*p-_*u;if(x===0)return null;const P=(_*(i.y-r.y)-m*(i.x-r.x))/x;return new j(i.x+P*p,i.y+P*u)},w.al=gx,w.am=nv,w.an=__,w.ao=function(i){let t=1/0,r=1/0,s=-1/0,u=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return[t,r,s,u]},w.ap=gr,w.ar=L_,w.as=function(i,t){var r=t[0],s=t[1],u=t[2],p=t[3],m=t[4],_=t[5],x=t[6],P=t[7],C=t[8],k=t[9],D=t[10],F=t[11],N=t[12],q=t[13],Y=t[14],ie=t[15],xe=r*_-s*m,ue=r*x-u*m,ge=r*P-p*m,Ce=s*x-u*_,je=s*P-p*_,ct=u*P-p*x,Dt=C*q-k*N,ot=C*Y-D*N,nt=C*ie-F*N,wt=k*Y-D*q,_t=k*ie-F*q,ft=D*ie-F*Y,Me=xe*ft-ue*_t+ge*wt+Ce*nt-je*ot+ct*Dt;return Me?(i[0]=(_*ft-x*_t+P*wt)*(Me=1/Me),i[1]=(u*_t-s*ft-p*wt)*Me,i[2]=(q*ct-Y*je+ie*Ce)*Me,i[3]=(D*je-k*ct-F*Ce)*Me,i[4]=(x*nt-m*ft-P*ot)*Me,i[5]=(r*ft-u*nt+p*ot)*Me,i[6]=(Y*ge-N*ct-ie*ue)*Me,i[7]=(C*ct-D*ge+F*ue)*Me,i[8]=(m*_t-_*nt+P*Dt)*Me,i[9]=(s*nt-r*_t-p*Dt)*Me,i[10]=(N*je-q*ge+ie*xe)*Me,i[11]=(k*ge-C*je-F*xe)*Me,i[12]=(_*ot-m*wt-x*Dt)*Me,i[13]=(r*wt-s*ot+u*Dt)*Me,i[14]=(q*ue-N*Ce-Y*xe)*Me,i[15]=(C*Ce-k*ue+D*xe)*Me,i):null},w.at=Z_,w.au=R_,w.av=G_,w.aw=function(){const i={},t=ye.$version;for(const r in ye.$root){const s=ye.$root[r];if(s.required){let u=null;u=r==="version"?t:s.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},w.ax=wu,w.ay=Pi,w.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=sn(i[r],t[i[r].ref]));return i},w.b=pt,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=Xe,w.b4=cx,w.b5=ax,w.b6=function(i,t,r,s,u){var p,m=1/Math.tan(t/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+s)*(p=1/(s-u)),i[14]=2*u*s*p):(i[10]=-1,i[14]=-2*s),i},w.b7=function(i,t,r){var s=Math.sin(r),u=Math.cos(r),p=t[4],m=t[5],_=t[6],x=t[7],P=t[8],C=t[9],k=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*u+P*s,i[5]=m*u+C*s,i[6]=_*u+k*s,i[7]=x*u+D*s,i[8]=P*u-p*s,i[9]=C*u-m*s,i[10]=k*u-_*s,i[11]=D*u-x*s,i},w.b8=ke,w.b9=Ne,w.bA=Lv,w.bB=function(i){return i.message===qt},w.bC=fo,w.bD=un,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){const{x:r,y:s}=Uu.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends A{},w.be=V_,w.bf=Ew,w.bh=yi,w.bi=function(i,t){li.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete li.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){const r={};for(let u=0;u<i.length;u++){const p=t&&t[i[u].id]||rf(i[u]);t&&(t[i[u].id]=p);let m=r[p];m||(m=r[p]=[]),m.push(i[u])}const s=[];for(const u in r)s.push(r[u]);return s},w.bl=gt,w.bm=hx,w.bn=px,w.bo=Zv,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=mr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,u={layoutIconSize:s["icon-size"].possiblyEvaluate(new Li(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Li(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Li(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:C}=i.bucket.textSizeData;u.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Li(P),i.canonical),s["text-size"].possiblyEvaluate(new Li(C),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:C}=i.bucket.iconSizeData;u.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Li(P),i.canonical),s["icon-size"].possiblyEvaluate(new Li(C),i.canonical)]}const p=r.get("text-line-height")*gr,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),x=r.get("text-size");for(const P of i.bucket.features){const C=r.get("text-font").evaluate(P,{},i.canonical).join(","),k=x.evaluate(P,{},i.canonical),D=u.layoutTextSize.evaluate(P,{},i.canonical),F=u.layoutIconSize.evaluate(P,{},i.canonical),N={horizontal:{},vertical:void 0},q=P.text;let Y,ie=[0,0];if(q){const ge=q.toString(),Ce=r.get("text-letter-spacing").evaluate(P,{},i.canonical)*gr,je=o_(ge)?Ce:0,ct=r.get("text-anchor").evaluate(P,{},i.canonical),Dt=Tx(t,P,i.canonical);if(!Dt){const _t=r.get("text-radial-offset").evaluate(P,{},i.canonical);ie=_t?Px(ct,[_t*gr,q_]):r.get("text-offset").evaluate(P,{},i.canonical).map(ft=>ft*gr)}let ot=m?"center":r.get("text-justify").evaluate(P,{},i.canonical);const nt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(P,{},i.canonical)*gr:1/0,wt=()=>{i.bucket.allowVerticalPlacement&&Su(ge)&&(N.vertical=Tf(q,i.glyphMap,i.glyphPositions,i.imagePositions,C,nt,p,ct,"left",je,ie,w.ah.vertical,!0,D,k))};if(!m&&Dt){const _t=new Set;if(ot==="auto")for(let Me=0;Me<Dt.values.length;Me+=2)_t.add(Z_(Dt.values[Me]));else _t.add(ot);let ft=!1;for(const Me of _t)if(!N.horizontal[Me])if(ft)N.horizontal[Me]=N.horizontal[0];else{const Tt=Tf(q,i.glyphMap,i.glyphPositions,i.imagePositions,C,nt,p,"center",Me,je,ie,w.ah.horizontal,!1,D,k);Tt&&(N.horizontal[Me]=Tt,ft=Tt.positionedLines.length===1)}wt()}else{ot==="auto"&&(ot=Z_(ct));const _t=Tf(q,i.glyphMap,i.glyphPositions,i.imagePositions,C,nt,p,ct,ot,je,ie,w.ah.horizontal,!1,D,k);_t&&(N.horizontal[ot]=_t),wt(),Su(ge)&&m&&_&&(N.vertical=Tf(q,i.glyphMap,i.glyphPositions,i.imagePositions,C,nt,p,ct,ot,je,ie,w.ah.vertical,!1,D,k))}}let xe=!1;if(P.icon&&P.icon.name){const ge=i.imageMap[P.icon.name];ge&&(Y=hw(i.imagePositions[P.icon.name],r.get("icon-offset").evaluate(P,{},i.canonical),r.get("icon-anchor").evaluate(P,{},i.canonical)),xe=!!ge.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=xe:i.bucket.sdfIcons!==xe&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ue=Cx(N.horizontal)||N.vertical;i.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||Y)&&Cw(i.bucket,P,N,Y,i.imageMap,u,D,F,ie,xe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=A_,w.br=T_,w.bs=C_,w.bt=Mo,w.bu=k_,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,s,u){return c(this,void 0,void 0,function*(){if(_e())try{return yield lt(i,t,r,s,u)}catch{}return function(p,m,_,x,P){const C=p.width,k=p.height;ut&&Ft||(ut=new OffscreenCanvas(C,k),Ft=ut.getContext("2d",{willReadFrequently:!0})),ut.width=C,ut.height=k,Ft.drawImage(p,0,0,C,k);const D=Ft.getImageData(m,_,x,P);return Ft.clearRect(0,0,C,k),D.data}(i,t,r,s,u)})},w.bx=ux,w.by=U,w.bz=W,w.c=fi,w.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=it,w.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=yt})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(u):yt}),w.g=Si,w.h=(i,t)=>Ui(it(i,{type:"json"}),t),w.i=Le,w.j=mt,w.k=Ei,w.l=(i,t)=>Ui(it(i,{type:"arrayBuffer"}),t),w.m=Ui,w.n=function(i){return new k_(i).readFields(nw,[])},w.o=zu,w.p=qv,w.q=d,w.r=n_,w.s=qi,w.t=xu,w.u=Vs,w.v=ye,w.w=Fe,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=Kr,w.z=Li}),T("worker",["./shared"],function(w){class c{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,L){for(const $ of O){this._layerConfigs[$.id]=$;const he=this._layers[$.id]=w.aA($);he._featureFilter=w.a7(he.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of L)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const G=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const $ of G){const he=$.map(Te=>this._layers[Te.id]),pe=he[0];if(pe.visibility==="none")continue;const ve=pe.source||"";let ae=this.familiesBySource[ve];ae||(ae=this.familiesBySource[ve]={});const Ae=pe.sourceLayer||"_geojsonTileLayer";let Re=ae[Ae];Re||(Re=ae[Ae]=[]),Re.push(he)}}}class U{constructor(O){const L={},G=[];for(const ve in O){const ae=O[ve],Ae=L[ve]={};for(const Re in ae){const Te=ae[+Re];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const $e={x:0,y:0,w:Te.bitmap.width+2,h:Te.bitmap.height+2};G.push($e),Ae[Re]={rect:$e,metrics:Te.metrics}}}const{w:$,h:he}=w.p(G),pe=new w.o({width:$||1,height:he||1});for(const ve in O){const ae=O[ve];for(const Ae in ae){const Re=ae[+Ae];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const Te=L[ve][Ae].rect;w.o.copy(Re.bitmap,pe,{x:0,y:0},{x:Te.x+1,y:Te.y+1},Re.bitmap)}}this.image=pe,this.positions=L}}w.bl("GlyphAtlas",U);class W{constructor(O){this.tileID=new w.S(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,L,G,$){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new w.a5;const he=new w.bm(Object.keys(O.layers).sort()),pe=new w.bn(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const ve={},ae={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},Ae=L.familiesBySource[this.source];for(const Xt in Ae){const bi=O.layers[Xt];if(!bi)continue;bi.version===1&&w.w(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gi=he.encode(Xt),yr=[];for(let Sr=0;Sr<bi.length;Sr++){const Nr=bi.feature(Sr),io=pe.getId(Nr,Xt);yr.push({feature:Nr,id:io,index:Sr,sourceLayerIndex:Gi})}for(const Sr of Ae[Xt]){const Nr=Sr[0];Nr.source!==this.source&&w.w(`layer.source = ${Nr.source} does not equal this.source = ${this.source}`),Nr.minzoom&&this.zoom<Math.floor(Nr.minzoom)||Nr.maxzoom&&this.zoom>=Nr.maxzoom||Nr.visibility!=="none"&&(K(Sr,this.zoom,G),(ve[Nr.id]=Nr.createBucket({index:pe.bucketLayerIDs.length,layers:Sr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gi,sourceID:this.source})).populate(yr,ae,this.tileID.canonical),pe.bucketLayerIDs.push(Sr.map(io=>io.id)))}}const Re=w.aF(ae.glyphDependencies,Xt=>Object.keys(Xt).map(Number));this.inFlightDependencies.forEach(Xt=>Xt==null?void 0:Xt.abort()),this.inFlightDependencies=[];let Te=Promise.resolve({});if(Object.keys(Re).length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),Te=$.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},Xt)}const $e=Object.keys(ae.iconDependencies);let It=Promise.resolve({});if($e.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),It=$.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"icons"}},Xt)}const zt=Object.keys(ae.patternDependencies);let ci=Promise.resolve({});if(zt.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),ci=$.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},Xt)}const[Zt,ui,ti]=yield Promise.all([Te,It,ci]),pr=new U(Zt),Yi=new w.bo(ui,ti);for(const Xt in ve){const bi=ve[Xt];bi instanceof w.a6?(K(bi.layers,this.zoom,G),w.bp({bucket:bi,glyphMap:Zt,glyphPositions:pr.positions,imageMap:ui,imagePositions:Yi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):bi.hasPattern&&(bi instanceof w.bq||bi instanceof w.br||bi instanceof w.bs)&&(K(bi.layers,this.zoom,G),bi.addFeatures(ae,this.tileID.canonical,Yi.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter(Xt=>!Xt.isEmpty()),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pr.image,imageAtlas:Yi,glyphMap:this.returnDependencies?Zt:null,iconMap:this.returnDependencies?ui:null,glyphPositions:this.returnDependencies?pr.positions:null}})}}function K(te,O,L){const G=new w.z(O);for(const $ of te)$.recalculate(G,L)}class j{constructor(O,L,G){this.actor=O,this.layerIndex=L,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,L){return w._(this,void 0,void 0,function*(){const G=yield w.l(O.request,L);try{return{vectorTile:new w.bt.VectorTile(new w.bu(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch($){const he=new Uint8Array(G.data);let pe=`Unable to parse the tile at ${O.request.url}, `;throw pe+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${$.message}`,new Error(pe)}})}loadTile(O){return w._(this,void 0,void 0,function*(){const L=O.uid,G=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request),$=new W(O);this.loading[L]=$;const he=new AbortController;$.abort=he;try{const pe=yield this.loadVectorTile(O,he);if(delete this.loading[L],!pe)return null;const ve=pe.rawData,ae={};pe.expires&&(ae.expires=pe.expires),pe.cacheControl&&(ae.cacheControl=pe.cacheControl);const Ae={};if(G){const Te=G.finish();Te&&(Ae.resourceTiming=JSON.parse(JSON.stringify(Te)))}$.vectorTile=pe.vectorTile;const Re=$.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=$,this.fetching[L]={rawTileData:ve,cacheControl:ae,resourceTiming:Ae};try{const Te=yield Re;return w.e({rawTileData:ve.slice(0)},Te,ae,Ae)}finally{delete this.fetching[L]}}catch(pe){throw delete this.loading[L],$.status="done",this.loaded[L]=$,pe}})}reloadTile(O){return w._(this,void 0,void 0,function*(){const L=O.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[L];if(G.showCollisionBoxes=O.showCollisionBoxes,G.status==="parsing"){const $=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[L]){const{rawTileData:pe,cacheControl:ve,resourceTiming:ae}=this.fetching[L];delete this.fetching[L],he=w.e({rawTileData:pe.slice(0)},$,ve,ae)}else he=$;return he}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return w._(this,void 0,void 0,function*(){const L=this.loading,G=O.uid;L&&L[G]&&L[G].abort&&(L[G].abort.abort(),delete L[G])})}removeTile(O){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class V{constructor(){this.loaded={}}loadTile(O){return w._(this,void 0,void 0,function*(){const{uid:L,encoding:G,rawImageData:$,redFactor:he,greenFactor:pe,blueFactor:ve,baseShift:ae}=O,Ae=$.width+2,Re=$.height+2,Te=w.b($)?new w.R({width:Ae,height:Re},yield w.bw($,-1,-1,Ae,Re)):$,$e=new w.bx(L,Te,G,he,pe,ve,ae);return this.loaded=this.loaded||{},this.loaded[L]=$e,$e})}removeTile(O){const L=this.loaded,G=O.uid;L&&L[G]&&delete L[G]}}function ne(te,O){if(te.length!==0){oe(te[0],O);for(var L=1;L<te.length;L++)oe(te[L],!O)}}function oe(te,O){for(var L=0,G=0,$=0,he=te.length,pe=he-1;$<he;pe=$++){var ve=(te[$][0]-te[pe][0])*(te[pe][1]+te[$][1]),ae=L+ve;G+=Math.abs(L)>=Math.abs(ve)?L-ae+ve:ve-ae+L,L=ae}L+G>=0!=!!O&&te.reverse()}var ce=w.by(function te(O,L){var G,$=O&&O.type;if($==="FeatureCollection")for(G=0;G<O.features.length;G++)te(O.features[G],L);else if($==="GeometryCollection")for(G=0;G<O.geometries.length;G++)te(O.geometries[G],L);else if($==="Feature")te(O.geometry,L);else if($==="Polygon")ne(O.coordinates,L);else if($==="MultiPolygon")for(G=0;G<O.coordinates.length;G++)ne(O.coordinates[G],L);return O});const fe=w.bt.VectorTileFeature.prototype.toGeoJSON;var Ie={exports:{}},_e=w.bz,ke=w.bt.VectorTileFeature,Ne=De;function De(te,O){this.options=O||{},this.features=te,this.length=te.length}function Xe(te,O){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=O||4096}De.prototype.feature=function(te){return new Xe(this.features[te],this.options.extent)},Xe.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var O=0;O<te.length;O++){for(var L=te[O],G=[],$=0;$<L.length;$++)G.push(new _e(L[$][0],L[$][1]));this.geometry.push(G)}return this.geometry},Xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,O=1/0,L=-1/0,G=1/0,$=-1/0,he=0;he<te.length;he++)for(var pe=te[he],ve=0;ve<pe.length;ve++){var ae=pe[ve];O=Math.min(O,ae.x),L=Math.max(L,ae.x),G=Math.min(G,ae.y),$=Math.max($,ae.y)}return[O,G,L,$]},Xe.prototype.toGeoJSON=ke.prototype.toGeoJSON;var it=w.bA,Ct=Ne;function Je(te){var O=new it;return function(L,G){for(var $ in L.layers)G.writeMessage(3,St,L.layers[$])}(te,O),O.finish()}function St(te,O){var L;O.writeVarintField(15,te.version||1),O.writeStringField(1,te.name||""),O.writeVarintField(5,te.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<te.length;L++)G.feature=te.feature(L),O.writeMessage(2,dt,G);var $=G.keys;for(L=0;L<$.length;L++)O.writeStringField(3,$[L]);var he=G.values;for(L=0;L<he.length;L++)O.writeMessage(4,Ke,he[L])}function dt(te,O){var L=te.feature;L.id!==void 0&&O.writeVarintField(1,L.id),O.writeMessage(2,Ge,te),O.writeVarintField(3,L.type),O.writeMessage(4,Le,L)}function Ge(te,O){var L=te.feature,G=te.keys,$=te.values,he=te.keycache,pe=te.valuecache;for(var ve in L.properties){var ae=L.properties[ve],Ae=he[ve];if(ae!==null){Ae===void 0&&(G.push(ve),he[ve]=Ae=G.length-1),O.writeVarint(Ae);var Re=typeof ae;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(ae=JSON.stringify(ae));var Te=Re+":"+ae,$e=pe[Te];$e===void 0&&($.push(ae),pe[Te]=$e=$.length-1),O.writeVarint($e)}}}function Fe(te,O){return(O<<3)+(7&te)}function Ee(te){return te<<1^te>>31}function Le(te,O){for(var L=te.loadGeometry(),G=te.type,$=0,he=0,pe=L.length,ve=0;ve<pe;ve++){var ae=L[ve],Ae=1;G===1&&(Ae=ae.length),O.writeVarint(Fe(1,Ae));for(var Re=G===3?ae.length-1:ae.length,Te=0;Te<Re;Te++){Te===1&&G!==1&&O.writeVarint(Fe(2,Re-1));var $e=ae[Te].x-$,It=ae[Te].y-he;O.writeVarint(Ee($e)),O.writeVarint(Ee(It)),$+=$e,he+=It}G===3&&O.writeVarint(Fe(7,1))}}function Ke(te,O){var L=typeof te;L==="string"?O.writeStringField(1,te):L==="boolean"?O.writeBooleanField(7,te):L==="number"&&(te%1!=0?O.writeDoubleField(3,te):te<0?O.writeSVarintField(6,te):O.writeVarintField(5,te))}Ie.exports=Je,Ie.exports.fromVectorTileJs=Je,Ie.exports.fromGeojsonVt=function(te,O){O=O||{};var L={};for(var G in te)L[G]=new Ct(te[G].features,O),L[G].name=G,L[G].version=O.version,L[G].extent=O.extent;return Je({layers:L})},Ie.exports.GeoJSONWrapper=Ct;var pt=w.by(Ie.exports);const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},lt=Math.fround||(ut=new Float32Array(1),te=>(ut[0]=+te,ut[0]));var ut;const Ft=3,qt=5,fi=6;class li{constructor(O){this.options=Object.assign(Object.create(yt),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:L,minZoom:G,maxZoom:$}=this.options;L&&console.time("total time");const he=`prepare ${O.length} points`;L&&console.time(he),this.points=O;const pe=[];for(let ae=0;ae<O.length;ae++){const Ae=O[ae];if(!Ae.geometry)continue;const[Re,Te]=Ae.geometry.coordinates,$e=lt(yi(Re)),It=lt(Pi(Te));pe.push($e,It,1/0,ae,-1,1),this.options.reduce&&pe.push(0)}let ve=this.trees[$+1]=this._createTree(pe);L&&console.timeEnd(he);for(let ae=$;ae>=G;ae--){const Ae=+Date.now();ve=this.trees[ae]=this._createTree(this._cluster(ve,ae)),L&&console.log("z%d: %d clusters in %dms",ae,ve.numItems,+Date.now()-Ae)}return L&&console.timeEnd("total time"),this}getClusters(O,L){let G=((O[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,O[1]));let he=O[2]===180?180:((O[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)G=-180,he=180;else if(G>he){const Te=this.getClusters([G,$,180,pe],L),$e=this.getClusters([-180,$,he,pe],L);return Te.concat($e)}const ve=this.trees[this._limitZoom(L)],ae=ve.range(yi(G),Pi(pe),yi(he),Pi($)),Ae=ve.data,Re=[];for(const Te of ae){const $e=this.stride*Te;Re.push(Ae[$e+qt]>1?Si(Ae,$e,this.clusterProps):this.points[Ae[$e+Ft]])}return Re}getChildren(O){const L=this._getOriginId(O),G=this._getOriginZoom(O),$="No cluster with the specified id.",he=this.trees[G];if(!he)throw new Error($);const pe=he.data;if(L*this.stride>=pe.length)throw new Error($);const ve=this.options.radius/(this.options.extent*Math.pow(2,G-1)),ae=he.within(pe[L*this.stride],pe[L*this.stride+1],ve),Ae=[];for(const Re of ae){const Te=Re*this.stride;pe[Te+4]===O&&Ae.push(pe[Te+qt]>1?Si(pe,Te,this.clusterProps):this.points[pe[Te+Ft]])}if(Ae.length===0)throw new Error($);return Ae}getLeaves(O,L,G){const $=[];return this._appendLeaves($,O,L=L||10,G=G||0,0),$}getTile(O,L,G){const $=this.trees[this._limitZoom(O)],he=Math.pow(2,O),{extent:pe,radius:ve}=this.options,ae=ve/pe,Ae=(G-ae)/he,Re=(G+1+ae)/he,Te={features:[]};return this._addTileFeatures($.range((L-ae)/he,Ae,(L+1+ae)/he,Re),$.data,L,G,he,Te),L===0&&this._addTileFeatures($.range(1-ae/he,Ae,1,Re),$.data,he,G,he,Te),L===he-1&&this._addTileFeatures($.range(0,Ae,ae/he,Re),$.data,-1,G,he,Te),Te.features.length?Te:null}getClusterExpansionZoom(O){let L=this._getOriginZoom(O)-1;for(;L<=this.options.maxZoom;){const G=this.getChildren(O);if(L++,G.length!==1)break;O=G[0].properties.cluster_id}return L}_appendLeaves(O,L,G,$,he){const pe=this.getChildren(L);for(const ve of pe){const ae=ve.properties;if(ae&&ae.cluster?he+ae.point_count<=$?he+=ae.point_count:he=this._appendLeaves(O,ae.cluster_id,G,$,he):he<$?he++:O.push(ve),O.length===G)break}return he}_createTree(O){const L=new w.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<O.length;G+=this.stride)L.add(O[G],O[G+1]);return L.finish(),L.data=O,L}_addTileFeatures(O,L,G,$,he,pe){for(const ve of O){const ae=ve*this.stride,Ae=L[ae+qt]>1;let Re,Te,$e;if(Ae)Re=_i(L,ae,this.clusterProps),Te=L[ae],$e=L[ae+1];else{const ci=this.points[L[ae+Ft]];Re=ci.properties;const[Zt,ui]=ci.geometry.coordinates;Te=yi(Zt),$e=Pi(ui)}const It={type:1,geometry:[[Math.round(this.options.extent*(Te*he-G)),Math.round(this.options.extent*($e*he-$))]],tags:Re};let zt;zt=Ae||this.options.generateId?L[ae+Ft]:this.points[L[ae+Ft]].id,zt!==void 0&&(It.id=zt),pe.features.push(It)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,L){const{radius:G,extent:$,reduce:he,minPoints:pe}=this.options,ve=G/($*Math.pow(2,L)),ae=O.data,Ae=[],Re=this.stride;for(let Te=0;Te<ae.length;Te+=Re){if(ae[Te+2]<=L)continue;ae[Te+2]=L;const $e=ae[Te],It=ae[Te+1],zt=O.within(ae[Te],ae[Te+1],ve),ci=ae[Te+qt];let Zt=ci;for(const ui of zt){const ti=ui*Re;ae[ti+2]>L&&(Zt+=ae[ti+qt])}if(Zt>ci&&Zt>=pe){let ui,ti=$e*ci,pr=It*ci,Yi=-1;const Xt=((Te/Re|0)<<5)+(L+1)+this.points.length;for(const bi of zt){const Gi=bi*Re;if(ae[Gi+2]<=L)continue;ae[Gi+2]=L;const yr=ae[Gi+qt];ti+=ae[Gi]*yr,pr+=ae[Gi+1]*yr,ae[Gi+4]=Xt,he&&(ui||(ui=this._map(ae,Te,!0),Yi=this.clusterProps.length,this.clusterProps.push(ui)),he(ui,this._map(ae,Gi)))}ae[Te+4]=Xt,Ae.push(ti/Zt,pr/Zt,1/0,Xt,-1,Zt),he&&Ae.push(Yi)}else{for(let ui=0;ui<Re;ui++)Ae.push(ae[Te+ui]);if(Zt>1)for(const ui of zt){const ti=ui*Re;if(!(ae[ti+2]<=L)){ae[ti+2]=L;for(let pr=0;pr<Re;pr++)Ae.push(ae[ti+pr])}}}}return Ae}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,L,G){if(O[L+qt]>1){const pe=this.clusterProps[O[L+fi]];return G?Object.assign({},pe):pe}const $=this.points[O[L+Ft]].properties,he=this.options.map($);return G&&he===$?Object.assign({},he):he}}function Si(te,O,L){return{type:"Feature",id:te[O+Ft],properties:_i(te,O,L),geometry:{type:"Point",coordinates:[(G=te[O],360*(G-.5)),Ui(te[O+1])]}};var G}function _i(te,O,L){const G=te[O+qt],$=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,he=te[O+fi],pe=he===-1?{}:Object.assign({},L[he]);return Object.assign(pe,{cluster:!0,cluster_id:te[O+Ft],point_count:G,point_count_abbreviated:$})}function yi(te){return te/360+.5}function Pi(te){const O=Math.sin(te*Math.PI/180),L=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return L<0?0:L>1?1:L}function Ui(te){const O=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function qi(te,O,L,G){let $=G;const he=O+(L-O>>1);let pe,ve=L-O;const ae=te[O],Ae=te[O+1],Re=te[L],Te=te[L+1];for(let $e=O+3;$e<L;$e+=3){const It=Zi(te[$e],te[$e+1],ae,Ae,Re,Te);if(It>$)pe=$e,$=It;else if(It===$){const zt=Math.abs($e-he);zt<ve&&(pe=$e,ve=zt)}}$>G&&(pe-O>3&&qi(te,O,pe,G),te[pe+2]=$,L-pe>3&&qi(te,pe,L,G))}function Zi(te,O,L,G,$,he){let pe=$-L,ve=he-G;if(pe!==0||ve!==0){const ae=((te-L)*pe+(O-G)*ve)/(pe*pe+ve*ve);ae>1?(L=$,G=he):ae>0&&(L+=pe*ae,G+=ve*ae)}return pe=te-L,ve=O-G,pe*pe+ve*ve}function Xi(te,O,L,G){const $={id:te??null,type:O,geometry:L,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")Ei($,L);else if(O==="Polygon")Ei($,L[0]);else if(O==="MultiLineString")for(const he of L)Ei($,he);else if(O==="MultiPolygon")for(const he of L)Ei($,he[0]);return $}function Ei(te,O){for(let L=0;L<O.length;L+=3)te.minX=Math.min(te.minX,O[L]),te.minY=Math.min(te.minY,O[L+1]),te.maxX=Math.max(te.maxX,O[L]),te.maxY=Math.max(te.maxY,O[L+1])}function mt(te,O,L,G){if(!O.geometry)return;const $=O.geometry.coordinates;if($&&$.length===0)return;const he=O.geometry.type,pe=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2);let ve=[],ae=O.id;if(L.promoteId?ae=O.properties[L.promoteId]:L.generateId&&(ae=G||0),he==="Point")kt($,ve);else if(he==="MultiPoint")for(const Ae of $)kt(Ae,ve);else if(he==="LineString")ye($,ve,pe,!1);else if(he==="MultiLineString"){if(L.lineMetrics){for(const Ae of $)ve=[],ye(Ae,ve,pe,!1),te.push(Xi(ae,"LineString",ve,O.properties));return}Ri($,ve,pe,!1)}else if(he==="Polygon")Ri($,ve,pe,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Ae of O.geometry.geometries)mt(te,{id:ae,geometry:Ae,properties:O.properties},L,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ae of $){const Re=[];Ri(Ae,Re,pe,!0),ve.push(Re)}}te.push(Xi(ae,he,ve,O.properties))}function kt(te,O){O.push(sn(te[0]),Ht(te[1]),0)}function ye(te,O,L,G){let $,he,pe=0;for(let ae=0;ae<te.length;ae++){const Ae=sn(te[ae][0]),Re=Ht(te[ae][1]);O.push(Ae,Re,0),ae>0&&(pe+=G?($*Re-Ae*he)/2:Math.sqrt(Math.pow(Ae-$,2)+Math.pow(Re-he,2))),$=Ae,he=Re}const ve=O.length-3;O[2]=1,qi(O,0,ve,L),O[ve+2]=1,O.size=Math.abs(pe),O.start=0,O.end=O.size}function Ri(te,O,L,G){for(let $=0;$<te.length;$++){const he=[];ye(te[$],he,L,G),O.push(he)}}function sn(te){return te/360+.5}function Ht(te){const O=Math.sin(te*Math.PI/180),L=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return L<0?0:L>1?1:L}function vi(te,O,L,G,$,he,pe,ve){if(G/=O,he>=(L/=O)&&pe<G)return te;if(pe<L||he>=G)return null;const ae=[];for(const Ae of te){const Re=Ae.geometry;let Te=Ae.type;const $e=$===0?Ae.minX:Ae.minY,It=$===0?Ae.maxX:Ae.maxY;if($e>=L&&It<G){ae.push(Ae);continue}if(It<L||$e>=G)continue;let zt=[];if(Te==="Point"||Te==="MultiPoint")Ki(Re,zt,L,G,$);else if(Te==="LineString")xi(Re,zt,L,G,$,!1,ve.lineMetrics);else if(Te==="MultiLineString")ar(Re,zt,L,G,$,!1);else if(Te==="Polygon")ar(Re,zt,L,G,$,!0);else if(Te==="MultiPolygon")for(const ci of Re){const Zt=[];ar(ci,Zt,L,G,$,!0),Zt.length&&zt.push(Zt)}if(zt.length){if(ve.lineMetrics&&Te==="LineString"){for(const ci of zt)ae.push(Xi(Ae.id,Te,ci,Ae.tags));continue}Te!=="LineString"&&Te!=="MultiLineString"||(zt.length===1?(Te="LineString",zt=zt[0]):Te="MultiLineString"),Te!=="Point"&&Te!=="MultiPoint"||(Te=zt.length===3?"Point":"MultiPoint"),ae.push(Xi(Ae.id,Te,zt,Ae.tags))}}return ae.length?ae:null}function Ki(te,O,L,G,$){for(let he=0;he<te.length;he+=3){const pe=te[he+$];pe>=L&&pe<=G&&ir(O,te[he],te[he+1],te[he+2])}}function xi(te,O,L,G,$,he,pe){let ve=tr(te);const ae=$===0?hr:Er;let Ae,Re,Te=te.start;for(let Zt=0;Zt<te.length-3;Zt+=3){const ui=te[Zt],ti=te[Zt+1],pr=te[Zt+2],Yi=te[Zt+3],Xt=te[Zt+4],bi=$===0?ui:ti,Gi=$===0?Yi:Xt;let yr=!1;pe&&(Ae=Math.sqrt(Math.pow(ui-Yi,2)+Math.pow(ti-Xt,2))),bi<L?Gi>L&&(Re=ae(ve,ui,ti,Yi,Xt,L),pe&&(ve.start=Te+Ae*Re)):bi>G?Gi<G&&(Re=ae(ve,ui,ti,Yi,Xt,G),pe&&(ve.start=Te+Ae*Re)):ir(ve,ui,ti,pr),Gi<L&&bi>=L&&(Re=ae(ve,ui,ti,Yi,Xt,L),yr=!0),Gi>G&&bi<=G&&(Re=ae(ve,ui,ti,Yi,Xt,G),yr=!0),!he&&yr&&(pe&&(ve.end=Te+Ae*Re),O.push(ve),ve=tr(te)),pe&&(Te+=Ae)}let $e=te.length-3;const It=te[$e],zt=te[$e+1],ci=$===0?It:zt;ci>=L&&ci<=G&&ir(ve,It,zt,te[$e+2]),$e=ve.length-3,he&&$e>=3&&(ve[$e]!==ve[0]||ve[$e+1]!==ve[1])&&ir(ve,ve[0],ve[1],ve[2]),ve.length&&O.push(ve)}function tr(te){const O=[];return O.size=te.size,O.start=te.start,O.end=te.end,O}function ar(te,O,L,G,$,he){for(const pe of te)xi(pe,O,L,G,$,he,!1)}function ir(te,O,L,G){te.push(O,L,G)}function hr(te,O,L,G,$,he){const pe=(he-O)/(G-O);return ir(te,he,L+($-L)*pe,1),pe}function Er(te,O,L,G,$,he){const pe=(he-L)/($-L);return ir(te,O+(G-O)*pe,he,1),pe}function Ve(te,O){const L=[];for(let G=0;G<te.length;G++){const $=te[G],he=$.type;let pe;if(he==="Point"||he==="MultiPoint"||he==="LineString")pe=Ji($.geometry,O);else if(he==="MultiLineString"||he==="Polygon"){pe=[];for(const ve of $.geometry)pe.push(Ji(ve,O))}else if(he==="MultiPolygon"){pe=[];for(const ve of $.geometry){const ae=[];for(const Ae of ve)ae.push(Ji(Ae,O));pe.push(ae)}}L.push(Xi($.id,he,pe,$.tags))}return L}function Ji(te,O){const L=[];L.size=te.size,te.start!==void 0&&(L.start=te.start,L.end=te.end);for(let G=0;G<te.length;G+=3)L.push(te[G]+O,te[G+1],te[G+2]);return L}function Wi(te,O){if(te.transformed)return te;const L=1<<te.z,G=te.x,$=te.y;for(const he of te.features){const pe=he.geometry,ve=he.type;if(he.geometry=[],ve===1)for(let ae=0;ae<pe.length;ae+=2)he.geometry.push(kr(pe[ae],pe[ae+1],O,L,G,$));else for(let ae=0;ae<pe.length;ae++){const Ae=[];for(let Re=0;Re<pe[ae].length;Re+=2)Ae.push(kr(pe[ae][Re],pe[ae][Re+1],O,L,G,$));he.geometry.push(Ae)}}return te.transformed=!0,te}function kr(te,O,L,G,$,he){return[Math.round(L*(te*G-$)),Math.round(L*(O*G-he))]}function wr(te,O,L,G,$){const he=O===$.maxZoom?0:$.tolerance/((1<<O)*$.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:te.length,source:null,x:L,y:G,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of te)We(pe,ve,he,$);return pe}function We(te,O,L,G){const $=O.geometry,he=O.type,pe=[];if(te.minX=Math.min(te.minX,O.minX),te.minY=Math.min(te.minY,O.minY),te.maxX=Math.max(te.maxX,O.maxX),te.maxY=Math.max(te.maxY,O.maxY),he==="Point"||he==="MultiPoint")for(let ve=0;ve<$.length;ve+=3)pe.push($[ve],$[ve+1]),te.numPoints++,te.numSimplified++;else if(he==="LineString")Bt(pe,$,te,L,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ve=0;ve<$.length;ve++)Bt(pe,$[ve],te,L,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(let ve=0;ve<$.length;ve++){const ae=$[ve];for(let Ae=0;Ae<ae.length;Ae++)Bt(pe,ae[Ae],te,L,!0,Ae===0)}if(pe.length){let ve=O.tags||null;if(he==="LineString"&&G.lineMetrics){ve={};for(const Ae in O.tags)ve[Ae]=O.tags[Ae];ve.mapbox_clip_start=$.start/$.size,ve.mapbox_clip_end=$.end/$.size}const ae={geometry:pe,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ve};O.id!==null&&(ae.id=O.id),te.features.push(ae)}}function Bt(te,O,L,G,$,he){const pe=G*G;if(G>0&&O.size<($?pe:G))return void(L.numPoints+=O.length/3);const ve=[];for(let ae=0;ae<O.length;ae+=3)(G===0||O[ae+2]>pe)&&(L.numSimplified++,ve.push(O[ae],O[ae+1])),L.numPoints++;$&&function(ae,Ae){let Re=0;for(let Te=0,$e=ae.length,It=$e-2;Te<$e;It=Te,Te+=2)Re+=(ae[Te]-ae[It])*(ae[Te+1]+ae[It+1]);if(Re>0===Ae)for(let Te=0,$e=ae.length;Te<$e/2;Te+=2){const It=ae[Te],zt=ae[Te+1];ae[Te]=ae[$e-2-Te],ae[Te+1]=ae[$e-1-Te],ae[$e-2-Te]=It,ae[$e-1-Te]=zt}}(ve,he),te.push(ve)}const Mt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class dr{constructor(O,L){const G=(L=this.options=function(he,pe){for(const ve in pe)he[ve]=pe[ve];return he}(Object.create(Mt),L)).debug;if(G&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");let $=function(he,pe){const ve=[];if(he.type==="FeatureCollection")for(let ae=0;ae<he.features.length;ae++)mt(ve,he.features[ae],pe,ae);else mt(ve,he.type==="Feature"?he:{geometry:he},pe);return ve}(O,L);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(he,pe){const ve=pe.buffer/pe.extent;let ae=he;const Ae=vi(he,1,-1-ve,ve,0,-1,2,pe),Re=vi(he,1,1-ve,2+ve,0,-1,2,pe);return(Ae||Re)&&(ae=vi(he,1,-ve,1+ve,0,-1,2,pe)||[],Ae&&(ae=Ve(Ae,1).concat(ae)),Re&&(ae=ae.concat(Ve(Re,-1)))),ae}($,L),$.length&&this.splitTile($,0,0,0),G&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,L,G,$,he,pe,ve){const ae=[O,L,G,$],Ae=this.options,Re=Ae.debug;for(;ae.length;){$=ae.pop(),G=ae.pop(),L=ae.pop(),O=ae.pop();const Te=1<<L,$e=Xr(L,G,$);let It=this.tiles[$e];if(!It&&(Re>1&&console.time("creation"),It=this.tiles[$e]=wr(O,L,G,$,Ae),this.tileCoords.push({z:L,x:G,y:$}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,G,$,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const yr=`z${L}`;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(It.source=O,he==null){if(L===Ae.indexMaxZoom||It.numPoints<=Ae.indexMaxPoints)continue}else{if(L===Ae.maxZoom||L===he)continue;if(he!=null){const yr=he-L;if(G!==pe>>yr||$!==ve>>yr)continue}}if(It.source=null,O.length===0)continue;Re>1&&console.time("clipping");const zt=.5*Ae.buffer/Ae.extent,ci=.5-zt,Zt=.5+zt,ui=1+zt;let ti=null,pr=null,Yi=null,Xt=null,bi=vi(O,Te,G-zt,G+Zt,0,It.minX,It.maxX,Ae),Gi=vi(O,Te,G+ci,G+ui,0,It.minX,It.maxX,Ae);O=null,bi&&(ti=vi(bi,Te,$-zt,$+Zt,1,It.minY,It.maxY,Ae),pr=vi(bi,Te,$+ci,$+ui,1,It.minY,It.maxY,Ae),bi=null),Gi&&(Yi=vi(Gi,Te,$-zt,$+Zt,1,It.minY,It.maxY,Ae),Xt=vi(Gi,Te,$+ci,$+ui,1,It.minY,It.maxY,Ae),Gi=null),Re>1&&console.timeEnd("clipping"),ae.push(ti||[],L+1,2*G,2*$),ae.push(pr||[],L+1,2*G,2*$+1),ae.push(Yi||[],L+1,2*G+1,2*$),ae.push(Xt||[],L+1,2*G+1,2*$+1)}}getTile(O,L,G){O=+O,L=+L,G=+G;const $=this.options,{extent:he,debug:pe}=$;if(O<0||O>24)return null;const ve=1<<O,ae=Xr(O,L=L+ve&ve-1,G);if(this.tiles[ae])return Wi(this.tiles[ae],he);pe>1&&console.log("drilling down to z%d-%d-%d",O,L,G);let Ae,Re=O,Te=L,$e=G;for(;!Ae&&Re>0;)Re--,Te>>=1,$e>>=1,Ae=this.tiles[Xr(Re,Te,$e)];return Ae&&Ae.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",Re,Te,$e),console.time("drilling down")),this.splitTile(Ae.source,Re,Te,$e,O,L,G),pe>1&&console.timeEnd("drilling down"),this.tiles[ae]?Wi(this.tiles[ae],he):null):null}}function Xr(te,O,L){return 32*((1<<te)*L+O)+te}function Ut(te,O){return O?te.properties[O]:te.id}function mn(te,O){if(te==null)return!0;if(te.type==="Feature")return Ut(te,O)!=null;if(te.type==="FeatureCollection"){const L=new Set;for(const G of te.features){const $=Ut(G,O);if($==null||L.has($))return!1;L.add($)}return!0}return!1}function Yn(te,O){const L=new Map;if(te!=null)if(te.type==="Feature")L.set(Ut(te,O),te);else for(const G of te.features)L.set(Ut(G,O),G);return L}class as extends j{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,L){return w._(this,void 0,void 0,function*(){const G=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const $=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!$)return null;const he=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(ae){this._feature=ae,this.extent=w.X,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const Ae of this._feature.geometry)ae.push([new w.P(Ae[0],Ae[1])]);return ae}{const ae=[];for(const Ae of this._feature.geometry){const Re=[];for(const Te of Ae)Re.push(new w.P(Te[0],Te[1]));ae.push(Re)}return ae}}toGeoJSON(ae,Ae,Re){return fe.call(this,ae,Ae,Re)}}(this._features[ve])}}($.features);let pe=pt(he);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:he,rawData:pe.buffer}})}loadData(O){return w._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const G=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest),this._geoJSONIndex=O.cluster?new li(function({superclusterOptions:pe,clusterProperties:ve}){if(!ve||!pe)return pe;const ae={},Ae={},Re={accumulated:null,zoom:0},Te={properties:null},$e=Object.keys(ve);for(const It of $e){const[zt,ci]=ve[It],Zt=w.bC(ci),ui=w.bC(typeof zt=="string"?[zt,["accumulated"],["get",It]]:zt);ae[It]=Zt.value,Ae[It]=ui.value}return pe.map=It=>{Te.properties=It;const zt={};for(const ci of $e)zt[ci]=ae[ci].evaluate(Re,Te);return zt},pe.reduce=(It,zt)=>{Te.properties=zt;for(const ci of $e)Re.accumulated=It[ci],It[ci]=Ae[ci].evaluate(Re,Te)},pe}(O)).load((yield this._pendingData).features):($=yield this._pendingData,new dr($,O.geojsonVtOptions)),this.loaded={};const he={};if(G){const pe=G.finish();pe&&(he.resourceTiming={},he.resourceTiming[O.source]=JSON.parse(JSON.stringify(pe)))}return he}catch(he){if(delete this._pendingRequest,w.bB(he))return{abandoned:!0};throw he}var $})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){const L=this.loaded;return L&&L[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,L){return w._(this,void 0,void 0,function*(){let G=yield this.loadGeoJSON(O,L);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(ce(G,!0),O.filter){const $=w.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($.result==="error")throw new Error($.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(pe=>$.value.evaluate({zoom:0},pe))}}return G})}loadGeoJSON(O,L){return w._(this,void 0,void 0,function*(){const{promoteId:G}=O;if(O.request){const $=yield w.h(O.request,L);return this._dataUpdateable=mn($.data,G)?Yn($.data,G):void 0,$.data}if(typeof O.data=="string")try{const $=JSON.parse(O.data);return this._dataUpdateable=mn($,G)?Yn($,G):void 0,$}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function($,he,pe){var ve,ae,Ae,Re;if(he.removeAll&&$.clear(),he.remove)for(const Te of he.remove)$.delete(Te);if(he.add)for(const Te of he.add){const $e=Ut(Te,pe);$e!=null&&$.set($e,Te)}if(he.update)for(const Te of he.update){let $e=$.get(Te.id);if($e==null)continue;const It=!Te.removeAllProperties&&(((ve=Te.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((ae=Te.addOrUpdateProperties)===null||ae===void 0?void 0:ae.length)>0);if((Te.newGeometry||Te.removeAllProperties||It)&&($e=Object.assign({},$e),$.set(Te.id,$e),It&&($e.properties=Object.assign({},$e.properties))),Te.newGeometry&&($e.geometry=Te.newGeometry),Te.removeAllProperties)$e.properties={};else if(((Ae=Te.removeProperties)===null||Ae===void 0?void 0:Ae.length)>0)for(const zt of Te.removeProperties)Object.prototype.hasOwnProperty.call($e.properties,zt)&&delete $e.properties[zt];if(((Re=Te.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0)for(const{key:zt,value:ci}of Te.addOrUpdateProperties)$e.properties[zt]=ci}}(this._dataUpdateable,O.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Un{constructor(O){this.self=O,this.actor=new w.F(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,G)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=G},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=L=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,G)=>this._getDEMWorkerSource(L,G.source).loadTile(G)),this.actor.registerMessageHandler("RDT",(L,G)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,G.source).removeTile(G)})),this.actor.registerMessageHandler("GCEZ",(L,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,G.type,G.source).getClusterExpansionZoom(G)})),this.actor.registerMessageHandler("GCC",(L,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,G.type,G.source).getClusterChildren(G)})),this.actor.registerMessageHandler("GCL",(L,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,G.type,G.source).getClusterLeaves(G)})),this.actor.registerMessageHandler("LD",(L,G)=>this._getWorkerSource(L,G.type,G.source).loadData(G)),this.actor.registerMessageHandler("GD",(L,G)=>this._getWorkerSource(L,G.type,G.source).getData()),this.actor.registerMessageHandler("LT",(L,G)=>this._getWorkerSource(L,G.type,G.source).loadTile(G)),this.actor.registerMessageHandler("RT",(L,G)=>this._getWorkerSource(L,G.type,G.source).reloadTile(G)),this.actor.registerMessageHandler("AT",(L,G)=>this._getWorkerSource(L,G.type,G.source).abortTile(G)),this.actor.registerMessageHandler("RMT",(L,G)=>this._getWorkerSource(L,G.type,G.source).removeTile(G)),this.actor.registerMessageHandler("RS",(L,G)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][G.type]||!this.workerSources[L][G.type][G.source])return;const $=this.workerSources[L][G.type][G.source];delete this.workerSources[L][G.type][G.source],$.removeSource!==void 0&&$.removeSource(G)})),this.actor.registerMessageHandler("RM",L=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,G)=>w._(this,void 0,void 0,function*(){this.referrer=G})),this.actor.registerMessageHandler("SRPS",(L,G)=>this._syncRTLPluginState(L,G)),this.actor.registerMessageHandler("IS",(L,G)=>w._(this,void 0,void 0,function*(){this.self.importScripts(G)})),this.actor.registerMessageHandler("SI",(L,G)=>this._setImages(L,G)),this.actor.registerMessageHandler("UL",(L,G)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(G.layers,G.removedIds)})),this.actor.registerMessageHandler("SL",(L,G)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(G)}))}_setImages(O,L){return w._(this,void 0,void 0,function*(){this.availableImages[O]=L;for(const G in this.workerSources[O]){const $=this.workerSources[O][G];for(const he in $)$[he].availableImages=L}})}_syncRTLPluginState(O,L){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(L.pluginStatus!=="loading")return w.bD.setState(L),L;const G=L.pluginURL;if(this.self.importScripts(G),w.bD.isParsed()){const $={pluginStatus:"loaded",pluginURL:G};return w.bD.setState($),$}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${G}`)})}_getAvailableImages(O){let L=this.availableImages[O];return L||(L=[]),L}_getLayerIndex(O){let L=this.layerIndexes[O];return L||(L=this.layerIndexes[O]=new c),L}_getWorkerSource(O,L,G){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][L]||(this.workerSources[O][L]={}),!this.workerSources[O][L][G]){const $={sendAsync:(he,pe)=>(he.targetMapId=O,this.actor.sendAsync(he,pe))};switch(L){case"vector":this.workerSources[O][L][G]=new j($,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][L][G]=new as($,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][L][G]=new this.externalWorkerSourceTypes[L]($,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][L][G]}_getDEMWorkerSource(O,L){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][L]||(this.demWorkerSources[O][L]=new V),this.demWorkerSources[O][L]}}return w.i(self)&&(self.worker=new Un(self)),Un}),T("index",["exports","./shared"],function(w,c){var U="4.7.1";let W,K;const j={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((e,n)=>{const a=requestAnimationFrame(e);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(W||(W=document.createElement("a")),W.href=d,W.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in V.docStyle)return e[n];return e[0]}static create(e,n,a){const l=window.document.createElement(e);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,n){e.style[V.transformProp]=n}static addEventListener(e,n,a,l={}){e.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(e,n,a,l={}){e.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const l=n.boundingClientRect;return new c.P((a.clientX-l.left)/n.x-e.clientLeft,(a.clientY-l.top)/n.y-e.clientTop)}static mousePos(e,n){const a=V.getScale(e);return V.getPoint(e,a,n)}static touchPos(e,n){const a=[],l=V.getScale(e);for(let h=0;h<n.length;h++)a.push(V.getPoint(e,l,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const ne={supported:!1,testSupport:function(d){!fe&&ce&&(Ie?_e(d):oe=d)}};let oe,ce,fe=!1,Ie=!1;function _e(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,ce),d.isContextLost())return;ne.supported=!0}catch{}d.deleteTexture(e),fe=!0}var ke;typeof document<"u"&&(ce=document.createElement("img"),ce.onload=()=>{oe&&_e(oe),oe=null,Ie=!0},ce.onerror=()=>{fe=!0,oe=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,a,l;d.resetRequestQueue=()=>{e=[],n=0,a=0,l={}},d.addThrottleControl=S=>{const A=a++;return l[A]=S,A},d.removeThrottleControl=S=>{delete l[S],y()},d.getImage=(S,A,M=!0)=>new Promise((z,B)=>{ne.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),c.e(S,{type:"image"}),e.push({abortController:A,requestParameters:S,supportImageRefresh:M,state:"queued",onError:Z=>{B(Z)},onSuccess:Z=>{z(Z)}}),y()});const h=S=>c._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:A,supportImageRefresh:M,onError:z,onSuccess:B,abortController:Z}=S,H=M===!1&&!c.i(self)&&!c.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((se,le)=>se&&le==="accept",!0));n++;const Q=H?b(A,Z):c.m(A,Z);try{const se=yield Q;delete S.abortController,S.state="completed",se.data instanceof HTMLImageElement||c.b(se.data)?B(se):se.data&&B({data:yield(re=se.data,typeof createImageBitmap=="function"?c.d(re):c.f(re)),cacheControl:se.cacheControl,expires:se.expires})}catch(se){delete S.abortController,z(se)}finally{n--,y()}var re}),y=()=>{const S=(()=>{for(const A of Object.keys(l))if(l[A]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=n;A<S&&e.length>0;A++){const M=e.shift();M.abortController.signal.aborted?A--:h(M)}},b=(S,A)=>new Promise((M,z)=>{const B=new Image,Z=S.url,H=S.credentials;H&&H==="include"?B.crossOrigin="use-credentials":(H&&H==="same-origin"||!c.s(Z))&&(B.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{B.src="",z(c.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,M({data:B})},B.onerror=()=>{B.onerror=B.onload=null,A.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=Z})}(ke||(ke={})),ke.resetRequestQueue();class Ne{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function De(d){var e=new c.A(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var Xe,it=function(d,e,n){return d[0]=e[0]-n[0],d[1]=e[1]-n[1],d[2]=e[2]-n[2],d};Xe=new c.A(3),c.A!=Float32Array&&(Xe[0]=0,Xe[1]=0,Xe[2]=0);var Ct=function(d){var e=d[0],n=d[1];return e*e+n*n};function Je(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:a,url:l}of d){const h=`${a}${l}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:l}))}}return e}function St(d,e,n){const a=d.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var d=new c.A(2);c.A!=Float32Array&&(d[0]=0,d[1]=0)})();class dt{constructor(e,n,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,a){const{width:l,height:h}=e,y=!(this.size&&this.size[0]===l&&this.size[1]===h||a),{context:b}=this,{gl:S}=b;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[l,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,l,h,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:A,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,A,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,A,M,l,h,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,n,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ge(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class Fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||l<e[0]||e[1]<0||h<e[1]||e[2]<0||l<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let l=this.getImage(a);l||(this.fire(new c.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new c.I(l,a);this.patterns[e]={bin:l,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new dt(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=c.p(e),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:y}=this.patterns[h],b=y.x+1,S=y.y+1,A=this.getImage(h).data,M=A.width,z=A.height;c.R.copy(A,l,{x:0,y:0},{x:b,y:S},{width:M,height:z}),c.R.copy(A,l,{x:0,y:z-1},{x:b,y:S-1},{width:M,height:1}),c.R.copy(A,l,{x:0,y:0},{x:b,y:S+z},{width:M,height:1}),c.R.copy(A,l,{x:M-1,y:0},{x:b-1,y:S},{width:1,height:z}),c.R.copy(A,l,{x:0,y:0},{x:b+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),Ge(a)&&this.updateImage(n,a)}}}const Ee=1e20;function Le(d,e,n,a,l,h,y,b,S){for(let A=e;A<e+a;A++)Ke(d,n*h+A,h,l,y,b,S);for(let A=n;A<n+l;A++)Ke(d,A*h+e,1,a,y,b,S)}function Ke(d,e,n,a,l,h,y){h[0]=0,y[0]=-Ee,y[1]=Ee,l[0]=d[e];for(let b=1,S=0,A=0;b<a;b++){l[b]=d[e+b*n];const M=b*b;do{const z=h[S];A=(l[b]-l[z]+M-z*z)/(b-z)/2}while(A<=y[S]&&--S>-1);S++,h[S]=b,y[S]=A,y[S+1]=Ee}for(let b=0,S=0;b<a;b++){for(;y[S+1]<b;)S++;const A=h[S],M=b-A;d[e+b*n]=l[A]+M*M}}class pt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const y of e[h])n.push(this._getAndCacheGlyphsPromise(h,y));const a=yield Promise.all(n),l={};for(const{stack:h,id:y,glyph:b}of a)l[h]||(l[h]={}),l[h][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return l})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:e,id:n,glyph:l};if(l=this._tinySDF(a,e,n),l)return a.glyphs[n]=l,{stack:e,id:n,glyph:l};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const b=pt.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=b}const y=yield a.requests[h];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(a.glyphs[+b]=y[+b]);return a.ranges[h]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),h=e.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:b})}const y=h.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(d,e,n,a){return c._(this,void 0,void 0,function*(){const l=256*e,h=l+255,y=a.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${l}-${h}`),"Glyphs"),b=yield c.l(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${h}`);const S={};for(const A of c.n(b.data))S[A.id]=A;return S})},pt.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const b=this.size=d+4*e,S=this._createCanvas(b),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${h} ${d}px ${l}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(d),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),S=Math.min(this.size-this.buffer,y+Math.ceil(a)),A=b+2*this.buffer,M=S+2*this.buffer,z=Math.max(A*M,0),B=new Uint8ClampedArray(z),Z={data:B,width:A,height:M,glyphWidth:b,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||S===0)return Z;const{ctx:H,buffer:Q,gridInner:re,gridOuter:se}=this;H.clearRect(Q,Q,b,S),H.fillText(d,Q,Q+y);const le=H.getImageData(Q,Q,b,S);se.fill(Ee,0,z),re.fill(0,0,z);for(let J=0;J<S;J++)for(let de=0;de<b;de++){const me=le.data[4*(J*b+de)+3]/255;if(me===0)continue;const be=(J+Q)*A+de+Q;if(me===1)se[be]=0,re[be]=Ee;else{const ze=.5-me;se[be]=ze>0?ze*ze:0,re[be]=ze<0?ze*ze:0}}Le(se,0,0,A,M,A,this.f,this.v,this.z),Le(re,Q,Q,b,S,A,this.f,this.v,this.z);for(let J=0;J<z;J++){const de=Math.sqrt(se[J])-Math.sqrt(re[J]);B[J]=Math.round(255-255*(de/this.radius+this.cutoff))}return Z}};class yt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let lt;class ut extends c.E{constructor(e){super(),lt=lt||new c.q({anchor:new c.D(c.v.light.anchor),position:new yt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(lt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Ft=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class qt extends c.E{constructor(e){super(),this._transitionable=new c.T(Ft),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class fi{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,b=!0;l.push({left:h,right:y,isDash:b,zeroLength:e[0]===0});let S=e[0];for(let A=1;A<e.length;A++){b=!b;const M=e[A];h=S*a,S+=M,y=S*a,l.push({left:h,right:y,isDash:b,zeroLength:M===0})}return l}addRoundDash(e,n,a){const l=n/2;for(let h=-a;h<=a;h++){const y=this.width*(this.nextRow+a+h);let b=0,S=e[b];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++b]);const M=Math.abs(A-S.left),z=Math.abs(A-S.right),B=Math.min(M,z);let Z;const H=h/a*(l+1);if(S.isDash){const Q=l-Math.abs(H);Z=Math.sqrt(B*B+Q*Q)}else Z=l-Math.sqrt(B*B+H*H);this.data[y+A]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const S=e[b],A=e[b+1];S.zeroLength?e.splice(b,1):A&&A.isDash===S.isDash&&(A.left=S.left,e.splice(b,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,y=e[h];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++h]);const S=Math.abs(b-y.left),A=Math.abs(b-y.right),M=Math.min(S,A);this.data[l+b]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let b=0;b<e.length;b++)h+=e[b];if(h!==0){const b=this.width/h,S=this.getDashRanges(e,this.width,b);n?this.addRoundDash(S,b,a):this.addRegularDash(S)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=l,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const li="maplibre_preloaded_worker_pool";class Si{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Si.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[li]}numActive(){return Object.keys(this.active).length}}const _i=Math.floor(j.hardwareConcurrency/2);let yi,Pi;function Ui(){return yi||(yi=new Si),yi}Si.workerCount=c.C(globalThis)?Math.max(Math.min(_i,3),1):1;class qi{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const h=new c.F(a[l],n);h.name=`Worker ${l}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function Zi(){return Pi||(Pi=new qi(Ui(),c.G),Pi.registerMessageHandler("GR",(d,e,n)=>c.m(e,n))),Pi}function Xi(d,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*d.width,.5*d.height,1]),c.L(n,n,d.calculatePosMatrix(e.toUnwrapped()))}function Ei(d,e,n,a,l,h){const y=function(z,B,Z){if(z)for(const H of z){const Q=B[H];if(Q&&Q.source===Z&&Q.type==="fill-extrusion")return!0}else for(const H in B){const Q=B[H];if(Q.source===Z&&Q.type==="fill-extrusion")return!0}return!1}(l&&l.layers,e,d.id),b=h.maxPitchScaleFactor(),S=d.tilesIn(a,b,y);S.sort(mt);const A=[];for(const z of S)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,d._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,l,h,b,Xi(d.transform,z.tileID))});const M=function(z){const B={},Z={};for(const H of z){const Q=H.queryResults,re=H.wrappedTileID,se=Z[re]=Z[re]||{};for(const le in Q){const J=Q[le],de=se[le]=se[le]||{},me=B[le]=B[le]||[];for(const be of J)de[be.featureIndex]||(de[be.featureIndex]=!0,me.push(be))}}return B}(A);for(const z in M)M[z].forEach(B=>{const Z=B.feature,H=d.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return M}function mt(d,e){const n=d.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function kt(d,e,n){return c._(this,void 0,void 0,function*(){let a=d;if(d.url?a=(yield c.h(e.transformRequest(d.url,"Source"),n)).data:yield j.frameAsync(n),!a)return null;const l=c.M(c.e(a,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(h=>h.id)),l})}class ye{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let l,h;if(e instanceof c.N)l=e,h=e;else{if(!(e instanceof ye))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ye.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new c.N(l.lng,l.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof ye?e:e&&new ye(e)}static fromLngLat(e,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new ye(new c.N(e.lng-l,e.lat-a),new c.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new ye(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class Ri{constructor(e,n,a){this.bounds=ye.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),l=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),y=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=l&&e.y<y}}class sn extends c.E{constructor(e,n,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield kt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,y)=>{e.reloadPromise={resolve:h,reject:y}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ht extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield kt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new Ri(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield ke.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,h=l.gl,y=a.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new dt(l,y,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class vi extends Ht{constructor(e,n,a,l){super(e,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield ke.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const h=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const y=c.b(h)&&c.U()?h:yield this.readImageNow(h),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return j.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+a)%a,b=n.x+1===a?e.wrap+1:e.wrap,S={};return S[new c.S(e.overscaledZ,h,n.z,l,n.y).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new c.S(e.overscaledZ,h,n.z,l,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(S[new c.S(e.overscaledZ,h,n.z,l,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),S}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Ki extends c.E{constructor(e,n,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(j.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&c.e(h,{resourceTiming:l}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var xi=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class tr extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield ke.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(l){let h=1/0,y=1/0,b=-1/0,S=-1/0;for(const B of l)h=Math.min(h,B.x),y=Math.min(y,B.y),b=Math.max(b,B.x),S=Math.max(S,B.y);const A=Math.max(b-h,S-y),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,M);return new c.a1(M,Math.floor((h+b)/2*z),Math.floor((y+S)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,xi.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new dt(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ar extends tr{constructor(e,n,a,l){super(e,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,xi.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new dt(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ir extends tr{constructor(e,n,a,l){super(e,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(y=>typeof y!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,xi.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new dt(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const h in this.tiles){const y=this.tiles[h];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,l=!0)}l&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const hr={},Er=d=>{switch(d){case"geojson":return Ki;case"image":return tr;case"raster":return Ht;case"raster-dem":return vi;case"vector":return sn;case"video":return ar;case"canvas":return ir}return hr[d]},Ve="RTLPluginLoaded";class Ji extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Zi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Ve))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Wi=null;function kr(){return Wi||(Wi=new Ji),Wi}class wr{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const y={};if(!h)return y;for(const b of l){const S=b.layerIds.map(A=>h.getLayer(A)).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(A=>S.filter(M=>M.id===A)[0]));for(const A of S)y[A.id]=b}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,kr().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dt(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dt(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,l,h,y,b,S,A,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:h,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:b,queryPadding:this.queryPadding*A},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",y=l._geojsonTileLayer||l[h];if(!y)return;const b=c.a7(n&&n.filter),{z:S,x:A,y:M}=this.tileID.canonical,z={z:S,x:A,y:M};for(let B=0;B<y.length;B++){const Z=y.feature(B);if(b.needGeometry){const re=c.a8(Z,!0);if(!b.filter(new c.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!b.filter(new c.z(this.tileID.overscaledZ),Z))continue;const H=a.getId(Z,h),Q=new c.a9(Z,S,A,M,H);Q.tile=z,e.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const h=this.buckets[l],y=h.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],S=e[y];if(!b||!S||Object.keys(S).length===0)continue;h.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=n&&n.style&&n.style.getLayer(l);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=j.now()+e}setDependencies(e,n){const a={};for(const l of n)a[l]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const l=this.dependencies[a];if(l){for(const h of n)if(l[h])return!0}}return!1}}class We{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class Bt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},c.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),l=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const y in h)delete l[y]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const y in this.stateChanges[l])this.state[l][y]||(this.state[l][y]={}),c.e(this.state[l][y],this.stateChanges[l][y]),h[y]=this.state[l][y];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const y in this.state[l])h[y]={},this.state[l][y]={};else for(const y in this.deletedStates[l]){if(this.deletedStates[l][y]===null)this.state[l][y]={};else for(const b of Object.keys(this.deletedStates[l][y]))delete this.state[l][y][b];h[y]=this.state[l][y]}a[l]=a[l]||{},c.e(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,n)}}class Mt extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,h,y,b)=>{const S=new(Er(h.type))(l,h,y,b);if(S.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${S.id}`);return S})(e,n,a,this),this._tiles={},this._cache=new We(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new c.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(dr).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,l)=>{const h=a.tileID,y=l.tileID,b=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),S=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-y.overscaledZ||S.y-b.y||S.x-b.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(dr).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=j.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const h=n[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const y=this.getTileByID(h);a(e,y),a(y,e)}}function a(l,h){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let y=h.tileID.canonical.x-l.tileID.canonical.x;const b=h.tileID.canonical.y-l.tileID.canonical.y,S=Math.pow(2,l.tileID.canonical.z),A=h.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,y,b),l.neighboringTiles&&l.neighboringTiles[A]&&(l.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,l){for(const h in this._tiles){let y=this._tiles[h];if(l[h]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>a)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const A=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[A.key],y&&y.hasData()&&(b=A)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){l[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,n,a,l,h,y){const b={},S={},A=Object.keys(e),M=j.now();for(const z of A){const B=e[z],Z=this._tiles[z];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=M)continue;const H=this.findLoadedParent(B,n),Q=this.findLoadedSibling(B),re=H||Q||null;re&&(this._addTile(re.tileID),b[re.tileID.key]=re.tileID),S[z]=B}this._retainLoadedChildren(S,l,a,e);for(const z in b)e[z]||(this._coveredTiles[z]=!0,e[z]=b[z]);if(y){const z={},B={};for(const Z of h)this._tiles[Z.key].hasData()?z[Z.key]=Z:B[Z.key]=Z;for(const Z in B){const H=B[Z].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(z[H[0].key]=e[H[0].key]=H[0],z[H[1].key]=e[H[1].key]=H[1],z[H[2].key]=e[H[2].key]=H[2],z[H[3].key]=e[H[3].key]=H[3],delete B[Z])}for(const Z in B){const H=B[Z],Q=this.findLoadedParent(H,this._source.minzoom),re=this.findLoadedSibling(H),se=Q||re||null;if(se){z[se.tileID.key]=e[se.tileID.key]=se.tileID;for(const le in z)z[le].isChildOf(se.tileID)&&delete z[le]}}for(const Z in this._tiles)z[Z]||(this._coveredTiles[Z]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const l=e.coveringZoomLevel(this._source),h=Math.max(l-Mt.maxOverzooming,this._source.minzoom),y=Math.max(l+Mt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);M[B.key]=B;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[Z.key]=Z}a=a.concat(Object.values(M))}const b=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,l);Xr(this._source.type)&&this._updateCoveredAndRetainedTiles(S,h,y,l,a,n);for(const M in S)this._tiles[M].clearFadeHold();const A=c.ab(this._tiles,S);for(const M of A){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const l={},h={},y=Math.max(n-Mt.maxOverzooming,this._source.minzoom),b=Math.max(n+Mt.maxUnderzooming,this._source.minzoom),S={};for(const A of e){const M=this._addTile(A);l[A.key]=A,M.hasData()||n<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,n,b,l);for(const A of e){let M=this._tiles[A.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){const B=A.children(this._source.maxzoom)[0],Z=this.getTile(B);if(Z&&Z.hasData()){l[B.key]=B;continue}}else{const B=A.children(this._source.maxzoom);if(l[B[0].key]&&l[B[1].key]&&l[B[2].key]&&l[B[3].key])continue}let z=M.wasRequested();for(let B=A.overscaledZ-1;B>=y;--B){const Z=A.scaledTo(B);if(h[Z.key])break;if(h[Z.key]=!0,M=this.getTile(Z),!M&&z&&(M=this._addTile(Z)),M){const H=M.hasData();if((H||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(l[Z.key]=Z),z=M.wasRequested(),H)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new wr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const l=[],h=this.transform;if(!h)return l;const y=a?h.getCameraQueryGeometry(e):e,b=e.map(H=>h.pointCoordinate(H,this.terrain)),S=y.map(H=>h.pointCoordinate(H,this.terrain)),A=this.getIds();let M=1/0,z=1/0,B=-1/0,Z=-1/0;for(const H of S)M=Math.min(M,H.x),z=Math.min(z,H.y),B=Math.max(B,H.x),Z=Math.max(Z,H.y);for(let H=0;H<A.length;H++){const Q=this._tiles[A[H]];if(Q.holdingForFade())continue;const re=Q.tileID,se=Math.pow(2,h.zoom-Q.tileID.overscaledZ),le=n*Q.queryPadding*c.X/Q.tileSize/se,J=[re.getTilePoint(new c.Z(M,z)),re.getTilePoint(new c.Z(B,Z))];if(J[0].x-le<c.X&&J[0].y-le<c.X&&J[1].x+le>=0&&J[1].y+le>=0){const de=b.map(be=>re.getTilePoint(be)),me=S.map(be=>re.getTilePoint(be));l.push({tile:Q,tileID:re,queryGeometry:de,cameraQueryGeometry:me,scale:se})}}return l}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Xr(this._source.type)){const e=j.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const l=this._tiles[e];l&&l.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function dr(d,e){const n=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||a-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function Xr(d){return d==="raster"||d==="image"||d==="video"}Mt.maxOverzooming=10,Mt.maxUnderzooming=3;class Ut{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const l=e*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const h=n-1,y=this._distances[h],b=a-y,S=b>0?(l-y)/b:0;return this.points[h].mult(1-S).add(this.points[n].mult(S))}}function mn(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class Yn{constructor(e,n,a){const l=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)l.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,l,h){this._forEachCell(n,a,l,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h)}insertCircle(e,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,n,a,l,h,y){this.boxCells[h].push(y)}_insertCircleCell(e,n,a,l,h,y){this.circleCells[h].push(y)}_query(e,n,a,l,h,y,b){if(a<0||e>this.width||l<0||n>this.height)return[];const S=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=l){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:l}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],z=this.circles[3*A+1],B=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:M-B,y1:z-B,x2:M+B,y2:z+B})}}else this._forEachCell(e,n,a,l,this._queryCell,S,{hitTest:h,overlapMode:y,seenUids:{box:{},circle:{}}},b);return S}query(e,n,a,l){return this._query(e,n,a,l,!1,null)}hitTest(e,n,a,l,h,y){return this._query(e,n,a,l,!0,h,y).length>0}hitTestCircle(e,n,a,l,h){const y=e-a,b=e+a,S=n-a,A=n+a;if(b<0||y>this.width||A<0||S>this.height)return!1;const M=[];return this._forEachCell(y,S,b,A,this._queryCellCircle,M,{hitTest:!0,overlapMode:l,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),M.length>0}_queryCell(e,n,a,l,h,y,b,S){const{seenUids:A,hitTest:M,overlapMode:z}=b,B=this.boxCells[h];if(B!==null){const H=this.bboxes;for(const Q of B)if(!A.box[Q]){A.box[Q]=!0;const re=4*Q,se=this.boxKeys[Q];if(e<=H[re+2]&&n<=H[re+3]&&a>=H[re+0]&&l>=H[re+1]&&(!S||S(se))&&(!M||!mn(z,se.overlapMode))&&(y.push({key:se,x1:H[re],y1:H[re+1],x2:H[re+2],y2:H[re+3]}),M))return!0}}const Z=this.circleCells[h];if(Z!==null){const H=this.circles;for(const Q of Z)if(!A.circle[Q]){A.circle[Q]=!0;const re=3*Q,se=this.circleKeys[Q];if(this._circleAndRectCollide(H[re],H[re+1],H[re+2],e,n,a,l)&&(!S||S(se))&&(!M||!mn(z,se.overlapMode))){const le=H[re],J=H[re+1],de=H[re+2];if(y.push({key:se,x1:le-de,y1:J-de,x2:le+de,y2:J+de}),M)return!0}}}return!1}_queryCellCircle(e,n,a,l,h,y,b,S){const{circle:A,seenUids:M,overlapMode:z}=b,B=this.boxCells[h];if(B!==null){const H=this.bboxes;for(const Q of B)if(!M.box[Q]){M.box[Q]=!0;const re=4*Q,se=this.boxKeys[Q];if(this._circleAndRectCollide(A.x,A.y,A.radius,H[re+0],H[re+1],H[re+2],H[re+3])&&(!S||S(se))&&!mn(z,se.overlapMode))return y.push(!0),!0}}const Z=this.circleCells[h];if(Z!==null){const H=this.circles;for(const Q of Z)if(!M.circle[Q]){M.circle[Q]=!0;const re=3*Q,se=this.circleKeys[Q];if(this._circlesCollide(H[re],H[re+1],H[re+2],A.x,A.y,A.radius)&&(!S||S(se))&&!mn(z,se.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,a,l,h,y,b,S){const A=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),B=this._convertToYCellCoord(l);for(let Z=A;Z<=z;Z++)for(let H=M;H<=B;H++)if(h.call(this,e,n,a,l,this.xCellCount*H+Z,y,b,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,l,h,y){const b=l-e,S=h-n,A=a+y;return A*A>b*b+S*S}_circleAndRectCollide(e,n,a,l,h,y,b){const S=(y-l)/2,A=Math.abs(e-(l+S));if(A>S+a)return!1;const M=(b-h)/2,z=Math.abs(n-(h+M));if(z>M+a)return!1;if(A<=S||z<=M)return!0;const B=A-S,Z=z-M;return B*B+Z*Z<=a*a}}function as(d,e,n,a,l){const h=c.H();return e?(c.K(h,h,[1/l,1/l,1]),n||c.ad(h,h,a.angle)):c.L(h,a.labelPlaneMatrix,d),h}function Un(d,e,n,a,l){if(e){const h=c.ae(d);return c.K(h,h,[l,l,1]),n||c.ad(h,h,-a.angle),h}return a.glCoordMatrix}function te(d,e,n,a){let l;a?(l=[d,e,a(d,e),1],c.af(l,l,n)):(l=[d,e,0,1],ci(l,l,n));const h=l[3];return{point:new c.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function O(d,e){return .5+d/e*.5}function L(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function G(d,e,n,a,l,h,y,b,S,A,M,z,B,Z,H){const Q=a?d.textSizeData:d.iconSizeData,re=c.ag(Q,n.transform.zoom),se=[256/n.width*2+1,256/n.height*2+1],le=a?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;le.clear();const J=d.lineVertexArray,de=a?d.text.placedSymbolArray:d.icon.placedSymbolArray,me=n.transform.width/n.transform.height;let be=!1;for(let ze=0;ze<de.length;ze++){const He=de.get(ze);if(He.hidden||He.writingMode===c.ah.vertical&&!be){zt(He.numGlyphs,le);continue}be=!1;const st=te(He.anchorX,He.anchorY,e,H);if(!L(st.point,se)){zt(He.numGlyphs,le);continue}const ht=O(n.transform.cameraToCenterDistance,st.signedDistanceFromCamera),et=c.ai(Q,re,He),Qe=y?et/ht:et*ht,xt={getElevation:H,labelPlaneMatrix:l,lineVertexArray:J,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:A,tileAnchorPoint:new c.P(He.anchorX,He.anchorY),unwrappedTileID:M,width:z,height:B,translation:Z},jt=pe(xt,He,Qe,!1,b,e,h,d.glyphOffsetArray,le,me,S);be=jt.useVertical,(jt.notEnoughRoom||be||jt.needsFlipping&&pe(xt,He,Qe,!0,b,e,h,d.glyphOffsetArray,le,me,S).notEnoughRoom)&&zt(He.numGlyphs,le)}a?d.text.dynamicLayoutVertexBuffer.updateData(le):d.icon.dynamicLayoutVertexBuffer.updateData(le)}function $(d,e,n,a,l,h,y,b){const S=h.glyphStartIndex+h.numGlyphs,A=h.lineStartIndex,M=h.lineStartIndex+h.lineLength,z=e.getoffsetX(h.glyphStartIndex),B=e.getoffsetX(S-1),Z=$e(d*z,n,a,l,h.segment,A,M,b,y);if(!Z)return null;const H=$e(d*B,n,a,l,h.segment,A,M,b,y);return H?b.projectionCache.anyProjectionOccluded?null:{first:Z,last:H}:null}function he(d,e,n,a){return d===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(d===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function pe(d,e,n,a,l,h,y,b,S,A,M){const z=n/24,B=e.lineOffsetX*z,Z=e.lineOffsetY*z;let H;if(e.numGlyphs>1){const Q=e.glyphStartIndex+e.numGlyphs,re=e.lineStartIndex,se=e.lineStartIndex+e.lineLength,le=$(z,b,B,Z,a,e,M,d);if(!le)return{notEnoughRoom:!0};const J=te(le.first.point.x,le.first.point.y,y,d.getElevation).point,de=te(le.last.point.x,le.last.point.y,y,d.getElevation).point;if(l&&!a){const me=he(e.writingMode,J,de,A);if(me)return me}H=[le.first];for(let me=e.glyphStartIndex+1;me<Q-1;me++)H.push($e(z*b.getoffsetX(me),B,Z,a,e.segment,re,se,d,M));H.push(le.last)}else{if(l&&!a){const re=te(d.tileAnchorPoint.x,d.tileAnchorPoint.y,h,d.getElevation).point,se=e.lineStartIndex+e.segment+1,le=new c.P(d.lineVertexArray.getx(se),d.lineVertexArray.gety(se)),J=te(le.x,le.y,h,d.getElevation),de=J.signedDistanceFromCamera>0?J.point:function(be,ze,He,st,ht,et){return ve(be,ze,He,1,ht,et)}(d.tileAnchorPoint,le,re,0,h,d),me=he(e.writingMode,re,de,A);if(me)return me}const Q=$e(z*b.getoffsetX(e.glyphStartIndex),B,Z,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,d,M);if(!Q||d.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[Q]}for(const Q of H)c.aj(S,Q.point,Q.angle);return{}}function ve(d,e,n,a,l,h){const y=d.add(d.sub(e)._unit()),b=l!==void 0?te(y.x,y.y,l,h.getElevation).point:Ae(y.x,y.y,h).point,S=n.sub(b);return n.add(S._mult(a/S.mag()))}function ae(d,e,n){const a=e.projectionCache;if(a.projections[d])return a.projections[d];const l=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),h=Ae(l.x,l.y,e);if(h.signedDistanceFromCamera>0)return a.projections[d]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const y=d-n.direction;return function(b,S,A,M,z){return ve(b,S,A,M,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),l,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function Ae(d,e,n){const a=d+n.translation[0],l=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,l,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=te(a,l,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function Re(d,e,n){return d._unit()._perp()._mult(e*n)}function Te(d,e,n,a,l,h,y,b,S){if(b.projectionCache.offsets[d])return b.projectionCache.offsets[d];const A=n.add(e);if(d+S.direction<a||d+S.direction>=l)return b.projectionCache.offsets[d]=A,A;const M=ae(d+S.direction,b,S),z=Re(M.sub(n),y,S.direction),B=n.add(z),Z=M.add(z);return b.projectionCache.offsets[d]=c.ak(h,A,B,Z)||A,b.projectionCache.offsets[d]}function $e(d,e,n,a,l,h,y,b,S){const A=a?d-e:d+e;let M=A>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let B,Z=M>0?h+l:h+l+1;b.projectionCache.cachedAnchorPoint?B=b.projectionCache.cachedAnchorPoint:(B=Ae(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=B);let H,Q,re=B,se=B,le=0,J=0;const de=Math.abs(A),me=[];let be;for(;le+J<=de;){if(Z+=M,Z<h||Z>=y)return null;le+=J,se=re,Q=H;const st={absOffsetX:de,direction:M,distanceFromAnchor:le,previousVertex:se};if(re=ae(Z,b,st),n===0)me.push(se),be=re.sub(se);else{let ht;const et=re.sub(se);ht=et.mag()===0?Re(ae(Z+M,b,st).sub(re),n,M):Re(et,n,M),Q||(Q=se.add(ht)),H=Te(Z,ht,re,h,y,Q,n,b,st),me.push(Q),be=H.sub(Q)}J=be.mag()}const ze=be._mult((de-le)/J)._add(Q||se),He=z+Math.atan2(re.y-se.y,re.x-se.x);return me.push(ze),{point:ze,angle:S?He:0,path:me}}const It=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function zt(d,e){for(let n=0;n<d;n++){const a=e.length;e.resize(a+4),e.float32.set(It,3*a)}}function ci(d,e,n){const a=e[0],l=e[1];return d[0]=n[0]*a+n[4]*l+n[12],d[1]=n[1]*a+n[5]*l+n[13],d[3]=n[3]*a+n[7]*l+n[15],d}const Zt=100;class ui{constructor(e,n,a=new Yn(e.width+200,e.height+200,25),l=new Yn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Zt,this.screenBottomBoundary=e.height+Zt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,l,h,y,b,S,A,M,z){const B=e.anchorPointX+S[0],Z=e.anchorPointY+S[1],H=this.projectAndGetPerspectiveRatio(l,B,Z,h,M),Q=a*H.perspectiveRatio;let re;if(y||b)re=this._projectCollisionBox(e,Q,l,h,y,b,S,H,M,z);else{const me=H.point.x+(z?z.x*Q:0),be=H.point.y+(z?z.y*Q:0);re={allPointsOccluded:!1,box:[me+e.x1*Q,be+e.y1*Q,me+e.x2*Q,be+e.y2*Q]}}const[se,le,J,de]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(y?re.allPointsOccluded:this.mapProjection.isOccluded(B,Z,h))||H.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(se,le,J,de)||n!=="always"&&this.grid.hitTest(se,le,J,de,n,A)?{box:[se,le,J,de],placeable:!1,offscreen:!1}:{box:[se,le,J,de],placeable:!0,offscreen:this.isOffscreen(se,le,J,de)}}placeCollisionCircles(e,n,a,l,h,y,b,S,A,M,z,B,Z,H,Q,re){const se=[],le=new c.P(n.anchorX,n.anchorY),J=this.getPerspectiveRatio(y,le.x,le.y,b,re),de=(z?h/J:h*J)/c.ap,me={getElevation:re,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:le,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:Q},be=$(de,l,n.lineOffsetX*de,n.lineOffsetY*de,!1,n,!1,me);let ze=!1,He=!1,st=!0;if(be){const ht=.5*Z*J+H,et=new c.P(-100,-100),Qe=new c.P(this.screenRightBoundary,this.screenBottomBoundary),xt=new Ut,jt=be.first,rt=be.last;let at=[];for(let Gt=jt.path.length-1;Gt>=1;Gt--)at.push(jt.path[Gt]);for(let Gt=1;Gt<rt.path.length;Gt++)at.push(rt.path[Gt]);const Nt=2.5*ht;if(A){const Gt=this.projectPathToScreenSpace(at,me,A);at=Gt.some(ii=>ii.signedDistanceFromCamera<=0)?[]:Gt.map(ii=>ii.point)}let Oi=[];if(at.length>0){const Gt=at[0].clone(),ii=at[0].clone();for(let Fi=1;Fi<at.length;Fi++)Gt.x=Math.min(Gt.x,at[Fi].x),Gt.y=Math.min(Gt.y,at[Fi].y),ii.x=Math.max(ii.x,at[Fi].x),ii.y=Math.max(ii.y,at[Fi].y);Oi=Gt.x>=et.x&&ii.x<=Qe.x&&Gt.y>=et.y&&ii.y<=Qe.y?[at]:ii.x<et.x||Gt.x>Qe.x||ii.y<et.y||Gt.y>Qe.y?[]:c.al([at],et.x,et.y,Qe.x,Qe.y)}for(const Gt of Oi){xt.reset(Gt,.25*ht);let ii=0;ii=xt.length<=.5*ht?1:Math.ceil(xt.paddedLength/Nt)+1;for(let Fi=0;Fi<ii;Fi++){const zr=Fi/Math.max(ii-1,1),Mn=xt.lerp(zr),Bi=Mn.x+Zt,Yr=Mn.y+Zt;se.push(Bi,Yr,ht,0);const Vr=Bi-ht,Dr=Yr-ht,jr=Bi+ht,Wn=Yr+ht;if(st=st&&this.isOffscreen(Vr,Dr,jr,Wn),He=He||this.isInsideGrid(Vr,Dr,jr,Wn),e!=="always"&&this.grid.hitTestCircle(Bi,Yr,ht,e,B)&&(ze=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!M&&ze||!He||J<this.perspectiveRatioCutoff?[]:se,offscreen:st,collisionDetected:ze}}projectPathToScreenSpace(e,n,a){return e.map(l=>te(l.x,l.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,h=-1/0,y=-1/0;for(const M of e){const z=new c.P(M.x+Zt,M.y+Zt);a=Math.min(a,z.x),l=Math.min(l,z.y),h=Math.max(h,z.x),y=Math.max(y,z.y),n.push(z)}const b=this.grid.query(a,l,h,y).concat(this.ignoredGrid.query(a,l,h,y)),S={},A={};for(const M of b){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const B=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(n,B)&&(S[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(e,n,a,l,h,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,l,h,y){const b=a?this.ignoredGrid:this.grid,S={bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n};for(let A=0;A<e.length;A+=4)b.insertCircle(S,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,n,a,l,h){let y;h?(y=[n,a,h(n,a),1],c.af(y,y,e)):(y=[n,a,0,1],ci(y,y,e));const b=y[3];return{point:new c.P((y[0]/b+1)/2*this.transform.width+Zt,(-y[1]/b+1)/2*this.transform.height+Zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}getPerspectiveRatio(e,n,a,l,h){const y=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,h):te(n,a,e,h);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,n,a,l){return a<Zt||e>=this.screenRightBoundary||l<Zt||n>this.screenBottomBoundary}isInsideGrid(e,n,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,l,h,y,b,S,A,M){let z=new c.P(1,0),B=new c.P(0,1);const Z=new c.P(e.anchorPointX+b[0],e.anchorPointY+b[1]);if(y&&!h){const st=this.projectAndGetPerspectiveRatio(a,Z.x+1,Z.y,l,A).point.sub(S.point).unit(),ht=Math.atan(st.y/st.x)+(st.x<0?Math.PI:0),et=Math.sin(ht),Qe=Math.cos(ht);z=new c.P(Qe,et),B=new c.P(-et,Qe)}else if(!y&&h){const st=-this.transform.angle,ht=Math.sin(st),et=Math.cos(st);z=new c.P(et,ht),B=new c.P(-ht,et)}let H=S.point,Q=n;if(h){H=Z;const st=this.transform.zoom-Math.floor(this.transform.zoom);Q=Math.pow(2,-st),Q*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,l),M||(Q*=c.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(H=H.add(z.mult(M.x*Q)).add(B.mult(M.y*Q)));const re=e.x1*Q,se=e.x2*Q,le=(re+se)/2,J=e.y1*Q,de=e.y2*Q,me=(J+de)/2,be=[{offsetX:re,offsetY:J},{offsetX:le,offsetY:J},{offsetX:se,offsetY:J},{offsetX:se,offsetY:me},{offsetX:se,offsetY:de},{offsetX:le,offsetY:de},{offsetX:re,offsetY:de},{offsetX:re,offsetY:me}];let ze=[];for(const{offsetX:st,offsetY:ht}of be)ze.push(new c.P(H.x+z.x*st+B.x*ht,H.y+z.y*st+B.y*ht));let He=!1;if(h){const st=ze.map(ht=>this.projectAndGetPerspectiveRatio(a,ht.x,ht.y,l,A));He=st.some(ht=>!ht.isOccluded),ze=st.map(ht=>ht.point)}else He=!0;return{box:c.ao(ze),allPointsOccluded:!He}}}function ti(d,e,n){return e*(c.X/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class pr{constructor(e,n,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Yi{constructor(e,n,a,l,h){this.text=new pr(e?e.text:null,n,a,h),this.icon=new pr(e?e.icon:null,n,l,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xt{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class bi{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class Gi{constructor(e,n,a,l,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=h}}class yr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function Sr(d,e,n,a,l){const{horizontalAlign:h,verticalAlign:y}=c.au(d);return new c.P(-(h-.5)*e+a[0]*l,-(y-.5)*n+a[1]*l)}class Nr{constructor(e,n,a,l,h,y){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new ui(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new yr(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,l)=>n.getElevation(e,a,l):null}getBucketParts(e,n,a,l){const h=a.getBucket(n),y=a.latestFeatureIndex;if(!h||!y||n.id!==h.layerIds[0])return;const b=a.collisionBoxArray,S=h.layers[0].layout,A=h.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,B=a.tileID.toUnwrapped(),Z=this.transform.calculatePosMatrix(B),H=S.get("text-pitch-alignment")==="map",Q=S.get("text-rotation-alignment")==="map",re=ti(a,1,this.transform.zoom),se=this.collisionIndex.mapProjection.translatePosition(this.transform,a,A.get("text-translate"),A.get("text-translate-anchor")),le=this.collisionIndex.mapProjection.translatePosition(this.transform,a,A.get("icon-translate"),A.get("icon-translate-anchor")),J=as(Z,H,Q,this.transform,re);let de=null;if(H){const be=Un(Z,H,Q,this.transform,re);de=c.L([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[h.bucketInstanceId]=new Gi(h.bucketInstanceId,y,h.sourceLayerIndex,h.index,a.tileID);const me={bucket:h,layout:S,translationText:se,translationIcon:le,posMatrix:Z,unwrappedTileID:B,textLabelPlaneMatrix:J,labelToScreenMatrix:de,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(l)for(const be of h.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:He,symbolInstanceEnd:st}=be;e.push({sortKey:ze,symbolInstanceStart:He,symbolInstanceEnd:st,parameters:me})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:me})}attemptAnchorPlacement(e,n,a,l,h,y,b,S,A,M,z,B,Z,H,Q,re,se,le,J){const de=c.aq[e.textAnchor],me=[e.textOffset0,e.textOffset1],be=Sr(de,a,l,me,h),ze=this.collisionIndex.placeCollisionBox(n,B,S,A,M,b,y,re,z.predicate,J,be);if((!le||this.collisionIndex.placeCollisionBox(le,B,S,A,M,b,y,se,z.predicate,J,be).placeable)&&ze.placeable){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(He=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:me,width:a,height:l,anchor:de,textBoxScale:h,prevAnchor:He},this.markUsedJustification(H,de,Z,Q),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Q,Z),this.placedOrientations[Z.crossTileID]=Q),{shift:be,placedGlyphBoxes:ze}}}placeLayerBucketPart(e,n,a){const{bucket:l,layout:h,translationText:y,translationIcon:b,posMatrix:S,unwrappedTileID:A,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:B,holdingForFade:Z,collisionBoxArray:H,partiallyEvaluatedTextSize:Q,collisionGroup:re}=e.parameters,se=h.get("text-optional"),le=h.get("icon-optional"),J=c.ar(h,"text-overlap","text-allow-overlap"),de=J==="always",me=c.ar(h,"icon-overlap","icon-allow-overlap"),be=me==="always",ze=h.get("text-rotation-alignment")==="map",He=h.get("text-pitch-alignment")==="map",st=h.get("icon-text-fit")!=="none",ht=h.get("symbol-z-order")==="viewport-y",et=de&&(be||!l.hasIconData()||le),Qe=be&&(de||!l.hasTextData()||se);!l.collisionArrays&&H&&l.deserializeCollisionBoxes(H);const xt=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),jt=(rt,at,Nt)=>{var Oi,Gt;if(n[rt.crossTileID])return;if(Z)return void(this.placements[rt.crossTileID]=new Xt(!1,!1,!1));let ii=!1,Fi=!1,zr=!0,Mn=null,Bi={box:null,placeable:!1,offscreen:null},Yr={box:null,placeable:!1,offscreen:null},Vr=null,Dr=null,jr=null,Wn=0,To=0,Sl=0;at.textFeatureIndex?Wn=at.textFeatureIndex:rt.useRuntimeCollisionCircles&&(Wn=rt.featureIndex),at.verticalTextFeatureIndex&&(To=at.verticalTextFeatureIndex);const Io=at.textBox;if(Io){const bn=Pr=>{let Rr=c.ah.horizontal;if(l.allowVerticalPlacement&&!Pr&&this.prevPlacement){const hn=this.prevPlacement.placedOrientations[rt.crossTileID];hn&&(this.placedOrientations[rt.crossTileID]=hn,Rr=hn,this.markUsedOrientation(l,Rr,rt))}return Rr},wn=(Pr,Rr)=>{if(l.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&at.verticalTextBox){for(const hn of l.writingModes)if(hn===c.ah.vertical?(Bi=Rr(),Yr=Bi):Bi=Pr(),Bi&&Bi.placeable)break}else Bi=Pr()},us=rt.textAnchorOffsetStartIndex,zn=rt.textAnchorOffsetEndIndex;if(zn===us){const Pr=(Rr,hn)=>{const oi=this.collisionIndex.placeCollisionBox(Rr,J,B,S,A,He,ze,y,re.predicate,xt);return oi&&oi.placeable&&(this.markUsedOrientation(l,hn,rt),this.placedOrientations[rt.crossTileID]=hn),oi};wn(()=>Pr(Io,c.ah.horizontal),()=>{const Rr=at.verticalTextBox;return l.allowVerticalPlacement&&rt.numVerticalGlyphVertices>0&&Rr?Pr(Rr,c.ah.vertical):{box:null,offscreen:null}}),bn(Bi&&Bi.placeable)}else{let Pr=c.aq[(Gt=(Oi=this.prevPlacement)===null||Oi===void 0?void 0:Oi.variableOffsets[rt.crossTileID])===null||Gt===void 0?void 0:Gt.anchor];const Rr=(oi,js,Co)=>{const Ao=oi.x2-oi.x1,df=oi.y2-oi.y1,h_=rt.textBoxScale,pf=st&&me==="never"?js:null;let hs=null,ff=J==="never"?1:2,Tl="never";Pr&&ff++;for(let Pa=0;Pa<ff;Pa++){for(let Il=us;Il<zn;Il++){const Cl=l.textAnchorOffsets.get(Il);if(Pr&&Cl.textAnchor!==Pr)continue;const Eo=this.attemptAnchorPlacement(Cl,oi,Ao,df,h_,ze,He,B,S,A,re,Tl,rt,l,Co,y,b,pf,xt);if(Eo&&(hs=Eo.placedGlyphBoxes,hs&&hs.placeable))return ii=!0,Mn=Eo.shift,hs}Pr?Pr=null:Tl=J}return a&&!hs&&(hs={box:this.collisionIndex.placeCollisionBox(Io,"always",B,S,A,He,ze,y,re.predicate,xt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),hs};wn(()=>Rr(Io,at.iconBox,c.ah.horizontal),()=>{const oi=at.verticalTextBox;return l.allowVerticalPlacement&&(!Bi||!Bi.placeable)&&rt.numVerticalGlyphVertices>0&&oi?Rr(oi,at.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Bi&&(ii=Bi.placeable,zr=Bi.offscreen);const hn=bn(Bi&&Bi.placeable);if(!ii&&this.prevPlacement){const oi=this.prevPlacement.variableOffsets[rt.crossTileID];oi&&(this.variableOffsets[rt.crossTileID]=oi,this.markUsedJustification(l,oi.anchor,rt,hn))}}}if(Vr=Bi,ii=Vr&&Vr.placeable,zr=Vr&&Vr.offscreen,rt.useRuntimeCollisionCircles){const bn=l.text.placedSymbolArray.get(rt.centerJustifiedTextSymbolIndex),wn=c.ai(l.textSizeData,Q,bn),us=h.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(J,bn,l.lineVertexArray,l.glyphOffsetArray,wn,S,A,M,z,a,He,re.predicate,rt.collisionCircleDiameter,us,y,xt),Dr.circles.length&&Dr.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),ii=de||Dr.circles.length>0&&!Dr.collisionDetected,zr=zr&&Dr.offscreen}if(at.iconFeatureIndex&&(Sl=at.iconFeatureIndex),at.iconBox){const bn=wn=>this.collisionIndex.placeCollisionBox(wn,me,B,S,A,He,ze,b,re.predicate,xt,st&&Mn?Mn:void 0);Yr&&Yr.placeable&&at.verticalIconBox?(jr=bn(at.verticalIconBox),Fi=jr.placeable):(jr=bn(at.iconBox),Fi=jr.placeable),zr=zr&&jr.offscreen}const xn=se||rt.numHorizontalGlyphVertices===0&&rt.numVerticalGlyphVertices===0,Pl=le||rt.numIconVertices===0;xn||Pl?Pl?xn||(Fi=Fi&&ii):ii=Fi&&ii:Fi=ii=Fi&&ii;const Au=Fi&&jr.placeable;if(ii&&Vr.placeable&&this.collisionIndex.insertCollisionBox(Vr.box,J,h.get("text-ignore-placement"),l.bucketInstanceId,Yr&&Yr.placeable&&To?To:Wn,re.ID),Au&&this.collisionIndex.insertCollisionBox(jr.box,me,h.get("icon-ignore-placement"),l.bucketInstanceId,Sl,re.ID),Dr&&ii&&this.collisionIndex.insertCollisionCircles(Dr.circles,J,h.get("text-ignore-placement"),l.bucketInstanceId,Wn,re.ID),a&&this.storeCollisionData(l.bucketInstanceId,Nt,at,Vr,jr,Dr),rt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[rt.crossTileID]=new Xt(ii||et,Fi||Qe,zr||l.justReloaded),n[rt.crossTileID]=!0};if(ht){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const rt=l.getSortedSymbolIndexes(this.transform.angle);for(let at=rt.length-1;at>=0;--at){const Nt=rt[at];jt(l.symbolInstances.get(Nt),l.collisionArrays[Nt],Nt)}}else for(let rt=e.symbolInstanceStart;rt<e.symbolInstanceEnd;rt++)jt(l.symbolInstances.get(rt),l.collisionArrays[rt],rt);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const rt=this.collisionCircleArrays[l.bucketInstanceId];c.as(rt.invProjMatrix,S),rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(e,n,a,l,h,y){if(a.textBox||a.iconBox){let b,S;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(n)?S=b.get(n):(S={text:null,icon:null},b.set(n,S)),a.textBox&&(S.text=l.box),a.iconBox&&(S.icon=h.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=new bi);for(let S=0;S<y.circles.length;S+=4)b.circles.push(y.circles[S+0]),b.circles.push(y.circles[S+1]),b.circles.push(y.circles[S+2]),b.circles.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,a,l){let h;h=l===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=h>=0&&b!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const l=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},y=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],M=h[S];M?(this.opacities[S]=new Yi(M,l,A.text,A.icon),a=a||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[S]=new Yi(null,l,A.text,A.icon,A.skipFade),a=a||A.text||A.icon)}for(const S in h){const A=h[S];if(!this.opacities[S]){const M=new Yi(A,l,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||A.text.placed||A.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const l of n){const h=l.getBucket(e);h&&l.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,n,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],y=h.layout,b=new Yi(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),M=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",Z=y.get("icon-text-fit")!=="none",H=new Yi(null,0,S&&(A||!e.hasIconData()||y.get("icon-optional")),A&&(S||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const Q=(se,le,J)=>{for(let de=0;de<le/4;de++)se.opacityVertexArray.emplaceBack(J);se.hasVisibleVertices=se.hasVisibleVertices||J!==ro},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let se=0;se<e.symbolInstances.length;se++){const le=e.symbolInstances.get(se),{numHorizontalGlyphVertices:J,numVerticalGlyphVertices:de,crossTileID:me}=le;let be=this.opacities[me];a[me]?be=b:be||(be=H,this.opacities[me]=be),a[me]=!0;const ze=le.numIconVertices>0,He=this.placedOrientations[le.crossTileID],st=He===c.ah.vertical,ht=He===c.ah.horizontal||He===c.ah.horizontalOnly;if(J>0||de>0){const Qe=ln(be.text);Q(e.text,J,st?ro:Qe),Q(e.text,de,ht?ro:Qe);const xt=be.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(at=>{at>=0&&(e.text.placedSymbolArray.get(at).hidden=xt||st?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=xt||ht?1:0);const jt=this.variableOffsets[le.crossTileID];jt&&this.markUsedJustification(e,jt.anchor,le,He);const rt=this.placedOrientations[le.crossTileID];rt&&(this.markUsedJustification(e,"left",le,rt),this.markUsedOrientation(e,rt,le))}if(ze){const Qe=ln(be.icon),xt=!(Z&&le.verticalPlacedIconSymbolIndex&&st);le.placedIconSymbolIndex>=0&&(Q(e.icon,le.numIconVertices,xt?Qe:ro),e.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=be.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,le.numVerticalIconVertices,xt?ro:Qe),e.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}const et=re&&re.has(se)?re.get(se):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Qe=e.collisionArrays[se];if(Qe){let xt=new c.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let jt=!0;if(M){const rt=this.variableOffsets[me];rt?(xt=Sr(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale),z&&xt._rotate(B?this.transform.angle:-this.transform.angle)):jt=!1}if(Qe.textBox||Qe.verticalTextBox){let rt;Qe.textBox&&(rt=st),Qe.verticalTextBox&&(rt=ht),io(e.textCollisionBox.collisionVertexArray,be.text.placed,!jt||rt,et.text,xt.x,xt.y)}}if(Qe.iconBox||Qe.verticalIconBox){const jt=!!(!ht&&Qe.verticalIconBox);let rt;Qe.iconBox&&(rt=jt),Qe.verticalIconBox&&(rt=!jt),io(e.iconCollisionBox.collisionVertexArray,be.icon.placed,rt,et.icon,Z?xt.x:0,Z?xt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=se.invProjMatrix,e.placementViewportMatrix=se.viewportMatrix,e.collisionCircleArray=se.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function io(d,e,n,a,l,h){a&&a.length!==0||(a=[0,0,0,0]);const y=a[0]-Zt,b=a[1]-Zt,S=a[2]-Zt,A=a[3]-Zt;d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,b),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,b),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,A),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,A)}const wi=Math.pow(2,25),Nc=Math.pow(2,24),Vc=Math.pow(2,17),on=Math.pow(2,16),an=Math.pow(2,9),Ng=Math.pow(2,8),gn=Math.pow(2,1);function ln(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*wi+e*Nc+n*Vc+e*on+n*an+e*Ng+n*gn+e}const ro=0;function Es(){return{isOccluded:(d,e,n)=>!1,getPitchedTextCorrection:(d,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(d,e,n,a){throw new Error("Not implemented.")},translatePosition:(d,e,n,a)=>function(l,h,y,b,S=!1){if(!y[0]&&!y[1])return[0,0];const A=S?b==="map"?l.angle:0:b==="viewport"?-l.angle:0;if(A){const M=Math.sin(A),z=Math.cos(A);y=[y[0]*z-y[1]*M,y[0]*M+y[1]*z]}return[S?y[0]:ti(h,y[0],l.zoom),S?y[1]:ti(h,y[1],l.zoom)]}(d,e,n,a),getCircleRadiusCorrection:d=>1}}class fr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,l,h){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,S)=>b.sortKey-S.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class oa{constructor(e,n,a,l,h,y,b,S){this.placement=new Nr(e,Es(),n,y,b,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const l=j.now(),h=()=>!this._forceFullPlacement&&j.now()-l>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new fr(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const In=512/c.X/2;class lr{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let h=0;h<n.length;h++){const y=n.get(h),b=y.key,S=l.get(b);S?S.push(y):l.set(b,[y])}for(const[h,y]of l){const b={positions:y.map(S=>({x:Math.floor(S.anchorX*In),y:Math.floor(S.anchorY*In)})),crossTileIDs:y.map(S=>S.crossTileID)};if(b.positions.length>128){const S=new c.av(b.positions.length,16,Uint16Array);for(const{x:A,y:M}of b.positions)S.add(A,M);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[h]=b}}getScaledCoordinates(e,n){const{x:a,y:l,z:h}=this.tileID.canonical,{x:y,y:b,z:S}=n.canonical,A=In/Math.pow(2,S-h),M=(b*c.X+e.anchorY)*A,z=l*c.X*In;return{x:Math.floor((y*c.X+e.anchorX)*A-a*c.X*In),y:Math.floor(M-z)}}findMatches(e,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const y=e.get(h);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const S=this.getScaledCoordinates(y,n);if(b.index){const A=b.index.range(S.x-l,S.y-l,S.x+l,S.y+l).sort();for(const M of A){const z=b.crossTileIDs[M];if(!a[z]){a[z]=!0,y.crossTileID=z;break}}}else if(b.positions)for(let A=0;A<b.positions.length;A++){const M=b.positions[A],z=b.crossTileIDs[A];if(Math.abs(M.x-S.x)<=l&&Math.abs(M.y-S.y)<=l&&!a[z]){a[z]=!0,y.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Wa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Cn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],h={};for(const y in l){const b=l[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),h[b.tileID.key]=b}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const y=this.indexes[h];if(Number(h)>e.overscaledZ)for(const b in y){const S=y[b];S.tileID.isChildOf(e)&&S.findMatches(n.symbolInstances,e,l)}else{const b=y[e.scaledTo(Number(h)).key];b&&b.findMatches(n.symbolInstances,e,l)}}for(let h=0;h<n.symbolInstances.length;h++){const y=n.symbolInstances.get(h);y.crossTileID||(y.crossTileID=a.generate(),l[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new lr(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const h in l)e[l[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[h]),delete l[h],n=!0)}return n}}class jc{constructor(){this.layerIndexes={},this.crossTileIDs=new Wa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new Cn);let h=!1;const y={};l.handleWrapJump(a);for(const b of n){const S=b.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(b.tileID,S,this.crossTileIDs)&&(h=!0),y[S.bucketInstanceId]=!0)}return l.removeStaleBuckets(y)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const An=(d,e)=>c.t(d,e&&e.filter(n=>n.identifier!=="source.canvas")),Vg=c.aw();class Ha extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new qi(Ui(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new Fe,this.imageManager.setEventedParent(this),this.glyphManager=new pt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new fi(256,512),this.crossTileSymbolIndex=new jc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),kr().on(Ve,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const h=l.getSource();if(h&&h.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===h.id&&this._validateLayer(b)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;c.h(l,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,a)}).catch(y=>{this._loadStyleRequest=null,y&&!h.signal.aborted&&this.fire(new c.j(y))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Vg,{validate:!1})}_load(e,n,a){var l;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!An(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(const y in h.sources)this.addSource(y,h.sources[y],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new ut(this.stylesheet.light),this.sky=new qt(this.stylesheet.sky),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,y,b,S){return c._(this,void 0,void 0,function*(){const A=Je(h),M=b>1?"@2x":"",z={},B={};for(const{id:Z,url:H}of A){const Q=y.transformRequest(St(H,M,".json"),"SpriteJSON");z[Z]=c.h(Q,S);const re=y.transformRequest(St(H,M,".png"),"SpriteImage");B[Z]=ke.getImage(re,S)}return yield Promise.all([...Object.values(z),...Object.values(B)]),function(Z,H){return c._(this,void 0,void 0,function*(){const Q={};for(const re in Z){Q[re]={};const se=j.getImageCanvasContext((yield H[re]).data),le=(yield Z[re]).data;for(const J in le){const{width:de,height:me,x:be,y:ze,sdf:He,pixelRatio:st,stretchX:ht,stretchY:et,content:Qe,textFitWidth:xt,textFitHeight:jt}=le[J];Q[re][J]={data:null,pixelRatio:st,sdf:He,stretchX:ht,stretchY:et,content:Qe,textFitWidth:xt,textFitHeight:jt,spriteData:{width:de,height:me,x:be,y:ze,context:se}}}}return Q})}(z,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const y in h){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(S=>!(S in h)):[];for(const S of b)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in h[y]){const A=y==="default"?S:`${y}:${S}`;this._spritesImagesIds[y].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,h[y][S],!1):this.imageManager.addImage(A,h[y][S]),n&&(this._changedImages[A]=!0)}}}).catch(h=>{this._spriteRequest=null,l=h,this.fire(new c.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const l=[];for(const h of e)if(a[h]){const y=n?c.aB(a[h]):a[h];l.push(y)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const l=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(l.length||h.length)&&this._updateWorkerLayers(l,h);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const h=this.sourceCaches[l];a[l]=h.used,h.used=!1}for(const l of this._order){const h=this._layers[l];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const l in a){const h=this.sourceCaches[l];!!a[l]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const l=this.serialize();if(e=n.transformStyle?n.transformStyle(l,e):e,((a=n.validate)===null||a===void 0||a)&&An(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const h=c.aC(l,e),y=this._getOperationsToPerform(h);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setSky":n.push(()=>this.setSky.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[e]=new Mt(e,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new c.j(new Error(`Layer "${l}" already exists on this map.`)));let h;if(e.type==="custom"){if(An(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=c.aB(e),e=c.e(e,{source:l})),this._validate(c.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:l}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,l),this._layerOrderChanged=!0,this._layers[l]=h,this._removedLayers[l]&&h.source&&h.type!=="custom"){const b=this._removedLayers[l];delete this._removedLayers[l],b.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!c.aE(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(c.u.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=c.aB(n),this._updateLayer(l)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,l),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,l)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,l=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const y=h.getSource().type;y==="geojson"&&l?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||l?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(l,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=l.getSource().type,y=h==="vector"?e.sourceLayer:void 0;h!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(y,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return c.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",a={},l=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b)){a[b]=y;for(const S of e){const A=S[b];if(A)for(const M of A)l.push(M)}}}l.sort((y,b)=>b.intersectionZ-y.intersectionZ);const h=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b))for(let S=l.length-1;S>=0;S--){const A=l[S].feature;if(a[A.layer.id]<y)break;h.push(A),l.pop()}else for(const S of e){const A=S[b];if(A)for(const M of A)h.push(M.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const b of n.layers){const S=this._layers[b];if(!S)return this.fire(new c.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];l[S.source]=!0}}const h=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers();for(const b in this.sourceCaches)n.layers&&!l[b]||h.push(Ei(this.sourceCaches[b],this._layers,y,e,n,a));return this.placement&&h.push(function(b,S,A,M,z,B,Z){const H={},Q=B.queryRenderedSymbols(M),re=[];for(const se of Object.keys(Q).map(Number))re.push(Z[se]);re.sort(mt);for(const se of re){const le=se.featureIndex.lookupSymbolFeatures(Q[se.bucketInstanceId],S,se.bucketIndex,se.sourceLayerIndex,z.filter,z.layers,z.availableImages,b);for(const J in le){const de=H[J]=H[J]||[],me=le[J];me.sort((be,ze)=>{const He=se.featureSortOrder;if(He){const st=He.indexOf(be.featureIndex);return He.indexOf(ze.featureIndex)-st}return ze.featureIndex-be.featureIndex});for(const be of me)de.push(be)}}for(const se in H)H[se].forEach(le=>{const J=le.feature,de=A[b[se].source].getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=de});return H}(this._layers,y,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(l,h){const y=l.getRenderableIds().map(A=>l.getTileByID(A)),b=[],S={};for(let A=0;A<y.length;A++){const M=y[A],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(b,h))}return b}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:j.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:j.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,l,h={}){return(!h||h.validate!==!1)&&An(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),kr().off(Ve,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,l,h=!1){let y=!1,b=!1;const S={};for(const A of this._order){const M=this._layers[A];if(M.type!=="symbol")continue;if(!S[M.source]){const B=this.sourceCaches[M.source];S[M.source]=B.getRenderableIds(!0).map(Z=>B.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(j.now(),e.zoom))&&(this.pauseablePlacement=new oa(e,this.map.terrain,this._order,h,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(j.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const A of this._order){const M=this._layers[A];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(j.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},l){this._checkLoaded();const h=[{id:e,url:n}],y=[...Je(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",y,null,a)||(this.stylesheet.sprite=y,this._loadSprite(h,!0,l))}removeSprite(e){this._checkLoaded();const n=Je(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Je(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var ks=c.Y([{name:"a_pos",type:"Int16",components:2}]);const ls={prelude:pi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:pi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:pi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:pi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:pi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:pi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:pi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:pi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:pi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:pi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:pi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:pi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:pi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:pi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:pi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:pi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:pi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function pi(d,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),l=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=h?h.concat(l):l,b={};return{fragmentSource:d=d.replace(n,(S,A,M,z,B)=>(b[B]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(n,(S,A,M,z,B)=>{const Z=z==="float"?"vec2":"vec4",H=B.match(/color/)?"color":Z;return b[B]?A==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${Z} a_${B};
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${Z} a_${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Uc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,l,h,y,b,S,A){this.context=e;let M=this.boundPaintVertexBuffers.length!==l.length;for(let z=0;!M&&z<l.length;z++)this.boundPaintVertexBuffers[z]!==l[z]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==h||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(n,a,l,h,y,b,S,A):(e.bindVertexArray.set(this.vao),b&&b.bind(),h&&h.dynamicDraw&&h.bind(),S&&S.bind(),A&&A.bind())}freshBind(e,n,a,l,h,y,b,S){const A=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,n.enableAttributes(z,e);for(const B of a)B.enableAttributes(z,e);y&&y.enableAttributes(z,e),b&&b.enableAttributes(z,e),S&&S.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,h);for(const B of a)B.bind(),B.setVertexAttribPointers(z,e,h);y&&(y.bind(),y.setVertexAttribPointers(z,e,h)),l&&l.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,e,h)),S&&(S.bind(),S.setVertexAttribPointers(z,e,h)),M.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const qc=(d,e,n,a,l)=>({u_matrix:d,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function no(d){const e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const a=d[n].split(" ");e.push(a.pop())}return e}class Zc{constructor(e,n,a,l,h,y){const b=e.gl;this.program=b.createProgram();const S=no(n.staticAttributes),A=a?a.getBinderAttributes():[],M=S.concat(A),z=ls.prelude.staticUniforms?no(ls.prelude.staticUniforms):[],B=n.staticUniforms?no(n.staticUniforms):[],Z=a?a.getBinderUniforms():[],H=z.concat(B).concat(Z),Q=[];for(const be of H)Q.indexOf(be)<0&&Q.push(be);const re=a?a.defines():[];h&&re.push("#define OVERDRAW_INSPECTOR;"),y&&re.push("#define TERRAIN3D;");const se=re.concat(ls.prelude.fragmentSource,n.fragmentSource).join(`
`),le=re.concat(ls.prelude.vertexSource,n.vertexSource).join(`
`),J=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(J,se),b.compileShader(J),!b.getShaderParameter(J,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(J)}`);b.attachShader(this.program,J);const de=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(de,le),b.compileShader(de),!b.getShaderParameter(de,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(de)}`);b.attachShader(this.program,de),this.attributes={};const me={};this.numAttributes=M.length;for(let be=0;be<this.numAttributes;be++)M[be]&&(b.bindAttribLocation(this.program,be,M[be]),this.attributes[M[be]]=be);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(de),b.deleteShader(J);for(let be=0;be<Q.length;be++){const ze=Q[be];if(ze&&!me[ze]){const He=b.getUniformLocation(this.program,ze);He&&(me[ze]=He)}}this.fixedUniforms=l(e,me),this.terrainUniforms=((be,ze)=>({u_depth:new c.aH(be,ze.u_depth),u_terrain:new c.aH(be,ze.u_terrain),u_terrain_dim:new c.aI(be,ze.u_terrain_dim),u_terrain_matrix:new c.aJ(be,ze.u_terrain_matrix),u_terrain_unpack:new c.aK(be,ze.u_terrain_unpack),u_terrain_exaggeration:new c.aI(be,ze.u_terrain_exaggeration)}))(e,me),this.binderUniforms=a?a.getUniforms(e,me):[]}draw(e,n,a,l,h,y,b,S,A,M,z,B,Z,H,Q,re,se,le){const J=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(h),e.setCullFace(y),S){e.activeTexture.set(J.TEXTURE2),J.bindTexture(J.TEXTURE_2D,S.depthTexture),e.activeTexture.set(J.TEXTURE3),J.bindTexture(J.TEXTURE_2D,S.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(S[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(b[me]);Q&&Q.setUniforms(e,this.binderUniforms,Z,{zoom:H});let de=0;switch(n){case J.LINES:de=2;break;case J.TRIANGLES:de=3;break;case J.LINE_STRIP:de=1}for(const me of B.get()){const be=me.vaos||(me.vaos={});(be[A]||(be[A]=new Uc)).bind(e,this,M,Q?Q.getPaintVertexBuffers():[],z,me.vertexOffset,re,se,le),J.drawElements(n,me.primitiveLength*de,J.UNSIGNED_SHORT,me.primitiveOffset*de*2)}}}function Xa(d,e,n){const a=1/ti(n,1,e.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/l,y=h*(n.tileID.canonical.x+n.tileID.wrap*l),b=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const aa=(d,e,n,a)=>{const l=e.style.light,h=l.properties.get("position"),y=[h.x,h.y,h.z],b=function(){var A=new c.A(9);return c.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();l.properties.get("anchor")==="viewport"&&function(A,M){var z=Math.sin(M),B=Math.cos(M);A[0]=B,A[1]=z,A[2]=0,A[3]=-z,A[4]=B,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(b,-e.transform.angle),function(A,M,z){var B=M[0],Z=M[1],H=M[2];A[0]=B*z[0]+Z*z[3]+H*z[6],A[1]=B*z[1]+Z*z[4]+H*z[7],A[2]=B*z[2]+Z*z[5]+H*z[8]}(y,y,b);const S=l.properties.get("color");return{u_matrix:d,u_lightpos:y,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:a}},Ka=(d,e,n,a,l,h,y)=>c.e(aa(d,e,n,a),Xa(h,e,y),{u_height_factor:-Math.pow(2,l.overscaledZ)/y.tileSize/8}),so=d=>({u_matrix:d}),zp=(d,e,n,a)=>c.e(so(d),Xa(n,e,a)),jg=(d,e)=>({u_matrix:d,u_world:e}),Dp=(d,e,n,a,l)=>c.e(zp(d,e,n,a),{u_world:l}),Ug=(d,e,n,a)=>{const l=d.transform;let h,y;if(a.paint.get("circle-pitch-alignment")==="map"){const b=ti(n,1,l.zoom);h=!0,y=[b,b]}else h=!1,y=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:y}},Ms=(d,e,n)=>({u_matrix:d,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),la=(d,e,n=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:n}),Kr=d=>({u_matrix:d}),Jr=(d,e,n,a)=>({u_matrix:d,u_extrude_scale:ti(e,1,n),u_intensity:a}),Ja=(d,e,n,a)=>{const l=c.H();c.aP(l,0,d.width,d.height,0,0,1);const h=d.context.gl;return{u_matrix:l,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function Ya(d,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const $a=(d,e,n,a)=>{const l=d.transform;return{u_matrix:Op(d,e,n,a),u_ratio:1/ti(e,1,l.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Rp=(d,e,n,a,l)=>c.e($a(d,e,n,l),{u_image:0,u_image_height:a}),oo=(d,e,n,a,l)=>{const h=d.transform,y=Lp(e,h);return{u_matrix:Op(d,e,n,l),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ti(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},qg=(d,e,n,a,l,h)=>{const y=d.lineAtlas,b=Lp(e,d.transform),S=n.layout.get("line-cap")==="round",A=y.getDash(a.from,S),M=y.getDash(a.to,S),z=A.width*l.fromScale,B=M.width*l.toScale;return c.e($a(d,e,n,h),{u_patternscale_a:[b/z,-A.height/2],u_patternscale_b:[b/B,-M.height/2],u_sdfgamma:y.width/(256*Math.min(z,B)*d.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:M.y,u_mix:l.t})};function Lp(d,e){return 1/ti(d,1,e.tileZoom)}function Op(d,e,n,a){return d.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Zg=(d,e,n,a,l)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(h=l.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:Gg(l.paint.get("raster-hue-rotate"))};var h,y};function Gg(d){d*=Math.PI/180;const e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Fp=(d,e,n,a,l,h,y,b,S,A,M,z,B,Z)=>{const H=y.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:h,u_texsize:B,u_texture:0,u_translation:M,u_pitched_scale:Z}},ca=(d,e,n,a,l,h,y,b,S,A,M,z,B,Z,H)=>{const Q=y.transform;return c.e(Fp(d,e,n,a,l,h,y,b,S,A,M,z,B,H),{u_gamma_scale:a?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+Z})},Gc=(d,e,n,a,l,h,y,b,S,A,M,z,B,Z)=>c.e(ca(d,e,n,a,l,h,y,b,S,A,M,!0,z,!0,Z),{u_texsize_icon:B,u_texture_icon:1}),Qa=(d,e,n)=>({u_matrix:d,u_opacity:e,u_color:n}),Wc=(d,e,n,a,l,h)=>c.e(function(y,b,S,A){const M=S.imageManager.getPattern(y.from.toString()),z=S.imageManager.getPattern(y.to.toString()),{width:B,height:Z}=S.imageManager.getPixelSize(),H=Math.pow(2,A.tileID.overscaledZ),Q=A.tileSize*Math.pow(2,S.transform.tileZoom)/H,re=Q*(A.tileID.canonical.x+A.tileID.wrap*H),se=Q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,Z],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/ti(A,1,S.transform.tileZoom),u_pixel_coord_upper:[re>>16,se>>16],u_pixel_coord_lower:[65535&re,65535&se]}}(a,h,n,l),{u_matrix:d,u_opacity:e}),Hc={fillExtrusion:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_opacity:new c.aI(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_height_factor:new c.aI(d,e.u_height_factor),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade),u_opacity:new c.aI(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(d,e.u_scale_with_map),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_extrude_scale:new c.aO(d,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_matrix:new c.aJ(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_pixel_extrude_scale:new c.aO(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_inv_matrix:new c.aJ(d,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_viewport_size:new c.aO(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.aL(d,e.u_color),u_matrix:new c.aJ(d,e.u_matrix),u_overlay:new c.aH(d,e.u_overlay),u_overlay_scale:new c.aI(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new c.aI(d,e.u_extrude_scale),u_intensity:new c.aI(d,e.u_intensity),u_matrix:new c.aJ(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_color_ramp:new c.aH(d,e.u_color_ramp),u_opacity:new c.aI(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_latrange:new c.aO(d,e.u_latrange),u_light:new c.aO(d,e.u_light),u_shadow:new c.aL(d,e.u_shadow),u_highlight:new c.aL(d,e.u_highlight),u_accent:new c.aL(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_dimension:new c.aO(d,e.u_dimension),u_zoom:new c.aI(d,e.u_zoom),u_unpack:new c.aK(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_image:new c.aH(d,e.u_image),u_image_height:new c.aI(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texsize:new c.aO(d,e.u_texsize),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_image:new c.aH(d,e.u_image),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_patternscale_a:new c.aO(d,e.u_patternscale_a),u_patternscale_b:new c.aO(d,e.u_patternscale_b),u_sdfgamma:new c.aI(d,e.u_sdfgamma),u_image:new c.aH(d,e.u_image),u_tex_y_a:new c.aI(d,e.u_tex_y_a),u_tex_y_b:new c.aI(d,e.u_tex_y_b),u_mix:new c.aI(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_tl_parent:new c.aO(d,e.u_tl_parent),u_scale_parent:new c.aI(d,e.u_scale_parent),u_buffer_scale:new c.aI(d,e.u_buffer_scale),u_fade_t:new c.aI(d,e.u_fade_t),u_opacity:new c.aI(d,e.u_opacity),u_image0:new c.aH(d,e.u_image0),u_image1:new c.aH(d,e.u_image1),u_brightness_low:new c.aI(d,e.u_brightness_low),u_brightness_high:new c.aI(d,e.u_brightness_high),u_saturation_factor:new c.aI(d,e.u_saturation_factor),u_contrast_factor:new c.aI(d,e.u_contrast_factor),u_spin_weights:new c.aN(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texsize_icon:new c.aO(d,e.u_texsize_icon),u_texture:new c.aH(d,e.u_texture),u_texture_icon:new c.aH(d,e.u_texture_icon),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),background:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_color:new c.aL(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_image:new c.aH(d,e.u_image),u_pattern_tl_a:new c.aO(d,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(d,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(d,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(d,e.u_pattern_br_b),u_texsize:new c.aO(d,e.u_texsize),u_mix:new c.aI(d,e.u_mix),u_pattern_size_a:new c.aO(d,e.u_pattern_size_a),u_pattern_size_b:new c.aO(d,e.u_pattern_size_b),u_scale_a:new c.aI(d,e.u_scale_a),u_scale_b:new c.aI(d,e.u_scale_b),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_ele_delta:new c.aI(d,e.u_ele_delta),u_fog_matrix:new c.aJ(d,e.u_fog_matrix),u_fog_color:new c.aL(d,e.u_fog_color),u_fog_ground_blend:new c.aI(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon_fog_blend:new c.aI(d,e.u_horizon_fog_blend)}),terrainDepth:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ele_delta:new c.aI(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_terrain_coords_id:new c.aI(d,e.u_terrain_coords_id),u_ele_delta:new c.aI(d,e.u_ele_delta)}),sky:(d,e)=>({u_sky_color:new c.aL(d,e.u_sky_color),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon:new c.aI(d,e.u_horizon),u_sky_horizon_blend:new c.aI(d,e.u_sky_horizon_blend)})};class qn{constructor(e,n,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xc{constructor(e,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,n,a){for(let l=0;l<this.attributes.length;l++){const h=this.attributes[l],y=n.attributes[h.name];y!==void 0&&e.vertexAttribPointer(y,h.components,e[Wg[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs=new WeakMap;function cs(d){var e;if(zs.has(d))return zs.get(d);{const n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return zs.set(d,n),n}}class mi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class el extends mi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Hg extends mi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ao extends mi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Xg extends mi{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Bp extends mi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Kg extends mi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Np extends mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Kc extends mi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Vp extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class jp extends mi{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Up extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class qp extends mi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ds extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Zp extends mi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Jg extends mi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Gp extends mi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ua extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Yg extends mi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class tl extends mi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class $g extends mi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Qg extends mi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Wp extends mi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Hp extends mi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Xp extends mi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Jc extends mi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Kp extends mi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class il extends mi{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $n extends mi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;cs(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Yc extends mi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class $c extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Qc extends mi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class rl extends mi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class eu extends rl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Rs extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class tu extends rl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class e_{constructor(e,n,a,l,h){this.context=e,this.width=n,this.height=a;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new eu(e,b),l)this.depthAttachment=h?new tu(e,b):new Rs(e,b);else if(h)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class rr{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}rr.Replace=[1,0],rr.disabled=new rr(rr.Replace,c.aM.transparent,[!1,!1,!1,!1]),rr.unblended=new rr(rr.Replace,c.aM.transparent,[!0,!0,!0,!0]),rr.alphaBlended=new rr([1,771],c.aM.transparent,[!0,!0,!0,!0]);class t_{constructor(e){var n,a;if(this.gl=e,this.clearColor=new el(this),this.clearDepth=new Hg(this),this.clearStencil=new ao(this),this.colorMask=new Xg(this),this.depthMask=new Bp(this),this.stencilMask=new Kg(this),this.stencilFunc=new Np(this),this.stencilOp=new Kc(this),this.stencilTest=new Vp(this),this.depthRange=new jp(this),this.depthTest=new Up(this),this.depthFunc=new qp(this),this.blend=new Ds(this),this.blendFunc=new Zp(this),this.blendColor=new Jg(this),this.blendEquation=new Gp(this),this.cullFace=new ua(this),this.cullFaceSide=new Yg(this),this.frontFace=new tl(this),this.program=new $g(this),this.activeTexture=new Qg(this),this.viewport=new Wp(this),this.bindFramebuffer=new Hp(this),this.bindRenderbuffer=new Xp(this),this.bindTexture=new Jc(this),this.bindVertexBuffer=new Kp(this),this.bindElementBuffer=new il(this),this.bindVertexArray=new $n(this),this.pixelStoreUnpack=new Yc(this),this.pixelStoreUnpackPremultiplyAlpha=new $c(this),this.pixelStoreUnpackFlipY=new Qc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),cs(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new qn(this,e,n)}createVertexBuffer(e,n,a){return new Xc(this,e,n,a)}createRenderbuffer(e,n,a){const l=this.gl,h=l.createRenderbuffer();return this.bindRenderbuffer.set(h),l.renderbufferStorage(l.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,l){return new e_(this,e,n,a,l)}clear({color:e,depth:n,stencil:a}){const l=this.gl;let h=0;e&&(h|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,rr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return cs(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return cs(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Yt{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Yt.ReadOnly=!1,Yt.ReadWrite=!0,Yt.disabled=new Yt(519,Yt.ReadOnly,[0,1]);const nl=7680;class Mi{constructor(e,n,a,l,h,y){this.test=e,this.ref=n,this.mask=a,this.fail=l,this.depthFail=h,this.pass=y}}Mi.disabled=new Mi({func:519,mask:0},0,0,nl,nl,nl);class Ti{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let Ls;function ha(d,e,n,a,l){const h=d.context,y=h.gl,b=d.useProgram("collisionBox"),S=[];let A=0,M=0;for(let se=0;se<a.length;se++){const le=a[se],J=e.getTile(le).getBucket(n);if(!J)continue;const de=l?J.textCollisionBox:J.iconCollisionBox,me=J.collisionCircleArray;if(me.length>0){const be=c.H();c.aQ(be,J.placementInvProjMatrix,d.transform.glCoordMatrix),c.aQ(be,be,J.placementViewportMatrix),S.push({circleArray:me,circleOffset:M,transform:le.posMatrix,invTransform:be,coord:le}),A+=me.length/4,M=A}de&&b.draw(h,y.LINES,Yt.disabled,Mi.disabled,d.colorModeForRenderPass(),Ti.disabled,{u_matrix:le.posMatrix,u_pixel_extrude_scale:[1/(z=d.transform).width,1/z.height]},d.style.map.terrain&&d.style.map.terrain.getTerrainData(le),n.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,d.transform.zoom,null,null,de.collisionVertexBuffer)}var z;if(!l||!S.length)return;const B=d.useProgram("collisionCircle"),Z=new c.aR;Z.resize(4*A),Z._trim();let H=0;for(const se of S)for(let le=0;le<se.circleArray.length/4;le++){const J=4*le,de=se.circleArray[J+0],me=se.circleArray[J+1],be=se.circleArray[J+2],ze=se.circleArray[J+3];Z.emplace(H++,de,me,be,ze,0),Z.emplace(H++,de,me,be,ze,1),Z.emplace(H++,de,me,be,ze,2),Z.emplace(H++,de,me,be,ze,3)}(!Ls||Ls.length<2*A)&&(Ls=function(se){const le=2*se,J=new c.aT;J.resize(le),J._trim();for(let de=0;de<le;de++){const me=6*de;J.uint16[me+0]=4*de+0,J.uint16[me+1]=4*de+1,J.uint16[me+2]=4*de+2,J.uint16[me+3]=4*de+2,J.uint16[me+4]=4*de+3,J.uint16[me+5]=4*de+0}return J}(A));const Q=h.createIndexBuffer(Ls,!0),re=h.createVertexBuffer(Z,c.aS.members,!0);for(const se of S){const le=Ms(se.transform,se.invTransform,d.transform);B.draw(h,y.TRIANGLES,Yt.disabled,Mi.disabled,d.colorModeForRenderPass(),Ti.disabled,le,d.style.map.terrain&&d.style.map.terrain.getTerrainData(se.coord),n.id,re,Q,c.a0.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,d.transform.zoom,null,null,null)}re.destroy(),Q.destroy()}Ti.disabled=new Ti(!1,1029,2305),Ti.backCCW=new Ti(!0,1029,2305);const da=c.an(new Float32Array(16));function iu(d,e,n,a,l,h){const{horizontalAlign:y,verticalAlign:b}=c.au(d);return new c.P((-(y-.5)*e/l+a[0])*h,(-(b-.5)*n/l+a[1])*h)}function Os(d,e,n,a,l,h){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=a.mult(h);n||(b=b.rotate(-l));const S=y.add(b);return te(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const b=Ae(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return d.add(a.rotate(S))}return d.add(a)}function lo(d,e,n,a,l,h,y,b,S,A,M,z,B,Z){const H=d.text.placedSymbolArray,Q=d.text.dynamicLayoutVertexArray,re=d.icon.dynamicLayoutVertexArray,se={};Q.clear();for(let le=0;le<H.length;le++){const J=H.get(le),de=J.hidden||!J.crossTileID||d.allowVerticalPlacement&&!J.placedOrientation?null:a[J.crossTileID];if(de){const me=new c.P(J.anchorX,J.anchorY),be={getElevation:Z,width:l.width,height:l.height,labelPlaneMatrix:h,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:me,translation:z,unwrappedTileID:B},ze=n?te(me.x,me.y,y,Z):Ae(me.x,me.y,be),He=O(l.cameraToCenterDistance,ze.signedDistanceFromCamera);let st=c.ai(d.textSizeData,S,J)*He/c.ap;n&&(st*=d.tilePixelRatio/b);const{width:ht,height:et,anchor:Qe,textOffset:xt,textBoxScale:jt}=de,rt=iu(Qe,ht,et,xt,jt,st),at=M.getPitchedTextCorrection(l,me.add(new c.P(z[0],z[1])),B),Nt=Os(ze.point,be,e,rt,l.angle,at),Oi=d.allowVerticalPlacement&&J.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Gt=0;Gt<J.numGlyphs;Gt++)c.aj(Q,Nt,Oi);A&&J.associatedIconIndex>=0&&(se[J.associatedIconIndex]={shiftedAnchor:Nt,angle:Oi})}else zt(J.numGlyphs,Q)}if(A){re.clear();const le=d.icon.placedSymbolArray;for(let J=0;J<le.length;J++){const de=le.get(J);if(de.hidden)zt(de.numGlyphs,re);else{const me=se[J];if(me)for(let be=0;be<de.numGlyphs;be++)c.aj(re,me.shiftedAnchor,me.angle);else zt(de.numGlyphs,re)}}d.icon.dynamicLayoutVertexBuffer.updateData(re)}d.text.dynamicLayoutVertexBuffer.updateData(Q)}function _n(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function ru(d,e,n,a,l,h,y,b,S,A,M,z){const B=d.context,Z=B.gl,H=d.transform,Q=Es(),re=b==="map",se=S==="map",le=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",J=re&&!se&&!le,de=!se&&le,me=!n.layout.get("symbol-sort-key").isConstant();let be=!1;const ze=d.depthModeForSublayer(0,Yt.ReadOnly),He=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),st=[],ht=Q.getCircleRadiusCorrection(H);for(const et of a){const Qe=e.getTile(et),xt=Qe.getBucket(n);if(!xt)continue;const jt=l?xt.text:xt.icon;if(!jt||!jt.segments.get().length||!jt.hasVisibleVertices)continue;const rt=jt.programConfigurations.get(n.id),at=l||xt.sdfIcons,Nt=l?xt.textSizeData:xt.iconSizeData,Oi=se||H.pitch!==0,Gt=d.useProgram(_n(at,l,xt),rt),ii=c.ag(Nt,H.zoom),Fi=d.style.map.terrain&&d.style.map.terrain.getTerrainData(et);let zr,Mn,Bi,Yr,Vr=[0,0],Dr=null;if(l)Mn=Qe.glyphAtlasTexture,Bi=Z.LINEAR,zr=Qe.glyphAtlasTexture.size,xt.iconsInText&&(Vr=Qe.imageAtlasTexture.size,Dr=Qe.imageAtlasTexture,Yr=Oi||d.options.rotating||d.options.zooming||Nt.kind==="composite"||Nt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const oi=n.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Mn=Qe.imageAtlasTexture,Bi=at||d.options.rotating||d.options.zooming||oi||Oi?Z.LINEAR:Z.NEAREST,zr=Qe.imageAtlasTexture.size}const jr=ti(Qe,1,d.transform.zoom),Wn=de?et.posMatrix:da,To=as(Wn,se,re,d.transform,jr),Sl=Un(Wn,se,re,d.transform,jr),Io=Un(et.posMatrix,se,re,d.transform,jr),xn=Q.translatePosition(d.transform,Qe,h,y),Pl=He&&xt.hasTextData(),Au=n.layout.get("icon-text-fit")!=="none"&&Pl&&xt.hasIconData();if(le){const oi=d.style.map.terrain?(Co,Ao)=>d.style.map.terrain.getElevation(et,Co,Ao):null,js=n.layout.get("text-rotation-alignment")==="map";G(xt,et.posMatrix,d,l,To,Io,se,A,js,Q,et.toUnwrapped(),H.width,H.height,xn,oi)}const bn=et.posMatrix,wn=l&&He||Au,us=le||wn?da:To,zn=Sl,Pr=at&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Rr;Rr=at?xt.iconsInText?Gc(Nt.kind,ii,J,se,le,wn,d,bn,us,zn,xn,zr,Vr,ht):ca(Nt.kind,ii,J,se,le,wn,d,bn,us,zn,xn,l,zr,!0,ht):Fp(Nt.kind,ii,J,se,le,wn,d,bn,us,zn,xn,l,zr,ht);const hn={program:Gt,buffers:jt,uniformValues:Rr,atlasTexture:Mn,atlasTextureIcon:Dr,atlasInterpolation:Bi,atlasInterpolationIcon:Yr,isSDF:at,hasHalo:Pr};if(me&&xt.canOverlap){be=!0;const oi=jt.segments.get();for(const js of oi)st.push({segments:new c.a0([js]),sortKey:js.sortKey,state:hn,terrainData:Fi})}else st.push({segments:jt.segments,sortKey:0,state:hn,terrainData:Fi})}be&&st.sort((et,Qe)=>et.sortKey-Qe.sortKey);for(const et of st){const Qe=et.state;if(B.activeTexture.set(Z.TEXTURE0),Qe.atlasTexture.bind(Qe.atlasInterpolation,Z.CLAMP_TO_EDGE),Qe.atlasTextureIcon&&(B.activeTexture.set(Z.TEXTURE1),Qe.atlasTextureIcon&&Qe.atlasTextureIcon.bind(Qe.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Qe.isSDF){const xt=Qe.uniformValues;Qe.hasHalo&&(xt.u_is_halo=1,nu(Qe.buffers,et.segments,n,d,Qe.program,ze,M,z,xt,et.terrainData)),xt.u_is_halo=0}nu(Qe.buffers,et.segments,n,d,Qe.program,ze,M,z,Qe.uniformValues,et.terrainData)}}function nu(d,e,n,a,l,h,y,b,S,A){const M=a.context;l.draw(M,M.gl.TRIANGLES,h,y,b,Ti.disabled,S,A,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,a.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function su(d,e,n,a){const l=d.context,h=l.gl,y=Mi.disabled,b=new rr([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(n);if(!S)return;const A=a.key;let M=n.heatmapFbos.get(A);M||(M=pa(l,e.tileSize,e.tileSize),n.heatmapFbos.set(A,M)),l.bindFramebuffer.set(M.framebuffer),l.viewport.set([0,0,e.tileSize,e.tileSize]),l.clear({color:c.aM.transparent});const z=S.programConfigurations.get(n.id),B=d.useProgram("heatmap",z),Z=d.style.map.terrain.getTerrainData(a);B.draw(l,h.TRIANGLES,Yt.disabled,y,b,Ti.disabled,Jr(a.posMatrix,e,d.transform.zoom,n.paint.get("heatmap-intensity")),Z,n.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,n.paint,d.transform.zoom,z)}function Fs(d,e,n){const a=d.context,l=a.gl;a.setColorMode(d.colorModeForRenderPass());const h=fa(a,e),y=n.key,b=e.heatmapFbos.get(y);b&&(a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,b.colorAttachment.get()),a.activeTexture.set(l.TEXTURE1),h.bind(l.LINEAR,l.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(a,l.TRIANGLES,Yt.disabled,Mi.disabled,d.colorModeForRenderPass(),Ti.disabled,Ja(d,e,0,1),null,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,d.transform.zoom),b.destroy(),e.heatmapFbos.delete(y))}function pa(d,e,n){var a,l;const h=d.gl,y=h.createTexture();h.bindTexture(h.TEXTURE_2D,y),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const b=(a=d.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,S=(l=d.RGBA16F)!==null&&l!==void 0?l:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,S,e,n,0,h.RGBA,b,null);const A=d.createFramebuffer(e,n,!1,!1);return A.colorAttachment.set(y),A}function fa(d,e){return e.colorRampTexture||(e.colorRampTexture=new dt(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function co(d,e,n,a,l){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let y=h[n.to.toString()],b=h[n.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const S=l.getPaintProperty(e);y=h[S],b=h[S]}y&&b&&d.setConstantPatternPositions(y,b)}function ma(d,e,n,a,l,h,y){const b=d.context.gl,S="fill-pattern",A=n.paint.get(S),M=A&&A.constantOr(1),z=n.getCrossfadeParameters();let B,Z,H,Q,re;y?(Z=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=b.LINES):(Z=M?"fillPattern":"fill",B=b.TRIANGLES);const se=A.constantOr(null);for(const le of a){const J=e.getTile(le);if(M&&!J.patternsLoaded())continue;const de=J.getBucket(n);if(!de)continue;const me=de.programConfigurations.get(n.id),be=d.useProgram(Z,me),ze=d.style.map.terrain&&d.style.map.terrain.getTerrainData(le);M&&(d.context.activeTexture.set(b.TEXTURE0),J.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),me.updatePaintBuffers(z)),co(me,S,se,J,n);const He=ze?le:null,st=d.translatePosMatrix(He?He.posMatrix:le.posMatrix,J,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(y){Q=de.indexBuffer2,re=de.segments2;const ht=[b.drawingBufferWidth,b.drawingBufferHeight];H=Z==="fillOutlinePattern"&&M?Dp(st,d,z,J,ht):jg(st,ht)}else Q=de.indexBuffer,re=de.segments,H=M?zp(st,d,z,J):so(st);be.draw(d.context,B,l,d.stencilModeForClipping(le),h,Ti.disabled,H,ze,n.id,de.layoutVertexBuffer,Q,re,n.paint,d.transform.zoom,me)}}function sl(d,e,n,a,l,h,y){const b=d.context,S=b.gl,A="fill-extrusion-pattern",M=n.paint.get(A),z=M.constantOr(1),B=n.getCrossfadeParameters(),Z=n.paint.get("fill-extrusion-opacity"),H=M.constantOr(null);for(const Q of a){const re=e.getTile(Q),se=re.getBucket(n);if(!se)continue;const le=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Q),J=se.programConfigurations.get(n.id),de=d.useProgram(z?"fillExtrusionPattern":"fillExtrusion",J);z&&(d.context.activeTexture.set(S.TEXTURE0),re.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),J.updatePaintBuffers(B)),co(J,A,H,re,n);const me=d.translatePosMatrix(Q.posMatrix,re,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),be=n.paint.get("fill-extrusion-vertical-gradient"),ze=z?Ka(me,d,be,Z,Q,B,re):aa(me,d,be,Z);de.draw(b,b.gl.TRIANGLES,l,h,y,Ti.backCCW,ze,le,n.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,n.paint,d.transform.zoom,J,d.style.map.terrain&&se.centroidVertexBuffer)}}function uo(d,e,n,a,l,h,y){const b=d.context,S=b.gl,A=n.fbo;if(!A)return;const M=d.useProgram("hillshade"),z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),M.draw(b,S.TRIANGLES,l,h,y,Ti.disabled,((B,Z,H,Q)=>{const re=H.paint.get("hillshade-shadow-color"),se=H.paint.get("hillshade-highlight-color"),le=H.paint.get("hillshade-accent-color");let J=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(J-=B.transform.angle);const de=!B.options.moving;return{u_matrix:Q?Q.posMatrix:B.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),de),u_image:0,u_latrange:Ya(0,Z.tileID),u_light:[H.paint.get("hillshade-exaggeration"),J],u_shadow:re,u_highlight:se,u_accent:le}})(d,n,a,z?e:null),z,a.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function ho(d,e,n,a,l,h){const y=d.context,b=y.gl,S=e.dem;if(S&&S.data){const A=S.dim,M=S.stride,z=S.getPixels();if(y.activeTexture.set(b.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(M),e.demTexture){const Z=e.demTexture;Z.update(z,{premultiply:!1}),Z.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new dt(y,z,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);y.activeTexture.set(b.TEXTURE0);let B=e.fbo;if(!B){const Z=new dt(y,{width:A,height:A,data:null},b.RGBA);Z.bind(b.LINEAR,b.CLAMP_TO_EDGE),B=e.fbo=y.createFramebuffer(A,A,!0,!1),B.colorAttachment.set(Z.texture)}y.bindFramebuffer.set(B.framebuffer),y.viewport.set([0,0,A,A]),d.useProgram("hillshadePrepare").draw(y,b.TRIANGLES,a,l,h,Ti.disabled,((Z,H)=>{const Q=H.stride,re=c.H();return c.aP(re,0,c.X,-c.X,0,0,1),c.J(re,re,[0,-c.X,0]),{u_matrix:re,u_image:1,u_dimension:[Q,Q],u_zoom:Z.overscaledZ,u_unpack:H.getUnpackVector()}})(e.tileID,S),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Jp(d,e,n,a,l,h){const y=a.paint.get("raster-fade-duration");if(!h&&y>0){const b=j.now(),S=(b-d.timeAdded)/y,A=e?(b-e.timeAdded)/y:-1,M=n.getSource(),z=l.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),Z=B&&d.refreshedUponExpiration?1:c.ac(B?S:1-A,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const ou=new c.aM(1,0,0,1),hi=new c.aM(0,1,0,1),ol=new c.aM(0,0,1,1),i_=new c.aM(1,0,1,1),Yp=new c.aM(0,1,1,1);function po(d,e,n,a){al(d,0,e+n/2,d.transform.width,n,a)}function $p(d,e,n,a){al(d,e-n/2,0,n,d.transform.height,a)}function al(d,e,n,a,l,h){const y=d.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,n*d.pixelRatio,a*d.pixelRatio,l*d.pixelRatio),y.clear({color:h}),b.disable(b.SCISSOR_TEST)}function Qp(d,e,n){const a=d.context,l=a.gl,h=n.posMatrix,y=d.useProgram("debug"),b=Yt.disabled,S=Mi.disabled,A=d.colorModeForRenderPass(),M="$debug",z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const B=e.getTileByID(n.key).latestRawTileData,Z=Math.floor((B&&B.byteLength||0)/1024),H=e.getTile(n).tileSize,Q=512/Math.min(H,512)*(n.overscaledZ/d.transform.zoom)*.5;let re=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(re+=` => ${n.overscaledZ}`),function(se,le){se.initDebugOverlayCanvas();const J=se.debugOverlayCanvas,de=se.context.gl,me=se.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,J.width,J.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(le,5,5),me.strokeText(le,5,5),se.debugOverlayTexture.update(J),se.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(d,`${re} ${Z}kB`),y.draw(a,l.TRIANGLES,b,S,rr.alphaBlended,Ti.disabled,la(h,c.aM.transparent,Q),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),y.draw(a,l.LINE_STRIP,b,S,A,Ti.disabled,la(h,c.aM.red),z,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function ef(d,e,n){const a=d.context,l=a.gl,h=d.colorModeForRenderPass(),y=new Yt(l.LEQUAL,Yt.ReadWrite,d.depthRangeFor3D),b=d.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,d.width,d.height]);for(const A of n){const M=d.renderToTexture.getTexture(A),z=e.getTerrainData(A.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,M.texture);const B=d.transform.calculatePosMatrix(A.tileID.toUnwrapped()),Z=e.getMeshFrameDelta(d.transform.zoom),H=d.transform.calculateFogMatrix(A.tileID.toUnwrapped()),Q=qc(B,Z,H,d.style.sky,d.transform.pitch);b.draw(a,l.TRIANGLES,y,Mi.disabled,h,Ti.backCCW,Q,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class ll{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class cl{constructor(e,n){this.context=new t_(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Mt.maxUnderzooming+Mt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new jc}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,ks.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,ks.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const l=new c.$;l.emplaceBack(0,0,0,0),l.emplaceBack(c.X,0,c.X,0),l.emplaceBack(0,c.X,0,c.X),l.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,xi.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,ks.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aZ;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const b=new c.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const S=this.context.gl;this.stencilClearMode=new Mi({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Yt.disabled,this.stencilClearMode,rr.disabled,Ti.disabled,Kr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(rr.disabled),a.setDepthMode(Yt.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of n){const b=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y);h.draw(a,l.TRIANGLES,Yt.disabled,new Mi({func:l.ALWAYS,mask:0},b,255,l.KEEP,l.KEEP,l.REPLACE),rr.disabled,Ti.disabled,Kr(y.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Mi({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Mi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),l=a[a.length-1].overscaledZ,h=a[0].overscaledZ-l+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const y={};for(let b=0;b<h;b++)y[b+l]=new Mi({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[y,a]}return[{[l]:Mi.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new rr([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?rr.unblended:rr.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return Yt.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Yt(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(j.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,h={},y={},b={};for(const S in l){const A=l[S];A.used&&A.prepare(this.context),h[S]=A.getVisibleCoordinates(),y[S]=h[S].slice().reverse(),b[S]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const A=this.style._layers[S];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const M=y[A.source];(A.type==="custom"||M.length)&&this.renderLayer(this,l[A.source],A,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,A){const M=S.context,z=M.gl,B=((se,le,J)=>({u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:(le.height/2+le.getHorizon())*J,u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*le.height/2*J}))(A,S.style.map.transform,S.pixelRatio),Z=new Yt(z.LEQUAL,Yt.ReadWrite,[0,1]),H=Mi.disabled,Q=S.colorModeForRenderPass(),re=S.useProgram("sky");if(!A.mesh){const se=new c.aX;se.emplaceBack(-1,-1),se.emplaceBack(1,-1),se.emplaceBack(1,1),se.emplaceBack(-1,1);const le=new c.aY;le.emplaceBack(0,1,2),le.emplaceBack(0,2,3),A.mesh=new ll(M.createVertexBuffer(se,ks.members),M.createIndexBuffer(le),c.a0.simpleSegment(0,0,se.length,le.length))}re.draw(M,z.TRIANGLES,Z,H,Q,Ti.disabled,B,void 0,"sky",A.mesh.vertexBuffer,A.mesh.indexBuffer,A.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],A=l[S.source],M=h[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,A,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],A=l[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?b:y)[S.source];this._renderTileClippingMasks(S,h[S.source]),this.renderLayer(this,A,S,M)}if(this.options.showTileBoundaries){const S=function(A,M){let z=null;const B=Object.values(A._layers).flatMap(re=>re.source&&!re.isHidden(M)?[A.sourceCaches[re.source]]:[]),Z=B.filter(re=>re.getSource().type==="vector"),H=B.filter(re=>re.getSource().type!=="vector"),Q=re=>{(!z||z.getSource().maxzoom<re.getSource().maxzoom)&&(z=re)};return Z.forEach(re=>Q(re)),z||H.forEach(re=>Q(re)),z}(this.style,this.transform.zoom);S&&function(A,M,z){for(let B=0;B<z.length;B++)Qp(A,M,z[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const A=S.transform.padding;po(S,S.transform.height-(A.top||0),3,ou),po(S,A.bottom||0,3,hi),$p(S,A.left||0,3,ol),$p(S,S.transform.width-(A.right||0),3,i_);const M=S.transform.centerPoint;(function(z,B,Z,H){al(z,B-1,Z-10,2,20,H),al(z,B-10,Z-1,20,2,H)})(S,M.x,S.transform.height-M.y,Yp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!c.a_(n,a):!c.a$(n,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,y){const b=h.context,S=b.gl,A=rr.unblended,M=new Yt(S.LEQUAL,Yt.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.sourceCache.getRenderableTiles(),Z=h.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1});for(const H of B){const Q=y.getTerrainData(H.tileID),re={u_matrix:h.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};Z.draw(b,S.TRIANGLES,M,Mi.disabled,A,Ti.backCCW,re,Q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,y){const b=h.context,S=b.gl,A=rr.unblended,M=new Yt(S.LEQUAL,Yt.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.getCoordsTexture(),Z=y.sourceCache.getRenderableTiles(),H=h.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1}),y.coordsIndex=[];for(const Q of Z){const re=y.getTerrainData(Q.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,B.texture);const se={u_matrix:h.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};H.draw(b,S.TRIANGLES,M,Mi.disabled,A,Ti.backCCW,se,re,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),y.coordsIndex.push(Q.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,y,b,S,A){if(h.renderPass!=="translucent")return;const M=Mi.disabled,z=h.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,Z,H,Q,re,se,le,J,de){const me=Z.transform,be=Es(),ze=re==="map",He=se==="map";for(const st of B){const ht=Q.getTile(st),et=ht.getBucket(H);if(!et||!et.text||!et.text.segments.get().length)continue;const Qe=c.ag(et.textSizeData,me.zoom),xt=ti(ht,1,Z.transform.zoom),jt=as(st.posMatrix,He,ze,Z.transform,xt),rt=H.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(Qe){const at=Math.pow(2,me.zoom-ht.tileID.overscaledZ),Nt=Z.style.map.terrain?(Gt,ii)=>Z.style.map.terrain.getElevation(st,Gt,ii):null,Oi=be.translatePosition(me,ht,le,J);lo(et,ze,He,de,me,jt,st.posMatrix,at,Qe,rt,be,Oi,st.toUnwrapped(),Nt)}}}(S,h,b,y,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),A),b.paint.get("icon-opacity").constantOr(1)!==0&&ru(h,y,b,S,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),M,z),b.paint.get("text-opacity").constantOr(1)!==0&&ru(h,y,b,S,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),M,z),y.map.showCollisionBoxes&&(ha(h,y,b,S,!0),ha(h,y,b,S,!1))})(e,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(h,y,b,S){if(h.renderPass!=="translucent")return;const A=b.paint.get("circle-opacity"),M=b.paint.get("circle-stroke-width"),z=b.paint.get("circle-stroke-opacity"),B=!b.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const Z=h.context,H=Z.gl,Q=h.depthModeForSublayer(0,Yt.ReadOnly),re=Mi.disabled,se=h.colorModeForRenderPass(),le=[];for(let J=0;J<S.length;J++){const de=S[J],me=y.getTile(de),be=me.getBucket(b);if(!be)continue;const ze=be.programConfigurations.get(b.id),He=h.useProgram("circle",ze),st=be.layoutVertexBuffer,ht=be.indexBuffer,et=h.style.map.terrain&&h.style.map.terrain.getTerrainData(de),Qe={programConfiguration:ze,program:He,layoutVertexBuffer:st,indexBuffer:ht,uniformValues:Ug(h,de,me,b),terrainData:et};if(B){const xt=be.segments.get();for(const jt of xt)le.push({segments:new c.a0([jt]),sortKey:jt.sortKey,state:Qe})}else le.push({segments:be.segments,sortKey:0,state:Qe})}B&&le.sort((J,de)=>J.sortKey-de.sortKey);for(const J of le){const{programConfiguration:de,program:me,layoutVertexBuffer:be,indexBuffer:ze,uniformValues:He,terrainData:st}=J.state;me.draw(Z,H.TRIANGLES,Q,re,se,Ti.disabled,He,st,b.id,be,ze,J.segments,b.paint,h.transform.zoom,de)}})(e,n,a,l);break;case"heatmap":(function(h,y,b,S){if(b.paint.get("heatmap-opacity")===0)return;const A=h.context;if(h.style.map.terrain){for(const M of S){const z=y.getTile(M);y.hasRenderableParent(M)||(h.renderPass==="offscreen"?su(h,z,b,M):h.renderPass==="translucent"&&Fs(h,b,M))}A.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(M,z,B,Z){const H=M.context,Q=H.gl,re=Mi.disabled,se=new rr([Q.ONE,Q.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(le,J,de){const me=le.gl;le.activeTexture.set(me.TEXTURE1),le.viewport.set([0,0,J.width/4,J.height/4]);let be=de.heatmapFbos.get(c.aU);be?(me.bindTexture(me.TEXTURE_2D,be.colorAttachment.get()),le.bindFramebuffer.set(be.framebuffer)):(be=pa(le,J.width/4,J.height/4),de.heatmapFbos.set(c.aU,be))})(H,M,B),H.clear({color:c.aM.transparent});for(let le=0;le<Z.length;le++){const J=Z[le];if(z.hasRenderableParent(J))continue;const de=z.getTile(J),me=de.getBucket(B);if(!me)continue;const be=me.programConfigurations.get(B.id),ze=M.useProgram("heatmap",be),{zoom:He}=M.transform;ze.draw(H,Q.TRIANGLES,Yt.disabled,re,se,Ti.disabled,Jr(J.posMatrix,de,He,B.paint.get("heatmap-intensity")),null,B.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,B.paint,M.transform.zoom,be)}H.viewport.set([0,0,M.width,M.height])}(h,y,b,S):h.renderPass==="translucent"&&function(M,z){const B=M.context,Z=B.gl;B.setColorMode(M.colorModeForRenderPass());const H=z.heatmapFbos.get(c.aU);H&&(B.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,H.colorAttachment.get()),B.activeTexture.set(Z.TEXTURE1),fa(B,z).bind(Z.LINEAR,Z.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(B,Z.TRIANGLES,Yt.disabled,Mi.disabled,M.colorModeForRenderPass(),Ti.disabled,Ja(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(h,b)})(e,n,a,l);break;case"line":(function(h,y,b,S){if(h.renderPass!=="translucent")return;const A=b.paint.get("line-opacity"),M=b.paint.get("line-width");if(A.constantOr(1)===0||M.constantOr(1)===0)return;const z=h.depthModeForSublayer(0,Yt.ReadOnly),B=h.colorModeForRenderPass(),Z=b.paint.get("line-dasharray"),H=b.paint.get("line-pattern"),Q=H.constantOr(1),re=b.paint.get("line-gradient"),se=b.getCrossfadeParameters(),le=Q?"linePattern":Z?"lineSDF":re?"lineGradient":"line",J=h.context,de=J.gl;let me=!0;for(const be of S){const ze=y.getTile(be);if(Q&&!ze.patternsLoaded())continue;const He=ze.getBucket(b);if(!He)continue;const st=He.programConfigurations.get(b.id),ht=h.context.program.get(),et=h.useProgram(le,st),Qe=me||et.program!==ht,xt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(be),jt=H.constantOr(null);if(jt&&ze.imageAtlas){const Nt=ze.imageAtlas,Oi=Nt.patternPositions[jt.to.toString()],Gt=Nt.patternPositions[jt.from.toString()];Oi&&Gt&&st.setConstantPatternPositions(Oi,Gt)}const rt=xt?be:null,at=Q?oo(h,ze,b,se,rt):Z?qg(h,ze,b,Z,se,rt):re?Rp(h,ze,b,He.lineClipsArray.length,rt):$a(h,ze,b,rt);if(Q)J.activeTexture.set(de.TEXTURE0),ze.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),st.updatePaintBuffers(se);else if(Z&&(Qe||h.lineAtlas.dirty))J.activeTexture.set(de.TEXTURE0),h.lineAtlas.bind(J);else if(re){const Nt=He.gradients[b.id];let Oi=Nt.texture;if(b.gradientVersion!==Nt.version){let Gt=256;if(b.stepInterpolant){const ii=y.getSource().maxzoom,Fi=be.canonical.z===ii?Math.ceil(1<<h.transform.maxZoom-be.canonical.z):1;Gt=c.ac(c.aV(He.maxLineLength/c.X*1024*Fi),256,J.maxTextureSize)}Nt.gradient=c.aW({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Nt.gradient||void 0,clips:He.lineClipsArray}),Nt.texture?Nt.texture.update(Nt.gradient):Nt.texture=new dt(J,Nt.gradient,de.RGBA),Nt.version=b.gradientVersion,Oi=Nt.texture}J.activeTexture.set(de.TEXTURE0),Oi.bind(b.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}et.draw(J,de.TRIANGLES,z,h.stencilModeForClipping(be),B,Ti.disabled,at,xt,b.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,b.paint,h.transform.zoom,st,He.layoutVertexBuffer2),me=!1}})(e,n,a,l);break;case"fill":(function(h,y,b,S){const A=b.paint.get("fill-color"),M=b.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=h.colorModeForRenderPass(),B=b.paint.get("fill-pattern"),Z=h.opaquePassEnabledForLayer()&&!B.constantOr(1)&&A.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===Z){const H=h.depthModeForSublayer(1,h.renderPass==="opaque"?Yt.ReadWrite:Yt.ReadOnly);ma(h,y,b,S,H,z,!1)}if(h.renderPass==="translucent"&&b.paint.get("fill-antialias")){const H=h.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Yt.ReadOnly);ma(h,y,b,S,H,z,!0)}})(e,n,a,l);break;case"fill-extrusion":(function(h,y,b,S){const A=b.paint.get("fill-extrusion-opacity");if(A!==0&&h.renderPass==="translucent"){const M=new Yt(h.context.gl.LEQUAL,Yt.ReadWrite,h.depthRangeFor3D);if(A!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))sl(h,y,b,S,M,Mi.disabled,rr.disabled),sl(h,y,b,S,M,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const z=h.colorModeForRenderPass();sl(h,y,b,S,M,Mi.disabled,z)}}})(e,n,a,l);break;case"hillshade":(function(h,y,b,S){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const A=h.context,M=h.depthModeForSublayer(0,Yt.ReadOnly),z=h.colorModeForRenderPass(),[B,Z]=h.renderPass==="translucent"?h.stencilConfigForOverlap(S):[{},S];for(const H of Z){const Q=y.getTile(H);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&h.renderPass==="offscreen"?ho(h,Q,b,M,Mi.disabled,z):h.renderPass==="translucent"&&uo(h,H,Q,b,M,B[H.overscaledZ],z)}A.viewport.set([0,0,h.width,h.height])})(e,n,a,l);break;case"raster":(function(h,y,b,S){if(h.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!S.length)return;const A=h.context,M=A.gl,z=y.getSource(),B=h.useProgram("raster"),Z=h.colorModeForRenderPass(),[H,Q]=z instanceof tr?[{},S]:h.stencilConfigForOverlap(S),re=Q[Q.length-1].overscaledZ,se=!h.options.moving;for(const le of Q){const J=h.depthModeForSublayer(le.overscaledZ-re,b.paint.get("raster-opacity")===1?Yt.ReadWrite:Yt.ReadOnly,M.LESS),de=y.getTile(le);de.registerFadeDuration(b.paint.get("raster-fade-duration"));const me=y.findLoadedParent(le,0),be=y.findLoadedSibling(le),ze=Jp(de,me||be||null,y,b,h.transform,h.style.map.terrain);let He,st;const ht=b.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;A.activeTexture.set(M.TEXTURE0),de.texture.bind(ht,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(M.TEXTURE1),me?(me.texture.bind(ht,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),He=Math.pow(2,me.tileID.overscaledZ-de.tileID.overscaledZ),st=[de.tileID.canonical.x*He%1,de.tileID.canonical.y*He%1]):de.texture.bind(ht,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&A.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const et=h.style.map.terrain&&h.style.map.terrain.getTerrainData(le),Qe=et?le:null,xt=Qe?Qe.posMatrix:h.transform.calculatePosMatrix(le.toUnwrapped(),se),jt=Zg(xt,st||[0,0],He||1,ze,b);z instanceof tr?B.draw(A,M.TRIANGLES,J,Mi.disabled,Z,Ti.disabled,jt,et,b.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments):B.draw(A,M.TRIANGLES,J,H[le.overscaledZ],Z,Ti.disabled,jt,et,b.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,l);break;case"background":(function(h,y,b,S){const A=b.paint.get("background-color"),M=b.paint.get("background-opacity");if(M===0)return;const z=h.context,B=z.gl,Z=h.transform,H=Z.tileSize,Q=b.paint.get("background-pattern");if(h.isPatternMissing(Q))return;const re=!Q&&A.a===1&&M===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==re)return;const se=Mi.disabled,le=h.depthModeForSublayer(0,re==="opaque"?Yt.ReadWrite:Yt.ReadOnly),J=h.colorModeForRenderPass(),de=h.useProgram(Q?"backgroundPattern":"background"),me=S||Z.coveringTiles({tileSize:H,terrain:h.style.map.terrain});Q&&(z.activeTexture.set(B.TEXTURE0),h.imageManager.bind(h.context));const be=b.getCrossfadeParameters();for(const ze of me){const He=S?ze.posMatrix:h.transform.calculatePosMatrix(ze.toUnwrapped()),st=Q?Wc(He,M,h,Q,{tileID:ze,tileSize:H},be):Qa(He,M,A),ht=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ze);de.draw(z,B.TRIANGLES,le,se,J,Ti.disabled,st,ht,b.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,l);break;case"custom":(function(h,y,b){const S=h.context,A=b.implementation;if(h.renderPass==="offscreen"){const M=A.prerender;M&&(h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),M.call(A,S.gl,h.transform.customLayerMatrix()),S.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),S.setStencilMode(Mi.disabled);const M=A.renderingMode==="3d"?new Yt(h.context.gl.LEQUAL,Yt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Yt.ReadOnly);S.setDepthMode(M),A.render(S.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),S.setDirty(),h.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,l,h){if(!a[0]&&!a[1])return e;const y=h?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(y){const A=Math.sin(y),M=Math.cos(y);a=[a[0]*M-a[1]*A,a[0]*A+a[1]*M]}const b=[h?a[0]:ti(n,a[0],this.transform.zoom),h?a[1]:ti(n,a[1],this.transform.zoom),0],S=new Float32Array(16);return c.J(S,e,b),S}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Zc(this.context,ls[e],n,Hc[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new dt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class fo{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const l=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=1/(b=c.af([],b,e))[3]/n*l;return c.b1(b,b,[S,S,1/b[3],S])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=function(B,Z){var H=Z[0],Q=Z[1],re=Z[2],se=H*H+Q*Q+re*re;return se>0&&(se=1/Math.sqrt(se)),B[0]=Z[0]*se,B[1]=Z[1]*se,B[2]=Z[2]*se,B}([],function(B,Z,H){var Q=Z[0],re=Z[1],se=Z[2],le=H[0],J=H[1],de=H[2];return B[0]=re*de-se*J,B[1]=se*le-Q*de,B[2]=Q*J-re*le,B}([],it([],h[b[0]],h[b[1]]),it([],h[b[2]],h[b[1]]))),A=-((M=S)[0]*(z=h[b[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(A)});return new fo(h,y)}}class mo{constructor(e,n){this.min=e,this.max=n,this.center=function(a,l,h){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,h){return a[0]=l[0]+h[0],a[1]=l[1]+h[1],a[2]=l[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=De(this.min),l=De(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],l[h]=n[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new mo(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let y=0;for(let b=0;b<n.length;b++)c.b2(h,n[b])>=0&&y++;if(y===0)return 0;y!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const S=e.points[b][l]-this.min[l];h=Math.min(h,S),y=Math.max(y,S)}if(y<0||h>this.max[l]-this.min[l])return 0}return 1}}class go{constructor(e=0,n=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=l}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),l=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const au=85.051129;class _o{constructor(e,n,a,l,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new go,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new _o(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,h){var y=l[0],b=l[1],S=l[2],A=l[3],M=Math.sin(h),z=Math.cos(h);a[0]=y*z+S*M,a[1]=b*z+A*M,a[2]=y*-M+S*z,a[3]=b*-M+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),l=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),y=this.pointCoordinate(new c.P(0,this.height)),b=Math.floor(Math.min(a.x,l.x,h.x,y.x)),S=Math.floor(Math.max(a.x,l.x,h.x,y.x)),A=1;for(let M=b-A;M<=S+A;M++)M!==0&&n.push(new c.b4(M,e))}return n}coveringTiles(e){var n,a;let l=this.coveringZoomLevel(e);const h=l;if(e.minzoom!==void 0&&l<e.minzoom)return[];e.maxzoom!==void 0&&l>e.maxzoom&&(l=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),b=c.Z.fromLngLat(this.center),S=Math.pow(2,l),A=[S*y.x,S*y.y,0],M=[S*b.x,S*b.y,0],z=fo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,l);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=l);const Z=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,H=J=>({aabb:new mo([J*S,0,0],[(J+1)*S,S,0]),zoom:0,x:0,y:0,wrap:J,fullyVisible:!1}),Q=[],re=[],se=l,le=e.reparseOverscaled?h:l;if(this._renderWorldCopies)for(let J=1;J<=3;J++)Q.push(H(-J)),Q.push(H(J));for(Q.push(H(0));Q.length>0;){const J=Q.pop(),de=J.x,me=J.y;let be=J.fullyVisible;if(!be){const et=J.aabb.intersects(z);if(et===0)continue;be=et===2}const ze=e.terrain?A:M,He=J.aabb.distanceX(ze),st=J.aabb.distanceY(ze),ht=Math.max(Math.abs(He),Math.abs(st));if(J.zoom===se||ht>Z+(1<<se-J.zoom)-2&&J.zoom>=B){const et=se-J.zoom,Qe=A[0]-.5-(de<<et),xt=A[1]-.5-(me<<et);re.push({tileID:new c.S(J.zoom===se?le:J.zoom,J.wrap,J.zoom,de,me),distanceSq:Ct([M[0]-.5-de,M[1]-.5-me]),tileDistanceToCamera:Math.sqrt(Qe*Qe+xt*xt)})}else for(let et=0;et<4;et++){const Qe=(de<<1)+et%2,xt=(me<<1)+(et>>1),jt=J.zoom+1;let rt=J.aabb.quadrant(et);if(e.terrain){const at=new c.S(jt,J.wrap,jt,Qe,xt),Nt=e.terrain.getMinMaxElevation(at),Oi=(n=Nt.minElevation)!==null&&n!==void 0?n:this.elevation,Gt=(a=Nt.maxElevation)!==null&&a!==void 0?a:this.elevation;rt=new mo([rt.min[0],rt.min[1],Oi],[rt.max[0],rt.max[1],Gt])}Q.push({aabb:rt,zoom:jt,x:Qe,y:xt,wrap:J.wrap,fullyVisible:be})}}return re.sort((J,de)=>J.distanceSq-de.distanceSq).map(J=>J.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,au);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-h))return;const y=a+n-h,b=Math.cos(this._pitch)*this.cameraToCenterDistance/y/c.b5(1,l.lat),S=this.scaleZoom(b/this.tileSize);this._elevation=h,this._center=l,this.zoom=S}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),y=new c.Z(h.x-(a.x-l.x),h.y-(a.y-l.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const B=n.pointCoordinate(e);if(B!=null)return B}const a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(l,l,this.pixelMatrixInverse);const h=a[3],y=l[3],b=a[1]/h,S=l[1]/y,A=a[2]/h,M=l[2]/y,z=A===M?0:(0-A)/(M-A);return new c.Z(c.y.number(a[0]/h,l[0]/y,z)/this.worldSize,c.y.number(b,S,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(l,l,a),new c.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ye().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,au])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),l=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[l*a,n.y*a,0]),c.K(h,h,[a/c.X,a/c.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),l[a]=new Float32Array(h),l[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const l=this.calculateTileMatrix(e);return c.L(l,this.fogMatrix,l),a[n]=new Float32Array(l),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const J=179.9999999999;l=[-J,J]}const h=this.tileSize*this.zoomScale(a.zoom);let y=0,b=h,S=0,A=h,M=0,z=0;const{x:B,y:Z}=this.size;if(this.latRange){const J=this.latRange;y=c.Q(J[1])*h,b=c.Q(J[0])*h,b-y<Z&&(M=Z/(b-y))}l&&(S=c.b3(c.O(l[0])*h,0,h),A=c.b3(c.O(l[1])*h,0,h),A<S&&(A+=h),A-S<B&&(z=B/(A-S)));const{x:H,y:Q}=this.project.call({worldSize:h},e);let re,se;const le=Math.max(z||0,M||0);if(le){const J=new c.P(z?(A+S)/2:H,M?(b+y)/2:Q);return a.center=this.unproject.call({worldSize:h},J).wrap(),a.zoom+=this.scaleZoom(le),a}if(this.latRange){const J=Z/2;Q-J<y&&(se=y+J),Q+J>b&&(se=b-J)}if(l){const J=(S+A)/2;let de=H;this._renderWorldCopies&&(de=c.b3(H,J-h/2,J+h/2));const me=B/2;de-me<S&&(re=S+me),de+me>A&&(re=A-me)}if(re!==void 0||se!==void 0){const J=new c.P(re??H,se??Q);a.center=this.unproject.call({worldSize:h},J).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let l=c.an(new Float64Array(16));c.K(l,l,[this.width/2,-this.height/2,1]),c.J(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=c.an(new Float64Array(16)),c.K(l,l,[1,-1,1]),c.J(l,l,[-1,-1,0]),c.K(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),y=Math.min(this.elevation,this.minElevationForCurrentTile),b=h-y*this._pixelPerMeter/Math.cos(this._pitch),S=y<0?b:h,A=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(c.ac(Math.PI-A-M,.01,Math.PI-.01)),B=this.getHorizon(),Z=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),H=Math.sin(Z)*S/Math.sin(c.ac(Math.PI-A-Z,.01,Math.PI-.01)),Q=Math.min(z,H);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+S),this.nearZ=this.height/50,l=new Float64Array(16),c.b6(l,this._fov,this.width/this.height,this.nearZ,this.farZ),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.projectionMatrix=c.ae(l),c.K(l,l,[1,-1,1]),c.J(l,l,[0,0,-this.cameraToCenterDistance]),c.b7(l,l,this._pitch),c.ad(l,l,this.angle),c.J(l,l,[-n,-a,0]),this.mercatorMatrix=c.K([],l,[this.worldSize,this.worldSize,this.worldSize]),c.K(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,l),c.J(l,l,[0,0,-this.elevation]),this.modelViewProjectionMatrix=l,this.invModelViewProjectionMatrix=c.as([],l),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,l);const re=this.width%2/2,se=this.height%2/2,le=Math.cos(this.angle),J=Math.sin(this.angle),de=n-Math.round(n)+le*re+J*se,me=a-Math.round(a)+le*se+J*re,be=new Float64Array(l);if(c.J(be,be,[de>.5?de-1:de,me>.5?me-1:me,0]),this.alignedModelViewProjectionMatrix=be,l=c.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,l=n.y,h=n.x,y=n.y;for(const b of e)a=Math.min(a,b.x),l=Math.min(l,b.y),h=Math.max(h,b.x),y=Math.max(y,b.y);return[new c.P(a,l),new c.P(h,l),new c.P(h,y),new c.P(a,y),new c.P(a,l)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(l,l,this.modelViewProjectionMatrix),l[2]/l[3]}}function ga(d,e){let n,a=!1,l=null,h=null;const y=()=>{l=null,a&&(d.apply(h,n),l=setTimeout(y,e),a=!1)};return(...b)=>(a=!0,h=this,n=b,l||y(),l)}class ul{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let h=window.location.hash.replace(l,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let y=window.location.href.replace(/(#.+)?$/,h);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ga(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,l),y=Math.round(n.lng*h)/h,b=Math.round(n.lat*h)/h,S=this._map.getBearing(),A=this._map.getPitch();let M="";if(M+=e?`/${y}/${b}/${a}`:`${a}/${b}/${y}`,(S||A)&&(M+="/"+Math.round(10*S)/10),A&&(M+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let B=!1;const Z=window.location.hash.slice(1).split("&").map(H=>{const Q=H.split("=")[0];return Q===z?(B=!0,`${Q}=${M}`):H}).filter(H=>H);return B||Z.push(`${z}=${M}`),`#${Z.join("&")}`}return`#${M}`}}const hl={linearity:.3,easing:c.b8(0,0,.3,1)},lu=c.e({deceleration:2500,maxSpeed:1400},hl),r_=c.e({deceleration:20,maxSpeed:1400},hl),tf=c.e({deceleration:1e3,maxSpeed:360},hl),dl=c.e({deceleration:1e3,maxSpeed:90},hl);class cu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:j.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=j.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const h=ya(n.pan.mag(),a,c.e({},lu,e||{}));l.offset=n.pan.mult(h.amount/n.pan.mag()),l.center=this._map.transform.center,_a(l,h)}if(n.zoom){const h=ya(n.zoom,a,r_);l.zoom=this._map.transform.zoom+h.amount,_a(l,h)}if(n.bearing){const h=ya(n.bearing,a,tf);l.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),_a(l,h)}if(n.pitch){const h=ya(n.pitch,a,dl);l.pitch=this._map.transform.pitch+h.amount,_a(l,h)}if(l.zoom||l.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;l.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(l,{noMoveStart:!0})}}function _a(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function ya(d,e,n){const{maxSpeed:a,linearity:l,deceleration:h}=n,y=c.ac(d*l/(e/1e3),-a,a),b=Math.abs(y)/(h*l);return{easing:n.easing,duration:1e3*b,amount:y*(b/2)}}class Mr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,l={}){const h=V.mousePos(n.getCanvas(),a),y=n.unproject(h);super(e,c.e({point:h,lngLat:y,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class Bs extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const l=e==="touchend"?a.changedTouches:a.touches,h=V.touchPos(n.getCanvasContainer(),l),y=h.map(S=>n.unproject(S)),b=h.reduce((S,A,M,z)=>S.add(A.div(z.length)),new c.P(0,0));super(e,{points:h,point:b,lngLats:y,lngLat:n.unproject(b),originalEvent:a}),this._defaultPrevented=!1}}class rf extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class nf{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new rf(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Mr(e.type,this._map,e))}mouseup(e){this._map.fire(new Mr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Mr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mr(e.type,this._map,e))}mouseover(e){this._map.fire(new Mr(e.type,this._map,e))}mouseout(e){this._map.fire(new Mr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Bs(e.type,this._map,e))}touchmove(e){this._map.fire(new Bs(e.type,this._map,e))}touchend(e){this._map.fire(new Bs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Bs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class En{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class cn{constructor(e,n){this._map=e,this._tr=new En(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(l.x,a.x),y=Math.max(l.x,a.x),b=Math.min(l.y,a.y),S=Math.max(l.y,a.y);V.setTransform(this._box,`translate(${h}px,${b}px)`),this._box.style.width=y-h+"px",this._box.style.height=S-b+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,l=n;if(this.reset(),V.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function va(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const n={};for(let a=0;a<d.length;a++)n[d[a].identifier]=e[a];return n}class uu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const h=new c.P(0,0);for(const y of l)h._add(y);return h.div(l.length)}(n),this.touches=va(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const l=va(a,n);for(const h in this.touches){const y=l[h];(!y||y.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class pl{constructor(e){this.singleTap=new uu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const l=this.singleTap.touchend(e,n,a);if(l){const h=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(l)<30;if(h&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class yo{constructor(e){this._tr=new En(e),this._zoomIn=new pl({numTouches:1,numTaps:2}),this._zoomOut=new pl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const l=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),y=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(l)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hu={0:1,2:2};class fl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=V.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const l=hu[a];return n.buttons===void 0||(n.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class du{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const ml=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}},pu=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new fl({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new Qn({clickTolerance:e,move:(l,h)=>({bearingDelta:(h.x-l.x)*n}),moveStateManager:a,enable:d,assignEvents:ml})},fu=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new fl({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new Qn({clickTolerance:e,move:(l,h)=>({pitchDelta:(h.y-l.y)*n}),moveStateManager:a,enable:d,assignEvents:ml})};class Ns{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const l=va(a,n),h=new c.P(0,0),y=new c.P(0,0);let b=0;for(const A in l){const M=l[A],z=this._touches[A];z&&(h._add(M),y._add(M.sub(z)),b++,l[A]=M)}if(this._touches=l,this._shouldBePrevented(b)||!y.mag())return;const S=y.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,h]=this._firstTwoTouches,y=xa(a,n,l),b=xa(a,n,h);if(!y||!b)return;const S=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],S,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[l,h]=this._firstTwoTouches,y=xa(a,n,l),b=xa(a,n,h);y&&b||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function xa(d,e,n){for(let a=0;a<d.length;a++)if(d[a].identifier===n)return e[a]}function mu(d,e){return Math.log(d/e)/Math.LN2}class gu extends gl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mu(this._distance,a),pinchAround:n}}}function _u(d,e){return 180*d.angleWith(e)/Math.PI}class yu extends gl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_u(this._vector,l),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=_u(e,this._startVector);return Math.abs(a)<n}}function _l(d){return Math.abs(d.y)>Math.abs(d.x)}class vo extends gl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,_l(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,h=n.mag()>=2;if(!l&&!h)return;if(!l||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return _l(e)&&_l(n)&&y}}const sf={panStep:100,bearingStep:15,pitchStep:10};class yn{constructor(e){this._tr=new En(e);const n=sf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,l=0,h=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Zn,zoom:n?Math.round(S.zoom)+n*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+l*this._pitchStep,offset:[-h*this._panStep,-y*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zn(d){return d*(2-d)}const vu=4.000244140625;class kn{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new En(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=j.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%vu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=V.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>vu?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*A))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,l=this._easing;let h,y=!1;const b=j.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&l&&b){const S=Math.min(b/200,1),A=l(S);h=c.y.number(a,n,A),S<1?this._frameId||(this._frameId=!0):y=!0}else h=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,l=(j.now()-a.start)/a.duration,h=a.easing(l+.01)-a.easing(l),y=.27/Math.sqrt(h*h+1e-4)*.01,b=Math.sqrt(.0729-y*y);n=c.b8(y,b,.25,1)}return this._prevEase={start:j.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vs{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class n_{constructor(e){this._tr=new En(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class s_{constructor(){this._tap=new pl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],h=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(l)<30;h&&y?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],h=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,n,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class of{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class af{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xu{constructor(e,n,a,l){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class xo{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const vn=d=>d.zoom||d.drag||d.pitch||d.rotate;class gt extends c.k{}function yl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class bu{constructor(e,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,h)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=l.type==="renderFrame"?void 0:l,b={needsRenderFrame:!1},S={},A={},M=l.touches,z=M?this._getMapTouches(M):void 0,B=z?V.touchPos(this._map.getCanvas(),z):V.mousePos(this._map.getCanvas(),l);for(const{handlerName:Q,handler:re,allowed:se}of this._handlers){if(!re.isEnabled())continue;let le;this._blockedByActive(A,se,Q)?re.reset():re[h||l.type]&&(le=re[h||l.type](l,B,z),this.mergeHandlerResult(b,S,le,Q,y),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||re.isActive())&&(A[Q]=re)}const Z={};for(const Q in this._previousActiveHandlers)A[Q]||(Z[Q]=y);this._previousActiveHandlers=A,(Object.keys(Z).length||yl(b))&&(this._changes.push([b,S,Z]),this._triggerRenderFrame()),(Object.keys(A).length||yl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cu(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,h,y]of this._listeners)V.addEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,a]of this._listeners)V.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new nf(n,e));const l=n.boxZoom=new cn(n,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const h=n.cooperativeGestures=new xo(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const y=new yo(n),b=new n_(n);n.doubleClickZoom=new Vs(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const S=new s_;this._add("tapDragZoom",S);const A=n.touchPitch=new vo(n);this._add("touchPitch",A),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const M=pu(e),z=fu(e);n.dragRotate=new af(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const B=(({enable:le,clickTolerance:J})=>{const de=new fl({checkCorrectEvent:me=>V.mouseButton(me)===0&&!me.ctrlKey});return new Qn({clickTolerance:J,move:(me,be)=>({around:be,panDelta:be.sub(me)}),activateOnStart:!0,moveStateManager:de,enable:le,assignEvents:ml})})(e),Z=new Ns(e,n);n.dragPan=new of(a,B,Z),this._add("mousePan",B),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const H=new yu,Q=new gu;n.touchZoomRotate=new xu(a,Q,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const re=n.scrollZoom=new kn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const se=n.keyboard=new yn(n);this._add("keyboard",se),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new nr(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const l in e)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,l,h){if(!a)return;c.e(e,a);const y={handlerName:l,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=y),a.panDelta!==void 0&&(n.drag=y),a.pitchDelta!==void 0&&(n.pitch=y),a.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},a={};for(const[l,h,y]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),c.e(n,h),c.e(a,y);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const l=this._map,h=l._getTransformForUpdate(),y=l.terrain;if(!(yl(e)||y&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:b,zoomDelta:S,bearingDelta:A,pitchDelta:M,around:z,pinchAround:B}=e;B!==void 0&&(z=B),l._stop(!0),z=z||l.transform.centerPoint;const Z=h.pointLocation(b?z.sub(b):z);A&&(h.bearing+=A),M&&(h.pitch+=M),S&&(h.zoom+=S),y?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(b)):h.setLocationAtPoint(Z,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(Z,z)):h.setLocationAtPoint(Z,z),l._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const l=vn(this._eventsInProgress),h=vn(e),y={};for(const z in e){const{originalEvent:B}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=B),this._eventsInProgress[z]=e[z]}!l&&h&&this._fireEvent("movestart",h.originalEvent);for(const z in y)this._fireEvent(z,y[z]);h&&this._fireEvent("move",h.originalEvent);for(const z in e){const{originalEvent:B}=e[z];this._fireEvent(z,B)}const b={};let S;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:Z}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],S=n[B]||Z,b[`${z}end`]=S)}for(const z in b)this._fireEvent(z,b[z]);const A=vn(this._eventsInProgress),M=(l||h)&&!A;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!z||!z.essential&&j.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:S})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new gt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class lf extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((j.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=ye.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,l){const h={top:0,bottom:0,right:0,left:0};if(typeof(l=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const et=l.padding;l.padding={top:et,bottom:et,right:et,left:et}}l.padding=c.e(h,l.padding);const y=this.transform,b=y.padding,S=new ye(e,n),A=y.project(S.getNorthWest()),M=y.project(S.getNorthEast()),z=y.project(S.getSouthEast()),B=y.project(S.getSouthWest()),Z=c.ba(-a),H=A.rotate(Z),Q=M.rotate(Z),re=z.rotate(Z),se=B.rotate(Z),le=new c.P(Math.max(H.x,Q.x,se.x,re.x),Math.max(H.y,Q.y,se.y,re.y)),J=new c.P(Math.min(H.x,Q.x,se.x,re.x),Math.min(H.y,Q.y,se.y,re.y)),de=le.sub(J),me=(y.width-(b.left+b.right+l.padding.left+l.padding.right))/de.x,be=(y.height-(b.top+b.bottom+l.padding.top+l.padding.bottom))/de.y;if(be<0||me<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(y.scaleZoom(y.scale*Math.min(me,be)),l.maxZoom),He=c.P.convert(l.offset),st=new c.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(c.ba(a)),ht=He.add(st).mult(y.scale/y.zoomScale(ze));return{center:y.unproject(A.add(z).div(2).sub(ht)),zoom:ze,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,l,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,l),l,h)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let l=!1,h=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(l=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),l&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),y&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,l=0){const h=c.Z.fromLngLat(e,n),y=c.Z.fromLngLat(a,l),b=y.x-h.x,S=y.y-h.y,A=y.z-h.z,M=Math.hypot(b,S,A);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),Z=180*Math.atan2(b,-S)/Math.PI;let H=180*Math.acos(z/M)/Math.PI;return H=A<0?90-H:90+H,{center:y.toLngLat(),zoom:B,pitch:H,bearing:Z}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&j.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,A="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let Z=l.centerPoint.add(B);const H=l.pointLocation(Z),{center:Q,zoom:re}=l.getConstrained(c.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(Q,l);const se=l.project(H),le=l.project(Q).sub(se),J=l.zoomScale(re-h);let de,me;e.around&&(de=c.N.convert(e.around),me=l.locationPoint(de));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==h,this._rotating=this._rotating||y!==A,this._pitching=this._pitching||M!==b,this._padding=!l.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,be),this.terrain&&this._prepareElevation(Q),this._ease(ze=>{if(this._zooming&&(l.zoom=c.y.number(h,re,ze)),this._rotating&&(l.bearing=c.y.number(y,A,ze)),this._pitching&&(l.pitch=c.y.number(b,M,ze)),this._padding&&(l.interpolatePadding(S,z,ze),Z=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(ze),de)l.setLocationAtPoint(de,me);else{const He=l.zoomScale(l.zoom-h),st=re>h?Math.min(2,J):Math.max(.5,J),ht=Math.pow(st,1-ze),et=l.unproject(se.add(le.mult(ze*ht)).mult(He));l.setLocationAtPoint(l.renderWorldCopies?et.wrap():et,Z)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},ze=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ze)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const l=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:l.pitch,zoom:l.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&n.push(l=>this.transformCameraUpdate(l)),!n.length)return;const a=e.clone();for(const l of n){const h=a.clone(),{center:y,zoom:b,pitch:S,bearing:A,elevation:M}=l(h);y&&(h.center=y),b!==void 0&&(h.zoom=b),S!==void 0&&(h.pitch=S),A!==void 0&&(h.bearing=A),M!==void 0&&(h.elevation=M),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),l&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&j.prefersReducedMotion){const at=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,A="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let Z=l.centerPoint.add(B);const H=l.pointLocation(Z),{center:Q,zoom:re}=l.getConstrained(c.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(Q,l);const se=l.zoomScale(re-h),le=l.project(H),J=l.project(Q).sub(le);let de=e.curve;const me=Math.max(l.width,l.height),be=me/se,ze=J.mag();if("minZoom"in e){const at=c.ac(Math.min(e.minZoom,h,re),l.minZoom,l.maxZoom),Nt=me/l.zoomScale(at-h);de=Math.sqrt(Nt/ze*2)}const He=de*de;function st(at){const Nt=(be*be-me*me+(at?-1:1)*He*He*ze*ze)/(2*(at?be:me)*He*ze);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function ht(at){return(Math.exp(at)-Math.exp(-at))/2}function et(at){return(Math.exp(at)+Math.exp(-at))/2}const Qe=st(!1);let xt=function(at){return et(Qe)/et(Qe+de*at)},jt=function(at){return me*((et(Qe)*(ht(Nt=Qe+de*at)/et(Nt))-ht(Qe))/He)/ze;var Nt},rt=(st(!0)-Qe)/de;if(Math.abs(ze)<1e-6||!isFinite(rt)){if(Math.abs(me-be)<1e-6)return this.easeTo(e,n);const at=be<me?-1:1;rt=Math.abs(Math.log(be/me))/de,jt=()=>0,xt=Nt=>Math.exp(at*de*Nt)}return e.duration="duration"in e?+e.duration:1e3*rt/("screenSpeed"in e?+e.screenSpeed/de:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=y!==A,this._pitching=M!==b,this._padding=!l.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(Q),this._ease(at=>{const Nt=at*rt,Oi=1/xt(Nt);l.zoom=at===1?re:h+l.scaleZoom(Oi),this._rotating&&(l.bearing=c.y.number(y,A,at)),this._pitching&&(l.pitch=c.y.number(b,M,at)),this._padding&&(l.interpolatePadding(S,z,at),Z=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(at);const Gt=at===1?Q:l.unproject(le.add(J.mult(jt(Nt))).mult(Oi));l.setLocationAtPoint(l.renderWorldCopies?Gt.wrap():Gt,Z),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=j.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const bo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wo{constructor(e=bo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const h=n[l];if(h.used||h.usedForTerrain){const y=h.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,h)=>l.length-h.length),e=e.filter((l,h)=>{for(let y=h+1;y<e.length;y++)if(e[y].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class wu{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const n=V.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class si{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Su=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class o_ extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const l of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),c.aP(l.posMatrix,0,c.X,0,c.X,0,1),this._tiles[l.key]=new wr(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[a]=h}else if(l.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=l.canonical.z-e.canonical.z,b=l.canonical.x-(l.canonical.x>>y<<y),S=l.canonical.y-(l.canonical.y>>y<<y),A=c.X>>y;c.aP(h.posMatrix,0,A,0,A,0,1),c.J(h.posMatrix,h.posMatrix,[-b*A,-S*A,0]),n[a]=h}else if(e.canonical.isChildOf(l.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=e.canonical.z-l.canonical.z,b=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),A=c.X>>y;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[b*A,S*A,0]),c.K(h.posMatrix,h.posMatrix,[1/2**y,1/2**y,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;l>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(l--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class Pu{constructor(e,n,a){this.painter=e,this.sourceCache=new o_(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,l=c.X){var h;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const y=this.getTerrainData(e),b=(h=y.tile)===null||h===void 0?void 0:h.dem;if(!b)return 0;const S=function(H,Q,re){var se=Q[0],le=Q[1];return H[0]=re[0]*se+re[4]*le+re[12],H[1]=re[1]*se+re[5]*le+re[13],H}([],[n/l*c.X,a/l*c.X],y.u_terrain_matrix),A=[S[0]*b.dim,S[1]*b.dim],M=Math.floor(A[0]),z=Math.floor(A[1]),B=A[0]-M,Z=A[1]-z;return b.get(M,z)*(1-B)*(1-Z)+b.get(M+1,z)*B*(1-Z)+b.get(M,z+1)*(1-B)*Z+b.get(M+1,z+1)*B*Z}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,l%c.X,h%c.X,c.X)}getElevation(e,n,a,l=c.X){return this.getDEMElevation(e,n,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new dt(l,h,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new dt(l,new c.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new dt(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?h=e.canonical.z-l:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>h<<h),b=e.canonical.y-(e.canonical.y>>h<<h),S=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(S,S,[y*c.X,b*c.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new dt(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new dt(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,y=0;h<this._coordsTextureSize;h++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)n[y+0]=255&b,n[y+1]=255&h,n[y+2]=b>>8<<4|h>>8,n[y+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new dt(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,l=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(h,b-y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const S=n[0]+(n[2]>>4<<8),A=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const B=this._coordsTextureSize,Z=(1<<z.tileID.canonical.z)*B;return new c.Z((z.tileID.canonical.x*B+S)/Z+z.tileID.wrap,(z.tileID.canonical.y*B+A)/Z,this.getElevation(z.tileID,S,A,B))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,l=this.meshSize,h=c.X/l,y=l*l;for(let z=0;z<=l;z++)for(let B=0;B<=l;B++)n.emplaceBack(B*h,z*h,0);for(let z=0;z<y;z+=l+1)for(let B=0;B<l;B++)a.emplaceBack(B+z,l+B+z+1,l+B+z+2),a.emplaceBack(B+z,l+B+z+2,B+z+1);const b=n.length,S=b+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const Z of[0,1])n.emplaceBack(B*h,z*c.X,Z);for(let z=0;z<2*l;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(b+z,b+z+3,b+z+1),a.emplaceBack(b+z,b+z+2,b+z+3);const A=n.length,M=A+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const Z of[0,1])n.emplaceBack(z*c.X,B*h,Z);for(let z=0;z<2*l;z+=2)a.emplaceBack(A+z,A+z+1,A+z+3),a.emplaceBack(A+z,A+z+3,A+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new ll(e.createVertexBuffer(n,Su.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),l=(1<<n)*c.X,h=a.x*l,y=a.y*l,b=Math.floor(h/c.X),S=Math.floor(y/c.X);return{tileID:new c.S(n,0,n,b,S),mercatorX:h,mercatorY:y}}}class a_{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new dt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const So={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class cf{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new a_(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const h of l){const y=this.terrain.sourceCache.getTerrainCoords(h);for(const b in y)this._coordsDescendingInv[a][b]||(this._coordsDescendingInv[a][b]=[]),this._coordsDescendingInv[a][b].push(y[b])}}this._coordsDescendingInvStr={};for(const a of e._order){const l=e._layers[a],h=l.source;if(So[l.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const y in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][y]=this._coordsDescendingInv[h][y].map(b=>b.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[l][a.tileID.key];h&&h!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(So[n]&&(this._prevType&&So[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!l))return!0;if(So[this._prevType]||So[n]&&l){this._prevType=n;const h=this._stacks.length-1,y=this._stacks[h]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(ef(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[h]){const A=this.pool.getObjectForId(b.rtt[h].id);if(A.stamp===b.rtt[h].stamp){this.pool.useObject(A);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),b.rtt[h]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let A=0;A<y.length;A++){const M=a.style._layers[y[A]],z=M.source?this._coordsDescendingInv[M.source][b.tileID.key]:[b.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(b.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][b.tileID.key])}}return ef(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),So[n]}return!1}}const Tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},uf=U,l_={hash:!1,interactive:!0,bearingSnap:7,attributionControl:bo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Iu=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},c_={showCompass:!0,showZoom:!0,visualizePitch:!1};class u_{constructor(e,n,a=!1){this.mousedown=y=>{this.startMouse(c.e({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),V.mousePos(this.element,y)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.moveMouse(y,V.mousePos(this.element,y))},this.mouseup=y=>{this.mouseRotate.dragEnd(y),this.mousePitch&&this.mousePitch.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.startTouch(y,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.moveTouch(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=pu({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:y,clickTolerance:b,bearingDegreesPerPixelMoved:S=.8})=>{const A=new du;return new Qn({clickTolerance:b,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:A,enable:y,assignEvents:Iu})})({clickTolerance:l,enable:!0}),this.map=e,a&&(this.mousePitch=fu({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:y,clickTolerance:b,pitchDegreesPerPixelMoved:S=-.5})=>{const A=new du;return new Qn({clickTolerance:b,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:A,enable:y,assignEvents:Iu})})({clickTolerance:h,enable:!0})),V.addEventListener(n,"mousedown",this.mousedown),V.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),V.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),V.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let un;function Li(d,e,n){const a=new c.N(d.lng,d.lat);if(d=new c.N(d.lng,d.lat),e){const l=new c.N(d.lng-360,d.lat),h=new c.N(d.lng+360,d.lat),y=n.locationPoint(d).distSqr(e);n.locationPoint(l).distSqr(e)<y?d=l:n.locationPoint(h).distSqr(e)<y&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){const l=n.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==a.lng&&n.locationPoint(d).y>n.height/2-n.getHorizon()?d:a}const Po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vl(d,e,n){const a=d.classList;for(const l in Po)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${e}`)}class xl extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Li(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Po[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${h}`),j.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const n=V.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const h=V.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const y=V.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of S){const le=V.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",se.rx),le.setAttributeNS(null,"ry",se.ry),b.appendChild(le)}const A=V.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(M);const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const B=V.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(B);const Z=V.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const H=V.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=V.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const re=V.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),H.appendChild(Q),H.appendChild(re),y.appendChild(b),y.appendChild(A),y.appendChild(z),y.appendChild(Z),y.appendChild(H),n.appendChild(y),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),vl(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,h=l.terrain.depthAtPoint(this._pos),y=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,y)-h<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/l.transform._pixelPerMeter,S=Math.sin(l.getPitch()*Math.PI/180)*b,A=l.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=l.transform.lngLatToCameraDepth(this._lngLat,y+S)-A>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const hf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ba=0,wa=!1;const Gn={maxWidth:100,unit:"metric"};function Sa(d,e,n){const a=n&&n.maxWidth||100,l=d._container.clientHeight/2,h=d.unproject([0,l]),y=d.unproject([a,l]),b=h.distanceTo(y);if(n&&n.unit==="imperial"){const S=3.2808*b;S>5280?vt(e,a,S/5280,d._getUIString("ScaleControl.Miles")):vt(e,a,S,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?vt(e,a,b/1852,d._getUIString("ScaleControl.NauticalMiles")):b>=1e3?vt(e,a,b/1e3,d._getUIString("ScaleControl.Kilometers")):vt(e,a,b,d._getUIString("ScaleControl.Meters"))}function vt(d,e,n,a){const l=function(h){const y=Math.pow(10,`${Math.floor(h)}`.length-1);let b=h/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A}(b),y*b}(n);d.style.width=e*(l/n)+"px",d.innerHTML=`${l}&nbsp;${a}`}const Lt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},bl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wl(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){const e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return wl(new c.P(0,0))}const Cu=U;w.AJAXError=c.bh,w.Evented=c.E,w.LngLat=c.N,w.MercatorCoordinate=c.Z,w.Point=c.P,w.addProtocol=c.bi,w.config=c.a,w.removeProtocol=c.bj,w.AttributionControl=wo,w.BoxZoomHandler=cn,w.CanvasSource=ir,w.CooperativeGesturesHandler=xo,w.DoubleClickZoomHandler=Vs,w.DragPanHandler=of,w.DragRotateHandler=af,w.EdgeInsets=go,w.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=Ki,w.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),h=c.e({bearing:l},this.options.fitBoundsOptions),y=ye.fromLngLat(n,a);this._map.fitBounds(y,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&wa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},hf,d)}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(un!==void 0&&!e)return un;if(window.navigator.permissions===void 0)return un=!!window.navigator.geolocation,un;try{un=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{un=!!window.navigator.geolocation}return un})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ba=0,wa=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),a=e.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ba--,wa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ba++,ba>1?(d={maximumAge:6e5,timeout:0},wa=!0):(d=this.options.positionOptions,wa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=ul,w.ImageSource=tr,w.KeyboardHandler=yn,w.LngLatBounds=ye,w.LogoControl=wu,w.Map=class extends lf{constructor(d){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},l_),d);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _o(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new si,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Tu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ke.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ne(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=ga(l=>{this._trackResize&&!this._removed&&(this.resize(l),this.redraw())},50);this._resizeObserver=new ResizeObserver(l=>{n?a(l):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new bu(this,e),this._hash=e.hash&&new ul(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new wo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new wu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,a)}resize(d){var e;const n=this._containerDimensions(),a=n[0],l=n[1],h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const S=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,S),this.painter.resize(a,l,S)}this.transform.resize(a,l),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l);const y=!this._moving;return y&&(this.stop(),this.fire(new c.k("movestart",d)).fire(new c.k("move",d))),this.fire(new c.k("resize",d)),y&&this.fire(new c.k("moveend",d)),this}_getClampedPixelRatio(d,e){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),h=d*l,y=e*l;return Math.min(h>n?n/h:1,y>a?a/y:1)*l}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ye.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(c.N.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const y=e.filter(S=>this.getLayer(S)),b=y.length!==0?this.queryRenderedFeatures(h.point,{layers:y}):[];b.length?a||(a=!0,n.call(this,new Mr(d,this,h.originalEvent,{features:b}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const b=e.filter(S=>this.getLayer(S));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?a=!0:a&&(a=!1,n.call(this,new Mr(d,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,n.call(this,new Mr(d,this,y.originalEvent)))}}}}{const a=l=>{const h=e.filter(b=>this.getLayer(b)),y=h.length!==0?this.queryRenderedFeatures(l.point,{layers:h}):[];y.length&&(l.features=y,n.call(this,l),delete l.features)};return{layers:e,listener:n,delegates:{[d]:a}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const a=this._delegatedListeners[d];for(let l=0;l<a.length;l++){const h=a[l];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(y=>e.includes(y))){for(const y in h.delegates)this.off(y,h.delegates[y]);return void a.splice(l,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);const a=this._createDelegatedListener(d,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(d,a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(d,e,n){if(n===void 0)return super.once(d,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(d,a,n);for(const h in l.delegates){const y=l.delegates[h];l.delegates[h]=(...b)=>{this._removeDelegatedListener(d,a,n),y(...b)}}this._saveDelegatedListener(d,l);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n;const a=d instanceof c.P||Array.isArray(d),l=a?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:d)||{},l instanceof c.P||typeof l[0]=="number")n=[c.P.convert(l)];else{const h=c.P.convert(l[0]),y=c.P.convert(l[1]);n=[h,new c.P(y.x,h.y),y,new c.P(h.x,y.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Ha(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,n):this.style.loadJSON(d,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pu(this.painter,e,d),this.painter.renderToTexture=new cf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const n=d[e]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:A}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:B}=e,Z=e;return this.style.addImage(d,{data:new c.R({width:M,height:z},new Uint8Array(B)),pixelRatio:a,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:A,sdf:l,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,d),this}}{const{width:M,height:z,data:B}=j.getImageData(e);this.style.addImage(d,{data:new c.R({width:M,height:z},B),pixelRatio:a,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:A,sdf:l,version:0})}}updateImage(d,e){const n=this.style.getImage(d);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?j.getImageData(e):e,{width:l,height:h,data:y}=a;if(l===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,b),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return ke.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,a={}){return this.style.setPaintProperty(d,e,n,a),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,a={}){return this.style.setLayoutProperty(d,e,n,a),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,a=>{a||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d){return this._lazyInitEmptyStyle(),this.style.setSky(d),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=V.create("div","maplibregl-control-container",d),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{h[y]=V.create("div",`maplibregl-ctrl-${y} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:d},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new cl(n,this.transform),ne.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,h=j.now();this.style.zoomHistory.update(l,h);const y=new c.z(l,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=y.crossFadingFactor();b===1&&b===this._crossFadingFactor||(n=!0,this._crossFadingFactor=b),this.style.update(y)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ke.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(d=>{c.bf.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return uf}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Mr,w.MapTouchEvent=Bs,w.MapWheelEvent=rf,w.Marker=xl,w.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},c_,d),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new u_(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const n=V.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},w.Popup=class extends c.E{constructor(d){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Li(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const h=wl(this.options.offset);if(!l){const b=this._container.offsetWidth,S=this._container.offsetHeight;let A;A=a.y+h.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<b/2?A.push("left"):a.x>this._map.transform.width-b/2&&A.push("right"),l=A.length===0?"bottom":A.join("-")}let y=a.add(h[l]);this.options.subpixelPositioning||(y=y.round()),V.setTransform(this._container,`${Po[l]} translate(${y.x}px,${y.y}px)`),vl(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Lt),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.N.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=d;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(bl);d&&d.focus()}},w.RasterDEMTileSource=vi,w.RasterTileSource=Ht,w.ScaleControl=class{constructor(d){this._onMove=()=>{Sa(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Sa(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Gn),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=kn,w.Style=Ha,w.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=vo,w.TwoFingersTouchRotateHandler=yu,w.TwoFingersTouchZoomHandler=gu,w.TwoFingersTouchZoomRotateHandler=xu,w.VectorTileSource=sn,w.VideoSource=ar,w.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(Er(d))throw new Error(`A source type called "${d}" already exists.`);((n,a)=>{hr[n]=a})(d,e)}),w.clearPrewarmedResources=function(){const d=yi;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(li),yi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return kr().getRTLTextPluginStatus()},w.getVersion=function(){return Cu},w.getWorkerCount=function(){return Si.workerCount},w.getWorkerUrl=function(){return c.a.WORKER_URL},w.importScriptInWorkers=function(d){return Zi().broadcast("IS",d)},w.prewarm=function(){Ui().acquire(li)},w.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},w.setRTLTextPlugin=function(d,e){return kr().setRTLTextPlugin(d,e)},w.setWorkerCount=function(d){Si.workerCount=d},w.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var E=g;return E})}(Zf)),Zf.exports}var pE=dE();const Bc=eb(pE);var kc,xp,Yo,Ua,sa,Ey,ky;class fE{constructor(o,g){X(this,sa);X(this,kc,Ye());X(this,xp);X(this,Yo,0);X(this,Ua,null);I(this,kc).v=Ze(o),qe(this,xp,g)}get current(){return D0()?Pt(()=>(Hu(this,Yo)._++,I(this,Yo)===1&&Zr(this,sa,Ey).call(this,!0),()=>{Mg().then(()=>{Hu(this,Yo)._--,I(this,Yo)===0&&Zr(this,sa,ky).call(this)})})):I(this,Yo)===0&&(Zr(this,sa,Ey).call(this,!1),Zr(this,sa,ky).call(this)),R(I(this,kc))}}kc=new WeakMap,xp=new WeakMap,Yo=new WeakMap,Ua=new WeakMap,sa=new WeakSet,Ey=function(o){qe(this,Ua,I(this,xp).call(this,g=>{Oe(I(this,kc),Ze(g))},o)??null)},ky=function(){I(this,Ua)!==null&&(I(this,Ua).call(this),qe(this,Ua,null))};new fE(null,(f,o)=>{function g(){f(document.activeElement)}if(g(),!!o)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function mE(f,o,g,v){const T=Array.isArray(o)?o:[o];for(const E of T)f.addEventListener(E,g,v);return()=>{for(const E of T)f.removeEventListener(E,g,v)}}function I0({key:f,storage:o,serializer:g}){if(!o)return{found:!1,value:null};const v=o.getItem(f);if(v===null)return{found:!1,value:null};try{return{found:!0,value:g.deserialize(v)}}catch(T){return console.error(`Error when parsing ${v} from persisted store "${f}"`,T),{found:!1,value:null}}}function gE({key:f,value:o,storage:g,serializer:v}){if(g)try{g.setItem(f,v.serialize(o))}catch(T){console.error(`Error when writing value from persisted store "${f}" to ${g}`,T)}}function _E(f){return typeof window>"u"?null:{local:localStorage,session:sessionStorage}[f]}var $o,Qo,ea,qa,Eg,Zb;class yE{constructor(o,g,v={}){X(this,Eg);X(this,$o,Ye());X(this,Qo);X(this,ea);X(this,qa);const{storage:T="local",serializer:E={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:w=!0}=v;qe(this,Qo,o),qe(this,ea,_E(T)),qe(this,qa,E);const c=I0({key:I(this,Qo),storage:I(this,ea),serializer:I(this,qa)});I(this,$o).v=Ze(c.found?c.value:g),Pt(()=>{gE({key:I(this,Qo),value:R(I(this,$o)),storage:I(this,ea),serializer:I(this,qa)})}),Pt(()=>{if(w)return mE(window,"storage",Zr(this,Eg,Zb).bind(this))})}get current(){return R(I(this,$o))}set current(o){Oe(I(this,$o),Ze(o))}}$o=new WeakMap,Qo=new WeakMap,ea=new WeakMap,qa=new WeakMap,Eg=new WeakSet,Zb=function(o){if(o.key!==I(this,Qo)||!I(this,ea))return;const g=I0({key:I(this,Qo),storage:I(this,ea),serializer:I(this,qa)});g.found&&Oe(I(this,$o),Ze(g.value))};var bp;class C0{constructor(o){X(this,bp,Ye());this.value=o}get value(){return R(I(this,bp))}set value(o){Oe(I(this,bp),Ze(o))}}bp=new WeakMap;var wp,Sp,Pp,Tp;class vE{constructor(){X(this,wp,Ye());X(this,Sp,Ye(!1));Ue(this,"loadedImages",new Sy);X(this,Pp,Ye(0));X(this,Tp,Ye(24));Ue(this,"layerInfo",new Map);Ue(this,"eventTracker",new WeakMap);Ue(this,"eventTopMost");Ue(this,"markerClickManager",new IE);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return R(I(this,wp))}set map(o){Oe(I(this,wp),Ze(o))}get loaded(){return R(I(this,Sp))}set loaded(o){Oe(I(this,Sp),Ze(o))}get minzoom(){return R(I(this,Pp))}set minzoom(o){Oe(I(this,Pp),Ze(o))}get maxzoom(){return R(I(this,Tp))}set maxzoom(o){Oe(I(this,Tp),Ze(o))}_eventTopMost(o){var E;let g=this.eventTracker.get(o.originalEvent);if(g!==void 0)return g;let T=(E=o.target.queryRenderedFeatures(o.point).find(w=>{var c;return(c=this.layerInfo.get(w.layer.id))==null?void 0:c.interactive}))==null?void 0:E.layer.id;return this.eventTracker.set(o.originalEvent,T),T}}wp=new WeakMap,Sp=new WeakMap,Pp=new WeakMap,Tp=new WeakMap;function xE(f){Ip(wE,f)}function bE(f){Ip(SE,f)}const Gb=Symbol.for("svelte-maplibre"),wE=Symbol.for("svelte-maplibre.popup-target"),SE=Symbol.for("svelte-maplibre.layer-event");function kp(){return zy(Gb)}function PE(){return Ip(Gb,new vE)}function TE(){const f=new C0(void 0),o=new C0(void 0);return xE(f),bE(o),{marker:f,layerEvent:o}}class IE{constructor(){Ue(this,"_handlers",new Set)}add(o){this._handlers.add(o)}remove(o){this._handlers.delete(o)}handleClick(o){for(const g of this._handlers)g(o)}}function CE(f){return Object.fromEntries(Object.entries(f).filter(([o,g])=>g!=null))}k0(["click"]);function AE(f,o){At(o,!0);const g=Pe(kp),v=Pe(()=>R(g).map),T=Pe(()=>R(g).loaded);let E=ee(o,"position",3,"top-left"),w=ee(o,"container",3,void 0),c=Ye(void 0),U=Pe(()=>typeof w()=="string"?document.querySelector(w())??void 0:w());Pt(()=>{R(U)&&!R(c)&&(Oe(c,Ze(new Bc.FullscreenControl({container:R(U)}))),R(v).addControl(R(c),E()))}),zg(()=>{R(T)&&R(c)&&R(v).removeControl(R(c))}),Et()}function EE(f,o){At(o,!0);const g=Pe(kp),v=Pe(()=>R(g).map),T=Pe(()=>R(g).loaded);let E=ee(o,"position",3,"top-left"),w=ee(o,"positionOptions",3,void 0),c=ee(o,"fitBoundsOptions",3,void 0),U=ee(o,"trackUserLocation",3,!1),W=ee(o,"showAccuracyCircle",3,!0),K=ee(o,"showUserLocation",3,!0),j=ee(o,"control",15);Pt(()=>{R(v)&&!j()&&(j(new Bc.GeolocateControl({positionOptions:w(),fitBoundsOptions:c(),trackUserLocation:U(),showAccuracyCircle:W(),showUserLocation:K()})),R(v).addControl(j(),E()))}),zg(()=>{R(T)&&j()&&R(v).removeControl(j())}),Et()}function kE(f){let o=f.getCenter(),g=Math.round(f.getZoom()*100)/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),E=Math.round(o.lat*T)/T,w=Math.round(o.lng*T)/T,c=`${g}/${E}/${w}`,U=f.getBearing(),W=f.getPitch();return(U||W)&&(c+=`/${Math.round(U*10)/10}`),W&&(c+=`/${Math.round(W)}`),`#${c}`}function ME(f){return f.replace("#","").split("/").map(parseFloat)}var jl=Yy;function Yy(f,o){return f===o||f!==f&&o!==o?!0:typeof f!=typeof o||{}.toString.call(f)!={}.toString.call(o)||f!==Object(f)||!f?!1:Array.isArray(f)?A0(f,o):{}.toString.call(f)=="[object Set]"?A0(Array.from(f),Array.from(o)):{}.toString.call(f)=="[object Object]"?DE(f,o):zE(f,o)}function zE(f,o){return f.toString()===o.toString()}function A0(f,o){var g=f.length;if(g!=o.length)return!1;for(var v=0;v<g;v++)if(!Yy(f[v],o[v]))return!1;return!0}function DE(f,o){var g=Object.keys(f),v=g.length;if(v!=Object.keys(o).length)return!1;for(var T=0;T<v;T++){var E=g[T];if(!(o.hasOwnProperty(E)&&Yy(f[E],o[E])))return!1}return!0}function RE(f,o){At(o,!0);const g=Pe(kp),v=Pe(()=>R(g).map),T=Pe(()=>R(g).loaded);let E=ee(o,"position",3,"top-left"),w=ee(o,"showCompass",3,!0),c=ee(o,"showZoom",3,!0),U=ee(o,"visualizePitch",3,!1),W=Ye(void 0);Pt(()=>{R(v)&&!R(W)&&(Oe(W,Ze(new Bc.NavigationControl({showCompass:w(),showZoom:c(),visualizePitch:U()}))),R(v).addControl(R(W),E()))}),zg(()=>{R(T)&&R(W)&&R(v).removeControl(R(W))}),Et()}function LE(f,o){At(o,!0);const g=Pe(kp),v=Pe(()=>R(g).map),T=Pe(()=>R(g).loaded);let E=ee(o,"position",3,"bottom-left"),w=ee(o,"maxWidth",3,void 0),c=ee(o,"unit",3,"metric"),U=Ye(void 0);Pt(()=>{R(v)&&!R(U)&&(Oe(U,Ze(new Bc.ScaleControl({maxWidth:w(),unit:c()}))),R(v).addControl(R(U),E()))}),zg(()=>{R(T)&&R(U)&&R(v).removeControl(R(U))}),Et()}var OE=Rt("<!> <!> <!> <!>",1),FE=Rt("<!> <!>",1),BE=Rt('<div data-testid="map-container"><!></div>');function NE(f,o){At(o,!0);let g=ee(o,"map",15,void 0),v=ee(o,"mapContainer",15,void 0),T=ee(o,"class",3,void 0),E=ee(o,"diffStyleUpdates",3,!1),w=ee(o,"center",15,void 0),c=ee(o,"zoom",15,void 0),U=ee(o,"pitch",15,0),W=ee(o,"bearing",15,0),K=ee(o,"bounds",15,void 0),j=ee(o,"hash",3,!1),V=ee(o,"updateHash",3,mt=>{window.history.replaceState(window.history.state,"",mt)}),ne=ee(o,"loaded",15,!1),oe=ee(o,"minZoom",3,0),ce=ee(o,"maxZoom",3,22),fe=ee(o,"minPitch",3,0),Ie=ee(o,"maxPitch",3,60),_e=ee(o,"renderWorldCopies",3,void 0),ke=ee(o,"dragPan",3,void 0),Ne=ee(o,"dragRotate",3,void 0),De=ee(o,"pitchWithRotate",3,void 0),Xe=ee(o,"antialias",3,void 0),it=ee(o,"zoomOnDoubleClick",3,!0),Ct=ee(o,"locale",3,void 0),Je=ee(o,"interactive",3,!0),St=ee(o,"attributionControl",3,void 0),dt=ee(o,"cooperativeGestures",3,!1),Ge=ee(o,"preserveDrawingBuffer",3,!1),Fe=ee(o,"maxBounds",3,void 0),Ee=ee(o,"images",19,()=>[]),Le=ee(o,"standardControls",3,!1),Ke=ee(o,"filterLayers",3,void 0),pt=ee(o,"transformRequest",3,void 0),yt=Pe(()=>typeof Le()=="boolean"?void 0:Le());const lt=PE();let ut=Ye(Ze(new Set));async function Ft(mt,kt=!1){var ye;if(g()&&!(!((ye=g())!=null&&ye.loaded())&&!kt))if("url"in mt){R(ut).add(mt.id);try{let Ri=await g().loadImage(mt.url);g().addImage(mt.id,Ri.data,mt.options),lt.loadedImages.add(mt.id)}catch(Ri){o.onerror?o.onerror({error:Ri}):console.error(Ri)}finally{R(ut).delete(mt.id)}}else g().addImage(mt.id,mt.data,mt.options),lt.loadedImages.add(mt.id)}Pt(()=>{var mt;if(ne()&&((mt=g())!=null&&mt.loaded()))for(let kt of Ee())!lt.loadedImages.has(kt.id)&&!R(ut).has(kt.id)&&!g().hasImage(kt.id)&&Ft(kt)});let qt=Pe(()=>Ee().every(mt=>lt.loadedImages.has(mt.id))),fi=Ye(void 0),li=Ye(void 0),Si=Ye(void 0),_i=Ye(void 0);function yi(mt){o.onerror?o.onerror(mt):mt.error.name!=="AbortError"&&console.error(mt.error)}function Pi(mt){return qi(),g(lt.map=new Bc.Map(CE({container:mt,style:o.style,locale:Ct(),center:w(),zoom:c(),pitch:U(),bearing:W(),minZoom:oe(),maxZoom:ce(),minPitch:fe(),maxPitch:Ie(),renderWorldCopies:_e(),dragPan:ke(),dragRotate:Ne(),pitchWithRotate:De(),antialias:Xe(),interactive:Je(),preserveDrawingBuffer:Ge(),maxBounds:Fe(),bounds:K(),attributionControl:St(),transformRequest:pt(),cooperativeGestures:dt()}))),g().on("load",kt=>{kt.target.getContainer().setAttribute("data-testid","map"),kt.target.getCanvas().setAttribute("data-testid","map-canvas"),o.onload&&o.onload(g()),lt.loaded=!0,ne(!0)}),g().on("error",yi),o.onmovestart&&g().on("movestart",o.onmovestart),g().on("moveend",kt=>{var ye;if(w(kt.target.getCenter()),c(kt.target.getZoom()),U(kt.target.getPitch()),W(kt.target.getBearing()),K(kt.target.getBounds()),(ye=o.onmoveend)==null||ye.call(o,kt),j()){let Ri=new URL(window.location.href.replace(/(#.+)?$/,kE(kt.target)));V()(Ri)}}),o.onclick&&g().on("click",o.onclick),o.ondblclick&&g().on("dblclick",o.ondblclick),o.oncontextmenu&&g().on("contextmenu",o.oncontextmenu),o.onmousemove&&g().on("mousemove",o.onmousemove),o.onzoomstart&&g().on("zoomstart",o.onzoomstart),o.onzoom&&g().on("zoom",o.onzoom),o.onzoomend&&g().on("zoomend",o.onzoomend),o.onpitch&&g().on("pitch",o.onpitch),o.onrotate&&g().on("rotate",o.onrotate),o.onwheel&&g().on("wheel",o.onwheel),o.ondata&&g().on("data",o.ondata),o.onidle&&g().on("idle",o.onidle),g().on("style.load",()=>{if(g()){const kt=g().getStyle();if(Oe(fi,Ze(kt.layers.map(ye=>ye.id))),Oe(li,Ze(Object.keys(kt.sources))),R(_i))for(const[ye,Ri]of Object.entries(R(_i)))g().addSource(ye,Ri);if(R(Si))for(const ye of R(Si))g().addLayer(ye);for(const ye of Ee())Ft(ye,!0)}}),g().on("styledata",kt=>{var ye;if(g()&&Ke()){const Ri=g().getStyle().layers;if(Ri)for(let sn of Ri)Ke()(sn)||g().setLayoutProperty(sn.id,"visibility","none")}(ye=o.onstyledata)==null||ye.call(o,kt)}),{destroy(){var kt;ne(!1),lt.loaded=!1,(kt=g())==null||kt.remove()}}}let Ui=Ye(Ze(o.style));Pt(()=>{if(g()&&!jl(o.style,R(Ui))){const mt=g().getStyle();if(R(fi)&&Oe(Si,Ze(mt.layers.filter(kt=>!R(fi).includes(kt.id)))),R(li)){const kt=Object.keys(mt.sources).filter(ye=>!R(li).includes(ye));Oe(_i,Ze({}));for(const ye of kt)R(_i)[ye]=mt.sources[ye]}Oe(Ui,Ze(o.style)),g().setStyle(o.style,{diff:E()}),lt.loadedImages.clear(),Oe(ut,Ze(new Set))}}),Pt(()=>{if(g()){let mt={};w()!=null&&!jl(w(),g().getCenter())&&(mt.center=w()),c()!=null&&!jl(c(),g().getZoom())&&(mt.zoom=c()),W()!=null&&!jl(W(),g().getBearing())&&(mt.bearing=W()),U()!=null&&!jl(U(),g().getPitch())&&(mt.pitch=U()),Object.keys(mt).length&&g().easeTo(mt)}}),Pt(()=>{var mt,kt;K()&&!jl(K(),(mt=g())==null?void 0:mt.getBounds())&&((kt=g())==null||kt.fitBounds(K()))}),Pt(()=>{var mt,kt;it()?(mt=g())==null||mt.doubleClickZoom.enable():(kt=g())==null||kt.doubleClickZoom.disable()});function qi(){if(j()){let mt=ME(window.location.hash);mt.length>=3&&(c(mt[0]),w([mt[2],mt[1]])),mt.length==5&&(W(mt[3]),U(mt[4]))}}var Zi=BE();my("hashchange",d2,qi);var Xi=Kt(Zi);{var Ei=mt=>{var kt=FE(),ye=Be(kt);{var Ri=Ht=>{var vi=OE(),Ki=Be(vi);RE(Ki,{get position(){return R(yt)}});var xi=ni(Ki,2);EE(xi,{get position(){return R(yt)},fitBoundsOptions:{maxZoom:12}});var tr=ni(xi,2);AE(tr,{get position(){return R(yt)}});var ar=ni(tr,2);LE(ar,{get position(){return R(yt)}}),we(Ht,vi)};gi(ye,Ht=>{Le()&&Ht(Ri)})}var sn=ni(ye,2);Ot(sn,()=>o.children??ei,()=>({map:g(),loadedImages:lt.loadedImages,allImagesLoaded:R(qt)})),we(mt,kt)};gi(Xi,mt=>{g()&&ne()&&mt(Ei)})}Wt(Zi),Is(Zi,mt=>v(mt),()=>v()),gy(Zi,mt=>Pi==null?void 0:Pi(mt)),$t(()=>{B0(Zi,`${T()??""} svelte-p00lfq`),P2(Zi,"expand-map",!T())}),we(f,Zi),Et()}function VE(f,o){f.key===" "&&(f.preventDefault(),f.stopPropagation(),o("click"))}var jE=(f,o)=>{f.stopPropagation(),o("click")},UE=(f,o)=>{f.stopPropagation(),o("dblclick")},qE=(f,o)=>{f.stopPropagation(),f.preventDefault(),o("contextmenu")},ZE=(f,o)=>o("mousemove"),GE=Rt("<div><!></div>");function WE(f,o){At(o,!0);let g=ee(o,"marker",15,void 0),v=ee(o,"lngLat",15),T=ee(o,"class",3,void 0),E=ee(o,"interactive",3,!0),w=ee(o,"asButton",3,!1),c=ee(o,"draggable",3,!1),U=ee(o,"feature",3,void 0),W=ee(o,"offset",3,void 0),K=ee(o,"zIndex",3,void 0),j=ee(o,"rotation",3,0),V=ee(o,"opacity",3,1),ne=Jt(o,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const oe=Pe(kp),ce=Pe(()=>R(oe).map),fe=Pe(()=>R(oe).markerClickManager),{layerEvent:Ie,marker:_e}=TE();function ke(Je){_e.value=new Bc.Marker({element:Je,rotation:j(),draggable:c(),offset:W(),opacity:V().toString()}).setLngLat(v()).addTo(R(ce)),g(_e.value);const St=()=>Xe("dragstart"),dt=()=>{De(),Xe("drag")},Ge=()=>{De(),Xe("dragend")};return c()&&(_e.value.on("dragstart",St),_e.value.on("drag",dt),_e.value.on("dragend",Ge)),{destroy(){var Fe,Ee,Le,Ke;c()&&((Fe=_e.value)==null||Fe.off("dragstart",St),(Ee=_e.value)==null||Ee.off("drag",dt),(Le=_e.value)==null||Le.off("dragend",Ge)),g(void 0),(Ke=_e.value)==null||Ke.remove()}}}function Ne(Je,St){const dt=Je.className;function Ge(Fe){Fe?Je.className=`${dt} ${Fe}`:Je.className=dt}return Ge(St),{update:Ge}}Pt(()=>{var Je;(Je=_e.value)==null||Je.setLngLat(v())}),Pt(()=>{var Je;(Je=_e.value)==null||Je.setOffset(W()??[0,0])}),Pt(()=>{var Je;(Je=_e.value)==null||Je.setRotation(j())}),Pt(()=>{var Je;(Je=_e.value)==null||Je.setOpacity(V().toString())});function De(){var St;let Je=(St=_e.value)==null?void 0:St.getLngLat();Je&&(Array.isArray(v())?v([Je.lng,Je.lat]):v()&&"lon"in v()?v({lon:Je.lng,lat:Je.lat}):v(Je))}function Xe(Je){var Ee,Le;if(!E())return;let St=(Ee=_e.value)==null?void 0:Ee.getLngLat();if(!St)return;const dt=[St.lng,St.lat];let Ge={map:R(ce),marker:_e.value,lngLat:dt,features:[{type:"Feature",properties:((Le=U())==null?void 0:Le.properties)??{},geometry:{type:"Point",coordinates:dt}}]};(Je==="click"||Je==="contextmenu")&&R(fe).handleClick(Ge),Ie.value={...Ge,layerType:"marker",type:Je};const Fe=ne["on"+Je];Fe==null||Fe(Ge)}var it=GE();it.__click=[jE,Xe],it.__dblclick=[UE,Xe],it.__contextmenu=[qE,Xe],it.__mousemove=[ZE,Xe],it.__keydown=[VE,Xe];var Ct=Kt(it);Ot(Ct,()=>o.children??ei,()=>({marker:_e.value})),Wt(it),gy(it,Je=>ke==null?void 0:ke(Je)),gy(it,(Je,St)=>Ne==null?void 0:Ne(Je,St),T),$t(()=>{Gf(it,"tabindex",w()?0:void 0),Gf(it,"role",w()?"button":void 0),T2(it,"z-index",K())}),my("mouseenter",it,()=>{Xe("mouseenter")}),my("mouseleave",it,()=>{Xe("mouseleave")}),we(f,it),Et()}k0(["click","dblclick","contextmenu","mousemove","keydown"]);var Mp=Uint8Array,Wb=Uint16Array,HE=Int32Array,XE=new Mp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),KE=new Mp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Hb=function(f,o){for(var g=new Wb(31),v=0;v<31;++v)g[v]=o+=1<<f[v-1];for(var T=new HE(g[30]),v=1;v<30;++v)for(var E=g[v];E<g[v+1];++E)T[E]=E-g[v]<<5|v;return{b:g,r:T}},Xb=Hb(XE,2),JE=Xb.b,YE=Xb.r;JE[28]=258,YE[258]=28;Hb(KE,0);var $E=new Wb(32768);for(Ai=0;Ai<32768;++Ai)Hs=(Ai&43690)>>1|(Ai&21845)<<1,Hs=(Hs&52428)>>2|(Hs&13107)<<2,Hs=(Hs&61680)>>4|(Hs&3855)<<4,$E[Ai]=((Hs&65280)>>8|(Hs&255)<<8)>>1;var Hs,Ai,Bg=new Mp(288);for(Ai=0;Ai<144;++Ai)Bg[Ai]=8;var Ai;for(Ai=144;Ai<256;++Ai)Bg[Ai]=9;var Ai;for(Ai=256;Ai<280;++Ai)Bg[Ai]=7;var Ai;for(Ai=280;Ai<288;++Ai)Bg[Ai]=8;var Ai,QE=new Mp(32);for(Ai=0;Ai<32;++Ai)QE[Ai]=5;var Ai,ek=new Mp(0),tk=typeof TextDecoder<"u"&&new TextDecoder,ik=0;try{tk.decode(ek,{stream:!0}),ik=1}catch{}var rk=Rt('<div class="group flex h-16 w-16 cursor-pointer items-center justify-center"><div>&nbsp;</div></div>'),nk=Rt(" <!>",1),sk=Rt("<!> ",1),ok=Rt("<!> <!>",1),ak=Rt("<!> <!>",1),lk=Rt("<!> <!>",1),ck=Rt('<!> <!> <span class="sr-only">Toggle theme</span>',1),uk=Rt("<!> <!>",1),hk=Rt('<div class="flex flex-col gap-y-2"><!> <!> <!></div>'),dk=Rt("<!> <!>",1),pk=Rt("<!> <!>",1),fk=Rt('<li class="flex gap-x-1 ps-1"><!> <span> </span></li>'),mk=Rt('<ul class="mb-3"><h2 class="mb-1 font-semibold">Included Amenities</h2> <!></ul>'),gk=Rt("<span>Always open!</span>"),_k=Rt("<span> </span>"),yk=Rt("<span>Closed</span>"),vk=Rt('<li class="flex justify-between gap-x-1"><span class="first-letter:uppercase"> </span> <!></li>'),xk=Rt("<ul></ul>"),bk=Rt('<div class="mx-auto w-full max-w-md px-4 pb-6 md:px-0"><!> <p class="mb-3"> </p> <!> <div class="mb-3"><h2 class="font-semibold">Directions</h2> <a class="flex gap-x-1 hover:underline" target="_blank" rel="noopener noreferrer"><span>Google Maps</span> <!></a></div> <div><h2 class="font-semibold">Hours</h2> <!></div></div>'),wk=Rt('<!> <div class="absolute left-1/2 top-2.5 z-10 -translate-x-1/2"><!></div> <!> <!> <!>',1);function Ok(f,o){At(o,!0);const g=_2(),v=()=>v2(g2,"$mode",g);let T=Ye(!1),E=Ye(null);const w=new yE("count",""),c=Pe(()=>P0.find(Le=>Le.value===w.current));let U=Ye(null);const W=`https://api.maptiler.com/maps/topo-v2/style.json?key=${Ux}`,K=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${Ux}`,j=Pe(()=>v()==="dark"?K:W);let V=Ye(!1),ne=Ye(void 0);const oe=Pe(()=>Kx(R(ne)));function ce(Le){Oe(V,!0),Oe(ne,Ze(Le))}function fe(){Oe(T,!1),Mg().then(()=>{R(E).focus()})}function Ie(Le){var Ke;return Le===void 0?"":((Ke=Le.metadata)==null?void 0:Ke.link)??`https://www.google.com/maps?q=${Le.location.lat},${Le.location.lng}`}const _e={Open:"bg-green-400 hover:bg-green-500",Closed:"bg-red-400 hover:bg-red-500","Opening Soon":"bg-yellow-400 hover:bg-yellow-500","Closing Soon":"bg-yellow-400 hover:bg-yellow-500"},ke={Open:"bg-green-400 shadow-green-400 group-hover:bg-green-500 group-hover:shadow-green-500",Closed:"bg-red-400 shadow-red-400 group-hover:bg-red-500 group-hover:shadow-red-500","Opening Soon":"from-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500","Closing Soon":"from-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500"};Pt(()=>{var Le;if(R(c)){const Ke=(Le=R(c).metadata)==null?void 0:Le.display;R(U).jumpTo({center:R(c).location,zoom:(Ke==null?void 0:Ke.zoom)??16,pitch:(Ke==null?void 0:Ke.pitch)??60,bearing:(Ke==null?void 0:Ke.bearing)??0})}});const Ne=Cp(),[De,Xe]=Ne;var it=wk();y2(Le=>{p2.title="Campus Study Spots"});var Ct=Be(it);NE(Ct,{get map(){return R(U)},set map(Le){Oe(U,Ze(Le))},get style(){return R(j)},class:"min-h-screen",standardControls:!0,children:(Le,Ke)=>{var pt=tt(),yt=Be(pt);{var lt=ut=>{var Ft=tt(),qt=Be(Ft);eh(qt,17,()=>R(c).spaces,th,(fi,li)=>{WE(fi,{get lngLat(){return R(li).location},class:"cursor-pointer",onclick:()=>ce(R(li)),children:(Si,_i)=>{var yi=rk(),Pi=Kt(yi);const Ui=Pe(()=>Di(ke[Kx(R(li))],"h-2 w-2 rounded-full shadow-3xl"));Wt(yi),$t(()=>B0(Pi,R(Ui))),we(Si,yi)},$$slots:{default:!0}})}),we(ut,Ft)};gi(yt,ut=>{R(c)&&ut(lt)})}we(Le,pt)},$$slots:{default:!0}});var Je=ni(Ct,2),St=Kt(Je);ai(St,()=>aE,(Le,Ke)=>{Ke(Le,{get open(){return R(T)},set open(pt){Oe(T,Ze(pt))},children:(pt,yt)=>{var lt=lk(),ut=Be(lt);ai(ut,()=>lE,(qt,fi)=>{fi(qt,{get ref(){return R(E)},set ref(Si){Oe(E,Ze(Si))},child:(Si,_i)=>{Yx(Si,Qt({variant:"outline",class:"w-52 justify-between"},()=>_i==null?void 0:_i().props,{role:"combobox",get"aria-expanded"(){return R(T)},children:(Pi,Ui)=>{Kn();var qi=nk(),Zi=Be(qi),Xi=ni(Zi);M2(Xi,{class:"opacity-50"}),$t(()=>{var Ei;return _s(Zi,`${(((Ei=R(c))==null?void 0:Ei.label)||"Select a campus...")??""} `)}),we(Pi,qi)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var Ft=ni(ut,2);ai(Ft,()=>oE,(qt,fi)=>{fi(qt,{class:"w-52 p-0",children:(li,Si)=>{var _i=tt(),yi=Be(_i);ai(yi,()=>oA,(Pi,Ui)=>{Ui(Pi,{children:(qi,Zi)=>{var Xi=ak(),Ei=Be(Xi);ai(Ei,()=>hA,(kt,ye)=>{ye(kt,{placeholder:"Search campuses..."})});var mt=ni(Ei,2);ai(mt,()=>pA,(kt,ye)=>{ye(kt,{children:(Ri,sn)=>{var Ht=ok(),vi=Be(Ht);ai(vi,()=>aA,(xi,tr)=>{tr(xi,{children:(ar,ir)=>{Kn();var hr=gs("No campus found.");we(ar,hr)},$$slots:{default:!0}})});var Ki=ni(vi,2);ai(Ki,()=>cA,(xi,tr)=>{tr(xi,{children:(ar,ir)=>{var hr=tt(),Er=Be(hr);eh(Er,17,()=>P0,th,(Ve,Ji)=>{var Wi=tt(),kr=Be(Wi);ai(kr,()=>dA,(wr,We)=>{We(wr,{get value(){return R(Ji).value},onSelect:()=>{w.current=R(Ji).value,fe()},children:(Bt,Mt)=>{var dr=sk(),Xr=Be(dr),Ut=Pe(()=>Di("ml-auto",w.current!==R(Ji).value&&"text-transparent"));k2(Xr,{get class(){return R(Ut)}});var mn=ni(Xr);$t(()=>_s(mn,` ${R(Ji).label??""}`)),we(Bt,dr)},$$slots:{default:!0}})}),we(Ve,Wi)}),we(ar,hr)},$$slots:{default:!0}})}),we(Ri,Ht)},$$slots:{default:!0}})}),we(qi,Xi)},$$slots:{default:!0}})}),we(li,_i)},$$slots:{default:!0}})}),we(pt,lt)},$$slots:{default:!0}})}),Wt(Je);var dt=ni(Je,2);Yx(dt,{class:"absolute right-2.5 top-2.5 z-10",onclick:m2,variant:"outline",size:"icon",children:(Le,Ke)=>{var pt=ck(),yt=Be(pt);V2(yt,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var lt=ni(yt,2);O2(lt,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),Kn(2),we(Le,pt)},$$slots:{default:!0}});var Ge=ni(dt,2);ai(Ge,()=>LS,(Le,Ke)=>{Ke(Le,{class:"absolute bottom-10 left-2.5 z-10",children:(pt,yt)=>{var lt=dk(),ut=Be(lt);ai(ut,()=>MS,(qt,fi)=>{fi(qt,{children:(li,Si)=>{var _i=uk(),yi=Be(_i);ai(yi,()=>DS,(Ui,qi)=>{qi(Ui,{children:(Zi,Xi)=>{Kn();var Ei=gs("Legend");we(Zi,Ei)},$$slots:{default:!0}})});var Pi=ni(yi,2);ai(Pi,()=>ES,(Ui,qi)=>{qi(Ui,{children:(Zi,Xi)=>{Kn();var Ei=gs("Colors indicate open status of the spaces.");we(Zi,Ei)},$$slots:{default:!0}})}),we(li,_i)},$$slots:{default:!0}})});var Ft=ni(ut,2);ai(Ft,()=>CS,(qt,fi)=>{fi(qt,{children:(li,Si)=>{var _i=hk(),yi=Kt(_i),Pi=Pe(()=>Di(_e.Open,"mr-auto border-transparent"));Of(yi,{get class(){return R(Pi)},children:(Ei,mt)=>{Kn();var kt=gs("Open");we(Ei,kt)},$$slots:{default:!0}});var Ui=ni(yi,2),qi=Pe(()=>Di(_e["Opening Soon"],"mr-auto border-transparent"));Of(Ui,{get class(){return R(qi)},children:(Ei,mt)=>{Kn();var kt=gs("Opening Soon/Closing Soon");we(Ei,kt)},$$slots:{default:!0}});var Zi=ni(Ui,2),Xi=Pe(()=>Di(_e.Closed,"mr-auto border-transparent"));Of(Zi,{get class(){return R(Xi)},children:(Ei,mt)=>{Kn();var kt=gs("Closed");we(Ei,kt)},$$slots:{default:!0}}),Wt(_i),we(li,_i)},$$slots:{default:!0}})}),we(pt,lt)},$$slots:{default:!0}})});var Fe=ni(Ge,2);{var Ee=Le=>{var Ke=tt(),pt=Be(Ke);ai(pt,()=>sE,(yt,lt)=>{lt(yt,{get open(){return R(V)},set open(ut){Oe(V,Ze(ut))},children:(ut,Ft)=>{var qt=tt(),fi=Be(qt);ai(fi,()=>eE,(li,Si)=>{Si(li,{children:(_i,yi)=>{var Pi=bk(),Ui=Kt(Pi);ai(Ui,()=>rE,(Ki,xi)=>{xi(Ki,{children:(tr,ar)=>{var ir=pk(),hr=Be(ir);ai(hr,()=>nE,(Ve,Ji)=>{Ji(Ve,{children:(Wi,kr)=>{Kn();var wr=gs();$t(()=>_s(wr,R(ne).label)),we(Wi,wr)},$$slots:{default:!0}})});var Er=ni(hr,2);ai(Er,()=>tE,(Ve,Ji)=>{Ji(Ve,{children:(Wi,kr)=>{var wr=Pe(()=>Di(_e[R(oe)],"border-transparent"));Of(Wi,{get class(){return R(wr)},children:(We,Bt)=>{Kn();var Mt=gs();$t(()=>_s(Mt,R(oe))),we(We,Mt)},$$slots:{default:!0}})},$$slots:{default:!0}})}),we(tr,ir)},$$slots:{default:!0}})});var qi=ni(Ui,2),Zi=Kt(qi,!0);Wt(qi);var Xi=ni(qi,2);{var Ei=Ki=>{var xi=mk(),tr=ni(Kt(xi),2);eh(tr,17,()=>{var ar;return(ar=R(ne).metadata)==null?void 0:ar.amenities.slice().sort()},th,(ar,ir)=>{var hr=fk(),Er=Kt(hr);U2(Er,{get amenity(){return R(ir)}});var Ve=ni(Er,2),Ji=Kt(Ve,!0);Wt(Ve),Wt(hr),$t(()=>_s(Ji,R(ir))),we(ar,hr)}),Wt(xi),we(Ki,xi)};gi(Xi,Ki=>{var xi;(xi=R(ne).metadata)!=null&&xi.amenities&&Ki(Ei)})}var mt=ni(Xi,2),kt=ni(Kt(mt),2);$t(()=>Gf(kt,"href",De(Ie(R(ne)),void 0)));var ye=ni(Kt(kt),2);L2(ye,{class:"h-fit w-fit scale-75"}),Wt(kt),Wt(mt);var Ri=ni(mt,2),sn=ni(Kt(Ri),2);{var Ht=Ki=>{var xi=gk();we(Ki,xi)},vi=Ki=>{var xi=xk();eh(xi,21,()=>Object.entries(R(ne).hours),th,(tr,ar)=>{let ir=()=>R(ar)[0],hr=()=>R(ar)[1];var Er=vk(),Ve=Kt(Er),Ji=Kt(Ve,!0);Wt(Ve);var Wi=ni(Ve,2);{var kr=We=>{var Bt=_k(),Mt=Kt(Bt,!0);$t(()=>_s(Mt,hr().map(dr=>`${dr.open} - ${dr.close}`).join(", "))),Wt(Bt),we(We,Bt)},wr=We=>{var Bt=yk();we(We,Bt)};gi(Wi,We=>{hr().length>0?We(kr):We(wr,!1)})}Wt(Er),$t(()=>_s(Ji,ir())),we(tr,Er)}),Wt(xi),we(Ki,xi)};gi(sn,Ki=>{R(ne).alwaysOpen?Ki(Ht):Ki(vi,!1)})}Wt(Ri),Wt(Pi),$t(()=>_s(Zi,R(ne).description)),we(_i,Pi)},$$slots:{default:!0}})}),we(ut,qt)},$$slots:{default:!0}})}),we(Le,Ke)};gi(Fe,Le=>{R(ne)&&Le(Ee)})}we(f,it),Et()}export{Ok as component};
