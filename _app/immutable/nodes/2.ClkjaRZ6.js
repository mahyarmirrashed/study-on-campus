var D1=Object.defineProperty;var R1=Object.getPrototypeOf;var L1=Reflect.get;var zx=m=>{throw TypeError(m)};var O1=(m,o,g)=>o in m?D1(m,o,{enumerable:!0,configurable:!0,writable:!0,value:g}):m[o]=g;var Ve=(m,o,g)=>O1(m,typeof o!="symbol"?o+"":o,g),X_=(m,o,g)=>o.has(m)||zx("Cannot "+g);var T=(m,o,g)=>(X_(m,o,"read from private field"),g?g.call(m):o.get(m)),X=(m,o,g)=>o.has(m)?zx("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(m):o.set(m,g),je=(m,o,g,b)=>(X_(m,o,"write to private field"),b?b.call(m,g):o.set(m,g),g),Er=(m,o,g)=>(X_(m,o,"access private method"),g);var Zu=(m,o,g,b)=>({set _(I){je(m,o,I,g)},get _(){return T(m,o,b)}}),Dx=(m,o,g)=>L1(R1(m),g,o);import{c as F1,p as B1,l as ut,a as Me,t as Gt,m as Qu,q as N1,g as P0,s as ly}from"../chunks/legacy.Dm4gyfrH.js";import{a7 as V1,W as j1,a0 as U1,x as hs,j as Rx,k as K_,J as q1,K as Z1,w as G1,g as W1,v as H1,e as Lx,h as Ox,y as X1,aR as T0,L as K1,aa as J1,aC as Y1,M as $1,C as ki,N as I0,G as Q1,V as e2,aw as t2,U as Fe,p as Mt,f as Xe,a as zt,c as Mi,T as ri,r as zi,t as fi,F,I as Te,av as Je,B as Tt,au as Pg,_ as wp,aS as A0,$ as Ay,aT as C0,aU as i2,a2 as js,u as r2,an as Tg,s as Fi,aV as Ia,aW as n2,aX as s2}from"../chunks/runtime.B76Vjo_i.js";import{m as o2,u as Fx,s as Aa}from"../chunks/render.DC6ny83U.js";import{p as te,i as bi,r as ei,a as qe,o as E0,s as ai,l as Na,b as Ig}from"../chunks/index-client.BrO4ukPi.js";import{q as Bt,k as k0,e as cy,s as kc,i as uy,r as a2,b as l2}from"../chunks/mode.CHMDlCvN.js";import{b as Nf,c as ci}from"../chunks/this.QRC2F710.js";import{s as c2,h as u2,a as h2}from"../chunks/store.BvVuv4PB.js";import{g as Cy,c as Qi,r as d2,s as hy}from"../chunks/index.DKNLSslk.js";import{i as p2}from"../chunks/lifecycle.CU51bgik.js";const f2=[];function M0(m,o=!1){return Of(m,new Map,"",f2)}function Of(m,o,g,b,I=null){if(typeof m=="object"&&m!==null){const w=o.get(m);if(w!==void 0)return w;if(m instanceof Map)return new Map(m);if(m instanceof Set)return new Set(m);if(V1(m)){const u=[];o.set(m,u),I!==null&&o.set(I,u);for(let U=0;U<m.length;U+=1)u.push(Of(m[U],o,g,b));return u}if(j1(m)===U1){const u={};o.set(m,u),I!==null&&o.set(I,u);for(var E in m)u[E]=Of(m[E],o,g,b);return u}if(m instanceof Date)return structuredClone(m);if(typeof m.toJSON=="function")return Of(m.toJSON(),o,g,b,m)}if(m instanceof EventTarget)return m;try{return structuredClone(m)}catch{return m}}function m2(m,o,g,b,I,E){let w=hs;hs&&Rx();var u,U,W=null;hs&&K_.nodeType===1&&(W=K_,Rx());var Q=hs?K_:m,j;q1(()=>{const V=o()||null;var ae=T0;V!==u&&(j&&(V===null?K1(j,()=>{j=null,U=null}):V===U?J1(j):Y1(j)),V&&V!==U&&(j=G1(()=>{if(W=hs?W:document.createElementNS(ae,V),F1(W,W),b){var se=hs?W1(W):W.appendChild(H1());hs&&(se===null?Lx(!1):Ox(se)),b(W,se)}X1.nodes_end=W,Q.before(W)})),u=V,u&&(U=u))},Z1),w&&(Lx(!0),Ox(Q))}function dy(m,o,g){$1(()=>{var b=ki(()=>o(m,g==null?void 0:g())||{});if(g&&(b!=null&&b.update)){var I=!1,E={};I0(()=>{var w=g();Q1(w),I&&e2(E,w)&&(E=w,b.update(w))}),I=!0}if(b!=null&&b.destroy)return()=>b.destroy()})}function g2(m,o){var g=m.__className,b=_2(o);hs&&m.className===b?m.__className=b:(g!==b||hs&&m.className!==b)&&(o==null?m.removeAttribute("class"):m.className=b,m.__className=b)}function _2(m){return m??""}function y2(m,o,g){if(g){if(m.classList.contains(o))return;m.classList.add(o)}else{if(!m.classList.contains(o))return;m.classList.remove(o)}}function v2(m,o,g,b){var I=m.__styles??(m.__styles={});I[o]!==g&&(I[o]=g,g==null?m.style.removeProperty(o):m.style.setProperty(o,g,""))}function x2(m,o,g=o){var b=t2();B1(m,"input",I=>{var E=I?m.defaultValue:m.value;E=J_(m)?Y_(E):E,g(E),b&&E!==(E=o())&&(m.value=E??"")}),(hs&&m.defaultValue!==m.value||ki(o)==null&&m.value)&&g(J_(m)?Y_(m.value):m.value),I0(()=>{var I=o();J_(m)&&I===Y_(m.value)||m.type==="date"&&!I&&!m.value||I!==m.value&&(m.value=I??"")})}function J_(m){var o=m.type;return o==="number"||o==="range"}function Y_(m){return m===""?null:+m}function Do(m){Fe(m,m.v+1)}const Bx="LYsosKTbN7Q5Pq1NzJI1";var Nx=m=>typeof m=="boolean"?`${m}`:m===0?"0":m,mn=m=>!m||typeof m!="object"||Object.keys(m).length===0,b2=(m,o)=>JSON.stringify(m)===JSON.stringify(o);function z0(m,o){m.forEach(function(g){Array.isArray(g)?z0(g,o):o.push(g)})}function D0(m){let o=[];return z0(m,o),o}var R0=(...m)=>D0(m).filter(Boolean),L0=(m,o)=>{let g={},b=Object.keys(m),I=Object.keys(o);for(let E of b)if(I.includes(E)){let w=m[E],u=o[E];Array.isArray(w)||Array.isArray(u)?g[E]=R0(u,w):typeof w=="object"&&typeof u=="object"?g[E]=L0(w,u):g[E]=u+" "+w}else g[E]=m[E];for(let E of I)b.includes(E)||(g[E]=o[E]);return g},Vx=m=>!m||typeof m!="string"?m:m.replace(/\s+/g," ").trim();const Ey="-",w2=m=>{const o=P2(m),{conflictingClassGroups:g,conflictingClassGroupModifiers:b}=m;return{getClassGroupId:w=>{const u=w.split(Ey);return u[0]===""&&u.length!==1&&u.shift(),O0(u,o)||S2(w)},getConflictingClassGroupIds:(w,u)=>{const U=g[w]||[];return u&&b[w]?[...U,...b[w]]:U}}},O0=(m,o)=>{var w;if(m.length===0)return o.classGroupId;const g=m[0],b=o.nextPart.get(g),I=b?O0(m.slice(1),b):void 0;if(I)return I;if(o.validators.length===0)return;const E=m.join(Ey);return(w=o.validators.find(({validator:u})=>u(E)))==null?void 0:w.classGroupId},jx=/^\[(.+)\]$/,S2=m=>{if(jx.test(m)){const o=jx.exec(m)[1],g=o==null?void 0:o.substring(0,o.indexOf(":"));if(g)return"arbitrary.."+g}},P2=m=>{const{theme:o,prefix:g}=m,b={nextPart:new Map,validators:[]};return I2(Object.entries(m.classGroups),g).forEach(([E,w])=>{py(w,b,E,o)}),b},py=(m,o,g,b)=>{m.forEach(I=>{if(typeof I=="string"){const E=I===""?o:Ux(o,I);E.classGroupId=g;return}if(typeof I=="function"){if(T2(I)){py(I(b),o,g,b);return}o.validators.push({validator:I,classGroupId:g});return}Object.entries(I).forEach(([E,w])=>{py(w,Ux(o,E),g,b)})})},Ux=(m,o)=>{let g=m;return o.split(Ey).forEach(b=>{g.nextPart.has(b)||g.nextPart.set(b,{nextPart:new Map,validators:[]}),g=g.nextPart.get(b)}),g},T2=m=>m.isThemeGetter,I2=(m,o)=>o?m.map(([g,b])=>{const I=b.map(E=>typeof E=="string"?o+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([w,u])=>[o+w,u])):E);return[g,I]}):m,A2=m=>{if(m<1)return{get:()=>{},set:()=>{}};let o=0,g=new Map,b=new Map;const I=(E,w)=>{g.set(E,w),o++,o>m&&(o=0,b=g,g=new Map)};return{get(E){let w=g.get(E);if(w!==void 0)return w;if((w=b.get(E))!==void 0)return I(E,w),w},set(E,w){g.has(E)?g.set(E,w):I(E,w)}}},F0="!",C2=m=>{const{separator:o,experimentalParseClassName:g}=m,b=o.length===1,I=o[0],E=o.length,w=u=>{const U=[];let W=0,Q=0,j;for(let fe=0;fe<u.length;fe++){let Pe=u[fe];if(W===0){if(Pe===I&&(b||u.slice(fe,fe+E)===o)){U.push(u.slice(Q,fe)),Q=fe+E;continue}if(Pe==="/"){j=fe;continue}}Pe==="["?W++:Pe==="]"&&W--}const V=U.length===0?u:u.substring(Q),ae=V.startsWith(F0),se=ae?V.substring(1):V,ue=j&&j>Q?j-Q:void 0;return{modifiers:U,hasImportantModifier:ae,baseClassName:se,maybePostfixModifierPosition:ue}};return g?u=>g({className:u,parseClassName:w}):w},E2=m=>{if(m.length<=1)return m;const o=[];let g=[];return m.forEach(b=>{b[0]==="["?(o.push(...g.sort(),b),g=[]):g.push(b)}),o.push(...g.sort()),o},k2=m=>({cache:A2(m.cacheSize),parseClassName:C2(m),...w2(m)}),M2=/\s+/,z2=(m,o)=>{const{parseClassName:g,getClassGroupId:b,getConflictingClassGroupIds:I}=o,E=[],w=m.trim().split(M2);let u="";for(let U=w.length-1;U>=0;U-=1){const W=w[U],{modifiers:Q,hasImportantModifier:j,baseClassName:V,maybePostfixModifierPosition:ae}=g(W);let se=!!ae,ue=b(se?V.substring(0,ae):V);if(!ue){if(!se){u=W+(u.length>0?" "+u:u);continue}if(ue=b(V),!ue){u=W+(u.length>0?" "+u:u);continue}se=!1}const fe=E2(Q).join(":"),Pe=j?fe+F0:fe,_e=Pe+ue;if(E.includes(_e))continue;E.push(_e);const Ee=I(ue,se);for(let Be=0;Be<Ee.length;++Be){const De=Ee[Be];E.push(Pe+De)}u=W+(u.length>0?" "+u:u)}return u};function D2(){let m=0,o,g,b="";for(;m<arguments.length;)(o=arguments[m++])&&(g=B0(o))&&(b&&(b+=" "),b+=g);return b}const B0=m=>{if(typeof m=="string")return m;let o,g="";for(let b=0;b<m.length;b++)m[b]&&(o=B0(m[b]))&&(g&&(g+=" "),g+=o);return g};function fy(m,...o){let g,b,I,E=w;function w(U){const W=o.reduce((Q,j)=>j(Q),m());return g=k2(W),b=g.cache.get,I=g.cache.set,E=u,u(U)}function u(U){const W=b(U);if(W)return W;const Q=z2(U,g);return I(U,Q),Q}return function(){return E(D2.apply(null,arguments))}}const Vi=m=>{const o=g=>g[m]||[];return o.isThemeGetter=!0,o},N0=/^\[(?:([a-z-]+):)?(.+)\]$/i,R2=/^\d+\/\d+$/,L2=new Set(["px","full","screen"]),O2=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,F2=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,B2=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,N2=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,V2=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Bs=m=>Bl(m)||L2.has(m)||R2.test(m),ko=m=>Mc(m,"length",X2),Bl=m=>!!m&&!Number.isNaN(Number(m)),$_=m=>Mc(m,"number",Bl),Gu=m=>!!m&&Number.isInteger(Number(m)),j2=m=>m.endsWith("%")&&Bl(m.slice(0,-1)),Yt=m=>N0.test(m),Mo=m=>O2.test(m),U2=new Set(["length","size","percentage"]),q2=m=>Mc(m,U2,V0),Z2=m=>Mc(m,"position",V0),G2=new Set(["image","url"]),W2=m=>Mc(m,G2,J2),H2=m=>Mc(m,"",K2),Wu=()=>!0,Mc=(m,o,g)=>{const b=N0.exec(m);return b?b[1]?typeof o=="string"?b[1]===o:o.has(b[1]):g(b[2]):!1},X2=m=>F2.test(m)&&!B2.test(m),V0=()=>!1,K2=m=>N2.test(m),J2=m=>V2.test(m),my=()=>{const m=Vi("colors"),o=Vi("spacing"),g=Vi("blur"),b=Vi("brightness"),I=Vi("borderColor"),E=Vi("borderRadius"),w=Vi("borderSpacing"),u=Vi("borderWidth"),U=Vi("contrast"),W=Vi("grayscale"),Q=Vi("hueRotate"),j=Vi("invert"),V=Vi("gap"),ae=Vi("gradientColorStops"),se=Vi("gradientColorStopPositions"),ue=Vi("inset"),fe=Vi("margin"),Pe=Vi("opacity"),_e=Vi("padding"),Ee=Vi("saturate"),Be=Vi("scale"),De=Vi("sepia"),Oe=Vi("skew"),Ze=Vi("space"),ft=Vi("translate"),We=()=>["auto","contain","none"],mt=()=>["auto","hidden","clip","visible","scroll"],st=()=>["auto",Yt,o],Ue=()=>[Yt,o],Re=()=>["",Bs,ko],Ae=()=>["auto",Bl,Yt],Ke=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],rt=()=>["solid","dashed","dotted","double","none"],_t=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],yt=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",Yt],xt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Dt=()=>[Bl,Yt];return{cacheSize:500,separator:":",theme:{colors:[Wu],spacing:[Bs,ko],blur:["none","",Mo,Yt],brightness:Dt(),borderColor:[m],borderRadius:["none","","full",Mo,Yt],borderSpacing:Ue(),borderWidth:Re(),contrast:Dt(),grayscale:ht(),hueRotate:Dt(),invert:ht(),gap:Ue(),gradientColorStops:[m],gradientColorStopPositions:[j2,ko],inset:st(),margin:st(),opacity:Dt(),padding:Ue(),saturate:Dt(),scale:Dt(),sepia:ht(),skew:Dt(),space:Ue(),translate:Ue()},classGroups:{aspect:[{aspect:["auto","square","video",Yt]}],container:["container"],columns:[{columns:[Mo]}],"break-after":[{"break-after":xt()}],"break-before":[{"break-before":xt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ke(),Yt]}],overflow:[{overflow:mt()}],"overflow-x":[{"overflow-x":mt()}],"overflow-y":[{"overflow-y":mt()}],overscroll:[{overscroll:We()}],"overscroll-x":[{"overscroll-x":We()}],"overscroll-y":[{"overscroll-y":We()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ue]}],"inset-x":[{"inset-x":[ue]}],"inset-y":[{"inset-y":[ue]}],start:[{start:[ue]}],end:[{end:[ue]}],top:[{top:[ue]}],right:[{right:[ue]}],bottom:[{bottom:[ue]}],left:[{left:[ue]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Gu,Yt]}],basis:[{basis:st()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Yt]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",Gu,Yt]}],"grid-cols":[{"grid-cols":[Wu]}],"col-start-end":[{col:["auto",{span:["full",Gu,Yt]},Yt]}],"col-start":[{"col-start":Ae()}],"col-end":[{"col-end":Ae()}],"grid-rows":[{"grid-rows":[Wu]}],"row-start-end":[{row:["auto",{span:[Gu,Yt]},Yt]}],"row-start":[{"row-start":Ae()}],"row-end":[{"row-end":Ae()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Yt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Yt]}],gap:[{gap:[V]}],"gap-x":[{"gap-x":[V]}],"gap-y":[{"gap-y":[V]}],"justify-content":[{justify:["normal",...yt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...yt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...yt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[_e]}],px:[{px:[_e]}],py:[{py:[_e]}],ps:[{ps:[_e]}],pe:[{pe:[_e]}],pt:[{pt:[_e]}],pr:[{pr:[_e]}],pb:[{pb:[_e]}],pl:[{pl:[_e]}],m:[{m:[fe]}],mx:[{mx:[fe]}],my:[{my:[fe]}],ms:[{ms:[fe]}],me:[{me:[fe]}],mt:[{mt:[fe]}],mr:[{mr:[fe]}],mb:[{mb:[fe]}],ml:[{ml:[fe]}],"space-x":[{"space-x":[Ze]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Ze]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Yt,o]}],"min-w":[{"min-w":[Yt,o,"min","max","fit"]}],"max-w":[{"max-w":[Yt,o,"none","full","min","max","fit","prose",{screen:[Mo]},Mo]}],h:[{h:[Yt,o,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Yt,o,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Yt,o,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Yt,o,"auto","min","max","fit"]}],"font-size":[{text:["base",Mo,ko]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",$_]}],"font-family":[{font:[Wu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Yt]}],"line-clamp":[{"line-clamp":["none",Bl,$_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Bs,Yt]}],"list-image":[{"list-image":["none",Yt]}],"list-style-type":[{list:["none","disc","decimal",Yt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[m]}],"placeholder-opacity":[{"placeholder-opacity":[Pe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[m]}],"text-opacity":[{"text-opacity":[Pe]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...rt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Bs,ko]}],"underline-offset":[{"underline-offset":["auto",Bs,Yt]}],"text-decoration-color":[{decoration:[m]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Yt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Yt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Pe]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ke(),Z2]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",q2]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},W2]}],"bg-color":[{bg:[m]}],"gradient-from-pos":[{from:[se]}],"gradient-via-pos":[{via:[se]}],"gradient-to-pos":[{to:[se]}],"gradient-from":[{from:[ae]}],"gradient-via":[{via:[ae]}],"gradient-to":[{to:[ae]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[u]}],"border-w-x":[{"border-x":[u]}],"border-w-y":[{"border-y":[u]}],"border-w-s":[{"border-s":[u]}],"border-w-e":[{"border-e":[u]}],"border-w-t":[{"border-t":[u]}],"border-w-r":[{"border-r":[u]}],"border-w-b":[{"border-b":[u]}],"border-w-l":[{"border-l":[u]}],"border-opacity":[{"border-opacity":[Pe]}],"border-style":[{border:[...rt(),"hidden"]}],"divide-x":[{"divide-x":[u]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[u]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Pe]}],"divide-style":[{divide:rt()}],"border-color":[{border:[I]}],"border-color-x":[{"border-x":[I]}],"border-color-y":[{"border-y":[I]}],"border-color-s":[{"border-s":[I]}],"border-color-e":[{"border-e":[I]}],"border-color-t":[{"border-t":[I]}],"border-color-r":[{"border-r":[I]}],"border-color-b":[{"border-b":[I]}],"border-color-l":[{"border-l":[I]}],"divide-color":[{divide:[I]}],"outline-style":[{outline:["",...rt()]}],"outline-offset":[{"outline-offset":[Bs,Yt]}],"outline-w":[{outline:[Bs,ko]}],"outline-color":[{outline:[m]}],"ring-w":[{ring:Re()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[m]}],"ring-opacity":[{"ring-opacity":[Pe]}],"ring-offset-w":[{"ring-offset":[Bs,ko]}],"ring-offset-color":[{"ring-offset":[m]}],shadow:[{shadow:["","inner","none",Mo,H2]}],"shadow-color":[{shadow:[Wu]}],opacity:[{opacity:[Pe]}],"mix-blend":[{"mix-blend":[..._t(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":_t()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[b]}],contrast:[{contrast:[U]}],"drop-shadow":[{"drop-shadow":["","none",Mo,Yt]}],grayscale:[{grayscale:[W]}],"hue-rotate":[{"hue-rotate":[Q]}],invert:[{invert:[j]}],saturate:[{saturate:[Ee]}],sepia:[{sepia:[De]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[b]}],"backdrop-contrast":[{"backdrop-contrast":[U]}],"backdrop-grayscale":[{"backdrop-grayscale":[W]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Q]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[Pe]}],"backdrop-saturate":[{"backdrop-saturate":[Ee]}],"backdrop-sepia":[{"backdrop-sepia":[De]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Yt]}],duration:[{duration:Dt()}],ease:[{ease:["linear","in","out","in-out",Yt]}],delay:[{delay:Dt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Yt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Be]}],"scale-x":[{"scale-x":[Be]}],"scale-y":[{"scale-y":[Be]}],rotate:[{rotate:[Gu,Yt]}],"translate-x":[{"translate-x":[ft]}],"translate-y":[{"translate-y":[ft]}],"skew-x":[{"skew-x":[Oe]}],"skew-y":[{"skew-y":[Oe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Yt]}],accent:[{accent:["auto",m]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Yt]}],"caret-color":[{caret:[m]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ue()}],"scroll-mx":[{"scroll-mx":Ue()}],"scroll-my":[{"scroll-my":Ue()}],"scroll-ms":[{"scroll-ms":Ue()}],"scroll-me":[{"scroll-me":Ue()}],"scroll-mt":[{"scroll-mt":Ue()}],"scroll-mr":[{"scroll-mr":Ue()}],"scroll-mb":[{"scroll-mb":Ue()}],"scroll-ml":[{"scroll-ml":Ue()}],"scroll-p":[{"scroll-p":Ue()}],"scroll-px":[{"scroll-px":Ue()}],"scroll-py":[{"scroll-py":Ue()}],"scroll-ps":[{"scroll-ps":Ue()}],"scroll-pe":[{"scroll-pe":Ue()}],"scroll-pt":[{"scroll-pt":Ue()}],"scroll-pr":[{"scroll-pr":Ue()}],"scroll-pb":[{"scroll-pb":Ue()}],"scroll-pl":[{"scroll-pl":Ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Yt]}],fill:[{fill:[m,"none"]}],"stroke-w":[{stroke:[Bs,ko,$_]}],stroke:[{stroke:[m,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Y2=(m,{cacheSize:o,prefix:g,separator:b,experimentalParseClassName:I,extend:E={},override:w={}})=>{Yu(m,"cacheSize",o),Yu(m,"prefix",g),Yu(m,"separator",b),Yu(m,"experimentalParseClassName",I);for(const u in w)$2(m[u],w[u]);for(const u in E)Q2(m[u],E[u]);return m},Yu=(m,o,g)=>{g!==void 0&&(m[o]=g)},$2=(m,o)=>{if(o)for(const g in o)Yu(m,g,o[g])},Q2=(m,o)=>{if(o)for(const g in o){const b=o[g];b!==void 0&&(m[g]=(m[g]||[]).concat(b))}},eS=(m,...o)=>typeof m=="function"?fy(my,m,...o):fy(()=>Y2(my(),m),...o),j0=fy(my);var tS={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},U0=m=>m||void 0,eh=(...m)=>U0(D0(m).filter(Boolean).join(" ")),Q_=null,Vs={},gy=!1,Hu=(...m)=>o=>o.twMerge?((!Q_||gy)&&(gy=!1,Q_=mn(Vs)?j0:eS({...Vs,extend:{theme:Vs.theme,classGroups:Vs.classGroups,conflictingClassGroupModifiers:Vs.conflictingClassGroupModifiers,conflictingClassGroups:Vs.conflictingClassGroups,...Vs.extend}})),U0(Q_(eh(m)))):eh(m),qx=(m,o)=>{for(let g in o)m.hasOwnProperty(g)?m[g]=eh(m[g],o[g]):m[g]=o[g];return m},iS=(m,o)=>{let{extend:g=null,slots:b={},variants:I={},compoundVariants:E=[],compoundSlots:w=[],defaultVariants:u={}}=m,U={...tS,...o},W=g!=null&&g.base?eh(g.base,m==null?void 0:m.base):m==null?void 0:m.base,Q=g!=null&&g.variants&&!mn(g.variants)?L0(I,g.variants):I,j=g!=null&&g.defaultVariants&&!mn(g.defaultVariants)?{...g.defaultVariants,...u}:u;!mn(U.twMergeConfig)&&!b2(U.twMergeConfig,Vs)&&(gy=!0,Vs=U.twMergeConfig);let V=mn(g==null?void 0:g.slots),ae=mn(b)?{}:{base:eh(m==null?void 0:m.base,V&&(g==null?void 0:g.base)),...b},se=V?ae:qx({...g==null?void 0:g.slots},mn(ae)?{base:m==null?void 0:m.base}:ae),ue=mn(g==null?void 0:g.compoundVariants)?E:R0(g==null?void 0:g.compoundVariants,E),fe=_e=>{if(mn(Q)&&mn(b)&&V)return Hu(W,_e==null?void 0:_e.class,_e==null?void 0:_e.className)(U);if(ue&&!Array.isArray(ue))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof ue}`);if(w&&!Array.isArray(w))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof w}`);let Ee=(Ue,Re,Ae=[],Ke)=>{let rt=Ae;if(typeof Re=="string")rt=rt.concat(Vx(Re).split(" ").map(_t=>`${Ue}:${_t}`));else if(Array.isArray(Re))rt=rt.concat(Re.reduce((_t,yt)=>_t.concat(`${Ue}:${yt}`),[]));else if(typeof Re=="object"&&typeof Ke=="string"){for(let _t in Re)if(Re.hasOwnProperty(_t)&&_t===Ke){let yt=Re[_t];if(yt&&typeof yt=="string"){let ht=Vx(yt);rt[Ke]?rt[Ke]=rt[Ke].concat(ht.split(" ").map(xt=>`${Ue}:${xt}`)):rt[Ke]=ht.split(" ").map(xt=>`${Ue}:${xt}`)}else Array.isArray(yt)&&yt.length>0&&(rt[Ke]=yt.reduce((ht,xt)=>ht.concat(`${Ue}:${xt}`),[]))}}return rt},Be=(Ue,Re=Q,Ae=null,Ke=null)=>{var rt;let _t=Re[Ue];if(!_t||mn(_t))return null;let yt=(rt=Ke==null?void 0:Ke[Ue])!=null?rt:_e==null?void 0:_e[Ue];if(yt===null)return null;let ht=Nx(yt),xt=Array.isArray(U.responsiveVariants)&&U.responsiveVariants.length>0||U.responsiveVariants===!0,Dt=j==null?void 0:j[Ue],qt=[];if(typeof ht=="object"&&xt)for(let[Li,Ui]of Object.entries(ht)){let Di=_t[Ui];if(Li==="initial"){Dt=Ui;continue}Array.isArray(U.responsiveVariants)&&!U.responsiveVariants.includes(Li)||(qt=Ee(Li,Di,qt,Ae))}let vi=ht!=null&&typeof ht!="object"?ht:Nx(Dt),hi=_t[vi||"false"];return typeof qt=="object"&&typeof Ae=="string"&&qt[Ae]?qx(qt,hi):qt.length>0?(qt.push(hi),Ae==="base"?qt.join(" "):qt):hi},De=()=>Q?Object.keys(Q).map(Ue=>Be(Ue,Q)):null,Oe=(Ue,Re)=>{if(!Q||typeof Q!="object")return null;let Ae=new Array;for(let Ke in Q){let rt=Be(Ke,Q,Ue,Re),_t=Ue==="base"&&typeof rt=="string"?rt:rt&&rt[Ue];_t&&(Ae[Ae.length]=_t)}return Ae},Ze={};for(let Ue in _e)_e[Ue]!==void 0&&(Ze[Ue]=_e[Ue]);let ft=(Ue,Re)=>{var Ae;let Ke=typeof(_e==null?void 0:_e[Ue])=="object"?{[Ue]:(Ae=_e[Ue])==null?void 0:Ae.initial}:{};return{...j,...Ze,...Ke,...Re}},We=(Ue=[],Re)=>{let Ae=[];for(let{class:Ke,className:rt,..._t}of Ue){let yt=!0;for(let[ht,xt]of Object.entries(_t)){let Dt=ft(ht,Re)[ht];if(Array.isArray(xt)){if(!xt.includes(Dt)){yt=!1;break}}else{let qt=vi=>vi==null||vi===!1;if(qt(xt)&&qt(Dt))continue;if(Dt!==xt){yt=!1;break}}}yt&&(Ke&&Ae.push(Ke),rt&&Ae.push(rt))}return Ae},mt=Ue=>{let Re=We(ue,Ue);if(!Array.isArray(Re))return Re;let Ae={};for(let Ke of Re)if(typeof Ke=="string"&&(Ae.base=Hu(Ae.base,Ke)(U)),typeof Ke=="object")for(let[rt,_t]of Object.entries(Ke))Ae[rt]=Hu(Ae[rt],_t)(U);return Ae},st=Ue=>{if(w.length<1)return null;let Re={};for(let{slots:Ae=[],class:Ke,className:rt,..._t}of w){if(!mn(_t)){let yt=!0;for(let ht of Object.keys(_t)){let xt=ft(ht,Ue)[ht];if(xt===void 0||(Array.isArray(_t[ht])?!_t[ht].includes(xt):_t[ht]!==xt)){yt=!1;break}}if(!yt)continue}for(let yt of Ae)Re[yt]=Re[yt]||[],Re[yt].push([Ke,rt])}return Re};if(!mn(b)||!V){let Ue={};if(typeof se=="object"&&!mn(se))for(let Re of Object.keys(se))Ue[Re]=Ae=>{var Ke,rt;return Hu(se[Re],Oe(Re,Ae),((Ke=mt(Ae))!=null?Ke:[])[Re],((rt=st(Ae))!=null?rt:[])[Re],Ae==null?void 0:Ae.class,Ae==null?void 0:Ae.className)(U)};return Ue}return Hu(W,De(),We(ue),_e==null?void 0:_e.class,_e==null?void 0:_e.className)(U)},Pe=()=>{if(!(!Q||typeof Q!="object"))return Object.keys(Q)};return fe.variantKeys=Pe(),fe.extend=g,fe.base=W,fe.slots=se,fe.variants=Q,fe.defaultVariants=j,fe.compoundSlots=w,fe.compoundVariants=ue,fe};function q0(m){var o,g,b="";if(typeof m=="string"||typeof m=="number")b+=m;else if(typeof m=="object")if(Array.isArray(m)){var I=m.length;for(o=0;o<I;o++)m[o]&&(g=q0(m[o]))&&(b&&(b+=" "),b+=g)}else for(g in m)m[g]&&(b&&(b+=" "),b+=g);return b}function Z0(){for(var m,o,g=0,b="",I=arguments.length;g<I;g++)(m=arguments[g])&&(o=q0(m))&&(b&&(b+=" "),b+=o);return b}function nn(...m){return j0(Z0(m))}const Zx=iS({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var rS=Gt("<a><!></a>"),nS=Gt("<button><!></button>");function Gx(m,o){Mt(o,!0);let g=te(o,"variant",3,"default"),b=te(o,"size",3,"default"),I=te(o,"ref",15,null),E=te(o,"href",3,void 0),w=te(o,"type",3,"button"),u=ei(o,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const U=Cy(),[W,Q]=U;var j=ut(),V=Xe(j);{var ae=ue=>{var fe=rS();const Pe=Te(()=>Q({class:nn(Zx({variant:g(),size:b(),className:o.class})),href:E(),...u},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let _e;var Ee=Mi(fe);Bt(Ee,()=>o.children??ri),zi(fe),Nf(fe,Be=>I(Be),()=>I()),fi(()=>_e=Qi(fe,_e,{...F(Pe)})),Me(ue,fe)},se=ue=>{var fe=nS();const Pe=Te(()=>Q({class:nn(Zx({variant:g(),size:b(),className:o.class})),type:w(),...u},[{attribute_name:"formaction"}]));let _e;var Ee=Mi(fe);Bt(Ee,()=>o.children??ri),zi(fe),Nf(fe,Be=>I(Be),()=>I()),fi(()=>_e=Qi(fe,_e,{...F(Pe)})),Me(ue,fe)};bi(V,ue=>{E()?ue(ae):ue(se,!1)})}Me(m,j),zt()}function sS(m){return typeof m=="function"}function oS(m){return m!==null&&typeof m=="object"}const th=Symbol("box"),ky=Symbol("is-writable");function aS(m){return oS(m)&&th in m}function lS(m){return we.isBox(m)&&ky in m}function we(m){let o=Je(qe(m));return{[th]:!0,[ky]:!0,get current(){return F(o)},set current(g){Fe(o,qe(g))}}}function cS(m,o){const g=Te(m);return o?{[th]:!0,[ky]:!0,get current(){return F(g)},set current(b){o(b)}}:{[th]:!0,get current(){return m()}}}function uS(m){return we.isBox(m)?m:sS(m)?we.with(m):we(m)}function hS(m){return Object.entries(m).reduce((o,[g,b])=>we.isBox(b)?(we.isWritableBox(b)?Object.defineProperty(o,g,{get(){return b.current},set(I){b.current=I}}):Object.defineProperty(o,g,{get(){return b.current}}),o):Object.assign(o,{[g]:b}),{})}function dS(m){return we.isWritableBox(m)?{[th]:!0,get current(){return m.current}}:m}we.from=uS;we.with=cS;we.flatten=hS;we.readonly=dS;we.isBox=aS;we.isWritableBox=lS;function G0(...m){return function(o){var g;for(const b of m)if(b){if(o.defaultPrevented)return;typeof b=="function"?b.call(this,o):(g=b.current)==null||g.call(this,o)}}}function W0(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var Ol={},ey,Wx;function pS(){if(Wx)return ey;Wx=1;var m=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,o=/\n/g,g=/^\s*/,b=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,I=/^:\s*/,E=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,w=/^[;\s]*/,u=/^\s+|\s+$/g,U=`
`,W="/",Q="*",j="",V="comment",ae="declaration";ey=function(ue,fe){if(typeof ue!="string")throw new TypeError("First argument must be a string");if(!ue)return[];fe=fe||{};var Pe=1,_e=1;function Ee(Re){var Ae=Re.match(o);Ae&&(Pe+=Ae.length);var Ke=Re.lastIndexOf(U);_e=~Ke?Re.length-Ke:_e+Re.length}function Be(){var Re={line:Pe,column:_e};return function(Ae){return Ae.position=new De(Re),ft(),Ae}}function De(Re){this.start=Re,this.end={line:Pe,column:_e},this.source=fe.source}De.prototype.content=ue;function Oe(Re){var Ae=new Error(fe.source+":"+Pe+":"+_e+": "+Re);if(Ae.reason=Re,Ae.filename=fe.source,Ae.line=Pe,Ae.column=_e,Ae.source=ue,!fe.silent)throw Ae}function Ze(Re){var Ae=Re.exec(ue);if(Ae){var Ke=Ae[0];return Ee(Ke),ue=ue.slice(Ke.length),Ae}}function ft(){Ze(g)}function We(Re){var Ae;for(Re=Re||[];Ae=mt();)Ae!==!1&&Re.push(Ae);return Re}function mt(){var Re=Be();if(!(W!=ue.charAt(0)||Q!=ue.charAt(1))){for(var Ae=2;j!=ue.charAt(Ae)&&(Q!=ue.charAt(Ae)||W!=ue.charAt(Ae+1));)++Ae;if(Ae+=2,j===ue.charAt(Ae-1))return Oe("End of comment missing");var Ke=ue.slice(2,Ae-2);return _e+=2,Ee(Ke),ue=ue.slice(Ae),_e+=2,Re({type:V,comment:Ke})}}function st(){var Re=Be(),Ae=Ze(b);if(Ae){if(mt(),!Ze(I))return Oe("property missing ':'");var Ke=Ze(E),rt=Re({type:ae,property:se(Ae[0].replace(m,j)),value:Ke?se(Ke[0].replace(m,j)):j});return Ze(w),rt}}function Ue(){var Re=[];We(Re);for(var Ae;Ae=st();)Ae!==!1&&(Re.push(Ae),We(Re));return Re}return ft(),Ue()};function se(ue){return ue?ue.replace(u,j):j}return ey}var Hx;function fS(){if(Hx)return Ol;Hx=1;var m=Ol&&Ol.__importDefault||function(b){return b&&b.__esModule?b:{default:b}};Object.defineProperty(Ol,"__esModule",{value:!0}),Ol.default=g;var o=m(pS());function g(b,I){var E=null;if(!b||typeof b!="string")return E;var w=(0,o.default)(b),u=typeof I=="function";return w.forEach(function(U){if(U.type==="declaration"){var W=U.property,Q=U.value;u?I(W,Q,U):Q&&(E=E||{},E[W]=Q)}}),E}return Ol}var mS=fS();const Xx=W0(mS),gS=Xx.default||Xx,_S=/\d/,yS=["-","_","/","."];function vS(m=""){if(!_S.test(m))return m!==m.toLowerCase()}function xS(m){const o=[];let g="",b,I;for(const E of m){const w=yS.includes(E);if(w===!0){o.push(g),g="",b=void 0;continue}const u=vS(E);if(I===!1){if(b===!1&&u===!0){o.push(g),g=E,b=u;continue}if(b===!0&&u===!1&&g.length>1){const U=g.at(-1);o.push(g.slice(0,Math.max(0,g.length-1))),g=U+E,b=u;continue}}g+=E,b=u,I=w}return o.push(g),o}function H0(m){return m?xS(m).map(o=>wS(o)).join(""):""}function bS(m){return SS(H0(m||""))}function wS(m){return m?m[0].toUpperCase()+m.slice(1):""}function SS(m){return m?m[0].toLowerCase()+m.slice(1):""}function $u(m){if(!m)return{};const o={};function g(b,I){if(b.startsWith("-moz-")||b.startsWith("-webkit-")||b.startsWith("-ms-")||b.startsWith("-o-")){o[H0(b)]=I;return}if(b.startsWith("--")){o[b]=I;return}o[bS(b)]=I}return gS(m,g),o}function Nl(...m){return(...o)=>{for(const g of m)typeof g=="function"&&g(...o)}}function PS(m,o){const g=RegExp(m,"g");return b=>{if(typeof b!="string")throw new TypeError(`expected an argument of type string, but got ${typeof b}`);return b.match(g)?b.replace(g,o):b}}const TS=PS(/[A-Z]/,m=>`-${m.toLowerCase()}`);function IS(m){if(!m||typeof m!="object"||Array.isArray(m))throw new TypeError(`expected an argument of type object, but got ${typeof m}`);return Object.keys(m).map(o=>`${TS(o)}: ${m[o]};`).join(`
`)}function My(m={}){return IS(m).replace(`
`," ")}const X0={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};My(X0);function AS(m){var o;return m.length>2&&m.startsWith("on")&&m[2]===((o=m[2])==null?void 0:o.toLowerCase())}function ji(...m){const o={...m[0]};for(let g=1;g<m.length;g++){const b=m[g];for(const I in b){const E=o[I],w=b[I],u=typeof E=="function",U=typeof w=="function";if(u&&AS(I)){const W=E,Q=w;o[I]=G0(W,Q)}else if(u&&U)o[I]=Nl(E,w);else if(I==="class"&&typeof E=="string"&&typeof w=="string")o[I]=Z0(E,w);else if(I==="style"){const W=typeof E=="object",Q=typeof w=="object",j=typeof E=="string",V=typeof w=="string";if(W&&Q)o[I]={...E,...w};else if(W&&V){const ae=$u(w);o[I]={...E,...ae}}else if(j&&Q){const ae=$u(E);o[I]={...ae,...w}}else if(j&&V){const ae=$u(E),se=$u(w);o[I]={...ae,...se}}else W?o[I]=E:Q&&(o[I]=w)}else o[I]=w!==void 0?w:E}}return typeof o.style=="object"&&(o.style=My(o.style).replaceAll(`
`," ")),o.hidden!==!0&&(o.hidden=void 0),o.disabled!==!0&&(o.disabled=void 0),o}function ir({id:m,ref:o,deps:g=()=>!0,onRefChange:b=()=>{},getRootNode:I=()=>typeof document<"u"?document:void 0}){const E=Te(()=>g()),w=Te(()=>I());Tt(()=>(m.current,F(E),F(w),ki(()=>{var U;const u=(U=F(w))==null?void 0:U.getElementById(m.current);u?o.current=u:o.current=null,b(o.current)}))),Tt(()=>()=>{o.current=null,b(null)})}function CS(m){Tt(()=>()=>{m()})}function Sp(m,o){setTimeout(o,m)}function Ac(m){Pg().then(m)}function zy(m){return m?"open":"closed"}function ES(m){return m?"true":"false"}function K0(m){return m?"true":"false"}function kS(m){return m?"":void 0}function MS(m){return m?"true":"false"}function zS(m){return m?"":void 0}const DS="ArrowDown",RS="ArrowUp",LS="End",J0="Enter",OS="Escape",FS="Home",BS=" ",NS="Tab",VS="p",jS="n",US="j",qS="k",Dy=typeof document<"u",Kx=ZS();function ZS(){var m,o;return Dy&&((m=window==null?void 0:window.navigator)==null?void 0:m.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((o=window==null?void 0:window.navigator)==null?void 0:o.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function Vf(m){return m instanceof HTMLElement}function GS(m){return m instanceof Element}function WS(m){return m!==null}function HS(m){return m instanceof HTMLInputElement&&"select"in m}function XS(m,o){if(getComputedStyle(m).visibility==="hidden")return!0;for(;m;){if(o!==void 0&&m===o)return!1;if(getComputedStyle(m).display==="none")return!0;m=m.parentElement}return!1}function Jx(m,o){return wp(m,o)}function KS(m,o){const g=m,b=typeof m=="symbol"?m.description:m;if(!A0(g)){if(o===void 0)throw new Error(`Missing context dependency: ${b} and no fallback was provided.`);return o}return Ay(m)}function JS(m,o){return typeof m=="string"&&o===void 0?`${m}Context`:Array.isArray(m)&&o===void 0?`${m[0]}Context`:`${m}Context`}function ja(m,o,g=!0){const b=JS(m,o),I=Symbol.for(`bits-ui.${b}`),E=b;function w(U){const W=KS(g?I:E,U);if(W===void 0)throw new Error(`Context \`${b}\` not found. Component must be used within ${Array.isArray(m)?`one of the following components: ${m.join(", ")}`:`\`${m}\``}`);return W}function u(U){return Jx(g?I:E,U)}return[u,w]}let Yx=0;function fr(m="bits"){return Yx++,`${m}-${Yx}`}function Ki(){}var jl,nh,Ro,Ea,Yo,_y,yy,S0;let YS=(S0=class{constructor(o,g){X(this,Yo);X(this,jl,Je());X(this,nh);X(this,Ro,0);X(this,Ea,null);T(this,jl).v=qe(o),je(this,nh,g)}get current(){return C0()?Tt(()=>(Zu(this,Ro)._++,T(this,Ro)===1&&Er(this,Yo,_y).call(this,!0),()=>{Pg().then(()=>{Zu(this,Ro)._--,T(this,Ro)===0&&Er(this,Yo,yy).call(this)})})):T(this,Ro)===0&&(Er(this,Yo,_y).call(this,!1),Er(this,Yo,yy).call(this)),F(T(this,jl))}},jl=new WeakMap,nh=new WeakMap,Ro=new WeakMap,Ea=new WeakMap,Yo=new WeakSet,_y=function(o){je(this,Ea,T(this,nh).call(this,g=>{Fe(T(this,jl),qe(g))},o)??null)},yy=function(){T(this,Ea)!==null&&(T(this,Ea).call(this),je(this,Ea,null))},S0);new YS(null,(m,o)=>{function g(){m(document.activeElement)}if(g(),!!o)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function $S(m){return typeof m=="function"}function QS(m){return $S(m)?m():m}var Lo;class eP{constructor(o,g={box:"border-box"}){X(this,Lo,Je(qe({width:0,height:0})));var b,I;T(this,Lo).v=qe({width:((b=g.initialSize)==null?void 0:b.width)??0,height:((I=g.initialSize)==null?void 0:I.height)??0}),Tt(()=>{const E=QS(o);if(!E)return;const w=new ResizeObserver(u=>{for(const U of u){const W=g.box==="content-box"?U.contentBoxSize:U.borderBoxSize,Q=Array.isArray(W)?W:[W];F(T(this,Lo)).width=Q.reduce((j,V)=>Math.max(j,V.inlineSize),0),F(T(this,Lo)).height=Q.reduce((j,V)=>Math.max(j,V.blockSize),0)}});return w.observe(E),()=>{w.disconnect()}})}get width(){return F(T(this,Lo)).width}get height(){return F(T(this,Lo)).height}}Lo=new WeakMap;var sh,oh;class tP{constructor(o){X(this,sh,Je());X(this,oh);Tt(()=>{Fe(T(this,sh),qe(T(this,oh))),je(this,oh,o())})}get current(){return F(T(this,sh))}}sh=new WeakMap,oh=new WeakMap;function iP(m,o){const g=we(m);function b(E){return o[g.current][E]??g.current}return{state:g,dispatch:E=>{g.current=b(E)}}}function rP(m,o){let g=Je(qe({})),b=Je("none");const I=m.current?"mounted":"unmounted";let E=Je(null);const w=new tP(()=>m.current);Tt(()=>{o.current&&m.current&&Ac(()=>{Fe(E,qe(document.getElementById(o.current)))})});const{state:u,dispatch:U}=iP(I,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Tt(()=>{const V=m.current;ki(()=>{if(F(E)||Fe(E,qe(document.getElementById(o.current))),!F(E)||!(V!==w.current))return;const se=F(b),ue=Mf(F(E));V?U("MOUNT"):ue==="none"||F(g).display==="none"?U("UNMOUNT"):U(w&&se!==ue?"ANIMATION_OUT":"UNMOUNT")})});function W(V){if(F(E)||Fe(E,qe(document.getElementById(o.current))),!F(E))return;const ae=Mf(F(E)),se=ae.includes(V.animationName)||ae==="none";V.target===F(E)&&se&&U("ANIMATION_END")}function Q(V){F(E)||Fe(E,qe(document.getElementById(o.current))),F(E)&&V.target===F(E)&&Fe(b,qe(Mf(F(E))))}Tt(()=>{u.current,ki(()=>{if(F(E)||Fe(E,qe(document.getElementById(o.current))),!F(E))return;const V=Mf(F(E));Fe(b,qe(u.current==="mounted"?V:"none"))})}),Tt(()=>{if(F(E))return Fe(g,qe(getComputedStyle(F(E)))),F(E).addEventListener("animationstart",Q),F(E).addEventListener("animationcancel",W),F(E).addEventListener("animationend",W),()=>{var V,ae,se;(V=F(E))==null||V.removeEventListener("animationstart",Q),(ae=F(E))==null||ae.removeEventListener("animationcancel",W),(se=F(E))==null||se.removeEventListener("animationend",W)}});const j=Te(()=>["mounted","unmountSuspended"].includes(u.current));return{get current(){return F(j)}}}function Mf(m){return m&&getComputedStyle(m).animationName||"none"}function Ry(m,o){Mt(o,!0);const g=rP(we.with(()=>o.present),we.with(()=>o.id));var b=ut(),I=Xe(b);{var E=w=>{var u=ut(),U=Xe(u);Bt(U,()=>o.presence??ri,()=>({present:g})),Me(w,u)};bi(I,w=>{(o.forceMount||o.present||g.current)&&w(E)})}Me(m,b),zt()}function nP(m){return{content:`data-${m}-content`,trigger:`data-${m}-trigger`,overlay:`data-${m}-overlay`,title:`data-${m}-title`,description:`data-${m}-description`,close:`data-${m}-close`,cancel:`data-${m}-cancel`,action:`data-${m}-action`}}var ah,lh,ch,uh,hh,dh,ph,fh,mh,Gf,Wf;class sP{constructor(o){Ve(this,"open");Ve(this,"variant");X(this,ah,Je(null));X(this,lh,Je(null));X(this,ch,Je(null));X(this,uh,Je(null));X(this,hh,Je(void 0));X(this,dh,Je(void 0));X(this,ph,Je(void 0));X(this,fh,Je(void 0));X(this,mh,Je(null));X(this,Gf,Te(()=>nP(this.variant.current)));Ve(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});Ve(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});X(this,Wf,Te(()=>({"data-state":zy(this.open.current)})));this.open=o.open,this.variant=o.variant}get triggerNode(){return F(T(this,ah))}set triggerNode(o){Fe(T(this,ah),qe(o))}get titleNode(){return F(T(this,lh))}set titleNode(o){Fe(T(this,lh),qe(o))}get contentNode(){return F(T(this,ch))}set contentNode(o){Fe(T(this,ch),qe(o))}get descriptionNode(){return F(T(this,uh))}set descriptionNode(o){Fe(T(this,uh),qe(o))}get contentId(){return F(T(this,hh))}set contentId(o){Fe(T(this,hh),qe(o))}get titleId(){return F(T(this,dh))}set titleId(o){Fe(T(this,dh),qe(o))}get triggerId(){return F(T(this,ph))}set triggerId(o){Fe(T(this,ph),qe(o))}get descriptionId(){return F(T(this,fh))}set descriptionId(o){Fe(T(this,fh),qe(o))}get cancelNode(){return F(T(this,mh))}set cancelNode(o){Fe(T(this,mh),qe(o))}get attrs(){return F(T(this,Gf))}get sharedProps(){return F(T(this,Wf))}}ah=new WeakMap,lh=new WeakMap,ch=new WeakMap,uh=new WeakMap,hh=new WeakMap,dh=new WeakMap,ph=new WeakMap,fh=new WeakMap,mh=new WeakMap,Gf=new WeakMap,Wf=new WeakMap;var Ul,gh,Us,_h,Hf;class oP{constructor(o,g){X(this,Ul);X(this,gh);X(this,Us);X(this,_h);X(this,Hf,Te(()=>({id:T(this,Ul).current,role:"heading","aria-level":T(this,_h).current,[T(this,Us).attrs.title]:"",...T(this,Us).sharedProps})));je(this,Ul,o.id),je(this,Us,g),je(this,gh,o.ref),je(this,_h,o.level),ir({id:T(this,Ul),ref:T(this,gh),onRefChange:b=>{T(this,Us).titleNode=b,T(this,Us).titleId=b==null?void 0:b.id},deps:()=>T(this,Us).open.current})}get props(){return F(T(this,Hf))}}Ul=new WeakMap,gh=new WeakMap,Us=new WeakMap,_h=new WeakMap,Hf=new WeakMap;var ql,yh,qs,Xf;class aP{constructor(o,g){X(this,ql);X(this,yh);X(this,qs);X(this,Xf,Te(()=>({id:T(this,ql).current,[T(this,qs).attrs.description]:"",...T(this,qs).sharedProps})));je(this,ql,o.id),je(this,qs,g),je(this,yh,o.ref),ir({id:T(this,ql),ref:T(this,yh),deps:()=>T(this,qs).open.current,onRefChange:b=>{T(this,qs).descriptionNode=b,T(this,qs).descriptionId=b==null?void 0:b.id}})}get props(){return F(T(this,Xf))}}ql=new WeakMap,yh=new WeakMap,qs=new WeakMap,Xf=new WeakMap;var Zl,vh,Kf,Jf;class lP{constructor(o,g){X(this,Zl);X(this,vh);Ve(this,"root");X(this,Kf,Te(()=>({open:this.root.open.current})));X(this,Jf,Te(()=>({id:T(this,Zl).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));je(this,Zl,o.id),this.root=g,je(this,vh,o.ref),ir({id:T(this,Zl),ref:T(this,vh),deps:()=>this.root.open.current,onRefChange:b=>{this.root.contentNode=b,this.root.contentId=b==null?void 0:b.id}})}get snippetProps(){return F(T(this,Kf))}get props(){return F(T(this,Jf))}}Zl=new WeakMap,vh=new WeakMap,Kf=new WeakMap,Jf=new WeakMap;var Gl,xh,Yf,$f;class cP{constructor(o,g){X(this,Gl);X(this,xh);Ve(this,"root");X(this,Yf,Te(()=>({open:this.root.open.current})));X(this,$f,Te(()=>({id:T(this,Gl).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));je(this,Gl,o.id),je(this,xh,o.ref),this.root=g,ir({id:T(this,Gl),ref:T(this,xh),deps:()=>this.root.open.current})}get snippetProps(){return F(T(this,Yf))}get props(){return F(T(this,$f))}}Gl=new WeakMap,xh=new WeakMap,Yf=new WeakMap,$f=new WeakMap;const[uP,Ag]=ja("Dialog.Root");function hP(m){return uP(new sP(m))}function dP(m){return new oP(m,Ag())}function pP(m){return new lP(m,Ag())}function fP(m){return new cP(m,Ag())}function mP(m){return new aP(m,Ag())}var gP=Gt("<div><!></div>");function _P(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"level",3,2),E=ei(o,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const w=dP({id:we.with(()=>g()),level:we.with(()=>I()),ref:we.with(()=>b(),V=>b(V))}),u=Te(()=>ji(E,w.props));var U=ut(),W=Xe(U);{var Q=V=>{var ae=ut(),se=Xe(ae);Bt(se,()=>o.child,()=>({props:F(u)})),Me(V,ae)},j=V=>{var ae=gP();let se;var ue=Mi(ae);Bt(ue,()=>o.children??ri),zi(ae),fi(()=>se=Qi(ae,se,{...F(u)})),Me(V,ae)};bi(W,V=>{o.child?V(Q):V(j,!1)})}Me(m,U),zt()}function yP(m,o){Mt(o,!0);var g=ut(),b=Xe(g);k0(b,()=>o.children,I=>{var E=ut(),w=Xe(E);Bt(w,()=>o.children??ri),Me(I,E)}),Me(m,g),zt()}function Y0(m,o){Mt(o,!0);let g=te(o,"to",3,"body");const b=i2();let I=Te(E);function E(){if(!Dy||o.disabled)return null;let Q=null;return typeof g()=="string"?Q=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(Q=g()),Q}let w;Tt(()=>{if(!F(I)||o.disabled){w&&(Fx(w),w=null);return}return ki(()=>w=o2(yP,{target:F(I),props:{children:o.children},context:b})),()=>{w&&(Fx(w),w=null)}});var u=ut(),U=Xe(u);{var W=Q=>{var j=ut(),V=Xe(j);Bt(V,()=>o.children??ri),Me(Q,j)};bi(U,Q=>{o.disabled&&Q(W)})}Me(m,u),zt()}function _s(m,o,g,b){const I=Array.isArray(o)?o:[o];return I.forEach(E=>m.addEventListener(E,g,b)),()=>{I.forEach(E=>m.removeEventListener(E,g,b))}}function $x(m,o=500){let g=null;const b=(...I)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{m(...I)},o)};return b.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},b}function Ly(m,o){return m===o||m.contains(o)}function $0(m){return(m==null?void 0:m.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var Wl,ka,Oo,Hl,Fo,Xl,Kl,bh,wh,Sh,Zs,Qf,Ec,Q0,em,Jl,tm,im,rm,nm,Ph,eb,sm,om;class vP{constructor(o){X(this,Ec);X(this,Wl);X(this,ka);X(this,Oo,{pointerdown:!1});X(this,Hl,!1);Ve(this,"node",we(null));X(this,Fo);X(this,Xl);X(this,Kl,Je(!1));X(this,bh);X(this,wh,Je(null));X(this,Sh);X(this,Zs,Ki);X(this,Qf,o=>{o.defaultPrevented||this.currNode&&Ac(()=>{var g,b;!this.currNode||T(this,nm).call(this,o.target)||o.target&&!F(T(this,Kl))&&((b=(g=T(this,bh)).current)==null||b.call(g,o))})});X(this,em,o=>{let g=o;g.defaultPrevented&&(g=Qx(o)),T(this,Wl).current(o)});X(this,Jl,$x(o=>{if(!this.currNode){T(this,Zs).call(this);return}const g=T(this,Sh).current(o,this.currNode)||SP(o,this.currNode);if(!T(this,Hl)||Er(this,Ec,eb).call(this)||!g){T(this,Zs).call(this);return}let b=o;if(b.defaultPrevented&&(b=Qx(b)),T(this,ka).current!=="close"&&T(this,ka).current!=="defer-otherwise-close"){T(this,Zs).call(this);return}o.pointerType==="touch"?(T(this,Zs).call(this),je(this,Zs,_s(T(this,Fo),"click",T(this,em),{once:!0}))):T(this,Wl).current(b)},10));X(this,tm,o=>{T(this,Oo)[o.type]=!0});X(this,im,o=>{T(this,Oo)[o.type]=!1});X(this,rm,()=>{this.node.current&&je(this,Hl,wP(this.node.current))});X(this,nm,o=>this.node.current?Ly(this.node.current,o):!1);X(this,Ph,$x(()=>{for(const o in T(this,Oo))T(this,Oo)[o]=!1;je(this,Hl,!1)},20));X(this,sm,()=>{Fe(T(this,Kl),!0)});X(this,om,()=>{Fe(T(this,Kl),!1)});Ve(this,"props",{onfocuscapture:T(this,sm),onblurcapture:T(this,om)});je(this,Xl,o.enabled),je(this,Sh,o.isValidEvent),ir({id:o.id,ref:this.node,deps:()=>T(this,Xl).current,onRefChange:I=>{this.currNode=I}}),je(this,ka,o.interactOutsideBehavior),je(this,Wl,o.onInteractOutside),je(this,bh,o.onFocusOutside),Tt(()=>{je(this,Fo,$0(this.currNode))});let g=Ki;const b=()=>{T(this,Ph).call(this),globalThis.bitsDismissableLayers.delete(this),T(this,Jl).destroy(),g()};Tt(()=>(T(this,Xl).current&&this.currNode&&Sp(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,ki(()=>T(this,ka))),g(),g=Er(this,Ec,Q0).call(this))}),()=>{b()})),CS(()=>{T(this,Ph).destroy(),globalThis.bitsDismissableLayers.delete(this),T(this,Jl).destroy(),T(this,Zs).call(this),g()})}get currNode(){return F(T(this,wh))}set currNode(o){Fe(T(this,wh),qe(o))}}Wl=new WeakMap,ka=new WeakMap,Oo=new WeakMap,Hl=new WeakMap,Fo=new WeakMap,Xl=new WeakMap,Kl=new WeakMap,bh=new WeakMap,wh=new WeakMap,Sh=new WeakMap,Zs=new WeakMap,Qf=new WeakMap,Ec=new WeakSet,Q0=function(){return Nl(_s(T(this,Fo),"pointerdown",Nl(T(this,tm),T(this,rm)),!0),_s(T(this,Fo),"pointerdown",Nl(T(this,im),T(this,Jl))),_s(T(this,Fo),"focusin",T(this,Qf)))},em=new WeakMap,Jl=new WeakMap,tm=new WeakMap,im=new WeakMap,rm=new WeakMap,nm=new WeakMap,Ph=new WeakMap,eb=function(){return Object.values(T(this,Oo)).some(Boolean)},sm=new WeakMap,om=new WeakMap;function xP(m){return new vP(m)}function bP(m){return m.findLast(([o,{current:g}])=>g==="close"||g==="ignore")}function wP(m){const o=[...globalThis.bitsDismissableLayers],g=bP(o);if(g)return g[0].node.current===m;const[b]=o[0];return b.node.current===m}function SP(m,o){if("button"in m&&m.button>0)return!1;const g=m.target;return GS(g)?$0(g).documentElement.contains(g)&&!Ly(o,g):!1}function Qx(m){const o=m.currentTarget,g=m.target;let b;m instanceof PointerEvent?b=new PointerEvent(m.type,m):b=new PointerEvent("pointerdown",m);let I=!1;return new Proxy(b,{get:(w,u)=>u==="currentTarget"?o:u==="target"?g:u==="preventDefault"?()=>{I=!0,typeof w.preventDefault=="function"&&w.preventDefault()}:u==="defaultPrevented"?I:u in w?w[u]:m[u]})}function tb(m,o){Mt(o,!0);let g=te(o,"interactOutsideBehavior",3,"close"),b=te(o,"onInteractOutside",3,Ki),I=te(o,"onFocusOutside",3,Ki),E=te(o,"isValidEvent",3,()=>!1);const w=xP({id:we.with(()=>o.id),interactOutsideBehavior:we.with(()=>g()),onInteractOutside:we.with(()=>b()),enabled:we.with(()=>o.enabled),onFocusOutside:we.with(()=>I()),isValidEvent:we.with(()=>E())});var u=ut(),U=Xe(u);Bt(U,()=>o.children??ri,()=>({props:w.props})),Me(m,u),zt()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var Th,Yl,Ih,am,lm;class PP{constructor(o){X(this,Th);X(this,Yl);X(this,Ih);X(this,am,()=>_s(document,"keydown",T(this,lm),{passive:!1}));X(this,lm,o=>{if(o.key!==OS||!IP(this))return;const g=new KeyboardEvent(o.type,o);o.preventDefault();const b=T(this,Yl).current;b!=="close"&&b!=="defer-otherwise-close"||T(this,Th).current(g)});je(this,Yl,o.escapeKeydownBehavior),je(this,Th,o.onEscapeKeydown),je(this,Ih,o.enabled);let g=Ki;Tt(()=>(T(this,Ih).current&&(globalThis.bitsEscapeLayers.set(this,ki(()=>T(this,Yl))),g=T(this,am).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}Th=new WeakMap,Yl=new WeakMap,Ih=new WeakMap,am=new WeakMap,lm=new WeakMap;function TP(m){return new PP(m)}function IP(m){const o=[...globalThis.bitsEscapeLayers],g=o.findLast(([I,{current:E}])=>E==="close"||E==="ignore");if(g)return g[0]===m;const[b]=o[0];return b===m}function ib(m,o){Mt(o,!0);let g=te(o,"escapeKeydownBehavior",3,"close"),b=te(o,"onEscapeKeydown",3,Ki);TP({escapeKeydownBehavior:we.with(()=>g()),onEscapeKeydown:we.with(()=>b()),enabled:we.with(()=>o.enabled)});var I=ut(),E=Xe(I);Bt(E,()=>o.children??ri),Me(m,I),zt()}const AP=we([]);function CP(){const m=AP;return{add(o){const g=m.current[0];o.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),m.current=e0(m.current,o),m.current.unshift(o)},remove(o){var g;m.current=e0(m.current,o),(g=m.current[0])==null||g.resume()}}}function EP(){let m=Je(!1);return{id:fr(),get paused(){return F(m)},pause(){Fe(m,!0)},resume(){Fe(m,!1)}}}function e0(m,o){return[...m].filter(g=>g.id!==o.id)}function kP(m){return m.filter(o=>o.tagName!=="A")}function zo(m,{select:o=!1}={}){if(!(m&&m.focus))return;const g=document.activeElement;m.focus({preventScroll:!0}),m!==g&&HS(m)&&o&&m.select()}function MP(m,{select:o=!1}={}){const g=document.activeElement;for(const b of m)if(zo(b,{select:o}),document.activeElement!==g)return!0}function t0(m,o){for(const g of m)if(!XS(g,o))return g}function rb(m){const o=[],g=document.createTreeWalker(m,NodeFilter.SHOW_ELEMENT,{acceptNode:b=>{const I=b.tagName==="INPUT"&&b.type==="hidden";return b.disabled||b.hidden||I?NodeFilter.FILTER_SKIP:b.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)o.push(g.currentNode);return o}function zP(m){const o=rb(m),g=t0(o,m),b=t0(o.reverse(),m);return[g,b]}const DP="focusScope.autoFocusOnMount",RP="focusScope.autoFocusOnDestroy",i0={bubbles:!1,cancelable:!0};function LP({id:m,loop:o,enabled:g,onOpenAutoFocus:b,onCloseAutoFocus:I,forceMount:E}){const w=CP(),u=EP(),U=we(null);ir({id:m,ref:U,deps:()=>g.current});let W=Je(null);Tt(()=>{const se=U.current;if(!se||!g.current)return;function ue(_e){if(u.paused||!se)return;const Ee=_e.target;Vf(Ee)&&(se.contains(Ee)?Fe(W,qe(Ee)):zo(F(W),{select:!0}))}function fe(_e){if(u.paused||!se)return;const Ee=_e.relatedTarget;Vf(Ee)&&Ee!==null&&(se.contains(Ee)||zo(F(W),{select:!0}))}function Pe(_e){(se==null?void 0:se.contains(F(W)))||zo(se)}return ki(()=>{const _e=Nl(_s(document,"focusin",ue),_s(document,"focusout",fe)),Ee=new MutationObserver(Pe);return Ee.observe(se,{childList:!0,subtree:!0}),()=>{_e(),Ee.disconnect()}})}),Tt(()=>{if(E.current)return;let se=U.current;const ue=document.activeElement;return ki(()=>{Q(se,ue)}),()=>{se&&j(ue)}}),Tt(()=>{if(!E.current)return;g.current;const se=U.current,ue=document.activeElement;return ki(()=>{Q(se,ue)}),()=>{se&&j(ue)}});function Q(se,ue){if(se||(se=document.getElementById(m.current)),!se)return;if(w.add(u),!se.contains(ue)){const Pe=new CustomEvent(DP,i0);b.current(Pe),Pe.defaultPrevented||Ac(()=>{se&&(MP(kP(rb(se)),{select:!0}),document.activeElement===ue&&zo(se))})}}function j(se){const ue=new CustomEvent(RP,i0);I.current(ue),setTimeout(()=>{!ue.defaultPrevented&&se&&zo(se??document.body,{select:!0}),w.remove(u)},0)}function V(se){if(!g.current||!o.current&&!g.current||u.paused)return;const ue=se.key===NS&&!se.ctrlKey&&!se.altKey&&!se.metaKey,fe=document.activeElement;if(!(ue&&fe))return;const Pe=U.current;if(!Pe)return;const[_e,Ee]=zP(Pe);_e&&Ee?!se.shiftKey&&fe===Ee?(se.preventDefault(),o.current&&zo(_e,{select:!0})):se.shiftKey&&fe===_e&&(se.preventDefault(),o.current&&zo(Ee,{select:!0})):fe===Pe&&se.preventDefault()}const ae=Te(()=>({id:m.current,tabindex:-1,onkeydown:V}));return{get props(){return F(ae)}}}function nb(m,o){Mt(o,!0);let g=te(o,"trapFocus",3,!1),b=te(o,"loop",3,!1),I=te(o,"onCloseAutoFocus",3,Ki),E=te(o,"onOpenAutoFocus",3,Ki),w=te(o,"forceMount",3,!1);const u=LP({enabled:we.with(()=>g()),loop:we.with(()=>b()),onCloseAutoFocus:we.with(()=>I()),onOpenAutoFocus:we.with(()=>E()),id:we.with(()=>o.id),forceMount:we.with(()=>w())});var U=ut(),W=Xe(U);Bt(W,()=>o.focusScope??ri,()=>({props:u.props})),Me(m,U),zt()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Ah,Ch,Eh,Bo,$l,kh,cm,sb,um,Mh;class OP{constructor(o){X(this,cm);X(this,Ah);X(this,Ch);X(this,Eh);X(this,Bo);X(this,$l,Ki);X(this,kh,we(null));X(this,um,o=>{const g=T(this,kh).current,b=o.target;!Vf(g)||!Vf(b)||!T(this,Bo).current||!NP(this)||!Ly(g,b)||(T(this,Ch).current(o),!o.defaultPrevented&&je(this,$l,BP(g)))});X(this,Mh,()=>{T(this,$l).call(this),je(this,$l,Ki)});je(this,Ah,o.id),je(this,Bo,o.preventOverflowTextSelection),je(this,Ch,o.onPointerDown),je(this,Eh,o.onPointerUp),ir({id:T(this,Ah),ref:T(this,kh),deps:()=>T(this,Bo).current});let g=Ki;Tt(()=>(T(this,Bo).current&&(globalThis.bitsTextSelectionLayers.set(this,ki(()=>T(this,Bo))),g=Er(this,cm,sb).call(this)),()=>{g(),T(this,Mh).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Ah=new WeakMap,Ch=new WeakMap,Eh=new WeakMap,Bo=new WeakMap,$l=new WeakMap,kh=new WeakMap,cm=new WeakSet,sb=function(){return Nl(_s(document,"pointerdown",T(this,um)),_s(document,"pointerup",G0(T(this,Mh),T(this,Eh))))},um=new WeakMap,Mh=new WeakMap;function FP(m){return new OP(m)}const r0=m=>m.style.userSelect||m.style.webkitUserSelect;function BP(m){const o=document.body,g=r0(o),b=r0(m);return zf(o,"none"),zf(m,"text"),()=>{zf(o,g),zf(m,b)}}function zf(m,o){m.style.userSelect=o,m.style.webkitUserSelect=o}function NP(m){const o=[...globalThis.bitsTextSelectionLayers];if(!o.length)return!1;const g=o.at(-1);return g?g[0]===m:!1}function ob(m,o){Mt(o,!0);let g=te(o,"preventOverflowTextSelection",3,!0),b=te(o,"onPointerDown",3,Ki),I=te(o,"onPointerUp",3,Ki);FP({id:we.with(()=>o.id),preventOverflowTextSelection:we.with(()=>g()),onPointerDown:we.with(()=>b()),onPointerUp:we.with(()=>I()),enabled:we.with(()=>o.enabled)});var E=ut(),w=Xe(E);Bt(w,()=>o.children??ri),Me(m,E),zt()}var VP=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],jP=["difference","intersection","symmetricDifference","union"],n0=!1,Ql,Jn,No,hm,ab;const dm=class dm extends Set{constructor(g){super();X(this,hm);X(this,Ql,new Map);X(this,Jn,js(0));X(this,No,js(0));if(g){for(var b of g)super.add(b);T(this,No).v=super.size}n0||Er(this,hm,ab).call(this)}has(g){var b=super.has(g),I=T(this,Ql),E=I.get(g);if(E===void 0){if(!b)return F(T(this,Jn)),!1;E=js(!0),I.set(g,E)}return F(E),b}add(g){return super.has(g)||(super.add(g),Fe(T(this,No),super.size),Do(T(this,Jn))),this}delete(g){var b=super.delete(g),I=T(this,Ql),E=I.get(g);return E!==void 0&&(I.delete(g),Fe(E,!1)),b&&(Fe(T(this,No),super.size),Do(T(this,Jn))),b}clear(){if(super.size!==0){super.clear();var g=T(this,Ql);for(var b of g.values())Fe(b,!1);g.clear(),Fe(T(this,No),0),Do(T(this,Jn))}}keys(){return this.values()}values(){return F(T(this,Jn)),super.values()}entries(){return F(T(this,Jn)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return F(T(this,No))}};Ql=new WeakMap,Jn=new WeakMap,No=new WeakMap,hm=new WeakSet,ab=function(){n0=!0;var g=dm.prototype,b=Set.prototype;for(const I of VP)g[I]=function(...E){return F(T(this,Jn)),b[I].apply(this,E)};for(const I of jP)g[I]=function(...E){F(T(this,Jn));var w=b[I].apply(this,E);return new dm(w)}};let vy=dm;var ds,ps,Gs,ec,Ff;const Xy=class Xy extends Map{constructor(g){super();X(this,ec);X(this,ds,new Map);X(this,ps,js(0));X(this,Gs,js(0));if(g){for(var[b,I]of g)super.set(b,I);T(this,Gs).v=super.size}}has(g){var b=T(this,ds),I=b.get(g);if(I===void 0){var E=super.get(g);if(E!==void 0)I=js(0),b.set(g,I);else return F(T(this,ps)),!1}return F(I),!0}forEach(g,b){Er(this,ec,Ff).call(this),super.forEach(g,b)}get(g){var b=T(this,ds),I=b.get(g);if(I===void 0){var E=super.get(g);if(E!==void 0)I=js(0),b.set(g,I);else{F(T(this,ps));return}}return F(I),super.get(g)}set(g,b){var j;var I=T(this,ds),E=I.get(g),w=super.get(g),u=super.set(g,b),U=T(this,ps);if(E===void 0)I.set(g,js(0)),Fe(T(this,Gs),super.size),Do(U);else if(w!==b){Do(E);var W=U.reactions===null?null:new Set(U.reactions),Q=W===null||!((j=E.reactions)!=null&&j.every(V=>W.has(V)));Q&&Do(U)}return u}delete(g){var b=T(this,ds),I=b.get(g),E=super.delete(g);return I!==void 0&&(b.delete(g),Fe(T(this,Gs),super.size),Fe(I,-1),Do(T(this,ps))),E}clear(){if(super.size!==0){super.clear();var g=T(this,ds);Fe(T(this,Gs),0);for(var b of g.values())Fe(b,-1);Do(T(this,ps)),g.clear()}}keys(){return F(T(this,ps)),super.keys()}values(){return Er(this,ec,Ff).call(this),super.values()}entries(){return Er(this,ec,Ff).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return F(T(this,Gs)),super.size}};ds=new WeakMap,ps=new WeakMap,Gs=new WeakMap,ec=new WeakSet,Ff=function(){F(T(this,ps));var g=T(this,ds);if(T(this,Gs).v!==g.size)for(var b of Dx(Xy.prototype,this,"keys").call(this))g.has(b)||g.set(b,js(0));for(var[,I]of T(this,ds))F(I)};let xy=Xy;function UP(m){let o=0,g=Je(void 0),b;function I(){o-=1,b&&o<=0&&(b(),Fe(g,void 0),b=void 0)}return(...E)=>(o+=1,F(g)===void 0&&(b=r2(()=>{Fe(g,qe(m(...E)))})),Tt(()=>()=>{I()}),F(g))}const qP=UP(()=>{const m=new xy,o=Te(()=>{for(const E of m.values())if(E)return!0;return!1});let g=qe({}),b=null;function I(){Dy&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",Kx&&(b==null||b()))}return Tt(()=>{const E=F(o);return ki(()=>{if(!E)return;const w=getComputedStyle(document.body);g.overflow=w.overflow,g.paddingRight=w.paddingRight,g.marginRight=w.marginRight,g.pointerEvents=w.pointerEvents;const u=window.innerWidth-document.documentElement.clientWidth,W={padding:Number.parseInt(g.paddingRight??"0",10)+u,margin:Number.parseInt(g.marginRight??"0",10)};u>0&&(document.body.style.paddingRight=`${W.padding}px`,document.body.style.marginRight=`${W.margin}px`,document.body.style.setProperty("--scrollbar-width",`${u}px`),document.body.style.overflow="hidden"),Kx&&(b=_s(document,"touchmove",Q=>{Q.target===document.documentElement&&(Q.touches.length>1||Q.preventDefault())},{passive:!1})),Ac(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Tt(()=>()=>{b==null||b()}),{get map(){return m},resetBodyStyle:I}});function ZP(m,o=()=>null){const g=fr(),b=qP(),I=Te(o);b.map.set(g,m??!1);const E=we.with(()=>b.map.get(g)??!1,w=>b.map.set(g,w));return Tt(()=>()=>{b.map.delete(g),!GP(b.map)&&(F(I)===null?requestAnimationFrame(()=>b.resetBodyStyle()):Sp(F(I),()=>b.resetBodyStyle()))}),E}function GP(m){for(const[o,g]of m)if(g)return!0;return!1}function jf(m,o){Mt(o,!0);let g=te(o,"preventScroll",3,!0),b=te(o,"restoreScrollDelay",3,null);ZP(g(),()=>b()),zt()}function WP({forceMount:m,present:o,trapFocus:g,open:b}){return m?b&&g:o&&g&&b}var HP=Gt("<div><!></div>");function XP(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"forceMount",3,!1),I=te(o,"ref",15,null),E=ei(o,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const w=fP({id:we.with(()=>g()),ref:we.with(()=>I(),W=>I(W))}),u=Te(()=>ji(E,w.props));var U=Te(()=>w.root.open.current||b());Ry(m,{get id(){return g()},get present(){return F(U)},presence:Q=>{var j=ut(),V=Xe(j);{var ae=ue=>{var fe=ut(),Pe=Xe(fe),_e=Tg(()=>({props:ji(F(u)),...w.snippetProps}));Bt(Pe,()=>o.child,()=>F(_e)),Me(ue,fe)},se=ue=>{var fe=HP();const Pe=Te(()=>ji(F(u)));let _e;var Ee=Mi(fe);Bt(Ee,()=>o.children??ri,()=>w.snippetProps),zi(fe),fi(()=>_e=Qi(fe,_e,{...F(Pe)})),Me(ue,fe)};bi(V,ue=>{o.child?ue(ae):ue(se,!1)})}Me(Q,j)},$$slots:{presence:!0}}),zt()}var KP=Gt("<div><!></div>");function JP(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","children","child","ref"]);const E=mP({id:we.with(()=>g()),ref:we.with(()=>b(),j=>b(j))}),w=Te(()=>ji(I,E.props));var u=ut(),U=Xe(u);{var W=j=>{var V=ut(),ae=Xe(V);Bt(ae,()=>o.child,()=>({props:F(w)})),Me(j,V)},Q=j=>{var V=KP();let ae;var se=Mi(V);Bt(se,()=>o.children??ri),zi(V),fi(()=>ae=Qi(V,ae,{...F(w)})),Me(j,V)};bi(U,j=>{o.child?j(W):j(Q,!1)})}Me(m,u),zt()}const YP=["top","right","bottom","left"],Xo=Math.min,Mn=Math.max,Uf=Math.round,Df=Math.floor,ys=m=>({x:m,y:m}),$P={left:"right",right:"left",bottom:"top",top:"bottom"},QP={start:"end",end:"start"};function by(m,o,g){return Mn(m,Xo(o,g))}function Ws(m,o){return typeof m=="function"?m(o):m}function Hs(m){return m.split("-")[0]}function zc(m){return m.split("-")[1]}function Oy(m){return m==="x"?"y":"x"}function Fy(m){return m==="y"?"height":"width"}function Ko(m){return["top","bottom"].includes(Hs(m))?"y":"x"}function By(m){return Oy(Ko(m))}function eT(m,o,g){g===void 0&&(g=!1);const b=zc(m),I=By(m),E=Fy(I);let w=I==="x"?b===(g?"end":"start")?"right":"left":b==="start"?"bottom":"top";return o.reference[E]>o.floating[E]&&(w=qf(w)),[w,qf(w)]}function tT(m){const o=qf(m);return[wy(m),o,wy(o)]}function wy(m){return m.replace(/start|end/g,o=>QP[o])}function iT(m,o,g){const b=["left","right"],I=["right","left"],E=["top","bottom"],w=["bottom","top"];switch(m){case"top":case"bottom":return g?o?I:b:o?b:I;case"left":case"right":return o?E:w;default:return[]}}function rT(m,o,g,b){const I=zc(m);let E=iT(Hs(m),g==="start",b);return I&&(E=E.map(w=>w+"-"+I),o&&(E=E.concat(E.map(wy)))),E}function qf(m){return m.replace(/left|right|bottom|top/g,o=>$P[o])}function nT(m){return{top:0,right:0,bottom:0,left:0,...m}}function lb(m){return typeof m!="number"?nT(m):{top:m,right:m,bottom:m,left:m}}function Zf(m){const{x:o,y:g,width:b,height:I}=m;return{width:b,height:I,top:g,left:o,right:o+b,bottom:g+I,x:o,y:g}}function s0(m,o,g){let{reference:b,floating:I}=m;const E=Ko(o),w=By(o),u=Fy(w),U=Hs(o),W=E==="y",Q=b.x+b.width/2-I.width/2,j=b.y+b.height/2-I.height/2,V=b[u]/2-I[u]/2;let ae;switch(U){case"top":ae={x:Q,y:b.y-I.height};break;case"bottom":ae={x:Q,y:b.y+b.height};break;case"right":ae={x:b.x+b.width,y:j};break;case"left":ae={x:b.x-I.width,y:j};break;default:ae={x:b.x,y:b.y}}switch(zc(o)){case"start":ae[w]-=V*(g&&W?-1:1);break;case"end":ae[w]+=V*(g&&W?-1:1);break}return ae}const sT=async(m,o,g)=>{const{placement:b="bottom",strategy:I="absolute",middleware:E=[],platform:w}=g,u=E.filter(Boolean),U=await(w.isRTL==null?void 0:w.isRTL(o));let W=await w.getElementRects({reference:m,floating:o,strategy:I}),{x:Q,y:j}=s0(W,b,U),V=b,ae={},se=0;for(let ue=0;ue<u.length;ue++){const{name:fe,fn:Pe}=u[ue],{x:_e,y:Ee,data:Be,reset:De}=await Pe({x:Q,y:j,initialPlacement:b,placement:V,strategy:I,middlewareData:ae,rects:W,platform:w,elements:{reference:m,floating:o}});Q=_e??Q,j=Ee??j,ae={...ae,[fe]:{...ae[fe],...Be}},De&&se<=50&&(se++,typeof De=="object"&&(De.placement&&(V=De.placement),De.rects&&(W=De.rects===!0?await w.getElementRects({reference:m,floating:o,strategy:I}):De.rects),{x:Q,y:j}=s0(W,V,U)),ue=-1)}return{x:Q,y:j,placement:V,strategy:I,middlewareData:ae}};async function ih(m,o){var g;o===void 0&&(o={});const{x:b,y:I,platform:E,rects:w,elements:u,strategy:U}=m,{boundary:W="clippingAncestors",rootBoundary:Q="viewport",elementContext:j="floating",altBoundary:V=!1,padding:ae=0}=Ws(o,m),se=lb(ae),fe=u[V?j==="floating"?"reference":"floating":j],Pe=Zf(await E.getClippingRect({element:(g=await(E.isElement==null?void 0:E.isElement(fe)))==null||g?fe:fe.contextElement||await(E.getDocumentElement==null?void 0:E.getDocumentElement(u.floating)),boundary:W,rootBoundary:Q,strategy:U})),_e=j==="floating"?{x:b,y:I,width:w.floating.width,height:w.floating.height}:w.reference,Ee=await(E.getOffsetParent==null?void 0:E.getOffsetParent(u.floating)),Be=await(E.isElement==null?void 0:E.isElement(Ee))?await(E.getScale==null?void 0:E.getScale(Ee))||{x:1,y:1}:{x:1,y:1},De=Zf(E.convertOffsetParentRelativeRectToViewportRelativeRect?await E.convertOffsetParentRelativeRectToViewportRelativeRect({elements:u,rect:_e,offsetParent:Ee,strategy:U}):_e);return{top:(Pe.top-De.top+se.top)/Be.y,bottom:(De.bottom-Pe.bottom+se.bottom)/Be.y,left:(Pe.left-De.left+se.left)/Be.x,right:(De.right-Pe.right+se.right)/Be.x}}const oT=m=>({name:"arrow",options:m,async fn(o){const{x:g,y:b,placement:I,rects:E,platform:w,elements:u,middlewareData:U}=o,{element:W,padding:Q=0}=Ws(m,o)||{};if(W==null)return{};const j=lb(Q),V={x:g,y:b},ae=By(I),se=Fy(ae),ue=await w.getDimensions(W),fe=ae==="y",Pe=fe?"top":"left",_e=fe?"bottom":"right",Ee=fe?"clientHeight":"clientWidth",Be=E.reference[se]+E.reference[ae]-V[ae]-E.floating[se],De=V[ae]-E.reference[ae],Oe=await(w.getOffsetParent==null?void 0:w.getOffsetParent(W));let Ze=Oe?Oe[Ee]:0;(!Ze||!await(w.isElement==null?void 0:w.isElement(Oe)))&&(Ze=u.floating[Ee]||E.floating[se]);const ft=Be/2-De/2,We=Ze/2-ue[se]/2-1,mt=Xo(j[Pe],We),st=Xo(j[_e],We),Ue=mt,Re=Ze-ue[se]-st,Ae=Ze/2-ue[se]/2+ft,Ke=by(Ue,Ae,Re),rt=!U.arrow&&zc(I)!=null&&Ae!==Ke&&E.reference[se]/2-(Ae<Ue?mt:st)-ue[se]/2<0,_t=rt?Ae<Ue?Ae-Ue:Ae-Re:0;return{[ae]:V[ae]+_t,data:{[ae]:Ke,centerOffset:Ae-Ke-_t,...rt&&{alignmentOffset:_t}},reset:rt}}}),aT=function(m){return m===void 0&&(m={}),{name:"flip",options:m,async fn(o){var g,b;const{placement:I,middlewareData:E,rects:w,initialPlacement:u,platform:U,elements:W}=o,{mainAxis:Q=!0,crossAxis:j=!0,fallbackPlacements:V,fallbackStrategy:ae="bestFit",fallbackAxisSideDirection:se="none",flipAlignment:ue=!0,...fe}=Ws(m,o);if((g=E.arrow)!=null&&g.alignmentOffset)return{};const Pe=Hs(I),_e=Ko(u),Ee=Hs(u)===u,Be=await(U.isRTL==null?void 0:U.isRTL(W.floating)),De=V||(Ee||!ue?[qf(u)]:tT(u)),Oe=se!=="none";!V&&Oe&&De.push(...rT(u,ue,se,Be));const Ze=[u,...De],ft=await ih(o,fe),We=[];let mt=((b=E.flip)==null?void 0:b.overflows)||[];if(Q&&We.push(ft[Pe]),j){const Ae=eT(I,w,Be);We.push(ft[Ae[0]],ft[Ae[1]])}if(mt=[...mt,{placement:I,overflows:We}],!We.every(Ae=>Ae<=0)){var st,Ue;const Ae=(((st=E.flip)==null?void 0:st.index)||0)+1,Ke=Ze[Ae];if(Ke)return{data:{index:Ae,overflows:mt},reset:{placement:Ke}};let rt=(Ue=mt.filter(_t=>_t.overflows[0]<=0).sort((_t,yt)=>_t.overflows[1]-yt.overflows[1])[0])==null?void 0:Ue.placement;if(!rt)switch(ae){case"bestFit":{var Re;const _t=(Re=mt.filter(yt=>{if(Oe){const ht=Ko(yt.placement);return ht===_e||ht==="y"}return!0}).map(yt=>[yt.placement,yt.overflows.filter(ht=>ht>0).reduce((ht,xt)=>ht+xt,0)]).sort((yt,ht)=>yt[1]-ht[1])[0])==null?void 0:Re[0];_t&&(rt=_t);break}case"initialPlacement":rt=u;break}if(I!==rt)return{reset:{placement:rt}}}return{}}}};function o0(m,o){return{top:m.top-o.height,right:m.right-o.width,bottom:m.bottom-o.height,left:m.left-o.width}}function a0(m){return YP.some(o=>m[o]>=0)}const lT=function(m){return m===void 0&&(m={}),{name:"hide",options:m,async fn(o){const{rects:g}=o,{strategy:b="referenceHidden",...I}=Ws(m,o);switch(b){case"referenceHidden":{const E=await ih(o,{...I,elementContext:"reference"}),w=o0(E,g.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:a0(w)}}}case"escaped":{const E=await ih(o,{...I,altBoundary:!0}),w=o0(E,g.floating);return{data:{escapedOffsets:w,escaped:a0(w)}}}default:return{}}}}};async function cT(m,o){const{placement:g,platform:b,elements:I}=m,E=await(b.isRTL==null?void 0:b.isRTL(I.floating)),w=Hs(g),u=zc(g),U=Ko(g)==="y",W=["left","top"].includes(w)?-1:1,Q=E&&U?-1:1,j=Ws(o,m);let{mainAxis:V,crossAxis:ae,alignmentAxis:se}=typeof j=="number"?{mainAxis:j,crossAxis:0,alignmentAxis:null}:{mainAxis:j.mainAxis||0,crossAxis:j.crossAxis||0,alignmentAxis:j.alignmentAxis};return u&&typeof se=="number"&&(ae=u==="end"?se*-1:se),U?{x:ae*Q,y:V*W}:{x:V*W,y:ae*Q}}const uT=function(m){return m===void 0&&(m=0),{name:"offset",options:m,async fn(o){var g,b;const{x:I,y:E,placement:w,middlewareData:u}=o,U=await cT(o,m);return w===((g=u.offset)==null?void 0:g.placement)&&(b=u.arrow)!=null&&b.alignmentOffset?{}:{x:I+U.x,y:E+U.y,data:{...U,placement:w}}}}},hT=function(m){return m===void 0&&(m={}),{name:"shift",options:m,async fn(o){const{x:g,y:b,placement:I}=o,{mainAxis:E=!0,crossAxis:w=!1,limiter:u={fn:fe=>{let{x:Pe,y:_e}=fe;return{x:Pe,y:_e}}},...U}=Ws(m,o),W={x:g,y:b},Q=await ih(o,U),j=Ko(Hs(I)),V=Oy(j);let ae=W[V],se=W[j];if(E){const fe=V==="y"?"top":"left",Pe=V==="y"?"bottom":"right",_e=ae+Q[fe],Ee=ae-Q[Pe];ae=by(_e,ae,Ee)}if(w){const fe=j==="y"?"top":"left",Pe=j==="y"?"bottom":"right",_e=se+Q[fe],Ee=se-Q[Pe];se=by(_e,se,Ee)}const ue=u.fn({...o,[V]:ae,[j]:se});return{...ue,data:{x:ue.x-g,y:ue.y-b,enabled:{[V]:E,[j]:w}}}}}},dT=function(m){return m===void 0&&(m={}),{options:m,fn(o){const{x:g,y:b,placement:I,rects:E,middlewareData:w}=o,{offset:u=0,mainAxis:U=!0,crossAxis:W=!0}=Ws(m,o),Q={x:g,y:b},j=Ko(I),V=Oy(j);let ae=Q[V],se=Q[j];const ue=Ws(u,o),fe=typeof ue=="number"?{mainAxis:ue,crossAxis:0}:{mainAxis:0,crossAxis:0,...ue};if(U){const Ee=V==="y"?"height":"width",Be=E.reference[V]-E.floating[Ee]+fe.mainAxis,De=E.reference[V]+E.reference[Ee]-fe.mainAxis;ae<Be?ae=Be:ae>De&&(ae=De)}if(W){var Pe,_e;const Ee=V==="y"?"width":"height",Be=["top","left"].includes(Hs(I)),De=E.reference[j]-E.floating[Ee]+(Be&&((Pe=w.offset)==null?void 0:Pe[j])||0)+(Be?0:fe.crossAxis),Oe=E.reference[j]+E.reference[Ee]+(Be?0:((_e=w.offset)==null?void 0:_e[j])||0)-(Be?fe.crossAxis:0);se<De?se=De:se>Oe&&(se=Oe)}return{[V]:ae,[j]:se}}}},pT=function(m){return m===void 0&&(m={}),{name:"size",options:m,async fn(o){var g,b;const{placement:I,rects:E,platform:w,elements:u}=o,{apply:U=()=>{},...W}=Ws(m,o),Q=await ih(o,W),j=Hs(I),V=zc(I),ae=Ko(I)==="y",{width:se,height:ue}=E.floating;let fe,Pe;j==="top"||j==="bottom"?(fe=j,Pe=V===(await(w.isRTL==null?void 0:w.isRTL(u.floating))?"start":"end")?"left":"right"):(Pe=j,fe=V==="end"?"top":"bottom");const _e=ue-Q.top-Q.bottom,Ee=se-Q.left-Q.right,Be=Xo(ue-Q[fe],_e),De=Xo(se-Q[Pe],Ee),Oe=!o.middlewareData.shift;let Ze=Be,ft=De;if((g=o.middlewareData.shift)!=null&&g.enabled.x&&(ft=Ee),(b=o.middlewareData.shift)!=null&&b.enabled.y&&(Ze=_e),Oe&&!V){const mt=Mn(Q.left,0),st=Mn(Q.right,0),Ue=Mn(Q.top,0),Re=Mn(Q.bottom,0);ae?ft=se-2*(mt!==0||st!==0?mt+st:Mn(Q.left,Q.right)):Ze=ue-2*(Ue!==0||Re!==0?Ue+Re:Mn(Q.top,Q.bottom))}await U({...o,availableWidth:ft,availableHeight:Ze});const We=await w.getDimensions(u.floating);return se!==We.width||ue!==We.height?{reset:{rects:!0}}:{}}}};function Cg(){return typeof window<"u"}function Dc(m){return cb(m)?(m.nodeName||"").toLowerCase():"#document"}function zn(m){var o;return(m==null||(o=m.ownerDocument)==null?void 0:o.defaultView)||window}function xs(m){var o;return(o=(cb(m)?m.ownerDocument:m.document)||window.document)==null?void 0:o.documentElement}function cb(m){return Cg()?m instanceof Node||m instanceof zn(m).Node:!1}function $n(m){return Cg()?m instanceof Element||m instanceof zn(m).Element:!1}function vs(m){return Cg()?m instanceof HTMLElement||m instanceof zn(m).HTMLElement:!1}function l0(m){return!Cg()||typeof ShadowRoot>"u"?!1:m instanceof ShadowRoot||m instanceof zn(m).ShadowRoot}function Pp(m){const{overflow:o,overflowX:g,overflowY:b,display:I}=Qn(m);return/auto|scroll|overlay|hidden|clip/.test(o+b+g)&&!["inline","contents"].includes(I)}function fT(m){return["table","td","th"].includes(Dc(m))}function Eg(m){return[":popover-open",":modal"].some(o=>{try{return m.matches(o)}catch{return!1}})}function Ny(m){const o=Vy(),g=$n(m)?Qn(m):m;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!o&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!o&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(b=>(g.willChange||"").includes(b))||["paint","layout","strict","content"].some(b=>(g.contain||"").includes(b))}function mT(m){let o=Jo(m);for(;vs(o)&&!Cc(o);){if(Ny(o))return o;if(Eg(o))return null;o=Jo(o)}return null}function Vy(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Cc(m){return["html","body","#document"].includes(Dc(m))}function Qn(m){return zn(m).getComputedStyle(m)}function kg(m){return $n(m)?{scrollLeft:m.scrollLeft,scrollTop:m.scrollTop}:{scrollLeft:m.scrollX,scrollTop:m.scrollY}}function Jo(m){if(Dc(m)==="html")return m;const o=m.assignedSlot||m.parentNode||l0(m)&&m.host||xs(m);return l0(o)?o.host:o}function ub(m){const o=Jo(m);return Cc(o)?m.ownerDocument?m.ownerDocument.body:m.body:vs(o)&&Pp(o)?o:ub(o)}function rh(m,o,g){var b;o===void 0&&(o=[]),g===void 0&&(g=!0);const I=ub(m),E=I===((b=m.ownerDocument)==null?void 0:b.body),w=zn(I);if(E){const u=Sy(w);return o.concat(w,w.visualViewport||[],Pp(I)?I:[],u&&g?rh(u):[])}return o.concat(I,rh(I,[],g))}function Sy(m){return m.parent&&Object.getPrototypeOf(m.parent)?m.frameElement:null}function hb(m){const o=Qn(m);let g=parseFloat(o.width)||0,b=parseFloat(o.height)||0;const I=vs(m),E=I?m.offsetWidth:g,w=I?m.offsetHeight:b,u=Uf(g)!==E||Uf(b)!==w;return u&&(g=E,b=w),{width:g,height:b,$:u}}function jy(m){return $n(m)?m:m.contextElement}function Vl(m){const o=jy(m);if(!vs(o))return ys(1);const g=o.getBoundingClientRect(),{width:b,height:I,$:E}=hb(o);let w=(E?Uf(g.width):g.width)/b,u=(E?Uf(g.height):g.height)/I;return(!w||!Number.isFinite(w))&&(w=1),(!u||!Number.isFinite(u))&&(u=1),{x:w,y:u}}const gT=ys(0);function db(m){const o=zn(m);return!Vy()||!o.visualViewport?gT:{x:o.visualViewport.offsetLeft,y:o.visualViewport.offsetTop}}function _T(m,o,g){return o===void 0&&(o=!1),!g||o&&g!==zn(m)?!1:o}function Va(m,o,g,b){o===void 0&&(o=!1),g===void 0&&(g=!1);const I=m.getBoundingClientRect(),E=jy(m);let w=ys(1);o&&(b?$n(b)&&(w=Vl(b)):w=Vl(m));const u=_T(E,g,b)?db(E):ys(0);let U=(I.left+u.x)/w.x,W=(I.top+u.y)/w.y,Q=I.width/w.x,j=I.height/w.y;if(E){const V=zn(E),ae=b&&$n(b)?zn(b):b;let se=V,ue=Sy(se);for(;ue&&b&&ae!==se;){const fe=Vl(ue),Pe=ue.getBoundingClientRect(),_e=Qn(ue),Ee=Pe.left+(ue.clientLeft+parseFloat(_e.paddingLeft))*fe.x,Be=Pe.top+(ue.clientTop+parseFloat(_e.paddingTop))*fe.y;U*=fe.x,W*=fe.y,Q*=fe.x,j*=fe.y,U+=Ee,W+=Be,se=zn(ue),ue=Sy(se)}}return Zf({width:Q,height:j,x:U,y:W})}function Uy(m,o){const g=kg(m).scrollLeft;return o?o.left+g:Va(xs(m)).left+g}function pb(m,o,g){g===void 0&&(g=!1);const b=m.getBoundingClientRect(),I=b.left+o.scrollLeft-(g?0:Uy(m,b)),E=b.top+o.scrollTop;return{x:I,y:E}}function yT(m){let{elements:o,rect:g,offsetParent:b,strategy:I}=m;const E=I==="fixed",w=xs(b),u=o?Eg(o.floating):!1;if(b===w||u&&E)return g;let U={scrollLeft:0,scrollTop:0},W=ys(1);const Q=ys(0),j=vs(b);if((j||!j&&!E)&&((Dc(b)!=="body"||Pp(w))&&(U=kg(b)),vs(b))){const ae=Va(b);W=Vl(b),Q.x=ae.x+b.clientLeft,Q.y=ae.y+b.clientTop}const V=w&&!j&&!E?pb(w,U,!0):ys(0);return{width:g.width*W.x,height:g.height*W.y,x:g.x*W.x-U.scrollLeft*W.x+Q.x+V.x,y:g.y*W.y-U.scrollTop*W.y+Q.y+V.y}}function vT(m){return Array.from(m.getClientRects())}function xT(m){const o=xs(m),g=kg(m),b=m.ownerDocument.body,I=Mn(o.scrollWidth,o.clientWidth,b.scrollWidth,b.clientWidth),E=Mn(o.scrollHeight,o.clientHeight,b.scrollHeight,b.clientHeight);let w=-g.scrollLeft+Uy(m);const u=-g.scrollTop;return Qn(b).direction==="rtl"&&(w+=Mn(o.clientWidth,b.clientWidth)-I),{width:I,height:E,x:w,y:u}}function bT(m,o){const g=zn(m),b=xs(m),I=g.visualViewport;let E=b.clientWidth,w=b.clientHeight,u=0,U=0;if(I){E=I.width,w=I.height;const W=Vy();(!W||W&&o==="fixed")&&(u=I.offsetLeft,U=I.offsetTop)}return{width:E,height:w,x:u,y:U}}function wT(m,o){const g=Va(m,!0,o==="fixed"),b=g.top+m.clientTop,I=g.left+m.clientLeft,E=vs(m)?Vl(m):ys(1),w=m.clientWidth*E.x,u=m.clientHeight*E.y,U=I*E.x,W=b*E.y;return{width:w,height:u,x:U,y:W}}function c0(m,o,g){let b;if(o==="viewport")b=bT(m,g);else if(o==="document")b=xT(xs(m));else if($n(o))b=wT(o,g);else{const I=db(m);b={x:o.x-I.x,y:o.y-I.y,width:o.width,height:o.height}}return Zf(b)}function fb(m,o){const g=Jo(m);return g===o||!$n(g)||Cc(g)?!1:Qn(g).position==="fixed"||fb(g,o)}function ST(m,o){const g=o.get(m);if(g)return g;let b=rh(m,[],!1).filter(u=>$n(u)&&Dc(u)!=="body"),I=null;const E=Qn(m).position==="fixed";let w=E?Jo(m):m;for(;$n(w)&&!Cc(w);){const u=Qn(w),U=Ny(w);!U&&u.position==="fixed"&&(I=null),(E?!U&&!I:!U&&u.position==="static"&&!!I&&["absolute","fixed"].includes(I.position)||Pp(w)&&!U&&fb(m,w))?b=b.filter(Q=>Q!==w):I=u,w=Jo(w)}return o.set(m,b),b}function PT(m){let{element:o,boundary:g,rootBoundary:b,strategy:I}=m;const w=[...g==="clippingAncestors"?Eg(o)?[]:ST(o,this._c):[].concat(g),b],u=w[0],U=w.reduce((W,Q)=>{const j=c0(o,Q,I);return W.top=Mn(j.top,W.top),W.right=Xo(j.right,W.right),W.bottom=Xo(j.bottom,W.bottom),W.left=Mn(j.left,W.left),W},c0(o,u,I));return{width:U.right-U.left,height:U.bottom-U.top,x:U.left,y:U.top}}function TT(m){const{width:o,height:g}=hb(m);return{width:o,height:g}}function IT(m,o,g){const b=vs(o),I=xs(o),E=g==="fixed",w=Va(m,!0,E,o);let u={scrollLeft:0,scrollTop:0};const U=ys(0);if(b||!b&&!E)if((Dc(o)!=="body"||Pp(I))&&(u=kg(o)),b){const V=Va(o,!0,E,o);U.x=V.x+o.clientLeft,U.y=V.y+o.clientTop}else I&&(U.x=Uy(I));const W=I&&!b&&!E?pb(I,u):ys(0),Q=w.left+u.scrollLeft-U.x-W.x,j=w.top+u.scrollTop-U.y-W.y;return{x:Q,y:j,width:w.width,height:w.height}}function ty(m){return Qn(m).position==="static"}function u0(m,o){if(!vs(m)||Qn(m).position==="fixed")return null;if(o)return o(m);let g=m.offsetParent;return xs(m)===g&&(g=g.ownerDocument.body),g}function mb(m,o){const g=zn(m);if(Eg(m))return g;if(!vs(m)){let I=Jo(m);for(;I&&!Cc(I);){if($n(I)&&!ty(I))return I;I=Jo(I)}return g}let b=u0(m,o);for(;b&&fT(b)&&ty(b);)b=u0(b,o);return b&&Cc(b)&&ty(b)&&!Ny(b)?g:b||mT(m)||g}const AT=async function(m){const o=this.getOffsetParent||mb,g=this.getDimensions,b=await g(m.floating);return{reference:IT(m.reference,await o(m.floating),m.strategy),floating:{x:0,y:0,width:b.width,height:b.height}}};function CT(m){return Qn(m).direction==="rtl"}const ET={convertOffsetParentRelativeRectToViewportRelativeRect:yT,getDocumentElement:xs,getClippingRect:PT,getOffsetParent:mb,getElementRects:AT,getClientRects:vT,getDimensions:TT,getScale:Vl,isElement:$n,isRTL:CT};function kT(m,o){let g=null,b;const I=xs(m);function E(){var u;clearTimeout(b),(u=g)==null||u.disconnect(),g=null}function w(u,U){u===void 0&&(u=!1),U===void 0&&(U=1),E();const{left:W,top:Q,width:j,height:V}=m.getBoundingClientRect();if(u||o(),!j||!V)return;const ae=Df(Q),se=Df(I.clientWidth-(W+j)),ue=Df(I.clientHeight-(Q+V)),fe=Df(W),_e={rootMargin:-ae+"px "+-se+"px "+-ue+"px "+-fe+"px",threshold:Mn(0,Xo(1,U))||1};let Ee=!0;function Be(De){const Oe=De[0].intersectionRatio;if(Oe!==U){if(!Ee)return w();Oe?w(!1,Oe):b=setTimeout(()=>{w(!1,1e-7)},1e3)}Ee=!1}try{g=new IntersectionObserver(Be,{..._e,root:I.ownerDocument})}catch{g=new IntersectionObserver(Be,_e)}g.observe(m)}return w(!0),E}function MT(m,o,g,b){b===void 0&&(b={});const{ancestorScroll:I=!0,ancestorResize:E=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:u=typeof IntersectionObserver=="function",animationFrame:U=!1}=b,W=jy(m),Q=I||E?[...W?rh(W):[],...rh(o)]:[];Q.forEach(Pe=>{I&&Pe.addEventListener("scroll",g,{passive:!0}),E&&Pe.addEventListener("resize",g)});const j=W&&u?kT(W,g):null;let V=-1,ae=null;w&&(ae=new ResizeObserver(Pe=>{let[_e]=Pe;_e&&_e.target===W&&ae&&(ae.unobserve(o),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var Ee;(Ee=ae)==null||Ee.observe(o)})),g()}),W&&!U&&ae.observe(W),ae.observe(o));let se,ue=U?Va(m):null;U&&fe();function fe(){const Pe=Va(m);ue&&(Pe.x!==ue.x||Pe.y!==ue.y||Pe.width!==ue.width||Pe.height!==ue.height)&&g(),ue=Pe,se=requestAnimationFrame(fe)}return g(),()=>{var Pe;Q.forEach(_e=>{I&&_e.removeEventListener("scroll",g),E&&_e.removeEventListener("resize",g)}),j==null||j(),(Pe=ae)==null||Pe.disconnect(),ae=null,U&&cancelAnimationFrame(se)}}const zT=uT,DT=hT,RT=aT,LT=pT,OT=lT,FT=oT,BT=dT,NT=(m,o,g)=>{const b=new Map,I={platform:ET,...g},E={...I.platform,_c:b};return sT(m,o,{...I,platform:E})};function Xu(m){return typeof m=="function"?m():m}function gb(m){return typeof window>"u"?1:(m.ownerDocument.defaultView||window).devicePixelRatio||1}function h0(m,o){const g=gb(m);return Math.round(o*g)/g}function d0(m){return{[`--bits-${m}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${m}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${m}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${m}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${m}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function VT(m){const o=m.whileElementsMounted,g=Te(()=>Xu(m.open)??!0),b=Te(()=>Xu(m.middleware)),I=Te(()=>Xu(m.transform)??!0),E=Te(()=>Xu(m.placement)??"bottom"),w=Te(()=>Xu(m.strategy)??"absolute"),u=m.reference;let U=Je(0),W=Je(0);const Q=we(null);let j=Je(qe(F(w))),V=Je(qe(F(E))),ae=Je(qe({})),se=Je(!1);const ue=Te(()=>{const De={position:F(j),left:"0",top:"0"};if(!Q.current)return De;const Oe=h0(Q.current,F(U)),Ze=h0(Q.current,F(W));return F(I)?{...De,transform:`translate(${Oe}px, ${Ze}px)`,...gb(Q.current)>=1.5&&{willChange:"transform"}}:{position:F(j),left:`${Oe}px`,top:`${Ze}px`}});let fe;function Pe(){u.current===null||Q.current===null||NT(u.current,Q.current,{middleware:F(b),placement:F(E),strategy:F(w)}).then(De=>{Fe(U,qe(De.x)),Fe(W,qe(De.y)),Fe(j,qe(De.strategy)),Fe(V,qe(De.placement)),Fe(ae,qe(De.middlewareData)),Fe(se,!0)})}function _e(){typeof fe=="function"&&(fe(),fe=void 0)}function Ee(){if(_e(),o===void 0){Pe();return}u.current===null||Q.current===null||(fe=o(u.current,Q.current,Pe))}function Be(){F(g)||Fe(se,!1)}return Tt(Pe),Tt(Ee),Tt(Be),Tt(()=>_e),{floating:Q,reference:u,get strategy(){return F(j)},get placement(){return F(V)},get middlewareData(){return F(ae)},get isPositioned(){return F(se)},get floatingStyles(){return F(ue)},get update(){return Pe}}}const jT={top:"bottom",right:"left",bottom:"top",left:"right"};class UT{constructor(){Ve(this,"anchorNode",we(null));Ve(this,"customAnchorNode",we(null));Ve(this,"triggerNode",we(null));Tt(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var zh,Dh,Rh,Lh,tc,Oh,Fh,ic,Ma,Bh,Nh,Vh,jh,Uh,qh,pm,Zh,fm,Gh,mm,gm,Wh,Hh,Xh,Kh,_m,ym,vm,xm,bm,wm,Jh,Sm,Pm,Tm,Im;class qT{constructor(o,g){Ve(this,"root");Ve(this,"contentRef",we(null));Ve(this,"wrapperRef",we(null));Ve(this,"arrowRef",we(null));Ve(this,"arrowId",we(fr()));Ve(this,"id");Ve(this,"wrapperId");Ve(this,"style");X(this,zh,Te(()=>{if(typeof this.style=="string")return $u(this.style);if(!this.style)return{}}));X(this,Dh);X(this,Rh);X(this,Lh);X(this,tc);X(this,Oh);X(this,Fh);X(this,ic);X(this,Ma);X(this,Bh);X(this,Nh);X(this,Vh);X(this,jh);X(this,Uh);Ve(this,"onPlaced");Ve(this,"enabled");X(this,qh,new eP(()=>this.arrowRef.current??void 0));X(this,pm,Te(()=>{var o;return((o=T(this,qh))==null?void 0:o.width)??0}));X(this,Zh,Te(()=>{var o;return((o=T(this,qh))==null?void 0:o.height)??0}));X(this,fm,Te(()=>{var o;return((o=T(this,Rh))==null?void 0:o.current)+(T(this,tc).current!=="center"?`-${T(this,tc).current}`:"")}));X(this,Gh,Te(()=>Array.isArray(T(this,Ma).current)?T(this,Ma).current:[T(this,Ma).current]));X(this,mm,Te(()=>F(T(this,Gh)).length>0));X(this,gm,Te(()=>({padding:T(this,Bh).current,boundary:F(T(this,Gh)).filter(WS),altBoundary:this.hasExplicitBoundaries})));X(this,Wh,Je(void 0));X(this,Hh,Je(void 0));X(this,Xh,Je(void 0));X(this,Kh,Je(void 0));X(this,_m,Te(()=>[zT({mainAxis:T(this,Lh).current+F(T(this,Zh)),alignmentAxis:T(this,Oh).current}),T(this,ic)&&DT({mainAxis:!0,crossAxis:!1,limiter:T(this,Nh).current==="partial"?BT():void 0,...this.detectOverflowOptions}),T(this,ic)&&RT({...this.detectOverflowOptions}),LT({...this.detectOverflowOptions,apply:({rects:o,availableWidth:g,availableHeight:b})=>{const{width:I,height:E}=o.reference;Fe(T(this,Wh),qe(g)),Fe(T(this,Hh),qe(b)),Fe(T(this,Xh),qe(I)),Fe(T(this,Kh),qe(E))}}),this.arrowRef.current&&FT({element:this.arrowRef.current,padding:T(this,Fh).current}),JT({arrowWidth:F(T(this,pm)),arrowHeight:F(T(this,Zh))}),T(this,Vh).current&&OT({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Ve(this,"floating");X(this,ym,Te(()=>YT(this.floating.placement)));X(this,vm,Te(()=>$T(this.floating.placement)));X(this,xm,Te(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.x)??0}));X(this,bm,Te(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.y)??0}));X(this,wm,Te(()=>{var o;return((o=this.floating.middlewareData.arrow)==null?void 0:o.centerOffset)!==0}));X(this,Jh,Je());X(this,Sm,Te(()=>jT[this.placedSide]));X(this,Pm,Te(()=>{var o,g,b;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(o=this.floating.middlewareData.transformOrigin)==null?void 0:o.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${F(T(this,Wh))}px`,"--bits-floating-available-height":`${F(T(this,Hh))}px`,"--bits-floating-anchor-width":`${F(T(this,Xh))}px`,"--bits-floating-anchor-height":`${F(T(this,Kh))}px`,...((b=this.floating.middlewareData.hide)==null?void 0:b.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...F(T(this,zh))},dir:T(this,Dh).current}}));X(this,Tm,Te(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:My({...F(T(this,zh))})})));X(this,Im,Te(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=o.id,je(this,Rh,o.side),je(this,Lh,o.sideOffset),je(this,tc,o.align),je(this,Oh,o.alignOffset),je(this,Fh,o.arrowPadding),je(this,ic,o.avoidCollisions),je(this,Ma,o.collisionBoundary),je(this,Bh,o.collisionPadding),je(this,Nh,o.sticky),je(this,Vh,o.hideWhenDetached),je(this,Uh,o.updatePositionStrategy),this.onPlaced=o.onPlaced,je(this,jh,o.strategy),je(this,Dh,o.dir),this.style=o.style,this.root=g,this.enabled=o.enabled,this.wrapperId=o.wrapperId,o.customAnchor&&(this.root.customAnchorNode.current=o.customAnchor.current),Tt(()=>{o.customAnchor.current,ki(()=>{this.root.customAnchorNode.current=o.customAnchor.current})}),ir({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),ir({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=VT({strategy:()=>T(this,jh).current,placement:()=>F(T(this,fm)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...b)=>{var E;return MT(...b,{animationFrame:((E=T(this,Uh))==null?void 0:E.current)==="always"})},open:()=>this.enabled.current}),Tt(()=>{var b;this.floating.isPositioned&&((b=this.onPlaced)==null||b.current())}),Tt(()=>{const b=this.contentRef.current;b&&ki(()=>{this.contentZIndex=window.getComputedStyle(b).zIndex})}),Tt(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return F(T(this,mm))}get detectOverflowOptions(){return F(T(this,gm))}get middleware(){return F(T(this,_m))}get placedSide(){return F(T(this,ym))}get placedAlign(){return F(T(this,vm))}get arrowX(){return F(T(this,xm))}get arrowY(){return F(T(this,bm))}get cannotCenterArrow(){return F(T(this,wm))}get contentZIndex(){return F(T(this,Jh))}set contentZIndex(o){Fe(T(this,Jh),qe(o))}get arrowBaseSide(){return F(T(this,Sm))}get wrapperProps(){return F(T(this,Pm))}get props(){return F(T(this,Tm))}get arrowStyle(){return F(T(this,Im))}}zh=new WeakMap,Dh=new WeakMap,Rh=new WeakMap,Lh=new WeakMap,tc=new WeakMap,Oh=new WeakMap,Fh=new WeakMap,ic=new WeakMap,Ma=new WeakMap,Bh=new WeakMap,Nh=new WeakMap,Vh=new WeakMap,jh=new WeakMap,Uh=new WeakMap,qh=new WeakMap,pm=new WeakMap,Zh=new WeakMap,fm=new WeakMap,Gh=new WeakMap,mm=new WeakMap,gm=new WeakMap,Wh=new WeakMap,Hh=new WeakMap,Xh=new WeakMap,Kh=new WeakMap,_m=new WeakMap,ym=new WeakMap,vm=new WeakMap,xm=new WeakMap,bm=new WeakMap,wm=new WeakMap,Jh=new WeakMap,Sm=new WeakMap,Pm=new WeakMap,Tm=new WeakMap,Im=new WeakMap;class ZT{constructor(o,g){Ve(this,"ref",we(null));o.virtualEl&&o.virtualEl.current?g.triggerNode=we.from(o.virtualEl.current):ir({id:o.id,ref:this.ref,onRefChange:b=>{g.triggerNode.current=b}})}}const[GT,_b]=ja("Floating.Root"),[WT,ek]=ja("Floating.Content");function HT(){return GT(new UT)}function XT(m){return WT(new qT(m,_b()))}function KT(m){return new ZT(m,_b())}function JT(m){return{name:"transformOrigin",options:m,fn(o){var fe,Pe,_e;const{placement:g,rects:b,middlewareData:I}=o,w=((fe=I.arrow)==null?void 0:fe.centerOffset)!==0,u=w?0:m.arrowWidth,U=w?0:m.arrowHeight,[W,Q]=qy(g),j={start:"0%",center:"50%",end:"100%"}[Q],V=(((Pe=I.arrow)==null?void 0:Pe.x)??0)+u/2,ae=(((_e=I.arrow)==null?void 0:_e.y)??0)+U/2;let se="",ue="";return W==="bottom"?(se=w?j:`${V}px`,ue=`${-U}px`):W==="top"?(se=w?j:`${V}px`,ue=`${b.floating.height+U}px`):W==="right"?(se=`${-U}px`,ue=w?j:`${ae}px`):W==="left"&&(se=`${b.floating.width+U}px`,ue=w?j:`${ae}px`),{data:{x:se,y:ue}}}}}function qy(m){const[o,g="center"]=m.split("-");return[o,g]}function YT(m){return qy(m)[0]}function $T(m){return qy(m)[1]}function QT(m,o){Mt(o,!0),HT();var g=ut(),b=Xe(g);Bt(b,()=>o.children??ri),Me(m,g),zt()}function eI(m,o){Mt(o,!0),KT({id:we.with(()=>o.id),virtualEl:we.with(()=>o.virtualEl)});var g=ut(),b=Xe(g);Bt(b,()=>o.children??ri),Me(m,g),zt()}var tI=Gt("<div><!></div>");function iI(m,o){Mt(o,!0);let g=te(o,"side",3,"bottom"),b=te(o,"sideOffset",3,0),I=te(o,"align",3,"center"),E=te(o,"alignOffset",3,0),w=te(o,"arrowPadding",3,0),u=te(o,"avoidCollisions",3,!0),U=te(o,"collisionBoundary",19,()=>[]),W=te(o,"collisionPadding",3,0),Q=te(o,"hideWhenDetached",3,!1),j=te(o,"onPlaced",3,()=>{}),V=te(o,"sticky",3,"partial"),ae=te(o,"updatePositionStrategy",3,"optimized"),se=te(o,"strategy",3,"fixed"),ue=te(o,"dir",3,"ltr"),fe=te(o,"style",19,()=>({})),Pe=te(o,"wrapperId",19,fr),_e=te(o,"customAnchor",3,null);const Ee=XT({side:we.with(()=>g()),sideOffset:we.with(()=>b()),align:we.with(()=>I()),alignOffset:we.with(()=>E()),id:we.with(()=>o.id),arrowPadding:we.with(()=>w()),avoidCollisions:we.with(()=>u()),collisionBoundary:we.with(()=>U()),collisionPadding:we.with(()=>W()),hideWhenDetached:we.with(()=>Q()),onPlaced:we.with(()=>j()),sticky:we.with(()=>V()),updatePositionStrategy:we.with(()=>ae()),strategy:we.with(()=>se()),dir:we.with(()=>ue()),style:we.with(()=>fe()),enabled:we.with(()=>!1),wrapperId:we.with(()=>Pe()),customAnchor:we.with(()=>_e())}),Be=Te(()=>ji(Ee.wrapperProps,{style:{pointerEvents:"auto"}}));var De=tI();let Oe;var Ze=Mi(De);Bt(Ze,()=>o.content??ri,()=>({props:Ee.props})),zi(De),fi(()=>Oe=Qi(De,Oe,{...F(Be)})),Me(m,De),zt()}function rI(m,o){Mt(o,!0),E0(()=>{var I;(I=o.onPlaced)==null||I.call(o)});var g=ut(),b=Xe(g);Bt(b,()=>o.content??ri,()=>({props:{}})),Me(m,g),zt()}function nI(m,o){let g=te(o,"isStatic",3,!1),b=ei(o,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var I=ut(),E=Xe(I);{var w=U=>{rI(U,{get content(){return o.content},get onPlaced(){return o.onPlaced}})},u=U=>{iI(U,ai({get content(){return o.content},get onPlaced(){return o.onPlaced}},()=>b))};bi(E,U=>{g()?U(w):U(u,!1)})}Me(m,I)}var sI=Gt("<!> <!>",1);function yb(m,o){Mt(o,!0);let g=te(o,"interactOutsideBehavior",3,"close"),b=te(o,"trapFocus",3,!0),I=te(o,"isValidEvent",3,()=>!1),E=te(o,"customAnchor",3,null),w=te(o,"isStatic",3,!1),u=ei(o,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);nI(m,{get isStatic(){return w()},get id(){return o.id},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},content:(W,Q)=>{let j=()=>Q==null?void 0:Q().props;var V=sI(),ae=Xe(V);{var se=_e=>{jf(_e,{get preventScroll(){return o.preventScroll}})},ue=_e=>{var Ee=ut(),Be=Xe(Ee);{var De=Oe=>{jf(Oe,{get preventScroll(){return o.preventScroll}})};bi(Be,Oe=>{o.forceMount||Oe(De)},!0)}Me(_e,Ee)};bi(ae,_e=>{o.forceMount&&o.enabled?_e(se):_e(ue,!1)})}var fe=Fi(ae,2),Pe=Te(()=>o.enabled&&b());nb(fe,{get id(){return o.id},get onOpenAutoFocus(){return o.onOpenAutoFocus},get onCloseAutoFocus(){return o.onCloseAutoFocus},get loop(){return o.loop},get trapFocus(){return F(Pe)},get forceMount(){return o.forceMount},focusScope:(Ee,Be)=>{let De=()=>Be==null?void 0:Be().props;ib(Ee,{get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get enabled(){return o.enabled},children:(Oe,Ze)=>{tb(Oe,{get id(){return o.id},get onInteractOutside(){return o.onInteractOutside},get onFocusOutside(){return o.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return I()},get enabled(){return o.enabled},children:(We,mt)=>{let st=()=>mt==null?void 0:mt().props;ob(We,{get id(){return o.id},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get enabled(){return o.enabled},children:(Ue,Re)=>{var Ae=ut(),Ke=Xe(Ae),rt=Tg(()=>({props:ji(u,j(),st(),De(),{style:{pointerEvents:"auto"}})}));Bt(Ke,()=>o.popper??ri,()=>F(rt)),Me(Ue,Ae)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),Me(W,V)},$$slots:{content:!0}}),zt()}function oI(m,o){let g=te(o,"interactOutsideBehavior",3,"close"),b=te(o,"trapFocus",3,!0),I=te(o,"isValidEvent",3,()=>!1),E=te(o,"customAnchor",3,null),w=te(o,"isStatic",3,!1),u=ei(o,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);Ry(m,ai({get id(){return o.id},get present(){return o.present}},()=>u,{presence:(W,Q)=>{let j=()=>Q==null?void 0:Q().present;yb(W,ai({get popper(){return o.popper},get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get id(){return o.id},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get preventScroll(){return o.preventScroll},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return j().current},get onInteractOutside(){return o.onInteractOutside},get onCloseAutoFocus(){return o.onCloseAutoFocus},get onOpenAutoFocus(){return o.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return o.loop},get trapFocus(){return b()},get isValidEvent(){return I()},get onFocusOutside(){return o.onFocusOutside},forceMount:!1},()=>u))},$$slots:{presence:!0}}))}function aI(m,o){let g=te(o,"interactOutsideBehavior",3,"close"),b=te(o,"trapFocus",3,!0),I=te(o,"isValidEvent",3,()=>!1),E=te(o,"customAnchor",3,null),w=te(o,"isStatic",3,!1),u=ei(o,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);yb(m,ai({get popper(){return o.popper},get onEscapeKeydown(){return o.onEscapeKeydown},get escapeKeydownBehavior(){return o.escapeKeydownBehavior},get preventOverflowTextSelection(){return o.preventOverflowTextSelection},get id(){return o.id},get onPointerDown(){return o.onPointerDown},get onPointerUp(){return o.onPointerUp},get side(){return o.side},get sideOffset(){return o.sideOffset},get align(){return o.align},get alignOffset(){return o.alignOffset},get arrowPadding(){return o.arrowPadding},get avoidCollisions(){return o.avoidCollisions},get collisionBoundary(){return o.collisionBoundary},get collisionPadding(){return o.collisionPadding},get sticky(){return o.sticky},get hideWhenDetached(){return o.hideWhenDetached},get updatePositionStrategy(){return o.updatePositionStrategy},get strategy(){return o.strategy},get dir(){return o.dir},get preventScroll(){return o.preventScroll},get wrapperId(){return o.wrapperId},get style(){return o.style},get onPlaced(){return o.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return o.enabled},get onInteractOutside(){return o.onInteractOutside},get onCloseAutoFocus(){return o.onCloseAutoFocus},get onOpenAutoFocus(){return o.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return o.loop},get trapFocus(){return b()},get isValidEvent(){return I()},get onFocusOutside(){return o.onFocusOutside}},()=>u,{forceMount:!0}))}function lI(m,o){let g=m.nextElementSibling;for(;g;){if(g.matches(o))return g;g=g.nextElementSibling}}function cI(m,o){let g=m.previousElementSibling;for(;g;){if(g.matches(o))return g;g=g.previousElementSibling}}const p0=1,uI=.9,hI=.8,dI=.17,iy=.1,ry=.999,pI=.9999,fI=.99,mI=/[\\/_+.#"@[({&]/,gI=/[\\/_+.#"@[({&]/g,_I=/[\s-]/,vb=/[\s-]/g;function Py(m,o,g,b,I,E,w){if(E===o.length)return I===m.length?p0:fI;const u=`${I},${E}`;if(w[u]!==void 0)return w[u];const U=b.charAt(E);let W=g.indexOf(U,I),Q=0,j,V,ae,se;for(;W>=0;)j=Py(m,o,g,b,W+1,E+1,w),j>Q&&(W===I?j*=p0:mI.test(m.charAt(W-1))?(j*=hI,ae=m.slice(I,W-1).match(gI),ae&&I>0&&(j*=ry**ae.length)):_I.test(m.charAt(W-1))?(j*=uI,se=m.slice(I,W-1).match(vb),se&&I>0&&(j*=ry**se.length)):(j*=dI,I>0&&(j*=ry**(W-I))),m.charAt(W)!==o.charAt(E)&&(j*=pI)),(j<iy&&g.charAt(W-1)===b.charAt(E+1)||b.charAt(E+1)===b.charAt(E)&&g.charAt(W-1)!==b.charAt(E))&&(V=Py(m,o,g,b,W+1,E+2,w),V*iy>j&&(j=V*iy)),j>Q&&(Q=j),W=g.indexOf(U,W+1);return w[u]=Q,Q}function f0(m){return m.toLowerCase().replace(vb," ")}function yI(m,o,g){return m=g&&g.length>0?`${`${m} ${g==null?void 0:g.join(" ")}`}`:m,Py(m,o,f0(m),f0(o),0,0,{})}function vI(m){if(!m)return null;for(const o of m.childNodes)if(o.nodeType!==Node.COMMENT_NODE)return o;return null}const xI="data-command-root",bI="data-command-list",wI="data-command-input",SI="data-command-empty",xb="data-command-group",bb="data-command-group-items",wb="data-command-group-heading",Sb="data-command-item",Ca="data-value",PI="data-command-input-label",Ku=`[${xb}]`,ny=`[${bb}]`,TI=`[${wb}]`,Pb=`[${Sb}]`,sy=`${Pb}:not([aria-disabled="true"])`;function Tb(m,o,g){return yI(m,o,g)}const[II,Rc]=ja("Command.Root"),[AI,tk]=ja("Command.List"),[CI,Mg]=ja("Command.Group");var Yh,$h,Qh,ed,rc,td,id,rd,nc,sc,oc,Vo,jo,Am,ac,lc,nd,sd,od,ad,Cm,Em;class EI{constructor(o){Ve(this,"allItems",new Set);Ve(this,"allGroups",new Map);Ve(this,"allIds",new Map);Ve(this,"id");Ve(this,"ref");Ve(this,"filter");Ve(this,"shouldFilter");Ve(this,"loop");X(this,Yh,Je(0));X(this,$h,Je(null));X(this,Qh,Je(null));X(this,ed,Je(null));Ve(this,"valueProp");X(this,rc);Ve(this,"disablePointerSelection");X(this,td,Je(null));X(this,id,Je(null));Ve(this,"snapshot",()=>this._commandState);Ve(this,"setState",(o,g,b)=>{Object.is(this._commandState[o],g)||(this._commandState[o]=g,o==="search"?(T(this,oc).call(this),T(this,nc).call(this),T(this,sc).call(this)):o==="value"&&(b||T(this,Am).call(this)),this.emit())});Ve(this,"emit",()=>{this.commandState=M0(this._commandState)});X(this,rd,(o,g)=>{const b=this.filter.current??Tb;return o?b(o,this._commandState.search,g):0});X(this,nc,()=>{var w;if(!this._commandState.search||this.shouldFilter.current===!1)return;const o=this._commandState.filtered.items,g=[];for(const u of this._commandState.filtered.groups){const U=this.allGroups.get(u);let W=0;if(!U){g.push([u,W]);continue}for(const Q of U){const j=o.get(Q);W=Math.max(j??0,W)}g.push([u,W])}const b=this.viewportNode,I=T(this,Vo).call(this).sort((u,U)=>{const W=u.getAttribute("id"),Q=U.getAttribute("id"),j=o.get(W)??0;return(o.get(Q)??0)-j});for(const u of I){const U=u.closest(ny);if(U){const W=u.parentElement===U?u:u.closest(`${ny} > *`);W&&U.appendChild(W)}else{const W=u.parentElement===b?u:u.closest(`${ny} > *`);W&&(b==null||b.appendChild(W))}}const E=g.sort((u,U)=>U[1]-u[1]);for(const u of E){const U=b==null?void 0:b.querySelector(`${Ku}[${Ca}="${encodeURIComponent(u[0])}"]`);(w=U==null?void 0:U.parentElement)==null||w.appendChild(U)}});Ve(this,"setValue",(o,g)=>{o!==this.valueProp.current&&o===""&&Ac(()=>{this.key++}),this.setState("value",o,g),this.valueProp.current=o});X(this,sc,()=>{Ac(()=>{const o=T(this,Vo).call(this).find(b=>b.getAttribute("aria-disabled")!=="true"),g=o==null?void 0:o.getAttribute(Ca);this.setValue(g||"")})});X(this,oc,()=>{var g,b;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let o=0;for(const I of this.allItems){const E=((g=this.allIds.get(I))==null?void 0:g.value)??"",w=((b=this.allIds.get(I))==null?void 0:b.keywords)??[],u=T(this,rd).call(this,E,w);this._commandState.filtered.items.set(I,u),u>0&&o++}for(const[I,E]of this.allGroups)for(const w of E){const u=this._commandState.filtered.items.get(w);if(u&&u>0){this._commandState.filtered.groups.add(I);break}}this._commandState.filtered.count=o});X(this,Vo,()=>{const o=this.ref.current;return o?Array.from(o.querySelectorAll(sy)).filter(b=>!!b):[]});X(this,jo,()=>{const o=this.ref.current;if(!o)return;const g=o.querySelector(`${sy}[aria-selected="true"]`);if(g)return g});X(this,Am,()=>{Sp(1,()=>{var I,E,w,u,U;const o=T(this,jo).call(this);if(!o)return;const g=(I=o.parentElement)==null?void 0:I.parentElement;if(!g)return;const b=vI(g);if(b&&((E=b.dataset)==null?void 0:E.value)===((w=o.dataset)==null?void 0:w.value)){(U=(u=o==null?void 0:o.closest(Ku))==null?void 0:u.querySelector(TI))==null||U.scrollIntoView({block:"nearest"});return}o.scrollIntoView({block:"nearest"})})});X(this,ac,o=>{const b=T(this,Vo).call(this)[o];b&&this.setValue(b.getAttribute(Ca)??"")});X(this,lc,o=>{const g=T(this,jo).call(this),b=T(this,Vo).call(this),I=b.findIndex(w=>w===g);let E=b[I+o];this.loop.current&&(E=I+o<0?b[b.length-1]:I+o===b.length?b[0]:b[I+o]),E&&this.setValue(E.getAttribute(Ca)??"")});X(this,nd,o=>{const g=T(this,jo).call(this);let b=g==null?void 0:g.closest(Ku),I;for(;b&&!I;)b=o>0?lI(b,Ku):cI(b,Ku),I=b==null?void 0:b.querySelector(sy);I?this.setValue(I.getAttribute(Ca)??""):T(this,lc).call(this,o)});Ve(this,"registerValue",(o,g,b)=>{var I;if(g!==((I=this.allIds.get(o))==null?void 0:I.value))return this.allIds.set(o,{value:g,keywords:b}),this._commandState.filtered.items.set(o,T(this,rd).call(this,g,b)),T(this,nc).call(this),this.emit(),()=>{this.allIds.delete(o)}});Ve(this,"registerItem",(o,g)=>(this.allItems.add(o),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(o):this.allGroups.set(g,new Set([o]))),T(this,oc).call(this),T(this,nc).call(this),this.commandState.value||T(this,sc).call(this),this.emit(),()=>{this.allIds.delete(o),this.allItems.delete(o),this.commandState.filtered.items.delete(o);const b=T(this,jo).call(this);T(this,oc).call(this),(b==null?void 0:b.getAttribute("id"))===o&&T(this,sc).call(this),this.emit()}));Ve(this,"registerGroup",o=>(this.allGroups.has(o)||this.allGroups.set(o,new Set),()=>{this.allIds.delete(o),this.allGroups.delete(o)}));X(this,sd,()=>T(this,ac).call(this,T(this,Vo).call(this).length-1));X(this,od,o=>{o.preventDefault(),o.metaKey?T(this,sd).call(this):o.altKey?T(this,nd).call(this,1):T(this,lc).call(this,1)});X(this,ad,o=>{o.preventDefault(),o.metaKey?T(this,ac).call(this,0):o.altKey?T(this,nd).call(this,-1):T(this,lc).call(this,-1)});X(this,Cm,o=>{switch(o.key){case jS:case US:{T(this,rc).current&&o.ctrlKey&&T(this,od).call(this,o);break}case DS:T(this,od).call(this,o);break;case VS:case qS:{T(this,rc).current&&o.ctrlKey&&T(this,ad).call(this,o);break}case RS:T(this,ad).call(this,o);break;case FS:o.preventDefault(),T(this,ac).call(this,0);break;case LS:o.preventDefault(),T(this,sd).call(this);break;case J0:if(!o.isComposing&&o.keyCode!==229){o.preventDefault();const g=T(this,jo).call(this);g&&(g==null||g.click())}}});X(this,Em,Te(()=>({id:this.id.current,role:"application",[xI]:"",tabindex:-1,onkeydown:T(this,Cm)})));this.id=o.id,this.ref=o.ref,this.filter=o.filter,this.shouldFilter=o.shouldFilter,this.loop=o.loop,this.valueProp=o.value,je(this,rc,o.vimBindings),this.disablePointerSelection=o.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,ir({id:this.id,ref:this.ref})}get key(){return F(T(this,Yh))}set key(o){Fe(T(this,Yh),qe(o))}get viewportNode(){return F(T(this,$h))}set viewportNode(o){Fe(T(this,$h),qe(o))}get inputNode(){return F(T(this,Qh))}set inputNode(o){Fe(T(this,Qh),qe(o))}get labelNode(){return F(T(this,ed))}set labelNode(o){Fe(T(this,ed),qe(o))}get commandState(){return F(T(this,td))}set commandState(o){Fe(T(this,td),o)}get _commandState(){return F(T(this,id))}set _commandState(o){Fe(T(this,id),qe(o))}get props(){return F(T(this,Em))}}Yh=new WeakMap,$h=new WeakMap,Qh=new WeakMap,ed=new WeakMap,rc=new WeakMap,td=new WeakMap,id=new WeakMap,rd=new WeakMap,nc=new WeakMap,sc=new WeakMap,oc=new WeakMap,Vo=new WeakMap,jo=new WeakMap,Am=new WeakMap,ac=new WeakMap,lc=new WeakMap,nd=new WeakMap,sd=new WeakMap,od=new WeakMap,ad=new WeakMap,Cm=new WeakMap,Em=new WeakMap;var ld,cc,cd,ud,hd,km,Mm;class kI{constructor(o,g){X(this,ld);X(this,cc);X(this,cd);X(this,ud);X(this,hd,!0);X(this,km,Te(()=>T(this,cd)._commandState.filtered.count===0&&T(this,hd)===!1||T(this,ud).current));X(this,Mm,Te(()=>({id:T(this,cc).current,role:"presentation",[SI]:""})));je(this,ld,o.ref),je(this,cc,o.id),je(this,cd,g),je(this,ud,o.forceMount),Tt(()=>{je(this,hd,!1)}),ir({id:T(this,cc),ref:T(this,ld),deps:()=>this.shouldRender})}get shouldRender(){return F(T(this,km))}get props(){return F(T(this,Mm))}}ld=new WeakMap,cc=new WeakMap,cd=new WeakMap,ud=new WeakMap,hd=new WeakMap,km=new WeakMap,Mm=new WeakMap;var za,Da,Yn,dd,zm,pd,Dm;class MI{constructor(o,g){X(this,za);Ve(this,"id");Ve(this,"forceMount");X(this,Da);X(this,Yn);X(this,dd,Je(null));X(this,zm,Te(()=>this.forceMount.current||T(this,Yn).shouldFilter.current===!1||!T(this,Yn).commandState.search?!0:T(this,Yn).commandState.filtered.groups.has(this.id.current)));X(this,pd,Je(""));X(this,Dm,Te(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[xb]:""})));je(this,za,o.ref),this.id=o.id,je(this,Yn,g),this.forceMount=o.forceMount,je(this,Da,o.value),this.trueValue=o.value.current,ir({id:this.id,ref:T(this,za),deps:()=>this.shouldRender}),Tt(()=>T(this,Yn).registerGroup(this.id.current)),Tt(()=>{var b;if(T(this,Da).current)return this.trueValue=T(this,Da).current,T(this,Yn).registerValue(this.id.current,T(this,Da).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),T(this,Yn).registerValue(this.id.current,this.trueValue);if((b=T(this,za).current)!=null&&b.textContent)return this.trueValue=T(this,za).current.textContent.trim().toLowerCase(),T(this,Yn).registerValue(this.id.current,this.trueValue)})}get headingNode(){return F(T(this,dd))}set headingNode(o){Fe(T(this,dd),qe(o))}get shouldRender(){return F(T(this,zm))}get trueValue(){return F(T(this,pd))}set trueValue(o){Fe(T(this,pd),qe(o))}get props(){return F(T(this,Dm))}createGroupHeading(o){return new Ib(o,this)}createGroupItems(o){return new Ab(o,this)}}za=new WeakMap,Da=new WeakMap,Yn=new WeakMap,dd=new WeakMap,zm=new WeakMap,pd=new WeakMap,Dm=new WeakMap;var fd,uc,md,Rm;class Ib{constructor(o,g){X(this,fd);X(this,uc);X(this,md);X(this,Rm,Te(()=>({id:T(this,uc).current,[wb]:""})));je(this,fd,o.ref),je(this,uc,o.id),je(this,md,g),ir({id:T(this,uc),ref:T(this,fd),onRefChange:b=>{T(this,md).headingNode=b}})}get props(){return F(T(this,Rm))}}fd=new WeakMap,uc=new WeakMap,md=new WeakMap,Rm=new WeakMap;var gd,hc,_d,Lm;class Ab{constructor(o,g){X(this,gd);X(this,hc);X(this,_d);X(this,Lm,Te(()=>{var o;return{id:T(this,hc).current,role:"group",[bb]:"","aria-labelledby":((o=T(this,_d).headingNode)==null?void 0:o.id)??void 0}}));je(this,gd,o.ref),je(this,hc,o.id),je(this,_d,g),ir({id:T(this,hc),ref:T(this,gd)})}get props(){return F(T(this,Lm))}}gd=new WeakMap,hc=new WeakMap,_d=new WeakMap,Lm=new WeakMap;var dc,pc,fs,Uo,yd,Om,Fm;class zI{constructor(o,g){X(this,dc);X(this,pc);X(this,fs);X(this,Uo);X(this,yd);X(this,Om,Te(()=>{var g;const o=(g=T(this,fs).viewportNode)==null?void 0:g.querySelector(`${Pb}[${Ca}="${encodeURIComponent(T(this,Uo).current)}"]`);if(o)return(o==null?void 0:o.getAttribute("id"))??void 0}));X(this,Fm,Te(()=>{var o,g;return{id:T(this,pc).current,type:"text",[wI]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":K0(!0),"aria-controls":((o=T(this,fs).viewportNode)==null?void 0:o.id)??void 0,"aria-labelledby":((g=T(this,fs).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":F(T(this,Om))}}));je(this,dc,o.ref),je(this,pc,o.id),je(this,fs,g),je(this,Uo,o.value),je(this,yd,o.autofocus),ir({id:T(this,pc),ref:T(this,dc),onRefChange:b=>{T(this,fs).inputNode=b}}),Tt(()=>{const b=T(this,dc).current;ki(()=>{b&&T(this,yd).current&&Sp(10,()=>b.focus())})}),Tt(()=>{T(this,Uo).current,ki(()=>{T(this,fs).commandState.search!==T(this,Uo).current&&T(this,fs).setState("search",T(this,Uo).current)})})}get props(){return F(T(this,Fm))}}dc=new WeakMap,pc=new WeakMap,fs=new WeakMap,Uo=new WeakMap,yd=new WeakMap,Om=new WeakMap,Fm=new WeakMap;var fc,vd,ms,xd,mc,Ra,Bm,bd,Nm,Vm,jm,wd,Um,qm,Zm;class DI{constructor(o,g){X(this,fc);Ve(this,"id");Ve(this,"root");X(this,vd);X(this,ms);X(this,xd);X(this,mc);X(this,Ra,null);X(this,Bm,Te(()=>{var o;return T(this,mc).current||((o=T(this,Ra))==null?void 0:o.forceMount.current)===!0}));X(this,bd,Je(""));X(this,Nm,Te(()=>{if(F(T(this,Bm))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const o=this.root.commandState.filtered.items.get(this.id.current);return o===void 0?!1:o>0}));X(this,Vm,Te(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));X(this,jm,()=>{var o;T(this,ms).current||(T(this,wd).call(this),(o=T(this,xd))==null||o.current())});X(this,wd,()=>{T(this,ms).current||this.root.setValue(this.trueValue,!0)});X(this,Um,()=>{T(this,ms).current||this.root.disablePointerSelection.current||T(this,wd).call(this)});X(this,qm,()=>{T(this,ms).current||T(this,jm).call(this)});X(this,Zm,Te(()=>({id:this.id.current,"aria-disabled":ES(T(this,ms).current),"aria-selected":MS(this.isSelected),"data-disabled":kS(T(this,ms).current),"data-selected":zS(this.isSelected),[Sb]:"",role:"option",onpointermove:T(this,Um),onclick:T(this,qm)})));je(this,fc,o.ref),this.id=o.id,this.root=g,je(this,vd,o.value),je(this,ms,o.disabled),je(this,xd,o.onSelect),je(this,mc,o.forceMount),je(this,Ra,Mg(null)),this.trueValue=o.value.current,ir({id:this.id,ref:T(this,fc),deps:()=>!!this.root.commandState.search}),Tt(()=>{var b;if(this.id.current,(b=T(this,Ra))==null||b.id.current,!T(this,mc).current)return ki(()=>{var I;return this.root.registerItem(this.id.current,(I=T(this,Ra))==null?void 0:I.id.current)})}),Tt(()=>{const b=T(this,vd).current,I=T(this,fc).current;I&&(!b&&I.textContent&&(this.trueValue=I.textContent.trim()),ki(()=>{this.root.registerValue(this.id.current,this.trueValue,o.keywords.current.map(E=>E.trim())),I.setAttribute(Ca,this.trueValue)}))})}get trueValue(){return F(T(this,bd))}set trueValue(o){Fe(T(this,bd),qe(o))}get shouldRender(){return F(T(this,Nm))}get isSelected(){return F(T(this,Vm))}get props(){return F(T(this,Zm))}}fc=new WeakMap,vd=new WeakMap,ms=new WeakMap,xd=new WeakMap,mc=new WeakMap,Ra=new WeakMap,Bm=new WeakMap,bd=new WeakMap,Nm=new WeakMap,Vm=new WeakMap,jm=new WeakMap,wd=new WeakMap,Um=new WeakMap,qm=new WeakMap,Zm=new WeakMap;var gc,Sd,Gm;class RI{constructor(o,g){Ve(this,"ref");X(this,gc);X(this,Sd);Ve(this,"root");X(this,Gm,Te(()=>({id:T(this,gc).current,role:"listbox","aria-label":T(this,Sd).current,[bI]:""})));this.ref=o.ref,je(this,gc,o.id),this.root=g,je(this,Sd,o.ariaLabel),ir({id:T(this,gc),ref:this.ref})}get props(){return F(T(this,Gm))}}gc=new WeakMap,Sd=new WeakMap,Gm=new WeakMap;var Pd,_c,Td,Id,Wm;class LI{constructor(o,g){X(this,Pd);X(this,_c);X(this,Td);X(this,Id);X(this,Wm,Te(()=>{var o;return{id:T(this,_c).current,[PI]:"",for:(o=T(this,Id))==null?void 0:o.current,style:X0}}));je(this,Pd,o.ref),je(this,_c,o.id),je(this,Td,g),je(this,Id,o.for),ir({id:T(this,_c),ref:T(this,Pd),onRefChange:b=>{T(this,Td).labelNode=b}})}get props(){return F(T(this,Wm))}}Pd=new WeakMap,_c=new WeakMap,Td=new WeakMap,Id=new WeakMap,Wm=new WeakMap;function OI(m){return II(new EI(m))}function FI(m){const o=Rc();return new kI(m,o)}function BI(m){const o=Rc();return new DI(m,o)}function NI(m){const o=Rc();return CI(new MI(m,o))}function VI(m){const o=Mg();return new Ib(m,o)}function jI(m){const o=Mg();return new Ab(m,o)}function UI(m){const o=Rc();return new zI(m,o)}function qI(m){const o=Rc();return AI(new RI(m,o))}function ZI(m){const o=Rc();return new LI(m,o)}var GI=Gt("<label><!></label>");function WI(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","ref","children"]);const E=ZI({id:we.with(()=>g()),ref:we.with(()=>b(),Q=>b(Q))}),w=Te(()=>ji(I,E.props));var u=GI();let U;var W=Mi(u);Bt(W,()=>o.children??ri),zi(u),fi(()=>U=Qi(u,U,{...F(w)})),Me(m,u),zt()}var HI=Gt("<!> <!>",1),XI=Gt("<div><!> <!></div>");function KI(m,o){Mt(o,!0);const g=De=>{WI(De,{children:(Oe,Ze)=>{Ia();var ft=Qu();fi(()=>Aa(ft,Q())),Me(Oe,ft)},$$slots:{default:!0}})};let b=te(o,"id",19,fr),I=te(o,"ref",15,null),E=te(o,"value",15,""),w=te(o,"onValueChange",3,Ki),u=te(o,"loop",3,!1),U=te(o,"shouldFilter",3,!0),W=te(o,"filter",3,Tb),Q=te(o,"label",3,""),j=te(o,"vimBindings",3,!0),V=te(o,"disablePointerSelection",3,!1),ae=te(o,"controlledValue",3,!1),se=ei(o,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const ue=OI({id:we.with(()=>b()),ref:we.with(()=>I(),De=>I(De)),filter:we.with(()=>W()),shouldFilter:we.with(()=>U()),loop:we.with(()=>u()),value:we.with(()=>E(),De=>{ae()||E(De),w()(De)}),vimBindings:we.with(()=>j()),disablePointerSelection:we.with(()=>V())}),fe=Te(()=>ji(se,ue.props));var Pe=ut(),_e=Xe(Pe);{var Ee=De=>{var Oe=HI(),Ze=Xe(Oe);g(Ze);var ft=Fi(Ze,2);Bt(ft,()=>o.child,()=>({props:F(fe)})),Me(De,Oe)},Be=De=>{var Oe=XI();let Ze;var ft=Mi(Oe);g(ft);var We=Fi(ft,2);Bt(We,()=>o.children??ri),zi(Oe),fi(()=>Ze=Qi(Oe,Ze,{...F(fe)})),Me(De,Oe)};bi(_e,De=>{o.child?De(Ee):De(Be,!1)})}Me(m,Pe),zt()}var JI=Gt("<div><!></div>");function YI(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"forceMount",3,!1),E=ei(o,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const w=FI({id:we.with(()=>g()),ref:we.with(()=>b(),j=>b(j)),forceMount:we.with(()=>I())}),u=Te(()=>ji(w.props,E));var U=ut(),W=Xe(U);{var Q=j=>{var V=ut(),ae=Xe(V);{var se=fe=>{var Pe=ut(),_e=Xe(Pe);Bt(_e,()=>o.child,()=>({props:F(u)})),Me(fe,Pe)},ue=fe=>{var Pe=JI();let _e;var Ee=Mi(Pe);Bt(Ee,()=>o.children??ri),zi(Pe),fi(()=>_e=Qi(Pe,_e,{...F(u)})),Me(fe,Pe)};bi(ae,fe=>{o.child?fe(se):fe(ue,!1)})}Me(j,V)};bi(W,j=>{w.shouldRender&&j(Q)})}Me(m,U),zt()}var $I=Gt("<div><!></div>");function QI(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"value",3,""),E=te(o,"forceMount",3,!1),w=ei(o,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const u=NI({id:we.with(()=>g()),ref:we.with(()=>b(),ae=>b(ae)),forceMount:we.with(()=>E()),value:we.with(()=>I())}),U=Te(()=>ji(w,u.props));var W=ut(),Q=Xe(W);{var j=ae=>{var se=ut(),ue=Xe(se);Bt(ue,()=>o.child,()=>({props:F(U)})),Me(ae,se)},V=ae=>{var se=$I();let ue;var fe=Mi(se);Bt(fe,()=>o.children??ri),zi(se),fi(()=>ue=Qi(se,ue,{...F(U)})),Me(ae,se)};bi(Q,ae=>{o.child?ae(j):ae(V,!1)})}Me(m,W),zt()}var eA=Gt("<div><!></div>");function tA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=VI({id:we.with(()=>g()),ref:we.with(()=>b(),j=>b(j))}),w=Te(()=>ji(I,E.props));var u=ut(),U=Xe(u);{var W=j=>{var V=ut(),ae=Xe(V);Bt(ae,()=>o.child,()=>({props:F(w)})),Me(j,V)},Q=j=>{var V=eA();let ae;var se=Mi(V);Bt(se,()=>o.children??ri),zi(V),fi(()=>ae=Qi(V,ae,{...F(w)})),Me(j,V)};bi(U,j=>{o.child?j(W):j(Q,!1)})}Me(m,u),zt()}var iA=Gt("<div><!></div>"),rA=Gt('<div style="display: contents;"><!></div>');function nA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=jI({id:we.with(()=>g()),ref:we.with(()=>b(),j=>b(j))}),w=Te(()=>ji(I,E.props));var u=rA(),U=Mi(u);{var W=j=>{var V=ut(),ae=Xe(V);Bt(ae,()=>o.child,()=>({props:F(w)})),Me(j,V)},Q=j=>{var V=iA();let ae;var se=Mi(V);Bt(se,()=>o.children??ri),zi(V),fi(()=>ae=Qi(V,ae,{...F(w)})),Me(j,V)};bi(U,j=>{o.child?j(W):j(Q,!1)})}zi(u),Me(m,u),zt()}var sA=Gt("<input>");function oA(m,o){Mt(o,!0);let g=te(o,"value",15,""),b=te(o,"autofocus",3,!1),I=te(o,"id",19,fr),E=te(o,"ref",15,null),w=ei(o,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const u=UI({id:we.with(()=>I()),ref:we.with(()=>E(),ae=>E(ae)),value:we.with(()=>g(),ae=>{g(ae)}),autofocus:we.with(()=>b()??!1)}),U=Te(()=>ji(w,u.props));var W=ut(),Q=Xe(W);{var j=ae=>{var se=ut(),ue=Xe(se);Bt(ue,()=>o.child,()=>({props:F(U)})),Me(ae,se)},V=ae=>{var se=sA();d2(se);let ue;fi(()=>ue=Qi(se,ue,{...F(U)})),x2(se,g),Me(ae,se)};bi(Q,ae=>{o.child?ae(j):ae(V,!1)})}Me(m,W),zt()}var aA=Gt("<div><!></div>"),lA=Gt('<div style="display: contents;" data-item-wrapper=""><!></div>');function cA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"value",3,""),E=te(o,"disabled",3,!1),w=te(o,"onSelect",3,Ki),u=te(o,"forceMount",3,!1),U=te(o,"keywords",19,()=>[]),W=ei(o,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const Q=Mg(null),j=BI({id:we.with(()=>g()),ref:we.with(()=>b(),ue=>b(ue)),value:we.with(()=>I()),disabled:we.with(()=>E()),onSelect:we.with(()=>w()),forceMount:we.with(()=>u()),keywords:we.with(()=>U()),group:Q}),V=Te(()=>ji(W,j.props));var ae=ut(),se=Xe(ae);k0(se,()=>j.root.key,ue=>{var fe=lA(),Pe=Mi(fe);{var _e=Ee=>{var Be=ut(),De=Xe(Be);{var Oe=ft=>{var We=ut(),mt=Xe(We);Bt(mt,()=>o.child,()=>({props:F(V)})),Me(ft,We)},Ze=ft=>{var We=aA();let mt;var st=Mi(We);Bt(st,()=>o.children??ri),zi(We),fi(()=>mt=Qi(We,mt,{...F(V)})),Me(ft,We)};bi(De,ft=>{o.child?ft(Oe):ft(Ze,!1)})}Me(Ee,Be)};bi(Pe,Ee=>{j.shouldRender&&Ee(_e)})}zi(fe),fi(()=>hy(fe,"data-value",I())),Me(ue,fe)}),Me(m,ae),zt()}var uA=Gt("<div><!></div>");function hA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const E=qI({id:we.with(()=>g()),ref:we.with(()=>b(),j=>b(j)),ariaLabel:we.with(()=>o["aria-label"]??"Suggestions...")}),w=Te(()=>ji(I,E.props));var u=ut(),U=Xe(u);{var W=j=>{var V=ut(),ae=Xe(V);Bt(ae,()=>o.child,()=>({props:F(w)})),Me(j,V)},Q=j=>{var V=uA();let ae;var se=Mi(V);Bt(se,()=>o.children??ri),zi(V),fi(()=>ae=Qi(V,ae,{...F(w)})),Me(j,V)};bi(U,j=>{o.child?j(W):j(Q,!1)})}Me(m,u),zt()}var Ad,Cd,Ed;class dA{constructor(o){Ve(this,"open");X(this,Ad,Je(null));X(this,Cd,Je(void 0));X(this,Ed,Je(null));Ve(this,"toggleOpen",()=>{this.open.current=!this.open.current});Ve(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=o.open}get contentNode(){return F(T(this,Ad))}set contentNode(o){Fe(T(this,Ad),qe(o))}get contentId(){return F(T(this,Cd))}set contentId(o){Fe(T(this,Cd),qe(o))}get triggerNode(){return F(T(this,Ed))}set triggerNode(o){Fe(T(this,Ed),qe(o))}}Ad=new WeakMap,Cd=new WeakMap,Ed=new WeakMap;var yc,kd,qo,kn,Hm,Xm,Km,Jm,Ym;class pA{constructor(o,g){X(this,yc);X(this,kd);X(this,qo);X(this,kn);X(this,Hm,o=>{if(!T(this,qo).current){if(o.pointerType==="touch"||o.button!==0)return o.preventDefault();T(this,kn).toggleOpen()}});X(this,Xm,o=>{T(this,qo).current||o.pointerType==="touch"&&(o.preventDefault(),T(this,kn).toggleOpen())});X(this,Km,o=>{T(this,qo).current||(o.key===J0||o.key===BS)&&(o.preventDefault(),T(this,kn).toggleOpen())});X(this,Jm,()=>{if(T(this,kn).open.current&&T(this,kn).contentId)return T(this,kn).contentId});X(this,Ym,Te(()=>({id:T(this,yc).current,"aria-haspopup":"dialog","aria-expanded":K0(T(this,kn).open.current),"data-state":zy(T(this,kn).open.current),"aria-controls":T(this,Jm).call(this),"data-popover-trigger":"",disabled:T(this,qo).current,onpointerdown:T(this,Hm),onkeydown:T(this,Km),onpointerup:T(this,Xm)})));je(this,yc,o.id),je(this,kn,g),je(this,kd,o.ref),je(this,qo,o.disabled),ir({id:T(this,yc),ref:T(this,kd),onRefChange:b=>{T(this,kn).triggerNode=b}})}get props(){return F(T(this,Ym))}}yc=new WeakMap,kd=new WeakMap,qo=new WeakMap,kn=new WeakMap,Hm=new WeakMap,Xm=new WeakMap,Km=new WeakMap,Jm=new WeakMap,Ym=new WeakMap;var vc,Md,$m,Qm;class fA{constructor(o,g){X(this,vc);X(this,Md);Ve(this,"root");X(this,$m,Te(()=>({open:this.root.open.current})));X(this,Qm,Te(()=>({id:T(this,vc).current,tabindex:-1,"data-state":zy(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));je(this,vc,o.id),this.root=g,je(this,Md,o.ref),ir({id:T(this,vc),ref:T(this,Md),deps:()=>this.root.open.current,onRefChange:b=>{this.root.contentNode=b,this.root.contentId=b==null?void 0:b.id}})}get snippetProps(){return F(T(this,$m))}get props(){return F(T(this,Qm))}}vc=new WeakMap,Md=new WeakMap,$m=new WeakMap,Qm=new WeakMap;const[mA,Cb]=ja("Popover.Root");function gA(m){return mA(new dA(m))}function _A(m){return new pA(m,Cb())}function yA(m){return new fA(m,Cb())}var vA=Gt("<div><!></div>"),xA=Gt("<div><!></div>");function bA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=te(o,"id",19,fr),I=te(o,"forceMount",3,!1),E=te(o,"onCloseAutoFocus",3,Ki),w=te(o,"onEscapeKeydown",3,Ki),u=te(o,"onInteractOutside",3,Ki),U=te(o,"trapFocus",3,!0),W=te(o,"preventScroll",3,!1),Q=ei(o,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const j=yA({id:we.with(()=>b()),ref:we.with(()=>g(),Be=>g(Be))}),V=Te(()=>ji(Q,j.props));function ae(Be){u()(Be),!Be.defaultPrevented&&j.root.close()}function se(Be){w()(Be),!Be.defaultPrevented&&j.root.close()}function ue(Be){var De;E()(Be),!Be.defaultPrevented&&(Be.preventDefault(),(De=j.root.triggerNode)==null||De.focus())}var fe=ut(),Pe=Xe(fe);{var _e=Be=>{aI(Be,ai(()=>F(V),{get enabled(){return j.root.open.current},get id(){return b()},onInteractOutside:ae,onEscapeKeydown:se,onCloseAutoFocus:ue,get trapFocus(){return U()},get preventScroll(){return W()},loop:!0,forceMount:!0,popper:(Oe,Ze)=>{let ft=()=>Ze==null?void 0:Ze().props;var We=ut();const mt=Te(()=>ji(ft(),{style:d0("popover")}));var st=Xe(We);{var Ue=Ae=>{var Ke=ut(),rt=Xe(Ke);Bt(rt,()=>o.child,()=>({props:F(mt),...j.snippetProps})),Me(Ae,Ke)},Re=Ae=>{var Ke=vA();let rt;var _t=Mi(Ke);Bt(_t,()=>o.children??ri),zi(Ke),fi(()=>rt=Qi(Ke,rt,{...F(mt)})),Me(Ae,Ke)};bi(st,Ae=>{o.child?Ae(Ue):Ae(Re,!1)})}Me(Oe,We)},$$slots:{popper:!0}}))},Ee=Be=>{var De=ut(),Oe=Xe(De);{var Ze=ft=>{oI(ft,ai(()=>F(V),{get present(){return j.root.open.current},get id(){return b()},onInteractOutside:ae,onEscapeKeydown:se,onCloseAutoFocus:ue,get trapFocus(){return U()},get preventScroll(){return W()},loop:!0,forceMount:!1,popper:(mt,st)=>{let Ue=()=>st==null?void 0:st().props;var Re=ut();const Ae=Te(()=>ji(Ue(),{style:d0("popover")}));var Ke=Xe(Re);{var rt=yt=>{var ht=ut(),xt=Xe(ht);Bt(xt,()=>o.child,()=>({props:F(Ae),...j.snippetProps})),Me(yt,ht)},_t=yt=>{var ht=xA();let xt;var Dt=Mi(ht);Bt(Dt,()=>o.children??ri),zi(ht),fi(()=>xt=Qi(ht,xt,{...F(Ae)})),Me(yt,ht)};bi(Ke,yt=>{o.child?yt(rt):yt(_t,!1)})}Me(mt,Re)},$$slots:{popper:!0}}))};bi(Oe,ft=>{I()||ft(Ze)},!0)}Me(Be,De)};bi(Pe,Be=>{I()?Be(_e):Be(Ee,!1)})}Me(m,fe),zt()}var wA=Gt("<button><!></button>");function SA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"type",3,"button"),E=te(o,"disabled",3,!1),w=ei(o,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const u=_A({id:we.with(()=>g()),ref:we.with(()=>b(),V=>b(V)),disabled:we.with(()=>!!E())}),U=Te(()=>ji(w,u.props,{type:I()})),W=Cy(),[Q,j]=W;eI(m,{get id(){return g()},children:(V,ae)=>{var se=ut(),ue=Xe(se);{var fe=_e=>{var Ee=ut(),Be=Xe(Ee);Bt(Be,()=>o.child,()=>({props:F(U)})),Me(_e,Ee)},Pe=_e=>{var Ee=wA();const Be=Te(()=>j({...F(U)},[{attribute_name:"formaction"}]));let De;var Oe=Mi(Ee);Bt(Oe,()=>o.children??ri),zi(Ee),fi(()=>De=Qi(Ee,De,{...F(Be)})),Me(_e,Ee)};bi(ue,_e=>{o.child?_e(fe):_e(Pe,!1)})}Me(V,se)},$$slots:{default:!0}}),zt()}function PA(m,o){Mt(o,!0);let g=te(o,"open",15,!1),b=te(o,"onOpenChange",3,Ki),I=te(o,"controlledOpen",3,!1);hP({variant:we.with(()=>"dialog"),open:we.with(()=>g(),u=>{I()||g(u),b()(u)})});var E=ut(),w=Xe(E);Bt(w,()=>o.children??ri),Me(m,E),zt()}var TA=Gt("<!> <!>",1),IA=Gt("<!> <div><!></div>",1);function AA(m,o){Mt(o,!0);let g=te(o,"id",19,fr),b=te(o,"ref",15,null),I=te(o,"forceMount",3,!1),E=te(o,"onCloseAutoFocus",3,Ki),w=te(o,"onEscapeKeydown",3,Ki),u=te(o,"onInteractOutside",3,Ki),U=te(o,"trapFocus",3,!0),W=te(o,"preventScroll",3,!0),Q=te(o,"restoreScrollDelay",3,null),j=ei(o,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const V=pP({id:we.with(()=>g()),ref:we.with(()=>b(),ue=>b(ue))}),ae=Te(()=>ji(j,V.props));var se=Te(()=>V.root.open.current||I());Ry(m,ai(()=>F(ae),{get forceMount(){return I()},get present(){return F(se)},presence:(fe,Pe)=>{let _e=()=>Pe==null?void 0:Pe().present;var Ee=Te(()=>WP({forceMount:I(),present:_e().current,trapFocus:U(),open:V.root.open.current}));nb(fe,ai({loop:!0,get trapFocus(){return F(Ee)}},()=>F(ae),{onCloseAutoFocus:De=>{var Oe;E()(De),!De.defaultPrevented&&((Oe=V.root.triggerNode)==null||Oe.focus())},focusScope:(De,Oe)=>{let Ze=()=>Oe==null?void 0:Oe().props;ib(De,ai(()=>F(ae),{get enabled(){return _e().current},onEscapeKeydown:ft=>{w()(ft),!ft.defaultPrevented&&V.root.handleClose()},children:(ft,We)=>{tb(ft,ai(()=>F(ae),{get enabled(){return _e().current},onInteractOutside:mt=>{u()(mt),!mt.defaultPrevented&&V.root.handleClose()},children:(mt,st)=>{ob(mt,ai(()=>F(ae),{get enabled(){return _e().current},children:(Ue,Re)=>{var Ae=ut(),Ke=Xe(Ae);{var rt=yt=>{var ht=TA(),xt=Xe(ht);{var Dt=hi=>{jf(hi,{get preventScroll(){return W()},get restoreScrollDelay(){return Q()}})};bi(xt,hi=>{V.root.open.current&&hi(Dt)})}var qt=Fi(xt,2),vi=Tg(()=>({props:ji(F(ae),Ze()),...V.snippetProps}));Bt(qt,()=>o.child,()=>F(vi)),Me(yt,ht)},_t=yt=>{var ht=IA(),xt=Xe(ht);jf(xt,{get preventScroll(){return W()}});var Dt=Fi(xt,2);const qt=Te(()=>ji(F(ae),Ze()));let vi;var hi=Mi(Dt);Bt(hi,()=>o.children??ri),zi(Dt),fi(()=>vi=Qi(Dt,vi,{...F(qt)})),Me(yt,ht)};bi(Ke,yt=>{o.child?yt(rt):yt(_t,!1)})}Me(Ue,Ae)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),zt()}function CA(m,o){Mt(o,!0);let g=te(o,"open",15,!1),b=te(o,"onOpenChange",3,Ki),I=te(o,"controlledOpen",3,!1);gA({open:we.with(()=>g(),E=>{I()||g(E),b()(E)})}),QT(m,{children:(E,w)=>{var u=ut(),U=Xe(u);Bt(U,()=>o.children??ri),Me(E,u)},$$slots:{default:!0}}),zt()}function EA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=te(o,"value",15,""),I=ei(o,["$$slots","$$events","$$legacy","ref","value","class"]);var E=ut(),w=Xe(E),u=Te(()=>nn("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",o.class));ci(w,()=>KI,(U,W)=>{W(U,ai({get class(){return F(u)},get value(){return b()},set value(Q){b(Q)},get ref(){return g()},set ref(Q){g(Q)}},()=>I))}),Me(m,E),zt()}/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var MA=N1("<svg><!><!></svg>");function Tp(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]),b=Na(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Mt(o,!1);let I=te(o,"name",8,void 0),E=te(o,"color",8,"currentColor"),w=te(o,"size",8,24),u=te(o,"strokeWidth",8,2),U=te(o,"absoluteStrokeWidth",8,!1),W=te(o,"iconNode",24,()=>[]);const Q=(..._e)=>_e.filter((Ee,Be,De)=>!!Ee&&De.indexOf(Ee)===Be).join(" "),j=Cy(),[V,ae]=j;p2();var se=MA();let ue;var fe=Mi(se);cy(fe,1,W,uy,(_e,Ee)=>{let Be=()=>F(Ee)[0],De=()=>F(Ee)[1];var Oe=ut(),Ze=Xe(Oe);const ft=Tg(()=>`${Be()}`=="button"?ae({...De()},[{attribute_name:"formaction"}]):`${Be()}`=="form"?ae({...De()},[{attribute_name:"action"}]):`${Be()}`=="a"?ae({...De()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...De()});m2(Ze,Be,!0,(We,mt)=>{let st;fi(()=>st=Qi(We,st,{...F(ft)},void 0,We.namespaceURI===T0,We.nodeName.includes("-")))}),Me(_e,Oe)});var Pe=Fi(fe);kc(Pe,o,"default",{}),zi(se),fi(()=>ue=Qi(se,ue,{...kA,...b,width:w(),height:w(),stroke:E(),"stroke-width":U()?Number(u())*24/Number(w()):u(),class:Q("lucide-icon","lucide",I()?`lucide-${I()}`:"",g.class)},void 0,!0)),Me(m,se),zt()}function zA(m,o){Mt(o,!0),te(o,"ref",11,null);let g=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var b=ut(),I=Xe(b),E=Te(()=>nn("py-6 text-center text-sm",o.class));ci(I,()=>YI,(w,u)=>{u(w,ai({get class(){return F(E)}},()=>g))}),Me(m,b),zt()}var DA=Gt("<!> <!>",1);function RA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var I=ut(),E=Xe(I),w=Te(()=>nn("text-foreground overflow-hidden p-1",o.class));ci(E,()=>QI,(u,U)=>{U(u,ai({get class(){return F(w)},get ref(){return g()},set ref(W){g(W)}},()=>b,{children:(W,Q)=>{var j=DA(),V=Xe(j);{var ae=ue=>{var fe=ut(),Pe=Xe(fe);ci(Pe,()=>tA,(_e,Ee)=>{Ee(_e,{class:"text-muted-foreground px-2 py-1.5 text-xs font-medium",children:(Be,De)=>{Ia();var Oe=Qu();fi(()=>Aa(Oe,o.heading)),Me(Be,Oe)},$$slots:{default:!0}})}),Me(ue,fe)};bi(V,ue=>{o.heading&&ue(ae)})}var se=Fi(V,2);ci(se,()=>nA,(ue,fe)=>{fe(ue,{get children(){return o.children}})}),Me(W,j)},$$slots:{default:!0}}))}),Me(m,I),zt()}function LA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var I=ut(),E=Xe(I),w=Te(()=>nn("aria-selected:bg-accent aria-selected:text-accent-foreground relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",o.class));ci(E,()=>cA,(u,U)=>{U(u,ai({get class(){return F(w)},get ref(){return g()},set ref(W){g(W)}},()=>b))}),Me(m,I),zt()}function OA(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]);Tp(m,ai({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(I,E)=>{var w=ut(),u=Xe(w);kc(u,o,"default",{}),Me(I,w)},$$slots:{default:!0}}))}var FA=Gt('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function BA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=te(o,"value",15,""),I=ei(o,["$$slots","$$events","$$legacy","ref","class","value"]);var E=FA(),w=Mi(E);OA(w,{class:"mr-2 size-4 shrink-0 opacity-50"});var u=Fi(w,2),U=Te(()=>nn("placeholder:text-muted-foreground flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50",o.class));ci(u,()=>oA,(W,Q)=>{Q(W,ai({get class(){return F(U)},get ref(){return g()},set ref(j){g(j)}},()=>I,{get value(){return b()},set value(j){b(j)}}))}),zi(E),Me(m,E),zt()}function NA(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var I=ut(),E=Xe(I),w=Te(()=>nn("max-h-[300px] overflow-y-auto overflow-x-hidden",o.class));ci(E,()=>hA,(u,U)=>{U(u,ai({get class(){return F(w)}},()=>b,{get ref(){return g()},set ref(W){g(W)}}))}),Me(m,I),zt()}function pr(){}const VA=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),jA=typeof document<"u";function UA(m){return m instanceof HTMLInputElement&&!VA.has(m.type)||m instanceof HTMLTextAreaElement||m instanceof HTMLElement&&m.isContentEditable}function zr(m){switch(m){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return m}}const Wi={DURATION:.5,EASE:[.32,.72,0,1]},Eb=.4,qA=.25,ZA=100,kb=8,Ta=16,Zy=26,oy="vaul-dragging",Mb=new WeakMap;function dr(m,o,g=!1){if(!m||!(m instanceof HTMLElement))return;const b={};Object.entries(o).forEach(([I,E])=>{if(I.startsWith("--")){m.style.setProperty(I,E);return}b[I]=m.style[I],m.style[I]=E}),!g&&Mb.set(m,b)}function GA(m,o){if(!m||!(m instanceof HTMLElement))return;const g=Mb.get(m);g&&(m.style[o]=g[o])}function WA(){return Gy(/^Mac/)}function Gy(m){return typeof window<"u"&&window.navigator!=null?m.test(window.navigator.platform):void 0}function HA(){return Gy(/^iPhone/)}function m0(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function XA(){return Gy(/^iPad/)||WA()&&navigator.maxTouchPoints>1}function KA(){return HA()||XA()}function g0(m){switch(m){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return m}}function Rf(m,o){if(!m)return null;const g=window.getComputedStyle(m),b=g.transform||g.webkitTransform||g.mozTransform;let I=b.match(/^matrix3d\((.+)\)$/);return I?Number.parseFloat(I[1].split(", ")[g0(o)?13:12]):(I=b.match(/^matrix\((.+)\)$/),I?Number.parseFloat(I[1].split(", ")[g0(o)?5:4]):null)}function ay(m,o){if(!m)return()=>{};const g=m.style.cssText;return Object.assign(m.style,o),()=>{m.style.cssText=g}}let Ju=null;var gs,La,Oa,xc,zd,eg,Dd,tg,ig;class JA{constructor(o){X(this,gs);X(this,La,Je(qe(typeof window<"u"?window.location.href:"")));X(this,Oa,Je(0));X(this,xc,Te(()=>T(this,gs).open.current));X(this,zd,Te(()=>T(this,gs).noBodyStyles.current));X(this,eg,Te(()=>T(this,gs).preventScrollRestoration.current));X(this,Dd,Te(()=>T(this,gs).modal.current));X(this,tg,Te(()=>T(this,gs).nested.current));X(this,ig,Te(()=>T(this,gs).hasBeenOpened));Ve(this,"setPositionFixed",()=>{if(m0()&&Ju===null&&F(T(this,xc))&&!F(T(this,zd))){Ju={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:o,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-F(T(this,Oa))}px`,left:`${-o}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const b=g-window.innerHeight;b&&F(T(this,Oa))>=g&&(document.body.style.top=`${-(F(T(this,Oa))+b)}px`)}),300)}});Ve(this,"restorePositionSetting",()=>{if(m0()&&Ju!==null&&!F(T(this,zd))){const o=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,Ju),window.requestAnimationFrame(()=>{if(F(T(this,eg))&&F(T(this,La))!==window.location.href){Fe(T(this,La),qe(window.location.href));return}window.scrollTo(g,o)}),Ju=null}});je(this,gs,o),Tt(()=>ki(()=>{const g=()=>{Fe(T(this,Oa),qe(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),Tt(()=>{if(F(T(this,La)),!!F(T(this,Dd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),Tt(()=>{F(T(this,xc));const g=F(T(this,Dd)),b=F(T(this,ig)),I=F(T(this,tg));F(T(this,La)),ki(()=>{I||!b||(F(T(this,xc))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}gs=new WeakMap,La=new WeakMap,Oa=new WeakMap,xc=new WeakMap,zd=new WeakMap,eg=new WeakMap,Dd=new WeakMap,tg=new WeakMap,ig=new WeakMap;function _0(m,o){return wp(m,o)}function YA(m,o){const g=m,b=typeof m=="symbol"?m.description:m;if(!A0(g)){if(o===void 0)throw new Error(`Missing context dependency: ${b} and no fallback was provided.`);return o}return Ay(m)}function $A(m,o){return`${m}Context`}function QA(m,o,g=!0){const b=$A(m),I=Symbol(b),E=b;function w(U){const W=YA(g?I:E,U);if(W===void 0)throw new Error(`Context \`${b}\` not found. Component must be used within ${Array.isArray(m)?`one of the following components: ${m.join(", ")}`:`\`${m}\``}`);return W}function u(U){return _0(g?I:E,U)}return[u,w]}var Gr,kr,bc,Mr,rg,ng,wc,Rd,Ld,Od,sg,og,ag,lg,cg,Fd;class eC{constructor(o){X(this,Gr);X(this,kr,Te(()=>T(this,Gr).direction.current));X(this,bc,Te(()=>T(this,Gr).container.current));X(this,Mr,Te(()=>T(this,Gr).snapPoints.current??[]));X(this,rg,Te(()=>T(this,Gr).activeSnapPoint.current));X(this,ng,Te(()=>T(this,Gr).fadeFromIndex.current));X(this,wc,Te(()=>T(this,Gr).overlayNode));X(this,Rd,Te(()=>T(this,Gr).drawerNode));X(this,Ld,Te(()=>T(this,Gr).snapToSequentialPoint.current));X(this,Od,Je(jA?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));X(this,sg,Te(()=>{var o;return this.activeSnapPoint===((o=F(T(this,Mr)))==null?void 0:o[F(T(this,Mr)).length-1])||null}));X(this,og,Te(()=>{var o;return(o=F(T(this,Mr)))==null?void 0:o.findIndex(g=>g===this.activeSnapPoint)}));X(this,ag,Te(()=>F(T(this,Mr))&&F(T(this,Mr)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&F(T(this,Mr))[this.fadeFromIndex]===this.activeSnapPoint||!F(T(this,Mr))));X(this,lg,Te(()=>{var b;this.windowDimensions,T(this,Gr).open.current;const o=F(T(this,bc))?{width:F(T(this,bc)).getBoundingClientRect().width,height:F(T(this,bc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((b=F(T(this,Mr)))==null?void 0:b.map(I=>{const E=typeof I=="string";let w=0;if(E&&(w=Number.parseInt(I,10)),zr(F(T(this,kr)))){const U=E?w:this.windowDimensions?I*o.height:0;return this.windowDimensions?F(T(this,kr))==="bottom"?o.height-U:-o.height+U:U}const u=E?w:this.windowDimensions?I*o.width:0;return this.windowDimensions?F(T(this,kr))==="right"?o.width-u:-o.width+u:u}))??[]}));X(this,cg,Te(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));X(this,Fd,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});Ve(this,"snapToPoint",o=>{var b;const g=this.snapPointsOffset.findIndex(I=>I===o)??null;T(this,Gr).onSnapPointChange(g),dr(F(T(this,Rd)),{transition:`transform ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,transform:zr(F(T(this,kr)))?`translate3d(0, ${o}px, 0)`:`translate3d(${o}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?dr(F(T(this,wc)),{transition:`opacity ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,opacity:"0"}):dr(F(T(this,wc)),{transition:`opacity ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,opacity:"1"}),T(this,Gr).setActiveSnapPoint((b=F(T(this,Mr)))==null?void 0:b[Math.max(g,0)])});Ve(this,"onRelease",o=>{var U;if(this.fadeFromIndex===void 0)return;const g=F(T(this,kr))==="bottom"||F(T(this,kr))==="right"?(this.activeSnapPointOffset??0)-o.draggedDistance:(this.activeSnapPointOffset??0)+o.draggedDistance,b=this.activeSnapPointIndex===this.fadeFromIndex-1,I=this.activeSnapPointIndex===0,E=o.draggedDistance>0;if(b&&dr(F(T(this,wc)),{transition:`opacity ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`}),!F(T(this,Ld))&&o.velocity>2&&!E){o.dismissible?o.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!F(T(this,Ld))&&o.velocity>2&&E&&this.snapPointsOffset&&F(T(this,Mr))){this.snapToPoint(this.snapPointsOffset[F(T(this,Mr)).length-1]);return}const w=(U=this.snapPointsOffset)==null?void 0:U.reduce((W,Q)=>typeof W!="number"||typeof Q!="number"?W:Math.abs(Q-g)<Math.abs(W-g)?Q:W),u=zr(F(T(this,kr)))?window.innerHeight:window.innerWidth;if(o.velocity>Eb&&Math.abs(o.draggedDistance)<u*.4){const W=E?1:-1;if(W>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[F(T(this,Mr)).length-1]);return}if(I&&W<0&&o.dismissible&&T(this,Gr).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+W]);return}this.snapToPoint(w)});Ve(this,"onDrag",o=>{if(this.activeSnapPointOffset===null)return;const g=F(T(this,kr))==="bottom"||F(T(this,kr))==="right"?this.activeSnapPointOffset-o.draggedDistance:this.activeSnapPointOffset+o.draggedDistance;(F(T(this,kr))==="bottom"||F(T(this,kr))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(F(T(this,kr))==="top"||F(T(this,kr))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||dr(F(T(this,Rd)),{transform:zr(F(T(this,kr)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});Ve(this,"getPercentageDragged",(o,g)=>{if(!F(T(this,Mr)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const b=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(b&&!g)return 1;if(!this.shouldFade&&!b)return null;const E=b?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,w=b?this.snapPointsOffset[E]-this.snapPointsOffset[E-1]:this.snapPointsOffset[E+1]-this.snapPointsOffset[E],u=o/Math.abs(w);return b?1-u:u});je(this,Gr,o),Tt(()=>ki(()=>(window.addEventListener("resize",T(this,Fd)),()=>window.removeEventListener("resize",T(this,Fd))))),Tt(()=>{const g=this.activeSnapPoint,b=F(T(this,Mr)),I=this.snapPointsOffset;ki(()=>{if(g){const E=(b==null?void 0:b.findIndex(w=>w===g))??-1;I&&E!==-1&&typeof I[E]=="number"&&this.snapToPoint(I[E])}})})}get activeSnapPoint(){return F(T(this,rg))}get fadeFromIndex(){return F(T(this,ng))}get windowDimensions(){return F(T(this,Od))}set windowDimensions(o){Fe(T(this,Od),o)}get isLastSnapPoint(){return F(T(this,sg))}get activeSnapPointIndex(){return F(T(this,og))}get shouldFade(){return F(T(this,ag))}get snapPointsOffset(){return F(T(this,lg))}get activeSnapPointOffset(){return F(T(this,cg))}}Gr=new WeakMap,kr=new WeakMap,bc=new WeakMap,Mr=new WeakMap,rg=new WeakMap,ng=new WeakMap,wc=new WeakMap,Rd=new WeakMap,Ld=new WeakMap,Od=new WeakMap,sg=new WeakMap,og=new WeakMap,ag=new WeakMap,lg=new WeakMap,cg=new WeakMap,Fd=new WeakMap;function tC(...m){return(...o)=>{for(const g of m)typeof g=="function"&&g(...o)}}function iC(m){const o=Te(()=>m.direction.current),g=Te(()=>m.open.current),b=Te(()=>m.shouldScaleBackground.current),I=Te(()=>m.setBackgroundColorOnScale.current),E=Te(()=>m.noBodyStyles.current);let w=Je(null),u=Je("");function U(){return(window.innerWidth-Zy)/window.innerWidth}Tt(()=>{ki(()=>{Fe(u,qe(document.body.style.backgroundColor))})}),Tt(()=>(F(g),F(b),F(I),ki(()=>{if(F(g)&&F(b)){F(w)&&window.clearTimeout(F(w));const W=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!W)return;tC(F(I)&&!F(E)?ay(document.body,{background:"black"}):pr,ay(W,{transformOrigin:zr(F(o))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Wi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Wi.EASE.join(",")})`}));const Q=ay(W,{borderRadius:`${kb}px`,overflow:"hidden",...zr(F(o))?{transform:`scale(${U()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${U()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{Q(),Fe(w,qe(window.setTimeout(()=>{F(u)?document.body.style.background=F(u):document.body.style.removeProperty("background")},Wi.DURATION*1e3)))}}})))}var Bd,Nd,Vd,jd,Ud,qd,Zd,Gd,Wd,Hd,Xd,Kd,Jd,Yd,$d,Qd,ep,ug;class rC{constructor(o){Ve(this,"open");Ve(this,"activeSnapPoint");Ve(this,"closeThreshold");Ve(this,"shouldScaleBackground");Ve(this,"scrollLockTimeout");Ve(this,"snapPoints");Ve(this,"fadeFromIndex");Ve(this,"fixed");Ve(this,"dismissible");Ve(this,"direction");Ve(this,"onDragProp");Ve(this,"onReleaseProp");Ve(this,"nested");Ve(this,"onCloseProp");Ve(this,"backgroundColor");Ve(this,"modal");Ve(this,"handleOnly");Ve(this,"noBodyStyles");Ve(this,"preventScrollRestoration");Ve(this,"setBackgroundColorOnScale");Ve(this,"container");Ve(this,"snapToSequentialPoint");Ve(this,"repositionInputs");Ve(this,"autoFocus");X(this,Bd,Je(!1));X(this,Nd,Je(!1));X(this,Vd,Je(!1));X(this,jd,Je(null));X(this,Ud,Je(null));X(this,qd,Je(null));X(this,Zd,Je(null));X(this,Gd,Je(null));X(this,Wd,Je(!1));X(this,Hd,Je(null));X(this,Xd,Je(0));X(this,Kd,Je(!1));X(this,Jd,Je(0));X(this,Yd,Je(null));X(this,$d,Je(0));X(this,Qd,Je(0));X(this,ep,Je(0));Ve(this,"snapPointsState");X(this,ug,Te(()=>this.snapPointsState.snapPointsOffset));Ve(this,"positionFixedState");Ve(this,"setActiveSnapPoint",o=>{this.activeSnapPoint.current=o});Ve(this,"onSnapPointChange",o=>{this.snapPoints.current&&o===this.snapPointsOffset.length-1&&(this.openTime=new Date)});Ve(this,"onPress",o=>{var b;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(o.target))return;const g=(b=this.drawerNode)==null?void 0:b.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,KA()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),o.target.setPointerCapture(o.pointerId),this.pointerStart=zr(this.direction.current)?o.pageY:o.pageX});Ve(this,"shouldDrag",(o,g)=>{var u;if(o===null)return!1;let b=o;const I=(u=window.getSelection())==null?void 0:u.toString(),E=this.drawerNode?Rf(this.drawerNode,this.direction.current):null,w=new Date;if(b.hasAttribute("data-vaul-no-drag")||b.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&w.getTime()-this.openTime.getTime()<500)return!1;if(E!==null&&(this.direction.current==="bottom"?E>0:E<0))return!0;if(I&&I.length>0)return!1;if(this.lastTimeDragPrevented!==null&&w.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&E===0)return this.lastTimeDragPrevented=w,!1;if(g)return this.lastTimeDragPrevented=w,!1;for(;b;){if(b.scrollHeight>b.clientHeight){if(b.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(b.getAttribute("role")==="dialog")return!0}b=b.parentNode}return!0});Ve(this,"onDrag",o=>{var V,ae;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,b=(this.pointerStart-(zr(this.direction.current)?o.pageY:o.pageX))*g,I=b>0,E=this.snapPoints.current&&!this.dismissible.current&&!I;if(E&&this.snapPointsState.activeSnapPointIndex===0)return;const w=Math.abs(b),u=document.querySelector("[data-vaul-drawer-wrapper]"),U=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let W=w/U;const Q=this.snapPointsState.getPercentageDragged(w,I);if(Q!==null&&(W=Q),E&&W>=1||!this.isAllowedToDrag&&!this.shouldDrag(o.target,I))return;if(this.drawerNode.classList.add(oy),this.isAllowedToDrag=!0,dr(this.drawerNode,{transition:"none"}),dr(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:b}),I&&!this.snapPoints.current){const se=dC(b),ue=Math.min(se*-1,0)*g;dr(this.drawerNode,{transform:zr(this.direction.current)?`translate3d(0, ${ue}px, 0)`:`translate3d(${ue}px, 0, 0)`});return}const j=1-W;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((ae=(V=this.onDragProp).current)==null||ae.call(V,o,W),dr(this.overlayNode,{opacity:`${j}`,transition:"none"},!0)),u&&this.overlayNode&&this.shouldScaleBackground.current){const se=Math.min(Lf()+W*(1-Lf()),1),ue=8-W*8,fe=Math.max(0,14-W*14);dr(u,{borderRadius:`${ue}px`,transform:zr(this.direction.current)?`scale(${se}) translate3d(0, ${fe}px, 0)`:`scale(${se}) translate3d(${fe}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const se=w*g;dr(this.drawerNode,{transform:zr(this.direction.current)?`translate3d(0, ${se}px, 0)`:`translate3d(${se}px, 0, 0)`})}});Ve(this,"closeDrawer",o=>{var g,b;this.cancelDrag(),(b=(g=this.onCloseProp).current)==null||b.call(g),o||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},Wi.DURATION*1e3)});Ve(this,"resetDrawer",()=>{if(!this.drawerNode)return;const o=document.querySelector("[data-vaul-drawer-wrapper]"),g=Rf(this.drawerNode,this.direction.current);dr(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`}),dr(this.overlayNode,{transition:`opacity ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&dr(o,{borderRadius:`${kb}px`,overflow:"hidden",...zr(this.direction.current)?{transform:`scale(${Lf()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Lf()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Wi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Wi.EASE.join(",")})`},!0)});Ve(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(oy),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});Ve(this,"onRelease",o=>{var W,Q,j,V,ae,se,ue,fe,Pe,_e;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(oy),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=Rf(this.drawerNode,this.direction.current);if(!this.shouldDrag(o.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const b=this.dragEndTime.getTime()-this.dragStartTime.getTime(),I=this.pointerStart-(zr(this.direction.current)?o.pageY:o.pageX),E=Math.abs(I)/b;if(E>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const Ee=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:I*Ee,closeDrawer:this.closeDrawer,velocity:E,dismissible:this.dismissible.current}),(Q=(W=this.onReleaseProp).current)==null||Q.call(W,o,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?I>0:I<0){this.resetDrawer(),(V=(j=this.onReleaseProp).current)==null||V.call(j,o,!0);return}if(E>Eb){this.closeDrawer(),(se=(ae=this.onReleaseProp).current)==null||se.call(ae,o,!1);return}const w=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),u=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),U=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(U?u:w)*this.closeThreshold.current){this.closeDrawer(),(fe=(ue=this.onReleaseProp).current)==null||fe.call(ue,o,!1);return}(_e=(Pe=this.onReleaseProp).current)==null||_e.call(Pe,o,!0),this.resetDrawer()});Ve(this,"onNestedOpenChange",o=>{const g=o?(window.innerWidth-Ta)/window.innerWidth:1,b=o?-Ta:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),dr(this.drawerNode,{transition:`transform ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${b}px, 0)`}),!o&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const I=Rf(this.drawerNode,this.direction.current);dr(this.drawerNode,{transition:"none",transform:zr(this.direction.current)?`translate3d(0, ${I}px, 0)`:`translate3d(${I}px, 0, 0)`})},500))});Ve(this,"onNestedDrag",(o,g)=>{if(g<0)return;const b=(window.innerWidth-Ta)/window.innerWidth,I=b+g*(1-b),E=-Ta+g*Ta;dr(this.drawerNode,{transform:zr(this.direction.current)?`scale(${I}) translate3d(0, ${E}px, 0)`:`scale(${I}) translate3d(${E}px, 0, 0)`,transition:"none"})});Ve(this,"onNestedRelease",(o,g)=>{const b=zr(this.direction.current)?window.innerHeight:window.innerWidth,I=g?(b-Ta)/b:1,E=g?-Ta:0;g&&dr(this.drawerNode,{transition:`transform ${Wi.DURATION}s cubic-bezier(${Wi.EASE.join(",")})`,transform:zr(this.direction.current)?`scale(${I}) translate3d(0, ${E}px, 0)`:`scale(${I}) translate3d(${E}px, 0, 0)`})});Ve(this,"onDialogOpenChange",o=>{!this.dismissible.current&&!this.open.current||(o?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=o)});this.open=o.open,this.activeSnapPoint=o.activeSnapPoint,this.closeThreshold=o.closeThreshold,this.shouldScaleBackground=o.shouldScaleBackground,this.scrollLockTimeout=o.scrollLockTimeout,this.snapPoints=o.snapPoints,this.fadeFromIndex=o.fadeFromIndex,this.fixed=o.fixed,this.dismissible=o.dismissible,this.direction=o.direction,this.onDragProp=o.onDrag,this.onReleaseProp=o.onRelease,this.nested=o.nested,this.onCloseProp=o.onClose,this.backgroundColor=o.backgroundColor,this.modal=o.modal,this.handleOnly=o.handleOnly,this.noBodyStyles=o.noBodyStyles,this.preventScrollRestoration=o.preventScrollRestoration,this.setBackgroundColorOnScale=o.setBackgroundColorOnScale,this.container=o.container,this.snapToSequentialPoint=o.snapToSequentialPoint,this.repositionInputs=o.repositionInputs,this.autoFocus=o.autoFocus,this.snapPointsState=new eC(this),this.positionFixedState=new JA(this),Tt(()=>{const g=this.snapPointsState.activeSnapPointIndex,b=this.snapPoints.current,I=this.snapPointsState.snapPointsOffset;return this.drawerNode,ki(()=>{var w;const E=()=>{var U;if(!this.drawerNode||!this.repositionInputs.current)return;const u=document.activeElement;if(UA(u)||this.keyboardIsOpen){const W=((U=window.visualViewport)==null?void 0:U.height)||0,Q=window.innerHeight;let j=Q-W;const V=this.drawerNode.getBoundingClientRect().height||0,ae=V>Q*.8;this.initialDrawerHeight||(this.initialDrawerHeight=V);const se=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-j)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),b&&b.length>0&&I&&g){const ue=I[g]||0;j+=ue}if(this.previousDiffFromInitial=j,V>W||this.keyboardIsOpen){const ue=this.drawerNode.getBoundingClientRect().height;let fe=ue;ue>W&&(fe=W-(ae?se:Zy)),this.fixed.current?this.drawerNode.style.height=`${ue-Math.max(j,0)}px`:this.drawerNode.style.height=`${Math.max(fe,W-se)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;b&&b.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(j,0)}px`}};return(w=window.visualViewport)==null||w.addEventListener("resize",E),()=>{var u;return(u=window.visualViewport)==null?void 0:u.removeEventListener("resize",E)}})}),Tt(()=>{const g=this.open.current;return ki(()=>(g&&(dr(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{GA(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return F(T(this,Bd))}set hasBeenOpened(o){Fe(T(this,Bd),qe(o))}get isDragging(){return F(T(this,Nd))}set isDragging(o){Fe(T(this,Nd),qe(o))}get justReleased(){return F(T(this,Vd))}set justReleased(o){Fe(T(this,Vd),qe(o))}get overlayNode(){return F(T(this,jd))}set overlayNode(o){Fe(T(this,jd),qe(o))}get openTime(){return F(T(this,Ud))}set openTime(o){Fe(T(this,Ud),qe(o))}get dragStartTime(){return F(T(this,qd))}set dragStartTime(o){Fe(T(this,qd),qe(o))}get dragEndTime(){return F(T(this,Zd))}set dragEndTime(o){Fe(T(this,Zd),qe(o))}get lastTimeDragPrevented(){return F(T(this,Gd))}set lastTimeDragPrevented(o){Fe(T(this,Gd),qe(o))}get isAllowedToDrag(){return F(T(this,Wd))}set isAllowedToDrag(o){Fe(T(this,Wd),qe(o))}get nestedOpenChangeTimer(){return F(T(this,Hd))}set nestedOpenChangeTimer(o){Fe(T(this,Hd),qe(o))}get pointerStart(){return F(T(this,Xd))}set pointerStart(o){Fe(T(this,Xd),qe(o))}get keyboardIsOpen(){return F(T(this,Kd))}set keyboardIsOpen(o){Fe(T(this,Kd),qe(o))}get previousDiffFromInitial(){return F(T(this,Jd))}set previousDiffFromInitial(o){Fe(T(this,Jd),qe(o))}get drawerNode(){return F(T(this,Yd))}set drawerNode(o){Fe(T(this,Yd),qe(o))}get drawerHeight(){return F(T(this,$d))}set drawerHeight(o){Fe(T(this,$d),qe(o))}get drawerWidth(){return F(T(this,Qd))}set drawerWidth(o){Fe(T(this,Qd),qe(o))}get initialDrawerHeight(){return F(T(this,ep))}set initialDrawerHeight(o){Fe(T(this,ep),qe(o))}get snapPointsOffset(){return F(T(this,ug))}}Bd=new WeakMap,Nd=new WeakMap,Vd=new WeakMap,jd=new WeakMap,Ud=new WeakMap,qd=new WeakMap,Zd=new WeakMap,Gd=new WeakMap,Wd=new WeakMap,Hd=new WeakMap,Xd=new WeakMap,Kd=new WeakMap,Jd=new WeakMap,Yd=new WeakMap,$d=new WeakMap,Qd=new WeakMap,ep=new WeakMap,ug=new WeakMap;var qn,Sc,tp,ip,hg,dg,pg;class nC{constructor(o,g){X(this,qn);X(this,Sc);X(this,tp);X(this,ip,Je(!1));X(this,hg,Te(()=>T(this,qn).snapPoints.current&&T(this,qn).snapPoints.current.length>0));X(this,dg,o=>{T(this,qn).onRelease(o)});X(this,pg,Te(()=>({id:T(this,Sc).current,"data-vaul-overlay":"","data-vaul-snap-points":T(this,qn).open.current&&F(T(this,hg))?"true":"false","data-vaul-snap-points-overlay":T(this,qn).open.current&&T(this,qn).snapPointsState.shouldFade?"true":"false",onmouseup:T(this,dg)})));je(this,qn,g),je(this,Sc,o.id),je(this,tp,o.ref),zb({id:T(this,Sc),ref:T(this,tp),onRefChange:b=>{this.mounted?T(this,qn).overlayNode=b:T(this,qn).overlayNode=null},deps:()=>this.mounted})}get mounted(){return F(T(this,ip))}set mounted(o){Fe(T(this,ip),qe(o))}get props(){return F(T(this,pg))}}qn=new WeakMap,Sc=new WeakMap,tp=new WeakMap,ip=new WeakMap,hg=new WeakMap,dg=new WeakMap,pg=new WeakMap;var Oi,Pc,rp,np,sp,op,ap,lp,cp,up,hp,dp,pp,fp,fg,mp,mg,gg,_g,yg,vg,xg,bg;class sC{constructor(o,g){X(this,Oi);X(this,Pc);X(this,rp);X(this,np);X(this,sp);X(this,op);X(this,ap);X(this,lp);X(this,cp);X(this,up);X(this,hp,Je(!1));X(this,dp,Je(null));X(this,pp,Je(null));X(this,fp,Je(!1));X(this,fg,Te(()=>T(this,Oi).snapPoints.current&&T(this,Oi).snapPoints.current.length>0));X(this,mp,Je(!1));Ve(this,"isDeltaInDirection",(o,g,b=0)=>{if(this.wasBeyondThePoint)return!0;const I=Math.abs(o.y),E=Math.abs(o.x),w=E>I,u=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(o.x*u<0)&&E>=0&&E<=b)return w}else if(!(o.y*u<0)&&I>=0&&I<=b)return!w;return this.wasBeyondThePoint=!0,!0});Ve(this,"handleOnPointerUp",o=>{this.pointerStart=null,this.wasBeyondThePoint=!1,T(this,Oi).onRelease(o)});Ve(this,"onOpenAutoFocus",o=>{T(this,up).current(o)});Ve(this,"onInteractOutside",o=>{if(T(this,np).current(o),!T(this,Oi).modal.current||o.defaultPrevented){o.preventDefault();return}T(this,Oi).keyboardIsOpen&&(T(this,Oi).keyboardIsOpen=!1)});Ve(this,"onFocusOutside",o=>{T(this,Oi).modal.current||o.preventDefault()});X(this,mg,o=>{if(this.lastKnownPointerEvent=o,T(this,Oi).handleOnly.current||(T(this,op).current(o),!this.pointerStart))return;const g=o.pageY-this.pointerStart.y,b=o.pageX-this.pointerStart.x,I=o.pointerType==="touch"?10:2,E={x:b,y:g};this.isDeltaInDirection(E,T(this,Oi).direction.current,I)?T(this,Oi).onDrag(o):(Math.abs(b)>I||Math.abs(g)>I)&&(this.pointerStart=null)});X(this,gg,o=>{T(this,ap).current(o),this.pointerStart=null,this.wasBeyondThePoint=!1,T(this,Oi).onRelease(o)});X(this,_g,o=>{T(this,lp).current(o),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,yg,o=>{T(this,cp).current(o),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,vg,o=>{T(this,Oi).handleOnly.current||(T(this,sp).current(o),this.pointerStart={x:o.pageX,y:o.pageY},T(this,Oi).onPress(o))});X(this,xg,Te(()=>M0(T(this,Oi).snapPointsState.snapPointsOffset)));X(this,bg,Te(()=>({id:T(this,Pc).current,"data-vaul-drawer-direction":T(this,Oi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":T(this,Oi).container.current?"true":"false","data-vaul-snap-points":T(this,Oi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:T(this,vg),onpointermove:T(this,mg),onpointerup:T(this,gg),onpointerout:T(this,_g),oncontextmenu:T(this,yg)})));je(this,Oi,g),je(this,Pc,o.id),je(this,rp,o.ref),je(this,np,o.onInteractOutside),je(this,sp,o.onPointerDown),je(this,op,o.onPointerMove),je(this,ap,o.onPointerUp),je(this,lp,o.onPointerOut),je(this,cp,o.onContextMenu),je(this,up,o.onOpenAutoFocus),zb({id:T(this,Pc),ref:T(this,rp),onRefChange:b=>{this.mounted?T(this,Oi).drawerNode=b:T(this,Oi).drawerNode=null},deps:()=>this.mounted&&T(this,Oi).open.current}),iC(T(this,Oi)),Tt(()=>{this.hasSnapPoints&&T(this,Oi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return F(T(this,hp))}set delayedSnapPoints(o){Fe(T(this,hp),qe(o))}get pointerStart(){return F(T(this,dp))}set pointerStart(o){Fe(T(this,dp),qe(o))}get lastKnownPointerEvent(){return F(T(this,pp))}set lastKnownPointerEvent(o){Fe(T(this,pp),qe(o))}get wasBeyondThePoint(){return F(T(this,fp))}set wasBeyondThePoint(o){Fe(T(this,fp),qe(o))}get hasSnapPoints(){return F(T(this,fg))}get mounted(){return F(T(this,mp))}set mounted(o){Fe(T(this,mp),qe(o))}get snapPointsOffset(){return F(T(this,xg))}get props(){return F(T(this,bg))}}Oi=new WeakMap,Pc=new WeakMap,rp=new WeakMap,np=new WeakMap,sp=new WeakMap,op=new WeakMap,ap=new WeakMap,lp=new WeakMap,cp=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,fg=new WeakMap,mp=new WeakMap,mg=new WeakMap,gg=new WeakMap,_g=new WeakMap,yg=new WeakMap,vg=new WeakMap,xg=new WeakMap,bg=new WeakMap;var Tc,wg;class oC{constructor(o){X(this,Tc);X(this,wg,Te(()=>({to:T(this,Tc).container.current?T(this,Tc).container.current:void 0})));je(this,Tc,o)}get props(){return F(T(this,wg))}}Tc=new WeakMap,wg=new WeakMap;const[aC,Wy]=QA("Drawer.Root");function lC(m){return aC(new rC(m))}function cC(m){const o=Wy();return new sC(m,o)}function uC(m){const o=Wy();return new nC(m,o)}function hC(){const m=Wy();return new oC(m)}function Lf(){return(window.innerWidth-Zy)/window.innerWidth}function dC(m){return 8*(Math.log(m+1)-2)}function zb({id:m,ref:o,deps:g=()=>!0,onRefChange:b=()=>{}}){const I=Te(()=>g());Tt(()=>(m.current,F(I),ki(()=>{const E=document.getElementById(m.current);return o.current=E,b(o.current),()=>{b(null)}}))),Tt(()=>()=>{o.current=null,b(null)})}function pC(m,o){Mt(o,!0);let g=te(o,"open",15,!1),b=te(o,"onOpenChange",3,pr),I=te(o,"closeThreshold",3,qA),E=te(o,"scrollLockTimeout",3,ZA),w=te(o,"fadeFromIndex",19,()=>o.snapPoints&&o.snapPoints.length-1),u=te(o,"backgroundColor",3,"black"),U=te(o,"nested",3,!1),W=te(o,"shouldScaleBackground",3,!1),Q=te(o,"activeSnapPoint",15,null),j=te(o,"onActiveSnapPointChange",3,pr),V=te(o,"onRelease",3,pr),ae=te(o,"onDrag",3,pr),se=te(o,"onClose",3,pr),ue=te(o,"dismissible",3,!0),fe=te(o,"direction",3,"bottom"),Pe=te(o,"fixed",3,!1),_e=te(o,"handleOnly",3,!1),Ee=te(o,"noBodyStyles",3,!1),Be=te(o,"preventScrollRestoration",3,!0),De=te(o,"setBackgroundColorOnScale",3,!0),Oe=te(o,"onAnimationEnd",3,pr),Ze=te(o,"controlledOpen",3,!1),ft=te(o,"repositionInputs",3,!0),We=te(o,"autoFocus",3,!1),mt=te(o,"snapToSequentialPoint",3,!1),st=te(o,"container",3,null),Ue=te(o,"controlledActiveSnapPoint",3,!1),Re=te(o,"modal",3,!0),Ae=ei(o,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const Ke=lC({open:we.with(()=>g(),xt=>{Ze()?_t(g()):(g(xt),_t(xt))}),closeThreshold:we.with(()=>I()),scrollLockTimeout:we.with(()=>E()),snapPoints:we.with(()=>o.snapPoints),fadeFromIndex:we.with(()=>w()),backgroundColor:we.with(()=>u()),nested:we.with(()=>U()),shouldScaleBackground:we.with(()=>W()),activeSnapPoint:we.with(()=>Q(),xt=>{Ue()||Q(xt),j()(xt)}),onRelease:we.with(()=>V()),onDrag:we.with(()=>ae()),onClose:we.with(()=>se()),dismissible:we.with(()=>ue()),direction:we.with(()=>fe()),fixed:we.with(()=>Pe()),modal:we.with(()=>Re()),handleOnly:we.with(()=>_e()),noBodyStyles:we.with(()=>Ee()),preventScrollRestoration:we.with(()=>Be()),setBackgroundColorOnScale:we.with(()=>De()),repositionInputs:we.with(()=>ft()),autoFocus:we.with(()=>We()),snapToSequentialPoint:we.with(()=>mt()),container:we.with(()=>st())});let rt;function _t(xt){var Dt;(Dt=b())==null||Dt(xt),xt&&!U()?rt=document.body.style.cssText:!xt&&!U()&&Sp(Wi.DURATION*1e3,()=>{document.body.style.cssText=rt}),!xt&&!U()&&Ke.positionFixedState.restorePositionSetting(),setTimeout(()=>{var qt;(qt=Oe())==null||qt(xt)},Wi.DURATION*1e3),xt&&!Re()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),xt||(document.body.style.pointerEvents="auto")}Tt(()=>()=>{U()||(document.body.style.cssText=rt)});var yt=ut(),ht=Xe(yt);ci(ht,()=>PA,(xt,Dt)=>{Dt(xt,ai({controlledOpen:!0,get open(){return Ke.open.current},onOpenChange:qt=>{Ke.onDialogOpenChange(qt),_t(qt)}},()=>Ae))}),Me(m,yt),zt()}function Db(m,o){Mt(o,!0),E0(()=>(o.onMounted(!0),()=>{o.onMounted(!1)})),zt()}class fC{constructor(o=0){Ve(this,"value",0);this.value=o}}const mC=new fC(0);function Rb(){return`vaul-${mC.value++}`}var gC=Gt("<!> <!>",1);function _C(m,o){Mt(o,!0);let g=te(o,"id",19,Rb),b=te(o,"ref",15,null),I=te(o,"onOpenAutoFocus",3,pr),E=te(o,"onInteractOutside",3,pr),w=te(o,"oncontextmenu",3,pr),u=te(o,"onpointerdown",3,pr),U=te(o,"onpointerup",3,pr),W=te(o,"onpointerout",3,pr),Q=te(o,"onpointermove",3,pr),j=te(o,"preventScroll",3,!0),V=ei(o,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const ae=cC({id:we.with(()=>g()),ref:we.with(()=>b(),Pe=>b(Pe)),onContextMenu:we.with(()=>w()??pr),onInteractOutside:we.with(()=>E()),onPointerDown:we.with(()=>u()??pr),onPointerMove:we.with(()=>Q()??pr),onPointerOut:we.with(()=>W()??pr),onPointerUp:we.with(()=>U()??pr),onOpenAutoFocus:we.with(()=>I())}),se=Te(()=>ji(V,ae.props));var ue=ut(),fe=Xe(ue);ci(fe,()=>AA,(Pe,_e)=>{_e(Pe,ai(()=>F(se),{get preventScroll(){return j()},get onInteractOutside(){return ae.onInteractOutside},get onFocusOutside(){return ae.onFocusOutside},get onOpenAutoFocus(){return ae.onOpenAutoFocus},children:(Ee,Be)=>{var De=gC(),Oe=Xe(De);Bt(Oe,()=>o.children??ri);var Ze=Fi(Oe,2);Db(Ze,{onMounted:ft=>ae.mounted=ft}),Me(Ee,De)},$$slots:{default:!0}}))}),Me(m,ue),zt()}var yC=Gt("<!> <!>",1);function vC(m,o){Mt(o,!0);let g=te(o,"id",19,Rb),b=te(o,"ref",15,null),I=ei(o,["$$slots","$$events","$$legacy","id","ref","children"]);const E=uC({id:we.with(()=>g()),ref:we.with(()=>b(),W=>b(W))}),w=Te(()=>ji(I,E.props));var u=ut(),U=Xe(u);ci(U,()=>XP,(W,Q)=>{Q(W,ai({get ref(){return b()},set ref(j){b(j)}},()=>F(w),{children:(j,V)=>{var ae=yC(),se=Xe(ae);Db(se,{onMounted:fe=>{E.mounted=fe}});var ue=Fi(se,2);Bt(ue,()=>o.children??ri),Me(j,ae)},$$slots:{default:!0}}))}),Me(m,u),zt()}function xC(m,o){Mt(o,!0);const g=hC();let b=te(o,"to",19,()=>g.props.to),I=ei(o,["$$slots","$$events","$$legacy","to"]);var E=ut(),w=Xe(E);ci(w,()=>Y0,(u,U)=>{U(u,ai({get to(){return b()}},()=>I))}),Me(m,E),zt()}const bC=_P,wC=JP;function SC(m,o){let g=te(o,"shouldScaleBackground",3,!0),b=te(o,"open",15,!1),I=te(o,"activeSnapPoint",15,null),E=ei(o,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var w=ut(),u=Xe(w);ci(u,()=>pC,(U,W)=>{W(U,ai({get shouldScaleBackground(){return g()},get open(){return b()},set open(Q){b(Q)},get activeSnapPoint(){return I()},set activeSnapPoint(Q){I(Q)}},()=>E))}),Me(m,w)}function PC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var I=ut(),E=Xe(I),w=Te(()=>nn("fixed inset-0 z-50 bg-black/80",o.class));ci(E,()=>vC,(u,U)=>{U(u,ai({get ref(){return g()},set ref(W){g(W)},get class(){return F(w)}},()=>b))}),Me(m,I),zt()}var TC=Gt('<div class="bg-muted mx-auto mt-4 h-2 w-[100px] rounded-full"></div> <!>',1),IC=Gt("<!> <!>",1);function AC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var I=ut(),E=Xe(I);ci(E,()=>xC,(w,u)=>{u(w,ai(()=>o.portalProps,{children:(U,W)=>{var Q=IC(),j=Xe(Q);PC(j,{});var V=Fi(j,2),ae=Te(()=>nn("bg-background fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border",o.class));ci(V,()=>_C,(se,ue)=>{ue(se,ai({get ref(){return g()},set ref(fe){g(fe)},get class(){return F(ae)}},()=>b,{children:(fe,Pe)=>{var _e=TC(),Ee=Fi(Xe(_e),2);Bt(Ee,()=>o.children??ri),Me(fe,_e)},$$slots:{default:!0}}))}),Me(U,Q)},$$slots:{default:!0}}))}),Me(m,I),zt()}function CC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var I=ut(),E=Xe(I),w=Te(()=>nn("text-muted-foreground text-sm",o.class));ci(E,()=>wC,(u,U)=>{U(u,ai({get ref(){return g()},set ref(W){g(W)},get class(){return F(w)}},()=>b))}),Me(m,I),zt()}var EC=Gt("<div><!></div>");function kC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class","children"]);var I=EC();let E;var w=Mi(I);Bt(w,()=>o.children??ri),zi(I),Nf(I,u=>g(u),()=>g()),fi(()=>E=Qi(I,E,{class:nn("grid gap-1.5 p-4 text-center sm:text-left",o.class),...b})),Me(m,I),zt()}function MC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=ei(o,["$$slots","$$events","$$legacy","ref","class"]);var I=ut(),E=Xe(I),w=Te(()=>nn("text-lg font-semibold leading-none tracking-tight",o.class));ci(E,()=>bC,(u,U)=>{U(u,ai({get ref(){return g()},set ref(W){g(W)},get class(){return F(w)}},()=>b))}),Me(m,I),zt()}function zC(m,o){Mt(o,!0);let g=te(o,"ref",15,null),b=te(o,"sideOffset",3,4),I=te(o,"align",3,"center"),E=ei(o,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var w=ut(),u=Xe(w);ci(u,()=>Y0,(U,W)=>{W(U,ai(()=>o.portalProps,{children:(Q,j)=>{var V=ut(),ae=Xe(V),se=Te(()=>nn("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 rounded-md border p-4 shadow-md outline-none",o.class));ci(ae,()=>bA,(ue,fe)=>{fe(ue,ai({get ref(){return g()},set ref(Pe){g(Pe)},get sideOffset(){return b()},get align(){return I()},get class(){return F(se)}},()=>E))}),Me(Q,V)},$$slots:{default:!0}}))}),Me(m,w),zt()}const DC=CA,RC=SA;function LC(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]);Tp(m,ai({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(I,E)=>{var w=ut(),u=Xe(w);kc(u,o,"default",{}),Me(I,w)},$$slots:{default:!0}}))}function OC(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]);Tp(m,ai({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(I,E)=>{var w=ut(),u=Xe(w);kc(u,o,"default",{}),Me(I,w)},$$slots:{default:!0}}))}function FC(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]);Tp(m,ai({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(I,E)=>{var w=ut(),u=Xe(w);kc(u,o,"default",{}),Me(I,w)},$$slots:{default:!0}}))}function BC(m,o){const g=Na(o,["children","$$slots","$$events","$$legacy"]);Tp(m,ai({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(I,E)=>{var w=ut(),u=Xe(w);kc(u,o,"default",{}),Me(I,w)},$$slots:{default:!0}}))}var Bf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var NC=Bf.exports,y0;function VC(){return y0||(y0=1,function(m,o){(function(g,b){m.exports=b()})(NC,function(){var g={},b={};function I(w,u,U){if(b[w]=U,w==="index"){var W="var sharedModule = {}; ("+b.shared+")(sharedModule); ("+b.worker+")(sharedModule);",Q={};return b.shared(Q),b.index(g,Q),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),g}}I("shared",["exports"],function(w){function u(i,t,r,s){return new(r||(r=Promise))(function(c,p){function f(P){try{v(s.next(P))}catch(A){p(A)}}function _(P){try{v(s.throw(P))}catch(A){p(A)}}function v(P){var A;P.done?c(P.value):(A=P.value,A instanceof r?A:new r(function(k){k(A)})).then(f,_)}v((s=s.apply(i,t||[])).next())})}function U(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var W=Q;function Q(i,t){this.x=i,this.y=t}Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround:function(i,t){var r=Math.cos(i),s=Math.sin(i),c=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Q.convert=function(i){return i instanceof Q?i:Array.isArray(i)?new Q(i[0],i[1]):i};var j=U(W),V=ae;function ae(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}ae.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=c/p}var f=0,_=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<t));s++)i>c?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var se=U(V);let ue,fe;function Pe(){return ue==null&&(ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ue}function _e(){if(fe==null&&(fe=!1,Pe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<5*5;s++){const c=4*s;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<5*5*4;s++)if(s%4!=3&&r[s]!==s){fe=!0;break}}}return fe||!1}function Ee(i,t,r,s){const c=new se(i,t,r,s);return p=>c.solve(p)}const Be=Ee(.25,.1,.25,1);function De(i,t,r){return Math.min(r,Math.max(t,i))}function Oe(i,t,r){const s=r-t,c=((i-t)%s+s)%s+t;return c===t?r:c}function Ze(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let ft=1;function We(i,t,r){const s={};for(const c in i)s[c]=t.call(this,i[c],c,i);return s}function mt(i,t,r){const s={};for(const c in i)t.call(this,i[c],c,i)&&(s[c]=i[c]);return s}function st(i){return Array.isArray(i)?i.map(st):typeof i=="object"&&i?We(i,st):i}const Ue={};function Re(i){Ue[i]||(typeof console<"u"&&console.warn(i),Ue[i]=!0)}function Ae(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Ke(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let rt=null;function _t(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(i,t,r,s,c){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const f=p==null?void 0:p.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const _=f.startsWith("BGR"),v=new Uint8ClampedArray(s*c*4);if(yield p.copyTo(v,function(P,A,k,D,O){const N=4*Math.max(-A,0),q=(Math.max(0,k)-k)*D*4+N,J=4*D,ie=Math.max(0,A),ve=Math.max(0,k);return{rect:{x:ie,y:ve,width:Math.min(P.width,A+D)-ie,height:Math.min(P.height,k+O)-ve},layout:[{offset:q,stride:J}]}}(i,t,r,s,c)),_)for(let P=0;P<v.length;P+=4){const A=v[P];v[P]=v[P+2],v[P+2]=A}return v}finally{p.close()}})}let xt,Dt;const qt="AbortError";function vi(){return new Error(qt)}const hi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Li(i){return hi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Ui="global-dispatcher";class Di extends Error{constructor(t,r,s,c){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=c}}const er=()=>Ke(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ar=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=Li(i.url);if(s)return s(i,t);if(Ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Ui},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(er())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(s,c){return u(this,void 0,void 0,function*(){const p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:er(),signal:c.signal});s.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");const f=yield fetch(p);if(!f.ok){const P=yield f.blob();throw new Di(f.status,f.statusText,s.url,P)}let _;_=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const v=yield _;if(c.signal.aborted)throw vi();return{data:v,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}})}(i,t);if(Ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Ui},t)}var r;return function(s,c){return new Promise((p,f)=>{var _;const v=new XMLHttpRequest;v.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(v.responseType="arraybuffer");for(const P in s.headers)v.setRequestHeader(P,s.headers[P]);s.type==="json"&&(v.responseType="text",!((_=s.headers)===null||_===void 0)&&_.Accept||v.setRequestHeader("Accept","application/json")),v.withCredentials=s.credentials==="include",v.onerror=()=>{f(new Error(v.statusText))},v.onload=()=>{if(!c.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let P=v.response;if(s.type==="json")try{P=JSON.parse(v.response)}catch(A){return void f(A)}p({data:P,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const P=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});f(new Di(v.status,v.statusText,s.url,P))}},c.signal.addEventListener("abort",()=>{v.abort(),f(vi())}),v.send(s.body)})}(i,t)};function Wr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function mr(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Hr(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class Dr{constructor(t,r={}){Ze(this,r),this.type=t}}class vt extends Dr{constructor(t,r={}){super("error",Ze({error:t},r))}}class Nt{on(t,r){return this._listeners=this._listeners||{},mr(t,r,this._listeners),this}off(t,r){return Hr(t,r,this._listeners),Hr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},mr(t,r,this._oneTimeListeners),this):new Promise(s=>this.once(t,s))}fire(t,r){typeof t=="string"&&(t=new Dr(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of c)_.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of p)Hr(s,_,this._oneTimeListeners),_.call(this,t);const f=this._eventedParent;f&&(Ze(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(t))}else t instanceof vt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Pi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function sn(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return Pi.forEach(s=>{s in t&&(r[s]=t[s])}),r}function Xt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Xt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Xt(i[r],t[r]))return!1;return!0}return i===t}function ui(i,t){i.push(t)}function gn(i,t,r){ui(r,{command:"addSource",args:[i,t[i]]})}function Xr(i,t,r){ui(t,{command:"removeSource",args:[i]}),r[i]=!0}function Rr(i,t,r,s){Xr(i,r,s),gn(i,t,r)}function Dn(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Xt(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!Xt(i[r][s],t[r][s]))return!1;return!0}function Lr(i,t,r,s,c,p){i=i||{},t=t||{};for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&(Xt(i[f],t[f])||r.push({command:p,args:[s,f,t[f],c]}));for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&!Object.prototype.hasOwnProperty.call(i,f)&&(Xt(i[f],t[f])||r.push({command:p,args:[s,f,t[f],c]}))}function Xs(i){return i.id}function es(i,t){return i[t.id]=t,i}class He{constructor(t,r,s,c){this.message=(t?`${t}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function on(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class lr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Rn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(t){return new Rn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ts={kind:"null"},et={kind:"number"},Zt={kind:"string"},Rt={kind:"boolean"},Or={kind:"color"},_n={kind:"object"},Vt={kind:"value"},Ln={kind:"collator"},Zn={kind:"formatted"},is={kind:"padding"},On={kind:"resolvedImage"},ee={kind:"variableAnchorOffsetCollection"};function L(i,t){return{kind:"array",itemType:i,N:t}}function R(i){if(i.kind==="array"){const t=R(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const G=[ts,et,Zt,Rt,Or,Zn,_n,L(Vt),is,On,ee];function Y(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Y(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of G)if(!Y(r,t))return null}}return`Expected ${R(i)} but found ${R(t)} instead.`}function he(i,t){return t.some(r=>r.kind===i.kind)}function pe(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ye(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const oe=.96422,Ce=.82521,Le=4/29,Se=6/29,Ye=3*Se*Se,At=Se*Se*Se,Ct=Math.PI/180,ti=180/Math.PI;function jt(i){return(i%=360)<0&&(i+=360),i}function ii([i,t,r,s]){let c,p;const f=Ji((.2225045*(i=Kt(i))+.7168786*(t=Kt(t))+.0606169*(r=Kt(r)))/1);i===t&&t===r?c=p=f:(c=Ji((.4360747*i+.3850649*t+.1430804*r)/oe),p=Ji((.0139322*i+.0971045*t+.7141733*r)/Ce));const _=116*f-16;return[_<0?0:_,500*(c-f),200*(f-p),s]}function Kt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ji(i){return i>At?Math.pow(i,1/3):i/Ye+Le}function Bi([i,t,r,s]){let c=(i+16)/116,p=isNaN(t)?c:c+t/500,f=isNaN(r)?c:c-r/200;return c=1*di(c),p=oe*di(p),f=Ce*di(f),[Wt(3.1338561*p-1.6168667*c-.4906146*f),Wt(-.9787684*p+1.9161415*c+.033454*f),Wt(.0719453*p-.2289914*c+1.4052427*f),s]}function Wt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function di(i){return i>Se?i*i*i:Ye*(i-Le)}function Ri(i){return parseInt(i.padEnd(2,i),16)/255}function rr(i,t){return cr(t?i/100:i,0,1)}function cr(i,t,r){return Math.min(Math.max(t,i),r)}function Pr(i){return!i.some(Number.isNaN)}const Ks={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class pi{constructor(t,r,s,c=1,p=!0){this.r=t,this.g=r,this.b=s,this.a=c,p||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,r,s,c]))}static parse(t){if(t instanceof pi)return t;if(typeof t!="string")return;const r=function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=Ks[s];if(c){const[f,_,v]=c;return[f/255,_/255,v/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let _=1;return[Ri(s.slice(_,_+=f)),Ri(s.slice(_,_+=f)),Ri(s.slice(_,_+=f)),Ri(s.slice(_,_+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[_,v,P,A,k,D,O,N,q,J,ie,ve]=f,ce=[A||" ",O||" ",J].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const ge=[P,D,q].join(""),Ie=ge==="%%%"?100:ge===""?255:0;if(Ie){const Ne=[cr(+v/Ie,0,1),cr(+k/Ie,0,1),cr(+N/Ie,0,1),ie?rr(+ie,ve):1];if(Pr(Ne))return Ne}}return}}const p=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,_,v,P,A,k,D,O,N]=p,q=[v||" ",A||" ",D].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const J=[+_,cr(+P,0,100),cr(+k,0,100),O?rr(+O,N):1];if(Pr(J))return function([ie,ve,ce,ge]){function Ie(Ne){const lt=(Ne+ie/30)%12,Et=ve*Math.min(ce,1-ce);return ce-Et*Math.max(-1,Math.min(lt-3,9-lt,1))}return ie=jt(ie),ve/=100,ce/=100,[Ie(0),Ie(8),Ie(4),ge]}(J)}}}(t);return r?new pi(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:c}=this,p=c||1/0;return this.overwriteGetter("rgb",[t/p,r/p,s/p,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,s,c,p]=ii(t),f=Math.sqrt(s*s+c*c);return[Math.round(1e4*f)?jt(Math.atan2(c,s)*ti):NaN,f,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ii(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,c]=this.rgb;return`rgba(${[t,r,s].map(p=>Math.round(255*p)).join(",")},${c})`}}pi.black=new pi(0,0,0,1),pi.white=new pi(1,1,1,1),pi.transparent=new pi(0,0,0,0),pi.red=new pi(1,0,0,1);class Oc{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fc{constructor(t,r,s,c,p){this.text=t,this.image=r,this.scale=s,this.fontStack=c,this.textColor=p}}class Kr{constructor(t){this.sections=t}static fromString(t){return new Kr([new Fc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Kr?t:Kr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Jr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Jr)return t;if(typeof t=="number")return new Jr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Jr(t)}}toString(){return JSON.stringify(this.values)}}const Dg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class an{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof an)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],c=t[r+1];if(typeof s!="string"||!Dg.has(s)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new an(t)}}toString(){return JSON.stringify(this.values)}}class Yr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Yr({name:t,available:!1}):null}}function Js(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof pi||i instanceof Oc||i instanceof Kr||i instanceof Jr||i instanceof an||i instanceof Yr)return!0;if(Array.isArray(i)){for(const t of i)if(!bs(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!bs(i[t]))return!1;return!0}return!1}function Yi(i){if(i===null)return ts;if(typeof i=="string")return Zt;if(typeof i=="boolean")return Rt;if(typeof i=="number")return et;if(i instanceof pi)return Or;if(i instanceof Oc)return Ln;if(i instanceof Kr)return Zn;if(i instanceof Jr)return is;if(i instanceof an)return ee;if(i instanceof Yr)return On;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const c=Yi(s);if(r){if(r===c)continue;r=Vt;break}r=c}return L(r||Vt,t)}return _n}function Qo(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof pi||i instanceof Kr||i instanceof Jr||i instanceof an||i instanceof Yr?i.toString():JSON.stringify(i)}class yn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!bs(t[1]))return r.error("invalid value");const s=t[1];let c=Yi(s);const p=r.expectedType;return c.kind!=="array"||c.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(c=p),new yn(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Hi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ua={string:Zt,number:et,boolean:Rt,object:_n};class vn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,c=1;const p=t[0];if(p==="array"){let _,v;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ua)||P==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Ua[P],c++}else _=Vt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=t[2],c++}s=L(_,v)}else{if(!Ua[p])throw new Error(`Types doesn't contain name = ${p}`);s=Ua[p]}const f=[];for(;c<t.length;c++){const _=r.parse(t[c],c,Vt);if(!_)return null;f.push(_)}return new vn(s,f)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!Y(this.type,Yi(s)))return s;if(r===this.args.length-1)throw new Hi(`Expected value to be of type ${R(this.type)}, but found ${R(Yi(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Bc={"to-boolean":Rt,"to-color":Or,"to-number":et,"to-string":Zt};class xn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!Bc[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const c=Bc[s],p=[];for(let f=1;f<t.length;f++){const _=r.parse(t[f],f,Vt);if(!_)return null;p.push(_)}return new xn(c,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const c of this.args){if(r=c.evaluate(t),s=null,r instanceof pi)return r;if(typeof r=="string"){const p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Js(r[0],r[1],r[2],r[3]),!s))return new pi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Hi(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const c=Jr.parse(r);if(c)return c}throw new Hi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const c=an.parse(r);if(c)return c}throw new Hi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Hi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Kr.fromString(Qo(this.args[0].evaluate(t)));case"resolvedImage":return Yr.fromString(Qo(this.args[0].evaluate(t)));default:return Qo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Rg=["Unknown","Point","LineString","Polygon"];class qa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Rg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=pi.parse(t)),r}}class ws{constructor(t,r,s=[],c,p=new Rn,f=[]){this.registry=t,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=f,this.expectedType=c,this._isConstant=r}parse(t,r,s,c,p={}){return r?this.concat(r,s,c)._parse(t,p):this._parse(t,p)}_parse(t,r){function s(c,p,f){return f==="assert"?new vn(p,[c]):f==="coerce"?new xn(p,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[c];if(p){let f=p.parse(t,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,v=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string")if(_.kind!=="padding"||v.kind!=="value"&&v.kind!=="number"&&v.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||v.kind!=="value"&&v.kind!=="array"){if(this.checkSubtype(_,v))return null}else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"coerce");else f=s(f,_,r.typeAnnotation||"assert")}if(!(f instanceof yn)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const _=new qa;try{f=new yn(f.type,f.evaluate(_))}catch(v){return this.error(v.message),null}}return f}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const c=typeof t=="number"?this.path.concat(t):this.path,p=s?this.scope.concat(s):this.scope;return new ws(this.registry,this._isConstant,c,r||null,p,this.errors)}error(t,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new lr(s,t))}checkSubtype(t,r){const s=Y(t,r);return s&&this.error(s),s}}class rs{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let p=1;p<t.length-1;p+=2){const f=t[p];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const _=r.parse(t[p+1],p+1);if(!_)return null;s.push([f,_])}const c=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return c?new rs(s,c):null}outputDefined(){return this.result.outputDefined()}}class oi{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new oi(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Nc{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,et),c=r.parse(t[2],2,L(r.expectedType||Vt));return s&&c?new Nc(c.type.itemType,s,c):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new Hi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new Hi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new Hi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Vc{constructor(t,r){this.type=Rt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Vt),c=r.parse(t[2],2,Vt);return s&&c?he(s.type,[Rt,Zt,et,ts,Vt])?new Vc(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!pe(r,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${R(Yi(r))} instead.`);if(!pe(s,["string","array"]))throw new Hi(`Expected second argument to be of type array or string, but found ${R(Yi(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ys{constructor(t,r,s){this.type=et,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Vt),c=r.parse(t[2],2,Vt);if(!s||!c)return null;if(!he(s.type,[Rt,Zt,et,ts,Vt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(s.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,et);return p?new Ys(s,c,p):null}return new Ys(s,c)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!pe(r,["boolean","string","number","null"]))throw new Hi(`Expected first argument to be of type boolean, string, number or null, but found ${R(Yi(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),pe(s,["string"])){const p=s.indexOf(r,c);return p===-1?-1:[...s.slice(0,p)].length}if(pe(s,["array"]))return s.indexOf(r,c);throw new Hi(`Expected second argument to be of type array or string, but found ${R(Yi(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class jc{constructor(t,r,s,c,p,f){this.inputType=t,this.type=r,this.input=s,this.cases=c,this.outputs=p,this.otherwise=f}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const p={},f=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const k=t[P+1];Array.isArray(A)||(A=[A]);const D=r.concat(P);if(A.length===0)return D.error("Expected at least one branch label.");for(const N of A){if(typeof N!="number"&&typeof N!="string")return D.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,Yi(N)))return null}else s=Yi(N);if(p[String(N)]!==void 0)return D.error("Branch labels must be unique.");p[String(N)]=f.length}const O=r.parse(k,P,c);if(!O)return null;c=c||O.type,f.push(O)}const _=r.parse(t[1],1,Vt);if(!_)return null;const v=r.parse(t[t.length-1],t.length-1,c);return v?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new jc(s,c,_,p,f,v):null}evaluate(t){const r=this.input.evaluate(t);return(Yi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Za{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let f=1;f<t.length-1;f+=2){const _=r.parse(t[f],f,Rt);if(!_)return null;const v=r.parse(t[f+1],f+1,s);if(!v)return null;c.push([_,v]),s=s||v.type}const p=r.parse(t[t.length-1],t.length-1,s);if(!p)return null;if(!s)throw new Error("Can't infer output type");return new Za(s,c,p)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ea{constructor(t,r,s,c){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,Vt),c=r.parse(t[2],2,et);if(!s||!c)return null;if(!he(s.type,[L(Vt),Zt,Vt]))return r.error(`Expected first argument to be of type array or string, but found ${R(s.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,et);return p?new ea(s.type,s,c,p):null}return new ea(s.type,s,c)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),pe(r,["string"]))return[...r].slice(s,c).join("");if(pe(r,["array"]))return r.slice(s,c);throw new Hi(`Expected first argument to be of type array or string, but found ${R(Yi(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ga(i,t){const r=i.length-1;let s,c,p=0,f=r,_=0;for(;p<=f;)if(_=Math.floor((p+f)/2),s=i[_],c=i[_+1],s<=t){if(_===r||t<c)return _;p=_+1}else{if(!(s>t))throw new Hi("Input is not a number.");f=_-1}return 0}class $s{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[c,p]of s)this.labels.push(c),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,et);if(!s)return null;const c=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let f=1;f<t.length;f+=2){const _=f===1?-1/0:t[f],v=t[f+1],P=f,A=f+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(c.length&&c[c.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const k=r.parse(v,A,p);if(!k)return null;p=p||k.type,c.push([_,k])}return new $s(p,s,c)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return s[0].evaluate(t);const p=r.length;return c>=r[p-1]?s[p-1].evaluate(t):s[Ga(r,c)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Cp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Lg=Ep;function Ep(i,t,r,s){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(s-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=s}Ep.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,s=0;s<8;s++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=c/p}var f=0,_=1;for(r=i,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<t));s++)i>c?f=r:_=r,r=.5*(_-f)+f;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Og=Cp(Lg);function Ss(i,t,r){return i+r*(t-i)}function ta(i,t,r){return i.map((s,c)=>Ss(s,t[c],r))}const Fr={number:Ss,color:function(i,t,r,s="rgb"){switch(s){case"rgb":{const[c,p,f,_]=ta(i.rgb,t.rgb,r);return new pi(c,p,f,_,!1)}case"hcl":{const[c,p,f,_]=i.hcl,[v,P,A,k]=t.hcl;let D,O;if(isNaN(c)||isNaN(v))isNaN(c)?isNaN(v)?D=NaN:(D=v,f!==1&&f!==0||(O=P)):(D=c,A!==1&&A!==0||(O=p));else{let ve=v-c;v>c&&ve>180?ve-=360:v<c&&c-v>180&&(ve+=360),D=c+r*ve}const[N,q,J,ie]=function([ve,ce,ge,Ie]){return ve=isNaN(ve)?0:ve*Ct,Bi([ge,Math.cos(ve)*ce,Math.sin(ve)*ce,Ie])}([D,O??Ss(p,P,r),Ss(f,A,r),Ss(_,k,r)]);return new pi(N,q,J,ie,!1)}case"lab":{const[c,p,f,_]=Bi(ta(i.lab,t.lab,r));return new pi(c,p,f,_,!1)}}},array:ta,padding:function(i,t,r){return new Jr(ta(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const s=i.values,c=t.values;if(s.length!==c.length)throw new Hi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const p=[];for(let f=0;f<s.length;f+=2){if(s[f]!==c[f])throw new Hi(`Cannot interpolate values containing mismatched anchors. from[${f}]: ${s[f]}, to[${f}]: ${c[f]}`);p.push(s[f]);const[_,v]=s[f+1],[P,A]=c[f+1];p.push([Ss(_,P,r),Ss(v,A,r)])}return new an(p)}};class Br{constructor(t,r,s,c,p){this.type=t,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[f,_]of p)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(t,r,s,c){let p=0;if(t.name==="exponential")p=Wa(r,t.base,s,c);else if(t.name==="linear")p=Wa(r,1,s,c);else if(t.name==="cubic-bezier"){const f=t.controlPoints;p=new Og(f[0],f[1],f[2],f[3]).solve(Wa(r,1,s,c))}return p}static parse(t,r){let[s,c,p,...f]=t;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const P=c[1];if(typeof P!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:P}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const P=c.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,et),!p)return null;const _=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=Or:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let P=0;P<f.length;P+=2){const A=f[P],k=f[P+1],D=P+3,O=P+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const N=r.parse(k,O,v);if(!N)return null;v=v||N.type,_.push([A,N])}return ye(v,et)||ye(v,Or)||ye(v,is)||ye(v,ee)||ye(v,L(et))?new Br(v,s,c,p,_):r.error(`Type ${R(v)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return s[0].evaluate(t);const p=r.length;if(c>=r[p-1])return s[p-1].evaluate(t);const f=Ga(r,c),_=Br.interpolationFactor(this.interpolation,c,r[f],r[f+1]),v=s[f].evaluate(t),P=s[f+1].evaluate(t);switch(this.operator){case"interpolate":return Fr[this.type.kind](v,P,_);case"interpolate-hcl":return Fr.color(v,P,_,"hcl");case"interpolate-lab":return Fr.color(v,P,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Wa(i,t,r,s){const c=s-r,p=i-r;return c===0?0:t===1?p/c:(Math.pow(t,p)-1)/(Math.pow(t,c)-1)}class Ha{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const p=[];for(const _ of t.slice(1)){const v=r.parse(_,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,p.push(v)}if(!s)throw new Error("No output type");const f=c&&p.some(_=>Y(c,_.type));return new Ha(f?Vt:s,p)}evaluate(t){let r,s=null,c=0;for(const p of this.args)if(c++,s=p.evaluate(t),s&&s instanceof Yr&&!s.available&&(r||(r=s.name),s=null,c===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Xa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function kp(i,t,r,s){return s.compare(t,r)===0}function Qs(i,t,r){const s=i!=="=="&&i!=="!=";return class Lb{constructor(p,f,_){this.type=Rt,this.lhs=p,this.rhs=f,this.collator=_,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const _=p[0];let v=f.parse(p[1],1,Vt);if(!v)return null;if(!Xa(_,v.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${R(v.type)}'.`);let P=f.parse(p[2],2,Vt);if(!P)return null;if(!Xa(_,P.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${R(P.type)}'.`);if(v.type.kind!==P.type.kind&&v.type.kind!=="value"&&P.type.kind!=="value")return f.error(`Cannot compare types '${R(v.type)}' and '${R(P.type)}'.`);s&&(v.type.kind==="value"&&P.type.kind!=="value"?v=new vn(P.type,[v]):v.type.kind!=="value"&&P.type.kind==="value"&&(P=new vn(v.type,[P])));let A=null;if(p.length===4){if(v.type.kind!=="string"&&P.type.kind!=="string"&&v.type.kind!=="value"&&P.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(A=f.parse(p[3],3,Ln),!A)return null}return new Lb(v,P,A)}evaluate(p){const f=this.lhs.evaluate(p),_=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const v=Yi(f),P=Yi(_);if(v.kind!==P.kind||v.kind!=="string"&&v.kind!=="number")throw new Hi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${P.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=Yi(f),P=Yi(_);if(v.kind!=="string"||P.kind!=="string")return t(p,f,_)}return this.collator?r(p,f,_,this.collator.evaluate(p)):t(p,f,_)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const Fg=Qs("==",function(i,t,r){return t===r},kp),Mp=Qs("!=",function(i,t,r){return t!==r},function(i,t,r,s){return!kp(0,t,r,s)}),zp=Qs("<",function(i,t,r){return t<r},function(i,t,r,s){return s.compare(t,r)<0}),Bg=Qs(">",function(i,t,r){return t>r},function(i,t,r,s){return s.compare(t,r)>0}),Ng=Qs("<=",function(i,t,r){return t<=r},function(i,t,r,s){return s.compare(t,r)<=0}),Dp=Qs(">=",function(i,t,r){return t>=r},function(i,t,r,s){return s.compare(t,r)>=0});class ia{constructor(t,r,s){this.type=Ln,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Rt);if(!c)return null;const p=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Rt);if(!p)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,Zt),!f)?null:new ia(c,p,f)}evaluate(t){return new Oc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Uc{constructor(t,r,s,c,p){this.type=Zt,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,et);if(!s)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let p=null;if(c.locale&&(p=r.parse(c.locale,1,Zt),!p))return null;let f=null;if(c.currency&&(f=r.parse(c.currency,1,Zt),!f))return null;let _=null;if(c["min-fraction-digits"]&&(_=r.parse(c["min-fraction-digits"],1,et),!_))return null;let v=null;return c["max-fraction-digits"]&&(v=r.parse(c["max-fraction-digits"],1,et),!v)?null:new Uc(s,p,f,_,v)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ka{constructor(t){this.type=Zn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let p=!1;for(let f=1;f<=t.length-1;++f){const _=t[f];if(p&&typeof _=="object"&&!Array.isArray(_)){p=!1;let v=null;if(_["font-scale"]&&(v=r.parse(_["font-scale"],1,et),!v))return null;let P=null;if(_["text-font"]&&(P=r.parse(_["text-font"],1,L(Zt)),!P))return null;let A=null;if(_["text-color"]&&(A=r.parse(_["text-color"],1,Or),!A))return null;const k=c[c.length-1];k.scale=v,k.font=P,k.textColor=A}else{const v=r.parse(t[f],1,Vt);if(!v)return null;const P=v.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,c.push({content:v,scale:null,font:null,textColor:null})}}return new Ka(c)}evaluate(t){return new Kr(this.sections.map(r=>{const s=r.content.evaluate(t);return Yi(s)===On?new Fc("",s,null,null,null):new Fc(Qo(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class qc{constructor(t){this.type=On,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Zt);return s?new qc(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=Yr.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class Zc{constructor(t){this.type=et,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${R(s.type)} instead.`):new Zc(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Hi(`Expected value to be of type string or array, but found ${R(Yi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Fn=8192;function Vg(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(r*c*Fn),Math.round(s*c*Fn)]}function Gc(i,t){const r=Math.pow(2,t.z);return[(c=(i[0]/Fn+t.x)/r,360*c-180),(s=(i[1]/Fn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,c}function Ps(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ns(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function li(i,t,r){const s=i[0]-t[0],c=i[1]-t[1],p=i[0]-r[0],f=i[1]-r[1];return s*f-p*c==0&&s*p<=0&&c*f<=0}function Ja(i,t,r,s){return(c=[s[0]-r[0],s[1]-r[1]])[0]*(p=[t[0]-i[0],t[1]-i[1]])[1]-c[1]*p[0]!=0&&!(!Lp(i,t,r,s)||!Lp(r,s,i,t));var c,p}function jg(i,t,r){for(const s of r)for(let c=0;c<s.length-1;++c)if(Ja(i,t,s[c],s[c+1]))return!0;return!1}function eo(i,t,r=!1){let s=!1;for(const _ of t)for(let v=0;v<_.length-1;v++){if(li(i,_[v],_[v+1]))return r;(p=_[v])[1]>(c=i)[1]!=(f=_[v+1])[1]>c[1]&&c[0]<(f[0]-p[0])*(c[1]-p[1])/(f[1]-p[1])+p[0]&&(s=!s)}var c,p,f;return s}function Ug(i,t){for(const r of t)if(eo(i,r))return!0;return!1}function Rp(i,t){for(const r of i)if(!eo(r,t))return!1;for(let r=0;r<i.length-1;++r)if(jg(i[r],i[r+1],t))return!1;return!0}function qg(i,t){for(const r of t)if(Rp(i,r))return!0;return!1}function Lp(i,t,r,s){const c=s[0]-r[0],p=s[1]-r[1],f=(i[0]-r[0])*p-c*(i[1]-r[1]),_=(t[0]-r[0])*p-c*(t[1]-r[1]);return f>0&&_<0||f<0&&_>0}function Wc(i,t,r){const s=[];for(let c=0;c<i.length;c++){const p=[];for(let f=0;f<i[c].length;f++){const _=Vg(i[c][f],r);Ps(t,_),p.push(_)}s.push(p)}return s}function Op(i,t,r){const s=[];for(let c=0;c<i.length;c++){const p=Wc(i[c],t,r);s.push(p)}return s}function Fp(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const c=.5*s;let p=i[0]-r[0]>c?-s:r[0]-i[0]>c?s:0;p===0&&(p=i[0]-r[2]>c?-s:r[2]-i[0]>c?s:0),i[0]+=p}Ps(t,i)}function Bp(i,t,r,s){const c=Math.pow(2,s.z)*Fn,p=[s.x*Fn,s.y*Fn],f=[];for(const _ of i)for(const v of _){const P=[v.x+p[0],v.y+p[1]];Fp(P,t,r,c),f.push(P)}return f}function Np(i,t,r,s){const c=Math.pow(2,s.z)*Fn,p=[s.x*Fn,s.y*Fn],f=[];for(const v of i){const P=[];for(const A of v){const k=[A.x+p[0],A.y+p[1]];Ps(t,k),P.push(k)}f.push(P)}if(t[2]-t[0]<=c/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const v of f)for(const P of v)Fp(P,t,r,c)}var _;return f}class Ts{constructor(t,r){this.type=Rt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(bs(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const c=[];for(const p of s.features){const{type:f,coordinates:_}=p.geometry;f==="Polygon"&&c.push(_),f==="MultiPolygon"&&c.push(..._)}if(c.length)return new Ts(s,{type:"MultiPolygon",coordinates:c})}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ts(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Ts(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=Wc(s.coordinates,p,f),v=Bp(r.geometry(),c,p,f);if(!ns(c,p))return!1;for(const P of v)if(!eo(P,_))return!1}if(s.type==="MultiPolygon"){const _=Op(s.coordinates,p,f),v=Bp(r.geometry(),c,p,f);if(!ns(c,p))return!1;for(const P of v)if(!Ug(P,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=Wc(s.coordinates,p,f),v=Np(r.geometry(),c,p,f);if(!ns(c,p))return!1;for(const P of v)if(!Rp(P,_))return!1}if(s.type==="MultiPolygon"){const _=Op(s.coordinates,p,f),v=Np(r.geometry(),c,p,f);if(!ns(c,p))return!1;for(const P of v)if(!qg(P,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Vp=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const c=i-1>>1,p=t[c];if(r(s,p)>=0)break;t[i]=p,i=c}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,c=t[i];for(;i<s;){let p=1+(i<<1);const f=p+1;if(f<this.length&&r(t[f],t[p])<0&&(p=f),r(t[p],c)>=0)break;t[i]=t[p],i=p}t[i]=c}};function Zg(i,t,r,s,c){jp(i,t,r,s||i.length-1,c||Gg)}function jp(i,t,r,s,c){for(;s>r;){if(s-r>600){var p=s-r+1,f=t-r+1,_=Math.log(p),v=.5*Math.exp(2*_/3),P=.5*Math.sqrt(_*v*(p-v)/p)*(f-p/2<0?-1:1);jp(i,t,Math.max(r,Math.floor(t-f*v/p+P)),Math.min(s,Math.floor(t+(p-f)*v/p+P)),c)}var A=i[t],k=r,D=s;for(ra(i,r,t),c(i[s],A)>0&&ra(i,r,s);k<D;){for(ra(i,k,D),k++,D--;c(i[k],A)<0;)k++;for(;c(i[D],A)>0;)D--}c(i[r],A)===0?ra(i,r,D):ra(i,++D,s),D<=t&&(r=D+1),t<=D&&(s=D-1)}}function ra(i,t,r){var s=i[t];i[t]=i[r],i[r]=s}function Gg(i,t){return i<t?-1:i>t?1:0}function Ya(i,t){if(i.length<=1)return[i];const r=[];let s,c;for(const p of i){const f=Hg(p);f!==0&&(p.area=Math.abs(f),c===void 0&&(c=f<0),c===f<0?(s&&r.push(s),s=[p]):s.push(p))}if(s&&r.push(s),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(Zg(r[p],t,1,r[p].length-1,Wg),r[p]=r[p].slice(0,t));return r}function Wg(i,t){return t.area-i.area}function Hg(i){let t=0;for(let r,s,c=0,p=i.length,f=p-1;c<p;f=c++)r=i[c],s=i[f],t+=(s.x-r.x)*(r.y+s.y);return t}const Up=1/298.257223563,qp=Up*(2-Up),Zp=Math.PI/180;class Hc{constructor(t){const r=6378.137*Zp*1e3,s=Math.cos(t*Zp),c=1/(1-qp*(1-s*s)),p=Math.sqrt(c);this.kx=r*p*s,this.ky=r*p*c*(1-qp)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,c=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+c*c)}pointOnLine(t,r){let s,c,p,f,_=1/0;for(let v=0;v<t.length-1;v++){let P=t[v][0],A=t[v][1],k=this.wrap(t[v+1][0]-P)*this.kx,D=(t[v+1][1]-A)*this.ky,O=0;k===0&&D===0||(O=(this.wrap(r[0]-P)*this.kx*k+(r[1]-A)*this.ky*D)/(k*k+D*D),O>1?(P=t[v+1][0],A=t[v+1][1]):O>0&&(P+=k/this.kx*O,A+=D/this.ky*O)),k=this.wrap(r[0]-P)*this.kx,D=(r[1]-A)*this.ky;const N=k*k+D*D;N<_&&(_=N,s=P,c=A,p=v,f=O)}return{point:[s,c],index:p,t:Math.max(0,Math.min(1,f))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Gp(i,t){return t[0]-i[0]}function $a(i){return i[1]-i[0]+1}function Gn(i,t){return i[1]>=i[0]&&i[1]<t}function Xc(i,t){if(i[0]>i[1])return[null,null];const r=$a(i);if(t){if(r===2)return[i,null];const c=Math.floor(r/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function Kc(i,t){if(!Gn(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)Ps(r,i[s]);return r}function Jc(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)Ps(t,s);return t}function Qa(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Yc(i,t,r){if(!Qa(i)||!Qa(t))return NaN;let s=0,c=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(c=i[1]-t[3]),i[3]<t[1]&&(c=t[1]-i[3]),r.distance([0,0],[s,c])}function Is(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function $c(i,t,r,s,c){const p=Math.min(Is(i,[r,s],c),Is(t,[r,s],c)),f=Math.min(Is(r,[i,t],c),Is(s,[i,t],c));return Math.min(p,f)}function Xg(i,t,r,s,c){if(!Gn(t,i.length)||!Gn(s,r.length))return 1/0;let p=1/0;for(let f=t[0];f<t[1];++f){const _=i[f],v=i[f+1];for(let P=s[0];P<s[1];++P){const A=r[P],k=r[P+1];if(Ja(_,v,A,k))return 0;p=Math.min(p,$c(_,v,A,k,c))}}return p}function qi(i,t,r,s,c){if(!Gn(t,i.length)||!Gn(s,r.length))return NaN;let p=1/0;for(let f=t[0];f<=t[1];++f)for(let _=s[0];_<=s[1];++_)if(p=Math.min(p,c.distance(i[f],r[_])),p===0)return p;return p}function Kg(i,t,r){if(eo(i,t,!0))return 0;let s=1/0;for(const c of t){const p=c[0],f=c[c.length-1];if(p!==f&&(s=Math.min(s,Is(i,[f,p],r)),s===0))return s;const _=r.pointOnLine(c,i);if(s=Math.min(s,r.distance(i,_.point)),s===0)return s}return s}function Ht(i,t,r,s){if(!Gn(t,i.length))return NaN;for(let p=t[0];p<=t[1];++p)if(eo(i[p],r,!0))return 0;let c=1/0;for(let p=t[0];p<t[1];++p){const f=i[p],_=i[p+1];for(const v of r)for(let P=0,A=v.length,k=A-1;P<A;k=P++){const D=v[k],O=v[P];if(Ja(f,_,D,O))return 0;c=Math.min(c,$c(f,_,D,O,s))}}return c}function el(i,t){for(const r of i)for(const s of r)if(eo(s,t,!0))return!0;return!1}function wi(i,t,r,s=1/0){const c=Jc(i),p=Jc(t);if(s!==1/0&&Yc(c,p,r)>=s)return s;if(ns(c,p)){if(el(i,t))return 0}else if(el(t,i))return 0;let f=1/0;for(const _ of i)for(let v=0,P=_.length,A=P-1;v<P;A=v++){const k=_[A],D=_[v];for(const O of t)for(let N=0,q=O.length,J=q-1;N<q;J=N++){const ie=O[J],ve=O[N];if(Ja(k,D,ie,ve))return 0;f=Math.min(f,$c(k,D,ie,ve,r))}}return f}function mi(i,t,r,s,c,p){if(!p)return;const f=Yc(Kc(s,p),c,r);f<t&&i.push([f,p,[0,0]])}function As(i,t,r,s,c,p,f){if(!p||!f)return;const _=Yc(Kc(s,p),Kc(c,f),r);_<t&&i.push([_,p,f])}function na(i,t,r,s,c=1/0){let p=Math.min(s.distance(i[0],r[0][0]),c);if(p===0)return p;const f=new Vp([[0,[0,i.length-1],[0,0]]],Gp),_=Jc(r);for(;f.length>0;){const v=f.pop();if(v[0]>=p)continue;const P=v[1],A=t?50:100;if($a(P)<=A){if(!Gn(P,i.length))return NaN;if(t){const k=Ht(i,P,r,s);if(isNaN(k)||k===0)return k;p=Math.min(p,k)}else for(let k=P[0];k<=P[1];++k){const D=Kg(i[k],r,s);if(p=Math.min(p,D),p===0)return 0}}else{const k=Xc(P,t);mi(f,p,s,i,_,k[0]),mi(f,p,s,i,_,k[1])}}return p}function sa(i,t,r,s,c,p=1/0){let f=Math.min(p,c.distance(i[0],r[0]));if(f===0)return f;const _=new Vp([[0,[0,i.length-1],[0,r.length-1]]],Gp);for(;_.length>0;){const v=_.pop();if(v[0]>=f)continue;const P=v[1],A=v[2],k=t?50:100,D=s?50:100;if($a(P)<=k&&$a(A)<=D){if(!Gn(P,i.length)&&Gn(A,r.length))return NaN;let O;if(t&&s)O=Xg(i,P,r,A,c),f=Math.min(f,O);else if(t&&!s){const N=i.slice(P[0],P[1]+1);for(let q=A[0];q<=A[1];++q)if(O=Is(r[q],N,c),f=Math.min(f,O),f===0)return f}else if(!t&&s){const N=r.slice(A[0],A[1]+1);for(let q=P[0];q<=P[1];++q)if(O=Is(i[q],N,c),f=Math.min(f,O),f===0)return f}else O=qi(i,P,r,A,c),f=Math.min(f,O)}else{const O=Xc(P,t),N=Xc(A,s);As(_,f,c,i,r,O[0],N[0]),As(_,f,c,i,r,O[0],N[1]),As(_,f,c,i,r,O[1],N[0]),As(_,f,c,i,r,O[1],N[1])}}return f}function Qc(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Cs{constructor(t,r){this.type=et,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(bs(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new Cs(s,s.features.map(c=>Qc(c.geometry)).flat());if(s.type==="Feature")return new Cs(s,Qc(s.geometry));if("type"in s&&"coordinates"in s)return new Cs(s,Qc(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,s){const c=r.geometry(),p=c.flat().map(v=>Gc([v.x,v.y],r.canonical));if(c.length===0)return NaN;const f=new Hc(p[0][1]);let _=1/0;for(const v of s){switch(v.type){case"Point":_=Math.min(_,sa(p,!1,[v.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,sa(p,!1,v.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,na(p,!1,v.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,s){const c=r.geometry(),p=c.flat().map(v=>Gc([v.x,v.y],r.canonical));if(c.length===0)return NaN;const f=new Hc(p[0][1]);let _=1/0;for(const v of s){switch(v.type){case"Point":_=Math.min(_,sa(p,!0,[v.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,sa(p,!0,v.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,na(p,!0,v.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,s){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const p=Ya(c,0).map(v=>v.map(P=>P.map(A=>Gc([A.x,A.y],r.canonical)))),f=new Hc(p[0][0][0][1]);let _=1/0;for(const v of s)for(const P of p){switch(v.type){case"Point":_=Math.min(_,na([v.coordinates],!1,P,f,_));break;case"LineString":_=Math.min(_,na(v.coordinates,!0,P,f,_));break;case"Polygon":_=Math.min(_,wi(P,v.coordinates,f,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const to={"==":Fg,"!=":Mp,">":Bg,"<":zp,">=":Dp,"<=":Ng,array:vn,at:Nc,boolean:vn,case:Za,coalesce:Ha,collator:ia,format:Ka,image:qc,in:Vc,"index-of":Ys,interpolate:Br,"interpolate-hcl":Br,"interpolate-lab":Br,length:Zc,let:rs,literal:yn,match:jc,number:vn,"number-format":Uc,object:vn,slice:ea,step:$s,string:vn,"to-boolean":xn,"to-color":xn,"to-number":xn,"to-string":xn,var:oi,within:Ts,distance:Cs};class ln{constructor(t,r,s,c){this.name=t,this.type=r,this._evaluate=s,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],c=ln.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(c)?c[0]:c.type,f=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=f.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let v=null;for(const[P,A]of _){v=new ws(r.registry,oa,r.path,null,r.scope);const k=[];let D=!1;for(let O=1;O<t.length;O++){const N=t[O],q=Array.isArray(P)?P[O-1]:P.type,J=v.parse(N,1+k.length,q);if(!J){D=!0;break}k.push(J)}if(!D)if(Array.isArray(P)&&P.length!==k.length)v.error(`Expected ${P.length} arguments, but found ${k.length} instead.`);else{for(let O=0;O<k.length;O++){const N=Array.isArray(P)?P[O]:P.type,q=k[O];v.concat(O+1).checkSubtype(N,q.type)}if(v.errors.length===0)return new ln(s,p,A,k)}}if(_.length===1)r.errors.push(...v.errors);else{const P=(_.length?_:f).map(([k])=>{return D=k,Array.isArray(D)?`(${D.map(R).join(", ")})`:`(${R(D.type)}...)`;var D}).join(" | "),A=[];for(let k=1;k<t.length;k++){const D=r.parse(t[k],1+A.length);if(!D)return null;A.push(R(D.type))}r.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){ln.definitions=r;for(const s in r)t[s]=ln}}function eu(i,[t,r,s,c]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const p=c?c.evaluate(i):1,f=Js(t,r,s,p);if(f)throw new Hi(f);return new pi(t/255,r/255,s/255,p,!1)}function tu(i,t){return i in t}function iu(i,t){const r=t[i];return r===void 0?null:r}function Es(i){return{type:i}}function oa(i){if(i instanceof oi)return oa(i.boundExpression);if(i instanceof ln&&i.name==="error"||i instanceof ia||i instanceof Ts||i instanceof Cs)return!1;const t=i instanceof xn||i instanceof vn;let r=!0;return i.eachChild(s=>{r=t?r&&oa(s):r&&s instanceof yn}),!!r&&aa(i)&&la(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function aa(i){if(i instanceof ln&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ts||i instanceof Cs)return!1;let t=!0;return i.eachChild(r=>{t&&!aa(r)&&(t=!1)}),t}function io(i){if(i instanceof ln&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!io(r)&&(t=!1)}),t}function la(i,t){if(i instanceof ln&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(s=>{r&&!la(s,t)&&(r=!1)}),r}function tl(i){return{result:"success",value:i}}function ro(i){return{result:"error",value:i}}function no(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Wp(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function ru(i){return!!i.expression&&i.expression.interpolated}function ni(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function il(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Jg(i){return i}function Hp(i,t){const r=t.type==="color",s=i.stops&&typeof i.stops[0][0]=="object",c=s||!(s||i.property!==void 0),p=i.type||(ru(t)?"exponential":"interval");if(r||t.type==="padding"){const A=r?pi.parse:Jr.parse;(i=on({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],A(k[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(f=i.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var f;let _,v,P;if(p==="exponential")_=Kp;else if(p==="interval")_=rl;else if(p==="categorical"){_=Xp,v=Object.create(null);for(const A of i.stops)v[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=Jp}if(s){const A={},k=[];for(let N=0;N<i.stops.length;N++){const q=i.stops[N],J=q[0].zoom;A[J]===void 0&&(A[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},k.push(J)),A[J].stops.push([q[0].value,q[1]])}const D=[];for(const N of k)D.push([A[N].zoom,Hp(A[N],t)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Br.interpolationFactor.bind(void 0,O),zoomStops:D.map(N=>N[0]),evaluate:({zoom:N},q)=>Kp({stops:D,base:i.base},t,N).evaluate(N,q)}}if(c){const A=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Br.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>_(i,t,k,v,P)}}return{kind:"source",evaluate(A,k){const D=k&&k.properties?k.properties[i.property]:void 0;return D===void 0?so(i.default,t.default):_(i,t,D,v,P)}}}function so(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Xp(i,t,r,s,c){return so(typeof r===c?s[r]:void 0,i.default,t.default)}function rl(i,t,r){if(ni(r)!=="number")return so(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const c=Ga(i.stops.map(p=>p[0]),r);return i.stops[c][1]}function Kp(i,t,r){const s=i.base!==void 0?i.base:1;if(ni(r)!=="number")return so(i.default,t.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const p=Ga(i.stops.map(A=>A[0]),r),f=function(A,k,D,O){const N=O-D,q=A-D;return N===0?0:k===1?q/N:(Math.pow(k,q)-1)/(Math.pow(k,N)-1)}(r,s,i.stops[p][0],i.stops[p+1][0]),_=i.stops[p][1],v=i.stops[p+1][1],P=Fr[t.type]||Jg;return typeof _.evaluate=="function"?{evaluate(...A){const k=_.evaluate.apply(void 0,A),D=v.evaluate.apply(void 0,A);if(k!==void 0&&D!==void 0)return P(k,D,f,i.colorSpace)}}:P(_,v,f,i.colorSpace)}function Jp(i,t,r){switch(t.type){case"color":r=pi.parse(r);break;case"formatted":r=Kr.fromString(r.toString());break;case"resolvedImage":r=Yr.fromString(r.toString());break;case"padding":r=Jr.parse(r);break;default:ni(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return so(r,i.default,t.default)}ln.register(to,{error:[{kind:"error"},[Zt],(i,[t])=>{throw new Hi(t.evaluate(i))}],typeof:[Zt,[Vt],(i,[t])=>R(Yi(t.evaluate(i)))],"to-rgba":[L(et,4),[Or],(i,[t])=>{const[r,s,c,p]=t.evaluate(i).rgb;return[255*r,255*s,255*c,p]}],rgb:[Or,[et,et,et],eu],rgba:[Or,[et,et,et,et],eu],has:{type:Rt,overloads:[[[Zt],(i,[t])=>tu(t.evaluate(i),i.properties())],[[Zt,_n],(i,[t,r])=>tu(t.evaluate(i),r.evaluate(i))]]},get:{type:Vt,overloads:[[[Zt],(i,[t])=>iu(t.evaluate(i),i.properties())],[[Zt,_n],(i,[t,r])=>iu(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Vt,[Zt],(i,[t])=>iu(t.evaluate(i),i.featureState||{})],properties:[_n,[],i=>i.properties()],"geometry-type":[Zt,[],i=>i.geometryType()],id:[Vt,[],i=>i.id()],zoom:[et,[],i=>i.globals.zoom],"heatmap-density":[et,[],i=>i.globals.heatmapDensity||0],"line-progress":[et,[],i=>i.globals.lineProgress||0],accumulated:[Vt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[et,Es(et),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[et,Es(et),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:et,overloads:[[[et,et],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[et],(i,[t])=>-t.evaluate(i)]]},"/":[et,[et,et],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[et,[et,et],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[et,[et],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[et,[et],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[et,[et],(i,[t])=>Math.log(t.evaluate(i))],log2:[et,[et],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[et,[et],(i,[t])=>Math.sin(t.evaluate(i))],cos:[et,[et],(i,[t])=>Math.cos(t.evaluate(i))],tan:[et,[et],(i,[t])=>Math.tan(t.evaluate(i))],asin:[et,[et],(i,[t])=>Math.asin(t.evaluate(i))],acos:[et,[et],(i,[t])=>Math.acos(t.evaluate(i))],atan:[et,[et],(i,[t])=>Math.atan(t.evaluate(i))],min:[et,Es(et),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[et,Es(et),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[et,[et],(i,[t])=>Math.abs(t.evaluate(i))],round:[et,[et],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[et,[et],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[et,[et],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Rt,[Zt,Vt],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Rt,[Vt],(i,[t])=>i.id()===t.value],"filter-type-==":[Rt,[Zt],(i,[t])=>i.geometryType()===t.value],"filter-<":[Rt,[Zt,Vt],(i,[t,r])=>{const s=i.properties()[t.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Rt,[Vt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Rt,[Zt,Vt],(i,[t,r])=>{const s=i.properties()[t.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[Rt,[Vt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Rt,[Zt,Vt],(i,[t,r])=>{const s=i.properties()[t.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Rt,[Vt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Rt,[Zt,Vt],(i,[t,r])=>{const s=i.properties()[t.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Rt,[Vt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Rt,[Vt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Rt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Rt,[L(Zt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Rt,[L(Vt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Rt,[Zt,L(Vt)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Rt,[Zt,L(Vt)],(i,[t,r])=>function(s,c,p,f){for(;p<=f;){const _=p+f>>1;if(c[_]===s)return!0;c[_]>s?f=_-1:p=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Es(Rt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Es(Rt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Rt,[Rt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Rt,[Zt],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Zt,[Zt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Zt,[Zt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Zt,Es(Vt),(i,t)=>t.map(r=>Qo(r.evaluate(i))).join("")],"resolved-locale":[Zt,[Ln],(i,[t])=>t.evaluate(i).resolvedLocale()]});class nl{constructor(t,r){var s;this.expression=t,this._warningHistory={},this._evaluator=new qa,this._defaultValue=r?(s=r).type==="color"&&il(s.default)?new pi(0,0,0,0):s.type==="color"?pi.parse(s.default)||null:s.type==="padding"?Jr.parse(s.default)||null:s.type==="variableAnchorOffsetCollection"?an.parse(s.default)||null:s.default===void 0?null:s.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,c,p,f){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,c,p,f){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Hi(`Expected value to be one of ${Object.keys(this._enumValues).map(v=>JSON.stringify(v)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function sl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in to}function oo(i,t){const r=new ws(to,oa,[],t?function(c){const p={color:Or,string:Zt,number:et,enum:Zt,boolean:Rt,formatted:Zn,padding:is,resolvedImage:On,variableAnchorOffsetCollection:ee};return c.type==="array"?L(p[c.value]||Vt,c.length):p[c.type]}(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?tl(new nl(s,t)):ro(r.errors)}class ao{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!io(r.expression)}evaluateWithoutErrorHandling(t,r,s,c,p,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,c,p,f)}evaluate(t,r,s,c,p,f){return this._styleExpression.evaluate(t,r,s,c,p,f)}}class lo{constructor(t,r,s,c){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!io(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,r,s,c,p,f){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,c,p,f)}evaluate(t,r,s,c,p,f){return this._styleExpression.evaluate(t,r,s,c,p,f)}interpolationFactor(t,r,s){return this.interpolationType?Br.interpolationFactor(this.interpolationType,t,r,s):0}}function nu(i,t){const r=oo(i,t);if(r.result==="error")return r;const s=r.value.expression,c=aa(s);if(!c&&!no(t))return ro([new lr("","data expressions not supported")]);const p=la(s,["zoom"]);if(!p&&!Wp(t))return ro([new lr("","zoom expressions not supported")]);const f=ca(s);return f||p?f instanceof lr?ro([f]):f instanceof Br&&!ru(t)?ro([new lr("",'"interpolate" expressions cannot be used with this property')]):tl(f?new lo(c?"camera":"composite",r.value,f.labels,f instanceof Br?f.interpolation:void 0):new ao(c?"constant":"source",r.value)):ro([new lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class co{constructor(t,r){this._parameters=t,this._specification=r,on(this,Hp(this._parameters,this._specification))}static deserialize(t){return new co(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ca(i){let t=null;if(i instanceof rs)t=ca(i.result);else if(i instanceof Ha){for(const r of i.args)if(t=ca(r),t)break}else(i instanceof $s||i instanceof Br)&&i.input instanceof ln&&i.input.name==="zoom"&&(t=i);return t instanceof lr||i.eachChild(r=>{const s=ca(r);s instanceof lr?t=s:!t&&s?t=new lr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new lr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ol(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ol(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const al={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function su(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ol(i)||(i=ll(i));const t=oo(i,al);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,s,c)=>t.value.evaluate(r,s,{},c),needGeometry:Yp(i)}}function Yg(i,t){return i<t?-1:i>t?1:0}function Yp(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Yp(i[t]))return!0;return!1}function ll(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?ou(i[1],i[2],"=="):t==="!="?gr(ou(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?ou(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(ll))):t==="all"?["all"].concat(i.slice(1).map(ll)):t==="none"?["all"].concat(i.slice(1).map(ll).map(gr)):t==="in"?ua(i[1],i.slice(2)):t==="!in"?gr(ua(i[1],i.slice(2))):t==="has"?ha(i[1]):t!=="!has"||gr(ha(i[1]));var r}function ou(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function ua(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Yg)]]:["filter-in-small",i,["literal",t]]}}function ha(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function gr(i){return["!",i]}function ks(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const p of i)c+=`${ks(p)},`;return`${c}]`}const r=Object.keys(i).sort();let s="{";for(let c=0;c<r.length;c++)s+=`${JSON.stringify(r[c])}:${ks(i[r[c]])},`;return`${s}}`}function $p(i){let t="";for(const r of Pi)t+=`/${ks(i[r])}`;return t}function Qp(i){const t=i.value;return t?[new He(i.key,t,"constants have been deprecated as of v8")]:[]}function Zi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function bn(i){if(Array.isArray(i))return i.map(bn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=bn(i[r]);return t}return Zi(i)}function $r(i){const t=i.key,r=i.value,s=i.valueSpec||{},c=i.objectElementValidators||{},p=i.style,f=i.styleSpec,_=i.validateSpec;let v=[];const P=ni(r);if(P!=="object")return[new He(t,r,`object expected, ${P} found`)];for(const A in r){const k=A.split(".")[0],D=s[k]||s["*"];let O;if(c[k])O=c[k];else if(s[k])O=_;else if(c["*"])O=c["*"];else{if(!s["*"]){v.push(new He(t,r[A],`unknown property "${A}"`));continue}O=_}v=v.concat(O({key:(t&&`${t}.`)+A,value:r[A],valueSpec:D,style:p,styleSpec:f,object:r,objectKey:A,validateSpec:_},r))}for(const A in s)c[A]||s[A].required&&s[A].default===void 0&&r[A]===void 0&&v.push(new He(t,r,`missing required property "${A}"`));return v}function da(i){const t=i.value,r=i.valueSpec,s=i.style,c=i.styleSpec,p=i.key,f=i.arrayElementValidator||i.validateSpec;if(ni(t)!=="array")return[new He(p,t,`array expected, ${ni(t)} found`)];if(r.length&&t.length!==r.length)return[new He(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new He(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};c.$version<7&&(_.function=r.function),ni(r.value)==="object"&&(_=r.value);let v=[];for(let P=0;P<t.length;P++)v=v.concat(f({array:t,arrayIndex:P,value:t[P],valueSpec:_,validateSpec:i.validateSpec,style:s,styleSpec:c,key:`${p}[${P}]`}));return v}function au(i){const t=i.key,r=i.value,s=i.valueSpec;let c=ni(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new He(t,r,`number expected, ${c} found`)]:"minimum"in s&&r<s.minimum?[new He(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new He(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function cl(i){const t=i.valueSpec,r=Zi(i.value.type);let s,c,p,f={};const _=r!=="categorical"&&i.value.property===void 0,v=!_,P=ni(i.value.stops)==="array"&&ni(i.value.stops[0])==="array"&&ni(i.value.stops[0][0])==="object",A=$r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(O){if(r==="identity")return[new He(O.key,O.value,'identity function may not have a "stops" property')];let N=[];const q=O.value;return N=N.concat(da({key:O.key,value:q,valueSpec:O.valueSpec,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:k})),ni(q)==="array"&&q.length===0&&N.push(new He(O.key,q,"array must have at least one stop")),N},default:function(O){return O.validateSpec({key:O.key,value:O.value,valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec})}}});return r==="identity"&&_&&A.push(new He(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new He(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!ru(i.valueSpec)&&A.push(new He(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!no(i.valueSpec)?A.push(new He(i.key,i.value,"property functions not supported")):_&&!Wp(i.valueSpec)&&A.push(new He(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!P||i.value.property!==void 0||A.push(new He(i.key,i.value,'"property" property is required')),A;function k(O){let N=[];const q=O.value,J=O.key;if(ni(q)!=="array")return[new He(J,q,`array expected, ${ni(q)} found`)];if(q.length!==2)return[new He(J,q,`array length 2 expected, length ${q.length} found`)];if(P){if(ni(q[0])!=="object")return[new He(J,q,`object expected, ${ni(q[0])} found`)];if(q[0].zoom===void 0)return[new He(J,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new He(J,q,"object stop key must have value")];if(p&&p>Zi(q[0].zoom))return[new He(J,q[0].zoom,"stop zoom values must appear in ascending order")];Zi(q[0].zoom)!==p&&(p=Zi(q[0].zoom),c=void 0,f={}),N=N.concat($r({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:au,value:D}}))}else N=N.concat(D({key:`${J}[0]`,value:q[0],valueSpec:{},validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec},q));return sl(bn(q[1]))?N.concat([new He(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat(O.validateSpec({key:`${J}[1]`,value:q[1],valueSpec:t,validateSpec:O.validateSpec,style:O.style,styleSpec:O.styleSpec}))}function D(O,N){const q=ni(O.value),J=Zi(O.value),ie=O.value!==null?O.value:N;if(s){if(q!==s)return[new He(O.key,ie,`${q} stop domain type must match previous stop domain type ${s}`)]}else s=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new He(O.key,ie,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let ve=`number expected, ${q} found`;return no(t)&&r===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(O.key,ie,ve)]}return r!=="categorical"||q!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&q==="number"&&c!==void 0&&J<c?[new He(O.key,ie,"stop domain values must appear in ascending order")]:(c=J,r==="categorical"&&J in f?[new He(O.key,ie,"stop domain values must be unique")]:(f[J]=!0,[])):[new He(O.key,ie,`integer expected, found ${J}`)]}}function uo(i){const t=(i.expressionContext==="property"?nu:oo)(bn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(s=>new He(`${i.key}${s.key}`,i.value,s.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new He(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!io(r))return[new He(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!io(r))return[new He(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!la(r,["zoom","feature-state"]))return[new He(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!aa(r))return[new He(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wn(i){const t=i.key,r=i.value,s=i.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Zi(r))===-1&&c.push(new He(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Zi(r))===-1&&c.push(new He(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function lu(i){return ol(bn(i.value))?uo(on({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ul(i)}function ul(i){const t=i.value,r=i.key;if(ni(t)!=="array")return[new He(r,t,`array expected, ${ni(t)} found`)];const s=i.styleSpec;let c,p=[];if(t.length<1)return[new He(r,t,"filter array must have at least 1 element")];switch(p=p.concat(Wn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Zi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Zi(t[1])==="$type"&&p.push(new He(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new He(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=ni(t[1]),c!=="string"&&p.push(new He(`${r}[1]`,t[1],`string expected, ${c} found`)));for(let f=2;f<t.length;f++)c=ni(t[f]),Zi(t[1])==="$type"?p=p.concat(Wn({key:`${r}[${f}]`,value:t[f],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&p.push(new He(`${r}[${f}]`,t[f],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let f=1;f<t.length;f++)p=p.concat(ul({key:`${r}[${f}]`,value:t[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=ni(t[1]),t.length!==2?p.push(new He(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&p.push(new He(`${r}[1]`,t[1],`string expected, ${c} found`))}return p}function cu(i,t){const r=i.key,s=i.validateSpec,c=i.style,p=i.styleSpec,f=i.value,_=i.objectKey,v=p[`${t}_${i.layerType}`];if(!v)return[];const P=_.match(/^(.*)-transition$/);if(t==="paint"&&P&&v[P[1]]&&v[P[1]].transition)return s({key:r,value:f,valueSpec:p.transition,style:c,styleSpec:p});const A=i.valueSpec||v[_];if(!A)return[new He(r,f,`unknown property "${_}"`)];let k;if(ni(f)==="string"&&no(A)&&!A.tokens&&(k=/^{([^}]+)}$/.exec(f)))return[new He(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&D.push(new He(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&il(bn(f))&&Zi(f.type)==="identity"&&D.push(new He(r,f,'"text-font" does not support identity functions'))),D.concat(s({key:i.key,value:f,valueSpec:A,style:c,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:_}))}function hl(i){return cu(i,"paint")}function uu(i){return cu(i,"layout")}function hu(i){let t=[];const r=i.value,s=i.key,c=i.style,p=i.styleSpec;r.type||r.ref||t.push(new He(s,r,'either "type" or "ref" is required'));let f=Zi(r.type);const _=Zi(r.ref);if(r.id){const v=Zi(r.id);for(let P=0;P<i.arrayIndex;P++){const A=c.layers[P];Zi(A.id)===v&&t.push(new He(s,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new He(s,r[P],`"${P}" is prohibited for ref layers`))}),c.layers.forEach(P=>{Zi(P.id)===_&&(v=P)}),v?v.ref?t.push(new He(s,r.ref,"ref cannot reference another ref layer")):f=Zi(v.type):t.push(new He(s,r.ref,`ref layer "${_}" not found`))}else if(f!=="background")if(r.source){const v=c.sources&&c.sources[r.source],P=v&&Zi(v.type);v?P==="vector"&&f==="raster"?t.push(new He(s,r.source,`layer "${r.id}" requires a raster source`)):P!=="raster-dem"&&f==="hillshade"?t.push(new He(s,r.source,`layer "${r.id}" requires a raster-dem source`)):P==="raster"&&f!=="raster"?t.push(new He(s,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&f!=="hillshade"?t.push(new He(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||P==="geojson"&&v.lineMetrics||t.push(new He(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new He(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new He(s,r.source,`source "${r.source}" not found`))}else t.push(new He(s,r,'missing required property "source"'));return t=t.concat($r({key:s,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:lu,layout:v=>$r({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":P=>uu(on({layerType:f},P))}}),paint:v=>$r({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":P=>hl(on({layerType:f},P))}})}})),t}function Ms(i){const t=i.value,r=i.key,s=ni(t);return s!=="string"?[new He(r,t,`string expected, ${s} found`)]:[]}const dl={promoteId:function({key:i,value:t}){if(ni(t)==="string")return Ms({key:i,value:t});{const r=[];for(const s in t)r.push(...Ms({key:`${i}.${s}`,value:t[s]}));return r}}};function pa(i){const t=i.value,r=i.key,s=i.styleSpec,c=i.style,p=i.validateSpec;if(!t.type)return[new He(r,t,'"type" is required')];const f=Zi(t.type);let _;switch(f){case"vector":case"raster":return _=$r({key:r,value:t,valueSpec:s[`source_${f.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:dl,validateSpec:p}),_;case"raster-dem":return _=function(v){var P;const A=(P=v.sourceName)!==null&&P!==void 0?P:"",k=v.value,D=v.styleSpec,O=D.source_raster_dem,N=v.style;let q=[];const J=ni(k);if(k===void 0)return q;if(J!=="object")return q.push(new He("source_raster_dem",k,`object expected, ${J} found`)),q;const ie=Zi(k.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],ce=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const ge in k)!ie&&ve.includes(ge)?q.push(new He(ge,k[ge],`In "${A}": "${ge}" is only valid when "encoding" is set to "custom". ${ce} encoding found`)):O[ge]?q=q.concat(v.validateSpec({key:ge,value:k[ge],valueSpec:O[ge],validateSpec:v.validateSpec,style:N,styleSpec:D})):q.push(new He(ge,k[ge],`unknown property "${ge}"`));return q}({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:p}),_;case"geojson":if(_=$r({key:r,value:t,valueSpec:s.source_geojson,style:c,styleSpec:s,validateSpec:p,objectElementValidators:dl}),t.cluster)for(const v in t.clusterProperties){const[P,A]=t.clusterProperties[v],k=typeof P=="string"?[P,["accumulated"],["get",v]]:P;_.push(...uo({key:`${r}.${v}.map`,value:A,validateSpec:p,expressionContext:"cluster-map"})),_.push(...uo({key:`${r}.${v}.reduce`,value:k,validateSpec:p,expressionContext:"cluster-reduce"}))}return _;case"video":return $r({key:r,value:t,valueSpec:s.source_video,style:c,validateSpec:p,styleSpec:s});case"image":return $r({key:r,value:t,valueSpec:s.source_image,style:c,validateSpec:p,styleSpec:s});case"canvas":return[new He(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:p,styleSpec:s})}}function du(i){const t=i.value,r=i.styleSpec,s=r.light,c=i.style;let p=[];const f=ni(t);if(t===void 0)return p;if(f!=="object")return p=p.concat([new He("light",t,`object expected, ${f} found`)]),p;for(const _ in t){const v=_.match(/^(.*)-transition$/);p=p.concat(v&&s[v[1]]&&s[v[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new He(_,t[_],`unknown property "${_}"`)])}return p}function pu(i){const t=i.value,r=i.styleSpec,s=r.sky,c=i.style,p=ni(t);if(t===void 0)return[];if(p!=="object")return[new He("sky",t,`object expected, ${p} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:c,styleSpec:r}):[new He(_,t[_],`unknown property "${_}"`)]);return f}function fu(i){const t=i.value,r=i.styleSpec,s=r.terrain,c=i.style;let p=[];const f=ni(t);if(t===void 0)return p;if(f!=="object")return p=p.concat([new He("terrain",t,`object expected, ${f} found`)]),p;for(const _ in t)p=p.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new He(_,t[_],`unknown property "${_}"`)]);return p}function mu(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const c=[],p=[];for(const f in r)r[f].id&&c.includes(r[f].id)&&t.push(new He(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),c.push(r[f].id),r[f].url&&p.includes(r[f].url)&&t.push(new He(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),p.push(r[f].url),t=t.concat($r({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ms({key:s,value:r})}const pl={"*":()=>[],array:da,boolean:function(i){const t=i.value,r=i.key,s=ni(t);return s!=="boolean"?[new He(r,t,`boolean expected, ${s} found`)]:[]},number:au,color:function(i){const t=i.key,r=i.value,s=ni(r);return s!=="string"?[new He(t,r,`color expected, ${s} found`)]:pi.parse(String(r))?[]:[new He(t,r,`color expected, "${r}" found`)]},constants:Qp,enum:Wn,filter:lu,function:cl,layer:hu,object:$r,source:pa,light:du,sky:pu,terrain:fu,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,c=i.style,p=ni(t);if(t===void 0)return[];if(p!=="object")return[new He("projection",t,`object expected, ${p} found`)];let f=[];for(const _ in t)f=f.concat(s[_]?i.validateSpec({key:_,value:t[_],valueSpec:s[_],style:c,styleSpec:r}):[new He(_,t[_],`unknown property "${_}"`)]);return f},string:Ms,formatted:function(i){return Ms(i).length===0?[]:uo(i)},resolvedImage:function(i){return Ms(i).length===0?[]:uo(i)},padding:function(i){const t=i.key,r=i.value;if(ni(r)==="array"){if(r.length<1||r.length>4)return[new He(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let c=[];for(let p=0;p<r.length;p++)c=c.concat(i.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:s}));return c}return au({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=ni(r),c=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new He(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let f=0;f<r.length;f+=2)p=p.concat(Wn({key:`${t}[${f}]`,value:r[f],valueSpec:c.layout_symbol["text-anchor"]})),p=p.concat(da({key:`${t}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return p},sprite:mu};function ho(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=ho,r.expression&&il(Zi(t))?cl(i):r.expression&&sl(bn(t))?uo(i):r.type&&pl[r.type]?pl[r.type](i):$r(on({},i,{valueSpec:r.type?s[r.type]:r}))}function ef(i){const t=i.value,r=i.key,s=Ms(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new He(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new He(r,t,'"glyphs" url must include a "{range}" token'))),s}function cn(i,t=xe){let r=[];return r=r.concat(ho({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ho,objectElementValidators:{glyphs:ef,"*":()=>[]}})),i.constants&&(r=r.concat(Qp({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:ho}))),gu(r)}function Bn(i){return function(t){return i({...t,validateSpec:ho})}}function gu(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function wn(i){return function(...t){return gu(i.apply(this,t))}}cn.source=wn(Bn(pa)),cn.sprite=wn(Bn(mu)),cn.glyphs=wn(Bn(ef)),cn.light=wn(Bn(du)),cn.sky=wn(Bn(pu)),cn.terrain=wn(Bn(fu)),cn.layer=wn(Bn(hu)),cn.filter=wn(Bn(lu)),cn.paintProperty=wn(Bn(hl)),cn.layoutProperty=wn(Bn(uu));const zs=cn,$g=zs.light,Qg=zs.sky,tf=zs.paintProperty,rf=zs.layoutProperty;function _u(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new vt(new Error(s.message))),r=!0;return r}class po{constructor(t,r,s){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const f=new Int32Array(this.arrayBuffer);t=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let v=0;v<this.d*this.d;v++){const P=f[3+v],A=f[3+v+1];c.push(P===A?null:f.subarray(P,A))}const _=f[3+c.length+1];this.keys=f.subarray(f[3+c.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const p=s/r*t;this.min=-p,this.max=t+p}insert(t,r,s,c,p){this._forEachCell(r,s,c,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,c,p,f){this.cells[p].push(f)}query(t,r,s,c,p){const f=this.min,_=this.max;if(t<=f&&r<=f&&_<=s&&_<=c&&!p)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(t,r,s,c,this._queryCell,v,{},p),v}}_queryCell(t,r,s,c,p,f,_,v){const P=this.cells[p];if(P!==null){const A=this.keys,k=this.bboxes;for(let D=0;D<P.length;D++){const O=P[D];if(_[O]===void 0){const N=4*O;(v?v(k[N+0],k[N+1],k[N+2],k[N+3]):t<=k[N+2]&&r<=k[N+3]&&s>=k[N+0]&&c>=k[N+1])?(_[O]=!0,f.push(A[O])):_[O]=!1}}}}_forEachCell(t,r,s,c,p,f,_,v){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(r),k=this._convertToCellCoord(s),D=this._convertToCellCoord(c);for(let O=P;O<=k;O++)for(let N=A;N<=D;N++){const q=this.d*N+O;if((!v||v(this._convertFromCellCoord(O),this._convertFromCellCoord(N),this._convertFromCellCoord(O+1),this._convertFromCellCoord(N+1)))&&p.call(this,t,r,s,c,q,f,_,v))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const c=new Int32Array(r+s+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let p=r;for(let f=0;f<t.length;f++){const _=t[f];c[3+f]=p,c.set(_,p),p+=_.length}return c[3+t.length]=p,c.set(this.keys,p),p+=this.keys.length,c[3+t.length+1]=p,c.set(this.bboxes,p),p+=this.bboxes.length,c.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new po(t.buffer)}}const un={};function pt(i,t,r={}){if(un[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),un[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}pt("Object",Object),pt("TransferableGridIndex",po),pt("Color",pi),pt("Error",Error),pt("AJAXError",Di),pt("ResolvedImage",Yr),pt("StylePropertyFunction",co),pt("StyleExpression",nl,{omit:["_evaluator"]}),pt("ZoomDependentExpression",lo),pt("ZoomConstantExpression",ao),pt("CompoundExpression",ln,{omit:["_evaluate"]});for(const i in to)to[i]._classRegistryKey||pt(`Expression_${i}`,to[i]);function fl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function yu(i){return i.$name||i.constructor._classRegistryKey}function nf(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=yu(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||fl(i)||_t(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function fo(i,t){if(nf(i))return(fl(i)||_t(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const f of i)p.push(fo(f,t));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=yu(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!un[r])throw new Error(`${r} is not registered.`);const{klass:s}=un[r],c=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||un[r].omit.indexOf(p)>=0)continue;const f=i[p];c[p]=un[r].shallow.indexOf(p)>=0?f:fo(f,t)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function mo(i){if(nf(i))return i;if(Array.isArray(i))return i.map(mo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=yu(i)||"Object";if(!un[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=un[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const p=i[c];s[c]=un[t].shallow.indexOf(c)>=0?p:mo(p)}return s}class vu{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const $t={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function xu(i){for(const t of i)if(wu(t.charCodeAt(0)))return!0;return!1}function e_(i){for(const t of i)if(!go(t.charCodeAt(0)))return!1;return!0}function bu(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const t_=bu(["Arab","Dupl","Mong","Ougr","Syrc"]);function go(i){return!t_.test(String.fromCodePoint(i))}const sf=bu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function wu(i){return!(i!==746&&i!==747&&(i<4352||!($t["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||$t["CJK Compatibility"](i)||$t["CJK Strokes"](i)||!(!$t["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||$t["Enclosed CJK Letters and Months"](i)||$t["Ideographic Description Characters"](i)||$t.Kanbun(i)||$t.Katakana(i)&&i!==12540||!(!$t["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!$t["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||$t["Vertical Forms"](i)||$t["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||sf.test(String.fromCodePoint(i)))))}function of(i){return!(wu(i)||function(t){return!!($t["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||$t["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||$t["Letterlike Symbols"](t)||$t["Number Forms"](t)||$t["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||$t["Control Pictures"](t)&&t!==9251||$t["Optical Character Recognition"](t)||$t["Enclosed Alphanumerics"](t)||$t["Geometric Shapes"](t)||$t["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||$t["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||$t["CJK Symbols and Punctuation"](t)||$t.Katakana(t)||$t["Private Use Area"](t)||$t["CJK Compatibility Forms"](t)||$t["Small Form Variants"](t)||$t["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const i_=bu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Su(i){return i_.test(String.fromCodePoint(i))}function r_(i,t){return!(!t&&Su(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||$t.Khmer(i))}function n_(i){for(const t of i)if(Su(t.charCodeAt(0)))return!0;return!1}const Qr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ti{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vu,this.transition={})}isSupportedScript(t){return function(r,s){for(const c of r)if(!r_(c.charCodeAt(0),s))return!1;return!0}(t,Qr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class _o{constructor(t,r){this.property=t,this.value=r,this.expression=function(s,c){if(il(s))return new co(s,c);if(sl(s)){const p=nu(s,c);if(p.result==="error")throw new Error(p.value.map(f=>`${f.key}: ${f.message}`).join(", "));return p.value}{let p=s;return c.type==="color"&&typeof s=="string"?p=pi.parse(s):c.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(s)&&(p=an.parse(s)):p=Jr.parse(s),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class ml{constructor(t){this.property=t,this.value=new _o(t,void 0)}transitioned(t,r){return new af(this.property,this.value,r,Ze({},t.transition,this.transition),t.now)}untransitioned(){return new af(this.property,this.value,null,{},0)}}class gl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return st(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ml(this._values[t].property)),this._values[t].value=new _o(this._values[t].property,r===null?void 0:st(r))}getTransition(t){return st(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ml(this._values[t].property)),this._values[t].transition=st(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const c=this.getTransition(r);c!==void 0&&(t[`${r}-transition`]=c)}return t}transitioned(t,r){const s=new fa(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(t,r._values[c]);return s}untransitioned(){const t=new fa(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class af{constructor(t,r,s,c,p){this.property=t,this.value=r,this.begin=p+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const c=t.now||0,p=this.value.possiblyEvaluate(t,r,s),f=this.prior;if(f){if(c>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(c<this.begin)return f.possiblyEvaluate(t,r,s);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(t,r,s),p,function(v){if(v<=0)return 0;if(v>=1)return 1;const P=v*v,A=P*v;return 4*(v<.5?A:3*(v-P)+A-.75)}(_))}}return p}}class fa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const c=new ga(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,r,s);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return st(this._values[t].value)}setValue(t,r){this._values[t]=new _o(this._values[t].property,r===null?void 0:st(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const c=new ga(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].possiblyEvaluate(t,r,s);return c}}class Nn{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,c){return this.property.evaluate(this.value,this.parameters,t,r,s,c)}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const c=Fr[this.specification.type];return c?c(t,r,s):t}}class kt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,c){return new Nn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,c)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Nn(this,{kind:"constant",value:void 0},t.parameters);const c=Fr[this.specification.type];if(c){const p=c(t.value.value,r.value.value,s);return new Nn(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,s,c,p,f){return t.kind==="constant"?t.value:t.evaluate(r,s,c,p,f)}}class _l extends kt{possiblyEvaluate(t,r,s,c){if(t.value===void 0)return new Nn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},s,c),f=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,_=this._calculate(f,f,f,r);return new Nn(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Nn(this,{kind:"constant",value:p},r)}return new Nn(this,t.expression,r)}evaluate(t,r,s,c,p,f){if(t.kind==="source"){const _=t.evaluate(r,s,c,p,f);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,c),t.evaluate({zoom:Math.floor(r.zoom)},s,c),t.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):t.value}_calculate(t,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class yl{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},s,c);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new Ti(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ti(Math.floor(r.zoom),r)),t.expression.evaluate(new Ti(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Pu{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,c){return!!t.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class d{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new _o(s,void 0),p=this.defaultTransitionablePropertyValues[r]=new ml(s);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}pt("DataDrivenProperty",kt),pt("DataConstantProperty",bt),pt("CrossFadedDataDrivenProperty",_l),pt("CrossFadedProperty",yl),pt("ColorRampProperty",Pu);const e="-transition";class n extends Nt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new ma(r.layout)),r.paint)){this._transitionablePaint=new gl(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ga(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,s={}){r!=null&&this._validate(rf,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(tf,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[t],p=c.property.specification["property-type"]==="cross-faded-data-driven",f=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value;return v.isDataDriven()||f||p||this._handleOverridablePaintPropertyUpdate(t,_,v)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mt(t,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(t,r,s,c,p={}){return(!p||p.validate!==!1)&&_u(this,t.call(zs,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Nn&&no(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function y(i,t=1){let r=0,s=0;return{members:i.map(c=>{const p=a[c.type].BYTES_PER_ELEMENT,f=r=x(r,Math.max(t,p)),_=c.components||1;return s=Math.max(s,p),r+=p*_,{name:c.name,type:c.type,components:_,offset:f}}),size:x(r,Math.max(s,t)),alignment:t}}function x(i,t){return Math.ceil(i/t)*t}class S extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.int16[c+0]=r,this.int16[c+1]=s,t}}S.prototype.bytesPerElement=4,pt("StructArrayLayout2i4",S);class C extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const p=3*t;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=c,t}}C.prototype.bytesPerElement=6,pt("StructArrayLayout3i6",C);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,c)}emplace(t,r,s,c,p){const f=4*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=c,this.int16[f+3]=p,t}}M.prototype.bytesPerElement=8,pt("StructArrayLayout4i8",M);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,c,p,f)}emplace(t,r,s,c,p,f,_){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=c,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=_,t}}z.prototype.bytesPerElement=12,pt("StructArrayLayout2i4i12",z);class B extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,c,p,f)}emplace(t,r,s,c,p,f,_){const v=4*t,P=8*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.uint8[P+4]=c,this.uint8[P+5]=p,this.uint8[P+6]=f,this.uint8[P+7]=_,t}}B.prototype.bytesPerElement=8,pt("StructArrayLayout2i4ub8",B);class Z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.float32[c+0]=r,this.float32[c+1]=s,t}}Z.prototype.bytesPerElement=8,pt("StructArrayLayout2f8",Z);class H extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f,_,v,P,A){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,s,c,p,f,_,v,P,A)}emplace(t,r,s,c,p,f,_,v,P,A,k){const D=10*t;return this.uint16[D+0]=r,this.uint16[D+1]=s,this.uint16[D+2]=c,this.uint16[D+3]=p,this.uint16[D+4]=f,this.uint16[D+5]=_,this.uint16[D+6]=v,this.uint16[D+7]=P,this.uint16[D+8]=A,this.uint16[D+9]=k,t}}H.prototype.bytesPerElement=20,pt("StructArrayLayout10ui20",H);class $ extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f,_,v,P,A,k,D){const O=this.length;return this.resize(O+1),this.emplace(O,t,r,s,c,p,f,_,v,P,A,k,D)}emplace(t,r,s,c,p,f,_,v,P,A,k,D,O){const N=12*t;return this.int16[N+0]=r,this.int16[N+1]=s,this.int16[N+2]=c,this.int16[N+3]=p,this.uint16[N+4]=f,this.uint16[N+5]=_,this.uint16[N+6]=v,this.uint16[N+7]=P,this.int16[N+8]=A,this.int16[N+9]=k,this.int16[N+10]=D,this.int16[N+11]=O,t}}$.prototype.bytesPerElement=24,pt("StructArrayLayout4i4ui4i24",$);class re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const p=3*t;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=c,t}}re.prototype.bytesPerElement=12,pt("StructArrayLayout3f12",re);class ne extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}ne.prototype.bytesPerElement=4,pt("StructArrayLayout1ul4",ne);class le extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f,_,v,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,s,c,p,f,_,v,P)}emplace(t,r,s,c,p,f,_,v,P,A){const k=10*t,D=5*t;return this.int16[k+0]=r,this.int16[k+1]=s,this.int16[k+2]=c,this.int16[k+3]=p,this.int16[k+4]=f,this.int16[k+5]=_,this.uint32[D+3]=v,this.uint16[k+8]=P,this.uint16[k+9]=A,t}}le.prototype.bytesPerElement=20,pt("StructArrayLayout6i1ul2ui20",le);class K extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,c,p,f)}emplace(t,r,s,c,p,f,_){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=c,this.int16[v+3]=p,this.int16[v+4]=f,this.int16[v+5]=_,t}}K.prototype.bytesPerElement=12,pt("StructArrayLayout2i2i2i12",K);class de extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,c,p)}emplace(t,r,s,c,p,f){const _=4*t,v=8*t;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=c,this.int16[v+6]=p,this.int16[v+7]=f,t}}de.prototype.bytesPerElement=16,pt("StructArrayLayout2f1f2i16",de);class me extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,s,c,p,f)}emplace(t,r,s,c,p,f,_){const v=16*t,P=4*t,A=8*t;return this.uint8[v+0]=r,this.uint8[v+1]=s,this.float32[P+1]=c,this.float32[P+2]=p,this.int16[A+6]=f,this.int16[A+7]=_,t}}me.prototype.bytesPerElement=16,pt("StructArrayLayout2ub2f2i16",me);class be extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=c,t}}be.prototype.bytesPerElement=6,pt("StructArrayLayout3ui6",be);class ze extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie){const ve=this.length;return this.resize(ve+1),this.emplace(ve,t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie)}emplace(t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie,ve){const ce=24*t,ge=12*t,Ie=48*t;return this.int16[ce+0]=r,this.int16[ce+1]=s,this.uint16[ce+2]=c,this.uint16[ce+3]=p,this.uint32[ge+2]=f,this.uint32[ge+3]=_,this.uint32[ge+4]=v,this.uint16[ce+10]=P,this.uint16[ce+11]=A,this.uint16[ce+12]=k,this.float32[ge+7]=D,this.float32[ge+8]=O,this.uint8[Ie+36]=N,this.uint8[Ie+37]=q,this.uint8[Ie+38]=J,this.uint32[ge+10]=ie,this.int16[ce+22]=ve,t}}ze.prototype.bytesPerElement=48,pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ze);class Ge extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie,ve,ce,ge,Ie,Ne,lt,Et,ot,it,Pt,gt){const dt=this.length;return this.resize(dt+1),this.emplace(dt,t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie,ve,ce,ge,Ie,Ne,lt,Et,ot,it,Pt,gt)}emplace(t,r,s,c,p,f,_,v,P,A,k,D,O,N,q,J,ie,ve,ce,ge,Ie,Ne,lt,Et,ot,it,Pt,gt,dt){const ke=32*t,It=16*t;return this.int16[ke+0]=r,this.int16[ke+1]=s,this.int16[ke+2]=c,this.int16[ke+3]=p,this.int16[ke+4]=f,this.int16[ke+5]=_,this.int16[ke+6]=v,this.int16[ke+7]=P,this.uint16[ke+8]=A,this.uint16[ke+9]=k,this.uint16[ke+10]=D,this.uint16[ke+11]=O,this.uint16[ke+12]=N,this.uint16[ke+13]=q,this.uint16[ke+14]=J,this.uint16[ke+15]=ie,this.uint16[ke+16]=ve,this.uint16[ke+17]=ce,this.uint16[ke+18]=ge,this.uint16[ke+19]=Ie,this.uint16[ke+20]=Ne,this.uint16[ke+21]=lt,this.uint16[ke+22]=Et,this.uint32[It+12]=ot,this.float32[It+13]=it,this.float32[It+14]=Pt,this.uint16[ke+30]=gt,this.uint16[ke+31]=dt,t}}Ge.prototype.bytesPerElement=64,pt("StructArrayLayout8i15ui1ul2f2ui64",Ge);class nt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}nt.prototype.bytesPerElement=4,pt("StructArrayLayout1f4",nt);class ct extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=s,this.float32[p+2]=c,t}}ct.prototype.bytesPerElement=12,pt("StructArrayLayout1ui2f12",ct);class Qe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,s)}emplace(t,r,s,c){const p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=s,this.uint16[p+3]=c,t}}Qe.prototype.bytesPerElement=8,pt("StructArrayLayout1ul2ui8",Qe);class $e extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const c=2*t;return this.uint16[c+0]=r,this.uint16[c+1]=s,t}}$e.prototype.bytesPerElement=4,pt("StructArrayLayout2ui4",$e);class wt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}wt.prototype.bytesPerElement=2,pt("StructArrayLayout1ui2",wt);class Ft extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,s,c)}emplace(t,r,s,c,p){const f=4*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=c,this.float32[f+3]=p,t}}Ft.prototype.bytesPerElement=16,pt("StructArrayLayout4f16",Ft);class tt extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new j(this.anchorPointX,this.anchorPointY)}}tt.prototype.size=20;class at extends le{get(t){return new tt(this,t)}}pt("CollisionBoxArray",at);class Lt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Lt.prototype.size=48;class Ii extends ze{get(t){return new Lt(this,t)}}pt("PlacedSymbolArray",Ii);class Ut extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ut.prototype.size=64;class Jt extends Ge{get(t){return new Ut(this,t)}}pt("SymbolInstanceArray",Jt);class Ai extends nt{getoffsetX(t){return this.float32[1*t+0]}}pt("GlyphOffsetArray",Ai);class _r extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}pt("SymbolLineVertexArray",_r);class Sn extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Sn.prototype.size=12;class Ci extends ct{get(t){return new Sn(this,t)}}pt("TextAnchorOffsetArray",Ci);class Nr extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Nr.prototype.size=8;class Tr extends Qe{get(t){return new Nr(this,t)}}pt("FeatureIndexArray",Tr);class yr extends S{}class Ir extends S{}class Vn extends S{}class yo extends z{}class vl extends B{}class vo extends Z{}class hn extends H{}class xl extends ${}class Tu extends re{}class dn extends ne{}class pn extends K{}class ss extends me{}class Pn extends be{}class ur extends $e{}const vr=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:en}=vr;class Qt{constructor(t=[]){this.segments=t}prepareSegment(t,r,s,c){let p=this.segments[this.segments.length-1];return t>Qt.MAX_VERTEX_ARRAY_LENGTH&&Re(`Max vertices per segment is ${Qt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>Qt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==c)&&(p={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(p.sortKey=c),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,c){return new Qt([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}function Ds(i,t){return 256*(i=De(Math.floor(i),0,255))+De(Math.floor(t),0,255)}Qt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt("SegmentVector",Qt);const xo=y([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var bo={exports:{}},lf={exports:{}};lf.exports=function(i,t){var r,s,c,p,f,_,v,P;for(s=i.length-(r=3&i.length),c=t,f=3432918353,_=461845907,P=0;P<s;)v=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,c=27492+(65535&(p=5*(65535&(c=(c^=v=(65535&(v=(v=(65535&v)*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*_+(((v>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&i.charCodeAt(P+2))<<16;case 2:v^=(255&i.charCodeAt(P+1))<<8;case 1:c^=v=(65535&(v=(v=(65535&(v^=255&i.charCodeAt(P)))*f+(((v>>>16)*f&65535)<<16)&4294967295)<<15|v>>>17))*_+(((v>>>16)*_&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var s_=lf.exports,cf={exports:{}};cf.exports=function(i,t){for(var r,s=i.length,c=t^s,p=0;s>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:c^=(255&i.charCodeAt(p+2))<<16;case 2:c^=(255&i.charCodeAt(p+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(p)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var os=s_,uf=cf.exports;bo.exports=os,bo.exports.murmur3=os,bo.exports.murmur2=uf;var bl=U(bo.exports);class _a{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,c){this.ids.push(wl(t)),this.positions.push(r,s,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=wl(t);let s=0,c=this.ids.length-1;for(;s<c;){const f=s+c>>1;this.ids[f]>=r?c=f:s=f+1}const p=[];for(;this.ids[s]===r;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(t,r){const s=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Sl(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(t){const r=new _a;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function wl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:bl(String(i))}function Sl(i,t,r,s){for(;r<s;){const c=i[r+s>>1];let p=r-1,f=s+1;for(;;){do p++;while(i[p]<c);do f--;while(i[f]>c);if(p>=f)break;wo(i,p,f),wo(t,3*p,3*f),wo(t,3*p+1,3*f+1),wo(t,3*p+2,3*f+2)}f-r<s-f?(Sl(i,t,r,f),r=f+1):(Sl(i,t,f+1,s),s=f)}}function wo(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}pt("FeaturePositionMap",_a);class ya{constructor(t,r){this.gl=t.gl,this.location=r}}class hf extends ya{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ky extends ya{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Jy extends ya{constructor(t,r){super(t,r),this.current=pi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const jb=new Float32Array(16);function o_(i){return[Ds(255*i.r,255*i.g),Ds(255*i.b,255*i.a)]}class Iu{constructor(t,r,s){this.value=t,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new Jy(t,r):new hf(t,r)}}class Pl{constructor(t,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,c){const p=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new Ky(t,r):new hf(t,r)}}class Rs{constructor(t,r,s,c){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,r,s,c,p){const f=this.paintVertexArray.length,_=this.expression.evaluate(new Ti(0),r,{},c,[],p);this.paintVertexArray.resize(t),this._setPaintValue(f,t,_)}updatePaintArray(t,r,s,c){const p=this.expression.evaluate({zoom:0},s,c);this._setPaintValue(t,r,p)}_setPaintValue(t,r,s){if(this.type==="color"){const c=o_(s);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,c[0],c[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hn{constructor(t,r,s,c,p,f){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,s,c,p){const f=this.expression.evaluate(new Ti(this.zoom),r,{},c,[],p),_=this.expression.evaluate(new Ti(this.zoom+1),r,{},c,[],p),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,f,_)}updatePaintArray(t,r,s,c){const p=this.expression.evaluate({zoom:this.zoom},s,c),f=this.expression.evaluate({zoom:this.zoom+1},s,c);this._setPaintValue(t,r,p,f)}_setPaintValue(t,r,s,c){if(this.type==="color"){const p=o_(s),f=o_(c);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,p[0],p[1],f[0],f[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=De(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,r,s){return new hf(t,r)}}class So{constructor(t,r,s,c,p,f){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=c,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,c,p){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],p)}_setPaintValues(t,r,s,c){if(!c||!s)return;const{min:p,mid:f,max:_}=s,v=c[p],P=c[f],A=c[_];if(v&&P&&A)for(let k=t;k<r;k++)this.zoomInPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],P.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,xo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,xo.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yy{constructor(t,r,s){this.binders={},this._buffers=[];const c=[];for(const p in t.paint._values){if(!s(p))continue;const f=t.paint.get(p);if(!(f instanceof Nn&&no(f.property.specification)))continue;const _=Ub(p,t.type),v=f.value,P=f.property.specification.type,A=f.property.useIntegerZoom,k=f.property.specification["property-type"],D=k==="cross-faded"||k==="cross-faded-data-driven";if(v.kind==="constant")this.binders[p]=D?new Pl(v.value,_):new Iu(v.value,_,P),c.push(`/u_${p}`);else if(v.kind==="source"||D){const O=$y(p,P,"source");this.binders[p]=D?new So(v,P,A,r,O,t.id):new Rs(v,_,P,O),c.push(`/a_${p}`)}else{const O=$y(p,P,"composite");this.binders[p]=new Hn(v,_,P,A,r,O),c.push(`/z_${p}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Rs||r instanceof Hn?r.maxValue:0}populatePaintArrays(t,r,s,c,p){for(const f in this.binders){const _=this.binders[f];(_ instanceof Rs||_ instanceof Hn||_ instanceof So)&&_.populatePaintArray(t,r,s,c,p)}}setConstantPatternPositions(t,r){for(const s in this.binders){const c=this.binders[s];c instanceof Pl&&c.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,c,p){let f=!1;for(const _ in t){const v=r.getPositions(_);for(const P of v){const A=s.feature(P.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof Rs||D instanceof Hn||D instanceof So)&&D.expression.isStateDependent===!0){const O=c.paint.get(k);D.expression=O.value,D.updatePaintArray(P.start,P.end,A,t[_],p),f=!0}}}}return f}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Iu||s instanceof Pl)&&t.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Rs||s instanceof Hn)for(let c=0;c<s.paintVertexAttributes.length;c++)t.push(s.paintVertexAttributes[c].name);else if(s instanceof So)for(let c=0;c<xo.members.length;c++)t.push(xo.members[c].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Iu||s instanceof Pl||s instanceof Hn)for(const c of s.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Iu||p instanceof Pl||p instanceof Hn){for(const f of p.uniformNames)if(r[f]){const _=p.getBinding(t,r[f],f);s.push({name:f,property:c,binding:_})}}}return s}setUniforms(t,r,s,c){for(const{name:p,property:f,binding:_}of r)this.binders[f].setUniform(_,c,s.get(f),p)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof So){const c=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof Rs||s instanceof Hn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof Rs||s instanceof Hn||s instanceof So)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Rs||r instanceof Hn||r instanceof So)&&r.destroy()}}}class va{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Yy(c,r,s);this.needsUpload=!1,this._featureMap=new _a,this._bufferOffset=0}populatePaintArrays(t,r,s,c,p,f){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,c,p,f);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,c){for(const p of s)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ub(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function $y(i,t,r){const s={color:{source:Z,composite:Ft},number:{source:nt,composite:Z}},c=function(p){return{"line-pattern":{source:hn,composite:hn},"fill-pattern":{source:hn,composite:hn},"fill-extrusion-pattern":{source:hn,composite:hn}}[p]}(i);return c&&c[r]||s[t][r]}pt("ConstantBinder",Iu),pt("CrossFadedConstantBinder",Pl),pt("SourceExpressionBinder",Rs),pt("CrossFadedCompositeBinder",So),pt("CompositeExpressionBinder",Hn),pt("ProgramConfiguration",Yy,{omit:["_buffers"]}),pt("ProgramConfigurationSet",va);const $i=8192,a_=Math.pow(2,14)-1,Qy=-a_-1;function xa(i){const t=$i/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const c=r[s];for(let p=0;p<c.length;p++){const f=c[p],_=Math.round(f.x*t),v=Math.round(f.y*t);f.x=De(_,Qy,a_),f.y=De(v,Qy,a_),(_<f.x||_>f.x+1||v<f.y||v>f.y+1)&&Re("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ba(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?xa(i):[]}}function df(i,t,r,s,c){i.emplaceBack(2*t+(s+1)/2,2*r+(c+1)/2)}class l_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ir,this.indexArray=new Pn,this.segments=new Qt,this.programConfigurations=new va(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){const c=this.layers[0],p=[];let f=null,_=!1;c.type==="circle"&&(f=c.layout.get("circle-sort-key"),_=!f.isConstant());for(const{feature:v,id:P,index:A,sourceLayerIndex:k}of t){const D=this.layers[0]._featureFilter.needGeometry,O=ba(v,D);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),O,s))continue;const N=_?f.evaluate(O,{},s):void 0,q={id:P,properties:v.properties,type:v.type,sourceLayerIndex:k,index:A,geometry:D?O.geometry:xa(v),patterns:{},sortKey:N};p.push(q)}_&&p.sort((v,P)=>v.sortKey-P.sortKey);for(const v of p){const{geometry:P,index:A,sourceLayerIndex:k}=v,D=t[A].feature;this.addFeature(v,P,A,s),r.featureIndex.insert(D,P,A,k,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,en),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,c){for(const p of r)for(const f of p){const _=f.x,v=f.y;if(_<0||_>=$i||v<0||v>=$i)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;df(this.layoutVertexArray,_,v,-1,-1),df(this.layoutVertexArray,_,v,1,-1),df(this.layoutVertexArray,_,v,1,1),df(this.layoutVertexArray,_,v,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},c)}}function ev(i,t){for(let r=0;r<i.length;r++)if(Tl(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Tl(i,t[r]))return!0;return!!c_(i,t)}function qb(i,t,r){return!!Tl(i,t)||!!u_(t,i,r)}function tv(i,t){if(i.length===1)return rv(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let c=0;c<s.length;c++)if(Tl(i,s[c]))return!0}for(let r=0;r<i.length;r++)if(rv(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(c_(i,t[r]))return!0;return!1}function Zb(i,t,r){if(i.length>1){if(c_(i,t))return!0;for(let s=0;s<t.length;s++)if(u_(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(u_(i[s],t,r))return!0;return!1}function c_(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],c=i[r+1];for(let p=0;p<t.length-1;p++)if(Gb(s,c,t[p],t[p+1]))return!0}return!1}function Gb(i,t,r,s){return Ae(i,r,s)!==Ae(t,r,s)&&Ae(i,t,r)!==Ae(i,t,s)}function u_(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let c=1;c<t.length;c++)if(iv(i,t[c-1],t[c])<s)return!0;return!1}function iv(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const c=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(c<0?t:c>1?r:r.sub(t)._mult(c)._add(t))}function rv(i,t){let r,s,c,p=!1;for(let f=0;f<i.length;f++){r=i[f];for(let _=0,v=r.length-1;_<r.length;v=_++)s=r[_],c=r[v],s.y>t.y!=c.y>t.y&&t.x<(c.x-s.x)*(t.y-s.y)/(c.y-s.y)+s.x&&(p=!p)}return p}function Tl(i,t){let r=!1;for(let s=0,c=i.length-1;s<i.length;c=s++){const p=i[s],f=i[c];p.y>t.y!=f.y>t.y&&t.x<(f.x-p.x)*(t.y-p.y)/(f.y-p.y)+p.x&&(r=!r)}return r}function Wb(i,t,r){const s=r[0],c=r[2];if(i.x<s.x&&t.x<s.x||i.x>c.x&&t.x>c.x||i.y<s.y&&t.y<s.y||i.y>c.y&&t.y>c.y)return!1;const p=Ae(i,t,r[0]);return p!==Ae(i,t,r[1])||p!==Ae(i,t,r[2])||p!==Ae(i,t,r[3])}function Au(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function pf(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ff(i,t,r,s,c){if(!t[0]&&!t[1])return i;const p=j.convert(t)._mult(c);r==="viewport"&&p._rotate(-s);const f=[];for(let _=0;_<i.length;_++)f.push(i[_].sub(p));return f}let nv,sv;pt("CircleBucket",l_,{omit:["layers"]});var Hb={get paint(){return sv=sv||new d({"circle-radius":new kt(xe.paint_circle["circle-radius"]),"circle-color":new kt(xe.paint_circle["circle-color"]),"circle-blur":new kt(xe.paint_circle["circle-blur"]),"circle-opacity":new kt(xe.paint_circle["circle-opacity"]),"circle-translate":new bt(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return nv=nv||new d({"circle-sort-key":new kt(xe.layout_circle["circle-sort-key"])})}},Vr=1e-6,Il=typeof Float32Array<"u"?Float32Array:Array;function h_(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ov(i,t,r){var s=t[0],c=t[1],p=t[2],f=t[3],_=t[4],v=t[5],P=t[6],A=t[7],k=t[8],D=t[9],O=t[10],N=t[11],q=t[12],J=t[13],ie=t[14],ve=t[15],ce=r[0],ge=r[1],Ie=r[2],Ne=r[3];return i[0]=ce*s+ge*_+Ie*k+Ne*q,i[1]=ce*c+ge*v+Ie*D+Ne*J,i[2]=ce*p+ge*P+Ie*O+Ne*ie,i[3]=ce*f+ge*A+Ie*N+Ne*ve,i[4]=(ce=r[4])*s+(ge=r[5])*_+(Ie=r[6])*k+(Ne=r[7])*q,i[5]=ce*c+ge*v+Ie*D+Ne*J,i[6]=ce*p+ge*P+Ie*O+Ne*ie,i[7]=ce*f+ge*A+Ie*N+Ne*ve,i[8]=(ce=r[8])*s+(ge=r[9])*_+(Ie=r[10])*k+(Ne=r[11])*q,i[9]=ce*c+ge*v+Ie*D+Ne*J,i[10]=ce*p+ge*P+Ie*O+Ne*ie,i[11]=ce*f+ge*A+Ie*N+Ne*ve,i[12]=(ce=r[12])*s+(ge=r[13])*_+(Ie=r[14])*k+(Ne=r[15])*q,i[13]=ce*c+ge*v+Ie*D+Ne*J,i[14]=ce*p+ge*P+Ie*O+Ne*ie,i[15]=ce*f+ge*A+Ie*N+Ne*ve,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Cu,Xb=ov;function mf(i,t,r){var s=t[0],c=t[1],p=t[2],f=t[3];return i[0]=r[0]*s+r[4]*c+r[8]*p+r[12]*f,i[1]=r[1]*s+r[5]*c+r[9]*p+r[13]*f,i[2]=r[2]*s+r[6]*c+r[10]*p+r[14]*f,i[3]=r[3]*s+r[7]*c+r[11]*p+r[15]*f,i}Cu=new Il(4),Il!=Float32Array&&(Cu[0]=0,Cu[1]=0,Cu[2]=0,Cu[3]=0);class Kb extends n{constructor(t){super(t,Hb)}createBucket(t){return new l_(t)}queryRadius(t){const r=t;return Au("circle-radius",this,r)+Au("circle-stroke-width",this,r)+pf(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,s,c,p,f,_,v){const P=ff(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,_),A=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),k=this.paint.get("circle-pitch-alignment")==="map",D=k?P:function(N,q){return N.map(J=>av(J,q))}(P,v),O=k?A*_:A;for(const N of c)for(const q of N){const J=k?q:av(q,v);let ie=O;const ve=mf([],[q.x,q.y,0,1],v);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ie*=ve[3]/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ie*=f.cameraToCenterDistance/ve[3]),qb(D,J,ie))return!0}return!1}}function av(i,t){const r=mf([],[i.x,i.y,0,1],t);return new j(r[0]/r[3],r[1]/r[3])}class lv extends l_{}let cv;pt("HeatmapBucket",lv,{omit:["layers"]});var Jb={get paint(){return cv=cv||new d({"heatmap-radius":new kt(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pu(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(xe.paint_heatmap["heatmap-opacity"])})}};function d_(i,{width:t,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*r*s}`)}else c=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=c,i}function uv(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const c=d_({},{width:t,height:r},s);p_(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=c.data}function p_(i,t,r,s,c,p){if(c.width===0||c.height===0)return t;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||s.x>t.width-c.width||s.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const f=i.data,_=t.data;if(f===_)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<c.height;v++){const P=((r.y+v)*i.width+r.x)*p,A=((s.y+v)*t.width+s.x)*p;for(let k=0;k<c.width*p;k++)_[A+k]=f[P+k]}return t}class Eu{constructor(t,r){d_(this,t,1,r)}resize(t){uv(this,t,1)}clone(){return new Eu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,c,p){p_(t,r,s,c,p,1)}}class Tn{constructor(t,r){d_(this,t,4,r)}resize(t){uv(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Tn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,c,p){p_(t,r,s,c,p,4)}}function hv(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,c=i.image||new Tn({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(f,_,v)=>{t[i.evaluationKey]=v;const P=i.expression.evaluate(t);c.data[f+_+0]=Math.floor(255*P.r/P.a),c.data[f+_+1]=Math.floor(255*P.g/P.a),c.data[f+_+2]=Math.floor(255*P.b/P.a),c.data[f+_+3]=Math.floor(255*P.a)};if(i.clips)for(let f=0,_=0;f<s;++f,_+=4*r)for(let v=0,P=0;v<r;v++,P+=4){const A=v/(r-1),{start:k,end:D}=i.clips[f];p(_,P,k*(1-A)+D*A)}else for(let f=0,_=0;f<r;f++,_+=4)p(0,_,f/(r-1));return c}pt("AlphaImage",Eu),pt("RGBAImage",Tn);const f_="big-fb";class Yb extends n{createBucket(t){return new lv(t)}constructor(t){super(t,Jb),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(f_)&&this.heatmapFbos.delete(f_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dv;var $b={get paint(){return dv=dv||new d({"hillshade-illumination-direction":new bt(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(xe.paint_hillshade["hillshade-accent-color"])})}};class Qb extends n{constructor(t){super(t,$b)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ew=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:tw}=ew;function pv(i,t,r=2){const s=t&&t.length,c=s?t[0]*r:i.length;let p=fv(i,0,c,r,!0);const f=[];if(!p||p.next===p.prev)return f;let _,v,P;if(s&&(p=function(A,k,D,O){const N=[];for(let q=0,J=k.length;q<J;q++){const ie=fv(A,k[q]*O,q<J-1?k[q+1]*O:A.length,O,!1);ie===ie.next&&(ie.steiner=!0),N.push(cw(ie))}N.sort(ow);for(let q=0;q<N.length;q++)D=aw(N[q],D);return D}(i,t,p,r)),i.length>80*r){_=1/0,v=1/0;let A=-1/0,k=-1/0;for(let D=r;D<c;D+=r){const O=i[D],N=i[D+1];O<_&&(_=O),N<v&&(v=N),O>A&&(A=O),N>k&&(k=N)}P=Math.max(A-_,k-v),P=P!==0?32767/P:0}return ku(p,f,r,_,v,P,0),f}function fv(i,t,r,s,c){let p;if(c===function(f,_,v,P){let A=0;for(let k=_,D=v-P;k<v;k+=P)A+=(f[D]-f[k])*(f[k+1]+f[D+1]),D=k;return A}(i,t,r,s)>0)for(let f=t;f<r;f+=s)p=_v(f/s|0,i[f],i[f+1],p);else for(let f=r-s;f>=t;f-=s)p=_v(f/s|0,i[f],i[f+1],p);return p&&gf(p,p.next)&&(zu(p),p=p.next),p}function wa(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!gf(s,s.next)&&Xi(s.prev,s,s.next)!==0)s=s.next;else{if(zu(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function ku(i,t,r,s,c,p,f){if(!i)return;!f&&p&&function(v,P,A,k){let D=v;do D.z===0&&(D.z=m_(D.x,D.y,P,A,k)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,function(O){let N,q=1;do{let J,ie=O;O=null;let ve=null;for(N=0;ie;){N++;let ce=ie,ge=0;for(let Ne=0;Ne<q&&(ge++,ce=ce.nextZ,ce);Ne++);let Ie=q;for(;ge>0||Ie>0&&ce;)ge!==0&&(Ie===0||!ce||ie.z<=ce.z)?(J=ie,ie=ie.nextZ,ge--):(J=ce,ce=ce.nextZ,Ie--),ve?ve.nextZ=J:O=J,J.prevZ=ve,ve=J;ie=ce}ve.nextZ=null,q*=2}while(N>1)}(D)}(i,s,c,p);let _=i;for(;i.prev!==i.next;){const v=i.prev,P=i.next;if(p?rw(i,s,c,p):iw(i))t.push(v.i,i.i,P.i),zu(i),i=P.next,_=P.next;else if((i=P)===_){f?f===1?ku(i=nw(wa(i),t),t,r,s,c,p,2):f===2&&sw(i,t,r,s,c,p):ku(wa(i),t,r,s,c,p,1);break}}}function iw(i){const t=i.prev,r=i,s=i.next;if(Xi(t,r,s)>=0)return!1;const c=t.x,p=r.x,f=s.x,_=t.y,v=r.y,P=s.y,A=c<p?c<f?c:f:p<f?p:f,k=_<v?_<P?_:P:v<P?v:P,D=c>p?c>f?c:f:p>f?p:f,O=_>v?_>P?_:P:v>P?v:P;let N=s.next;for(;N!==t;){if(N.x>=A&&N.x<=D&&N.y>=k&&N.y<=O&&Al(c,_,p,v,f,P,N.x,N.y)&&Xi(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function rw(i,t,r,s){const c=i.prev,p=i,f=i.next;if(Xi(c,p,f)>=0)return!1;const _=c.x,v=p.x,P=f.x,A=c.y,k=p.y,D=f.y,O=_<v?_<P?_:P:v<P?v:P,N=A<k?A<D?A:D:k<D?k:D,q=_>v?_>P?_:P:v>P?v:P,J=A>k?A>D?A:D:k>D?k:D,ie=m_(O,N,t,r,s),ve=m_(q,J,t,r,s);let ce=i.prevZ,ge=i.nextZ;for(;ce&&ce.z>=ie&&ge&&ge.z<=ve;){if(ce.x>=O&&ce.x<=q&&ce.y>=N&&ce.y<=J&&ce!==c&&ce!==f&&Al(_,A,v,k,P,D,ce.x,ce.y)&&Xi(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,ge.x>=O&&ge.x<=q&&ge.y>=N&&ge.y<=J&&ge!==c&&ge!==f&&Al(_,A,v,k,P,D,ge.x,ge.y)&&Xi(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;ce&&ce.z>=ie;){if(ce.x>=O&&ce.x<=q&&ce.y>=N&&ce.y<=J&&ce!==c&&ce!==f&&Al(_,A,v,k,P,D,ce.x,ce.y)&&Xi(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;ge&&ge.z<=ve;){if(ge.x>=O&&ge.x<=q&&ge.y>=N&&ge.y<=J&&ge!==c&&ge!==f&&Al(_,A,v,k,P,D,ge.x,ge.y)&&Xi(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function nw(i,t){let r=i;do{const s=r.prev,c=r.next.next;!gf(s,c)&&mv(s,r,r.next,c)&&Mu(s,c)&&Mu(c,s)&&(t.push(s.i,r.i,c.i),zu(r),zu(r.next),r=i=c),r=r.next}while(r!==i);return wa(r)}function sw(i,t,r,s,c,p){let f=i;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&uw(f,_)){let v=gv(f,_);return f=wa(f,f.next),v=wa(v,v.next),ku(f,t,r,s,c,p,0),void ku(v,t,r,s,c,p,0)}_=_.next}f=f.next}while(f!==i)}function ow(i,t){return i.x-t.x}function aw(i,t){const r=function(c,p){let f=p;const _=c.x,v=c.y;let P,A=-1/0;do{if(v<=f.y&&v>=f.next.y&&f.next.y!==f.y){const q=f.x+(v-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(q<=_&&q>A&&(A=q,P=f.x<f.next.x?f:f.next,q===_))return P}f=f.next}while(f!==p);if(!P)return null;const k=P,D=P.x,O=P.y;let N=1/0;f=P;do{if(_>=f.x&&f.x>=D&&_!==f.x&&Al(v<O?_:A,v,D,O,v<O?A:_,v,f.x,f.y)){const q=Math.abs(v-f.y)/(_-f.x);Mu(f,c)&&(q<N||q===N&&(f.x>P.x||f.x===P.x&&lw(P,f)))&&(P=f,N=q)}f=f.next}while(f!==k);return P}(i,t);if(!r)return t;const s=gv(r,i);return wa(s,s.next),wa(r,r.next)}function lw(i,t){return Xi(i.prev,i,t.prev)<0&&Xi(t.next,i,i.next)<0}function m_(i,t,r,s,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function cw(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Al(i,t,r,s,c,p,f,_){return(c-f)*(t-_)>=(i-f)*(p-_)&&(i-f)*(s-_)>=(r-f)*(t-_)&&(r-f)*(p-_)>=(c-f)*(s-_)}function uw(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,s){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&mv(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(i,t)&&(Mu(i,t)&&Mu(t,i)&&function(r,s){let c=r,p=!1;const f=(r.x+s.x)/2,_=(r.y+s.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&f<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(p=!p),c=c.next;while(c!==r);return p}(i,t)&&(Xi(i.prev,i,t.prev)||Xi(i,t.prev,t))||gf(i,t)&&Xi(i.prev,i,i.next)>0&&Xi(t.prev,t,t.next)>0)}function Xi(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function gf(i,t){return i.x===t.x&&i.y===t.y}function mv(i,t,r,s){const c=yf(Xi(i,t,r)),p=yf(Xi(i,t,s)),f=yf(Xi(r,s,i)),_=yf(Xi(r,s,t));return c!==p&&f!==_||!(c!==0||!_f(i,r,t))||!(p!==0||!_f(i,s,t))||!(f!==0||!_f(r,i,s))||!(_!==0||!_f(r,t,s))}function _f(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function yf(i){return i>0?1:i<0?-1:0}function Mu(i,t){return Xi(i.prev,i,i.next)<0?Xi(i,t,i.next)>=0&&Xi(i,i.prev,t)>=0:Xi(i,t,i.prev)<0||Xi(i,i.next,t)<0}function gv(i,t){const r=g_(i.i,i.x,i.y),s=g_(t.i,t.x,t.y),c=i.next,p=t.prev;return i.next=t,t.prev=i,r.next=c,c.prev=r,s.next=r,r.prev=s,p.next=s,s.prev=p,s}function _v(i,t,r,s){const c=g_(i,t,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function zu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function g_(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function __(i,t,r){const s=r.patternDependencies;let c=!1;for(const p of t){const f=p.paint.get(`${i}-pattern`);f.isConstant()||(c=!0);const _=f.constantOr(null);_&&(c=!0,s[_.to]=!0,s[_.from]=!0)}return c}function y_(i,t,r,s,c){const p=c.patternDependencies;for(const f of t){const _=f.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let v=_.evaluate({zoom:s-1},r,{},c.availableImages),P=_.evaluate({zoom:s},r,{},c.availableImages),A=_.evaluate({zoom:s+1},r,{},c.availableImages);v=v&&v.name?v.name:v,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,p[v]=!0,p[P]=!0,p[A]=!0,r.patterns[f.id]={min:v,mid:P,max:A}}}return r}class v_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Vn,this.indexArray=new Pn,this.indexArray2=new ur,this.programConfigurations=new va(t.layers,t.zoom),this.segments=new Qt,this.segments2=new Qt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=__("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),p=!c.isConstant(),f=[];for(const{feature:_,id:v,index:P,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,D=ba(_,k);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),D,s))continue;const O=p?c.evaluate(D,{},s,r.availableImages):void 0,N={id:v,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:k?D.geometry:xa(_),patterns:{},sortKey:O};f.push(N)}p&&f.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of f){const{geometry:v,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const k=y_("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,v,P,s,{});r.featureIndex.insert(t[P].feature,v,P,A,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,c,p){for(const f of Ya(r,500)){let _=0;for(const O of f)_+=O.length;const v=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),P=v.vertexLength,A=[],k=[];for(const O of f){if(O.length===0)continue;O!==f[0]&&k.push(A.length/2);const N=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(q+O.length-1,q),A.push(O[0].x),A.push(O[0].y);for(let J=1;J<O.length;J++)this.layoutVertexArray.emplaceBack(O[J].x,O[J].y),this.indexArray2.emplaceBack(q+J-1,q+J),A.push(O[J].x),A.push(O[J].y);N.vertexLength+=O.length,N.primitiveLength+=O.length}const D=pv(A,k);for(let O=0;O<D.length;O+=3)this.indexArray.emplaceBack(P+D[O],P+D[O+1],P+D[O+2]);v.vertexLength+=_,v.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,c)}}let yv,vv;pt("FillBucket",v_,{omit:["layers","patternFeatures"]});var hw={get paint(){return vv=vv||new d({"fill-antialias":new bt(xe.paint_fill["fill-antialias"]),"fill-opacity":new kt(xe.paint_fill["fill-opacity"]),"fill-color":new kt(xe.paint_fill["fill-color"]),"fill-outline-color":new kt(xe.paint_fill["fill-outline-color"]),"fill-translate":new bt(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new _l(xe.paint_fill["fill-pattern"])})},get layout(){return yv=yv||new d({"fill-sort-key":new kt(xe.layout_fill["fill-sort-key"])})}};class dw extends n{constructor(t){super(t,hw)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new v_(t)}queryRadius(){return pf(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,s,c,p,f,_){return tv(ff(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,_),c)}isTileClipped(){return!0}}const pw=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),fw=y([{name:"a_centroid",components:2,type:"Int16"}],4),{members:mw}=pw;var Po={},gw=W,xv=Cl;function Cl(i,t,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=s,this._values=c,i.readFields(_w,this,t)}function _w(i,t,r){i==1?t.id=r.readVarint():i==2?function(s,c){for(var p=s.readVarint()+s.pos;s.pos<p;){var f=c._keys[s.readVarint()],_=c._values[s.readVarint()];c.properties[f]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function yw(i){for(var t,r,s=0,c=0,p=i.length,f=p-1;c<p;f=c++)s+=((r=i[f]).x-(t=i[c]).x)*(t.y+r.y);return s}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,s=1,c=0,p=0,f=0,_=[];i.pos<r;){if(c<=0){var v=i.readVarint();s=7&v,c=v>>3}if(c--,s===1||s===2)p+=i.readSVarint(),f+=i.readSVarint(),s===1&&(t&&_.push(t),t=[]),t.push(new gw(p,f));else{if(s!==7)throw new Error("unknown command "+s);t&&t.push(t[0].clone())}}return t&&_.push(t),_},Cl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,s=0,c=0,p=0,f=1/0,_=-1/0,v=1/0,P=-1/0;i.pos<t;){if(s<=0){var A=i.readVarint();r=7&A,s=A>>3}if(s--,r===1||r===2)(c+=i.readSVarint())<f&&(f=c),c>_&&(_=c),(p+=i.readSVarint())<v&&(v=p),p>P&&(P=p);else if(r!==7)throw new Error("unknown command "+r)}return[f,v,_,P]},Cl.prototype.toGeoJSON=function(i,t,r){var s,c,p=this.extent*Math.pow(2,r),f=this.extent*i,_=this.extent*t,v=this.loadGeometry(),P=Cl.types[this.type];function A(O){for(var N=0;N<O.length;N++){var q=O[N];O[N]=[360*(q.x+f)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+_)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(s=0;s<v.length;s++)k[s]=v[s][0];A(v=k);break;case 2:for(s=0;s<v.length;s++)A(v[s]);break;case 3:for(v=function(O){var N=O.length;if(N<=1)return[O];for(var q,J,ie=[],ve=0;ve<N;ve++){var ce=yw(O[ve]);ce!==0&&(J===void 0&&(J=ce<0),J===ce<0?(q&&ie.push(q),q=[O[ve]]):q.push(O[ve]))}return q&&ie.push(q),ie}(v),s=0;s<v.length;s++)for(c=0;c<v[s].length;c++)A(v[s][c])}v.length===1?v=v[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:v},properties:this.properties};return"id"in this&&(D.id=this.id),D};var vw=xv,bv=wv;function wv(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(xw,this,t),this.length=this._features.length}function xw(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(s){for(var c=null,p=s.readVarint()+s.pos;s.pos<p;){var f=s.readVarint()>>3;c=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}return c}(r))}wv.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new vw(this._pbf,t,this.extent,this._keys,this._values)};var bw=bv;function ww(i,t,r){if(i===3){var s=new bw(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}Po.VectorTile=function(i,t){this.layers=i.readFields(ww,{},t)},Po.VectorTileFeature=xv,Po.VectorTileLayer=bv;const Sw=Po.VectorTileFeature.types,x_=Math.pow(2,13);function Du(i,t,r,s,c,p,f,_){i.emplaceBack(t,r,2*Math.floor(s*x_)+f,c*x_*2,p*x_*2,Math.round(_))}class b_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new yo,this.centroidVertexArray=new yr,this.indexArray=new Pn,this.programConfigurations=new va(t.layers,t.zoom),this.segments=new Qt,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.features=[],this.hasPattern=__("fill-extrusion",this.layers,r);for(const{feature:c,id:p,index:f,sourceLayerIndex:_}of t){const v=this.layers[0]._featureFilter.needGeometry,P=ba(c,v);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),P,s))continue;const A={id:p,sourceLayerIndex:_,index:f,geometry:v?P.geometry:xa(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(y_("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,f,s,{}),r.featureIndex.insert(c,A.geometry,f,_,this.index,!0)}}addFeatures(t,r,s){for(const c of this.features){const{geometry:p}=c;this.addFeature(c,p,c.index,r,s)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,fw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,c,p){for(const f of Ya(r,500)){const _={x:0,y:0,vertexCount:0};let v=0;for(const N of f)v+=N.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of f){if(N.length===0||Tw(N))continue;let q=0;for(let J=0;J<N.length;J++){const ie=N[J];if(J>=1){const ve=N[J-1];if(!Pw(ie,ve)){P.vertexLength+4>Qt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ce=ie.sub(ve)._perp()._unit(),ge=ve.dist(ie);q+ge>32768&&(q=0),Du(this.layoutVertexArray,ie.x,ie.y,ce.x,ce.y,0,0,q),Du(this.layoutVertexArray,ie.x,ie.y,ce.x,ce.y,0,1,q),_.x+=2*ie.x,_.y+=2*ie.y,_.vertexCount+=2,q+=ge,Du(this.layoutVertexArray,ve.x,ve.y,ce.x,ce.y,0,0,q),Du(this.layoutVertexArray,ve.x,ve.y,ce.x,ce.y,0,1,q),_.x+=2*ve.x,_.y+=2*ve.y,_.vertexCount+=2;const Ie=P.vertexLength;this.indexArray.emplaceBack(Ie,Ie+2,Ie+1),this.indexArray.emplaceBack(Ie+1,Ie+2,Ie+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+v>Qt.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray)),Sw[t.type]!=="Polygon")continue;const A=[],k=[],D=P.vertexLength;for(const N of f)if(N.length!==0){N!==f[0]&&k.push(A.length/2);for(let q=0;q<N.length;q++){const J=N[q];Du(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),_.x+=J.x,_.y+=J.y,_.vertexCount+=1,A.push(J.x),A.push(J.y)}}const O=pv(A,k);for(let N=0;N<O.length;N+=3)this.indexArray.emplaceBack(D+O[N],D+O[N+2],D+O[N+1]);P.primitiveLength+=O.length/3,P.vertexLength+=v;for(let N=0;N<_.vertexCount;N++){const q=Math.floor(_.x/_.vertexCount),J=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(q,J)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,c)}}function Pw(i,t){return i.x===t.x&&(i.x<0||i.x>$i)||i.y===t.y&&(i.y<0||i.y>$i)}function Tw(i){return i.every(t=>t.x<0)||i.every(t=>t.x>$i)||i.every(t=>t.y<0)||i.every(t=>t.y>$i)}let Sv;pt("FillExtrusionBucket",b_,{omit:["layers","features"]});var Iw={get paint(){return Sv=Sv||new d({"fill-extrusion-opacity":new bt(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _l(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Aw extends n{constructor(t){super(t,Iw)}createBucket(t){return new b_(t)}queryRadius(){return pf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,s,c,p,f,_,v){const P=ff(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,_),A=this.paint.get("fill-extrusion-height").evaluate(r,s),k=this.paint.get("fill-extrusion-base").evaluate(r,s),D=function(N,q,J,ie){const ve=[];for(const ce of N){const ge=[ce.x,ce.y,0,1];mf(ge,ge,q),ve.push(new j(ge[0]/ge[3],ge[1]/ge[3]))}return ve}(P,v),O=function(N,q,J,ie){const ve=[],ce=[],ge=ie[8]*q,Ie=ie[9]*q,Ne=ie[10]*q,lt=ie[11]*q,Et=ie[8]*J,ot=ie[9]*J,it=ie[10]*J,Pt=ie[11]*J;for(const gt of N){const dt=[],ke=[];for(const It of gt){const St=It.x,Ot=It.y,xi=ie[0]*St+ie[4]*Ot+ie[12],_i=ie[1]*St+ie[5]*Ot+ie[13],nr=ie[2]*St+ie[6]*Ot+ie[14],jn=ie[3]*St+ie[7]*Ot+ie[15],br=nr+Ne,sr=jn+lt,jr=xi+Et,Ur=_i+ot,qr=nr+it,Gi=jn+Pt,or=new j((xi+ge)/sr,(_i+Ie)/sr);or.z=br/sr,dt.push(or);const Ar=new j(jr/Gi,Ur/Gi);Ar.z=qr/Gi,ke.push(Ar)}ve.push(dt),ce.push(ke)}return[ve,ce]}(c,k,A,v);return function(N,q,J){let ie=1/0;tv(J,q)&&(ie=Pv(J,q[0]));for(let ve=0;ve<q.length;ve++){const ce=q[ve],ge=N[ve];for(let Ie=0;Ie<ce.length-1;Ie++){const Ne=ce[Ie],lt=[Ne,ce[Ie+1],ge[Ie+1],ge[Ie],Ne];ev(J,lt)&&(ie=Math.min(ie,Pv(J,lt)))}}return ie!==1/0&&ie}(O[0],O[1],D)}}function Ru(i,t){return i.x*t.x+i.y*t.y}function Pv(i,t){if(i.length===1){let r=0;const s=t[r++];let c;for(;!c||s.equals(c);)if(c=t[r++],!c)return 1/0;for(;r<t.length;r++){const p=t[r],f=i[0],_=c.sub(s),v=p.sub(s),P=f.sub(s),A=Ru(_,_),k=Ru(_,v),D=Ru(v,v),O=Ru(P,_),N=Ru(P,v),q=A*D-k*k,J=(D*O-k*N)/q,ie=(A*N-k*O)/q,ve=s.z*(1-J-ie)+c.z*J+p.z*ie;if(isFinite(ve))return ve}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const Cw=y([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ew}=Cw,kw=y([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Mw}=kw,zw=Po.VectorTileFeature.types,Dw=Math.cos(Math.PI/180*37.5),Tv=Math.pow(2,14)/.5;class w_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new vl,this.layoutVertexArray2=new vo,this.indexArray=new Pn,this.programConfigurations=new va(t.layers,t.zoom),this.segments=new Qt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,s){this.hasPattern=__("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),p=!c.isConstant(),f=[];for(const{feature:_,id:v,index:P,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,D=ba(_,k);if(!this.layers[0]._featureFilter.filter(new Ti(this.zoom),D,s))continue;const O=p?c.evaluate(D,{},s):void 0,N={id:v,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:k?D.geometry:xa(_),patterns:{},sortKey:O};f.push(N)}p&&f.sort((_,v)=>_.sortKey-v.sortKey);for(const _ of f){const{geometry:v,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const k=y_("line",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,v,P,s,{});r.featureIndex.insert(t[P].feature,v,P,A,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Mw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ew),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,c,p){const f=this.layers[0].layout,_=f.get("line-join").evaluate(t,{}),v=f.get("line-cap"),P=f.get("line-miter-limit"),A=f.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of r)this.addLine(k,t,_,v,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,p,c)}addLine(t,r,s,c,p,f){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ie=0;ie<t.length-1;ie++)this.totalDistance+=t[ie].dist(t[ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=zw[r.type]==="Polygon";let v=t.length;for(;v>=2&&t[v-1].equals(t[v-2]);)v--;let P=0;for(;P<v-1&&t[P].equals(t[P+1]);)P++;if(v<(_?3:2))return;s==="bevel"&&(p=1.05);const A=this.overscaling<=16?15*$i/(512*this.overscaling):0,k=this.segments.prepareSegment(10*v,this.layoutVertexArray,this.indexArray);let D,O,N,q,J;this.e1=this.e2=-1,_&&(D=t[v-2],J=t[P].sub(D)._unit()._perp());for(let ie=P;ie<v;ie++){if(N=ie===v-1?_?t[P+1]:void 0:t[ie+1],N&&t[ie].equals(N))continue;J&&(q=J),D&&(O=D),D=t[ie],J=N?N.sub(D)._unit()._perp():q,q=q||J;let ve=q.add(J);ve.x===0&&ve.y===0||ve._unit();const ce=q.x*J.x+q.y*J.y,ge=ve.x*J.x+ve.y*J.y,Ie=ge!==0?1/ge:1/0,Ne=2*Math.sqrt(2-2*ge),lt=ge<Dw&&O&&N,Et=q.x*J.y-q.y*J.x>0;if(lt&&ie>P){const Pt=D.dist(O);if(Pt>2*A){const gt=D.sub(D.sub(O)._mult(A/Pt)._round());this.updateDistance(O,gt),this.addCurrentVertex(gt,q,0,0,k),O=gt}}const ot=O&&N;let it=ot?s:_?"butt":c;if(ot&&it==="round"&&(Ie<f?it="miter":Ie<=2&&(it="fakeround")),it==="miter"&&Ie>p&&(it="bevel"),it==="bevel"&&(Ie>2&&(it="flipbevel"),Ie<p&&(it="miter")),O&&this.updateDistance(O,D),it==="miter")ve._mult(Ie),this.addCurrentVertex(D,ve,0,0,k);else if(it==="flipbevel"){if(Ie>100)ve=J.mult(-1);else{const Pt=Ie*q.add(J).mag()/q.sub(J).mag();ve._perp()._mult(Pt*(Et?-1:1))}this.addCurrentVertex(D,ve,0,0,k),this.addCurrentVertex(D,ve.mult(-1),0,0,k)}else if(it==="bevel"||it==="fakeround"){const Pt=-Math.sqrt(Ie*Ie-1),gt=Et?Pt:0,dt=Et?0:Pt;if(O&&this.addCurrentVertex(D,q,gt,dt,k),it==="fakeround"){const ke=Math.round(180*Ne/Math.PI/20);for(let It=1;It<ke;It++){let St=It/ke;if(St!==.5){const xi=St-.5;St+=St*xi*(St-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*xi*xi+(.848013+ce*(.215638*ce-1.06021)))}const Ot=J.sub(q)._mult(St)._add(q)._unit()._mult(Et?-1:1);this.addHalfVertex(D,Ot.x,Ot.y,!1,Et,0,k)}}N&&this.addCurrentVertex(D,J,-gt,-dt,k)}else if(it==="butt")this.addCurrentVertex(D,ve,0,0,k);else if(it==="square"){const Pt=O?1:-1;this.addCurrentVertex(D,ve,Pt,Pt,k)}else it==="round"&&(O&&(this.addCurrentVertex(D,q,0,0,k),this.addCurrentVertex(D,q,1,1,k,!0)),N&&(this.addCurrentVertex(D,J,-1,-1,k,!0),this.addCurrentVertex(D,J,0,0,k)));if(lt&&ie<v-1){const Pt=D.dist(N);if(Pt>2*A){const gt=D.add(N.sub(D)._mult(A/Pt)._round());this.updateDistance(D,gt),this.addCurrentVertex(gt,J,0,0,k),D=gt}}}}addCurrentVertex(t,r,s,c,p,f=!1){const _=r.y*c-r.x,v=-r.y-r.x*c;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,f,!1,s,p),this.addHalfVertex(t,_,v,f,!0,-c,p),this.distance>Tv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,c,p,f))}addHalfVertex({x:t,y:r},s,c,p,f,_,v){const P=.5*(this.lineClips?this.scaledDistance*(Tv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),v.primitiveLength++),f?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Iv,Av;pt("LineBucket",w_,{omit:["layers","patternFeatures"]});var Cv={get paint(){return Av=Av||new d({"line-opacity":new kt(xe.paint_line["line-opacity"]),"line-color":new kt(xe.paint_line["line-color"]),"line-translate":new bt(xe.paint_line["line-translate"]),"line-translate-anchor":new bt(xe.paint_line["line-translate-anchor"]),"line-width":new kt(xe.paint_line["line-width"]),"line-gap-width":new kt(xe.paint_line["line-gap-width"]),"line-offset":new kt(xe.paint_line["line-offset"]),"line-blur":new kt(xe.paint_line["line-blur"]),"line-dasharray":new yl(xe.paint_line["line-dasharray"]),"line-pattern":new _l(xe.paint_line["line-pattern"]),"line-gradient":new Pu(xe.paint_line["line-gradient"])})},get layout(){return Iv=Iv||new d({"line-cap":new bt(xe.layout_line["line-cap"]),"line-join":new kt(xe.layout_line["line-join"]),"line-miter-limit":new bt(xe.layout_line["line-miter-limit"]),"line-round-limit":new bt(xe.layout_line["line-round-limit"]),"line-sort-key":new kt(xe.layout_line["line-sort-key"])})}};class Rw extends kt{possiblyEvaluate(t,r){return r=new Ti(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,c){return r=Ze({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,c)}}let vf;class Lw extends n{constructor(t){super(t,Cv),this.gradientVersion=0,vf||(vf=new Rw(Cv.paint.properties["line-width"].specification),vf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(s){return s._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof $s,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=vf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new w_(t)}queryRadius(t){const r=t,s=Ev(Au("line-width",this,r),Au("line-gap-width",this,r)),c=Au("line-offset",this,r);return s/2+Math.abs(c)+pf(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,s,c,p,f,_){const v=ff(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,_),P=_/2*Ev(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),A=this.paint.get("line-offset").evaluate(r,s);return A&&(c=function(k,D){const O=[];for(let N=0;N<k.length;N++){const q=k[N],J=[];for(let ie=0;ie<q.length;ie++){const ve=q[ie-1],ce=q[ie],ge=q[ie+1],Ie=ie===0?new j(0,0):ce.sub(ve)._unit()._perp(),Ne=ie===q.length-1?new j(0,0):ge.sub(ce)._unit()._perp(),lt=Ie._add(Ne)._unit(),Et=lt.x*Ne.x+lt.y*Ne.y;Et!==0&&lt._mult(1/Et),J.push(lt._mult(D)._add(ce))}O.push(J)}return O}(c,A*_)),function(k,D,O){for(let N=0;N<D.length;N++){const q=D[N];if(k.length>=3){for(let J=0;J<q.length;J++)if(Tl(k,q[J]))return!0}if(Zb(k,q,O))return!0}return!1}(v,c,P)}isTileClipped(){return!0}}function Ev(i,t){return t>0?t+2*i:i}const Ow=y([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fw=y([{name:"a_projected_pos",components:3,type:"Float32"}],4);y([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bw=y([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);y([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const kv=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Nw=y([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Vw(i,t,r){return i.sections.forEach(s=>{s.text=function(c,p,f){const _=p.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Qr.applyArabicShaping&&(c=Qr.applyArabicShaping(c)),c}(s.text,t,r)}),i}y([{name:"triangle",components:3,type:"Uint16"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),y([{type:"Float32",name:"offsetX"}]),y([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),y([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Lu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var tr=24,Mv=gi,zv=function(i,t,r,s,c){var p,f,_=8*c-s-1,v=(1<<_)-1,P=v>>1,A=-7,k=c-1,D=-1,O=i[t+k];for(k+=D,p=O&(1<<-A)-1,O>>=-A,A+=_;A>0;p=256*p+i[t+k],k+=D,A-=8);for(f=p&(1<<-A)-1,p>>=-A,A+=s;A>0;f=256*f+i[t+k],k+=D,A-=8);if(p===0)p=1-P;else{if(p===v)return f?NaN:1/0*(O?-1:1);f+=Math.pow(2,s),p-=P}return(O?-1:1)*f*Math.pow(2,p-s)},Dv=function(i,t,r,s,c,p){var f,_,v,P=8*p-c-1,A=(1<<P)-1,k=A>>1,D=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=0,N=1,q=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,f=A):(f=Math.floor(Math.log(t)/Math.LN2),t*(v=Math.pow(2,-f))<1&&(f--,v*=2),(t+=f+k>=1?D/v:D*Math.pow(2,1-k))*v>=2&&(f++,v/=2),f+k>=A?(_=0,f=A):f+k>=1?(_=(t*v-1)*Math.pow(2,c),f+=k):(_=t*Math.pow(2,k-1)*Math.pow(2,c),f=0));c>=8;i[r+O]=255&_,O+=N,_/=256,c-=8);for(f=f<<c|_,P+=c;P>0;i[r+O]=255&f,O+=N,f/=256,P-=8);i[r+O-N]|=128*q};function gi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}gi.Varint=0,gi.Fixed64=1,gi.Bytes=2,gi.Fixed32=5;var S_=4294967296,Rv=1/S_,Lv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Ls(i){return i.type===gi.Bytes?i.readVarint()+i.pos:i.pos+1}function El(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Ov(i,t,r){var s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=i;c--)r.buf[c+s]=r.buf[c]}function jw(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Uw(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function qw(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function Zw(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function Gw(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function Ww(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function Hw(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Xw(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function Kw(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function xf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function kl(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Fv(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}gi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,p=this.pos;this.type=7&s,i(c,t,this),this.pos===p&&this.skip(s)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=xf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Fv(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=xf(this.buf,this.pos)+xf(this.buf,this.pos+4)*S_;return this.pos+=8,i},readSFixed64:function(){var i=xf(this.buf,this.pos)+Fv(this.buf,this.pos+4)*S_;return this.pos+=8,i},readFloat:function(){var i=zv(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=zv(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,s=this.buf;return t=127&(r=s[this.pos++]),r<128?t:(t|=(127&(r=s[this.pos++]))<<7,r<128?t:(t|=(127&(r=s[this.pos++]))<<14,r<128?t:(t|=(127&(r=s[this.pos++]))<<21,r<128?t:function(c,p,f){var _,v,P=f.buf;if(_=(112&(v=P[f.pos++]))>>4,v<128||(_|=(127&(v=P[f.pos++]))<<3,v<128)||(_|=(127&(v=P[f.pos++]))<<10,v<128)||(_|=(127&(v=P[f.pos++]))<<17,v<128)||(_|=(127&(v=P[f.pos++]))<<24,v<128)||(_|=(1&(v=P[f.pos++]))<<31,v<128))return El(c,_,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=s[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Lv?function(r,s,c){return Lv.decode(r.subarray(s,c))}(this.buf,t,i):function(r,s,c){for(var p="",f=s;f<c;){var _,v,P,A=r[f],k=null,D=A>239?4:A>223?3:A>191?2:1;if(f+D>c)break;D===1?A<128&&(k=A):D===2?(192&(_=r[f+1]))==128&&(k=(31&A)<<6|63&_)<=127&&(k=null):D===3?(v=r[f+2],(192&(_=r[f+1]))==128&&(192&v)==128&&((k=(15&A)<<12|(63&_)<<6|63&v)<=2047||k>=55296&&k<=57343)&&(k=null)):D===4&&(v=r[f+2],P=r[f+3],(192&(_=r[f+1]))==128&&(192&v)==128&&(192&P)==128&&((k=(15&A)<<18|(63&_)<<12|(63&v)<<6|63&P)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,D=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),f+=D}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==gi.Bytes)return i.push(this.readVarint(t));var r=Ls(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==gi.Bytes)return i.push(this.readSVarint());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==gi.Bytes)return i.push(this.readBoolean());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==gi.Bytes)return i.push(this.readFloat());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==gi.Bytes)return i.push(this.readDouble());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==gi.Bytes)return i.push(this.readFixed32());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==gi.Bytes)return i.push(this.readSFixed32());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==gi.Bytes)return i.push(this.readFixed64());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==gi.Bytes)return i.push(this.readSFixed64());var t=Ls(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===gi.Varint)for(;this.buf[this.pos++]>127;);else if(t===gi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===gi.Fixed32)this.pos+=4;else{if(t!==gi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),kl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),kl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),kl(this.buf,-1&i,this.pos),kl(this.buf,Math.floor(i*Rv),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),kl(this.buf,-1&i,this.pos),kl(this.buf,Math.floor(i*Rv),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var s,c;if(t>=0?(s=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(s=~(-t%4294967296))?s=s+1|0:(s=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,f,_){_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,_.buf[_.pos]=127&(p>>>=7)}(s,0,r),function(p,f){var _=(7&p)<<4;f.buf[f.pos++]|=_|((p>>>=3)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p|((p>>>=7)?128:0),p&&(f.buf[f.pos++]=127&p)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(s,c,p){for(var f,_,v=0;v<c.length;v++){if((f=c.charCodeAt(v))>55295&&f<57344){if(!_){f>56319||v+1===c.length?(s[p++]=239,s[p++]=191,s[p++]=189):_=f;continue}if(f<56320){s[p++]=239,s[p++]=191,s[p++]=189,_=f;continue}f=_-55296<<10|f-56320|65536,_=null}else _&&(s[p++]=239,s[p++]=191,s[p++]=189,_=null);f<128?s[p++]=f:(f<2048?s[p++]=f>>6|192:(f<65536?s[p++]=f>>12|224:(s[p++]=f>>18|240,s[p++]=f>>12&63|128),s[p++]=f>>6&63|128),s[p++]=63&f|128)}return p}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Ov(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Dv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Dv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var s=this.pos-r;s>=128&&Ov(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(i,t,r){this.writeTag(i,gi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,jw,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Uw,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Gw,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,qw,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Zw,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Ww,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Hw,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Xw,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Kw,t)},writeBytesField:function(i,t){this.writeTag(i,gi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,gi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,gi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,gi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,gi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,gi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,gi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,gi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,gi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,gi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var P_=U(Mv);const T_=3;function Jw(i,t,r){i===1&&r.readMessage(Yw,t)}function Yw(i,t,r){if(i===3){const{id:s,bitmap:c,width:p,height:f,left:_,top:v,advance:P}=r.readMessage($w,{});t.push({id:s,bitmap:new Eu({width:p+2*T_,height:f+2*T_},c),metrics:{width:p,height:f,left:_,top:v,advance:P}})}}function $w(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const Bv=T_;function Nv(i){let t=0,r=0;for(const f of i)t+=f.w*f.h,r=Math.max(r,f.w);i.sort((f,_)=>_.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let c=0,p=0;for(const f of i)for(let _=s.length-1;_>=0;_--){const v=s[_];if(!(f.w>v.w||f.h>v.h)){if(f.x=v.x,f.y=v.y,p=Math.max(p,f.y+f.h),c=Math.max(c,f.x+f.w),f.w===v.w&&f.h===v.h){const P=s.pop();_<s.length&&(s[_]=P)}else f.h===v.h?(v.x+=f.w,v.w-=f.w):f.w===v.w?(v.y+=f.h,v.h-=f.h):(s.push({x:v.x+f.w,y:v.y,w:v.w-f.w,h:f.h}),v.y+=f.h,v.h-=f.h);break}}return{w:c,h:p,fill:t/(c*p)||0}}const tn=1;class I_{constructor(t,{pixelRatio:r,version:s,stretchX:c,stretchY:p,content:f,textFitWidth:_,textFitHeight:v}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=c,this.stretchY=p,this.content=f,this.version=s,this.textFitWidth=_,this.textFitHeight=v}get tl(){return[this.paddedRect.x+tn,this.paddedRect.y+tn]}get br(){return[this.paddedRect.x+this.paddedRect.w-tn,this.paddedRect.y+this.paddedRect.h-tn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*tn)/this.pixelRatio,(this.paddedRect.h-2*tn)/this.pixelRatio]}}class Vv{constructor(t,r){const s={},c={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,s,p),this.addImages(r,c,p);const{w:f,h:_}=Nv(p),v=new Tn({width:f||1,height:_||1});for(const P in t){const A=t[P],k=s[P].paddedRect;Tn.copy(A.data,v,{x:0,y:0},{x:k.x+tn,y:k.y+tn},A.data)}for(const P in r){const A=r[P],k=c[P].paddedRect,D=k.x+tn,O=k.y+tn,N=A.data.width,q=A.data.height;Tn.copy(A.data,v,{x:0,y:0},{x:D,y:O},A.data),Tn.copy(A.data,v,{x:0,y:q-1},{x:D,y:O-1},{width:N,height:1}),Tn.copy(A.data,v,{x:0,y:0},{x:D,y:O+q},{width:N,height:1}),Tn.copy(A.data,v,{x:N-1,y:0},{x:D-1,y:O},{width:1,height:q}),Tn.copy(A.data,v,{x:0,y:0},{x:D+N,y:O},{width:1,height:q})}this.image=v,this.iconPositions=s,this.patternPositions=c}addImages(t,r,s){for(const c in t){const p=t[c],f={x:0,y:0,w:p.data.width+2*tn,h:p.data.height+2*tn};s.push(f),r[c]=new I_(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[c,p]=t.tl;s.update(r.data,void 0,{x:c,y:p})}}var To;pt("ImagePosition",I_),pt("ImageAtlas",Vv),w.ah=void 0,(To=w.ah||(w.ah={}))[To.none=0]="none",To[To.horizontal=1]="horizontal",To[To.vertical=2]="vertical",To[To.horizontalOnly=3]="horizontalOnly";const Ou=-17;class Fu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const s=new Fu;return s.scale=t||1,s.fontStack=r,s}static forImage(t){const r=new Fu;return r.imageName=t,r}}class Ml{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Ml;for(let c=0;c<t.sections.length;c++){const p=t.sections[c];p.image?s.addImageSection(p):s.addTextSection(p,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let s=0;s<t.length;s++){const c=t.charCodeAt(s+1)||null,p=t.charCodeAt(s-1)||null;r+=c&&of(c)&&!Lu[t[s+1]]||p&&of(p)&&!Lu[t[s-1]]||!Lu[t[s]]?t[s]:Lu[t[s]]}return r}(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&wf[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&wf[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Ml;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Fu.forText(t.scale,t.fontStack||r));const s=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Re("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Fu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Re("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bf(i,t,r,s,c,p,f,_,v,P,A,k,D,O,N){const q=Ml.fromFeature(i,c);let J;k===w.ah.vertical&&q.verticalizePunctuation();const{processBidirectionalText:ie,processStyledBidirectionalText:ve}=Qr;if(ie&&q.sections.length===1){J=[];const Ie=ie(q.toString(),A_(q,P,p,t,s,O));for(const Ne of Ie){const lt=new Ml;lt.text=Ne,lt.sections=q.sections;for(let Et=0;Et<Ne.length;Et++)lt.sectionIndex.push(0);J.push(lt)}}else if(ve){J=[];const Ie=ve(q.text,q.sectionIndex,A_(q,P,p,t,s,O));for(const Ne of Ie){const lt=new Ml;lt.text=Ne[0],lt.sectionIndex=Ne[1],lt.sections=q.sections,J.push(lt)}}else J=function(Ie,Ne){const lt=[],Et=Ie.text;let ot=0;for(const it of Ne)lt.push(Ie.substring(ot,it)),ot=it;return ot<Et.length&&lt.push(Ie.substring(ot,Et.length)),lt}(q,A_(q,P,p,t,s,O));const ce=[],ge={positionedLines:ce,text:q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Ie,Ne,lt,Et,ot,it,Pt,gt,dt,ke,It,St){let Ot=0,xi=Ou,_i=0,nr=0;const jn=gt==="right"?1:gt==="left"?0:.5;let br=0;for(const Gi of ot){Gi.trim();const or=Gi.getMaxScale(),Ar=(or-1)*tr,wr={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[br]=wr;const Zr=wr.positionedGlyphs;let Sr=0;if(!Gi.length()){xi+=it,++br;continue}for(let rn=0;rn<Gi.length();rn++){const si=Gi.getSection(rn),Si=Gi.getSectionIndex(rn),Ei=Gi.getCharCode(rn);let fn=0,Ni=null,Ll=null,ls=null,cs=tr;const Un=!(dt===w.ah.horizontal||!It&&!wu(Ei)||It&&(wf[Ei]||(sr=Ei,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(sr)))));if(si.imageName){const Cn=Et[si.imageName];if(!Cn)continue;ls=si.imageName,Ie.iconsInText=Ie.iconsInText||!0,Ll=Cn.paddedRect;const hr=Cn.displaySize;si.scale=si.scale*tr/St,Ni={width:hr[0],height:hr[1],left:tn,top:-Bv,advance:Un?hr[1]:hr[0]},fn=Ar+(tr-hr[1]*si.scale),cs=Ni.advance;const Os=Un?hr[0]*si.scale-tr*or:hr[1]*si.scale-tr*or;Os>0&&Os>Sr&&(Sr=Os)}else{const Cn=lt[si.fontStack],hr=Cn&&Cn[Ei];if(hr&&hr.rect)Ll=hr.rect,Ni=hr.metrics;else{const Os=Ne[si.fontStack],qu=Os&&Os[Ei];if(!qu)continue;Ni=qu.metrics}fn=(or-si.scale)*tr}Un?(Ie.verticalizable=!0,Zr.push({glyph:Ei,imageName:ls,x:Ot,y:xi+fn,vertical:Un,scale:si.scale,fontStack:si.fontStack,sectionIndex:Si,metrics:Ni,rect:Ll}),Ot+=cs*si.scale+ke):(Zr.push({glyph:Ei,imageName:ls,x:Ot,y:xi+fn,vertical:Un,scale:si.scale,fontStack:si.fontStack,sectionIndex:Si,metrics:Ni,rect:Ll}),Ot+=Ni.advance*si.scale+ke)}Zr.length!==0&&(_i=Math.max(Ot-ke,_i),i1(Zr,0,Zr.length-1,jn,Sr)),Ot=0;const An=it*or+Sr;wr.lineOffset=Math.max(Sr,Ar),xi+=An,nr=Math.max(An,nr),++br}var sr;const jr=xi-Ou,{horizontalAlign:Ur,verticalAlign:qr}=C_(Pt);(function(Gi,or,Ar,wr,Zr,Sr,An,rn,si){const Si=(or-Ar)*Zr;let Ei=0;Ei=Sr!==An?-rn*wr-Ou:(-wr*si+.5)*An;for(const fn of Gi)for(const Ni of fn.positionedGlyphs)Ni.x+=Si,Ni.y+=Ei})(Ie.positionedLines,jn,Ur,qr,_i,nr,it,jr,ot.length),Ie.top+=-qr*jr,Ie.bottom=Ie.top+jr,Ie.left+=-Ur*_i,Ie.right=Ie.left+_i}(ge,t,r,s,J,f,_,v,k,P,D,N),!function(Ie){for(const Ne of Ie)if(Ne.positionedGlyphs.length!==0)return!1;return!0}(ce)&&ge}const wf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},e1={40:!0};function jv(i,t,r,s,c,p){if(t.imageName){const f=s[t.imageName];return f?f.displaySize[0]*t.scale*tr/p+c:0}{const f=r[t.fontStack],_=f&&f[i];return _?_.metrics.advance*t.scale+c:0}}function Uv(i,t,r,s){const c=Math.pow(i-t,2);return s?i<t?c/2:2*c:c+Math.abs(r)*r}function t1(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function qv(i,t,r,s,c,p){let f=null,_=Uv(t,r,c,p);for(const v of s){const P=Uv(t-v.x,r,c,p)+v.badness;P<=_&&(f=v,_=P)}return{index:i,x:t,priorBreak:f,badness:_}}function Zv(i){return i?Zv(i.priorBreak).concat(i.index):[]}function A_(i,t,r,s,c,p){if(!i)return[];const f=[],_=function(k,D,O,N,q,J){let ie=0;for(let ve=0;ve<k.length();ve++){const ce=k.getSection(ve);ie+=jv(k.getCharCode(ve),ce,N,q,D,J)}return ie/Math.max(1,Math.ceil(ie/O))}(i,t,r,s,c,p),v=i.text.indexOf("")>=0;let P=0;for(let k=0;k<i.length();k++){const D=i.getSection(k),O=i.getCharCode(k);if(wf[O]||(P+=jv(O,D,s,c,t,p)),k<i.length()-1){const N=!((A=O)<11904)&&(!!$t["CJK Compatibility Forms"](A)||!!$t["CJK Compatibility"](A)||!!$t["CJK Strokes"](A)||!!$t["CJK Symbols and Punctuation"](A)||!!$t["Enclosed CJK Letters and Months"](A)||!!$t["Halfwidth and Fullwidth Forms"](A)||!!$t["Ideographic Description Characters"](A)||!!$t["Vertical Forms"](A)||sf.test(String.fromCodePoint(A)));(Qw[O]||N||D.imageName||k!==i.length()-2&&e1[i.getCharCode(k+1)])&&f.push(qv(k+1,P,_,f,t1(O,i.getCharCode(k+1),N&&v),!1))}}var A;return Zv(qv(i.length(),P,_,f,0,!0))}function C_(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function i1(i,t,r,s,c){if(!s&&!c)return;const p=i[r],f=(i[r].x+p.metrics.advance*p.scale)*s;for(let _=t;_<=r;_++)i[_].x-=f,i[_].y+=c}function r1(i,t,r){const{horizontalAlign:s,verticalAlign:c}=C_(r),p=t[0]-i.displaySize[0]*s,f=t[1]-i.displaySize[1]*c;return{image:i,top:f,bottom:f+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Gv(i){var t,r;let s=i.left,c=i.top,p=i.right-s,f=i.bottom-c;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",v=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(v==="proportional"){if(_==="stretchOnly"&&p/f<P||_==="proportional"){const A=Math.ceil(f*P);s*=A/p,p=A}}else if(_==="proportional"&&v==="stretchOnly"&&P!==0&&p/f>P){const A=Math.ceil(p/P);c*=A/f,f=A}return{x1:s,y1:c,x2:s+p,y2:c+f}}function Wv(i,t,r,s,c,p){const f=i.image;let _;if(f.content){const J=f.content,ie=f.pixelRatio||1;_=[J[0]/ie,J[1]/ie,f.displaySize[0]-J[2]/ie,f.displaySize[1]-J[3]/ie]}const v=t.left*p,P=t.right*p;let A,k,D,O;r==="width"||r==="both"?(O=c[0]+v-s[3],k=c[0]+P+s[1]):(O=c[0]+(v+P-f.displaySize[0])/2,k=O+f.displaySize[0]);const N=t.top*p,q=t.bottom*p;return r==="height"||r==="both"?(A=c[1]+N-s[0],D=c[1]+q+s[2]):(A=c[1]+(N+q-f.displaySize[1])/2,D=A+f.displaySize[1]),{image:f,top:A,right:k,bottom:D,left:O,collisionPadding:_}}const Bu=255,as=128,Io=Bu*as;function Hv(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ti(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let p=0;for(;p<s.length&&s[p]<=i;)p++;p=Math.max(0,p-1);let f=p;for(;f<s.length&&s[f]<i+1;)f++;f=Math.min(s.length-1,f);const _=s[p],v=s[f];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:v,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:v,minSize:r.evaluate(new Ti(_)),maxSize:r.evaluate(new Ti(v)),interpolationType:c}}}function E_(i,t,r){let s="never";const c=i.get(t);return c?s=c:i.get(r)&&(s="always"),s}const n1=Po.VectorTileFeature.types,s1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sf(i,t,r,s,c,p,f,_,v,P,A,k,D){const O=_?Math.min(Io,Math.round(_[0])):0,N=_?Math.min(Io,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*c),p,f,(O<<1)+(v?1:0),N,16*P,16*A,256*k,256*D)}function k_(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function o1(i){for(const t of i.sections)if(n_(t.text))return!0;return!1}class M_{constructor(t){this.layoutVertexArray=new xl,this.indexArray=new Pn,this.programConfigurations=t,this.segments=new Qt,this.dynamicLayoutVertexArray=new Tu,this.opacityVertexArray=new dn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Ii}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ow.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Fw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,s1,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pt("SymbolBuffers",M_);class z_{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Qt,this.collisionVertexArray=new ss}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Bw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pt("CollisionBuffers",z_);class zl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(f=>f.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=h_([]),this.placementViewportMatrix=h_([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hv(this.zoom,r["text-size"]),this.iconSizeData=Hv(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=E_(s,"text-overlap","text-allow-overlap")!=="never"||E_(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(f=>w.ah[f])),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=t.sourceID}createArrays(){this.text=new M_(new va(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new M_(new va(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ai,this.lineVertexArray=new _r,this.symbolInstances=new Jt,this.textAnchorOffsets=new Ci}calculateGlyphDependencies(t,r,s,c,p){for(let f=0;f<t.length;f++)if(r[t.charCodeAt(f)]=!0,(s||c)&&p){const _=Lu[t.charAt(f)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,s){const c=this.layers[0],p=c.layout,f=p.get("text-font"),_=p.get("text-field"),v=p.get("icon-image"),P=(_.value.kind!=="constant"||_.value.value instanceof Kr&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),A=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const D=r.iconDependencies,O=r.glyphDependencies,N=r.availableImages,q=new Ti(this.zoom);for(const{feature:J,id:ie,index:ve,sourceLayerIndex:ce}of t){const ge=c._featureFilter.needGeometry,Ie=ba(J,ge);if(!c._featureFilter.filter(q,Ie,s))continue;let Ne,lt;if(ge||(Ie.geometry=xa(J)),P){const ot=c.getValueAndResolveTokens("text-field",Ie,s,N),it=Kr.factory(ot),Pt=this.hasRTLText=this.hasRTLText||o1(it);(!Pt||Qr.getRTLTextPluginStatus()==="unavailable"||Pt&&Qr.isParsed())&&(Ne=Vw(it,c,Ie))}if(A){const ot=c.getValueAndResolveTokens("icon-image",Ie,s,N);lt=ot instanceof Yr?ot:Yr.fromString(ot)}if(!Ne&&!lt)continue;const Et=this.sortFeaturesByKey?k.evaluate(Ie,{},s):void 0;if(this.features.push({id:ie,text:Ne,icon:lt,index:ve,sourceLayerIndex:ce,geometry:Ie.geometry,properties:J.properties,type:n1[J.type],sortKey:Et}),lt&&(D[lt.name]=!0),Ne){const ot=f.evaluate(Ie,{},s).join(","),it=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const Pt of Ne.sections)if(Pt.image)D[Pt.image.name]=!0;else{const gt=xu(Ne.toString()),dt=Pt.fontStack||ot,ke=O[dt]=O[dt]||{};this.calculateGlyphDependencies(Pt.text,ke,it,this.allowVerticalPlacement,gt)}}}p.get("symbol-placement")==="line"&&(this.features=function(J){const ie={},ve={},ce=[];let ge=0;function Ie(ot){ce.push(J[ot]),ge++}function Ne(ot,it,Pt){const gt=ve[ot];return delete ve[ot],ve[it]=gt,ce[gt].geometry[0].pop(),ce[gt].geometry[0]=ce[gt].geometry[0].concat(Pt[0]),gt}function lt(ot,it,Pt){const gt=ie[it];return delete ie[it],ie[ot]=gt,ce[gt].geometry[0].shift(),ce[gt].geometry[0]=Pt[0].concat(ce[gt].geometry[0]),gt}function Et(ot,it,Pt){const gt=Pt?it[0][it[0].length-1]:it[0][0];return`${ot}:${gt.x}:${gt.y}`}for(let ot=0;ot<J.length;ot++){const it=J[ot],Pt=it.geometry,gt=it.text?it.text.toString():null;if(!gt){Ie(ot);continue}const dt=Et(gt,Pt),ke=Et(gt,Pt,!0);if(dt in ve&&ke in ie&&ve[dt]!==ie[ke]){const It=lt(dt,ke,Pt),St=Ne(dt,ke,ce[It].geometry);delete ie[dt],delete ve[ke],ve[Et(gt,ce[St].geometry,!0)]=St,ce[It].geometry=null}else dt in ve?Ne(dt,ke,Pt):ke in ie?lt(dt,ke,Pt):(Ie(ot),ie[dt]=ge-1,ve[ke]=ge-1)}return ce.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]);const f={};for(let _=t.segment+1;_<r.length;_++)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:c},_<r.length-1&&(c+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const v=f[_];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,c,p,f,_,v,P,A,k,D){const O=t.indexArray,N=t.layoutVertexArray,q=t.segments.prepareSegment(4*r.length,N,O,this.canOverlap?f.sortKey:void 0),J=this.glyphOffsetArray.length,ie=q.vertexLength,ve=this.allowVerticalPlacement&&_===w.ah.vertical?Math.PI/2:0,ce=f.text&&f.text.sections;for(let ge=0;ge<r.length;ge++){const{tl:Ie,tr:Ne,bl:lt,br:Et,tex:ot,pixelOffsetTL:it,pixelOffsetBR:Pt,minFontScaleX:gt,minFontScaleY:dt,glyphOffset:ke,isSDF:It,sectionIndex:St}=r[ge],Ot=q.vertexLength,xi=ke[1];Sf(N,v.x,v.y,Ie.x,xi+Ie.y,ot.x,ot.y,s,It,it.x,it.y,gt,dt),Sf(N,v.x,v.y,Ne.x,xi+Ne.y,ot.x+ot.w,ot.y,s,It,Pt.x,it.y,gt,dt),Sf(N,v.x,v.y,lt.x,xi+lt.y,ot.x,ot.y+ot.h,s,It,it.x,Pt.y,gt,dt),Sf(N,v.x,v.y,Et.x,xi+Et.y,ot.x+ot.w,ot.y+ot.h,s,It,Pt.x,Pt.y,gt,dt),k_(t.dynamicLayoutVertexArray,v,ve),O.emplaceBack(Ot,Ot+1,Ot+2),O.emplaceBack(Ot+1,Ot+2,Ot+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),ge!==r.length-1&&St===r[ge+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,f,f.index,{},D,ce&&ce[St])}t.placedSymbolArray.emplaceBack(v.x,v.y,J,this.glyphOffsetArray.length-J,ie,P,A,v.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],_,0,!1,0,k)}_addCollisionDebugVertex(t,r,s,c,p,f){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,c,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(t,r,s,c,p,f,_){const v=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),P=v.vertexLength,A=p.layoutVertexArray,k=p.collisionVertexArray,D=_.anchorX,O=_.anchorY;this._addCollisionDebugVertex(A,k,f,D,O,new j(t,r)),this._addCollisionDebugVertex(A,k,f,D,O,new j(s,r)),this._addCollisionDebugVertex(A,k,f,D,O,new j(s,c)),this._addCollisionDebugVertex(A,k,f,D,O,new j(t,c)),v.vertexLength+=4;const N=p.indexArray;N.emplaceBack(P,P+1),N.emplaceBack(P+1,P+2),N.emplaceBack(P+2,P+3),N.emplaceBack(P+3,P),v.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,c){for(let p=t;p<r;p++){const f=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,c?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new z_(pn,kv.members,ur),this.iconCollisionBox=new z_(pn,kv.members,ur);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,c,p,f,_,v,P){const A={};for(let k=r;k<s;k++){const D=t.get(k);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let k=c;k<p;k++){const D=t.get(k);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let k=f;k<_;k++){const D=t.get(k);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let k=v;k<P;k++){const D=t.get(k);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<c;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),c=[],p=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const v=this.symbolInstances.get(_);c.push(0|Math.round(r*v.anchorX+s*v.anchorY)),p.push(v.featureIndex)}return f.sort((_,v)=>c[_]-c[v]||p[v]-p[_]),f}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,p,f)=>{c>=0&&f.indexOf(c)===p&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Xv,Kv;pt("SymbolBucket",zl,{omit:["layers","collisionBoxArray","features","compareText"]}),zl.MAX_GLYPHS=65535,zl.addDynamicAttributes=k_;var D_={get paint(){return Kv=Kv||new d({"icon-opacity":new kt(xe.paint_symbol["icon-opacity"]),"icon-color":new kt(xe.paint_symbol["icon-color"]),"icon-halo-color":new kt(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new kt(xe.paint_symbol["text-opacity"]),"text-color":new kt(xe.paint_symbol["text-color"],{runtimeType:Or,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new kt(xe.paint_symbol["text-halo-color"]),"text-halo-width":new kt(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(xe.paint_symbol["text-halo-blur"]),"text-translate":new bt(xe.paint_symbol["text-translate"]),"text-translate-anchor":new bt(xe.paint_symbol["text-translate-anchor"])})},get layout(){return Xv=Xv||new d({"symbol-placement":new bt(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(xe.layout_symbol["icon-size"]),"icon-text-fit":new bt(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(xe.layout_symbol["icon-image"]),"icon-rotate":new kt(xe.layout_symbol["icon-rotate"]),"icon-padding":new kt(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(xe.layout_symbol["icon-offset"]),"icon-anchor":new kt(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(xe.layout_symbol["text-rotation-alignment"]),"text-field":new kt(xe.layout_symbol["text-field"]),"text-font":new kt(xe.layout_symbol["text-font"]),"text-size":new kt(xe.layout_symbol["text-size"]),"text-max-width":new kt(xe.layout_symbol["text-max-width"]),"text-line-height":new bt(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(xe.layout_symbol["text-letter-spacing"]),"text-justify":new kt(xe.layout_symbol["text-justify"]),"text-radial-offset":new kt(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new kt(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new kt(xe.layout_symbol["text-anchor"]),"text-max-angle":new bt(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(xe.layout_symbol["text-writing-mode"]),"text-rotate":new kt(xe.layout_symbol["text-rotate"]),"text-padding":new bt(xe.layout_symbol["text-padding"]),"text-keep-upright":new bt(xe.layout_symbol["text-keep-upright"]),"text-transform":new kt(xe.layout_symbol["text-transform"]),"text-offset":new kt(xe.layout_symbol["text-offset"]),"text-allow-overlap":new bt(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(xe.layout_symbol["text-ignore-placement"]),"text-optional":new bt(xe.layout_symbol["text-optional"])})}};class Jv{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ts,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt("FormatSectionOverride",Jv,{omit:["defaultValue"]});class Pf extends n{constructor(t){super(t,D_)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const p of s)c.indexOf(p)<0&&c.push(p);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,c){const p=this.layout.get(t).evaluate(r,{},s,c),f=this._unevaluatedLayout._values[t];return f.isDataDriven()||sl(f.value)||!p?p:function(_,v){return v.replace(/{([^{}]+)}/g,(P,A)=>_&&A in _?String(_[A]):"")}(r.properties,p)}createBucket(t){return new zl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of D_.paint.overridableProperties){if(!Pf.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new Jv(r),c=new nl(s,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new ao("source",c):new lo("composite",c,r.value.zoomStops),this.paint._values[t]=new Nn(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Pf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),c=D_.paint.properties[r];let p=!1;const f=_=>{for(const v of _)if(c.overrides&&c.overrides.hasOverride(v))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Kr)f(s.value.value.sections);else if(s.value.kind==="source"){const _=P=>{p||(P instanceof yn&&Yi(P.value)===Zn?f(P.value.sections):P instanceof Ka?f(P.sections):P.eachChild(_))},v=s.value;v._styleExpression&&_(v._styleExpression.expression)}return p}}let Yv;var a1={get paint(){return Yv=Yv||new d({"background-color":new bt(xe.paint_background["background-color"]),"background-pattern":new yl(xe.paint_background["background-pattern"]),"background-opacity":new bt(xe.paint_background["background-opacity"])})}};class l1 extends n{constructor(t){super(t,a1)}}let $v;var c1={get paint(){return $v=$v||new d({"raster-opacity":new bt(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(xe.paint_raster["raster-saturation"]),"raster-contrast":new bt(xe.paint_raster["raster-contrast"]),"raster-resampling":new bt(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(xe.paint_raster["raster-fade-duration"])})}};class u1 extends n{constructor(t){super(t,c1)}}class h1 extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class d1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const R_=63710088e-1;class Ao{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ao(Oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,c=t.lat*r,p=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((t.lng-this.lng)*r);return R_*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof Ao)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ao(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ao(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qv=2*Math.PI*R_;function ex(i){return Qv*Math.cos(i*Math.PI/180)}function tx(i){return(180+i)/360}function ix(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function rx(i,t){return i/ex(t)}function L_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Nu{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Ao.convert(t);return new Nu(tx(s.lng),ix(s.lat),rx(r,s.lat))}toLngLat(){return new Ao(360*this.x-180,L_(this.y))}toAltitude(){return this.z*ex(L_(this.y))}meterInMercatorCoordinateUnits(){return 1/Qv*(t=L_(this.y),1/Math.cos(t*Math.PI/180));var t}}function nx(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class O_{constructor(t,r,s){if(!function(c,p,f){return!(c<0||c>25||f<0||f>=Math.pow(2,c)||p<0||p>=Math.pow(2,c))}(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Vu(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const c=(f=this.y,_=this.z,v=nx(256*(p=this.x),256*(f=Math.pow(2,_)-f-1),_),P=nx(256*(p+1),256*(f+1),_),v[0]+","+v[1]+","+P[0]+","+P[1]);var p,f,_,v,P;const A=function(k,D,O){let N,q="";for(let J=k;J>0;J--)N=1<<J-1,q+=(D&N?1:0)+(O&N?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new j((t.x*r-this.x)*$i,(t.y*r-this.y)*$i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class sx{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Vu(t,r.z,r.z,r.x,r.y)}}class In{constructor(t,r,s,c,p){if(t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new O_(s,+c,+p),this.key=Vu(r,t,s,c,p)}clone(){return new In(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new In(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new In(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Vu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Vu(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new In(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new In(r,this.wrap,r,s,c),new In(r,this.wrap,r,s+1,c),new In(r,this.wrap,r,s,c+1),new In(r,this.wrap,r,s+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new In(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new In(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new sx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Nu(t.x-this.wrap,t.y))}}function Vu(i,t,r,s,c){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*c+s).toString(36)+r.toString(36)+t.toString(36)}pt("CanonicalTileID",O_),pt("OverscaledTileID",In,{omit:["posMatrix"]});class ox{constructor(t,r,s,c=1,p=1,f=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Re(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=p,this.blueFactor=f,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<v;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(v,P)]=this.data[this._idx(v-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,v)]=this.data[this._idx(P,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<v;P++)for(let A=0;A<v;A++){const k=this.get(P,A);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,r){const s=new Uint8Array(this.data.buffer),c=4*this._idx(t,r);return this.unpack(s[c],s[c+1],s[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}getPixels(){return new Tn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,p=r*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:c=p-1;break;case 1:p=c+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const v=-r*this.dim,P=-s*this.dim;for(let A=f;A<_;A++)for(let k=c;k<p;k++)this.data[this._idx(k,A)]=t.data[this._idx(k+v,A+P)]}}pt("DEMData",ox);class ax{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class lx{constructor(t,r,s,c,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=c,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class cx{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new po($i,16,0),this.grid3D=new po($i,16,0),this.featureIndexArray=new Tr,this.promoteId=r}insert(t,r,s,c,p,f){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,p);const v=f?this.grid3D:this.grid;for(let P=0;P<r.length;P++){const A=r[P],k=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const O=A[D];k[0]=Math.min(k[0],O.x),k[1]=Math.min(k[1],O.y),k[2]=Math.max(k[2],O.x),k[3]=Math.max(k[3],O.y)}k[0]<$i&&k[1]<$i&&k[2]>=0&&k[3]>=0&&v.insert(_,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Po.VectorTile(new P_(this.rawTileData)).layers,this.sourceLayerCoder=new ax(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,c){this.loadVTLayers();const p=t.params||{},f=$i/t.tileSize/t.scale,_=su(p.filter),v=t.queryGeometry,P=t.queryPadding*f,A=hx(v),k=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),D=hx(t.cameraQueryGeometry),O=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(J,ie,ve,ce)=>function(ge,Ie,Ne,lt,Et){for(const it of ge)if(Ie<=it.x&&Ne<=it.y&&lt>=it.x&&Et>=it.y)return!0;const ot=[new j(Ie,Ne),new j(Ie,Et),new j(lt,Et),new j(lt,Ne)];if(ge.length>2){for(const it of ot)if(Tl(ge,it))return!0}for(let it=0;it<ge.length-1;it++)if(Wb(ge[it],ge[it+1],ot))return!0;return!1}(t.cameraQueryGeometry,J-P,ie-P,ve+P,ce+P));for(const J of O)k.push(J);k.sort(p1);const N={};let q;for(let J=0;J<k.length;J++){const ie=k[J];if(ie===q)continue;q=ie;const ve=this.featureIndexArray.get(ie);let ce=null;this.loadMatchingFeature(N,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,_,p.layers,p.availableImages,r,s,c,(ge,Ie,Ne)=>(ce||(ce=xa(ge)),Ie.queryIntersectsFeature(v,ge,Ne,ce,this.z,t.transform,f,t.pixelPosMatrix)))}return N}loadMatchingFeature(t,r,s,c,p,f,_,v,P,A,k){const D=this.bucketLayerIDs[r];if(f&&!function(J,ie){for(let ve=0;ve<J.length;ve++)if(ie.indexOf(J[ve])>=0)return!0;return!1}(f,D))return;const O=this.sourceLayerCoder.decode(s),N=this.vtLayers[O].feature(c);if(p.needGeometry){const J=ba(N,!0);if(!p.filter(new Ti(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!p.filter(new Ti(this.tileID.overscaledZ),N))return;const q=this.getId(N,O);for(let J=0;J<D.length;J++){const ie=D[J];if(f&&f.indexOf(ie)<0)continue;const ve=v[ie];if(!ve)continue;let ce={};q&&A&&(ce=A.getState(ve.sourceLayer||"_geojsonTileLayer",q));const ge=Ze({},P[ie]);ge.paint=ux(ge.paint,ve.paint,N,ce,_),ge.layout=ux(ge.layout,ve.layout,N,ce,_);const Ie=!k||k(N,ve,ce);if(!Ie)continue;const Ne=new lx(N,this.z,this.x,this.y,q);Ne.layer=ge;let lt=t[ie];lt===void 0&&(lt=t[ie]=[]),lt.push({featureIndex:c,feature:Ne,intersectionZ:Ie})}}lookupSymbolFeatures(t,r,s,c,p,f,_,v){const P={};this.loadVTLayers();const A=su(p);for(const k of t)this.loadMatchingFeature(P,s,c,k,A,f,_,v,r);return P}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){let s=t.id;return this.promoteId&&(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof s=="boolean"&&(s=Number(s))),s}}function ux(i,t,r,s,c){return We(i,(p,f)=>{const _=t instanceof ga?t.get(f):null;return _&&_.evaluate?_.evaluate(r,s,c):_})}function hx(i){let t=1/0,r=1/0,s=-1/0,c=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),c=Math.max(c,p.y);return{minX:t,minY:r,maxX:s,maxY:c}}function p1(i,t){return t-i}function dx(i,t,r,s,c){const p=[];for(let f=0;f<i.length;f++){const _=i[f];let v;for(let P=0;P<_.length-1;P++){let A=_[P],k=_[P+1];A.x<t&&k.x<t||(A.x<t?A=new j(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<t&&(k=new j(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<r&&k.y<r||(A.y<r?A=new j(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round():k.y<r&&(k=new j(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round()),A.x>=s&&k.x>=s||(A.x>=s?A=new j(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=s&&(k=new j(s,A.y+(s-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=c&&k.y>=c||(A.y>=c?A=new j(A.x+(c-A.y)/(k.y-A.y)*(k.x-A.x),c)._round():k.y>=c&&(k=new j(A.x+(c-A.y)/(k.y-A.y)*(k.x-A.x),c)._round()),v&&A.equals(v[v.length-1])||(v=[A],p.push(v)),v.push(k)))))}}return p}pt("FeatureIndex",cx,{omit:["rawTileData","sourceLayerCoder"]});class Co extends j{constructor(t,r,s,c){super(t,r),this.angle=s,c!==void 0&&(this.segment=c)}clone(){return new Co(this.x,this.y,this.angle,this.segment)}}function px(i,t,r,s,c){if(t.segment===void 0||r===0)return!0;let p=t,f=t.segment+1,_=0;for(;_>-r/2;){if(f--,f<0)return!1;_-=i[f].dist(p),p=i[f]}_+=i[f].dist(i[f+1]),f++;const v=[];let P=0;for(;_<r/2;){const A=i[f],k=i[f+1];if(!k)return!1;let D=i[f-1].angleTo(A)-A.angleTo(k);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:_,angleDelta:D}),P+=D;_-v[0].distance>s;)P-=v.shift().angleDelta;if(P>c)return!1;f++,_+=A.dist(k)}return!0}function fx(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function mx(i,t,r){return i?.6*t*r:0}function gx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function f1(i,t,r,s,c,p){const f=mx(r,c,p),_=gx(r,s)*p;let v=0;const P=fx(i)/2;for(let A=0;A<i.length-1;A++){const k=i[A],D=i[A+1],O=k.dist(D);if(v+O>P){const N=(P-v)/O,q=Fr.number(k.x,D.x,N),J=Fr.number(k.y,D.y,N),ie=new Co(q,J,D.angleTo(k),A);return ie._round(),!f||px(i,ie,_,f,t)?ie:void 0}v+=O}}function m1(i,t,r,s,c,p,f,_,v){const P=mx(s,p,f),A=gx(s,c),k=A*f,D=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return t-k<t/4&&(t=k+t/4),_x(i,D?t/2*_%t:(A/2+2*p)*f*_%t,t,P,r,k,D,!1,v)}function _x(i,t,r,s,c,p,f,_,v){const P=p/2,A=fx(i);let k=0,D=t-r,O=[];for(let N=0;N<i.length-1;N++){const q=i[N],J=i[N+1],ie=q.dist(J),ve=J.angleTo(q);for(;D+r<k+ie;){D+=r;const ce=(D-k)/ie,ge=Fr.number(q.x,J.x,ce),Ie=Fr.number(q.y,J.y,ce);if(ge>=0&&ge<v&&Ie>=0&&Ie<v&&D-P>=0&&D+P<=A){const Ne=new Co(ge,Ie,ve,N);Ne._round(),s&&!px(i,Ne,p,s,c)||O.push(Ne)}}k+=ie}return _||O.length||f||(O=_x(i,k/2,r,s,c,p,f,!0,v)),O}pt("Anchor",Co);const Dl=tn;function yx(i,t,r,s){const c=[],p=i.image,f=p.pixelRatio,_=p.paddedRect.w-2*Dl,v=p.paddedRect.h-2*Dl;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=p.stretchX||[[0,_]],k=p.stretchY||[[0,v]],D=(ke,It)=>ke+It[1]-It[0],O=A.reduce(D,0),N=k.reduce(D,0),q=_-O,J=v-N;let ie=0,ve=O,ce=0,ge=N,Ie=0,Ne=q,lt=0,Et=J;if(p.content&&s){const ke=p.content,It=ke[2]-ke[0],St=ke[3]-ke[1];(p.textFitWidth||p.textFitHeight)&&(P=Gv(i)),ie=Tf(A,0,ke[0]),ce=Tf(k,0,ke[1]),ve=Tf(A,ke[0],ke[2]),ge=Tf(k,ke[1],ke[3]),Ie=ke[0]-ie,lt=ke[1]-ce,Ne=It-ve,Et=St-ge}const ot=P.x1,it=P.y1,Pt=P.x2-ot,gt=P.y2-it,dt=(ke,It,St,Ot)=>{const xi=If(ke.stretch-ie,ve,Pt,ot),_i=Af(ke.fixed-Ie,Ne,ke.stretch,O),nr=If(It.stretch-ce,ge,gt,it),jn=Af(It.fixed-lt,Et,It.stretch,N),br=If(St.stretch-ie,ve,Pt,ot),sr=Af(St.fixed-Ie,Ne,St.stretch,O),jr=If(Ot.stretch-ce,ge,gt,it),Ur=Af(Ot.fixed-lt,Et,Ot.stretch,N),qr=new j(xi,nr),Gi=new j(br,nr),or=new j(br,jr),Ar=new j(xi,jr),wr=new j(_i/f,jn/f),Zr=new j(sr/f,Ur/f),Sr=t*Math.PI/180;if(Sr){const si=Math.sin(Sr),Si=Math.cos(Sr),Ei=[Si,-si,si,Si];qr._matMult(Ei),Gi._matMult(Ei),Ar._matMult(Ei),or._matMult(Ei)}const An=ke.stretch+ke.fixed,rn=It.stretch+It.fixed;return{tl:qr,tr:Gi,bl:Ar,br:or,tex:{x:p.paddedRect.x+Dl+An,y:p.paddedRect.y+Dl+rn,w:St.stretch+St.fixed-An,h:Ot.stretch+Ot.fixed-rn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Zr,minFontScaleX:Ne/f/Pt,minFontScaleY:Et/f/gt,isSDF:r}};if(s&&(p.stretchX||p.stretchY)){const ke=vx(A,q,O),It=vx(k,J,N);for(let St=0;St<ke.length-1;St++){const Ot=ke[St],xi=ke[St+1];for(let _i=0;_i<It.length-1;_i++)c.push(dt(Ot,It[_i],xi,It[_i+1]))}}else c.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:v+1}));return c}function Tf(i,t,r){let s=0;for(const c of i)s+=Math.max(t,Math.min(r,c[1]))-Math.max(t,Math.min(r,c[0]));return s}function vx(i,t,r){const s=[{fixed:-Dl,stretch:0}];for(const[c,p]of i){const f=s[s.length-1];s.push({fixed:c-f.stretch,stretch:f.stretch}),s.push({fixed:c-f.stretch,stretch:f.stretch+(p-c)})}return s.push({fixed:t+Dl,stretch:r}),s}function If(i,t,r,s){return i/t*r+s}function Af(i,t,r,s){return i-t*r/s}class Cf{constructor(t,r,s,c,p,f,_,v,P,A){var k;if(this.boxStartIndex=t.length,P){let D=f.top,O=f.bottom;const N=f.collisionPadding;N&&(D-=N[1],O+=N[3]);let q=O-D;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const D=!((k=f.image)===null||k===void 0)&&k.content&&(f.image.textFitWidth||f.image.textFitHeight)?Gv(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};D.y1=D.y1*_-v[0],D.y2=D.y2*_+v[2],D.x1=D.x1*_-v[3],D.x2=D.x2*_+v[1];const O=f.collisionPadding;if(O&&(D.x1-=O[0]*_,D.y1-=O[1]*_,D.x2+=O[2]*_,D.y2+=O[3]*_),A){const N=new j(D.x1,D.y1),q=new j(D.x2,D.y1),J=new j(D.x1,D.y2),ie=new j(D.x2,D.y2),ve=A*Math.PI/180;N._rotate(ve),q._rotate(ve),J._rotate(ve),ie._rotate(ve),D.x1=Math.min(N.x,q.x,J.x,ie.x),D.x2=Math.max(N.x,q.x,J.x,ie.x),D.y1=Math.min(N.y,q.y,J.y,ie.y),D.y2=Math.max(N.y,q.y,J.y,ie.y)}t.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,s,c,p)}this.boxEndIndex=t.length}}class g1{constructor(t=[],r=(s,c)=>s<c?-1:s>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,c=r[t];for(;t>0;){const p=t-1>>1,f=r[p];if(s(c,f)>=0)break;r[t]=f,t=p}r[t]=c}_down(t){const{data:r,compare:s}=this,c=this.length>>1,p=r[t];for(;t<c;){let f=1+(t<<1);const _=f+1;if(_<this.length&&s(r[_],r[f])<0&&(f=_),s(r[f],p)>=0)break;r[t]=r[f],t=f}r[t]=p}}function _1(i,t=1,r=!1){let s=1/0,c=1/0,p=-1/0,f=-1/0;const _=i[0];for(let O=0;O<_.length;O++){const N=_[O];(!O||N.x<s)&&(s=N.x),(!O||N.y<c)&&(c=N.y),(!O||N.x>p)&&(p=N.x),(!O||N.y>f)&&(f=N.y)}const v=Math.min(p-s,f-c);let P=v/2;const A=new g1([],y1);if(v===0)return new j(s,c);for(let O=s;O<p;O+=v)for(let N=c;N<f;N+=v)A.push(new Rl(O+P,N+P,P,i));let k=function(O){let N=0,q=0,J=0;const ie=O[0];for(let ve=0,ce=ie.length,ge=ce-1;ve<ce;ge=ve++){const Ie=ie[ve],Ne=ie[ge],lt=Ie.x*Ne.y-Ne.x*Ie.y;q+=(Ie.x+Ne.x)*lt,J+=(Ie.y+Ne.y)*lt,N+=3*lt}return new Rl(q/N,J/N,0,O)}(i),D=A.length;for(;A.length;){const O=A.pop();(O.d>k.d||!k.d)&&(k=O,r&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-k.d<=t||(P=O.h/2,A.push(new Rl(O.p.x-P,O.p.y-P,P,i)),A.push(new Rl(O.p.x+P,O.p.y-P,P,i)),A.push(new Rl(O.p.x-P,O.p.y+P,P,i)),A.push(new Rl(O.p.x+P,O.p.y+P,P,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${k.d}`)),k.p}function y1(i,t){return t.max-i.max}function Rl(i,t,r,s){this.p=new j(i,t),this.h=r,this.d=function(c,p){let f=!1,_=1/0;for(let v=0;v<p.length;v++){const P=p[v];for(let A=0,k=P.length,D=k-1;A<k;D=A++){const O=P[A],N=P[D];O.y>c.y!=N.y>c.y&&c.x<(N.x-O.x)*(c.y-O.y)/(N.y-O.y)+O.x&&(f=!f),_=Math.min(_,iv(c,O,N))}}return(f?1:-1)*Math.sqrt(_)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}var xr;w.aq=void 0,(xr=w.aq||(w.aq={}))[xr.center=1]="center",xr[xr.left=2]="left",xr[xr.right=3]="right",xr[xr.top=4]="top",xr[xr.bottom=5]="bottom",xr[xr["top-left"]=6]="top-left",xr[xr["top-right"]=7]="top-right",xr[xr["bottom-left"]=8]="bottom-left",xr[xr["bottom-right"]=9]="bottom-right";const Eo=7,F_=Number.POSITIVE_INFINITY;function xx(i,t){return t[1]!==F_?function(r,s,c){let p=0,f=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":f=c-Eo;break;case"bottom-right":case"bottom-left":case"bottom":f=-c+Eo}switch(r){case"top-right":case"bottom-right":case"right":p=-s;break;case"top-left":case"bottom-left":case"left":p=s}return[p,f]}(i,t[0],t[1]):function(r,s){let c=0,p=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":p=f-Eo;break;case"bottom-right":case"bottom-left":p=-f+Eo;break;case"bottom":p=-s+Eo;break;case"top":p=s-Eo}switch(r){case"top-right":case"bottom-right":c=-f;break;case"top-left":case"bottom-left":c=f;break;case"left":c=s;break;case"right":c=-s}return[c,p]}(i,t[0])}function bx(i,t,r){var s;const c=i.layout,p=(s=c.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(p){const _=p.values,v=[];for(let P=0;P<_.length;P+=2){const A=v[P]=_[P],k=_[P+1].map(D=>D*tr);A.startsWith("top")?k[1]-=Eo:A.startsWith("bottom")&&(k[1]+=Eo),v[P+1]=k}return new an(v)}const f=c.get("text-variable-anchor");if(f){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},r)*tr,F_]:c.get("text-offset").evaluate(t,{},r).map(P=>P*tr);const v=[];for(const P of f)v.push(P,xx(P,_));return new an(v)}return null}function B_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function v1(i,t,r,s,c,p,f,_,v,P,A){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=f);const D=i.layers[0].layout,O=D.get("icon-offset").evaluate(t,{},A),N=Sx(r.horizontal),q=f/24,J=i.tilePixelRatio*q,ie=i.tilePixelRatio*k/24,ve=i.tilePixelRatio*_,ce=i.tilePixelRatio*D.get("symbol-spacing"),ge=D.get("text-padding")*i.tilePixelRatio,Ie=function(ke,It,St,Ot=1){const xi=ke.get("icon-padding").evaluate(It,{},St),_i=xi&&xi.values;return[_i[0]*Ot,_i[1]*Ot,_i[2]*Ot,_i[3]*Ot]}(D,t,A,i.tilePixelRatio),Ne=D.get("text-max-angle")/180*Math.PI,lt=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Et=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ot=D.get("symbol-placement"),it=ce/2,Pt=D.get("icon-text-fit");let gt;s&&Pt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(gt=Wv(s,r.vertical,Pt,D.get("icon-text-fit-padding"),O,q)),N&&(s=Wv(s,N,Pt,D.get("icon-text-fit-padding"),O,q)));const dt=(ke,It)=>{It.x<0||It.x>=$i||It.y<0||It.y>=$i||function(St,Ot,xi,_i,nr,jn,br,sr,jr,Ur,qr,Gi,or,Ar,wr,Zr,Sr,An,rn,si,Si,Ei,fn,Ni,Ll){const ls=St.addToLineVertexArray(Ot,xi);let cs,Un,Cn,hr,Os=0,qu=0,Ax=0,Cx=0,W_=-1,H_=-1;const Fs={};let Ex=bl("");if(St.allowVerticalPlacement&&_i.vertical){const Cr=sr.layout.get("text-rotate").evaluate(Si,{},Ni)+90;Cn=new Cf(jr,Ot,Ur,qr,Gi,_i.vertical,or,Ar,wr,Cr),br&&(hr=new Cf(jr,Ot,Ur,qr,Gi,br,Sr,An,wr,Cr))}if(nr){const Cr=sr.layout.get("icon-rotate").evaluate(Si,{}),En=sr.layout.get("icon-text-fit")!=="none",Sa=yx(nr,Cr,fn,En),Kn=br?yx(br,Cr,fn,En):void 0;Un=new Cf(jr,Ot,Ur,qr,Gi,nr,Sr,An,!1,Cr),Os=4*Sa.length;const Pa=St.iconSizeData;let us=null;Pa.kind==="source"?(us=[as*sr.layout.get("icon-size").evaluate(Si,{})],us[0]>Io&&Re(`${St.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(us=[as*Ei.compositeIconSizes[0].evaluate(Si,{},Ni),as*Ei.compositeIconSizes[1].evaluate(Si,{},Ni)],(us[0]>Io||us[1]>Io)&&Re(`${St.layerIds[0]}: Value for "icon-size" is >= ${Bu}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Sa,us,si,rn,Si,w.ah.none,Ot,ls.lineStartIndex,ls.lineLength,-1,Ni),W_=St.icon.placedSymbolArray.length-1,Kn&&(qu=4*Kn.length,St.addSymbols(St.icon,Kn,us,si,rn,Si,w.ah.vertical,Ot,ls.lineStartIndex,ls.lineLength,-1,Ni),H_=St.icon.placedSymbolArray.length-1)}const kx=Object.keys(_i.horizontal);for(const Cr of kx){const En=_i.horizontal[Cr];if(!cs){Ex=bl(En.text);const Kn=sr.layout.get("text-rotate").evaluate(Si,{},Ni);cs=new Cf(jr,Ot,Ur,qr,Gi,En,or,Ar,wr,Kn)}const Sa=En.positionedLines.length===1;if(Ax+=wx(St,Ot,En,jn,sr,wr,Si,Zr,ls,_i.vertical?w.ah.horizontal:w.ah.horizontalOnly,Sa?kx:[Cr],Fs,W_,Ei,Ni),Sa)break}_i.vertical&&(Cx+=wx(St,Ot,_i.vertical,jn,sr,wr,Si,Zr,ls,w.ah.vertical,["vertical"],Fs,H_,Ei,Ni));const w1=cs?cs.boxStartIndex:St.collisionBoxArray.length,S1=cs?cs.boxEndIndex:St.collisionBoxArray.length,P1=Cn?Cn.boxStartIndex:St.collisionBoxArray.length,T1=Cn?Cn.boxEndIndex:St.collisionBoxArray.length,I1=Un?Un.boxStartIndex:St.collisionBoxArray.length,A1=Un?Un.boxEndIndex:St.collisionBoxArray.length,C1=hr?hr.boxStartIndex:St.collisionBoxArray.length,E1=hr?hr.boxEndIndex:St.collisionBoxArray.length;let Xn=-1;const kf=(Cr,En)=>Cr&&Cr.circleDiameter?Math.max(Cr.circleDiameter,En):En;Xn=kf(cs,Xn),Xn=kf(Cn,Xn),Xn=kf(Un,Xn),Xn=kf(hr,Xn);const Mx=Xn>-1?1:0;Mx&&(Xn*=Ll/tr),St.glyphOffsetArray.length>=zl.MAX_GLYPHS&&Re("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Si.sortKey);const k1=bx(sr,Si,Ni),[M1,z1]=function(Cr,En){const Sa=Cr.length,Kn=En==null?void 0:En.values;if((Kn==null?void 0:Kn.length)>0)for(let Pa=0;Pa<Kn.length;Pa+=2){const us=Kn[Pa+1];Cr.emplaceBack(w.aq[Kn[Pa]],us[0],us[1])}return[Sa,Cr.length]}(St.textAnchorOffsets,k1);St.symbolInstances.emplaceBack(Ot.x,Ot.y,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical||-1,W_,H_,Ex,w1,S1,P1,T1,I1,A1,C1,E1,Ur,Ax,Cx,Os,qu,Mx,0,or,Xn,M1,z1)}(i,It,ke,r,s,c,gt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,J,[ge,ge,ge,ge],lt,v,ve,Ie,Et,O,t,p,P,A,f)};if(ot==="line")for(const ke of dx(t.geometry,0,0,$i,$i)){const It=m1(ke,ce,Ne,r.vertical||N,s,24,ie,i.overscaling,$i);for(const St of It)N&&x1(i,N.text,it,St)||dt(ke,St)}else if(ot==="line-center"){for(const ke of t.geometry)if(ke.length>1){const It=f1(ke,Ne,r.vertical||N,s,24,ie);It&&dt(ke,It)}}else if(t.type==="Polygon")for(const ke of Ya(t.geometry,0)){const It=_1(ke,16);dt(ke[0],new Co(It.x,It.y,0))}else if(t.type==="LineString")for(const ke of t.geometry)dt(ke,new Co(ke[0].x,ke[0].y,0));else if(t.type==="Point")for(const ke of t.geometry)for(const It of ke)dt([It],new Co(It.x,It.y,0))}function wx(i,t,r,s,c,p,f,_,v,P,A,k,D,O,N){const q=function(ve,ce,ge,Ie,Ne,lt,Et,ot){const it=Ie.layout.get("text-rotate").evaluate(lt,{})*Math.PI/180,Pt=[];for(const gt of ce.positionedLines)for(const dt of gt.positionedGlyphs){if(!dt.rect)continue;const ke=dt.rect||{};let It=Bv+1,St=!0,Ot=1,xi=0;const _i=(Ne||ot)&&dt.vertical,nr=dt.metrics.advance*dt.scale/2;if(ot&&ce.verticalizable&&(xi=gt.lineOffset/2-(dt.imageName?-(tr-dt.metrics.width*dt.scale)/2:(dt.scale-1)*tr)),dt.imageName){const si=Et[dt.imageName];St=si.sdf,Ot=si.pixelRatio,It=tn/Ot}const jn=Ne?[dt.x+nr,dt.y]:[0,0];let br=Ne?[0,0]:[dt.x+nr+ge[0],dt.y+ge[1]-xi],sr=[0,0];_i&&(sr=br,br=[0,0]);const jr=dt.metrics.isDoubleResolution?2:1,Ur=(dt.metrics.left-It)*dt.scale-nr+br[0],qr=(-dt.metrics.top-It)*dt.scale+br[1],Gi=Ur+ke.w/jr*dt.scale/Ot,or=qr+ke.h/jr*dt.scale/Ot,Ar=new j(Ur,qr),wr=new j(Gi,qr),Zr=new j(Ur,or),Sr=new j(Gi,or);if(_i){const si=new j(-nr,nr-Ou),Si=-Math.PI/2,Ei=tr/2-nr,fn=new j(5-Ou-Ei,-(dt.imageName?Ei:0)),Ni=new j(...sr);Ar._rotateAround(Si,si)._add(fn)._add(Ni),wr._rotateAround(Si,si)._add(fn)._add(Ni),Zr._rotateAround(Si,si)._add(fn)._add(Ni),Sr._rotateAround(Si,si)._add(fn)._add(Ni)}if(it){const si=Math.sin(it),Si=Math.cos(it),Ei=[Si,-si,si,Si];Ar._matMult(Ei),wr._matMult(Ei),Zr._matMult(Ei),Sr._matMult(Ei)}const An=new j(0,0),rn=new j(0,0);Pt.push({tl:Ar,tr:wr,bl:Zr,br:Sr,tex:ke,writingMode:ce.writingMode,glyphOffset:jn,sectionIndex:dt.sectionIndex,isSDF:St,pixelOffsetTL:An,pixelOffsetBR:rn,minFontScaleX:0,minFontScaleY:0})}return Pt}(0,r,_,c,p,f,s,i.allowVerticalPlacement),J=i.textSizeData;let ie=null;J.kind==="source"?(ie=[as*c.layout.get("text-size").evaluate(f,{})],ie[0]>Io&&Re(`${i.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)):J.kind==="composite"&&(ie=[as*O.compositeTextSizes[0].evaluate(f,{},N),as*O.compositeTextSizes[1].evaluate(f,{},N)],(ie[0]>Io||ie[1]>Io)&&Re(`${i.layerIds[0]}: Value for "text-size" is >= ${Bu}. Reduce your "text-size".`)),i.addSymbols(i.text,q,ie,_,p,f,P,t,v.lineStartIndex,v.lineLength,D,N);for(const ve of A)k[ve]=i.text.placedSymbolArray.length-1;return 4*q.length}function Sx(i){for(const t in i)return i[t];return null}function x1(i,t,r,s){const c=i.compareText;if(t in c){const p=c[t];for(let f=p.length-1;f>=0;f--)if(s.dist(p[f])<r)return!0}else c[t]=[];return c[t].push(s),!1}const Px=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class N_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const p=Px[15&s];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new N_(_,f,p,t)}constructor(t,r=64,s=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=Px.indexOf(this.ArrayType),f=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-_%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+v,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+v),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+v,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return V_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:_}=this,v=[0,p.length-1,0],P=[];for(;v.length;){const A=v.pop()||0,k=v.pop()||0,D=v.pop()||0;if(k-D<=_){for(let J=D;J<=k;J++){const ie=f[2*J],ve=f[2*J+1];ie>=t&&ie<=s&&ve>=r&&ve<=c&&P.push(p[J])}continue}const O=D+k>>1,N=f[2*O],q=f[2*O+1];N>=t&&N<=s&&q>=r&&q<=c&&P.push(p[O]),(A===0?t<=N:r<=q)&&(v.push(D),v.push(O-1),v.push(1-A)),(A===0?s>=N:c>=q)&&(v.push(O+1),v.push(k),v.push(1-A))}return P}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:p,nodeSize:f}=this,_=[0,c.length-1,0],v=[],P=s*s;for(;_.length;){const A=_.pop()||0,k=_.pop()||0,D=_.pop()||0;if(k-D<=f){for(let J=D;J<=k;J++)Ix(p[2*J],p[2*J+1],t,r)<=P&&v.push(c[J]);continue}const O=D+k>>1,N=p[2*O],q=p[2*O+1];Ix(N,q,t,r)<=P&&v.push(c[O]),(A===0?t-s<=N:r-s<=q)&&(_.push(D),_.push(O-1),_.push(1-A)),(A===0?t+s>=N:r+s>=q)&&(_.push(O+1),_.push(k),_.push(1-A))}return v}}function V_(i,t,r,s,c,p){if(c-s<=r)return;const f=s+c>>1;Tx(i,t,f,s,c,p),V_(i,t,r,s,f-1,1-p),V_(i,t,r,f+1,c,1-p)}function Tx(i,t,r,s,c,p){for(;c>s;){if(c-s>600){const P=c-s+1,A=r-s+1,k=Math.log(P),D=.5*Math.exp(2*k/3),O=.5*Math.sqrt(k*D*(P-D)/P)*(A-P/2<0?-1:1);Tx(i,t,r,Math.max(s,Math.floor(r-A*D/P+O)),Math.min(c,Math.floor(r+(P-A)*D/P+O)),p)}const f=t[2*r+p];let _=s,v=c;for(ju(i,t,s,r),t[2*c+p]>f&&ju(i,t,s,c);_<v;){for(ju(i,t,_,v),_++,v--;t[2*_+p]<f;)_++;for(;t[2*v+p]>f;)v--}t[2*s+p]===f?ju(i,t,s,v):(v++,ju(i,t,v,c)),v<=r&&(s=v+1),r<=v&&(c=v-1)}}function ju(i,t,r,s){j_(i,r,s),j_(t,2*r,2*s),j_(t,2*r+1,2*s+1)}function j_(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function Ix(i,t,r,s){const c=i-r,p=t-s;return c*c+p*p}var U_;w.bg=void 0,(U_=w.bg||(w.bg={})).create="create",U_.load="load",U_.fullLoad="fullLoad";let Ef=null,Uu=[];const q_=1e3/60,Z_="loadTime",G_="fullLoadTime",b1={mark(i){performance.mark(i)},frame(i){const t=i;Ef!=null&&Uu.push(t-Ef),Ef=t},clearMetrics(){Ef=null,Uu=[],performance.clearMeasures(Z_),performance.clearMeasures(G_);for(const i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(Z_,w.bg.create,w.bg.load),performance.measure(G_,w.bg.create,w.bg.fullLoad);const i=performance.getEntriesByName(Z_)[0].duration,t=performance.getEntriesByName(G_)[0].duration,r=Uu.length,s=1/(Uu.reduce((p,f)=>p+f,0)/r/1e3),c=Uu.filter(p=>p>q_).reduce((p,f)=>p+(f-q_)/q_,0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};w.$=class extends M{},w.A=Il,w.B=Qg,w.C=function(i){if(rt==null){const t=i.navigator?i.navigator.userAgent:null;rt=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return rt},w.D=bt,w.E=Nt,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new d1(()=>this.process()),this.subscription=function(r,s,c,p){return r.addEventListener(s,c,!1),{unsubscribe:()=>{r.removeEventListener(s,c,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Ke(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,s)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:r,reject:s},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const _={id:c,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const p=[],f=Object.assign(Object.assign({},i),{id:c,sourceMapId:this.mapId,origin:location.origin,data:fo(i.data,p)});this.target.postMessage(f,{transfer:p})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Ke(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[i];return delete this.resolveRejects[i],c?void(t.error?c.reject(mo(t.error)):c.resolve(mo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=mo(t.data),s=new AbortController;this.abortControllers[i]=s;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,c)}catch(c){this.completeTask(i,c)}})}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const c={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?fo(t):null,data:fo(r,s)};this.target.postMessage(c,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=Ui,w.H=function(){var i=new Il(16);return Il!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=I_,w.J=function(i,t,r){var s,c,p,f,_,v,P,A,k,D,O,N,q=r[0],J=r[1],ie=r[2];return t===i?(i[12]=t[0]*q+t[4]*J+t[8]*ie+t[12],i[13]=t[1]*q+t[5]*J+t[9]*ie+t[13],i[14]=t[2]*q+t[6]*J+t[10]*ie+t[14],i[15]=t[3]*q+t[7]*J+t[11]*ie+t[15]):(c=t[1],p=t[2],f=t[3],_=t[4],v=t[5],P=t[6],A=t[7],k=t[8],D=t[9],O=t[10],N=t[11],i[0]=s=t[0],i[1]=c,i[2]=p,i[3]=f,i[4]=_,i[5]=v,i[6]=P,i[7]=A,i[8]=k,i[9]=D,i[10]=O,i[11]=N,i[12]=s*q+_*J+k*ie+t[12],i[13]=c*q+v*J+D*ie+t[13],i[14]=p*q+P*J+O*ie+t[14],i[15]=f*q+A*J+N*ie+t[15]),i},w.K=function(i,t,r){var s=r[0],c=r[1],p=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*c,i[5]=t[5]*c,i[6]=t[6]*c,i[7]=t[7]*c,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=ov,w.M=function(i,t){const r={};for(let s=0;s<t.length;s++){const c=t[s];c in i&&(r[c]=i[c])}return r},w.N=Ao,w.O=tx,w.P=j,w.Q=ix,w.R=Tn,w.S=In,w.T=gl,w.U=Pe,w.V=_e,w.W=ht,w.X=$i,w.Y=y,w.Z=Nu,w._=u,w.a=hi,w.a$=function(i,t){var r=i[0],s=i[1],c=i[2],p=i[3],f=i[4],_=i[5],v=i[6],P=i[7],A=i[8],k=i[9],D=i[10],O=i[11],N=i[12],q=i[13],J=i[14],ie=i[15],ve=t[0],ce=t[1],ge=t[2],Ie=t[3],Ne=t[4],lt=t[5],Et=t[6],ot=t[7],it=t[8],Pt=t[9],gt=t[10],dt=t[11],ke=t[12],It=t[13],St=t[14],Ot=t[15];return Math.abs(r-ve)<=Vr*Math.max(1,Math.abs(r),Math.abs(ve))&&Math.abs(s-ce)<=Vr*Math.max(1,Math.abs(s),Math.abs(ce))&&Math.abs(c-ge)<=Vr*Math.max(1,Math.abs(c),Math.abs(ge))&&Math.abs(p-Ie)<=Vr*Math.max(1,Math.abs(p),Math.abs(Ie))&&Math.abs(f-Ne)<=Vr*Math.max(1,Math.abs(f),Math.abs(Ne))&&Math.abs(_-lt)<=Vr*Math.max(1,Math.abs(_),Math.abs(lt))&&Math.abs(v-Et)<=Vr*Math.max(1,Math.abs(v),Math.abs(Et))&&Math.abs(P-ot)<=Vr*Math.max(1,Math.abs(P),Math.abs(ot))&&Math.abs(A-it)<=Vr*Math.max(1,Math.abs(A),Math.abs(it))&&Math.abs(k-Pt)<=Vr*Math.max(1,Math.abs(k),Math.abs(Pt))&&Math.abs(D-gt)<=Vr*Math.max(1,Math.abs(D),Math.abs(gt))&&Math.abs(O-dt)<=Vr*Math.max(1,Math.abs(O),Math.abs(dt))&&Math.abs(N-ke)<=Vr*Math.max(1,Math.abs(N),Math.abs(ke))&&Math.abs(q-It)<=Vr*Math.max(1,Math.abs(q),Math.abs(It))&&Math.abs(J-St)<=Vr*Math.max(1,Math.abs(J),Math.abs(St))&&Math.abs(ie-Ot)<=Vr*Math.max(1,Math.abs(ie),Math.abs(Ot))},w.a0=Qt,w.a1=O_,w.a2=He,w.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const s of i){const c=window.document.createElement("source");Wr(s)||(t.crossOrigin="Anonymous"),c.src=s,t.appendChild(c)}})},w.a4=function(){return ft++},w.a5=at,w.a6=zl,w.a7=su,w.a8=ba,w.a9=lx,w.aA=function(i){if(i.type==="custom")return new h1(i);switch(i.type){case"background":return new l1(i);case"circle":return new Kb(i);case"fill":return new dw(i);case"fill-extrusion":return new Aw(i);case"heatmap":return new Yb(i);case"hillshade":return new Qb(i);case"line":return new Lw(i);case"raster":return new u1(i);case"symbol":return new Pf(i)}},w.aB=st,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Xt(i.version,t.version))return[{command:"setStyle",args:[t]}];Xt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Xt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Xt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Xt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Xt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Xt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Xt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Xt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Xt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Xt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Xt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},c=[];(function(f,_,v,P){let A;for(A in _=_||{},f=f||{})Object.prototype.hasOwnProperty.call(f,A)&&(Object.prototype.hasOwnProperty.call(_,A)||Xr(A,v,P));for(A in _)Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(f,A)?Xt(f[A],_[A])||(f[A].type==="geojson"&&_[A].type==="geojson"&&Dn(f,_,A)?ui(v,{command:"setGeoJSONSourceData",args:[A,_[A].data]}):Rr(A,_,v,P)):gn(A,_,v))})(i.sources,t.sources,c,s);const p=[];i.layers&&i.layers.forEach(f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):p.push(f)}),r=r.concat(c),function(f,_,v){_=_||[];const P=(f=f||[]).map(Xs),A=_.map(Xs),k=f.reduce(es,{}),D=_.reduce(es,{}),O=P.slice(),N=Object.create(null);let q,J,ie,ve,ce;for(let ge=0,Ie=0;ge<P.length;ge++)q=P[ge],Object.prototype.hasOwnProperty.call(D,q)?Ie++:(ui(v,{command:"removeLayer",args:[q]}),O.splice(O.indexOf(q,Ie),1));for(let ge=0,Ie=0;ge<A.length;ge++)q=A[A.length-1-ge],O[O.length-1-ge]!==q&&(Object.prototype.hasOwnProperty.call(k,q)?(ui(v,{command:"removeLayer",args:[q]}),O.splice(O.lastIndexOf(q,O.length-Ie),1)):Ie++,ve=O[O.length-ge],ui(v,{command:"addLayer",args:[D[q],ve]}),O.splice(O.length-ge,0,q),N[q]=!0);for(let ge=0;ge<A.length;ge++)if(q=A[ge],J=k[q],ie=D[q],!N[q]&&!Xt(J,ie))if(Xt(J.source,ie.source)&&Xt(J["source-layer"],ie["source-layer"])&&Xt(J.type,ie.type)){for(ce in Lr(J.layout,ie.layout,v,q,null,"setLayoutProperty"),Lr(J.paint,ie.paint,v,q,null,"setPaintProperty"),Xt(J.filter,ie.filter)||ui(v,{command:"setFilter",args:[q,ie.filter]}),Xt(J.minzoom,ie.minzoom)&&Xt(J.maxzoom,ie.maxzoom)||ui(v,{command:"setLayerZoomRange",args:[q,ie.minzoom,ie.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?Lr(J[ce],ie[ce],v,q,ce.slice(6),"setPaintProperty"):Xt(J[ce],ie[ce])||ui(v,{command:"setLayerProperty",args:[q,ce,ie[ce]]}));for(ce in ie)Object.prototype.hasOwnProperty.call(ie,ce)&&!Object.prototype.hasOwnProperty.call(J,ce)&&ce!=="layout"&&ce!=="paint"&&ce!=="filter"&&ce!=="metadata"&&ce!=="minzoom"&&ce!=="maxzoom"&&(ce.indexOf("paint.")===0?Lr(J[ce],ie[ce],v,q,ce.slice(6),"setPaintProperty"):Xt(J[ce],ie[ce])||ui(v,{command:"setLayerProperty",args:[q,ce,ie[ce]]}))}else ui(v,{command:"removeLayer",args:[q]}),ve=O[O.lastIndexOf(q)+1],ui(v,{command:"addLayer",args:[ie,ve]})}(p,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},w.aF=We,w.aG=mt,w.aH=class extends ya{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=hf,w.aJ=class extends ya{constructor(i,t){super(i,t),this.current=jb}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=Ky,w.aL=Jy,w.aM=pi,w.aN=class extends ya{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends ya{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,s,c,p,f){var _=1/(t-r),v=1/(s-c),P=1/(p-f);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+r)*_,i[13]=(c+s)*v,i[14]=(f+p)*P,i[15]=1,i},w.aQ=Xb,w.aR=class extends de{},w.aS=Nw,w.aT=class extends be{},w.aU=f_,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=hv,w.aX=yr,w.aY=Pn,w.aZ=class extends wt{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,p)=>{const f=c||p;return t[s]=!f||f.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},w.ac=De,w.ad=function(i,t,r){var s=Math.sin(r),c=Math.cos(r),p=t[0],f=t[1],_=t[2],v=t[3],P=t[4],A=t[5],k=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*c+P*s,i[1]=f*c+A*s,i[2]=_*c+k*s,i[3]=v*c+D*s,i[4]=P*c-p*s,i[5]=A*c-f*s,i[6]=k*c-_*s,i[7]=D*c-v*s,i},w.ae=function(i){var t=new Il(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=mf,w.ag=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:p,maxZoom:f}=i,_=c?De(Br.interpolationFactor(c,t,p,f),0,1):0;i.kind==="camera"?s=Fr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:s}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:c}){return i.kind==="source"?s/as:i.kind==="composite"?Fr.number(s/as,c/as,r):t},w.aj=k_,w.ak=function(i,t,r,s){const c=t.y-i.y,p=t.x-i.x,f=s.y-r.y,_=s.x-r.x,v=f*p-_*c;if(v===0)return null;const P=(_*(i.y-r.y)-f*(i.x-r.x))/v;return new j(i.x+P*p,i.y+P*c)},w.al=dx,w.am=ev,w.an=h_,w.ao=function(i){let t=1/0,r=1/0,s=-1/0,c=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),c=Math.max(c,p.y);return[t,r,s,c]},w.ap=tr,w.ar=E_,w.as=function(i,t){var r=t[0],s=t[1],c=t[2],p=t[3],f=t[4],_=t[5],v=t[6],P=t[7],A=t[8],k=t[9],D=t[10],O=t[11],N=t[12],q=t[13],J=t[14],ie=t[15],ve=r*_-s*f,ce=r*v-c*f,ge=r*P-p*f,Ie=s*v-c*_,Ne=s*P-p*_,lt=c*P-p*v,Et=A*q-k*N,ot=A*J-D*N,it=A*ie-O*N,Pt=k*J-D*q,gt=k*ie-O*q,dt=D*ie-O*J,ke=ve*dt-ce*gt+ge*Pt+Ie*it-Ne*ot+lt*Et;return ke?(i[0]=(_*dt-v*gt+P*Pt)*(ke=1/ke),i[1]=(c*gt-s*dt-p*Pt)*ke,i[2]=(q*lt-J*Ne+ie*Ie)*ke,i[3]=(D*Ne-k*lt-O*Ie)*ke,i[4]=(v*it-f*dt-P*ot)*ke,i[5]=(r*dt-c*it+p*ot)*ke,i[6]=(J*ge-N*lt-ie*ce)*ke,i[7]=(A*lt-D*ge+O*ce)*ke,i[8]=(f*gt-_*it+P*Et)*ke,i[9]=(s*it-r*gt-p*Et)*ke,i[10]=(N*Ne-q*ge+ie*ve)*ke,i[11]=(k*ge-A*Ne-O*ve)*ke,i[12]=(_*ot-f*Pt-v*Et)*ke,i[13]=(r*Pt-s*ot+c*Et)*ke,i[14]=(q*ce-N*Ie-J*ve)*ke,i[15]=(A*Ie-k*ce+D*ve)*ke,i):null},w.at=B_,w.au=C_,w.av=N_,w.aw=function(){const i={},t=xe.$version;for(const r in xe.$root){const s=xe.$root[r];if(s.required){let c=null;c=r==="version"?t:s.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},w.ax=vu,w.ay=er,w.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=sn(i[r],t[i[r].ref]));return i},w.b=_t,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=Oe,w.b4=sx,w.b5=rx,w.b6=function(i,t,r,s,c){var p,f=1/Math.tan(t/2);return i[0]=f/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=f,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+s)*(p=1/(s-c)),i[14]=2*c*s*p):(i[10]=-1,i[14]=-2*s),i},w.b7=function(i,t,r){var s=Math.sin(r),c=Math.cos(r),p=t[4],f=t[5],_=t[6],v=t[7],P=t[8],A=t[9],k=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*c+P*s,i[5]=f*c+A*s,i[6]=_*c+k*s,i[7]=v*c+D*s,i[8]=P*c-p*s,i[9]=A*c-f*s,i[10]=k*c-_*s,i[11]=D*c-v*s,i},w.b8=Ee,w.b9=Be,w.bA=Mv,w.bB=function(i){return i.message===qt},w.bC=oo,w.bD=Qr,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){const{x:r,y:s}=Nu.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends C{},w.be=R_,w.bf=b1,w.bh=Di,w.bi=function(i,t){hi.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete hi.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){const r={};for(let c=0;c<i.length;c++){const p=t&&t[i[c].id]||$p(i[c]);t&&(t[i[c].id]=p);let f=r[p];f||(f=r[p]=[]),f.push(i[c])}const s=[];for(const c in r)s.push(r[c]);return s},w.bl=pt,w.bm=ax,w.bn=cx,w.bo=Vv,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=$i/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,c={layoutIconSize:s["icon-size"].possiblyEvaluate(new Ti(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new Ti(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new Ti(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new Ti(P),i.canonical),s["text-size"].possiblyEvaluate(new Ti(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new Ti(P),i.canonical),s["icon-size"].possiblyEvaluate(new Ti(A),i.canonical)]}const p=r.get("text-line-height")*tr,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),v=r.get("text-size");for(const P of i.bucket.features){const A=r.get("text-font").evaluate(P,{},i.canonical).join(","),k=v.evaluate(P,{},i.canonical),D=c.layoutTextSize.evaluate(P,{},i.canonical),O=c.layoutIconSize.evaluate(P,{},i.canonical),N={horizontal:{},vertical:void 0},q=P.text;let J,ie=[0,0];if(q){const ge=q.toString(),Ie=r.get("text-letter-spacing").evaluate(P,{},i.canonical)*tr,Ne=e_(ge)?Ie:0,lt=r.get("text-anchor").evaluate(P,{},i.canonical),Et=bx(t,P,i.canonical);if(!Et){const gt=r.get("text-radial-offset").evaluate(P,{},i.canonical);ie=gt?xx(lt,[gt*tr,F_]):r.get("text-offset").evaluate(P,{},i.canonical).map(dt=>dt*tr)}let ot=f?"center":r.get("text-justify").evaluate(P,{},i.canonical);const it=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(P,{},i.canonical)*tr:1/0,Pt=()=>{i.bucket.allowVerticalPlacement&&xu(ge)&&(N.vertical=bf(q,i.glyphMap,i.glyphPositions,i.imagePositions,A,it,p,lt,"left",Ne,ie,w.ah.vertical,!0,D,k))};if(!f&&Et){const gt=new Set;if(ot==="auto")for(let ke=0;ke<Et.values.length;ke+=2)gt.add(B_(Et.values[ke]));else gt.add(ot);let dt=!1;for(const ke of gt)if(!N.horizontal[ke])if(dt)N.horizontal[ke]=N.horizontal[0];else{const It=bf(q,i.glyphMap,i.glyphPositions,i.imagePositions,A,it,p,"center",ke,Ne,ie,w.ah.horizontal,!1,D,k);It&&(N.horizontal[ke]=It,dt=It.positionedLines.length===1)}Pt()}else{ot==="auto"&&(ot=B_(lt));const gt=bf(q,i.glyphMap,i.glyphPositions,i.imagePositions,A,it,p,lt,ot,Ne,ie,w.ah.horizontal,!1,D,k);gt&&(N.horizontal[ot]=gt),Pt(),xu(ge)&&f&&_&&(N.vertical=bf(q,i.glyphMap,i.glyphPositions,i.imagePositions,A,it,p,lt,ot,Ne,ie,w.ah.vertical,!1,D,k))}}let ve=!1;if(P.icon&&P.icon.name){const ge=i.imageMap[P.icon.name];ge&&(J=r1(i.imagePositions[P.icon.name],r.get("icon-offset").evaluate(P,{},i.canonical),r.get("icon-anchor").evaluate(P,{},i.canonical)),ve=!!ge.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ve:i.bucket.sdfIcons!==ve&&Re("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ge.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ce=Sx(N.horizontal)||N.vertical;i.bucket.iconsInText=!!ce&&ce.iconsInText,(ce||J)&&v1(i.bucket,P,N,J,i.imageMap,c,D,O,ie,ve,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=w_,w.br=v_,w.bs=b_,w.bt=Po,w.bu=P_,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,s,c){return u(this,void 0,void 0,function*(){if(_e())try{return yield ht(i,t,r,s,c)}catch{}return function(p,f,_,v,P){const A=p.width,k=p.height;xt&&Dt||(xt=new OffscreenCanvas(A,k),Dt=xt.getContext("2d",{willReadFrequently:!0})),xt.width=A,xt.height=k,Dt.drawImage(p,0,0,A,k);const D=Dt.getImageData(f,_,v,P);return Dt.clearRect(0,0,A,k),D.data}(i,t,r,s,c)})},w.bx=ox,w.by=U,w.bz=W,w.c=vi,w.d=i=>u(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=Ze,w.f=i=>new Promise((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame(()=>{s.src=yt})},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(c):yt}),w.g=Li,w.h=(i,t)=>ar(Ze(i,{type:"json"}),t),w.i=Ke,w.j=vt,w.k=Dr,w.l=(i,t)=>ar(Ze(i,{type:"arrayBuffer"}),t),w.m=ar,w.n=function(i){return new P_(i).readFields(Jw,[])},w.o=Eu,w.p=Nv,w.q=d,w.r=$g,w.s=Wr,w.t=_u,w.u=zs,w.v=xe,w.w=Re,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=Fr,w.z=Ti}),I("worker",["./shared"],function(w){class u{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,R){for(const Y of L){this._layerConfigs[Y.id]=Y;const he=this._layers[Y.id]=w.aA(Y);he._featureFilter=w.a7(he.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const G=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const Y of G){const he=Y.map(Se=>this._layers[Se.id]),pe=he[0];if(pe.visibility==="none")continue;const ye=pe.source||"";let oe=this.familiesBySource[ye];oe||(oe=this.familiesBySource[ye]={});const Ce=pe.sourceLayer||"_geojsonTileLayer";let Le=oe[Ce];Le||(Le=oe[Ce]=[]),Le.push(he)}}}class U{constructor(L){const R={},G=[];for(const ye in L){const oe=L[ye],Ce=R[ye]={};for(const Le in oe){const Se=oe[+Le];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const Ye={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};G.push(Ye),Ce[Le]={rect:Ye,metrics:Se.metrics}}}const{w:Y,h:he}=w.p(G),pe=new w.o({width:Y||1,height:he||1});for(const ye in L){const oe=L[ye];for(const Ce in oe){const Le=oe[+Ce];if(!Le||Le.bitmap.width===0||Le.bitmap.height===0)continue;const Se=R[ye][Ce].rect;w.o.copy(Le.bitmap,pe,{x:0,y:0},{x:Se.x+1,y:Se.y+1},Le.bitmap)}}this.image=pe,this.positions=R}}w.bl("GlyphAtlas",U);class W{constructor(L){this.tileID=new w.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,R,G,Y){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new w.a5;const he=new w.bm(Object.keys(L.layers).sort()),pe=new w.bn(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const ye={},oe={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G},Ce=R.familiesBySource[this.source];for(const Wt in Ce){const di=L.layers[Wt];if(!di)continue;di.version===1&&w.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ri=he.encode(Wt),rr=[];for(let cr=0;cr<di.length;cr++){const Pr=di.feature(cr),Ks=pe.getId(Pr,Wt);rr.push({feature:Pr,id:Ks,index:cr,sourceLayerIndex:Ri})}for(const cr of Ce[Wt]){const Pr=cr[0];Pr.source!==this.source&&w.w(`layer.source = ${Pr.source} does not equal this.source = ${this.source}`),Pr.minzoom&&this.zoom<Math.floor(Pr.minzoom)||Pr.maxzoom&&this.zoom>=Pr.maxzoom||Pr.visibility!=="none"&&(Q(cr,this.zoom,G),(ye[Pr.id]=Pr.createBucket({index:pe.bucketLayerIDs.length,layers:cr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ri,sourceID:this.source})).populate(rr,oe,this.tileID.canonical),pe.bucketLayerIDs.push(cr.map(Ks=>Ks.id)))}}const Le=w.aF(oe.glyphDependencies,Wt=>Object.keys(Wt).map(Number));this.inFlightDependencies.forEach(Wt=>Wt==null?void 0:Wt.abort()),this.inFlightDependencies=[];let Se=Promise.resolve({});if(Object.keys(Le).length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),Se=Y.sendAsync({type:"GG",data:{stacks:Le,source:this.source,tileID:this.tileID,type:"glyphs"}},Wt)}const Ye=Object.keys(oe.iconDependencies);let At=Promise.resolve({});if(Ye.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),At=Y.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},Wt)}const Ct=Object.keys(oe.patternDependencies);let ti=Promise.resolve({});if(Ct.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),ti=Y.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"}},Wt)}const[jt,ii,Kt]=yield Promise.all([Se,At,ti]),Ji=new U(jt),Bi=new w.bo(ii,Kt);for(const Wt in ye){const di=ye[Wt];di instanceof w.a6?(Q(di.layers,this.zoom,G),w.bp({bucket:di,glyphMap:jt,glyphPositions:Ji.positions,imageMap:ii,imagePositions:Bi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):di.hasPattern&&(di instanceof w.bq||di instanceof w.br||di instanceof w.bs)&&(Q(di.layers,this.zoom,G),di.addFeatures(oe,this.tileID.canonical,Bi.patternPositions))}return this.status="done",{buckets:Object.values(ye).filter(Wt=>!Wt.isEmpty()),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ji.image,imageAtlas:Bi,glyphMap:this.returnDependencies?jt:null,iconMap:this.returnDependencies?ii:null,glyphPositions:this.returnDependencies?Ji.positions:null}})}}function Q(ee,L,R){const G=new w.z(L);for(const Y of ee)Y.recalculate(G,R)}class j{constructor(L,R,G){this.actor=L,this.layerIndex=R,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,R){return w._(this,void 0,void 0,function*(){const G=yield w.l(L.request,R);try{return{vectorTile:new w.bt.VectorTile(new w.bu(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(Y){const he=new Uint8Array(G.data);let pe=`Unable to parse the tile at ${L.request.url}, `;throw pe+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(pe)}})}loadTile(L){return w._(this,void 0,void 0,function*(){const R=L.uid,G=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request),Y=new W(L);this.loading[R]=Y;const he=new AbortController;Y.abort=he;try{const pe=yield this.loadVectorTile(L,he);if(delete this.loading[R],!pe)return null;const ye=pe.rawData,oe={};pe.expires&&(oe.expires=pe.expires),pe.cacheControl&&(oe.cacheControl=pe.cacheControl);const Ce={};if(G){const Se=G.finish();Se&&(Ce.resourceTiming=JSON.parse(JSON.stringify(Se)))}Y.vectorTile=pe.vectorTile;const Le=Y.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=Y,this.fetching[R]={rawTileData:ye,cacheControl:oe,resourceTiming:Ce};try{const Se=yield Le;return w.e({rawTileData:ye.slice(0)},Se,oe,Ce)}finally{delete this.fetching[R]}}catch(pe){throw delete this.loading[R],Y.status="done",this.loaded[R]=Y,pe}})}reloadTile(L){return w._(this,void 0,void 0,function*(){const R=L.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const G=this.loaded[R];if(G.showCollisionBoxes=L.showCollisionBoxes,G.status==="parsing"){const Y=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[R]){const{rawTileData:pe,cacheControl:ye,resourceTiming:oe}=this.fetching[R];delete this.fetching[R],he=w.e({rawTileData:pe.slice(0)},Y,ye,oe)}else he=Y;return he}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return w._(this,void 0,void 0,function*(){const R=this.loading,G=L.uid;R&&R[G]&&R[G].abort&&(R[G].abort.abort(),delete R[G])})}removeTile(L){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class V{constructor(){this.loaded={}}loadTile(L){return w._(this,void 0,void 0,function*(){const{uid:R,encoding:G,rawImageData:Y,redFactor:he,greenFactor:pe,blueFactor:ye,baseShift:oe}=L,Ce=Y.width+2,Le=Y.height+2,Se=w.b(Y)?new w.R({width:Ce,height:Le},yield w.bw(Y,-1,-1,Ce,Le)):Y,Ye=new w.bx(R,Se,G,he,pe,ye,oe);return this.loaded=this.loaded||{},this.loaded[R]=Ye,Ye})}removeTile(L){const R=this.loaded,G=L.uid;R&&R[G]&&delete R[G]}}function ae(ee,L){if(ee.length!==0){se(ee[0],L);for(var R=1;R<ee.length;R++)se(ee[R],!L)}}function se(ee,L){for(var R=0,G=0,Y=0,he=ee.length,pe=he-1;Y<he;pe=Y++){var ye=(ee[Y][0]-ee[pe][0])*(ee[pe][1]+ee[Y][1]),oe=R+ye;G+=Math.abs(R)>=Math.abs(ye)?R-oe+ye:ye-oe+R,R=oe}R+G>=0!=!!L&&ee.reverse()}var ue=w.by(function ee(L,R){var G,Y=L&&L.type;if(Y==="FeatureCollection")for(G=0;G<L.features.length;G++)ee(L.features[G],R);else if(Y==="GeometryCollection")for(G=0;G<L.geometries.length;G++)ee(L.geometries[G],R);else if(Y==="Feature")ee(L.geometry,R);else if(Y==="Polygon")ae(L.coordinates,R);else if(Y==="MultiPolygon")for(G=0;G<L.coordinates.length;G++)ae(L.coordinates[G],R);return L});const fe=w.bt.VectorTileFeature.prototype.toGeoJSON;var Pe={exports:{}},_e=w.bz,Ee=w.bt.VectorTileFeature,Be=De;function De(ee,L){this.options=L||{},this.features=ee,this.length=ee.length}function Oe(ee,L){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=L||4096}De.prototype.feature=function(ee){return new Oe(this.features[ee],this.options.extent)},Oe.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var L=0;L<ee.length;L++){for(var R=ee[L],G=[],Y=0;Y<R.length;Y++)G.push(new _e(R[Y][0],R[Y][1]));this.geometry.push(G)}return this.geometry},Oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,L=1/0,R=-1/0,G=1/0,Y=-1/0,he=0;he<ee.length;he++)for(var pe=ee[he],ye=0;ye<pe.length;ye++){var oe=pe[ye];L=Math.min(L,oe.x),R=Math.max(R,oe.x),G=Math.min(G,oe.y),Y=Math.max(Y,oe.y)}return[L,G,R,Y]},Oe.prototype.toGeoJSON=Ee.prototype.toGeoJSON;var Ze=w.bA,ft=Be;function We(ee){var L=new Ze;return function(R,G){for(var Y in R.layers)G.writeMessage(3,mt,R.layers[Y])}(ee,L),L.finish()}function mt(ee,L){var R;L.writeVarintField(15,ee.version||1),L.writeStringField(1,ee.name||""),L.writeVarintField(5,ee.extent||4096);var G={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<ee.length;R++)G.feature=ee.feature(R),L.writeMessage(2,st,G);var Y=G.keys;for(R=0;R<Y.length;R++)L.writeStringField(3,Y[R]);var he=G.values;for(R=0;R<he.length;R++)L.writeMessage(4,rt,he[R])}function st(ee,L){var R=ee.feature;R.id!==void 0&&L.writeVarintField(1,R.id),L.writeMessage(2,Ue,ee),L.writeVarintField(3,R.type),L.writeMessage(4,Ke,R)}function Ue(ee,L){var R=ee.feature,G=ee.keys,Y=ee.values,he=ee.keycache,pe=ee.valuecache;for(var ye in R.properties){var oe=R.properties[ye],Ce=he[ye];if(oe!==null){Ce===void 0&&(G.push(ye),he[ye]=Ce=G.length-1),L.writeVarint(Ce);var Le=typeof oe;Le!=="string"&&Le!=="boolean"&&Le!=="number"&&(oe=JSON.stringify(oe));var Se=Le+":"+oe,Ye=pe[Se];Ye===void 0&&(Y.push(oe),pe[Se]=Ye=Y.length-1),L.writeVarint(Ye)}}}function Re(ee,L){return(L<<3)+(7&ee)}function Ae(ee){return ee<<1^ee>>31}function Ke(ee,L){for(var R=ee.loadGeometry(),G=ee.type,Y=0,he=0,pe=R.length,ye=0;ye<pe;ye++){var oe=R[ye],Ce=1;G===1&&(Ce=oe.length),L.writeVarint(Re(1,Ce));for(var Le=G===3?oe.length-1:oe.length,Se=0;Se<Le;Se++){Se===1&&G!==1&&L.writeVarint(Re(2,Le-1));var Ye=oe[Se].x-Y,At=oe[Se].y-he;L.writeVarint(Ae(Ye)),L.writeVarint(Ae(At)),Y+=Ye,he+=At}G===3&&L.writeVarint(Re(7,1))}}function rt(ee,L){var R=typeof ee;R==="string"?L.writeStringField(1,ee):R==="boolean"?L.writeBooleanField(7,ee):R==="number"&&(ee%1!=0?L.writeDoubleField(3,ee):ee<0?L.writeSVarintField(6,ee):L.writeVarintField(5,ee))}Pe.exports=We,Pe.exports.fromVectorTileJs=We,Pe.exports.fromGeojsonVt=function(ee,L){L=L||{};var R={};for(var G in ee)R[G]=new ft(ee[G].features,L),R[G].name=G,R[G].version=L.version,R[G].extent=L.extent;return We({layers:R})},Pe.exports.GeoJSONWrapper=ft;var _t=w.by(Pe.exports);const yt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},ht=Math.fround||(xt=new Float32Array(1),ee=>(xt[0]=+ee,xt[0]));var xt;const Dt=3,qt=5,vi=6;class hi{constructor(L){this.options=Object.assign(Object.create(yt),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:R,minZoom:G,maxZoom:Y}=this.options;R&&console.time("total time");const he=`prepare ${L.length} points`;R&&console.time(he),this.points=L;const pe=[];for(let oe=0;oe<L.length;oe++){const Ce=L[oe];if(!Ce.geometry)continue;const[Le,Se]=Ce.geometry.coordinates,Ye=ht(Di(Le)),At=ht(er(Se));pe.push(Ye,At,1/0,oe,-1,1),this.options.reduce&&pe.push(0)}let ye=this.trees[Y+1]=this._createTree(pe);R&&console.timeEnd(he);for(let oe=Y;oe>=G;oe--){const Ce=+Date.now();ye=this.trees[oe]=this._createTree(this._cluster(ye,oe)),R&&console.log("z%d: %d clusters in %dms",oe,ye.numItems,+Date.now()-Ce)}return R&&console.timeEnd("total time"),this}getClusters(L,R){let G=((L[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,L[1]));let he=L[2]===180?180:((L[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)G=-180,he=180;else if(G>he){const Se=this.getClusters([G,Y,180,pe],R),Ye=this.getClusters([-180,Y,he,pe],R);return Se.concat(Ye)}const ye=this.trees[this._limitZoom(R)],oe=ye.range(Di(G),er(pe),Di(he),er(Y)),Ce=ye.data,Le=[];for(const Se of oe){const Ye=this.stride*Se;Le.push(Ce[Ye+qt]>1?Li(Ce,Ye,this.clusterProps):this.points[Ce[Ye+Dt]])}return Le}getChildren(L){const R=this._getOriginId(L),G=this._getOriginZoom(L),Y="No cluster with the specified id.",he=this.trees[G];if(!he)throw new Error(Y);const pe=he.data;if(R*this.stride>=pe.length)throw new Error(Y);const ye=this.options.radius/(this.options.extent*Math.pow(2,G-1)),oe=he.within(pe[R*this.stride],pe[R*this.stride+1],ye),Ce=[];for(const Le of oe){const Se=Le*this.stride;pe[Se+4]===L&&Ce.push(pe[Se+qt]>1?Li(pe,Se,this.clusterProps):this.points[pe[Se+Dt]])}if(Ce.length===0)throw new Error(Y);return Ce}getLeaves(L,R,G){const Y=[];return this._appendLeaves(Y,L,R=R||10,G=G||0,0),Y}getTile(L,R,G){const Y=this.trees[this._limitZoom(L)],he=Math.pow(2,L),{extent:pe,radius:ye}=this.options,oe=ye/pe,Ce=(G-oe)/he,Le=(G+1+oe)/he,Se={features:[]};return this._addTileFeatures(Y.range((R-oe)/he,Ce,(R+1+oe)/he,Le),Y.data,R,G,he,Se),R===0&&this._addTileFeatures(Y.range(1-oe/he,Ce,1,Le),Y.data,he,G,he,Se),R===he-1&&this._addTileFeatures(Y.range(0,Ce,oe/he,Le),Y.data,-1,G,he,Se),Se.features.length?Se:null}getClusterExpansionZoom(L){let R=this._getOriginZoom(L)-1;for(;R<=this.options.maxZoom;){const G=this.getChildren(L);if(R++,G.length!==1)break;L=G[0].properties.cluster_id}return R}_appendLeaves(L,R,G,Y,he){const pe=this.getChildren(R);for(const ye of pe){const oe=ye.properties;if(oe&&oe.cluster?he+oe.point_count<=Y?he+=oe.point_count:he=this._appendLeaves(L,oe.cluster_id,G,Y,he):he<Y?he++:L.push(ye),L.length===G)break}return he}_createTree(L){const R=new w.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<L.length;G+=this.stride)R.add(L[G],L[G+1]);return R.finish(),R.data=L,R}_addTileFeatures(L,R,G,Y,he,pe){for(const ye of L){const oe=ye*this.stride,Ce=R[oe+qt]>1;let Le,Se,Ye;if(Ce)Le=Ui(R,oe,this.clusterProps),Se=R[oe],Ye=R[oe+1];else{const ti=this.points[R[oe+Dt]];Le=ti.properties;const[jt,ii]=ti.geometry.coordinates;Se=Di(jt),Ye=er(ii)}const At={type:1,geometry:[[Math.round(this.options.extent*(Se*he-G)),Math.round(this.options.extent*(Ye*he-Y))]],tags:Le};let Ct;Ct=Ce||this.options.generateId?R[oe+Dt]:this.points[R[oe+Dt]].id,Ct!==void 0&&(At.id=Ct),pe.features.push(At)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,R){const{radius:G,extent:Y,reduce:he,minPoints:pe}=this.options,ye=G/(Y*Math.pow(2,R)),oe=L.data,Ce=[],Le=this.stride;for(let Se=0;Se<oe.length;Se+=Le){if(oe[Se+2]<=R)continue;oe[Se+2]=R;const Ye=oe[Se],At=oe[Se+1],Ct=L.within(oe[Se],oe[Se+1],ye),ti=oe[Se+qt];let jt=ti;for(const ii of Ct){const Kt=ii*Le;oe[Kt+2]>R&&(jt+=oe[Kt+qt])}if(jt>ti&&jt>=pe){let ii,Kt=Ye*ti,Ji=At*ti,Bi=-1;const Wt=((Se/Le|0)<<5)+(R+1)+this.points.length;for(const di of Ct){const Ri=di*Le;if(oe[Ri+2]<=R)continue;oe[Ri+2]=R;const rr=oe[Ri+qt];Kt+=oe[Ri]*rr,Ji+=oe[Ri+1]*rr,oe[Ri+4]=Wt,he&&(ii||(ii=this._map(oe,Se,!0),Bi=this.clusterProps.length,this.clusterProps.push(ii)),he(ii,this._map(oe,Ri)))}oe[Se+4]=Wt,Ce.push(Kt/jt,Ji/jt,1/0,Wt,-1,jt),he&&Ce.push(Bi)}else{for(let ii=0;ii<Le;ii++)Ce.push(oe[Se+ii]);if(jt>1)for(const ii of Ct){const Kt=ii*Le;if(!(oe[Kt+2]<=R)){oe[Kt+2]=R;for(let Ji=0;Ji<Le;Ji++)Ce.push(oe[Kt+Ji])}}}}return Ce}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,R,G){if(L[R+qt]>1){const pe=this.clusterProps[L[R+vi]];return G?Object.assign({},pe):pe}const Y=this.points[L[R+Dt]].properties,he=this.options.map(Y);return G&&he===Y?Object.assign({},he):he}}function Li(ee,L,R){return{type:"Feature",id:ee[L+Dt],properties:Ui(ee,L,R),geometry:{type:"Point",coordinates:[(G=ee[L],360*(G-.5)),ar(ee[L+1])]}};var G}function Ui(ee,L,R){const G=ee[L+qt],Y=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,he=ee[L+vi],pe=he===-1?{}:Object.assign({},R[he]);return Object.assign(pe,{cluster:!0,cluster_id:ee[L+Dt],point_count:G,point_count_abbreviated:Y})}function Di(ee){return ee/360+.5}function er(ee){const L=Math.sin(ee*Math.PI/180),R=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return R<0?0:R>1?1:R}function ar(ee){const L=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Wr(ee,L,R,G){let Y=G;const he=L+(R-L>>1);let pe,ye=R-L;const oe=ee[L],Ce=ee[L+1],Le=ee[R],Se=ee[R+1];for(let Ye=L+3;Ye<R;Ye+=3){const At=mr(ee[Ye],ee[Ye+1],oe,Ce,Le,Se);if(At>Y)pe=Ye,Y=At;else if(At===Y){const Ct=Math.abs(Ye-he);Ct<ye&&(pe=Ye,ye=Ct)}}Y>G&&(pe-L>3&&Wr(ee,L,pe,G),ee[pe+2]=Y,R-pe>3&&Wr(ee,pe,R,G))}function mr(ee,L,R,G,Y,he){let pe=Y-R,ye=he-G;if(pe!==0||ye!==0){const oe=((ee-R)*pe+(L-G)*ye)/(pe*pe+ye*ye);oe>1?(R=Y,G=he):oe>0&&(R+=pe*oe,G+=ye*oe)}return pe=ee-R,ye=L-G,pe*pe+ye*ye}function Hr(ee,L,R,G){const Y={id:ee??null,type:L,geometry:R,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Dr(Y,R);else if(L==="Polygon")Dr(Y,R[0]);else if(L==="MultiLineString")for(const he of R)Dr(Y,he);else if(L==="MultiPolygon")for(const he of R)Dr(Y,he[0]);return Y}function Dr(ee,L){for(let R=0;R<L.length;R+=3)ee.minX=Math.min(ee.minX,L[R]),ee.minY=Math.min(ee.minY,L[R+1]),ee.maxX=Math.max(ee.maxX,L[R]),ee.maxY=Math.max(ee.maxY,L[R+1])}function vt(ee,L,R,G){if(!L.geometry)return;const Y=L.geometry.coordinates;if(Y&&Y.length===0)return;const he=L.geometry.type,pe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let ye=[],oe=L.id;if(R.promoteId?oe=L.properties[R.promoteId]:R.generateId&&(oe=G||0),he==="Point")Nt(Y,ye);else if(he==="MultiPoint")for(const Ce of Y)Nt(Ce,ye);else if(he==="LineString")xe(Y,ye,pe,!1);else if(he==="MultiLineString"){if(R.lineMetrics){for(const Ce of Y)ye=[],xe(Ce,ye,pe,!1),ee.push(Hr(oe,"LineString",ye,L.properties));return}Pi(Y,ye,pe,!1)}else if(he==="Polygon")Pi(Y,ye,pe,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const Ce of L.geometry.geometries)vt(ee,{id:oe,geometry:Ce,properties:L.properties},R,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ce of Y){const Le=[];Pi(Ce,Le,pe,!0),ye.push(Le)}}ee.push(Hr(oe,he,ye,L.properties))}function Nt(ee,L){L.push(sn(ee[0]),Xt(ee[1]),0)}function xe(ee,L,R,G){let Y,he,pe=0;for(let oe=0;oe<ee.length;oe++){const Ce=sn(ee[oe][0]),Le=Xt(ee[oe][1]);L.push(Ce,Le,0),oe>0&&(pe+=G?(Y*Le-Ce*he)/2:Math.sqrt(Math.pow(Ce-Y,2)+Math.pow(Le-he,2))),Y=Ce,he=Le}const ye=L.length-3;L[2]=1,Wr(L,0,ye,R),L[ye+2]=1,L.size=Math.abs(pe),L.start=0,L.end=L.size}function Pi(ee,L,R,G){for(let Y=0;Y<ee.length;Y++){const he=[];xe(ee[Y],he,R,G),L.push(he)}}function sn(ee){return ee/360+.5}function Xt(ee){const L=Math.sin(ee*Math.PI/180),R=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return R<0?0:R>1?1:R}function ui(ee,L,R,G,Y,he,pe,ye){if(G/=L,he>=(R/=L)&&pe<G)return ee;if(pe<R||he>=G)return null;const oe=[];for(const Ce of ee){const Le=Ce.geometry;let Se=Ce.type;const Ye=Y===0?Ce.minX:Ce.minY,At=Y===0?Ce.maxX:Ce.maxY;if(Ye>=R&&At<G){oe.push(Ce);continue}if(At<R||Ye>=G)continue;let Ct=[];if(Se==="Point"||Se==="MultiPoint")gn(Le,Ct,R,G,Y);else if(Se==="LineString")Xr(Le,Ct,R,G,Y,!1,ye.lineMetrics);else if(Se==="MultiLineString")Dn(Le,Ct,R,G,Y,!1);else if(Se==="Polygon")Dn(Le,Ct,R,G,Y,!0);else if(Se==="MultiPolygon")for(const ti of Le){const jt=[];Dn(ti,jt,R,G,Y,!0),jt.length&&Ct.push(jt)}if(Ct.length){if(ye.lineMetrics&&Se==="LineString"){for(const ti of Ct)oe.push(Hr(Ce.id,Se,ti,Ce.tags));continue}Se!=="LineString"&&Se!=="MultiLineString"||(Ct.length===1?(Se="LineString",Ct=Ct[0]):Se="MultiLineString"),Se!=="Point"&&Se!=="MultiPoint"||(Se=Ct.length===3?"Point":"MultiPoint"),oe.push(Hr(Ce.id,Se,Ct,Ce.tags))}}return oe.length?oe:null}function gn(ee,L,R,G,Y){for(let he=0;he<ee.length;he+=3){const pe=ee[he+Y];pe>=R&&pe<=G&&Lr(L,ee[he],ee[he+1],ee[he+2])}}function Xr(ee,L,R,G,Y,he,pe){let ye=Rr(ee);const oe=Y===0?Xs:es;let Ce,Le,Se=ee.start;for(let jt=0;jt<ee.length-3;jt+=3){const ii=ee[jt],Kt=ee[jt+1],Ji=ee[jt+2],Bi=ee[jt+3],Wt=ee[jt+4],di=Y===0?ii:Kt,Ri=Y===0?Bi:Wt;let rr=!1;pe&&(Ce=Math.sqrt(Math.pow(ii-Bi,2)+Math.pow(Kt-Wt,2))),di<R?Ri>R&&(Le=oe(ye,ii,Kt,Bi,Wt,R),pe&&(ye.start=Se+Ce*Le)):di>G?Ri<G&&(Le=oe(ye,ii,Kt,Bi,Wt,G),pe&&(ye.start=Se+Ce*Le)):Lr(ye,ii,Kt,Ji),Ri<R&&di>=R&&(Le=oe(ye,ii,Kt,Bi,Wt,R),rr=!0),Ri>G&&di<=G&&(Le=oe(ye,ii,Kt,Bi,Wt,G),rr=!0),!he&&rr&&(pe&&(ye.end=Se+Ce*Le),L.push(ye),ye=Rr(ee)),pe&&(Se+=Ce)}let Ye=ee.length-3;const At=ee[Ye],Ct=ee[Ye+1],ti=Y===0?At:Ct;ti>=R&&ti<=G&&Lr(ye,At,Ct,ee[Ye+2]),Ye=ye.length-3,he&&Ye>=3&&(ye[Ye]!==ye[0]||ye[Ye+1]!==ye[1])&&Lr(ye,ye[0],ye[1],ye[2]),ye.length&&L.push(ye)}function Rr(ee){const L=[];return L.size=ee.size,L.start=ee.start,L.end=ee.end,L}function Dn(ee,L,R,G,Y,he){for(const pe of ee)Xr(pe,L,R,G,Y,he,!1)}function Lr(ee,L,R,G){ee.push(L,R,G)}function Xs(ee,L,R,G,Y,he){const pe=(he-L)/(G-L);return Lr(ee,he,R+(Y-R)*pe,1),pe}function es(ee,L,R,G,Y,he){const pe=(he-R)/(Y-R);return Lr(ee,L+(G-L)*pe,he,1),pe}function He(ee,L){const R=[];for(let G=0;G<ee.length;G++){const Y=ee[G],he=Y.type;let pe;if(he==="Point"||he==="MultiPoint"||he==="LineString")pe=on(Y.geometry,L);else if(he==="MultiLineString"||he==="Polygon"){pe=[];for(const ye of Y.geometry)pe.push(on(ye,L))}else if(he==="MultiPolygon"){pe=[];for(const ye of Y.geometry){const oe=[];for(const Ce of ye)oe.push(on(Ce,L));pe.push(oe)}}R.push(Hr(Y.id,he,pe,Y.tags))}return R}function on(ee,L){const R=[];R.size=ee.size,ee.start!==void 0&&(R.start=ee.start,R.end=ee.end);for(let G=0;G<ee.length;G+=3)R.push(ee[G]+L,ee[G+1],ee[G+2]);return R}function lr(ee,L){if(ee.transformed)return ee;const R=1<<ee.z,G=ee.x,Y=ee.y;for(const he of ee.features){const pe=he.geometry,ye=he.type;if(he.geometry=[],ye===1)for(let oe=0;oe<pe.length;oe+=2)he.geometry.push(Rn(pe[oe],pe[oe+1],L,R,G,Y));else for(let oe=0;oe<pe.length;oe++){const Ce=[];for(let Le=0;Le<pe[oe].length;Le+=2)Ce.push(Rn(pe[oe][Le],pe[oe][Le+1],L,R,G,Y));he.geometry.push(Ce)}}return ee.transformed=!0,ee}function Rn(ee,L,R,G,Y,he){return[Math.round(R*(ee*G-Y)),Math.round(R*(L*G-he))]}function ts(ee,L,R,G,Y){const he=L===Y.maxZoom?0:Y.tolerance/((1<<L)*Y.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:ee.length,source:null,x:R,y:G,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ye of ee)et(pe,ye,he,Y);return pe}function et(ee,L,R,G){const Y=L.geometry,he=L.type,pe=[];if(ee.minX=Math.min(ee.minX,L.minX),ee.minY=Math.min(ee.minY,L.minY),ee.maxX=Math.max(ee.maxX,L.maxX),ee.maxY=Math.max(ee.maxY,L.maxY),he==="Point"||he==="MultiPoint")for(let ye=0;ye<Y.length;ye+=3)pe.push(Y[ye],Y[ye+1]),ee.numPoints++,ee.numSimplified++;else if(he==="LineString")Zt(pe,Y,ee,R,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ye=0;ye<Y.length;ye++)Zt(pe,Y[ye],ee,R,he==="Polygon",ye===0);else if(he==="MultiPolygon")for(let ye=0;ye<Y.length;ye++){const oe=Y[ye];for(let Ce=0;Ce<oe.length;Ce++)Zt(pe,oe[Ce],ee,R,!0,Ce===0)}if(pe.length){let ye=L.tags||null;if(he==="LineString"&&G.lineMetrics){ye={};for(const Ce in L.tags)ye[Ce]=L.tags[Ce];ye.mapbox_clip_start=Y.start/Y.size,ye.mapbox_clip_end=Y.end/Y.size}const oe={geometry:pe,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ye};L.id!==null&&(oe.id=L.id),ee.features.push(oe)}}function Zt(ee,L,R,G,Y,he){const pe=G*G;if(G>0&&L.size<(Y?pe:G))return void(R.numPoints+=L.length/3);const ye=[];for(let oe=0;oe<L.length;oe+=3)(G===0||L[oe+2]>pe)&&(R.numSimplified++,ye.push(L[oe],L[oe+1])),R.numPoints++;Y&&function(oe,Ce){let Le=0;for(let Se=0,Ye=oe.length,At=Ye-2;Se<Ye;At=Se,Se+=2)Le+=(oe[Se]-oe[At])*(oe[Se+1]+oe[At+1]);if(Le>0===Ce)for(let Se=0,Ye=oe.length;Se<Ye/2;Se+=2){const At=oe[Se],Ct=oe[Se+1];oe[Se]=oe[Ye-2-Se],oe[Se+1]=oe[Ye-1-Se],oe[Ye-2-Se]=At,oe[Ye-1-Se]=Ct}}(ye,he),ee.push(ye)}const Rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Or{constructor(L,R){const G=(R=this.options=function(he,pe){for(const ye in pe)he[ye]=pe[ye];return he}(Object.create(Rt),R)).debug;if(G&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(he,pe){const ye=[];if(he.type==="FeatureCollection")for(let oe=0;oe<he.features.length;oe++)vt(ye,he.features[oe],pe,oe);else vt(ye,he.type==="Feature"?he:{geometry:he},pe);return ye}(L,R);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(he,pe){const ye=pe.buffer/pe.extent;let oe=he;const Ce=ui(he,1,-1-ye,ye,0,-1,2,pe),Le=ui(he,1,1-ye,2+ye,0,-1,2,pe);return(Ce||Le)&&(oe=ui(he,1,-ye,1+ye,0,-1,2,pe)||[],Ce&&(oe=He(Ce,1).concat(oe)),Le&&(oe=oe.concat(He(Le,-1)))),oe}(Y,R),Y.length&&this.splitTile(Y,0,0,0),G&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,R,G,Y,he,pe,ye){const oe=[L,R,G,Y],Ce=this.options,Le=Ce.debug;for(;oe.length;){Y=oe.pop(),G=oe.pop(),R=oe.pop(),L=oe.pop();const Se=1<<R,Ye=_n(R,G,Y);let At=this.tiles[Ye];if(!At&&(Le>1&&console.time("creation"),At=this.tiles[Ye]=ts(L,R,G,Y,Ce),this.tileCoords.push({z:R,x:G,y:Y}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,G,Y,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const rr=`z${R}`;this.stats[rr]=(this.stats[rr]||0)+1,this.total++}if(At.source=L,he==null){if(R===Ce.indexMaxZoom||At.numPoints<=Ce.indexMaxPoints)continue}else{if(R===Ce.maxZoom||R===he)continue;if(he!=null){const rr=he-R;if(G!==pe>>rr||Y!==ye>>rr)continue}}if(At.source=null,L.length===0)continue;Le>1&&console.time("clipping");const Ct=.5*Ce.buffer/Ce.extent,ti=.5-Ct,jt=.5+Ct,ii=1+Ct;let Kt=null,Ji=null,Bi=null,Wt=null,di=ui(L,Se,G-Ct,G+jt,0,At.minX,At.maxX,Ce),Ri=ui(L,Se,G+ti,G+ii,0,At.minX,At.maxX,Ce);L=null,di&&(Kt=ui(di,Se,Y-Ct,Y+jt,1,At.minY,At.maxY,Ce),Ji=ui(di,Se,Y+ti,Y+ii,1,At.minY,At.maxY,Ce),di=null),Ri&&(Bi=ui(Ri,Se,Y-Ct,Y+jt,1,At.minY,At.maxY,Ce),Wt=ui(Ri,Se,Y+ti,Y+ii,1,At.minY,At.maxY,Ce),Ri=null),Le>1&&console.timeEnd("clipping"),oe.push(Kt||[],R+1,2*G,2*Y),oe.push(Ji||[],R+1,2*G,2*Y+1),oe.push(Bi||[],R+1,2*G+1,2*Y),oe.push(Wt||[],R+1,2*G+1,2*Y+1)}}getTile(L,R,G){L=+L,R=+R,G=+G;const Y=this.options,{extent:he,debug:pe}=Y;if(L<0||L>24)return null;const ye=1<<L,oe=_n(L,R=R+ye&ye-1,G);if(this.tiles[oe])return lr(this.tiles[oe],he);pe>1&&console.log("drilling down to z%d-%d-%d",L,R,G);let Ce,Le=L,Se=R,Ye=G;for(;!Ce&&Le>0;)Le--,Se>>=1,Ye>>=1,Ce=this.tiles[_n(Le,Se,Ye)];return Ce&&Ce.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",Le,Se,Ye),console.time("drilling down")),this.splitTile(Ce.source,Le,Se,Ye,L,R,G),pe>1&&console.timeEnd("drilling down"),this.tiles[oe]?lr(this.tiles[oe],he):null):null}}function _n(ee,L,R){return 32*((1<<ee)*R+L)+ee}function Vt(ee,L){return L?ee.properties[L]:ee.id}function Ln(ee,L){if(ee==null)return!0;if(ee.type==="Feature")return Vt(ee,L)!=null;if(ee.type==="FeatureCollection"){const R=new Set;for(const G of ee.features){const Y=Vt(G,L);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Zn(ee,L){const R=new Map;if(ee!=null)if(ee.type==="Feature")R.set(Vt(ee,L),ee);else for(const G of ee.features)R.set(Vt(G,L),G);return R}class is extends j{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,R){return w._(this,void 0,void 0,function*(){const G=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!Y)return null;const he=new class{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=ye.length,this._features=ye}feature(ye){return new class{constructor(oe){this._feature=oe,this.extent=w.X,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const Ce of this._feature.geometry)oe.push([new w.P(Ce[0],Ce[1])]);return oe}{const oe=[];for(const Ce of this._feature.geometry){const Le=[];for(const Se of Ce)Le.push(new w.P(Se[0],Se[1]));oe.push(Le)}return oe}}toGeoJSON(oe,Ce,Le){return fe.call(this,oe,Ce,Le)}}(this._features[ye])}}(Y.features);let pe=_t(he);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:he,rawData:pe.buffer}})}loadData(L){return w._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const G=!!(L&&L.request&&L.request.collectResourceTiming)&&new w.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new hi(function({superclusterOptions:pe,clusterProperties:ye}){if(!ye||!pe)return pe;const oe={},Ce={},Le={accumulated:null,zoom:0},Se={properties:null},Ye=Object.keys(ye);for(const At of Ye){const[Ct,ti]=ye[At],jt=w.bC(ti),ii=w.bC(typeof Ct=="string"?[Ct,["accumulated"],["get",At]]:Ct);oe[At]=jt.value,Ce[At]=ii.value}return pe.map=At=>{Se.properties=At;const Ct={};for(const ti of Ye)Ct[ti]=oe[ti].evaluate(Le,Se);return Ct},pe.reduce=(At,Ct)=>{Se.properties=Ct;for(const ti of Ye)Le.accumulated=At[ti],At[ti]=Ce[ti].evaluate(Le,Se)},pe}(L)).load((yield this._pendingData).features):(Y=yield this._pendingData,new Or(Y,L.geojsonVtOptions)),this.loaded={};const he={};if(G){const pe=G.finish();pe&&(he.resourceTiming={},he.resourceTiming[L.source]=JSON.parse(JSON.stringify(pe)))}return he}catch(he){if(delete this._pendingRequest,w.bB(he))return{abandoned:!0};throw he}var Y})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const R=this.loaded;return R&&R[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,R){return w._(this,void 0,void 0,function*(){let G=yield this.loadGeoJSON(L,R);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(ue(G,!0),L.filter){const Y=w.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(pe=>Y.value.evaluate({zoom:0},pe))}}return G})}loadGeoJSON(L,R){return w._(this,void 0,void 0,function*(){const{promoteId:G}=L;if(L.request){const Y=yield w.h(L.request,R);return this._dataUpdateable=Ln(Y.data,G)?Zn(Y.data,G):void 0,Y.data}if(typeof L.data=="string")try{const Y=JSON.parse(L.data);return this._dataUpdateable=Ln(Y,G)?Zn(Y,G):void 0,Y}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(Y,he,pe){var ye,oe,Ce,Le;if(he.removeAll&&Y.clear(),he.remove)for(const Se of he.remove)Y.delete(Se);if(he.add)for(const Se of he.add){const Ye=Vt(Se,pe);Ye!=null&&Y.set(Ye,Se)}if(he.update)for(const Se of he.update){let Ye=Y.get(Se.id);if(Ye==null)continue;const At=!Se.removeAllProperties&&(((ye=Se.removeProperties)===null||ye===void 0?void 0:ye.length)>0||((oe=Se.addOrUpdateProperties)===null||oe===void 0?void 0:oe.length)>0);if((Se.newGeometry||Se.removeAllProperties||At)&&(Ye=Object.assign({},Ye),Y.set(Se.id,Ye),At&&(Ye.properties=Object.assign({},Ye.properties))),Se.newGeometry&&(Ye.geometry=Se.newGeometry),Se.removeAllProperties)Ye.properties={};else if(((Ce=Se.removeProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(const Ct of Se.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Ct)&&delete Ye.properties[Ct];if(((Le=Se.addOrUpdateProperties)===null||Le===void 0?void 0:Le.length)>0)for(const{key:Ct,value:ti}of Se.addOrUpdateProperties)Ye.properties[Ct]=ti}}(this._dataUpdateable,L.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class On{constructor(L){this.self=L,this.actor=new w.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,G)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=G},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=R=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,G)=>this._getDEMWorkerSource(R,G.source).loadTile(G)),this.actor.registerMessageHandler("RDT",(R,G)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,G.source).removeTile(G)})),this.actor.registerMessageHandler("GCEZ",(R,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,G.type,G.source).getClusterExpansionZoom(G)})),this.actor.registerMessageHandler("GCC",(R,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,G.type,G.source).getClusterChildren(G)})),this.actor.registerMessageHandler("GCL",(R,G)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,G.type,G.source).getClusterLeaves(G)})),this.actor.registerMessageHandler("LD",(R,G)=>this._getWorkerSource(R,G.type,G.source).loadData(G)),this.actor.registerMessageHandler("GD",(R,G)=>this._getWorkerSource(R,G.type,G.source).getData()),this.actor.registerMessageHandler("LT",(R,G)=>this._getWorkerSource(R,G.type,G.source).loadTile(G)),this.actor.registerMessageHandler("RT",(R,G)=>this._getWorkerSource(R,G.type,G.source).reloadTile(G)),this.actor.registerMessageHandler("AT",(R,G)=>this._getWorkerSource(R,G.type,G.source).abortTile(G)),this.actor.registerMessageHandler("RMT",(R,G)=>this._getWorkerSource(R,G.type,G.source).removeTile(G)),this.actor.registerMessageHandler("RS",(R,G)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][G.type]||!this.workerSources[R][G.type][G.source])return;const Y=this.workerSources[R][G.type][G.source];delete this.workerSources[R][G.type][G.source],Y.removeSource!==void 0&&Y.removeSource(G)})),this.actor.registerMessageHandler("RM",R=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,G)=>w._(this,void 0,void 0,function*(){this.referrer=G})),this.actor.registerMessageHandler("SRPS",(R,G)=>this._syncRTLPluginState(R,G)),this.actor.registerMessageHandler("IS",(R,G)=>w._(this,void 0,void 0,function*(){this.self.importScripts(G)})),this.actor.registerMessageHandler("SI",(R,G)=>this._setImages(R,G)),this.actor.registerMessageHandler("UL",(R,G)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(G.layers,G.removedIds)})),this.actor.registerMessageHandler("SL",(R,G)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(G)}))}_setImages(L,R){return w._(this,void 0,void 0,function*(){this.availableImages[L]=R;for(const G in this.workerSources[L]){const Y=this.workerSources[L][G];for(const he in Y)Y[he].availableImages=R}})}_syncRTLPluginState(L,R){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(R.pluginStatus!=="loading")return w.bD.setState(R),R;const G=R.pluginURL;if(this.self.importScripts(G),w.bD.isParsed()){const Y={pluginStatus:"loaded",pluginURL:G};return w.bD.setState(Y),Y}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${G}`)})}_getAvailableImages(L){let R=this.availableImages[L];return R||(R=[]),R}_getLayerIndex(L){let R=this.layerIndexes[L];return R||(R=this.layerIndexes[L]=new u),R}_getWorkerSource(L,R,G){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][R]||(this.workerSources[L][R]={}),!this.workerSources[L][R][G]){const Y={sendAsync:(he,pe)=>(he.targetMapId=L,this.actor.sendAsync(he,pe))};switch(R){case"vector":this.workerSources[L][R][G]=new j(Y,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][R][G]=new is(Y,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][R][G]=new this.externalWorkerSourceTypes[R](Y,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][R][G]}_getDEMWorkerSource(L,R){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][R]||(this.demWorkerSources[L][R]=new V),this.demWorkerSources[L][R]}}return w.i(self)&&(self.worker=new On(self)),On}),I("index",["exports","./shared"],function(w,u){var U="4.7.1";let W,Q;const j={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((e,n)=>{const a=requestAnimationFrame(e);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(u.c())})}),getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(W||(W=document.createElement("a")),W.href=d,W.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Q==null&&(Q=matchMedia("(prefers-reduced-motion: reduce)")),Q.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in V.docStyle)return e[n];return e[0]}static create(e,n,a){const l=window.document.createElement(e);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,n){e.style[V.transformProp]=n}static addEventListener(e,n,a,l={}){e.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(e,n,a,l={}){e.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const l=n.boundingClientRect;return new u.P((a.clientX-l.left)/n.x-e.clientLeft,(a.clientY-l.top)/n.y-e.clientTop)}static mousePos(e,n){const a=V.getScale(e);return V.getPoint(e,a,n)}static touchPos(e,n){const a=[],l=V.getScale(e);for(let h=0;h<n.length;h++)a.push(V.getPoint(e,l,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const ae={supported:!1,testSupport:function(d){!fe&&ue&&(Pe?_e(d):se=d)}};let se,ue,fe=!1,Pe=!1;function _e(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,ue),d.isContextLost())return;ae.supported=!0}catch{}d.deleteTexture(e),fe=!0}var Ee;typeof document<"u"&&(ue=document.createElement("img"),ue.onload=()=>{se&&_e(se),se=null,Pe=!0},ue.onerror=()=>{fe=!0,se=null},ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,a,l;d.resetRequestQueue=()=>{e=[],n=0,a=0,l={}},d.addThrottleControl=S=>{const C=a++;return l[C]=S,C},d.removeThrottleControl=S=>{delete l[S],y()},d.getImage=(S,C,M=!0)=>new Promise((z,B)=>{ae.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),u.e(S,{type:"image"}),e.push({abortController:C,requestParameters:S,supportImageRefresh:M,state:"queued",onError:Z=>{B(Z)},onSuccess:Z=>{z(Z)}}),y()});const h=S=>u._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:C,supportImageRefresh:M,onError:z,onSuccess:B,abortController:Z}=S,H=M===!1&&!u.i(self)&&!u.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((ne,le)=>ne&&le==="accept",!0));n++;const $=H?x(C,Z):u.m(C,Z);try{const ne=yield $;delete S.abortController,S.state="completed",ne.data instanceof HTMLImageElement||u.b(ne.data)?B(ne):ne.data&&B({data:yield(re=ne.data,typeof createImageBitmap=="function"?u.d(re):u.f(re)),cacheControl:ne.cacheControl,expires:ne.expires})}catch(ne){delete S.abortController,z(ne)}finally{n--,y()}var re}),y=()=>{const S=(()=>{for(const C of Object.keys(l))if(l[C]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=n;C<S&&e.length>0;C++){const M=e.shift();M.abortController.signal.aborted?C--:h(M)}},x=(S,C)=>new Promise((M,z)=>{const B=new Image,Z=S.url,H=S.credentials;H&&H==="include"?B.crossOrigin="use-credentials":(H&&H==="same-origin"||!u.s(Z))&&(B.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{B.src="",z(u.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,M({data:B})},B.onerror=()=>{B.onerror=B.onload=null,C.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=Z})}(Ee||(Ee={})),Ee.resetRequestQueue();class Be{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function De(d){var e=new u.A(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var Oe,Ze=function(d,e,n){return d[0]=e[0]-n[0],d[1]=e[1]-n[1],d[2]=e[2]-n[2],d};Oe=new u.A(3),u.A!=Float32Array&&(Oe[0]=0,Oe[1]=0,Oe[2]=0);var ft=function(d){var e=d[0],n=d[1];return e*e+n*n};function We(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:a,url:l}of d){const h=`${a}${l}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:l}))}}return e}function mt(d,e,n){const a=d.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var d=new u.A(2);u.A!=Float32Array&&(d[0]=0,d[1]=0)})();class st{constructor(e,n,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,a){const{width:l,height:h}=e,y=!(this.size&&this.size[0]===l&&this.size[1]===h||a),{context:x}=this,{gl:S}=x;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[l,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,l,h,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:C,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,C,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,C,M,l,h,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,n,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ue(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class Re extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new u.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||l<e[0]||e[1]<0||h<e[1]||e[2]<0||l<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let l=this.getImage(a);l||(this.fire(new u.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:u.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new u.I(l,a);this.patterns[e]={bin:l,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new st(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=u.p(e),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:y}=this.patterns[h],x=y.x+1,S=y.y+1,C=this.getImage(h).data,M=C.width,z=C.height;u.R.copy(C,l,{x:0,y:0},{x,y:S},{width:M,height:z}),u.R.copy(C,l,{x:0,y:z-1},{x,y:S-1},{width:M,height:1}),u.R.copy(C,l,{x:0,y:0},{x,y:S+z},{width:M,height:1}),u.R.copy(C,l,{x:M-1,y:0},{x:x-1,y:S},{width:1,height:z}),u.R.copy(C,l,{x:0,y:0},{x:x+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||u.w(`Image with ID: "${n}" was not found`),Ue(a)&&this.updateImage(n,a)}}}const Ae=1e20;function Ke(d,e,n,a,l,h,y,x,S){for(let C=e;C<e+a;C++)rt(d,n*h+C,h,l,y,x,S);for(let C=n;C<n+l;C++)rt(d,C*h+e,1,a,y,x,S)}function rt(d,e,n,a,l,h,y){h[0]=0,y[0]=-Ae,y[1]=Ae,l[0]=d[e];for(let x=1,S=0,C=0;x<a;x++){l[x]=d[e+x*n];const M=x*x;do{const z=h[S];C=(l[x]-l[z]+M-z*z)/(x-z)/2}while(C<=y[S]&&--S>-1);S++,h[S]=x,y[S]=C,y[S+1]=Ae}for(let x=0,S=0;x<a;x++){for(;y[S+1]<x;)S++;const C=h[S],M=x-C;d[e+x*n]=l[C]+M*M}}class _t{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const y of e[h])n.push(this._getAndCacheGlyphsPromise(h,y));const a=yield Promise.all(n),l={};for(const{stack:h,id:y,glyph:x}of a)l[h]||(l[h]={}),l[h][y]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics};return l})}_getAndCacheGlyphsPromise(e,n){return u._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:e,id:n,glyph:l};if(l=this._tinySDF(a,e,n),l)return a.glyphs[n]=l,{stack:e,id:n,glyph:l};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const x=_t.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=x}const y=yield a.requests[h];for(const x in y)this._doesCharSupportLocalGlyph(+x)||(a.glyphs[+x]=y[+x]);return a.ranges[h]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let x="400";/bold/i.test(n)?x="900":/medium/i.test(n)?x="500":/light/i.test(n)&&(x="200"),h=e.tinySDF=new _t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:x})}const y=h.draw(String.fromCharCode(a));return{id:a,bitmap:new u.o({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}_t.loadGlyphRange=function(d,e,n,a){return u._(this,void 0,void 0,function*(){const l=256*e,h=l+255,y=a.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${l}-${h}`),"Glyphs"),x=yield u.l(y,new AbortController);if(!x||!x.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${h}`);const S={};for(const C of u.n(x.data))S[C.id]=C;return S})},_t.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const x=this.size=d+4*e,S=this._createCanvas(x),C=this.ctx=S.getContext("2d",{willReadFrequently:!0});C.font=`${y} ${h} ${d}px ${l}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(d),y=Math.ceil(n),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),S=Math.min(this.size-this.buffer,y+Math.ceil(a)),C=x+2*this.buffer,M=S+2*this.buffer,z=Math.max(C*M,0),B=new Uint8ClampedArray(z),Z={data:B,width:C,height:M,glyphWidth:x,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(x===0||S===0)return Z;const{ctx:H,buffer:$,gridInner:re,gridOuter:ne}=this;H.clearRect($,$,x,S),H.fillText(d,$,$+y);const le=H.getImageData($,$,x,S);ne.fill(Ae,0,z),re.fill(0,0,z);for(let K=0;K<S;K++)for(let de=0;de<x;de++){const me=le.data[4*(K*x+de)+3]/255;if(me===0)continue;const be=(K+$)*C+de+$;if(me===1)ne[be]=0,re[be]=Ae;else{const ze=.5-me;ne[be]=ze>0?ze*ze:0,re[be]=ze<0?ze*ze:0}}Ke(ne,0,0,C,M,C,this.f,this.v,this.z),Ke(re,$,$,x,S,C,this.f,this.v,this.z);for(let K=0;K<z;K++){const de=Math.sqrt(ne[K])-Math.sqrt(re[K]);B[K]=Math.round(255-255*(de/this.radius+this.cutoff))}return Z}};class yt{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,n){return u.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:u.y.number(e.x,n.x,a),y:u.y.number(e.y,n.y,a),z:u.y.number(e.z,n.z,a)}}}let ht;class xt extends u.E{constructor(e){super(),ht=ht||new u.q({anchor:new u.D(u.v.light.anchor),position:new yt,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(u.r,e,n))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&u.t(this,e.call(u.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const Dt=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class qt extends u.E{constructor(e){super(),this._transitionable=new u.T(Dt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0))}setSky(e,n={}){if(!this._validate(u.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&u.t(this,e.call(u.u,u.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class vi{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,x=!0;l.push({left:h,right:y,isDash:x,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){x=!x;const M=e[C];h=S*a,S+=M,y=S*a,l.push({left:h,right:y,isDash:x,zeroLength:M===0})}return l}addRoundDash(e,n,a){const l=n/2;for(let h=-a;h<=a;h++){const y=this.width*(this.nextRow+a+h);let x=0,S=e[x];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++x]);const M=Math.abs(C-S.left),z=Math.abs(C-S.right),B=Math.min(M,z);let Z;const H=h/a*(l+1);if(S.isDash){const $=l-Math.abs(H);Z=Math.sqrt(B*B+$*$)}else Z=l-Math.sqrt(B*B+H*H);this.data[y+C]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(e){for(let x=e.length-1;x>=0;--x){const S=e[x],C=e[x+1];S.zeroLength?e.splice(x,1):C&&C.isDash===S.isDash&&(C.left=S.left,e.splice(x,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,y=e[h];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++h]);const S=Math.abs(x-y.left),C=Math.abs(x-y.right),M=Math.min(S,C);this.data[l+x]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return u.w("LineAtlas out of space"),null;let h=0;for(let x=0;x<e.length;x++)h+=e[x];if(h!==0){const x=this.width/h,S=this.getDashRanges(e,this.width,x);n?this.addRoundDash(S,x,a):this.addRegularDash(S)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=l,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const hi="maplibre_preloaded_worker_pool";class Li{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Li.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hi]}numActive(){return Object.keys(this.active).length}}const Ui=Math.floor(j.hardwareConcurrency/2);let Di,er;function ar(){return Di||(Di=new Li),Di}Li.workerCount=u.C(globalThis)?Math.max(Math.min(Ui,3),1):1;class Wr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const h=new u.F(a[l],n);h.name=`Worker ${l}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function mr(){return er||(er=new Wr(ar(),u.G),er.registerMessageHandler("GR",(d,e,n)=>u.m(e,n))),er}function Hr(d,e){const n=u.H();return u.J(n,n,[1,1,0]),u.K(n,n,[.5*d.width,.5*d.height,1]),u.L(n,n,d.calculatePosMatrix(e.toUnwrapped()))}function Dr(d,e,n,a,l,h){const y=function(z,B,Z){if(z)for(const H of z){const $=B[H];if($&&$.source===Z&&$.type==="fill-extrusion")return!0}else for(const H in B){const $=B[H];if($.source===Z&&$.type==="fill-extrusion")return!0}return!1}(l&&l.layers,e,d.id),x=h.maxPitchScaleFactor(),S=d.tilesIn(a,x,y);S.sort(vt);const C=[];for(const z of S)C.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,d._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,l,h,x,Hr(d.transform,z.tileID))});const M=function(z){const B={},Z={};for(const H of z){const $=H.queryResults,re=H.wrappedTileID,ne=Z[re]=Z[re]||{};for(const le in $){const K=$[le],de=ne[le]=ne[le]||{},me=B[le]=B[le]||[];for(const be of K)de[be.featureIndex]||(de[be.featureIndex]=!0,me.push(be))}}return B}(C);for(const z in M)M[z].forEach(B=>{const Z=B.feature,H=d.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=H});return M}function vt(d,e){const n=d.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Nt(d,e,n){return u._(this,void 0,void 0,function*(){let a=d;if(d.url?a=(yield u.h(e.transformRequest(d.url,"Source"),n)).data:yield j.frameAsync(n),!a)return null;const l=u.M(u.e(a,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(h=>h.id)),l})}class xe{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let l,h;if(e instanceof u.N)l=e,h=e;else{if(!(e instanceof xe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xe.convert(e)):this.extend(u.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.N.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new u.N(l.lng,l.lat),this._ne=new u.N(h.lng,h.lat)),this}getCenter(){return new u.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.N(this.getWest(),this.getNorth())}getSouthEast(){return new u.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=u.N.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof xe?e:e&&new xe(e)}static fromLngLat(e,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new xe(new u.N(e.lng-l,e.lat-a),new u.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new u.N(this._sw.lng,this._sw.lat),n=new u.N(this._ne.lng,this._ne.lat);return new xe(e,e.lng>n.lng?new u.N(n.lng+360,n.lat):n)}}class Pi{constructor(e,n,a){this.bounds=xe.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(u.O(this.bounds.getWest())*n),l=Math.floor(u.Q(this.bounds.getNorth())*n),h=Math.ceil(u.O(this.bounds.getEast())*n),y=Math.ceil(u.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=l&&e.y<y}}class sn extends u.E{constructor(e,n,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.M(n,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Nt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Pi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,y)=>{e.reloadPromise={resolve:h,reject:y}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Xt extends u.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},n),u.e(this,u.M(n,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Nt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Pi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ee.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,h=l.gl,y=a.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new st(l,y,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ui extends Xt{constructor(e,n,a,l){super(e,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield Ee.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const h=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const y=u.b(h)&&u.U()?h:yield this.readImageNow(h),x={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:x});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const n=e.width+2,a=e.height+2;try{return new u.R({width:n,height:a},yield u.W(e,-1,-1,n,a))}catch{}}return j.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+a)%a,x=n.x+1===a?e.wrap+1:e.wrap,S={};return S[new u.S(e.overscaledZ,h,n.z,l,n.y).key]={backfilled:!1},S[new u.S(e.overscaledZ,x,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new u.S(e.overscaledZ,h,n.z,l,n.y-1).key]={backfilled:!1},S[new u.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new u.S(e.overscaledZ,x,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(S[new u.S(e.overscaledZ,h,n.z,l,n.y+1).key]={backfilled:!1},S[new u.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new u.S(e.overscaledZ,x,n.z,y,n.y+1).key]={backfilled:!1}),S}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class gn extends u.E{constructor(e,n,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=u.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=u.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:u.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:u.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const n=u.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(j.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&u.e(h,{resourceTiming:l}),this.fire(new u.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,n==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Xr=u.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Rr extends u.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new u.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(u.Z.fromLngLat);this.tileID=function(l){let h=1/0,y=1/0,x=-1/0,S=-1/0;for(const B of l)h=Math.min(h,B.x),y=Math.min(y,B.y),x=Math.max(x,B.x),S=Math.max(S,B.y);const C=Math.max(x-h,S-y),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,M);return new u.a1(M,Math.floor((h+x)/2*z),Math.floor((y+S)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new u.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,u.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,u.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,u.X,u.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Xr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new st(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Dn extends Rr{constructor(e,n,a,l){super(e,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield u.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new u.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new u.j(new u.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Xr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new st(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Lr extends Rr{constructor(e,n,a,l){super(e,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(y=>typeof y!="number"))||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new u.j(new u.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Xr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new st(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const h in this.tiles){const y=this.tiles[h];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,l=!0)}l&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Xs={},es=d=>{switch(d){case"geojson":return gn;case"image":return Rr;case"raster":return Xt;case"raster-dem":return ui;case"vector":return sn;case"video":return Dn;case"canvas":return Lr}return Xs[d]},He="RTLPluginLoaded";class on extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=mr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=j.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(He))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let lr=null;function Rn(){return lr||(lr=new on),lr}class ts{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const y={};if(!h)return y;for(const x of l){const S=x.layerIds.map(C=>h.getLayer(C)).filter(Boolean);if(S.length!==0){x.layers=S,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(C=>S.filter(M=>M.id===C)[0]));for(const C of S)y[C.id]=x}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof u.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof u.a6&&h.hasRTLText){this.hasRTLText=!0,Rn().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new st(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new st(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,l,h,y,x,S,C,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:h,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:x,queryPadding:this.queryPadding*C},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",y=l._geojsonTileLayer||l[h];if(!y)return;const x=u.a7(n&&n.filter),{z:S,x:C,y:M}=this.tileID.canonical,z={z:S,x:C,y:M};for(let B=0;B<y.length;B++){const Z=y.feature(B);if(x.needGeometry){const re=u.a8(Z,!0);if(!x.filter(new u.z(this.tileID.overscaledZ),re,this.tileID.canonical))continue}else if(!x.filter(new u.z(this.tileID.overscaledZ),Z))continue;const H=a.getId(Z,h),$=new u.a9(Z,S,C,M,H);$.tile=z,e.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=u.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const h=this.buckets[l],y=h.layers[0].sourceLayer||"_geojsonTileLayer",x=a[y],S=e[y];if(!x||!S||Object.keys(S).length===0)continue;h.update(S,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(l);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<j.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=j.now()+e}setDependencies(e,n){const a={};for(const l of n)a[l]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const l=this.dependencies[a];if(l){for(const h of n)if(l[h])return!0}}return!1}}class et{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class Zt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},u.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),l=u.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const y in h)delete l[y]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const y in this.stateChanges[l])this.state[l][y]||(this.state[l][y]={}),u.e(this.state[l][y],this.stateChanges[l][y]),h[y]=this.state[l][y];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const y in this.state[l])h[y]={},this.state[l][y]={};else for(const y in this.deletedStates[l]){if(this.deletedStates[l][y]===null)this.state[l][y]={};else for(const x of Object.keys(this.deletedStates[l][y]))delete this.state[l][y][x];h[y]=this.state[l][y]}a[l]=a[l]||{},u.e(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,n)}}class Rt extends u.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,h,y,x)=>{const S=new(es(h.type))(l,h,y,x);if(S.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${S.id}`);return S})(e,n,a,this),this._tiles={},this._cache=new et(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Zt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new u.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Or).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,l)=>{const h=a.tileID,y=l.tileID,x=new u.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),S=new u.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-y.overscaledZ||S.y-x.y||S.x-x.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Or).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return u._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=j.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const h=n[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const y=this.getTileByID(h);a(e,y),a(y,e)}}function a(l,h){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let y=h.tileID.canonical.x-l.tileID.canonical.x;const x=h.tileID.canonical.y-l.tileID.canonical.y,S=Math.pow(2,l.tileID.canonical.z),C=h.tileID.key;y===0&&x===0||Math.abs(x)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,y,x),l.neighboringTiles&&l.neighboringTiles[C]&&(l.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,l){for(const h in this._tiles){let y=this._tiles[h];if(l[h]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>a)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const C=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[C.key],y&&y.hasData()&&(x=C)}let S=x;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){l[x.key]=x;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,n,a,l,h,y){const x={},S={},C=Object.keys(e),M=j.now();for(const z of C){const B=e[z],Z=this._tiles[z];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=M)continue;const H=this.findLoadedParent(B,n),$=this.findLoadedSibling(B),re=H||$||null;re&&(this._addTile(re.tileID),x[re.tileID.key]=re.tileID),S[z]=B}this._retainLoadedChildren(S,l,a,e);for(const z in x)e[z]||(this._coveredTiles[z]=!0,e[z]=x[z]);if(y){const z={},B={};for(const Z of h)this._tiles[Z.key].hasData()?z[Z.key]=Z:B[Z.key]=Z;for(const Z in B){const H=B[Z].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(z[H[0].key]=e[H[0].key]=H[0],z[H[1].key]=e[H[1].key]=H[1],z[H[2].key]=e[H[2].key]=H[2],z[H[3].key]=e[H[3].key]=H[3],delete B[Z])}for(const Z in B){const H=B[Z],$=this.findLoadedParent(H,this._source.minzoom),re=this.findLoadedSibling(H),ne=$||re||null;if(ne){z[ne.tileID.key]=e[ne.tileID.key]=ne.tileID;for(const le in z)z[le].isChildOf(ne.tileID)&&delete z[le]}}for(const Z in this._tiles)z[Z]||(this._coveredTiles[Z]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new u.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const l=e.coveringZoomLevel(this._source),h=Math.max(l-Rt.maxOverzooming,this._source.minzoom),y=Math.max(l+Rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);M[B.key]=B;const Z=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[Z.key]=Z}a=a.concat(Object.values(M))}const x=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,l);_n(this._source.type)&&this._updateCoveredAndRetainedTiles(S,h,y,l,a,n);for(const M in S)this._tiles[M].clearFadeHold();const C=u.ab(this._tiles,S);for(const M of C){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const l={},h={},y=Math.max(n-Rt.maxOverzooming,this._source.minzoom),x=Math.max(n+Rt.maxUnderzooming,this._source.minzoom),S={};for(const C of e){const M=this._addTile(C);l[C.key]=C,M.hasData()||n<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,n,x,l);for(const C of e){let M=this._tiles[C.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],Z=this.getTile(B);if(Z&&Z.hasData()){l[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(l[B[0].key]&&l[B[1].key]&&l[B[2].key]&&l[B[3].key])continue}let z=M.wasRequested();for(let B=C.overscaledZ-1;B>=y;--B){const Z=C.scaledTo(B);if(h[Z.key])break;if(h[Z.key]=!0,M=this.getTile(Z),!M&&z&&(M=this._addTile(Z)),M){const H=M.hasData();if((H||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(l[Z.key]=Z),z=M.wasRequested(),H)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new ts(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new u.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const l=[],h=this.transform;if(!h)return l;const y=a?h.getCameraQueryGeometry(e):e,x=e.map(H=>h.pointCoordinate(H,this.terrain)),S=y.map(H=>h.pointCoordinate(H,this.terrain)),C=this.getIds();let M=1/0,z=1/0,B=-1/0,Z=-1/0;for(const H of S)M=Math.min(M,H.x),z=Math.min(z,H.y),B=Math.max(B,H.x),Z=Math.max(Z,H.y);for(let H=0;H<C.length;H++){const $=this._tiles[C[H]];if($.holdingForFade())continue;const re=$.tileID,ne=Math.pow(2,h.zoom-$.tileID.overscaledZ),le=n*$.queryPadding*u.X/$.tileSize/ne,K=[re.getTilePoint(new u.Z(M,z)),re.getTilePoint(new u.Z(B,Z))];if(K[0].x-le<u.X&&K[0].y-le<u.X&&K[1].x+le>=0&&K[1].y+le>=0){const de=x.map(be=>re.getTilePoint(be)),me=S.map(be=>re.getTilePoint(be));l.push({tile:$,tileID:re,queryGeometry:de,cameraQueryGeometry:me,scale:ne})}}return l}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(_n(this._source.type)){const e=j.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const l=this._tiles[e];l&&l.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function Or(d,e){const n=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||a-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function _n(d){return d==="raster"||d==="image"||d==="video"}Rt.maxOverzooming=10,Rt.maxUnderzooming=3;class Vt{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ac(e,0,1);let n=1,a=this._distances[n];const l=e*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const h=n-1,y=this._distances[h],x=a-y,S=x>0?(l-y)/x:0;return this.points[h].mult(1-S).add(this.points[n].mult(S))}}function Ln(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class Zn{constructor(e,n,a){const l=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)l.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,l,h){this._forEachCell(n,a,l,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h)}insertCircle(e,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,n,a,l,h,y){this.boxCells[h].push(y)}_insertCircleCell(e,n,a,l,h,y){this.circleCells[h].push(y)}_query(e,n,a,l,h,y,x){if(a<0||e>this.width||l<0||n>this.height)return[];const S=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=l){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:l}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],z=this.circles[3*C+1],B=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:M-B,y1:z-B,x2:M+B,y2:z+B})}}else this._forEachCell(e,n,a,l,this._queryCell,S,{hitTest:h,overlapMode:y,seenUids:{box:{},circle:{}}},x);return S}query(e,n,a,l){return this._query(e,n,a,l,!1,null)}hitTest(e,n,a,l,h,y){return this._query(e,n,a,l,!0,h,y).length>0}hitTestCircle(e,n,a,l,h){const y=e-a,x=e+a,S=n-a,C=n+a;if(x<0||y>this.width||C<0||S>this.height)return!1;const M=[];return this._forEachCell(y,S,x,C,this._queryCellCircle,M,{hitTest:!0,overlapMode:l,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),M.length>0}_queryCell(e,n,a,l,h,y,x,S){const{seenUids:C,hitTest:M,overlapMode:z}=x,B=this.boxCells[h];if(B!==null){const H=this.bboxes;for(const $ of B)if(!C.box[$]){C.box[$]=!0;const re=4*$,ne=this.boxKeys[$];if(e<=H[re+2]&&n<=H[re+3]&&a>=H[re+0]&&l>=H[re+1]&&(!S||S(ne))&&(!M||!Ln(z,ne.overlapMode))&&(y.push({key:ne,x1:H[re],y1:H[re+1],x2:H[re+2],y2:H[re+3]}),M))return!0}}const Z=this.circleCells[h];if(Z!==null){const H=this.circles;for(const $ of Z)if(!C.circle[$]){C.circle[$]=!0;const re=3*$,ne=this.circleKeys[$];if(this._circleAndRectCollide(H[re],H[re+1],H[re+2],e,n,a,l)&&(!S||S(ne))&&(!M||!Ln(z,ne.overlapMode))){const le=H[re],K=H[re+1],de=H[re+2];if(y.push({key:ne,x1:le-de,y1:K-de,x2:le+de,y2:K+de}),M)return!0}}}return!1}_queryCellCircle(e,n,a,l,h,y,x,S){const{circle:C,seenUids:M,overlapMode:z}=x,B=this.boxCells[h];if(B!==null){const H=this.bboxes;for(const $ of B)if(!M.box[$]){M.box[$]=!0;const re=4*$,ne=this.boxKeys[$];if(this._circleAndRectCollide(C.x,C.y,C.radius,H[re+0],H[re+1],H[re+2],H[re+3])&&(!S||S(ne))&&!Ln(z,ne.overlapMode))return y.push(!0),!0}}const Z=this.circleCells[h];if(Z!==null){const H=this.circles;for(const $ of Z)if(!M.circle[$]){M.circle[$]=!0;const re=3*$,ne=this.circleKeys[$];if(this._circlesCollide(H[re],H[re+1],H[re+2],C.x,C.y,C.radius)&&(!S||S(ne))&&!Ln(z,ne.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,a,l,h,y,x,S){const C=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),B=this._convertToYCellCoord(l);for(let Z=C;Z<=z;Z++)for(let H=M;H<=B;H++)if(h.call(this,e,n,a,l,this.xCellCount*H+Z,y,x,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,l,h,y){const x=l-e,S=h-n,C=a+y;return C*C>x*x+S*S}_circleAndRectCollide(e,n,a,l,h,y,x){const S=(y-l)/2,C=Math.abs(e-(l+S));if(C>S+a)return!1;const M=(x-h)/2,z=Math.abs(n-(h+M));if(z>M+a)return!1;if(C<=S||z<=M)return!0;const B=C-S,Z=z-M;return B*B+Z*Z<=a*a}}function is(d,e,n,a,l){const h=u.H();return e?(u.K(h,h,[1/l,1/l,1]),n||u.ad(h,h,a.angle)):u.L(h,a.labelPlaneMatrix,d),h}function On(d,e,n,a,l){if(e){const h=u.ae(d);return u.K(h,h,[l,l,1]),n||u.ad(h,h,-a.angle),h}return a.glCoordMatrix}function ee(d,e,n,a){let l;a?(l=[d,e,a(d,e),1],u.af(l,l,n)):(l=[d,e,0,1],ti(l,l,n));const h=l[3];return{point:new u.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function L(d,e){return .5+d/e*.5}function R(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function G(d,e,n,a,l,h,y,x,S,C,M,z,B,Z,H){const $=a?d.textSizeData:d.iconSizeData,re=u.ag($,n.transform.zoom),ne=[256/n.width*2+1,256/n.height*2+1],le=a?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;le.clear();const K=d.lineVertexArray,de=a?d.text.placedSymbolArray:d.icon.placedSymbolArray,me=n.transform.width/n.transform.height;let be=!1;for(let ze=0;ze<de.length;ze++){const Ge=de.get(ze);if(Ge.hidden||Ge.writingMode===u.ah.vertical&&!be){Ct(Ge.numGlyphs,le);continue}be=!1;const nt=ee(Ge.anchorX,Ge.anchorY,e,H);if(!R(nt.point,ne)){Ct(Ge.numGlyphs,le);continue}const ct=L(n.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),Qe=u.ai($,re,Ge),$e=y?Qe/ct:Qe*ct,wt={getElevation:H,labelPlaneMatrix:l,lineVertexArray:K,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new u.P(Ge.anchorX,Ge.anchorY),unwrappedTileID:M,width:z,height:B,translation:Z},Ft=pe(wt,Ge,$e,!1,x,e,h,d.glyphOffsetArray,le,me,S);be=Ft.useVertical,(Ft.notEnoughRoom||be||Ft.needsFlipping&&pe(wt,Ge,$e,!0,x,e,h,d.glyphOffsetArray,le,me,S).notEnoughRoom)&&Ct(Ge.numGlyphs,le)}a?d.text.dynamicLayoutVertexBuffer.updateData(le):d.icon.dynamicLayoutVertexBuffer.updateData(le)}function Y(d,e,n,a,l,h,y,x){const S=h.glyphStartIndex+h.numGlyphs,C=h.lineStartIndex,M=h.lineStartIndex+h.lineLength,z=e.getoffsetX(h.glyphStartIndex),B=e.getoffsetX(S-1),Z=Ye(d*z,n,a,l,h.segment,C,M,x,y);if(!Z)return null;const H=Ye(d*B,n,a,l,h.segment,C,M,x,y);return H?x.projectionCache.anyProjectionOccluded?null:{first:Z,last:H}:null}function he(d,e,n,a){return d===u.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(d===u.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function pe(d,e,n,a,l,h,y,x,S,C,M){const z=n/24,B=e.lineOffsetX*z,Z=e.lineOffsetY*z;let H;if(e.numGlyphs>1){const $=e.glyphStartIndex+e.numGlyphs,re=e.lineStartIndex,ne=e.lineStartIndex+e.lineLength,le=Y(z,x,B,Z,a,e,M,d);if(!le)return{notEnoughRoom:!0};const K=ee(le.first.point.x,le.first.point.y,y,d.getElevation).point,de=ee(le.last.point.x,le.last.point.y,y,d.getElevation).point;if(l&&!a){const me=he(e.writingMode,K,de,C);if(me)return me}H=[le.first];for(let me=e.glyphStartIndex+1;me<$-1;me++)H.push(Ye(z*x.getoffsetX(me),B,Z,a,e.segment,re,ne,d,M));H.push(le.last)}else{if(l&&!a){const re=ee(d.tileAnchorPoint.x,d.tileAnchorPoint.y,h,d.getElevation).point,ne=e.lineStartIndex+e.segment+1,le=new u.P(d.lineVertexArray.getx(ne),d.lineVertexArray.gety(ne)),K=ee(le.x,le.y,h,d.getElevation),de=K.signedDistanceFromCamera>0?K.point:function(be,ze,Ge,nt,ct,Qe){return ye(be,ze,Ge,1,ct,Qe)}(d.tileAnchorPoint,le,re,0,h,d),me=he(e.writingMode,re,de,C);if(me)return me}const $=Ye(z*x.getoffsetX(e.glyphStartIndex),B,Z,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,d,M);if(!$||d.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[$]}for(const $ of H)u.aj(S,$.point,$.angle);return{}}function ye(d,e,n,a,l,h){const y=d.add(d.sub(e)._unit()),x=l!==void 0?ee(y.x,y.y,l,h.getElevation).point:Ce(y.x,y.y,h).point,S=n.sub(x);return n.add(S._mult(a/S.mag()))}function oe(d,e,n){const a=e.projectionCache;if(a.projections[d])return a.projections[d];const l=new u.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),h=Ce(l.x,l.y,e);if(h.signedDistanceFromCamera>0)return a.projections[d]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const y=d-n.direction;return function(x,S,C,M,z){return ye(x,S,C,M,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),l,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function Ce(d,e,n){const a=d+n.translation[0],l=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,l,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=ee(a,l,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function Le(d,e,n){return d._unit()._perp()._mult(e*n)}function Se(d,e,n,a,l,h,y,x,S){if(x.projectionCache.offsets[d])return x.projectionCache.offsets[d];const C=n.add(e);if(d+S.direction<a||d+S.direction>=l)return x.projectionCache.offsets[d]=C,C;const M=oe(d+S.direction,x,S),z=Le(M.sub(n),y,S.direction),B=n.add(z),Z=M.add(z);return x.projectionCache.offsets[d]=u.ak(h,C,B,Z)||C,x.projectionCache.offsets[d]}function Ye(d,e,n,a,l,h,y,x,S){const C=a?d-e:d+e;let M=C>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let B,Z=M>0?h+l:h+l+1;x.projectionCache.cachedAnchorPoint?B=x.projectionCache.cachedAnchorPoint:(B=Ce(x.tileAnchorPoint.x,x.tileAnchorPoint.y,x).point,x.projectionCache.cachedAnchorPoint=B);let H,$,re=B,ne=B,le=0,K=0;const de=Math.abs(C),me=[];let be;for(;le+K<=de;){if(Z+=M,Z<h||Z>=y)return null;le+=K,ne=re,$=H;const nt={absOffsetX:de,direction:M,distanceFromAnchor:le,previousVertex:ne};if(re=oe(Z,x,nt),n===0)me.push(ne),be=re.sub(ne);else{let ct;const Qe=re.sub(ne);ct=Qe.mag()===0?Le(oe(Z+M,x,nt).sub(re),n,M):Le(Qe,n,M),$||($=ne.add(ct)),H=Se(Z,ct,re,h,y,$,n,x,nt),me.push($),be=H.sub($)}K=be.mag()}const ze=be._mult((de-le)/K)._add($||ne),Ge=z+Math.atan2(re.y-ne.y,re.x-ne.x);return me.push(ze),{point:ze,angle:S?Ge:0,path:me}}const At=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(d,e){for(let n=0;n<d;n++){const a=e.length;e.resize(a+4),e.float32.set(At,3*a)}}function ti(d,e,n){const a=e[0],l=e[1];return d[0]=n[0]*a+n[4]*l+n[12],d[1]=n[1]*a+n[5]*l+n[13],d[3]=n[3]*a+n[7]*l+n[15],d}const jt=100;class ii{constructor(e,n,a=new Zn(e.width+200,e.height+200,25),l=new Zn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+jt,this.screenBottomBoundary=e.height+jt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,l,h,y,x,S,C,M,z){const B=e.anchorPointX+S[0],Z=e.anchorPointY+S[1],H=this.projectAndGetPerspectiveRatio(l,B,Z,h,M),$=a*H.perspectiveRatio;let re;if(y||x)re=this._projectCollisionBox(e,$,l,h,y,x,S,H,M,z);else{const me=H.point.x+(z?z.x*$:0),be=H.point.y+(z?z.y*$:0);re={allPointsOccluded:!1,box:[me+e.x1*$,be+e.y1*$,me+e.x2*$,be+e.y2*$]}}const[ne,le,K,de]=re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(y?re.allPointsOccluded:this.mapProjection.isOccluded(B,Z,h))||H.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ne,le,K,de)||n!=="always"&&this.grid.hitTest(ne,le,K,de,n,C)?{box:[ne,le,K,de],placeable:!1,offscreen:!1}:{box:[ne,le,K,de],placeable:!0,offscreen:this.isOffscreen(ne,le,K,de)}}placeCollisionCircles(e,n,a,l,h,y,x,S,C,M,z,B,Z,H,$,re){const ne=[],le=new u.P(n.anchorX,n.anchorY),K=this.getPerspectiveRatio(y,le.x,le.y,x,re),de=(z?h/K:h*K)/u.ap,me={getElevation:re,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:le,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:$},be=Y(de,l,n.lineOffsetX*de,n.lineOffsetY*de,!1,n,!1,me);let ze=!1,Ge=!1,nt=!0;if(be){const ct=.5*Z*K+H,Qe=new u.P(-100,-100),$e=new u.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new Vt,Ft=be.first,tt=be.last;let at=[];for(let Ut=Ft.path.length-1;Ut>=1;Ut--)at.push(Ft.path[Ut]);for(let Ut=1;Ut<tt.path.length;Ut++)at.push(tt.path[Ut]);const Lt=2.5*ct;if(C){const Ut=this.projectPathToScreenSpace(at,me,C);at=Ut.some(Jt=>Jt.signedDistanceFromCamera<=0)?[]:Ut.map(Jt=>Jt.point)}let Ii=[];if(at.length>0){const Ut=at[0].clone(),Jt=at[0].clone();for(let Ai=1;Ai<at.length;Ai++)Ut.x=Math.min(Ut.x,at[Ai].x),Ut.y=Math.min(Ut.y,at[Ai].y),Jt.x=Math.max(Jt.x,at[Ai].x),Jt.y=Math.max(Jt.y,at[Ai].y);Ii=Ut.x>=Qe.x&&Jt.x<=$e.x&&Ut.y>=Qe.y&&Jt.y<=$e.y?[at]:Jt.x<Qe.x||Ut.x>$e.x||Jt.y<Qe.y||Ut.y>$e.y?[]:u.al([at],Qe.x,Qe.y,$e.x,$e.y)}for(const Ut of Ii){wt.reset(Ut,.25*ct);let Jt=0;Jt=wt.length<=.5*ct?1:Math.ceil(wt.paddedLength/Lt)+1;for(let Ai=0;Ai<Jt;Ai++){const _r=Ai/Math.max(Jt-1,1),Sn=wt.lerp(_r),Ci=Sn.x+jt,Nr=Sn.y+jt;ne.push(Ci,Nr,ct,0);const Tr=Ci-ct,yr=Nr-ct,Ir=Ci+ct,Vn=Nr+ct;if(nt=nt&&this.isOffscreen(Tr,yr,Ir,Vn),Ge=Ge||this.isInsideGrid(Tr,yr,Ir,Vn),e!=="always"&&this.grid.hitTestCircle(Ci,Nr,ct,e,B)&&(ze=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!M&&ze||!Ge||K<this.perspectiveRatioCutoff?[]:ne,offscreen:nt,collisionDetected:ze}}projectPathToScreenSpace(e,n,a){return e.map(l=>ee(l.x,l.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,h=-1/0,y=-1/0;for(const M of e){const z=new u.P(M.x+jt,M.y+jt);a=Math.min(a,z.x),l=Math.min(l,z.y),h=Math.max(h,z.x),y=Math.max(y,z.y),n.push(z)}const x=this.grid.query(a,l,h,y).concat(this.ignoredGrid.query(a,l,h,y)),S={},C={};for(const M of x){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const B=[new u.P(M.x1,M.y1),new u.P(M.x2,M.y1),new u.P(M.x2,M.y2),new u.P(M.x1,M.y2)];u.am(n,B)&&(S[z.bucketInstanceId][z.featureIndex]=!0,C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]=[]),C[z.bucketInstanceId].push(z.featureIndex))}return C}insertCollisionBox(e,n,a,l,h,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,l,h,y){const x=a?this.ignoredGrid:this.grid,S={bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n};for(let C=0;C<e.length;C+=4)x.insertCircle(S,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,n,a,l,h){let y;h?(y=[n,a,h(n,a),1],u.af(y,y,e)):(y=[n,a,0,1],ti(y,y,e));const x=y[3];return{point:new u.P((y[0]/x+1)/2*this.transform.width+jt,(-y[1]/x+1)/2*this.transform.height+jt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x*.5,isOccluded:!1,signedDistanceFromCamera:x}}getPerspectiveRatio(e,n,a,l,h){const y=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,h):ee(n,a,e,h);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,n,a,l){return a<jt||e>=this.screenRightBoundary||l<jt||n>this.screenBottomBoundary}isInsideGrid(e,n,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=u.an([]);return u.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,l,h,y,x,S,C,M){let z=new u.P(1,0),B=new u.P(0,1);const Z=new u.P(e.anchorPointX+x[0],e.anchorPointY+x[1]);if(y&&!h){const nt=this.projectAndGetPerspectiveRatio(a,Z.x+1,Z.y,l,C).point.sub(S.point).unit(),ct=Math.atan(nt.y/nt.x)+(nt.x<0?Math.PI:0),Qe=Math.sin(ct),$e=Math.cos(ct);z=new u.P($e,Qe),B=new u.P(-Qe,$e)}else if(!y&&h){const nt=-this.transform.angle,ct=Math.sin(nt),Qe=Math.cos(nt);z=new u.P(Qe,ct),B=new u.P(-ct,Qe)}let H=S.point,$=n;if(h){H=Z;const nt=this.transform.zoom-Math.floor(this.transform.zoom);$=Math.pow(2,-nt),$*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,l),M||($*=u.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(H=H.add(z.mult(M.x*$)).add(B.mult(M.y*$)));const re=e.x1*$,ne=e.x2*$,le=(re+ne)/2,K=e.y1*$,de=e.y2*$,me=(K+de)/2,be=[{offsetX:re,offsetY:K},{offsetX:le,offsetY:K},{offsetX:ne,offsetY:K},{offsetX:ne,offsetY:me},{offsetX:ne,offsetY:de},{offsetX:le,offsetY:de},{offsetX:re,offsetY:de},{offsetX:re,offsetY:me}];let ze=[];for(const{offsetX:nt,offsetY:ct}of be)ze.push(new u.P(H.x+z.x*nt+B.x*ct,H.y+z.y*nt+B.y*ct));let Ge=!1;if(h){const nt=ze.map(ct=>this.projectAndGetPerspectiveRatio(a,ct.x,ct.y,l,C));Ge=nt.some(ct=>!ct.isOccluded),ze=nt.map(ct=>ct.point)}else Ge=!0;return{box:u.ao(ze),allPointsOccluded:!Ge}}}function Kt(d,e,n){return e*(u.X/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class Ji{constructor(e,n,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(e,n,a,l,h){this.text=new Ji(e?e.text:null,n,a,h),this.icon=new Ji(e?e.icon:null,n,l,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class di{constructor(){this.invProjMatrix=u.H(),this.viewportMatrix=u.H(),this.circles=[]}}class Ri{constructor(e,n,a,l,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=h}}class rr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function cr(d,e,n,a,l){const{horizontalAlign:h,verticalAlign:y}=u.au(d);return new u.P(-(h-.5)*e+a[0]*l,-(y-.5)*n+a[1]*l)}class Pr{constructor(e,n,a,l,h,y){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new ii(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new rr(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,l)=>n.getElevation(e,a,l):null}getBucketParts(e,n,a,l){const h=a.getBucket(n),y=a.latestFeatureIndex;if(!h||!y||n.id!==h.layerIds[0])return;const x=a.collisionBoxArray,S=h.layers[0].layout,C=h.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/u.X,B=a.tileID.toUnwrapped(),Z=this.transform.calculatePosMatrix(B),H=S.get("text-pitch-alignment")==="map",$=S.get("text-rotation-alignment")==="map",re=Kt(a,1,this.transform.zoom),ne=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("text-translate"),C.get("text-translate-anchor")),le=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("icon-translate"),C.get("icon-translate-anchor")),K=is(Z,H,$,this.transform,re);let de=null;if(H){const be=On(Z,H,$,this.transform,re);de=u.L([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[h.bucketInstanceId]=new Ri(h.bucketInstanceId,y,h.sourceLayerIndex,h.index,a.tileID);const me={bucket:h,layout:S,translationText:ne,translationIcon:le,posMatrix:Z,unwrappedTileID:B,textLabelPlaneMatrix:K,labelToScreenMatrix:de,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:u.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(l)for(const be of h.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:nt}=be;e.push({sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:nt,parameters:me})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:me})}attemptAnchorPlacement(e,n,a,l,h,y,x,S,C,M,z,B,Z,H,$,re,ne,le,K){const de=u.aq[e.textAnchor],me=[e.textOffset0,e.textOffset1],be=cr(de,a,l,me,h),ze=this.collisionIndex.placeCollisionBox(n,B,S,C,M,x,y,re,z.predicate,K,be);if((!le||this.collisionIndex.placeCollisionBox(le,B,S,C,M,x,y,ne,z.predicate,K,be).placeable)&&ze.placeable){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),Z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Z.crossTileID]={textOffset:me,width:a,height:l,anchor:de,textBoxScale:h,prevAnchor:Ge},this.markUsedJustification(H,de,Z,$),H.allowVerticalPlacement&&(this.markUsedOrientation(H,$,Z),this.placedOrientations[Z.crossTileID]=$),{shift:be,placedGlyphBoxes:ze}}}placeLayerBucketPart(e,n,a){const{bucket:l,layout:h,translationText:y,translationIcon:x,posMatrix:S,unwrappedTileID:C,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:B,holdingForFade:Z,collisionBoxArray:H,partiallyEvaluatedTextSize:$,collisionGroup:re}=e.parameters,ne=h.get("text-optional"),le=h.get("icon-optional"),K=u.ar(h,"text-overlap","text-allow-overlap"),de=K==="always",me=u.ar(h,"icon-overlap","icon-allow-overlap"),be=me==="always",ze=h.get("text-rotation-alignment")==="map",Ge=h.get("text-pitch-alignment")==="map",nt=h.get("icon-text-fit")!=="none",ct=h.get("symbol-z-order")==="viewport-y",Qe=de&&(be||!l.hasIconData()||le),$e=be&&(de||!l.hasTextData()||ne);!l.collisionArrays&&H&&l.deserializeCollisionBoxes(H);const wt=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),Ft=(tt,at,Lt)=>{var Ii,Ut;if(n[tt.crossTileID])return;if(Z)return void(this.placements[tt.crossTileID]=new Wt(!1,!1,!1));let Jt=!1,Ai=!1,_r=!0,Sn=null,Ci={box:null,placeable:!1,offscreen:null},Nr={box:null,placeable:!1,offscreen:null},Tr=null,yr=null,Ir=null,Vn=0,yo=0,vl=0;at.textFeatureIndex?Vn=at.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Vn=tt.featureIndex),at.verticalTextFeatureIndex&&(yo=at.verticalTextFeatureIndex);const vo=at.textBox;if(vo){const dn=ur=>{let vr=u.ah.horizontal;if(l.allowVerticalPlacement&&!ur&&this.prevPlacement){const en=this.prevPlacement.placedOrientations[tt.crossTileID];en&&(this.placedOrientations[tt.crossTileID]=en,vr=en,this.markUsedOrientation(l,vr,tt))}return vr},pn=(ur,vr)=>{if(l.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&at.verticalTextBox){for(const en of l.writingModes)if(en===u.ah.vertical?(Ci=vr(),Nr=Ci):Ci=ur(),Ci&&Ci.placeable)break}else Ci=ur()},ss=tt.textAnchorOffsetStartIndex,Pn=tt.textAnchorOffsetEndIndex;if(Pn===ss){const ur=(vr,en)=>{const Qt=this.collisionIndex.placeCollisionBox(vr,K,B,S,C,Ge,ze,y,re.predicate,wt);return Qt&&Qt.placeable&&(this.markUsedOrientation(l,en,tt),this.placedOrientations[tt.crossTileID]=en),Qt};pn(()=>ur(vo,u.ah.horizontal),()=>{const vr=at.verticalTextBox;return l.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&vr?ur(vr,u.ah.vertical):{box:null,offscreen:null}}),dn(Ci&&Ci.placeable)}else{let ur=u.aq[(Ut=(Ii=this.prevPlacement)===null||Ii===void 0?void 0:Ii.variableOffsets[tt.crossTileID])===null||Ut===void 0?void 0:Ut.anchor];const vr=(Qt,Ds,xo)=>{const bo=Qt.x2-Qt.x1,lf=Qt.y2-Qt.y1,s_=tt.textBoxScale,cf=nt&&me==="never"?Ds:null;let os=null,uf=K==="never"?1:2,bl="never";ur&&uf++;for(let _a=0;_a<uf;_a++){for(let wl=ss;wl<Pn;wl++){const Sl=l.textAnchorOffsets.get(wl);if(ur&&Sl.textAnchor!==ur)continue;const wo=this.attemptAnchorPlacement(Sl,Qt,bo,lf,s_,ze,Ge,B,S,C,re,bl,tt,l,xo,y,x,cf,wt);if(wo&&(os=wo.placedGlyphBoxes,os&&os.placeable))return Jt=!0,Sn=wo.shift,os}ur?ur=null:bl=K}return a&&!os&&(os={box:this.collisionIndex.placeCollisionBox(vo,"always",B,S,C,Ge,ze,y,re.predicate,wt,new u.P(0,0)).box,offscreen:!1,placeable:!1}),os};pn(()=>vr(vo,at.iconBox,u.ah.horizontal),()=>{const Qt=at.verticalTextBox;return l.allowVerticalPlacement&&(!Ci||!Ci.placeable)&&tt.numVerticalGlyphVertices>0&&Qt?vr(Qt,at.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Ci&&(Jt=Ci.placeable,_r=Ci.offscreen);const en=dn(Ci&&Ci.placeable);if(!Jt&&this.prevPlacement){const Qt=this.prevPlacement.variableOffsets[tt.crossTileID];Qt&&(this.variableOffsets[tt.crossTileID]=Qt,this.markUsedJustification(l,Qt.anchor,tt,en))}}}if(Tr=Ci,Jt=Tr&&Tr.placeable,_r=Tr&&Tr.offscreen,tt.useRuntimeCollisionCircles){const dn=l.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),pn=u.ai(l.textSizeData,$,dn),ss=h.get("text-padding");yr=this.collisionIndex.placeCollisionCircles(K,dn,l.lineVertexArray,l.glyphOffsetArray,pn,S,C,M,z,a,Ge,re.predicate,tt.collisionCircleDiameter,ss,y,wt),yr.circles.length&&yr.collisionDetected&&!a&&u.w("Collisions detected, but collision boxes are not shown"),Jt=de||yr.circles.length>0&&!yr.collisionDetected,_r=_r&&yr.offscreen}if(at.iconFeatureIndex&&(vl=at.iconFeatureIndex),at.iconBox){const dn=pn=>this.collisionIndex.placeCollisionBox(pn,me,B,S,C,Ge,ze,x,re.predicate,wt,nt&&Sn?Sn:void 0);Nr&&Nr.placeable&&at.verticalIconBox?(Ir=dn(at.verticalIconBox),Ai=Ir.placeable):(Ir=dn(at.iconBox),Ai=Ir.placeable),_r=_r&&Ir.offscreen}const hn=ne||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,xl=le||tt.numIconVertices===0;hn||xl?xl?hn||(Ai=Ai&&Jt):Jt=Ai&&Jt:Ai=Jt=Ai&&Jt;const Tu=Ai&&Ir.placeable;if(Jt&&Tr.placeable&&this.collisionIndex.insertCollisionBox(Tr.box,K,h.get("text-ignore-placement"),l.bucketInstanceId,Nr&&Nr.placeable&&yo?yo:Vn,re.ID),Tu&&this.collisionIndex.insertCollisionBox(Ir.box,me,h.get("icon-ignore-placement"),l.bucketInstanceId,vl,re.ID),yr&&Jt&&this.collisionIndex.insertCollisionCircles(yr.circles,K,h.get("text-ignore-placement"),l.bucketInstanceId,Vn,re.ID),a&&this.storeCollisionData(l.bucketInstanceId,Lt,at,Tr,Ir,yr),tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new Wt(Jt||Qe,Ai||$e,_r||l.justReloaded),n[tt.crossTileID]=!0};if(ct){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=l.getSortedSymbolIndexes(this.transform.angle);for(let at=tt.length-1;at>=0;--at){const Lt=tt[at];Ft(l.symbolInstances.get(Lt),l.collisionArrays[Lt],Lt)}}else for(let tt=e.symbolInstanceStart;tt<e.symbolInstanceEnd;tt++)Ft(l.symbolInstances.get(tt),l.collisionArrays[tt],tt);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[l.bucketInstanceId];u.as(tt.invProjMatrix,S),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(e,n,a,l,h,y){if(a.textBox||a.iconBox){let x,S;this.collisionBoxArrays.has(e)?x=this.collisionBoxArrays.get(e):(x=new Map,this.collisionBoxArrays.set(e,x)),x.has(n)?S=x.get(n):(S={text:null,icon:null},x.set(n,S)),a.textBox&&(S.text=l.box),a.iconBox&&(S.icon=h.box)}if(y){let x=this.collisionCircleArrays[e];x===void 0&&(x=this.collisionCircleArrays[e]=new di);for(let S=0;S<y.circles.length;S+=4)x.circles.push(y.circles[S+0]),x.circles.push(y.circles[S+1]),x.circles.push(y.circles[S+2]),x.circles.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,a,l){let h;h=l===u.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[u.at(n)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const x of y)x>=0&&(e.text.placedSymbolArray.get(x).crossTileID=h>=0&&x!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const l=n===u.ah.horizontal||n===u.ah.horizontalOnly?n:0,h=n===u.ah.vertical?n:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const x of y)e.text.placedSymbolArray.get(x).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},y=n?n.variableOffsets:{},x=n?n.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],M=h[S];M?(this.opacities[S]=new Bi(M,l,C.text,C.icon),a=a||C.text!==M.text.placed||C.icon!==M.icon.placed):(this.opacities[S]=new Bi(null,l,C.text,C.icon,C.skipFade),a=a||C.text||C.icon)}for(const S in h){const C=h[S];if(!this.opacities[S]){const M=new Bi(C,l,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||C.text.placed||C.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in x)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=x[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const l of n){const h=l.getBucket(e);h&&l.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,n,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],y=h.layout,x=new Bi(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),C=y.get("icon-allow-overlap"),M=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",Z=y.get("icon-text-fit")!=="none",H=new Bi(null,0,S&&(C||!e.hasIconData()||y.get("icon-optional")),C&&(S||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const $=(ne,le,K)=>{for(let de=0;de<le/4;de++)ne.opacityVertexArray.emplaceBack(K);ne.hasVisibleVertices=ne.hasVisibleVertices||K!==Js},re=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ne=0;ne<e.symbolInstances.length;ne++){const le=e.symbolInstances.get(ne),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:de,crossTileID:me}=le;let be=this.opacities[me];a[me]?be=x:be||(be=H,this.opacities[me]=be),a[me]=!0;const ze=le.numIconVertices>0,Ge=this.placedOrientations[le.crossTileID],nt=Ge===u.ah.vertical,ct=Ge===u.ah.horizontal||Ge===u.ah.horizontalOnly;if(K>0||de>0){const $e=Yr(be.text);$(e.text,K,nt?Js:$e),$(e.text,de,ct?Js:$e);const wt=be.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(at=>{at>=0&&(e.text.placedSymbolArray.get(at).hidden=wt||nt?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=wt||ct?1:0);const Ft=this.variableOffsets[le.crossTileID];Ft&&this.markUsedJustification(e,Ft.anchor,le,Ge);const tt=this.placedOrientations[le.crossTileID];tt&&(this.markUsedJustification(e,"left",le,tt),this.markUsedOrientation(e,tt,le))}if(ze){const $e=Yr(be.icon),wt=!(Z&&le.verticalPlacedIconSymbolIndex&&nt);le.placedIconSymbolIndex>=0&&($(e.icon,le.numIconVertices,wt?$e:Js),e.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=be.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&($(e.icon,le.numVerticalIconVertices,wt?Js:$e),e.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=be.icon.isHidden())}const Qe=re&&re.has(ne)?re.get(ne):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const $e=e.collisionArrays[ne];if($e){let wt=new u.P(0,0);if($e.textBox||$e.verticalTextBox){let Ft=!0;if(M){const tt=this.variableOffsets[me];tt?(wt=cr(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),z&&wt._rotate(B?this.transform.angle:-this.transform.angle)):Ft=!1}if($e.textBox||$e.verticalTextBox){let tt;$e.textBox&&(tt=nt),$e.verticalTextBox&&(tt=ct),Ks(e.textCollisionBox.collisionVertexArray,be.text.placed,!Ft||tt,Qe.text,wt.x,wt.y)}}if($e.iconBox||$e.verticalIconBox){const Ft=!!(!ct&&$e.verticalIconBox);let tt;$e.iconBox&&(tt=Ft),$e.verticalIconBox&&(tt=!Ft),Ks(e.iconCollisionBox.collisionVertexArray,be.icon.placed,tt,Qe.icon,Z?wt.x:0,Z?wt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ne.invProjMatrix,e.placementViewportMatrix=ne.viewportMatrix,e.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function Ks(d,e,n,a,l,h){a&&a.length!==0||(a=[0,0,0,0]);const y=a[0]-jt,x=a[1]-jt,S=a[2]-jt,C=a[3]-jt;d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,x),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,x),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,C),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,C)}const pi=Math.pow(2,25),Oc=Math.pow(2,24),Fc=Math.pow(2,17),Kr=Math.pow(2,16),Jr=Math.pow(2,9),Dg=Math.pow(2,8),an=Math.pow(2,1);function Yr(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*pi+e*Oc+n*Fc+e*Kr+n*Jr+e*Dg+n*an+e}const Js=0;function bs(){return{isOccluded:(d,e,n)=>!1,getPitchedTextCorrection:(d,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(d,e,n,a){throw new Error("Not implemented.")},translatePosition:(d,e,n,a)=>function(l,h,y,x,S=!1){if(!y[0]&&!y[1])return[0,0];const C=S?x==="map"?l.angle:0:x==="viewport"?-l.angle:0;if(C){const M=Math.sin(C),z=Math.cos(C);y=[y[0]*z-y[1]*M,y[0]*M+y[1]*z]}return[S?y[0]:Kt(h,y[0],l.zoom),S?y[1]:Kt(h,y[1],l.zoom)]}(d,e,n,a),getCircleRadiusCorrection:d=>1}}class Yi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,l,h){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((x,S)=>x.sortKey-S.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class Qo{constructor(e,n,a,l,h,y,x,S){this.placement=new Pr(e,bs(),n,y,x,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const l=j.now(),h=()=>!this._forceFullPlacement&&j.now()-l>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=x)&&(!y.maxzoom||y.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Yi(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const yn=512/u.X/2;class Hi{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let h=0;h<n.length;h++){const y=n.get(h),x=y.key,S=l.get(x);S?S.push(y):l.set(x,[y])}for(const[h,y]of l){const x={positions:y.map(S=>({x:Math.floor(S.anchorX*yn),y:Math.floor(S.anchorY*yn)})),crossTileIDs:y.map(S=>S.crossTileID)};if(x.positions.length>128){const S=new u.av(x.positions.length,16,Uint16Array);for(const{x:C,y:M}of x.positions)S.add(C,M);S.finish(),delete x.positions,x.index=S}this._symbolsByKey[h]=x}}getScaledCoordinates(e,n){const{x:a,y:l,z:h}=this.tileID.canonical,{x:y,y:x,z:S}=n.canonical,C=yn/Math.pow(2,S-h),M=(x*u.X+e.anchorY)*C,z=l*u.X*yn;return{x:Math.floor((y*u.X+e.anchorX)*C-a*u.X*yn),y:Math.floor(M-z)}}findMatches(e,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const y=e.get(h);if(y.crossTileID)continue;const x=this._symbolsByKey[y.key];if(!x)continue;const S=this.getScaledCoordinates(y,n);if(x.index){const C=x.index.range(S.x-l,S.y-l,S.x+l,S.y+l).sort();for(const M of C){const z=x.crossTileIDs[M];if(!a[z]){a[z]=!0,y.crossTileID=z;break}}}else if(x.positions)for(let C=0;C<x.positions.length;C++){const M=x.positions[C],z=x.crossTileIDs[C];if(Math.abs(M.x-S.x)<=l&&Math.abs(M.y-S.y)<=l&&!a[z]){a[z]=!0,y.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ua{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],h={};for(const y in l){const x=l[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+n),h[x.tileID.key]=x}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const y=this.indexes[h];if(Number(h)>e.overscaledZ)for(const x in y){const S=y[x];S.tileID.isChildOf(e)&&S.findMatches(n.symbolInstances,e,l)}else{const x=y[e.scaledTo(Number(h)).key];x&&x.findMatches(n.symbolInstances,e,l)}}for(let h=0;h<n.symbolInstances.length;h++){const y=n.symbolInstances.get(h);y.crossTileID||(y.crossTileID=a.generate(),l[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Hi(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const h in l)e[l[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[h]),delete l[h],n=!0)}return n}}class Bc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ua,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new vn);let h=!1;const y={};l.handleWrapJump(a);for(const x of n){const S=x.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(x.tileID,S,this.crossTileIDs)&&(h=!0),y[S.bucketInstanceId]=!0)}return l.removeStaleBuckets(y)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const xn=(d,e)=>u.t(d,e&&e.filter(n=>n.identifier!=="source.canvas")),Rg=u.aw();class qa extends u.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Wr(ar(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new Re,this.imageManager.setEventedParent(this),this.glyphManager=new _t(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new vi(256,512),this.crossTileSymbolIndex=new Bc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ay()),Rn().on(He,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const h=l.getSource();if(h&&h.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===h.id&&this._validateLayer(x)}})}loadURL(e,n={},a){this.fire(new u.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;u.h(l,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,a)}).catch(y=>{this._loadStyleRequest=null,y&&!h.signal.aborted&&this.fire(new u.j(y))})}loadJSON(e,n={},a){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Rg,{validate:!1})}_load(e,n,a){var l;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!xn(this,u.u(h))){this._loaded=!0,this.stylesheet=h;for(const y in h.sources)this.addSource(y,h.sources[y],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new xt(this.stylesheet.light),this.sky=new qt(this.stylesheet.sky),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const e=u.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=u.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,y,x,S){return u._(this,void 0,void 0,function*(){const C=We(h),M=x>1?"@2x":"",z={},B={};for(const{id:Z,url:H}of C){const $=y.transformRequest(mt(H,M,".json"),"SpriteJSON");z[Z]=u.h($,S);const re=y.transformRequest(mt(H,M,".png"),"SpriteImage");B[Z]=Ee.getImage(re,S)}return yield Promise.all([...Object.values(z),...Object.values(B)]),function(Z,H){return u._(this,void 0,void 0,function*(){const $={};for(const re in Z){$[re]={};const ne=j.getImageCanvasContext((yield H[re]).data),le=(yield Z[re]).data;for(const K in le){const{width:de,height:me,x:be,y:ze,sdf:Ge,pixelRatio:nt,stretchX:ct,stretchY:Qe,content:$e,textFitWidth:wt,textFitHeight:Ft}=le[K];$[re][K]={data:null,pixelRatio:nt,sdf:Ge,stretchX:ct,stretchY:Qe,content:$e,textFitWidth:wt,textFitHeight:Ft,spriteData:{width:de,height:me,x:be,y:ze,context:ne}}}}return $})}(z,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const y in h){this._spritesImagesIds[y]=[];const x=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(S=>!(S in h)):[];for(const S of x)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in h[y]){const C=y==="default"?S:`${y}:${S}`;this._spritesImagesIds[y].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,h[y][S],!1):this.imageManager.addImage(C,h[y][S]),n&&(this._changedImages[C]=!0)}}}).catch(h=>{this._spriteRequest=null,l=h,this.fire(new u.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new u.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?u.aB(a):a);const l=[];for(const h of e)if(a[h]){const y=n?u.aB(a[h]):a[h];l.push(y)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const l=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(l.length||h.length)&&this._updateWorkerLayers(l,h);for(const y in this._updatedSources){const x=this._updatedSources[y];if(x==="reload")this._reloadSource(y);else{if(x!=="clear")throw new Error(`Invalid action ${x}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const h=this.sourceCaches[l];a[l]=h.used,h.used=!1}for(const l of this._order){const h=this._layers[l];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const l in a){const h=this.sourceCaches[l];!!a[l]!=!!h.used&&h.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const l=this.serialize();if(e=n.transformStyle?n.transformStyle(l,e):e,((a=n.validate)===null||a===void 0||a)&&xn(this,u.u(e)))return!1;(e=u.aB(e)).layers=u.az(e.layers);const h=u.aC(l,e),y=this._getOperationsToPerform(h);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const x of y.operations)x();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setSky":n.push(()=>this.setSky.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(u.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[e]=new Rt(e,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new u.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new u.j(new Error(`Layer "${l}" already exists on this map.`)));let h;if(e.type==="custom"){if(xn(this,u.aD(e)))return;h=u.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=u.aB(e),e=u.e(e,{source:l})),this._validate(u.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;h=u.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:l}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new u.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,l),this._layerOrderChanged=!0,this._layers[l]=h,this._removedLayers[l]&&h.source&&h.type!=="custom"){const x=this._removedLayers[l];delete this._removedLayers[l],x.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new u.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!u.aE(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(u.u.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=u.aB(n),this._updateLayer(l)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?u.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,l),this._updateLayer(h)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?u.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,l)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,l=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)));const y=h.getSource().type;y==="geojson"&&l?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||l?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(l,e.id,n)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new u.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=l.getSource().type,y=h==="vector"?e.sourceLayer:void 0;h!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(y,e.id,n):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return u.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",a={},l=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(n(x)){a[x]=y;for(const S of e){const C=S[x];if(C)for(const M of C)l.push(M)}}}l.sort((y,x)=>x.intersectionZ-y.intersectionZ);const h=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(n(x))for(let S=l.length-1;S>=0;S--){const C=l[S].feature;if(a[C.layer.id]<y)break;h.push(C),l.pop()}else for(const S of e){const C=S[x];if(C)for(const M of C)h.push(M.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(u.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const x of n.layers){const S=this._layers[x];if(!S)return this.fire(new u.j(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];l[S.source]=!0}}const h=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers();for(const x in this.sourceCaches)n.layers&&!l[x]||h.push(Dr(this.sourceCaches[x],this._layers,y,e,n,a));return this.placement&&h.push(function(x,S,C,M,z,B,Z){const H={},$=B.queryRenderedSymbols(M),re=[];for(const ne of Object.keys($).map(Number))re.push(Z[ne]);re.sort(vt);for(const ne of re){const le=ne.featureIndex.lookupSymbolFeatures($[ne.bucketInstanceId],S,ne.bucketIndex,ne.sourceLayerIndex,z.filter,z.layers,z.availableImages,x);for(const K in le){const de=H[K]=H[K]||[],me=le[K];me.sort((be,ze)=>{const Ge=ne.featureSortOrder;if(Ge){const nt=Ge.indexOf(be.featureIndex);return Ge.indexOf(ze.featureIndex)-nt}return ze.featureIndex-be.featureIndex});for(const be of me)de.push(be)}}for(const ne in H)H[ne].forEach(le=>{const K=le.feature,de=C[x[ne].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=de});return H}(this._layers,y,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(u.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(l,h){const y=l.getRenderableIds().map(C=>l.getTileByID(C)),x=[],S={};for(let C=0;C<y.length;C++){const M=y[C],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(x,h))}return x}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const y in e)if(!u.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:j.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const y in e)if(!u.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:j.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,l,h={}){return(!h||h.validate!==!1)&&xn(this,e.call(u.u,u.e({key:n,style:this.serialize(),value:a,styleSpec:u.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Rn().off(He,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,l,h=!1){let y=!1,x=!1;const S={};for(const C of this._order){const M=this._layers[C];if(M.type!=="symbol")continue;if(!S[M.source]){const B=this.sourceCaches[M.source];S[M.source]=B.getRenderableIds(!0).map(Z=>B.getTileByID(Z)).sort((Z,H)=>H.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(j.now(),e.zoom))&&(this.pauseablePlacement=new Qo(e,this.map.terrain,this._order,h,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(j.now()),x=!0),y&&this.pauseablePlacement.placement.setStale()),x||y)for(const C of this._order){const M=this._layers[C];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(j.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return u._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return u._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(u.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},l){this._checkLoaded();const h=[{id:e,url:n}],y=[...We(this.stylesheet.sprite),...h];this._validate(u.u.sprite,"sprite",y,null,a)||(this.stylesheet.sprite=y,this._loadSprite(h,!0,l))}removeSprite(e){this._checkLoaded();const n=We(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return We(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(u.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var ws=u.Y([{name:"a_pos",type:"Int16",components:2}]);const rs={prelude:oi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:oi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:oi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:oi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:oi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:oi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:oi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:oi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:oi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:oi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:oi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:oi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:oi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:oi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:oi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:oi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:oi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:oi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:oi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:oi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:oi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:oi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:oi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:oi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:oi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:oi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:oi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:oi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function oi(d,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),l=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=h?h.concat(l):l,x={};return{fragmentSource:d=d.replace(n,(S,C,M,z,B)=>(x[B]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(n,(S,C,M,z,B)=>{const Z=z==="float"?"vec2":"vec4",H=B.match(/color/)?"color":Z;return x[B]?C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${Z} a_${B};
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${Z} a_${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Nc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,l,h,y,x,S,C){this.context=e;let M=this.boundPaintVertexBuffers.length!==l.length;for(let z=0;!M&&z<l.length;z++)this.boundPaintVertexBuffers[z]!==l[z]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==h||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==x||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,a,l,h,y,x,S,C):(e.bindVertexArray.set(this.vao),x&&x.bind(),h&&h.dynamicDraw&&h.bind(),S&&S.bind(),C&&C.bind())}freshBind(e,n,a,l,h,y,x,S){const C=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=x,this.boundDynamicVertexBuffer3=S,n.enableAttributes(z,e);for(const B of a)B.enableAttributes(z,e);y&&y.enableAttributes(z,e),x&&x.enableAttributes(z,e),S&&S.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,h);for(const B of a)B.bind(),B.setVertexAttribPointers(z,e,h);y&&(y.bind(),y.setVertexAttribPointers(z,e,h)),l&&l.bind(),x&&(x.bind(),x.setVertexAttribPointers(z,e,h)),S&&(S.bind(),S.setVertexAttribPointers(z,e,h)),M.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Vc=(d,e,n,a,l)=>({u_matrix:d,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):u.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):u.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function Ys(d){const e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const a=d[n].split(" ");e.push(a.pop())}return e}class jc{constructor(e,n,a,l,h,y){const x=e.gl;this.program=x.createProgram();const S=Ys(n.staticAttributes),C=a?a.getBinderAttributes():[],M=S.concat(C),z=rs.prelude.staticUniforms?Ys(rs.prelude.staticUniforms):[],B=n.staticUniforms?Ys(n.staticUniforms):[],Z=a?a.getBinderUniforms():[],H=z.concat(B).concat(Z),$=[];for(const be of H)$.indexOf(be)<0&&$.push(be);const re=a?a.defines():[];h&&re.push("#define OVERDRAW_INSPECTOR;"),y&&re.push("#define TERRAIN3D;");const ne=re.concat(rs.prelude.fragmentSource,n.fragmentSource).join(`
`),le=re.concat(rs.prelude.vertexSource,n.vertexSource).join(`
`),K=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(K,ne),x.compileShader(K),!x.getShaderParameter(K,x.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${x.getShaderInfoLog(K)}`);x.attachShader(this.program,K);const de=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);if(x.shaderSource(de,le),x.compileShader(de),!x.getShaderParameter(de,x.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${x.getShaderInfoLog(de)}`);x.attachShader(this.program,de),this.attributes={};const me={};this.numAttributes=M.length;for(let be=0;be<this.numAttributes;be++)M[be]&&(x.bindAttribLocation(this.program,be,M[be]),this.attributes[M[be]]=be);if(x.linkProgram(this.program),!x.getProgramParameter(this.program,x.LINK_STATUS))throw new Error(`Program failed to link: ${x.getProgramInfoLog(this.program)}`);x.deleteShader(de),x.deleteShader(K);for(let be=0;be<$.length;be++){const ze=$[be];if(ze&&!me[ze]){const Ge=x.getUniformLocation(this.program,ze);Ge&&(me[ze]=Ge)}}this.fixedUniforms=l(e,me),this.terrainUniforms=((be,ze)=>({u_depth:new u.aH(be,ze.u_depth),u_terrain:new u.aH(be,ze.u_terrain),u_terrain_dim:new u.aI(be,ze.u_terrain_dim),u_terrain_matrix:new u.aJ(be,ze.u_terrain_matrix),u_terrain_unpack:new u.aK(be,ze.u_terrain_unpack),u_terrain_exaggeration:new u.aI(be,ze.u_terrain_exaggeration)}))(e,me),this.binderUniforms=a?a.getUniforms(e,me):[]}draw(e,n,a,l,h,y,x,S,C,M,z,B,Z,H,$,re,ne,le){const K=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(h),e.setCullFace(y),S){e.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),e.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(S[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(x[me]);$&&$.setUniforms(e,this.binderUniforms,Z,{zoom:H});let de=0;switch(n){case K.LINES:de=2;break;case K.TRIANGLES:de=3;break;case K.LINE_STRIP:de=1}for(const me of B.get()){const be=me.vaos||(me.vaos={});(be[C]||(be[C]=new Nc)).bind(e,this,M,$?$.getPaintVertexBuffers():[],z,me.vertexOffset,re,ne,le),K.drawElements(n,me.primitiveLength*de,K.UNSIGNED_SHORT,me.primitiveOffset*de*2)}}}function Za(d,e,n){const a=1/Kt(n,1,e.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/l,y=h*(n.tileID.canonical.x+n.tileID.wrap*l),x=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x]}}const ea=(d,e,n,a)=>{const l=e.style.light,h=l.properties.get("position"),y=[h.x,h.y,h.z],x=function(){var C=new u.A(9);return u.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();l.properties.get("anchor")==="viewport"&&function(C,M){var z=Math.sin(M),B=Math.cos(M);C[0]=B,C[1]=z,C[2]=0,C[3]=-z,C[4]=B,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(x,-e.transform.angle),function(C,M,z){var B=M[0],Z=M[1],H=M[2];C[0]=B*z[0]+Z*z[3]+H*z[6],C[1]=B*z[1]+Z*z[4]+H*z[7],C[2]=B*z[2]+Z*z[5]+H*z[8]}(y,y,x);const S=l.properties.get("color");return{u_matrix:d,u_lightpos:y,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:a}},Ga=(d,e,n,a,l,h,y)=>u.e(ea(d,e,n,a),Za(h,e,y),{u_height_factor:-Math.pow(2,l.overscaledZ)/y.tileSize/8}),$s=d=>({u_matrix:d}),Cp=(d,e,n,a)=>u.e($s(d),Za(n,e,a)),Lg=(d,e)=>({u_matrix:d,u_world:e}),Ep=(d,e,n,a,l)=>u.e(Cp(d,e,n,a),{u_world:l}),Og=(d,e,n,a)=>{const l=d.transform;let h,y;if(a.paint.get("circle-pitch-alignment")==="map"){const x=Kt(n,1,l.zoom);h=!0,y=[x,x]}else h=!1,y=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:y}},Ss=(d,e,n)=>({u_matrix:d,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),ta=(d,e,n=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:n}),Fr=d=>({u_matrix:d}),Br=(d,e,n,a)=>({u_matrix:d,u_extrude_scale:Kt(e,1,n),u_intensity:a}),Wa=(d,e,n,a)=>{const l=u.H();u.aP(l,0,d.width,d.height,0,0,1);const h=d.context.gl;return{u_matrix:l,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function Ha(d,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new u.Z(0,a/n).toLngLat().lat,new u.Z(0,(a+1)/n).toLngLat().lat]}const Xa=(d,e,n,a)=>{const l=d.transform;return{u_matrix:zp(d,e,n,a),u_ratio:1/Kt(e,1,l.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},kp=(d,e,n,a,l)=>u.e(Xa(d,e,n,l),{u_image:0,u_image_height:a}),Qs=(d,e,n,a,l)=>{const h=d.transform,y=Mp(e,h);return{u_matrix:zp(d,e,n,l),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Kt(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Fg=(d,e,n,a,l,h)=>{const y=d.lineAtlas,x=Mp(e,d.transform),S=n.layout.get("line-cap")==="round",C=y.getDash(a.from,S),M=y.getDash(a.to,S),z=C.width*l.fromScale,B=M.width*l.toScale;return u.e(Xa(d,e,n,h),{u_patternscale_a:[x/z,-C.height/2],u_patternscale_b:[x/B,-M.height/2],u_sdfgamma:y.width/(256*Math.min(z,B)*d.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:M.y,u_mix:l.t})};function Mp(d,e){return 1/Kt(d,1,e.tileZoom)}function zp(d,e,n,a){return d.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Bg=(d,e,n,a,l)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(h=l.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:Ng(l.paint.get("raster-hue-rotate"))};var h,y};function Ng(d){d*=Math.PI/180;const e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Dp=(d,e,n,a,l,h,y,x,S,C,M,z,B,Z)=>{const H=y.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:h,u_texsize:B,u_texture:0,u_translation:M,u_pitched_scale:Z}},ia=(d,e,n,a,l,h,y,x,S,C,M,z,B,Z,H)=>{const $=y.transform;return u.e(Dp(d,e,n,a,l,h,y,x,S,C,M,z,B,H),{u_gamma_scale:a?Math.cos($._pitch)*$.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+Z})},Uc=(d,e,n,a,l,h,y,x,S,C,M,z,B,Z)=>u.e(ia(d,e,n,a,l,h,y,x,S,C,M,!0,z,!0,Z),{u_texsize_icon:B,u_texture_icon:1}),Ka=(d,e,n)=>({u_matrix:d,u_opacity:e,u_color:n}),qc=(d,e,n,a,l,h)=>u.e(function(y,x,S,C){const M=S.imageManager.getPattern(y.from.toString()),z=S.imageManager.getPattern(y.to.toString()),{width:B,height:Z}=S.imageManager.getPixelSize(),H=Math.pow(2,C.tileID.overscaledZ),$=C.tileSize*Math.pow(2,S.transform.tileZoom)/H,re=$*(C.tileID.canonical.x+C.tileID.wrap*H),ne=$*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,Z],u_mix:x.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/Kt(C,1,S.transform.tileZoom),u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}}(a,h,n,l),{u_matrix:d,u_opacity:e}),Zc={fillExtrusion:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_lightpos:new u.aN(d,e.u_lightpos),u_lightintensity:new u.aI(d,e.u_lightintensity),u_lightcolor:new u.aN(d,e.u_lightcolor),u_vertical_gradient:new u.aI(d,e.u_vertical_gradient),u_opacity:new u.aI(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_lightpos:new u.aN(d,e.u_lightpos),u_lightintensity:new u.aI(d,e.u_lightintensity),u_lightcolor:new u.aN(d,e.u_lightcolor),u_vertical_gradient:new u.aI(d,e.u_vertical_gradient),u_height_factor:new u.aI(d,e.u_height_factor),u_image:new u.aH(d,e.u_image),u_texsize:new u.aO(d,e.u_texsize),u_pixel_coord_upper:new u.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(d,e.u_pixel_coord_lower),u_scale:new u.aN(d,e.u_scale),u_fade:new u.aI(d,e.u_fade),u_opacity:new u.aI(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_image:new u.aH(d,e.u_image),u_texsize:new u.aO(d,e.u_texsize),u_pixel_coord_upper:new u.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(d,e.u_pixel_coord_lower),u_scale:new u.aN(d,e.u_scale),u_fade:new u.aI(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_world:new u.aO(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_world:new u.aO(d,e.u_world),u_image:new u.aH(d,e.u_image),u_texsize:new u.aO(d,e.u_texsize),u_pixel_coord_upper:new u.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(d,e.u_pixel_coord_lower),u_scale:new u.aN(d,e.u_scale),u_fade:new u.aI(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new u.aI(d,e.u_camera_to_center_distance),u_scale_with_map:new u.aH(d,e.u_scale_with_map),u_pitch_with_map:new u.aH(d,e.u_pitch_with_map),u_extrude_scale:new u.aO(d,e.u_extrude_scale),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_matrix:new u.aJ(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_pixel_extrude_scale:new u.aO(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_inv_matrix:new u.aJ(d,e.u_inv_matrix),u_camera_to_center_distance:new u.aI(d,e.u_camera_to_center_distance),u_viewport_size:new u.aO(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new u.aL(d,e.u_color),u_matrix:new u.aJ(d,e.u_matrix),u_overlay:new u.aH(d,e.u_overlay),u_overlay_scale:new u.aI(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new u.aI(d,e.u_extrude_scale),u_intensity:new u.aI(d,e.u_intensity),u_matrix:new u.aJ(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_world:new u.aO(d,e.u_world),u_image:new u.aH(d,e.u_image),u_color_ramp:new u.aH(d,e.u_color_ramp),u_opacity:new u.aI(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_image:new u.aH(d,e.u_image),u_latrange:new u.aO(d,e.u_latrange),u_light:new u.aO(d,e.u_light),u_shadow:new u.aL(d,e.u_shadow),u_highlight:new u.aL(d,e.u_highlight),u_accent:new u.aL(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_image:new u.aH(d,e.u_image),u_dimension:new u.aO(d,e.u_dimension),u_zoom:new u.aI(d,e.u_zoom),u_unpack:new u.aK(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_ratio:new u.aI(d,e.u_ratio),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_ratio:new u.aI(d,e.u_ratio),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(d,e.u_units_to_pixels),u_image:new u.aH(d,e.u_image),u_image_height:new u.aI(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_texsize:new u.aO(d,e.u_texsize),u_ratio:new u.aI(d,e.u_ratio),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_image:new u.aH(d,e.u_image),u_units_to_pixels:new u.aO(d,e.u_units_to_pixels),u_scale:new u.aN(d,e.u_scale),u_fade:new u.aI(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_ratio:new u.aI(d,e.u_ratio),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(d,e.u_units_to_pixels),u_patternscale_a:new u.aO(d,e.u_patternscale_a),u_patternscale_b:new u.aO(d,e.u_patternscale_b),u_sdfgamma:new u.aI(d,e.u_sdfgamma),u_image:new u.aH(d,e.u_image),u_tex_y_a:new u.aI(d,e.u_tex_y_a),u_tex_y_b:new u.aI(d,e.u_tex_y_b),u_mix:new u.aI(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_tl_parent:new u.aO(d,e.u_tl_parent),u_scale_parent:new u.aI(d,e.u_scale_parent),u_buffer_scale:new u.aI(d,e.u_buffer_scale),u_fade_t:new u.aI(d,e.u_fade_t),u_opacity:new u.aI(d,e.u_opacity),u_image0:new u.aH(d,e.u_image0),u_image1:new u.aH(d,e.u_image1),u_brightness_low:new u.aI(d,e.u_brightness_low),u_brightness_high:new u.aI(d,e.u_brightness_high),u_saturation_factor:new u.aI(d,e.u_saturation_factor),u_contrast_factor:new u.aI(d,e.u_contrast_factor),u_spin_weights:new u.aN(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new u.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(d,e.u_is_size_feature_constant),u_size_t:new u.aI(d,e.u_size_t),u_size:new u.aI(d,e.u_size),u_camera_to_center_distance:new u.aI(d,e.u_camera_to_center_distance),u_pitch:new u.aI(d,e.u_pitch),u_rotate_symbol:new u.aH(d,e.u_rotate_symbol),u_aspect_ratio:new u.aI(d,e.u_aspect_ratio),u_fade_change:new u.aI(d,e.u_fade_change),u_matrix:new u.aJ(d,e.u_matrix),u_label_plane_matrix:new u.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(d,e.u_coord_matrix),u_is_text:new u.aH(d,e.u_is_text),u_pitch_with_map:new u.aH(d,e.u_pitch_with_map),u_is_along_line:new u.aH(d,e.u_is_along_line),u_is_variable_anchor:new u.aH(d,e.u_is_variable_anchor),u_texsize:new u.aO(d,e.u_texsize),u_texture:new u.aH(d,e.u_texture),u_translation:new u.aO(d,e.u_translation),u_pitched_scale:new u.aI(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new u.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(d,e.u_is_size_feature_constant),u_size_t:new u.aI(d,e.u_size_t),u_size:new u.aI(d,e.u_size),u_camera_to_center_distance:new u.aI(d,e.u_camera_to_center_distance),u_pitch:new u.aI(d,e.u_pitch),u_rotate_symbol:new u.aH(d,e.u_rotate_symbol),u_aspect_ratio:new u.aI(d,e.u_aspect_ratio),u_fade_change:new u.aI(d,e.u_fade_change),u_matrix:new u.aJ(d,e.u_matrix),u_label_plane_matrix:new u.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(d,e.u_coord_matrix),u_is_text:new u.aH(d,e.u_is_text),u_pitch_with_map:new u.aH(d,e.u_pitch_with_map),u_is_along_line:new u.aH(d,e.u_is_along_line),u_is_variable_anchor:new u.aH(d,e.u_is_variable_anchor),u_texsize:new u.aO(d,e.u_texsize),u_texture:new u.aH(d,e.u_texture),u_gamma_scale:new u.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_is_halo:new u.aH(d,e.u_is_halo),u_translation:new u.aO(d,e.u_translation),u_pitched_scale:new u.aI(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new u.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(d,e.u_is_size_feature_constant),u_size_t:new u.aI(d,e.u_size_t),u_size:new u.aI(d,e.u_size),u_camera_to_center_distance:new u.aI(d,e.u_camera_to_center_distance),u_pitch:new u.aI(d,e.u_pitch),u_rotate_symbol:new u.aH(d,e.u_rotate_symbol),u_aspect_ratio:new u.aI(d,e.u_aspect_ratio),u_fade_change:new u.aI(d,e.u_fade_change),u_matrix:new u.aJ(d,e.u_matrix),u_label_plane_matrix:new u.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(d,e.u_coord_matrix),u_is_text:new u.aH(d,e.u_is_text),u_pitch_with_map:new u.aH(d,e.u_pitch_with_map),u_is_along_line:new u.aH(d,e.u_is_along_line),u_is_variable_anchor:new u.aH(d,e.u_is_variable_anchor),u_texsize:new u.aO(d,e.u_texsize),u_texsize_icon:new u.aO(d,e.u_texsize_icon),u_texture:new u.aH(d,e.u_texture),u_texture_icon:new u.aH(d,e.u_texture_icon),u_gamma_scale:new u.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(d,e.u_device_pixel_ratio),u_is_halo:new u.aH(d,e.u_is_halo),u_translation:new u.aO(d,e.u_translation),u_pitched_scale:new u.aI(d,e.u_pitched_scale)}),background:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_opacity:new u.aI(d,e.u_opacity),u_color:new u.aL(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_opacity:new u.aI(d,e.u_opacity),u_image:new u.aH(d,e.u_image),u_pattern_tl_a:new u.aO(d,e.u_pattern_tl_a),u_pattern_br_a:new u.aO(d,e.u_pattern_br_a),u_pattern_tl_b:new u.aO(d,e.u_pattern_tl_b),u_pattern_br_b:new u.aO(d,e.u_pattern_br_b),u_texsize:new u.aO(d,e.u_texsize),u_mix:new u.aI(d,e.u_mix),u_pattern_size_a:new u.aO(d,e.u_pattern_size_a),u_pattern_size_b:new u.aO(d,e.u_pattern_size_b),u_scale_a:new u.aI(d,e.u_scale_a),u_scale_b:new u.aI(d,e.u_scale_b),u_pixel_coord_upper:new u.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aI(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_texture:new u.aH(d,e.u_texture),u_ele_delta:new u.aI(d,e.u_ele_delta),u_fog_matrix:new u.aJ(d,e.u_fog_matrix),u_fog_color:new u.aL(d,e.u_fog_color),u_fog_ground_blend:new u.aI(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.aI(d,e.u_fog_ground_blend_opacity),u_horizon_color:new u.aL(d,e.u_horizon_color),u_horizon_fog_blend:new u.aI(d,e.u_horizon_fog_blend)}),terrainDepth:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_ele_delta:new u.aI(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new u.aJ(d,e.u_matrix),u_texture:new u.aH(d,e.u_texture),u_terrain_coords_id:new u.aI(d,e.u_terrain_coords_id),u_ele_delta:new u.aI(d,e.u_ele_delta)}),sky:(d,e)=>({u_sky_color:new u.aL(d,e.u_sky_color),u_horizon_color:new u.aL(d,e.u_horizon_color),u_horizon:new u.aI(d,e.u_horizon),u_sky_horizon_blend:new u.aI(d,e.u_sky_horizon_blend)})};class Fn{constructor(e,n,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vg={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gc{constructor(e,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,n,a){for(let l=0;l<this.attributes.length;l++){const h=this.attributes[l],y=n.attributes[h.name];y!==void 0&&e.vertexAttribPointer(y,h.components,e[Vg[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ps=new WeakMap;function ns(d){var e;if(Ps.has(d))return Ps.get(d);{const n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ps.set(d,n),n}}class li{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ja extends li{getDefault(){return u.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class jg extends li{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class eo extends li{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ug extends li{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Rp extends li{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class qg extends li{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Lp extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Wc extends li{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Op extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Fp extends li{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bp extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Np extends li{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ts extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Vp extends li{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Zg extends li{getDefault(){return u.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class jp extends li{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ra extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Gg extends li{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Ya extends li{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Wg extends li{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Hg extends li{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Up extends li{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class qp extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Zp extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Hc extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Gp extends li{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $a extends li{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Gn extends li{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;ns(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Xc extends li{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Kc extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Jc extends li{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Qa extends li{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Yc extends Qa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Is extends Qa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class $c extends Qa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Xg{constructor(e,n,a,l,h){this.context=e,this.width=n,this.height=a;const y=e.gl,x=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Yc(e,x),l)this.depthAttachment=h?new $c(e,x):new Is(e,x);else if(h)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class qi{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}qi.Replace=[1,0],qi.disabled=new qi(qi.Replace,u.aM.transparent,[!1,!1,!1,!1]),qi.unblended=new qi(qi.Replace,u.aM.transparent,[!0,!0,!0,!0]),qi.alphaBlended=new qi([1,771],u.aM.transparent,[!0,!0,!0,!0]);class Kg{constructor(e){var n,a;if(this.gl=e,this.clearColor=new Ja(this),this.clearDepth=new jg(this),this.clearStencil=new eo(this),this.colorMask=new Ug(this),this.depthMask=new Rp(this),this.stencilMask=new qg(this),this.stencilFunc=new Lp(this),this.stencilOp=new Wc(this),this.stencilTest=new Op(this),this.depthRange=new Fp(this),this.depthTest=new Bp(this),this.depthFunc=new Np(this),this.blend=new Ts(this),this.blendFunc=new Vp(this),this.blendColor=new Zg(this),this.blendEquation=new jp(this),this.cullFace=new ra(this),this.cullFaceSide=new Gg(this),this.frontFace=new Ya(this),this.program=new Wg(this),this.activeTexture=new Hg(this),this.viewport=new Up(this),this.bindFramebuffer=new qp(this),this.bindRenderbuffer=new Zp(this),this.bindTexture=new Hc(this),this.bindVertexBuffer=new Gp(this),this.bindElementBuffer=new $a(this),this.bindVertexArray=new Gn(this),this.pixelStoreUnpack=new Xc(this),this.pixelStoreUnpackPremultiplyAlpha=new Kc(this),this.pixelStoreUnpackFlipY=new Jc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ns(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Fn(this,e,n)}createVertexBuffer(e,n,a){return new Gc(this,e,n,a)}createRenderbuffer(e,n,a){const l=this.gl,h=l.createRenderbuffer();return this.bindRenderbuffer.set(h),l.renderbufferStorage(l.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,l){return new Xg(this,e,n,a,l)}clear({color:e,depth:n,stencil:a}){const l=this.gl;let h=0;e&&(h|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.aE(e.blendFunction,qi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ns(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ns(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Ht{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Ht.ReadOnly=!1,Ht.ReadWrite=!0,Ht.disabled=new Ht(519,Ht.ReadOnly,[0,1]);const el=7680;class wi{constructor(e,n,a,l,h,y){this.test=e,this.ref=n,this.mask=a,this.fail=l,this.depthFail=h,this.pass=y}}wi.disabled=new wi({func:519,mask:0},0,0,el,el,el);class mi{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let As;function na(d,e,n,a,l){const h=d.context,y=h.gl,x=d.useProgram("collisionBox"),S=[];let C=0,M=0;for(let ne=0;ne<a.length;ne++){const le=a[ne],K=e.getTile(le).getBucket(n);if(!K)continue;const de=l?K.textCollisionBox:K.iconCollisionBox,me=K.collisionCircleArray;if(me.length>0){const be=u.H();u.aQ(be,K.placementInvProjMatrix,d.transform.glCoordMatrix),u.aQ(be,be,K.placementViewportMatrix),S.push({circleArray:me,circleOffset:M,transform:le.posMatrix,invTransform:be,coord:le}),C+=me.length/4,M=C}de&&x.draw(h,y.LINES,Ht.disabled,wi.disabled,d.colorModeForRenderPass(),mi.disabled,{u_matrix:le.posMatrix,u_pixel_extrude_scale:[1/(z=d.transform).width,1/z.height]},d.style.map.terrain&&d.style.map.terrain.getTerrainData(le),n.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,d.transform.zoom,null,null,de.collisionVertexBuffer)}var z;if(!l||!S.length)return;const B=d.useProgram("collisionCircle"),Z=new u.aR;Z.resize(4*C),Z._trim();let H=0;for(const ne of S)for(let le=0;le<ne.circleArray.length/4;le++){const K=4*le,de=ne.circleArray[K+0],me=ne.circleArray[K+1],be=ne.circleArray[K+2],ze=ne.circleArray[K+3];Z.emplace(H++,de,me,be,ze,0),Z.emplace(H++,de,me,be,ze,1),Z.emplace(H++,de,me,be,ze,2),Z.emplace(H++,de,me,be,ze,3)}(!As||As.length<2*C)&&(As=function(ne){const le=2*ne,K=new u.aT;K.resize(le),K._trim();for(let de=0;de<le;de++){const me=6*de;K.uint16[me+0]=4*de+0,K.uint16[me+1]=4*de+1,K.uint16[me+2]=4*de+2,K.uint16[me+3]=4*de+2,K.uint16[me+4]=4*de+3,K.uint16[me+5]=4*de+0}return K}(C));const $=h.createIndexBuffer(As,!0),re=h.createVertexBuffer(Z,u.aS.members,!0);for(const ne of S){const le=Ss(ne.transform,ne.invTransform,d.transform);B.draw(h,y.TRIANGLES,Ht.disabled,wi.disabled,d.colorModeForRenderPass(),mi.disabled,le,d.style.map.terrain&&d.style.map.terrain.getTerrainData(ne.coord),n.id,re,$,u.a0.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,d.transform.zoom,null,null,null)}re.destroy(),$.destroy()}mi.disabled=new mi(!1,1029,2305),mi.backCCW=new mi(!0,1029,2305);const sa=u.an(new Float32Array(16));function Qc(d,e,n,a,l,h){const{horizontalAlign:y,verticalAlign:x}=u.au(d);return new u.P((-(y-.5)*e/l+a[0])*h,(-(x-.5)*n/l+a[1])*h)}function Cs(d,e,n,a,l,h){const y=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let x=a.mult(h);n||(x=x.rotate(-l));const S=y.add(x);return ee(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const x=Ce(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),S=Math.atan(x.y/x.x)+(x.x<0?Math.PI:0);return d.add(a.rotate(S))}return d.add(a)}function to(d,e,n,a,l,h,y,x,S,C,M,z,B,Z){const H=d.text.placedSymbolArray,$=d.text.dynamicLayoutVertexArray,re=d.icon.dynamicLayoutVertexArray,ne={};$.clear();for(let le=0;le<H.length;le++){const K=H.get(le),de=K.hidden||!K.crossTileID||d.allowVerticalPlacement&&!K.placedOrientation?null:a[K.crossTileID];if(de){const me=new u.P(K.anchorX,K.anchorY),be={getElevation:Z,width:l.width,height:l.height,labelPlaneMatrix:h,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:me,translation:z,unwrappedTileID:B},ze=n?ee(me.x,me.y,y,Z):Ce(me.x,me.y,be),Ge=L(l.cameraToCenterDistance,ze.signedDistanceFromCamera);let nt=u.ai(d.textSizeData,S,K)*Ge/u.ap;n&&(nt*=d.tilePixelRatio/x);const{width:ct,height:Qe,anchor:$e,textOffset:wt,textBoxScale:Ft}=de,tt=Qc($e,ct,Qe,wt,Ft,nt),at=M.getPitchedTextCorrection(l,me.add(new u.P(z[0],z[1])),B),Lt=Cs(ze.point,be,e,tt,l.angle,at),Ii=d.allowVerticalPlacement&&K.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let Ut=0;Ut<K.numGlyphs;Ut++)u.aj($,Lt,Ii);C&&K.associatedIconIndex>=0&&(ne[K.associatedIconIndex]={shiftedAnchor:Lt,angle:Ii})}else Ct(K.numGlyphs,$)}if(C){re.clear();const le=d.icon.placedSymbolArray;for(let K=0;K<le.length;K++){const de=le.get(K);if(de.hidden)Ct(de.numGlyphs,re);else{const me=ne[K];if(me)for(let be=0;be<de.numGlyphs;be++)u.aj(re,me.shiftedAnchor,me.angle);else Ct(de.numGlyphs,re)}}d.icon.dynamicLayoutVertexBuffer.updateData(re)}d.text.dynamicLayoutVertexBuffer.updateData($)}function ln(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function eu(d,e,n,a,l,h,y,x,S,C,M,z){const B=d.context,Z=B.gl,H=d.transform,$=bs(),re=x==="map",ne=S==="map",le=x!=="viewport"&&n.layout.get("symbol-placement")!=="point",K=re&&!ne&&!le,de=!ne&&le,me=!n.layout.get("symbol-sort-key").isConstant();let be=!1;const ze=d.depthModeForSublayer(0,Ht.ReadOnly),Ge=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),nt=[],ct=$.getCircleRadiusCorrection(H);for(const Qe of a){const $e=e.getTile(Qe),wt=$e.getBucket(n);if(!wt)continue;const Ft=l?wt.text:wt.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const tt=Ft.programConfigurations.get(n.id),at=l||wt.sdfIcons,Lt=l?wt.textSizeData:wt.iconSizeData,Ii=ne||H.pitch!==0,Ut=d.useProgram(ln(at,l,wt),tt),Jt=u.ag(Lt,H.zoom),Ai=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Qe);let _r,Sn,Ci,Nr,Tr=[0,0],yr=null;if(l)Sn=$e.glyphAtlasTexture,Ci=Z.LINEAR,_r=$e.glyphAtlasTexture.size,wt.iconsInText&&(Tr=$e.imageAtlasTexture.size,yr=$e.imageAtlasTexture,Nr=Ii||d.options.rotating||d.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Qt=n.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;Sn=$e.imageAtlasTexture,Ci=at||d.options.rotating||d.options.zooming||Qt||Ii?Z.LINEAR:Z.NEAREST,_r=$e.imageAtlasTexture.size}const Ir=Kt($e,1,d.transform.zoom),Vn=de?Qe.posMatrix:sa,yo=is(Vn,ne,re,d.transform,Ir),vl=On(Vn,ne,re,d.transform,Ir),vo=On(Qe.posMatrix,ne,re,d.transform,Ir),hn=$.translatePosition(d.transform,$e,h,y),xl=Ge&&wt.hasTextData(),Tu=n.layout.get("icon-text-fit")!=="none"&&xl&&wt.hasIconData();if(le){const Qt=d.style.map.terrain?(xo,bo)=>d.style.map.terrain.getElevation(Qe,xo,bo):null,Ds=n.layout.get("text-rotation-alignment")==="map";G(wt,Qe.posMatrix,d,l,yo,vo,ne,C,Ds,$,Qe.toUnwrapped(),H.width,H.height,hn,Qt)}const dn=Qe.posMatrix,pn=l&&Ge||Tu,ss=le||pn?sa:yo,Pn=vl,ur=at&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vr;vr=at?wt.iconsInText?Uc(Lt.kind,Jt,K,ne,le,pn,d,dn,ss,Pn,hn,_r,Tr,ct):ia(Lt.kind,Jt,K,ne,le,pn,d,dn,ss,Pn,hn,l,_r,!0,ct):Dp(Lt.kind,Jt,K,ne,le,pn,d,dn,ss,Pn,hn,l,_r,ct);const en={program:Ut,buffers:Ft,uniformValues:vr,atlasTexture:Sn,atlasTextureIcon:yr,atlasInterpolation:Ci,atlasInterpolationIcon:Nr,isSDF:at,hasHalo:ur};if(me&&wt.canOverlap){be=!0;const Qt=Ft.segments.get();for(const Ds of Qt)nt.push({segments:new u.a0([Ds]),sortKey:Ds.sortKey,state:en,terrainData:Ai})}else nt.push({segments:Ft.segments,sortKey:0,state:en,terrainData:Ai})}be&&nt.sort((Qe,$e)=>Qe.sortKey-$e.sortKey);for(const Qe of nt){const $e=Qe.state;if(B.activeTexture.set(Z.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,Z.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(B.activeTexture.set(Z.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),$e.isSDF){const wt=$e.uniformValues;$e.hasHalo&&(wt.u_is_halo=1,tu($e.buffers,Qe.segments,n,d,$e.program,ze,M,z,wt,Qe.terrainData)),wt.u_is_halo=0}tu($e.buffers,Qe.segments,n,d,$e.program,ze,M,z,$e.uniformValues,Qe.terrainData)}}function tu(d,e,n,a,l,h,y,x,S,C){const M=a.context;l.draw(M,M.gl.TRIANGLES,h,y,x,mi.disabled,S,C,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,a.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function iu(d,e,n,a){const l=d.context,h=l.gl,y=wi.disabled,x=new qi([h.ONE,h.ONE],u.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(n);if(!S)return;const C=a.key;let M=n.heatmapFbos.get(C);M||(M=oa(l,e.tileSize,e.tileSize),n.heatmapFbos.set(C,M)),l.bindFramebuffer.set(M.framebuffer),l.viewport.set([0,0,e.tileSize,e.tileSize]),l.clear({color:u.aM.transparent});const z=S.programConfigurations.get(n.id),B=d.useProgram("heatmap",z),Z=d.style.map.terrain.getTerrainData(a);B.draw(l,h.TRIANGLES,Ht.disabled,y,x,mi.disabled,Br(a.posMatrix,e,d.transform.zoom,n.paint.get("heatmap-intensity")),Z,n.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,n.paint,d.transform.zoom,z)}function Es(d,e,n){const a=d.context,l=a.gl;a.setColorMode(d.colorModeForRenderPass());const h=aa(a,e),y=n.key,x=e.heatmapFbos.get(y);x&&(a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,x.colorAttachment.get()),a.activeTexture.set(l.TEXTURE1),h.bind(l.LINEAR,l.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(a,l.TRIANGLES,Ht.disabled,wi.disabled,d.colorModeForRenderPass(),mi.disabled,Wa(d,e,0,1),null,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,d.transform.zoom),x.destroy(),e.heatmapFbos.delete(y))}function oa(d,e,n){var a,l;const h=d.gl,y=h.createTexture();h.bindTexture(h.TEXTURE_2D,y),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const x=(a=d.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,S=(l=d.RGBA16F)!==null&&l!==void 0?l:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,S,e,n,0,h.RGBA,x,null);const C=d.createFramebuffer(e,n,!1,!1);return C.colorAttachment.set(y),C}function aa(d,e){return e.colorRampTexture||(e.colorRampTexture=new st(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function io(d,e,n,a,l){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let y=h[n.to.toString()],x=h[n.from.toString()];if(!y&&x&&(y=x),!x&&y&&(x=y),!y||!x){const S=l.getPaintProperty(e);y=h[S],x=h[S]}y&&x&&d.setConstantPatternPositions(y,x)}function la(d,e,n,a,l,h,y){const x=d.context.gl,S="fill-pattern",C=n.paint.get(S),M=C&&C.constantOr(1),z=n.getCrossfadeParameters();let B,Z,H,$,re;y?(Z=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=x.LINES):(Z=M?"fillPattern":"fill",B=x.TRIANGLES);const ne=C.constantOr(null);for(const le of a){const K=e.getTile(le);if(M&&!K.patternsLoaded())continue;const de=K.getBucket(n);if(!de)continue;const me=de.programConfigurations.get(n.id),be=d.useProgram(Z,me),ze=d.style.map.terrain&&d.style.map.terrain.getTerrainData(le);M&&(d.context.activeTexture.set(x.TEXTURE0),K.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),me.updatePaintBuffers(z)),io(me,S,ne,K,n);const Ge=ze?le:null,nt=d.translatePosMatrix(Ge?Ge.posMatrix:le.posMatrix,K,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(y){$=de.indexBuffer2,re=de.segments2;const ct=[x.drawingBufferWidth,x.drawingBufferHeight];H=Z==="fillOutlinePattern"&&M?Ep(nt,d,z,K,ct):Lg(nt,ct)}else $=de.indexBuffer,re=de.segments,H=M?Cp(nt,d,z,K):$s(nt);be.draw(d.context,B,l,d.stencilModeForClipping(le),h,mi.disabled,H,ze,n.id,de.layoutVertexBuffer,$,re,n.paint,d.transform.zoom,me)}}function tl(d,e,n,a,l,h,y){const x=d.context,S=x.gl,C="fill-extrusion-pattern",M=n.paint.get(C),z=M.constantOr(1),B=n.getCrossfadeParameters(),Z=n.paint.get("fill-extrusion-opacity"),H=M.constantOr(null);for(const $ of a){const re=e.getTile($),ne=re.getBucket(n);if(!ne)continue;const le=d.style.map.terrain&&d.style.map.terrain.getTerrainData($),K=ne.programConfigurations.get(n.id),de=d.useProgram(z?"fillExtrusionPattern":"fillExtrusion",K);z&&(d.context.activeTexture.set(S.TEXTURE0),re.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers(B)),io(K,C,H,re,n);const me=d.translatePosMatrix($.posMatrix,re,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),be=n.paint.get("fill-extrusion-vertical-gradient"),ze=z?Ga(me,d,be,Z,$,B,re):ea(me,d,be,Z);de.draw(x,x.gl.TRIANGLES,l,h,y,mi.backCCW,ze,le,n.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,n.paint,d.transform.zoom,K,d.style.map.terrain&&ne.centroidVertexBuffer)}}function ro(d,e,n,a,l,h,y){const x=d.context,S=x.gl,C=n.fbo;if(!C)return;const M=d.useProgram("hillshade"),z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),M.draw(x,S.TRIANGLES,l,h,y,mi.disabled,((B,Z,H,$)=>{const re=H.paint.get("hillshade-shadow-color"),ne=H.paint.get("hillshade-highlight-color"),le=H.paint.get("hillshade-accent-color");let K=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=B.transform.angle);const de=!B.options.moving;return{u_matrix:$?$.posMatrix:B.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),de),u_image:0,u_latrange:Ha(0,Z.tileID),u_light:[H.paint.get("hillshade-exaggeration"),K],u_shadow:re,u_highlight:ne,u_accent:le}})(d,n,a,z?e:null),z,a.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function no(d,e,n,a,l,h){const y=d.context,x=y.gl,S=e.dem;if(S&&S.data){const C=S.dim,M=S.stride,z=S.getPixels();if(y.activeTexture.set(x.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(M),e.demTexture){const Z=e.demTexture;Z.update(z,{premultiply:!1}),Z.bind(x.NEAREST,x.CLAMP_TO_EDGE)}else e.demTexture=new st(y,z,x.RGBA,{premultiply:!1}),e.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);y.activeTexture.set(x.TEXTURE0);let B=e.fbo;if(!B){const Z=new st(y,{width:C,height:C,data:null},x.RGBA);Z.bind(x.LINEAR,x.CLAMP_TO_EDGE),B=e.fbo=y.createFramebuffer(C,C,!0,!1),B.colorAttachment.set(Z.texture)}y.bindFramebuffer.set(B.framebuffer),y.viewport.set([0,0,C,C]),d.useProgram("hillshadePrepare").draw(y,x.TRIANGLES,a,l,h,mi.disabled,((Z,H)=>{const $=H.stride,re=u.H();return u.aP(re,0,u.X,-u.X,0,0,1),u.J(re,re,[0,-u.X,0]),{u_matrix:re,u_image:1,u_dimension:[$,$],u_zoom:Z.overscaledZ,u_unpack:H.getUnpackVector()}})(e.tileID,S),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Wp(d,e,n,a,l,h){const y=a.paint.get("raster-fade-duration");if(!h&&y>0){const x=j.now(),S=(x-d.timeAdded)/y,C=e?(x-e.timeAdded)/y:-1,M=n.getSource(),z=l.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),Z=B&&d.refreshedUponExpiration?1:u.ac(B?S:1-C,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const ru=new u.aM(1,0,0,1),ni=new u.aM(0,1,0,1),il=new u.aM(0,0,1,1),Jg=new u.aM(1,0,1,1),Hp=new u.aM(0,1,1,1);function so(d,e,n,a){rl(d,0,e+n/2,d.transform.width,n,a)}function Xp(d,e,n,a){rl(d,e-n/2,0,n,d.transform.height,a)}function rl(d,e,n,a,l,h){const y=d.context,x=y.gl;x.enable(x.SCISSOR_TEST),x.scissor(e*d.pixelRatio,n*d.pixelRatio,a*d.pixelRatio,l*d.pixelRatio),y.clear({color:h}),x.disable(x.SCISSOR_TEST)}function Kp(d,e,n){const a=d.context,l=a.gl,h=n.posMatrix,y=d.useProgram("debug"),x=Ht.disabled,S=wi.disabled,C=d.colorModeForRenderPass(),M="$debug",z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const B=e.getTileByID(n.key).latestRawTileData,Z=Math.floor((B&&B.byteLength||0)/1024),H=e.getTile(n).tileSize,$=512/Math.min(H,512)*(n.overscaledZ/d.transform.zoom)*.5;let re=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(re+=` => ${n.overscaledZ}`),function(ne,le){ne.initDebugOverlayCanvas();const K=ne.debugOverlayCanvas,de=ne.context.gl,me=ne.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,K.width,K.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(le,5,5),me.strokeText(le,5,5),ne.debugOverlayTexture.update(K),ne.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(d,`${re} ${Z}kB`),y.draw(a,l.TRIANGLES,x,S,qi.alphaBlended,mi.disabled,ta(h,u.aM.transparent,$),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),y.draw(a,l.LINE_STRIP,x,S,C,mi.disabled,ta(h,u.aM.red),z,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function Jp(d,e,n){const a=d.context,l=a.gl,h=d.colorModeForRenderPass(),y=new Ht(l.LEQUAL,Ht.ReadWrite,d.depthRangeFor3D),x=d.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,d.width,d.height]);for(const C of n){const M=d.renderToTexture.getTexture(C),z=e.getTerrainData(C.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,M.texture);const B=d.transform.calculatePosMatrix(C.tileID.toUnwrapped()),Z=e.getMeshFrameDelta(d.transform.zoom),H=d.transform.calculateFogMatrix(C.tileID.toUnwrapped()),$=Vc(B,Z,H,d.style.sky,d.transform.pitch);x.draw(a,l.TRIANGLES,y,wi.disabled,h,mi.backCCW,$,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class nl{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class sl{constructor(e,n){this.context=new Kg(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rt.maxUnderzooming+Rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bc}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,n=new u.aX;n.emplaceBack(0,0),n.emplaceBack(u.X,0),n.emplaceBack(0,u.X),n.emplaceBack(u.X,u.X),this.tileExtentBuffer=e.createVertexBuffer(n,ws.members),this.tileExtentSegments=u.a0.simpleSegment(0,0,4,2);const a=new u.aX;a.emplaceBack(0,0),a.emplaceBack(u.X,0),a.emplaceBack(0,u.X),a.emplaceBack(u.X,u.X),this.debugBuffer=e.createVertexBuffer(a,ws.members),this.debugSegments=u.a0.simpleSegment(0,0,4,5);const l=new u.$;l.emplaceBack(0,0,0,0),l.emplaceBack(u.X,0,u.X,0),l.emplaceBack(0,u.X,0,u.X),l.emplaceBack(u.X,u.X,u.X,u.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,Xr.members),this.rasterBoundsSegments=u.a0.simpleSegment(0,0,4,2);const h=new u.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,ws.members),this.viewportSegments=u.a0.simpleSegment(0,0,4,2);const y=new u.aZ;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const x=new u.aY;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(x);const S=this.context.gl;this.stencilClearMode=new wi({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=u.H();u.aP(a,0,this.width,this.height,0,0,1),u.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Ht.disabled,this.stencilClearMode,qi.disabled,mi.disabled,Fr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(qi.disabled),a.setDepthMode(Ht.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of n){const x=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y);h.draw(a,l.TRIANGLES,Ht.disabled,new wi({func:l.ALWAYS,mask:0},x,255,l.KEEP,l.KEEP,l.REPLACE),qi.disabled,mi.disabled,Fr(y.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new wi({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new wi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((y,x)=>x.overscaledZ-y.overscaledZ),l=a[a.length-1].overscaledZ,h=a[0].overscaledZ-l+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const y={};for(let x=0;x<h;x++)y[x+l]=new wi({func:n.GEQUAL,mask:255},x+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[y,a]}return[{[l]:wi.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new qi([e.CONSTANT_COLOR,e.ONE],new u.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?qi.unblended:qi.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return Ht.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ht(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(j.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,h={},y={},x={};for(const S in l){const C=l[S];C.used&&C.prepare(this.context),h[S]=C.getVisibleCoordinates(),y[S]=h[S].slice().reverse(),x[S]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const C=this.style._layers[S];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const M=y[C.source];(C.type==="custom"||M.length)&&this.renderLayer(this,l[C.source],C,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?u.aM.black:u.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,C){const M=S.context,z=M.gl,B=((ne,le,K)=>({u_sky_color:ne.properties.get("sky-color"),u_horizon_color:ne.properties.get("horizon-color"),u_horizon:(le.height/2+le.getHorizon())*K,u_sky_horizon_blend:ne.properties.get("sky-horizon-blend")*le.height/2*K}))(C,S.style.map.transform,S.pixelRatio),Z=new Ht(z.LEQUAL,Ht.ReadWrite,[0,1]),H=wi.disabled,$=S.colorModeForRenderPass(),re=S.useProgram("sky");if(!C.mesh){const ne=new u.aX;ne.emplaceBack(-1,-1),ne.emplaceBack(1,-1),ne.emplaceBack(1,1),ne.emplaceBack(-1,1);const le=new u.aY;le.emplaceBack(0,1,2),le.emplaceBack(0,2,3),C.mesh=new nl(M.createVertexBuffer(ne,ws.members),M.createIndexBuffer(le),u.a0.simpleSegment(0,0,ne.length,le.length))}re.draw(M,z.TRIANGLES,Z,H,$,mi.disabled,B,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],C=l[S.source],M=h[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,C,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],C=l[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?x:y)[S.source];this._renderTileClippingMasks(S,h[S.source]),this.renderLayer(this,C,S,M)}if(this.options.showTileBoundaries){const S=function(C,M){let z=null;const B=Object.values(C._layers).flatMap(re=>re.source&&!re.isHidden(M)?[C.sourceCaches[re.source]]:[]),Z=B.filter(re=>re.getSource().type==="vector"),H=B.filter(re=>re.getSource().type!=="vector"),$=re=>{(!z||z.getSource().maxzoom<re.getSource().maxzoom)&&(z=re)};return Z.forEach(re=>$(re)),z||H.forEach(re=>$(re)),z}(this.style,this.transform.zoom);S&&function(C,M,z){for(let B=0;B<z.length;B++)Kp(C,M,z[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const C=S.transform.padding;so(S,S.transform.height-(C.top||0),3,ru),so(S,C.bottom||0,3,ni),Xp(S,C.left||0,3,il),Xp(S,S.transform.width-(C.right||0),3,Jg);const M=S.transform.centerPoint;(function(z,B,Z,H){rl(z,B-1,Z-10,2,20,H),rl(z,B-10,Z-1,20,2,H)})(S,M.x,S.transform.height-M.y,Hp)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!u.a_(n,a):!u.a$(n,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(u.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,y){const x=h.context,S=x.gl,C=qi.unblended,M=new Ht(S.LEQUAL,Ht.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.sourceCache.getRenderableTiles(),Z=h.useProgram("terrainDepth");x.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),x.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),x.clear({color:u.aM.transparent,depth:1});for(const H of B){const $=y.getTerrainData(H.tileID),re={u_matrix:h.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};Z.draw(x,S.TRIANGLES,M,wi.disabled,C,mi.backCCW,re,$,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,y){const x=h.context,S=x.gl,C=qi.unblended,M=new Ht(S.LEQUAL,Ht.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.getCoordsTexture(),Z=y.sourceCache.getRenderableTiles(),H=h.useProgram("terrainCoords");x.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),x.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),x.clear({color:u.aM.transparent,depth:1}),y.coordsIndex=[];for(const $ of Z){const re=y.getTerrainData($.tileID);x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,B.texture);const ne={u_matrix:h.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};H.draw(x,S.TRIANGLES,M,wi.disabled,C,mi.backCCW,ne,re,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),y.coordsIndex.push($.tileID.key)}x.bindFramebuffer.set(null),x.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,y,x,S,C){if(h.renderPass!=="translucent")return;const M=wi.disabled,z=h.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,Z,H,$,re,ne,le,K,de){const me=Z.transform,be=bs(),ze=re==="map",Ge=ne==="map";for(const nt of B){const ct=$.getTile(nt),Qe=ct.getBucket(H);if(!Qe||!Qe.text||!Qe.text.segments.get().length)continue;const $e=u.ag(Qe.textSizeData,me.zoom),wt=Kt(ct,1,Z.transform.zoom),Ft=is(nt.posMatrix,Ge,ze,Z.transform,wt),tt=H.layout.get("icon-text-fit")!=="none"&&Qe.hasIconData();if($e){const at=Math.pow(2,me.zoom-ct.tileID.overscaledZ),Lt=Z.style.map.terrain?(Ut,Jt)=>Z.style.map.terrain.getElevation(nt,Ut,Jt):null,Ii=be.translatePosition(me,ct,le,K);to(Qe,ze,Ge,de,me,Ft,nt.posMatrix,at,$e,tt,be,Ii,nt.toUnwrapped(),Lt)}}}(S,h,x,y,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),C),x.paint.get("icon-opacity").constantOr(1)!==0&&eu(h,y,x,S,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),M,z),x.paint.get("text-opacity").constantOr(1)!==0&&eu(h,y,x,S,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),M,z),y.map.showCollisionBoxes&&(na(h,y,x,S,!0),na(h,y,x,S,!1))})(e,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(h,y,x,S){if(h.renderPass!=="translucent")return;const C=x.paint.get("circle-opacity"),M=x.paint.get("circle-stroke-width"),z=x.paint.get("circle-stroke-opacity"),B=!x.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const Z=h.context,H=Z.gl,$=h.depthModeForSublayer(0,Ht.ReadOnly),re=wi.disabled,ne=h.colorModeForRenderPass(),le=[];for(let K=0;K<S.length;K++){const de=S[K],me=y.getTile(de),be=me.getBucket(x);if(!be)continue;const ze=be.programConfigurations.get(x.id),Ge=h.useProgram("circle",ze),nt=be.layoutVertexBuffer,ct=be.indexBuffer,Qe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(de),$e={programConfiguration:ze,program:Ge,layoutVertexBuffer:nt,indexBuffer:ct,uniformValues:Og(h,de,me,x),terrainData:Qe};if(B){const wt=be.segments.get();for(const Ft of wt)le.push({segments:new u.a0([Ft]),sortKey:Ft.sortKey,state:$e})}else le.push({segments:be.segments,sortKey:0,state:$e})}B&&le.sort((K,de)=>K.sortKey-de.sortKey);for(const K of le){const{programConfiguration:de,program:me,layoutVertexBuffer:be,indexBuffer:ze,uniformValues:Ge,terrainData:nt}=K.state;me.draw(Z,H.TRIANGLES,$,re,ne,mi.disabled,Ge,nt,x.id,be,ze,K.segments,x.paint,h.transform.zoom,de)}})(e,n,a,l);break;case"heatmap":(function(h,y,x,S){if(x.paint.get("heatmap-opacity")===0)return;const C=h.context;if(h.style.map.terrain){for(const M of S){const z=y.getTile(M);y.hasRenderableParent(M)||(h.renderPass==="offscreen"?iu(h,z,x,M):h.renderPass==="translucent"&&Es(h,x,M))}C.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(M,z,B,Z){const H=M.context,$=H.gl,re=wi.disabled,ne=new qi([$.ONE,$.ONE],u.aM.transparent,[!0,!0,!0,!0]);(function(le,K,de){const me=le.gl;le.activeTexture.set(me.TEXTURE1),le.viewport.set([0,0,K.width/4,K.height/4]);let be=de.heatmapFbos.get(u.aU);be?(me.bindTexture(me.TEXTURE_2D,be.colorAttachment.get()),le.bindFramebuffer.set(be.framebuffer)):(be=oa(le,K.width/4,K.height/4),de.heatmapFbos.set(u.aU,be))})(H,M,B),H.clear({color:u.aM.transparent});for(let le=0;le<Z.length;le++){const K=Z[le];if(z.hasRenderableParent(K))continue;const de=z.getTile(K),me=de.getBucket(B);if(!me)continue;const be=me.programConfigurations.get(B.id),ze=M.useProgram("heatmap",be),{zoom:Ge}=M.transform;ze.draw(H,$.TRIANGLES,Ht.disabled,re,ne,mi.disabled,Br(K.posMatrix,de,Ge,B.paint.get("heatmap-intensity")),null,B.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,B.paint,M.transform.zoom,be)}H.viewport.set([0,0,M.width,M.height])}(h,y,x,S):h.renderPass==="translucent"&&function(M,z){const B=M.context,Z=B.gl;B.setColorMode(M.colorModeForRenderPass());const H=z.heatmapFbos.get(u.aU);H&&(B.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,H.colorAttachment.get()),B.activeTexture.set(Z.TEXTURE1),aa(B,z).bind(Z.LINEAR,Z.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(B,Z.TRIANGLES,Ht.disabled,wi.disabled,M.colorModeForRenderPass(),mi.disabled,Wa(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(h,x)})(e,n,a,l);break;case"line":(function(h,y,x,S){if(h.renderPass!=="translucent")return;const C=x.paint.get("line-opacity"),M=x.paint.get("line-width");if(C.constantOr(1)===0||M.constantOr(1)===0)return;const z=h.depthModeForSublayer(0,Ht.ReadOnly),B=h.colorModeForRenderPass(),Z=x.paint.get("line-dasharray"),H=x.paint.get("line-pattern"),$=H.constantOr(1),re=x.paint.get("line-gradient"),ne=x.getCrossfadeParameters(),le=$?"linePattern":Z?"lineSDF":re?"lineGradient":"line",K=h.context,de=K.gl;let me=!0;for(const be of S){const ze=y.getTile(be);if($&&!ze.patternsLoaded())continue;const Ge=ze.getBucket(x);if(!Ge)continue;const nt=Ge.programConfigurations.get(x.id),ct=h.context.program.get(),Qe=h.useProgram(le,nt),$e=me||Qe.program!==ct,wt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(be),Ft=H.constantOr(null);if(Ft&&ze.imageAtlas){const Lt=ze.imageAtlas,Ii=Lt.patternPositions[Ft.to.toString()],Ut=Lt.patternPositions[Ft.from.toString()];Ii&&Ut&&nt.setConstantPatternPositions(Ii,Ut)}const tt=wt?be:null,at=$?Qs(h,ze,x,ne,tt):Z?Fg(h,ze,x,Z,ne,tt):re?kp(h,ze,x,Ge.lineClipsArray.length,tt):Xa(h,ze,x,tt);if($)K.activeTexture.set(de.TEXTURE0),ze.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),nt.updatePaintBuffers(ne);else if(Z&&($e||h.lineAtlas.dirty))K.activeTexture.set(de.TEXTURE0),h.lineAtlas.bind(K);else if(re){const Lt=Ge.gradients[x.id];let Ii=Lt.texture;if(x.gradientVersion!==Lt.version){let Ut=256;if(x.stepInterpolant){const Jt=y.getSource().maxzoom,Ai=be.canonical.z===Jt?Math.ceil(1<<h.transform.maxZoom-be.canonical.z):1;Ut=u.ac(u.aV(Ge.maxLineLength/u.X*1024*Ai),256,K.maxTextureSize)}Lt.gradient=u.aW({expression:x.gradientExpression(),evaluationKey:"lineProgress",resolution:Ut,image:Lt.gradient||void 0,clips:Ge.lineClipsArray}),Lt.texture?Lt.texture.update(Lt.gradient):Lt.texture=new st(K,Lt.gradient,de.RGBA),Lt.version=x.gradientVersion,Ii=Lt.texture}K.activeTexture.set(de.TEXTURE0),Ii.bind(x.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}Qe.draw(K,de.TRIANGLES,z,h.stencilModeForClipping(be),B,mi.disabled,at,wt,x.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,x.paint,h.transform.zoom,nt,Ge.layoutVertexBuffer2),me=!1}})(e,n,a,l);break;case"fill":(function(h,y,x,S){const C=x.paint.get("fill-color"),M=x.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=h.colorModeForRenderPass(),B=x.paint.get("fill-pattern"),Z=h.opaquePassEnabledForLayer()&&!B.constantOr(1)&&C.constantOr(u.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===Z){const H=h.depthModeForSublayer(1,h.renderPass==="opaque"?Ht.ReadWrite:Ht.ReadOnly);la(h,y,x,S,H,z,!1)}if(h.renderPass==="translucent"&&x.paint.get("fill-antialias")){const H=h.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Ht.ReadOnly);la(h,y,x,S,H,z,!0)}})(e,n,a,l);break;case"fill-extrusion":(function(h,y,x,S){const C=x.paint.get("fill-extrusion-opacity");if(C!==0&&h.renderPass==="translucent"){const M=new Ht(h.context.gl.LEQUAL,Ht.ReadWrite,h.depthRangeFor3D);if(C!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))tl(h,y,x,S,M,wi.disabled,qi.disabled),tl(h,y,x,S,M,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const z=h.colorModeForRenderPass();tl(h,y,x,S,M,wi.disabled,z)}}})(e,n,a,l);break;case"hillshade":(function(h,y,x,S){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const C=h.context,M=h.depthModeForSublayer(0,Ht.ReadOnly),z=h.colorModeForRenderPass(),[B,Z]=h.renderPass==="translucent"?h.stencilConfigForOverlap(S):[{},S];for(const H of Z){const $=y.getTile(H);$.needsHillshadePrepare!==void 0&&$.needsHillshadePrepare&&h.renderPass==="offscreen"?no(h,$,x,M,wi.disabled,z):h.renderPass==="translucent"&&ro(h,H,$,x,M,B[H.overscaledZ],z)}C.viewport.set([0,0,h.width,h.height])})(e,n,a,l);break;case"raster":(function(h,y,x,S){if(h.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!S.length)return;const C=h.context,M=C.gl,z=y.getSource(),B=h.useProgram("raster"),Z=h.colorModeForRenderPass(),[H,$]=z instanceof Rr?[{},S]:h.stencilConfigForOverlap(S),re=$[$.length-1].overscaledZ,ne=!h.options.moving;for(const le of $){const K=h.depthModeForSublayer(le.overscaledZ-re,x.paint.get("raster-opacity")===1?Ht.ReadWrite:Ht.ReadOnly,M.LESS),de=y.getTile(le);de.registerFadeDuration(x.paint.get("raster-fade-duration"));const me=y.findLoadedParent(le,0),be=y.findLoadedSibling(le),ze=Wp(de,me||be||null,y,x,h.transform,h.style.map.terrain);let Ge,nt;const ct=x.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),de.texture.bind(ct,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(M.TEXTURE1),me?(me.texture.bind(ct,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ge=Math.pow(2,me.tileID.overscaledZ-de.tileID.overscaledZ),nt=[de.tileID.canonical.x*Ge%1,de.tileID.canonical.y*Ge%1]):de.texture.bind(ct,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&C.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Qe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(le),$e=Qe?le:null,wt=$e?$e.posMatrix:h.transform.calculatePosMatrix(le.toUnwrapped(),ne),Ft=Bg(wt,nt||[0,0],Ge||1,ze,x);z instanceof Rr?B.draw(C,M.TRIANGLES,K,wi.disabled,Z,mi.disabled,Ft,Qe,x.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments):B.draw(C,M.TRIANGLES,K,H[le.overscaledZ],Z,mi.disabled,Ft,Qe,x.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,l);break;case"background":(function(h,y,x,S){const C=x.paint.get("background-color"),M=x.paint.get("background-opacity");if(M===0)return;const z=h.context,B=z.gl,Z=h.transform,H=Z.tileSize,$=x.paint.get("background-pattern");if(h.isPatternMissing($))return;const re=!$&&C.a===1&&M===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==re)return;const ne=wi.disabled,le=h.depthModeForSublayer(0,re==="opaque"?Ht.ReadWrite:Ht.ReadOnly),K=h.colorModeForRenderPass(),de=h.useProgram($?"backgroundPattern":"background"),me=S||Z.coveringTiles({tileSize:H,terrain:h.style.map.terrain});$&&(z.activeTexture.set(B.TEXTURE0),h.imageManager.bind(h.context));const be=x.getCrossfadeParameters();for(const ze of me){const Ge=S?ze.posMatrix:h.transform.calculatePosMatrix(ze.toUnwrapped()),nt=$?qc(Ge,M,h,$,{tileID:ze,tileSize:H},be):Ka(Ge,M,C),ct=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ze);de.draw(z,B.TRIANGLES,le,ne,K,mi.disabled,nt,ct,x.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,l);break;case"custom":(function(h,y,x){const S=h.context,C=x.implementation;if(h.renderPass==="offscreen"){const M=C.prerender;M&&(h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),M.call(C,S.gl,h.transform.customLayerMatrix()),S.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),S.setStencilMode(wi.disabled);const M=C.renderingMode==="3d"?new Ht(h.context.gl.LEQUAL,Ht.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Ht.ReadOnly);S.setDepthMode(M),C.render(S.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),S.setDirty(),h.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,l,h){if(!a[0]&&!a[1])return e;const y=h?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(y){const C=Math.sin(y),M=Math.cos(y);a=[a[0]*M-a[1]*C,a[0]*C+a[1]*M]}const x=[h?a[0]:Kt(n,a[0],this.transform.zoom),h?a[1]:Kt(n,a[1],this.transform.zoom),0],S=new Float32Array(16);return u.J(S,e,x),S}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new jc(this.context,rs[e],n,Zc[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new st(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class oo{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const l=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const S=1/(x=u.af([],x,e))[3]/n*l;return u.b1(x,x,[S,S,1/x[3],S])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const S=function(B,Z){var H=Z[0],$=Z[1],re=Z[2],ne=H*H+$*$+re*re;return ne>0&&(ne=1/Math.sqrt(ne)),B[0]=Z[0]*ne,B[1]=Z[1]*ne,B[2]=Z[2]*ne,B}([],function(B,Z,H){var $=Z[0],re=Z[1],ne=Z[2],le=H[0],K=H[1],de=H[2];return B[0]=re*de-ne*K,B[1]=ne*le-$*de,B[2]=$*K-re*le,B}([],Ze([],h[x[0]],h[x[1]]),Ze([],h[x[2]],h[x[1]]))),C=-((M=S)[0]*(z=h[x[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(C)});return new oo(h,y)}}class ao{constructor(e,n){this.min=e,this.max=n,this.center=function(a,l,h){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,h){return a[0]=l[0]+h[0],a[1]=l[1]+h[1],a[2]=l[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=De(this.min),l=De(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],l[h]=n[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new ao(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let y=0;for(let x=0;x<n.length;x++)u.b2(h,n[x])>=0&&y++;if(y===0)return 0;y!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const S=e.points[x][l]-this.min[l];h=Math.min(h,S),y=Math.max(y,S)}if(y<0||h>this.max[l]-this.min[l])return 0}return 1}}class lo{constructor(e=0,n=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=l}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=u.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=u.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=u.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=u.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=u.ac((this.left+e-this.right)/2,0,e),l=u.ac((this.top+n-this.bottom)/2,0,n);return new u.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new lo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const nu=85.051129;class co{constructor(e,n,a,l,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new lo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new co(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-u.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new u.A(4);return u.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,h){var y=l[0],x=l[1],S=l[2],C=l[3],M=Math.sin(h),z=Math.cos(h);a[0]=y*z+S*M,a[1]=x*z+C*M,a[2]=y*-M+S*z,a[3]=x*-M+C*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=u.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new u.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new u.P(0,0)),l=this.pointCoordinate(new u.P(this.width,0)),h=this.pointCoordinate(new u.P(this.width,this.height)),y=this.pointCoordinate(new u.P(0,this.height)),x=Math.floor(Math.min(a.x,l.x,h.x,y.x)),S=Math.floor(Math.max(a.x,l.x,h.x,y.x)),C=1;for(let M=x-C;M<=S+C;M++)M!==0&&n.push(new u.b4(M,e))}return n}coveringTiles(e){var n,a;let l=this.coveringZoomLevel(e);const h=l;if(e.minzoom!==void 0&&l<e.minzoom)return[];e.maxzoom!==void 0&&l>e.maxzoom&&(l=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),x=u.Z.fromLngLat(this.center),S=Math.pow(2,l),C=[S*y.x,S*y.y,0],M=[S*x.x,S*x.y,0],z=oo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,l);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=l);const Z=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,H=K=>({aabb:new ao([K*S,0,0],[(K+1)*S,S,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),$=[],re=[],ne=l,le=e.reparseOverscaled?h:l;if(this._renderWorldCopies)for(let K=1;K<=3;K++)$.push(H(-K)),$.push(H(K));for($.push(H(0));$.length>0;){const K=$.pop(),de=K.x,me=K.y;let be=K.fullyVisible;if(!be){const Qe=K.aabb.intersects(z);if(Qe===0)continue;be=Qe===2}const ze=e.terrain?C:M,Ge=K.aabb.distanceX(ze),nt=K.aabb.distanceY(ze),ct=Math.max(Math.abs(Ge),Math.abs(nt));if(K.zoom===ne||ct>Z+(1<<ne-K.zoom)-2&&K.zoom>=B){const Qe=ne-K.zoom,$e=C[0]-.5-(de<<Qe),wt=C[1]-.5-(me<<Qe);re.push({tileID:new u.S(K.zoom===ne?le:K.zoom,K.wrap,K.zoom,de,me),distanceSq:ft([M[0]-.5-de,M[1]-.5-me]),tileDistanceToCamera:Math.sqrt($e*$e+wt*wt)})}else for(let Qe=0;Qe<4;Qe++){const $e=(de<<1)+Qe%2,wt=(me<<1)+(Qe>>1),Ft=K.zoom+1;let tt=K.aabb.quadrant(Qe);if(e.terrain){const at=new u.S(Ft,K.wrap,Ft,$e,wt),Lt=e.terrain.getMinMaxElevation(at),Ii=(n=Lt.minElevation)!==null&&n!==void 0?n:this.elevation,Ut=(a=Lt.maxElevation)!==null&&a!==void 0?a:this.elevation;tt=new ao([tt.min[0],tt.min[1],Ii],[tt.max[0],tt.max[1],Ut])}$.push({aabb:tt,zoom:Ft,x:$e,y:wt,wrap:K.wrap,fullyVisible:be})}}return re.sort((K,de)=>K.distanceSq-de.distanceSq).map(K=>K.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=u.ac(e.lat,-85.051129,nu);return new u.P(u.O(e.lng)*this.worldSize,u.Q(n)*this.worldSize)}unproject(e){return new u.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-h))return;const y=a+n-h,x=Math.cos(this._pitch)*this.cameraToCenterDistance/y/u.b5(1,l.lat),S=this.scaleZoom(x/this.tileSize);this._elevation=h,this._center=l,this.zoom=S}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),y=new u.Z(h.x-(a.x-l.x),h.y-(a.y-l.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return u.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const B=n.pointCoordinate(e);if(B!=null)return B}const a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];u.af(a,a,this.pixelMatrixInverse),u.af(l,l,this.pixelMatrixInverse);const h=a[3],y=l[3],x=a[1]/h,S=l[1]/y,C=a[2]/h,M=l[2]/y,z=C===M?0:(0-C)/(M-C);return new u.Z(u.y.number(a[0]/h,l[0]/y,z)/this.worldSize,u.y.number(x,S,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,n,1];return u.af(l,l,a),new u.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new xe().extend(this.pointLocation(new u.P(0,e))).extend(this.pointLocation(new u.P(this.width,e))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,nu])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),l=n.x+Math.pow(2,n.z)*e.wrap,h=u.an(new Float64Array(16));return u.J(h,h,[l*a,n.y*a,0]),u.K(h,h,[a/u.X,a/u.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const h=this.calculateTileMatrix(e);return u.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),l[a]=new Float32Array(h),l[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const l=this.calculateTileMatrix(e);return u.L(l,this.fogMatrix,l),a[n]=new Float32Array(l),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=u.ac(+n,this.minZoom,this.maxZoom);const a={center:new u.N(e.lng,e.lat),zoom:n};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const K=179.9999999999;l=[-K,K]}const h=this.tileSize*this.zoomScale(a.zoom);let y=0,x=h,S=0,C=h,M=0,z=0;const{x:B,y:Z}=this.size;if(this.latRange){const K=this.latRange;y=u.Q(K[1])*h,x=u.Q(K[0])*h,x-y<Z&&(M=Z/(x-y))}l&&(S=u.b3(u.O(l[0])*h,0,h),C=u.b3(u.O(l[1])*h,0,h),C<S&&(C+=h),C-S<B&&(z=B/(C-S)));const{x:H,y:$}=this.project.call({worldSize:h},e);let re,ne;const le=Math.max(z||0,M||0);if(le){const K=new u.P(z?(C+S)/2:H,M?(x+y)/2:$);return a.center=this.unproject.call({worldSize:h},K).wrap(),a.zoom+=this.scaleZoom(le),a}if(this.latRange){const K=Z/2;$-K<y&&(ne=y+K),$+K>x&&(ne=x-K)}if(l){const K=(S+C)/2;let de=H;this._renderWorldCopies&&(de=u.b3(H,K-h/2,K+h/2));const me=B/2;de-me<S&&(re=S+me),de+me>C&&(re=C-me)}if(re!==void 0||ne!==void 0){const K=new u.P(re??H,ne??$);a.center=this.unproject.call({worldSize:h},K).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b5(1,this.center.lat)*this.worldSize;let l=u.an(new Float64Array(16));u.K(l,l,[this.width/2,-this.height/2,1]),u.J(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=u.an(new Float64Array(16)),u.K(l,l,[1,-1,1]),u.J(l,l,[-1,-1,0]),u.K(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),y=Math.min(this.elevation,this.minElevationForCurrentTile),x=h-y*this._pixelPerMeter/Math.cos(this._pitch),S=y<0?x:h,C=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(u.ac(Math.PI-C-M,.01,Math.PI-.01)),B=this.getHorizon(),Z=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),H=Math.sin(Z)*S/Math.sin(u.ac(Math.PI-C-Z,.01,Math.PI-.01)),$=Math.min(z,H);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*$+S),this.nearZ=this.height/50,l=new Float64Array(16),u.b6(l,this._fov,this.width/this.height,this.nearZ,this.farZ),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.projectionMatrix=u.ae(l),u.K(l,l,[1,-1,1]),u.J(l,l,[0,0,-this.cameraToCenterDistance]),u.b7(l,l,this._pitch),u.ad(l,l,this.angle),u.J(l,l,[-n,-a,0]),this.mercatorMatrix=u.K([],l,[this.worldSize,this.worldSize,this.worldSize]),u.K(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.L(new Float64Array(16),this.labelPlaneMatrix,l),u.J(l,l,[0,0,-this.elevation]),this.modelViewProjectionMatrix=l,this.invModelViewProjectionMatrix=u.as([],l),this.fogMatrix=new Float64Array(16),u.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,u.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b7(this.fogMatrix,this.fogMatrix,this._pitch),u.ad(this.fogMatrix,this.fogMatrix,this.angle),u.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),u.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=u.L(new Float64Array(16),this.labelPlaneMatrix,l);const re=this.width%2/2,ne=this.height%2/2,le=Math.cos(this.angle),K=Math.sin(this.angle),de=n-Math.round(n)+le*re+K*ne,me=a-Math.round(a)+le*ne+K*re,be=new Float64Array(l);if(u.J(be,be,[de>.5?de-1:de,me>.5?me-1:me,0]),this.alignedModelViewProjectionMatrix=be,l=u.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new u.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,l=n.y,h=n.x,y=n.y;for(const x of e)a=Math.min(a,x.x),l=Math.min(l,x.y),h=Math.max(h,x.x),y=Math.max(y,x.y);return[new u.P(a,l),new u.P(h,l),new u.P(h,y),new u.P(a,y),new u.P(a,l)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return u.af(l,l,this.modelViewProjectionMatrix),l[2]/l[3]}}function ca(d,e){let n,a=!1,l=null,h=null;const y=()=>{l=null,a&&(d.apply(h,n),l=setTimeout(y,e),a=!1)};return(...x)=>(a=!0,h=this,n=x,l||y(),l)}class ol{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let h=window.location.hash.replace(l,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let y=window.location.href.replace(/(#.+)?$/,h);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ca(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,l),y=Math.round(n.lng*h)/h,x=Math.round(n.lat*h)/h,S=this._map.getBearing(),C=this._map.getPitch();let M="";if(M+=e?`/${y}/${x}/${a}`:`${a}/${x}/${y}`,(S||C)&&(M+="/"+Math.round(10*S)/10),C&&(M+=`/${Math.round(C)}`),this._hashName){const z=this._hashName;let B=!1;const Z=window.location.hash.slice(1).split("&").map(H=>{const $=H.split("=")[0];return $===z?(B=!0,`${$}=${M}`):H}).filter(H=>H);return B||Z.push(`${z}=${M}`),`#${Z.join("&")}`}return`#${M}`}}const al={linearity:.3,easing:u.b8(0,0,.3,1)},su=u.e({deceleration:2500,maxSpeed:1400},al),Yg=u.e({deceleration:20,maxSpeed:1400},al),Yp=u.e({deceleration:1e3,maxSpeed:360},al),ll=u.e({deceleration:1e3,maxSpeed:90},al);class ou{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:j.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=j.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const h=ha(n.pan.mag(),a,u.e({},su,e||{}));l.offset=n.pan.mult(h.amount/n.pan.mag()),l.center=this._map.transform.center,ua(l,h)}if(n.zoom){const h=ha(n.zoom,a,Yg);l.zoom=this._map.transform.zoom+h.amount,ua(l,h)}if(n.bearing){const h=ha(n.bearing,a,Yp);l.bearing=this._map.transform.bearing+u.ac(h.amount,-179,179),ua(l,h)}if(n.pitch){const h=ha(n.pitch,a,ll);l.pitch=this._map.transform.pitch+h.amount,ua(l,h)}if(l.zoom||l.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;l.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),u.e(l,{noMoveStart:!0})}}function ua(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function ha(d,e,n){const{maxSpeed:a,linearity:l,deceleration:h}=n,y=u.ac(d*l/(e/1e3),-a,a),x=Math.abs(y)/(h*l);return{easing:n.easing,duration:1e3*x,amount:y*(x/2)}}class gr extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,l={}){const h=V.mousePos(n.getCanvas(),a),y=n.unproject(h);super(e,u.e({point:h,lngLat:y,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class ks extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const l=e==="touchend"?a.changedTouches:a.touches,h=V.touchPos(n.getCanvasContainer(),l),y=h.map(S=>n.unproject(S)),x=h.reduce((S,C,M,z)=>S.add(C.div(z.length)),new u.P(0,0));super(e,{points:h,point:x,lngLats:y,lngLat:n.unproject(x),originalEvent:a}),this._defaultPrevented=!1}}class $p extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class Qp{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new $p(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new gr(e.type,this._map,e))}mouseup(e){this._map.fire(new gr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new gr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new gr(e.type,this._map,e))}mouseover(e){this._map.fire(new gr(e.type,this._map,e))}mouseout(e){this._map.fire(new gr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ks(e.type,this._map,e))}touchmove(e){this._map.fire(new ks(e.type,this._map,e))}touchend(e){this._map.fire(new ks(e.type,this._map,e))}touchcancel(e){this._map.fire(new ks(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new gr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new gr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(u.P.convert(e),this._map.terrain)}}class $r{constructor(e,n){this._map=e,this._tr=new bn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(l.x,a.x),y=Math.max(l.x,a.x),x=Math.min(l.y,a.y),S=Math.max(l.y,a.y);V.setTransform(this._box,`translate(${h}px,${x}px)`),this._box.style.width=y-h+"px",this._box.style.height=S-x+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,l=n;if(this.reset(),V.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new u.k(e,{originalEvent:n}))}}function da(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const n={};for(let a=0;a<d.length;a++)n[d[a].identifier]=e[a];return n}class au{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const h=new u.P(0,0);for(const y of l)h._add(y);return h.div(l.length)}(n),this.touches=da(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const l=da(a,n);for(const h in this.touches){const y=l[h];(!y||y.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class cl{constructor(e){this.singleTap=new au(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const l=this.singleTap.touchend(e,n,a);if(l){const h=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(l)<30;if(h&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class uo{constructor(e){this._tr=new bn(e),this._zoomIn=new cl({numTouches:1,numTaps:2}),this._zoomOut=new cl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const l=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),y=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(l)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const lu={0:1,2:2};class ul{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=V.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const l=lu[a];return n.buttons===void 0||(n.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class cu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const hl=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}},uu=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new ul({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new Wn({clickTolerance:e,move:(l,h)=>({bearingDelta:(h.x-l.x)*n}),moveStateManager:a,enable:d,assignEvents:hl})},hu=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new ul({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new Wn({clickTolerance:e,move:(l,h)=>({pitchDelta:(h.y-l.y)*n}),moveStateManager:a,enable:d,assignEvents:hl})};class Ms{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const l=da(a,n),h=new u.P(0,0),y=new u.P(0,0);let x=0;for(const C in l){const M=l[C],z=this._touches[C];z&&(h._add(M),y._add(M.sub(z)),x++,l[C]=M)}if(this._touches=l,this._shouldBePrevented(x)||!y.mag())return;const S=y.div(x);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(x),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,h]=this._firstTwoTouches,y=pa(a,n,l),x=pa(a,n,h);if(!y||!x)return;const S=this._aroundCenter?null:y.add(x).div(2);return this._move([y,x],S,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[l,h]=this._firstTwoTouches,y=pa(a,n,l),x=pa(a,n,h);y&&x||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(d,e,n){for(let a=0;a<d.length;a++)if(d[a].identifier===n)return e[a]}function du(d,e){return Math.log(d/e)/Math.LN2}class pu extends dl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:du(this._distance,a),pinchAround:n}}}function fu(d,e){return 180*d.angleWith(e)/Math.PI}class mu extends dl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fu(this._vector,l),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=fu(e,this._startVector);return Math.abs(a)<n}}function pl(d){return Math.abs(d.y)>Math.abs(d.x)}class ho extends dl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,pl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,h=n.mag()>=2;if(!l&&!h)return;if(!l||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return pl(e)&&pl(n)&&y}}const ef={panStep:100,bearingStep:15,pitchStep:10};class cn{constructor(e){this._tr=new bn(e);const n=ef;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,l=0,h=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:x=>{const S=this._tr;x.easeTo({duration:300,easeId:"keyboardHandler",easing:Bn,zoom:n?Math.round(S.zoom)+n*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+l*this._pitchStep,offset:[-h*this._panStep,-y*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bn(d){return d*(2-d)}const gu=4.000244140625;class wn{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new bn(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=j.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%gu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=V.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?u.N.convert(this._aroundCenter?a.center:a.unproject(n)):u.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>gu?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,l=this._easing;let h,y=!1;const x=j.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&l&&x){const S=Math.min(x/200,1),C=l(S);h=u.y.number(a,n,C),S<1?this._frameId||(this._frameId=!0):y=!0}else h=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=u.b9;if(this._prevEase){const a=this._prevEase,l=(j.now()-a.start)/a.duration,h=a.easing(l+.01)-a.easing(l),y=.27/Math.sqrt(h*h+1e-4)*.01,x=Math.sqrt(.0729-y*y);n=u.b8(y,x,.25,1)}return this._prevEase={start:j.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zs{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $g{constructor(e){this._tr=new bn(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qg{constructor(){this._tap=new cl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],h=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(l)<30;h&&y?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],h=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,n,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tf{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rf{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _u{constructor(e,n,a,l){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class po{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const un=d=>d.zoom||d.drag||d.pitch||d.rotate;class pt extends u.k{}function fl(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class yu{constructor(e,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,h)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=l.type==="renderFrame"?void 0:l,x={needsRenderFrame:!1},S={},C={},M=l.touches,z=M?this._getMapTouches(M):void 0,B=z?V.touchPos(this._map.getCanvas(),z):V.mousePos(this._map.getCanvas(),l);for(const{handlerName:$,handler:re,allowed:ne}of this._handlers){if(!re.isEnabled())continue;let le;this._blockedByActive(C,ne,$)?re.reset():re[h||l.type]&&(le=re[h||l.type](l,B,z),this.mergeHandlerResult(x,S,le,$,y),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||re.isActive())&&(C[$]=re)}const Z={};for(const $ in this._previousActiveHandlers)C[$]||(Z[$]=y);this._previousActiveHandlers=C,(Object.keys(Z).length||fl(x))&&(this._changes.push([x,S,Z]),this._triggerRenderFrame()),(Object.keys(C).length||fl(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=x;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ou(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,h,y]of this._listeners)V.addEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,a]of this._listeners)V.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new Qp(n,e));const l=n.boxZoom=new $r(n,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const h=n.cooperativeGestures=new po(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const y=new uo(n),x=new $g(n);n.doubleClickZoom=new zs(x,y),this._add("tapZoom",y),this._add("clickZoom",x),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const S=new Qg;this._add("tapDragZoom",S);const C=n.touchPitch=new ho(n);this._add("touchPitch",C),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const M=uu(e),z=hu(e);n.dragRotate=new rf(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const B=(({enable:le,clickTolerance:K})=>{const de=new ul({checkCorrectEvent:me=>V.mouseButton(me)===0&&!me.ctrlKey});return new Wn({clickTolerance:K,move:(me,be)=>({around:be,panDelta:be.sub(me)}),activateOnStart:!0,moveStateManager:de,enable:le,assignEvents:hl})})(e),Z=new Ms(e,n);n.dragPan=new tf(a,B,Z),this._add("mousePan",B),this._add("touchPan",Z,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const H=new mu,$=new pu;n.touchZoomRotate=new _u(a,$,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const re=n.scrollZoom=new wn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",re,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const ne=n.keyboard=new cn(n);this._add("keyboard",ne),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Zi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!un(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const l in e)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,l,h){if(!a)return;u.e(e,a);const y={handlerName:l,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=y),a.panDelta!==void 0&&(n.drag=y),a.pitchDelta!==void 0&&(n.pitch=y),a.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},a={};for(const[l,h,y]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),u.e(n,h),u.e(a,y);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const l=this._map,h=l._getTransformForUpdate(),y=l.terrain;if(!(fl(e)||y&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:x,zoomDelta:S,bearingDelta:C,pitchDelta:M,around:z,pinchAround:B}=e;B!==void 0&&(z=B),l._stop(!0),z=z||l.transform.centerPoint;const Z=h.pointLocation(x?z.sub(x):z);C&&(h.bearing+=C),M&&(h.pitch+=M),S&&(h.zoom+=S),y?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(x)):h.setLocationAtPoint(Z,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(Z,z)):h.setLocationAtPoint(Z,z),l._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const l=un(this._eventsInProgress),h=un(e),y={};for(const z in e){const{originalEvent:B}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=B),this._eventsInProgress[z]=e[z]}!l&&h&&this._fireEvent("movestart",h.originalEvent);for(const z in y)this._fireEvent(z,y[z]);h&&this._fireEvent("move",h.originalEvent);for(const z in e){const{originalEvent:B}=e[z];this._fireEvent(z,B)}const x={};let S;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:Z}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],S=n[B]||Z,x[`${z}end`]=S)}for(const z in x)this._fireEvent(z,x[z]);const C=un(this._eventsInProgress),M=(l||h)&&!C;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;!z||!z.essential&&j.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:S})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new u.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new pt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class nf extends u.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((j.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(u.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(u.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(u.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,u.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=xe.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,l){const h={top:0,bottom:0,right:0,left:0};if(typeof(l=u.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const Qe=l.padding;l.padding={top:Qe,bottom:Qe,right:Qe,left:Qe}}l.padding=u.e(h,l.padding);const y=this.transform,x=y.padding,S=new xe(e,n),C=y.project(S.getNorthWest()),M=y.project(S.getNorthEast()),z=y.project(S.getSouthEast()),B=y.project(S.getSouthWest()),Z=u.ba(-a),H=C.rotate(Z),$=M.rotate(Z),re=z.rotate(Z),ne=B.rotate(Z),le=new u.P(Math.max(H.x,$.x,ne.x,re.x),Math.max(H.y,$.y,ne.y,re.y)),K=new u.P(Math.min(H.x,$.x,ne.x,re.x),Math.min(H.y,$.y,ne.y,re.y)),de=le.sub(K),me=(y.width-(x.left+x.right+l.padding.left+l.padding.right))/de.x,be=(y.height-(x.top+x.bottom+l.padding.top+l.padding.bottom))/de.y;if(be<0||me<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ze=Math.min(y.scaleZoom(y.scale*Math.min(me,be)),l.maxZoom),Ge=u.P.convert(l.offset),nt=new u.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(u.ba(a)),ct=Ge.add(nt).mult(y.scale/y.zoomScale(ze));return{center:y.unproject(C.add(z).div(2).sub(ct)),zoom:ze,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,l,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(e)),this.transform.pointLocation(u.P.convert(n)),a,l),l,h)}_fitInternal(e,n,a){return e?(delete(n=u.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let l=!1,h=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(l=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=u.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new u.k("movestart",n)).fire(new u.k("move",n)),l&&this.fire(new u.k("zoomstart",n)).fire(new u.k("zoom",n)).fire(new u.k("zoomend",n)),h&&this.fire(new u.k("rotatestart",n)).fire(new u.k("rotate",n)).fire(new u.k("rotateend",n)),y&&this.fire(new u.k("pitchstart",n)).fire(new u.k("pitch",n)).fire(new u.k("pitchend",n)),this.fire(new u.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,l=0){const h=u.Z.fromLngLat(e,n),y=u.Z.fromLngLat(a,l),x=y.x-h.x,S=y.y-h.y,C=y.z-h.z,M=Math.hypot(x,S,C);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(x,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),Z=180*Math.atan2(x,-S)/Math.PI;let H=180*Math.acos(z/M)/Math.PI;return H=C<0?90-H:90+H,{center:y.toLngLat(),zoom:B,pitch:H,bearing:Z}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.b9},e)).animate===!1||!e.essential&&j.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,x=l.pitch,S=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:x,z="padding"in e?e.padding:l.padding,B=u.P.convert(e.offset);let Z=l.centerPoint.add(B);const H=l.pointLocation(Z),{center:$,zoom:re}=l.getConstrained(u.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter($,l);const ne=l.project(H),le=l.project($).sub(ne),K=l.zoomScale(re-h);let de,me;e.around&&(de=u.N.convert(e.around),me=l.locationPoint(de));const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||re!==h,this._rotating=this._rotating||y!==C,this._pitching=this._pitching||M!==x,this._padding=!l.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,be),this.terrain&&this._prepareElevation($),this._ease(ze=>{if(this._zooming&&(l.zoom=u.y.number(h,re,ze)),this._rotating&&(l.bearing=u.y.number(y,C,ze)),this._pitching&&(l.pitch=u.y.number(x,M,ze)),this._padding&&(l.interpolatePadding(S,z,ze),Z=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(ze),de)l.setLocationAtPoint(de,me);else{const Ge=l.zoomScale(l.zoom-h),nt=re>h?Math.min(2,K):Math.max(.5,K),ct=Math.pow(nt,1-ze),Qe=l.unproject(ne.add(le.mult(ze*ct)).mult(Ge));l.setLocationAtPoint(l.renderWorldCopies?Qe.wrap():Qe,Z)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},ze=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ze)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new u.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new u.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new u.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new u.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=u.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const l=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:l.pitch,zoom:l.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&n.push(l=>this.transformCameraUpdate(l)),!n.length)return;const a=e.clone();for(const l of n){const h=a.clone(),{center:y,zoom:x,pitch:S,bearing:C,elevation:M}=l(h);y&&(h.center=y),x!==void 0&&(h.zoom=x),S!==void 0&&(h.pitch=S),C!==void 0&&(h.bearing=C),M!==void 0&&(h.elevation=M),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new u.k("move",e)),this._zooming&&this.fire(new u.k("zoom",e)),this._rotating&&this.fire(new u.k("rotate",e)),this._pitching&&this.fire(new u.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new u.k("zoomend",e)),l&&this.fire(new u.k("rotateend",e)),h&&this.fire(new u.k("pitchend",e)),this.fire(new u.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&j.prefersReducedMotion){const at=u.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(at,n)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b9},e);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,x=l.pitch,S=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:x,z="padding"in e?e.padding:l.padding,B=u.P.convert(e.offset);let Z=l.centerPoint.add(B);const H=l.pointLocation(Z),{center:$,zoom:re}=l.getConstrained(u.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter($,l);const ne=l.zoomScale(re-h),le=l.project(H),K=l.project($).sub(le);let de=e.curve;const me=Math.max(l.width,l.height),be=me/ne,ze=K.mag();if("minZoom"in e){const at=u.ac(Math.min(e.minZoom,h,re),l.minZoom,l.maxZoom),Lt=me/l.zoomScale(at-h);de=Math.sqrt(Lt/ze*2)}const Ge=de*de;function nt(at){const Lt=(be*be-me*me+(at?-1:1)*Ge*Ge*ze*ze)/(2*(at?be:me)*Ge*ze);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function ct(at){return(Math.exp(at)-Math.exp(-at))/2}function Qe(at){return(Math.exp(at)+Math.exp(-at))/2}const $e=nt(!1);let wt=function(at){return Qe($e)/Qe($e+de*at)},Ft=function(at){return me*((Qe($e)*(ct(Lt=$e+de*at)/Qe(Lt))-ct($e))/Ge)/ze;var Lt},tt=(nt(!0)-$e)/de;if(Math.abs(ze)<1e-6||!isFinite(tt)){if(Math.abs(me-be)<1e-6)return this.easeTo(e,n);const at=be<me?-1:1;tt=Math.abs(Math.log(be/me))/de,Ft=()=>0,wt=Lt=>Math.exp(at*de*Lt)}return e.duration="duration"in e?+e.duration:1e3*tt/("screenSpeed"in e?+e.screenSpeed/de:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=y!==C,this._pitching=M!==x,this._padding=!l.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation($),this._ease(at=>{const Lt=at*tt,Ii=1/wt(Lt);l.zoom=at===1?re:h+l.scaleZoom(Ii),this._rotating&&(l.bearing=u.y.number(y,C,at)),this._pitching&&(l.pitch=u.y.number(x,M,at)),this._padding&&(l.interpolatePadding(S,z,at),Z=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(at);const Ut=at===1?$:l.unproject(le.add(K.mult(Ft(Lt))).mult(Ii));l.setLocationAtPoint(l.renderWorldCopies?Ut.wrap():Ut,Z),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=j.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=u.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const fo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class mo{constructor(e=fo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const h=n[l];if(h.used||h.usedForTerrain){const y=h.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,h)=>l.length-h.length),e=e.filter((l,h)=>{for(let y=h+1;y<e.length;y++)if(e[y].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class vu{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const n=V.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class $t{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var xu=u.Y([{name:"a_pos3d",type:"Int16",components:3}]);class e_ extends u.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const l of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),u.aP(l.posMatrix,0,u.X,0,u.X,0,1),this._tiles[l.key]=new ts(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),u.aP(h.posMatrix,0,u.X,0,u.X,0,1),n[a]=h}else if(l.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=l.canonical.z-e.canonical.z,x=l.canonical.x-(l.canonical.x>>y<<y),S=l.canonical.y-(l.canonical.y>>y<<y),C=u.X>>y;u.aP(h.posMatrix,0,C,0,C,0,1),u.J(h.posMatrix,h.posMatrix,[-x*C,-S*C,0]),n[a]=h}else if(e.canonical.isChildOf(l.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=e.canonical.z-l.canonical.z,x=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),C=u.X>>y;u.aP(h.posMatrix,0,u.X,0,u.X,0,1),u.J(h.posMatrix,h.posMatrix,[x*C,S*C,0]),u.K(h.posMatrix,h.posMatrix,[1/2**y,1/2**y,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;l>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(l--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class bu{constructor(e,n,a){this.painter=e,this.sourceCache=new e_(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,l=u.X){var h;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const y=this.getTerrainData(e),x=(h=y.tile)===null||h===void 0?void 0:h.dem;if(!x)return 0;const S=function(H,$,re){var ne=$[0],le=$[1];return H[0]=re[0]*ne+re[4]*le+re[12],H[1]=re[1]*ne+re[5]*le+re[13],H}([],[n/l*u.X,a/l*u.X],y.u_terrain_matrix),C=[S[0]*x.dim,S[1]*x.dim],M=Math.floor(C[0]),z=Math.floor(C[1]),B=C[0]-M,Z=C[1]-z;return x.get(M,z)*(1-B)*(1-Z)+x.get(M+1,z)*B*(1-Z)+x.get(M,z+1)*(1-B)*Z+x.get(M+1,z+1)*B*Z}getElevationForLngLatZoom(e,n){if(!u.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,l%u.X,h%u.X,u.X)}getElevation(e,n,a,l=u.X){return this.getDEMElevation(e,n,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,h=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new st(l,h,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new st(l,new u.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new st(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?h=e.canonical.z-l:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>h<<h),x=e.canonical.y-(e.canonical.y>>h<<h),S=u.bc(new Float64Array(16),[1/(u.X<<h),1/(u.X<<h),0]);u.J(S,S,[y*u.X,x*u.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new st(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new st(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,y=0;h<this._coordsTextureSize;h++)for(let x=0;x<this._coordsTextureSize;x++,y+=4)n[y+0]=255&x,n[y+1]=255&h,n[y+2]=x>>8<<4|h>>8,n[y+3]=0;const a=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new st(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,l=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),x=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(h,x-y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const S=n[0]+(n[2]>>4<<8),C=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const B=this._coordsTextureSize,Z=(1<<z.tileID.canonical.z)*B;return new u.Z((z.tileID.canonical.x*B+S)/Z+z.tileID.wrap,(z.tileID.canonical.y*B+C)/Z,this.getElevation(z.tileID,S,C,B))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new u.bd,a=new u.aY,l=this.meshSize,h=u.X/l,y=l*l;for(let z=0;z<=l;z++)for(let B=0;B<=l;B++)n.emplaceBack(B*h,z*h,0);for(let z=0;z<y;z+=l+1)for(let B=0;B<l;B++)a.emplaceBack(B+z,l+B+z+1,l+B+z+2),a.emplaceBack(B+z,l+B+z+2,B+z+1);const x=n.length,S=x+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const Z of[0,1])n.emplaceBack(B*h,z*u.X,Z);for(let z=0;z<2*l;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(x+z,x+z+3,x+z+1),a.emplaceBack(x+z,x+z+2,x+z+3);const C=n.length,M=C+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const Z of[0,1])n.emplaceBack(z*u.X,B*h,Z);for(let z=0;z<2*l;z+=2)a.emplaceBack(C+z,C+z+1,C+z+3),a.emplaceBack(C+z,C+z+3,C+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new nl(e.createVertexBuffer(n,xu.members),e.createIndexBuffer(a),u.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*u.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=u.Z.fromLngLat(e.wrap()),l=(1<<n)*u.X,h=a.x*l,y=a.y*l,x=Math.floor(h/u.X),S=Math.floor(y/u.X);return{tileID:new u.S(n,0,n,x,S),mercatorX:h,mercatorY:y}}}class t_{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new st(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const go={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class sf{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new t_(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const h of l){const y=this.terrain.sourceCache.getTerrainCoords(h);for(const x in y)this._coordsDescendingInv[a][x]||(this._coordsDescendingInv[a][x]=[]),this._coordsDescendingInv[a][x].push(y[x])}}this._coordsDescendingInvStr={};for(const a of e._order){const l=e._layers[a],h=l.source;if(go[l.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const y in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][y]=this._coordsDescendingInv[h][y].map(x=>x.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[l][a.tileID.key];h&&h!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(go[n]&&(this._prevType&&go[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!l))return!0;if(go[this._prevType]||go[n]&&l){this._prevType=n;const h=this._stacks.length-1,y=this._stacks[h]||[];for(const x of this._renderableTiles){if(this.pool.isFull()&&(Jp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(x),x.rtt[h]){const C=this.pool.getObjectForId(x.rtt[h].id);if(C.stamp===x.rtt[h].stamp){this.pool.useObject(C);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),x.rtt[h]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:u.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let C=0;C<y.length;C++){const M=a.style._layers[y[C]],z=M.source?this._coordsDescendingInv[M.source][x.tileID.key]:[x.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(x.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][x.tileID.key])}}return Jp(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),go[n]}return!1}}const wu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},of=U,i_={hash:!1,interactive:!0,bearingSnap:7,attributionControl:fo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Su=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},r_={showCompass:!0,showZoom:!0,visualizePitch:!1};class n_{constructor(e,n,a=!1){this.mousedown=y=>{this.startMouse(u.e({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),V.mousePos(this.element,y)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.moveMouse(y,V.mousePos(this.element,y))},this.mouseup=y=>{this.mouseRotate.dragEnd(y),this.mousePitch&&this.mousePitch.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.startTouch(y,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.moveTouch(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=uu({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:y,clickTolerance:x,bearingDegreesPerPixelMoved:S=.8})=>{const C=new cu;return new Wn({clickTolerance:x,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:C,enable:y,assignEvents:Su})})({clickTolerance:l,enable:!0}),this.map=e,a&&(this.mousePitch=hu({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:y,clickTolerance:x,pitchDegreesPerPixelMoved:S=-.5})=>{const C=new cu;return new Wn({clickTolerance:x,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:C,enable:y,assignEvents:Su})})({clickTolerance:h,enable:!0})),V.addEventListener(n,"mousedown",this.mousedown),V.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),V.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),V.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let Qr;function Ti(d,e,n){const a=new u.N(d.lng,d.lat);if(d=new u.N(d.lng,d.lat),e){const l=new u.N(d.lng-360,d.lat),h=new u.N(d.lng+360,d.lat),y=n.locationPoint(d).distSqr(e);n.locationPoint(l).distSqr(e)<y?d=l:n.locationPoint(h).distSqr(e)<y&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){const l=n.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==a.lng&&n.locationPoint(d).y>n.height/2-n.getHorizon()?d:a}const _o={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ml(d,e,n){const a=d.classList;for(const l in _o)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${e}`)}class gl extends u.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ti(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${_o[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${h}`),j.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const n=V.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const h=V.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const y=V.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const x=V.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(3.0, 29.0)"),x.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ne of S){const le=V.createNS("http://www.w3.org/2000/svg","ellipse");le.setAttributeNS(null,"opacity","0.04"),le.setAttributeNS(null,"cx","10.5"),le.setAttributeNS(null,"cy","5.80029008"),le.setAttributeNS(null,"rx",ne.rx),le.setAttributeNS(null,"ry",ne.ry),x.appendChild(le)}const C=V.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(M);const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const B=V.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(B);const Z=V.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const H=V.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const $=V.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#000000"),$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962");const re=V.createNS("http://www.w3.org/2000/svg","circle");re.setAttributeNS(null,"fill","#FFFFFF"),re.setAttributeNS(null,"cx","5.5"),re.setAttributeNS(null,"cy","5.5"),re.setAttributeNS(null,"r","5.4999962"),H.appendChild($),H.appendChild(re),y.appendChild(x),y.appendChild(C),y.appendChild(z),y.appendChild(Z),y.appendChild(H),n.appendChild(y),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),ml(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,h=l.terrain.depthAtPoint(this._pos),y=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,y)-h<.006)return void(this._element.style.opacity=this._opacity);const x=-this._offset.y/l.transform._pixelPerMeter,S=Math.sin(l.getPitch()*Math.PI/180)*x,C=l.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),M=l.transform.lngLatToCameraDepth(this._lngLat,y+S)-C>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const af={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let fa=0,ma=!1;const Nn={maxWidth:100,unit:"metric"};function ga(d,e,n){const a=n&&n.maxWidth||100,l=d._container.clientHeight/2,h=d.unproject([0,l]),y=d.unproject([a,l]),x=h.distanceTo(y);if(n&&n.unit==="imperial"){const S=3.2808*x;S>5280?bt(e,a,S/5280,d._getUIString("ScaleControl.Miles")):bt(e,a,S,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?bt(e,a,x/1852,d._getUIString("ScaleControl.NauticalMiles")):x>=1e3?bt(e,a,x/1e3,d._getUIString("ScaleControl.Kilometers")):bt(e,a,x,d._getUIString("ScaleControl.Meters"))}function bt(d,e,n,a){const l=function(h){const y=Math.pow(10,`${Math.floor(h)}`.length-1);let x=h/y;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(x),y*x}(n);d.style.width=e*(l/n)+"px",d.innerHTML=`${l}&nbsp;${a}`}const kt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_l=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yl(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,d),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-d),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(d,0),right:new u.P(-d,0)}}if(d instanceof u.P||Array.isArray(d)){const e=u.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(d.center||[0,0]),top:u.P.convert(d.top||[0,0]),"top-left":u.P.convert(d["top-left"]||[0,0]),"top-right":u.P.convert(d["top-right"]||[0,0]),bottom:u.P.convert(d.bottom||[0,0]),"bottom-left":u.P.convert(d["bottom-left"]||[0,0]),"bottom-right":u.P.convert(d["bottom-right"]||[0,0]),left:u.P.convert(d.left||[0,0]),right:u.P.convert(d.right||[0,0])}}return yl(new u.P(0,0))}const Pu=U;w.AJAXError=u.bh,w.Evented=u.E,w.LngLat=u.N,w.MercatorCoordinate=u.Z,w.Point=u.P,w.addProtocol=u.bi,w.config=u.a,w.removeProtocol=u.bj,w.AttributionControl=mo,w.BoxZoomHandler=$r,w.CanvasSource=Lr,w.CooperativeGesturesHandler=po,w.DoubleClickZoomHandler=zs,w.DragPanHandler=tf,w.DragRotateHandler=rf,w.EdgeInsets=lo,w.FullscreenControl=class extends u.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=gn,w.GeolocateControl=class extends u.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new u.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),h=u.e({bearing:l},this.options.fitBoundsOptions),y=xe.fromLngLat(n,a);this._map.fitBounds(y,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new u.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ma)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new gl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new gl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},af,d)}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(Qr!==void 0&&!e)return Qr;if(window.navigator.permissions===void 0)return Qr=!!window.navigator.geolocation,Qr;try{Qr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qr=!!window.navigator.geolocation}return Qr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fa=0,ma=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),a=e.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fa--,ma=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fa++,fa>1?(d={maximumAge:6e5,timeout:0},ma=!0):(d=this.options.positionOptions,ma=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=ol,w.ImageSource=Rr,w.KeyboardHandler=cn,w.LngLatBounds=xe,w.LogoControl=vu,w.Map=class extends nf{constructor(d){u.bf.mark(u.bg.create);const e=Object.assign(Object.assign({},i_),d);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new co(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new $t,this._controls=[],this._mapId=u.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},wu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new Be(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=ca(l=>{this._trackResize&&!this._removed&&(this.resize(l),this.redraw())},50);this._resizeObserver=new ResizeObserver(l=>{n?a(l):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new yu(this,e),this._hash=e.hash&&new ol(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,u.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new mo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new vu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new u.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new u.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new u.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,a)}resize(d){var e;const n=this._containerDimensions(),a=n[0],l=n[1],h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,S),this.painter.resize(a,l,S)}this.transform.resize(a,l),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l);const y=!this._moving;return y&&(this.stop(),this.fire(new u.k("movestart",d)).fire(new u.k("move",d))),this.fire(new u.k("resize",d)),y&&this.fire(new u.k("moveend",d)),this}_getClampedPixelRatio(d,e){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),h=d*l,y=e*l;return Math.min(h>n?n/h:1,y>a?a/y:1)*l}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(xe.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(u.N.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(u.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const y=e.filter(S=>this.getLayer(S)),x=y.length!==0?this.queryRenderedFeatures(h.point,{layers:y}):[];x.length?a||(a=!0,n.call(this,new gr(d,this,h.originalEvent,{features:x}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const x=e.filter(S=>this.getLayer(S));(x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[]).length?a=!0:a&&(a=!1,n.call(this,new gr(d,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,n.call(this,new gr(d,this,y.originalEvent)))}}}}{const a=l=>{const h=e.filter(x=>this.getLayer(x)),y=h.length!==0?this.queryRenderedFeatures(l.point,{layers:h}):[];y.length&&(l.features=y,n.call(this,l),delete l.features)};return{layers:e,listener:n,delegates:{[d]:a}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const a=this._delegatedListeners[d];for(let l=0;l<a.length;l++){const h=a[l];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(y=>e.includes(y))){for(const y in h.delegates)this.off(y,h.delegates[y]);return void a.splice(l,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);const a=this._createDelegatedListener(d,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(d,a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(d,e,n){if(n===void 0)return super.once(d,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(d,a,n);for(const h in l.delegates){const y=l.delegates[h];l.delegates[h]=(...x)=>{this._removeDelegatedListener(d,a,n),y(...x)}}this._saveDelegatedListener(d,l);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n;const a=d instanceof u.P||Array.isArray(d),l=a?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:d)||{},l instanceof u.P||typeof l[0]=="number")n=[u.P.convert(l)];else{const h=u.P.convert(l[0]),y=u.P.convert(l[1]);n=[h,new u.P(y.x,h.y),y,new u.P(h.x,y.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new qa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,n):this.style.loadJSON(d,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new qa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,"Style");u.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new u.j(a))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){u.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new u.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===d.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new bu(this.painter,e,d),this.painter.renderToTexture=new sf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const n=d[e]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:h,stretchY:y,content:x,textFitWidth:S,textFitHeight:C}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:B}=e,Z=e;return this.style.addImage(d,{data:new u.R({width:M,height:z},new Uint8Array(B)),pixelRatio:a,stretchX:h,stretchY:y,content:x,textFitWidth:S,textFitHeight:C,sdf:l,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,d),this}}{const{width:M,height:z,data:B}=j.getImageData(e);this.style.addImage(d,{data:new u.R({width:M,height:z},B),pixelRatio:a,stretchX:h,stretchY:y,content:x,textFitWidth:S,textFitHeight:C,sdf:l,version:0})}}updateImage(d,e){const n=this.style.getImage(d);if(!n)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||u.b(e)?j.getImageData(e):e,{width:l,height:h,data:y}=a;if(l===void 0||h===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||h!==n.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(e instanceof HTMLImageElement||u.b(e));return n.data.replace(y,x),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Ee.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,a={}){return this.style.setPaintProperty(d,e,n,a),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,a={}){return this.style.setLayoutProperty(d,e,n,a),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,a=>{a||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d){return this._lazyInitEmptyStyle(),this.style.setSky(d),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=V.create("div","maplibregl-control-container",d),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{h[y]=V.create("div",`maplibregl-ctrl-${y} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:d},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new sl(n,this.transform),ae.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,h=j.now();this.style.zoomHistory.update(l,h);const y=new u.z(l,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),x=y.crossFadingFactor();x===1&&x===this._crossFadingFactor||(n=!0,this._crossFadingFactor=x),this.style.update(y)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bf.mark(u.bg.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,u.bf.mark(u.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ee.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bf.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,j.frameAsync(this._frameRequest).then(d=>{u.bf.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return of}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=gr,w.MapTouchEvent=ks,w.MapWheelEvent=$p,w.Marker=gl,w.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=u.e({},r_,d),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new n_(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const n=V.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},w.Popup=class extends u.E{constructor(d){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ti(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const h=yl(this.options.offset);if(!l){const x=this._container.offsetWidth,S=this._container.offsetHeight;let C;C=a.y+h.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<x/2?C.push("left"):a.x>this._map.transform.width-x/2&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let y=a.add(h[l]);this.options.subpixelPositioning||(y=y.round()),V.setTransform(this._container,`${_o[l]} translate(${y.x}px,${y.y}px)`),ml(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(kt),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=u.N.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=d;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(_l);d&&d.focus()}},w.RasterDEMTileSource=ui,w.RasterTileSource=Xt,w.ScaleControl=class{constructor(d){this._onMove=()=>{ga(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ga(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Nn),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=wn,w.Style=qa,w.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=ho,w.TwoFingersTouchRotateHandler=mu,w.TwoFingersTouchZoomHandler=pu,w.TwoFingersTouchZoomRotateHandler=_u,w.VectorTileSource=sn,w.VideoSource=Dn,w.addSourceType=(d,e)=>u._(void 0,void 0,void 0,function*(){if(es(d))throw new Error(`A source type called "${d}" already exists.`);((n,a)=>{Xs[n]=a})(d,e)}),w.clearPrewarmedResources=function(){const d=Di;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(hi),Di=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return Rn().getRTLTextPluginStatus()},w.getVersion=function(){return Pu},w.getWorkerCount=function(){return Li.workerCount},w.getWorkerUrl=function(){return u.a.WORKER_URL},w.importScriptInWorkers=function(d){return mr().broadcast("IS",d)},w.prewarm=function(){ar().acquire(hi)},w.setMaxParallelImageRequests=function(d){u.a.MAX_PARALLEL_IMAGE_REQUESTS=d},w.setRTLTextPlugin=function(d,e){return Rn().setRTLTextPlugin(d,e)},w.setWorkerCount=function(d){Li.workerCount=d},w.setWorkerUrl=function(d){u.a.WORKER_URL=d}});var E=g;return E})}(Bf)),Bf.exports}var jC=VC();const Lc=W0(jC);var Ic,gp,Zo,Fa,$o,Ty,Iy;class UC{constructor(o,g){X(this,$o);X(this,Ic,Je());X(this,gp);X(this,Zo,0);X(this,Fa,null);T(this,Ic).v=qe(o),je(this,gp,g)}get current(){return C0()?Tt(()=>(Zu(this,Zo)._++,T(this,Zo)===1&&Er(this,$o,Ty).call(this,!0),()=>{Pg().then(()=>{Zu(this,Zo)._--,T(this,Zo)===0&&Er(this,$o,Iy).call(this)})})):T(this,Zo)===0&&(Er(this,$o,Ty).call(this,!1),Er(this,$o,Iy).call(this)),F(T(this,Ic))}}Ic=new WeakMap,gp=new WeakMap,Zo=new WeakMap,Fa=new WeakMap,$o=new WeakSet,Ty=function(o){je(this,Fa,T(this,gp).call(this,g=>{Fe(T(this,Ic),qe(g))},o)??null)},Iy=function(){T(this,Fa)!==null&&(T(this,Fa).call(this),je(this,Fa,null))};new UC(null,(m,o)=>{function g(){m(document.activeElement)}if(g(),!!o)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function qC(m,o,g,b){const I=Array.isArray(o)?o:[o];for(const E of I)m.addEventListener(E,g,b);return()=>{for(const E of I)m.removeEventListener(E,g,b)}}function v0({key:m,storage:o,serializer:g}){if(!o)return{found:!1,value:null};const b=o.getItem(m);if(b===null)return{found:!1,value:null};try{return{found:!0,value:g.deserialize(b)}}catch(I){return console.error(`Error when parsing ${b} from persisted store "${m}"`,I),{found:!1,value:null}}}function ZC({key:m,value:o,storage:g,serializer:b}){if(g)try{g.setItem(m,b.serialize(o))}catch(I){console.error(`Error when writing value from persisted store "${m}" to ${g}`,I)}}function GC(m){return typeof window>"u"?null:{local:localStorage,session:sessionStorage}[m]}var Go,Wo,Ho,Ba,Sg,Ob;class WC{constructor(o,g,b={}){X(this,Sg);X(this,Go,Je());X(this,Wo);X(this,Ho);X(this,Ba);const{storage:I="local",serializer:E={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:w=!0}=b;je(this,Wo,o),je(this,Ho,GC(I)),je(this,Ba,E);const u=v0({key:T(this,Wo),storage:T(this,Ho),serializer:T(this,Ba)});T(this,Go).v=qe(u.found?u.value:g),Tt(()=>{ZC({key:T(this,Wo),value:F(T(this,Go)),storage:T(this,Ho),serializer:T(this,Ba)})}),Tt(()=>{if(w)return qC(window,"storage",Er(this,Sg,Ob).bind(this))})}get current(){return F(T(this,Go))}set current(o){Fe(T(this,Go),qe(o))}}Go=new WeakMap,Wo=new WeakMap,Ho=new WeakMap,Ba=new WeakMap,Sg=new WeakSet,Ob=function(o){if(o.key!==T(this,Wo)||!T(this,Ho))return;const g=v0({key:T(this,Wo),storage:T(this,Ho),serializer:T(this,Ba)});g.found&&Fe(T(this,Go),qe(g.value))};var _p;class x0{constructor(o){X(this,_p,Je());this.value=o}get value(){return F(T(this,_p))}set value(o){Fe(T(this,_p),qe(o))}}_p=new WeakMap;var yp,vp,xp,bp;class HC{constructor(){X(this,yp,Je());X(this,vp,Je(!1));Ve(this,"loadedImages",new vy);X(this,xp,Je(0));X(this,bp,Je(24));Ve(this,"layerInfo",new Map);Ve(this,"eventTracker",new WeakMap);Ve(this,"eventTopMost");Ve(this,"markerClickManager",new eE);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return F(T(this,yp))}set map(o){Fe(T(this,yp),qe(o))}get loaded(){return F(T(this,vp))}set loaded(o){Fe(T(this,vp),qe(o))}get minzoom(){return F(T(this,xp))}set minzoom(o){Fe(T(this,xp),qe(o))}get maxzoom(){return F(T(this,bp))}set maxzoom(o){Fe(T(this,bp),qe(o))}_eventTopMost(o){var E;let g=this.eventTracker.get(o.originalEvent);if(g!==void 0)return g;let I=(E=o.target.queryRenderedFeatures(o.point).find(w=>{var u;return(u=this.layerInfo.get(w.layer.id))==null?void 0:u.interactive}))==null?void 0:E.layer.id;return this.eventTracker.set(o.originalEvent,I),I}}yp=new WeakMap,vp=new WeakMap,xp=new WeakMap,bp=new WeakMap;function XC(m){wp(JC,m)}function KC(m){wp(YC,m)}const Fb=Symbol.for("svelte-maplibre"),JC=Symbol.for("svelte-maplibre.popup-target"),YC=Symbol.for("svelte-maplibre.layer-event");function Ip(){return Ay(Fb)}function $C(){return wp(Fb,new HC)}function QC(){const m=new x0(void 0),o=new x0(void 0);return XC(m),KC(o),{marker:m,layerEvent:o}}class eE{constructor(){Ve(this,"_handlers",new Set)}add(o){this._handlers.add(o)}remove(o){this._handlers.delete(o)}handleClick(o){for(const g of this._handlers)g(o)}}function tE(m){return Object.fromEntries(Object.entries(m).filter(([o,g])=>g!=null))}P0(["click"]);function iE(m,o){Mt(o,!0);const g=Te(Ip),b=Te(()=>F(g).map),I=Te(()=>F(g).loaded);let E=te(o,"position",3,"top-left"),w=te(o,"container",3,void 0),u=Je(void 0),U=Te(()=>typeof w()=="string"?document.querySelector(w())??void 0:w());Tt(()=>{F(U)&&!F(u)&&(Fe(u,qe(new Lc.FullscreenControl({container:F(U)}))),F(b).addControl(F(u),E()))}),Ig(()=>{F(I)&&F(u)&&F(b).removeControl(F(u))}),zt()}function rE(m,o){Mt(o,!0);const g=Te(Ip),b=Te(()=>F(g).map),I=Te(()=>F(g).loaded);let E=te(o,"position",3,"top-left"),w=te(o,"positionOptions",3,void 0),u=te(o,"fitBoundsOptions",3,void 0),U=te(o,"trackUserLocation",3,!1),W=te(o,"showAccuracyCircle",3,!0),Q=te(o,"showUserLocation",3,!0),j=te(o,"control",15);Tt(()=>{F(b)&&!j()&&(j(new Lc.GeolocateControl({positionOptions:w(),fitBoundsOptions:u(),trackUserLocation:U(),showAccuracyCircle:W(),showUserLocation:Q()})),F(b).addControl(j(),E()))}),Ig(()=>{F(I)&&j()&&F(b).removeControl(j())}),zt()}function nE(m){let o=m.getCenter(),g=Math.round(m.getZoom()*100)/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,b),E=Math.round(o.lat*I)/I,w=Math.round(o.lng*I)/I,u=`${g}/${E}/${w}`,U=m.getBearing(),W=m.getPitch();return(U||W)&&(u+=`/${Math.round(U*10)/10}`),W&&(u+=`/${Math.round(W)}`),`#${u}`}function sE(m){return m.replace("#","").split("/").map(parseFloat)}var Fl=Hy;function Hy(m,o){return m===o||m!==m&&o!==o?!0:typeof m!=typeof o||{}.toString.call(m)!={}.toString.call(o)||m!==Object(m)||!m?!1:Array.isArray(m)?b0(m,o):{}.toString.call(m)=="[object Set]"?b0(Array.from(m),Array.from(o)):{}.toString.call(m)=="[object Object]"?aE(m,o):oE(m,o)}function oE(m,o){return m.toString()===o.toString()}function b0(m,o){var g=m.length;if(g!=o.length)return!1;for(var b=0;b<g;b++)if(!Hy(m[b],o[b]))return!1;return!0}function aE(m,o){var g=Object.keys(m),b=g.length;if(b!=Object.keys(o).length)return!1;for(var I=0;I<b;I++){var E=g[I];if(!(o.hasOwnProperty(E)&&Hy(m[E],o[E])))return!1}return!0}function lE(m,o){Mt(o,!0);const g=Te(Ip),b=Te(()=>F(g).map),I=Te(()=>F(g).loaded);let E=te(o,"position",3,"top-left"),w=te(o,"showCompass",3,!0),u=te(o,"showZoom",3,!0),U=te(o,"visualizePitch",3,!1),W=Je(void 0);Tt(()=>{F(b)&&!F(W)&&(Fe(W,qe(new Lc.NavigationControl({showCompass:w(),showZoom:u(),visualizePitch:U()}))),F(b).addControl(F(W),E()))}),Ig(()=>{F(I)&&F(W)&&F(b).removeControl(F(W))}),zt()}function cE(m,o){Mt(o,!0);const g=Te(Ip),b=Te(()=>F(g).map),I=Te(()=>F(g).loaded);let E=te(o,"position",3,"bottom-left"),w=te(o,"maxWidth",3,void 0),u=te(o,"unit",3,"metric"),U=Je(void 0);Tt(()=>{F(b)&&!F(U)&&(Fe(U,qe(new Lc.ScaleControl({maxWidth:w(),unit:u()}))),F(b).addControl(F(U),E()))}),Ig(()=>{F(I)&&F(U)&&F(b).removeControl(F(U))}),zt()}var uE=Gt("<!> <!> <!> <!>",1),hE=Gt("<!> <!>",1),dE=Gt('<div data-testid="map-container"><!></div>');function pE(m,o){Mt(o,!0);let g=te(o,"map",15,void 0),b=te(o,"mapContainer",15,void 0),I=te(o,"class",3,void 0),E=te(o,"diffStyleUpdates",3,!1),w=te(o,"center",15,void 0),u=te(o,"zoom",15,void 0),U=te(o,"pitch",15,0),W=te(o,"bearing",15,0),Q=te(o,"bounds",15,void 0),j=te(o,"hash",3,!1),V=te(o,"updateHash",3,vt=>{window.history.replaceState(window.history.state,"",vt)}),ae=te(o,"loaded",15,!1),se=te(o,"minZoom",3,0),ue=te(o,"maxZoom",3,22),fe=te(o,"minPitch",3,0),Pe=te(o,"maxPitch",3,60),_e=te(o,"renderWorldCopies",3,void 0),Ee=te(o,"dragPan",3,void 0),Be=te(o,"dragRotate",3,void 0),De=te(o,"pitchWithRotate",3,void 0),Oe=te(o,"antialias",3,void 0),Ze=te(o,"zoomOnDoubleClick",3,!0),ft=te(o,"locale",3,void 0),We=te(o,"interactive",3,!0),mt=te(o,"attributionControl",3,void 0),st=te(o,"cooperativeGestures",3,!1),Ue=te(o,"preserveDrawingBuffer",3,!1),Re=te(o,"maxBounds",3,void 0),Ae=te(o,"images",19,()=>[]),Ke=te(o,"standardControls",3,!1),rt=te(o,"filterLayers",3,void 0),_t=te(o,"transformRequest",3,void 0),yt=Te(()=>typeof Ke()=="boolean"?void 0:Ke());const ht=$C();let xt=Je(qe(new Set));async function Dt(vt,Nt=!1){var xe;if(g()&&!(!((xe=g())!=null&&xe.loaded())&&!Nt))if("url"in vt){F(xt).add(vt.id);try{let Pi=await g().loadImage(vt.url);g().addImage(vt.id,Pi.data,vt.options),ht.loadedImages.add(vt.id)}catch(Pi){o.onerror?o.onerror({error:Pi}):console.error(Pi)}finally{F(xt).delete(vt.id)}}else g().addImage(vt.id,vt.data,vt.options),ht.loadedImages.add(vt.id)}Tt(()=>{var vt;if(ae()&&((vt=g())!=null&&vt.loaded()))for(let Nt of Ae())!ht.loadedImages.has(Nt.id)&&!F(xt).has(Nt.id)&&!g().hasImage(Nt.id)&&Dt(Nt)});let qt=Te(()=>Ae().every(vt=>ht.loadedImages.has(vt.id))),vi=Je(void 0),hi=Je(void 0),Li=Je(void 0),Ui=Je(void 0);function Di(vt){o.onerror?o.onerror(vt):vt.error.name!=="AbortError"&&console.error(vt.error)}function er(vt){return Wr(),g(ht.map=new Lc.Map(tE({container:vt,style:o.style,locale:ft(),center:w(),zoom:u(),pitch:U(),bearing:W(),minZoom:se(),maxZoom:ue(),minPitch:fe(),maxPitch:Pe(),renderWorldCopies:_e(),dragPan:Ee(),dragRotate:Be(),pitchWithRotate:De(),antialias:Oe(),interactive:We(),preserveDrawingBuffer:Ue(),maxBounds:Re(),bounds:Q(),attributionControl:mt(),transformRequest:_t(),cooperativeGestures:st()}))),g().on("load",Nt=>{Nt.target.getContainer().setAttribute("data-testid","map"),Nt.target.getCanvas().setAttribute("data-testid","map-canvas"),o.onload&&o.onload(g()),ht.loaded=!0,ae(!0)}),g().on("error",Di),o.onmovestart&&g().on("movestart",o.onmovestart),g().on("moveend",Nt=>{var xe;if(w(Nt.target.getCenter()),u(Nt.target.getZoom()),U(Nt.target.getPitch()),W(Nt.target.getBearing()),Q(Nt.target.getBounds()),(xe=o.onmoveend)==null||xe.call(o,Nt),j()){let Pi=new URL(window.location.href.replace(/(#.+)?$/,nE(Nt.target)));V()(Pi)}}),o.onclick&&g().on("click",o.onclick),o.ondblclick&&g().on("dblclick",o.ondblclick),o.oncontextmenu&&g().on("contextmenu",o.oncontextmenu),o.onmousemove&&g().on("mousemove",o.onmousemove),o.onzoomstart&&g().on("zoomstart",o.onzoomstart),o.onzoom&&g().on("zoom",o.onzoom),o.onzoomend&&g().on("zoomend",o.onzoomend),o.onpitch&&g().on("pitch",o.onpitch),o.onrotate&&g().on("rotate",o.onrotate),o.onwheel&&g().on("wheel",o.onwheel),o.ondata&&g().on("data",o.ondata),o.onidle&&g().on("idle",o.onidle),g().on("style.load",()=>{if(g()){const Nt=g().getStyle();if(Fe(vi,qe(Nt.layers.map(xe=>xe.id))),Fe(hi,qe(Object.keys(Nt.sources))),F(Ui))for(const[xe,Pi]of Object.entries(F(Ui)))g().addSource(xe,Pi);if(F(Li))for(const xe of F(Li))g().addLayer(xe);for(const xe of Ae())Dt(xe,!0)}}),g().on("styledata",Nt=>{var xe;if(g()&&rt()){const Pi=g().getStyle().layers;if(Pi)for(let sn of Pi)rt()(sn)||g().setLayoutProperty(sn.id,"visibility","none")}(xe=o.onstyledata)==null||xe.call(o,Nt)}),{destroy(){var Nt;ae(!1),ht.loaded=!1,(Nt=g())==null||Nt.remove()}}}let ar=Je(qe(o.style));Tt(()=>{if(g()&&!Fl(o.style,F(ar))){const vt=g().getStyle();if(F(vi)&&Fe(Li,qe(vt.layers.filter(Nt=>!F(vi).includes(Nt.id)))),F(hi)){const Nt=Object.keys(vt.sources).filter(xe=>!F(hi).includes(xe));Fe(Ui,qe({}));for(const xe of Nt)F(Ui)[xe]=vt.sources[xe]}Fe(ar,qe(o.style)),g().setStyle(o.style,{diff:E()}),ht.loadedImages.clear(),Fe(xt,qe(new Set))}}),Tt(()=>{if(g()){let vt={};w()!=null&&!Fl(w(),g().getCenter())&&(vt.center=w()),u()!=null&&!Fl(u(),g().getZoom())&&(vt.zoom=u()),W()!=null&&!Fl(W(),g().getBearing())&&(vt.bearing=W()),U()!=null&&!Fl(U(),g().getPitch())&&(vt.pitch=U()),Object.keys(vt).length&&g().easeTo(vt)}}),Tt(()=>{var vt,Nt;Q()&&!Fl(Q(),(vt=g())==null?void 0:vt.getBounds())&&((Nt=g())==null||Nt.fitBounds(Q()))}),Tt(()=>{var vt,Nt;Ze()?(vt=g())==null||vt.doubleClickZoom.enable():(Nt=g())==null||Nt.doubleClickZoom.disable()});function Wr(){if(j()){let vt=sE(window.location.hash);vt.length>=3&&(u(vt[0]),w([vt[2],vt[1]])),vt.length==5&&(W(vt[3]),U(vt[4]))}}var mr=dE();ly("hashchange",n2,Wr);var Hr=Mi(mr);{var Dr=vt=>{var Nt=hE(),xe=Xe(Nt);{var Pi=Xt=>{var ui=uE(),gn=Xe(ui);lE(gn,{get position(){return F(yt)}});var Xr=Fi(gn,2);rE(Xr,{get position(){return F(yt)},fitBoundsOptions:{maxZoom:12}});var Rr=Fi(Xr,2);iE(Rr,{get position(){return F(yt)}});var Dn=Fi(Rr,2);cE(Dn,{get position(){return F(yt)}}),Me(Xt,ui)};bi(xe,Xt=>{Ke()&&Xt(Pi)})}var sn=Fi(xe,2);Bt(sn,()=>o.children??ri,()=>({map:g(),loadedImages:ht.loadedImages,allImagesLoaded:F(qt)})),Me(vt,Nt)};bi(Hr,vt=>{g()&&ae()&&vt(Dr)})}zi(mr),Nf(mr,vt=>b(vt),()=>b()),dy(mr,vt=>er==null?void 0:er(vt)),fi(()=>{g2(mr,`${I()??""} svelte-p00lfq`),y2(mr,"expand-map",!I())}),Me(m,mr),zt()}function fE(m,o){m.key===" "&&(m.preventDefault(),m.stopPropagation(),o("click"))}var mE=(m,o)=>{m.stopPropagation(),o("click")},gE=(m,o)=>{m.stopPropagation(),o("dblclick")},_E=(m,o)=>{m.stopPropagation(),m.preventDefault(),o("contextmenu")},yE=(m,o)=>o("mousemove"),vE=Gt("<div><!></div>");function xE(m,o){Mt(o,!0);let g=te(o,"marker",15,void 0),b=te(o,"lngLat",15),I=te(o,"class",3,void 0),E=te(o,"interactive",3,!0),w=te(o,"asButton",3,!1),u=te(o,"draggable",3,!1),U=te(o,"feature",3,void 0),W=te(o,"offset",3,void 0),Q=te(o,"zIndex",3,void 0),j=te(o,"rotation",3,0),V=te(o,"opacity",3,1),ae=ei(o,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const se=Te(Ip),ue=Te(()=>F(se).map),fe=Te(()=>F(se).markerClickManager),{layerEvent:Pe,marker:_e}=QC();function Ee(We){_e.value=new Lc.Marker({element:We,rotation:j(),draggable:u(),offset:W(),opacity:V().toString()}).setLngLat(b()).addTo(F(ue)),g(_e.value);const mt=()=>Oe("dragstart"),st=()=>{De(),Oe("drag")},Ue=()=>{De(),Oe("dragend")};return u()&&(_e.value.on("dragstart",mt),_e.value.on("drag",st),_e.value.on("dragend",Ue)),{destroy(){var Re,Ae,Ke,rt;u()&&((Re=_e.value)==null||Re.off("dragstart",mt),(Ae=_e.value)==null||Ae.off("drag",st),(Ke=_e.value)==null||Ke.off("dragend",Ue)),g(void 0),(rt=_e.value)==null||rt.remove()}}}function Be(We,mt){const st=We.className;function Ue(Re){Re?We.className=`${st} ${Re}`:We.className=st}return Ue(mt),{update:Ue}}Tt(()=>{var We;(We=_e.value)==null||We.setLngLat(b())}),Tt(()=>{var We;(We=_e.value)==null||We.setOffset(W()??[0,0])}),Tt(()=>{var We;(We=_e.value)==null||We.setRotation(j())}),Tt(()=>{var We;(We=_e.value)==null||We.setOpacity(V().toString())});function De(){var mt;let We=(mt=_e.value)==null?void 0:mt.getLngLat();We&&(Array.isArray(b())?b([We.lng,We.lat]):b()&&"lon"in b()?b({lon:We.lng,lat:We.lat}):b(We))}function Oe(We){var Ae,Ke;if(!E())return;let mt=(Ae=_e.value)==null?void 0:Ae.getLngLat();if(!mt)return;const st=[mt.lng,mt.lat];let Ue={map:F(ue),marker:_e.value,lngLat:st,features:[{type:"Feature",properties:((Ke=U())==null?void 0:Ke.properties)??{},geometry:{type:"Point",coordinates:st}}]};(We==="click"||We==="contextmenu")&&F(fe).handleClick(Ue),Pe.value={...Ue,layerType:"marker",type:We};const Re=ae["on"+We];Re==null||Re(Ue)}var Ze=vE();Ze.__click=[mE,Oe],Ze.__dblclick=[gE,Oe],Ze.__contextmenu=[_E,Oe],Ze.__mousemove=[yE,Oe],Ze.__keydown=[fE,Oe];var ft=Mi(Ze);Bt(ft,()=>o.children??ri,()=>({marker:_e.value})),zi(Ze),dy(Ze,We=>Ee==null?void 0:Ee(We)),dy(Ze,(We,mt)=>Be==null?void 0:Be(We,mt),I),fi(()=>{hy(Ze,"tabindex",w()?0:void 0),hy(Ze,"role",w()?"button":void 0),v2(Ze,"z-index",Q())}),ly("mouseenter",Ze,()=>{Oe("mouseenter")}),ly("mouseleave",Ze,()=>{Oe("mouseleave")}),Me(m,Ze),zt()}P0(["click","dblclick","contextmenu","mousemove","keydown"]);var Ap=Uint8Array,Bb=Uint16Array,bE=Int32Array,wE=new Ap([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),SE=new Ap([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Nb=function(m,o){for(var g=new Bb(31),b=0;b<31;++b)g[b]=o+=1<<m[b-1];for(var I=new bE(g[30]),b=1;b<30;++b)for(var E=g[b];E<g[b+1];++E)I[E]=E-g[b]<<5|b;return{b:g,r:I}},Vb=Nb(wE,2),PE=Vb.b,TE=Vb.r;PE[28]=258,TE[258]=28;Nb(SE,0);var IE=new Bb(32768);for(yi=0;yi<32768;++yi)Ns=(yi&43690)>>1|(yi&21845)<<1,Ns=(Ns&52428)>>2|(Ns&13107)<<2,Ns=(Ns&61680)>>4|(Ns&3855)<<4,IE[yi]=((Ns&65280)>>8|(Ns&255)<<8)>>1;var Ns,yi,zg=new Ap(288);for(yi=0;yi<144;++yi)zg[yi]=8;var yi;for(yi=144;yi<256;++yi)zg[yi]=9;var yi;for(yi=256;yi<280;++yi)zg[yi]=7;var yi;for(yi=280;yi<288;++yi)zg[yi]=8;var yi,AE=new Ap(32);for(yi=0;yi<32;++yi)AE[yi]=5;var yi,CE=new Ap(0),EE=typeof TextDecoder<"u"&&new TextDecoder,kE=0;try{EE.decode(CE,{stream:!0}),kE=1}catch{}const ME=[{value:"architecture-fine-arts-library",label:"Architecture/Fine Arts Library",description:"The Architecture/Fine Arts Library supports the teaching and research requirements of the Faculty of Architecture, which includes programs in Architecture, City Planning, Interior Design and Landscape Architecture, as well as the School of Art with programs in Fine Arts and Art History.",location:{lat:49.80815612216234,lng:-97.13530152378586},hours:{monday:[{open:"08:30",close:"17:30"}],tuesday:[{open:"08:30",close:"17:30"}],wednesday:[{open:"08:30",close:"17:30"}],thursday:[{open:"08:30",close:"17:30"}],friday:[{open:"08:30",close:"17:30"}],saturday:[],sunday:[]},metadata:{amentities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/CFbxpALxC7HpwdBx8"}},{value:"donald-craik-engineering-library",label:"Donald W. Craik Engineering Library",description:"The Donald W. Craik Engineering Library serves engineeirng resources, including books, journals, and electronic databases, to support academic and research needs of students and faculty.",location:{lat:49.80835859585458,lng:-97.13445434076718},alwaysOpen:!0,metadata:{amentities:["WiFi"]}},{value:"e-k-williams-law-library",label:"E. K. Williams Law Library",description:"E.K. Williams Law Library primarily serves the teaching and research needs of the Faculty of Law and the University. The library is also an integral part of the legal resources of Manitoba, where it plays a prominent role in the delivery of legal information to the members of the legal profession, the judiciary, other professional groups, and the general public.",location:{lat:49.81194940624498,lng:-97.13047415092316},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amentities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/NzVn21YBon12p11e8"}},{value:"eckhardt-gramatte-music-library",label:"Eckhardt Gramatt Music Library",description:"The Eckhardt Gramatt Music Library supports study, research, and performance at the University of Manitoba. As a unit of the University of Manitoba Libraries, the Music Library provides a vast range of print, recorded and electronic resources to students, faculty and staff of the University as well as members of the public.",location:{lat:49.808042975950016,lng:-97.1321825540353},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amentities:["WiFi","Printing"],link:"https://maps.app.goo.gl/BkewBe4p6jjSWEgb7"}},{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amentities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/pq5cGKjbKwuJFan86"}},{value:"father-harold-drake-library",label:"St. Paul's College",description:"The Fr. Harold Drake Library at St. Paul's College focuses on supporting the teaching and research needs of staff and students at St. Paul's College including the Jesuit Centre for Catholic Studies and Arthur V. Mauro Institute for Peace and Justice.",location:{lat:49.81045700369361,lng:-97.13799926192738},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amentities:["WiFi","Printing"],link:"https://maps.app.goo.gl/JGQEwkeyEtG1cDCbA"}},{value:"jim-peebles-science-and-technology-library",label:"Jim Peebles Science and Technology Library",description:"The Jim Peebles Science and Technology Library serves the research, study, and teaching requirements of the Faculties of Science, Engineering, Agricultural and Food Sciences, and Environment, Earth, and Resources.",location:{lat:49.81151151579056,lng:-97.13336330797407},hours:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amentities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/48NVXVD6kGeSoEue9"}}],zE=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46990996120006,lng:-80.54232110658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amentities:["WiFi"]}}],w0=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.133},spaces:ME},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:zE}];var DE=Gt("<span> </span>"),RE=Gt(" <!>",1),LE=Gt("<!> ",1),OE=Gt("<!> <!>",1),FE=Gt("<!> <!>",1),BE=Gt("<!> <!>",1),NE=Gt('<!> <!> <span class="sr-only">Toggle theme</span>',1),VE=Gt("<!> <!>",1),jE=Gt('<div class="mx-auto w-full max-w-md"><!></div>'),UE=Gt('<!> <div class="z-10 absolute top-2.5 left-1/2 -translate-x-1/2"><!></div> <!> <!>',1);function ik(m,o){Mt(o,!0);const g=c2(),b=()=>h2(l2,"$mode",g);let I=Je(!1),E=Je(null);const w=new WC("count",""),u=Te(()=>w0.find(Oe=>Oe.value===w.current));let U=Je(null);const W=`https://api.maptiler.com/maps/topo-v2/style.json?key=${Bx}`,Q=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${Bx}`,j=Te(()=>b()==="dark"?Q:W);let V=Je(!1),ae=Je(null);function se(Oe){Fe(V,!0),Fe(ae,qe(Oe))}function ue(){Fe(I,!1),Pg().then(()=>{F(E).focus()})}Tt(()=>{var Oe;if(F(u)){const Ze=(Oe=F(u).metadata)==null?void 0:Oe.display;F(U).jumpTo({center:F(u).location,zoom:(Ze==null?void 0:Ze.zoom)??16,pitch:(Ze==null?void 0:Ze.pitch)??60,bearing:(Ze==null?void 0:Ze.bearing)??0})}});var fe=UE();u2(Oe=>{s2.title="Campus Study Spots"});var Pe=Xe(fe);pE(Pe,{get map(){return F(U)},set map(Oe){Fe(U,qe(Oe))},get style(){return F(j)},class:"min-h-screen",standardControls:!0,children:(Oe,Ze)=>{var ft=ut(),We=Xe(ft);{var mt=st=>{var Ue=ut(),Re=Xe(Ue);cy(Re,17,()=>F(u).spaces,uy,(Ae,Ke)=>{xE(Ae,{get lngLat(){return F(Ke).location},class:"cursor-pointer",onclick:()=>se(F(Ke)),children:(rt,_t)=>{var yt=DE(),ht=Mi(yt,!0);zi(yt),fi(()=>Aa(ht,F(Ke).label)),Me(rt,yt)},$$slots:{default:!0}})}),Me(st,Ue)};bi(We,st=>{F(u)&&st(mt)})}Me(Oe,ft)},$$slots:{default:!0}});var _e=Fi(Pe,2),Ee=Mi(_e);ci(Ee,()=>DC,(Oe,Ze)=>{Ze(Oe,{get open(){return F(I)},set open(ft){Fe(I,qe(ft))},children:(ft,We)=>{var mt=BE(),st=Xe(mt);ci(st,()=>RC,(Re,Ae)=>{Ae(Re,{get ref(){return F(E)},set ref(rt){Fe(E,qe(rt))},child:(rt,_t)=>{Gx(rt,ai({variant:"outline",class:"w-52 justify-between"},()=>_t==null?void 0:_t().props,{role:"combobox",get"aria-expanded"(){return F(I)},children:(ht,xt)=>{Ia();var Dt=RE(),qt=Xe(Dt),vi=Fi(qt);OC(vi,{class:"opacity-50"}),fi(()=>{var hi;return Aa(qt,`${(((hi=F(u))==null?void 0:hi.label)||"Select a campus...")??""} `)}),Me(ht,Dt)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var Ue=Fi(st,2);ci(Ue,()=>zC,(Re,Ae)=>{Ae(Re,{class:"w-52 p-0",children:(Ke,rt)=>{var _t=ut(),yt=Xe(_t);ci(yt,()=>EA,(ht,xt)=>{xt(ht,{children:(Dt,qt)=>{var vi=FE(),hi=Xe(vi);ci(hi,()=>BA,(Ui,Di)=>{Di(Ui,{placeholder:"Search campuses..."})});var Li=Fi(hi,2);ci(Li,()=>NA,(Ui,Di)=>{Di(Ui,{children:(er,ar)=>{var Wr=OE(),mr=Xe(Wr);ci(mr,()=>zA,(Dr,vt)=>{vt(Dr,{children:(Nt,xe)=>{Ia();var Pi=Qu("No campus found.");Me(Nt,Pi)},$$slots:{default:!0}})});var Hr=Fi(mr,2);ci(Hr,()=>RA,(Dr,vt)=>{vt(Dr,{children:(Nt,xe)=>{var Pi=ut(),sn=Xe(Pi);cy(sn,17,()=>w0,uy,(Xt,ui)=>{var gn=ut(),Xr=Xe(gn);ci(Xr,()=>LA,(Rr,Dn)=>{Dn(Rr,{get value(){return F(ui).value},onSelect:()=>{w.current=F(ui).value,ue()},children:(Lr,Xs)=>{var es=LE(),He=Xe(es),on=Te(()=>nn("ml-auto",w.current!==F(ui).value&&"text-transparent"));LC(He,{get class(){return F(on)}});var lr=Fi(He);fi(()=>Aa(lr,` ${F(ui).label??""}`)),Me(Lr,es)},$$slots:{default:!0}})}),Me(Xt,gn)}),Me(Nt,Pi)},$$slots:{default:!0}})}),Me(er,Wr)},$$slots:{default:!0}})}),Me(Dt,vi)},$$slots:{default:!0}})}),Me(Ke,_t)},$$slots:{default:!0}})}),Me(ft,mt)},$$slots:{default:!0}})}),zi(_e);var Be=Fi(_e,2);Gx(Be,{class:"absolute top-2.5 right-2.5 z-10",onclick:a2,variant:"outline",size:"icon",children:(Oe,Ze)=>{var ft=NE(),We=Xe(ft);BC(We,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var mt=Fi(We,2);FC(mt,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),Ia(2),Me(Oe,ft)},$$slots:{default:!0}});var De=Fi(Be,2);ci(De,()=>SC,(Oe,Ze)=>{Ze(Oe,{get open(){return F(V)},set open(ft){Fe(V,qe(ft))},children:(ft,We)=>{var mt=ut(),st=Xe(mt);ci(st,()=>AC,(Ue,Re)=>{Re(Ue,{children:(Ae,Ke)=>{var rt=jE(),_t=Mi(rt);ci(_t,()=>kC,(yt,ht)=>{ht(yt,{children:(xt,Dt)=>{var qt=VE(),vi=Xe(qt);ci(vi,()=>MC,(Li,Ui)=>{Ui(Li,{children:(Di,er)=>{Ia();var ar=Qu();fi(()=>Aa(ar,F(ae).label)),Me(Di,ar)},$$slots:{default:!0}})});var hi=Fi(vi,2);ci(hi,()=>CC,(Li,Ui)=>{Ui(Li,{children:(Di,er)=>{Ia();var ar=Qu();fi(()=>Aa(ar,F(ae).description)),Me(Di,ar)},$$slots:{default:!0}})}),Me(xt,qt)},$$slots:{default:!0}})}),zi(rt),Me(Ae,rt)},$$slots:{default:!0}})}),Me(ft,mt)},$$slots:{default:!0}})}),Me(m,fe),zt()}export{ik as component};
