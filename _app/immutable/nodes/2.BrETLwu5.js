var V2=Object.defineProperty;var j2=Object.getPrototypeOf;var U2=Reflect.get;var bx=h=>{throw TypeError(h)};var q2=(h,s,g)=>s in h?V2(h,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):h[s]=g;var Ge=(h,s,g)=>q2(h,typeof s!="symbol"?s+"":s,g),k_=(h,s,g)=>s.has(h)||bx("Cannot "+g);var I=(h,s,g)=>(k_(h,s,"read from private field"),g?g.call(h):s.get(h)),H=(h,s,g)=>s.has(h)?bx("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(h):s.set(h,g),Ve=(h,s,g,v)=>(k_(h,s,"write to private field"),v?v.call(h,g):s.set(h,g),g),qn=(h,s,g)=>(k_(h,s,"access private method"),g);var rh=(h,s,g,v)=>({set _(T){Ve(h,s,T,g)},get _(){return I(h,s,v)}}),wx=(h,s,g)=>U2(j2(h),g,s);import{e as Z2,y as G2,f as Xe,a as _e,g as On,t as Et,z as W2,s as vb,b as xb,p as H2,m as bb,A as H_,v as X2}from"../chunks/stores.Ci9THb0v.js";import{$ as K2,ag as $2,aF as J2,x as jr,j as X_,X as wb,J as Sb,aZ as Y2,a4 as E_,w as hh,O as Q2,_ as Sx,k as rm,ab as as,U as Tx,aq as Px,ap as Ix,a_ as Cx,a3 as sm,L as om,R as eS,z as tS,K as iS,g as nS,v as rS,e as Ax,h as kx,y as sS,a$ as dv,a7 as oS,M as aS,C as Oi,N as Tb,G as lS,Z as cS,Q as je,p as Pt,f as Le,a as It,t as zt,af as ti,F as L,I as Te,aE as ia,c as qt,r as Vt,W as Qe,B as Ct,V as ay,ak as jp,b0 as Pb,al as pv,b1 as Ib,b2 as uS,u as hS,aU as Up,s as Wt,aC as dS,b3 as Ex,b4 as pS,b5 as fS,b6 as mS}from"../chunks/entry.2tcR25Ko.js";import{s as Ri,m as gS,u as Mx}from"../chunks/render.B1S_QQKv.js";import{p as ee,r as Kt,l as hi,d as Gt,b as fi,a as qe,o as Cb,e as yn,f as yS,i as zx,g as qp}from"../chunks/i18n.DZ5ruM6j.js";import{w as la,v as Ot,x as ji,k as Ab,y as _S,s as mh,e as Hl,b as Hn,i as Xl,z as vS,g as xS}from"../chunks/mode.D1Gxkdfq.js";import{b as Vc,c as si}from"../chunks/this.wScnCoPQ.js";import{i as fv}from"../chunks/lifecycle.C0SxHwQ6.js";const bS=[];function kb(h,s=!1){return am(h,new Map,"",bS)}function am(h,s,g,v,T=null){if(typeof h=="object"&&h!==null){const b=s.get(h);if(b!==void 0)return b;if(h instanceof Map)return new Map(h);if(h instanceof Set)return new Set(h);if(K2(h)){const c=[];s.set(h,c),T!==null&&s.set(T,c);for(let j=0;j<h.length;j+=1)c.push(am(h[j],s,g,v));return c}if($2(h)===J2){const c={};s.set(h,c),T!==null&&s.set(T,c);for(var C in h)c[C]=am(h[C],s,g,v);return c}if(h instanceof Date)return structuredClone(h);if(typeof h.toJSON=="function")return am(h.toJSON(),s,g,v,h)}if(h instanceof EventTarget)return h;try{return structuredClone(h)}catch{return h}}const M_=0,Jf=1,z_=2;function lm(h,s,g,v,T){jr&&X_();var C=h,b=wb(),c=tS,j=Sx,U,K,B,V=(b?as:Tx)(void 0),oe=(b?as:Tx)(void 0),ie=!1;function te(ve,pe){ie=!0,pe&&(Px(ue),Ix(ue),Cx(c));try{ve===M_&&g&&(U?sm(U):U=hh(()=>g(C))),ve===Jf&&v&&(K?sm(K):K=hh(()=>v(C,V))),ve===z_&&T&&(B?sm(B):B=hh(()=>T(C,oe))),ve!==M_&&U&&om(U,()=>U=null),ve!==Jf&&K&&om(K,()=>K=null),ve!==z_&&B&&om(B,()=>B=null)}finally{pe&&(Cx(null),Ix(null),Px(null),eS())}}var ue=Sb(()=>{if(j!==(j=s())){if(Y2(j)){var ve=j;ie=!1,ve.then(pe=>{ve===j&&(E_(V,pe),te(Jf,!0))},pe=>{if(ve===j&&(E_(oe,pe),te(z_,!0),!T))throw oe.v}),jr?g&&(U=hh(()=>g(C))):Q2(()=>{ie||te(M_,!0)})}else E_(V,j),te(Jf,!1);return()=>j=Sx}});jr&&(C=rm)}function Eb(h,s,g,v,T,C){let b=jr;jr&&X_();var c,j,U=null;jr&&rm.nodeType===1&&(U=rm,X_());var K=jr?rm:h,B;Sb(()=>{const V=s()||null;var oe=g||V==="svg"?dv:null;V!==c&&(B&&(V===null?om(B,()=>{B=null,j=null}):V===j?sm(B):oS(B)),V&&V!==j&&(B=hh(()=>{if(U=jr?U:oe?document.createElementNS(oe,V):document.createElement(V),Z2(U,U),v){var ie=jr?nS(U):U.appendChild(rS());jr&&(ie===null?Ax(!1):kx(ie)),v(U,ie)}sS.nodes_end=U,K.before(U)})),c=V,c&&(j=c))},iS),b&&(Ax(!0),kx(K))}function K_(h,s,g){aS(()=>{var v=Oi(()=>s(h,g==null?void 0:g())||{});if(g&&(v!=null&&v.update)){var T=!1,C={};Tb(()=>{var b=g();lS(b),T&&cS(C,b)&&(C=b,v.update(b))}),T=!0}if(v!=null&&v.destroy)return()=>v.destroy()})}function Mb(h,s){var g=h.__className,v=wS(s);jr&&h.className===v?h.__className=v:(g!==v||jr&&h.className!==v)&&(s==null?h.removeAttribute("class"):h.className=v,h.__className=v)}function wS(h){return h??""}function SS(h,s,g){if(g){if(h.classList.contains(s))return;h.classList.add(s)}else{if(!h.classList.contains(s))return;h.classList.remove(s)}}function TS(h,s,g,v){var T=h.__styles??(h.__styles={});T[s]!==g&&(T[s]=g,g==null?h.style.removeProperty(s):h.style.setProperty(s,g,""))}function PS(h,s,g=s){var v=wb();G2(h,"input",T=>{var C=T?h.defaultValue:h.value;C=D_(h)?L_(C):C,g(C),v&&C!==(C=s())&&(h.value=C??"")}),(jr&&h.defaultValue!==h.value||Oi(s)==null&&h.value)&&g(D_(h)?L_(h.value):h.value),Tb(()=>{var T=s();D_(h)&&T===L_(h.value)||h.type==="date"&&!T&&!h.value||T!==h.value&&(h.value=T??"")})}function D_(h){var s=h.type;return s==="number"||s==="range"}function L_(h){return h===""?null:+h}function jo(h){je(h,h.v+1)}const IS="https://github.com/mahyarmirrashed/study-spots",Dx="LYsosKTbN7Q5Pq1NzJI1";var Lx=h=>typeof h=="boolean"?`${h}`:h===0?"0":h,Tr=h=>!h||typeof h!="object"||Object.keys(h).length===0,CS=(h,s)=>JSON.stringify(h)===JSON.stringify(s);function zb(h,s){h.forEach(function(g){Array.isArray(g)?zb(g,s):s.push(g)})}function Db(h){let s=[];return zb(h,s),s}var Lb=(...h)=>Db(h).filter(Boolean),Rb=(h,s)=>{let g={},v=Object.keys(h),T=Object.keys(s);for(let C of v)if(T.includes(C)){let b=h[C],c=s[C];Array.isArray(b)||Array.isArray(c)?g[C]=Lb(c,b):typeof b=="object"&&typeof c=="object"?g[C]=Rb(b,c):g[C]=c+" "+b}else g[C]=h[C];for(let C of T)v.includes(C)||(g[C]=s[C]);return g},Rx=h=>!h||typeof h!="string"?h:h.replace(/\s+/g," ").trim();const mv="-",AS=h=>{const s=ES(h),{conflictingClassGroups:g,conflictingClassGroupModifiers:v}=h;return{getClassGroupId:b=>{const c=b.split(mv);return c[0]===""&&c.length!==1&&c.shift(),Ob(c,s)||kS(b)},getConflictingClassGroupIds:(b,c)=>{const j=g[b]||[];return c&&v[b]?[...j,...v[b]]:j}}},Ob=(h,s)=>{var b;if(h.length===0)return s.classGroupId;const g=h[0],v=s.nextPart.get(g),T=v?Ob(h.slice(1),v):void 0;if(T)return T;if(s.validators.length===0)return;const C=h.join(mv);return(b=s.validators.find(({validator:c})=>c(C)))==null?void 0:b.classGroupId},Ox=/^\[(.+)\]$/,kS=h=>{if(Ox.test(h)){const s=Ox.exec(h)[1],g=s==null?void 0:s.substring(0,s.indexOf(":"));if(g)return"arbitrary.."+g}},ES=h=>{const{theme:s,prefix:g}=h,v={nextPart:new Map,validators:[]};return zS(Object.entries(h.classGroups),g).forEach(([C,b])=>{$_(b,v,C,s)}),v},$_=(h,s,g,v)=>{h.forEach(T=>{if(typeof T=="string"){const C=T===""?s:Fx(s,T);C.classGroupId=g;return}if(typeof T=="function"){if(MS(T)){$_(T(v),s,g,v);return}s.validators.push({validator:T,classGroupId:g});return}Object.entries(T).forEach(([C,b])=>{$_(b,Fx(s,C),g,v)})})},Fx=(h,s)=>{let g=h;return s.split(mv).forEach(v=>{g.nextPart.has(v)||g.nextPart.set(v,{nextPart:new Map,validators:[]}),g=g.nextPart.get(v)}),g},MS=h=>h.isThemeGetter,zS=(h,s)=>s?h.map(([g,v])=>{const T=v.map(C=>typeof C=="string"?s+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([b,c])=>[s+b,c])):C);return[g,T]}):h,DS=h=>{if(h<1)return{get:()=>{},set:()=>{}};let s=0,g=new Map,v=new Map;const T=(C,b)=>{g.set(C,b),s++,s>h&&(s=0,v=g,g=new Map)};return{get(C){let b=g.get(C);if(b!==void 0)return b;if((b=v.get(C))!==void 0)return T(C,b),b},set(C,b){g.has(C)?g.set(C,b):T(C,b)}}},Fb="!",LS=h=>{const{separator:s,experimentalParseClassName:g}=h,v=s.length===1,T=s[0],C=s.length,b=c=>{const j=[];let U=0,K=0,B;for(let ue=0;ue<c.length;ue++){let ve=c[ue];if(U===0){if(ve===T&&(v||c.slice(ue,ue+C)===s)){j.push(c.slice(K,ue)),K=ue+C;continue}if(ve==="/"){B=ue;continue}}ve==="["?U++:ve==="]"&&U--}const V=j.length===0?c:c.substring(K),oe=V.startsWith(Fb),ie=oe?V.substring(1):V,te=B&&B>K?B-K:void 0;return{modifiers:j,hasImportantModifier:oe,baseClassName:ie,maybePostfixModifierPosition:te}};return g?c=>g({className:c,parseClassName:b}):b},RS=h=>{if(h.length<=1)return h;const s=[];let g=[];return h.forEach(v=>{v[0]==="["?(s.push(...g.sort(),v),g=[]):g.push(v)}),s.push(...g.sort()),s},OS=h=>({cache:DS(h.cacheSize),parseClassName:LS(h),...AS(h)}),FS=/\s+/,BS=(h,s)=>{const{parseClassName:g,getClassGroupId:v,getConflictingClassGroupIds:T}=s,C=[],b=h.trim().split(FS);let c="";for(let j=b.length-1;j>=0;j-=1){const U=b[j],{modifiers:K,hasImportantModifier:B,baseClassName:V,maybePostfixModifierPosition:oe}=g(U);let ie=!!oe,te=v(ie?V.substring(0,oe):V);if(!te){if(!ie){c=U+(c.length>0?" "+c:c);continue}if(te=v(V),!te){c=U+(c.length>0?" "+c:c);continue}ie=!1}const ue=RS(K).join(":"),ve=B?ue+Fb:ue,pe=ve+te;if(C.includes(pe))continue;C.push(pe);const Ie=T(te,ie);for(let Oe=0;Oe<Ie.length;++Oe){const ze=Ie[Oe];C.push(ve+ze)}c=U+(c.length>0?" "+c:c)}return c};function NS(){let h=0,s,g,v="";for(;h<arguments.length;)(s=arguments[h++])&&(g=Bb(s))&&(v&&(v+=" "),v+=g);return v}const Bb=h=>{if(typeof h=="string")return h;let s,g="";for(let v=0;v<h.length;v++)h[v]&&(s=Bb(h[v]))&&(g&&(g+=" "),g+=s);return g};function J_(h,...s){let g,v,T,C=b;function b(j){const U=s.reduce((K,B)=>B(K),h());return g=OS(U),v=g.cache.get,T=g.cache.set,C=c,c(j)}function c(j){const U=v(j);if(U)return U;const K=BS(j,g);return T(j,K),K}return function(){return C(NS.apply(null,arguments))}}const Wi=h=>{const s=g=>g[h]||[];return s.isThemeGetter=!0,s},Nb=/^\[(?:([a-z-]+):)?(.+)\]$/i,VS=/^\d+\/\d+$/,jS=new Set(["px","full","screen"]),US=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qS=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ZS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,GS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,WS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Xs=h=>Kl(h)||jS.has(h)||VS.test(h),Bo=h=>Zc(h,"length",eT),Kl=h=>!!h&&!Number.isNaN(Number(h)),R_=h=>Zc(h,"number",Kl),sh=h=>!!h&&Number.isInteger(Number(h)),HS=h=>h.endsWith("%")&&Kl(h.slice(0,-1)),ri=h=>Nb.test(h),No=h=>US.test(h),XS=new Set(["length","size","percentage"]),KS=h=>Zc(h,XS,Vb),$S=h=>Zc(h,"position",Vb),JS=new Set(["image","url"]),YS=h=>Zc(h,JS,iT),QS=h=>Zc(h,"",tT),oh=()=>!0,Zc=(h,s,g)=>{const v=Nb.exec(h);return v?v[1]?typeof s=="string"?v[1]===s:s.has(v[1]):g(v[2]):!1},eT=h=>qS.test(h)&&!ZS.test(h),Vb=()=>!1,tT=h=>GS.test(h),iT=h=>WS.test(h),Y_=()=>{const h=Wi("colors"),s=Wi("spacing"),g=Wi("blur"),v=Wi("brightness"),T=Wi("borderColor"),C=Wi("borderRadius"),b=Wi("borderSpacing"),c=Wi("borderWidth"),j=Wi("contrast"),U=Wi("grayscale"),K=Wi("hueRotate"),B=Wi("invert"),V=Wi("gap"),oe=Wi("gradientColorStops"),ie=Wi("gradientColorStopPositions"),te=Wi("inset"),ue=Wi("margin"),ve=Wi("opacity"),pe=Wi("padding"),Ie=Wi("saturate"),Oe=Wi("scale"),ze=Wi("sepia"),We=Wi("skew"),$e=Wi("space"),xt=Wi("translate"),He=()=>["auto","contain","none"],Ye=()=>["auto","hidden","clip","visible","scroll"],Be=()=>["auto",ri,s],Me=()=>[ri,s],De=()=>["",Xs,Bo],Ae=()=>["auto",Kl,ri],Ue=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],et=()=>["solid","dashed","dotted","double","none"],pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ut=()=>["start","end","center","between","around","evenly","stretch"],ct=()=>["","0",ri],at=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[Kl,ri];return{cacheSize:500,separator:":",theme:{colors:[oh],spacing:[Xs,Bo],blur:["none","",No,ri],brightness:Mt(),borderColor:[h],borderRadius:["none","","full",No,ri],borderSpacing:Me(),borderWidth:De(),contrast:Mt(),grayscale:ct(),hueRotate:Mt(),invert:ct(),gap:Me(),gradientColorStops:[h],gradientColorStopPositions:[HS,Bo],inset:Be(),margin:Be(),opacity:Mt(),padding:Me(),saturate:Mt(),scale:Mt(),sepia:ct(),skew:Mt(),space:Me(),translate:Me()},classGroups:{aspect:[{aspect:["auto","square","video",ri]}],container:["container"],columns:[{columns:[No]}],"break-after":[{"break-after":at()}],"break-before":[{"break-before":at()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ue(),ri]}],overflow:[{overflow:Ye()}],"overflow-x":[{"overflow-x":Ye()}],"overflow-y":[{"overflow-y":Ye()}],overscroll:[{overscroll:He()}],"overscroll-x":[{"overscroll-x":He()}],"overscroll-y":[{"overscroll-y":He()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[te]}],"inset-x":[{"inset-x":[te]}],"inset-y":[{"inset-y":[te]}],start:[{start:[te]}],end:[{end:[te]}],top:[{top:[te]}],right:[{right:[te]}],bottom:[{bottom:[te]}],left:[{left:[te]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",sh,ri]}],basis:[{basis:Be()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ri]}],grow:[{grow:ct()}],shrink:[{shrink:ct()}],order:[{order:["first","last","none",sh,ri]}],"grid-cols":[{"grid-cols":[oh]}],"col-start-end":[{col:["auto",{span:["full",sh,ri]},ri]}],"col-start":[{"col-start":Ae()}],"col-end":[{"col-end":Ae()}],"grid-rows":[{"grid-rows":[oh]}],"row-start-end":[{row:["auto",{span:[sh,ri]},ri]}],"row-start":[{"row-start":Ae()}],"row-end":[{"row-end":Ae()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ri]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ri]}],gap:[{gap:[V]}],"gap-x":[{"gap-x":[V]}],"gap-y":[{"gap-y":[V]}],"justify-content":[{justify:["normal",...ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[pe]}],px:[{px:[pe]}],py:[{py:[pe]}],ps:[{ps:[pe]}],pe:[{pe:[pe]}],pt:[{pt:[pe]}],pr:[{pr:[pe]}],pb:[{pb:[pe]}],pl:[{pl:[pe]}],m:[{m:[ue]}],mx:[{mx:[ue]}],my:[{my:[ue]}],ms:[{ms:[ue]}],me:[{me:[ue]}],mt:[{mt:[ue]}],mr:[{mr:[ue]}],mb:[{mb:[ue]}],ml:[{ml:[ue]}],"space-x":[{"space-x":[$e]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[$e]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ri,s]}],"min-w":[{"min-w":[ri,s,"min","max","fit"]}],"max-w":[{"max-w":[ri,s,"none","full","min","max","fit","prose",{screen:[No]},No]}],h:[{h:[ri,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ri,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ri,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ri,s,"auto","min","max","fit"]}],"font-size":[{text:["base",No,Bo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",R_]}],"font-family":[{font:[oh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ri]}],"line-clamp":[{"line-clamp":["none",Kl,R_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Xs,ri]}],"list-image":[{"list-image":["none",ri]}],"list-style-type":[{list:["none","disc","decimal",ri]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[h]}],"placeholder-opacity":[{"placeholder-opacity":[ve]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[h]}],"text-opacity":[{"text-opacity":[ve]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...et(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Xs,Bo]}],"underline-offset":[{"underline-offset":["auto",Xs,ri]}],"text-decoration-color":[{decoration:[h]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Me()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ri]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ri]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ve]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ue(),$S]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",KS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},YS]}],"bg-color":[{bg:[h]}],"gradient-from-pos":[{from:[ie]}],"gradient-via-pos":[{via:[ie]}],"gradient-to-pos":[{to:[ie]}],"gradient-from":[{from:[oe]}],"gradient-via":[{via:[oe]}],"gradient-to":[{to:[oe]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[ve]}],"border-style":[{border:[...et(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ve]}],"divide-style":[{divide:et()}],"border-color":[{border:[T]}],"border-color-x":[{"border-x":[T]}],"border-color-y":[{"border-y":[T]}],"border-color-s":[{"border-s":[T]}],"border-color-e":[{"border-e":[T]}],"border-color-t":[{"border-t":[T]}],"border-color-r":[{"border-r":[T]}],"border-color-b":[{"border-b":[T]}],"border-color-l":[{"border-l":[T]}],"divide-color":[{divide:[T]}],"outline-style":[{outline:["",...et()]}],"outline-offset":[{"outline-offset":[Xs,ri]}],"outline-w":[{outline:[Xs,Bo]}],"outline-color":[{outline:[h]}],"ring-w":[{ring:De()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[h]}],"ring-opacity":[{"ring-opacity":[ve]}],"ring-offset-w":[{"ring-offset":[Xs,Bo]}],"ring-offset-color":[{"ring-offset":[h]}],shadow:[{shadow:["","inner","none",No,QS]}],"shadow-color":[{shadow:[oh]}],opacity:[{opacity:[ve]}],"mix-blend":[{"mix-blend":[...pt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":pt()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[v]}],contrast:[{contrast:[j]}],"drop-shadow":[{"drop-shadow":["","none",No,ri]}],grayscale:[{grayscale:[U]}],"hue-rotate":[{"hue-rotate":[K]}],invert:[{invert:[B]}],saturate:[{saturate:[Ie]}],sepia:[{sepia:[ze]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[v]}],"backdrop-contrast":[{"backdrop-contrast":[j]}],"backdrop-grayscale":[{"backdrop-grayscale":[U]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[K]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[ve]}],"backdrop-saturate":[{"backdrop-saturate":[Ie]}],"backdrop-sepia":[{"backdrop-sepia":[ze]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[b]}],"border-spacing-x":[{"border-spacing-x":[b]}],"border-spacing-y":[{"border-spacing-y":[b]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ri]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",ri]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",ri]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Oe]}],"scale-x":[{"scale-x":[Oe]}],"scale-y":[{"scale-y":[Oe]}],rotate:[{rotate:[sh,ri]}],"translate-x":[{"translate-x":[xt]}],"translate-y":[{"translate-y":[xt]}],"skew-x":[{"skew-x":[We]}],"skew-y":[{"skew-y":[We]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ri]}],accent:[{accent:["auto",h]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ri]}],"caret-color":[{caret:[h]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Me()}],"scroll-mx":[{"scroll-mx":Me()}],"scroll-my":[{"scroll-my":Me()}],"scroll-ms":[{"scroll-ms":Me()}],"scroll-me":[{"scroll-me":Me()}],"scroll-mt":[{"scroll-mt":Me()}],"scroll-mr":[{"scroll-mr":Me()}],"scroll-mb":[{"scroll-mb":Me()}],"scroll-ml":[{"scroll-ml":Me()}],"scroll-p":[{"scroll-p":Me()}],"scroll-px":[{"scroll-px":Me()}],"scroll-py":[{"scroll-py":Me()}],"scroll-ps":[{"scroll-ps":Me()}],"scroll-pe":[{"scroll-pe":Me()}],"scroll-pt":[{"scroll-pt":Me()}],"scroll-pr":[{"scroll-pr":Me()}],"scroll-pb":[{"scroll-pb":Me()}],"scroll-pl":[{"scroll-pl":Me()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ri]}],fill:[{fill:[h,"none"]}],"stroke-w":[{stroke:[Xs,Bo,R_]}],stroke:[{stroke:[h,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},nT=(h,{cacheSize:s,prefix:g,separator:v,experimentalParseClassName:T,extend:C={},override:b={}})=>{dh(h,"cacheSize",s),dh(h,"prefix",g),dh(h,"separator",v),dh(h,"experimentalParseClassName",T);for(const c in b)rT(h[c],b[c]);for(const c in C)sT(h[c],C[c]);return h},dh=(h,s,g)=>{g!==void 0&&(h[s]=g)},rT=(h,s)=>{if(s)for(const g in s)dh(h,g,s[g])},sT=(h,s)=>{if(s)for(const g in s){const v=s[g];v!==void 0&&(h[g]=(h[g]||[]).concat(v))}},oT=(h,...s)=>typeof h=="function"?J_(Y_,h,...s):J_(()=>nT(Y_(),h),...s),jb=J_(Y_);var aT={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},Ub=h=>h||void 0,gh=(...h)=>Ub(Db(h).filter(Boolean).join(" ")),O_=null,$s={},Q_=!1,ah=(...h)=>s=>s.twMerge?((!O_||Q_)&&(Q_=!1,O_=Tr($s)?jb:oT({...$s,extend:{theme:$s.theme,classGroups:$s.classGroups,conflictingClassGroupModifiers:$s.conflictingClassGroupModifiers,conflictingClassGroups:$s.conflictingClassGroups,...$s.extend}})),Ub(O_(gh(h)))):gh(h),Bx=(h,s)=>{for(let g in s)h.hasOwnProperty(g)?h[g]=gh(h[g],s[g]):h[g]=s[g];return h},qb=(h,s)=>{let{extend:g=null,slots:v={},variants:T={},compoundVariants:C=[],compoundSlots:b=[],defaultVariants:c={}}=h,j={...aT,...s},U=g!=null&&g.base?gh(g.base,h==null?void 0:h.base):h==null?void 0:h.base,K=g!=null&&g.variants&&!Tr(g.variants)?Rb(T,g.variants):T,B=g!=null&&g.defaultVariants&&!Tr(g.defaultVariants)?{...g.defaultVariants,...c}:c;!Tr(j.twMergeConfig)&&!CS(j.twMergeConfig,$s)&&(Q_=!0,$s=j.twMergeConfig);let V=Tr(g==null?void 0:g.slots),oe=Tr(v)?{}:{base:gh(h==null?void 0:h.base,V&&(g==null?void 0:g.base)),...v},ie=V?oe:Bx({...g==null?void 0:g.slots},Tr(oe)?{base:h==null?void 0:h.base}:oe),te=Tr(g==null?void 0:g.compoundVariants)?C:Lb(g==null?void 0:g.compoundVariants,C),ue=pe=>{if(Tr(K)&&Tr(v)&&V)return ah(U,pe==null?void 0:pe.class,pe==null?void 0:pe.className)(j);if(te&&!Array.isArray(te))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof te}`);if(b&&!Array.isArray(b))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof b}`);let Ie=(Me,De,Ae=[],Ue)=>{let et=Ae;if(typeof De=="string")et=et.concat(Rx(De).split(" ").map(pt=>`${Me}:${pt}`));else if(Array.isArray(De))et=et.concat(De.reduce((pt,ut)=>pt.concat(`${Me}:${ut}`),[]));else if(typeof De=="object"&&typeof Ue=="string"){for(let pt in De)if(De.hasOwnProperty(pt)&&pt===Ue){let ut=De[pt];if(ut&&typeof ut=="string"){let ct=Rx(ut);et[Ue]?et[Ue]=et[Ue].concat(ct.split(" ").map(at=>`${Me}:${at}`)):et[Ue]=ct.split(" ").map(at=>`${Me}:${at}`)}else Array.isArray(ut)&&ut.length>0&&(et[Ue]=ut.reduce((ct,at)=>ct.concat(`${Me}:${at}`),[]))}}return et},Oe=(Me,De=K,Ae=null,Ue=null)=>{var et;let pt=De[Me];if(!pt||Tr(pt))return null;let ut=(et=Ue==null?void 0:Ue[Me])!=null?et:pe==null?void 0:pe[Me];if(ut===null)return null;let ct=Lx(ut),at=Array.isArray(j.responsiveVariants)&&j.responsiveVariants.length>0||j.responsiveVariants===!0,Mt=B==null?void 0:B[Me],Yt=[];if(typeof ct=="object"&&at)for(let[Fi,sn]of Object.entries(ct)){let Ui=pt[sn];if(Fi==="initial"){Mt=sn;continue}Array.isArray(j.responsiveVariants)&&!j.responsiveVariants.includes(Fi)||(Yt=Ie(Fi,Ui,Yt,Ae))}let yi=ct!=null&&typeof ct!="object"?ct:Lx(Mt),Pi=pt[yi||"false"];return typeof Yt=="object"&&typeof Ae=="string"&&Yt[Ae]?Bx(Yt,Pi):Yt.length>0?(Yt.push(Pi),Ae==="base"?Yt.join(" "):Yt):Pi},ze=()=>K?Object.keys(K).map(Me=>Oe(Me,K)):null,We=(Me,De)=>{if(!K||typeof K!="object")return null;let Ae=new Array;for(let Ue in K){let et=Oe(Ue,K,Me,De),pt=Me==="base"&&typeof et=="string"?et:et&&et[Me];pt&&(Ae[Ae.length]=pt)}return Ae},$e={};for(let Me in pe)pe[Me]!==void 0&&($e[Me]=pe[Me]);let xt=(Me,De)=>{var Ae;let Ue=typeof(pe==null?void 0:pe[Me])=="object"?{[Me]:(Ae=pe[Me])==null?void 0:Ae.initial}:{};return{...B,...$e,...Ue,...De}},He=(Me=[],De)=>{let Ae=[];for(let{class:Ue,className:et,...pt}of Me){let ut=!0;for(let[ct,at]of Object.entries(pt)){let Mt=xt(ct,De)[ct];if(Array.isArray(at)){if(!at.includes(Mt)){ut=!1;break}}else{let Yt=yi=>yi==null||yi===!1;if(Yt(at)&&Yt(Mt))continue;if(Mt!==at){ut=!1;break}}}ut&&(Ue&&Ae.push(Ue),et&&Ae.push(et))}return Ae},Ye=Me=>{let De=He(te,Me);if(!Array.isArray(De))return De;let Ae={};for(let Ue of De)if(typeof Ue=="string"&&(Ae.base=ah(Ae.base,Ue)(j)),typeof Ue=="object")for(let[et,pt]of Object.entries(Ue))Ae[et]=ah(Ae[et],pt)(j);return Ae},Be=Me=>{if(b.length<1)return null;let De={};for(let{slots:Ae=[],class:Ue,className:et,...pt}of b){if(!Tr(pt)){let ut=!0;for(let ct of Object.keys(pt)){let at=xt(ct,Me)[ct];if(at===void 0||(Array.isArray(pt[ct])?!pt[ct].includes(at):pt[ct]!==at)){ut=!1;break}}if(!ut)continue}for(let ut of Ae)De[ut]=De[ut]||[],De[ut].push([Ue,et])}return De};if(!Tr(v)||!V){let Me={};if(typeof ie=="object"&&!Tr(ie))for(let De of Object.keys(ie))Me[De]=Ae=>{var Ue,et;return ah(ie[De],We(De,Ae),((Ue=Ye(Ae))!=null?Ue:[])[De],((et=Be(Ae))!=null?et:[])[De],Ae==null?void 0:Ae.class,Ae==null?void 0:Ae.className)(j)};return Me}return ah(U,ze(),He(te),pe==null?void 0:pe.class,pe==null?void 0:pe.className)(j)},ve=()=>{if(!(!K||typeof K!="object"))return Object.keys(K)};return ue.variantKeys=ve(),ue.extend=g,ue.base=U,ue.slots=ie,ue.variants=K,ue.defaultVariants=B,ue.compoundSlots=b,ue.compoundVariants=te,ue};function Zb(h){var s,g,v="";if(typeof h=="string"||typeof h=="number")v+=h;else if(typeof h=="object")if(Array.isArray(h)){var T=h.length;for(s=0;s<T;s++)h[s]&&(g=Zb(h[s]))&&(v&&(v+=" "),v+=g)}else for(g in h)h[g]&&(v&&(v+=" "),v+=g);return v}function Gb(){for(var h,s,g=0,v="",T=arguments.length;g<T;g++)(h=arguments[g])&&(s=Zb(h))&&(v&&(v+=" "),v+=s);return v}const Nx=30;function Ni(...h){return jb(Gb(h))}function F_(h){const[s,g]=h.split(":").map(Number);return s*60+g}function Vx(h,s,g=new Date){if(h===void 0)return"Closed";if(h.alwaysOpen)return"Open";const v={weekday:"long",hour:"2-digit",minute:"2-digit",hourCycle:"h23"};s&&(v.timeZone=s);const C=new Intl.DateTimeFormat("en-US",v).formatToParts(g);let b,c,j;for(const K of C)K.type==="weekday"?b=K.value.toLowerCase():K.type==="hour"?c=K.value:K.type==="minute"&&(j=K.value);if(!b||!c||!j)throw new Error("Failed to parse current time information.");const U=F_(`${c}:${j}`);for(const K of h.hours[b]||[]){const B=F_(K.open),V=F_(K.close);if(U>=B&&U<V)return V-U<=Nx?"Closing Soon":"Open";if(U<B)return B-U<=Nx?"Opening Soon":"Closed"}return"Closed"}const Yf=qb({base:"focus:ring-ring inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80 border-transparent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border-transparent",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80 border-transparent",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function lT(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"variant",3,"default"),T=Kt(s,["$$slots","$$events","$$legacy","ref","href","class","variant","children"]);const C=la(),[b,c]=C;var j=Xe(),U=Le(j);const K=Te(()=>`${s.href?"a":"span"}`=="button"?c({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"formaction"}]):`${s.href?"a":"span"}`=="form"?c({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"action"}]):`${s.href?"a":"span"}`=="a"?c({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T});Eb(U,()=>s.href?"a":"span",!1,(B,V)=>{Vc(B,ue=>g(ue),()=>g());let oe;zt(()=>oe=ji(B,oe,{...L(K)},void 0,B.namespaceURI===dv,B.nodeName.includes("-")));var ie=Xe(),te=Le(ie);Ot(te,()=>s.children??ti),_e(V,ie)}),_e(h,j),It()}const cT=()=>"Campus Study Spots",uT=()=>"Lieux d'Étude sur le Campus",hT=(h={},s={})=>({en:cT,fr:uT})[s.languageTag??hi()](),dT=()=>"Select a campus...",pT=()=>"Sélectionner un campus...",fT=(h={},s={})=>({en:dT,fr:pT})[s.languageTag??hi()](),mT=()=>"Search campuses...",gT=()=>"Rechercher des campus...",yT=(h={},s={})=>({en:mT,fr:gT})[s.languageTag??hi()](),_T=()=>"No campus found.",vT=()=>"Aucun campus trouvé.",xT=(h={},s={})=>({en:_T,fr:vT})[s.languageTag??hi()](),bT=()=>"Colors indicate open status of the spaces.",wT=()=>"Les couleurs indiquent le statut ouvert des espaces.",ST=(h={},s={})=>({en:bT,fr:wT})[s.languageTag??hi()](),TT=()=>"Legend",PT=()=>"Légende",IT=(h={},s={})=>({en:TT,fr:PT})[s.languageTag??hi()](),CT=()=>"Toggle theme",AT=()=>"Changer le thème",kT=(h={},s={})=>({en:CT,fr:AT})[s.languageTag??hi()](),ET=()=>"Toggle language",MT=()=>"Changer de langue",zT=(h={},s={})=>({en:ET,fr:MT})[s.languageTag??hi()](),DT=()=>"Visit source",LT=()=>"Visiter la source",RT=(h={},s={})=>({en:DT,fr:LT})[s.languageTag??hi()](),OT=()=>"Get help",FT=()=>"Obtenir de l'aide",BT=(h={},s={})=>({en:OT,fr:FT})[s.languageTag??hi()](),NT=()=>"Open",VT=()=>"Ouvert",jT=(h={},s={})=>({en:NT,fr:VT})[s.languageTag??hi()](),UT=()=>"Closed",qT=()=>"Fermé",Wb=(h={},s={})=>({en:UT,fr:qT})[s.languageTag??hi()](),ZT=()=>"Opening Soon",GT=()=>"Ouvre bientôt",WT=(h={},s={})=>({en:ZT,fr:GT})[s.languageTag??hi()](),HT=()=>"Closing Soon",XT=()=>"Ferme bientôt",KT=(h={},s={})=>({en:HT,fr:XT})[s.languageTag??hi()](),$T=()=>"Included Amenities",JT=()=>"Commodités Incluses",YT=(h={},s={})=>({en:$T,fr:JT})[s.languageTag??hi()](),QT=()=>"Computers",eP=()=>"Ordinateurs",tP=(h={},s={})=>({en:QT,fr:eP})[s.languageTag??hi()](),iP=()=>"Outlets",nP=()=>"Prises",rP=(h={},s={})=>({en:iP,fr:nP})[s.languageTag??hi()](),sP=()=>"Printing",oP=()=>"Impression",aP=(h={},s={})=>({en:sP,fr:oP})[s.languageTag??hi()](),lP=()=>"Rooms",cP=()=>"Salles",uP=(h={},s={})=>({en:lP,fr:cP})[s.languageTag??hi()](),hP=()=>"Water Fountains",dP=()=>"Fontaines d'eau",pP=(h={},s={})=>({en:hP,fr:dP})[s.languageTag??hi()](),fP=()=>"WiFi",mP=()=>"Wi-Fi",gP=(h={},s={})=>({en:fP,fr:mP})[s.languageTag??hi()](),yP=()=>"Google Maps",_P=()=>"Google Maps",vP=(h={},s={})=>({en:yP,fr:_P})[s.languageTag??hi()](),xP=()=>"Directions",bP=()=>"Directions",wP=(h={},s={})=>({en:xP,fr:bP})[s.languageTag??hi()](),SP=()=>"Always Open!",TP=()=>"Toujours ouvert !",PP=(h={},s={})=>({en:SP,fr:TP})[s.languageTag??hi()](),IP=()=>"Hours",CP=()=>"Heures",AP=(h={},s={})=>({en:IP,fr:CP})[s.languageTag??hi()](),kP=()=>"Monday",EP=()=>"Lundi",MP=(h={},s={})=>({en:kP,fr:EP})[s.languageTag??hi()](),zP=()=>"Tuesday",DP=()=>"Mardi",LP=(h={},s={})=>({en:zP,fr:DP})[s.languageTag??hi()](),RP=()=>"Wednesday",OP=()=>"Mercredi",FP=(h={},s={})=>({en:RP,fr:OP})[s.languageTag??hi()](),BP=()=>"Thursday",NP=()=>"Jeudi",VP=(h={},s={})=>({en:BP,fr:NP})[s.languageTag??hi()](),jP=()=>"Friday",UP=()=>"Vendredi",qP=(h={},s={})=>({en:jP,fr:UP})[s.languageTag??hi()](),ZP=()=>"Saturday",GP=()=>"Samedi",WP=(h={},s={})=>({en:ZP,fr:GP})[s.languageTag??hi()](),HP=()=>"Sunday",XP=()=>"Dimanche",KP=(h={},s={})=>({en:HP,fr:XP})[s.languageTag??hi()]();function cm(h,s){Pt(s,!0);let g=Kt(s,["$$slots","$$events","$$legacy","status","class"]);const v={Open:jT(),Closed:Wb(),"Opening Soon":WT(),"Closing Soon":KT()},T={Open:"bg-green-400 hover:bg-green-500",Closed:"bg-red-400 hover:bg-red-500","Opening Soon":"bg-yellow-400 hover:bg-yellow-500","Closing Soon":"bg-yellow-400 hover:bg-yellow-500"};var C=Te(()=>Ni(T[s.status],"border-transparent",s.class));lT(h,Gt({get class(){return L(C)}},()=>g,{children:(b,c)=>{ia();var j=On();zt(()=>Ri(j,v[s.status])),_e(b,j)},$$slots:{default:!0}})),It()}const ev=qb({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var $P=Et("<a><!></a>"),JP=Et("<button><!></button>");function um(h,s){Pt(s,!0);let g=ee(s,"variant",3,"default"),v=ee(s,"size",3,"default"),T=ee(s,"ref",15,null),C=ee(s,"href",3,void 0),b=ee(s,"type",3,"button"),c=Kt(s,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var oe=te=>{var ue=$P();const ve=Te(()=>K({class:Ni(ev({variant:g(),size:v(),className:s.class})),href:C(),...c},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let pe;var Ie=qt(ue);Ot(Ie,()=>s.children??ti),Vt(ue),Vc(ue,Oe=>T(Oe),()=>T()),zt(()=>pe=ji(ue,pe,{...L(ve)})),_e(te,ue)},ie=te=>{var ue=JP();const ve=Te(()=>K({class:Ni(ev({variant:g(),size:v(),className:s.class})),type:b(),...c},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ue);Ot(Ie,()=>s.children??ti),Vt(ue),Vc(ue,Oe=>T(Oe),()=>T()),zt(()=>pe=ji(ue,pe,{...L(ve)})),_e(te,ue)};fi(V,te=>{C()?te(oe):te(ie,!1)})}_e(h,B),It()}function YP(h){return typeof h=="function"}function QP(h){return h!==null&&typeof h=="object"}const yh=Symbol("box"),gv=Symbol("is-writable");function eI(h){return QP(h)&&yh in h}function tI(h){return Pe.isBox(h)&&gv in h}function Pe(h){let s=Qe(qe(h));return{[yh]:!0,[gv]:!0,get current(){return L(s)},set current(g){je(s,qe(g))}}}function iI(h,s){const g=Te(h);return s?{[yh]:!0,[gv]:!0,get current(){return L(g)},set current(v){s(v)}}:{[yh]:!0,get current(){return h()}}}function nI(h){return Pe.isBox(h)?h:YP(h)?Pe.with(h):Pe(h)}function rI(h){return Object.entries(h).reduce((s,[g,v])=>Pe.isBox(v)?(Pe.isWritableBox(v)?Object.defineProperty(s,g,{get(){return v.current},set(T){v.current=T}}):Object.defineProperty(s,g,{get(){return v.current}}),s):Object.assign(s,{[g]:v}),{})}function sI(h){return Pe.isWritableBox(h)?{[yh]:!0,get current(){return h.current}}:h}Pe.from=nI;Pe.with=iI;Pe.flatten=rI;Pe.readonly=sI;Pe.isBox=eI;Pe.isWritableBox=tI;function Hb(...h){return function(s){var g;for(const v of h)if(v){if(s.defaultPrevented)return;typeof v=="function"?v.call(this,s):(g=v.current)==null||g.call(this,s)}}}function Xb(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Gl={},B_,jx;function oI(){if(jx)return B_;jx=1;var h=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,s=/\n/g,g=/^\s*/,v=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,T=/^:\s*/,C=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,b=/^[;\s]*/,c=/^\s+|\s+$/g,j=`
`,U="/",K="*",B="",V="comment",oe="declaration";B_=function(te,ue){if(typeof te!="string")throw new TypeError("First argument must be a string");if(!te)return[];ue=ue||{};var ve=1,pe=1;function Ie(De){var Ae=De.match(s);Ae&&(ve+=Ae.length);var Ue=De.lastIndexOf(j);pe=~Ue?De.length-Ue:pe+De.length}function Oe(){var De={line:ve,column:pe};return function(Ae){return Ae.position=new ze(De),xt(),Ae}}function ze(De){this.start=De,this.end={line:ve,column:pe},this.source=ue.source}ze.prototype.content=te;function We(De){var Ae=new Error(ue.source+":"+ve+":"+pe+": "+De);if(Ae.reason=De,Ae.filename=ue.source,Ae.line=ve,Ae.column=pe,Ae.source=te,!ue.silent)throw Ae}function $e(De){var Ae=De.exec(te);if(Ae){var Ue=Ae[0];return Ie(Ue),te=te.slice(Ue.length),Ae}}function xt(){$e(g)}function He(De){var Ae;for(De=De||[];Ae=Ye();)Ae!==!1&&De.push(Ae);return De}function Ye(){var De=Oe();if(!(U!=te.charAt(0)||K!=te.charAt(1))){for(var Ae=2;B!=te.charAt(Ae)&&(K!=te.charAt(Ae)||U!=te.charAt(Ae+1));)++Ae;if(Ae+=2,B===te.charAt(Ae-1))return We("End of comment missing");var Ue=te.slice(2,Ae-2);return pe+=2,Ie(Ue),te=te.slice(Ae),pe+=2,De({type:V,comment:Ue})}}function Be(){var De=Oe(),Ae=$e(v);if(Ae){if(Ye(),!$e(T))return We("property missing ':'");var Ue=$e(C),et=De({type:oe,property:ie(Ae[0].replace(h,B)),value:Ue?ie(Ue[0].replace(h,B)):B});return $e(b),et}}function Me(){var De=[];He(De);for(var Ae;Ae=Be();)Ae!==!1&&(De.push(Ae),He(De));return De}return xt(),Me()};function ie(te){return te?te.replace(c,B):B}return B_}var Ux;function aI(){if(Ux)return Gl;Ux=1;var h=Gl&&Gl.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(Gl,"__esModule",{value:!0}),Gl.default=g;var s=h(oI());function g(v,T){var C=null;if(!v||typeof v!="string")return C;var b=(0,s.default)(v),c=typeof T=="function";return b.forEach(function(j){if(j.type==="declaration"){var U=j.property,K=j.value;c?T(U,K,j):K&&(C=C||{},C[U]=K)}}),C}return Gl}var lI=aI();const qx=Xb(lI),cI=qx.default||qx,uI=/\d/,hI=["-","_","/","."];function dI(h=""){if(!uI.test(h))return h!==h.toLowerCase()}function pI(h){const s=[];let g="",v,T;for(const C of h){const b=hI.includes(C);if(b===!0){s.push(g),g="",v=void 0;continue}const c=dI(C);if(T===!1){if(v===!1&&c===!0){s.push(g),g=C,v=c;continue}if(v===!0&&c===!1&&g.length>1){const j=g.at(-1);s.push(g.slice(0,Math.max(0,g.length-1))),g=j+C,v=c;continue}}g+=C,v=c,T=b}return s.push(g),s}function Kb(h){return h?pI(h).map(s=>mI(s)).join(""):""}function fI(h){return gI(Kb(h||""))}function mI(h){return h?h[0].toUpperCase()+h.slice(1):""}function gI(h){return h?h[0].toLowerCase()+h.slice(1):""}function ph(h){if(!h)return{};const s={};function g(v,T){if(v.startsWith("-moz-")||v.startsWith("-webkit-")||v.startsWith("-ms-")||v.startsWith("-o-")){s[Kb(v)]=T;return}if(v.startsWith("--")){s[v]=T;return}s[fI(v)]=T}return cI(h,g),s}function $l(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function yI(h,s){const g=RegExp(h,"g");return v=>{if(typeof v!="string")throw new TypeError(`expected an argument of type string, but got ${typeof v}`);return v.match(g)?v.replace(g,s):v}}const _I=yI(/[A-Z]/,h=>`-${h.toLowerCase()}`);function vI(h){if(!h||typeof h!="object"||Array.isArray(h))throw new TypeError(`expected an argument of type object, but got ${typeof h}`);return Object.keys(h).map(s=>`${_I(s)}: ${h[s]};`).join(`
`)}function yv(h={}){return vI(h).replace(`
`," ")}const $b={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};yv($b);function xI(h){var s;return h.length>2&&h.startsWith("on")&&h[2]===((s=h[2])==null?void 0:s.toLowerCase())}function Vi(...h){const s={...h[0]};for(let g=1;g<h.length;g++){const v=h[g];for(const T in v){const C=s[T],b=v[T],c=typeof C=="function",j=typeof b=="function";if(c&&xI(T)){const U=C,K=b;s[T]=Hb(U,K)}else if(c&&j)s[T]=$l(C,b);else if(T==="class"&&typeof C=="string"&&typeof b=="string")s[T]=Gb(C,b);else if(T==="style"){const U=typeof C=="object",K=typeof b=="object",B=typeof C=="string",V=typeof b=="string";if(U&&K)s[T]={...C,...b};else if(U&&V){const oe=ph(b);s[T]={...C,...oe}}else if(B&&K){const oe=ph(C);s[T]={...oe,...b}}else if(B&&V){const oe=ph(C),ie=ph(b);s[T]={...oe,...ie}}else U?s[T]=C:K&&(s[T]=b)}else s[T]=b!==void 0?b:C}}return typeof s.style=="object"&&(s.style=yv(s.style).replaceAll(`
`," ")),s.hidden!==!0&&(s.hidden=void 0),s.disabled!==!0&&(s.disabled=void 0),s}function rn({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{},getRootNode:T=()=>typeof document<"u"?document:void 0}){const C=Te(()=>g()),b=Te(()=>T());Ct(()=>(h.current,L(C),L(b),Oi(()=>{var j;const c=(j=L(b))==null?void 0:j.getElementById(h.current);c?s.current=c:s.current=null,v(s.current)}))),Ct(()=>()=>{s.current=null,v(null)})}function bI(h){Ct(()=>()=>{h()})}function Zp(h,s){setTimeout(s,h)}function jc(h){ay().then(h)}function _v(h){return h?"open":"closed"}function wI(h){return h?"true":"false"}function vv(h){return h?"true":"false"}function SI(h){return h?"":void 0}function TI(h){return h?"true":"false"}function PI(h){return h?"":void 0}const II="ArrowDown",CI="ArrowUp",AI="End",ly="Enter",kI="Escape",EI="Home",xv=" ",MI="Tab",zI="p",DI="n",LI="j",RI="k",bv=typeof document<"u",Zx=OI();function OI(){var h,s;return bv&&((h=window==null?void 0:window.navigator)==null?void 0:h.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((s=window==null?void 0:window.navigator)==null?void 0:s.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function pm(h){return h instanceof HTMLElement}function FI(h){return h instanceof Element}function BI(h){return h!==null}function NI(h){return h instanceof HTMLInputElement&&"select"in h}function VI(h,s){if(getComputedStyle(h).visibility==="hidden")return!0;for(;h;){if(s!==void 0&&h===s)return!1;if(getComputedStyle(h).display==="none")return!0;h=h.parentElement}return!1}function Gx(h,s){return jp(h,s)}function jI(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!Pb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return pv(h)}function UI(h,s){return typeof h=="string"&&s===void 0?`${h}Context`:Array.isArray(h)&&s===void 0?`${h[0]}Context`:`${h}Context`}function $a(h,s,g=!0){const v=UI(h,s),T=Symbol.for(`bits-ui.${v}`),C=v;function b(j){const U=jI(g?T:C,j);if(U===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return U}function c(j){return Gx(g?T:C,j)}return[c,b]}let Wx=0;function hn(h="bits"){return Wx++,`${h}-${Wx}`}function nn(){}var Yl,xh,Uo,Fa,oa,tv,iv,_b;let qI=(_b=class{constructor(s,g){H(this,oa);H(this,Yl,Qe());H(this,xh);H(this,Uo,0);H(this,Fa,null);I(this,Yl).v=qe(s),Ve(this,xh,g)}get current(){return Ib()?Ct(()=>(rh(this,Uo)._++,I(this,Uo)===1&&qn(this,oa,tv).call(this,!0),()=>{ay().then(()=>{rh(this,Uo)._--,I(this,Uo)===0&&qn(this,oa,iv).call(this)})})):I(this,Uo)===0&&(qn(this,oa,tv).call(this,!1),qn(this,oa,iv).call(this)),L(I(this,Yl))}},Yl=new WeakMap,xh=new WeakMap,Uo=new WeakMap,Fa=new WeakMap,oa=new WeakSet,tv=function(s){Ve(this,Fa,I(this,xh).call(this,g=>{je(I(this,Yl),qe(g))},s)??null)},iv=function(){I(this,Fa)!==null&&(I(this,Fa).call(this),Ve(this,Fa,null))},_b);new qI(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function ZI(h){return typeof h=="function"}function GI(h){return ZI(h)?h():h}var qo;class WI{constructor(s,g={box:"border-box"}){H(this,qo,Qe(qe({width:0,height:0})));var v,T;I(this,qo).v=qe({width:((v=g.initialSize)==null?void 0:v.width)??0,height:((T=g.initialSize)==null?void 0:T.height)??0}),Ct(()=>{const C=GI(s);if(!C)return;const b=new ResizeObserver(c=>{for(const j of c){const U=g.box==="content-box"?j.contentBoxSize:j.borderBoxSize,K=Array.isArray(U)?U:[U];L(I(this,qo)).width=K.reduce((B,V)=>Math.max(B,V.inlineSize),0),L(I(this,qo)).height=K.reduce((B,V)=>Math.max(B,V.blockSize),0)}});return b.observe(C),()=>{b.disconnect()}})}get width(){return L(I(this,qo)).width}get height(){return L(I(this,qo)).height}}qo=new WeakMap;var bh,wh;class HI{constructor(s){H(this,bh,Qe());H(this,wh);Ct(()=>{je(I(this,bh),qe(I(this,wh))),Ve(this,wh,s())})}get current(){return L(I(this,bh))}}bh=new WeakMap,wh=new WeakMap;function XI(h,s){const g=Pe(h);function v(C){return s[g.current][C]??g.current}return{state:g,dispatch:C=>{g.current=v(C)}}}function KI(h,s){let g=Qe(qe({})),v=Qe("none");const T=h.current?"mounted":"unmounted";let C=Qe(null);const b=new HI(()=>h.current);Ct(()=>{s.current&&h.current&&jc(()=>{je(C,qe(document.getElementById(s.current)))})});const{state:c,dispatch:j}=XI(T,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Ct(()=>{const V=h.current;Oi(()=>{if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C)||!(V!==b.current))return;const ie=L(v),te=Qf(L(C));V?j("MOUNT"):te==="none"||L(g).display==="none"?j("UNMOUNT"):j(b&&ie!==te?"ANIMATION_OUT":"UNMOUNT")})});function U(V){if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C))return;const oe=Qf(L(C)),ie=oe.includes(V.animationName)||oe==="none";V.target===L(C)&&ie&&j("ANIMATION_END")}function K(V){L(C)||je(C,qe(document.getElementById(s.current))),L(C)&&V.target===L(C)&&je(v,qe(Qf(L(C))))}Ct(()=>{c.current,Oi(()=>{if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C))return;const V=Qf(L(C));je(v,qe(c.current==="mounted"?V:"none"))})}),Ct(()=>{if(L(C))return je(g,qe(getComputedStyle(L(C)))),L(C).addEventListener("animationstart",K),L(C).addEventListener("animationcancel",U),L(C).addEventListener("animationend",U),()=>{var V,oe,ie;(V=L(C))==null||V.removeEventListener("animationstart",K),(oe=L(C))==null||oe.removeEventListener("animationcancel",U),(ie=L(C))==null||ie.removeEventListener("animationend",U)}});const B=Te(()=>["mounted","unmountSuspended"].includes(c.current));return{get current(){return L(B)}}}function Qf(h){return h&&getComputedStyle(h).animationName||"none"}function wv(h,s){Pt(s,!0);const g=KI(Pe.with(()=>s.present),Pe.with(()=>s.id));var v=Xe(),T=Le(v);{var C=b=>{var c=Xe(),j=Le(c);Ot(j,()=>s.presence??ti,()=>({present:g})),_e(b,c)};fi(T,b=>{(s.forceMount||s.present||g.current)&&b(C)})}_e(h,v),It()}function $I(h){return{content:`data-${h}-content`,trigger:`data-${h}-trigger`,overlay:`data-${h}-overlay`,title:`data-${h}-title`,description:`data-${h}-description`,close:`data-${h}-close`,cancel:`data-${h}-cancel`,action:`data-${h}-action`}}var Sh,Th,Ph,Ih,Ch,Ah,kh,Eh,Mh,vm,xm;class JI{constructor(s){Ge(this,"open");Ge(this,"variant");H(this,Sh,Qe(null));H(this,Th,Qe(null));H(this,Ph,Qe(null));H(this,Ih,Qe(null));H(this,Ch,Qe(void 0));H(this,Ah,Qe(void 0));H(this,kh,Qe(void 0));H(this,Eh,Qe(void 0));H(this,Mh,Qe(null));H(this,vm,Te(()=>$I(this.variant.current)));Ge(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});Ge(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});H(this,xm,Te(()=>({"data-state":_v(this.open.current)})));this.open=s.open,this.variant=s.variant}get triggerNode(){return L(I(this,Sh))}set triggerNode(s){je(I(this,Sh),qe(s))}get titleNode(){return L(I(this,Th))}set titleNode(s){je(I(this,Th),qe(s))}get contentNode(){return L(I(this,Ph))}set contentNode(s){je(I(this,Ph),qe(s))}get descriptionNode(){return L(I(this,Ih))}set descriptionNode(s){je(I(this,Ih),qe(s))}get contentId(){return L(I(this,Ch))}set contentId(s){je(I(this,Ch),qe(s))}get titleId(){return L(I(this,Ah))}set titleId(s){je(I(this,Ah),qe(s))}get triggerId(){return L(I(this,kh))}set triggerId(s){je(I(this,kh),qe(s))}get descriptionId(){return L(I(this,Eh))}set descriptionId(s){je(I(this,Eh),qe(s))}get cancelNode(){return L(I(this,Mh))}set cancelNode(s){je(I(this,Mh),qe(s))}get attrs(){return L(I(this,vm))}get sharedProps(){return L(I(this,xm))}}Sh=new WeakMap,Th=new WeakMap,Ph=new WeakMap,Ih=new WeakMap,Ch=new WeakMap,Ah=new WeakMap,kh=new WeakMap,Eh=new WeakMap,Mh=new WeakMap,vm=new WeakMap,xm=new WeakMap;var Ql,zh,Nr,Ba,bm,wm,Sm,Tm;class YI{constructor(s,g){H(this,Ql);H(this,zh);H(this,Nr);H(this,Ba);H(this,bm,s=>{I(this,Ba).current||s.button>0||I(this,Nr).handleOpen()});H(this,wm,s=>{if(!I(this,Ba).current){if(s.pointerType==="touch")return s.preventDefault();s.button>0||(s.preventDefault(),I(this,Nr).handleOpen())}});H(this,Sm,s=>{I(this,Ba).current||(s.key===xv||s.key===ly)&&(s.preventDefault(),I(this,Nr).handleOpen())});H(this,Tm,Te(()=>({id:I(this,Ql).current,"aria-haspopup":"dialog","aria-expanded":vv(I(this,Nr).open.current),"aria-controls":I(this,Nr).contentId,[I(this,Nr).attrs.trigger]:"",onpointerdown:I(this,wm),onkeydown:I(this,Sm),onclick:I(this,bm),...I(this,Nr).sharedProps})));Ve(this,Ql,s.id),Ve(this,Nr,g),Ve(this,zh,s.ref),Ve(this,Ba,s.disabled),rn({id:I(this,Ql),ref:I(this,zh),onRefChange:v=>{I(this,Nr).triggerNode=v,I(this,Nr).triggerId=v==null?void 0:v.id}})}get props(){return L(I(this,Tm))}}Ql=new WeakMap,zh=new WeakMap,Nr=new WeakMap,Ba=new WeakMap,bm=new WeakMap,wm=new WeakMap,Sm=new WeakMap,Tm=new WeakMap;var ec,Dh,xs,Lh,Na,Pm,Im,Cm,Am,km;class QI{constructor(s,g){H(this,ec);H(this,Dh);H(this,xs);H(this,Lh);H(this,Na);H(this,Pm,Te(()=>I(this,xs).attrs[I(this,Lh).current]));H(this,Im,s=>{I(this,Na).current||s.button>0||I(this,xs).handleClose()});H(this,Cm,s=>{if(!I(this,Na).current){if(s.pointerType==="touch")return s.preventDefault();s.button>0||(s.preventDefault(),I(this,xs).handleClose())}});H(this,Am,s=>{I(this,Na).current||(s.key===xv||s.key===ly)&&(s.preventDefault(),I(this,xs).handleClose())});H(this,km,Te(()=>({id:I(this,ec).current,[L(I(this,Pm))]:"",onpointerdown:I(this,Cm),onclick:I(this,Im),onkeydown:I(this,Am),...I(this,xs).sharedProps})));Ve(this,xs,g),Ve(this,Dh,s.ref),Ve(this,ec,s.id),Ve(this,Lh,s.variant),Ve(this,Na,s.disabled),rn({id:I(this,ec),ref:I(this,Dh),deps:()=>I(this,xs).open.current})}get props(){return L(I(this,km))}}ec=new WeakMap,Dh=new WeakMap,xs=new WeakMap,Lh=new WeakMap,Na=new WeakMap,Pm=new WeakMap,Im=new WeakMap,Cm=new WeakMap,Am=new WeakMap,km=new WeakMap;var tc,Rh,Js,Oh,Em;class eC{constructor(s,g){H(this,tc);H(this,Rh);H(this,Js);H(this,Oh);H(this,Em,Te(()=>({id:I(this,tc).current,role:"heading","aria-level":I(this,Oh).current,[I(this,Js).attrs.title]:"",...I(this,Js).sharedProps})));Ve(this,tc,s.id),Ve(this,Js,g),Ve(this,Rh,s.ref),Ve(this,Oh,s.level),rn({id:I(this,tc),ref:I(this,Rh),onRefChange:v=>{I(this,Js).titleNode=v,I(this,Js).titleId=v==null?void 0:v.id},deps:()=>I(this,Js).open.current})}get props(){return L(I(this,Em))}}tc=new WeakMap,Rh=new WeakMap,Js=new WeakMap,Oh=new WeakMap,Em=new WeakMap;var ic,Fh,Ys,Mm;class tC{constructor(s,g){H(this,ic);H(this,Fh);H(this,Ys);H(this,Mm,Te(()=>({id:I(this,ic).current,[I(this,Ys).attrs.description]:"",...I(this,Ys).sharedProps})));Ve(this,ic,s.id),Ve(this,Ys,g),Ve(this,Fh,s.ref),rn({id:I(this,ic),ref:I(this,Fh),deps:()=>I(this,Ys).open.current,onRefChange:v=>{I(this,Ys).descriptionNode=v,I(this,Ys).descriptionId=v==null?void 0:v.id}})}get props(){return L(I(this,Mm))}}ic=new WeakMap,Fh=new WeakMap,Ys=new WeakMap,Mm=new WeakMap;var nc,Bh,zm,Dm;class iC{constructor(s,g){H(this,nc);H(this,Bh);Ge(this,"root");H(this,zm,Te(()=>({open:this.root.open.current})));H(this,Dm,Te(()=>({id:I(this,nc).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ve(this,nc,s.id),this.root=g,Ve(this,Bh,s.ref),rn({id:I(this,nc),ref:I(this,Bh),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,zm))}get props(){return L(I(this,Dm))}}nc=new WeakMap,Bh=new WeakMap,zm=new WeakMap,Dm=new WeakMap;var rc,Nh,Lm,Rm;class nC{constructor(s,g){H(this,rc);H(this,Nh);Ge(this,"root");H(this,Lm,Te(()=>({open:this.root.open.current})));H(this,Rm,Te(()=>({id:I(this,rc).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ve(this,rc,s.id),Ve(this,Nh,s.ref),this.root=g,rn({id:I(this,rc),ref:I(this,Nh),deps:()=>this.root.open.current})}get snippetProps(){return L(I(this,Lm))}get props(){return L(I(this,Rm))}}rc=new WeakMap,Nh=new WeakMap,Lm=new WeakMap,Rm=new WeakMap;const[rC,Gc]=$a("Dialog.Root");function sC(h){return rC(new JI(h))}function oC(h){const s=Gc();return new YI(h,s)}function aC(h){return new eC(h,Gc())}function lC(h){return new iC(h,Gc())}function cC(h){return new nC(h,Gc())}function uC(h){return new tC(h,Gc())}function hC(h){return new QI(h,Gc())}var dC=Et("<div><!></div>");function Jb(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"level",3,2),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const b=aC({id:Pe.with(()=>g()),level:Pe.with(()=>T()),ref:Pe.with(()=>v(),V=>v(V))}),c=Te(()=>Vi(C,b.props));var j=Xe(),U=Le(j);{var K=V=>{var oe=Xe(),ie=Le(oe);Ot(ie,()=>s.child,()=>({props:L(c)})),_e(V,oe)},B=V=>{var oe=dC();let ie;var te=qt(oe);Ot(te,()=>s.children??ti),Vt(oe),zt(()=>ie=ji(oe,ie,{...L(c)})),_e(V,oe)};fi(U,V=>{s.child?V(K):V(B,!1)})}_e(h,j),It()}function pC(h,s){Pt(s,!0);var g=Xe(),v=Le(g);Ab(v,()=>s.children,T=>{var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),_e(T,C)}),_e(h,g),It()}function Sv(h,s){Pt(s,!0);let g=ee(s,"to",3,"body");const v=uS();let T=Te(C);function C(){if(!bv||s.disabled)return null;let K=null;return typeof g()=="string"?K=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(K=g()),K}let b;Ct(()=>{if(!L(T)||s.disabled){b&&(Mx(b),b=null);return}return Oi(()=>b=gS(pC,{target:L(T),props:{children:s.children},context:v})),()=>{b&&(Mx(b),b=null)}});var c=Xe(),j=Le(c);{var U=K=>{var B=Xe(),V=Le(B);Ot(V,()=>s.children??ti),_e(K,B)};fi(j,K=>{s.disabled&&K(U)})}_e(h,c),It()}function Is(h,s,g,v){const T=Array.isArray(s)?s:[s];return T.forEach(C=>h.addEventListener(C,g,v)),()=>{T.forEach(C=>h.removeEventListener(C,g,v))}}function Hx(h,s=500){let g=null;const v=(...T)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{h(...T)},s)};return v.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},v}function Tv(h,s){return h===s||h.contains(s)}function Yb(h){return(h==null?void 0:h.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var sc,Va,Zo,oc,Go,ac,lc,Vh,jh,Uh,Qs,Om,qc,Qb,Fm,cc,Bm,Nm,Vm,jm,qh,e1,Um,qm;class fC{constructor(s){H(this,qc);H(this,sc);H(this,Va);H(this,Zo,{pointerdown:!1});H(this,oc,!1);Ge(this,"node",Pe(null));H(this,Go);H(this,ac);H(this,lc,Qe(!1));H(this,Vh);H(this,jh,Qe(null));H(this,Uh);H(this,Qs,nn);H(this,Om,s=>{s.defaultPrevented||this.currNode&&jc(()=>{var g,v;!this.currNode||I(this,jm).call(this,s.target)||s.target&&!L(I(this,lc))&&((v=(g=I(this,Vh)).current)==null||v.call(g,s))})});H(this,Fm,s=>{let g=s;g.defaultPrevented&&(g=Xx(s)),I(this,sc).current(s)});H(this,cc,Hx(s=>{if(!this.currNode){I(this,Qs).call(this);return}const g=I(this,Uh).current(s,this.currNode)||_C(s,this.currNode);if(!I(this,oc)||qn(this,qc,e1).call(this)||!g){I(this,Qs).call(this);return}let v=s;if(v.defaultPrevented&&(v=Xx(v)),I(this,Va).current!=="close"&&I(this,Va).current!=="defer-otherwise-close"){I(this,Qs).call(this);return}s.pointerType==="touch"?(I(this,Qs).call(this),Ve(this,Qs,Is(I(this,Go),"click",I(this,Fm),{once:!0}))):I(this,sc).current(v)},10));H(this,Bm,s=>{I(this,Zo)[s.type]=!0});H(this,Nm,s=>{I(this,Zo)[s.type]=!1});H(this,Vm,()=>{this.node.current&&Ve(this,oc,yC(this.node.current))});H(this,jm,s=>this.node.current?Tv(this.node.current,s):!1);H(this,qh,Hx(()=>{for(const s in I(this,Zo))I(this,Zo)[s]=!1;Ve(this,oc,!1)},20));H(this,Um,()=>{je(I(this,lc),!0)});H(this,qm,()=>{je(I(this,lc),!1)});Ge(this,"props",{onfocuscapture:I(this,Um),onblurcapture:I(this,qm)});Ve(this,ac,s.enabled),Ve(this,Uh,s.isValidEvent),rn({id:s.id,ref:this.node,deps:()=>I(this,ac).current,onRefChange:T=>{this.currNode=T}}),Ve(this,Va,s.interactOutsideBehavior),Ve(this,sc,s.onInteractOutside),Ve(this,Vh,s.onFocusOutside),Ct(()=>{Ve(this,Go,Yb(this.currNode))});let g=nn;const v=()=>{I(this,qh).call(this),globalThis.bitsDismissableLayers.delete(this),I(this,cc).destroy(),g()};Ct(()=>(I(this,ac).current&&this.currNode&&Zp(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,Oi(()=>I(this,Va))),g(),g=qn(this,qc,Qb).call(this))}),()=>{v()})),bI(()=>{I(this,qh).destroy(),globalThis.bitsDismissableLayers.delete(this),I(this,cc).destroy(),I(this,Qs).call(this),g()})}get currNode(){return L(I(this,jh))}set currNode(s){je(I(this,jh),qe(s))}}sc=new WeakMap,Va=new WeakMap,Zo=new WeakMap,oc=new WeakMap,Go=new WeakMap,ac=new WeakMap,lc=new WeakMap,Vh=new WeakMap,jh=new WeakMap,Uh=new WeakMap,Qs=new WeakMap,Om=new WeakMap,qc=new WeakSet,Qb=function(){return $l(Is(I(this,Go),"pointerdown",$l(I(this,Bm),I(this,Vm)),!0),Is(I(this,Go),"pointerdown",$l(I(this,Nm),I(this,cc))),Is(I(this,Go),"focusin",I(this,Om)))},Fm=new WeakMap,cc=new WeakMap,Bm=new WeakMap,Nm=new WeakMap,Vm=new WeakMap,jm=new WeakMap,qh=new WeakMap,e1=function(){return Object.values(I(this,Zo)).some(Boolean)},Um=new WeakMap,qm=new WeakMap;function mC(h){return new fC(h)}function gC(h){return h.findLast(([s,{current:g}])=>g==="close"||g==="ignore")}function yC(h){const s=[...globalThis.bitsDismissableLayers],g=gC(s);if(g)return g[0].node.current===h;const[v]=s[0];return v.node.current===h}function _C(h,s){if("button"in h&&h.button>0)return!1;const g=h.target;return FI(g)?Yb(g).documentElement.contains(g)&&!Tv(s,g):!1}function Xx(h){const s=h.currentTarget,g=h.target;let v;h instanceof PointerEvent?v=new PointerEvent(h.type,h):v=new PointerEvent("pointerdown",h);let T=!1;return new Proxy(v,{get:(b,c)=>c==="currentTarget"?s:c==="target"?g:c==="preventDefault"?()=>{T=!0,typeof b.preventDefault=="function"&&b.preventDefault()}:c==="defaultPrevented"?T:c in b?b[c]:h[c]})}function t1(h,s){Pt(s,!0);let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"onInteractOutside",3,nn),T=ee(s,"onFocusOutside",3,nn),C=ee(s,"isValidEvent",3,()=>!1);const b=mC({id:Pe.with(()=>s.id),interactOutsideBehavior:Pe.with(()=>g()),onInteractOutside:Pe.with(()=>v()),enabled:Pe.with(()=>s.enabled),onFocusOutside:Pe.with(()=>T()),isValidEvent:Pe.with(()=>C())});var c=Xe(),j=Le(c);Ot(j,()=>s.children??ti,()=>({props:b.props})),_e(h,c),It()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var Zh,uc,Gh,Zm,Gm;class vC{constructor(s){H(this,Zh);H(this,uc);H(this,Gh);H(this,Zm,()=>Is(document,"keydown",I(this,Gm),{passive:!1}));H(this,Gm,s=>{if(s.key!==kI||!bC(this))return;const g=new KeyboardEvent(s.type,s);s.preventDefault();const v=I(this,uc).current;v!=="close"&&v!=="defer-otherwise-close"||I(this,Zh).current(g)});Ve(this,uc,s.escapeKeydownBehavior),Ve(this,Zh,s.onEscapeKeydown),Ve(this,Gh,s.enabled);let g=nn;Ct(()=>(I(this,Gh).current&&(globalThis.bitsEscapeLayers.set(this,Oi(()=>I(this,uc))),g=I(this,Zm).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}Zh=new WeakMap,uc=new WeakMap,Gh=new WeakMap,Zm=new WeakMap,Gm=new WeakMap;function xC(h){return new vC(h)}function bC(h){const s=[...globalThis.bitsEscapeLayers],g=s.findLast(([T,{current:C}])=>C==="close"||C==="ignore");if(g)return g[0]===h;const[v]=s[0];return v===h}function i1(h,s){Pt(s,!0);let g=ee(s,"escapeKeydownBehavior",3,"close"),v=ee(s,"onEscapeKeydown",3,nn);xC({escapeKeydownBehavior:Pe.with(()=>g()),onEscapeKeydown:Pe.with(()=>v()),enabled:Pe.with(()=>s.enabled)});var T=Xe(),C=Le(T);Ot(C,()=>s.children??ti),_e(h,T),It()}const wC=Pe([]);function SC(){const h=wC;return{add(s){const g=h.current[0];s.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),h.current=Kx(h.current,s),h.current.unshift(s)},remove(s){var g;h.current=Kx(h.current,s),(g=h.current[0])==null||g.resume()}}}function TC(){let h=Qe(!1);return{id:hn(),get paused(){return L(h)},pause(){je(h,!0)},resume(){je(h,!1)}}}function Kx(h,s){return[...h].filter(g=>g.id!==s.id)}function PC(h){return h.filter(s=>s.tagName!=="A")}function Vo(h,{select:s=!1}={}){if(!(h&&h.focus))return;const g=document.activeElement;h.focus({preventScroll:!0}),h!==g&&NI(h)&&s&&h.select()}function IC(h,{select:s=!1}={}){const g=document.activeElement;for(const v of h)if(Vo(v,{select:s}),document.activeElement!==g)return!0}function $x(h,s){for(const g of h)if(!VI(g,s))return g}function n1(h){const s=[],g=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,{acceptNode:v=>{const T=v.tagName==="INPUT"&&v.type==="hidden";return v.disabled||v.hidden||T?NodeFilter.FILTER_SKIP:v.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)s.push(g.currentNode);return s}function CC(h){const s=n1(h),g=$x(s,h),v=$x(s.reverse(),h);return[g,v]}const AC="focusScope.autoFocusOnMount",kC="focusScope.autoFocusOnDestroy",Jx={bubbles:!1,cancelable:!0};function EC({id:h,loop:s,enabled:g,onOpenAutoFocus:v,onCloseAutoFocus:T,forceMount:C}){const b=SC(),c=TC(),j=Pe(null);rn({id:h,ref:j,deps:()=>g.current});let U=Qe(null);Ct(()=>{const ie=j.current;if(!ie||!g.current)return;function te(pe){if(c.paused||!ie)return;const Ie=pe.target;pm(Ie)&&(ie.contains(Ie)?je(U,qe(Ie)):Vo(L(U),{select:!0}))}function ue(pe){if(c.paused||!ie)return;const Ie=pe.relatedTarget;pm(Ie)&&Ie!==null&&(ie.contains(Ie)||Vo(L(U),{select:!0}))}function ve(pe){(ie==null?void 0:ie.contains(L(U)))||Vo(ie)}return Oi(()=>{const pe=$l(Is(document,"focusin",te),Is(document,"focusout",ue)),Ie=new MutationObserver(ve);return Ie.observe(ie,{childList:!0,subtree:!0}),()=>{pe(),Ie.disconnect()}})}),Ct(()=>{if(C.current)return;let ie=j.current;const te=document.activeElement;return Oi(()=>{K(ie,te)}),()=>{ie&&B(te)}}),Ct(()=>{if(!C.current)return;g.current;const ie=j.current,te=document.activeElement;return Oi(()=>{K(ie,te)}),()=>{ie&&B(te)}});function K(ie,te){if(ie||(ie=document.getElementById(h.current)),!ie)return;if(b.add(c),!ie.contains(te)){const ve=new CustomEvent(AC,Jx);v.current(ve),ve.defaultPrevented||jc(()=>{ie&&(IC(PC(n1(ie)),{select:!0}),document.activeElement===te&&Vo(ie))})}}function B(ie){const te=new CustomEvent(kC,Jx);T.current(te),setTimeout(()=>{!te.defaultPrevented&&ie&&Vo(ie??document.body,{select:!0}),b.remove(c)},0)}function V(ie){if(!g.current||!s.current&&!g.current||c.paused)return;const te=ie.key===MI&&!ie.ctrlKey&&!ie.altKey&&!ie.metaKey,ue=document.activeElement;if(!(te&&ue))return;const ve=j.current;if(!ve)return;const[pe,Ie]=CC(ve);pe&&Ie?!ie.shiftKey&&ue===Ie?(ie.preventDefault(),s.current&&Vo(pe,{select:!0})):ie.shiftKey&&ue===pe&&(ie.preventDefault(),s.current&&Vo(Ie,{select:!0})):ue===ve&&ie.preventDefault()}const oe=Te(()=>({id:h.current,tabindex:-1,onkeydown:V}));return{get props(){return L(oe)}}}function r1(h,s){Pt(s,!0);let g=ee(s,"trapFocus",3,!1),v=ee(s,"loop",3,!1),T=ee(s,"onCloseAutoFocus",3,nn),C=ee(s,"onOpenAutoFocus",3,nn),b=ee(s,"forceMount",3,!1);const c=EC({enabled:Pe.with(()=>g()),loop:Pe.with(()=>v()),onCloseAutoFocus:Pe.with(()=>T()),onOpenAutoFocus:Pe.with(()=>C()),id:Pe.with(()=>s.id),forceMount:Pe.with(()=>b())});var j=Xe(),U=Le(j);Ot(U,()=>s.focusScope??ti,()=>({props:c.props})),_e(h,j),It()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Wh,Hh,Xh,Wo,hc,Kh,Wm,s1,Hm,$h;class MC{constructor(s){H(this,Wm);H(this,Wh);H(this,Hh);H(this,Xh);H(this,Wo);H(this,hc,nn);H(this,Kh,Pe(null));H(this,Hm,s=>{const g=I(this,Kh).current,v=s.target;!pm(g)||!pm(v)||!I(this,Wo).current||!LC(this)||!Tv(g,v)||(I(this,Hh).current(s),!s.defaultPrevented&&Ve(this,hc,DC(g)))});H(this,$h,()=>{I(this,hc).call(this),Ve(this,hc,nn)});Ve(this,Wh,s.id),Ve(this,Wo,s.preventOverflowTextSelection),Ve(this,Hh,s.onPointerDown),Ve(this,Xh,s.onPointerUp),rn({id:I(this,Wh),ref:I(this,Kh),deps:()=>I(this,Wo).current});let g=nn;Ct(()=>(I(this,Wo).current&&(globalThis.bitsTextSelectionLayers.set(this,Oi(()=>I(this,Wo))),g=qn(this,Wm,s1).call(this)),()=>{g(),I(this,$h).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Wh=new WeakMap,Hh=new WeakMap,Xh=new WeakMap,Wo=new WeakMap,hc=new WeakMap,Kh=new WeakMap,Wm=new WeakSet,s1=function(){return $l(Is(document,"pointerdown",I(this,Hm)),Is(document,"pointerup",Hb(I(this,$h),I(this,Xh))))},Hm=new WeakMap,$h=new WeakMap;function zC(h){return new MC(h)}const Yx=h=>h.style.userSelect||h.style.webkitUserSelect;function DC(h){const s=document.body,g=Yx(s),v=Yx(h);return em(s,"none"),em(h,"text"),()=>{em(s,g),em(h,v)}}function em(h,s){h.style.userSelect=s,h.style.webkitUserSelect=s}function LC(h){const s=[...globalThis.bitsTextSelectionLayers];if(!s.length)return!1;const g=s.at(-1);return g?g[0]===h:!1}function o1(h,s){Pt(s,!0);let g=ee(s,"preventOverflowTextSelection",3,!0),v=ee(s,"onPointerDown",3,nn),T=ee(s,"onPointerUp",3,nn);zC({id:Pe.with(()=>s.id),preventOverflowTextSelection:Pe.with(()=>g()),onPointerDown:Pe.with(()=>v()),onPointerUp:Pe.with(()=>T()),enabled:Pe.with(()=>s.enabled)});var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),_e(h,C),It()}var RC=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],OC=["difference","intersection","symmetricDifference","union"],Qx=!1,dc,ss,Ho,Xm,a1;const Km=class Km extends Set{constructor(g){super();H(this,Xm);H(this,dc,new Map);H(this,ss,as(0));H(this,Ho,as(0));if(g){for(var v of g)super.add(v);I(this,Ho).v=super.size}Qx||qn(this,Xm,a1).call(this)}has(g){var v=super.has(g),T=I(this,dc),C=T.get(g);if(C===void 0){if(!v)return L(I(this,ss)),!1;C=as(!0),T.set(g,C)}return L(C),v}add(g){return super.has(g)||(super.add(g),je(I(this,Ho),super.size),jo(I(this,ss))),this}delete(g){var v=super.delete(g),T=I(this,dc),C=T.get(g);return C!==void 0&&(T.delete(g),je(C,!1)),v&&(je(I(this,Ho),super.size),jo(I(this,ss))),v}clear(){if(super.size!==0){super.clear();var g=I(this,dc);for(var v of g.values())je(v,!1);g.clear(),je(I(this,Ho),0),jo(I(this,ss))}}keys(){return this.values()}values(){return L(I(this,ss)),super.values()}entries(){return L(I(this,ss)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return L(I(this,Ho))}};dc=new WeakMap,ss=new WeakMap,Ho=new WeakMap,Xm=new WeakSet,a1=function(){Qx=!0;var g=Km.prototype,v=Set.prototype;for(const T of RC)g[T]=function(...C){return L(I(this,ss)),v[T].apply(this,C)};for(const T of OC)g[T]=function(...C){L(I(this,ss));var b=v[T].apply(this,C);return new Km(b)}};let nv=Km;var bs,ws,eo,pc,hm;const Fv=class Fv extends Map{constructor(g){super();H(this,pc);H(this,bs,new Map);H(this,ws,as(0));H(this,eo,as(0));if(g){for(var[v,T]of g)super.set(v,T);I(this,eo).v=super.size}}has(g){var v=I(this,bs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else return L(I(this,ws)),!1}return L(T),!0}forEach(g,v){qn(this,pc,hm).call(this),super.forEach(g,v)}get(g){var v=I(this,bs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else{L(I(this,ws));return}}return L(T),super.get(g)}set(g,v){var B;var T=I(this,bs),C=T.get(g),b=super.get(g),c=super.set(g,v),j=I(this,ws);if(C===void 0)T.set(g,as(0)),je(I(this,eo),super.size),jo(j);else if(b!==v){jo(C);var U=j.reactions===null?null:new Set(j.reactions),K=U===null||!((B=C.reactions)!=null&&B.every(V=>U.has(V)));K&&jo(j)}return c}delete(g){var v=I(this,bs),T=v.get(g),C=super.delete(g);return T!==void 0&&(v.delete(g),je(I(this,eo),super.size),je(T,-1),jo(I(this,ws))),C}clear(){if(super.size!==0){super.clear();var g=I(this,bs);je(I(this,eo),0);for(var v of g.values())je(v,-1);jo(I(this,ws)),g.clear()}}keys(){return L(I(this,ws)),super.keys()}values(){return qn(this,pc,hm).call(this),super.values()}entries(){return qn(this,pc,hm).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return L(I(this,eo)),super.size}};bs=new WeakMap,ws=new WeakMap,eo=new WeakMap,pc=new WeakSet,hm=function(){L(I(this,ws));var g=I(this,bs);if(I(this,eo).v!==g.size)for(var v of wx(Fv.prototype,this,"keys").call(this))g.has(v)||g.set(v,as(0));for(var[,T]of I(this,bs))L(T)};let rv=Fv;function FC(h){let s=0,g=Qe(void 0),v;function T(){s-=1,v&&s<=0&&(v(),je(g,void 0),v=void 0)}return(...C)=>(s+=1,L(g)===void 0&&(v=hS(()=>{je(g,qe(h(...C)))})),Ct(()=>()=>{T()}),L(g))}const BC=FC(()=>{const h=new rv,s=Te(()=>{for(const C of h.values())if(C)return!0;return!1});let g=qe({}),v=null;function T(){bv&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",Zx&&(v==null||v()))}return Ct(()=>{const C=L(s);return Oi(()=>{if(!C)return;const b=getComputedStyle(document.body);g.overflow=b.overflow,g.paddingRight=b.paddingRight,g.marginRight=b.marginRight,g.pointerEvents=b.pointerEvents;const c=window.innerWidth-document.documentElement.clientWidth,U={padding:Number.parseInt(g.paddingRight??"0",10)+c,margin:Number.parseInt(g.marginRight??"0",10)};c>0&&(document.body.style.paddingRight=`${U.padding}px`,document.body.style.marginRight=`${U.margin}px`,document.body.style.setProperty("--scrollbar-width",`${c}px`),document.body.style.overflow="hidden"),Zx&&(v=Is(document,"touchmove",K=>{K.target===document.documentElement&&(K.touches.length>1||K.preventDefault())},{passive:!1})),jc(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Ct(()=>()=>{v==null||v()}),{get map(){return h},resetBodyStyle:T}});function NC(h,s=()=>null){const g=hn(),v=BC(),T=Te(s);v.map.set(g,h??!1);const C=Pe.with(()=>v.map.get(g)??!1,b=>v.map.set(g,b));return Ct(()=>()=>{v.map.delete(g),!VC(v.map)&&(L(T)===null?requestAnimationFrame(()=>v.resetBodyStyle()):Zp(L(T),()=>v.resetBodyStyle()))}),C}function VC(h){for(const[s,g]of h)if(g)return!0;return!1}function fm(h,s){Pt(s,!0);let g=ee(s,"preventScroll",3,!0),v=ee(s,"restoreScrollDelay",3,null);NC(g(),()=>v()),It()}function jC({forceMount:h,present:s,trapFocus:g,open:v}){return h?v&&g:s&&g&&v}var UC=Et("<div><!></div>");function l1(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"forceMount",3,!1),T=ee(s,"ref",15,null),C=Kt(s,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const b=cC({id:Pe.with(()=>g()),ref:Pe.with(()=>T(),U=>T(U))}),c=Te(()=>Vi(C,b.props));var j=Te(()=>b.root.open.current||v());wv(h,{get id(){return g()},get present(){return L(j)},presence:K=>{var B=Xe(),V=Le(B);{var oe=te=>{var ue=Xe(),ve=Le(ue),pe=Up(()=>({props:Vi(L(c)),...b.snippetProps}));Ot(ve,()=>s.child,()=>L(pe)),_e(te,ue)},ie=te=>{var ue=UC();const ve=Te(()=>Vi(L(c)));let pe;var Ie=qt(ue);Ot(Ie,()=>s.children??ti,()=>b.snippetProps),Vt(ue),zt(()=>pe=ji(ue,pe,{...L(ve)})),_e(te,ue)};fi(V,te=>{s.child?te(oe):te(ie,!1)})}_e(K,B)},$$slots:{presence:!0}}),It()}var qC=Et("<button><!></button>");function ZC(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"disabled",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const b=oC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),te=>v(te)),disabled:Pe.with(()=>!!T())}),c=Te(()=>Vi(C,b.props)),j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var oe=te=>{var ue=Xe(),ve=Le(ue);Ot(ve,()=>s.child,()=>({props:L(c)})),_e(te,ue)},ie=te=>{var ue=qC();const ve=Te(()=>K({...L(c)},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ue);Ot(Ie,()=>s.children??ti),Vt(ue),zt(()=>pe=ji(ue,pe,{...L(ve)})),_e(te,ue)};fi(V,te=>{s.child?te(oe):te(ie,!1)})}_e(h,B),It()}var GC=Et("<div><!></div>");function c1(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref"]);const C=uC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var c=Xe(),j=Le(c);{var U=B=>{var V=Xe(),oe=Le(V);Ot(oe,()=>s.child,()=>({props:L(b)})),_e(B,V)},K=B=>{var V=GC();let oe;var ie=qt(V);Ot(ie,()=>s.children??ti),Vt(V),zt(()=>oe=ji(V,oe,{...L(b)})),_e(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}_e(h,c),It()}const WC=["top","right","bottom","left"],na=Math.min,Ur=Math.max,mm=Math.round,tm=Math.floor,Cs=h=>({x:h,y:h}),HC={left:"right",right:"left",bottom:"top",top:"bottom"},XC={start:"end",end:"start"};function sv(h,s,g){return Ur(h,na(s,g))}function to(h,s){return typeof h=="function"?h(s):h}function io(h){return h.split("-")[0]}function Wc(h){return h.split("-")[1]}function Pv(h){return h==="x"?"y":"x"}function Iv(h){return h==="y"?"height":"width"}function ra(h){return["top","bottom"].includes(io(h))?"y":"x"}function Cv(h){return Pv(ra(h))}function KC(h,s,g){g===void 0&&(g=!1);const v=Wc(h),T=Cv(h),C=Iv(T);let b=T==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return s.reference[C]>s.floating[C]&&(b=gm(b)),[b,gm(b)]}function $C(h){const s=gm(h);return[ov(h),s,ov(s)]}function ov(h){return h.replace(/start|end/g,s=>XC[s])}function JC(h,s,g){const v=["left","right"],T=["right","left"],C=["top","bottom"],b=["bottom","top"];switch(h){case"top":case"bottom":return g?s?T:v:s?v:T;case"left":case"right":return s?C:b;default:return[]}}function YC(h,s,g,v){const T=Wc(h);let C=JC(io(h),g==="start",v);return T&&(C=C.map(b=>b+"-"+T),s&&(C=C.concat(C.map(ov)))),C}function gm(h){return h.replace(/left|right|bottom|top/g,s=>HC[s])}function QC(h){return{top:0,right:0,bottom:0,left:0,...h}}function u1(h){return typeof h!="number"?QC(h):{top:h,right:h,bottom:h,left:h}}function ym(h){const{x:s,y:g,width:v,height:T}=h;return{width:v,height:T,top:g,left:s,right:s+v,bottom:g+T,x:s,y:g}}function eb(h,s,g){let{reference:v,floating:T}=h;const C=ra(s),b=Cv(s),c=Iv(b),j=io(s),U=C==="y",K=v.x+v.width/2-T.width/2,B=v.y+v.height/2-T.height/2,V=v[c]/2-T[c]/2;let oe;switch(j){case"top":oe={x:K,y:v.y-T.height};break;case"bottom":oe={x:K,y:v.y+v.height};break;case"right":oe={x:v.x+v.width,y:B};break;case"left":oe={x:v.x-T.width,y:B};break;default:oe={x:v.x,y:v.y}}switch(Wc(s)){case"start":oe[b]-=V*(g&&U?-1:1);break;case"end":oe[b]+=V*(g&&U?-1:1);break}return oe}const eA=async(h,s,g)=>{const{placement:v="bottom",strategy:T="absolute",middleware:C=[],platform:b}=g,c=C.filter(Boolean),j=await(b.isRTL==null?void 0:b.isRTL(s));let U=await b.getElementRects({reference:h,floating:s,strategy:T}),{x:K,y:B}=eb(U,v,j),V=v,oe={},ie=0;for(let te=0;te<c.length;te++){const{name:ue,fn:ve}=c[te],{x:pe,y:Ie,data:Oe,reset:ze}=await ve({x:K,y:B,initialPlacement:v,placement:V,strategy:T,middlewareData:oe,rects:U,platform:b,elements:{reference:h,floating:s}});K=pe??K,B=Ie??B,oe={...oe,[ue]:{...oe[ue],...Oe}},ze&&ie<=50&&(ie++,typeof ze=="object"&&(ze.placement&&(V=ze.placement),ze.rects&&(U=ze.rects===!0?await b.getElementRects({reference:h,floating:s,strategy:T}):ze.rects),{x:K,y:B}=eb(U,V,j)),te=-1)}return{x:K,y:B,placement:V,strategy:T,middlewareData:oe}};async function _h(h,s){var g;s===void 0&&(s={});const{x:v,y:T,platform:C,rects:b,elements:c,strategy:j}=h,{boundary:U="clippingAncestors",rootBoundary:K="viewport",elementContext:B="floating",altBoundary:V=!1,padding:oe=0}=to(s,h),ie=u1(oe),ue=c[V?B==="floating"?"reference":"floating":B],ve=ym(await C.getClippingRect({element:(g=await(C.isElement==null?void 0:C.isElement(ue)))==null||g?ue:ue.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(c.floating)),boundary:U,rootBoundary:K,strategy:j})),pe=B==="floating"?{x:v,y:T,width:b.floating.width,height:b.floating.height}:b.reference,Ie=await(C.getOffsetParent==null?void 0:C.getOffsetParent(c.floating)),Oe=await(C.isElement==null?void 0:C.isElement(Ie))?await(C.getScale==null?void 0:C.getScale(Ie))||{x:1,y:1}:{x:1,y:1},ze=ym(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:pe,offsetParent:Ie,strategy:j}):pe);return{top:(ve.top-ze.top+ie.top)/Oe.y,bottom:(ze.bottom-ve.bottom+ie.bottom)/Oe.y,left:(ve.left-ze.left+ie.left)/Oe.x,right:(ze.right-ve.right+ie.right)/Oe.x}}const tA=h=>({name:"arrow",options:h,async fn(s){const{x:g,y:v,placement:T,rects:C,platform:b,elements:c,middlewareData:j}=s,{element:U,padding:K=0}=to(h,s)||{};if(U==null)return{};const B=u1(K),V={x:g,y:v},oe=Cv(T),ie=Iv(oe),te=await b.getDimensions(U),ue=oe==="y",ve=ue?"top":"left",pe=ue?"bottom":"right",Ie=ue?"clientHeight":"clientWidth",Oe=C.reference[ie]+C.reference[oe]-V[oe]-C.floating[ie],ze=V[oe]-C.reference[oe],We=await(b.getOffsetParent==null?void 0:b.getOffsetParent(U));let $e=We?We[Ie]:0;(!$e||!await(b.isElement==null?void 0:b.isElement(We)))&&($e=c.floating[Ie]||C.floating[ie]);const xt=Oe/2-ze/2,He=$e/2-te[ie]/2-1,Ye=na(B[ve],He),Be=na(B[pe],He),Me=Ye,De=$e-te[ie]-Be,Ae=$e/2-te[ie]/2+xt,Ue=sv(Me,Ae,De),et=!j.arrow&&Wc(T)!=null&&Ae!==Ue&&C.reference[ie]/2-(Ae<Me?Ye:Be)-te[ie]/2<0,pt=et?Ae<Me?Ae-Me:Ae-De:0;return{[oe]:V[oe]+pt,data:{[oe]:Ue,centerOffset:Ae-Ue-pt,...et&&{alignmentOffset:pt}},reset:et}}}),iA=function(h){return h===void 0&&(h={}),{name:"flip",options:h,async fn(s){var g,v;const{placement:T,middlewareData:C,rects:b,initialPlacement:c,platform:j,elements:U}=s,{mainAxis:K=!0,crossAxis:B=!0,fallbackPlacements:V,fallbackStrategy:oe="bestFit",fallbackAxisSideDirection:ie="none",flipAlignment:te=!0,...ue}=to(h,s);if((g=C.arrow)!=null&&g.alignmentOffset)return{};const ve=io(T),pe=ra(c),Ie=io(c)===c,Oe=await(j.isRTL==null?void 0:j.isRTL(U.floating)),ze=V||(Ie||!te?[gm(c)]:$C(c)),We=ie!=="none";!V&&We&&ze.push(...YC(c,te,ie,Oe));const $e=[c,...ze],xt=await _h(s,ue),He=[];let Ye=((v=C.flip)==null?void 0:v.overflows)||[];if(K&&He.push(xt[ve]),B){const Ae=KC(T,b,Oe);He.push(xt[Ae[0]],xt[Ae[1]])}if(Ye=[...Ye,{placement:T,overflows:He}],!He.every(Ae=>Ae<=0)){var Be,Me;const Ae=(((Be=C.flip)==null?void 0:Be.index)||0)+1,Ue=$e[Ae];if(Ue)return{data:{index:Ae,overflows:Ye},reset:{placement:Ue}};let et=(Me=Ye.filter(pt=>pt.overflows[0]<=0).sort((pt,ut)=>pt.overflows[1]-ut.overflows[1])[0])==null?void 0:Me.placement;if(!et)switch(oe){case"bestFit":{var De;const pt=(De=Ye.filter(ut=>{if(We){const ct=ra(ut.placement);return ct===pe||ct==="y"}return!0}).map(ut=>[ut.placement,ut.overflows.filter(ct=>ct>0).reduce((ct,at)=>ct+at,0)]).sort((ut,ct)=>ut[1]-ct[1])[0])==null?void 0:De[0];pt&&(et=pt);break}case"initialPlacement":et=c;break}if(T!==et)return{reset:{placement:et}}}return{}}}};function tb(h,s){return{top:h.top-s.height,right:h.right-s.width,bottom:h.bottom-s.height,left:h.left-s.width}}function ib(h){return WC.some(s=>h[s]>=0)}const nA=function(h){return h===void 0&&(h={}),{name:"hide",options:h,async fn(s){const{rects:g}=s,{strategy:v="referenceHidden",...T}=to(h,s);switch(v){case"referenceHidden":{const C=await _h(s,{...T,elementContext:"reference"}),b=tb(C,g.reference);return{data:{referenceHiddenOffsets:b,referenceHidden:ib(b)}}}case"escaped":{const C=await _h(s,{...T,altBoundary:!0}),b=tb(C,g.floating);return{data:{escapedOffsets:b,escaped:ib(b)}}}default:return{}}}}};async function rA(h,s){const{placement:g,platform:v,elements:T}=h,C=await(v.isRTL==null?void 0:v.isRTL(T.floating)),b=io(g),c=Wc(g),j=ra(g)==="y",U=["left","top"].includes(b)?-1:1,K=C&&j?-1:1,B=to(s,h);let{mainAxis:V,crossAxis:oe,alignmentAxis:ie}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return c&&typeof ie=="number"&&(oe=c==="end"?ie*-1:ie),j?{x:oe*K,y:V*U}:{x:V*U,y:oe*K}}const sA=function(h){return h===void 0&&(h=0),{name:"offset",options:h,async fn(s){var g,v;const{x:T,y:C,placement:b,middlewareData:c}=s,j=await rA(s,h);return b===((g=c.offset)==null?void 0:g.placement)&&(v=c.arrow)!=null&&v.alignmentOffset?{}:{x:T+j.x,y:C+j.y,data:{...j,placement:b}}}}},oA=function(h){return h===void 0&&(h={}),{name:"shift",options:h,async fn(s){const{x:g,y:v,placement:T}=s,{mainAxis:C=!0,crossAxis:b=!1,limiter:c={fn:ue=>{let{x:ve,y:pe}=ue;return{x:ve,y:pe}}},...j}=to(h,s),U={x:g,y:v},K=await _h(s,j),B=ra(io(T)),V=Pv(B);let oe=U[V],ie=U[B];if(C){const ue=V==="y"?"top":"left",ve=V==="y"?"bottom":"right",pe=oe+K[ue],Ie=oe-K[ve];oe=sv(pe,oe,Ie)}if(b){const ue=B==="y"?"top":"left",ve=B==="y"?"bottom":"right",pe=ie+K[ue],Ie=ie-K[ve];ie=sv(pe,ie,Ie)}const te=c.fn({...s,[V]:oe,[B]:ie});return{...te,data:{x:te.x-g,y:te.y-v,enabled:{[V]:C,[B]:b}}}}}},aA=function(h){return h===void 0&&(h={}),{options:h,fn(s){const{x:g,y:v,placement:T,rects:C,middlewareData:b}=s,{offset:c=0,mainAxis:j=!0,crossAxis:U=!0}=to(h,s),K={x:g,y:v},B=ra(T),V=Pv(B);let oe=K[V],ie=K[B];const te=to(c,s),ue=typeof te=="number"?{mainAxis:te,crossAxis:0}:{mainAxis:0,crossAxis:0,...te};if(j){const Ie=V==="y"?"height":"width",Oe=C.reference[V]-C.floating[Ie]+ue.mainAxis,ze=C.reference[V]+C.reference[Ie]-ue.mainAxis;oe<Oe?oe=Oe:oe>ze&&(oe=ze)}if(U){var ve,pe;const Ie=V==="y"?"width":"height",Oe=["top","left"].includes(io(T)),ze=C.reference[B]-C.floating[Ie]+(Oe&&((ve=b.offset)==null?void 0:ve[B])||0)+(Oe?0:ue.crossAxis),We=C.reference[B]+C.reference[Ie]+(Oe?0:((pe=b.offset)==null?void 0:pe[B])||0)-(Oe?ue.crossAxis:0);ie<ze?ie=ze:ie>We&&(ie=We)}return{[V]:oe,[B]:ie}}}},lA=function(h){return h===void 0&&(h={}),{name:"size",options:h,async fn(s){var g,v;const{placement:T,rects:C,platform:b,elements:c}=s,{apply:j=()=>{},...U}=to(h,s),K=await _h(s,U),B=io(T),V=Wc(T),oe=ra(T)==="y",{width:ie,height:te}=C.floating;let ue,ve;B==="top"||B==="bottom"?(ue=B,ve=V===(await(b.isRTL==null?void 0:b.isRTL(c.floating))?"start":"end")?"left":"right"):(ve=B,ue=V==="end"?"top":"bottom");const pe=te-K.top-K.bottom,Ie=ie-K.left-K.right,Oe=na(te-K[ue],pe),ze=na(ie-K[ve],Ie),We=!s.middlewareData.shift;let $e=Oe,xt=ze;if((g=s.middlewareData.shift)!=null&&g.enabled.x&&(xt=Ie),(v=s.middlewareData.shift)!=null&&v.enabled.y&&($e=pe),We&&!V){const Ye=Ur(K.left,0),Be=Ur(K.right,0),Me=Ur(K.top,0),De=Ur(K.bottom,0);oe?xt=ie-2*(Ye!==0||Be!==0?Ye+Be:Ur(K.left,K.right)):$e=te-2*(Me!==0||De!==0?Me+De:Ur(K.top,K.bottom))}await j({...s,availableWidth:xt,availableHeight:$e});const He=await b.getDimensions(c.floating);return ie!==He.width||te!==He.height?{reset:{rects:!0}}:{}}}};function cy(){return typeof window<"u"}function Hc(h){return h1(h)?(h.nodeName||"").toLowerCase():"#document"}function qr(h){var s;return(h==null||(s=h.ownerDocument)==null?void 0:s.defaultView)||window}function ks(h){var s;return(s=(h1(h)?h.ownerDocument:h.document)||window.document)==null?void 0:s.documentElement}function h1(h){return cy()?h instanceof Node||h instanceof qr(h).Node:!1}function ls(h){return cy()?h instanceof Element||h instanceof qr(h).Element:!1}function As(h){return cy()?h instanceof HTMLElement||h instanceof qr(h).HTMLElement:!1}function nb(h){return!cy()||typeof ShadowRoot>"u"?!1:h instanceof ShadowRoot||h instanceof qr(h).ShadowRoot}function Gp(h){const{overflow:s,overflowX:g,overflowY:v,display:T}=cs(h);return/auto|scroll|overlay|hidden|clip/.test(s+v+g)&&!["inline","contents"].includes(T)}function cA(h){return["table","td","th"].includes(Hc(h))}function uy(h){return[":popover-open",":modal"].some(s=>{try{return h.matches(s)}catch{return!1}})}function Av(h){const s=kv(),g=ls(h)?cs(h):h;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!s&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!s&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(v=>(g.willChange||"").includes(v))||["paint","layout","strict","content"].some(v=>(g.contain||"").includes(v))}function uA(h){let s=sa(h);for(;As(s)&&!Uc(s);){if(Av(s))return s;if(uy(s))return null;s=sa(s)}return null}function kv(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Uc(h){return["html","body","#document"].includes(Hc(h))}function cs(h){return qr(h).getComputedStyle(h)}function hy(h){return ls(h)?{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}:{scrollLeft:h.scrollX,scrollTop:h.scrollY}}function sa(h){if(Hc(h)==="html")return h;const s=h.assignedSlot||h.parentNode||nb(h)&&h.host||ks(h);return nb(s)?s.host:s}function d1(h){const s=sa(h);return Uc(s)?h.ownerDocument?h.ownerDocument.body:h.body:As(s)&&Gp(s)?s:d1(s)}function vh(h,s,g){var v;s===void 0&&(s=[]),g===void 0&&(g=!0);const T=d1(h),C=T===((v=h.ownerDocument)==null?void 0:v.body),b=qr(T);if(C){const c=av(b);return s.concat(b,b.visualViewport||[],Gp(T)?T:[],c&&g?vh(c):[])}return s.concat(T,vh(T,[],g))}function av(h){return h.parent&&Object.getPrototypeOf(h.parent)?h.frameElement:null}function p1(h){const s=cs(h);let g=parseFloat(s.width)||0,v=parseFloat(s.height)||0;const T=As(h),C=T?h.offsetWidth:g,b=T?h.offsetHeight:v,c=mm(g)!==C||mm(v)!==b;return c&&(g=C,v=b),{width:g,height:v,$:c}}function Ev(h){return ls(h)?h:h.contextElement}function Jl(h){const s=Ev(h);if(!As(s))return Cs(1);const g=s.getBoundingClientRect(),{width:v,height:T,$:C}=p1(s);let b=(C?mm(g.width):g.width)/v,c=(C?mm(g.height):g.height)/T;return(!b||!Number.isFinite(b))&&(b=1),(!c||!Number.isFinite(c))&&(c=1),{x:b,y:c}}const hA=Cs(0);function f1(h){const s=qr(h);return!kv()||!s.visualViewport?hA:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function dA(h,s,g){return s===void 0&&(s=!1),!g||s&&g!==qr(h)?!1:s}function Ka(h,s,g,v){s===void 0&&(s=!1),g===void 0&&(g=!1);const T=h.getBoundingClientRect(),C=Ev(h);let b=Cs(1);s&&(v?ls(v)&&(b=Jl(v)):b=Jl(h));const c=dA(C,g,v)?f1(C):Cs(0);let j=(T.left+c.x)/b.x,U=(T.top+c.y)/b.y,K=T.width/b.x,B=T.height/b.y;if(C){const V=qr(C),oe=v&&ls(v)?qr(v):v;let ie=V,te=av(ie);for(;te&&v&&oe!==ie;){const ue=Jl(te),ve=te.getBoundingClientRect(),pe=cs(te),Ie=ve.left+(te.clientLeft+parseFloat(pe.paddingLeft))*ue.x,Oe=ve.top+(te.clientTop+parseFloat(pe.paddingTop))*ue.y;j*=ue.x,U*=ue.y,K*=ue.x,B*=ue.y,j+=Ie,U+=Oe,ie=qr(te),te=av(ie)}}return ym({width:K,height:B,x:j,y:U})}function Mv(h,s){const g=hy(h).scrollLeft;return s?s.left+g:Ka(ks(h)).left+g}function m1(h,s,g){g===void 0&&(g=!1);const v=h.getBoundingClientRect(),T=v.left+s.scrollLeft-(g?0:Mv(h,v)),C=v.top+s.scrollTop;return{x:T,y:C}}function pA(h){let{elements:s,rect:g,offsetParent:v,strategy:T}=h;const C=T==="fixed",b=ks(v),c=s?uy(s.floating):!1;if(v===b||c&&C)return g;let j={scrollLeft:0,scrollTop:0},U=Cs(1);const K=Cs(0),B=As(v);if((B||!B&&!C)&&((Hc(v)!=="body"||Gp(b))&&(j=hy(v)),As(v))){const oe=Ka(v);U=Jl(v),K.x=oe.x+v.clientLeft,K.y=oe.y+v.clientTop}const V=b&&!B&&!C?m1(b,j,!0):Cs(0);return{width:g.width*U.x,height:g.height*U.y,x:g.x*U.x-j.scrollLeft*U.x+K.x+V.x,y:g.y*U.y-j.scrollTop*U.y+K.y+V.y}}function fA(h){return Array.from(h.getClientRects())}function mA(h){const s=ks(h),g=hy(h),v=h.ownerDocument.body,T=Ur(s.scrollWidth,s.clientWidth,v.scrollWidth,v.clientWidth),C=Ur(s.scrollHeight,s.clientHeight,v.scrollHeight,v.clientHeight);let b=-g.scrollLeft+Mv(h);const c=-g.scrollTop;return cs(v).direction==="rtl"&&(b+=Ur(s.clientWidth,v.clientWidth)-T),{width:T,height:C,x:b,y:c}}function gA(h,s){const g=qr(h),v=ks(h),T=g.visualViewport;let C=v.clientWidth,b=v.clientHeight,c=0,j=0;if(T){C=T.width,b=T.height;const U=kv();(!U||U&&s==="fixed")&&(c=T.offsetLeft,j=T.offsetTop)}return{width:C,height:b,x:c,y:j}}function yA(h,s){const g=Ka(h,!0,s==="fixed"),v=g.top+h.clientTop,T=g.left+h.clientLeft,C=As(h)?Jl(h):Cs(1),b=h.clientWidth*C.x,c=h.clientHeight*C.y,j=T*C.x,U=v*C.y;return{width:b,height:c,x:j,y:U}}function rb(h,s,g){let v;if(s==="viewport")v=gA(h,g);else if(s==="document")v=mA(ks(h));else if(ls(s))v=yA(s,g);else{const T=f1(h);v={x:s.x-T.x,y:s.y-T.y,width:s.width,height:s.height}}return ym(v)}function g1(h,s){const g=sa(h);return g===s||!ls(g)||Uc(g)?!1:cs(g).position==="fixed"||g1(g,s)}function _A(h,s){const g=s.get(h);if(g)return g;let v=vh(h,[],!1).filter(c=>ls(c)&&Hc(c)!=="body"),T=null;const C=cs(h).position==="fixed";let b=C?sa(h):h;for(;ls(b)&&!Uc(b);){const c=cs(b),j=Av(b);!j&&c.position==="fixed"&&(T=null),(C?!j&&!T:!j&&c.position==="static"&&!!T&&["absolute","fixed"].includes(T.position)||Gp(b)&&!j&&g1(h,b))?v=v.filter(K=>K!==b):T=c,b=sa(b)}return s.set(h,v),v}function vA(h){let{element:s,boundary:g,rootBoundary:v,strategy:T}=h;const b=[...g==="clippingAncestors"?uy(s)?[]:_A(s,this._c):[].concat(g),v],c=b[0],j=b.reduce((U,K)=>{const B=rb(s,K,T);return U.top=Ur(B.top,U.top),U.right=na(B.right,U.right),U.bottom=na(B.bottom,U.bottom),U.left=Ur(B.left,U.left),U},rb(s,c,T));return{width:j.right-j.left,height:j.bottom-j.top,x:j.left,y:j.top}}function xA(h){const{width:s,height:g}=p1(h);return{width:s,height:g}}function bA(h,s,g){const v=As(s),T=ks(s),C=g==="fixed",b=Ka(h,!0,C,s);let c={scrollLeft:0,scrollTop:0};const j=Cs(0);if(v||!v&&!C)if((Hc(s)!=="body"||Gp(T))&&(c=hy(s)),v){const V=Ka(s,!0,C,s);j.x=V.x+s.clientLeft,j.y=V.y+s.clientTop}else T&&(j.x=Mv(T));const U=T&&!v&&!C?m1(T,c):Cs(0),K=b.left+c.scrollLeft-j.x-U.x,B=b.top+c.scrollTop-j.y-U.y;return{x:K,y:B,width:b.width,height:b.height}}function N_(h){return cs(h).position==="static"}function sb(h,s){if(!As(h)||cs(h).position==="fixed")return null;if(s)return s(h);let g=h.offsetParent;return ks(h)===g&&(g=g.ownerDocument.body),g}function y1(h,s){const g=qr(h);if(uy(h))return g;if(!As(h)){let T=sa(h);for(;T&&!Uc(T);){if(ls(T)&&!N_(T))return T;T=sa(T)}return g}let v=sb(h,s);for(;v&&cA(v)&&N_(v);)v=sb(v,s);return v&&Uc(v)&&N_(v)&&!Av(v)?g:v||uA(h)||g}const wA=async function(h){const s=this.getOffsetParent||y1,g=this.getDimensions,v=await g(h.floating);return{reference:bA(h.reference,await s(h.floating),h.strategy),floating:{x:0,y:0,width:v.width,height:v.height}}};function SA(h){return cs(h).direction==="rtl"}const TA={convertOffsetParentRelativeRectToViewportRelativeRect:pA,getDocumentElement:ks,getClippingRect:vA,getOffsetParent:y1,getElementRects:wA,getClientRects:fA,getDimensions:xA,getScale:Jl,isElement:ls,isRTL:SA};function PA(h,s){let g=null,v;const T=ks(h);function C(){var c;clearTimeout(v),(c=g)==null||c.disconnect(),g=null}function b(c,j){c===void 0&&(c=!1),j===void 0&&(j=1),C();const{left:U,top:K,width:B,height:V}=h.getBoundingClientRect();if(c||s(),!B||!V)return;const oe=tm(K),ie=tm(T.clientWidth-(U+B)),te=tm(T.clientHeight-(K+V)),ue=tm(U),pe={rootMargin:-oe+"px "+-ie+"px "+-te+"px "+-ue+"px",threshold:Ur(0,na(1,j))||1};let Ie=!0;function Oe(ze){const We=ze[0].intersectionRatio;if(We!==j){if(!Ie)return b();We?b(!1,We):v=setTimeout(()=>{b(!1,1e-7)},1e3)}Ie=!1}try{g=new IntersectionObserver(Oe,{...pe,root:T.ownerDocument})}catch{g=new IntersectionObserver(Oe,pe)}g.observe(h)}return b(!0),C}function IA(h,s,g,v){v===void 0&&(v={});const{ancestorScroll:T=!0,ancestorResize:C=!0,elementResize:b=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:j=!1}=v,U=Ev(h),K=T||C?[...U?vh(U):[],...vh(s)]:[];K.forEach(ve=>{T&&ve.addEventListener("scroll",g,{passive:!0}),C&&ve.addEventListener("resize",g)});const B=U&&c?PA(U,g):null;let V=-1,oe=null;b&&(oe=new ResizeObserver(ve=>{let[pe]=ve;pe&&pe.target===U&&oe&&(oe.unobserve(s),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var Ie;(Ie=oe)==null||Ie.observe(s)})),g()}),U&&!j&&oe.observe(U),oe.observe(s));let ie,te=j?Ka(h):null;j&&ue();function ue(){const ve=Ka(h);te&&(ve.x!==te.x||ve.y!==te.y||ve.width!==te.width||ve.height!==te.height)&&g(),te=ve,ie=requestAnimationFrame(ue)}return g(),()=>{var ve;K.forEach(pe=>{T&&pe.removeEventListener("scroll",g),C&&pe.removeEventListener("resize",g)}),B==null||B(),(ve=oe)==null||ve.disconnect(),oe=null,j&&cancelAnimationFrame(ie)}}const CA=sA,AA=oA,kA=iA,EA=lA,MA=nA,zA=tA,DA=aA,LA=(h,s,g)=>{const v=new Map,T={platform:TA,...g},C={...T.platform,_c:v};return eA(h,s,{...T,platform:C})};function lh(h){return typeof h=="function"?h():h}function _1(h){return typeof window>"u"?1:(h.ownerDocument.defaultView||window).devicePixelRatio||1}function ob(h,s){const g=_1(h);return Math.round(s*g)/g}function ab(h){return{[`--bits-${h}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${h}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${h}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${h}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${h}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function RA(h){const s=h.whileElementsMounted,g=Te(()=>lh(h.open)??!0),v=Te(()=>lh(h.middleware)),T=Te(()=>lh(h.transform)??!0),C=Te(()=>lh(h.placement)??"bottom"),b=Te(()=>lh(h.strategy)??"absolute"),c=h.reference;let j=Qe(0),U=Qe(0);const K=Pe(null);let B=Qe(qe(L(b))),V=Qe(qe(L(C))),oe=Qe(qe({})),ie=Qe(!1);const te=Te(()=>{const ze={position:L(B),left:"0",top:"0"};if(!K.current)return ze;const We=ob(K.current,L(j)),$e=ob(K.current,L(U));return L(T)?{...ze,transform:`translate(${We}px, ${$e}px)`,..._1(K.current)>=1.5&&{willChange:"transform"}}:{position:L(B),left:`${We}px`,top:`${$e}px`}});let ue;function ve(){c.current===null||K.current===null||LA(c.current,K.current,{middleware:L(v),placement:L(C),strategy:L(b)}).then(ze=>{je(j,qe(ze.x)),je(U,qe(ze.y)),je(B,qe(ze.strategy)),je(V,qe(ze.placement)),je(oe,qe(ze.middlewareData)),je(ie,!0)})}function pe(){typeof ue=="function"&&(ue(),ue=void 0)}function Ie(){if(pe(),s===void 0){ve();return}c.current===null||K.current===null||(ue=s(c.current,K.current,ve))}function Oe(){L(g)||je(ie,!1)}return Ct(ve),Ct(Ie),Ct(Oe),Ct(()=>pe),{floating:K,reference:c,get strategy(){return L(B)},get placement(){return L(V)},get middlewareData(){return L(oe)},get isPositioned(){return L(ie)},get floatingStyles(){return L(te)},get update(){return ve}}}const OA={top:"bottom",right:"left",bottom:"top",left:"right"};class FA{constructor(){Ge(this,"anchorNode",Pe(null));Ge(this,"customAnchorNode",Pe(null));Ge(this,"triggerNode",Pe(null));Ct(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Jh,Yh,Qh,ed,fc,td,id,mc,ja,nd,rd,sd,od,ad,ld,$m,cd,Jm,ud,Ym,Qm,hd,dd,pd,fd,eg,tg,ig,ng,rg,sg,md,og,ag,lg,cg;class BA{constructor(s,g){Ge(this,"root");Ge(this,"contentRef",Pe(null));Ge(this,"wrapperRef",Pe(null));Ge(this,"arrowRef",Pe(null));Ge(this,"arrowId",Pe(hn()));Ge(this,"id");Ge(this,"wrapperId");Ge(this,"style");H(this,Jh,Te(()=>{if(typeof this.style=="string")return ph(this.style);if(!this.style)return{}}));H(this,Yh);H(this,Qh);H(this,ed);H(this,fc);H(this,td);H(this,id);H(this,mc);H(this,ja);H(this,nd);H(this,rd);H(this,sd);H(this,od);H(this,ad);Ge(this,"onPlaced");Ge(this,"enabled");H(this,ld,new WI(()=>this.arrowRef.current??void 0));H(this,$m,Te(()=>{var s;return((s=I(this,ld))==null?void 0:s.width)??0}));H(this,cd,Te(()=>{var s;return((s=I(this,ld))==null?void 0:s.height)??0}));H(this,Jm,Te(()=>{var s;return((s=I(this,Qh))==null?void 0:s.current)+(I(this,fc).current!=="center"?`-${I(this,fc).current}`:"")}));H(this,ud,Te(()=>Array.isArray(I(this,ja).current)?I(this,ja).current:[I(this,ja).current]));H(this,Ym,Te(()=>L(I(this,ud)).length>0));H(this,Qm,Te(()=>({padding:I(this,nd).current,boundary:L(I(this,ud)).filter(BI),altBoundary:this.hasExplicitBoundaries})));H(this,hd,Qe(void 0));H(this,dd,Qe(void 0));H(this,pd,Qe(void 0));H(this,fd,Qe(void 0));H(this,eg,Te(()=>[CA({mainAxis:I(this,ed).current+L(I(this,cd)),alignmentAxis:I(this,td).current}),I(this,mc)&&AA({mainAxis:!0,crossAxis:!1,limiter:I(this,rd).current==="partial"?DA():void 0,...this.detectOverflowOptions}),I(this,mc)&&kA({...this.detectOverflowOptions}),EA({...this.detectOverflowOptions,apply:({rects:s,availableWidth:g,availableHeight:v})=>{const{width:T,height:C}=s.reference;je(I(this,hd),qe(g)),je(I(this,dd),qe(v)),je(I(this,pd),qe(T)),je(I(this,fd),qe(C))}}),this.arrowRef.current&&zA({element:this.arrowRef.current,padding:I(this,id).current}),GA({arrowWidth:L(I(this,$m)),arrowHeight:L(I(this,cd))}),I(this,sd).current&&MA({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Ge(this,"floating");H(this,tg,Te(()=>WA(this.floating.placement)));H(this,ig,Te(()=>HA(this.floating.placement)));H(this,ng,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.x)??0}));H(this,rg,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.y)??0}));H(this,sg,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.centerOffset)!==0}));H(this,md,Qe());H(this,og,Te(()=>OA[this.placedSide]));H(this,ag,Te(()=>{var s,g,v;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(s=this.floating.middlewareData.transformOrigin)==null?void 0:s.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${L(I(this,hd))}px`,"--bits-floating-available-height":`${L(I(this,dd))}px`,"--bits-floating-anchor-width":`${L(I(this,pd))}px`,"--bits-floating-anchor-height":`${L(I(this,fd))}px`,...((v=this.floating.middlewareData.hide)==null?void 0:v.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...L(I(this,Jh))},dir:I(this,Yh).current}}));H(this,lg,Te(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:yv({...L(I(this,Jh))})})));H(this,cg,Te(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=s.id,Ve(this,Qh,s.side),Ve(this,ed,s.sideOffset),Ve(this,fc,s.align),Ve(this,td,s.alignOffset),Ve(this,id,s.arrowPadding),Ve(this,mc,s.avoidCollisions),Ve(this,ja,s.collisionBoundary),Ve(this,nd,s.collisionPadding),Ve(this,rd,s.sticky),Ve(this,sd,s.hideWhenDetached),Ve(this,ad,s.updatePositionStrategy),this.onPlaced=s.onPlaced,Ve(this,od,s.strategy),Ve(this,Yh,s.dir),this.style=s.style,this.root=g,this.enabled=s.enabled,this.wrapperId=s.wrapperId,s.customAnchor&&(this.root.customAnchorNode.current=s.customAnchor.current),Ct(()=>{s.customAnchor.current,Oi(()=>{this.root.customAnchorNode.current=s.customAnchor.current})}),rn({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),rn({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=RA({strategy:()=>I(this,od).current,placement:()=>L(I(this,Jm)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...v)=>{var C;return IA(...v,{animationFrame:((C=I(this,ad))==null?void 0:C.current)==="always"})},open:()=>this.enabled.current}),Ct(()=>{var v;this.floating.isPositioned&&((v=this.onPlaced)==null||v.current())}),Ct(()=>{const v=this.contentRef.current;v&&Oi(()=>{this.contentZIndex=window.getComputedStyle(v).zIndex})}),Ct(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return L(I(this,Ym))}get detectOverflowOptions(){return L(I(this,Qm))}get middleware(){return L(I(this,eg))}get placedSide(){return L(I(this,tg))}get placedAlign(){return L(I(this,ig))}get arrowX(){return L(I(this,ng))}get arrowY(){return L(I(this,rg))}get cannotCenterArrow(){return L(I(this,sg))}get contentZIndex(){return L(I(this,md))}set contentZIndex(s){je(I(this,md),qe(s))}get arrowBaseSide(){return L(I(this,og))}get wrapperProps(){return L(I(this,ag))}get props(){return L(I(this,lg))}get arrowStyle(){return L(I(this,cg))}}Jh=new WeakMap,Yh=new WeakMap,Qh=new WeakMap,ed=new WeakMap,fc=new WeakMap,td=new WeakMap,id=new WeakMap,mc=new WeakMap,ja=new WeakMap,nd=new WeakMap,rd=new WeakMap,sd=new WeakMap,od=new WeakMap,ad=new WeakMap,ld=new WeakMap,$m=new WeakMap,cd=new WeakMap,Jm=new WeakMap,ud=new WeakMap,Ym=new WeakMap,Qm=new WeakMap,hd=new WeakMap,dd=new WeakMap,pd=new WeakMap,fd=new WeakMap,eg=new WeakMap,tg=new WeakMap,ig=new WeakMap,ng=new WeakMap,rg=new WeakMap,sg=new WeakMap,md=new WeakMap,og=new WeakMap,ag=new WeakMap,lg=new WeakMap,cg=new WeakMap;class NA{constructor(s,g){Ge(this,"ref",Pe(null));s.virtualEl&&s.virtualEl.current?g.triggerNode=Pe.from(s.virtualEl.current):rn({id:s.id,ref:this.ref,onRefChange:v=>{g.triggerNode.current=v}})}}const[VA,v1]=$a("Floating.Root"),[jA,GD]=$a("Floating.Content");function UA(){return VA(new FA)}function qA(h){return jA(new BA(h,v1()))}function ZA(h){return new NA(h,v1())}function GA(h){return{name:"transformOrigin",options:h,fn(s){var ue,ve,pe;const{placement:g,rects:v,middlewareData:T}=s,b=((ue=T.arrow)==null?void 0:ue.centerOffset)!==0,c=b?0:h.arrowWidth,j=b?0:h.arrowHeight,[U,K]=zv(g),B={start:"0%",center:"50%",end:"100%"}[K],V=(((ve=T.arrow)==null?void 0:ve.x)??0)+c/2,oe=(((pe=T.arrow)==null?void 0:pe.y)??0)+j/2;let ie="",te="";return U==="bottom"?(ie=b?B:`${V}px`,te=`${-j}px`):U==="top"?(ie=b?B:`${V}px`,te=`${v.floating.height+j}px`):U==="right"?(ie=`${-j}px`,te=b?B:`${oe}px`):U==="left"&&(ie=`${v.floating.width+j}px`,te=b?B:`${oe}px`),{data:{x:ie,y:te}}}}}function zv(h){const[s,g="center"]=h.split("-");return[s,g]}function WA(h){return zv(h)[0]}function HA(h){return zv(h)[1]}function XA(h,s){Pt(s,!0),UA();var g=Xe(),v=Le(g);Ot(v,()=>s.children??ti),_e(h,g),It()}function KA(h,s){Pt(s,!0),ZA({id:Pe.with(()=>s.id),virtualEl:Pe.with(()=>s.virtualEl)});var g=Xe(),v=Le(g);Ot(v,()=>s.children??ti),_e(h,g),It()}var $A=Et("<div><!></div>");function JA(h,s){Pt(s,!0);let g=ee(s,"side",3,"bottom"),v=ee(s,"sideOffset",3,0),T=ee(s,"align",3,"center"),C=ee(s,"alignOffset",3,0),b=ee(s,"arrowPadding",3,0),c=ee(s,"avoidCollisions",3,!0),j=ee(s,"collisionBoundary",19,()=>[]),U=ee(s,"collisionPadding",3,0),K=ee(s,"hideWhenDetached",3,!1),B=ee(s,"onPlaced",3,()=>{}),V=ee(s,"sticky",3,"partial"),oe=ee(s,"updatePositionStrategy",3,"optimized"),ie=ee(s,"strategy",3,"fixed"),te=ee(s,"dir",3,"ltr"),ue=ee(s,"style",19,()=>({})),ve=ee(s,"wrapperId",19,hn),pe=ee(s,"customAnchor",3,null);const Ie=qA({side:Pe.with(()=>g()),sideOffset:Pe.with(()=>v()),align:Pe.with(()=>T()),alignOffset:Pe.with(()=>C()),id:Pe.with(()=>s.id),arrowPadding:Pe.with(()=>b()),avoidCollisions:Pe.with(()=>c()),collisionBoundary:Pe.with(()=>j()),collisionPadding:Pe.with(()=>U()),hideWhenDetached:Pe.with(()=>K()),onPlaced:Pe.with(()=>B()),sticky:Pe.with(()=>V()),updatePositionStrategy:Pe.with(()=>oe()),strategy:Pe.with(()=>ie()),dir:Pe.with(()=>te()),style:Pe.with(()=>ue()),enabled:Pe.with(()=>!1),wrapperId:Pe.with(()=>ve()),customAnchor:Pe.with(()=>pe())}),Oe=Te(()=>Vi(Ie.wrapperProps,{style:{pointerEvents:"auto"}}));var ze=$A();let We;var $e=qt(ze);Ot($e,()=>s.content??ti,()=>({props:Ie.props})),Vt(ze),zt(()=>We=ji(ze,We,{...L(Oe)})),_e(h,ze),It()}function YA(h,s){Pt(s,!0),Cb(()=>{var T;(T=s.onPlaced)==null||T.call(s)});var g=Xe(),v=Le(g);Ot(v,()=>s.content??ti,()=>({props:{}})),_e(h,g),It()}function QA(h,s){let g=ee(s,"isStatic",3,!1),v=Kt(s,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var T=Xe(),C=Le(T);{var b=j=>{YA(j,{get content(){return s.content},get onPlaced(){return s.onPlaced}})},c=j=>{JA(j,Gt({get content(){return s.content},get onPlaced(){return s.onPlaced}},()=>v))};fi(C,j=>{g()?j(b):j(c,!1)})}_e(h,T)}var ek=Et("<!> <!>",1);function x1(h,s){Pt(s,!0);let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),b=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);QA(h,{get isStatic(){return b()},get id(){return s.id},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},content:(U,K)=>{let B=()=>K==null?void 0:K().props;var V=ek(),oe=Le(V);{var ie=pe=>{fm(pe,{get preventScroll(){return s.preventScroll}})},te=pe=>{var Ie=Xe(),Oe=Le(Ie);{var ze=We=>{fm(We,{get preventScroll(){return s.preventScroll}})};fi(Oe,We=>{s.forceMount||We(ze)},!0)}_e(pe,Ie)};fi(oe,pe=>{s.forceMount&&s.enabled?pe(ie):pe(te,!1)})}var ue=Wt(oe,2),ve=Te(()=>s.enabled&&v());r1(ue,{get id(){return s.id},get onOpenAutoFocus(){return s.onOpenAutoFocus},get onCloseAutoFocus(){return s.onCloseAutoFocus},get loop(){return s.loop},get trapFocus(){return L(ve)},get forceMount(){return s.forceMount},focusScope:(Ie,Oe)=>{let ze=()=>Oe==null?void 0:Oe().props;i1(Ie,{get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get enabled(){return s.enabled},children:(We,$e)=>{t1(We,{get id(){return s.id},get onInteractOutside(){return s.onInteractOutside},get onFocusOutside(){return s.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return T()},get enabled(){return s.enabled},children:(He,Ye)=>{let Be=()=>Ye==null?void 0:Ye().props;o1(He,{get id(){return s.id},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get enabled(){return s.enabled},children:(Me,De)=>{var Ae=Xe(),Ue=Le(Ae),et=Up(()=>({props:Vi(c,B(),Be(),ze(),{style:{pointerEvents:"auto"}})}));Ot(Ue,()=>s.popper??ti,()=>L(et)),_e(Me,Ae)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),_e(U,V)},$$slots:{content:!0}}),It()}function tk(h,s){let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),b=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);wv(h,Gt({get id(){return s.id},get present(){return s.present}},()=>c,{presence:(U,K)=>{let B=()=>K==null?void 0:K().present;x1(U,Gt({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return b()},get enabled(){return B().current},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside},forceMount:!1},()=>c))},$$slots:{presence:!0}}))}function ik(h,s){let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),b=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);x1(h,Gt({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return b()},get enabled(){return s.enabled},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside}},()=>c,{forceMount:!0}))}function nk(h,s){let g=h.nextElementSibling;for(;g;){if(g.matches(s))return g;g=g.nextElementSibling}}function rk(h,s){let g=h.previousElementSibling;for(;g;){if(g.matches(s))return g;g=g.previousElementSibling}}const lb=1,sk=.9,ok=.8,ak=.17,V_=.1,j_=.999,lk=.9999,ck=.99,uk=/[\\/_+.#"@[({&]/,hk=/[\\/_+.#"@[({&]/g,dk=/[\s-]/,b1=/[\s-]/g;function lv(h,s,g,v,T,C,b){if(C===s.length)return T===h.length?lb:ck;const c=`${T},${C}`;if(b[c]!==void 0)return b[c];const j=v.charAt(C);let U=g.indexOf(j,T),K=0,B,V,oe,ie;for(;U>=0;)B=lv(h,s,g,v,U+1,C+1,b),B>K&&(U===T?B*=lb:uk.test(h.charAt(U-1))?(B*=ok,oe=h.slice(T,U-1).match(hk),oe&&T>0&&(B*=j_**oe.length)):dk.test(h.charAt(U-1))?(B*=sk,ie=h.slice(T,U-1).match(b1),ie&&T>0&&(B*=j_**ie.length)):(B*=ak,T>0&&(B*=j_**(U-T))),h.charAt(U)!==s.charAt(C)&&(B*=lk)),(B<V_&&g.charAt(U-1)===v.charAt(C+1)||v.charAt(C+1)===v.charAt(C)&&g.charAt(U-1)!==v.charAt(C))&&(V=lv(h,s,g,v,U+1,C+2,b),V*V_>B&&(B=V*V_)),B>K&&(K=B),U=g.indexOf(j,U+1);return b[c]=K,K}function cb(h){return h.toLowerCase().replace(b1," ")}function pk(h,s,g){return h=g&&g.length>0?`${`${h} ${g==null?void 0:g.join(" ")}`}`:h,lv(h,s,cb(h),cb(s),0,0,{})}function fk(h){if(!h)return null;for(const s of h.childNodes)if(s.nodeType!==Node.COMMENT_NODE)return s;return null}const mk="data-command-root",gk="data-command-list",yk="data-command-input",_k="data-command-empty",w1="data-command-group",S1="data-command-group-items",T1="data-command-group-heading",P1="data-command-item",Oa="data-value",vk="data-command-input-label",ch=`[${w1}]`,U_=`[${S1}]`,xk=`[${T1}]`,I1=`[${P1}]`,q_=`${I1}:not([aria-disabled="true"])`;function C1(h,s,g){return pk(h,s,g)}const[bk,Xc]=$a("Command.Root"),[wk,WD]=$a("Command.List"),[Sk,dy]=$a("Command.Group");var gd,yd,_d,vd,gc,xd,bd,wd,yc,_c,vc,Xo,Ko,ug,xc,bc,Sd,Td,Pd,Id,hg,dg;class Tk{constructor(s){Ge(this,"allItems",new Set);Ge(this,"allGroups",new Map);Ge(this,"allIds",new Map);Ge(this,"id");Ge(this,"ref");Ge(this,"filter");Ge(this,"shouldFilter");Ge(this,"loop");H(this,gd,Qe(0));H(this,yd,Qe(null));H(this,_d,Qe(null));H(this,vd,Qe(null));Ge(this,"valueProp");H(this,gc);Ge(this,"disablePointerSelection");H(this,xd,Qe(null));H(this,bd,Qe(null));Ge(this,"snapshot",()=>this._commandState);Ge(this,"setState",(s,g,v)=>{Object.is(this._commandState[s],g)||(this._commandState[s]=g,s==="search"?(I(this,vc).call(this),I(this,yc).call(this),I(this,_c).call(this)):s==="value"&&(v||I(this,ug).call(this)),this.emit())});Ge(this,"emit",()=>{this.commandState=kb(this._commandState)});H(this,wd,(s,g)=>{const v=this.filter.current??C1;return s?v(s,this._commandState.search,g):0});H(this,yc,()=>{var b;if(!this._commandState.search||this.shouldFilter.current===!1)return;const s=this._commandState.filtered.items,g=[];for(const c of this._commandState.filtered.groups){const j=this.allGroups.get(c);let U=0;if(!j){g.push([c,U]);continue}for(const K of j){const B=s.get(K);U=Math.max(B??0,U)}g.push([c,U])}const v=this.viewportNode,T=I(this,Xo).call(this).sort((c,j)=>{const U=c.getAttribute("id"),K=j.getAttribute("id"),B=s.get(U)??0;return(s.get(K)??0)-B});for(const c of T){const j=c.closest(U_);if(j){const U=c.parentElement===j?c:c.closest(`${U_} > *`);U&&j.appendChild(U)}else{const U=c.parentElement===v?c:c.closest(`${U_} > *`);U&&(v==null||v.appendChild(U))}}const C=g.sort((c,j)=>j[1]-c[1]);for(const c of C){const j=v==null?void 0:v.querySelector(`${ch}[${Oa}="${encodeURIComponent(c[0])}"]`);(b=j==null?void 0:j.parentElement)==null||b.appendChild(j)}});Ge(this,"setValue",(s,g)=>{s!==this.valueProp.current&&s===""&&jc(()=>{this.key++}),this.setState("value",s,g),this.valueProp.current=s});H(this,_c,()=>{jc(()=>{const s=I(this,Xo).call(this).find(v=>v.getAttribute("aria-disabled")!=="true"),g=s==null?void 0:s.getAttribute(Oa);this.setValue(g||"")})});H(this,vc,()=>{var g,v;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let s=0;for(const T of this.allItems){const C=((g=this.allIds.get(T))==null?void 0:g.value)??"",b=((v=this.allIds.get(T))==null?void 0:v.keywords)??[],c=I(this,wd).call(this,C,b);this._commandState.filtered.items.set(T,c),c>0&&s++}for(const[T,C]of this.allGroups)for(const b of C){const c=this._commandState.filtered.items.get(b);if(c&&c>0){this._commandState.filtered.groups.add(T);break}}this._commandState.filtered.count=s});H(this,Xo,()=>{const s=this.ref.current;return s?Array.from(s.querySelectorAll(q_)).filter(v=>!!v):[]});H(this,Ko,()=>{const s=this.ref.current;if(!s)return;const g=s.querySelector(`${q_}[aria-selected="true"]`);if(g)return g});H(this,ug,()=>{Zp(1,()=>{var T,C,b,c,j;const s=I(this,Ko).call(this);if(!s)return;const g=(T=s.parentElement)==null?void 0:T.parentElement;if(!g)return;const v=fk(g);if(v&&((C=v.dataset)==null?void 0:C.value)===((b=s.dataset)==null?void 0:b.value)){(j=(c=s==null?void 0:s.closest(ch))==null?void 0:c.querySelector(xk))==null||j.scrollIntoView({block:"nearest"});return}s.scrollIntoView({block:"nearest"})})});H(this,xc,s=>{const v=I(this,Xo).call(this)[s];v&&this.setValue(v.getAttribute(Oa)??"")});H(this,bc,s=>{const g=I(this,Ko).call(this),v=I(this,Xo).call(this),T=v.findIndex(b=>b===g);let C=v[T+s];this.loop.current&&(C=T+s<0?v[v.length-1]:T+s===v.length?v[0]:v[T+s]),C&&this.setValue(C.getAttribute(Oa)??"")});H(this,Sd,s=>{const g=I(this,Ko).call(this);let v=g==null?void 0:g.closest(ch),T;for(;v&&!T;)v=s>0?nk(v,ch):rk(v,ch),T=v==null?void 0:v.querySelector(q_);T?this.setValue(T.getAttribute(Oa)??""):I(this,bc).call(this,s)});Ge(this,"registerValue",(s,g,v)=>{var T;if(g!==((T=this.allIds.get(s))==null?void 0:T.value))return this.allIds.set(s,{value:g,keywords:v}),this._commandState.filtered.items.set(s,I(this,wd).call(this,g,v)),I(this,yc).call(this),this.emit(),()=>{this.allIds.delete(s)}});Ge(this,"registerItem",(s,g)=>(this.allItems.add(s),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(s):this.allGroups.set(g,new Set([s]))),I(this,vc).call(this),I(this,yc).call(this),this.commandState.value||I(this,_c).call(this),this.emit(),()=>{this.allIds.delete(s),this.allItems.delete(s),this.commandState.filtered.items.delete(s);const v=I(this,Ko).call(this);I(this,vc).call(this),(v==null?void 0:v.getAttribute("id"))===s&&I(this,_c).call(this),this.emit()}));Ge(this,"registerGroup",s=>(this.allGroups.has(s)||this.allGroups.set(s,new Set),()=>{this.allIds.delete(s),this.allGroups.delete(s)}));H(this,Td,()=>I(this,xc).call(this,I(this,Xo).call(this).length-1));H(this,Pd,s=>{s.preventDefault(),s.metaKey?I(this,Td).call(this):s.altKey?I(this,Sd).call(this,1):I(this,bc).call(this,1)});H(this,Id,s=>{s.preventDefault(),s.metaKey?I(this,xc).call(this,0):s.altKey?I(this,Sd).call(this,-1):I(this,bc).call(this,-1)});H(this,hg,s=>{switch(s.key){case DI:case LI:{I(this,gc).current&&s.ctrlKey&&I(this,Pd).call(this,s);break}case II:I(this,Pd).call(this,s);break;case zI:case RI:{I(this,gc).current&&s.ctrlKey&&I(this,Id).call(this,s);break}case CI:I(this,Id).call(this,s);break;case EI:s.preventDefault(),I(this,xc).call(this,0);break;case AI:s.preventDefault(),I(this,Td).call(this);break;case ly:if(!s.isComposing&&s.keyCode!==229){s.preventDefault();const g=I(this,Ko).call(this);g&&(g==null||g.click())}}});H(this,dg,Te(()=>({id:this.id.current,role:"application",[mk]:"",tabindex:-1,onkeydown:I(this,hg)})));this.id=s.id,this.ref=s.ref,this.filter=s.filter,this.shouldFilter=s.shouldFilter,this.loop=s.loop,this.valueProp=s.value,Ve(this,gc,s.vimBindings),this.disablePointerSelection=s.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,rn({id:this.id,ref:this.ref})}get key(){return L(I(this,gd))}set key(s){je(I(this,gd),qe(s))}get viewportNode(){return L(I(this,yd))}set viewportNode(s){je(I(this,yd),qe(s))}get inputNode(){return L(I(this,_d))}set inputNode(s){je(I(this,_d),qe(s))}get labelNode(){return L(I(this,vd))}set labelNode(s){je(I(this,vd),qe(s))}get commandState(){return L(I(this,xd))}set commandState(s){je(I(this,xd),s)}get _commandState(){return L(I(this,bd))}set _commandState(s){je(I(this,bd),qe(s))}get props(){return L(I(this,dg))}}gd=new WeakMap,yd=new WeakMap,_d=new WeakMap,vd=new WeakMap,gc=new WeakMap,xd=new WeakMap,bd=new WeakMap,wd=new WeakMap,yc=new WeakMap,_c=new WeakMap,vc=new WeakMap,Xo=new WeakMap,Ko=new WeakMap,ug=new WeakMap,xc=new WeakMap,bc=new WeakMap,Sd=new WeakMap,Td=new WeakMap,Pd=new WeakMap,Id=new WeakMap,hg=new WeakMap,dg=new WeakMap;var Cd,wc,Ad,kd,Ed,pg,fg;class Pk{constructor(s,g){H(this,Cd);H(this,wc);H(this,Ad);H(this,kd);H(this,Ed,!0);H(this,pg,Te(()=>I(this,Ad)._commandState.filtered.count===0&&I(this,Ed)===!1||I(this,kd).current));H(this,fg,Te(()=>({id:I(this,wc).current,role:"presentation",[_k]:""})));Ve(this,Cd,s.ref),Ve(this,wc,s.id),Ve(this,Ad,g),Ve(this,kd,s.forceMount),Ct(()=>{Ve(this,Ed,!1)}),rn({id:I(this,wc),ref:I(this,Cd),deps:()=>this.shouldRender})}get shouldRender(){return L(I(this,pg))}get props(){return L(I(this,fg))}}Cd=new WeakMap,wc=new WeakMap,Ad=new WeakMap,kd=new WeakMap,Ed=new WeakMap,pg=new WeakMap,fg=new WeakMap;var Ua,qa,os,Md,mg,zd,gg;class Ik{constructor(s,g){H(this,Ua);Ge(this,"id");Ge(this,"forceMount");H(this,qa);H(this,os);H(this,Md,Qe(null));H(this,mg,Te(()=>this.forceMount.current||I(this,os).shouldFilter.current===!1||!I(this,os).commandState.search?!0:I(this,os).commandState.filtered.groups.has(this.id.current)));H(this,zd,Qe(""));H(this,gg,Te(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[w1]:""})));Ve(this,Ua,s.ref),this.id=s.id,Ve(this,os,g),this.forceMount=s.forceMount,Ve(this,qa,s.value),this.trueValue=s.value.current,rn({id:this.id,ref:I(this,Ua),deps:()=>this.shouldRender}),Ct(()=>I(this,os).registerGroup(this.id.current)),Ct(()=>{var v;if(I(this,qa).current)return this.trueValue=I(this,qa).current,I(this,os).registerValue(this.id.current,I(this,qa).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue);if((v=I(this,Ua).current)!=null&&v.textContent)return this.trueValue=I(this,Ua).current.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue)})}get headingNode(){return L(I(this,Md))}set headingNode(s){je(I(this,Md),qe(s))}get shouldRender(){return L(I(this,mg))}get trueValue(){return L(I(this,zd))}set trueValue(s){je(I(this,zd),qe(s))}get props(){return L(I(this,gg))}createGroupHeading(s){return new A1(s,this)}createGroupItems(s){return new k1(s,this)}}Ua=new WeakMap,qa=new WeakMap,os=new WeakMap,Md=new WeakMap,mg=new WeakMap,zd=new WeakMap,gg=new WeakMap;var Dd,Sc,Ld,yg;class A1{constructor(s,g){H(this,Dd);H(this,Sc);H(this,Ld);H(this,yg,Te(()=>({id:I(this,Sc).current,[T1]:""})));Ve(this,Dd,s.ref),Ve(this,Sc,s.id),Ve(this,Ld,g),rn({id:I(this,Sc),ref:I(this,Dd),onRefChange:v=>{I(this,Ld).headingNode=v}})}get props(){return L(I(this,yg))}}Dd=new WeakMap,Sc=new WeakMap,Ld=new WeakMap,yg=new WeakMap;var Rd,Tc,Od,_g;class k1{constructor(s,g){H(this,Rd);H(this,Tc);H(this,Od);H(this,_g,Te(()=>{var s;return{id:I(this,Tc).current,role:"group",[S1]:"","aria-labelledby":((s=I(this,Od).headingNode)==null?void 0:s.id)??void 0}}));Ve(this,Rd,s.ref),Ve(this,Tc,s.id),Ve(this,Od,g),rn({id:I(this,Tc),ref:I(this,Rd)})}get props(){return L(I(this,_g))}}Rd=new WeakMap,Tc=new WeakMap,Od=new WeakMap,_g=new WeakMap;var Pc,Ic,Ss,$o,Fd,vg,xg;class Ck{constructor(s,g){H(this,Pc);H(this,Ic);H(this,Ss);H(this,$o);H(this,Fd);H(this,vg,Te(()=>{var g;const s=(g=I(this,Ss).viewportNode)==null?void 0:g.querySelector(`${I1}[${Oa}="${encodeURIComponent(I(this,$o).current)}"]`);if(s)return(s==null?void 0:s.getAttribute("id"))??void 0}));H(this,xg,Te(()=>{var s,g;return{id:I(this,Ic).current,type:"text",[yk]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":vv(!0),"aria-controls":((s=I(this,Ss).viewportNode)==null?void 0:s.id)??void 0,"aria-labelledby":((g=I(this,Ss).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":L(I(this,vg))}}));Ve(this,Pc,s.ref),Ve(this,Ic,s.id),Ve(this,Ss,g),Ve(this,$o,s.value),Ve(this,Fd,s.autofocus),rn({id:I(this,Ic),ref:I(this,Pc),onRefChange:v=>{I(this,Ss).inputNode=v}}),Ct(()=>{const v=I(this,Pc).current;Oi(()=>{v&&I(this,Fd).current&&Zp(10,()=>v.focus())})}),Ct(()=>{I(this,$o).current,Oi(()=>{I(this,Ss).commandState.search!==I(this,$o).current&&I(this,Ss).setState("search",I(this,$o).current)})})}get props(){return L(I(this,xg))}}Pc=new WeakMap,Ic=new WeakMap,Ss=new WeakMap,$o=new WeakMap,Fd=new WeakMap,vg=new WeakMap,xg=new WeakMap;var Cc,Bd,Ts,Nd,Ac,Za,bg,Vd,wg,Sg,Tg,jd,Pg,Ig,Cg;class Ak{constructor(s,g){H(this,Cc);Ge(this,"id");Ge(this,"root");H(this,Bd);H(this,Ts);H(this,Nd);H(this,Ac);H(this,Za,null);H(this,bg,Te(()=>{var s;return I(this,Ac).current||((s=I(this,Za))==null?void 0:s.forceMount.current)===!0}));H(this,Vd,Qe(""));H(this,wg,Te(()=>{if(L(I(this,bg))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const s=this.root.commandState.filtered.items.get(this.id.current);return s===void 0?!1:s>0}));H(this,Sg,Te(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));H(this,Tg,()=>{var s;I(this,Ts).current||(I(this,jd).call(this),(s=I(this,Nd))==null||s.current())});H(this,jd,()=>{I(this,Ts).current||this.root.setValue(this.trueValue,!0)});H(this,Pg,()=>{I(this,Ts).current||this.root.disablePointerSelection.current||I(this,jd).call(this)});H(this,Ig,()=>{I(this,Ts).current||I(this,Tg).call(this)});H(this,Cg,Te(()=>({id:this.id.current,"aria-disabled":wI(I(this,Ts).current),"aria-selected":TI(this.isSelected),"data-disabled":SI(I(this,Ts).current),"data-selected":PI(this.isSelected),[P1]:"",role:"option",onpointermove:I(this,Pg),onclick:I(this,Ig)})));Ve(this,Cc,s.ref),this.id=s.id,this.root=g,Ve(this,Bd,s.value),Ve(this,Ts,s.disabled),Ve(this,Nd,s.onSelect),Ve(this,Ac,s.forceMount),Ve(this,Za,dy(null)),this.trueValue=s.value.current,rn({id:this.id,ref:I(this,Cc),deps:()=>!!this.root.commandState.search}),Ct(()=>{var v;if(this.id.current,(v=I(this,Za))==null||v.id.current,!I(this,Ac).current)return Oi(()=>{var T;return this.root.registerItem(this.id.current,(T=I(this,Za))==null?void 0:T.id.current)})}),Ct(()=>{const v=I(this,Bd).current,T=I(this,Cc).current;T&&(!v&&T.textContent&&(this.trueValue=T.textContent.trim()),Oi(()=>{this.root.registerValue(this.id.current,this.trueValue,s.keywords.current.map(C=>C.trim())),T.setAttribute(Oa,this.trueValue)}))})}get trueValue(){return L(I(this,Vd))}set trueValue(s){je(I(this,Vd),qe(s))}get shouldRender(){return L(I(this,wg))}get isSelected(){return L(I(this,Sg))}get props(){return L(I(this,Cg))}}Cc=new WeakMap,Bd=new WeakMap,Ts=new WeakMap,Nd=new WeakMap,Ac=new WeakMap,Za=new WeakMap,bg=new WeakMap,Vd=new WeakMap,wg=new WeakMap,Sg=new WeakMap,Tg=new WeakMap,jd=new WeakMap,Pg=new WeakMap,Ig=new WeakMap,Cg=new WeakMap;var kc,Ud,Ag;class kk{constructor(s,g){Ge(this,"ref");H(this,kc);H(this,Ud);Ge(this,"root");H(this,Ag,Te(()=>({id:I(this,kc).current,role:"listbox","aria-label":I(this,Ud).current,[gk]:""})));this.ref=s.ref,Ve(this,kc,s.id),this.root=g,Ve(this,Ud,s.ariaLabel),rn({id:I(this,kc),ref:this.ref})}get props(){return L(I(this,Ag))}}kc=new WeakMap,Ud=new WeakMap,Ag=new WeakMap;var qd,Ec,Zd,Gd,kg;class Ek{constructor(s,g){H(this,qd);H(this,Ec);H(this,Zd);H(this,Gd);H(this,kg,Te(()=>{var s;return{id:I(this,Ec).current,[vk]:"",for:(s=I(this,Gd))==null?void 0:s.current,style:$b}}));Ve(this,qd,s.ref),Ve(this,Ec,s.id),Ve(this,Zd,g),Ve(this,Gd,s.for),rn({id:I(this,Ec),ref:I(this,qd),onRefChange:v=>{I(this,Zd).labelNode=v}})}get props(){return L(I(this,kg))}}qd=new WeakMap,Ec=new WeakMap,Zd=new WeakMap,Gd=new WeakMap,kg=new WeakMap;function Mk(h){return bk(new Tk(h))}function zk(h){const s=Xc();return new Pk(h,s)}function Dk(h){const s=Xc();return new Ak(h,s)}function Lk(h){const s=Xc();return Sk(new Ik(h,s))}function Rk(h){const s=dy();return new A1(h,s)}function Ok(h){const s=dy();return new k1(h,s)}function Fk(h){const s=Xc();return new Ck(h,s)}function Bk(h){const s=Xc();return wk(new kk(h,s))}function Nk(h){const s=Xc();return new Ek(h,s)}var Vk=Et("<label><!></label>");function jk(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=Nk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),K=>v(K))}),b=Te(()=>Vi(T,C.props));var c=Vk();let j;var U=qt(c);Ot(U,()=>s.children??ti),Vt(c),zt(()=>j=ji(c,j,{...L(b)})),_e(h,c),It()}var Uk=Et("<!> <!>",1),qk=Et("<div><!> <!></div>");function Zk(h,s){Pt(s,!0);const g=ze=>{jk(ze,{children:(We,$e)=>{ia();var xt=On();zt(()=>Ri(xt,K())),_e(We,xt)},$$slots:{default:!0}})};let v=ee(s,"id",19,hn),T=ee(s,"ref",15,null),C=ee(s,"value",15,""),b=ee(s,"onValueChange",3,nn),c=ee(s,"loop",3,!1),j=ee(s,"shouldFilter",3,!0),U=ee(s,"filter",3,C1),K=ee(s,"label",3,""),B=ee(s,"vimBindings",3,!0),V=ee(s,"disablePointerSelection",3,!1),oe=ee(s,"controlledValue",3,!1),ie=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const te=Mk({id:Pe.with(()=>v()),ref:Pe.with(()=>T(),ze=>T(ze)),filter:Pe.with(()=>U()),shouldFilter:Pe.with(()=>j()),loop:Pe.with(()=>c()),value:Pe.with(()=>C(),ze=>{oe()||C(ze),b()(ze)}),vimBindings:Pe.with(()=>B()),disablePointerSelection:Pe.with(()=>V())}),ue=Te(()=>Vi(ie,te.props));var ve=Xe(),pe=Le(ve);{var Ie=ze=>{var We=Uk(),$e=Le(We);g($e);var xt=Wt($e,2);Ot(xt,()=>s.child,()=>({props:L(ue)})),_e(ze,We)},Oe=ze=>{var We=qk();let $e;var xt=qt(We);g(xt);var He=Wt(xt,2);Ot(He,()=>s.children??ti),Vt(We),zt(()=>$e=ji(We,$e,{...L(ue)})),_e(ze,We)};fi(pe,ze=>{s.child?ze(Ie):ze(Oe,!1)})}_e(h,ve),It()}var Gk=Et("<div><!></div>");function Wk(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"forceMount",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const b=zk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B)),forceMount:Pe.with(()=>T())}),c=Te(()=>Vi(b.props,C));var j=Xe(),U=Le(j);{var K=B=>{var V=Xe(),oe=Le(V);{var ie=ue=>{var ve=Xe(),pe=Le(ve);Ot(pe,()=>s.child,()=>({props:L(c)})),_e(ue,ve)},te=ue=>{var ve=Gk();let pe;var Ie=qt(ve);Ot(Ie,()=>s.children??ti),Vt(ve),zt(()=>pe=ji(ve,pe,{...L(c)})),_e(ue,ve)};fi(oe,ue=>{s.child?ue(ie):ue(te,!1)})}_e(B,V)};fi(U,B=>{b.shouldRender&&B(K)})}_e(h,j),It()}var Hk=Et("<div><!></div>");function Xk(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"value",3,""),C=ee(s,"forceMount",3,!1),b=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const c=Lk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),oe=>v(oe)),forceMount:Pe.with(()=>C()),value:Pe.with(()=>T())}),j=Te(()=>Vi(b,c.props));var U=Xe(),K=Le(U);{var B=oe=>{var ie=Xe(),te=Le(ie);Ot(te,()=>s.child,()=>({props:L(j)})),_e(oe,ie)},V=oe=>{var ie=Hk();let te;var ue=qt(ie);Ot(ue,()=>s.children??ti),Vt(ie),zt(()=>te=ji(ie,te,{...L(j)})),_e(oe,ie)};fi(K,oe=>{s.child?oe(B):oe(V,!1)})}_e(h,U),It()}var Kk=Et("<div><!></div>");function $k(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=Rk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var c=Xe(),j=Le(c);{var U=B=>{var V=Xe(),oe=Le(V);Ot(oe,()=>s.child,()=>({props:L(b)})),_e(B,V)},K=B=>{var V=Kk();let oe;var ie=qt(V);Ot(ie,()=>s.children??ti),Vt(V),zt(()=>oe=ji(V,oe,{...L(b)})),_e(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}_e(h,c),It()}var Jk=Et("<div><!></div>"),Yk=Et('<div style="display: contents;"><!></div>');function Qk(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=Ok({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var c=Yk(),j=qt(c);{var U=B=>{var V=Xe(),oe=Le(V);Ot(oe,()=>s.child,()=>({props:L(b)})),_e(B,V)},K=B=>{var V=Jk();let oe;var ie=qt(V);Ot(ie,()=>s.children??ti),Vt(V),zt(()=>oe=ji(V,oe,{...L(b)})),_e(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}Vt(c),_e(h,c),It()}var eE=Et("<input>");function tE(h,s){Pt(s,!0);let g=ee(s,"value",15,""),v=ee(s,"autofocus",3,!1),T=ee(s,"id",19,hn),C=ee(s,"ref",15,null),b=Kt(s,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const c=Fk({id:Pe.with(()=>T()),ref:Pe.with(()=>C(),oe=>C(oe)),value:Pe.with(()=>g(),oe=>{g(oe)}),autofocus:Pe.with(()=>v()??!1)}),j=Te(()=>Vi(b,c.props));var U=Xe(),K=Le(U);{var B=oe=>{var ie=Xe(),te=Le(ie);Ot(te,()=>s.child,()=>({props:L(j)})),_e(oe,ie)},V=oe=>{var ie=eE();_S(ie);let te;zt(()=>te=ji(ie,te,{...L(j)})),PS(ie,g),_e(oe,ie)};fi(K,oe=>{s.child?oe(B):oe(V,!1)})}_e(h,U),It()}var iE=Et("<div><!></div>"),nE=Et('<div style="display: contents;" data-item-wrapper=""><!></div>');function rE(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"value",3,""),C=ee(s,"disabled",3,!1),b=ee(s,"onSelect",3,nn),c=ee(s,"forceMount",3,!1),j=ee(s,"keywords",19,()=>[]),U=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=dy(null),B=Dk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),te=>v(te)),value:Pe.with(()=>T()),disabled:Pe.with(()=>C()),onSelect:Pe.with(()=>b()),forceMount:Pe.with(()=>c()),keywords:Pe.with(()=>j()),group:K}),V=Te(()=>Vi(U,B.props));var oe=Xe(),ie=Le(oe);Ab(ie,()=>B.root.key,te=>{var ue=nE(),ve=qt(ue);{var pe=Ie=>{var Oe=Xe(),ze=Le(Oe);{var We=xt=>{var He=Xe(),Ye=Le(He);Ot(Ye,()=>s.child,()=>({props:L(V)})),_e(xt,He)},$e=xt=>{var He=iE();let Ye;var Be=qt(He);Ot(Be,()=>s.children??ti),Vt(He),zt(()=>Ye=ji(He,Ye,{...L(V)})),_e(xt,He)};fi(ze,xt=>{s.child?xt(We):xt($e,!1)})}_e(Ie,Oe)};fi(ve,Ie=>{B.shouldRender&&Ie(pe)})}Vt(ue),zt(()=>mh(ue,"data-value",T())),_e(te,ue)}),_e(h,oe),It()}var sE=Et("<div><!></div>");function oE(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const C=Bk({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B)),ariaLabel:Pe.with(()=>s["aria-label"]??"Suggestions...")}),b=Te(()=>Vi(T,C.props));var c=Xe(),j=Le(c);{var U=B=>{var V=Xe(),oe=Le(V);Ot(oe,()=>s.child,()=>({props:L(b)})),_e(B,V)},K=B=>{var V=sE();let oe;var ie=qt(V);Ot(ie,()=>s.children??ti),Vt(V),zt(()=>oe=ji(V,oe,{...L(b)})),_e(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}_e(h,c),It()}var Wd,Hd,Xd;class aE{constructor(s){Ge(this,"open");H(this,Wd,Qe(null));H(this,Hd,Qe(void 0));H(this,Xd,Qe(null));Ge(this,"toggleOpen",()=>{this.open.current=!this.open.current});Ge(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=s.open}get contentNode(){return L(I(this,Wd))}set contentNode(s){je(I(this,Wd),qe(s))}get contentId(){return L(I(this,Hd))}set contentId(s){je(I(this,Hd),qe(s))}get triggerNode(){return L(I(this,Xd))}set triggerNode(s){je(I(this,Xd),qe(s))}}Wd=new WeakMap,Hd=new WeakMap,Xd=new WeakMap;var Mc,Kd,Jo,Vr,Eg,Mg,zg,Dg,Lg;class lE{constructor(s,g){H(this,Mc);H(this,Kd);H(this,Jo);H(this,Vr);H(this,Eg,s=>{if(!I(this,Jo).current){if(s.pointerType==="touch"||s.button!==0)return s.preventDefault();I(this,Vr).toggleOpen()}});H(this,Mg,s=>{I(this,Jo).current||s.pointerType==="touch"&&(s.preventDefault(),I(this,Vr).toggleOpen())});H(this,zg,s=>{I(this,Jo).current||(s.key===ly||s.key===xv)&&(s.preventDefault(),I(this,Vr).toggleOpen())});H(this,Dg,()=>{if(I(this,Vr).open.current&&I(this,Vr).contentId)return I(this,Vr).contentId});H(this,Lg,Te(()=>({id:I(this,Mc).current,"aria-haspopup":"dialog","aria-expanded":vv(I(this,Vr).open.current),"data-state":_v(I(this,Vr).open.current),"aria-controls":I(this,Dg).call(this),"data-popover-trigger":"",disabled:I(this,Jo).current,onpointerdown:I(this,Eg),onkeydown:I(this,zg),onpointerup:I(this,Mg)})));Ve(this,Mc,s.id),Ve(this,Vr,g),Ve(this,Kd,s.ref),Ve(this,Jo,s.disabled),rn({id:I(this,Mc),ref:I(this,Kd),onRefChange:v=>{I(this,Vr).triggerNode=v}})}get props(){return L(I(this,Lg))}}Mc=new WeakMap,Kd=new WeakMap,Jo=new WeakMap,Vr=new WeakMap,Eg=new WeakMap,Mg=new WeakMap,zg=new WeakMap,Dg=new WeakMap,Lg=new WeakMap;var zc,$d,Rg,Og;class cE{constructor(s,g){H(this,zc);H(this,$d);Ge(this,"root");H(this,Rg,Te(()=>({open:this.root.open.current})));H(this,Og,Te(()=>({id:I(this,zc).current,tabindex:-1,"data-state":_v(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));Ve(this,zc,s.id),this.root=g,Ve(this,$d,s.ref),rn({id:I(this,zc),ref:I(this,$d),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,Rg))}get props(){return L(I(this,Og))}}zc=new WeakMap,$d=new WeakMap,Rg=new WeakMap,Og=new WeakMap;const[uE,E1]=$a("Popover.Root");function hE(h){return uE(new aE(h))}function dE(h){return new lE(h,E1())}function pE(h){return new cE(h,E1())}var fE=Et("<div><!></div>"),mE=Et("<div><!></div>");function gE(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"id",19,hn),T=ee(s,"forceMount",3,!1),C=ee(s,"onCloseAutoFocus",3,nn),b=ee(s,"onEscapeKeydown",3,nn),c=ee(s,"onInteractOutside",3,nn),j=ee(s,"trapFocus",3,!0),U=ee(s,"preventScroll",3,!1),K=Kt(s,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const B=pE({id:Pe.with(()=>v()),ref:Pe.with(()=>g(),Oe=>g(Oe))}),V=Te(()=>Vi(K,B.props));function oe(Oe){c()(Oe),!Oe.defaultPrevented&&B.root.close()}function ie(Oe){b()(Oe),!Oe.defaultPrevented&&B.root.close()}function te(Oe){var ze;C()(Oe),!Oe.defaultPrevented&&(Oe.preventDefault(),(ze=B.root.triggerNode)==null||ze.focus())}var ue=Xe(),ve=Le(ue);{var pe=Oe=>{ik(Oe,Gt(()=>L(V),{get enabled(){return B.root.open.current},get id(){return v()},onInteractOutside:oe,onEscapeKeydown:ie,onCloseAutoFocus:te,get trapFocus(){return j()},get preventScroll(){return U()},loop:!0,forceMount:!0,popper:(We,$e)=>{let xt=()=>$e==null?void 0:$e().props;var He=Xe();const Ye=Te(()=>Vi(xt(),{style:ab("popover")}));var Be=Le(He);{var Me=Ae=>{var Ue=Xe(),et=Le(Ue);Ot(et,()=>s.child,()=>({props:L(Ye),...B.snippetProps})),_e(Ae,Ue)},De=Ae=>{var Ue=fE();let et;var pt=qt(Ue);Ot(pt,()=>s.children??ti),Vt(Ue),zt(()=>et=ji(Ue,et,{...L(Ye)})),_e(Ae,Ue)};fi(Be,Ae=>{s.child?Ae(Me):Ae(De,!1)})}_e(We,He)},$$slots:{popper:!0}}))},Ie=Oe=>{var ze=Xe(),We=Le(ze);{var $e=xt=>{tk(xt,Gt(()=>L(V),{get present(){return B.root.open.current},get id(){return v()},onInteractOutside:oe,onEscapeKeydown:ie,onCloseAutoFocus:te,get trapFocus(){return j()},get preventScroll(){return U()},loop:!0,forceMount:!1,popper:(Ye,Be)=>{let Me=()=>Be==null?void 0:Be().props;var De=Xe();const Ae=Te(()=>Vi(Me(),{style:ab("popover")}));var Ue=Le(De);{var et=ut=>{var ct=Xe(),at=Le(ct);Ot(at,()=>s.child,()=>({props:L(Ae),...B.snippetProps})),_e(ut,ct)},pt=ut=>{var ct=mE();let at;var Mt=qt(ct);Ot(Mt,()=>s.children??ti),Vt(ct),zt(()=>at=ji(ct,at,{...L(Ae)})),_e(ut,ct)};fi(Ue,ut=>{s.child?ut(et):ut(pt,!1)})}_e(Ye,De)},$$slots:{popper:!0}}))};fi(We,xt=>{T()||xt($e)},!0)}_e(Oe,ze)};fi(ve,Oe=>{T()?Oe(pe):Oe(Ie,!1)})}_e(h,ue),It()}var yE=Et("<button><!></button>");function _E(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"type",3,"button"),C=ee(s,"disabled",3,!1),b=Kt(s,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const c=dE({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),V=>v(V)),disabled:Pe.with(()=>!!C())}),j=Te(()=>Vi(b,c.props,{type:T()})),U=la(),[K,B]=U;KA(h,{get id(){return g()},children:(V,oe)=>{var ie=Xe(),te=Le(ie);{var ue=pe=>{var Ie=Xe(),Oe=Le(Ie);Ot(Oe,()=>s.child,()=>({props:L(j)})),_e(pe,Ie)},ve=pe=>{var Ie=yE();const Oe=Te(()=>B({...L(j)},[{attribute_name:"formaction"}]));let ze;var We=qt(Ie);Ot(We,()=>s.children??ti),Vt(Ie),zt(()=>ze=ji(Ie,ze,{...L(Oe)})),_e(pe,Ie)};fi(te,pe=>{s.child?pe(ue):pe(ve,!1)})}_e(V,ie)},$$slots:{default:!0}}),It()}function M1(h,s){Pt(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,nn),T=ee(s,"controlledOpen",3,!1);sC({variant:Pe.with(()=>"dialog"),open:Pe.with(()=>g(),c=>{T()||g(c),v()(c)})});var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),_e(h,C),It()}var vE=Et("<button><!></button>");function xE(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"disabled",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const b=hC({variant:Pe.with(()=>"close"),id:Pe.with(()=>g()),ref:Pe.with(()=>v(),te=>v(te)),disabled:Pe.with(()=>!!T())}),c=Te(()=>Vi(C,b.props)),j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var oe=te=>{var ue=Xe(),ve=Le(ue);Ot(ve,()=>s.child,()=>({props:L(c)})),_e(te,ue)},ie=te=>{var ue=vE();const ve=Te(()=>K({...L(c)},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ue);Ot(Ie,()=>s.children??ti),Vt(ue),zt(()=>pe=ji(ue,pe,{...L(ve)})),_e(te,ue)};fi(V,te=>{s.child?te(oe):te(ie,!1)})}_e(h,B),It()}var bE=Et("<!> <!>",1),wE=Et("<!> <div><!></div>",1);function z1(h,s){Pt(s,!0);let g=ee(s,"id",19,hn),v=ee(s,"ref",15,null),T=ee(s,"forceMount",3,!1),C=ee(s,"onCloseAutoFocus",3,nn),b=ee(s,"onEscapeKeydown",3,nn),c=ee(s,"onInteractOutside",3,nn),j=ee(s,"trapFocus",3,!0),U=ee(s,"preventScroll",3,!0),K=ee(s,"restoreScrollDelay",3,null),B=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const V=lC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),te=>v(te))}),oe=Te(()=>Vi(B,V.props));var ie=Te(()=>V.root.open.current||T());wv(h,Gt(()=>L(oe),{get forceMount(){return T()},get present(){return L(ie)},presence:(ue,ve)=>{let pe=()=>ve==null?void 0:ve().present;var Ie=Te(()=>jC({forceMount:T(),present:pe().current,trapFocus:j(),open:V.root.open.current}));r1(ue,Gt({loop:!0,get trapFocus(){return L(Ie)}},()=>L(oe),{onCloseAutoFocus:ze=>{var We;C()(ze),!ze.defaultPrevented&&((We=V.root.triggerNode)==null||We.focus())},focusScope:(ze,We)=>{let $e=()=>We==null?void 0:We().props;i1(ze,Gt(()=>L(oe),{get enabled(){return pe().current},onEscapeKeydown:xt=>{b()(xt),!xt.defaultPrevented&&V.root.handleClose()},children:(xt,He)=>{t1(xt,Gt(()=>L(oe),{get enabled(){return pe().current},onInteractOutside:Ye=>{c()(Ye),!Ye.defaultPrevented&&V.root.handleClose()},children:(Ye,Be)=>{o1(Ye,Gt(()=>L(oe),{get enabled(){return pe().current},children:(Me,De)=>{var Ae=Xe(),Ue=Le(Ae);{var et=ut=>{var ct=bE(),at=Le(ct);{var Mt=Pi=>{fm(Pi,{get preventScroll(){return U()},get restoreScrollDelay(){return K()}})};fi(at,Pi=>{V.root.open.current&&Pi(Mt)})}var Yt=Wt(at,2),yi=Up(()=>({props:Vi(L(oe),$e()),...V.snippetProps}));Ot(Yt,()=>s.child,()=>L(yi)),_e(ut,ct)},pt=ut=>{var ct=wE(),at=Le(ct);fm(at,{get preventScroll(){return U()}});var Mt=Wt(at,2);const Yt=Te(()=>Vi(L(oe),$e()));let yi;var Pi=qt(Mt);Ot(Pi,()=>s.children??ti),Vt(Mt),zt(()=>yi=ji(Mt,yi,{...L(Yt)})),_e(ut,ct)};fi(Ue,ut=>{s.child?ut(et):ut(pt,!1)})}_e(Me,Ae)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),It()}function SE(h,s){Pt(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,nn),T=ee(s,"controlledOpen",3,!1);hE({open:Pe.with(()=>g(),C=>{T()||g(C),v()(C)})}),XA(h,{children:(C,b)=>{var c=Xe(),j=Le(c);Ot(j,()=>s.children??ti),_e(C,c)},$$slots:{default:!0}}),It()}/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var PE=W2("<svg><!><!></svg>");function rr(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]),v=yn(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Pt(s,!1);let T=ee(s,"name",8,void 0),C=ee(s,"color",8,"currentColor"),b=ee(s,"size",8,24),c=ee(s,"strokeWidth",8,2),j=ee(s,"absoluteStrokeWidth",8,!1),U=ee(s,"iconNode",24,()=>[]);const K=(...pe)=>pe.filter((Ie,Oe,ze)=>!!Ie&&ze.indexOf(Ie)===Oe).join(" "),B=la(),[V,oe]=B;fv();var ie=PE();let te;var ue=qt(ie);Hl(ue,1,U,Xl,(pe,Ie)=>{let Oe=()=>L(Ie)[0],ze=()=>L(Ie)[1];var We=Xe(),$e=Le(We);const xt=Up(()=>`${Oe()}`=="button"?oe({...ze()},[{attribute_name:"formaction"}]):`${Oe()}`=="form"?oe({...ze()},[{attribute_name:"action"}]):`${Oe()}`=="a"?oe({...ze()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...ze()});Eb($e,Oe,!0,(He,Ye)=>{let Be;zt(()=>Be=ji(He,Be,{...L(xt)},void 0,He.namespaceURI===dv,He.nodeName.includes("-")))}),_e(pe,We)});var ve=Wt(ue);Hn(ve,s,"default",{}),Vt(ie),zt(()=>te=ji(ie,te,{...TE,...v,width:b(),height:b(),stroke:C(),"stroke-width":j()?Number(c())*24/Number(b()):c(),class:K("lucide-icon","lucide",T()?`lucide-${T()}`:"",g.class)},void 0,!0)),_e(h,ie),It()}function IE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"x"},()=>g,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}var CE=Et('<!> <span class="sr-only">Close</span>',1),AE=Et("<!> <!>",1),kE=Et("<!> <!>",1);function EE(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=Xe(),C=Le(T);si(C,()=>BE,(b,c)=>{c(b,Gt(()=>s.portalProps,{children:(j,U)=>{var K=kE(),B=Le(K);si(B,()=>LE,(ie,te)=>{te(ie,{})});var V=Wt(B,2),oe=Te(()=>Ni("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s.class));si(V,()=>z1,(ie,te)=>{te(ie,Gt({get ref(){return g()},set ref(ue){g(ue)},get class(){return L(oe)}},()=>v,{children:(ue,ve)=>{var pe=AE(),Ie=Le(pe);Ot(Ie,()=>s.children??ti);var Oe=Wt(Ie,2);si(Oe,()=>xE,(ze,We)=>{We(ze,{class:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:($e,xt)=>{var He=CE(),Ye=Le(He);IE(Ye,{class:"size-4"}),ia(2),_e($e,He)},$$slots:{default:!0}})}),_e(ue,pe)},$$slots:{default:!0}}))}),_e(j,K)},$$slots:{default:!0}}))}),_e(h,T),It()}function ME(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-sm text-muted-foreground",s.class));si(C,()=>c1,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}var zE=Et("<div><!></div>");function DE(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=zE();let C;var b=qt(T);Ot(b,()=>s.children??ti),Vt(T),Vc(T,c=>g(c),()=>g()),zt(()=>C=ji(T,C,{class:Ni("flex flex-col space-y-1.5 text-center sm:text-left",s.class),...v})),_e(h,T),It()}function LE(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s.class));si(C,()=>l1,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}function RE(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-lg font-semibold leading-none tracking-tight",s.class));si(C,()=>Jb,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}const OE=M1,FE=ZC,BE=Sv;function NE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"box"},()=>g,{iconNode:[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"}],["path",{d:"m3.3 7 8.7 5 8.7-5"}],["path",{d:"M12 22V12"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function VE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function jE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function UE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"circle-help"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function qE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"computer"},()=>g,{iconNode:[["rect",{width:"14",height:"8",x:"5",y:"2",rx:"2"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2"}],["path",{d:"M6 18h2"}],["path",{d:"M12 18h6"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function ZE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"corner-down-right"},()=>g,{iconNode:[["polyline",{points:"15 10 20 15 15 20"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function GE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"droplet"},()=>g,{iconNode:[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function WE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"external-link"},()=>g,{iconNode:[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function HE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"github"},()=>g,{iconNode:[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["path",{d:"M9 18c-4.51 2-5-2-7-2"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function XE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function KE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"plug"},()=>g,{iconNode:[["path",{d:"M12 22v-5"}],["path",{d:"M9 8V2"}],["path",{d:"M15 8V2"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function $E(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"printer"},()=>g,{iconNode:[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function JE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function YE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}function QE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"wifi"},()=>g,{iconNode:[["path",{d:"M12 20h.01"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}]],children:(T,C)=>{var b=Xe(),c=Le(b);Hn(c,s,"default",{}),_e(T,b)},$$slots:{default:!0}}))}var Dc,Jd,Yo,Ga,aa,cv,uv;class eM{constructor(s,g){H(this,aa);H(this,Dc,Qe());H(this,Jd);H(this,Yo,0);H(this,Ga,null);I(this,Dc).v=qe(s),Ve(this,Jd,g)}get current(){return Ib()?Ct(()=>(rh(this,Yo)._++,I(this,Yo)===1&&qn(this,aa,cv).call(this,!0),()=>{ay().then(()=>{rh(this,Yo)._--,I(this,Yo)===0&&qn(this,aa,uv).call(this)})})):I(this,Yo)===0&&(qn(this,aa,cv).call(this,!1),qn(this,aa,uv).call(this)),L(I(this,Dc))}}Dc=new WeakMap,Jd=new WeakMap,Yo=new WeakMap,Ga=new WeakMap,aa=new WeakSet,cv=function(s){Ve(this,Ga,I(this,Jd).call(this,g=>{je(I(this,Dc),qe(g))},s)??null)},uv=function(){I(this,Ga)!==null&&(I(this,Ga).call(this),Ve(this,Ga,null))};new eM(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function tM(h,s,g,v){const T=Array.isArray(s)?s:[s];for(const C of T)h.addEventListener(C,g,v);return()=>{for(const C of T)h.removeEventListener(C,g,v)}}function ub({key:h,storage:s,serializer:g}){if(!s)return{found:!1,value:null};const v=s.getItem(h);if(v===null)return{found:!1,value:null};try{return{found:!0,value:g.deserialize(v)}}catch(T){return console.error(`Error when parsing ${v} from persisted store "${h}"`,T),{found:!1,value:null}}}function iM({key:h,value:s,storage:g,serializer:v}){if(g)try{g.setItem(h,v.serialize(s))}catch(T){console.error(`Error when writing value from persisted store "${h}" to ${g}`,T)}}function nM(h){return typeof window>"u"?null:{local:localStorage,session:sessionStorage}[h]}var Qo,ea,ta,Wa,Fg,L1;class D1{constructor(s,g,v={}){H(this,Fg);H(this,Qo,Qe());H(this,ea);H(this,ta);H(this,Wa);const{storage:T="local",serializer:C={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:b=!0}=v;Ve(this,ea,s),Ve(this,ta,nM(T)),Ve(this,Wa,C);const c=ub({key:I(this,ea),storage:I(this,ta),serializer:I(this,Wa)});I(this,Qo).v=qe(c.found?c.value:g),Ct(()=>{iM({key:I(this,ea),value:L(I(this,Qo)),storage:I(this,ta),serializer:I(this,Wa)})}),Ct(()=>{if(b)return tM(window,"storage",qn(this,Fg,L1).bind(this))})}get current(){return L(I(this,Qo))}set current(s){je(I(this,Qo),qe(s))}}Qo=new WeakMap,ea=new WeakMap,ta=new WeakMap,Wa=new WeakMap,Fg=new WeakSet,L1=function(s){if(s.key!==I(this,ea)||!I(this,ta))return;const g=ub({key:I(this,ea),storage:I(this,ta),serializer:I(this,Wa)});g.found&&je(I(this,Qo),qe(g.value))};var rM=Et('<!> <!> <span class="sr-only"> </span>',1),sM=Et(' <span class="sr-only"> </span>',1),oM=Et('<!> <span class="sr-only"> </span>',1),aM=Et('<!> <span class="sr-only"> </span>',1),lM=Et("<!> <!>",1),cM=Et('<!> <div class="flex flex-col gap-y-2"><!> <!> <!></div>',1),uM=Et("<!> <!>",1),hM=Et('<div class="absolute right-2.5 top-2.5 z-10 flex flex-col gap-y-2"><!> <!> <a target="_blank" rel="noopener noreferrer"><!></a> <!></div>');function dM(h,s){Pt(s,!1);const g=vb(),v=()=>xb(H2,"$page",g),T=dS(new D1("language","en"));function C(){L(T).current==="en"?Ex(T,L(T).current="fr"):L(T).current==="fr"&&Ex(T,L(T).current="en"),yS(L(T).current);const te=zx.route(v().url.pathname),ue=zx.resolveRoute(te,L(T).current);pS(ue)}const b=la(),[c,j]=b;fv();var U=hM(),K=qt(U);um(K,{onclick:vS,variant:"outline",size:"icon",children:(te,ue)=>{var ve=rM(),pe=Le(ve);YE(pe,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var Ie=Wt(pe,2);XE(Ie,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"});var Oe=Wt(Ie,2),ze=qt(Oe,!0);zt(()=>Ri(ze,kT())),Vt(Oe),_e(te,ve)},$$slots:{default:!0}});var B=Wt(K,2);um(B,{onclick:C,variant:"outline",size:"icon",class:"uppercase",children:(te,ue)=>{ia();var ve=sM(),pe=Le(ve),Ie=Wt(pe),Oe=qt(Ie,!0);zt(()=>Ri(Oe,zT())),Vt(Ie),zt(()=>Ri(pe,`${L(T).current??""} `)),_e(te,ve)},$$slots:{default:!0}});var V=Wt(B,2);zt(()=>mh(V,"href",c(IS,void 0)));var oe=qt(V);um(oe,{variant:"outline",size:"icon",class:"uppercase",children:(te,ue)=>{var ve=oM(),pe=Le(ve);HE(pe,{class:"h-fit w-fit scale-100 "});var Ie=Wt(pe,2),Oe=qt(Ie,!0);zt(()=>Ri(Oe,RT())),Vt(Ie),_e(te,ve)},$$slots:{default:!0}}),Vt(V);var ie=Wt(V,2);OE(ie,{children:(te,ue)=>{var ve=uM(),pe=Le(ve),Ie=Up(()=>ev({variant:"outline",size:"icon"}));FE(pe,{get class(){return L(Ie)},children:(ze,We)=>{var $e=aM(),xt=Le($e);UE(xt,{class:"h-fit w-fit scale-100 "});var He=Wt(xt,2),Ye=qt(He,!0);zt(()=>Ri(Ye,BT())),Vt(He),_e(ze,$e)},$$slots:{default:!0}});var Oe=Wt(pe,2);EE(Oe,{children:(ze,We)=>{var $e=cM(),xt=Le($e);DE(xt,{children:(De,Ae)=>{var Ue=lM(),et=Le(Ue);RE(et,{children:(ut,ct)=>{ia();var at=On();zt(()=>Ri(at,IT())),_e(ut,at)},$$slots:{default:!0}});var pt=Wt(et,2);ME(pt,{children:(ut,ct)=>{ia();var at=On();zt(()=>Ri(at,ST())),_e(ut,at)},$$slots:{default:!0}}),_e(De,Ue)},$$slots:{default:!0}});var He=Wt(xt,2),Ye=qt(He);cm(Ye,{status:"Open",class:"mr-auto"});var Be=Wt(Ye,2);cm(Be,{status:"Closing Soon",class:"mr-auto"});var Me=Wt(Be,2);cm(Me,{status:"Closed",class:"mr-auto"}),Vt(He),_e(ze,$e)},$$slots:{default:!0}}),_e(te,ve)},$$slots:{default:!0}}),Vt(U),_e(h,U),It()}function pM(h,s){let g=Kt(s,["$$slots","$$events","$$legacy","amenity"]);({Computers:qE,Outlets:KE,Printing:$E,Rooms:NE,"Water Fountains":GE,WiFi:QE}[s.amenity]??ZE)(h,Gt({class:"h-fit w-fit scale-75"},()=>g))}var fM=Et("<div></div>");function mM(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]),v=yn(g,["class"]);Pt(s,!1);let T=ee(s,"class",8,void 0);fv();var C=fM();let b;zt(()=>b=ji(C,b,{class:Ni("animate-pulse rounded-md bg-muted",T()),...v})),_e(h,C),It()}function R1(){var h=Object.create(null);function s(g){delete h[g]}this.set=function(g,v,T){if(T!==void 0&&(typeof T!="number"||isNaN(T)||T<=0))throw new Error("Cache timeout must be a positive number");var C=h[g];C&&clearTimeout(C.timeout);var b={value:v,expire:T+Date.now()};return isNaN(b.expire)||(b.timeout=setTimeout(()=>s(g),T)),h[g]=b,v},this.del=function(g){var v=!0,T=h[g];return T?(clearTimeout(T.timeout),!isNaN(T.expire)&&T.expire<Date.now()&&(v=!1)):v=!1,v&&s(g),v},this.clear=function(){for(var g in h)clearTimeout(h[g].timeout);h=Object.create(null)},this.get=function(g){var v=h[g];if(v!==void 0){if(isNaN(v.expire)||v.expire>=Date.now())return v.value;delete h[g]}return null}}const hv=new R1;hv.Cache=R1;const gM="https://translate.googleapis.com/translate_a/single";var yM={fetch:({key:h,from:s,to:g,text:v})=>[`${gM}?client=gtx&sl=${s}&tl=${g}&dt=t&q=${encodeURIComponent(v)}`],parse:h=>h.json().then(s=>{if(!(s=s&&s[0]&&s[0][0]&&s[0].map(g=>g[0]).join("")))throw new Error("Translation not found");return s})},_M={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://translate.yandex.net/api/v1.5/tr.json/translate?key=${h}&lang=${s}-${g}&text=${encodeURIComponent(v)}`,{method:"POST",body:""}],parse:h=>h.json().then(s=>{if(s.code!==200)throw new Error(s.message);return s.text[0]})};const vM="https://libretranslate.com/translate";var xM={needkey:!1,fetch:({url:h=vM,key:s,from:g,to:v,text:T})=>[h,{method:"POST",body:JSON.stringify({q:T,source:g,target:v,api_key:s}),headers:{"Content-Type":"application/json"}}],parse:h=>h.json().then(s=>{if(!s)throw new Error("No response found");if(s.error)throw new Error(s.error);if(!s.translatedText)throw new Error("No response found");return s.translatedText})},bM={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://api${h.endsWith(":fx")?"-free":""}.deepl.com/v2/translate?auth_key=${h}&source_lang=${s}&target_lang=${g}&text=${v=encodeURIComponent(v)}`,{method:"POST",body:""}],parse:async h=>{if(!h.ok)throw h.status===403?new Error("Auth Error, please review the key for DeepL"):new Error(`Error ${h.status}`);return h.json().then(s=>s.translations[0].text)}},wM={google:yM,yandex:_M,libre:xM,deepl:bM},O1={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cze:"cs",dan:"da",div:"dv",dut:"nl",dzo:"dz",eng:"en",epo:"eo",est:"et",ewe:"ee",fao:"fo",fij:"fj",fin:"fi",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mlg:"mg",mlt:"mt",mon:"mn",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zul:"zu"},SM={afar:"aa",abkhazian:"ab",afrikaans:"af",akan:"ak",albanian:"sq",amharic:"am",arabic:"ar",aragonese:"an",armenian:"hy",assamese:"as",avaric:"av",avestan:"ae",aymara:"ay",azerbaijani:"az",bashkir:"ba",bambara:"bm",basque:"eu",belarusian:"be",bengali:"bn","bihari languages":"bh",bislama:"bi",tibetan:"bo",bosnian:"bs",breton:"br",bulgarian:"bg",burmese:"my",catalan:"ca",valencian:"ca",czech:"cs",chamorro:"ch",chechen:"ce",chinese:"zh","church slavic":"cu","old slavonic":"cu","church slavonic":"cu","old bulgarian":"cu","old church slavonic":"cu",chuvash:"cv",cornish:"kw",corsican:"co",cree:"cr",welsh:"cy",danish:"da",german:"de",divehi:"dv",dhivehi:"dv",maldivian:"dv",dutch:"nl",flemish:"nl",dzongkha:"dz",greek:"el",english:"en",esperanto:"eo",estonian:"et",ewe:"ee",faroese:"fo",persian:"fa",fijian:"fj",finnish:"fi",french:"fr","western frisian":"fy",fulah:"ff",georgian:"ka",gaelic:"gd","scottish gaelic":"gd",irish:"ga",galician:"gl",manx:"gv",guarani:"gn",gujarati:"gu",haitian:"ht","haitian creole":"ht",hausa:"ha",hebrew:"he",herero:"hz",hindi:"hi","hiri motu":"ho",croatian:"hr",hungarian:"hu",igbo:"ig",icelandic:"is",ido:"io","sichuan yi":"ii",nuosu:"ii",inuktitut:"iu",interlingue:"ie",occidental:"ie",interlingua:"ia",indonesian:"id",inupiaq:"ik",italian:"it",javanese:"jv",japanese:"ja",kalaallisut:"kl",greenlandic:"kl",kannada:"kn",kashmiri:"ks",kanuri:"kr",kazakh:"kk","central khmer":"km",kikuyu:"ki",gikuyu:"ki",kinyarwanda:"rw",kirghiz:"ky",kyrgyz:"ky",komi:"kv",kongo:"kg",korean:"ko",kuanyama:"kj",kwanyama:"kj",kurdish:"ku",lao:"lo",latin:"la",latvian:"lv",limburgan:"li",limburger:"li",limburgish:"li",lingala:"ln",lithuanian:"lt",luxembourgish:"lb",letzeburgesch:"lb","luba-katanga":"lu",ganda:"lg",macedonian:"mk",marshallese:"mh",malayalam:"ml",maori:"mi",marathi:"mr",malay:"ms",malagasy:"mg",maltese:"mt",mongolian:"mn",nauru:"na",navajo:"nv",navaho:"nv","ndebele, south":"nr","south ndebele":"nr","ndebele, north":"nd","north ndebele":"nd",ndonga:"ng",nepali:"ne","norwegian nynorsk":"nn","nynorsk, norwegian":"nn","norwegian bokmål":"nb","bokmål, norwegian":"nb",norwegian:"no",chichewa:"ny",chewa:"ny",nyanja:"ny",occitan:"oc",ojibwa:"oj",oriya:"or",oromo:"om",ossetian:"os",ossetic:"os",panjabi:"pa",punjabi:"pa",pali:"pi",polish:"pl",portuguese:"pt",pushto:"ps",pashto:"ps",quechua:"qu",romansh:"rm",romanian:"ro",moldavian:"ro",moldovan:"ro",rundi:"rn",russian:"ru",sango:"sg",sanskrit:"sa",sinhala:"si",sinhalese:"si",slovak:"sk",slovenian:"sl","northern sami":"se",samoan:"sm",shona:"sn",sindhi:"sd",somali:"so","sotho, southern":"st",spanish:"es",castilian:"es",sardinian:"sc",serbian:"sr",swati:"ss",sundanese:"su",swahili:"sw",swedish:"sv",tahitian:"ty",tamil:"ta",tatar:"tt",telugu:"te",tajik:"tg",tagalog:"tl",thai:"th",tigrinya:"ti",tonga:"to",tswana:"tn",tsonga:"ts",turkmen:"tk",turkish:"tr",twi:"tw",uighur:"ug",uyghur:"ug",ukrainian:"uk",urdu:"ur",uzbek:"uz",venda:"ve",vietnamese:"vi",volapük:"vo",walloon:"wa",wolof:"wo",xhosa:"xh",yiddish:"yi",yoruba:"yo",zhuang:"za",chuang:"za",zulu:"zu"};const TM=Object.values(O1).sort();var Z_=h=>{if(typeof h!="string")throw new Error('The "language" must be a string, received '+typeof h);if(h.length>100)throw new Error(`The "language" is too long at ${h.length} characters`);if(h=h.toLowerCase(),h=SM[h]||O1[h]||h,!TM.includes(h))throw new Error(`The language "${h}" is not part of the ISO 639-1`);return h};const _m=function(h={}){if(!(this instanceof _m))return new _m(h);const s={from:"en",to:"en",cache:void 0,engine:"google",key:void 0,url:void 0,languages:Z_,engines:wM,keys:{}},g=async(v,T={})=>{typeof T=="string"&&(T={to:T});const C=Object.keys(T).find(U=>U!=="from"&&U!=="to");if(C)throw new Error(`Invalid option with the name '${C}'`);T.text=v,T.from=Z_(T.from||g.from),T.to=Z_(T.to||g.to),T.cache=g.cache,T.engine=g.engine,T.url=g.url,T.id=`${T.url}:${T.from}:${T.to}:${T.engine}:${T.text}`,T.keys=g.keys||{};for(let U in g.keys)T.keys[U]=T.keys[U]||g.keys[U];T.key=T.key||g.key||T.keys[T.engine];const b=g.engines[T.engine],c=hv.get(T.id);if(c)return Promise.resolve(c);if(T.to===T.from)return Promise.resolve(T.text);if(b.needkey&&!T.key)throw new Error(`The engine "${T.engine}" needs a key, please provide it`);const j=b.fetch(T);return fetch(...j).then(b.parse).then(U=>hv.set(T.id,U,T.cache))};for(let v in s)g[v]=h[v]===void 0?s[v]:h[v];return g},fh=new _m;fh.Translate=_m;var PM=Et('<div class="flex flex-col gap-y-2"></div>'),IM=Et('<li class="flex gap-x-1 ps-1"><!> <span> </span></li>'),CM=Et('<ul class="mb-3"><h2 class="mb-1 font-semibold"> </h2> <!></ul>'),AM=Et("<span> </span>"),kM=Et('<li class="flex justify-between gap-x-1"><span class="first-letter:uppercase"> </span> <span> </span></li>'),EM=Et("<ul></ul>"),MM=Et('<div class="mb-3"><!></div> <!> <div class="mb-3"><h2 class="font-semibold"> </h2> <a class="flex gap-x-1 hover:underline" target="_blank" rel="noopener noreferrer"><span> </span> <!></a></div> <div><h2 class="font-semibold"> </h2> <!></div>',1);function zM(h,s){Pt(s,!0);const g={Computers:tP(),Outlets:rP(),Printing:aP(),Rooms:uP(),"Water Fountains":pP(),WiFi:gP()},v={monday:MP(),tuesday:LP(),wednesday:FP(),thursday:VP(),friday:qP(),saturday:WP(),sunday:KP()};function T(Be){var Me;return Be===void 0?"":((Me=Be.metadata)==null?void 0:Me.link)??`https://www.google.com/maps?q=${Be.location.lat},${Be.location.lng}`}function C(Be,Me){if(Be.length===0)return Wb();const De=Ue=>Ue.replace(/\:/g,"h"),Ae=Be.map(Ue=>`${Ue.open} - ${Ue.close}`).join(", ");return["fr"].includes(Me)?De(Ae):Ae}const b=la(),[c,j]=b;var U=MM(),K=Le(U),B=qt(K);lm(B,()=>fh(s.space.description,hi()),Be=>{var Me=PM();Hl(Me,20,()=>Array(3),Xl,(De,Ae)=>{mM(De,{class:"h-4 w-full"})}),Vt(Me),_e(Be,Me)},(Be,Me)=>{var De=On();zt(()=>Ri(De,L(Me))),_e(Be,De)},Be=>{var Me=On();zt(()=>Ri(Me,s.space.description)),_e(Be,Me)}),Vt(K);var V=Wt(K,2);{var oe=Be=>{var Me=CM(),De=qt(Me),Ae=qt(De,!0);zt(()=>Ri(Ae,YT())),Vt(De);var Ue=Wt(De,2);Hl(Ue,17,()=>{var et;return(et=s.space.metadata)==null?void 0:et.amenities.slice().sort()},Xl,(et,pt)=>{var ut=IM(),ct=qt(ut);pM(ct,{get amenity(){return L(pt)}});var at=Wt(ct,2),Mt=qt(at,!0);Vt(at),Vt(ut),zt(()=>Ri(Mt,g[L(pt)])),_e(et,ut)}),Vt(Me),_e(Be,Me)};fi(V,Be=>{var Me;(Me=s.space.metadata)!=null&&Me.amenities&&Be(oe)})}var ie=Wt(V,2),te=qt(ie),ue=qt(te,!0);zt(()=>Ri(ue,wP())),Vt(te);var ve=Wt(te,2);zt(()=>mh(ve,"href",c(T(s.space),void 0)));var pe=qt(ve),Ie=qt(pe,!0);zt(()=>Ri(Ie,vP())),Vt(pe);var Oe=Wt(pe,2);WE(Oe,{class:"h-fit w-fit scale-75"}),Vt(ve),Vt(ie);var ze=Wt(ie,2),We=qt(ze),$e=qt(We,!0);zt(()=>Ri($e,AP())),Vt(We);var xt=Wt(We,2);{var He=Be=>{var Me=AM(),De=qt(Me,!0);zt(()=>Ri(De,PP())),Vt(Me),_e(Be,Me)},Ye=Be=>{var Me=EM();Hl(Me,21,()=>Object.entries(s.space.hours),Xl,(De,Ae)=>{let Ue=()=>L(Ae)[0],et=()=>L(Ae)[1];var pt=kM(),ut=qt(pt),ct=qt(ut,!0);Vt(ut);var at=Wt(ut,2),Mt=qt(at,!0);zt(()=>Ri(Mt,C(et(),hi()))),Vt(at),Vt(pt),zt(()=>Ri(ct,v[Ue()])),_e(De,pt)}),Vt(Me),_e(Be,Me)};fi(xt,Be=>{s.space.alwaysOpen?Be(He):Be(Ye,!1)})}Vt(ze),_e(h,U),It()}var DM=Et('<div class="group flex h-16 w-16 cursor-pointer items-center justify-center"><div>&nbsp;</div></div>');function LM(h,s){Pt(s,!0);const g={Open:"bg-green-400 shadow-green-400 group-hover:bg-green-500 group-hover:shadow-green-500",Closed:"bg-red-400 shadow-red-400 group-hover:bg-red-500 group-hover:shadow-red-500","Opening Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500","Closing Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500"};var v=DM(),T=qt(v);const C=Te(()=>Ni(g[s.status],"h-2 w-2 rounded-full shadow-3xl"));Vt(v),zt(()=>Mb(T,L(C))),_e(h,v),It()}function RM(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","value","class"]);var C=Xe(),b=Le(C),c=Te(()=>Ni("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s.class));si(b,()=>Zk,(j,U)=>{U(j,Gt({get class(){return L(c)},get value(){return v()},set value(K){v(K)},get ref(){return g()},set ref(K){g(K)}},()=>T))}),_e(h,C),It()}function OM(h,s){Pt(s,!0),ee(s,"ref",11,null);let g=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var v=Xe(),T=Le(v),C=Te(()=>Ni("py-6 text-center text-sm",s.class));si(T,()=>Wk,(b,c)=>{c(b,Gt({get class(){return L(C)}},()=>g))}),_e(h,v),It()}var FM=Et("<!> <!>",1);function BM(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("overflow-hidden p-1 text-foreground",s.class));si(C,()=>Xk,(c,j)=>{j(c,Gt({get class(){return L(b)},get ref(){return g()},set ref(U){g(U)}},()=>v,{children:(U,K)=>{var B=FM(),V=Le(B);{var oe=te=>{var ue=Xe(),ve=Le(ue);si(ve,()=>$k,(pe,Ie)=>{Ie(pe,{class:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:(Oe,ze)=>{ia();var We=On();zt(()=>Ri(We,s.heading)),_e(Oe,We)},$$slots:{default:!0}})}),_e(te,ue)};fi(V,te=>{s.heading&&te(oe)})}var ie=Wt(V,2);si(ie,()=>Qk,(te,ue)=>{ue(te,{get children(){return s.children}})}),_e(U,B)},$$slots:{default:!0}}))}),_e(h,T),It()}var NM=Et('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function VM(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","class","value"]);var C=NM(),b=qt(C);JE(b,{class:"mr-2 size-4 shrink-0 opacity-50"});var c=Wt(b,2),j=Te(()=>Ni("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s.class));si(c,()=>tE,(U,K)=>{K(U,Gt({get class(){return L(j)},get ref(){return g()},set ref(B){g(B)}},()=>T,{get value(){return v()},set value(B){v(B)}}))}),Vt(C),_e(h,C),It()}function jM(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s.class));si(C,()=>rE,(c,j)=>{j(c,Gt({get class(){return L(b)},get ref(){return g()},set ref(U){g(U)}},()=>v))}),_e(h,T),It()}function UM(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("max-h-[300px] overflow-y-auto overflow-x-hidden",s.class));si(C,()=>oE,(c,j)=>{j(c,Gt({get class(){return L(b)}},()=>v,{get ref(){return g()},set ref(U){g(U)}}))}),_e(h,T),It()}function Pn(){}const qM=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),ZM=typeof document<"u";function GM(h){return h instanceof HTMLInputElement&&!qM.has(h.type)||h instanceof HTMLTextAreaElement||h instanceof HTMLElement&&h.isContentEditable}function Wn(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}const Qi={DURATION:.5,EASE:[.32,.72,0,1]},F1=.4,WM=.25,HM=100,B1=8,Ra=16,Dv=26,G_="vaul-dragging",N1=new WeakMap;function Tn(h,s,g=!1){if(!h||!(h instanceof HTMLElement))return;const v={};Object.entries(s).forEach(([T,C])=>{if(T.startsWith("--")){h.style.setProperty(T,C);return}v[T]=h.style[T],h.style[T]=C}),!g&&N1.set(h,v)}function XM(h,s){if(!h||!(h instanceof HTMLElement))return;const g=N1.get(h);g&&(h.style[s]=g[s])}function KM(){return Lv(/^Mac/)}function Lv(h){return typeof window<"u"&&window.navigator!=null?h.test(window.navigator.platform):void 0}function $M(){return Lv(/^iPhone/)}function hb(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function JM(){return Lv(/^iPad/)||KM()&&navigator.maxTouchPoints>1}function YM(){return $M()||JM()}function db(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}function im(h,s){if(!h)return null;const g=window.getComputedStyle(h),v=g.transform||g.webkitTransform||g.mozTransform;let T=v.match(/^matrix3d\((.+)\)$/);return T?Number.parseFloat(T[1].split(", ")[db(s)?13:12]):(T=v.match(/^matrix\((.+)\)$/),T?Number.parseFloat(T[1].split(", ")[db(s)?5:4]):null)}function W_(h,s){if(!h)return()=>{};const g=h.style.cssText;return Object.assign(h.style,s),()=>{h.style.cssText=g}}let uh=null;var Ps,Ha,Xa,Lc,Yd,Bg,Qd,Ng,Vg;class QM{constructor(s){H(this,Ps);H(this,Ha,Qe(qe(typeof window<"u"?window.location.href:"")));H(this,Xa,Qe(0));H(this,Lc,Te(()=>I(this,Ps).open.current));H(this,Yd,Te(()=>I(this,Ps).noBodyStyles.current));H(this,Bg,Te(()=>I(this,Ps).preventScrollRestoration.current));H(this,Qd,Te(()=>I(this,Ps).modal.current));H(this,Ng,Te(()=>I(this,Ps).nested.current));H(this,Vg,Te(()=>I(this,Ps).hasBeenOpened));Ge(this,"setPositionFixed",()=>{if(hb()&&uh===null&&L(I(this,Lc))&&!L(I(this,Yd))){uh={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:s,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-L(I(this,Xa))}px`,left:`${-s}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const v=g-window.innerHeight;v&&L(I(this,Xa))>=g&&(document.body.style.top=`${-(L(I(this,Xa))+v)}px`)}),300)}});Ge(this,"restorePositionSetting",()=>{if(hb()&&uh!==null&&!L(I(this,Yd))){const s=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,uh),window.requestAnimationFrame(()=>{if(L(I(this,Bg))&&L(I(this,Ha))!==window.location.href){je(I(this,Ha),qe(window.location.href));return}window.scrollTo(g,s)}),uh=null}});Ve(this,Ps,s),Ct(()=>Oi(()=>{const g=()=>{je(I(this,Xa),qe(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),Ct(()=>{if(L(I(this,Ha)),!!L(I(this,Qd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),Ct(()=>{L(I(this,Lc));const g=L(I(this,Qd)),v=L(I(this,Vg)),T=L(I(this,Ng));L(I(this,Ha)),Oi(()=>{T||!v||(L(I(this,Lc))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}Ps=new WeakMap,Ha=new WeakMap,Xa=new WeakMap,Lc=new WeakMap,Yd=new WeakMap,Bg=new WeakMap,Qd=new WeakMap,Ng=new WeakMap,Vg=new WeakMap;function pb(h,s){return jp(h,s)}function ez(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!Pb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return pv(h)}function tz(h,s){return`${h}Context`}function iz(h,s,g=!0){const v=tz(h),T=Symbol(v),C=v;function b(j){const U=ez(g?T:C,j);if(U===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return U}function c(j){return pb(g?T:C,j)}return[c,b]}var nr,Zn,Rc,Gn,jg,Ug,Oc,ep,tp,ip,qg,Zg,Gg,Wg,Hg,np;class nz{constructor(s){H(this,nr);H(this,Zn,Te(()=>I(this,nr).direction.current));H(this,Rc,Te(()=>I(this,nr).container.current));H(this,Gn,Te(()=>I(this,nr).snapPoints.current??[]));H(this,jg,Te(()=>I(this,nr).activeSnapPoint.current));H(this,Ug,Te(()=>I(this,nr).fadeFromIndex.current));H(this,Oc,Te(()=>I(this,nr).overlayNode));H(this,ep,Te(()=>I(this,nr).drawerNode));H(this,tp,Te(()=>I(this,nr).snapToSequentialPoint.current));H(this,ip,Qe(ZM?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));H(this,qg,Te(()=>{var s;return this.activeSnapPoint===((s=L(I(this,Gn)))==null?void 0:s[L(I(this,Gn)).length-1])||null}));H(this,Zg,Te(()=>{var s;return(s=L(I(this,Gn)))==null?void 0:s.findIndex(g=>g===this.activeSnapPoint)}));H(this,Gg,Te(()=>L(I(this,Gn))&&L(I(this,Gn)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&L(I(this,Gn))[this.fadeFromIndex]===this.activeSnapPoint||!L(I(this,Gn))));H(this,Wg,Te(()=>{var v;this.windowDimensions,I(this,nr).open.current;const s=L(I(this,Rc))?{width:L(I(this,Rc)).getBoundingClientRect().width,height:L(I(this,Rc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((v=L(I(this,Gn)))==null?void 0:v.map(T=>{const C=typeof T=="string";let b=0;if(C&&(b=Number.parseInt(T,10)),Wn(L(I(this,Zn)))){const j=C?b:this.windowDimensions?T*s.height:0;return this.windowDimensions?L(I(this,Zn))==="bottom"?s.height-j:-s.height+j:j}const c=C?b:this.windowDimensions?T*s.width:0;return this.windowDimensions?L(I(this,Zn))==="right"?s.width-c:-s.width+c:c}))??[]}));H(this,Hg,Te(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));H(this,np,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});Ge(this,"snapToPoint",s=>{var v;const g=this.snapPointsOffset.findIndex(T=>T===s)??null;I(this,nr).onSnapPointChange(g),Tn(L(I(this,ep)),{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:Wn(L(I(this,Zn)))?`translate3d(0, ${s}px, 0)`:`translate3d(${s}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"0"}):Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"1"}),I(this,nr).setActiveSnapPoint((v=L(I(this,Gn)))==null?void 0:v[Math.max(g,0)])});Ge(this,"onRelease",s=>{var j;if(this.fadeFromIndex===void 0)return;const g=L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right"?(this.activeSnapPointOffset??0)-s.draggedDistance:(this.activeSnapPointOffset??0)+s.draggedDistance,v=this.activeSnapPointIndex===this.fadeFromIndex-1,T=this.activeSnapPointIndex===0,C=s.draggedDistance>0;if(v&&Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`}),!L(I(this,tp))&&s.velocity>2&&!C){s.dismissible?s.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!L(I(this,tp))&&s.velocity>2&&C&&this.snapPointsOffset&&L(I(this,Gn))){this.snapToPoint(this.snapPointsOffset[L(I(this,Gn)).length-1]);return}const b=(j=this.snapPointsOffset)==null?void 0:j.reduce((U,K)=>typeof U!="number"||typeof K!="number"?U:Math.abs(K-g)<Math.abs(U-g)?K:U),c=Wn(L(I(this,Zn)))?window.innerHeight:window.innerWidth;if(s.velocity>F1&&Math.abs(s.draggedDistance)<c*.4){const U=C?1:-1;if(U>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[L(I(this,Gn)).length-1]);return}if(T&&U<0&&s.dismissible&&I(this,nr).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+U]);return}this.snapToPoint(b)});Ge(this,"onDrag",s=>{if(this.activeSnapPointOffset===null)return;const g=L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right"?this.activeSnapPointOffset-s.draggedDistance:this.activeSnapPointOffset+s.draggedDistance;(L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(L(I(this,Zn))==="top"||L(I(this,Zn))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||Tn(L(I(this,ep)),{transform:Wn(L(I(this,Zn)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});Ge(this,"getPercentageDragged",(s,g)=>{if(!L(I(this,Gn)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const v=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(v&&!g)return 1;if(!this.shouldFade&&!v)return null;const C=v?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,b=v?this.snapPointsOffset[C]-this.snapPointsOffset[C-1]:this.snapPointsOffset[C+1]-this.snapPointsOffset[C],c=s/Math.abs(b);return v?1-c:c});Ve(this,nr,s),Ct(()=>Oi(()=>(window.addEventListener("resize",I(this,np)),()=>window.removeEventListener("resize",I(this,np))))),Ct(()=>{const g=this.activeSnapPoint,v=L(I(this,Gn)),T=this.snapPointsOffset;Oi(()=>{if(g){const C=(v==null?void 0:v.findIndex(b=>b===g))??-1;T&&C!==-1&&typeof T[C]=="number"&&this.snapToPoint(T[C])}})})}get activeSnapPoint(){return L(I(this,jg))}get fadeFromIndex(){return L(I(this,Ug))}get windowDimensions(){return L(I(this,ip))}set windowDimensions(s){je(I(this,ip),s)}get isLastSnapPoint(){return L(I(this,qg))}get activeSnapPointIndex(){return L(I(this,Zg))}get shouldFade(){return L(I(this,Gg))}get snapPointsOffset(){return L(I(this,Wg))}get activeSnapPointOffset(){return L(I(this,Hg))}}nr=new WeakMap,Zn=new WeakMap,Rc=new WeakMap,Gn=new WeakMap,jg=new WeakMap,Ug=new WeakMap,Oc=new WeakMap,ep=new WeakMap,tp=new WeakMap,ip=new WeakMap,qg=new WeakMap,Zg=new WeakMap,Gg=new WeakMap,Wg=new WeakMap,Hg=new WeakMap,np=new WeakMap;function rz(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function sz(h){const s=Te(()=>h.direction.current),g=Te(()=>h.open.current),v=Te(()=>h.shouldScaleBackground.current),T=Te(()=>h.setBackgroundColorOnScale.current),C=Te(()=>h.noBodyStyles.current);let b=Qe(null),c=Qe("");function j(){return(window.innerWidth-Dv)/window.innerWidth}Ct(()=>{Oi(()=>{je(c,qe(document.body.style.backgroundColor))})}),Ct(()=>(L(g),L(v),L(T),Oi(()=>{if(L(g)&&L(v)){L(b)&&window.clearTimeout(L(b));const U=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!U)return;rz(L(T)&&!L(C)?W_(document.body,{background:"black"}):Pn,W_(U,{transformOrigin:Wn(L(s))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Qi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qi.EASE.join(",")})`}));const K=W_(U,{borderRadius:`${B1}px`,overflow:"hidden",...Wn(L(s))?{transform:`scale(${j()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${j()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{K(),je(b,qe(window.setTimeout(()=>{L(c)?document.body.style.background=L(c):document.body.style.removeProperty("background")},Qi.DURATION*1e3)))}}})))}var rp,sp,op,ap,lp,cp,up,hp,dp,pp,fp,mp,gp,yp,_p,vp,xp,Xg;class oz{constructor(s){Ge(this,"open");Ge(this,"activeSnapPoint");Ge(this,"closeThreshold");Ge(this,"shouldScaleBackground");Ge(this,"scrollLockTimeout");Ge(this,"snapPoints");Ge(this,"fadeFromIndex");Ge(this,"fixed");Ge(this,"dismissible");Ge(this,"direction");Ge(this,"onDragProp");Ge(this,"onReleaseProp");Ge(this,"nested");Ge(this,"onCloseProp");Ge(this,"backgroundColor");Ge(this,"modal");Ge(this,"handleOnly");Ge(this,"noBodyStyles");Ge(this,"preventScrollRestoration");Ge(this,"setBackgroundColorOnScale");Ge(this,"container");Ge(this,"snapToSequentialPoint");Ge(this,"repositionInputs");Ge(this,"autoFocus");H(this,rp,Qe(!1));H(this,sp,Qe(!1));H(this,op,Qe(!1));H(this,ap,Qe(null));H(this,lp,Qe(null));H(this,cp,Qe(null));H(this,up,Qe(null));H(this,hp,Qe(null));H(this,dp,Qe(!1));H(this,pp,Qe(null));H(this,fp,Qe(0));H(this,mp,Qe(!1));H(this,gp,Qe(0));H(this,yp,Qe(null));H(this,_p,Qe(0));H(this,vp,Qe(0));H(this,xp,Qe(0));Ge(this,"snapPointsState");H(this,Xg,Te(()=>this.snapPointsState.snapPointsOffset));Ge(this,"positionFixedState");Ge(this,"setActiveSnapPoint",s=>{this.activeSnapPoint.current=s});Ge(this,"onSnapPointChange",s=>{this.snapPoints.current&&s===this.snapPointsOffset.length-1&&(this.openTime=new Date)});Ge(this,"onPress",s=>{var v;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(s.target))return;const g=(v=this.drawerNode)==null?void 0:v.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,YM()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),s.target.setPointerCapture(s.pointerId),this.pointerStart=Wn(this.direction.current)?s.pageY:s.pageX});Ge(this,"shouldDrag",(s,g)=>{var c;if(s===null)return!1;let v=s;const T=(c=window.getSelection())==null?void 0:c.toString(),C=this.drawerNode?im(this.drawerNode,this.direction.current):null,b=new Date;if(v.hasAttribute("data-vaul-no-drag")||v.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&b.getTime()-this.openTime.getTime()<500)return!1;if(C!==null&&(this.direction.current==="bottom"?C>0:C<0))return!0;if(T&&T.length>0)return!1;if(this.lastTimeDragPrevented!==null&&b.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&C===0)return this.lastTimeDragPrevented=b,!1;if(g)return this.lastTimeDragPrevented=b,!1;for(;v;){if(v.scrollHeight>v.clientHeight){if(v.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(v.getAttribute("role")==="dialog")return!0}v=v.parentNode}return!0});Ge(this,"onDrag",s=>{var V,oe;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,v=(this.pointerStart-(Wn(this.direction.current)?s.pageY:s.pageX))*g,T=v>0,C=this.snapPoints.current&&!this.dismissible.current&&!T;if(C&&this.snapPointsState.activeSnapPointIndex===0)return;const b=Math.abs(v),c=document.querySelector("[data-vaul-drawer-wrapper]"),j=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let U=b/j;const K=this.snapPointsState.getPercentageDragged(b,T);if(K!==null&&(U=K),C&&U>=1||!this.isAllowedToDrag&&!this.shouldDrag(s.target,T))return;if(this.drawerNode.classList.add(G_),this.isAllowedToDrag=!0,Tn(this.drawerNode,{transition:"none"}),Tn(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:v}),T&&!this.snapPoints.current){const ie=mz(v),te=Math.min(ie*-1,0)*g;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`translate3d(0, ${te}px, 0)`:`translate3d(${te}px, 0, 0)`});return}const B=1-U;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((oe=(V=this.onDragProp).current)==null||oe.call(V,s,U),Tn(this.overlayNode,{opacity:`${B}`,transition:"none"},!0)),c&&this.overlayNode&&this.shouldScaleBackground.current){const ie=Math.min(nm()+U*(1-nm()),1),te=8-U*8,ue=Math.max(0,14-U*14);Tn(c,{borderRadius:`${te}px`,transform:Wn(this.direction.current)?`scale(${ie}) translate3d(0, ${ue}px, 0)`:`scale(${ie}) translate3d(${ue}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const ie=b*g;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`translate3d(0, ${ie}px, 0)`:`translate3d(${ie}px, 0, 0)`})}});Ge(this,"closeDrawer",s=>{var g,v;this.cancelDrag(),(v=(g=this.onCloseProp).current)==null||v.call(g),s||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},Qi.DURATION*1e3)});Ge(this,"resetDrawer",()=>{if(!this.drawerNode)return;const s=document.querySelector("[data-vaul-drawer-wrapper]"),g=im(this.drawerNode,this.direction.current);Tn(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`}),Tn(this.overlayNode,{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&Tn(s,{borderRadius:`${B1}px`,overflow:"hidden",...Wn(this.direction.current)?{transform:`scale(${nm()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${nm()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Qi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qi.EASE.join(",")})`},!0)});Ge(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(G_),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});Ge(this,"onRelease",s=>{var U,K,B,V,oe,ie,te,ue,ve,pe;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(G_),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=im(this.drawerNode,this.direction.current);if(!this.shouldDrag(s.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const v=this.dragEndTime.getTime()-this.dragStartTime.getTime(),T=this.pointerStart-(Wn(this.direction.current)?s.pageY:s.pageX),C=Math.abs(T)/v;if(C>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const Ie=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:T*Ie,closeDrawer:this.closeDrawer,velocity:C,dismissible:this.dismissible.current}),(K=(U=this.onReleaseProp).current)==null||K.call(U,s,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?T>0:T<0){this.resetDrawer(),(V=(B=this.onReleaseProp).current)==null||V.call(B,s,!0);return}if(C>F1){this.closeDrawer(),(ie=(oe=this.onReleaseProp).current)==null||ie.call(oe,s,!1);return}const b=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),c=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),j=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(j?c:b)*this.closeThreshold.current){this.closeDrawer(),(ue=(te=this.onReleaseProp).current)==null||ue.call(te,s,!1);return}(pe=(ve=this.onReleaseProp).current)==null||pe.call(ve,s,!0),this.resetDrawer()});Ge(this,"onNestedOpenChange",s=>{const g=s?(window.innerWidth-Ra)/window.innerWidth:1,v=s?-Ra:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),Tn(this.drawerNode,{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${v}px, 0)`}),!s&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const T=im(this.drawerNode,this.direction.current);Tn(this.drawerNode,{transition:"none",transform:Wn(this.direction.current)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))});Ge(this,"onNestedDrag",(s,g)=>{if(g<0)return;const v=(window.innerWidth-Ra)/window.innerWidth,T=v+g*(1-v),C=-Ra+g*Ra;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`,transition:"none"})});Ge(this,"onNestedRelease",(s,g)=>{const v=Wn(this.direction.current)?window.innerHeight:window.innerWidth,T=g?(v-Ra)/v:1,C=g?-Ra:0;g&&Tn(this.drawerNode,{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:Wn(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`})});Ge(this,"onDialogOpenChange",s=>{!this.dismissible.current&&!this.open.current||(s?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=s)});this.open=s.open,this.activeSnapPoint=s.activeSnapPoint,this.closeThreshold=s.closeThreshold,this.shouldScaleBackground=s.shouldScaleBackground,this.scrollLockTimeout=s.scrollLockTimeout,this.snapPoints=s.snapPoints,this.fadeFromIndex=s.fadeFromIndex,this.fixed=s.fixed,this.dismissible=s.dismissible,this.direction=s.direction,this.onDragProp=s.onDrag,this.onReleaseProp=s.onRelease,this.nested=s.nested,this.onCloseProp=s.onClose,this.backgroundColor=s.backgroundColor,this.modal=s.modal,this.handleOnly=s.handleOnly,this.noBodyStyles=s.noBodyStyles,this.preventScrollRestoration=s.preventScrollRestoration,this.setBackgroundColorOnScale=s.setBackgroundColorOnScale,this.container=s.container,this.snapToSequentialPoint=s.snapToSequentialPoint,this.repositionInputs=s.repositionInputs,this.autoFocus=s.autoFocus,this.snapPointsState=new nz(this),this.positionFixedState=new QM(this),Ct(()=>{const g=this.snapPointsState.activeSnapPointIndex,v=this.snapPoints.current,T=this.snapPointsState.snapPointsOffset;return this.drawerNode,Oi(()=>{var b;const C=()=>{var j;if(!this.drawerNode||!this.repositionInputs.current)return;const c=document.activeElement;if(GM(c)||this.keyboardIsOpen){const U=((j=window.visualViewport)==null?void 0:j.height)||0,K=window.innerHeight;let B=K-U;const V=this.drawerNode.getBoundingClientRect().height||0,oe=V>K*.8;this.initialDrawerHeight||(this.initialDrawerHeight=V);const ie=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-B)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),v&&v.length>0&&T&&g){const te=T[g]||0;B+=te}if(this.previousDiffFromInitial=B,V>U||this.keyboardIsOpen){const te=this.drawerNode.getBoundingClientRect().height;let ue=te;te>U&&(ue=U-(oe?ie:Dv)),this.fixed.current?this.drawerNode.style.height=`${te-Math.max(B,0)}px`:this.drawerNode.style.height=`${Math.max(ue,U-ie)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;v&&v.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(B,0)}px`}};return(b=window.visualViewport)==null||b.addEventListener("resize",C),()=>{var c;return(c=window.visualViewport)==null?void 0:c.removeEventListener("resize",C)}})}),Ct(()=>{const g=this.open.current;return Oi(()=>(g&&(Tn(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{XM(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return L(I(this,rp))}set hasBeenOpened(s){je(I(this,rp),qe(s))}get isDragging(){return L(I(this,sp))}set isDragging(s){je(I(this,sp),qe(s))}get justReleased(){return L(I(this,op))}set justReleased(s){je(I(this,op),qe(s))}get overlayNode(){return L(I(this,ap))}set overlayNode(s){je(I(this,ap),qe(s))}get openTime(){return L(I(this,lp))}set openTime(s){je(I(this,lp),qe(s))}get dragStartTime(){return L(I(this,cp))}set dragStartTime(s){je(I(this,cp),qe(s))}get dragEndTime(){return L(I(this,up))}set dragEndTime(s){je(I(this,up),qe(s))}get lastTimeDragPrevented(){return L(I(this,hp))}set lastTimeDragPrevented(s){je(I(this,hp),qe(s))}get isAllowedToDrag(){return L(I(this,dp))}set isAllowedToDrag(s){je(I(this,dp),qe(s))}get nestedOpenChangeTimer(){return L(I(this,pp))}set nestedOpenChangeTimer(s){je(I(this,pp),qe(s))}get pointerStart(){return L(I(this,fp))}set pointerStart(s){je(I(this,fp),qe(s))}get keyboardIsOpen(){return L(I(this,mp))}set keyboardIsOpen(s){je(I(this,mp),qe(s))}get previousDiffFromInitial(){return L(I(this,gp))}set previousDiffFromInitial(s){je(I(this,gp),qe(s))}get drawerNode(){return L(I(this,yp))}set drawerNode(s){je(I(this,yp),qe(s))}get drawerHeight(){return L(I(this,_p))}set drawerHeight(s){je(I(this,_p),qe(s))}get drawerWidth(){return L(I(this,vp))}set drawerWidth(s){je(I(this,vp),qe(s))}get initialDrawerHeight(){return L(I(this,xp))}set initialDrawerHeight(s){je(I(this,xp),qe(s))}get snapPointsOffset(){return L(I(this,Xg))}}rp=new WeakMap,sp=new WeakMap,op=new WeakMap,ap=new WeakMap,lp=new WeakMap,cp=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,mp=new WeakMap,gp=new WeakMap,yp=new WeakMap,_p=new WeakMap,vp=new WeakMap,xp=new WeakMap,Xg=new WeakMap;var Yr,Fc,bp,wp,Kg,$g,Jg;class az{constructor(s,g){H(this,Yr);H(this,Fc);H(this,bp);H(this,wp,Qe(!1));H(this,Kg,Te(()=>I(this,Yr).snapPoints.current&&I(this,Yr).snapPoints.current.length>0));H(this,$g,s=>{I(this,Yr).onRelease(s)});H(this,Jg,Te(()=>({id:I(this,Fc).current,"data-vaul-overlay":"","data-vaul-snap-points":I(this,Yr).open.current&&L(I(this,Kg))?"true":"false","data-vaul-snap-points-overlay":I(this,Yr).open.current&&I(this,Yr).snapPointsState.shouldFade?"true":"false",onmouseup:I(this,$g)})));Ve(this,Yr,g),Ve(this,Fc,s.id),Ve(this,bp,s.ref),V1({id:I(this,Fc),ref:I(this,bp),onRefChange:v=>{this.mounted?I(this,Yr).overlayNode=v:I(this,Yr).overlayNode=null},deps:()=>this.mounted})}get mounted(){return L(I(this,wp))}set mounted(s){je(I(this,wp),qe(s))}get props(){return L(I(this,Jg))}}Yr=new WeakMap,Fc=new WeakMap,bp=new WeakMap,wp=new WeakMap,Kg=new WeakMap,$g=new WeakMap,Jg=new WeakMap;var qi,Bc,Sp,Tp,Pp,Ip,Cp,Ap,kp,Ep,Mp,zp,Dp,Lp,Yg,Rp,Qg,ey,ty,iy,ny,ry,sy;class lz{constructor(s,g){H(this,qi);H(this,Bc);H(this,Sp);H(this,Tp);H(this,Pp);H(this,Ip);H(this,Cp);H(this,Ap);H(this,kp);H(this,Ep);H(this,Mp,Qe(!1));H(this,zp,Qe(null));H(this,Dp,Qe(null));H(this,Lp,Qe(!1));H(this,Yg,Te(()=>I(this,qi).snapPoints.current&&I(this,qi).snapPoints.current.length>0));H(this,Rp,Qe(!1));Ge(this,"isDeltaInDirection",(s,g,v=0)=>{if(this.wasBeyondThePoint)return!0;const T=Math.abs(s.y),C=Math.abs(s.x),b=C>T,c=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(s.x*c<0)&&C>=0&&C<=v)return b}else if(!(s.y*c<0)&&T>=0&&T<=v)return!b;return this.wasBeyondThePoint=!0,!0});Ge(this,"handleOnPointerUp",s=>{this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,qi).onRelease(s)});Ge(this,"onOpenAutoFocus",s=>{I(this,Ep).current(s)});Ge(this,"onInteractOutside",s=>{if(I(this,Tp).current(s),!I(this,qi).modal.current||s.defaultPrevented){s.preventDefault();return}I(this,qi).keyboardIsOpen&&(I(this,qi).keyboardIsOpen=!1)});Ge(this,"onFocusOutside",s=>{I(this,qi).modal.current||s.preventDefault()});H(this,Qg,s=>{if(this.lastKnownPointerEvent=s,I(this,qi).handleOnly.current||(I(this,Ip).current(s),!this.pointerStart))return;const g=s.pageY-this.pointerStart.y,v=s.pageX-this.pointerStart.x,T=s.pointerType==="touch"?10:2,C={x:v,y:g};this.isDeltaInDirection(C,I(this,qi).direction.current,T)?I(this,qi).onDrag(s):(Math.abs(v)>T||Math.abs(g)>T)&&(this.pointerStart=null)});H(this,ey,s=>{I(this,Cp).current(s),this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,qi).onRelease(s)});H(this,ty,s=>{I(this,Ap).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});H(this,iy,s=>{I(this,kp).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});H(this,ny,s=>{I(this,qi).handleOnly.current||(I(this,Pp).current(s),this.pointerStart={x:s.pageX,y:s.pageY},I(this,qi).onPress(s))});H(this,ry,Te(()=>kb(I(this,qi).snapPointsState.snapPointsOffset)));H(this,sy,Te(()=>({id:I(this,Bc).current,"data-vaul-drawer-direction":I(this,qi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":I(this,qi).container.current?"true":"false","data-vaul-snap-points":I(this,qi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:I(this,ny),onpointermove:I(this,Qg),onpointerup:I(this,ey),onpointerout:I(this,ty),oncontextmenu:I(this,iy)})));Ve(this,qi,g),Ve(this,Bc,s.id),Ve(this,Sp,s.ref),Ve(this,Tp,s.onInteractOutside),Ve(this,Pp,s.onPointerDown),Ve(this,Ip,s.onPointerMove),Ve(this,Cp,s.onPointerUp),Ve(this,Ap,s.onPointerOut),Ve(this,kp,s.onContextMenu),Ve(this,Ep,s.onOpenAutoFocus),V1({id:I(this,Bc),ref:I(this,Sp),onRefChange:v=>{this.mounted?I(this,qi).drawerNode=v:I(this,qi).drawerNode=null},deps:()=>this.mounted&&I(this,qi).open.current}),sz(I(this,qi)),Ct(()=>{this.hasSnapPoints&&I(this,qi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return L(I(this,Mp))}set delayedSnapPoints(s){je(I(this,Mp),qe(s))}get pointerStart(){return L(I(this,zp))}set pointerStart(s){je(I(this,zp),qe(s))}get lastKnownPointerEvent(){return L(I(this,Dp))}set lastKnownPointerEvent(s){je(I(this,Dp),qe(s))}get wasBeyondThePoint(){return L(I(this,Lp))}set wasBeyondThePoint(s){je(I(this,Lp),qe(s))}get hasSnapPoints(){return L(I(this,Yg))}get mounted(){return L(I(this,Rp))}set mounted(s){je(I(this,Rp),qe(s))}get snapPointsOffset(){return L(I(this,ry))}get props(){return L(I(this,sy))}}qi=new WeakMap,Bc=new WeakMap,Sp=new WeakMap,Tp=new WeakMap,Pp=new WeakMap,Ip=new WeakMap,Cp=new WeakMap,Ap=new WeakMap,kp=new WeakMap,Ep=new WeakMap,Mp=new WeakMap,zp=new WeakMap,Dp=new WeakMap,Lp=new WeakMap,Yg=new WeakMap,Rp=new WeakMap,Qg=new WeakMap,ey=new WeakMap,ty=new WeakMap,iy=new WeakMap,ny=new WeakMap,ry=new WeakMap,sy=new WeakMap;var Nc,oy;class cz{constructor(s){H(this,Nc);H(this,oy,Te(()=>({to:I(this,Nc).container.current?I(this,Nc).container.current:void 0})));Ve(this,Nc,s)}get props(){return L(I(this,oy))}}Nc=new WeakMap,oy=new WeakMap;const[uz,Rv]=iz("Drawer.Root");function hz(h){return uz(new oz(h))}function dz(h){const s=Rv();return new lz(h,s)}function pz(h){const s=Rv();return new az(h,s)}function fz(){const h=Rv();return new cz(h)}function nm(){return(window.innerWidth-Dv)/window.innerWidth}function mz(h){return 8*(Math.log(h+1)-2)}function V1({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{}}){const T=Te(()=>g());Ct(()=>(h.current,L(T),Oi(()=>{const C=document.getElementById(h.current);return s.current=C,v(s.current),()=>{v(null)}}))),Ct(()=>()=>{s.current=null,v(null)})}function gz(h,s){Pt(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,Pn),T=ee(s,"closeThreshold",3,WM),C=ee(s,"scrollLockTimeout",3,HM),b=ee(s,"fadeFromIndex",19,()=>s.snapPoints&&s.snapPoints.length-1),c=ee(s,"backgroundColor",3,"black"),j=ee(s,"nested",3,!1),U=ee(s,"shouldScaleBackground",3,!1),K=ee(s,"activeSnapPoint",15,null),B=ee(s,"onActiveSnapPointChange",3,Pn),V=ee(s,"onRelease",3,Pn),oe=ee(s,"onDrag",3,Pn),ie=ee(s,"onClose",3,Pn),te=ee(s,"dismissible",3,!0),ue=ee(s,"direction",3,"bottom"),ve=ee(s,"fixed",3,!1),pe=ee(s,"handleOnly",3,!1),Ie=ee(s,"noBodyStyles",3,!1),Oe=ee(s,"preventScrollRestoration",3,!0),ze=ee(s,"setBackgroundColorOnScale",3,!0),We=ee(s,"onAnimationEnd",3,Pn),$e=ee(s,"controlledOpen",3,!1),xt=ee(s,"repositionInputs",3,!0),He=ee(s,"autoFocus",3,!1),Ye=ee(s,"snapToSequentialPoint",3,!1),Be=ee(s,"container",3,null),Me=ee(s,"controlledActiveSnapPoint",3,!1),De=ee(s,"modal",3,!0),Ae=Kt(s,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const Ue=hz({open:Pe.with(()=>g(),at=>{$e()?pt(g()):(g(at),pt(at))}),closeThreshold:Pe.with(()=>T()),scrollLockTimeout:Pe.with(()=>C()),snapPoints:Pe.with(()=>s.snapPoints),fadeFromIndex:Pe.with(()=>b()),backgroundColor:Pe.with(()=>c()),nested:Pe.with(()=>j()),shouldScaleBackground:Pe.with(()=>U()),activeSnapPoint:Pe.with(()=>K(),at=>{Me()||K(at),B()(at)}),onRelease:Pe.with(()=>V()),onDrag:Pe.with(()=>oe()),onClose:Pe.with(()=>ie()),dismissible:Pe.with(()=>te()),direction:Pe.with(()=>ue()),fixed:Pe.with(()=>ve()),modal:Pe.with(()=>De()),handleOnly:Pe.with(()=>pe()),noBodyStyles:Pe.with(()=>Ie()),preventScrollRestoration:Pe.with(()=>Oe()),setBackgroundColorOnScale:Pe.with(()=>ze()),repositionInputs:Pe.with(()=>xt()),autoFocus:Pe.with(()=>He()),snapToSequentialPoint:Pe.with(()=>Ye()),container:Pe.with(()=>Be())});let et;function pt(at){var Mt;(Mt=v())==null||Mt(at),at&&!j()?et=document.body.style.cssText:!at&&!j()&&Zp(Qi.DURATION*1e3,()=>{document.body.style.cssText=et}),!at&&!j()&&Ue.positionFixedState.restorePositionSetting(),setTimeout(()=>{var Yt;(Yt=We())==null||Yt(at)},Qi.DURATION*1e3),at&&!De()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),at||(document.body.style.pointerEvents="auto")}Ct(()=>()=>{j()||(document.body.style.cssText=et)});var ut=Xe(),ct=Le(ut);si(ct,()=>M1,(at,Mt)=>{Mt(at,Gt({controlledOpen:!0,get open(){return Ue.open.current},onOpenChange:Yt=>{Ue.onDialogOpenChange(Yt),pt(Yt)}},()=>Ae))}),_e(h,ut),It()}function j1(h,s){Pt(s,!0),Cb(()=>(s.onMounted(!0),()=>{s.onMounted(!1)})),It()}class yz{constructor(s=0){Ge(this,"value",0);this.value=s}}const _z=new yz(0);function U1(){return`vaul-${_z.value++}`}var vz=Et("<!> <!>",1);function xz(h,s){Pt(s,!0);let g=ee(s,"id",19,U1),v=ee(s,"ref",15,null),T=ee(s,"onOpenAutoFocus",3,Pn),C=ee(s,"onInteractOutside",3,Pn),b=ee(s,"oncontextmenu",3,Pn),c=ee(s,"onpointerdown",3,Pn),j=ee(s,"onpointerup",3,Pn),U=ee(s,"onpointerout",3,Pn),K=ee(s,"onpointermove",3,Pn),B=ee(s,"preventScroll",3,!0),V=Kt(s,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const oe=dz({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ve=>v(ve)),onContextMenu:Pe.with(()=>b()??Pn),onInteractOutside:Pe.with(()=>C()),onPointerDown:Pe.with(()=>c()??Pn),onPointerMove:Pe.with(()=>K()??Pn),onPointerOut:Pe.with(()=>U()??Pn),onPointerUp:Pe.with(()=>j()??Pn),onOpenAutoFocus:Pe.with(()=>T())}),ie=Te(()=>Vi(V,oe.props));var te=Xe(),ue=Le(te);si(ue,()=>z1,(ve,pe)=>{pe(ve,Gt(()=>L(ie),{get preventScroll(){return B()},get onInteractOutside(){return oe.onInteractOutside},get onFocusOutside(){return oe.onFocusOutside},get onOpenAutoFocus(){return oe.onOpenAutoFocus},children:(Ie,Oe)=>{var ze=vz(),We=Le(ze);Ot(We,()=>s.children??ti);var $e=Wt(We,2);j1($e,{onMounted:xt=>oe.mounted=xt}),_e(Ie,ze)},$$slots:{default:!0}}))}),_e(h,te),It()}var bz=Et("<!> <!>",1);function wz(h,s){Pt(s,!0);let g=ee(s,"id",19,U1),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=pz({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),U=>v(U))}),b=Te(()=>Vi(T,C.props));var c=Xe(),j=Le(c);si(j,()=>l1,(U,K)=>{K(U,Gt({get ref(){return v()},set ref(B){v(B)}},()=>L(b),{children:(B,V)=>{var oe=bz(),ie=Le(oe);j1(ie,{onMounted:ue=>{C.mounted=ue}});var te=Wt(ie,2);Ot(te,()=>s.children??ti),_e(B,oe)},$$slots:{default:!0}}))}),_e(h,c),It()}function Sz(h,s){Pt(s,!0);const g=fz();let v=ee(s,"to",19,()=>g.props.to),T=Kt(s,["$$slots","$$events","$$legacy","to"]);var C=Xe(),b=Le(C);si(b,()=>Sv,(c,j)=>{j(c,Gt({get to(){return v()}},()=>T))}),_e(h,C),It()}const Tz=Jb,Pz=c1;function Iz(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("fixed inset-0 z-50 bg-black/80",s.class));si(C,()=>wz,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}var Cz=Et('<div class="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"></div> <!>',1),Az=Et("<!> <!>",1);function kz(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=Xe(),C=Le(T);si(C,()=>Sz,(b,c)=>{c(b,Gt(()=>s.portalProps,{children:(j,U)=>{var K=Az(),B=Le(K);Iz(B,{});var V=Wt(B,2),oe=Te(()=>Ni("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",s.class));si(V,()=>xz,(ie,te)=>{te(ie,Gt({get ref(){return g()},set ref(ue){g(ue)},get class(){return L(oe)}},()=>v,{children:(ue,ve)=>{var pe=Cz(),Ie=Wt(Le(pe),2);Ot(Ie,()=>s.children??ti),_e(ue,pe)},$$slots:{default:!0}}))}),_e(j,K)},$$slots:{default:!0}}))}),_e(h,T),It()}function Ez(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-sm text-muted-foreground",s.class));si(C,()=>Pz,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}var Mz=Et("<div><!></div>");function zz(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=Mz();let C;var b=qt(T);Ot(b,()=>s.children??ti),Vt(T),Vc(T,c=>g(c),()=>g()),zt(()=>C=ji(T,C,{class:Ni("grid gap-1.5 p-4 text-center sm:text-left",s.class),...v})),_e(h,T),It()}function Dz(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-lg font-semibold leading-none tracking-tight",s.class));si(C,()=>Tz,(c,j)=>{j(c,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),_e(h,T),It()}function Lz(h,s){let g=ee(s,"shouldScaleBackground",3,!0),v=ee(s,"open",15,!1),T=ee(s,"activeSnapPoint",15,null),C=Kt(s,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var b=Xe(),c=Le(b);si(c,()=>gz,(j,U)=>{U(j,Gt({get shouldScaleBackground(){return g()},get open(){return v()},set open(K){v(K)},get activeSnapPoint(){return T()},set activeSnapPoint(K){T(K)}},()=>C))}),_e(h,b)}function Rz(h,s){Pt(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"sideOffset",3,4),T=ee(s,"align",3,"center"),C=Kt(s,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var b=Xe(),c=Le(b);si(c,()=>Sv,(j,U)=>{U(j,Gt(()=>s.portalProps,{children:(K,B)=>{var V=Xe(),oe=Le(V),ie=Te(()=>Ni("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s.class));si(oe,()=>gE,(te,ue)=>{ue(te,Gt({get ref(){return g()},set ref(ve){g(ve)},get sideOffset(){return v()},get align(){return T()},get class(){return L(ie)}},()=>C))}),_e(K,V)},$$slots:{default:!0}}))}),_e(h,b),It()}const Oz=SE,Fz=_E,Bz=[{value:"architecture-fine-arts-library",label:"Architecture/Fine Arts Library",description:"The Architecture/Fine Arts Library supports the teaching and research requirements of the Faculty of Architecture, which includes programs in Architecture, City Planning, Interior Design and Landscape Architecture, as well as the School of Art with programs in Fine Arts and Art History.",location:{lat:49.80815612216234,lng:-97.13530152378586},hours:{monday:[{open:"08:30",close:"17:30"}],tuesday:[{open:"08:30",close:"17:30"}],wednesday:[{open:"08:30",close:"17:30"}],thursday:[{open:"08:30",close:"17:30"}],friday:[{open:"08:30",close:"17:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/CFbxpALxC7HpwdBx8"}},{value:"donald-craik-engineering-library",label:"Donald W. Craik Engineering Library",description:"The Donald W. Craik Engineering Library serves engineeirng resources, including books, journals, and electronic databases, to support academic and research needs of students and faculty.",location:{lat:49.80835859585458,lng:-97.13445434076718},alwaysOpen:!0,metadata:{amenities:["WiFi"]}},{value:"e-k-williams-law-library",label:"E. K. Williams Law Library",description:"E.K. Williams Law Library primarily serves the teaching and research needs of the Faculty of Law and the University. The library is also an integral part of the legal resources of Manitoba, where it plays a prominent role in the delivery of legal information to the members of the legal profession, the judiciary, other professional groups, and the general public.",location:{lat:49.81194940624498,lng:-97.13047415092316},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/NzVn21YBon12p11e8"}},{value:"eckhardt-gramatte-music-library",label:"Eckhardt Gramatté Music Library",description:"The Eckhardt Gramatté Music Library supports study, research, and performance at the University of Manitoba. As a unit of the University of Manitoba Libraries, the Music Library provides a vast range of print, recorded and electronic resources to students, faculty and staff of the University as well as members of the public.",location:{lat:49.80784297695002,lng:-97.1321825540353},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/BkewBe4p6jjSWEgb7"}},{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/pq5cGKjbKwuJFan86"}},{value:"father-harold-drake-library",label:"St. Paul's College",description:"The Fr. Harold Drake Library at St. Paul's College focuses on supporting the teaching and research needs of staff and students at St. Paul's College including the Jesuit Centre for Catholic Studies and Arthur V. Mauro Institute for Peace and Justice.",location:{lat:49.81045700369361,lng:-97.13799926192738},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/JGQEwkeyEtG1cDCbA"}},{value:"jim-peebles-science-and-technology-library",label:"Jim Peebles Science and Technology Library",description:"The Jim Peebles Science and Technology Library serves the research, study, and teaching requirements of the Faculties of Science, Engineering, Agricultural and Food Sciences, and Environment, Earth, and Resources.",location:{lat:49.81121151579056,lng:-97.13336330797407},hours:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/48NVXVD6kGeSoEue9"}}],Nz=[{value:"john-p-robarts-research-library",label:"John P. Robarts Research Library",description:"Massive research center at the University of Toronto, focused on arts, social sciences & government.",location:{lat:43.66446804156252,lng:-79.3995157978792},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"09:00",close:"22:00"}],sunday:[{open:"10:00",close:"22:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/zVf6CFQA5SnRtxNW7"}},{value:"e-j-pratt-library",label:"E. J. Pratt Library",description:"Supports undergraduate programs in the humanities and social sciences, including specialized Victoria College programs.",location:{lat:43.666364235118486,lng:-79.39129020831867},hours:{monday:[{open:"09:00",close:"23:45"}],tuesday:[{open:"09:00",close:"23:45"}],wednesday:[{open:"09:00",close:"23:45"}],thursday:[{open:"09:00",close:"23:45"}],friday:[{open:"09:00",close:"18:45"}],saturday:[{open:"10:00",close:"23:45"}],sunday:[{open:"10:00",close:"23:45"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/YuWigtdeDz7ETeBq6"}},{value:"gerstein-science-information-centre",label:"Gerstein Science Information Centre",description:"The largest science and health science academic library with a collection consisting primarily of material on the sciences.",location:{lat:43.66207857639802,lng:-79.39370214277896},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"22:00"}],saturday:[{open:"09:00",close:"22:00"}],sunday:[{open:"10:00",close:"22:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/ZXPQSTgZTcYmQAm6A"}},{value:"knox-college",label:"Knox College",description:"Knox College is a diverse community committed to the ideals of intellectual engagement, critical inquiry, and integrity, as well as to the principles of excellence, fairness, and respect for all people.",location:{lat:43.66132661472304,lng:-79.39707027756067},hours:{monday:[{open:"08:00",close:"16:30"}],tuesday:[{open:"08:00",close:"16:30"}],wednesday:[{open:"08:00",close:"16:30"}],thursday:[{open:"08:00",close:"16:30"}],friday:[{open:"08:00",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/fPj3gTJWDYjevyCV9"}},{value:"university-college-library",label:"University College Library",description:"The University College Library offers a large study space with lots of natural light, 20 computers, a group study room, and is also the home of the UC Writing Centre.",location:{lat:43.66295474108995,lng:-79.39540967937556},hours:{monday:[{open:"09:00",close:"20:00"}],tuesday:[{open:"09:00",close:"20:00"}],wednesday:[{open:"09:00",close:"20:00"}],thursday:[{open:"09:00",close:"20:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"13:00",close:"17:00"}],sunday:[{open:"13:00",close:"17:00"}]},metadata:{amenities:["WiFi","Outlets","Printing","Water Fountains","Computers"],link:"https://maps.app.goo.gl/ZGF3MEeBhrcLDmbt9"}},{value:"myhal-centre-for-engineering",label:"Myhal Centre for Engineering Innovation and Entrepreneurship",description:"The Myhal Centre is designed to foster collaboration between researchers, students, industry partners and alumni, sparking the exchange of new ideas and catalyzing innovation.",location:{lat:43.660773623027836,lng:-79.39671147994689},hours:{monday:[{open:"07:00",close:"23:00"}],tuesday:[{open:"07:00",close:"23:00"}],wednesday:[{open:"07:00",close:"23:00"}],thursday:[{open:"07:00",close:"23:00"}],friday:[{open:"07:00",close:"23:00"}],saturday:[{open:"08:30",close:"20:00"}],sunday:[{open:"08:30",close:"20:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/zvgpytTr524PNFYt8"}},{value:"bahen-centre-for-information-technology",label:"Bahen Centre for Information Technology",description:"The Bahen Centre for Information Technology in Toronto, ON is a facility dedicated to advancing research and education in the field of information technology.",location:{lat:43.659955698049664,lng:-79.3972051681471},hours:{monday:[{open:"08:30",close:"21:00"}],tuesday:[{open:"08:30",close:"21:00"}],wednesday:[{open:"08:30",close:"21:00"}],thursday:[{open:"08:30",close:"21:00"}],friday:[{open:"08:30",close:"18:00"}],saturday:[],sunday:[{open:"08:30",close:"21:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/LTRHuzjD4QxYuiJKA"}},{value:"sidney-smith-hall",label:"Sidney Smith Hall",description:"The Sidney Smith Commons is a an academic resource to help Arts & Science students through their undergraduate journey.",location:{lat:43.66271896031365,lng:-79.39855745074708},hours:{monday:[{open:"10:00",close:"18:30"}],tuesday:[{open:"10:00",close:"18:30"}],wednesday:[{open:"10:00",close:"18:30"}],thursday:[{open:"10:00",close:"18:30"}],friday:[{open:"10:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Hgzsqy7pbPqYGrHj9"}},{value:"medical-sciences-building",label:"Medical Sciences Building",description:"The Temerty Faculty of Medicine at the University of Toronto is at the centre of one of North America’s largest biomedical research, education and clinical care networks.",location:{lat:43.66093893044146,lng:-79.39343029804239},hours:{monday:[{open:"08:45",close:"17:00"}],tuesday:[{open:"08:45",close:"17:00"}],wednesday:[{open:"08:45",close:"17:00"}],thursday:[{open:"08:45",close:"17:00"}],friday:[{open:"08:45",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets","Water Fountains"],link:"https://maps.app.goo.gl/Dv6dvftxwTD2hHLT9"}},{value:"music-library",label:"Music Library",description:"The Music Library features articles, scores, encyclopedias, dissertations, and streaming media related to the study of music.",location:{lat:43.666597437748635,lng:-79.39435735738708},hours:{monday:[{open:"08:30",close:"19:00"}],tuesday:[{open:"08:30",close:"19:00"}],wednesday:[{open:"08:30",close:"19:00"}],thursday:[{open:"08:30",close:"19:00"}],friday:[{open:"08:30",close:"18:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/CxKfwqXP62PHbHKAA"}},{value:"gail-brooker-library",label:"Gail Brooker Library",description:"The library has collections covering the decorative arts as they relate to ceramic objects manufactured in England, France, Italy, Austria and Germany.",location:{lat:43.66819955524035,lng:-79.39308239668598},hours:{monday:[{open:"13:00",close:"16:00"}],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/AKdVpGR55NJu5e98A"}},{value:"rotman-school-of-management",label:"Rotman School of Management",description:"Rotman School of Management in Toronto offers innovative business education, integrative thinking, leadership development, and prime access to networking in Canada’s dynamic economic and cultural hub.",location:{lat:43.66539062727333,lng:-79.39854570027774},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/yVbwJV4Le6tS3mzc9"}},{value:"emmanuel-college-library",label:"Emmanuel College Library",description:"Emmanuel College, within the University of Toronto, offers theological education emphasizing social justice, interfaith dialogue, and access to rich academic and urban resources.",location:{lat:43.66683513656461,lng:-79.39286966347382},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"13:00",close:"17:00"}],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/GrMVn3G9JXVa9Htz5"}},{value:"ivey-library",label:"Ivey Library",description:"Ivey Library, at Emmanuel College in the University of Toronto, provides specialized theological resources, study spaces, and support, fostering academic excellence in a vibrant environment.",location:{lat:43.66195183556734,lng:-79.40017968749},alwaysOpen:!0,metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/jsJNhaiQ1QXie69H8"}},{value:"eberhard-zeidler-library",label:"Eberhard Zeidler Library",description:"The Eberhard Zeidler Library, located within the University of Toronto’s Daniels Building, offers extensive resources in architecture, landscape architecture, and urban design, supporting academic excellence.",location:{lat:43.65948402826712,lng:-79.4006472022839},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"19:00"}],saturday:[{open:"12:00",close:"17:00"}],sunday:[{open:"12:00",close:"17:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/azSiqBsWBNNGk2mx6"}},{value:"earth-sciences-library",label:"Earth Sciences Library",description:"The Noranda Earth Sciences Library at the University of Toronto offers extensive resources in geology and environmental science, supporting research and learning in Earth Sciences.",location:{lat:43.66057710831297,lng:-79.39973551814924},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"18:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/vzitf925LX81BHj8A"}},{value:"engineering-and-computer-science-library",label:"Engineering and Computer Science Library",description:"The Engineering and Computer Science Library at the University of Toronto offers extensive resources and study spaces, supporting engineering and computer science research and education.",location:{lat:43.660274633220986,lng:-79.3948690894763},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"10:00",close:"17:00"}],sunday:[{open:"13:00",close:"18:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/hFNNWom4EfdPZzhu8"}},{value:"john-m-kelly-library",label:"John M. Kelly Library",description:"The John M. Kelly Library at the University of St. Michael’s College, University of Toronto, offers extensive humanities and social sciences collections, supporting diverse academic programs.",location:{lat:43.665375420435694,lng:-79.38947345882741},hours:{monday:[{open:"08:30",close:"23:30"}],tuesday:[{open:"08:30",close:"23:30"}],wednesday:[{open:"08:30",close:"23:30"}],thursday:[{open:"08:30",close:"23:30"}],friday:[{open:"08:30",close:"23:30"}],saturday:[{open:"10:00",close:"23:30"}],sunday:[{open:"13:00",close:"23:30"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/7m9AsVYX1swhaqTk6"}},{value:"a-d-allen-chemistry-library",label:"A. D. Allen Chemistry Library",description:"The A.D. Allen Chemistry Library at the University of Toronto offers extensive resources and study spaces, supporting chemistry research and education.",location:{lat:43.66179180735074,lng:-79.39779551746699},hours:{monday:[{open:"10:00",close:"19:00"}],tuesday:[{open:"10:00",close:"19:00"}],wednesday:[{open:"10:00",close:"19:00"}],thursday:[{open:"10:00",close:"19:00"}],friday:[{open:"10:00",close:"19:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/yDvihnazaA8s8hsT6"}},{value:"mathematical-sciences-library",label:"Mathematical Sciences Library",description:"The Mathematical Sciences Library at the University of Toronto offers extensive resources and study spaces, supporting research and education in mathematics and statistical sciences.",location:{lat:43.6597359794816,lng:-79.39706012591914},hours:{monday:[{open:"09:00",close:"17:00"}],tuesday:[{open:"09:00",close:"17:00"}],wednesday:[{open:"09:00",close:"17:00"}],thursday:[{open:"09:00",close:"17:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/2WRmtdVU4rT5yZAj9"}},{value:"innis-college",label:"Innis College",description:"Innis College, established in 1964 at the University of Toronto, offers programs in Cinema Studies, Urban Studies, and Writing and Rhetoric, fostering a vibrant academic community.",location:{lat:43.66573524927401,lng:-79.39961603167595},hours:{monday:[{open:"08:00",close:"21:00"}],tuesday:[{open:"08:00",close:"21:00"}],wednesday:[{open:"08:00",close:"21:00"}],thursday:[{open:"08:00",close:"21:00"}],friday:[{open:"08:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/5tSLpqGGv14qguu7A"}},{value:"john-w-graham-library",label:"John W. Graham Library",description:"The John W. Graham Library, serving Trinity and Wycliffe Colleges at the University of Toronto, offers extensive theological resources and study spaces, supporting academic excellence.",location:{lat:43.665259408603106,lng:-79.39633787389684},hours:{monday:[{open:"08:30",close:"23:45"}],tuesday:[{open:"08:30",close:"23:45"}],wednesday:[{open:"08:30",close:"23:45"}],thursday:[{open:"08:30",close:"23:45"}],friday:[{open:"08:30",close:"19:45"}],saturday:[{open:"09:15",close:"19:45"}],sunday:[{open:"13:15",close:"23:45"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/jzi12m7qvCDYWqMM9"}},{value:"regis-college",label:"Regis College",description:"Regis College, the Jesuit Faculty of Theology at the University of Toronto, offers programs in theology and ministry, emphasizing Jesuit traditions and academic excellence.",location:{lat:43.664229501433454,lng:-79.38998668479978},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Ad87rAjcvttdiRkv6"}},{value:"bora-laskin-law-library",label:"Bora Laskin Law Library",description:"The Bora Laskin Law Library at the University of Toronto supports legal research and education with extensive collections and study spaces.",location:{lat:43.666186648399915,lng:-79.3938063340236},hours:{monday:[{open:"08:45",close:"23:00"}],tuesday:[{open:"08:45",close:"23:00"}],wednesday:[{open:"08:45",close:"23:00"}],thursday:[{open:"08:45",close:"23:00"}],friday:[{open:"08:45",close:"20:00"}],saturday:[{open:"10:00",close:"20:00"}],sunday:[{open:"10:00",close:"20:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Q8Yuvam1aLqhPuBf7"}},{value:"dentistry-library",label:"Dentistry Library",description:"The Dentistry Library at the University of Toronto offers extensive dental resources and study spaces, supporting research and education in dental sciences.",location:{lat:43.656384016321454,lng:-79.38703499453736},hours:{monday:[{open:"09:00",close:"17:00"}],tuesday:[{open:"09:00",close:"17:00"}],wednesday:[{open:"09:00",close:"17:00"}],thursday:[{open:"09:00",close:"17:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/3J7bHokjDudEZiG56"}},{value:"utsu-student-commons",label:"UTSU Student Commons",description:"The UTSU Student Commons, located at 230 College Street, serves as a central hub for University of Toronto students. It offers study spaces, meeting rooms, lounges, and a café, fostering community engagement and providing resources for student activities.",location:{lat:43.65867796664493,lng:-79.3978822751627},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/eAYLPrwRvF4h8avk8"}},{value:"oise-library",label:"OISE Library",description:"The OISE Library at the University of Toronto is Canada’s largest academic education library, supporting teacher training, graduate studies, and research in education.",location:{lat:43.66803443817239,lng:-79.39858835469845},hours:{monday:[{open:"09:00",close:"16:00"}],tuesday:[{open:"09:00",close:"16:00"}],wednesday:[{open:"09:00",close:"16:00"}],thursday:[{open:"09:00",close:"16:00"}],friday:[{open:"09:00",close:"16:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/6fg5ikSrUb1zav2G9"}}],Vz=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46970996120006,lng:-80.54228100658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/5xkMePMsgStWSzgF8"}},{value:"david-centre-library",label:"Davis Centre Library",description:"The Davis Centre Library houses resources for engineering, mathematics, and science.",location:{lat:43.47298768397052,lng:-80.5419473517104},hours:{monday:[{open:"08:00",close:"24:00"}],tuesday:[{open:"08:00",close:"24:00"}],wednesday:[{open:"08:00",close:"24:00"}],thursday:[{open:"08:00",close:"24:00"}],friday:[{open:"08:00",close:"24:00"}],saturday:[{open:"11:00",close:"24:00"}],sunday:[{open:"11:00",close:"24:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/Z5CsTbspAfcd8XGS7"}}],fb=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.133},spaces:Bz,metadata:{timezone:"America/Winnipeg"}},{value:"university-of-toronto",label:"University of Toronto",location:{lat:43.662,lng:-79.398},spaces:Nz,metadata:{timezone:"America/Toronto",display:{bearing:45,zoom:15.5}}},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:Vz,metadata:{timezone:"America/Toronto"}}];var dm={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var jz=dm.exports,mb;function Uz(){return mb||(mb=1,function(h,s){(function(g,v){h.exports=v()})(jz,function(){var g={},v={};function T(b,c,j){if(v[b]=j,b==="index"){var U="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",K={};return v.shared(K),v.index(g,K),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([U],{type:"text/javascript"}))),g}}T("shared",["exports"],function(b){function c(i,t,n,o){return new(n||(n=Promise))(function(u,f){function m(P){try{x(o.next(P))}catch(A){f(A)}}function y(P){try{x(o.throw(P))}catch(A){f(A)}}function x(P){var A;P.done?u(P.value):(A=P.value,A instanceof n?A:new n(function(E){E(A)})).then(m,y)}x((o=o.apply(i,t||[])).next())})}function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var U=K;function K(i,t){this.x=i,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(i){return i instanceof K?i:Array.isArray(i)?new K(i[0],i[1]):i};var B=j(U),V=oe;function oe(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}oe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var m=0,y=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ie=j(V);let te,ue;function ve(){return te==null&&(te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),te}function pe(){if(ue==null&&(ue=!1,ve())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ue=!0;break}}}return ue||!1}function Ie(i,t,n,o){const u=new ie(i,t,n,o);return f=>u.solve(f)}const Oe=Ie(.25,.1,.25,1);function ze(i,t,n){return Math.min(n,Math.max(t,i))}function We(i,t,n){const o=n-t,u=((i-t)%o+o)%o+t;return u===t?n:u}function $e(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let xt=1;function He(i,t,n){const o={};for(const u in i)o[u]=t.call(this,i[u],u,i);return o}function Ye(i,t,n){const o={};for(const u in i)t.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function Be(i){return Array.isArray(i)?i.map(Be):typeof i=="object"&&i?He(i,Be):i}const Me={};function De(i){Me[i]||(typeof console<"u"&&console.warn(i),Me[i]=!0)}function Ae(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Ue(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let et=null;function pt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ct(i,t,n,o,u){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,function(P,A,E,D,F){const q=4*Math.max(-A,0),Z=(Math.max(0,E)-E)*D*4+q,J=4*D,re=Math.max(0,A),we=Math.max(0,E);return{rect:{x:re,y:we,width:Math.min(P.width,A+D)-re,height:Math.min(P.height,E+F)-we},layout:[{offset:Z,stride:J}]}}(i,t,n,o,u)),y)for(let P=0;P<x.length;P+=4){const A=x[P];x[P]=x[P+2],x[P+2]=A}return x}finally{f.close()}})}let at,Mt;const Yt="AbortError";function yi(){return new Error(Yt)}const Pi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fi(i){return Pi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const sn="global-dispatcher";class Ui extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const Hi=()=>Ue(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Fi(i.url);if(o)return o(i,t);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:sn},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Hi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return c(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Hi(),signal:u.signal});o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const m=yield fetch(f);if(!m.ok){const P=yield m.blob();throw new Ui(m.status,m.statusText,o.url,P)}let y;y=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const x=yield y;if(u.signal.aborted)throw yi();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:sn},t)}var n;return function(o,u){return new Promise((f,m)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const P in o.headers)x.setRequestHeader(P,o.headers[P]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let P=x.response;if(o.type==="json")try{P=JSON.parse(x.response)}catch(A){return void m(A)}f({data:P,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const P=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new Ui(x.status,x.statusText,o.url,P))}},u.signal.addEventListener("abort",()=>{x.abort(),m(yi())}),x.send(o.body)})}(i,t)};function Xi(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function xi(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function cn(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class Ki{constructor(t,n={}){$e(this,n),this.type=t}}class mt extends Ki{constructor(t,n={}){super("error",$e({error:t},n))}}class Bt{on(t,n){return this._listeners=this._listeners||{},xi(t,n,this._listeners),this}off(t,n){return cn(t,n,this._listeners),cn(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xi(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Ki(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)cn(o,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&($e(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof mt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ki=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function In(i,t){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return ki.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Ht(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Ht(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!Ht(i[n],t[n]))return!1;return!0}return i===t}function li(i,t){i.push(t)}function sr(i,t,n){li(n,{command:"addSource",args:[i,t[i]]})}function _n(i,t,n){li(t,{command:"removeSource",args:[i]}),n[i]=!0}function Xn(i,t,n,o){_n(i,n,o),sr(i,t,n)}function Zr(i,t,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!Ht(i[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Ht(i[n][o],t[n][o]))return!1;return!0}function dn(i,t,n,o,u,f){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||n.push({command:f,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||n.push({command:f,args:[o,m,t[m],u]}))}function us(i){return i.id}function Es(i,t){return i[t.id]=t,i}class Je{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function mr(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}class vn extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Pr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Pr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ir={kind:"null"},tt={kind:"number"},$t={kind:"string"},Ft={kind:"boolean"},Cn={kind:"color"},xn={kind:"object"},Nt={kind:"value"},or={kind:"collator"},Qr={kind:"formatted"},hs={kind:"padding"},Gr={kind:"resolvedImage"},ne={kind:"variableAnchorOffsetCollection"};function O(i,t){return{kind:"array",itemType:i,N:t}}function R(i){if(i.kind==="array"){const t=R(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const W=[Ir,tt,$t,Ft,Cn,Qr,xn,O(Nt),hs,Gr,ne];function Y(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Y(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of W)if(!Y(n,t))return null}}return`Expected ${R(i)} but found ${R(t)} instead.`}function de(i,t){return t.some(n=>n.kind===i.kind)}function me(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function xe(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const le=.96422,Ee=.82521,Ne=4/29,Ce=6/29,it=3*Ce*Ce,kt=Ce*Ce*Ce,Dt=Math.PI/180,ci=180/Math.PI;function Xt(i){return(i%=360)<0&&(i+=360),i}function ui([i,t,n,o]){let u,f;const m=on((.2225045*(i=ii(i))+.7168786*(t=ii(t))+.0606169*(n=ii(n)))/1);i===t&&t===n?u=f=m:(u=on((.4360747*i+.3850649*t+.1430804*n)/le),f=on((.0139322*i+.0971045*t+.7141733*n)/Ee));const y=116*m-16;return[y<0?0:y,500*(u-m),200*(m-f),o]}function ii(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function on(i){return i>kt?Math.pow(i,1/3):i/it+Ne}function Zi([i,t,n,o]){let u=(i+16)/116,f=isNaN(t)?u:u+t/500,m=isNaN(n)?u:u-n/200;return u=1*_i(u),f=le*_i(f),m=Ee*_i(m),[Qt(3.1338561*f-1.6168667*u-.4906146*m),Qt(-.9787684*f+1.9161415*u+.033454*m),Qt(.0719453*f-.2289914*u+1.4052427*m),o]}function Qt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function _i(i){return i>Ce?i*i*i:it*(i-Ne)}function Bi(i){return parseInt(i.padEnd(2,i),16)/255}function pn(i,t){return bn(t?i/100:i,0,1)}function bn(i,t,n){return Math.min(Math.max(t,i),n)}function Bn(i){return!i.some(Number.isNaN)}const no={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class vi{constructor(t,n,o,u=1,f=!0){this.r=t,this.g=n,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof vi)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=no[o];if(u){const[m,y,x]=u;return[m/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let y=1;return[Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,P,A,E,D,F,q,Z,J,re,we]=m,he=[A||" ",F||" ",J].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const ye=[P,D,Z].join(""),ke=ye==="%%%"?100:ye===""?255:0;if(ke){const Ze=[bn(+x/ke,0,1),bn(+E/ke,0,1),bn(+q/ke,0,1),re?pn(+re,we):1];if(Bn(Ze))return Ze}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,x,P,A,E,D,F,q]=f,Z=[x||" ",A||" ",D].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const J=[+y,bn(+P,0,100),bn(+E,0,100),F?pn(+F,q):1];if(Bn(J))return function([re,we,he,ye]){function ke(Ze){const ft=(Ze+re/30)%12,Lt=we*Math.min(he,1-he);return he-Lt*Math.max(-1,Math.min(ft-3,9-ft,1))}return re=Xt(re),we/=100,he/=100,[ke(0),ke(8),ke(4),ye]}(J)}}}(t);return n?new vi(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[t/f,n/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,u,f]=ui(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?Xt(Math.atan2(u,o)*ci):NaN,m,n,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ui(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map(f=>Math.round(255*f)).join(",")},${u})`}}vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1);class $c{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jc{constructor(t,n,o,u,f){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=f}}class ar{constructor(t){this.sections=t}static fromString(t){return new ar([new Jc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ar?t:ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class lr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof lr)return t;if(typeof t=="number")return new lr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new lr(t)}}toString(){return JSON.stringify(this.values)}}const fy=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!fy.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new gr(t)}}toString(){return JSON.stringify(this.values)}}class cr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new cr({name:t,available:!1}):null}}function ro(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vi||i instanceof $c||i instanceof ar||i instanceof lr||i instanceof gr||i instanceof cr)return!0;if(Array.isArray(i)){for(const t of i)if(!Ms(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ms(i[t]))return!1;return!0}return!1}function an(i){if(i===null)return Ir;if(typeof i=="string")return $t;if(typeof i=="boolean")return Ft;if(typeof i=="number")return tt;if(i instanceof vi)return Cn;if(i instanceof $c)return or;if(i instanceof ar)return Qr;if(i instanceof lr)return hs;if(i instanceof gr)return ne;if(i instanceof cr)return Gr;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const u=an(o);if(n){if(n===u)continue;n=Nt;break}n=u}return O(n||Nt,t)}return xn}function ca(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof vi||i instanceof ar||i instanceof lr||i instanceof gr||i instanceof cr?i.toString():JSON.stringify(i)}class Cr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ms(t[1]))return n.error("invalid value");const o=t[1];let u=an(o);const f=n.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Cr(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class en{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ja={string:$t,number:tt,boolean:Ft,object:xn};class Ar{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ja)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ja[P],u++}else y=Nt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}o=O(y,x)}else{if(!Ja[f])throw new Error(`Types doesn't contain name = ${f}`);o=Ja[f]}const m=[];for(;u<t.length;u++){const y=n.parse(t[u],u,Nt);if(!y)return null;m.push(y)}return new Ar(o,m)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Y(this.type,an(o)))return o;if(n===this.args.length-1)throw new en(`Expected value to be of type ${R(this.type)}, but found ${R(an(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Yc={"to-boolean":Ft,"to-color":Cn,"to-number":tt,"to-string":$t};class kr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Yc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Yc[o],f=[];for(let m=1;m<t.length;m++){const y=n.parse(t[m],m,Nt);if(!y)return null;f.push(y)}return new kr(u,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof vi)return n;if(typeof n=="string"){const f=t.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ro(n[0],n[1],n[2],n[3]),!o))return new vi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new en(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=lr.parse(n);if(u)return u}throw new en(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=gr.parse(n);if(u)return u}throw new en(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new en(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return ar.fromString(ca(this.args[0].evaluate(t)));case"resolvedImage":return cr.fromString(ca(this.args[0].evaluate(t)));default:return ca(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const my=["Unknown","Point","LineString","Polygon"];class Ya{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?my[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=vi.parse(t)),n}}class zs{constructor(t,n,o=[],u,f=new Pr,m=[]){this.registry=t,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=m,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,f={}){return n?this.concat(n,o,u)._parse(t,f):this._parse(t,f)}_parse(t,n){function o(u,f,m){return m==="assert"?new Ar(f,[u]):m==="coerce"?new kr(f,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"assert")}if(!(m instanceof Cr)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new Ya;try{m=new Cr(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,f=o?this.scope.concat(o):this.scope;return new zs(this.registry,this._isConstant,u,n||null,f,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new vn(o,t))}checkSubtype(t,n){const o=Y(t,n);return o&&this.error(o),o}}class ds{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(t[f+1],f+1);if(!y)return null;o.push([m,y])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new ds(o,u):null}outputDefined(){return this.result.outputDefined()}}class mi{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new mi(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Qc{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,tt),u=n.parse(t[2],2,O(n.expectedType||Nt));return o&&u?new Qc(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new en(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new en(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new en(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class eu{constructor(t,n){this.type=Ft,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,Nt);return o&&u?de(o.type,[Ft,$t,tt,Ir,Nt])?new eu(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!me(n,["boolean","string","number","null"]))throw new en(`Expected first argument to be of type boolean, string, number or null, but found ${R(an(n))} instead.`);if(!me(o,["string","array"]))throw new en(`Expected second argument to be of type array or string, but found ${R(an(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class so{constructor(t,n,o){this.type=tt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,Nt);if(!o||!u)return null;if(!de(o.type,[Ft,$t,tt,Ir,Nt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`);if(t.length===4){const f=n.parse(t[3],3,tt);return f?new so(o,u,f):null}return new so(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!me(n,["boolean","string","number","null"]))throw new en(`Expected first argument to be of type boolean, string, number or null, but found ${R(an(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),me(o,["string"])){const f=o.indexOf(n,u);return f===-1?-1:[...o.slice(0,f)].length}if(me(o,["array"]))return o.indexOf(n,u);throw new en(`Expected second argument to be of type array or string, but found ${R(an(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class tu{constructor(t,n,o,u,f,m){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=f,this.otherwise=m}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const f={},m=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const E=t[P+1];Array.isArray(A)||(A=[A]);const D=n.concat(P);if(A.length===0)return D.error("Expected at least one branch label.");for(const q of A){if(typeof q!="number"&&typeof q!="string")return D.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,an(q)))return null}else o=an(q);if(f[String(q)]!==void 0)return D.error("Branch labels must be unique.");f[String(q)]=m.length}const F=n.parse(E,P,u);if(!F)return null;u=u||F.type,m.push(F)}const y=n.parse(t[1],1,Nt);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,u);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(o,y.type)?null:new tu(o,u,y,f,m,x):null}evaluate(t){const n=this.input.evaluate(t);return(an(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const y=n.parse(t[m],m,Ft);if(!y)return null;const x=n.parse(t[m+1],m+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=n.parse(t[t.length-1],t.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Qa(o,u,f)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class ua{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,tt);if(!o||!u)return null;if(!de(o.type,[O(Nt),$t,Nt]))return n.error(`Expected first argument to be of type array or string, but found ${R(o.type)} instead`);if(t.length===4){const f=n.parse(t[3],3,tt);return f?new ua(o.type,o,u,f):null}return new ua(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),me(n,["string"]))return[...n].slice(o,u).join("");if(me(n,["array"]))return n.slice(o,u);throw new en(`Expected first argument to be of type array or string, but found ${R(an(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function el(i,t){const n=i.length-1;let o,u,f=0,m=n,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),o=i[y],u=i[y+1],o<=t){if(y===n||t<u)return y;f=y+1}else{if(!(o>t))throw new en("Input is not a number.");m=y-1}return 0}class oo{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const u=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],P=m,A=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const E=n.parse(x,A,f);if(!E)return null;f=f||E.type,u.push([y,E])}return new oo(f,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const f=n.length;return u>=n[f-1]?o[f-1].evaluate(t):o[el(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Xp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var gy=Kp;function Kp(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}Kp.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var m=0,y=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var yy=Xp(gy);function Ds(i,t,n){return i+n*(t-i)}function ha(i,t,n){return i.map((o,u)=>Ds(o,t[u],n))}const Kn={number:Ds,color:function(i,t,n,o="rgb"){switch(o){case"rgb":{const[u,f,m,y]=ha(i.rgb,t.rgb,n);return new vi(u,f,m,y,!1)}case"hcl":{const[u,f,m,y]=i.hcl,[x,P,A,E]=t.hcl;let D,F;if(isNaN(u)||isNaN(x))isNaN(u)?isNaN(x)?D=NaN:(D=x,m!==1&&m!==0||(F=P)):(D=u,A!==1&&A!==0||(F=f));else{let we=x-u;x>u&&we>180?we-=360:x<u&&u-x>180&&(we+=360),D=u+n*we}const[q,Z,J,re]=function([we,he,ye,ke]){return we=isNaN(we)?0:we*Dt,Zi([ye,Math.cos(we)*he,Math.sin(we)*he,ke])}([D,F??Ds(f,P,n),Ds(m,A,n),Ds(y,E,n)]);return new vi(q,Z,J,re,!1)}case"lab":{const[u,f,m,y]=Zi(ha(i.lab,t.lab,n));return new vi(u,f,m,y,!1)}}},array:ha,padding:function(i,t,n){return new lr(ha(i.values,t.values,n))},variableAnchorOffsetCollection:function(i,t,n){const o=i.values,u=t.values;if(o.length!==u.length)throw new en(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const f=[];for(let m=0;m<o.length;m+=2){if(o[m]!==u[m])throw new en(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${o[m]}, to[${m}]: ${u[m]}`);f.push(o[m]);const[y,x]=o[m+1],[P,A]=u[m+1];f.push([Ds(y,P,n),Ds(x,A,n)])}return new gr(f)}};class $n{constructor(t,n,o,u,f){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,n,o,u){let f=0;if(t.name==="exponential")f=tl(n,t.base,o,u);else if(t.name==="linear")f=tl(n,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new yy(m[0],m[1],m[2],m[3]).solve(tl(n,1,o,u))}return f}static parse(t,n){let[o,u,f,...m]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const P=u[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:P}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const P=u.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,tt),!f)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Cn:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let P=0;P<m.length;P+=2){const A=m[P],E=m[P+1],D=P+3,F=P+4;if(typeof A!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=A)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const q=n.parse(E,F,x);if(!q)return null;x=x||q.type,y.push([A,q])}return xe(x,tt)||xe(x,Cn)||xe(x,hs)||xe(x,ne)||xe(x,O(tt))?new $n(x,o,u,f,y):n.error(`Type ${R(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const f=n.length;if(u>=n[f-1])return o[f-1].evaluate(t);const m=el(n,u),y=$n.interpolationFactor(this.interpolation,u,n[m],n[m+1]),x=o[m].evaluate(t),P=o[m+1].evaluate(t);switch(this.operator){case"interpolate":return Kn[this.type.kind](x,P,y);case"interpolate-hcl":return Kn.color(x,P,y,"hcl");case"interpolate-lab":return Kn.color(x,P,y,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function tl(i,t,n,o){const u=o-n,f=i-n;return u===0?0:t===1?f/u:(Math.pow(t,f)-1)/(Math.pow(t,u)-1)}class il{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of t.slice(1)){const x=n.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const m=u&&f.some(y=>Y(u,y.type));return new il(m?Nt:o,f)}evaluate(t){let n,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(t),o&&o instanceof cr&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function nl(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function $p(i,t,n,o){return o.compare(t,n)===0}function ao(i,t,n){const o=i!=="=="&&i!=="!=";return class q1{constructor(f,m,y){this.type=Ft,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Nt);if(!x)return null;if(!nl(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${R(x.type)}'.`);let P=m.parse(f[2],2,Nt);if(!P)return null;if(!nl(y,P.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${R(P.type)}'.`);if(x.type.kind!==P.type.kind&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${R(x.type)}' and '${R(P.type)}'.`);o&&(x.type.kind==="value"&&P.type.kind!=="value"?x=new Ar(P.type,[x]):x.type.kind!=="value"&&P.type.kind==="value"&&(P=new Ar(x.type,[P])));let A=null;if(f.length===4){if(x.type.kind!=="string"&&P.type.kind!=="string"&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,or),!A)return null}return new q1(x,P,A)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=an(m),P=an(y);if(x.kind!==P.kind||x.kind!=="string"&&x.kind!=="number")throw new en(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=an(m),P=an(y);if(x.kind!=="string"||P.kind!=="string")return t(f,m,y)}return this.collator?n(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const _y=ao("==",function(i,t,n){return t===n},$p),Jp=ao("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!$p(0,t,n,o)}),Yp=ao("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),vy=ao(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),xy=ao("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),Qp=ao(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class da{constructor(t,n,o){this.type=or,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ft);if(!u)return null;const f=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ft);if(!f)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,$t),!m)?null:new da(u,f,m)}evaluate(t){return new $c(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class iu{constructor(t,n,o,u,f){this.type=$t,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,$t),!f))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,$t),!m))return null;let y=null;if(u["min-fraction-digits"]&&(y=n.parse(u["min-fraction-digits"],1,tt),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=n.parse(u["max-fraction-digits"],1,tt),!x)?null:new iu(o,f,m,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class rl{constructor(t){this.type=Qr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,tt),!x))return null;let P=null;if(y["text-font"]&&(P=n.parse(y["text-font"],1,O($t)),!P))return null;let A=null;if(y["text-color"]&&(A=n.parse(y["text-color"],1,Cn),!A))return null;const E=u[u.length-1];E.scale=x,E.font=P,E.textColor=A}else{const x=n.parse(t[m],1,Nt);if(!x)return null;const P=x.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new rl(u)}evaluate(t){return new ar(this.sections.map(n=>{const o=n.content.evaluate(t);return an(o)===Gr?new Jc("",o,null,null,null):new Jc(ca(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class nu{constructor(t){this.type=Gr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,$t);return o?new nu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=cr.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class ru{constructor(t){this.type=tt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${R(o.type)} instead.`):new ru(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new en(`Expected value to be of type string or array, but found ${R(an(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Wr=8192;function by(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Wr),Math.round(o*u*Wr)]}function su(i,t){const n=Math.pow(2,t.z);return[(u=(i[0]/Wr+t.x)/n,360*u-180),(o=(i[1]/Wr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Ls(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ps(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function gi(i,t,n){const o=i[0]-t[0],u=i[1]-t[1],f=i[0]-n[0],m=i[1]-n[1];return o*m-f*u==0&&o*f<=0&&u*m<=0}function sl(i,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(f=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*f[0]!=0&&!(!tf(i,t,n,o)||!tf(n,o,i,t));var u,f}function wy(i,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(sl(i,t,o[u],o[u+1]))return!0;return!1}function lo(i,t,n=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(gi(i,y[x],y[x+1]))return n;(f=y[x])[1]>(u=i)[1]!=(m=y[x+1])[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}var u,f,m;return o}function Sy(i,t){for(const n of t)if(lo(i,n))return!0;return!1}function ef(i,t){for(const n of i)if(!lo(n,t))return!1;for(let n=0;n<i.length-1;++n)if(wy(i[n],i[n+1],t))return!1;return!0}function Ty(i,t){for(const n of t)if(ef(i,n))return!0;return!1}function tf(i,t,n,o){const u=o[0]-n[0],f=o[1]-n[1],m=(i[0]-n[0])*f-u*(i[1]-n[1]),y=(t[0]-n[0])*f-u*(t[1]-n[1]);return m>0&&y<0||m<0&&y>0}function ou(i,t,n){const o=[];for(let u=0;u<i.length;u++){const f=[];for(let m=0;m<i[u].length;m++){const y=by(i[u][m],n);Ls(t,y),f.push(y)}o.push(f)}return o}function nf(i,t,n){const o=[];for(let u=0;u<i.length;u++){const f=ou(i[u],t,n);o.push(f)}return o}function rf(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let f=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;f===0&&(f=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=f}Ls(t,i)}function sf(i,t,n,o){const u=Math.pow(2,o.z)*Wr,f=[o.x*Wr,o.y*Wr],m=[];for(const y of i)for(const x of y){const P=[x.x+f[0],x.y+f[1]];rf(P,t,n,u),m.push(P)}return m}function of(i,t,n,o){const u=Math.pow(2,o.z)*Wr,f=[o.x*Wr,o.y*Wr],m=[];for(const x of i){const P=[];for(const A of x){const E=[A.x+f[0],A.y+f[1]];Ls(t,E),P.push(E)}m.push(P)}if(t[2]-t[0]<=u/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const P of x)rf(P,t,n,u)}var y;return m}class Rs{constructor(t,n){this.type=Ft,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&u.push(y),m==="MultiPolygon"&&u.push(...y)}if(u.length)return new Rs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Rs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Rs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const y=ou(o.coordinates,f,m),x=sf(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!lo(P,y))return!1}if(o.type==="MultiPolygon"){const y=nf(o.coordinates,f,m),x=sf(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!Sy(P,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const y=ou(o.coordinates,f,m),x=of(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!ef(P,y))return!1}if(o.type==="MultiPolygon"){const y=nf(o.coordinates,f,m),x=of(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!Ty(P,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let af=class{constructor(i=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,o=t[i];for(;i>0;){const u=i-1>>1,f=t[u];if(n(o,f)>=0)break;t[i]=f,i=u}t[i]=o}_down(i){const{data:t,compare:n}=this,o=this.length>>1,u=t[i];for(;i<o;){let f=1+(i<<1);const m=f+1;if(m<this.length&&n(t[m],t[f])<0&&(f=m),n(t[f],u)>=0)break;t[i]=t[f],i=f}t[i]=u}};function Py(i,t,n,o,u){lf(i,t,n,o||i.length-1,u||Iy)}function lf(i,t,n,o,u){for(;o>n;){if(o-n>600){var f=o-n+1,m=t-n+1,y=Math.log(f),x=.5*Math.exp(2*y/3),P=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);lf(i,t,Math.max(n,Math.floor(t-m*x/f+P)),Math.min(o,Math.floor(t+(f-m)*x/f+P)),u)}var A=i[t],E=n,D=o;for(pa(i,n,t),u(i[o],A)>0&&pa(i,n,o);E<D;){for(pa(i,E,D),E++,D--;u(i[E],A)<0;)E++;for(;u(i[D],A)>0;)D--}u(i[n],A)===0?pa(i,n,D):pa(i,++D,o),D<=t&&(n=D+1),t<=D&&(o=D-1)}}function pa(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function Iy(i,t){return i<t?-1:i>t?1:0}function ol(i,t){if(i.length<=1)return[i];const n=[];let o,u;for(const f of i){const m=Ay(f);m!==0&&(f.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&n.push(o),o=[f]):o.push(f))}if(o&&n.push(o),t>1)for(let f=0;f<n.length;f++)n[f].length<=t||(Py(n[f],t,1,n[f].length-1,Cy),n[f]=n[f].slice(0,t));return n}function Cy(i,t){return t.area-i.area}function Ay(i){let t=0;for(let n,o,u=0,f=i.length,m=f-1;u<f;m=u++)n=i[u],o=i[m],t+=(o.x-n.x)*(n.y+o.y);return t}const cf=1/298.257223563,uf=cf*(2-cf),hf=Math.PI/180;class au{constructor(t){const n=6378.137*hf*1e3,o=Math.cos(t*hf),u=1/(1-uf*(1-o*o)),f=Math.sqrt(u);this.kx=n*f*o,this.ky=n*f*u*(1-uf)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,f,m,y=1/0;for(let x=0;x<t.length-1;x++){let P=t[x][0],A=t[x][1],E=this.wrap(t[x+1][0]-P)*this.kx,D=(t[x+1][1]-A)*this.ky,F=0;E===0&&D===0||(F=(this.wrap(n[0]-P)*this.kx*E+(n[1]-A)*this.ky*D)/(E*E+D*D),F>1?(P=t[x+1][0],A=t[x+1][1]):F>0&&(P+=E/this.kx*F,A+=D/this.ky*F)),E=this.wrap(n[0]-P)*this.kx,D=(n[1]-A)*this.ky;const q=E*E+D*D;q<y&&(y=q,o=P,u=A,f=x,m=F)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function df(i,t){return t[0]-i[0]}function al(i){return i[1]-i[0]+1}function es(i,t){return i[1]>=i[0]&&i[1]<t}function lu(i,t){if(i[0]>i[1])return[null,null];const n=al(i);if(t){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function cu(i,t){if(!es(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Ls(n,i[o]);return n}function uu(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Ls(t,o);return t}function ll(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function hu(i,t,n){if(!ll(i)||!ll(t))return NaN;let o=0,u=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),n.distance([0,0],[o,u])}function Os(i,t,n){const o=n.pointOnLine(t,i);return n.distance(i,o.point)}function du(i,t,n,o,u){const f=Math.min(Os(i,[n,o],u),Os(t,[n,o],u)),m=Math.min(Os(n,[i,t],u),Os(o,[i,t],u));return Math.min(f,m)}function ky(i,t,n,o,u){if(!es(t,i.length)||!es(o,n.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=i[m],x=i[m+1];for(let P=o[0];P<o[1];++P){const A=n[P],E=n[P+1];if(sl(y,x,A,E))return 0;f=Math.min(f,du(y,x,A,E,u))}}return f}function $i(i,t,n,o,u){if(!es(t,i.length)||!es(o,n.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(i[m],n[y])),f===0)return f;return f}function Ey(i,t,n){if(lo(i,t,!0))return 0;let o=1/0;for(const u of t){const f=u[0],m=u[u.length-1];if(f!==m&&(o=Math.min(o,Os(i,[m,f],n)),o===0))return o;const y=n.pointOnLine(u,i);if(o=Math.min(o,n.distance(i,y.point)),o===0)return o}return o}function ei(i,t,n,o){if(!es(t,i.length))return NaN;for(let f=t[0];f<=t[1];++f)if(lo(i[f],n,!0))return 0;let u=1/0;for(let f=t[0];f<t[1];++f){const m=i[f],y=i[f+1];for(const x of n)for(let P=0,A=x.length,E=A-1;P<A;E=P++){const D=x[E],F=x[P];if(sl(m,y,D,F))return 0;u=Math.min(u,du(m,y,D,F,o))}}return u}function cl(i,t){for(const n of i)for(const o of n)if(lo(o,t,!0))return!0;return!1}function Ci(i,t,n,o=1/0){const u=uu(i),f=uu(t);if(o!==1/0&&hu(u,f,n)>=o)return o;if(ps(u,f)){if(cl(i,t))return 0}else if(cl(t,i))return 0;let m=1/0;for(const y of i)for(let x=0,P=y.length,A=P-1;x<P;A=x++){const E=y[A],D=y[x];for(const F of t)for(let q=0,Z=F.length,J=Z-1;q<Z;J=q++){const re=F[J],we=F[q];if(sl(E,D,re,we))return 0;m=Math.min(m,du(E,D,re,we,n))}}return m}function bi(i,t,n,o,u,f){if(!f)return;const m=hu(cu(o,f),u,n);m<t&&i.push([m,f,[0,0]])}function Fs(i,t,n,o,u,f,m){if(!f||!m)return;const y=hu(cu(o,f),cu(u,m),n);y<t&&i.push([y,f,m])}function fa(i,t,n,o,u=1/0){let f=Math.min(o.distance(i[0],n[0][0]),u);if(f===0)return f;const m=new af([[0,[0,i.length-1],[0,0]]],df),y=uu(n);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const P=x[1],A=t?50:100;if(al(P)<=A){if(!es(P,i.length))return NaN;if(t){const E=ei(i,P,n,o);if(isNaN(E)||E===0)return E;f=Math.min(f,E)}else for(let E=P[0];E<=P[1];++E){const D=Ey(i[E],n,o);if(f=Math.min(f,D),f===0)return 0}}else{const E=lu(P,t);bi(m,f,o,i,y,E[0]),bi(m,f,o,i,y,E[1])}}return f}function ma(i,t,n,o,u,f=1/0){let m=Math.min(f,u.distance(i[0],n[0]));if(m===0)return m;const y=new af([[0,[0,i.length-1],[0,n.length-1]]],df);for(;y.length>0;){const x=y.pop();if(x[0]>=m)continue;const P=x[1],A=x[2],E=t?50:100,D=o?50:100;if(al(P)<=E&&al(A)<=D){if(!es(P,i.length)&&es(A,n.length))return NaN;let F;if(t&&o)F=ky(i,P,n,A,u),m=Math.min(m,F);else if(t&&!o){const q=i.slice(P[0],P[1]+1);for(let Z=A[0];Z<=A[1];++Z)if(F=Os(n[Z],q,u),m=Math.min(m,F),m===0)return m}else if(!t&&o){const q=n.slice(A[0],A[1]+1);for(let Z=P[0];Z<=P[1];++Z)if(F=Os(i[Z],q,u),m=Math.min(m,F),m===0)return m}else F=$i(i,P,n,A,u),m=Math.min(m,F)}else{const F=lu(P,t),q=lu(A,o);Fs(y,m,u,i,n,F[0],q[0]),Fs(y,m,u,i,n,F[0],q[1]),Fs(y,m,u,i,n,F[1],q[0]),Fs(y,m,u,i,n,F[1],q[1])}}return m}function pu(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Bs{constructor(t,n){this.type=tt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Bs(o,o.features.map(u=>pu(u.geometry)).flat());if(o.type==="Feature")return new Bs(o,pu(o.geometry));if("type"in o&&"coordinates"in o)return new Bs(o,pu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=n.geometry(),f=u.flat().map(x=>su([x.x,x.y],n.canonical));if(u.length===0)return NaN;const m=new au(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,ma(f,!1,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ma(f,!1,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,fa(f,!1,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=n.geometry(),f=u.flat().map(x=>su([x.x,x.y],n.canonical));if(u.length===0)return NaN;const m=new au(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,ma(f,!0,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ma(f,!0,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,fa(f,!0,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const f=ol(u,0).map(x=>x.map(P=>P.map(A=>su([A.x,A.y],n.canonical)))),m=new au(f[0][0][0][1]);let y=1/0;for(const x of o)for(const P of f){switch(x.type){case"Point":y=Math.min(y,fa([x.coordinates],!1,P,m,y));break;case"LineString":y=Math.min(y,fa(x.coordinates,!0,P,m,y));break;case"Polygon":y=Math.min(y,Ci(P,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const co={"==":_y,"!=":Jp,">":vy,"<":Yp,">=":Qp,"<=":xy,array:Ar,at:Qc,boolean:Ar,case:Qa,coalesce:il,collator:da,format:rl,image:nu,in:eu,"index-of":so,interpolate:$n,"interpolate-hcl":$n,"interpolate-lab":$n,length:ru,let:ds,literal:Cr,match:tu,number:Ar,"number-format":iu,object:Ar,slice:ua,step:oo,string:Ar,"to-boolean":kr,"to-color":kr,"to-number":kr,"to-string":kr,var:mi,within:Rs,distance:Bs};class yr{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=yr.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let x=null;for(const[P,A]of y){x=new zs(n.registry,ga,n.path,null,n.scope);const E=[];let D=!1;for(let F=1;F<t.length;F++){const q=t[F],Z=Array.isArray(P)?P[F-1]:P.type,J=x.parse(q,1+E.length,Z);if(!J){D=!0;break}E.push(J)}if(!D)if(Array.isArray(P)&&P.length!==E.length)x.error(`Expected ${P.length} arguments, but found ${E.length} instead.`);else{for(let F=0;F<E.length;F++){const q=Array.isArray(P)?P[F]:P.type,Z=E[F];x.concat(F+1).checkSubtype(q,Z.type)}if(x.errors.length===0)return new yr(o,f,A,E)}}if(y.length===1)n.errors.push(...x.errors);else{const P=(y.length?y:m).map(([E])=>{return D=E,Array.isArray(D)?`(${D.map(R).join(", ")})`:`(${R(D.type)}...)`;var D}).join(" | "),A=[];for(let E=1;E<t.length;E++){const D=n.parse(t[E],1+A.length);if(!D)return null;A.push(R(D.type))}n.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,n){yr.definitions=n;for(const o in n)t[o]=yr}}function fu(i,[t,n,o,u]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const f=u?u.evaluate(i):1,m=ro(t,n,o,f);if(m)throw new en(m);return new vi(t/255,n/255,o/255,f,!1)}function mu(i,t){return i in t}function gu(i,t){const n=t[i];return n===void 0?null:n}function Ns(i){return{type:i}}function ga(i){if(i instanceof mi)return ga(i.boundExpression);if(i instanceof yr&&i.name==="error"||i instanceof da||i instanceof Rs||i instanceof Bs)return!1;const t=i instanceof kr||i instanceof Ar;let n=!0;return i.eachChild(o=>{n=t?n&&ga(o):n&&o instanceof Cr}),!!n&&ya(i)&&_a(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ya(i){if(i instanceof yr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Rs||i instanceof Bs)return!1;let t=!0;return i.eachChild(n=>{t&&!ya(n)&&(t=!1)}),t}function uo(i){if(i instanceof yr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!uo(n)&&(t=!1)}),t}function _a(i,t){if(i instanceof yr&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!_a(o,t)&&(n=!1)}),n}function ul(i){return{result:"success",value:i}}function ho(i){return{result:"error",value:i}}function po(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function pf(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yu(i){return!!i.expression&&i.expression.interpolated}function di(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function My(i){return i}function ff(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),f=i.type||(yu(t)?"exponential":"interval");if(n||t.type==="padding"){const A=n?vi.parse:lr.parse;(i=mr({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],A(E[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let y,x,P;if(f==="exponential")y=gf;else if(f==="interval")y=dl;else if(f==="categorical"){y=mf,x=Object.create(null);for(const A of i.stops)x[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=yf}if(o){const A={},E=[];for(let q=0;q<i.stops.length;q++){const Z=i.stops[q],J=Z[0].zoom;A[J]===void 0&&(A[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},E.push(J)),A[J].stops.push([Z[0].value,Z[1]])}const D=[];for(const q of E)D.push([A[q].zoom,ff(A[q],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:$n.interpolationFactor.bind(void 0,F),zoomStops:D.map(q=>q[0]),evaluate:({zoom:q},Z)=>gf({stops:D,base:i.base},t,q).evaluate(q,Z)}}if(u){const A=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:$n.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>y(i,t,E,x,P)}}return{kind:"source",evaluate(A,E){const D=E&&E.properties?E.properties[i.property]:void 0;return D===void 0?fo(i.default,t.default):y(i,t,D,x,P)}}}function fo(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function mf(i,t,n,o,u){return fo(typeof n===u?o[n]:void 0,i.default,t.default)}function dl(i,t,n){if(di(n)!=="number")return fo(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=el(i.stops.map(f=>f[0]),n);return i.stops[u][1]}function gf(i,t,n){const o=i.base!==void 0?i.base:1;if(di(n)!=="number")return fo(i.default,t.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const f=el(i.stops.map(A=>A[0]),n),m=function(A,E,D,F){const q=F-D,Z=A-D;return q===0?0:E===1?Z/q:(Math.pow(E,Z)-1)/(Math.pow(E,q)-1)}(n,o,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],x=i.stops[f+1][1],P=Kn[t.type]||My;return typeof y.evaluate=="function"?{evaluate(...A){const E=y.evaluate.apply(void 0,A),D=x.evaluate.apply(void 0,A);if(E!==void 0&&D!==void 0)return P(E,D,m,i.colorSpace)}}:P(y,x,m,i.colorSpace)}function yf(i,t,n){switch(t.type){case"color":n=vi.parse(n);break;case"formatted":n=ar.fromString(n.toString());break;case"resolvedImage":n=cr.fromString(n.toString());break;case"padding":n=lr.parse(n);break;default:di(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return fo(n,i.default,t.default)}yr.register(co,{error:[{kind:"error"},[$t],(i,[t])=>{throw new en(t.evaluate(i))}],typeof:[$t,[Nt],(i,[t])=>R(an(t.evaluate(i)))],"to-rgba":[O(tt,4),[Cn],(i,[t])=>{const[n,o,u,f]=t.evaluate(i).rgb;return[255*n,255*o,255*u,f]}],rgb:[Cn,[tt,tt,tt],fu],rgba:[Cn,[tt,tt,tt,tt],fu],has:{type:Ft,overloads:[[[$t],(i,[t])=>mu(t.evaluate(i),i.properties())],[[$t,xn],(i,[t,n])=>mu(t.evaluate(i),n.evaluate(i))]]},get:{type:Nt,overloads:[[[$t],(i,[t])=>gu(t.evaluate(i),i.properties())],[[$t,xn],(i,[t,n])=>gu(t.evaluate(i),n.evaluate(i))]]},"feature-state":[Nt,[$t],(i,[t])=>gu(t.evaluate(i),i.featureState||{})],properties:[xn,[],i=>i.properties()],"geometry-type":[$t,[],i=>i.geometryType()],id:[Nt,[],i=>i.id()],zoom:[tt,[],i=>i.globals.zoom],"heatmap-density":[tt,[],i=>i.globals.heatmapDensity||0],"line-progress":[tt,[],i=>i.globals.lineProgress||0],accumulated:[Nt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[tt,Ns(tt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[tt,Ns(tt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:tt,overloads:[[[tt,tt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[tt],(i,[t])=>-t.evaluate(i)]]},"/":[tt,[tt,tt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[tt,[tt,tt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[tt,[tt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))],log2:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[tt,[tt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[tt,[tt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[tt,[tt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[tt,[tt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[tt,[tt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[tt,[tt],(i,[t])=>Math.atan(t.evaluate(i))],min:[tt,Ns(tt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[tt,Ns(tt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[tt,[tt],(i,[t])=>Math.abs(t.evaluate(i))],round:[tt,[tt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[tt,[tt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[tt,[tt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ft,[$t,Nt],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Ft,[Nt],(i,[t])=>i.id()===t.value],"filter-type-==":[Ft,[$t],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Ft,[Nt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ft,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ft,[O($t)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ft,[O(Nt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ft,[$t,O(Nt)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ft,[$t,O(Nt)],(i,[t,n])=>function(o,u,f,m){for(;f<=m;){const y=f+m>>1;if(u[y]===o)return!0;u[y]>o?m=y-1:f=y+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[Ns(Ft),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[Ns(Ft),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Ft,[Ft],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ft,[$t],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[$t,[$t],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[$t,[$t],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[$t,Ns(Nt),(i,t)=>t.map(n=>ca(n.evaluate(i))).join("")],"resolved-locale":[$t,[or],(i,[t])=>t.evaluate(i).resolvedLocale()]});class pl{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Ya,this._defaultValue=n?(o=n).type==="color"&&hl(o.default)?new vi(0,0,0,0):o.type==="color"?vi.parse(o.default)||null:o.type==="padding"?lr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?gr.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,f,m){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new en(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function fl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in co}function mo(i,t){const n=new zs(co,ga,[],t?function(u){const f={color:Cn,string:$t,number:tt,enum:$t,boolean:Ft,formatted:Qr,padding:hs,resolvedImage:Gr,variableAnchorOffsetCollection:ne};return u.type==="array"?O(f[u.value]||Nt,u.length):f[u.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ul(new pl(o,t)):ho(n.errors)}class go{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!uo(n.expression)}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,f,m)}evaluate(t,n,o,u,f,m){return this._styleExpression.evaluate(t,n,o,u,f,m)}}class yo{constructor(t,n,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!uo(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,f,m)}evaluate(t,n,o,u,f,m){return this._styleExpression.evaluate(t,n,o,u,f,m)}interpolationFactor(t,n,o){return this.interpolationType?$n.interpolationFactor(this.interpolationType,t,n,o):0}}function _u(i,t){const n=mo(i,t);if(n.result==="error")return n;const o=n.value.expression,u=ya(o);if(!u&&!po(t))return ho([new vn("","data expressions not supported")]);const f=_a(o,["zoom"]);if(!f&&!pf(t))return ho([new vn("","zoom expressions not supported")]);const m=va(o);return m||f?m instanceof vn?ho([m]):m instanceof $n&&!yu(t)?ho([new vn("",'"interpolate" expressions cannot be used with this property')]):ul(m?new yo(u?"camera":"composite",n.value,m.labels,m instanceof $n?m.interpolation:void 0):new go(u?"constant":"source",n.value)):ho([new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _o{constructor(t,n){this._parameters=t,this._specification=n,mr(this,ff(this._parameters,this._specification))}static deserialize(t){return new _o(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function va(i){let t=null;if(i instanceof ds)t=va(i.result);else if(i instanceof il){for(const n of i.args)if(t=va(n),t)break}else(i instanceof oo||i instanceof $n)&&i.input instanceof yr&&i.input.name==="zoom"&&(t=i);return t instanceof vn||i.eachChild(n=>{const o=va(n);o instanceof vn?t=o:!t&&o?t=new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ml(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ml(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const gl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ml(i)||(i=yl(i));const t=mo(i,gl);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,u)=>t.value.evaluate(n,o,{},u),needGeometry:_f(i)}}function zy(i,t){return i<t?-1:i>t?1:0}function _f(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(_f(i[t]))return!0;return!1}function yl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?xu(i[1],i[2],"=="):t==="!="?An(xu(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?xu(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(yl))):t==="all"?["all"].concat(i.slice(1).map(yl)):t==="none"?["all"].concat(i.slice(1).map(yl).map(An)):t==="in"?xa(i[1],i.slice(2)):t==="!in"?An(xa(i[1],i.slice(2))):t==="has"?ba(i[1]):t!=="!has"||An(ba(i[1]));var n}function xu(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function xa(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(zy)]]:["filter-in-small",i,["literal",t]]}}function ba(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function An(i){return["!",i]}function Vs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const f of i)u+=`${Vs(f)},`;return`${u}]`}const n=Object.keys(i).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${Vs(i[n[u]])},`;return`${o}}`}function vf(i){let t="";for(const n of ki)t+=`/${Vs(i[n])}`;return t}function xf(i){const t=i.value;return t?[new Je(i.key,t,"constants have been deprecated as of v8")]:[]}function Ji(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Er(i){if(Array.isArray(i))return i.map(Er);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=Er(i[n]);return t}return Ji(i)}function ur(i){const t=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},f=i.style,m=i.styleSpec,y=i.validateSpec;let x=[];const P=di(n);if(P!=="object")return[new Je(t,n,`object expected, ${P} found`)];for(const A in n){const E=A.split(".")[0],D=o[E]||o["*"];let F;if(u[E])F=u[E];else if(o[E])F=y;else if(u["*"])F=u["*"];else{if(!o["*"]){x.push(new Je(t,n[A],`unknown property "${A}"`));continue}F=y}x=x.concat(F({key:(t&&`${t}.`)+A,value:n[A],valueSpec:D,style:f,styleSpec:m,object:n,objectKey:A,validateSpec:y},n))}for(const A in o)u[A]||o[A].required&&o[A].default===void 0&&n[A]===void 0&&x.push(new Je(t,n,`missing required property "${A}"`));return x}function wa(i){const t=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(di(t)!=="array")return[new Je(f,t,`array expected, ${di(t)} found`)];if(n.length&&t.length!==n.length)return[new Je(f,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Je(f,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};u.$version<7&&(y.function=n.function),di(n.value)==="object"&&(y=n.value);let x=[];for(let P=0;P<t.length;P++)x=x.concat(m({array:t,arrayIndex:P,value:t[P],valueSpec:y,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${f}[${P}]`}));return x}function bu(i){const t=i.key,n=i.value,o=i.valueSpec;let u=di(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Je(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Je(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Je(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function _l(i){const t=i.valueSpec,n=Ji(i.value.type);let o,u,f,m={};const y=n!=="categorical"&&i.value.property===void 0,x=!y,P=di(i.value.stops)==="array"&&di(i.value.stops[0])==="array"&&di(i.value.stops[0][0])==="object",A=ur({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Je(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const Z=F.value;return q=q.concat(wa({key:F.key,value:Z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:E})),di(Z)==="array"&&Z.length===0&&q.push(new Je(F.key,Z,"array must have at least one stop")),q},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&y&&A.push(new Je(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||A.push(new Je(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!yu(i.valueSpec)&&A.push(new Je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!po(i.valueSpec)?A.push(new Je(i.key,i.value,"property functions not supported")):y&&!pf(i.valueSpec)&&A.push(new Je(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!P||i.value.property!==void 0||A.push(new Je(i.key,i.value,'"property" property is required')),A;function E(F){let q=[];const Z=F.value,J=F.key;if(di(Z)!=="array")return[new Je(J,Z,`array expected, ${di(Z)} found`)];if(Z.length!==2)return[new Je(J,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(di(Z[0])!=="object")return[new Je(J,Z,`object expected, ${di(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Je(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Je(J,Z,"object stop key must have value")];if(f&&f>Ji(Z[0].zoom))return[new Je(J,Z[0].zoom,"stop zoom values must appear in ascending order")];Ji(Z[0].zoom)!==f&&(f=Ji(Z[0].zoom),u=void 0,m={}),q=q.concat(ur({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:bu,value:D}}))}else q=q.concat(D({key:`${J}[0]`,value:Z[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},Z));return fl(Er(Z[1]))?q.concat([new Je(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):q.concat(F.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,q){const Z=di(F.value),J=Ji(F.value),re=F.value!==null?F.value:q;if(o){if(Z!==o)return[new Je(F.key,re,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Je(F.key,re,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&n!=="categorical"){let we=`number expected, ${Z} found`;return po(t)&&n===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(F.key,re,we)]}return n!=="categorical"||Z!=="number"||isFinite(J)&&Math.floor(J)===J?n!=="categorical"&&Z==="number"&&u!==void 0&&J<u?[new Je(F.key,re,"stop domain values must appear in ascending order")]:(u=J,n==="categorical"&&J in m?[new Je(F.key,re,"stop domain values must be unique")]:(m[J]=!0,[])):[new Je(F.key,re,`integer expected, found ${J}`)]}}function vo(i){const t=(i.expressionContext==="property"?_u:mo)(Er(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Je(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!uo(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!uo(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_a(n,["zoom","feature-state"]))return[new Je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ya(n))return[new Je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ts(i){const t=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Ji(n))===-1&&u.push(new Je(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ji(n))===-1&&u.push(new Je(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function wu(i){return ml(Er(i.value))?vo(mr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vl(i)}function vl(i){const t=i.value,n=i.key;if(di(t)!=="array")return[new Je(n,t,`array expected, ${di(t)} found`)];const o=i.styleSpec;let u,f=[];if(t.length<1)return[new Je(n,t,"filter array must have at least 1 element")];switch(f=f.concat(ts({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ji(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ji(t[1])==="$type"&&f.push(new Je(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Je(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=di(t[1]),u!=="string"&&f.push(new Je(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=di(t[m]),Ji(t[1])==="$type"?f=f.concat(ts({key:`${n}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Je(`${n}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(vl({key:`${n}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=di(t[1]),t.length!==2?f.push(new Je(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Je(`${n}[1]`,t[1],`string expected, ${u} found`))}return f}function Su(i,t){const n=i.key,o=i.validateSpec,u=i.style,f=i.styleSpec,m=i.value,y=i.objectKey,x=f[`${t}_${i.layerType}`];if(!x)return[];const P=y.match(/^(.*)-transition$/);if(t==="paint"&&P&&x[P[1]]&&x[P[1]].transition)return o({key:n,value:m,valueSpec:f.transition,style:u,styleSpec:f});const A=i.valueSpec||x[y];if(!A)return[new Je(n,m,`unknown property "${y}"`)];let E;if(di(m)==="string"&&po(A)&&!A.tokens&&(E=/^{([^}]+)}$/.exec(m)))return[new Je(n,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&D.push(new Je(n,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&hl(Er(m))&&Ji(m.type)==="identity"&&D.push(new Je(n,m,'"text-font" does not support identity functions'))),D.concat(o({key:i.key,value:m,valueSpec:A,style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function xl(i){return Su(i,"paint")}function Tu(i){return Su(i,"layout")}function Pu(i){let t=[];const n=i.value,o=i.key,u=i.style,f=i.styleSpec;n.type||n.ref||t.push(new Je(o,n,'either "type" or "ref" is required'));let m=Ji(n.type);const y=Ji(n.ref);if(n.id){const x=Ji(n.id);for(let P=0;P<i.arrayIndex;P++){const A=u.layers[P];Ji(A.id)===x&&t.push(new Je(o,n.id,`duplicate layer id "${n.id}", previously used at line ${A.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(P=>{P in n&&t.push(new Je(o,n[P],`"${P}" is prohibited for ref layers`))}),u.layers.forEach(P=>{Ji(P.id)===y&&(x=P)}),x?x.ref?t.push(new Je(o,n.ref,"ref cannot reference another ref layer")):m=Ji(x.type):t.push(new Je(o,n.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(n.source){const x=u.sources&&u.sources[n.source],P=x&&Ji(x.type);x?P==="vector"&&m==="raster"?t.push(new Je(o,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&m==="hillshade"?t.push(new Je(o,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&m!=="raster"?t.push(new Je(o,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&m!=="hillshade"?t.push(new Je(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&x.lineMetrics||t.push(new Je(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Je(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Je(o,n.source,`source "${n.source}" not found`))}else t.push(new Je(o,n,'missing required property "source"'));return t=t.concat(ur({key:o,value:n,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:wu,layout:x=>ur({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>Tu(mr({layerType:m},P))}}),paint:x=>ur({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>xl(mr({layerType:m},P))}})}})),t}function js(i){const t=i.value,n=i.key,o=di(t);return o!=="string"?[new Je(n,t,`string expected, ${o} found`)]:[]}const bl={promoteId:function({key:i,value:t}){if(di(t)==="string")return js({key:i,value:t});{const n=[];for(const o in t)n.push(...js({key:`${i}.${o}`,value:t[o]}));return n}}};function Sa(i){const t=i.value,n=i.key,o=i.styleSpec,u=i.style,f=i.validateSpec;if(!t.type)return[new Je(n,t,'"type" is required')];const m=Ji(t.type);let y;switch(m){case"vector":case"raster":return y=ur({key:n,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:bl,validateSpec:f}),y;case"raster-dem":return y=function(x){var P;const A=(P=x.sourceName)!==null&&P!==void 0?P:"",E=x.value,D=x.styleSpec,F=D.source_raster_dem,q=x.style;let Z=[];const J=di(E);if(E===void 0)return Z;if(J!=="object")return Z.push(new Je("source_raster_dem",E,`object expected, ${J} found`)),Z;const re=Ji(E.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],he=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ye in E)!re&&we.includes(ye)?Z.push(new Je(ye,E[ye],`In "${A}": "${ye}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):F[ye]?Z=Z.concat(x.validateSpec({key:ye,value:E[ye],valueSpec:F[ye],validateSpec:x.validateSpec,style:q,styleSpec:D})):Z.push(new Je(ye,E[ye],`unknown property "${ye}"`));return Z}({sourceName:n,value:t,style:i.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=ur({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:bl}),t.cluster)for(const x in t.clusterProperties){const[P,A]=t.clusterProperties[x],E=typeof P=="string"?[P,["accumulated"],["get",x]]:P;y.push(...vo({key:`${n}.${x}.map`,value:A,validateSpec:f,expressionContext:"cluster-map"})),y.push(...vo({key:`${n}.${x}.reduce`,value:E,validateSpec:f,expressionContext:"cluster-reduce"}))}return y;case"video":return ur({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return ur({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new Je(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ts({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:f,styleSpec:o})}}function Iu(i){const t=i.value,n=i.styleSpec,o=n.light,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Je("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)])}return f}function Cu(i){const t=i.value,n=i.styleSpec,o=n.sky,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Je("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return m}function Au(i){const t=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Je("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return f}function ku(i){let t=[];const n=i.value,o=i.key;if(Array.isArray(n)){const u=[],f=[];for(const m in n)n[m].id&&u.includes(n[m].id)&&t.push(new Je(o,n,`all the sprites' ids must be unique, but ${n[m].id} is duplicated`)),u.push(n[m].id),n[m].url&&f.includes(n[m].url)&&t.push(new Je(o,n,`all the sprites' URLs must be unique, but ${n[m].url} is duplicated`)),f.push(n[m].url),t=t.concat(ur({key:`${o}[${m}]`,value:n[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return js({key:o,value:n})}const wl={"*":()=>[],array:wa,boolean:function(i){const t=i.value,n=i.key,o=di(t);return o!=="boolean"?[new Je(n,t,`boolean expected, ${o} found`)]:[]},number:bu,color:function(i){const t=i.key,n=i.value,o=di(n);return o!=="string"?[new Je(t,n,`color expected, ${o} found`)]:vi.parse(String(n))?[]:[new Je(t,n,`color expected, "${n}" found`)]},constants:xf,enum:ts,filter:wu,function:_l,layer:Pu,object:ur,source:Sa,light:Iu,sky:Cu,terrain:Au,projection:function(i){const t=i.value,n=i.styleSpec,o=n.projection,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Je("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return m},string:js,formatted:function(i){return js(i).length===0?[]:vo(i)},resolvedImage:function(i){return js(i).length===0?[]:vo(i)},padding:function(i){const t=i.key,n=i.value;if(di(n)==="array"){if(n.length<1||n.length>4)return[new Je(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<n.length;f++)u=u.concat(i.validateSpec({key:`${t}[${f}]`,value:n[f],validateSpec:i.validateSpec,valueSpec:o}));return u}return bu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,o=di(n),u=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Je(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<n.length;m+=2)f=f.concat(ts({key:`${t}[${m}]`,value:n[m],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(wa({key:`${t}[${m+1}]`,value:n[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return f},sprite:ku};function xo(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=xo,n.expression&&hl(Ji(t))?_l(i):n.expression&&fl(Er(t))?vo(i):n.type&&wl[n.type]?wl[n.type](i):ur(mr({},i,{valueSpec:n.type?o[n.type]:n}))}function bf(i){const t=i.value,n=i.key,o=js(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Je(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Je(n,t,'"glyphs" url must include a "{range}" token'))),o}function _r(i,t=be){let n=[];return n=n.concat(xo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:xo,objectElementValidators:{glyphs:bf,"*":()=>[]}})),i.constants&&(n=n.concat(xf({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:xo}))),Eu(n)}function Hr(i){return function(t){return i({...t,validateSpec:xo})}}function Eu(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Mr(i){return function(...t){return Eu(i.apply(this,t))}}_r.source=Mr(Hr(Sa)),_r.sprite=Mr(Hr(ku)),_r.glyphs=Mr(Hr(bf)),_r.light=Mr(Hr(Iu)),_r.sky=Mr(Hr(Cu)),_r.terrain=Mr(Hr(Au)),_r.layer=Mr(Hr(Pu)),_r.filter=Mr(Hr(wu)),_r.paintProperty=Mr(Hr(xl)),_r.layoutProperty=Mr(Hr(Tu));const Us=_r,Dy=Us.light,Ly=Us.sky,wf=Us.paintProperty,Sf=Us.layoutProperty;function Mu(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new mt(new Error(o.message))),n=!0;return n}class bo{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let x=0;x<this.d*this.d;x++){const P=m[3+x],A=m[3+x+1];u.push(P===A?null:m.subarray(P,A))}const y=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const f=o/n*t;this.min=-f,this.max=t+f}insert(t,n,o,u,f){this._forEachCell(n,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,f,m){this.cells[f].push(m)}query(t,n,o,u,f){const m=this.min,y=this.max;if(t<=m&&n<=m&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,u,this._queryCell,x,{},f),x}}_queryCell(t,n,o,u,f,m,y,x){const P=this.cells[f];if(P!==null){const A=this.keys,E=this.bboxes;for(let D=0;D<P.length;D++){const F=P[D];if(y[F]===void 0){const q=4*F;(x?x(E[q+0],E[q+1],E[q+2],E[q+3]):t<=E[q+2]&&n<=E[q+3]&&o>=E[q+0]&&u>=E[q+1])?(y[F]=!0,m.push(A[F])):y[F]=!1}}}}_forEachCell(t,n,o,u,f,m,y,x){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(n),E=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let F=P;F<=E;F++)for(let q=A;q<=D;q++){const Z=this.d*q+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(q),this._convertFromCellCoord(F+1),this._convertFromCellCoord(q+1)))&&f.call(this,t,n,o,u,Z,m,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=n;for(let m=0;m<t.length;m++){const y=t[m];u[3+m]=f,u.set(y,f),f+=y.length}return u[3+t.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+t.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new bo(t.buffer)}}const vr={};function _t(i,t,n={}){if(vr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),vr[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}_t("Object",Object),_t("TransferableGridIndex",bo),_t("Color",vi),_t("Error",Error),_t("AJAXError",Ui),_t("ResolvedImage",cr),_t("StylePropertyFunction",_o),_t("StyleExpression",pl,{omit:["_evaluator"]}),_t("ZoomDependentExpression",yo),_t("ZoomConstantExpression",go),_t("CompoundExpression",yr,{omit:["_evaluate"]});for(const i in co)co[i]._classRegistryKey||_t(`Expression_${i}`,co[i]);function Sl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function zu(i){return i.$name||i.constructor._classRegistryKey}function Tf(i){return!function(t){if(t===null||typeof t!="object")return!1;const n=zu(t);return!(!n||n==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Sl(i)||pt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function wo(i,t){if(Tf(i))return(Sl(i)||pt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(wo(m,t));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=zu(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!vr[n])throw new Error(`${n} is not registered.`);const{klass:o}=vr[n],u=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||vr[n].omit.indexOf(f)>=0)continue;const m=i[f];u[f]=vr[n].shallow.indexOf(f)>=0?m:wo(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function So(i){if(Tf(i))return i;if(Array.isArray(i))return i.map(So);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=zu(i)||"Object";if(!vr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=vr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const f=i[u];o[u]=vr[t].shallow.indexOf(u)>=0?f:So(f)}return o}class Du{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const oi={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Lu(i){for(const t of i)if(Ou(t.charCodeAt(0)))return!0;return!1}function Ry(i){for(const t of i)if(!To(t.charCodeAt(0)))return!1;return!0}function Ru(i){const t=i.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Oy=Ru(["Arab","Dupl","Mong","Ougr","Syrc"]);function To(i){return!Oy.test(String.fromCodePoint(i))}const Pf=Ru(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ou(i){return!(i!==746&&i!==747&&(i<4352||!(oi["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||oi["CJK Compatibility"](i)||oi["CJK Strokes"](i)||!(!oi["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||oi["Enclosed CJK Letters and Months"](i)||oi["Ideographic Description Characters"](i)||oi.Kanbun(i)||oi.Katakana(i)&&i!==12540||!(!oi["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!oi["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||oi["Vertical Forms"](i)||oi["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Pf.test(String.fromCodePoint(i)))))}function If(i){return!(Ou(i)||function(t){return!!(oi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||oi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||oi["Letterlike Symbols"](t)||oi["Number Forms"](t)||oi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||oi["Control Pictures"](t)&&t!==9251||oi["Optical Character Recognition"](t)||oi["Enclosed Alphanumerics"](t)||oi["Geometric Shapes"](t)||oi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||oi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||oi["CJK Symbols and Punctuation"](t)||oi.Katakana(t)||oi["Private Use Area"](t)||oi["CJK Compatibility Forms"](t)||oi["Small Form Variants"](t)||oi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Fy=Ru(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Fu(i){return Fy.test(String.fromCodePoint(i))}function By(i,t){return!(!t&&Fu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||oi.Khmer(i))}function Ny(i){for(const t of i)if(Fu(t.charCodeAt(0)))return!0;return!1}const hr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ei{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Du,this.transition={})}isSupportedScript(t){return function(n,o){for(const u of n)if(!By(u.charCodeAt(0),o))return!1;return!0}(t,hr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Po{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,u){if(hl(o))return new _o(o,u);if(fl(o)){const f=_u(o,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=o;return u.type==="color"&&typeof o=="string"?f=vi.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(f=gr.parse(o)):f=lr.parse(o),{kind:"constant",evaluate:()=>f}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Tl{constructor(t){this.property=t,this.value=new Po(t,void 0)}transitioned(t,n){return new Cf(this.property,this.value,n,$e({},t.transition,this.transition),t.now)}untransitioned(){return new Cf(this.property,this.value,null,{},0)}}class Pl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Be(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Tl(this._values[t].property)),this._values[t].value=new Po(this._values[t].property,n===null?void 0:Be(n))}getTransition(t){return Be(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Tl(this._values[t].property)),this._values[t].transition=Be(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new Ta(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new Ta(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Cf{constructor(t,n,o,u,f){this.property=t,this.value=n,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,f=this.value.possiblyEvaluate(t,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(t,n,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,n,o),f,function(x){if(x<=0)return 0;if(x>=1)return 1;const P=x*x,A=P*x;return 4*(x<.5?A:3*(x-P)+A-.75)}(y))}}return f}}class Ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new Ia(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Pa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Be(this._values[t].value)}setValue(t,n){this._values[t]=new Po(this._values[t].property,n===null?void 0:Be(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new Ia(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,n,o);return u}}class Xr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class Ia{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Kn[this.specification.type];return u?u(t,n,o):t}}class Rt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new Xr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Xr(this,{kind:"constant",value:void 0},t.parameters);const u=Kn[this.specification.type];if(u){const f=u(t.value.value,n.value.value,o);return new Xr(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,n,o,u,f,m){return t.kind==="constant"?t.value:t.evaluate(n,o,u,f,m)}}class Il extends Rt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new Xr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const f=t.expression.evaluate(n,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,n);return new Xr(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Xr(this,{kind:"constant",value:f},n)}return new Xr(this,t.expression,n)}evaluate(t,n,o,u,f,m){if(t.kind==="source"){const y=t.evaluate(n,o,u,f,m);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Cl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(n,null,{},o,u);return this._calculate(f,f,f,n)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Ei(Math.floor(n.zoom),n)),t.expression.evaluate(new Ei(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Bu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class p{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Po(o,void 0),f=this.defaultTransitionablePropertyValues[n]=new Tl(o);this.defaultTransitioningPropertyValues[n]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}_t("DataDrivenProperty",Rt),_t("DataConstantProperty",bt),_t("CrossFadedDataDrivenProperty",Il),_t("CrossFadedProperty",Cl),_t("ColorRampProperty",Bu);const e="-transition";class r extends Bt{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new Pa(n.layout)),n.paint)){this._transitionablePaint=new Pl(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ia(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Sf,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(wf,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],f=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ye(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,f={}){return(!f||f.validate!==!1)&&Mu(this,t.call(Us,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Xr&&po(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _(i,t=1){let n=0,o=0;return{members:i.map(u=>{const f=a[u.type].BYTES_PER_ELEMENT,m=n=w(n,Math.max(t,f)),y=u.components||1;return o=Math.max(o,f),n+=f*y,{name:u.name,type:u.type,components:y,offset:m}}),size:w(n,Math.max(o,t)),alignment:t}}function w(i,t){return Math.ceil(i/t)*t}class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}S.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",S);class k extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=u,t}}k.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",k);class M extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o,u)}emplace(t,n,o,u,f){const m=4*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=f,t}}M.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",M);class z extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}z.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",z);class N extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=4*t,P=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[P+4]=u,this.uint8[P+5]=f,this.uint8[P+6]=m,this.uint8[P+7]=y,t}}N.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",N);class G extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}G.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",G);class X extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,A){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,u,f,m,y,x,P,A)}emplace(t,n,o,u,f,m,y,x,P,A,E){const D=10*t;return this.uint16[D+0]=n,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=P,this.uint16[D+8]=A,this.uint16[D+9]=E,t}}X.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",X);class Q extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,A,E,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,o,u,f,m,y,x,P,A,E,D)}emplace(t,n,o,u,f,m,y,x,P,A,E,D,F){const q=12*t;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=u,this.int16[q+3]=f,this.uint16[q+4]=m,this.uint16[q+5]=y,this.uint16[q+6]=x,this.uint16[q+7]=P,this.int16[q+8]=A,this.int16[q+9]=E,this.int16[q+10]=D,this.int16[q+11]=F,t}}Q.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",Q);class se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=u,t}}se.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",se);class ae extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}ae.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",ae);class ce extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,n,o,u,f,m,y,x,P)}emplace(t,n,o,u,f,m,y,x,P,A){const E=10*t,D=5*t;return this.int16[E+0]=n,this.int16[E+1]=o,this.int16[E+2]=u,this.int16[E+3]=f,this.int16[E+4]=m,this.int16[E+5]=y,this.uint32[D+3]=x,this.uint16[E+8]=P,this.uint16[E+9]=A,t}}ce.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",ce);class $ extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}$.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",$);class fe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u,f)}emplace(t,n,o,u,f,m){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=m,t}}fe.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",fe);class ge extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=16*t,P=4*t,A=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[P+1]=u,this.float32[P+2]=f,this.int16[A+6]=m,this.int16[A+7]=y,t}}ge.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",ge);class Se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.uint16[f+0]=n,this.uint16[f+1]=o,this.uint16[f+2]=u,t}}Se.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",Se);class Fe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re){const we=this.length;return this.resize(we+1),this.emplace(we,t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re)}emplace(t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re,we){const he=24*t,ye=12*t,ke=48*t;return this.int16[he+0]=n,this.int16[he+1]=o,this.uint16[he+2]=u,this.uint16[he+3]=f,this.uint32[ye+2]=m,this.uint32[ye+3]=y,this.uint32[ye+4]=x,this.uint16[he+10]=P,this.uint16[he+11]=A,this.uint16[he+12]=E,this.float32[ye+7]=D,this.float32[ye+8]=F,this.uint8[ke+36]=q,this.uint8[ke+37]=Z,this.uint8[ke+38]=J,this.uint32[ye+10]=re,this.int16[he+22]=we,t}}Fe.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fe);class Ke extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re,we,he,ye,ke,Ze,ft,Lt,ht,ot,Tt,vt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re,we,he,ye,ke,Ze,ft,Lt,ht,ot,Tt,vt)}emplace(t,n,o,u,f,m,y,x,P,A,E,D,F,q,Z,J,re,we,he,ye,ke,Ze,ft,Lt,ht,ot,Tt,vt,yt){const Re=32*t,At=16*t;return this.int16[Re+0]=n,this.int16[Re+1]=o,this.int16[Re+2]=u,this.int16[Re+3]=f,this.int16[Re+4]=m,this.int16[Re+5]=y,this.int16[Re+6]=x,this.int16[Re+7]=P,this.uint16[Re+8]=A,this.uint16[Re+9]=E,this.uint16[Re+10]=D,this.uint16[Re+11]=F,this.uint16[Re+12]=q,this.uint16[Re+13]=Z,this.uint16[Re+14]=J,this.uint16[Re+15]=re,this.uint16[Re+16]=we,this.uint16[Re+17]=he,this.uint16[Re+18]=ye,this.uint16[Re+19]=ke,this.uint16[Re+20]=Ze,this.uint16[Re+21]=ft,this.uint16[Re+22]=Lt,this.uint32[At+12]=ht,this.float32[At+13]=ot,this.float32[At+14]=Tt,this.uint16[Re+30]=vt,this.uint16[Re+31]=yt,t}}Ke.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",Ke);class lt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}lt.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",lt);class gt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.uint16[6*t+0]=n,this.float32[f+1]=o,this.float32[f+2]=u,t}}gt.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",gt);class rt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=4*t;return this.uint32[2*t+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=u,t}}rt.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",rt);class nt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}nt.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",nt);class wt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}wt.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",wt);class Zt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o,u)}emplace(t,n,o,u,f){const m=4*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=f,t}}Zt.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",Zt);class st extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}st.prototype.size=20;class dt extends ce{get(t){return new st(this,t)}}_t("CollisionBoxArray",dt);class jt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}jt.prototype.size=48;class Mi extends Fe{get(t){return new jt(this,t)}}_t("PlacedSymbolArray",Mi);class Jt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Jt.prototype.size=64;class ni extends Ke{get(t){return new Jt(this,t)}}_t("SymbolInstanceArray",ni);class zi extends lt{getoffsetX(t){return this.float32[1*t+0]}}_t("GlyphOffsetArray",zi);class kn extends k{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_t("SymbolLineVertexArray",kn);class zr extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}zr.prototype.size=12;class Di extends gt{get(t){return new zr(this,t)}}_t("TextAnchorOffsetArray",Di);class Jn extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Jn.prototype.size=8;class Nn extends rt{get(t){return new Jn(this,t)}}_t("FeatureIndexArray",Nn);class En extends S{}class Vn extends S{}class Kr extends S{}class Io extends z{}class Al extends N{}class Co extends G{}class xr extends X{}class kl extends Q{}class Nu extends se{}class br extends ae{}class wr extends ${}class fs extends ge{}class Dr extends Se{}class wn extends nt{}const Mn=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:dr}=Mn;class ai{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,u){let f=this.segments[this.segments.length-1];return t>ai.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>ai.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new ai([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function qs(i,t){return 256*(i=ze(Math.floor(i),0,255))+ze(Math.floor(t),0,255)}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",ai);const Ao=_([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ko={exports:{}},Af={exports:{}};Af.exports=function(i,t){var n,o,u,f,m,y,x,P;for(o=i.length-(n=3&i.length),u=t,m=3432918353,y=461845907,P=0;P<o;)x=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&i.charCodeAt(P+2))<<16;case 2:x^=(255&i.charCodeAt(P+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(P)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Vy=Af.exports,kf={exports:{}};kf.exports=function(i,t){for(var n,o=i.length,u=t^o,f=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++f;switch(o){case 3:u^=(255&i.charCodeAt(f+2))<<16;case 2:u^=(255&i.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var ms=Vy,Ef=kf.exports;ko.exports=ms,ko.exports.murmur3=ms,ko.exports.murmur2=Ef;var El=j(ko.exports);class Ca{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(Ml(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ml(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const f=[];for(;this.ids[o]===n;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return zl(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new Ca;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Ml(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:El(String(i))}function zl(i,t,n,o){for(;n<o;){const u=i[n+o>>1];let f=n-1,m=o+1;for(;;){do f++;while(i[f]<u);do m--;while(i[m]>u);if(f>=m)break;Eo(i,f,m),Eo(t,3*f,3*m),Eo(t,3*f+1,3*m+1),Eo(t,3*f+2,3*m+2)}m-n<o-m?(zl(i,t,n,m),n=m+1):(zl(i,t,m+1,o),o=m)}}function Eo(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}_t("FeaturePositionMap",Ca);class Aa{constructor(t,n){this.gl=t.gl,this.location=n}}class Mf extends Aa{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Bv extends Aa{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Nv extends Aa{constructor(t,n){super(t,n),this.current=vi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const X1=new Float32Array(16);function jy(i){return[qs(255*i.r,255*i.g),qs(255*i.b,255*i.a)]}class Vu{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Nv(t,n):new Mf(t,n)}}class Dl{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const f=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Bv(t,n):new Mf(t,n)}}class Zs{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o,u,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Ei(0),n,{},u,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,n,o,u){const f=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,n,f)}_setPaintValue(t,n,o){if(this.type==="color"){const u=jy(o);for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(t,n,o,u,f,m){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,o,u,f){const m=this.expression.evaluate(new Ei(this.zoom),n,{},u,[],f),y=this.expression.evaluate(new Ei(this.zoom+1),n,{},u,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,y)}updatePaintArray(t,n,o,u){const f=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,n,f,m)}_setPaintValue(t,n,o,u){if(this.type==="color"){const f=jy(o),m=jy(u);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=ze(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Mf(t,n)}}class Mo{constructor(t,n,o,u,f,m){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,u,f){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:f,mid:m,max:y}=o,x=u[f],P=u[m],A=u[y];if(x&&P&&A)for(let E=t;E<n;E++)this.zoomInPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],P.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ao.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ao.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vv{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const f in t.paint._values){if(!o(f))continue;const m=t.paint.get(f);if(!(m instanceof Xr&&po(m.property.specification)))continue;const y=K1(f,t.type),x=m.value,P=m.property.specification.type,A=m.property.useIntegerZoom,E=m.property.specification["property-type"],D=E==="cross-faded"||E==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new Dl(x.value,y):new Vu(x.value,y,P),u.push(`/u_${f}`);else if(x.kind==="source"||D){const F=jv(f,P,"source");this.binders[f]=D?new Mo(x,P,A,n,F,t.id):new Zs(x,y,P,F),u.push(`/a_${f}`)}else{const F=jv(f,P,"composite");this.binders[f]=new is(x,y,P,A,n,F),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Zs||n instanceof is?n.maxValue:0}populatePaintArrays(t,n,o,u,f){for(const m in this.binders){const y=this.binders[m];(y instanceof Zs||y instanceof is||y instanceof Mo)&&y.populatePaintArray(t,n,o,u,f)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Dl&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,f){let m=!1;for(const y in t){const x=n.getPositions(y);for(const P of x){const A=o.feature(P.index);for(const E in this.binders){const D=this.binders[E];if((D instanceof Zs||D instanceof is||D instanceof Mo)&&D.expression.isStateDependent===!0){const F=u.paint.get(E);D.expression=F.value,D.updatePaintArray(P.start,P.end,A,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Vu||o instanceof Dl)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Zs||o instanceof is)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Mo)for(let u=0;u<Ao.members.length;u++)t.push(Ao.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Vu||o instanceof Dl||o instanceof is)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Vu||f instanceof Dl||f instanceof is){for(const m of f.uniformNames)if(n[m]){const y=f.getBinding(t,n[m],m);o.push({name:m,property:u,binding:y})}}}return o}setUniforms(t,n,o,u){for(const{name:f,property:m,binding:y}of n)this.binders[m].setUniform(y,u,o.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Mo){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Zs||o instanceof is)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Zs||o instanceof is||o instanceof Mo)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Zs||n instanceof is||n instanceof Mo)&&n.destroy()}}}class ka{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Vv(u,n,o);this.needsUpload=!1,this._featureMap=new Ca,this._bufferOffset=0}populatePaintArrays(t,n,o,u,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,n,u,f,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,n,f,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function K1(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function jv(i,t,n){const o={color:{source:G,composite:Zt},number:{source:lt,composite:G}},u=function(f){return{"line-pattern":{source:xr,composite:xr},"fill-pattern":{source:xr,composite:xr},"fill-extrusion-pattern":{source:xr,composite:xr}}[f]}(i);return u&&u[n]||o[t][n]}_t("ConstantBinder",Vu),_t("CrossFadedConstantBinder",Dl),_t("SourceExpressionBinder",Zs),_t("CrossFadedCompositeBinder",Mo),_t("CompositeExpressionBinder",is),_t("ProgramConfiguration",Vv,{omit:["_buffers"]}),_t("ProgramConfigurationSet",ka);const ln=8192,Uy=Math.pow(2,14)-1,Uv=-Uy-1;function Ea(i){const t=ln/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let f=0;f<u.length;f++){const m=u[f],y=Math.round(m.x*t),x=Math.round(m.y*t);m.x=ze(y,Uv,Uy),m.y=ze(x,Uv,Uy),(y<m.x||y>m.x+1||x<m.y||x>m.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ma(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Ea(i):[]}}function zf(i,t,n,o,u){i.emplaceBack(2*t+(o+1)/2,2*n+(u+1)/2)}class qy{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Vn,this.indexArray=new Dr,this.segments=new ai,this.programConfigurations=new ka(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],f=[];let m=null,y=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),y=!m.isConstant());for(const{feature:x,id:P,index:A,sourceLayerIndex:E}of t){const D=this.layers[0]._featureFilter.needGeometry,F=Ma(x,D);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),F,o))continue;const q=y?m.evaluate(F,{},o):void 0,Z={id:P,properties:x.properties,type:x.type,sourceLayerIndex:E,index:A,geometry:D?F.geometry:Ea(x),patterns:{},sortKey:q};f.push(Z)}y&&f.sort((x,P)=>x.sortKey-P.sortKey);for(const x of f){const{geometry:P,index:A,sourceLayerIndex:E}=x,D=t[A].feature;this.addFeature(x,P,A,o),n.featureIndex.insert(D,P,A,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u){for(const f of n)for(const m of f){const y=m.x,x=m.y;if(y<0||y>=ln||x<0||x>=ln)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;zf(this.layoutVertexArray,y,x,-1,-1),zf(this.layoutVertexArray,y,x,1,-1),zf(this.layoutVertexArray,y,x,1,1),zf(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function qv(i,t){for(let n=0;n<i.length;n++)if(Ll(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Ll(i,t[n]))return!0;return!!Zy(i,t)}function $1(i,t,n){return!!Ll(i,t)||!!Gy(t,i,n)}function Zv(i,t){if(i.length===1)return Wv(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(Ll(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(Wv(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Zy(i,t[n]))return!0;return!1}function J1(i,t,n){if(i.length>1){if(Zy(i,t))return!0;for(let o=0;o<t.length;o++)if(Gy(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Gy(i[o],t,n))return!0;return!1}function Zy(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let f=0;f<t.length-1;f++)if(Y1(o,u,t[f],t[f+1]))return!0}return!1}function Y1(i,t,n,o){return Ae(i,n,o)!==Ae(t,n,o)&&Ae(i,t,n)!==Ae(i,t,o)}function Gy(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Gv(i,t[u-1],t[u])<o)return!0;return!1}function Gv(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Wv(i,t){let n,o,u,f=!1;for(let m=0;m<i.length;m++){n=i[m];for(let y=0,x=n.length-1;y<n.length;x=y++)o=n[y],u=n[x],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function Ll(i,t){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const f=i[o],m=i[u];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(n=!n)}return n}function Q1(i,t,n){const o=n[0],u=n[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const f=Ae(i,t,n[0]);return f!==Ae(i,t,n[1])||f!==Ae(i,t,n[2])||f!==Ae(i,t,n[3])}function ju(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Df(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Lf(i,t,n,o,u){if(!t[0]&&!t[1])return i;const f=B.convert(t)._mult(u);n==="viewport"&&f._rotate(-o);const m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(f));return m}let Hv,Xv;_t("CircleBucket",qy,{omit:["layers"]});var ew={get paint(){return Xv=Xv||new p({"circle-radius":new Rt(be.paint_circle["circle-radius"]),"circle-color":new Rt(be.paint_circle["circle-color"]),"circle-blur":new Rt(be.paint_circle["circle-blur"]),"circle-opacity":new Rt(be.paint_circle["circle-opacity"]),"circle-translate":new bt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(be.paint_circle["circle-stroke-opacity"])})},get layout(){return Hv=Hv||new p({"circle-sort-key":new Rt(be.layout_circle["circle-sort-key"])})}},Yn=1e-6,Rl=typeof Float32Array<"u"?Float32Array:Array;function Wy(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Kv(i,t,n){var o=t[0],u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],P=t[6],A=t[7],E=t[8],D=t[9],F=t[10],q=t[11],Z=t[12],J=t[13],re=t[14],we=t[15],he=n[0],ye=n[1],ke=n[2],Ze=n[3];return i[0]=he*o+ye*y+ke*E+Ze*Z,i[1]=he*u+ye*x+ke*D+Ze*J,i[2]=he*f+ye*P+ke*F+Ze*re,i[3]=he*m+ye*A+ke*q+Ze*we,i[4]=(he=n[4])*o+(ye=n[5])*y+(ke=n[6])*E+(Ze=n[7])*Z,i[5]=he*u+ye*x+ke*D+Ze*J,i[6]=he*f+ye*P+ke*F+Ze*re,i[7]=he*m+ye*A+ke*q+Ze*we,i[8]=(he=n[8])*o+(ye=n[9])*y+(ke=n[10])*E+(Ze=n[11])*Z,i[9]=he*u+ye*x+ke*D+Ze*J,i[10]=he*f+ye*P+ke*F+Ze*re,i[11]=he*m+ye*A+ke*q+Ze*we,i[12]=(he=n[12])*o+(ye=n[13])*y+(ke=n[14])*E+(Ze=n[15])*Z,i[13]=he*u+ye*x+ke*D+Ze*J,i[14]=he*f+ye*P+ke*F+Ze*re,i[15]=he*m+ye*A+ke*q+Ze*we,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Uu,tw=Kv;function Rf(i,t,n){var o=t[0],u=t[1],f=t[2],m=t[3];return i[0]=n[0]*o+n[4]*u+n[8]*f+n[12]*m,i[1]=n[1]*o+n[5]*u+n[9]*f+n[13]*m,i[2]=n[2]*o+n[6]*u+n[10]*f+n[14]*m,i[3]=n[3]*o+n[7]*u+n[11]*f+n[15]*m,i}Uu=new Rl(4),Rl!=Float32Array&&(Uu[0]=0,Uu[1]=0,Uu[2]=0,Uu[3]=0);class iw extends r{constructor(t){super(t,ew)}createBucket(t){return new qy(t)}queryRadius(t){const n=t;return ju("circle-radius",this,n)+ju("circle-stroke-width",this,n)+Df(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y,x){const P=Lf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),A=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),E=this.paint.get("circle-pitch-alignment")==="map",D=E?P:function(q,Z){return q.map(J=>$v(J,Z))}(P,x),F=E?A*y:A;for(const q of u)for(const Z of q){const J=E?Z:$v(Z,x);let re=F;const we=Rf([],[Z.x,Z.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=we[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=m.cameraToCenterDistance/we[3]),$1(D,J,re))return!0}return!1}}function $v(i,t){const n=Rf([],[i.x,i.y,0,1],t);return new B(n[0]/n[3],n[1]/n[3])}class Jv extends qy{}let Yv;_t("HeatmapBucket",Jv,{omit:["layers"]});var nw={get paint(){return Yv=Yv||new p({"heatmap-radius":new Rt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bu(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(be.paint_heatmap["heatmap-opacity"])})}};function Hy(i,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=u,i}function Qv(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const u=Hy({},{width:t,height:n},o);Xy(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=u.data}function Xy(i,t,n,o,u,f){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const P=((n.y+x)*i.width+n.x)*f,A=((o.y+x)*t.width+o.x)*f;for(let E=0;E<u.width*f;E++)y[A+E]=m[P+E]}return t}class qu{constructor(t,n){Hy(this,t,1,n)}resize(t){Qv(this,t,1)}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,f){Xy(t,n,o,u,f,1)}}class Lr{constructor(t,n){Hy(this,t,4,n)}resize(t){Qv(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Lr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,f){Xy(t,n,o,u,f,4)}}function e0(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new Lr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const f=(m,y,x)=>{t[i.evaluationKey]=x;const P=i.expression.evaluate(t);u.data[m+y+0]=Math.floor(255*P.r/P.a),u.data[m+y+1]=Math.floor(255*P.g/P.a),u.data[m+y+2]=Math.floor(255*P.b/P.a),u.data[m+y+3]=Math.floor(255*P.a)};if(i.clips)for(let m=0,y=0;m<o;++m,y+=4*n)for(let x=0,P=0;x<n;x++,P+=4){const A=x/(n-1),{start:E,end:D}=i.clips[m];f(y,P,E*(1-A)+D*A)}else for(let m=0,y=0;m<n;m++,y+=4)f(0,y,m/(n-1));return u}_t("AlphaImage",qu),_t("RGBAImage",Lr);const Ky="big-fb";class rw extends r{createBucket(t){return new Jv(t)}constructor(t){super(t,nw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=e0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ky)&&this.heatmapFbos.delete(Ky)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let t0;var sw={get paint(){return t0=t0||new p({"hillshade-illumination-direction":new bt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(be.paint_hillshade["hillshade-accent-color"])})}};class ow extends r{constructor(t){super(t,sw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const aw=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:lw}=aw;function i0(i,t,n=2){const o=t&&t.length,u=o?t[0]*n:i.length;let f=n0(i,0,u,n,!0);const m=[];if(!f||f.next===f.prev)return m;let y,x,P;if(o&&(f=function(A,E,D,F){const q=[];for(let Z=0,J=E.length;Z<J;Z++){const re=n0(A,E[Z]*F,Z<J-1?E[Z+1]*F:A.length,F,!1);re===re.next&&(re.steiner=!0),q.push(gw(re))}q.sort(pw);for(let Z=0;Z<q.length;Z++)D=fw(q[Z],D);return D}(i,t,f,n)),i.length>80*n){y=1/0,x=1/0;let A=-1/0,E=-1/0;for(let D=n;D<u;D+=n){const F=i[D],q=i[D+1];F<y&&(y=F),q<x&&(x=q),F>A&&(A=F),q>E&&(E=q)}P=Math.max(A-y,E-x),P=P!==0?32767/P:0}return Zu(f,m,n,y,x,P,0),m}function n0(i,t,n,o,u){let f;if(u===function(m,y,x,P){let A=0;for(let E=y,D=x-P;E<x;E+=P)A+=(m[D]-m[E])*(m[E+1]+m[D+1]),D=E;return A}(i,t,n,o)>0)for(let m=t;m<n;m+=o)f=o0(m/o|0,i[m],i[m+1],f);else for(let m=n-o;m>=t;m-=o)f=o0(m/o|0,i[m],i[m+1],f);return f&&Of(f,f.next)&&(Wu(f),f=f.next),f}function za(i,t){if(!i)return i;t||(t=i);let n,o=i;do if(n=!1,o.steiner||!Of(o,o.next)&&tn(o.prev,o,o.next)!==0)o=o.next;else{if(Wu(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Zu(i,t,n,o,u,f,m){if(!i)return;!m&&f&&function(x,P,A,E){let D=x;do D.z===0&&(D.z=$y(D.x,D.y,P,A,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(F){let q,Z=1;do{let J,re=F;F=null;let we=null;for(q=0;re;){q++;let he=re,ye=0;for(let Ze=0;Ze<Z&&(ye++,he=he.nextZ,he);Ze++);let ke=Z;for(;ye>0||ke>0&&he;)ye!==0&&(ke===0||!he||re.z<=he.z)?(J=re,re=re.nextZ,ye--):(J=he,he=he.nextZ,ke--),we?we.nextZ=J:F=J,J.prevZ=we,we=J;re=he}we.nextZ=null,Z*=2}while(q>1)}(D)}(i,o,u,f);let y=i;for(;i.prev!==i.next;){const x=i.prev,P=i.next;if(f?uw(i,o,u,f):cw(i))t.push(x.i,i.i,P.i),Wu(i),i=P.next,y=P.next;else if((i=P)===y){m?m===1?Zu(i=hw(za(i),t),t,n,o,u,f,2):m===2&&dw(i,t,n,o,u,f):Zu(za(i),t,n,o,u,f,1);break}}}function cw(i){const t=i.prev,n=i,o=i.next;if(tn(t,n,o)>=0)return!1;const u=t.x,f=n.x,m=o.x,y=t.y,x=n.y,P=o.y,A=u<f?u<m?u:m:f<m?f:m,E=y<x?y<P?y:P:x<P?x:P,D=u>f?u>m?u:m:f>m?f:m,F=y>x?y>P?y:P:x>P?x:P;let q=o.next;for(;q!==t;){if(q.x>=A&&q.x<=D&&q.y>=E&&q.y<=F&&Ol(u,y,f,x,m,P,q.x,q.y)&&tn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function uw(i,t,n,o){const u=i.prev,f=i,m=i.next;if(tn(u,f,m)>=0)return!1;const y=u.x,x=f.x,P=m.x,A=u.y,E=f.y,D=m.y,F=y<x?y<P?y:P:x<P?x:P,q=A<E?A<D?A:D:E<D?E:D,Z=y>x?y>P?y:P:x>P?x:P,J=A>E?A>D?A:D:E>D?E:D,re=$y(F,q,t,n,o),we=$y(Z,J,t,n,o);let he=i.prevZ,ye=i.nextZ;for(;he&&he.z>=re&&ye&&ye.z<=we;){if(he.x>=F&&he.x<=Z&&he.y>=q&&he.y<=J&&he!==u&&he!==m&&Ol(y,A,x,E,P,D,he.x,he.y)&&tn(he.prev,he,he.next)>=0||(he=he.prevZ,ye.x>=F&&ye.x<=Z&&ye.y>=q&&ye.y<=J&&ye!==u&&ye!==m&&Ol(y,A,x,E,P,D,ye.x,ye.y)&&tn(ye.prev,ye,ye.next)>=0))return!1;ye=ye.nextZ}for(;he&&he.z>=re;){if(he.x>=F&&he.x<=Z&&he.y>=q&&he.y<=J&&he!==u&&he!==m&&Ol(y,A,x,E,P,D,he.x,he.y)&&tn(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ye&&ye.z<=we;){if(ye.x>=F&&ye.x<=Z&&ye.y>=q&&ye.y<=J&&ye!==u&&ye!==m&&Ol(y,A,x,E,P,D,ye.x,ye.y)&&tn(ye.prev,ye,ye.next)>=0)return!1;ye=ye.nextZ}return!0}function hw(i,t){let n=i;do{const o=n.prev,u=n.next.next;!Of(o,u)&&r0(o,n,n.next,u)&&Gu(o,u)&&Gu(u,o)&&(t.push(o.i,n.i,u.i),Wu(n),Wu(n.next),n=i=u),n=n.next}while(n!==i);return za(n)}function dw(i,t,n,o,u,f){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&yw(m,y)){let x=s0(m,y);return m=za(m,m.next),x=za(x,x.next),Zu(m,t,n,o,u,f,0),void Zu(x,t,n,o,u,f,0)}y=y.next}m=m.next}while(m!==i)}function pw(i,t){return i.x-t.x}function fw(i,t){const n=function(u,f){let m=f;const y=u.x,x=u.y;let P,A=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const Z=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=y&&Z>A&&(A=Z,P=m.x<m.next.x?m:m.next,Z===y))return P}m=m.next}while(m!==f);if(!P)return null;const E=P,D=P.x,F=P.y;let q=1/0;m=P;do{if(y>=m.x&&m.x>=D&&y!==m.x&&Ol(x<F?y:A,x,D,F,x<F?A:y,x,m.x,m.y)){const Z=Math.abs(x-m.y)/(y-m.x);Gu(m,u)&&(Z<q||Z===q&&(m.x>P.x||m.x===P.x&&mw(P,m)))&&(P=m,q=Z)}m=m.next}while(m!==E);return P}(i,t);if(!n)return t;const o=s0(n,i);return za(o,o.next),za(n,n.next)}function mw(i,t){return tn(i.prev,i,t.prev)<0&&tn(t.next,i,i.next)<0}function $y(i,t,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gw(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Ol(i,t,n,o,u,f,m,y){return(u-m)*(t-y)>=(i-m)*(f-y)&&(i-m)*(o-y)>=(n-m)*(t-y)&&(n-m)*(f-y)>=(u-m)*(o-y)}function yw(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&r0(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(i,t)&&(Gu(i,t)&&Gu(t,i)&&function(n,o){let u=n,f=!1;const m=(n.x+o.x)/2,y=(n.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==n);return f}(i,t)&&(tn(i.prev,i,t.prev)||tn(i,t.prev,t))||Of(i,t)&&tn(i.prev,i,i.next)>0&&tn(t.prev,t,t.next)>0)}function tn(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function Of(i,t){return i.x===t.x&&i.y===t.y}function r0(i,t,n,o){const u=Bf(tn(i,t,n)),f=Bf(tn(i,t,o)),m=Bf(tn(n,o,i)),y=Bf(tn(n,o,t));return u!==f&&m!==y||!(u!==0||!Ff(i,n,t))||!(f!==0||!Ff(i,o,t))||!(m!==0||!Ff(n,i,o))||!(y!==0||!Ff(n,t,o))}function Ff(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Bf(i){return i>0?1:i<0?-1:0}function Gu(i,t){return tn(i.prev,i,i.next)<0?tn(i,t,i.next)>=0&&tn(i,i.prev,t)>=0:tn(i,t,i.prev)<0||tn(i,i.next,t)<0}function s0(i,t){const n=Jy(i.i,i.x,i.y),o=Jy(t.i,t.x,t.y),u=i.next,f=t.prev;return i.next=t,t.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,f.next=o,o.prev=f,o}function o0(i,t,n,o){const u=Jy(i,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Wu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Jy(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Yy(i,t,n){const o=n.patternDependencies;let u=!1;for(const f of t){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Qy(i,t,n,o,u){const f=u.patternDependencies;for(const m of t){const y=m.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o-1},n,{},u.availableImages),P=y.evaluate({zoom:o},n,{},u.availableImages),A=y.evaluate({zoom:o+1},n,{},u.availableImages);x=x&&x.name?x.name:x,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,f[x]=!0,f[P]=!0,f[A]=!0,n.patterns[m.id]={min:x,mid:P,max:A}}}return n}class e_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kr,this.indexArray=new Dr,this.indexArray2=new wn,this.programConfigurations=new ka(t.layers,t.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Yy("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),m=[];for(const{feature:y,id:x,index:P,sourceLayerIndex:A}of t){const E=this.layers[0]._featureFilter.needGeometry,D=Ma(y,E);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o,n.availableImages):void 0,q={id:x,properties:y.properties,type:y.type,sourceLayerIndex:A,index:P,geometry:E?D.geometry:Ea(y),patterns:{},sortKey:F};m.push(q)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:P,sourceLayerIndex:A}=y;if(this.hasPattern){const E=Qy("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(y,x,P,o,{});n.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,f){for(const m of ol(n,500)){let y=0;for(const F of m)y+=F.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),P=x.vertexLength,A=[],E=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&E.push(A.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),A.push(F[0].x),A.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(Z+J-1,Z+J),A.push(F[J].x),A.push(F[J].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const D=i0(A,E);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(P+D[F],P+D[F+1],P+D[F+2]);x.vertexLength+=y,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}let a0,l0;_t("FillBucket",e_,{omit:["layers","patternFeatures"]});var _w={get paint(){return l0=l0||new p({"fill-antialias":new bt(be.paint_fill["fill-antialias"]),"fill-opacity":new Rt(be.paint_fill["fill-opacity"]),"fill-color":new Rt(be.paint_fill["fill-color"]),"fill-outline-color":new Rt(be.paint_fill["fill-outline-color"]),"fill-translate":new bt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Il(be.paint_fill["fill-pattern"])})},get layout(){return a0=a0||new p({"fill-sort-key":new Rt(be.layout_fill["fill-sort-key"])})}};class vw extends r{constructor(t){super(t,_w)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new e_(t)}queryRadius(){return Df(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y){return Zv(Lf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),u)}isTileClipped(){return!0}}const xw=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),bw=_([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ww}=xw;var zo={},Sw=U,c0=Fl;function Fl(i,t,n,o,u){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(Tw,this,t)}function Tw(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,u){for(var f=o.readVarint()+o.pos;o.pos<f;){var m=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[m]=y}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function Pw(i){for(var t,n,o=0,u=0,f=i.length,m=f-1;u<f;m=u++)o+=((n=i[m]).x-(t=i[u]).x)*(t.y+n.y);return o}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,u=0,f=0,m=0,y=[];i.pos<n;){if(u<=0){var x=i.readVarint();o=7&x,u=x>>3}if(u--,o===1||o===2)f+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&y.push(t),t=[]),t.push(new Sw(f,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&y.push(t),y},Fl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,u=0,f=0,m=1/0,y=-1/0,x=1/0,P=-1/0;i.pos<t;){if(o<=0){var A=i.readVarint();n=7&A,o=A>>3}if(o--,n===1||n===2)(u+=i.readSVarint())<m&&(m=u),u>y&&(y=u),(f+=i.readSVarint())<x&&(x=f),f>P&&(P=f);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,y,P]},Fl.prototype.toGeoJSON=function(i,t,n){var o,u,f=this.extent*Math.pow(2,n),m=this.extent*i,y=this.extent*t,x=this.loadGeometry(),P=Fl.types[this.type];function A(F){for(var q=0;q<F.length;q++){var Z=F[q];F[q]=[360*(Z.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(o=0;o<x.length;o++)E[o]=x[o][0];A(x=E);break;case 2:for(o=0;o<x.length;o++)A(x[o]);break;case 3:for(x=function(F){var q=F.length;if(q<=1)return[F];for(var Z,J,re=[],we=0;we<q;we++){var he=Pw(F[we]);he!==0&&(J===void 0&&(J=he<0),J===he<0?(Z&&re.push(Z),Z=[F[we]]):Z.push(F[we]))}return Z&&re.push(Z),re}(x),o=0;o<x.length;o++)for(u=0;u<x[o].length;u++)A(x[o][u])}x.length===1?x=x[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Iw=c0,u0=h0;function h0(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Cw,this,t),this.length=this._features.length}function Cw(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var u=null,f=o.readVarint()+o.pos;o.pos<f;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(n))}h0.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Iw(this._pbf,t,this.extent,this._keys,this._values)};var Aw=u0;function kw(i,t,n){if(i===3){var o=new Aw(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}zo.VectorTile=function(i,t){this.layers=i.readFields(kw,{},t)},zo.VectorTileFeature=c0,zo.VectorTileLayer=u0;const Ew=zo.VectorTileFeature.types,t_=Math.pow(2,13);function Hu(i,t,n,o,u,f,m,y){i.emplaceBack(t,n,2*Math.floor(o*t_)+m,u*t_*2,f*t_*2,Math.round(y))}class i_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Io,this.centroidVertexArray=new En,this.indexArray=new Dr,this.programConfigurations=new ka(t.layers,t.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=Yy("fill-extrusion",this.layers,n);for(const{feature:u,id:f,index:m,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,P=Ma(u,x);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),P,o))continue;const A={id:f,sourceLayerIndex:y,index:m,geometry:x?P.geometry:Ea(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(Qy("fill-extrusion",this.layers,A,this.zoom,n)):this.addFeature(A,A.geometry,m,o,{}),n.featureIndex.insert(u,A.geometry,m,y,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ww),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,f){for(const m of ol(n,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const q of m)x+=q.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of m){if(q.length===0||zw(q))continue;let Z=0;for(let J=0;J<q.length;J++){const re=q[J];if(J>=1){const we=q[J-1];if(!Mw(re,we)){P.vertexLength+4>ai.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=re.sub(we)._perp()._unit(),ye=we.dist(re);Z+ye>32768&&(Z=0),Hu(this.layoutVertexArray,re.x,re.y,he.x,he.y,0,0,Z),Hu(this.layoutVertexArray,re.x,re.y,he.x,he.y,0,1,Z),y.x+=2*re.x,y.y+=2*re.y,y.vertexCount+=2,Z+=ye,Hu(this.layoutVertexArray,we.x,we.y,he.x,he.y,0,0,Z),Hu(this.layoutVertexArray,we.x,we.y,he.x,he.y,0,1,Z),y.x+=2*we.x,y.y+=2*we.y,y.vertexCount+=2;const ke=P.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+x>ai.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Ew[t.type]!=="Polygon")continue;const A=[],E=[],D=P.vertexLength;for(const q of m)if(q.length!==0){q!==m[0]&&E.push(A.length/2);for(let Z=0;Z<q.length;Z++){const J=q[Z];Hu(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),y.x+=J.x,y.y+=J.y,y.vertexCount+=1,A.push(J.x),A.push(J.y)}}const F=i0(A,E);for(let q=0;q<F.length;q+=3)this.indexArray.emplaceBack(D+F[q],D+F[q+2],D+F[q+1]);P.primitiveLength+=F.length/3,P.vertexLength+=x;for(let q=0;q<y.vertexCount;q++){const Z=Math.floor(y.x/y.vertexCount),J=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(Z,J)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}function Mw(i,t){return i.x===t.x&&(i.x<0||i.x>ln)||i.y===t.y&&(i.y<0||i.y>ln)}function zw(i){return i.every(t=>t.x<0)||i.every(t=>t.x>ln)||i.every(t=>t.y<0)||i.every(t=>t.y>ln)}let d0;_t("FillExtrusionBucket",i_,{omit:["layers","features"]});var Dw={get paint(){return d0=d0||new p({"fill-extrusion-opacity":new bt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Il(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Lw extends r{constructor(t){super(t,Dw)}createBucket(t){return new i_(t)}queryRadius(){return Df(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,u,f,m,y,x){const P=Lf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),A=this.paint.get("fill-extrusion-height").evaluate(n,o),E=this.paint.get("fill-extrusion-base").evaluate(n,o),D=function(q,Z,J,re){const we=[];for(const he of q){const ye=[he.x,he.y,0,1];Rf(ye,ye,Z),we.push(new B(ye[0]/ye[3],ye[1]/ye[3]))}return we}(P,x),F=function(q,Z,J,re){const we=[],he=[],ye=re[8]*Z,ke=re[9]*Z,Ze=re[10]*Z,ft=re[11]*Z,Lt=re[8]*J,ht=re[9]*J,ot=re[10]*J,Tt=re[11]*J;for(const vt of q){const yt=[],Re=[];for(const At of vt){const St=At.x,Ut=At.y,Ii=re[0]*St+re[4]*Ut+re[12],Si=re[1]*St+re[5]*Ut+re[13],fn=re[2]*St+re[6]*Ut+re[14],$r=re[3]*St+re[7]*Ut+re[15],Dn=fn+Ze,mn=$r+ft,Qn=Ii+Lt,er=Si+ht,tr=fn+ot,Yi=$r+Tt,gn=new B((Ii+ye)/mn,(Si+ke)/mn);gn.z=Dn/mn,yt.push(gn);const jn=new B(Qn/Yi,er/Yi);jn.z=tr/Yi,Re.push(jn)}we.push(yt),he.push(Re)}return[we,he]}(u,E,A,x);return function(q,Z,J){let re=1/0;Zv(J,Z)&&(re=p0(J,Z[0]));for(let we=0;we<Z.length;we++){const he=Z[we],ye=q[we];for(let ke=0;ke<he.length-1;ke++){const Ze=he[ke],ft=[Ze,he[ke+1],ye[ke+1],ye[ke],Ze];qv(J,ft)&&(re=Math.min(re,p0(J,ft)))}}return re!==1/0&&re}(F[0],F[1],D)}}function Xu(i,t){return i.x*t.x+i.y*t.y}function p0(i,t){if(i.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const f=t[n],m=i[0],y=u.sub(o),x=f.sub(o),P=m.sub(o),A=Xu(y,y),E=Xu(y,x),D=Xu(x,x),F=Xu(P,y),q=Xu(P,x),Z=A*D-E*E,J=(D*F-E*q)/Z,re=(A*q-E*F)/Z,we=o.z*(1-J-re)+u.z*J+f.z*re;if(isFinite(we))return we}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Rw=_([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ow}=Rw,Fw=_([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Bw}=Fw,Nw=zo.VectorTileFeature.types,Vw=Math.cos(Math.PI/180*37.5),f0=Math.pow(2,14)/.5;class n_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Al,this.layoutVertexArray2=new Co,this.indexArray=new Dr,this.programConfigurations=new ka(t.layers,t.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Yy("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),m=[];for(const{feature:y,id:x,index:P,sourceLayerIndex:A}of t){const E=this.layers[0]._featureFilter.needGeometry,D=Ma(y,E);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o):void 0,q={id:x,properties:y.properties,type:y.type,sourceLayerIndex:A,index:P,geometry:E?D.geometry:Ea(y),patterns:{},sortKey:F};m.push(q)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:P,sourceLayerIndex:A}=y;if(this.hasPattern){const E=Qy("line",this.layers,y,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(y,x,P,o,{});n.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Bw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ow),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,f){const m=this.layers[0].layout,y=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),P=m.get("line-miter-limit"),A=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const E of n)this.addLine(E,t,y,x,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}addLine(t,n,o,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Nw[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let P=0;for(;P<x-1&&t[P].equals(t[P+1]);)P++;if(x<(y?3:2))return;o==="bevel"&&(f=1.05);const A=this.overscaling<=16?15*ln/(512*this.overscaling):0,E=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,F,q,Z,J;this.e1=this.e2=-1,y&&(D=t[x-2],J=t[P].sub(D)._unit()._perp());for(let re=P;re<x;re++){if(q=re===x-1?y?t[P+1]:void 0:t[re+1],q&&t[re].equals(q))continue;J&&(Z=J),D&&(F=D),D=t[re],J=q?q.sub(D)._unit()._perp():Z,Z=Z||J;let we=Z.add(J);we.x===0&&we.y===0||we._unit();const he=Z.x*J.x+Z.y*J.y,ye=we.x*J.x+we.y*J.y,ke=ye!==0?1/ye:1/0,Ze=2*Math.sqrt(2-2*ye),ft=ye<Vw&&F&&q,Lt=Z.x*J.y-Z.y*J.x>0;if(ft&&re>P){const Tt=D.dist(F);if(Tt>2*A){const vt=D.sub(D.sub(F)._mult(A/Tt)._round());this.updateDistance(F,vt),this.addCurrentVertex(vt,Z,0,0,E),F=vt}}const ht=F&&q;let ot=ht?o:y?"butt":u;if(ht&&ot==="round"&&(ke<m?ot="miter":ke<=2&&(ot="fakeround")),ot==="miter"&&ke>f&&(ot="bevel"),ot==="bevel"&&(ke>2&&(ot="flipbevel"),ke<f&&(ot="miter")),F&&this.updateDistance(F,D),ot==="miter")we._mult(ke),this.addCurrentVertex(D,we,0,0,E);else if(ot==="flipbevel"){if(ke>100)we=J.mult(-1);else{const Tt=ke*Z.add(J).mag()/Z.sub(J).mag();we._perp()._mult(Tt*(Lt?-1:1))}this.addCurrentVertex(D,we,0,0,E),this.addCurrentVertex(D,we.mult(-1),0,0,E)}else if(ot==="bevel"||ot==="fakeround"){const Tt=-Math.sqrt(ke*ke-1),vt=Lt?Tt:0,yt=Lt?0:Tt;if(F&&this.addCurrentVertex(D,Z,vt,yt,E),ot==="fakeround"){const Re=Math.round(180*Ze/Math.PI/20);for(let At=1;At<Re;At++){let St=At/Re;if(St!==.5){const Ii=St-.5;St+=St*Ii*(St-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Ii*Ii+(.848013+he*(.215638*he-1.06021)))}const Ut=J.sub(Z)._mult(St)._add(Z)._unit()._mult(Lt?-1:1);this.addHalfVertex(D,Ut.x,Ut.y,!1,Lt,0,E)}}q&&this.addCurrentVertex(D,J,-vt,-yt,E)}else if(ot==="butt")this.addCurrentVertex(D,we,0,0,E);else if(ot==="square"){const Tt=F?1:-1;this.addCurrentVertex(D,we,Tt,Tt,E)}else ot==="round"&&(F&&(this.addCurrentVertex(D,Z,0,0,E),this.addCurrentVertex(D,Z,1,1,E,!0)),q&&(this.addCurrentVertex(D,J,-1,-1,E,!0),this.addCurrentVertex(D,J,0,0,E)));if(ft&&re<x-1){const Tt=D.dist(q);if(Tt>2*A){const vt=D.add(q.sub(D)._mult(A/Tt)._round());this.updateDistance(D,vt),this.addCurrentVertex(vt,J,0,0,E),D=vt}}}}addCurrentVertex(t,n,o,u,f,m=!1){const y=n.y*u-n.x,x=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,m,!1,o,f),this.addHalfVertex(t,y,x,m,!0,-u,f),this.distance>f0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,f,m))}addHalfVertex({x:t,y:n},o,u,f,m,y,x){const P=.5*(this.lineClips?this.scaledDistance*(f0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),x.primitiveLength++),m?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let m0,g0;_t("LineBucket",n_,{omit:["layers","patternFeatures"]});var y0={get paint(){return g0=g0||new p({"line-opacity":new Rt(be.paint_line["line-opacity"]),"line-color":new Rt(be.paint_line["line-color"]),"line-translate":new bt(be.paint_line["line-translate"]),"line-translate-anchor":new bt(be.paint_line["line-translate-anchor"]),"line-width":new Rt(be.paint_line["line-width"]),"line-gap-width":new Rt(be.paint_line["line-gap-width"]),"line-offset":new Rt(be.paint_line["line-offset"]),"line-blur":new Rt(be.paint_line["line-blur"]),"line-dasharray":new Cl(be.paint_line["line-dasharray"]),"line-pattern":new Il(be.paint_line["line-pattern"]),"line-gradient":new Bu(be.paint_line["line-gradient"])})},get layout(){return m0=m0||new p({"line-cap":new bt(be.layout_line["line-cap"]),"line-join":new Rt(be.layout_line["line-join"]),"line-miter-limit":new bt(be.layout_line["line-miter-limit"]),"line-round-limit":new bt(be.layout_line["line-round-limit"]),"line-sort-key":new Rt(be.layout_line["line-sort-key"])})}};class jw extends Rt{possiblyEvaluate(t,n){return n=new Ei(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=$e({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Nf;class Uw extends r{constructor(t){super(t,y0),this.gradientVersion=0,Nf||(Nf=new jw(y0.paint.properties["line-width"].specification),Nf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Nf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new n_(t)}queryRadius(t){const n=t,o=_0(ju("line-width",this,n),ju("line-gap-width",this,n)),u=ju("line-offset",this,n);return o/2+Math.abs(u)+Df(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y){const x=Lf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),P=y/2*_0(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),A=this.paint.get("line-offset").evaluate(n,o);return A&&(u=function(E,D){const F=[];for(let q=0;q<E.length;q++){const Z=E[q],J=[];for(let re=0;re<Z.length;re++){const we=Z[re-1],he=Z[re],ye=Z[re+1],ke=re===0?new B(0,0):he.sub(we)._unit()._perp(),Ze=re===Z.length-1?new B(0,0):ye.sub(he)._unit()._perp(),ft=ke._add(Ze)._unit(),Lt=ft.x*Ze.x+ft.y*Ze.y;Lt!==0&&ft._mult(1/Lt),J.push(ft._mult(D)._add(he))}F.push(J)}return F}(u,A*y)),function(E,D,F){for(let q=0;q<D.length;q++){const Z=D[q];if(E.length>=3){for(let J=0;J<Z.length;J++)if(Ll(E,Z[J]))return!0}if(J1(E,Z,F))return!0}return!1}(x,u,P)}isTileClipped(){return!0}}function _0(i,t){return t>0?t+2*i:i}const qw=_([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zw=_([{name:"a_projected_pos",components:3,type:"Float32"}],4);_([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Gw=_([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v0=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ww=_([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hw(i,t,n){return i.sections.forEach(o=>{o.text=function(u,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),hr.applyArabicShaping&&(u=hr.applyArabicShaping(u)),u}(o.text,t,n)}),i}_([{name:"triangle",components:3,type:"Uint16"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_([{type:"Float32",name:"offsetX"}]),_([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ku={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var un=24,x0=wi,b0=function(i,t,n,o,u){var f,m,y=8*u-o-1,x=(1<<y)-1,P=x>>1,A=-7,E=u-1,D=-1,F=i[t+E];for(E+=D,f=F&(1<<-A)-1,F>>=-A,A+=y;A>0;f=256*f+i[t+E],E+=D,A-=8);for(m=f&(1<<-A)-1,f>>=-A,A+=o;A>0;m=256*m+i[t+E],E+=D,A-=8);if(f===0)f=1-P;else{if(f===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,o),f-=P}return(F?-1:1)*m*Math.pow(2,f-o)},w0=function(i,t,n,o,u,f){var m,y,x,P=8*f-u-1,A=(1<<P)-1,E=A>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,q=1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=A):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+E>=1?D/x:D*Math.pow(2,1-E))*x>=2&&(m++,x/=2),m+E>=A?(y=0,m=A):m+E>=1?(y=(t*x-1)*Math.pow(2,u),m+=E):(y=t*Math.pow(2,E-1)*Math.pow(2,u),m=0));u>=8;i[n+F]=255&y,F+=q,y/=256,u-=8);for(m=m<<u|y,P+=u;P>0;i[n+F]=255&m,F+=q,m/=256,P-=8);i[n+F-q]|=128*Z};function wi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}wi.Varint=0,wi.Fixed64=1,wi.Bytes=2,wi.Fixed32=5;var r_=4294967296,S0=1/r_,T0=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Gs(i){return i.type===wi.Bytes?i.readVarint()+i.pos:i.pos+1}function Bl(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function P0(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function Xw(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function Kw(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function $w(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function Jw(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function Yw(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function Qw(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function e2(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function t2(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function i2(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function Vf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Nl(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function I0(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}wi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),u=o>>3,f=this.pos;this.type=7&o,i(u,t,this),this.pos===f&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Vf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=I0(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Vf(this.buf,this.pos)+Vf(this.buf,this.pos+4)*r_;return this.pos+=8,i},readSFixed64:function(){var i=Vf(this.buf,this.pos)+I0(this.buf,this.pos+4)*r_;return this.pos+=8,i},readFloat:function(){var i=b0(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=b0(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(u,f,m){var y,x,P=m.buf;if(y=(112&(x=P[m.pos++]))>>4,x<128||(y|=(127&(x=P[m.pos++]))<<3,x<128)||(y|=(127&(x=P[m.pos++]))<<10,x<128)||(y|=(127&(x=P[m.pos++]))<<17,x<128)||(y|=(127&(x=P[m.pos++]))<<24,x<128)||(y|=(1&(x=P[m.pos++]))<<31,x<128))return Bl(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&T0?function(n,o,u){return T0.decode(n.subarray(o,u))}(this.buf,t,i):function(n,o,u){for(var f="",m=o;m<u;){var y,x,P,A=n[m],E=null,D=A>239?4:A>223?3:A>191?2:1;if(m+D>u)break;D===1?A<128&&(E=A):D===2?(192&(y=n[m+1]))==128&&(E=(31&A)<<6|63&y)<=127&&(E=null):D===3?(x=n[m+2],(192&(y=n[m+1]))==128&&(192&x)==128&&((E=(15&A)<<12|(63&y)<<6|63&x)<=2047||E>=55296&&E<=57343)&&(E=null)):D===4&&(x=n[m+2],P=n[m+3],(192&(y=n[m+1]))==128&&(192&x)==128&&(192&P)==128&&((E=(15&A)<<18|(63&y)<<12|(63&x)<<6|63&P)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,D=1):E>65535&&(E-=65536,f+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),f+=String.fromCharCode(E),m+=D}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==wi.Bytes)return i.push(this.readVarint(t));var n=Gs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==wi.Bytes)return i.push(this.readSVarint());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==wi.Bytes)return i.push(this.readBoolean());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==wi.Bytes)return i.push(this.readFloat());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==wi.Bytes)return i.push(this.readDouble());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed32());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed32());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed64());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed64());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===wi.Varint)for(;this.buf[this.pos++]>127;);else if(t===wi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===wi.Fixed32)this.pos+=4;else{if(t!==wi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Nl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Nl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Nl(this.buf,-1&i,this.pos),Nl(this.buf,Math.floor(i*S0),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Nl(this.buf,-1&i,this.pos),Nl(this.buf,Math.floor(i*S0),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(o,0,n),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,f){for(var m,y,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===u.length?(o[f++]=239,o[f++]=191,o[f++]=189):y=m;continue}if(m<56320){o[f++]=239,o[f++]=191,o[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(o[f++]=239,o[f++]=191,o[f++]=189,y=null);m<128?o[f++]=m:(m<2048?o[f++]=m>>6|192:(m<65536?o[f++]=m>>12|224:(o[f++]=m>>18|240,o[f++]=m>>12&63|128),o[f++]=m>>6&63|128),o[f++]=63&m|128)}return f}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&P0(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),w0(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),w0(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&P0(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,wi.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Xw,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Kw,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Yw,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,$w,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Jw,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Qw,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,e2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,t2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,i2,t)},writeBytesField:function(i,t){this.writeTag(i,wi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,wi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,wi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,wi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,wi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,wi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,wi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,wi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,wi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,wi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var s_=j(x0);const o_=3;function n2(i,t,n){i===1&&n.readMessage(r2,t)}function r2(i,t,n){if(i===3){const{id:o,bitmap:u,width:f,height:m,left:y,top:x,advance:P}=n.readMessage(s2,{});t.push({id:o,bitmap:new qu({width:f+2*o_,height:m+2*o_},u),metrics:{width:f,height:m,left:y,top:x,advance:P}})}}function s2(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const C0=o_;function A0(i){let t=0,n=0;for(const m of i)t+=m.w*m.h,n=Math.max(n,m.w);i.sort((m,y)=>y.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,f=0;for(const m of i)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const P=o.pop();y<o.length&&(o[y]=P)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(o.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:f,fill:t/(u*f)||0}}const pr=1;class a_{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:f,content:m,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=m,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+pr,this.paddedRect.y+pr]}get br(){return[this.paddedRect.x+this.paddedRect.w-pr,this.paddedRect.y+this.paddedRect.h-pr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*pr)/this.pixelRatio,(this.paddedRect.h-2*pr)/this.pixelRatio]}}class k0{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,o,f),this.addImages(n,u,f);const{w:m,h:y}=A0(f),x=new Lr({width:m||1,height:y||1});for(const P in t){const A=t[P],E=o[P].paddedRect;Lr.copy(A.data,x,{x:0,y:0},{x:E.x+pr,y:E.y+pr},A.data)}for(const P in n){const A=n[P],E=u[P].paddedRect,D=E.x+pr,F=E.y+pr,q=A.data.width,Z=A.data.height;Lr.copy(A.data,x,{x:0,y:0},{x:D,y:F},A.data),Lr.copy(A.data,x,{x:0,y:Z-1},{x:D,y:F-1},{width:q,height:1}),Lr.copy(A.data,x,{x:0,y:0},{x:D,y:F+Z},{width:q,height:1}),Lr.copy(A.data,x,{x:q-1,y:0},{x:D-1,y:F},{width:1,height:Z}),Lr.copy(A.data,x,{x:0,y:0},{x:D+q,y:F},{width:1,height:Z})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const f=t[u],m={x:0,y:0,w:f.data.width+2*pr,h:f.data.height+2*pr};o.push(m),n[u]=new a_(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,f]=t.tl;o.update(n.data,void 0,{x:u,y:f})}}var Do;_t("ImagePosition",a_),_t("ImageAtlas",k0),b.ah=void 0,(Do=b.ah||(b.ah={}))[Do.none=0]="none",Do[Do.horizontal=1]="horizontal",Do[Do.vertical=2]="vertical",Do[Do.horizontalOnly=3]="horizontalOnly";const $u=-17;class Ju{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ju;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ju;return n.imageName=t,n}}class Vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Vl;for(let u=0;u<t.sections.length;u++){const f=t.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,f=t.charCodeAt(o-1)||null;n+=u&&If(u)&&!Ku[t[o+1]]||f&&If(f)&&!Ku[t[o-1]]||!Ku[t[o]]?t[o]:Ku[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Uf[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Uf[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Vl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ju.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void De("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ju.forImage(n)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jf(i,t,n,o,u,f,m,y,x,P,A,E,D,F,q){const Z=Vl.fromFeature(i,u);let J;E===b.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:re,processStyledBidirectionalText:we}=hr;if(re&&Z.sections.length===1){J=[];const ke=re(Z.toString(),l_(Z,P,f,t,o,F));for(const Ze of ke){const ft=new Vl;ft.text=Ze,ft.sections=Z.sections;for(let Lt=0;Lt<Ze.length;Lt++)ft.sectionIndex.push(0);J.push(ft)}}else if(we){J=[];const ke=we(Z.text,Z.sectionIndex,l_(Z,P,f,t,o,F));for(const Ze of ke){const ft=new Vl;ft.text=Ze[0],ft.sectionIndex=Ze[1],ft.sections=Z.sections,J.push(ft)}}else J=function(ke,Ze){const ft=[],Lt=ke.text;let ht=0;for(const ot of Ze)ft.push(ke.substring(ht,ot)),ht=ot;return ht<Lt.length&&ft.push(ke.substring(ht,Lt.length)),ft}(Z,l_(Z,P,f,t,o,F));const he=[],ye={positionedLines:he,text:Z.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(ke,Ze,ft,Lt,ht,ot,Tt,vt,yt,Re,At,St){let Ut=0,Ii=$u,Si=0,fn=0;const $r=vt==="right"?1:vt==="left"?0:.5;let Dn=0;for(const Yi of ht){Yi.trim();const gn=Yi.getMaxScale(),jn=(gn-1)*un,Ln={positionedGlyphs:[],lineOffset:0};ke.positionedLines[Dn]=Ln;const ir=Ln.positionedGlyphs;let Rn=0;if(!Yi.length()){Ii+=ot,++Dn;continue}for(let fr=0;fr<Yi.length();fr++){const pi=Yi.getSection(fr),Ai=Yi.getSectionIndex(fr),Li=Yi.getCharCode(fr);let Sr=0,Gi=null,Zl=null,ys=null,_s=un;const Jr=!(yt===b.ah.horizontal||!At&&!Ou(Li)||At&&(Uf[Li]||(mn=Li,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(mn)))));if(pi.imageName){const Fr=Lt[pi.imageName];if(!Fr)continue;ys=pi.imageName,ke.iconsInText=ke.iconsInText||!0,Zl=Fr.paddedRect;const Sn=Fr.displaySize;pi.scale=pi.scale*un/St,Gi={width:Sn[0],height:Sn[1],left:pr,top:-C0,advance:Jr?Sn[1]:Sn[0]},Sr=jn+(un-Sn[1]*pi.scale),_s=Gi.advance;const Ws=Jr?Sn[0]*pi.scale-un*gn:Sn[1]*pi.scale-un*gn;Ws>0&&Ws>Rn&&(Rn=Ws)}else{const Fr=ft[pi.fontStack],Sn=Fr&&Fr[Li];if(Sn&&Sn.rect)Zl=Sn.rect,Gi=Sn.metrics;else{const Ws=Ze[pi.fontStack],nh=Ws&&Ws[Li];if(!nh)continue;Gi=nh.metrics}Sr=(gn-pi.scale)*un}Jr?(ke.verticalizable=!0,ir.push({glyph:Li,imageName:ys,x:Ut,y:Ii+Sr,vertical:Jr,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:Ai,metrics:Gi,rect:Zl}),Ut+=_s*pi.scale+Re):(ir.push({glyph:Li,imageName:ys,x:Ut,y:Ii+Sr,vertical:Jr,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:Ai,metrics:Gi,rect:Zl}),Ut+=Gi.advance*pi.scale+Re)}ir.length!==0&&(Si=Math.max(Ut-Re,Si),c2(ir,0,ir.length-1,$r,Rn)),Ut=0;const Or=ot*gn+Rn;Ln.lineOffset=Math.max(Rn,jn),Ii+=Or,fn=Math.max(Or,fn),++Dn}var mn;const Qn=Ii-$u,{horizontalAlign:er,verticalAlign:tr}=c_(Tt);(function(Yi,gn,jn,Ln,ir,Rn,Or,fr,pi){const Ai=(gn-jn)*ir;let Li=0;Li=Rn!==Or?-fr*Ln-$u:(-Ln*pi+.5)*Or;for(const Sr of Yi)for(const Gi of Sr.positionedGlyphs)Gi.x+=Ai,Gi.y+=Li})(ke.positionedLines,$r,er,tr,Si,fn,ot,Qn,ht.length),ke.top+=-tr*Qn,ke.bottom=ke.top+Qn,ke.left+=-er*Si,ke.right=ke.left+Si}(ye,t,n,o,J,m,y,x,E,P,D,q),!function(ke){for(const Ze of ke)if(Ze.positionedGlyphs.length!==0)return!1;return!0}(he)&&ye}const Uf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},o2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},a2={40:!0};function E0(i,t,n,o,u,f){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*un/f+u:0}{const m=n[t.fontStack],y=m&&m[i];return y?y.metrics.advance*t.scale+u:0}}function M0(i,t,n,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(n)*n}function l2(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function z0(i,t,n,o,u,f){let m=null,y=M0(t,n,u,f);for(const x of o){const P=M0(t-x.x,n,u,f)+x.badness;P<=y&&(m=x,y=P)}return{index:i,x:t,priorBreak:m,badness:y}}function D0(i){return i?D0(i.priorBreak).concat(i.index):[]}function l_(i,t,n,o,u,f){if(!i)return[];const m=[],y=function(E,D,F,q,Z,J){let re=0;for(let we=0;we<E.length();we++){const he=E.getSection(we);re+=E0(E.getCharCode(we),he,q,Z,D,J)}return re/Math.max(1,Math.ceil(re/F))}(i,t,n,o,u,f),x=i.text.indexOf("​")>=0;let P=0;for(let E=0;E<i.length();E++){const D=i.getSection(E),F=i.getCharCode(E);if(Uf[F]||(P+=E0(F,D,o,u,t,f)),E<i.length()-1){const q=!((A=F)<11904)&&(!!oi["CJK Compatibility Forms"](A)||!!oi["CJK Compatibility"](A)||!!oi["CJK Strokes"](A)||!!oi["CJK Symbols and Punctuation"](A)||!!oi["Enclosed CJK Letters and Months"](A)||!!oi["Halfwidth and Fullwidth Forms"](A)||!!oi["Ideographic Description Characters"](A)||!!oi["Vertical Forms"](A)||Pf.test(String.fromCodePoint(A)));(o2[F]||q||D.imageName||E!==i.length()-2&&a2[i.getCharCode(E+1)])&&m.push(z0(E+1,P,y,m,l2(F,i.getCharCode(E+1),q&&x),!1))}}var A;return D0(z0(i.length(),P,y,m,0,!0))}function c_(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function c2(i,t,n,o,u){if(!o&&!u)return;const f=i[n],m=(i[n].x+f.metrics.advance*f.scale)*o;for(let y=t;y<=n;y++)i[y].x-=m,i[y].y+=u}function u2(i,t,n){const{horizontalAlign:o,verticalAlign:u}=c_(n),f=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function L0(i){var t,n;let o=i.left,u=i.top,f=i.right-o,m=i.bottom-u;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/m<P||y==="proportional"){const A=Math.ceil(m*P);o*=A/f,f=A}}else if(y==="proportional"&&x==="stretchOnly"&&P!==0&&f/m>P){const A=Math.ceil(f/P);u*=A/m,m=A}return{x1:o,y1:u,x2:o+f,y2:u+m}}function R0(i,t,n,o,u,f){const m=i.image;let y;if(m.content){const J=m.content,re=m.pixelRatio||1;y=[J[0]/re,J[1]/re,m.displaySize[0]-J[2]/re,m.displaySize[1]-J[3]/re]}const x=t.left*f,P=t.right*f;let A,E,D,F;n==="width"||n==="both"?(F=u[0]+x-o[3],E=u[0]+P+o[1]):(F=u[0]+(x+P-m.displaySize[0])/2,E=F+m.displaySize[0]);const q=t.top*f,Z=t.bottom*f;return n==="height"||n==="both"?(A=u[1]+q-o[0],D=u[1]+Z+o[2]):(A=u[1]+(q+Z-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:E,bottom:D,left:F,collisionPadding:y}}const Yu=255,gs=128,Lo=Yu*gs;function O0(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ei(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let f=0;for(;f<o.length&&o[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const y=o[f],x=o[m];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new Ei(y)),maxSize:n.evaluate(new Ei(x)),interpolationType:u}}}function u_(i,t,n){let o="never";const u=i.get(t);return u?o=u:i.get(n)&&(o="always"),o}const h2=zo.VectorTileFeature.types,d2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qf(i,t,n,o,u,f,m,y,x,P,A,E,D){const F=y?Math.min(Lo,Math.round(y[0])):0,q=y?Math.min(Lo,Math.round(y[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),f,m,(F<<1)+(x?1:0),q,16*P,16*A,256*E,256*D)}function h_(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function p2(i){for(const t of i.sections)if(Ny(t.text))return!0;return!1}class d_{constructor(t){this.layoutVertexArray=new kl,this.indexArray=new Dr,this.programConfigurations=t,this.segments=new ai,this.dynamicLayoutVertexArray=new Nu,this.opacityVertexArray=new br,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Zw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,d2,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",d_);class p_{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new ai,this.collisionVertexArray=new fs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",p_);class jl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wy([]),this.placementViewportMatrix=Wy([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=O0(this.zoom,n["text-size"]),this.iconSizeData=O0(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=u_(o,"text-overlap","text-allow-overlap")!=="never"||u_(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>b.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new d_(new ka(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new d_(new ka(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new zi,this.lineVertexArray=new kn,this.symbolInstances=new ni,this.textAnchorOffsets=new Di}calculateGlyphDependencies(t,n,o,u,f){for(let m=0;m<t.length;m++)if(n[t.charCodeAt(m)]=!0,(o||u)&&f){const y=Ku[t.charAt(m)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],f=u.layout,m=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),P=(y.value.kind!=="constant"||y.value.value instanceof ar&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),A=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,E=f.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const D=n.iconDependencies,F=n.glyphDependencies,q=n.availableImages,Z=new Ei(this.zoom);for(const{feature:J,id:re,index:we,sourceLayerIndex:he}of t){const ye=u._featureFilter.needGeometry,ke=Ma(J,ye);if(!u._featureFilter.filter(Z,ke,o))continue;let Ze,ft;if(ye||(ke.geometry=Ea(J)),P){const ht=u.getValueAndResolveTokens("text-field",ke,o,q),ot=ar.factory(ht),Tt=this.hasRTLText=this.hasRTLText||p2(ot);(!Tt||hr.getRTLTextPluginStatus()==="unavailable"||Tt&&hr.isParsed())&&(Ze=Hw(ot,u,ke))}if(A){const ht=u.getValueAndResolveTokens("icon-image",ke,o,q);ft=ht instanceof cr?ht:cr.fromString(ht)}if(!Ze&&!ft)continue;const Lt=this.sortFeaturesByKey?E.evaluate(ke,{},o):void 0;if(this.features.push({id:re,text:Ze,icon:ft,index:we,sourceLayerIndex:he,geometry:ke.geometry,properties:J.properties,type:h2[J.type],sortKey:Lt}),ft&&(D[ft.name]=!0),Ze){const ht=m.evaluate(ke,{},o).join(","),ot=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ah.vertical)>=0;for(const Tt of Ze.sections)if(Tt.image)D[Tt.image.name]=!0;else{const vt=Lu(Ze.toString()),yt=Tt.fontStack||ht,Re=F[yt]=F[yt]||{};this.calculateGlyphDependencies(Tt.text,Re,ot,this.allowVerticalPlacement,vt)}}}f.get("symbol-placement")==="line"&&(this.features=function(J){const re={},we={},he=[];let ye=0;function ke(ht){he.push(J[ht]),ye++}function Ze(ht,ot,Tt){const vt=we[ht];return delete we[ht],we[ot]=vt,he[vt].geometry[0].pop(),he[vt].geometry[0]=he[vt].geometry[0].concat(Tt[0]),vt}function ft(ht,ot,Tt){const vt=re[ot];return delete re[ot],re[ht]=vt,he[vt].geometry[0].shift(),he[vt].geometry[0]=Tt[0].concat(he[vt].geometry[0]),vt}function Lt(ht,ot,Tt){const vt=Tt?ot[0][ot[0].length-1]:ot[0][0];return`${ht}:${vt.x}:${vt.y}`}for(let ht=0;ht<J.length;ht++){const ot=J[ht],Tt=ot.geometry,vt=ot.text?ot.text.toString():null;if(!vt){ke(ht);continue}const yt=Lt(vt,Tt),Re=Lt(vt,Tt,!0);if(yt in we&&Re in re&&we[yt]!==re[Re]){const At=ft(yt,Re,Tt),St=Ze(yt,Re,he[At].geometry);delete re[yt],delete we[Re],we[Lt(vt,he[St].geometry,!0)]=St,he[At].geometry=null}else yt in we?Ze(yt,Re,Tt):Re in re?ft(yt,Re,Tt):(ke(ht),re[yt]=ye-1,we[Re]=ye-1)}return he.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,re)=>J.sortKey-re.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),f=t.dist(n[t.segment]);const m={};for(let y=t.segment+1;y<n.length;y++)m[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:u},y<n.length-1&&(u+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,f,m,y,x,P,A,E,D){const F=t.indexArray,q=t.layoutVertexArray,Z=t.segments.prepareSegment(4*n.length,q,F,this.canOverlap?m.sortKey:void 0),J=this.glyphOffsetArray.length,re=Z.vertexLength,we=this.allowVerticalPlacement&&y===b.ah.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let ye=0;ye<n.length;ye++){const{tl:ke,tr:Ze,bl:ft,br:Lt,tex:ht,pixelOffsetTL:ot,pixelOffsetBR:Tt,minFontScaleX:vt,minFontScaleY:yt,glyphOffset:Re,isSDF:At,sectionIndex:St}=n[ye],Ut=Z.vertexLength,Ii=Re[1];qf(q,x.x,x.y,ke.x,Ii+ke.y,ht.x,ht.y,o,At,ot.x,ot.y,vt,yt),qf(q,x.x,x.y,Ze.x,Ii+Ze.y,ht.x+ht.w,ht.y,o,At,Tt.x,ot.y,vt,yt),qf(q,x.x,x.y,ft.x,Ii+ft.y,ht.x,ht.y+ht.h,o,At,ot.x,Tt.y,vt,yt),qf(q,x.x,x.y,Lt.x,Ii+Lt.y,ht.x+ht.w,ht.y+ht.h,o,At,Tt.x,Tt.y,vt,yt),h_(t.dynamicLayoutVertexArray,x,we),F.emplaceBack(Ut,Ut+1,Ut+2),F.emplaceBack(Ut+1,Ut+2,Ut+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Re[0]),ye!==n.length-1&&St===n[ye+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,m,m.index,{},D,he&&he[St])}t.placedSymbolArray.emplaceBack(x.x,x.y,J,this.glyphOffsetArray.length-J,re,P,A,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,E)}_addCollisionDebugVertex(t,n,o,u,f,m){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,n,o,u,f,m,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),P=x.vertexLength,A=f.layoutVertexArray,E=f.collisionVertexArray,D=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(A,E,m,D,F,new B(t,n)),this._addCollisionDebugVertex(A,E,m,D,F,new B(o,n)),this._addCollisionDebugVertex(A,E,m,D,F,new B(o,u)),this._addCollisionDebugVertex(A,E,m,D,F,new B(t,u)),x.vertexLength+=4;const q=f.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let f=t;f<n;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new p_(wr,v0.members,wn),this.iconCollisionBox=new p_(wr,v0.members,wn);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,f,m,y,x,P){const A={};for(let E=n;E<o;E++){const D=t.get(E);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let E=u;E<f;E++){const D=t.get(E);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let E=m;E<y;E++){const D=t.get(E);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let E=x;E<P;E++){const D=t.get(E);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(n*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>u[y]-u[x]||f[x]-f[y]),m}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,f,m)=>{u>=0&&m.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let F0,B0;_t("SymbolBucket",jl,{omit:["layers","collisionBoxArray","features","compareText"]}),jl.MAX_GLYPHS=65535,jl.addDynamicAttributes=h_;var f_={get paint(){return B0=B0||new p({"icon-opacity":new Rt(be.paint_symbol["icon-opacity"]),"icon-color":new Rt(be.paint_symbol["icon-color"]),"icon-halo-color":new Rt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(be.paint_symbol["text-opacity"]),"text-color":new Rt(be.paint_symbol["text-color"],{runtimeType:Cn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Rt(be.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(be.paint_symbol["text-halo-blur"]),"text-translate":new bt(be.paint_symbol["text-translate"]),"text-translate-anchor":new bt(be.paint_symbol["text-translate-anchor"])})},get layout(){return F0=F0||new p({"symbol-placement":new bt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(be.layout_symbol["icon-size"]),"icon-text-fit":new bt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(be.layout_symbol["icon-image"]),"icon-rotate":new Rt(be.layout_symbol["icon-rotate"]),"icon-padding":new Rt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(be.layout_symbol["icon-offset"]),"icon-anchor":new Rt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(be.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(be.layout_symbol["text-field"]),"text-font":new Rt(be.layout_symbol["text-font"]),"text-size":new Rt(be.layout_symbol["text-size"]),"text-max-width":new Rt(be.layout_symbol["text-max-width"]),"text-line-height":new bt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(be.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(be.layout_symbol["text-justify"]),"text-radial-offset":new Rt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rt(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rt(be.layout_symbol["text-anchor"]),"text-max-angle":new bt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(be.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(be.layout_symbol["text-rotate"]),"text-padding":new bt(be.layout_symbol["text-padding"]),"text-keep-upright":new bt(be.layout_symbol["text-keep-upright"]),"text-transform":new Rt(be.layout_symbol["text-transform"]),"text-offset":new Rt(be.layout_symbol["text-offset"]),"text-allow-overlap":new bt(be.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(be.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(be.layout_symbol["text-ignore-placement"]),"text-optional":new bt(be.layout_symbol["text-optional"])})}};class N0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ir,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",N0,{omit:["defaultValue"]});class Zf extends r{constructor(t){super(t,f_)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const f=this.layout.get(t).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||fl(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(P,A)=>y&&A in y?String(y[A]):"")}(n.properties,f)}createBucket(t){return new jl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of f_.paint.overridableProperties){if(!Zf.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new N0(n),u=new pl(o,n.property.specification);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new go("source",u):new yo("composite",u,n.value.zoomStops),this.paint._values[t]=new Xr(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Zf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=f_.paint.properties[n];let f=!1;const m=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ar)m(o.value.value.sections);else if(o.value.kind==="source"){const y=P=>{f||(P instanceof Cr&&an(P.value)===Qr?m(P.value.sections):P instanceof rl?m(P.sections):P.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let V0;var f2={get paint(){return V0=V0||new p({"background-color":new bt(be.paint_background["background-color"]),"background-pattern":new Cl(be.paint_background["background-pattern"]),"background-opacity":new bt(be.paint_background["background-opacity"])})}};class m2 extends r{constructor(t){super(t,f2)}}let j0;var g2={get paint(){return j0=j0||new p({"raster-opacity":new bt(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(be.paint_raster["raster-saturation"]),"raster-contrast":new bt(be.paint_raster["raster-contrast"]),"raster-resampling":new bt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(be.paint_raster["raster-fade-duration"])})}};class y2 extends r{constructor(t){super(t,g2)}}class _2 extends r{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class v2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const m_=63710088e-1;class Ro{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ro(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return m_*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Ro)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ro(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ro(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const U0=2*Math.PI*m_;function q0(i){return U0*Math.cos(i*Math.PI/180)}function Z0(i){return(180+i)/360}function G0(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function W0(i,t){return i/q0(t)}function g_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Qu{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=Ro.convert(t);return new Qu(Z0(o.lng),G0(o.lat),W0(n,o.lat))}toLngLat(){return new Ro(360*this.x-180,g_(this.y))}toAltitude(){return this.z*q0(g_(this.y))}meterInMercatorCoordinateUnits(){return 1/U0*(t=g_(this.y),1/Math.cos(t*Math.PI/180));var t}}function H0(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class y_{constructor(t,n,o){if(!function(u,f,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=eh(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(m=this.y,y=this.z,x=H0(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),P=H0(256*(f+1),256*(m+1),y),x[0]+","+x[1]+","+P[0]+","+P[1]);var f,m,y,x,P;const A=function(E,D,F){let q,Z="";for(let J=E;J>0;J--)q=1<<J-1,Z+=(D&q?1:0)+(F&q?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new B((t.x*n-this.x)*ln,(t.y*n-this.y)*ln)}toString(){return`${this.z}/${this.x}/${this.y}`}}class X0{constructor(t,n){this.wrap=t,this.canonical=n,this.key=eh(t,n.z,n.z,n.x,n.y)}}class Rr{constructor(t,n,o,u,f){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new y_(o,+u,+f),this.key=eh(n,t,o,u,f)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Rr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?eh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):eh(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Rr(n,this.wrap,n,o,u),new Rr(n,this.wrap,n,o+1,u),new Rr(n,this.wrap,n,o,u+1),new Rr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new X0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Qu(t.x-this.wrap,t.y))}}function eh(i,t,n,o,u){(i*=2)<0&&(i=-1*i-1);const f=1<<n;return(f*f*i+f*u+o).toString(36)+n.toString(36)+t.toString(36)}_t("CanonicalTileID",y_),_t("OverscaledTileID",Rr,{omit:["posMatrix"]});class K0{constructor(t,n,o,u=1,f=1,m=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void De(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<x;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(x,P)]=this.data[this._idx(x-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,x)]=this.data[this._idx(P,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<x;P++)for(let A=0;A<x;A++){const E=this.get(P,A);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Lr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,m=o*this.dim,y=o*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:m=y-1;break;case 1:y=m+1}const x=-n*this.dim,P=-o*this.dim;for(let A=m;A<y;A++)for(let E=u;E<f;E++)this.data[this._idx(E,A)]=t.data[this._idx(E+x,A+P)]}}_t("DEMData",K0);class $0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class J0{constructor(t,n,o,u,f){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Y0{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new bo(ln,16,0),this.grid3D=new bo(ln,16,0),this.featureIndexArray=new Nn,this.promoteId=n}insert(t,n,o,u,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=m?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const A=n[P],E=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const F=A[D];E[0]=Math.min(E[0],F.x),E[1]=Math.min(E[1],F.y),E[2]=Math.max(E[2],F.x),E[3]=Math.max(E[3],F.y)}E[0]<ln&&E[1]<ln&&E[2]>=0&&E[3]>=0&&x.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new s_(this.rawTileData)).layers,this.sourceLayerCoder=new $0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const f=t.params||{},m=ln/t.tileSize/t.scale,y=vu(f.filter),x=t.queryGeometry,P=t.queryPadding*m,A=ex(x),E=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),D=ex(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(J,re,we,he)=>function(ye,ke,Ze,ft,Lt){for(const ot of ye)if(ke<=ot.x&&Ze<=ot.y&&ft>=ot.x&&Lt>=ot.y)return!0;const ht=[new B(ke,Ze),new B(ke,Lt),new B(ft,Lt),new B(ft,Ze)];if(ye.length>2){for(const ot of ht)if(Ll(ye,ot))return!0}for(let ot=0;ot<ye.length-1;ot++)if(Q1(ye[ot],ye[ot+1],ht))return!0;return!1}(t.cameraQueryGeometry,J-P,re-P,we+P,he+P));for(const J of F)E.push(J);E.sort(x2);const q={};let Z;for(let J=0;J<E.length;J++){const re=E[J];if(re===Z)continue;Z=re;const we=this.featureIndexArray.get(re);let he=null;this.loadMatchingFeature(q,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,y,f.layers,f.availableImages,n,o,u,(ye,ke,Ze)=>(he||(he=Ea(ye)),ke.queryIntersectsFeature(x,ye,Ze,he,this.z,t.transform,m,t.pixelPosMatrix)))}return q}loadMatchingFeature(t,n,o,u,f,m,y,x,P,A,E){const D=this.bucketLayerIDs[n];if(m&&!function(J,re){for(let we=0;we<J.length;we++)if(re.indexOf(J[we])>=0)return!0;return!1}(m,D))return;const F=this.sourceLayerCoder.decode(o),q=this.vtLayers[F].feature(u);if(f.needGeometry){const J=Ma(q,!0);if(!f.filter(new Ei(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!f.filter(new Ei(this.tileID.overscaledZ),q))return;const Z=this.getId(q,F);for(let J=0;J<D.length;J++){const re=D[J];if(m&&m.indexOf(re)<0)continue;const we=x[re];if(!we)continue;let he={};Z&&A&&(he=A.getState(we.sourceLayer||"_geojsonTileLayer",Z));const ye=$e({},P[re]);ye.paint=Q0(ye.paint,we.paint,q,he,y),ye.layout=Q0(ye.layout,we.layout,q,he,y);const ke=!E||E(q,we,he);if(!ke)continue;const Ze=new J0(q,this.z,this.x,this.y,Z);Ze.layer=ye;let ft=t[re];ft===void 0&&(ft=t[re]=[]),ft.push({featureIndex:u,feature:Ze,intersectionZ:ke})}}lookupSymbolFeatures(t,n,o,u,f,m,y,x){const P={};this.loadVTLayers();const A=vu(f);for(const E of t)this.loadMatchingFeature(P,o,u,E,A,m,y,x,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Q0(i,t,n,o,u){return He(i,(f,m)=>{const y=t instanceof Ia?t.get(m):null;return y&&y.evaluate?y.evaluate(n,o,u):y})}function ex(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return{minX:t,minY:n,maxX:o,maxY:u}}function x2(i,t){return t-i}function tx(i,t,n,o,u){const f=[];for(let m=0;m<i.length;m++){const y=i[m];let x;for(let P=0;P<y.length-1;P++){let A=y[P],E=y[P+1];A.x<t&&E.x<t||(A.x<t?A=new B(t,A.y+(t-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x<t&&(E=new B(t,A.y+(t-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y<n&&E.y<n||(A.y<n?A=new B(A.x+(n-A.y)/(E.y-A.y)*(E.x-A.x),n)._round():E.y<n&&(E=new B(A.x+(n-A.y)/(E.y-A.y)*(E.x-A.x),n)._round()),A.x>=o&&E.x>=o||(A.x>=o?A=new B(o,A.y+(o-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x>=o&&(E=new B(o,A.y+(o-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y>=u&&E.y>=u||(A.y>=u?A=new B(A.x+(u-A.y)/(E.y-A.y)*(E.x-A.x),u)._round():E.y>=u&&(E=new B(A.x+(u-A.y)/(E.y-A.y)*(E.x-A.x),u)._round()),x&&A.equals(x[x.length-1])||(x=[A],f.push(x)),x.push(E)))))}}return f}_t("FeatureIndex",Y0,{omit:["rawTileData","sourceLayerCoder"]});class Oo extends B{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Oo(this.x,this.y,this.angle,this.segment)}}function ix(i,t,n,o,u){if(t.segment===void 0||n===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=i[m].dist(f),f=i[m]}y+=i[m].dist(i[m+1]),m++;const x=[];let P=0;for(;y<n/2;){const A=i[m],E=i[m+1];if(!E)return!1;let D=i[m-1].angleTo(A)-A.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),P+=D;y-x[0].distance>o;)P-=x.shift().angleDelta;if(P>u)return!1;m++,y+=A.dist(E)}return!0}function nx(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function rx(i,t,n){return i?.6*t*n:0}function sx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function b2(i,t,n,o,u,f){const m=rx(n,u,f),y=sx(n,o)*f;let x=0;const P=nx(i)/2;for(let A=0;A<i.length-1;A++){const E=i[A],D=i[A+1],F=E.dist(D);if(x+F>P){const q=(P-x)/F,Z=Kn.number(E.x,D.x,q),J=Kn.number(E.y,D.y,q),re=new Oo(Z,J,D.angleTo(E),A);return re._round(),!m||ix(i,re,y,m,t)?re:void 0}x+=F}}function w2(i,t,n,o,u,f,m,y,x){const P=rx(o,f,m),A=sx(o,u),E=A*m,D=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-E<t/4&&(t=E+t/4),ox(i,D?t/2*y%t:(A/2+2*f)*m*y%t,t,P,n,E,D,!1,x)}function ox(i,t,n,o,u,f,m,y,x){const P=f/2,A=nx(i);let E=0,D=t-n,F=[];for(let q=0;q<i.length-1;q++){const Z=i[q],J=i[q+1],re=Z.dist(J),we=J.angleTo(Z);for(;D+n<E+re;){D+=n;const he=(D-E)/re,ye=Kn.number(Z.x,J.x,he),ke=Kn.number(Z.y,J.y,he);if(ye>=0&&ye<x&&ke>=0&&ke<x&&D-P>=0&&D+P<=A){const Ze=new Oo(ye,ke,we,q);Ze._round(),o&&!ix(i,Ze,f,o,u)||F.push(Ze)}}E+=re}return y||F.length||m||(F=ox(i,E/2,n,o,u,f,m,!0,x)),F}_t("Anchor",Oo);const Ul=pr;function ax(i,t,n,o){const u=[],f=i.image,m=f.pixelRatio,y=f.paddedRect.w-2*Ul,x=f.paddedRect.h-2*Ul;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=f.stretchX||[[0,y]],E=f.stretchY||[[0,x]],D=(Re,At)=>Re+At[1]-At[0],F=A.reduce(D,0),q=E.reduce(D,0),Z=y-F,J=x-q;let re=0,we=F,he=0,ye=q,ke=0,Ze=Z,ft=0,Lt=J;if(f.content&&o){const Re=f.content,At=Re[2]-Re[0],St=Re[3]-Re[1];(f.textFitWidth||f.textFitHeight)&&(P=L0(i)),re=Gf(A,0,Re[0]),he=Gf(E,0,Re[1]),we=Gf(A,Re[0],Re[2]),ye=Gf(E,Re[1],Re[3]),ke=Re[0]-re,ft=Re[1]-he,Ze=At-we,Lt=St-ye}const ht=P.x1,ot=P.y1,Tt=P.x2-ht,vt=P.y2-ot,yt=(Re,At,St,Ut)=>{const Ii=Wf(Re.stretch-re,we,Tt,ht),Si=Hf(Re.fixed-ke,Ze,Re.stretch,F),fn=Wf(At.stretch-he,ye,vt,ot),$r=Hf(At.fixed-ft,Lt,At.stretch,q),Dn=Wf(St.stretch-re,we,Tt,ht),mn=Hf(St.fixed-ke,Ze,St.stretch,F),Qn=Wf(Ut.stretch-he,ye,vt,ot),er=Hf(Ut.fixed-ft,Lt,Ut.stretch,q),tr=new B(Ii,fn),Yi=new B(Dn,fn),gn=new B(Dn,Qn),jn=new B(Ii,Qn),Ln=new B(Si/m,$r/m),ir=new B(mn/m,er/m),Rn=t*Math.PI/180;if(Rn){const pi=Math.sin(Rn),Ai=Math.cos(Rn),Li=[Ai,-pi,pi,Ai];tr._matMult(Li),Yi._matMult(Li),jn._matMult(Li),gn._matMult(Li)}const Or=Re.stretch+Re.fixed,fr=At.stretch+At.fixed;return{tl:tr,tr:Yi,bl:jn,br:gn,tex:{x:f.paddedRect.x+Ul+Or,y:f.paddedRect.y+Ul+fr,w:St.stretch+St.fixed-Or,h:Ut.stretch+Ut.fixed-fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ln,pixelOffsetBR:ir,minFontScaleX:Ze/m/Tt,minFontScaleY:Lt/m/vt,isSDF:n}};if(o&&(f.stretchX||f.stretchY)){const Re=lx(A,Z,F),At=lx(E,J,q);for(let St=0;St<Re.length-1;St++){const Ut=Re[St],Ii=Re[St+1];for(let Si=0;Si<At.length-1;Si++)u.push(yt(Ut,At[Si],Ii,At[Si+1]))}}else u.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Gf(i,t,n){let o=0;for(const u of i)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function lx(i,t,n){const o=[{fixed:-Ul,stretch:0}];for(const[u,f]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return o.push({fixed:t+Ul,stretch:n}),o}function Wf(i,t,n,o){return i/t*n+o}function Hf(i,t,n,o){return i-t*n/o}class Xf{constructor(t,n,o,u,f,m,y,x,P,A){var E;if(this.boxStartIndex=t.length,P){let D=m.top,F=m.bottom;const q=m.collisionPadding;q&&(D-=q[1],F+=q[3]);let Z=F-D;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const D=!((E=m.image)===null||E===void 0)&&E.content&&(m.image.textFitWidth||m.image.textFitHeight)?L0(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*y,D.y1-=F[1]*y,D.x2+=F[2]*y,D.y2+=F[3]*y),A){const q=new B(D.x1,D.y1),Z=new B(D.x2,D.y1),J=new B(D.x1,D.y2),re=new B(D.x2,D.y2),we=A*Math.PI/180;q._rotate(we),Z._rotate(we),J._rotate(we),re._rotate(we),D.x1=Math.min(q.x,Z.x,J.x,re.x),D.x2=Math.max(q.x,Z.x,J.x,re.x),D.y1=Math.min(q.y,Z.y,J.y,re.y),D.y2=Math.max(q.y,Z.y,J.y,re.y)}t.emplaceBack(n.x,n.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=t.length}}class S2{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const f=t-1>>1,m=n[f];if(o(u,m)>=0)break;n[t]=m,t=f}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,f=n[t];for(;t<u;){let m=1+(t<<1);const y=m+1;if(y<this.length&&o(n[y],n[m])<0&&(m=y),o(n[m],f)>=0)break;n[t]=n[m],t=m}n[t]=f}}function T2(i,t=1,n=!1){let o=1/0,u=1/0,f=-1/0,m=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const q=y[F];(!F||q.x<o)&&(o=q.x),(!F||q.y<u)&&(u=q.y),(!F||q.x>f)&&(f=q.x),(!F||q.y>m)&&(m=q.y)}const x=Math.min(f-o,m-u);let P=x/2;const A=new S2([],P2);if(x===0)return new B(o,u);for(let F=o;F<f;F+=x)for(let q=u;q<m;q+=x)A.push(new ql(F+P,q+P,P,i));let E=function(F){let q=0,Z=0,J=0;const re=F[0];for(let we=0,he=re.length,ye=he-1;we<he;ye=we++){const ke=re[we],Ze=re[ye],ft=ke.x*Ze.y-Ze.x*ke.y;Z+=(ke.x+Ze.x)*ft,J+=(ke.y+Ze.y)*ft,q+=3*ft}return new ql(Z/q,J/q,0,F)}(i),D=A.length;for(;A.length;){const F=A.pop();(F.d>E.d||!E.d)&&(E=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-E.d<=t||(P=F.h/2,A.push(new ql(F.p.x-P,F.p.y-P,P,i)),A.push(new ql(F.p.x+P,F.p.y-P,P,i)),A.push(new ql(F.p.x-P,F.p.y+P,P,i)),A.push(new ql(F.p.x+P,F.p.y+P,P,i)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function P2(i,t){return t.max-i.max}function ql(i,t,n,o){this.p=new B(i,t),this.h=n,this.d=function(u,f){let m=!1,y=1/0;for(let x=0;x<f.length;x++){const P=f[x];for(let A=0,E=P.length,D=E-1;A<E;D=A++){const F=P[A],q=P[D];F.y>u.y!=q.y>u.y&&u.x<(q.x-F.x)*(u.y-F.y)/(q.y-F.y)+F.x&&(m=!m),y=Math.min(y,Gv(u,F,q))}}return(m?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var zn;b.aq=void 0,(zn=b.aq||(b.aq={}))[zn.center=1]="center",zn[zn.left=2]="left",zn[zn.right=3]="right",zn[zn.top=4]="top",zn[zn.bottom=5]="bottom",zn[zn["top-left"]=6]="top-left",zn[zn["top-right"]=7]="top-right",zn[zn["bottom-left"]=8]="bottom-left",zn[zn["bottom-right"]=9]="bottom-right";const Fo=7,__=Number.POSITIVE_INFINITY;function cx(i,t){return t[1]!==__?function(n,o,u){let f=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-Fo;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Fo}switch(n){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,m]}(i,t[0],t[1]):function(n,o){let u=0,f=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(n){case"top-right":case"top-left":f=m-Fo;break;case"bottom-right":case"bottom-left":f=-m+Fo;break;case"bottom":f=-o+Fo;break;case"top":f=o-Fo}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,f]}(i,t[0])}function ux(i,t,n){var o;const u=i.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(f){const y=f.values,x=[];for(let P=0;P<y.length;P+=2){const A=x[P]=y[P],E=y[P+1].map(D=>D*un);A.startsWith("top")?E[1]-=Fo:A.startsWith("bottom")&&(E[1]+=Fo),x[P+1]=E}return new gr(x)}const m=u.get("text-variable-anchor");if(m){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*un,__]:u.get("text-offset").evaluate(t,{},n).map(P=>P*un);const x=[];for(const P of m)x.push(P,cx(P,y));return new gr(x)}return null}function v_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I2(i,t,n,o,u,f,m,y,x,P,A){let E=f.textMaxSize.evaluate(t,{});E===void 0&&(E=m);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},A),q=dx(n.horizontal),Z=m/24,J=i.tilePixelRatio*Z,re=i.tilePixelRatio*E/24,we=i.tilePixelRatio*y,he=i.tilePixelRatio*D.get("symbol-spacing"),ye=D.get("text-padding")*i.tilePixelRatio,ke=function(Re,At,St,Ut=1){const Ii=Re.get("icon-padding").evaluate(At,{},St),Si=Ii&&Ii.values;return[Si[0]*Ut,Si[1]*Ut,Si[2]*Ut,Si[3]*Ut]}(D,t,A,i.tilePixelRatio),Ze=D.get("text-max-angle")/180*Math.PI,ft=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Lt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ht=D.get("symbol-placement"),ot=he/2,Tt=D.get("icon-text-fit");let vt;o&&Tt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(vt=R0(o,n.vertical,Tt,D.get("icon-text-fit-padding"),F,Z)),q&&(o=R0(o,q,Tt,D.get("icon-text-fit-padding"),F,Z)));const yt=(Re,At)=>{At.x<0||At.x>=ln||At.y<0||At.y>=ln||function(St,Ut,Ii,Si,fn,$r,Dn,mn,Qn,er,tr,Yi,gn,jn,Ln,ir,Rn,Or,fr,pi,Ai,Li,Sr,Gi,Zl){const ys=St.addToLineVertexArray(Ut,Ii);let _s,Jr,Fr,Sn,Ws=0,nh=0,gx=0,yx=0,C_=-1,A_=-1;const Hs={};let _x=El("");if(St.allowVerticalPlacement&&Si.vertical){const Un=mn.layout.get("text-rotate").evaluate(Ai,{},Gi)+90;Fr=new Xf(Qn,Ut,er,tr,Yi,Si.vertical,gn,jn,Ln,Un),Dn&&(Sn=new Xf(Qn,Ut,er,tr,Yi,Dn,Rn,Or,Ln,Un))}if(fn){const Un=mn.layout.get("icon-rotate").evaluate(Ai,{}),Br=mn.layout.get("icon-text-fit")!=="none",Da=ax(fn,Un,Sr,Br),rs=Dn?ax(Dn,Un,Sr,Br):void 0;Jr=new Xf(Qn,Ut,er,tr,Yi,fn,Rn,Or,!1,Un),Ws=4*Da.length;const La=St.iconSizeData;let vs=null;La.kind==="source"?(vs=[gs*mn.layout.get("icon-size").evaluate(Ai,{})],vs[0]>Lo&&De(`${St.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)):La.kind==="composite"&&(vs=[gs*Li.compositeIconSizes[0].evaluate(Ai,{},Gi),gs*Li.compositeIconSizes[1].evaluate(Ai,{},Gi)],(vs[0]>Lo||vs[1]>Lo)&&De(`${St.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Da,vs,pi,fr,Ai,b.ah.none,Ut,ys.lineStartIndex,ys.lineLength,-1,Gi),C_=St.icon.placedSymbolArray.length-1,rs&&(nh=4*rs.length,St.addSymbols(St.icon,rs,vs,pi,fr,Ai,b.ah.vertical,Ut,ys.lineStartIndex,ys.lineLength,-1,Gi),A_=St.icon.placedSymbolArray.length-1)}const vx=Object.keys(Si.horizontal);for(const Un of vx){const Br=Si.horizontal[Un];if(!_s){_x=El(Br.text);const rs=mn.layout.get("text-rotate").evaluate(Ai,{},Gi);_s=new Xf(Qn,Ut,er,tr,Yi,Br,gn,jn,Ln,rs)}const Da=Br.positionedLines.length===1;if(gx+=hx(St,Ut,Br,$r,mn,Ln,Ai,ir,ys,Si.vertical?b.ah.horizontal:b.ah.horizontalOnly,Da?vx:[Un],Hs,C_,Li,Gi),Da)break}Si.vertical&&(yx+=hx(St,Ut,Si.vertical,$r,mn,Ln,Ai,ir,ys,b.ah.vertical,["vertical"],Hs,A_,Li,Gi));const k2=_s?_s.boxStartIndex:St.collisionBoxArray.length,E2=_s?_s.boxEndIndex:St.collisionBoxArray.length,M2=Fr?Fr.boxStartIndex:St.collisionBoxArray.length,z2=Fr?Fr.boxEndIndex:St.collisionBoxArray.length,D2=Jr?Jr.boxStartIndex:St.collisionBoxArray.length,L2=Jr?Jr.boxEndIndex:St.collisionBoxArray.length,R2=Sn?Sn.boxStartIndex:St.collisionBoxArray.length,O2=Sn?Sn.boxEndIndex:St.collisionBoxArray.length;let ns=-1;const $f=(Un,Br)=>Un&&Un.circleDiameter?Math.max(Un.circleDiameter,Br):Br;ns=$f(_s,ns),ns=$f(Fr,ns),ns=$f(Jr,ns),ns=$f(Sn,ns);const xx=ns>-1?1:0;xx&&(ns*=Zl/un),St.glyphOffsetArray.length>=jl.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Ai.sortKey);const F2=ux(mn,Ai,Gi),[B2,N2]=function(Un,Br){const Da=Un.length,rs=Br==null?void 0:Br.values;if((rs==null?void 0:rs.length)>0)for(let La=0;La<rs.length;La+=2){const vs=rs[La+1];Un.emplaceBack(b.aq[rs[La]],vs[0],vs[1])}return[Da,Un.length]}(St.textAnchorOffsets,F2);St.symbolInstances.emplaceBack(Ut.x,Ut.y,Hs.right>=0?Hs.right:-1,Hs.center>=0?Hs.center:-1,Hs.left>=0?Hs.left:-1,Hs.vertical||-1,C_,A_,_x,k2,E2,M2,z2,D2,L2,R2,O2,er,gx,yx,Ws,nh,xx,0,gn,ns,B2,N2)}(i,At,Re,n,o,u,vt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,J,[ye,ye,ye,ye],ft,x,we,ke,Lt,F,t,f,P,A,m)};if(ht==="line")for(const Re of tx(t.geometry,0,0,ln,ln)){const At=w2(Re,he,Ze,n.vertical||q,o,24,re,i.overscaling,ln);for(const St of At)q&&C2(i,q.text,ot,St)||yt(Re,St)}else if(ht==="line-center"){for(const Re of t.geometry)if(Re.length>1){const At=b2(Re,Ze,n.vertical||q,o,24,re);At&&yt(Re,At)}}else if(t.type==="Polygon")for(const Re of ol(t.geometry,0)){const At=T2(Re,16);yt(Re[0],new Oo(At.x,At.y,0))}else if(t.type==="LineString")for(const Re of t.geometry)yt(Re,new Oo(Re[0].x,Re[0].y,0));else if(t.type==="Point")for(const Re of t.geometry)for(const At of Re)yt([At],new Oo(At.x,At.y,0))}function hx(i,t,n,o,u,f,m,y,x,P,A,E,D,F,q){const Z=function(we,he,ye,ke,Ze,ft,Lt,ht){const ot=ke.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Tt=[];for(const vt of he.positionedLines)for(const yt of vt.positionedGlyphs){if(!yt.rect)continue;const Re=yt.rect||{};let At=C0+1,St=!0,Ut=1,Ii=0;const Si=(Ze||ht)&&yt.vertical,fn=yt.metrics.advance*yt.scale/2;if(ht&&he.verticalizable&&(Ii=vt.lineOffset/2-(yt.imageName?-(un-yt.metrics.width*yt.scale)/2:(yt.scale-1)*un)),yt.imageName){const pi=Lt[yt.imageName];St=pi.sdf,Ut=pi.pixelRatio,At=pr/Ut}const $r=Ze?[yt.x+fn,yt.y]:[0,0];let Dn=Ze?[0,0]:[yt.x+fn+ye[0],yt.y+ye[1]-Ii],mn=[0,0];Si&&(mn=Dn,Dn=[0,0]);const Qn=yt.metrics.isDoubleResolution?2:1,er=(yt.metrics.left-At)*yt.scale-fn+Dn[0],tr=(-yt.metrics.top-At)*yt.scale+Dn[1],Yi=er+Re.w/Qn*yt.scale/Ut,gn=tr+Re.h/Qn*yt.scale/Ut,jn=new B(er,tr),Ln=new B(Yi,tr),ir=new B(er,gn),Rn=new B(Yi,gn);if(Si){const pi=new B(-fn,fn-$u),Ai=-Math.PI/2,Li=un/2-fn,Sr=new B(5-$u-Li,-(yt.imageName?Li:0)),Gi=new B(...mn);jn._rotateAround(Ai,pi)._add(Sr)._add(Gi),Ln._rotateAround(Ai,pi)._add(Sr)._add(Gi),ir._rotateAround(Ai,pi)._add(Sr)._add(Gi),Rn._rotateAround(Ai,pi)._add(Sr)._add(Gi)}if(ot){const pi=Math.sin(ot),Ai=Math.cos(ot),Li=[Ai,-pi,pi,Ai];jn._matMult(Li),Ln._matMult(Li),ir._matMult(Li),Rn._matMult(Li)}const Or=new B(0,0),fr=new B(0,0);Tt.push({tl:jn,tr:Ln,bl:ir,br:Rn,tex:Re,writingMode:he.writingMode,glyphOffset:$r,sectionIndex:yt.sectionIndex,isSDF:St,pixelOffsetTL:Or,pixelOffsetBR:fr,minFontScaleX:0,minFontScaleY:0})}return Tt}(0,n,y,u,f,m,o,i.allowVerticalPlacement),J=i.textSizeData;let re=null;J.kind==="source"?(re=[gs*u.layout.get("text-size").evaluate(m,{})],re[0]>Lo&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)):J.kind==="composite"&&(re=[gs*F.compositeTextSizes[0].evaluate(m,{},q),gs*F.compositeTextSizes[1].evaluate(m,{},q)],(re[0]>Lo||re[1]>Lo)&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,re,y,f,m,P,t,x.lineStartIndex,x.lineLength,D,q);for(const we of A)E[we]=i.text.placedSymbolArray.length-1;return 4*Z.length}function dx(i){for(const t in i)return i[t];return null}function C2(i,t,n,o){const u=i.compareText;if(t in u){const f=u[t];for(let m=f.length-1;m>=0;m--)if(o.dist(f[m])<n)return!0}else u[t]=[];return u[t].push(o),!1}const px=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class x_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=px[15&o];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new x_(y,m,f,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=px.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return b_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],P=[];for(;x.length;){const A=x.pop()||0,E=x.pop()||0,D=x.pop()||0;if(E-D<=y){for(let J=D;J<=E;J++){const re=m[2*J],we=m[2*J+1];re>=t&&re<=o&&we>=n&&we<=u&&P.push(f[J])}continue}const F=D+E>>1,q=m[2*F],Z=m[2*F+1];q>=t&&q<=o&&Z>=n&&Z<=u&&P.push(f[F]),(A===0?t<=q:n<=Z)&&(x.push(D),x.push(F-1),x.push(1-A)),(A===0?o>=q:u>=Z)&&(x.push(F+1),x.push(E),x.push(1-A))}return P}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,y=[0,u.length-1,0],x=[],P=o*o;for(;y.length;){const A=y.pop()||0,E=y.pop()||0,D=y.pop()||0;if(E-D<=m){for(let J=D;J<=E;J++)mx(f[2*J],f[2*J+1],t,n)<=P&&x.push(u[J]);continue}const F=D+E>>1,q=f[2*F],Z=f[2*F+1];mx(q,Z,t,n)<=P&&x.push(u[F]),(A===0?t-o<=q:n-o<=Z)&&(y.push(D),y.push(F-1),y.push(1-A)),(A===0?t+o>=q:n+o>=Z)&&(y.push(F+1),y.push(E),y.push(1-A))}return x}}function b_(i,t,n,o,u,f){if(u-o<=n)return;const m=o+u>>1;fx(i,t,m,o,u,f),b_(i,t,n,o,m-1,1-f),b_(i,t,n,m+1,u,1-f)}function fx(i,t,n,o,u,f){for(;u>o;){if(u-o>600){const P=u-o+1,A=n-o+1,E=Math.log(P),D=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*D*(P-D)/P)*(A-P/2<0?-1:1);fx(i,t,n,Math.max(o,Math.floor(n-A*D/P+F)),Math.min(u,Math.floor(n+(P-A)*D/P+F)),f)}const m=t[2*n+f];let y=o,x=u;for(th(i,t,o,n),t[2*u+f]>m&&th(i,t,o,u);y<x;){for(th(i,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*o+f]===m?th(i,t,o,x):(x++,th(i,t,x,u)),x<=n&&(o=x+1),n<=x&&(u=x-1)}}function th(i,t,n,o){w_(i,n,o),w_(t,2*n,2*o),w_(t,2*n+1,2*o+1)}function w_(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function mx(i,t,n,o){const u=i-n,f=t-o;return u*u+f*f}var S_;b.bg=void 0,(S_=b.bg||(b.bg={})).create="create",S_.load="load",S_.fullLoad="fullLoad";let Kf=null,ih=[];const T_=1e3/60,P_="loadTime",I_="fullLoadTime",A2={mark(i){performance.mark(i)},frame(i){const t=i;Kf!=null&&ih.push(t-Kf),Kf=t},clearMetrics(){Kf=null,ih=[],performance.clearMeasures(P_),performance.clearMeasures(I_);for(const i in b.bg)performance.clearMarks(b.bg[i])},getPerformanceMetrics(){performance.measure(P_,b.bg.create,b.bg.load),performance.measure(I_,b.bg.create,b.bg.fullLoad);const i=performance.getEntriesByName(P_)[0].duration,t=performance.getEntriesByName(I_)[0].duration,n=ih.length,o=1/(ih.reduce((f,m)=>f+m,0)/n/1e3),u=ih.filter(f=>f>T_).reduce((f,m)=>f+(m-T_)/T_,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};b.$=class extends M{},b.A=Rl,b.B=Ly,b.C=function(i){if(et==null){const t=i.navigator?i.navigator.userAgent:null;et=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return et},b.D=bt,b.E=Bt,b.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new v2(()=>this.process()),this.subscription=function(n,o,u,f){return n.addEventListener(o,u,!1),{unsubscribe:()=>{n.removeEventListener(o,u,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Ue(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const y={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const f=[],m=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:wo(i.data,f)});this.target.postMessage(m,{transfer:f})})}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ue(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(So(t.error)):u.resolve(So(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=So(t.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,t,n){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?wo(t):null,data:wo(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.G=sn,b.H=function(){var i=new Rl(16);return Rl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.I=a_,b.J=function(i,t,n){var o,u,f,m,y,x,P,A,E,D,F,q,Z=n[0],J=n[1],re=n[2];return t===i?(i[12]=t[0]*Z+t[4]*J+t[8]*re+t[12],i[13]=t[1]*Z+t[5]*J+t[9]*re+t[13],i[14]=t[2]*Z+t[6]*J+t[10]*re+t[14],i[15]=t[3]*Z+t[7]*J+t[11]*re+t[15]):(u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],P=t[6],A=t[7],E=t[8],D=t[9],F=t[10],q=t[11],i[0]=o=t[0],i[1]=u,i[2]=f,i[3]=m,i[4]=y,i[5]=x,i[6]=P,i[7]=A,i[8]=E,i[9]=D,i[10]=F,i[11]=q,i[12]=o*Z+y*J+E*re+t[12],i[13]=u*Z+x*J+D*re+t[13],i[14]=f*Z+P*J+F*re+t[14],i[15]=m*Z+A*J+q*re+t[15]),i},b.K=function(i,t,n){var o=n[0],u=n[1],f=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.L=Kv,b.M=function(i,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(n[u]=i[u])}return n},b.N=Ro,b.O=Z0,b.P=B,b.Q=G0,b.R=Lr,b.S=Rr,b.T=Pl,b.U=ve,b.V=pe,b.W=ct,b.X=ln,b.Y=_,b.Z=Qu,b._=c,b.a=Pi,b.a$=function(i,t){var n=i[0],o=i[1],u=i[2],f=i[3],m=i[4],y=i[5],x=i[6],P=i[7],A=i[8],E=i[9],D=i[10],F=i[11],q=i[12],Z=i[13],J=i[14],re=i[15],we=t[0],he=t[1],ye=t[2],ke=t[3],Ze=t[4],ft=t[5],Lt=t[6],ht=t[7],ot=t[8],Tt=t[9],vt=t[10],yt=t[11],Re=t[12],At=t[13],St=t[14],Ut=t[15];return Math.abs(n-we)<=Yn*Math.max(1,Math.abs(n),Math.abs(we))&&Math.abs(o-he)<=Yn*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(u-ye)<=Yn*Math.max(1,Math.abs(u),Math.abs(ye))&&Math.abs(f-ke)<=Yn*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(m-Ze)<=Yn*Math.max(1,Math.abs(m),Math.abs(Ze))&&Math.abs(y-ft)<=Yn*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(x-Lt)<=Yn*Math.max(1,Math.abs(x),Math.abs(Lt))&&Math.abs(P-ht)<=Yn*Math.max(1,Math.abs(P),Math.abs(ht))&&Math.abs(A-ot)<=Yn*Math.max(1,Math.abs(A),Math.abs(ot))&&Math.abs(E-Tt)<=Yn*Math.max(1,Math.abs(E),Math.abs(Tt))&&Math.abs(D-vt)<=Yn*Math.max(1,Math.abs(D),Math.abs(vt))&&Math.abs(F-yt)<=Yn*Math.max(1,Math.abs(F),Math.abs(yt))&&Math.abs(q-Re)<=Yn*Math.max(1,Math.abs(q),Math.abs(Re))&&Math.abs(Z-At)<=Yn*Math.max(1,Math.abs(Z),Math.abs(At))&&Math.abs(J-St)<=Yn*Math.max(1,Math.abs(J),Math.abs(St))&&Math.abs(re-Ut)<=Yn*Math.max(1,Math.abs(re),Math.abs(Ut))},b.a0=ai,b.a1=y_,b.a2=Je,b.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of i){const u=window.document.createElement("source");Xi(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},b.a4=function(){return xt++},b.a5=dt,b.a6=jl,b.a7=vu,b.a8=Ma,b.a9=J0,b.aA=function(i){if(i.type==="custom")return new _2(i);switch(i.type){case"background":return new m2(i);case"circle":return new iw(i);case"fill":return new vw(i);case"fill-extrusion":return new Lw(i);case"heatmap":return new rw(i);case"hillshade":return new ow(i);case"line":return new Uw(i);case"raster":return new y2(i);case"symbol":return new Zf(i)}},b.aB=Be,b.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Ht(i.version,t.version))return[{command:"setStyle",args:[t]}];Ht(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Ht(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Ht(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Ht(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Ht(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Ht(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Ht(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Ht(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),Ht(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Ht(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Ht(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,y,x,P){let A;for(A in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,A)&&(Object.prototype.hasOwnProperty.call(y,A)||_n(A,x,P));for(A in y)Object.prototype.hasOwnProperty.call(y,A)&&(Object.prototype.hasOwnProperty.call(m,A)?Ht(m[A],y[A])||(m[A].type==="geojson"&&y[A].type==="geojson"&&Zr(m,y,A)?li(x,{command:"setGeoJSONSourceData",args:[A,y[A].data]}):Xn(A,y,x,P)):sr(A,y,x))})(i.sources,t.sources,u,o);const f=[];i.layers&&i.layers.forEach(m=>{"source"in m&&o[m.source]?n.push({command:"removeLayer",args:[m.id]}):f.push(m)}),n=n.concat(u),function(m,y,x){y=y||[];const P=(m=m||[]).map(us),A=y.map(us),E=m.reduce(Es,{}),D=y.reduce(Es,{}),F=P.slice(),q=Object.create(null);let Z,J,re,we,he;for(let ye=0,ke=0;ye<P.length;ye++)Z=P[ye],Object.prototype.hasOwnProperty.call(D,Z)?ke++:(li(x,{command:"removeLayer",args:[Z]}),F.splice(F.indexOf(Z,ke),1));for(let ye=0,ke=0;ye<A.length;ye++)Z=A[A.length-1-ye],F[F.length-1-ye]!==Z&&(Object.prototype.hasOwnProperty.call(E,Z)?(li(x,{command:"removeLayer",args:[Z]}),F.splice(F.lastIndexOf(Z,F.length-ke),1)):ke++,we=F[F.length-ye],li(x,{command:"addLayer",args:[D[Z],we]}),F.splice(F.length-ye,0,Z),q[Z]=!0);for(let ye=0;ye<A.length;ye++)if(Z=A[ye],J=E[Z],re=D[Z],!q[Z]&&!Ht(J,re))if(Ht(J.source,re.source)&&Ht(J["source-layer"],re["source-layer"])&&Ht(J.type,re.type)){for(he in dn(J.layout,re.layout,x,Z,null,"setLayoutProperty"),dn(J.paint,re.paint,x,Z,null,"setPaintProperty"),Ht(J.filter,re.filter)||li(x,{command:"setFilter",args:[Z,re.filter]}),Ht(J.minzoom,re.minzoom)&&Ht(J.maxzoom,re.maxzoom)||li(x,{command:"setLayerZoomRange",args:[Z,re.minzoom,re.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?dn(J[he],re[he],x,Z,he.slice(6),"setPaintProperty"):Ht(J[he],re[he])||li(x,{command:"setLayerProperty",args:[Z,he,re[he]]}));for(he in re)Object.prototype.hasOwnProperty.call(re,he)&&!Object.prototype.hasOwnProperty.call(J,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?dn(J[he],re[he],x,Z,he.slice(6),"setPaintProperty"):Ht(J[he],re[he])||li(x,{command:"setLayerProperty",args:[Z,he,re[he]]}))}else li(x,{command:"removeLayer",args:[Z]}),we=F[F.lastIndexOf(Z)+1],li(x,{command:"addLayer",args:[re,we]})}(f,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},b.aD=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},b.aE=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!i(t[o],n[o]))return!1;return!0}return t===n},b.aF=He,b.aG=Ye,b.aH=class extends Aa{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.aI=Mf,b.aJ=class extends Aa{constructor(i,t){super(i,t),this.current=X1}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.aK=Bv,b.aL=Nv,b.aM=vi,b.aN=class extends Aa{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.aO=class extends Aa{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.aP=function(i,t,n,o,u,f,m){var y=1/(t-n),x=1/(o-u),P=1/(f-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+n)*y,i[13]=(u+o)*x,i[14]=(m+f)*P,i[15]=1,i},b.aQ=tw,b.aR=class extends fe{},b.aS=Ww,b.aT=class extends Se{},b.aU=Ky,b.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.aW=e0,b.aX=En,b.aY=Dr,b.aZ=class extends wt{},b.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},b.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,f)=>{const m=u||f;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},b.ab=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},b.ac=ze,b.ad=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),f=t[0],m=t[1],y=t[2],x=t[3],P=t[4],A=t[5],E=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*u+P*o,i[1]=m*u+A*o,i[2]=y*u+E*o,i[3]=x*u+D*o,i[4]=P*u-f*o,i[5]=A*u-m*o,i[6]=E*u-y*o,i[7]=D*u-x*o,i},b.ae=function(i){var t=new Rl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},b.af=Rf,b.ag=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=i,y=u?ze($n.interpolationFactor(u,t,f,m),0,1):0;i.kind==="camera"?o=Kn.number(i.minSize,i.maxSize,y):n=y}return{uSizeT:n,uSize:o}},b.ai=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/gs:i.kind==="composite"?Kn.number(o/gs,u/gs,n):t},b.aj=h_,b.ak=function(i,t,n,o){const u=t.y-i.y,f=t.x-i.x,m=o.y-n.y,y=o.x-n.x,x=m*f-y*u;if(x===0)return null;const P=(y*(i.y-n.y)-m*(i.x-n.x))/x;return new B(i.x+P*f,i.y+P*u)},b.al=tx,b.am=qv,b.an=Wy,b.ao=function(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[t,n,o,u]},b.ap=un,b.ar=u_,b.as=function(i,t){var n=t[0],o=t[1],u=t[2],f=t[3],m=t[4],y=t[5],x=t[6],P=t[7],A=t[8],E=t[9],D=t[10],F=t[11],q=t[12],Z=t[13],J=t[14],re=t[15],we=n*y-o*m,he=n*x-u*m,ye=n*P-f*m,ke=o*x-u*y,Ze=o*P-f*y,ft=u*P-f*x,Lt=A*Z-E*q,ht=A*J-D*q,ot=A*re-F*q,Tt=E*J-D*Z,vt=E*re-F*Z,yt=D*re-F*J,Re=we*yt-he*vt+ye*Tt+ke*ot-Ze*ht+ft*Lt;return Re?(i[0]=(y*yt-x*vt+P*Tt)*(Re=1/Re),i[1]=(u*vt-o*yt-f*Tt)*Re,i[2]=(Z*ft-J*Ze+re*ke)*Re,i[3]=(D*Ze-E*ft-F*ke)*Re,i[4]=(x*ot-m*yt-P*ht)*Re,i[5]=(n*yt-u*ot+f*ht)*Re,i[6]=(J*ye-q*ft-re*he)*Re,i[7]=(A*ft-D*ye+F*he)*Re,i[8]=(m*vt-y*ot+P*Lt)*Re,i[9]=(o*ot-n*vt-f*Lt)*Re,i[10]=(q*Ze-Z*ye+re*we)*Re,i[11]=(E*ye-A*Ze-F*we)*Re,i[12]=(y*ht-m*Tt-x*Lt)*Re,i[13]=(n*Tt-o*ht+u*Lt)*Re,i[14]=(Z*he-q*ke-J*we)*Re,i[15]=(A*ke-E*he+D*we)*Re,i):null},b.at=v_,b.au=c_,b.av=x_,b.aw=function(){const i={},t=be.$version;for(const n in be.$root){const o=be.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},b.ax=Du,b.ay=Hi,b.az=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=In(i[n],t[i[n].ref]));return i},b.b=pt,b.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.b1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},b.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},b.b3=We,b.b4=X0,b.b5=W0,b.b6=function(i,t,n,o,u){var f,m=1/Math.tan(t/2);return i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(f=1/(o-u)),i[14]=2*u*o*f):(i[10]=-1,i[14]=-2*o),i},b.b7=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),f=t[4],m=t[5],y=t[6],x=t[7],P=t[8],A=t[9],E=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*u+P*o,i[5]=m*u+A*o,i[6]=y*u+E*o,i[7]=x*u+D*o,i[8]=P*u-f*o,i[9]=A*u-m*o,i[10]=E*u-y*o,i[11]=D*u-x*o,i},b.b8=Ie,b.b9=Oe,b.bA=x0,b.bB=function(i){return i.message===Yt},b.bC=mo,b.bD=hr,b.ba=function(i){return i*Math.PI/180},b.bb=function(i,t){const{x:n,y:o}=Qu.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},b.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.bd=class extends k{},b.be=m_,b.bf=A2,b.bh=Ui,b.bi=function(i,t){Pi.REGISTERED_PROTOCOLS[i]=t},b.bj=function(i){delete Pi.REGISTERED_PROTOCOLS[i]},b.bk=function(i,t){const n={};for(let u=0;u<i.length;u++){const f=t&&t[i[u].id]||vf(i[u]);t&&(t[i[u].id]=f);let m=n[f];m||(m=n[f]=[]),m.push(i[u])}const o=[];for(const u in n)o.push(n[u]);return o},b.bl=_t,b.bm=$0,b.bn=Y0,b.bo=k0,b.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ln/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ei(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ei(P),i.canonical),o["text-size"].possiblyEvaluate(new Ei(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ei(P),i.canonical),o["icon-size"].possiblyEvaluate(new Ei(A),i.canonical)]}const f=n.get("text-line-height")*un,m=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const P of i.bucket.features){const A=n.get("text-font").evaluate(P,{},i.canonical).join(","),E=x.evaluate(P,{},i.canonical),D=u.layoutTextSize.evaluate(P,{},i.canonical),F=u.layoutIconSize.evaluate(P,{},i.canonical),q={horizontal:{},vertical:void 0},Z=P.text;let J,re=[0,0];if(Z){const ye=Z.toString(),ke=n.get("text-letter-spacing").evaluate(P,{},i.canonical)*un,Ze=Ry(ye)?ke:0,ft=n.get("text-anchor").evaluate(P,{},i.canonical),Lt=ux(t,P,i.canonical);if(!Lt){const vt=n.get("text-radial-offset").evaluate(P,{},i.canonical);re=vt?cx(ft,[vt*un,__]):n.get("text-offset").evaluate(P,{},i.canonical).map(yt=>yt*un)}let ht=m?"center":n.get("text-justify").evaluate(P,{},i.canonical);const ot=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},i.canonical)*un:1/0,Tt=()=>{i.bucket.allowVerticalPlacement&&Lu(ye)&&(q.vertical=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,ft,"left",Ze,re,b.ah.vertical,!0,D,E))};if(!m&&Lt){const vt=new Set;if(ht==="auto")for(let Re=0;Re<Lt.values.length;Re+=2)vt.add(v_(Lt.values[Re]));else vt.add(ht);let yt=!1;for(const Re of vt)if(!q.horizontal[Re])if(yt)q.horizontal[Re]=q.horizontal[0];else{const At=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,"center",Re,Ze,re,b.ah.horizontal,!1,D,E);At&&(q.horizontal[Re]=At,yt=At.positionedLines.length===1)}Tt()}else{ht==="auto"&&(ht=v_(ft));const vt=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,ft,ht,Ze,re,b.ah.horizontal,!1,D,E);vt&&(q.horizontal[ht]=vt),Tt(),Lu(ye)&&m&&y&&(q.vertical=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,ft,ht,Ze,re,b.ah.vertical,!1,D,E))}}let we=!1;if(P.icon&&P.icon.name){const ye=i.imageMap[P.icon.name];ye&&(J=u2(i.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},i.canonical),n.get("icon-anchor").evaluate(P,{},i.canonical)),we=!!ye.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=we:i.bucket.sdfIcons!==we&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ye.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const he=dx(q.horizontal)||q.vertical;i.bucket.iconsInText=!!he&&he.iconsInText,(he||J)&&I2(i.bucket,P,q,J,i.imageMap,u,D,F,re,we,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.bq=n_,b.br=e_,b.bs=i_,b.bt=zo,b.bu=s_,b.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.bw=function(i,t,n,o,u){return c(this,void 0,void 0,function*(){if(pe())try{return yield ct(i,t,n,o,u)}catch{}return function(f,m,y,x,P){const A=f.width,E=f.height;at&&Mt||(at=new OffscreenCanvas(A,E),Mt=at.getContext("2d",{willReadFrequently:!0})),at.width=A,at.height=E,Mt.drawImage(f,0,0,A,E);const D=Mt.getImageData(m,y,x,P);return Mt.clearRect(0,0,A,E),D.data}(i,t,n,o,u)})},b.bx=K0,b.by=j,b.bz=U,b.c=yi,b.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.e=$e,b.f=i=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ut})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):ut}),b.g=Fi,b.h=(i,t)=>Fn($e(i,{type:"json"}),t),b.i=Ue,b.j=mt,b.k=Ki,b.l=(i,t)=>Fn($e(i,{type:"arrayBuffer"}),t),b.m=Fn,b.n=function(i){return new s_(i).readFields(n2,[])},b.o=qu,b.p=A0,b.q=p,b.r=Dy,b.s=Xi,b.t=Mu,b.u=Us,b.v=be,b.w=De,b.x=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},b.y=Kn,b.z=Ei}),T("worker",["./shared"],function(b){class c{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,R){for(const Y of O){this._layerConfigs[Y.id]=Y;const de=this._layers[Y.id]=b.aA(Y);de._featureFilter=b.a7(de.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const W=b.bk(Object.values(this._layerConfigs),this.keyCache);for(const Y of W){const de=Y.map(Ce=>this._layers[Ce.id]),me=de[0];if(me.visibility==="none")continue;const xe=me.source||"";let le=this.familiesBySource[xe];le||(le=this.familiesBySource[xe]={});const Ee=me.sourceLayer||"_geojsonTileLayer";let Ne=le[Ee];Ne||(Ne=le[Ee]=[]),Ne.push(de)}}}class j{constructor(O){const R={},W=[];for(const xe in O){const le=O[xe],Ee=R[xe]={};for(const Ne in le){const Ce=le[+Ne];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const it={x:0,y:0,w:Ce.bitmap.width+2,h:Ce.bitmap.height+2};W.push(it),Ee[Ne]={rect:it,metrics:Ce.metrics}}}const{w:Y,h:de}=b.p(W),me=new b.o({width:Y||1,height:de||1});for(const xe in O){const le=O[xe];for(const Ee in le){const Ne=le[+Ee];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ce=R[xe][Ee].rect;b.o.copy(Ne.bitmap,me,{x:0,y:0},{x:Ce.x+1,y:Ce.y+1},Ne.bitmap)}}this.image=me,this.positions=R}}b.bl("GlyphAtlas",j);class U{constructor(O){this.tileID=new b.S(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,R,W,Y){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new b.a5;const de=new b.bm(Object.keys(O.layers).sort()),me=new b.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const xe={},le={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},Ee=R.familiesBySource[this.source];for(const Qt in Ee){const _i=O.layers[Qt];if(!_i)continue;_i.version===1&&b.w(`Vector tile source "${this.source}" layer "${Qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=de.encode(Qt),pn=[];for(let bn=0;bn<_i.length;bn++){const Bn=_i.feature(bn),no=me.getId(Bn,Qt);pn.push({feature:Bn,id:no,index:bn,sourceLayerIndex:Bi})}for(const bn of Ee[Qt]){const Bn=bn[0];Bn.source!==this.source&&b.w(`layer.source = ${Bn.source} does not equal this.source = ${this.source}`),Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(K(bn,this.zoom,W),(xe[Bn.id]=Bn.createBucket({index:me.bucketLayerIDs.length,layers:bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source})).populate(pn,le,this.tileID.canonical),me.bucketLayerIDs.push(bn.map(no=>no.id)))}}const Ne=b.aF(le.glyphDependencies,Qt=>Object.keys(Qt).map(Number));this.inFlightDependencies.forEach(Qt=>Qt==null?void 0:Qt.abort()),this.inFlightDependencies=[];let Ce=Promise.resolve({});if(Object.keys(Ne).length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),Ce=Y.sendAsync({type:"GG",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},Qt)}const it=Object.keys(le.iconDependencies);let kt=Promise.resolve({});if(it.length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),kt=Y.sendAsync({type:"GI",data:{icons:it,source:this.source,tileID:this.tileID,type:"icons"}},Qt)}const Dt=Object.keys(le.patternDependencies);let ci=Promise.resolve({});if(Dt.length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),ci=Y.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Qt)}const[Xt,ui,ii]=yield Promise.all([Ce,kt,ci]),on=new j(Xt),Zi=new b.bo(ui,ii);for(const Qt in xe){const _i=xe[Qt];_i instanceof b.a6?(K(_i.layers,this.zoom,W),b.bp({bucket:_i,glyphMap:Xt,glyphPositions:on.positions,imageMap:ui,imagePositions:Zi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_i.hasPattern&&(_i instanceof b.bq||_i instanceof b.br||_i instanceof b.bs)&&(K(_i.layers,this.zoom,W),_i.addFeatures(le,this.tileID.canonical,Zi.patternPositions))}return this.status="done",{buckets:Object.values(xe).filter(Qt=>!Qt.isEmpty()),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,imageAtlas:Zi,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ui:null,glyphPositions:this.returnDependencies?on.positions:null}})}}function K(ne,O,R){const W=new b.z(O);for(const Y of ne)Y.recalculate(W,R)}class B{constructor(O,R,W){this.actor=O,this.layerIndex=R,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,R){return b._(this,void 0,void 0,function*(){const W=yield b.l(O.request,R);try{return{vectorTile:new b.bt.VectorTile(new b.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(Y){const de=new Uint8Array(W.data);let me=`Unable to parse the tile at ${O.request.url}, `;throw me+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(me)}})}loadTile(O){return b._(this,void 0,void 0,function*(){const R=O.uid,W=!!(O&&O.request&&O.request.collectResourceTiming)&&new b.bv(O.request),Y=new U(O);this.loading[R]=Y;const de=new AbortController;Y.abort=de;try{const me=yield this.loadVectorTile(O,de);if(delete this.loading[R],!me)return null;const xe=me.rawData,le={};me.expires&&(le.expires=me.expires),me.cacheControl&&(le.cacheControl=me.cacheControl);const Ee={};if(W){const Ce=W.finish();Ce&&(Ee.resourceTiming=JSON.parse(JSON.stringify(Ce)))}Y.vectorTile=me.vectorTile;const Ne=Y.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=Y,this.fetching[R]={rawTileData:xe,cacheControl:le,resourceTiming:Ee};try{const Ce=yield Ne;return b.e({rawTileData:xe.slice(0)},Ce,le,Ee)}finally{delete this.fetching[R]}}catch(me){throw delete this.loading[R],Y.status="done",this.loaded[R]=Y,me}})}reloadTile(O){return b._(this,void 0,void 0,function*(){const R=O.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[R];if(W.showCollisionBoxes=O.showCollisionBoxes,W.status==="parsing"){const Y=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[R]){const{rawTileData:me,cacheControl:xe,resourceTiming:le}=this.fetching[R];delete this.fetching[R],de=b.e({rawTileData:me.slice(0)},Y,xe,le)}else de=Y;return de}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return b._(this,void 0,void 0,function*(){const R=this.loading,W=O.uid;R&&R[W]&&R[W].abort&&(R[W].abort.abort(),delete R[W])})}removeTile(O){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class V{constructor(){this.loaded={}}loadTile(O){return b._(this,void 0,void 0,function*(){const{uid:R,encoding:W,rawImageData:Y,redFactor:de,greenFactor:me,blueFactor:xe,baseShift:le}=O,Ee=Y.width+2,Ne=Y.height+2,Ce=b.b(Y)?new b.R({width:Ee,height:Ne},yield b.bw(Y,-1,-1,Ee,Ne)):Y,it=new b.bx(R,Ce,W,de,me,xe,le);return this.loaded=this.loaded||{},this.loaded[R]=it,it})}removeTile(O){const R=this.loaded,W=O.uid;R&&R[W]&&delete R[W]}}function oe(ne,O){if(ne.length!==0){ie(ne[0],O);for(var R=1;R<ne.length;R++)ie(ne[R],!O)}}function ie(ne,O){for(var R=0,W=0,Y=0,de=ne.length,me=de-1;Y<de;me=Y++){var xe=(ne[Y][0]-ne[me][0])*(ne[me][1]+ne[Y][1]),le=R+xe;W+=Math.abs(R)>=Math.abs(xe)?R-le+xe:xe-le+R,R=le}R+W>=0!=!!O&&ne.reverse()}var te=b.by(function ne(O,R){var W,Y=O&&O.type;if(Y==="FeatureCollection")for(W=0;W<O.features.length;W++)ne(O.features[W],R);else if(Y==="GeometryCollection")for(W=0;W<O.geometries.length;W++)ne(O.geometries[W],R);else if(Y==="Feature")ne(O.geometry,R);else if(Y==="Polygon")oe(O.coordinates,R);else if(Y==="MultiPolygon")for(W=0;W<O.coordinates.length;W++)oe(O.coordinates[W],R);return O});const ue=b.bt.VectorTileFeature.prototype.toGeoJSON;var ve={exports:{}},pe=b.bz,Ie=b.bt.VectorTileFeature,Oe=ze;function ze(ne,O){this.options=O||{},this.features=ne,this.length=ne.length}function We(ne,O){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=O||4096}ze.prototype.feature=function(ne){return new We(this.features[ne],this.options.extent)},We.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var O=0;O<ne.length;O++){for(var R=ne[O],W=[],Y=0;Y<R.length;Y++)W.push(new pe(R[Y][0],R[Y][1]));this.geometry.push(W)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,O=1/0,R=-1/0,W=1/0,Y=-1/0,de=0;de<ne.length;de++)for(var me=ne[de],xe=0;xe<me.length;xe++){var le=me[xe];O=Math.min(O,le.x),R=Math.max(R,le.x),W=Math.min(W,le.y),Y=Math.max(Y,le.y)}return[O,W,R,Y]},We.prototype.toGeoJSON=Ie.prototype.toGeoJSON;var $e=b.bA,xt=Oe;function He(ne){var O=new $e;return function(R,W){for(var Y in R.layers)W.writeMessage(3,Ye,R.layers[Y])}(ne,O),O.finish()}function Ye(ne,O){var R;O.writeVarintField(15,ne.version||1),O.writeStringField(1,ne.name||""),O.writeVarintField(5,ne.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<ne.length;R++)W.feature=ne.feature(R),O.writeMessage(2,Be,W);var Y=W.keys;for(R=0;R<Y.length;R++)O.writeStringField(3,Y[R]);var de=W.values;for(R=0;R<de.length;R++)O.writeMessage(4,et,de[R])}function Be(ne,O){var R=ne.feature;R.id!==void 0&&O.writeVarintField(1,R.id),O.writeMessage(2,Me,ne),O.writeVarintField(3,R.type),O.writeMessage(4,Ue,R)}function Me(ne,O){var R=ne.feature,W=ne.keys,Y=ne.values,de=ne.keycache,me=ne.valuecache;for(var xe in R.properties){var le=R.properties[xe],Ee=de[xe];if(le!==null){Ee===void 0&&(W.push(xe),de[xe]=Ee=W.length-1),O.writeVarint(Ee);var Ne=typeof le;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(le=JSON.stringify(le));var Ce=Ne+":"+le,it=me[Ce];it===void 0&&(Y.push(le),me[Ce]=it=Y.length-1),O.writeVarint(it)}}}function De(ne,O){return(O<<3)+(7&ne)}function Ae(ne){return ne<<1^ne>>31}function Ue(ne,O){for(var R=ne.loadGeometry(),W=ne.type,Y=0,de=0,me=R.length,xe=0;xe<me;xe++){var le=R[xe],Ee=1;W===1&&(Ee=le.length),O.writeVarint(De(1,Ee));for(var Ne=W===3?le.length-1:le.length,Ce=0;Ce<Ne;Ce++){Ce===1&&W!==1&&O.writeVarint(De(2,Ne-1));var it=le[Ce].x-Y,kt=le[Ce].y-de;O.writeVarint(Ae(it)),O.writeVarint(Ae(kt)),Y+=it,de+=kt}W===3&&O.writeVarint(De(7,1))}}function et(ne,O){var R=typeof ne;R==="string"?O.writeStringField(1,ne):R==="boolean"?O.writeBooleanField(7,ne):R==="number"&&(ne%1!=0?O.writeDoubleField(3,ne):ne<0?O.writeSVarintField(6,ne):O.writeVarintField(5,ne))}ve.exports=He,ve.exports.fromVectorTileJs=He,ve.exports.fromGeojsonVt=function(ne,O){O=O||{};var R={};for(var W in ne)R[W]=new xt(ne[W].features,O),R[W].name=W,R[W].version=O.version,R[W].extent=O.extent;return He({layers:R})},ve.exports.GeoJSONWrapper=xt;var pt=b.by(ve.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},ct=Math.fround||(at=new Float32Array(1),ne=>(at[0]=+ne,at[0]));var at;const Mt=3,Yt=5,yi=6;class Pi{constructor(O){this.options=Object.assign(Object.create(ut),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:R,minZoom:W,maxZoom:Y}=this.options;R&&console.time("total time");const de=`prepare ${O.length} points`;R&&console.time(de),this.points=O;const me=[];for(let le=0;le<O.length;le++){const Ee=O[le];if(!Ee.geometry)continue;const[Ne,Ce]=Ee.geometry.coordinates,it=ct(Ui(Ne)),kt=ct(Hi(Ce));me.push(it,kt,1/0,le,-1,1),this.options.reduce&&me.push(0)}let xe=this.trees[Y+1]=this._createTree(me);R&&console.timeEnd(de);for(let le=Y;le>=W;le--){const Ee=+Date.now();xe=this.trees[le]=this._createTree(this._cluster(xe,le)),R&&console.log("z%d: %d clusters in %dms",le,xe.numItems,+Date.now()-Ee)}return R&&console.timeEnd("total time"),this}getClusters(O,R){let W=((O[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,O[1]));let de=O[2]===180?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)W=-180,de=180;else if(W>de){const Ce=this.getClusters([W,Y,180,me],R),it=this.getClusters([-180,Y,de,me],R);return Ce.concat(it)}const xe=this.trees[this._limitZoom(R)],le=xe.range(Ui(W),Hi(me),Ui(de),Hi(Y)),Ee=xe.data,Ne=[];for(const Ce of le){const it=this.stride*Ce;Ne.push(Ee[it+Yt]>1?Fi(Ee,it,this.clusterProps):this.points[Ee[it+Mt]])}return Ne}getChildren(O){const R=this._getOriginId(O),W=this._getOriginZoom(O),Y="No cluster with the specified id.",de=this.trees[W];if(!de)throw new Error(Y);const me=de.data;if(R*this.stride>=me.length)throw new Error(Y);const xe=this.options.radius/(this.options.extent*Math.pow(2,W-1)),le=de.within(me[R*this.stride],me[R*this.stride+1],xe),Ee=[];for(const Ne of le){const Ce=Ne*this.stride;me[Ce+4]===O&&Ee.push(me[Ce+Yt]>1?Fi(me,Ce,this.clusterProps):this.points[me[Ce+Mt]])}if(Ee.length===0)throw new Error(Y);return Ee}getLeaves(O,R,W){const Y=[];return this._appendLeaves(Y,O,R=R||10,W=W||0,0),Y}getTile(O,R,W){const Y=this.trees[this._limitZoom(O)],de=Math.pow(2,O),{extent:me,radius:xe}=this.options,le=xe/me,Ee=(W-le)/de,Ne=(W+1+le)/de,Ce={features:[]};return this._addTileFeatures(Y.range((R-le)/de,Ee,(R+1+le)/de,Ne),Y.data,R,W,de,Ce),R===0&&this._addTileFeatures(Y.range(1-le/de,Ee,1,Ne),Y.data,de,W,de,Ce),R===de-1&&this._addTileFeatures(Y.range(0,Ee,le/de,Ne),Y.data,-1,W,de,Ce),Ce.features.length?Ce:null}getClusterExpansionZoom(O){let R=this._getOriginZoom(O)-1;for(;R<=this.options.maxZoom;){const W=this.getChildren(O);if(R++,W.length!==1)break;O=W[0].properties.cluster_id}return R}_appendLeaves(O,R,W,Y,de){const me=this.getChildren(R);for(const xe of me){const le=xe.properties;if(le&&le.cluster?de+le.point_count<=Y?de+=le.point_count:de=this._appendLeaves(O,le.cluster_id,W,Y,de):de<Y?de++:O.push(xe),O.length===W)break}return de}_createTree(O){const R=new b.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<O.length;W+=this.stride)R.add(O[W],O[W+1]);return R.finish(),R.data=O,R}_addTileFeatures(O,R,W,Y,de,me){for(const xe of O){const le=xe*this.stride,Ee=R[le+Yt]>1;let Ne,Ce,it;if(Ee)Ne=sn(R,le,this.clusterProps),Ce=R[le],it=R[le+1];else{const ci=this.points[R[le+Mt]];Ne=ci.properties;const[Xt,ui]=ci.geometry.coordinates;Ce=Ui(Xt),it=Hi(ui)}const kt={type:1,geometry:[[Math.round(this.options.extent*(Ce*de-W)),Math.round(this.options.extent*(it*de-Y))]],tags:Ne};let Dt;Dt=Ee||this.options.generateId?R[le+Mt]:this.points[R[le+Mt]].id,Dt!==void 0&&(kt.id=Dt),me.features.push(kt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,R){const{radius:W,extent:Y,reduce:de,minPoints:me}=this.options,xe=W/(Y*Math.pow(2,R)),le=O.data,Ee=[],Ne=this.stride;for(let Ce=0;Ce<le.length;Ce+=Ne){if(le[Ce+2]<=R)continue;le[Ce+2]=R;const it=le[Ce],kt=le[Ce+1],Dt=O.within(le[Ce],le[Ce+1],xe),ci=le[Ce+Yt];let Xt=ci;for(const ui of Dt){const ii=ui*Ne;le[ii+2]>R&&(Xt+=le[ii+Yt])}if(Xt>ci&&Xt>=me){let ui,ii=it*ci,on=kt*ci,Zi=-1;const Qt=((Ce/Ne|0)<<5)+(R+1)+this.points.length;for(const _i of Dt){const Bi=_i*Ne;if(le[Bi+2]<=R)continue;le[Bi+2]=R;const pn=le[Bi+Yt];ii+=le[Bi]*pn,on+=le[Bi+1]*pn,le[Bi+4]=Qt,de&&(ui||(ui=this._map(le,Ce,!0),Zi=this.clusterProps.length,this.clusterProps.push(ui)),de(ui,this._map(le,Bi)))}le[Ce+4]=Qt,Ee.push(ii/Xt,on/Xt,1/0,Qt,-1,Xt),de&&Ee.push(Zi)}else{for(let ui=0;ui<Ne;ui++)Ee.push(le[Ce+ui]);if(Xt>1)for(const ui of Dt){const ii=ui*Ne;if(!(le[ii+2]<=R)){le[ii+2]=R;for(let on=0;on<Ne;on++)Ee.push(le[ii+on])}}}}return Ee}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,R,W){if(O[R+Yt]>1){const me=this.clusterProps[O[R+yi]];return W?Object.assign({},me):me}const Y=this.points[O[R+Mt]].properties,de=this.options.map(Y);return W&&de===Y?Object.assign({},de):de}}function Fi(ne,O,R){return{type:"Feature",id:ne[O+Mt],properties:sn(ne,O,R),geometry:{type:"Point",coordinates:[(W=ne[O],360*(W-.5)),Fn(ne[O+1])]}};var W}function sn(ne,O,R){const W=ne[O+Yt],Y=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,de=ne[O+yi],me=de===-1?{}:Object.assign({},R[de]);return Object.assign(me,{cluster:!0,cluster_id:ne[O+Mt],point_count:W,point_count_abbreviated:Y})}function Ui(ne){return ne/360+.5}function Hi(ne){const O=Math.sin(ne*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function Fn(ne){const O=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Xi(ne,O,R,W){let Y=W;const de=O+(R-O>>1);let me,xe=R-O;const le=ne[O],Ee=ne[O+1],Ne=ne[R],Ce=ne[R+1];for(let it=O+3;it<R;it+=3){const kt=xi(ne[it],ne[it+1],le,Ee,Ne,Ce);if(kt>Y)me=it,Y=kt;else if(kt===Y){const Dt=Math.abs(it-de);Dt<xe&&(me=it,xe=Dt)}}Y>W&&(me-O>3&&Xi(ne,O,me,W),ne[me+2]=Y,R-me>3&&Xi(ne,me,R,W))}function xi(ne,O,R,W,Y,de){let me=Y-R,xe=de-W;if(me!==0||xe!==0){const le=((ne-R)*me+(O-W)*xe)/(me*me+xe*xe);le>1?(R=Y,W=de):le>0&&(R+=me*le,W+=xe*le)}return me=ne-R,xe=O-W,me*me+xe*xe}function cn(ne,O,R,W){const Y={id:ne??null,type:O,geometry:R,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")Ki(Y,R);else if(O==="Polygon")Ki(Y,R[0]);else if(O==="MultiLineString")for(const de of R)Ki(Y,de);else if(O==="MultiPolygon")for(const de of R)Ki(Y,de[0]);return Y}function Ki(ne,O){for(let R=0;R<O.length;R+=3)ne.minX=Math.min(ne.minX,O[R]),ne.minY=Math.min(ne.minY,O[R+1]),ne.maxX=Math.max(ne.maxX,O[R]),ne.maxY=Math.max(ne.maxY,O[R+1])}function mt(ne,O,R,W){if(!O.geometry)return;const Y=O.geometry.coordinates;if(Y&&Y.length===0)return;const de=O.geometry.type,me=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let xe=[],le=O.id;if(R.promoteId?le=O.properties[R.promoteId]:R.generateId&&(le=W||0),de==="Point")Bt(Y,xe);else if(de==="MultiPoint")for(const Ee of Y)Bt(Ee,xe);else if(de==="LineString")be(Y,xe,me,!1);else if(de==="MultiLineString"){if(R.lineMetrics){for(const Ee of Y)xe=[],be(Ee,xe,me,!1),ne.push(cn(le,"LineString",xe,O.properties));return}ki(Y,xe,me,!1)}else if(de==="Polygon")ki(Y,xe,me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Ee of O.geometry.geometries)mt(ne,{id:le,geometry:Ee,properties:O.properties},R,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ee of Y){const Ne=[];ki(Ee,Ne,me,!0),xe.push(Ne)}}ne.push(cn(le,de,xe,O.properties))}function Bt(ne,O){O.push(In(ne[0]),Ht(ne[1]),0)}function be(ne,O,R,W){let Y,de,me=0;for(let le=0;le<ne.length;le++){const Ee=In(ne[le][0]),Ne=Ht(ne[le][1]);O.push(Ee,Ne,0),le>0&&(me+=W?(Y*Ne-Ee*de)/2:Math.sqrt(Math.pow(Ee-Y,2)+Math.pow(Ne-de,2))),Y=Ee,de=Ne}const xe=O.length-3;O[2]=1,Xi(O,0,xe,R),O[xe+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function ki(ne,O,R,W){for(let Y=0;Y<ne.length;Y++){const de=[];be(ne[Y],de,R,W),O.push(de)}}function In(ne){return ne/360+.5}function Ht(ne){const O=Math.sin(ne*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function li(ne,O,R,W,Y,de,me,xe){if(W/=O,de>=(R/=O)&&me<W)return ne;if(me<R||de>=W)return null;const le=[];for(const Ee of ne){const Ne=Ee.geometry;let Ce=Ee.type;const it=Y===0?Ee.minX:Ee.minY,kt=Y===0?Ee.maxX:Ee.maxY;if(it>=R&&kt<W){le.push(Ee);continue}if(kt<R||it>=W)continue;let Dt=[];if(Ce==="Point"||Ce==="MultiPoint")sr(Ne,Dt,R,W,Y);else if(Ce==="LineString")_n(Ne,Dt,R,W,Y,!1,xe.lineMetrics);else if(Ce==="MultiLineString")Zr(Ne,Dt,R,W,Y,!1);else if(Ce==="Polygon")Zr(Ne,Dt,R,W,Y,!0);else if(Ce==="MultiPolygon")for(const ci of Ne){const Xt=[];Zr(ci,Xt,R,W,Y,!0),Xt.length&&Dt.push(Xt)}if(Dt.length){if(xe.lineMetrics&&Ce==="LineString"){for(const ci of Dt)le.push(cn(Ee.id,Ce,ci,Ee.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(Dt.length===1?(Ce="LineString",Dt=Dt[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=Dt.length===3?"Point":"MultiPoint"),le.push(cn(Ee.id,Ce,Dt,Ee.tags))}}return le.length?le:null}function sr(ne,O,R,W,Y){for(let de=0;de<ne.length;de+=3){const me=ne[de+Y];me>=R&&me<=W&&dn(O,ne[de],ne[de+1],ne[de+2])}}function _n(ne,O,R,W,Y,de,me){let xe=Xn(ne);const le=Y===0?us:Es;let Ee,Ne,Ce=ne.start;for(let Xt=0;Xt<ne.length-3;Xt+=3){const ui=ne[Xt],ii=ne[Xt+1],on=ne[Xt+2],Zi=ne[Xt+3],Qt=ne[Xt+4],_i=Y===0?ui:ii,Bi=Y===0?Zi:Qt;let pn=!1;me&&(Ee=Math.sqrt(Math.pow(ui-Zi,2)+Math.pow(ii-Qt,2))),_i<R?Bi>R&&(Ne=le(xe,ui,ii,Zi,Qt,R),me&&(xe.start=Ce+Ee*Ne)):_i>W?Bi<W&&(Ne=le(xe,ui,ii,Zi,Qt,W),me&&(xe.start=Ce+Ee*Ne)):dn(xe,ui,ii,on),Bi<R&&_i>=R&&(Ne=le(xe,ui,ii,Zi,Qt,R),pn=!0),Bi>W&&_i<=W&&(Ne=le(xe,ui,ii,Zi,Qt,W),pn=!0),!de&&pn&&(me&&(xe.end=Ce+Ee*Ne),O.push(xe),xe=Xn(ne)),me&&(Ce+=Ee)}let it=ne.length-3;const kt=ne[it],Dt=ne[it+1],ci=Y===0?kt:Dt;ci>=R&&ci<=W&&dn(xe,kt,Dt,ne[it+2]),it=xe.length-3,de&&it>=3&&(xe[it]!==xe[0]||xe[it+1]!==xe[1])&&dn(xe,xe[0],xe[1],xe[2]),xe.length&&O.push(xe)}function Xn(ne){const O=[];return O.size=ne.size,O.start=ne.start,O.end=ne.end,O}function Zr(ne,O,R,W,Y,de){for(const me of ne)_n(me,O,R,W,Y,de,!1)}function dn(ne,O,R,W){ne.push(O,R,W)}function us(ne,O,R,W,Y,de){const me=(de-O)/(W-O);return dn(ne,de,R+(Y-R)*me,1),me}function Es(ne,O,R,W,Y,de){const me=(de-R)/(Y-R);return dn(ne,O+(W-O)*me,de,1),me}function Je(ne,O){const R=[];for(let W=0;W<ne.length;W++){const Y=ne[W],de=Y.type;let me;if(de==="Point"||de==="MultiPoint"||de==="LineString")me=mr(Y.geometry,O);else if(de==="MultiLineString"||de==="Polygon"){me=[];for(const xe of Y.geometry)me.push(mr(xe,O))}else if(de==="MultiPolygon"){me=[];for(const xe of Y.geometry){const le=[];for(const Ee of xe)le.push(mr(Ee,O));me.push(le)}}R.push(cn(Y.id,de,me,Y.tags))}return R}function mr(ne,O){const R=[];R.size=ne.size,ne.start!==void 0&&(R.start=ne.start,R.end=ne.end);for(let W=0;W<ne.length;W+=3)R.push(ne[W]+O,ne[W+1],ne[W+2]);return R}function vn(ne,O){if(ne.transformed)return ne;const R=1<<ne.z,W=ne.x,Y=ne.y;for(const de of ne.features){const me=de.geometry,xe=de.type;if(de.geometry=[],xe===1)for(let le=0;le<me.length;le+=2)de.geometry.push(Pr(me[le],me[le+1],O,R,W,Y));else for(let le=0;le<me.length;le++){const Ee=[];for(let Ne=0;Ne<me[le].length;Ne+=2)Ee.push(Pr(me[le][Ne],me[le][Ne+1],O,R,W,Y));de.geometry.push(Ee)}}return ne.transformed=!0,ne}function Pr(ne,O,R,W,Y,de){return[Math.round(R*(ne*W-Y)),Math.round(R*(O*W-de))]}function Ir(ne,O,R,W,Y){const de=O===Y.maxZoom?0:Y.tolerance/((1<<O)*Y.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:ne.length,source:null,x:R,y:W,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xe of ne)tt(me,xe,de,Y);return me}function tt(ne,O,R,W){const Y=O.geometry,de=O.type,me=[];if(ne.minX=Math.min(ne.minX,O.minX),ne.minY=Math.min(ne.minY,O.minY),ne.maxX=Math.max(ne.maxX,O.maxX),ne.maxY=Math.max(ne.maxY,O.maxY),de==="Point"||de==="MultiPoint")for(let xe=0;xe<Y.length;xe+=3)me.push(Y[xe],Y[xe+1]),ne.numPoints++,ne.numSimplified++;else if(de==="LineString")$t(me,Y,ne,R,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let xe=0;xe<Y.length;xe++)$t(me,Y[xe],ne,R,de==="Polygon",xe===0);else if(de==="MultiPolygon")for(let xe=0;xe<Y.length;xe++){const le=Y[xe];for(let Ee=0;Ee<le.length;Ee++)$t(me,le[Ee],ne,R,!0,Ee===0)}if(me.length){let xe=O.tags||null;if(de==="LineString"&&W.lineMetrics){xe={};for(const Ee in O.tags)xe[Ee]=O.tags[Ee];xe.mapbox_clip_start=Y.start/Y.size,xe.mapbox_clip_end=Y.end/Y.size}const le={geometry:me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:xe};O.id!==null&&(le.id=O.id),ne.features.push(le)}}function $t(ne,O,R,W,Y,de){const me=W*W;if(W>0&&O.size<(Y?me:W))return void(R.numPoints+=O.length/3);const xe=[];for(let le=0;le<O.length;le+=3)(W===0||O[le+2]>me)&&(R.numSimplified++,xe.push(O[le],O[le+1])),R.numPoints++;Y&&function(le,Ee){let Ne=0;for(let Ce=0,it=le.length,kt=it-2;Ce<it;kt=Ce,Ce+=2)Ne+=(le[Ce]-le[kt])*(le[Ce+1]+le[kt+1]);if(Ne>0===Ee)for(let Ce=0,it=le.length;Ce<it/2;Ce+=2){const kt=le[Ce],Dt=le[Ce+1];le[Ce]=le[it-2-Ce],le[Ce+1]=le[it-1-Ce],le[it-2-Ce]=kt,le[it-1-Ce]=Dt}}(xe,de),ne.push(xe)}const Ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Cn{constructor(O,R){const W=(R=this.options=function(de,me){for(const xe in me)de[xe]=me[xe];return de}(Object.create(Ft),R)).debug;if(W&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(de,me){const xe=[];if(de.type==="FeatureCollection")for(let le=0;le<de.features.length;le++)mt(xe,de.features[le],me,le);else mt(xe,de.type==="Feature"?de:{geometry:de},me);return xe}(O,R);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(de,me){const xe=me.buffer/me.extent;let le=de;const Ee=li(de,1,-1-xe,xe,0,-1,2,me),Ne=li(de,1,1-xe,2+xe,0,-1,2,me);return(Ee||Ne)&&(le=li(de,1,-xe,1+xe,0,-1,2,me)||[],Ee&&(le=Je(Ee,1).concat(le)),Ne&&(le=le.concat(Je(Ne,-1)))),le}(Y,R),Y.length&&this.splitTile(Y,0,0,0),W&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,R,W,Y,de,me,xe){const le=[O,R,W,Y],Ee=this.options,Ne=Ee.debug;for(;le.length;){Y=le.pop(),W=le.pop(),R=le.pop(),O=le.pop();const Ce=1<<R,it=xn(R,W,Y);let kt=this.tiles[it];if(!kt&&(Ne>1&&console.time("creation"),kt=this.tiles[it]=Ir(O,R,W,Y,Ee),this.tileCoords.push({z:R,x:W,y:Y}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,W,Y,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));const pn=`z${R}`;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(kt.source=O,de==null){if(R===Ee.indexMaxZoom||kt.numPoints<=Ee.indexMaxPoints)continue}else{if(R===Ee.maxZoom||R===de)continue;if(de!=null){const pn=de-R;if(W!==me>>pn||Y!==xe>>pn)continue}}if(kt.source=null,O.length===0)continue;Ne>1&&console.time("clipping");const Dt=.5*Ee.buffer/Ee.extent,ci=.5-Dt,Xt=.5+Dt,ui=1+Dt;let ii=null,on=null,Zi=null,Qt=null,_i=li(O,Ce,W-Dt,W+Xt,0,kt.minX,kt.maxX,Ee),Bi=li(O,Ce,W+ci,W+ui,0,kt.minX,kt.maxX,Ee);O=null,_i&&(ii=li(_i,Ce,Y-Dt,Y+Xt,1,kt.minY,kt.maxY,Ee),on=li(_i,Ce,Y+ci,Y+ui,1,kt.minY,kt.maxY,Ee),_i=null),Bi&&(Zi=li(Bi,Ce,Y-Dt,Y+Xt,1,kt.minY,kt.maxY,Ee),Qt=li(Bi,Ce,Y+ci,Y+ui,1,kt.minY,kt.maxY,Ee),Bi=null),Ne>1&&console.timeEnd("clipping"),le.push(ii||[],R+1,2*W,2*Y),le.push(on||[],R+1,2*W,2*Y+1),le.push(Zi||[],R+1,2*W+1,2*Y),le.push(Qt||[],R+1,2*W+1,2*Y+1)}}getTile(O,R,W){O=+O,R=+R,W=+W;const Y=this.options,{extent:de,debug:me}=Y;if(O<0||O>24)return null;const xe=1<<O,le=xn(O,R=R+xe&xe-1,W);if(this.tiles[le])return vn(this.tiles[le],de);me>1&&console.log("drilling down to z%d-%d-%d",O,R,W);let Ee,Ne=O,Ce=R,it=W;for(;!Ee&&Ne>0;)Ne--,Ce>>=1,it>>=1,Ee=this.tiles[xn(Ne,Ce,it)];return Ee&&Ee.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Ne,Ce,it),console.time("drilling down")),this.splitTile(Ee.source,Ne,Ce,it,O,R,W),me>1&&console.timeEnd("drilling down"),this.tiles[le]?vn(this.tiles[le],de):null):null}}function xn(ne,O,R){return 32*((1<<ne)*R+O)+ne}function Nt(ne,O){return O?ne.properties[O]:ne.id}function or(ne,O){if(ne==null)return!0;if(ne.type==="Feature")return Nt(ne,O)!=null;if(ne.type==="FeatureCollection"){const R=new Set;for(const W of ne.features){const Y=Nt(W,O);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Qr(ne,O){const R=new Map;if(ne!=null)if(ne.type==="Feature")R.set(Nt(ne,O),ne);else for(const W of ne.features)R.set(Nt(W,O),W);return R}class hs extends B{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,R){return b._(this,void 0,void 0,function*(){const W=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!Y)return null;const de=new class{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.X,this.length=xe.length,this._features=xe}feature(xe){return new class{constructor(le){this._feature=le,this.extent=b.X,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Ee of this._feature.geometry)le.push([new b.P(Ee[0],Ee[1])]);return le}{const le=[];for(const Ee of this._feature.geometry){const Ne=[];for(const Ce of Ee)Ne.push(new b.P(Ce[0],Ce[1]));le.push(Ne)}return le}}toGeoJSON(le,Ee,Ne){return ue.call(this,le,Ee,Ne)}}(this._features[xe])}}(Y.features);let me=pt(de);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:de,rawData:me.buffer}})}loadData(O){return b._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const W=!!(O&&O.request&&O.request.collectResourceTiming)&&new b.bv(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest),this._geoJSONIndex=O.cluster?new Pi(function({superclusterOptions:me,clusterProperties:xe}){if(!xe||!me)return me;const le={},Ee={},Ne={accumulated:null,zoom:0},Ce={properties:null},it=Object.keys(xe);for(const kt of it){const[Dt,ci]=xe[kt],Xt=b.bC(ci),ui=b.bC(typeof Dt=="string"?[Dt,["accumulated"],["get",kt]]:Dt);le[kt]=Xt.value,Ee[kt]=ui.value}return me.map=kt=>{Ce.properties=kt;const Dt={};for(const ci of it)Dt[ci]=le[ci].evaluate(Ne,Ce);return Dt},me.reduce=(kt,Dt)=>{Ce.properties=Dt;for(const ci of it)Ne.accumulated=kt[ci],kt[ci]=Ee[ci].evaluate(Ne,Ce)},me}(O)).load((yield this._pendingData).features):(Y=yield this._pendingData,new Cn(Y,O.geojsonVtOptions)),this.loaded={};const de={};if(W){const me=W.finish();me&&(de.resourceTiming={},de.resourceTiming[O.source]=JSON.parse(JSON.stringify(me)))}return de}catch(de){if(delete this._pendingRequest,b.bB(de))return{abandoned:!0};throw de}var Y})}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){const R=this.loaded;return R&&R[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,R){return b._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(O,R);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(te(W,!0),O.filter){const Y=b.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(me=>`${me.key}: ${me.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(me=>Y.value.evaluate({zoom:0},me))}}return W})}loadGeoJSON(O,R){return b._(this,void 0,void 0,function*(){const{promoteId:W}=O;if(O.request){const Y=yield b.h(O.request,R);return this._dataUpdateable=or(Y.data,W)?Qr(Y.data,W):void 0,Y.data}if(typeof O.data=="string")try{const Y=JSON.parse(O.data);return this._dataUpdateable=or(Y,W)?Qr(Y,W):void 0,Y}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function(Y,de,me){var xe,le,Ee,Ne;if(de.removeAll&&Y.clear(),de.remove)for(const Ce of de.remove)Y.delete(Ce);if(de.add)for(const Ce of de.add){const it=Nt(Ce,me);it!=null&&Y.set(it,Ce)}if(de.update)for(const Ce of de.update){let it=Y.get(Ce.id);if(it==null)continue;const kt=!Ce.removeAllProperties&&(((xe=Ce.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((le=Ce.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((Ce.newGeometry||Ce.removeAllProperties||kt)&&(it=Object.assign({},it),Y.set(Ce.id,it),kt&&(it.properties=Object.assign({},it.properties))),Ce.newGeometry&&(it.geometry=Ce.newGeometry),Ce.removeAllProperties)it.properties={};else if(((Ee=Ce.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const Dt of Ce.removeProperties)Object.prototype.hasOwnProperty.call(it.properties,Dt)&&delete it.properties[Dt];if(((Ne=Ce.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:Dt,value:ci}of Ce.addOrUpdateProperties)it.properties[Dt]=ci}}(this._dataUpdateable,O.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Gr{constructor(O){this.self=O,this.actor=new b.F(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,W)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=W},this.self.addProtocol=b.bi,this.self.removeProtocol=b.bj,this.self.registerRTLTextPlugin=R=>{if(b.bD.isParsed())throw new Error("RTL text plugin already registered.");b.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,W)=>this._getDEMWorkerSource(R,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(R,W)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(R,W)=>this._getWorkerSource(R,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(R,W)=>this._getWorkerSource(R,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(R,W)=>this._getWorkerSource(R,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(R,W)=>this._getWorkerSource(R,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(R,W)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][W.type]||!this.workerSources[R][W.type][W.source])return;const Y=this.workerSources[R][W.type][W.source];delete this.workerSources[R][W.type][W.source],Y.removeSource!==void 0&&Y.removeSource(W)})),this.actor.registerMessageHandler("RM",R=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,W)=>b._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(R,W)=>this._syncRTLPluginState(R,W)),this.actor.registerMessageHandler("IS",(R,W)=>b._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(R,W)=>this._setImages(R,W)),this.actor.registerMessageHandler("UL",(R,W)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(R,W)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(W)}))}_setImages(O,R){return b._(this,void 0,void 0,function*(){this.availableImages[O]=R;for(const W in this.workerSources[O]){const Y=this.workerSources[O][W];for(const de in Y)Y[de].availableImages=R}})}_syncRTLPluginState(O,R){return b._(this,void 0,void 0,function*(){if(b.bD.isParsed())return b.bD.getState();if(R.pluginStatus!=="loading")return b.bD.setState(R),R;const W=R.pluginURL;if(this.self.importScripts(W),b.bD.isParsed()){const Y={pluginStatus:"loaded",pluginURL:W};return b.bD.setState(Y),Y}throw b.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)})}_getAvailableImages(O){let R=this.availableImages[O];return R||(R=[]),R}_getLayerIndex(O){let R=this.layerIndexes[O];return R||(R=this.layerIndexes[O]=new c),R}_getWorkerSource(O,R,W){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][R]||(this.workerSources[O][R]={}),!this.workerSources[O][R][W]){const Y={sendAsync:(de,me)=>(de.targetMapId=O,this.actor.sendAsync(de,me))};switch(R){case"vector":this.workerSources[O][R][W]=new B(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][R][W]=new hs(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][R][W]=new this.externalWorkerSourceTypes[R](Y,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][R][W]}_getDEMWorkerSource(O,R){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][R]||(this.demWorkerSources[O][R]=new V),this.demWorkerSources[O][R]}}return b.i(self)&&(self.worker=new Gr(self)),Gr}),T("index",["exports","./shared"],function(b,c){var j="4.7.1";let U,K;const B={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((e,r)=>{const a=requestAnimationFrame(e);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),r(c.c())})}),getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,r.drawImage(p,0,0,p.width,p.height),r},resolveURL:p=>(U||(U=document.createElement("a")),U.href=p,U.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in V.docStyle)return e[r];return e[0]}static create(e,r,a){const l=window.document.createElement(e);return r!==void 0&&(l.className=r),a&&a.appendChild(l),l}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,r){e.style[V.transformProp]=r}static addEventListener(e,r,a,l={}){e.addEventListener(r,a,"passive"in l?l:l.capture)}static removeEventListener(e,r,a,l={}){e.removeEventListener(r,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,a){const l=r.boundingClientRect;return new c.P((a.clientX-l.left)/r.x-e.clientLeft,(a.clientY-l.top)/r.y-e.clientTop)}static mousePos(e,r){const a=V.getScale(e);return V.getPoint(e,a,r)}static touchPos(e,r){const a=[],l=V.getScale(e);for(let d=0;d<r.length;d++)a.push(V.getPoint(e,l,r[d]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const oe={supported:!1,testSupport:function(p){!ue&&te&&(ve?pe(p):ie=p)}};let ie,te,ue=!1,ve=!1;function pe(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,te),p.isContextLost())return;oe.supported=!0}catch{}p.deleteTexture(e),ue=!0}var Ie;typeof document<"u"&&(te=document.createElement("img"),te.onload=()=>{ie&&pe(ie),ie=null,ve=!0},te.onerror=()=>{ue=!0,ie=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,r,a,l;p.resetRequestQueue=()=>{e=[],r=0,a=0,l={}},p.addThrottleControl=S=>{const k=a++;return l[k]=S,k},p.removeThrottleControl=S=>{delete l[S],_()},p.getImage=(S,k,M=!0)=>new Promise((z,N)=>{oe.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),c.e(S,{type:"image"}),e.push({abortController:k,requestParameters:S,supportImageRefresh:M,state:"queued",onError:G=>{N(G)},onSuccess:G=>{z(G)}}),_()});const d=S=>c._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:k,supportImageRefresh:M,onError:z,onSuccess:N,abortController:G}=S,X=M===!1&&!c.i(self)&&!c.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((ae,ce)=>ae&&ce==="accept",!0));r++;const Q=X?w(k,G):c.m(k,G);try{const ae=yield Q;delete S.abortController,S.state="completed",ae.data instanceof HTMLImageElement||c.b(ae.data)?N(ae):ae.data&&N({data:yield(se=ae.data,typeof createImageBitmap=="function"?c.d(se):c.f(se)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete S.abortController,z(ae)}finally{r--,_()}var se}),_=()=>{const S=(()=>{for(const k of Object.keys(l))if(l[k]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=r;k<S&&e.length>0;k++){const M=e.shift();M.abortController.signal.aborted?k--:d(M)}},w=(S,k)=>new Promise((M,z)=>{const N=new Image,G=S.url,X=S.credentials;X&&X==="include"?N.crossOrigin="use-credentials":(X&&X==="same-origin"||!c.s(G))&&(N.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{N.src="",z(c.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,M({data:N})},N.onerror=()=>{N.onerror=N.onload=null,k.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=G})}(Ie||(Ie={})),Ie.resetRequestQueue();class Oe{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ze(p){var e=new c.A(3);return e[0]=p[0],e[1]=p[1],e[2]=p[2],e}var We,$e=function(p,e,r){return p[0]=e[0]-r[0],p[1]=e[1]-r[1],p[2]=e[2]-r[2],p};We=new c.A(3),c.A!=Float32Array&&(We[0]=0,We[1]=0,We[2]=0);var xt=function(p){var e=p[0],r=p[1];return e*e+r*r};function He(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const r=[];for(const{id:a,url:l}of p){const d=`${a}${l}`;r.indexOf(d)===-1&&(r.push(d),e.push({id:a,url:l}))}}return e}function Ye(p,e,r){const a=p.split("?");return a[0]+=`${e}${r}`,a.join("?")}(function(){var p=new c.A(2);c.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Be{constructor(e,r,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,l)}update(e,r,a){const{width:l,height:d}=e,_=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(r&&r.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[l,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,l,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:k,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,k,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,k,M,l,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,r,a){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Me(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class De extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:a}of this.requestors)a(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const a=r.spriteData;r.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let a=!0;const l=r.data||r.spriteData;return this._validateStretch(r.stretchX,l&&l.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,l&&l.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,r){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||r<l[1])return!1;a=l[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const a=r.spriteData,l=a&&a.width||r.data.width,d=a&&a.height||r.data.height;return!(e[0]<0||l<e[0]||e[1]<0||d<e[1]||e[2]<0||l<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==r.data.width||l.data.height!==r.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=l.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,a)=>{let l=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(l=!1);this.isLoaded()||l?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const a of e){let l=this.getImage(a);l||(this.fire(new c.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?r[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],a=this.getImage(e);if(!a)return null;if(r&&r.position.version===a.version)return r.position;if(r)r.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new c.I(l,a);this.patterns[e]={bin:l,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Be(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:r,h:a}=c.p(e),l=this.atlasImage;l.resize({width:r||1,height:a||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],w=_.x+1,S=_.y+1,k=this.getImage(d).data,M=k.width,z=k.height;c.R.copy(k,l,{x:0,y:0},{x:w,y:S},{width:M,height:z}),c.R.copy(k,l,{x:0,y:z-1},{x:w,y:S-1},{width:M,height:1}),c.R.copy(k,l,{x:0,y:0},{x:w,y:S+z},{width:M,height:1}),c.R.copy(k,l,{x:M-1,y:0},{x:w-1,y:S},{width:1,height:z}),c.R.copy(k,l,{x:0,y:0},{x:w+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const a=this.getImage(r);a||c.w(`Image with ID: "${r}" was not found`),Me(a)&&this.updateImage(r,a)}}}const Ae=1e20;function Ue(p,e,r,a,l,d,_,w,S){for(let k=e;k<e+a;k++)et(p,r*d+k,d,l,_,w,S);for(let k=r;k<r+l;k++)et(p,k*d+e,1,a,_,w,S)}function et(p,e,r,a,l,d,_){d[0]=0,_[0]=-Ae,_[1]=Ae,l[0]=p[e];for(let w=1,S=0,k=0;w<a;w++){l[w]=p[e+w*r];const M=w*w;do{const z=d[S];k=(l[w]-l[z]+M-z*z)/(w-z)/2}while(k<=_[S]&&--S>-1);S++,d[S]=w,_[S]=k,_[S+1]=Ae}for(let w=0,S=0;w<a;w++){for(;_[S+1]<w;)S++;const k=d[S],M=w-k;p[e+w*r]=l[k]+M*M}}class pt{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const r=[];for(const d in e)for(const _ of e[d])r.push(this._getAndCacheGlyphsPromise(d,_));const a=yield Promise.all(r),l={};for(const{stack:d,id:_,glyph:w}of a)l[d]||(l[d]={}),l[d][_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return l})}_getAndCacheGlyphsPromise(e,r){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[r];if(l!==void 0)return{stack:e,id:r,glyph:l};if(l=this._tinySDF(a,e,r),l)return a.glyphs[r]=l,{stack:e,id:r,glyph:l};const d=Math.floor(r/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[d])return{stack:e,id:r,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[d]){const w=pt.loadGlyphRange(e,d,this.url,this.requestManager);a.requests[d]=w}const _=yield a.requests[d];for(const w in _)this._doesCharSupportLocalGlyph(+w)||(a.glyphs[+w]=_[+w]);return a.ranges[d]=!0,{stack:e,id:r,glyph:_[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,r,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),d=e.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:w})}const _=d.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(p,e,r,a){return c._(this,void 0,void 0,function*(){const l=256*e,d=l+255,_=a.transformRequest(r.replace("{fontstack}",p).replace("{range}",`${l}-${d}`),"Glyphs"),w=yield c.l(_,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${d}`);const S={};for(const k of c.n(w.data))S[k.id]=k;return S})},pt.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const w=this.size=p+4*e,S=this._createCanvas(w),k=this.ctx=S.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${d} ${p}px ${l}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(p),_=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),S=Math.min(this.size-this.buffer,_+Math.ceil(a)),k=w+2*this.buffer,M=S+2*this.buffer,z=Math.max(k*M,0),N=new Uint8ClampedArray(z),G={data:N,width:k,height:M,glyphWidth:w,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return G;const{ctx:X,buffer:Q,gridInner:se,gridOuter:ae}=this;X.clearRect(Q,Q,w,S),X.fillText(p,Q,Q+_);const ce=X.getImageData(Q,Q,w,S);ae.fill(Ae,0,z),se.fill(0,0,z);for(let $=0;$<S;$++)for(let fe=0;fe<w;fe++){const ge=ce.data[4*($*w+fe)+3]/255;if(ge===0)continue;const Se=($+Q)*k+fe+Q;if(ge===1)ae[Se]=0,se[Se]=Ae;else{const Fe=.5-ge;ae[Se]=Fe>0?Fe*Fe:0,se[Se]=Fe<0?Fe*Fe:0}}Ue(ae,0,0,k,M,k,this.f,this.v,this.z),Ue(se,Q,Q,w,S,k,this.f,this.v,this.z);for(let $=0;$<z;$++){const fe=Math.sqrt(ae[$])-Math.sqrt(se[$]);N[$]=Math.round(255-255*(fe/this.radius+this.cutoff))}return G}};class ut{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,r){return c.x(e.expression.evaluate(r))}interpolate(e,r,a){return{x:c.y.number(e.x,r.x,a),y:c.y.number(e.y,r.y,a),z:c.y.number(e.z,r.z,a)}}}let ct;class at extends c.E{constructor(e){super(),ct=ct||new c.q({anchor:new c.D(c.v.light.anchor),position:new ut,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(c.r,e,r))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Mt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class Yt extends c.E{constructor(e){super(),this._transitionable=new c.T(Mt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,r={}){if(!this._validate(c.B,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class yi{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const a=e.join(",")+String(r);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,r)),this.dashEntry[a]}getDashRanges(e,r,a){const l=[];let d=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,w=!0;l.push({left:d,right:_,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let k=1;k<e.length;k++){w=!w;const M=e[k];d=S*a,S+=M,_=S*a,l.push({left:d,right:_,isDash:w,zeroLength:M===0})}return l}addRoundDash(e,r,a){const l=r/2;for(let d=-a;d<=a;d++){const _=this.width*(this.nextRow+a+d);let w=0,S=e[w];for(let k=0;k<this.width;k++){k/S.right>1&&(S=e[++w]);const M=Math.abs(k-S.left),z=Math.abs(k-S.right),N=Math.min(M,z);let G;const X=d/a*(l+1);if(S.isDash){const Q=l-Math.abs(X);G=Math.sqrt(N*N+Q*Q)}else G=l-Math.sqrt(N*N+X*X);this.data[_+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],k=e[w+1];S.zeroLength?e.splice(w,1):k&&k.isDash===S.isDash&&(k.left=S.left,e.splice(w,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const l=this.width*this.nextRow;let d=0,_=e[d];for(let w=0;w<this.width;w++){w/_.right>1&&(_=e[++d]);const S=Math.abs(w-_.left),k=Math.abs(w-_.right),M=Math.min(S,k);this.data[l+w]=Math.max(0,Math.min(255,(_.isDash?M:-M)+128))}}addDash(e,r){const a=r?7:0,l=2*a+1;if(this.nextRow+l>this.height)return c.w("LineAtlas out of space"),null;let d=0;for(let w=0;w<e.length;w++)d+=e[w];if(d!==0){const w=this.width/d,S=this.getDashRanges(e,this.width,w);r?this.addRoundDash(S,w,a):this.addRegularDash(S)}const _={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=l,this.dirty=!0,_}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Pi="maplibre_preloaded_worker_pool";class Fi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Fi.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pi]}numActive(){return Object.keys(this.active).length}}const sn=Math.floor(B.hardwareConcurrency/2);let Ui,Hi;function Fn(){return Ui||(Ui=new Fi),Ui}Fi.workerCount=c.C(globalThis)?Math.max(Math.min(sn,3),1):1;class Xi{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const a=this.workerPool.acquire(r);for(let l=0;l<a.length;l++){const d=new c.F(a[l],r);d.name=`Worker ${l}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:r}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const a of this.actors)a.registerMessageHandler(e,r)}}function xi(){return Hi||(Hi=new Xi(Fn(),c.G),Hi.registerMessageHandler("GR",(p,e,r)=>c.m(e,r))),Hi}function cn(p,e){const r=c.H();return c.J(r,r,[1,1,0]),c.K(r,r,[.5*p.width,.5*p.height,1]),c.L(r,r,p.calculatePosMatrix(e.toUnwrapped()))}function Ki(p,e,r,a,l,d){const _=function(z,N,G){if(z)for(const X of z){const Q=N[X];if(Q&&Q.source===G&&Q.type==="fill-extrusion")return!0}else for(const X in N){const Q=N[X];if(Q.source===G&&Q.type==="fill-extrusion")return!0}return!1}(l&&l.layers,e,p.id),w=d.maxPitchScaleFactor(),S=p.tilesIn(a,w,_);S.sort(mt);const k=[];for(const z of S)k.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,r,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,l,d,w,cn(p.transform,z.tileID))});const M=function(z){const N={},G={};for(const X of z){const Q=X.queryResults,se=X.wrappedTileID,ae=G[se]=G[se]||{};for(const ce in Q){const $=Q[ce],fe=ae[ce]=ae[ce]||{},ge=N[ce]=N[ce]||[];for(const Se of $)fe[Se.featureIndex]||(fe[Se.featureIndex]=!0,ge.push(Se))}}return N}(k);for(const z in M)M[z].forEach(N=>{const G=N.feature,X=p.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=X});return M}function mt(p,e){const r=p.tileID,a=e.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}function Bt(p,e,r){return c._(this,void 0,void 0,function*(){let a=p;if(p.url?a=(yield c.h(e.transformRequest(p.url,"Source"),r)).data:yield B.frameAsync(r),!a)return null;const l=c.M(c.e(a,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(d=>d.id)),l})}class be{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const r=this._sw,a=this._ne;let l,d;if(e instanceof c.N)l=e,d=e;else{if(!(e instanceof be))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(be.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return r||a?(r.lng=Math.min(l.lng,r.lng),r.lat=Math.min(l.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new c.N(l.lng,l.lat),this._ne=new c.N(d.lng,d.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=c.N.convert(e);let l=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof be?e:e&&new be(e)}static fromLngLat(e,r=0){const a=360*r/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new be(new c.N(e.lng-l,e.lat-a),new c.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),r=new c.N(this._ne.lng,this._ne.lat);return new be(e,e.lng>r.lng?new c.N(r.lng+360,r.lat):r)}}class ki{constructor(e,r,a){this.bounds=be.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*r),l=Math.floor(c.Q(this.bounds.getNorth())*r),d=Math.ceil(c.O(this.bounds.getEast())*r),_=Math.ceil(c.Q(this.bounds.getSouth())*r);return e.x>=a&&e.x<d&&e.y>=l&&e.y<_}}class In extends c.E{constructor(e,r,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(r,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ki(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,_)=>{e.reloadPromise={resolve:d,reject:_}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ht extends c.E{constructor(e,r,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},r),c.e(this,c.M(r,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ki(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ie.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,d=l.gl,_=a.data;e.texture=this.map.painter.getTileTexture(_.width),e.texture?e.texture.update(_,{useMipmap:!0}):(e.texture=new Be(l,_,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class li extends Ht{constructor(e,r,a,l){super(e,r,a,l),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield Ie.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const d=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const _=c.b(d)&&c.U()?d:yield this.readImageNow(d),w={type:this.type,uid:e.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const r=e.width+2,a=e.height+2;try{return new c.R({width:r,height:a},yield c.W(e,-1,-1,r,a))}catch{}}return B.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,a=Math.pow(2,r.z),l=(r.x-1+a)%a,d=r.x===0?e.wrap-1:e.wrap,_=(r.x+1+a)%a,w=r.x+1===a?e.wrap+1:e.wrap,S={};return S[new c.S(e.overscaledZ,d,r.z,l,r.y).key]={backfilled:!1},S[new c.S(e.overscaledZ,w,r.z,_,r.y).key]={backfilled:!1},r.y>0&&(S[new c.S(e.overscaledZ,d,r.z,l,r.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,w,r.z,_,r.y-1).key]={backfilled:!1}),r.y+1<a&&(S[new c.S(e.overscaledZ,d,r.z,l,r.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,w,r.z,_,r.y+1).key]={backfilled:!1}),S}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class sr extends c.E{constructor(e,r,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=r.data,this._options=c.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const d=c.X/this.tileSize;r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*d,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*d,extent:c.X,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:c.X,radius:(r.clusterRadius||50)*d,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const r=c.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(B.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&c.e(d,{resourceTiming:l}),this.fire(new c.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:r,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,r==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var _n=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Xn extends c.E{constructor(e,r,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=r}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ie.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new c.j(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(c.Z.fromLngLat);this.tileID=function(l){let d=1/0,_=1/0,w=-1/0,S=-1/0;for(const N of l)d=Math.min(d,N.x),_=Math.min(_,N.y),w=Math.max(w,N.x),S=Math.max(S,N.y);const k=Math.max(w-d,S-_),M=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),z=Math.pow(2,M);return new c.a1(M,Math.floor((d+w)/2*z),Math.floor((_+S)/2*z))}(r),this.minzoom=this.maxzoom=this.tileID.z;const a=r.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Be(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zr extends Xn{constructor(e,r,a,l){super(e,r,a,l),this.roundZoom=!0,this.type="video",this.options=r}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield c.a3(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new c.j(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new Be(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dn extends Xn{constructor(e,r,a,l){super(e,r,a,l),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(_=>typeof _!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Be(r,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const us={},Es=p=>{switch(p){case"geojson":return sr;case"image":return Xn;case"raster":return Ht;case"raster-dem":return li;case"vector":return In;case"video":return Zr;case"canvas":return dn}return us[p]},Je="RTLPluginLoaded";class mr extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(r,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=B.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Je))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let vn=null;function Pr(){return vn||(vn=new mr),vn}class Ir{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,d){const _={};if(!d)return _;for(const w of l){const S=w.layerIds.map(k=>d.getLayer(k)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(k=>S.filter(M=>M.id===k)[0]));for(const k of S)_[k.id]=w}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a6&&d.hasRTLText){this.hasRTLText=!0,Pr().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const d=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(l).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Be(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Be(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,l,d,_,w,S,k,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:w,queryPadding:this.queryPadding*k},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),d=r&&r.sourceLayer?r.sourceLayer:"",_=l._geojsonTileLayer||l[d];if(!_)return;const w=c.a7(r&&r.filter),{z:S,x:k,y:M}=this.tileID.canonical,z={z:S,x:k,y:M};for(let N=0;N<_.length;N++){const G=_.feature(N);if(w.needGeometry){const se=c.a8(G,!0);if(!w.filter(new c.z(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!w.filter(new c.z(this.tileID.overscaledZ),G))continue;const X=a.getId(G,d),Q=new c.a9(G,S,k,M,X);Q.tile=z,e.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(r)if(this.expirationTime<r)l=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!r.style.hasLayer(l))continue;const d=this.buckets[l],_=d.layers[0].sourceLayer||"_geojsonTileLayer",w=a[_],S=e[_];if(!w||!S||Object.keys(S).length===0)continue;d.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=r&&r.style&&r.style.getLayer(l);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=B.now()+e}setDependencies(e,r){const a={};for(const l of r)a[l]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const l=this.dependencies[a];if(l){for(const d of r)if(l[d])return!0}}return!1}}class tt{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,l=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][l];return this.data[a].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||r.push(l);for(const a of r)this.remove(a.value.tileID,a)}}class $t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const l=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},c.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==l&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const d in this.state[e][l])a[d]||(this.deletedStates[e][l][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][d]===null&&delete this.deletedStates[e][l][d]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const l=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),l=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const _ in d)delete l[_]}return l}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const d={};for(const _ in this.stateChanges[l])this.state[l][_]||(this.state[l][_]={}),c.e(this.state[l][_],this.stateChanges[l][_]),d[_]=this.state[l][_];a[l]=d}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const d={};if(this.deletedStates[l]===null)for(const _ in this.state[l])d[_]={},this.state[l][_]={};else for(const _ in this.deletedStates[l]){if(this.deletedStates[l][_]===null)this.state[l][_]={};else for(const w of Object.keys(this.deletedStates[l][_]))delete this.state[l][_][w];d[_]=this.state[l][_]}a[l]=a[l]||{},c.e(a[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,r)}}class Ft extends c.E{constructor(e,r,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,d,_,w)=>{const S=new(Es(d.type))(l,d,_,w);if(S.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${S.id}`);return S})(e,r,a,this),this._tiles={},this._cache=new tt(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new c.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Cn).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&r.push(this._tiles[a]);return e?r.sort((a,l)=>{const d=a.tileID,_=l.tileID,w=new c.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),S=new c.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||S.y-w.y||S.x-w.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(Cn).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,r){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),yield this._loadTile(a,e,r))})}_tileLoaded(e,r,a){e.timeAdded=B.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let l=0;l<r.length;l++){const d=r[l];if(e.neighboringTiles&&e.neighboringTiles[d]){const _=this.getTileByID(d);a(e,_),a(_,e)}}function a(l,d){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let _=d.tileID.canonical.x-l.tileID.canonical.x;const w=d.tileID.canonical.y-l.tileID.canonical.y,S=Math.pow(2,l.tileID.canonical.z),k=d.tileID.key;_===0&&w===0||Math.abs(w)>1||(Math.abs(_)>1&&(Math.abs(_+S)===1?_+=S:Math.abs(_-S)===1&&(_-=S)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,_,w),l.neighboringTiles&&l.neighboringTiles[k]&&(l.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,l){for(const d in this._tiles){let _=this._tiles[d];if(l[d]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>a)continue;let w=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const k=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[k.key],_&&_.hasData()&&(w=k)}let S=w;for(;S.overscaledZ>r;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){l[w.key]=w;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const l=e.scaledTo(a),d=this._getLoadedTile(l);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(r*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(d)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,r,a,l,d,_){const w={},S={},k=Object.keys(e),M=B.now();for(const z of k){const N=e[z],G=this._tiles[z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=M)continue;const X=this.findLoadedParent(N,r),Q=this.findLoadedSibling(N),se=X||Q||null;se&&(this._addTile(se.tileID),w[se.tileID.key]=se.tileID),S[z]=N}this._retainLoadedChildren(S,l,a,e);for(const z in w)e[z]||(this._coveredTiles[z]=!0,e[z]=w[z]);if(_){const z={},N={};for(const G of d)this._tiles[G.key].hasData()?z[G.key]=G:N[G.key]=G;for(const G in N){const X=N[G].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(z[X[0].key]=e[X[0].key]=X[0],z[X[1].key]=e[X[1].key]=X[1],z[X[2].key]=e[X[2].key]=X[2],z[X[3].key]=e[X[3].key]=X[3],delete N[G])}for(const G in N){const X=N[G],Q=this.findLoadedParent(X,this._source.minzoom),se=this.findLoadedSibling(X),ae=Q||se||null;if(ae){z[ae.tileID.key]=e[ae.tileID.key]=ae.tileID;for(const ce in z)z[ce].isChildOf(ae.tileID)&&delete z[ce]}}for(const G in this._tiles)z[G]||(this._coveredTiles[G]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const l=e.coveringZoomLevel(this._source),d=Math.max(l-Ft.maxOverzooming,this._source.minzoom),_=Math.max(l+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);M[N.key]=N;const G=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[G.key]=G}a=a.concat(Object.values(M))}const w=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,l);xn(this._source.type)&&this._updateCoveredAndRetainedTiles(S,d,_,l,a,r);for(const M in S)this._tiles[M].clearFadeHold();const k=c.ab(this._tiles,S);for(const M of k){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var a;const l={},d={},_=Math.max(r-Ft.maxOverzooming,this._source.minzoom),w=Math.max(r+Ft.maxUnderzooming,this._source.minzoom),S={};for(const k of e){const M=this._addTile(k);l[k.key]=k,M.hasData()||r<this._source.maxzoom&&(S[k.key]=k)}this._retainLoadedChildren(S,r,w,l);for(const k of e){let M=this._tiles[k.key];if(M.hasData())continue;if(r+1>this._source.maxzoom){const N=k.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){l[N.key]=N;continue}}else{const N=k.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let z=M.wasRequested();for(let N=k.overscaledZ-1;N>=_;--N){const G=k.scaledTo(N);if(d[G.key])break;if(d[G.key]=!0,M=this.getTile(G),!M&&z&&(M=this._addTile(G)),M){const X=M.hasData();if((X||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(l[G.key]=G),z=M.wasRequested(),X)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}r.push(l.key);const d=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;l=d}for(const d of r)this._loadedParentTiles[d]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,a=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=r;return r||(r=new Ir(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,a||this._source.fire(new c.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,a){const l=[],d=this.transform;if(!d)return l;const _=a?d.getCameraQueryGeometry(e):e,w=e.map(X=>d.pointCoordinate(X,this.terrain)),S=_.map(X=>d.pointCoordinate(X,this.terrain)),k=this.getIds();let M=1/0,z=1/0,N=-1/0,G=-1/0;for(const X of S)M=Math.min(M,X.x),z=Math.min(z,X.y),N=Math.max(N,X.x),G=Math.max(G,X.y);for(let X=0;X<k.length;X++){const Q=this._tiles[k[X]];if(Q.holdingForFade())continue;const se=Q.tileID,ae=Math.pow(2,d.zoom-Q.tileID.overscaledZ),ce=r*Q.queryPadding*c.X/Q.tileSize/ae,$=[se.getTilePoint(new c.Z(M,z)),se.getTilePoint(new c.Z(N,G))];if($[0].x-ce<c.X&&$[0].y-ce<c.X&&$[1].x+ce>=0&&$[1].y+ce>=0){const fe=w.map(Se=>se.getTilePoint(Se)),ge=S.map(Se=>se.getTilePoint(Se));l.push({tile:Q,tileID:se,queryGeometry:fe,cameraQueryGeometry:ge,scale:ae})}}return l}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(xn(this._source.type)){const e=B.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const l=this._tiles[e];l&&l.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}}function Cn(p,e){const r=Math.abs(2*p.wrap)-+(p.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||a-r||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function xn(p){return p==="raster"||p==="image"||p==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;class Nt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let r=1,a=this._distances[r];const l=e*this.paddedLength+this.padding;for(;a<l&&r<this._distances.length;)a=this._distances[++r];const d=r-1,_=this._distances[d],w=a-_,S=w>0?(l-_)/w:0;return this.points[d].mult(1-S).add(this.points[r].mult(S))}}function or(p,e){let r=!0;return p==="always"||p!=="never"&&e!=="never"||(r=!1),r}class Qr{constructor(e,r,a){const l=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(r/a);for(let _=0;_<this.xCellCount*this.yCellCount;_++)l.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,a,l,d){this._forEachCell(r,a,l,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}insertCircle(e,r,a,l){this._forEachCell(r-l,a-l,r+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,r,a,l,d,_){this.boxCells[d].push(_)}_insertCircleCell(e,r,a,l,d,_){this.circleCells[d].push(_)}_query(e,r,a,l,d,_,w){if(a<0||e>this.width||l<0||r>this.height)return[];const S=[];if(e<=0&&r<=0&&this.width<=a&&this.height<=l){if(d)return[{key:null,x1:e,y1:r,x2:a,y2:l}];for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const M=this.circles[3*k],z=this.circles[3*k+1],N=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:M-N,y1:z-N,x2:M+N,y2:z+N})}}else this._forEachCell(e,r,a,l,this._queryCell,S,{hitTest:d,overlapMode:_,seenUids:{box:{},circle:{}}},w);return S}query(e,r,a,l){return this._query(e,r,a,l,!1,null)}hitTest(e,r,a,l,d,_){return this._query(e,r,a,l,!0,d,_).length>0}hitTestCircle(e,r,a,l,d){const _=e-a,w=e+a,S=r-a,k=r+a;if(w<0||_>this.width||k<0||S>this.height)return!1;const M=[];return this._forEachCell(_,S,w,k,this._queryCellCircle,M,{hitTest:!0,overlapMode:l,circle:{x:e,y:r,radius:a},seenUids:{box:{},circle:{}}},d),M.length>0}_queryCell(e,r,a,l,d,_,w,S){const{seenUids:k,hitTest:M,overlapMode:z}=w,N=this.boxCells[d];if(N!==null){const X=this.bboxes;for(const Q of N)if(!k.box[Q]){k.box[Q]=!0;const se=4*Q,ae=this.boxKeys[Q];if(e<=X[se+2]&&r<=X[se+3]&&a>=X[se+0]&&l>=X[se+1]&&(!S||S(ae))&&(!M||!or(z,ae.overlapMode))&&(_.push({key:ae,x1:X[se],y1:X[se+1],x2:X[se+2],y2:X[se+3]}),M))return!0}}const G=this.circleCells[d];if(G!==null){const X=this.circles;for(const Q of G)if(!k.circle[Q]){k.circle[Q]=!0;const se=3*Q,ae=this.circleKeys[Q];if(this._circleAndRectCollide(X[se],X[se+1],X[se+2],e,r,a,l)&&(!S||S(ae))&&(!M||!or(z,ae.overlapMode))){const ce=X[se],$=X[se+1],fe=X[se+2];if(_.push({key:ae,x1:ce-fe,y1:$-fe,x2:ce+fe,y2:$+fe}),M)return!0}}}return!1}_queryCellCircle(e,r,a,l,d,_,w,S){const{circle:k,seenUids:M,overlapMode:z}=w,N=this.boxCells[d];if(N!==null){const X=this.bboxes;for(const Q of N)if(!M.box[Q]){M.box[Q]=!0;const se=4*Q,ae=this.boxKeys[Q];if(this._circleAndRectCollide(k.x,k.y,k.radius,X[se+0],X[se+1],X[se+2],X[se+3])&&(!S||S(ae))&&!or(z,ae.overlapMode))return _.push(!0),!0}}const G=this.circleCells[d];if(G!==null){const X=this.circles;for(const Q of G)if(!M.circle[Q]){M.circle[Q]=!0;const se=3*Q,ae=this.circleKeys[Q];if(this._circlesCollide(X[se],X[se+1],X[se+2],k.x,k.y,k.radius)&&(!S||S(ae))&&!or(z,ae.overlapMode))return _.push(!0),!0}}}_forEachCell(e,r,a,l,d,_,w,S){const k=this._convertToXCellCoord(e),M=this._convertToYCellCoord(r),z=this._convertToXCellCoord(a),N=this._convertToYCellCoord(l);for(let G=k;G<=z;G++)for(let X=M;X<=N;X++)if(d.call(this,e,r,a,l,this.xCellCount*X+G,_,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,a,l,d,_){const w=l-e,S=d-r,k=a+_;return k*k>w*w+S*S}_circleAndRectCollide(e,r,a,l,d,_,w){const S=(_-l)/2,k=Math.abs(e-(l+S));if(k>S+a)return!1;const M=(w-d)/2,z=Math.abs(r-(d+M));if(z>M+a)return!1;if(k<=S||z<=M)return!0;const N=k-S,G=z-M;return N*N+G*G<=a*a}}function hs(p,e,r,a,l){const d=c.H();return e?(c.K(d,d,[1/l,1/l,1]),r||c.ad(d,d,a.angle)):c.L(d,a.labelPlaneMatrix,p),d}function Gr(p,e,r,a,l){if(e){const d=c.ae(p);return c.K(d,d,[l,l,1]),r||c.ad(d,d,-a.angle),d}return a.glCoordMatrix}function ne(p,e,r,a){let l;a?(l=[p,e,a(p,e),1],c.af(l,l,r)):(l=[p,e,0,1],ci(l,l,r));const d=l[3];return{point:new c.P(l[0]/d,l[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function O(p,e){return .5+p/e*.5}function R(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function W(p,e,r,a,l,d,_,w,S,k,M,z,N,G,X){const Q=a?p.textSizeData:p.iconSizeData,se=c.ag(Q,r.transform.zoom),ae=[256/r.width*2+1,256/r.height*2+1],ce=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ce.clear();const $=p.lineVertexArray,fe=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,ge=r.transform.width/r.transform.height;let Se=!1;for(let Fe=0;Fe<fe.length;Fe++){const Ke=fe.get(Fe);if(Ke.hidden||Ke.writingMode===c.ah.vertical&&!Se){Dt(Ke.numGlyphs,ce);continue}Se=!1;const lt=ne(Ke.anchorX,Ke.anchorY,e,X);if(!R(lt.point,ae)){Dt(Ke.numGlyphs,ce);continue}const gt=O(r.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),rt=c.ai(Q,se,Ke),nt=_?rt/gt:rt*gt,wt={getElevation:X,labelPlaneMatrix:l,lineVertexArray:$,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:k,tileAnchorPoint:new c.P(Ke.anchorX,Ke.anchorY),unwrappedTileID:M,width:z,height:N,translation:G},Zt=me(wt,Ke,nt,!1,w,e,d,p.glyphOffsetArray,ce,ge,S);Se=Zt.useVertical,(Zt.notEnoughRoom||Se||Zt.needsFlipping&&me(wt,Ke,nt,!0,w,e,d,p.glyphOffsetArray,ce,ge,S).notEnoughRoom)&&Dt(Ke.numGlyphs,ce)}a?p.text.dynamicLayoutVertexBuffer.updateData(ce):p.icon.dynamicLayoutVertexBuffer.updateData(ce)}function Y(p,e,r,a,l,d,_,w){const S=d.glyphStartIndex+d.numGlyphs,k=d.lineStartIndex,M=d.lineStartIndex+d.lineLength,z=e.getoffsetX(d.glyphStartIndex),N=e.getoffsetX(S-1),G=it(p*z,r,a,l,d.segment,k,M,w,_);if(!G)return null;const X=it(p*N,r,a,l,d.segment,k,M,w,_);return X?w.projectionCache.anyProjectionOccluded?null:{first:G,last:X}:null}function de(p,e,r,a){return p===c.ah.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*a?{useVertical:!0}:(p===c.ah.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function me(p,e,r,a,l,d,_,w,S,k,M){const z=r/24,N=e.lineOffsetX*z,G=e.lineOffsetY*z;let X;if(e.numGlyphs>1){const Q=e.glyphStartIndex+e.numGlyphs,se=e.lineStartIndex,ae=e.lineStartIndex+e.lineLength,ce=Y(z,w,N,G,a,e,M,p);if(!ce)return{notEnoughRoom:!0};const $=ne(ce.first.point.x,ce.first.point.y,_,p.getElevation).point,fe=ne(ce.last.point.x,ce.last.point.y,_,p.getElevation).point;if(l&&!a){const ge=de(e.writingMode,$,fe,k);if(ge)return ge}X=[ce.first];for(let ge=e.glyphStartIndex+1;ge<Q-1;ge++)X.push(it(z*w.getoffsetX(ge),N,G,a,e.segment,se,ae,p,M));X.push(ce.last)}else{if(l&&!a){const se=ne(p.tileAnchorPoint.x,p.tileAnchorPoint.y,d,p.getElevation).point,ae=e.lineStartIndex+e.segment+1,ce=new c.P(p.lineVertexArray.getx(ae),p.lineVertexArray.gety(ae)),$=ne(ce.x,ce.y,d,p.getElevation),fe=$.signedDistanceFromCamera>0?$.point:function(Se,Fe,Ke,lt,gt,rt){return xe(Se,Fe,Ke,1,gt,rt)}(p.tileAnchorPoint,ce,se,0,d,p),ge=de(e.writingMode,se,fe,k);if(ge)return ge}const Q=it(z*w.getoffsetX(e.glyphStartIndex),N,G,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,p,M);if(!Q||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[Q]}for(const Q of X)c.aj(S,Q.point,Q.angle);return{}}function xe(p,e,r,a,l,d){const _=p.add(p.sub(e)._unit()),w=l!==void 0?ne(_.x,_.y,l,d.getElevation).point:Ee(_.x,_.y,d).point,S=r.sub(w);return r.add(S._mult(a/S.mag()))}function le(p,e,r){const a=e.projectionCache;if(a.projections[p])return a.projections[p];const l=new c.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=Ee(l.x,l.y,e);if(d.signedDistanceFromCamera>0)return a.projections[p]=d.point,a.anyProjectionOccluded=a.anyProjectionOccluded||d.isOccluded,d.point;const _=p-r.direction;return function(w,S,k,M,z){return xe(w,S,k,M,void 0,z)}(r.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),l,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Ee(p,e,r){const a=p+r.translation[0],l=e+r.translation[1];let d;return!r.pitchWithMap&&r.projection.useSpecialProjectionForSymbols?(d=r.projection.projectTileCoordinates(a,l,r.unwrappedTileID,r.getElevation),d.point.x=(.5*d.point.x+.5)*r.width,d.point.y=(.5*-d.point.y+.5)*r.height):(d=ne(a,l,r.labelPlaneMatrix,r.getElevation),d.isOccluded=!1),d}function Ne(p,e,r){return p._unit()._perp()._mult(e*r)}function Ce(p,e,r,a,l,d,_,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const k=r.add(e);if(p+S.direction<a||p+S.direction>=l)return w.projectionCache.offsets[p]=k,k;const M=le(p+S.direction,w,S),z=Ne(M.sub(r),_,S.direction),N=r.add(z),G=M.add(z);return w.projectionCache.offsets[p]=c.ak(d,k,N,G)||k,w.projectionCache.offsets[p]}function it(p,e,r,a,l,d,_,w,S){const k=a?p-e:p+e;let M=k>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let N,G=M>0?d+l:d+l+1;w.projectionCache.cachedAnchorPoint?N=w.projectionCache.cachedAnchorPoint:(N=Ee(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=N);let X,Q,se=N,ae=N,ce=0,$=0;const fe=Math.abs(k),ge=[];let Se;for(;ce+$<=fe;){if(G+=M,G<d||G>=_)return null;ce+=$,ae=se,Q=X;const lt={absOffsetX:fe,direction:M,distanceFromAnchor:ce,previousVertex:ae};if(se=le(G,w,lt),r===0)ge.push(ae),Se=se.sub(ae);else{let gt;const rt=se.sub(ae);gt=rt.mag()===0?Ne(le(G+M,w,lt).sub(se),r,M):Ne(rt,r,M),Q||(Q=ae.add(gt)),X=Ce(G,gt,se,d,_,Q,r,w,lt),ge.push(Q),Se=X.sub(Q)}$=Se.mag()}const Fe=Se._mult((fe-ce)/$)._add(Q||ae),Ke=z+Math.atan2(se.y-ae.y,se.x-ae.x);return ge.push(Fe),{point:Fe,angle:S?Ke:0,path:ge}}const kt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(p,e){for(let r=0;r<p;r++){const a=e.length;e.resize(a+4),e.float32.set(kt,3*a)}}function ci(p,e,r){const a=e[0],l=e[1];return p[0]=r[0]*a+r[4]*l+r[12],p[1]=r[1]*a+r[5]*l+r[13],p[3]=r[3]*a+r[7]*l+r[15],p}const Xt=100;class ui{constructor(e,r,a=new Qr(e.width+200,e.height+200,25),l=new Qr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=r,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Xt,this.screenBottomBoundary=e.height+Xt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,a,l,d,_,w,S,k,M,z){const N=e.anchorPointX+S[0],G=e.anchorPointY+S[1],X=this.projectAndGetPerspectiveRatio(l,N,G,d,M),Q=a*X.perspectiveRatio;let se;if(_||w)se=this._projectCollisionBox(e,Q,l,d,_,w,S,X,M,z);else{const ge=X.point.x+(z?z.x*Q:0),Se=X.point.y+(z?z.y*Q:0);se={allPointsOccluded:!1,box:[ge+e.x1*Q,Se+e.y1*Q,ge+e.x2*Q,Se+e.y2*Q]}}const[ae,ce,$,fe]=se.box;return this.mapProjection.useSpecialProjectionForSymbols&&(_?se.allPointsOccluded:this.mapProjection.isOccluded(N,G,d))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ae,ce,$,fe)||r!=="always"&&this.grid.hitTest(ae,ce,$,fe,r,k)?{box:[ae,ce,$,fe],placeable:!1,offscreen:!1}:{box:[ae,ce,$,fe],placeable:!0,offscreen:this.isOffscreen(ae,ce,$,fe)}}placeCollisionCircles(e,r,a,l,d,_,w,S,k,M,z,N,G,X,Q,se){const ae=[],ce=new c.P(r.anchorX,r.anchorY),$=this.getPerspectiveRatio(_,ce.x,ce.y,w,se),fe=(z?d/$:d*$)/c.ap,ge={getElevation:se,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:Q},Se=Y(fe,l,r.lineOffsetX*fe,r.lineOffsetY*fe,!1,r,!1,ge);let Fe=!1,Ke=!1,lt=!0;if(Se){const gt=.5*G*$+X,rt=new c.P(-100,-100),nt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new Nt,Zt=Se.first,st=Se.last;let dt=[];for(let Jt=Zt.path.length-1;Jt>=1;Jt--)dt.push(Zt.path[Jt]);for(let Jt=1;Jt<st.path.length;Jt++)dt.push(st.path[Jt]);const jt=2.5*gt;if(k){const Jt=this.projectPathToScreenSpace(dt,ge,k);dt=Jt.some(ni=>ni.signedDistanceFromCamera<=0)?[]:Jt.map(ni=>ni.point)}let Mi=[];if(dt.length>0){const Jt=dt[0].clone(),ni=dt[0].clone();for(let zi=1;zi<dt.length;zi++)Jt.x=Math.min(Jt.x,dt[zi].x),Jt.y=Math.min(Jt.y,dt[zi].y),ni.x=Math.max(ni.x,dt[zi].x),ni.y=Math.max(ni.y,dt[zi].y);Mi=Jt.x>=rt.x&&ni.x<=nt.x&&Jt.y>=rt.y&&ni.y<=nt.y?[dt]:ni.x<rt.x||Jt.x>nt.x||ni.y<rt.y||Jt.y>nt.y?[]:c.al([dt],rt.x,rt.y,nt.x,nt.y)}for(const Jt of Mi){wt.reset(Jt,.25*gt);let ni=0;ni=wt.length<=.5*gt?1:Math.ceil(wt.paddedLength/jt)+1;for(let zi=0;zi<ni;zi++){const kn=zi/Math.max(ni-1,1),zr=wt.lerp(kn),Di=zr.x+Xt,Jn=zr.y+Xt;ae.push(Di,Jn,gt,0);const Nn=Di-gt,En=Jn-gt,Vn=Di+gt,Kr=Jn+gt;if(lt=lt&&this.isOffscreen(Nn,En,Vn,Kr),Ke=Ke||this.isInsideGrid(Nn,En,Vn,Kr),e!=="always"&&this.grid.hitTestCircle(Di,Jn,gt,e,N)&&(Fe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!M&&Fe||!Ke||$<this.perspectiveRatioCutoff?[]:ae,offscreen:lt,collisionDetected:Fe}}projectPathToScreenSpace(e,r,a){return e.map(l=>ne(l.x,l.y,a,r.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let a=1/0,l=1/0,d=-1/0,_=-1/0;for(const M of e){const z=new c.P(M.x+Xt,M.y+Xt);a=Math.min(a,z.x),l=Math.min(l,z.y),d=Math.max(d,z.x),_=Math.max(_,z.y),r.push(z)}const w=this.grid.query(a,l,d,_).concat(this.ignoredGrid.query(a,l,d,_)),S={},k={};for(const M of w){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const N=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(r,N)&&(S[z.bucketInstanceId][z.featureIndex]=!0,k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]=[]),k[z.bucketInstanceId].push(z.featureIndex))}return k}insertCollisionBox(e,r,a,l,d,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:d,collisionGroupID:_,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,a,l,d,_){const w=a?this.ignoredGrid:this.grid,S={bucketInstanceId:l,featureIndex:d,collisionGroupID:_,overlapMode:r};for(let k=0;k<e.length;k+=4)w.insertCircle(S,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,r,a,l,d){let _;d?(_=[r,a,d(r,a),1],c.af(_,_,e)):(_=[r,a,0,1],ci(_,_,e));const w=_[3];return{point:new c.P((_[0]/w+1)/2*this.transform.width+Xt,(-_[1]/w+1)/2*this.transform.height+Xt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,r,a,l,d){const _=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(r,a,l,d):ne(r,a,e,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,r,a,l){return a<Xt||e>=this.screenRightBoundary||l<Xt||r>this.screenBottomBoundary}isInsideGrid(e,r,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,a,l,d,_,w,S,k,M){let z=new c.P(1,0),N=new c.P(0,1);const G=new c.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(_&&!d){const lt=this.projectAndGetPerspectiveRatio(a,G.x+1,G.y,l,k).point.sub(S.point).unit(),gt=Math.atan(lt.y/lt.x)+(lt.x<0?Math.PI:0),rt=Math.sin(gt),nt=Math.cos(gt);z=new c.P(nt,rt),N=new c.P(-rt,nt)}else if(!_&&d){const lt=-this.transform.angle,gt=Math.sin(lt),rt=Math.cos(lt);z=new c.P(rt,gt),N=new c.P(-gt,rt)}let X=S.point,Q=r;if(d){X=G;const lt=this.transform.zoom-Math.floor(this.transform.zoom);Q=Math.pow(2,-lt),Q*=this.mapProjection.getPitchedTextCorrection(this.transform,G,l),M||(Q*=c.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(X=X.add(z.mult(M.x*Q)).add(N.mult(M.y*Q)));const se=e.x1*Q,ae=e.x2*Q,ce=(se+ae)/2,$=e.y1*Q,fe=e.y2*Q,ge=($+fe)/2,Se=[{offsetX:se,offsetY:$},{offsetX:ce,offsetY:$},{offsetX:ae,offsetY:$},{offsetX:ae,offsetY:ge},{offsetX:ae,offsetY:fe},{offsetX:ce,offsetY:fe},{offsetX:se,offsetY:fe},{offsetX:se,offsetY:ge}];let Fe=[];for(const{offsetX:lt,offsetY:gt}of Se)Fe.push(new c.P(X.x+z.x*lt+N.x*gt,X.y+z.y*lt+N.y*gt));let Ke=!1;if(d){const lt=Fe.map(gt=>this.projectAndGetPerspectiveRatio(a,gt.x,gt.y,l,k));Ke=lt.some(gt=>!gt.isOccluded),Fe=lt.map(gt=>gt.point)}else Ke=!0;return{box:c.ao(Fe),allPointsOccluded:!Ke}}}function ii(p,e,r){return e*(c.X/(p.tileSize*Math.pow(2,r-p.tileID.overscaledZ)))}class on{constructor(e,r,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Zi{constructor(e,r,a,l,d){this.text=new on(e?e.text:null,r,a,d),this.icon=new on(e?e.icon:null,r,l,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qt{constructor(e,r,a){this.text=e,this.icon=r,this.skipFade=a}}class _i{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class Bi{constructor(e,r,a,l,d){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=d}}class pn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[e]}}function bn(p,e,r,a,l){const{horizontalAlign:d,verticalAlign:_}=c.au(p);return new c.P(-(d-.5)*e+a[0]*l,-(_-.5)*r+a[1]*l)}class Bn{constructor(e,r,a,l,d,_){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new ui(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new pn(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(a,l)=>r.getElevation(e,a,l):null}getBucketParts(e,r,a,l){const d=a.getBucket(r),_=a.latestFeatureIndex;if(!d||!_||r.id!==d.layerIds[0])return;const w=a.collisionBoxArray,S=d.layers[0].layout,k=d.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,N=a.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(N),X=S.get("text-pitch-alignment")==="map",Q=S.get("text-rotation-alignment")==="map",se=ii(a,1,this.transform.zoom),ae=this.collisionIndex.mapProjection.translatePosition(this.transform,a,k.get("text-translate"),k.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,a,k.get("icon-translate"),k.get("icon-translate-anchor")),$=hs(G,X,Q,this.transform,se);let fe=null;if(X){const Se=Gr(G,X,Q,this.transform,se);fe=c.L([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[d.bucketInstanceId]=new Bi(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,a.tileID);const ge={bucket:d,layout:S,translationText:ae,translationIcon:ce,posMatrix:G,unwrappedTileID:N,textLabelPlaneMatrix:$,labelToScreenMatrix:fe,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:c.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(l)for(const Se of d.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Ke,symbolInstanceEnd:lt}=Se;e.push({sortKey:Fe,symbolInstanceStart:Ke,symbolInstanceEnd:lt,parameters:ge})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(e,r,a,l,d,_,w,S,k,M,z,N,G,X,Q,se,ae,ce,$){const fe=c.aq[e.textAnchor],ge=[e.textOffset0,e.textOffset1],Se=bn(fe,a,l,ge,d),Fe=this.collisionIndex.placeCollisionBox(r,N,S,k,M,w,_,se,z.predicate,$,Se);if((!ce||this.collisionIndex.placeCollisionBox(ce,N,S,k,M,w,_,ae,z.predicate,$,Se).placeable)&&Fe.placeable){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ge,width:a,height:l,anchor:fe,textBoxScale:d,prevAnchor:Ke},this.markUsedJustification(X,fe,G,Q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,Q,G),this.placedOrientations[G.crossTileID]=Q),{shift:Se,placedGlyphBoxes:Fe}}}placeLayerBucketPart(e,r,a){const{bucket:l,layout:d,translationText:_,translationIcon:w,posMatrix:S,unwrappedTileID:k,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:N,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:Q,collisionGroup:se}=e.parameters,ae=d.get("text-optional"),ce=d.get("icon-optional"),$=c.ar(d,"text-overlap","text-allow-overlap"),fe=$==="always",ge=c.ar(d,"icon-overlap","icon-allow-overlap"),Se=ge==="always",Fe=d.get("text-rotation-alignment")==="map",Ke=d.get("text-pitch-alignment")==="map",lt=d.get("icon-text-fit")!=="none",gt=d.get("symbol-z-order")==="viewport-y",rt=fe&&(Se||!l.hasIconData()||ce),nt=Se&&(fe||!l.hasTextData()||ae);!l.collisionArrays&&X&&l.deserializeCollisionBoxes(X);const wt=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),Zt=(st,dt,jt)=>{var Mi,Jt;if(r[st.crossTileID])return;if(G)return void(this.placements[st.crossTileID]=new Qt(!1,!1,!1));let ni=!1,zi=!1,kn=!0,zr=null,Di={box:null,placeable:!1,offscreen:null},Jn={box:null,placeable:!1,offscreen:null},Nn=null,En=null,Vn=null,Kr=0,Io=0,Al=0;dt.textFeatureIndex?Kr=dt.textFeatureIndex:st.useRuntimeCollisionCircles&&(Kr=st.featureIndex),dt.verticalTextFeatureIndex&&(Io=dt.verticalTextFeatureIndex);const Co=dt.textBox;if(Co){const br=wn=>{let Mn=c.ah.horizontal;if(l.allowVerticalPlacement&&!wn&&this.prevPlacement){const dr=this.prevPlacement.placedOrientations[st.crossTileID];dr&&(this.placedOrientations[st.crossTileID]=dr,Mn=dr,this.markUsedOrientation(l,Mn,st))}return Mn},wr=(wn,Mn)=>{if(l.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const dr of l.writingModes)if(dr===c.ah.vertical?(Di=Mn(),Jn=Di):Di=wn(),Di&&Di.placeable)break}else Di=wn()},fs=st.textAnchorOffsetStartIndex,Dr=st.textAnchorOffsetEndIndex;if(Dr===fs){const wn=(Mn,dr)=>{const ai=this.collisionIndex.placeCollisionBox(Mn,$,N,S,k,Ke,Fe,_,se.predicate,wt);return ai&&ai.placeable&&(this.markUsedOrientation(l,dr,st),this.placedOrientations[st.crossTileID]=dr),ai};wr(()=>wn(Co,c.ah.horizontal),()=>{const Mn=dt.verticalTextBox;return l.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Mn?wn(Mn,c.ah.vertical):{box:null,offscreen:null}}),br(Di&&Di.placeable)}else{let wn=c.aq[(Jt=(Mi=this.prevPlacement)===null||Mi===void 0?void 0:Mi.variableOffsets[st.crossTileID])===null||Jt===void 0?void 0:Jt.anchor];const Mn=(ai,qs,Ao)=>{const ko=ai.x2-ai.x1,Af=ai.y2-ai.y1,Vy=st.textBoxScale,kf=lt&&ge==="never"?qs:null;let ms=null,Ef=$==="never"?1:2,El="never";wn&&Ef++;for(let Ca=0;Ca<Ef;Ca++){for(let Ml=fs;Ml<Dr;Ml++){const zl=l.textAnchorOffsets.get(Ml);if(wn&&zl.textAnchor!==wn)continue;const Eo=this.attemptAnchorPlacement(zl,ai,ko,Af,Vy,Fe,Ke,N,S,k,se,El,st,l,Ao,_,w,kf,wt);if(Eo&&(ms=Eo.placedGlyphBoxes,ms&&ms.placeable))return ni=!0,zr=Eo.shift,ms}wn?wn=null:El=$}return a&&!ms&&(ms={box:this.collisionIndex.placeCollisionBox(Co,"always",N,S,k,Ke,Fe,_,se.predicate,wt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),ms};wr(()=>Mn(Co,dt.iconBox,c.ah.horizontal),()=>{const ai=dt.verticalTextBox;return l.allowVerticalPlacement&&(!Di||!Di.placeable)&&st.numVerticalGlyphVertices>0&&ai?Mn(ai,dt.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Di&&(ni=Di.placeable,kn=Di.offscreen);const dr=br(Di&&Di.placeable);if(!ni&&this.prevPlacement){const ai=this.prevPlacement.variableOffsets[st.crossTileID];ai&&(this.variableOffsets[st.crossTileID]=ai,this.markUsedJustification(l,ai.anchor,st,dr))}}}if(Nn=Di,ni=Nn&&Nn.placeable,kn=Nn&&Nn.offscreen,st.useRuntimeCollisionCircles){const br=l.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),wr=c.ai(l.textSizeData,Q,br),fs=d.get("text-padding");En=this.collisionIndex.placeCollisionCircles($,br,l.lineVertexArray,l.glyphOffsetArray,wr,S,k,M,z,a,Ke,se.predicate,st.collisionCircleDiameter,fs,_,wt),En.circles.length&&En.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),ni=fe||En.circles.length>0&&!En.collisionDetected,kn=kn&&En.offscreen}if(dt.iconFeatureIndex&&(Al=dt.iconFeatureIndex),dt.iconBox){const br=wr=>this.collisionIndex.placeCollisionBox(wr,ge,N,S,k,Ke,Fe,w,se.predicate,wt,lt&&zr?zr:void 0);Jn&&Jn.placeable&&dt.verticalIconBox?(Vn=br(dt.verticalIconBox),zi=Vn.placeable):(Vn=br(dt.iconBox),zi=Vn.placeable),kn=kn&&Vn.offscreen}const xr=ae||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,kl=ce||st.numIconVertices===0;xr||kl?kl?xr||(zi=zi&&ni):ni=zi&&ni:zi=ni=zi&&ni;const Nu=zi&&Vn.placeable;if(ni&&Nn.placeable&&this.collisionIndex.insertCollisionBox(Nn.box,$,d.get("text-ignore-placement"),l.bucketInstanceId,Jn&&Jn.placeable&&Io?Io:Kr,se.ID),Nu&&this.collisionIndex.insertCollisionBox(Vn.box,ge,d.get("icon-ignore-placement"),l.bucketInstanceId,Al,se.ID),En&&ni&&this.collisionIndex.insertCollisionCircles(En.circles,$,d.get("text-ignore-placement"),l.bucketInstanceId,Kr,se.ID),a&&this.storeCollisionData(l.bucketInstanceId,jt,dt,Nn,Vn,En),st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new Qt(ni||rt,zi||nt,kn||l.justReloaded),r[st.crossTileID]=!0};if(gt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=l.getSortedSymbolIndexes(this.transform.angle);for(let dt=st.length-1;dt>=0;--dt){const jt=st[dt];Zt(l.symbolInstances.get(jt),l.collisionArrays[jt],jt)}}else for(let st=e.symbolInstanceStart;st<e.symbolInstanceEnd;st++)Zt(l.symbolInstances.get(st),l.collisionArrays[st],st);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[l.bucketInstanceId];c.as(st.invProjMatrix,S),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(e,r,a,l,d,_){if(a.textBox||a.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?S=w.get(r):(S={text:null,icon:null},w.set(r,S)),a.textBox&&(S.text=l.box),a.iconBox&&(S.icon=d.box)}if(_){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new _i);for(let S=0;S<_.circles.length;S+=4)w.circles.push(_.circles[S+0]),w.circles.push(_.circles[S+1]),w.circles.push(_.circles[S+2]),w.circles.push(_.collisionDetected?1:0)}}markUsedJustification(e,r,a,l){let d;d=l===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(r)];const _=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const w of _)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=d>=0&&w!==d?0:a.crossTileID)}markUsedOrientation(e,r,a){const l=r===c.ah.horizontal||r===c.ah.horizontalOnly?r:0,d=r===c.ah.vertical?r:0,_=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const w of _)e.text.placedSymbolArray.get(w).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const l=r?r.symbolFadeChange(e):1,d=r?r.opacities:{},_=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const S in this.placements){const k=this.placements[S],M=d[S];M?(this.opacities[S]=new Zi(M,l,k.text,k.icon),a=a||k.text!==M.text.placed||k.icon!==M.icon.placed):(this.opacities[S]=new Zi(null,l,k.text,k.icon,k.skipFade),a=a||k.text||k.icon)}for(const S in d){const k=d[S];if(!this.opacities[S]){const M=new Zi(k,l,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||k.text.placed||k.icon.placed)}}for(const S in _)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=_[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const a={};for(const l of r){const d=l.getBucket(e);d&&l.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,r,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],_=d.layout,w=new Zi(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),k=_.get("icon-allow-overlap"),M=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=_.get("text-rotation-alignment")==="map",N=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",X=new Zi(null,0,S&&(k||!e.hasIconData()||_.get("icon-optional")),k&&(S||!e.hasTextData()||_.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const Q=(ae,ce,$)=>{for(let fe=0;fe<ce/4;fe++)ae.opacityVertexArray.emplaceBack($);ae.hasVisibleVertices=ae.hasVisibleVertices||$!==ro},se=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ae=0;ae<e.symbolInstances.length;ae++){const ce=e.symbolInstances.get(ae),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:fe,crossTileID:ge}=ce;let Se=this.opacities[ge];a[ge]?Se=w:Se||(Se=X,this.opacities[ge]=Se),a[ge]=!0;const Fe=ce.numIconVertices>0,Ke=this.placedOrientations[ce.crossTileID],lt=Ke===c.ah.vertical,gt=Ke===c.ah.horizontal||Ke===c.ah.horizontalOnly;if($>0||fe>0){const nt=cr(Se.text);Q(e.text,$,lt?ro:nt),Q(e.text,fe,gt?ro:nt);const wt=Se.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(e.text.placedSymbolArray.get(dt).hidden=wt||lt?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=wt||gt?1:0);const Zt=this.variableOffsets[ce.crossTileID];Zt&&this.markUsedJustification(e,Zt.anchor,ce,Ke);const st=this.placedOrientations[ce.crossTileID];st&&(this.markUsedJustification(e,"left",ce,st),this.markUsedOrientation(e,st,ce))}if(Fe){const nt=cr(Se.icon),wt=!(G&&ce.verticalPlacedIconSymbolIndex&&lt);ce.placedIconSymbolIndex>=0&&(Q(e.icon,ce.numIconVertices,wt?nt:ro),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=Se.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,ce.numVerticalIconVertices,wt?ro:nt),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}const rt=se&&se.has(ae)?se.get(ae):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const nt=e.collisionArrays[ae];if(nt){let wt=new c.P(0,0);if(nt.textBox||nt.verticalTextBox){let Zt=!0;if(M){const st=this.variableOffsets[ge];st?(wt=bn(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),z&&wt._rotate(N?this.transform.angle:-this.transform.angle)):Zt=!1}if(nt.textBox||nt.verticalTextBox){let st;nt.textBox&&(st=lt),nt.verticalTextBox&&(st=gt),no(e.textCollisionBox.collisionVertexArray,Se.text.placed,!Zt||st,rt.text,wt.x,wt.y)}}if(nt.iconBox||nt.verticalIconBox){const Zt=!!(!gt&&nt.verticalIconBox);let st;nt.iconBox&&(st=Zt),nt.verticalIconBox&&(st=!Zt),no(e.iconCollisionBox.collisionVertexArray,Se.icon.placed,st,rt.icon,G?wt.x:0,G?wt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ae.invProjMatrix,e.placementViewportMatrix=ae.viewportMatrix,e.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function no(p,e,r,a,l,d){a&&a.length!==0||(a=[0,0,0,0]);const _=a[0]-Xt,w=a[1]-Xt,S=a[2]-Xt,k=a[3]-Xt;p.emplaceBack(e?1:0,r?1:0,l||0,d||0,_,w),p.emplaceBack(e?1:0,r?1:0,l||0,d||0,S,w),p.emplaceBack(e?1:0,r?1:0,l||0,d||0,S,k),p.emplaceBack(e?1:0,r?1:0,l||0,d||0,_,k)}const vi=Math.pow(2,25),$c=Math.pow(2,24),Jc=Math.pow(2,17),ar=Math.pow(2,16),lr=Math.pow(2,9),fy=Math.pow(2,8),gr=Math.pow(2,1);function cr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,r=Math.floor(127*p.opacity);return r*vi+e*$c+r*Jc+e*ar+r*lr+e*fy+r*gr+e}const ro=0;function Ms(){return{isOccluded:(p,e,r)=>!1,getPitchedTextCorrection:(p,e,r)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,e,r,a){throw new Error("Not implemented.")},translatePosition:(p,e,r,a)=>function(l,d,_,w,S=!1){if(!_[0]&&!_[1])return[0,0];const k=S?w==="map"?l.angle:0:w==="viewport"?-l.angle:0;if(k){const M=Math.sin(k),z=Math.cos(k);_=[_[0]*z-_[1]*M,_[0]*M+_[1]*z]}return[S?_[0]:ii(d,_[0],l.zoom),S?_[1]:ii(d,_[1],l.zoom)]}(p,e,r,a),getCircleRadiusCorrection:p=>1}}class an{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,a,l,d){const _=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(_,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<_.length;)if(r.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class ca{constructor(e,r,a,l,d,_,w,S){this.placement=new Bn(e,Ms(),r,_,w,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,r,a){const l=B.now(),d=()=>!this._forceFullPlacement&&B.now()-l>2;for(;this._currentPlacementIndex>=0;){const _=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=w)&&(!_.maxzoom||_.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new an(_)),this._inProgressLayer.continuePlacement(a[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Cr=512/c.X/2;class en{constructor(e,r,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let d=0;d<r.length;d++){const _=r.get(d),w=_.key,S=l.get(w);S?S.push(_):l.set(w,[_])}for(const[d,_]of l){const w={positions:_.map(S=>({x:Math.floor(S.anchorX*Cr),y:Math.floor(S.anchorY*Cr)})),crossTileIDs:_.map(S=>S.crossTileID)};if(w.positions.length>128){const S=new c.av(w.positions.length,16,Uint16Array);for(const{x:k,y:M}of w.positions)S.add(k,M);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[d]=w}}getScaledCoordinates(e,r){const{x:a,y:l,z:d}=this.tileID.canonical,{x:_,y:w,z:S}=r.canonical,k=Cr/Math.pow(2,S-d),M=(w*c.X+e.anchorY)*k,z=l*c.X*Cr;return{x:Math.floor((_*c.X+e.anchorX)*k-a*c.X*Cr),y:Math.floor(M-z)}}findMatches(e,r,a){const l=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let d=0;d<e.length;d++){const _=e.get(d);if(_.crossTileID)continue;const w=this._symbolsByKey[_.key];if(!w)continue;const S=this.getScaledCoordinates(_,r);if(w.index){const k=w.index.range(S.x-l,S.y-l,S.x+l,S.y+l).sort();for(const M of k){const z=w.crossTileIDs[M];if(!a[z]){a[z]=!0,_.crossTileID=z;break}}}else if(w.positions)for(let k=0;k<w.positions.length;k++){const M=w.positions[k],z=w.crossTileIDs[k];if(Math.abs(M.x-S.x)<=l&&Math.abs(M.y-S.y)<=l&&!a[z]){a[z]=!0,_.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ar{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const a in this.indexes){const l=this.indexes[a],d={};for(const _ in l){const w=l[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),d[w.tileID.key]=w}this.indexes[a]=d}this.lng=e}addBucket(e,r,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<r.symbolInstances.length;d++)r.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>e.overscaledZ)for(const w in _){const S=_[w];S.tileID.isChildOf(e)&&S.findMatches(r.symbolInstances,e,l)}else{const w=_[e.scaledTo(Number(d)).key];w&&w.findMatches(r.symbolInstances,e,l)}}for(let d=0;d<r.symbolInstances.length;d++){const _=r.symbolInstances.get(d);_.crossTileID||(_.crossTileID=a.generate(),l[_.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new en(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const a of r.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let r=!1;for(const a in this.indexes){const l=this.indexes[a];for(const d in l)e[l[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[d]),delete l[d],r=!0)}return r}}class Yc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new Ar);let d=!1;const _={};l.handleWrapJump(a);for(const w of r){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(w.tileID,S,this.crossTileIDs)&&(d=!0),_[S.bucketInstanceId]=!0)}return l.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(e){const r={};e.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}const kr=(p,e)=>c.t(p,e&&e.filter(r=>r.identifier!=="source.canvas")),my=c.aw();class Ya extends c.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Xi(Fn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new pt(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new yi(256,512),this.crossTileSymbolIndex=new Yc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),Pr().on(Je,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const d=l.getSource();if(d&&d.vectorLayerIds)for(const _ in this._layers){const w=this._layers[_];w.source===d.id&&this._validateLayer(w)}})}loadURL(e,r={},a){this.fire(new c.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;c.h(l,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,r,a)}).catch(_=>{this._loadStyleRequest=null,_&&!d.signal.aborted&&this.fire(new c.j(_))})}loadJSON(e,r={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(my,{validate:!1})}_load(e,r,a){var l;const d=r.transformStyle?r.transformStyle(a,e):e;if(!r.validate||!kr(this,c.u(d))){this._loaded=!0,this.stylesheet=d;for(const _ in d.sources)this.addSource(_,d.sources[_],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new at(this.stylesheet.light),this.sky=new Yt(this.stylesheet.sky),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const a=c.aA(r);a.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=a}}_loadSprite(e,r=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,_,w,S){return c._(this,void 0,void 0,function*(){const k=He(d),M=w>1?"@2x":"",z={},N={};for(const{id:G,url:X}of k){const Q=_.transformRequest(Ye(X,M,".json"),"SpriteJSON");z[G]=c.h(Q,S);const se=_.transformRequest(Ye(X,M,".png"),"SpriteImage");N[G]=Ie.getImage(se,S)}return yield Promise.all([...Object.values(z),...Object.values(N)]),function(G,X){return c._(this,void 0,void 0,function*(){const Q={};for(const se in G){Q[se]={};const ae=B.getImageCanvasContext((yield X[se]).data),ce=(yield G[se]).data;for(const $ in ce){const{width:fe,height:ge,x:Se,y:Fe,sdf:Ke,pixelRatio:lt,stretchX:gt,stretchY:rt,content:nt,textFitWidth:wt,textFitHeight:Zt}=ce[$];Q[se][$]={data:null,pixelRatio:lt,sdf:Ke,stretchX:gt,stretchY:rt,content:nt,textFitWidth:wt,textFitHeight:Zt,spriteData:{width:fe,height:ge,x:Se,y:Fe,context:ae}}}}return Q})}(z,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const _ in d){this._spritesImagesIds[_]=[];const w=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(S=>!(S in d)):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in d[_]){const k=_==="default"?S:`${_}:${S}`;this._spritesImagesIds[_].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,d[_][S],!1):this.imageManager.addImage(k,d[_][S]),r&&(this._changedImages[k]=!0)}}}).catch(d=>{this._spriteRequest=null,l=d,this.fire(new c.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const a=e.sourceLayer;if(!a)return;const l=r.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?c.aB(a):a);const l=[];for(const d of e)if(a[d]){const _=r?c.aB(a[d]):a[d];l.push(_)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const a of r){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const l=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(l.length||d.length)&&this._updateWorkerLayers(l,d);for(const _ in this._updatedSources){const w=this._updatedSources[_];if(w==="reload")this._reloadSource(_);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const d=this.sourceCaches[l];a[l]=d.used,d.used=!1}for(const l of this._order){const d=this._layers[l];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const l in a){const d=this.sourceCaches[l];!!a[l]!=!!d.used&&d.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,r&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var a;this._checkLoaded();const l=this.serialize();if(e=r.transformStyle?r.transformStyle(l,e):e,((a=r.validate)===null||a===void 0||a)&&kr(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const d=c.aC(l,e),_=this._getOperationsToPerform(d);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const w of _.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":r.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":r.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,l.args));break;case"setSky":r.push(()=>this.setSky.apply(this,l.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":r.push(()=>{});break;default:a.push(l.command)}return{operations:r,unimplemented:a}}addImage(e,r){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(c.u.source,`sources.${e}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const l=this.sourceCaches[e]=new Ft(e,r,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new c.j(new Error(`Layer "${l}" already exists on this map.`)));let d;if(e.type==="custom"){if(kr(this,c.aD(e)))return;d=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=c.aB(e),e=c.e(e,{source:l})),this._validate(c.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;d=c.aA(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:l}})}const _=r?this._order.indexOf(r):this._order.length;if(r&&_===-1)this.fire(new c.j(new Error(`Cannot add layer "${l}" before non-existing layer "${r}".`)));else{if(this._order.splice(_,0,l),this._layerOrderChanged=!0,this._layers[l]=d,this._removedLayers[l]&&d.source&&d.type!=="custom"){const w=this._removedLayers[l];delete this._removedLayers[l],w.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=r?this._order.indexOf(r):this._order.length;r&&l===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===r&&l.maxzoom===a||(r!=null&&(l.minzoom=r),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!c.aE(l.filter,r))return r==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(c.u.filter,`layers.${l.id}.filter`,r,null,a)||(l.filter=c.aB(r),this._updateLayer(l)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,r,a,l={}){this._checkLoaded();const d=this.getLayer(e);d?c.aE(d.getLayoutProperty(r),a)||(d.setLayoutProperty(r,a,l),this._updateLayer(d)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const a=this.getLayer(e);if(a)return a.getLayoutProperty(r);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,a,l={}){this._checkLoaded();const d=this.getLayer(e);d?c.aE(d.getPaintProperty(r),a)||(d.setPaintProperty(r,a,l)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const a=e.source,l=e.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const _=d.getSource().type;_==="geojson"&&l?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||l?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(l,e.id,r)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=l.getSource().type,_=d==="vector"?e.sourceLayer:void 0;d!=="vector"||_?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(_,e.id,r):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,a=e.sourceLayer,l=this.sourceCaches[r];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,d=>d.serialize()),r=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return c.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:r,terrain:a},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=_=>this._layers[_].type==="fill-extrusion",a={},l=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(r(w)){a[w]=_;for(const S of e){const k=S[w];if(k)for(const M of k)l.push(M)}}}l.sort((_,w)=>w.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(r(w))for(let S=l.length-1;S>=0;S--){const k=l[S].feature;if(a[k.layer.id]<_)break;d.push(k),l.pop()}else for(const S of e){const k=S[w];if(k)for(const M of k)d.push(M.feature)}}return d}queryRenderedFeatures(e,r,a){r&&r.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",r.filter,null,r);const l={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const w of r.layers){const S=this._layers[w];if(!S)return this.fire(new c.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];l[S.source]=!0}}const d=[];r.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const w in this.sourceCaches)r.layers&&!l[w]||d.push(Ki(this.sourceCaches[w],this._layers,_,e,r,a));return this.placement&&d.push(function(w,S,k,M,z,N,G){const X={},Q=N.queryRenderedSymbols(M),se=[];for(const ae of Object.keys(Q).map(Number))se.push(G[ae]);se.sort(mt);for(const ae of se){const ce=ae.featureIndex.lookupSymbolFeatures(Q[ae.bucketInstanceId],S,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const $ in ce){const fe=X[$]=X[$]||[],ge=ce[$];ge.sort((Se,Fe)=>{const Ke=ae.featureSortOrder;if(Ke){const lt=Ke.indexOf(Se.featureIndex);return Ke.indexOf(Fe.featureIndex)-lt}return Fe.featureIndex-Se.featureIndex});for(const Se of ge)fe.push(Se)}}for(const ae in X)X[ae].forEach(ce=>{const $=ce.feature,fe=k[w[ae].source].getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=fe});return X}(this._layers,_,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,r){r&&r.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",r.filter,null,r);const a=this.sourceCaches[e];return a?function(l,d){const _=l.getRenderableIds().map(k=>l.getTileByID(k)),w=[],S={};for(let k=0;k<_.length;k++){const M=_[k],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(w,d))}return w}(a,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const _ in e)if(!c.aE(e[_],a[_])){l=!0;break}if(!l)return;const d={now:B.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(d)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const _ in e)if(!c.aE(e[_],a[_])){l=!0;break}if(!l)return;const d={now:B.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(d)}_validate(e,r,a,l,d={}){return(!d||d.validate!==!1)&&kr(this,e.call(c.u,c.e({key:r,style:this.serialize(),value:a,styleSpec:c.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Pr().off(Je,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const a=this.sourceCaches[r];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,a,l,d=!1){let _=!1,w=!1;const S={};for(const k of this._order){const M=this._layers[k];if(M.type!=="symbol")continue;if(!S[M.source]){const N=this.sourceCaches[M.source];S[M.source]=N.getRenderableIds(!0).map(G=>N.getTileByID(G)).sort((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);_=_||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(B.now(),e.zoom))&&(this.pauseablePlacement=new ca(e,this.map.terrain,this._order,d,r,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(B.now()),w=!0),_&&this.pauseablePlacement.placement.setStale()),w||_)for(const k of this._order){const M=this._layers[k];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(B.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[r.source];return l&&l.setDependencies(r.tileID.key,r.type,r.icons),a})}getGlyphs(e,r){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(r.stacks),l=this.sourceCaches[r.source];return l&&l.setDependencies(r.tileID.key,r.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,a={},l){this._checkLoaded();const d=[{id:e,url:r}],_=[...He(this.stylesheet.sprite),...d];this._validate(c.u.sprite,"sprite",_,null,a)||(this.stylesheet.sprite=_,this._loadSprite(d,!0,l))}removeSprite(e){this._checkLoaded();const r=He(this.stylesheet.sprite);if(r.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;r.splice(r.findIndex(a=>a.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(e,r={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var zs=c.Y([{name:"a_pos",type:"Int16",components:2}]);const ds={prelude:mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:mi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mi(p,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),l=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=d?d.concat(l):l,w={};return{fragmentSource:p=p.replace(r,(S,k,M,z,N)=>(w[N]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${M} ${z} ${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(r,(S,k,M,z,N)=>{const G=z==="float"?"vec2":"vec4",X=N.match(/color/)?"color":G;return w[N]?k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${M} ${G} a_${N};
varying ${M} ${z} ${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${M} ${G} a_${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = a_${N};
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${M} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:a,staticUniforms:_}}class Qc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,a,l,d,_,w,S,k){this.context=e;let M=this.boundPaintVertexBuffers.length!==l.length;for(let z=0;!M&&z<l.length;z++)this.boundPaintVertexBuffers[z]!==l[z]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==d||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==k?this.freshBind(r,a,l,d,_,w,S,k):(e.bindVertexArray.set(this.vao),w&&w.bind(),d&&d.dynamicDraw&&d.bind(),S&&S.bind(),k&&k.bind())}freshBind(e,r,a,l,d,_,w,S){const k=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,r.enableAttributes(z,e);for(const N of a)N.enableAttributes(z,e);_&&_.enableAttributes(z,e),w&&w.enableAttributes(z,e),S&&S.enableAttributes(z,e),r.bind(),r.setVertexAttribPointers(z,e,d);for(const N of a)N.bind(),N.setVertexAttribPointers(z,e,d);_&&(_.bind(),_.setVertexAttribPointers(z,e,d)),l&&l.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,e,d)),S&&(S.bind(),S.setVertexAttribPointers(z,e,d)),M.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const eu=(p,e,r,a,l)=>({u_matrix:p,u_texture:0,u_ele_delta:e,u_fog_matrix:r,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function so(p){const e=[];for(let r=0;r<p.length;r++){if(p[r]===null)continue;const a=p[r].split(" ");e.push(a.pop())}return e}class tu{constructor(e,r,a,l,d,_){const w=e.gl;this.program=w.createProgram();const S=so(r.staticAttributes),k=a?a.getBinderAttributes():[],M=S.concat(k),z=ds.prelude.staticUniforms?so(ds.prelude.staticUniforms):[],N=r.staticUniforms?so(r.staticUniforms):[],G=a?a.getBinderUniforms():[],X=z.concat(N).concat(G),Q=[];for(const Se of X)Q.indexOf(Se)<0&&Q.push(Se);const se=a?a.defines():[];d&&se.push("#define OVERDRAW_INSPECTOR;"),_&&se.push("#define TERRAIN3D;");const ae=se.concat(ds.prelude.fragmentSource,r.fragmentSource).join(`
`),ce=se.concat(ds.prelude.vertexSource,r.vertexSource).join(`
`),$=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource($,ae),w.compileShader($),!w.getShaderParameter($,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog($)}`);w.attachShader(this.program,$);const fe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(fe,ce),w.compileShader(fe),!w.getShaderParameter(fe,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(fe)}`);w.attachShader(this.program,fe),this.attributes={};const ge={};this.numAttributes=M.length;for(let Se=0;Se<this.numAttributes;Se++)M[Se]&&(w.bindAttribLocation(this.program,Se,M[Se]),this.attributes[M[Se]]=Se);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(fe),w.deleteShader($);for(let Se=0;Se<Q.length;Se++){const Fe=Q[Se];if(Fe&&!ge[Fe]){const Ke=w.getUniformLocation(this.program,Fe);Ke&&(ge[Fe]=Ke)}}this.fixedUniforms=l(e,ge),this.terrainUniforms=((Se,Fe)=>({u_depth:new c.aH(Se,Fe.u_depth),u_terrain:new c.aH(Se,Fe.u_terrain),u_terrain_dim:new c.aI(Se,Fe.u_terrain_dim),u_terrain_matrix:new c.aJ(Se,Fe.u_terrain_matrix),u_terrain_unpack:new c.aK(Se,Fe.u_terrain_unpack),u_terrain_exaggeration:new c.aI(Se,Fe.u_terrain_exaggeration)}))(e,ge),this.binderUniforms=a?a.getUniforms(e,ge):[]}draw(e,r,a,l,d,_,w,S,k,M,z,N,G,X,Q,se,ae,ce){const $=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(d),e.setCullFace(_),S){e.activeTexture.set($.TEXTURE2),$.bindTexture($.TEXTURE_2D,S.depthTexture),e.activeTexture.set($.TEXTURE3),$.bindTexture($.TEXTURE_2D,S.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(S[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(w[ge]);Q&&Q.setUniforms(e,this.binderUniforms,G,{zoom:X});let fe=0;switch(r){case $.LINES:fe=2;break;case $.TRIANGLES:fe=3;break;case $.LINE_STRIP:fe=1}for(const ge of N.get()){const Se=ge.vaos||(ge.vaos={});(Se[k]||(Se[k]=new Qc)).bind(e,this,M,Q?Q.getPaintVertexBuffers():[],z,ge.vertexOffset,se,ae,ce),$.drawElements(r,ge.primitiveLength*fe,$.UNSIGNED_SHORT,ge.primitiveOffset*fe*2)}}}function Qa(p,e,r){const a=1/ii(r,1,e.transform.tileZoom),l=Math.pow(2,r.tileID.overscaledZ),d=r.tileSize*Math.pow(2,e.transform.tileZoom)/l,_=d*(r.tileID.canonical.x+r.tileID.wrap*l),w=d*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[a,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w]}}const ua=(p,e,r,a)=>{const l=e.style.light,d=l.properties.get("position"),_=[d.x,d.y,d.z],w=function(){var k=new c.A(9);return c.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();l.properties.get("anchor")==="viewport"&&function(k,M){var z=Math.sin(M),N=Math.cos(M);k[0]=N,k[1]=z,k[2]=0,k[3]=-z,k[4]=N,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(w,-e.transform.angle),function(k,M,z){var N=M[0],G=M[1],X=M[2];k[0]=N*z[0]+G*z[3]+X*z[6],k[1]=N*z[1]+G*z[4]+X*z[7],k[2]=N*z[2]+G*z[5]+X*z[8]}(_,_,w);const S=l.properties.get("color");return{u_matrix:p,u_lightpos:_,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+r,u_opacity:a}},el=(p,e,r,a,l,d,_)=>c.e(ua(p,e,r,a),Qa(d,e,_),{u_height_factor:-Math.pow(2,l.overscaledZ)/_.tileSize/8}),oo=p=>({u_matrix:p}),Xp=(p,e,r,a)=>c.e(oo(p),Qa(r,e,a)),gy=(p,e)=>({u_matrix:p,u_world:e}),Kp=(p,e,r,a,l)=>c.e(Xp(p,e,r,a),{u_world:l}),yy=(p,e,r,a)=>{const l=p.transform;let d,_;if(a.paint.get("circle-pitch-alignment")==="map"){const w=ii(r,1,l.zoom);d=!0,_=[w,w]}else d=!1,_=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(e.posMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:_}},Ds=(p,e,r)=>({u_matrix:p,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}),ha=(p,e,r=1)=>({u_matrix:p,u_color:e,u_overlay:0,u_overlay_scale:r}),Kn=p=>({u_matrix:p}),$n=(p,e,r,a)=>({u_matrix:p,u_extrude_scale:ii(e,1,r),u_intensity:a}),tl=(p,e,r,a)=>{const l=c.H();c.aP(l,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:l,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:r,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function il(p,e){const r=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/r).toLngLat().lat,new c.Z(0,(a+1)/r).toLngLat().lat]}const nl=(p,e,r,a)=>{const l=p.transform;return{u_matrix:Yp(p,e,r,a),u_ratio:1/ii(e,1,l.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},$p=(p,e,r,a,l)=>c.e(nl(p,e,r,l),{u_image:0,u_image_height:a}),ao=(p,e,r,a,l)=>{const d=p.transform,_=Jp(e,d);return{u_matrix:Yp(p,e,r,l),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ii(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[_,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},_y=(p,e,r,a,l,d)=>{const _=p.lineAtlas,w=Jp(e,p.transform),S=r.layout.get("line-cap")==="round",k=_.getDash(a.from,S),M=_.getDash(a.to,S),z=k.width*l.fromScale,N=M.width*l.toScale;return c.e(nl(p,e,r,d),{u_patternscale_a:[w/z,-k.height/2],u_patternscale_b:[w/N,-M.height/2],u_sdfgamma:_.width/(256*Math.min(z,N)*p.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:M.y,u_mix:l.t})};function Jp(p,e){return 1/ii(p,1,e.tileZoom)}function Yp(p,e,r,a){return p.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const vy=(p,e,r,a,l)=>{return{u_matrix:p,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(_=l.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=l.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:xy(l.paint.get("raster-hue-rotate"))};var d,_};function xy(p){p*=Math.PI/180;const e=Math.sin(p),r=Math.cos(p);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const Qp=(p,e,r,a,l,d,_,w,S,k,M,z,N,G)=>{const X=_.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:X.width/X.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:d,u_texsize:N,u_texture:0,u_translation:M,u_pitched_scale:G}},da=(p,e,r,a,l,d,_,w,S,k,M,z,N,G,X)=>{const Q=_.transform;return c.e(Qp(p,e,r,a,l,d,_,w,S,k,M,z,N,X),{u_gamma_scale:a?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+G})},iu=(p,e,r,a,l,d,_,w,S,k,M,z,N,G)=>c.e(da(p,e,r,a,l,d,_,w,S,k,M,!0,z,!0,G),{u_texsize_icon:N,u_texture_icon:1}),rl=(p,e,r)=>({u_matrix:p,u_opacity:e,u_color:r}),nu=(p,e,r,a,l,d)=>c.e(function(_,w,S,k){const M=S.imageManager.getPattern(_.from.toString()),z=S.imageManager.getPattern(_.to.toString()),{width:N,height:G}=S.imageManager.getPixelSize(),X=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,S.transform.tileZoom)/X,se=Q*(k.tileID.canonical.x+k.tileID.wrap*X),ae=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,G],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ii(k,1,S.transform.tileZoom),u_pixel_coord_upper:[se>>16,ae>>16],u_pixel_coord_lower:[65535&se,65535&ae]}}(a,d,r,l),{u_matrix:p,u_opacity:e}),ru={fillExtrusion:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_lightpos:new c.aN(p,e.u_lightpos),u_lightintensity:new c.aI(p,e.u_lightintensity),u_lightcolor:new c.aN(p,e.u_lightcolor),u_vertical_gradient:new c.aI(p,e.u_vertical_gradient),u_opacity:new c.aI(p,e.u_opacity)}),fillExtrusionPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_lightpos:new c.aN(p,e.u_lightpos),u_lightintensity:new c.aI(p,e.u_lightintensity),u_lightcolor:new c.aN(p,e.u_lightcolor),u_vertical_gradient:new c.aI(p,e.u_vertical_gradient),u_height_factor:new c.aI(p,e.u_height_factor),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade),u_opacity:new c.aI(p,e.u_opacity)}),fill:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix)}),fillPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),fillOutline:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world)}),fillOutlinePattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),circle:(p,e)=>({u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(p,e.u_scale_with_map),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_extrude_scale:new c.aO(p,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_matrix:new c.aJ(p,e.u_matrix)}),collisionBox:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_pixel_extrude_scale:new c.aO(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_inv_matrix:new c.aJ(p,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_viewport_size:new c.aO(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new c.aL(p,e.u_color),u_matrix:new c.aJ(p,e.u_matrix),u_overlay:new c.aH(p,e.u_overlay),u_overlay_scale:new c.aI(p,e.u_overlay_scale)}),clippingMask:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix)}),heatmap:(p,e)=>({u_extrude_scale:new c.aI(p,e.u_extrude_scale),u_intensity:new c.aI(p,e.u_intensity),u_matrix:new c.aJ(p,e.u_matrix)}),heatmapTexture:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world),u_image:new c.aH(p,e.u_image),u_color_ramp:new c.aH(p,e.u_color_ramp),u_opacity:new c.aI(p,e.u_opacity)}),hillshade:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_latrange:new c.aO(p,e.u_latrange),u_light:new c.aO(p,e.u_light),u_shadow:new c.aL(p,e.u_shadow),u_highlight:new c.aL(p,e.u_highlight),u_accent:new c.aL(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_dimension:new c.aO(p,e.u_dimension),u_zoom:new c.aI(p,e.u_zoom),u_unpack:new c.aK(p,e.u_unpack)}),line:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_image:new c.aH(p,e.u_image),u_image_height:new c.aI(p,e.u_image_height)}),linePattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texsize:new c.aO(p,e.u_texsize),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_image:new c.aH(p,e.u_image),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),lineSDF:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_patternscale_a:new c.aO(p,e.u_patternscale_a),u_patternscale_b:new c.aO(p,e.u_patternscale_b),u_sdfgamma:new c.aI(p,e.u_sdfgamma),u_image:new c.aH(p,e.u_image),u_tex_y_a:new c.aI(p,e.u_tex_y_a),u_tex_y_b:new c.aI(p,e.u_tex_y_b),u_mix:new c.aI(p,e.u_mix)}),raster:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_tl_parent:new c.aO(p,e.u_tl_parent),u_scale_parent:new c.aI(p,e.u_scale_parent),u_buffer_scale:new c.aI(p,e.u_buffer_scale),u_fade_t:new c.aI(p,e.u_fade_t),u_opacity:new c.aI(p,e.u_opacity),u_image0:new c.aH(p,e.u_image0),u_image1:new c.aH(p,e.u_image1),u_brightness_low:new c.aI(p,e.u_brightness_low),u_brightness_high:new c.aI(p,e.u_brightness_high),u_saturation_factor:new c.aI(p,e.u_saturation_factor),u_contrast_factor:new c.aI(p,e.u_contrast_factor),u_spin_weights:new c.aN(p,e.u_spin_weights)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texture:new c.aH(p,e.u_texture),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texture:new c.aH(p,e.u_texture),u_gamma_scale:new c.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_is_halo:new c.aH(p,e.u_is_halo),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texsize_icon:new c.aO(p,e.u_texsize_icon),u_texture:new c.aH(p,e.u_texture),u_texture_icon:new c.aH(p,e.u_texture_icon),u_gamma_scale:new c.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_is_halo:new c.aH(p,e.u_is_halo),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),background:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_opacity:new c.aI(p,e.u_opacity),u_color:new c.aL(p,e.u_color)}),backgroundPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_opacity:new c.aI(p,e.u_opacity),u_image:new c.aH(p,e.u_image),u_pattern_tl_a:new c.aO(p,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(p,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(p,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(p,e.u_pattern_br_b),u_texsize:new c.aO(p,e.u_texsize),u_mix:new c.aI(p,e.u_mix),u_pattern_size_a:new c.aO(p,e.u_pattern_size_a),u_pattern_size_b:new c.aO(p,e.u_pattern_size_b),u_scale_a:new c.aI(p,e.u_scale_a),u_scale_b:new c.aI(p,e.u_scale_b),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texture:new c.aH(p,e.u_texture),u_ele_delta:new c.aI(p,e.u_ele_delta),u_fog_matrix:new c.aJ(p,e.u_fog_matrix),u_fog_color:new c.aL(p,e.u_fog_color),u_fog_ground_blend:new c.aI(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(p,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(p,e.u_horizon_color),u_horizon_fog_blend:new c.aI(p,e.u_horizon_fog_blend)}),terrainDepth:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ele_delta:new c.aI(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texture:new c.aH(p,e.u_texture),u_terrain_coords_id:new c.aI(p,e.u_terrain_coords_id),u_ele_delta:new c.aI(p,e.u_ele_delta)}),sky:(p,e)=>({u_sky_color:new c.aL(p,e.u_sky_color),u_horizon_color:new c.aL(p,e.u_horizon_color),u_horizon:new c.aI(p,e.u_horizon),u_sky_horizon_blend:new c.aI(p,e.u_sky_horizon_blend)})};class Wr{constructor(e,r,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const by={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class su{constructor(e,r,a,l){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=l,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let a=0;a<this.attributes.length;a++){const l=r.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,r,a){for(let l=0;l<this.attributes.length;l++){const d=this.attributes[l],_=r.attributes[d.name];_!==void 0&&e.vertexAttribPointer(_,d.components,e[by[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls=new WeakMap;function ps(p){var e;if(Ls.has(p))return Ls.get(p);{const r=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ls.set(p,r),r}}class gi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class sl extends gi{getDefault(){return c.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wy extends gi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class lo extends gi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sy extends gi{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ef extends gi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ty extends gi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class tf extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ou extends gi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class nf extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class rf extends gi{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class sf extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class of extends gi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Rs extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class af extends gi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Py extends gi{getDefault(){return c.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class lf extends gi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class pa extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Iy extends gi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ol extends gi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Cy extends gi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Ay extends gi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class cf extends gi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class uf extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class hf extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class au extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class df extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class al extends gi{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class es extends gi{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const a=this.gl;ps(a)?a.bindVertexArray(e):(r=a.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class lu extends gi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class cu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class uu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ll extends gi{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class hu extends ll{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Os extends ll{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class du extends ll{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ky{constructor(e,r,a,l,d){this.context=e,this.width=r,this.height=a;const _=e.gl,w=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new hu(e,w),l)this.depthAttachment=d?new du(e,w):new Os(e,w);else if(d)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class $i{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}$i.Replace=[1,0],$i.disabled=new $i($i.Replace,c.aM.transparent,[!1,!1,!1,!1]),$i.unblended=new $i($i.Replace,c.aM.transparent,[!0,!0,!0,!0]),$i.alphaBlended=new $i([1,771],c.aM.transparent,[!0,!0,!0,!0]);class Ey{constructor(e){var r,a;if(this.gl=e,this.clearColor=new sl(this),this.clearDepth=new wy(this),this.clearStencil=new lo(this),this.colorMask=new Sy(this),this.depthMask=new ef(this),this.stencilMask=new Ty(this),this.stencilFunc=new tf(this),this.stencilOp=new ou(this),this.stencilTest=new nf(this),this.depthRange=new rf(this),this.depthTest=new sf(this),this.depthFunc=new of(this),this.blend=new Rs(this),this.blendFunc=new af(this),this.blendColor=new Py(this),this.blendEquation=new lf(this),this.cullFace=new pa(this),this.cullFaceSide=new Iy(this),this.frontFace=new ol(this),this.program=new Cy(this),this.activeTexture=new Ay(this),this.viewport=new cf(this),this.bindFramebuffer=new uf(this),this.bindRenderbuffer=new hf(this),this.bindTexture=new au(this),this.bindVertexBuffer=new df(this),this.bindElementBuffer=new al(this),this.bindVertexArray=new es(this),this.pixelStoreUnpack=new lu(this),this.pixelStoreUnpackPremultiplyAlpha=new cu(this),this.pixelStoreUnpackFlipY=new uu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ps(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Wr(this,e,r)}createVertexBuffer(e,r,a){return new su(this,e,r,a)}createRenderbuffer(e,r,a){const l=this.gl,d=l.createRenderbuffer();return this.bindRenderbuffer.set(d),l.renderbufferStorage(l.RENDERBUFFER,e,r,a),this.bindRenderbuffer.set(null),d}createFramebuffer(e,r,a,l){return new ky(this,e,r,a,l)}clear({color:e,depth:r,stencil:a}){const l=this.gl;let d=0;e&&(d|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(d|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),a!==void 0&&(d|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,$i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ps(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return ps(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ei{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const cl=7680;class Ci{constructor(e,r,a,l,d,_){this.test=e,this.ref=r,this.mask=a,this.fail=l,this.depthFail=d,this.pass=_}}Ci.disabled=new Ci({func:519,mask:0},0,0,cl,cl,cl);class bi{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}let Fs;function fa(p,e,r,a,l){const d=p.context,_=d.gl,w=p.useProgram("collisionBox"),S=[];let k=0,M=0;for(let ae=0;ae<a.length;ae++){const ce=a[ae],$=e.getTile(ce).getBucket(r);if(!$)continue;const fe=l?$.textCollisionBox:$.iconCollisionBox,ge=$.collisionCircleArray;if(ge.length>0){const Se=c.H();c.aQ(Se,$.placementInvProjMatrix,p.transform.glCoordMatrix),c.aQ(Se,Se,$.placementViewportMatrix),S.push({circleArray:ge,circleOffset:M,transform:ce.posMatrix,invTransform:Se,coord:ce}),k+=ge.length/4,M=k}fe&&w.draw(d,_.LINES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(z=p.transform).width,1/z.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),r.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,p.transform.zoom,null,null,fe.collisionVertexBuffer)}var z;if(!l||!S.length)return;const N=p.useProgram("collisionCircle"),G=new c.aR;G.resize(4*k),G._trim();let X=0;for(const ae of S)for(let ce=0;ce<ae.circleArray.length/4;ce++){const $=4*ce,fe=ae.circleArray[$+0],ge=ae.circleArray[$+1],Se=ae.circleArray[$+2],Fe=ae.circleArray[$+3];G.emplace(X++,fe,ge,Se,Fe,0),G.emplace(X++,fe,ge,Se,Fe,1),G.emplace(X++,fe,ge,Se,Fe,2),G.emplace(X++,fe,ge,Se,Fe,3)}(!Fs||Fs.length<2*k)&&(Fs=function(ae){const ce=2*ae,$=new c.aT;$.resize(ce),$._trim();for(let fe=0;fe<ce;fe++){const ge=6*fe;$.uint16[ge+0]=4*fe+0,$.uint16[ge+1]=4*fe+1,$.uint16[ge+2]=4*fe+2,$.uint16[ge+3]=4*fe+2,$.uint16[ge+4]=4*fe+3,$.uint16[ge+5]=4*fe+0}return $}(k));const Q=d.createIndexBuffer(Fs,!0),se=d.createVertexBuffer(G,c.aS.members,!0);for(const ae of S){const ce=Ds(ae.transform,ae.invTransform,p.transform);N.draw(d,_.TRIANGLES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,ce,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae.coord),r.id,se,Q,c.a0.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,p.transform.zoom,null,null,null)}se.destroy(),Q.destroy()}bi.disabled=new bi(!1,1029,2305),bi.backCCW=new bi(!0,1029,2305);const ma=c.an(new Float32Array(16));function pu(p,e,r,a,l,d){const{horizontalAlign:_,verticalAlign:w}=c.au(p);return new c.P((-(_-.5)*e/l+a[0])*d,(-(w-.5)*r/l+a[1])*d)}function Bs(p,e,r,a,l,d){const _=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=a.mult(d);r||(w=w.rotate(-l));const S=_.add(w);return ne(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(r){const w=Ee(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(a.rotate(S))}return p.add(a)}function co(p,e,r,a,l,d,_,w,S,k,M,z,N,G){const X=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,se=p.icon.dynamicLayoutVertexArray,ae={};Q.clear();for(let ce=0;ce<X.length;ce++){const $=X.get(ce),fe=$.hidden||!$.crossTileID||p.allowVerticalPlacement&&!$.placedOrientation?null:a[$.crossTileID];if(fe){const ge=new c.P($.anchorX,$.anchorY),Se={getElevation:G,width:l.width,height:l.height,labelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:r,projection:M,projectionCache:null,tileAnchorPoint:ge,translation:z,unwrappedTileID:N},Fe=r?ne(ge.x,ge.y,_,G):Ee(ge.x,ge.y,Se),Ke=O(l.cameraToCenterDistance,Fe.signedDistanceFromCamera);let lt=c.ai(p.textSizeData,S,$)*Ke/c.ap;r&&(lt*=p.tilePixelRatio/w);const{width:gt,height:rt,anchor:nt,textOffset:wt,textBoxScale:Zt}=fe,st=pu(nt,gt,rt,wt,Zt,lt),dt=M.getPitchedTextCorrection(l,ge.add(new c.P(z[0],z[1])),N),jt=Bs(Fe.point,Se,e,st,l.angle,dt),Mi=p.allowVerticalPlacement&&$.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Jt=0;Jt<$.numGlyphs;Jt++)c.aj(Q,jt,Mi);k&&$.associatedIconIndex>=0&&(ae[$.associatedIconIndex]={shiftedAnchor:jt,angle:Mi})}else Dt($.numGlyphs,Q)}if(k){se.clear();const ce=p.icon.placedSymbolArray;for(let $=0;$<ce.length;$++){const fe=ce.get($);if(fe.hidden)Dt(fe.numGlyphs,se);else{const ge=ae[$];if(ge)for(let Se=0;Se<fe.numGlyphs;Se++)c.aj(se,ge.shiftedAnchor,ge.angle);else Dt(fe.numGlyphs,se)}}p.icon.dynamicLayoutVertexBuffer.updateData(se)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function yr(p,e,r){return r.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function fu(p,e,r,a,l,d,_,w,S,k,M,z){const N=p.context,G=N.gl,X=p.transform,Q=Ms(),se=w==="map",ae=S==="map",ce=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",$=se&&!ae&&!ce,fe=!ae&&ce,ge=!r.layout.get("symbol-sort-key").isConstant();let Se=!1;const Fe=p.depthModeForSublayer(0,ei.ReadOnly),Ke=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],gt=Q.getCircleRadiusCorrection(X);for(const rt of a){const nt=e.getTile(rt),wt=nt.getBucket(r);if(!wt)continue;const Zt=l?wt.text:wt.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const st=Zt.programConfigurations.get(r.id),dt=l||wt.sdfIcons,jt=l?wt.textSizeData:wt.iconSizeData,Mi=ae||X.pitch!==0,Jt=p.useProgram(yr(dt,l,wt),st),ni=c.ag(jt,X.zoom),zi=p.style.map.terrain&&p.style.map.terrain.getTerrainData(rt);let kn,zr,Di,Jn,Nn=[0,0],En=null;if(l)zr=nt.glyphAtlasTexture,Di=G.LINEAR,kn=nt.glyphAtlasTexture.size,wt.iconsInText&&(Nn=nt.imageAtlasTexture.size,En=nt.imageAtlasTexture,Jn=Mi||p.options.rotating||p.options.zooming||jt.kind==="composite"||jt.kind==="camera"?G.LINEAR:G.NEAREST);else{const ai=r.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;zr=nt.imageAtlasTexture,Di=dt||p.options.rotating||p.options.zooming||ai||Mi?G.LINEAR:G.NEAREST,kn=nt.imageAtlasTexture.size}const Vn=ii(nt,1,p.transform.zoom),Kr=fe?rt.posMatrix:ma,Io=hs(Kr,ae,se,p.transform,Vn),Al=Gr(Kr,ae,se,p.transform,Vn),Co=Gr(rt.posMatrix,ae,se,p.transform,Vn),xr=Q.translatePosition(p.transform,nt,d,_),kl=Ke&&wt.hasTextData(),Nu=r.layout.get("icon-text-fit")!=="none"&&kl&&wt.hasIconData();if(ce){const ai=p.style.map.terrain?(Ao,ko)=>p.style.map.terrain.getElevation(rt,Ao,ko):null,qs=r.layout.get("text-rotation-alignment")==="map";W(wt,rt.posMatrix,p,l,Io,Co,ae,k,qs,Q,rt.toUnwrapped(),X.width,X.height,xr,ai)}const br=rt.posMatrix,wr=l&&Ke||Nu,fs=ce||wr?ma:Io,Dr=Al,wn=dt&&r.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mn;Mn=dt?wt.iconsInText?iu(jt.kind,ni,$,ae,ce,wr,p,br,fs,Dr,xr,kn,Nn,gt):da(jt.kind,ni,$,ae,ce,wr,p,br,fs,Dr,xr,l,kn,!0,gt):Qp(jt.kind,ni,$,ae,ce,wr,p,br,fs,Dr,xr,l,kn,gt);const dr={program:Jt,buffers:Zt,uniformValues:Mn,atlasTexture:zr,atlasTextureIcon:En,atlasInterpolation:Di,atlasInterpolationIcon:Jn,isSDF:dt,hasHalo:wn};if(ge&&wt.canOverlap){Se=!0;const ai=Zt.segments.get();for(const qs of ai)lt.push({segments:new c.a0([qs]),sortKey:qs.sortKey,state:dr,terrainData:zi})}else lt.push({segments:Zt.segments,sortKey:0,state:dr,terrainData:zi})}Se&&lt.sort((rt,nt)=>rt.sortKey-nt.sortKey);for(const rt of lt){const nt=rt.state;if(N.activeTexture.set(G.TEXTURE0),nt.atlasTexture.bind(nt.atlasInterpolation,G.CLAMP_TO_EDGE),nt.atlasTextureIcon&&(N.activeTexture.set(G.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),nt.isSDF){const wt=nt.uniformValues;nt.hasHalo&&(wt.u_is_halo=1,mu(nt.buffers,rt.segments,r,p,nt.program,Fe,M,z,wt,rt.terrainData)),wt.u_is_halo=0}mu(nt.buffers,rt.segments,r,p,nt.program,Fe,M,z,nt.uniformValues,rt.terrainData)}}function mu(p,e,r,a,l,d,_,w,S,k){const M=a.context;l.draw(M,M.gl.TRIANGLES,d,_,w,bi.disabled,S,k,r.id,p.layoutVertexBuffer,p.indexBuffer,e,r.paint,a.transform.zoom,p.programConfigurations.get(r.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function gu(p,e,r,a){const l=p.context,d=l.gl,_=Ci.disabled,w=new $i([d.ONE,d.ONE],c.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(r);if(!S)return;const k=a.key;let M=r.heatmapFbos.get(k);M||(M=ga(l,e.tileSize,e.tileSize),r.heatmapFbos.set(k,M)),l.bindFramebuffer.set(M.framebuffer),l.viewport.set([0,0,e.tileSize,e.tileSize]),l.clear({color:c.aM.transparent});const z=S.programConfigurations.get(r.id),N=p.useProgram("heatmap",z),G=p.style.map.terrain.getTerrainData(a);N.draw(l,d.TRIANGLES,ei.disabled,_,w,bi.disabled,$n(a.posMatrix,e,p.transform.zoom,r.paint.get("heatmap-intensity")),G,r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,p.transform.zoom,z)}function Ns(p,e,r){const a=p.context,l=a.gl;a.setColorMode(p.colorModeForRenderPass());const d=ya(a,e),_=r.key,w=e.heatmapFbos.get(_);w&&(a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,w.colorAttachment.get()),a.activeTexture.set(l.TEXTURE1),d.bind(l.LINEAR,l.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(a,l.TRIANGLES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,tl(p,e,0,1),null,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,p.transform.zoom),w.destroy(),e.heatmapFbos.delete(_))}function ga(p,e,r){var a,l;const d=p.gl,_=d.createTexture();d.bindTexture(d.TEXTURE_2D,_),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const w=(a=p.HALF_FLOAT)!==null&&a!==void 0?a:d.UNSIGNED_BYTE,S=(l=p.RGBA16F)!==null&&l!==void 0?l:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,S,e,r,0,d.RGBA,w,null);const k=p.createFramebuffer(e,r,!1,!1);return k.colorAttachment.set(_),k}function ya(p,e){return e.colorRampTexture||(e.colorRampTexture=new Be(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function uo(p,e,r,a,l){if(!r||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let _=d[r.to.toString()],w=d[r.from.toString()];if(!_&&w&&(_=w),!w&&_&&(w=_),!_||!w){const S=l.getPaintProperty(e);_=d[S],w=d[S]}_&&w&&p.setConstantPatternPositions(_,w)}function _a(p,e,r,a,l,d,_){const w=p.context.gl,S="fill-pattern",k=r.paint.get(S),M=k&&k.constantOr(1),z=r.getCrossfadeParameters();let N,G,X,Q,se;_?(G=M&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=w.LINES):(G=M?"fillPattern":"fill",N=w.TRIANGLES);const ae=k.constantOr(null);for(const ce of a){const $=e.getTile(ce);if(M&&!$.patternsLoaded())continue;const fe=$.getBucket(r);if(!fe)continue;const ge=fe.programConfigurations.get(r.id),Se=p.useProgram(G,ge),Fe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce);M&&(p.context.activeTexture.set(w.TEXTURE0),$.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ge.updatePaintBuffers(z)),uo(ge,S,ae,$,r);const Ke=Fe?ce:null,lt=p.translatePosMatrix(Ke?Ke.posMatrix:ce.posMatrix,$,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(_){Q=fe.indexBuffer2,se=fe.segments2;const gt=[w.drawingBufferWidth,w.drawingBufferHeight];X=G==="fillOutlinePattern"&&M?Kp(lt,p,z,$,gt):gy(lt,gt)}else Q=fe.indexBuffer,se=fe.segments,X=M?Xp(lt,p,z,$):oo(lt);Se.draw(p.context,N,l,p.stencilModeForClipping(ce),d,bi.disabled,X,Fe,r.id,fe.layoutVertexBuffer,Q,se,r.paint,p.transform.zoom,ge)}}function ul(p,e,r,a,l,d,_){const w=p.context,S=w.gl,k="fill-extrusion-pattern",M=r.paint.get(k),z=M.constantOr(1),N=r.getCrossfadeParameters(),G=r.paint.get("fill-extrusion-opacity"),X=M.constantOr(null);for(const Q of a){const se=e.getTile(Q),ae=se.getBucket(r);if(!ae)continue;const ce=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),$=ae.programConfigurations.get(r.id),fe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",$);z&&(p.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),$.updatePaintBuffers(N)),uo($,k,X,se,r);const ge=p.translatePosMatrix(Q.posMatrix,se,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Se=r.paint.get("fill-extrusion-vertical-gradient"),Fe=z?el(ge,p,Se,G,Q,N,se):ua(ge,p,Se,G);fe.draw(w,w.gl.TRIANGLES,l,d,_,bi.backCCW,Fe,ce,r.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,r.paint,p.transform.zoom,$,p.style.map.terrain&&ae.centroidVertexBuffer)}}function ho(p,e,r,a,l,d,_){const w=p.context,S=w.gl,k=r.fbo;if(!k)return;const M=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(e);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),M.draw(w,S.TRIANGLES,l,d,_,bi.disabled,((N,G,X,Q)=>{const se=X.paint.get("hillshade-shadow-color"),ae=X.paint.get("hillshade-highlight-color"),ce=X.paint.get("hillshade-accent-color");let $=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&($-=N.transform.angle);const fe=!N.options.moving;return{u_matrix:Q?Q.posMatrix:N.transform.calculatePosMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:il(0,G.tileID),u_light:[X.paint.get("hillshade-exaggeration"),$],u_shadow:se,u_highlight:ae,u_accent:ce}})(p,r,a,z?e:null),z,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function po(p,e,r,a,l,d){const _=p.context,w=_.gl,S=e.dem;if(S&&S.data){const k=S.dim,M=S.stride,z=S.getPixels();if(_.activeTexture.set(w.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||p.getTileTexture(M),e.demTexture){const G=e.demTexture;G.update(z,{premultiply:!1}),G.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new Be(_,z,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);_.activeTexture.set(w.TEXTURE0);let N=e.fbo;if(!N){const G=new Be(_,{width:k,height:k,data:null},w.RGBA);G.bind(w.LINEAR,w.CLAMP_TO_EDGE),N=e.fbo=_.createFramebuffer(k,k,!0,!1),N.colorAttachment.set(G.texture)}_.bindFramebuffer.set(N.framebuffer),_.viewport.set([0,0,k,k]),p.useProgram("hillshadePrepare").draw(_,w.TRIANGLES,a,l,d,bi.disabled,((G,X)=>{const Q=X.stride,se=c.H();return c.aP(se,0,c.X,-c.X,0,0,1),c.J(se,se,[0,-c.X,0]),{u_matrix:se,u_image:1,u_dimension:[Q,Q],u_zoom:G.overscaledZ,u_unpack:X.getUnpackVector()}})(e.tileID,S),null,r.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function pf(p,e,r,a,l,d){const _=a.paint.get("raster-fade-duration");if(!d&&_>0){const w=B.now(),S=(w-p.timeAdded)/_,k=e?(w-e.timeAdded)/_:-1,M=r.getSource(),z=l.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),G=N&&p.refreshedUponExpiration?1:c.ac(N?S:1-k,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const yu=new c.aM(1,0,0,1),di=new c.aM(0,1,0,1),hl=new c.aM(0,0,1,1),My=new c.aM(1,0,1,1),ff=new c.aM(0,1,1,1);function fo(p,e,r,a){dl(p,0,e+r/2,p.transform.width,r,a)}function mf(p,e,r,a){dl(p,e-r/2,0,r,p.transform.height,a)}function dl(p,e,r,a,l,d){const _=p.context,w=_.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,r*p.pixelRatio,a*p.pixelRatio,l*p.pixelRatio),_.clear({color:d}),w.disable(w.SCISSOR_TEST)}function gf(p,e,r){const a=p.context,l=a.gl,d=r.posMatrix,_=p.useProgram("debug"),w=ei.disabled,S=Ci.disabled,k=p.colorModeForRenderPass(),M="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(r);a.activeTexture.set(l.TEXTURE0);const N=e.getTileByID(r.key).latestRawTileData,G=Math.floor((N&&N.byteLength||0)/1024),X=e.getTile(r).tileSize,Q=512/Math.min(X,512)*(r.overscaledZ/p.transform.zoom)*.5;let se=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(se+=` => ${r.overscaledZ}`),function(ae,ce){ae.initDebugOverlayCanvas();const $=ae.debugOverlayCanvas,fe=ae.context.gl,ge=ae.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,$.width,$.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ce,5,5),ge.strokeText(ce,5,5),ae.debugOverlayTexture.update($),ae.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(p,`${se} ${G}kB`),_.draw(a,l.TRIANGLES,w,S,$i.alphaBlended,bi.disabled,ha(d,c.aM.transparent,Q),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),_.draw(a,l.LINE_STRIP,w,S,k,bi.disabled,ha(d,c.aM.red),z,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function yf(p,e,r){const a=p.context,l=a.gl,d=p.colorModeForRenderPass(),_=new ei(l.LEQUAL,ei.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,p.width,p.height]);for(const k of r){const M=p.renderToTexture.getTexture(k),z=e.getTerrainData(k.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,M.texture);const N=p.transform.calculatePosMatrix(k.tileID.toUnwrapped()),G=e.getMeshFrameDelta(p.transform.zoom),X=p.transform.calculateFogMatrix(k.tileID.toUnwrapped()),Q=eu(N,G,X,p.style.sky,p.transform.pitch);w.draw(a,l.TRIANGLES,_,Ci.disabled,d,bi.backCCW,Q,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class pl{constructor(e,r,a){this.vertexBuffer=e,this.indexBuffer=r,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class fl{constructor(e,r){this.context=new Ey(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yc}resize(e,r,a){if(this.width=Math.floor(e*a),this.height=Math.floor(r*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,r=new c.aX;r.emplaceBack(0,0),r.emplaceBack(c.X,0),r.emplaceBack(0,c.X),r.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(r,zs.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,zs.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const l=new c.$;l.emplaceBack(0,0,0,0),l.emplaceBack(c.X,0,c.X,0),l.emplaceBack(0,c.X,0,c.X),l.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,_n.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const d=new c.aX;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(d,zs.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const _=new c.aZ;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(_);const w=new c.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const S=this.context.gl;this.stencilClearMode=new Ci({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,ei.disabled,this.stencilClearMode,$i.disabled,bi.disabled,Kn(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source;const a=this.context,l=a.gl;this.nextStencilID+r.length>256&&this.clearStencil(),a.setColorMode($i.disabled),a.setDepthMode(ei.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of r){const w=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);d.draw(a,l.TRIANGLES,ei.disabled,new Ci({func:l.ALWAYS,mask:0},w,255,l.KEEP,l.KEEP,l.REPLACE),$i.disabled,bi.disabled,Kn(_.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Ci({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(e){const r=this.context.gl,a=e.sort((_,w)=>w.overscaledZ-_.overscaledZ),l=a[a.length-1].overscaledZ,d=a[0].overscaledZ-l+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let w=0;w<d;w++)_[w+l]=new Ci({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=d,[_,a]}return[{[l]:Ci.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new $i([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$i.unblended:$i.alphaBlended}depthModeForSublayer(e,r,a){if(!this.opaquePassEnabledForLayer())return ei.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ei(a||this.context.gl.LEQUAL,r,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(B.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,d={},_={},w={};for(const S in l){const k=l[S];k.used&&k.prepare(this.context),d[S]=k.getVisibleCoordinates(),_[S]=d[S].slice().reverse(),w[S]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const k=this.style._layers[S];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const M=_[k.source];(k.type==="custom"||M.length)&&this.renderLayer(this,l[k.source],k,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,k){const M=S.context,z=M.gl,N=((ae,ce,$)=>({u_sky_color:ae.properties.get("sky-color"),u_horizon_color:ae.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*$,u_sky_horizon_blend:ae.properties.get("sky-horizon-blend")*ce.height/2*$}))(k,S.style.map.transform,S.pixelRatio),G=new ei(z.LEQUAL,ei.ReadWrite,[0,1]),X=Ci.disabled,Q=S.colorModeForRenderPass(),se=S.useProgram("sky");if(!k.mesh){const ae=new c.aX;ae.emplaceBack(-1,-1),ae.emplaceBack(1,-1),ae.emplaceBack(1,1),ae.emplaceBack(-1,1);const ce=new c.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),k.mesh=new pl(M.createVertexBuffer(ae,zs.members),M.createIndexBuffer(ce),c.a0.simpleSegment(0,0,ae.length,ce.length))}se.draw(M,z.TRIANGLES,G,X,Q,bi.disabled,N,void 0,"sky",k.mesh.vertexBuffer,k.mesh.indexBuffer,k.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],k=l[S.source],M=d[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,k,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],k=l[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?w:_)[S.source];this._renderTileClippingMasks(S,d[S.source]),this.renderLayer(this,k,S,M)}if(this.options.showTileBoundaries){const S=function(k,M){let z=null;const N=Object.values(k._layers).flatMap(se=>se.source&&!se.isHidden(M)?[k.sourceCaches[se.source]]:[]),G=N.filter(se=>se.getSource().type==="vector"),X=N.filter(se=>se.getSource().type!=="vector"),Q=se=>{(!z||z.getSource().maxzoom<se.getSource().maxzoom)&&(z=se)};return G.forEach(se=>Q(se)),z||X.forEach(se=>Q(se)),z}(this.style,this.transform.zoom);S&&function(k,M,z){for(let N=0;N<z.length;N++)gf(k,M,z[N])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const k=S.transform.padding;fo(S,S.transform.height-(k.top||0),3,yu),fo(S,k.bottom||0,3,di),mf(S,k.left||0,3,hl),mf(S,S.transform.width-(k.right||0),3,My);const M=S.transform.centerPoint;(function(z,N,G,X){dl(z,N-1,G-10,2,20,X),dl(z,N-10,G-1,20,2,X)})(S,M.x,S.transform.height-M.y,ff)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!c.a_(r,a):!c.a$(r,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(c.b0(r,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,_){const w=d.context,S=w.gl,k=$i.unblended,M=new ei(S.LEQUAL,ei.ReadWrite,[0,1]),z=_.getTerrainMesh(),N=_.sourceCache.getRenderableTiles(),G=d.useProgram("terrainDepth");w.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1});for(const X of N){const Q=_.getTerrainData(X.tileID),se={u_matrix:d.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};G.draw(w,S.TRIANGLES,M,Ci.disabled,k,bi.backCCW,se,Q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,_){const w=d.context,S=w.gl,k=$i.unblended,M=new ei(S.LEQUAL,ei.ReadWrite,[0,1]),z=_.getTerrainMesh(),N=_.getCoordsTexture(),G=_.sourceCache.getRenderableTiles(),X=d.useProgram("terrainCoords");w.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:c.aM.transparent,depth:1}),_.coordsIndex=[];for(const Q of G){const se=_.getTerrainData(Q.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,N.texture);const ae={u_matrix:d.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};X.draw(w,S.TRIANGLES,M,Ci.disabled,k,bi.backCCW,ae,se,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),_.coordsIndex.push(Q.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,r,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,_,w,S,k){if(d.renderPass!=="translucent")return;const M=Ci.disabled,z=d.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,G,X,Q,se,ae,ce,$,fe){const ge=G.transform,Se=Ms(),Fe=se==="map",Ke=ae==="map";for(const lt of N){const gt=Q.getTile(lt),rt=gt.getBucket(X);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const nt=c.ag(rt.textSizeData,ge.zoom),wt=ii(gt,1,G.transform.zoom),Zt=hs(lt.posMatrix,Ke,Fe,G.transform,wt),st=X.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(nt){const dt=Math.pow(2,ge.zoom-gt.tileID.overscaledZ),jt=G.style.map.terrain?(Jt,ni)=>G.style.map.terrain.getElevation(lt,Jt,ni):null,Mi=Se.translatePosition(ge,gt,ce,$);co(rt,Fe,Ke,fe,ge,Zt,lt.posMatrix,dt,nt,st,Se,Mi,lt.toUnwrapped(),jt)}}}(S,d,w,_,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),k),w.paint.get("icon-opacity").constantOr(1)!==0&&fu(d,_,w,S,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,z),w.paint.get("text-opacity").constantOr(1)!==0&&fu(d,_,w,S,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,z),_.map.showCollisionBoxes&&(fa(d,_,w,S,!0),fa(d,_,w,S,!1))})(e,r,a,l,this.style.placement.variableOffsets);break;case"circle":(function(d,_,w,S){if(d.renderPass!=="translucent")return;const k=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),N=!w.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const G=d.context,X=G.gl,Q=d.depthModeForSublayer(0,ei.ReadOnly),se=Ci.disabled,ae=d.colorModeForRenderPass(),ce=[];for(let $=0;$<S.length;$++){const fe=S[$],ge=_.getTile(fe),Se=ge.getBucket(w);if(!Se)continue;const Fe=Se.programConfigurations.get(w.id),Ke=d.useProgram("circle",Fe),lt=Se.layoutVertexBuffer,gt=Se.indexBuffer,rt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(fe),nt={programConfiguration:Fe,program:Ke,layoutVertexBuffer:lt,indexBuffer:gt,uniformValues:yy(d,fe,ge,w),terrainData:rt};if(N){const wt=Se.segments.get();for(const Zt of wt)ce.push({segments:new c.a0([Zt]),sortKey:Zt.sortKey,state:nt})}else ce.push({segments:Se.segments,sortKey:0,state:nt})}N&&ce.sort(($,fe)=>$.sortKey-fe.sortKey);for(const $ of ce){const{programConfiguration:fe,program:ge,layoutVertexBuffer:Se,indexBuffer:Fe,uniformValues:Ke,terrainData:lt}=$.state;ge.draw(G,X.TRIANGLES,Q,se,ae,bi.disabled,Ke,lt,w.id,Se,Fe,$.segments,w.paint,d.transform.zoom,fe)}})(e,r,a,l);break;case"heatmap":(function(d,_,w,S){if(w.paint.get("heatmap-opacity")===0)return;const k=d.context;if(d.style.map.terrain){for(const M of S){const z=_.getTile(M);_.hasRenderableParent(M)||(d.renderPass==="offscreen"?gu(d,z,w,M):d.renderPass==="translucent"&&Ns(d,w,M))}k.viewport.set([0,0,d.width,d.height])}else d.renderPass==="offscreen"?function(M,z,N,G){const X=M.context,Q=X.gl,se=Ci.disabled,ae=new $i([Q.ONE,Q.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ce,$,fe){const ge=ce.gl;ce.activeTexture.set(ge.TEXTURE1),ce.viewport.set([0,0,$.width/4,$.height/4]);let Se=fe.heatmapFbos.get(c.aU);Se?(ge.bindTexture(ge.TEXTURE_2D,Se.colorAttachment.get()),ce.bindFramebuffer.set(Se.framebuffer)):(Se=ga(ce,$.width/4,$.height/4),fe.heatmapFbos.set(c.aU,Se))})(X,M,N),X.clear({color:c.aM.transparent});for(let ce=0;ce<G.length;ce++){const $=G[ce];if(z.hasRenderableParent($))continue;const fe=z.getTile($),ge=fe.getBucket(N);if(!ge)continue;const Se=ge.programConfigurations.get(N.id),Fe=M.useProgram("heatmap",Se),{zoom:Ke}=M.transform;Fe.draw(X,Q.TRIANGLES,ei.disabled,se,ae,bi.disabled,$n($.posMatrix,fe,Ke,N.paint.get("heatmap-intensity")),null,N.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,N.paint,M.transform.zoom,Se)}X.viewport.set([0,0,M.width,M.height])}(d,_,w,S):d.renderPass==="translucent"&&function(M,z){const N=M.context,G=N.gl;N.setColorMode(M.colorModeForRenderPass());const X=z.heatmapFbos.get(c.aU);X&&(N.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,X.colorAttachment.get()),N.activeTexture.set(G.TEXTURE1),ya(N,z).bind(G.LINEAR,G.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(N,G.TRIANGLES,ei.disabled,Ci.disabled,M.colorModeForRenderPass(),bi.disabled,tl(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(d,w)})(e,r,a,l);break;case"line":(function(d,_,w,S){if(d.renderPass!=="translucent")return;const k=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(k.constantOr(1)===0||M.constantOr(1)===0)return;const z=d.depthModeForSublayer(0,ei.ReadOnly),N=d.colorModeForRenderPass(),G=w.paint.get("line-dasharray"),X=w.paint.get("line-pattern"),Q=X.constantOr(1),se=w.paint.get("line-gradient"),ae=w.getCrossfadeParameters(),ce=Q?"linePattern":G?"lineSDF":se?"lineGradient":"line",$=d.context,fe=$.gl;let ge=!0;for(const Se of S){const Fe=_.getTile(Se);if(Q&&!Fe.patternsLoaded())continue;const Ke=Fe.getBucket(w);if(!Ke)continue;const lt=Ke.programConfigurations.get(w.id),gt=d.context.program.get(),rt=d.useProgram(ce,lt),nt=ge||rt.program!==gt,wt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Se),Zt=X.constantOr(null);if(Zt&&Fe.imageAtlas){const jt=Fe.imageAtlas,Mi=jt.patternPositions[Zt.to.toString()],Jt=jt.patternPositions[Zt.from.toString()];Mi&&Jt&&lt.setConstantPatternPositions(Mi,Jt)}const st=wt?Se:null,dt=Q?ao(d,Fe,w,ae,st):G?_y(d,Fe,w,G,ae,st):se?$p(d,Fe,w,Ke.lineClipsArray.length,st):nl(d,Fe,w,st);if(Q)$.activeTexture.set(fe.TEXTURE0),Fe.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),lt.updatePaintBuffers(ae);else if(G&&(nt||d.lineAtlas.dirty))$.activeTexture.set(fe.TEXTURE0),d.lineAtlas.bind($);else if(se){const jt=Ke.gradients[w.id];let Mi=jt.texture;if(w.gradientVersion!==jt.version){let Jt=256;if(w.stepInterpolant){const ni=_.getSource().maxzoom,zi=Se.canonical.z===ni?Math.ceil(1<<d.transform.maxZoom-Se.canonical.z):1;Jt=c.ac(c.aV(Ke.maxLineLength/c.X*1024*zi),256,$.maxTextureSize)}jt.gradient=c.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:jt.gradient||void 0,clips:Ke.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new Be($,jt.gradient,fe.RGBA),jt.version=w.gradientVersion,Mi=jt.texture}$.activeTexture.set(fe.TEXTURE0),Mi.bind(w.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}rt.draw($,fe.TRIANGLES,z,d.stencilModeForClipping(Se),N,bi.disabled,dt,wt,w.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,w.paint,d.transform.zoom,lt,Ke.layoutVertexBuffer2),ge=!1}})(e,r,a,l);break;case"fill":(function(d,_,w,S){const k=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=d.colorModeForRenderPass(),N=w.paint.get("fill-pattern"),G=d.opaquePassEnabledForLayer()&&!N.constantOr(1)&&k.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===G){const X=d.depthModeForSublayer(1,d.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly);_a(d,_,w,S,X,z,!1)}if(d.renderPass==="translucent"&&w.paint.get("fill-antialias")){const X=d.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly);_a(d,_,w,S,X,z,!0)}})(e,r,a,l);break;case"fill-extrusion":(function(d,_,w,S){const k=w.paint.get("fill-extrusion-opacity");if(k!==0&&d.renderPass==="translucent"){const M=new ei(d.context.gl.LEQUAL,ei.ReadWrite,d.depthRangeFor3D);if(k!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))ul(d,_,w,S,M,Ci.disabled,$i.disabled),ul(d,_,w,S,M,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const z=d.colorModeForRenderPass();ul(d,_,w,S,M,Ci.disabled,z)}}})(e,r,a,l);break;case"hillshade":(function(d,_,w,S){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const k=d.context,M=d.depthModeForSublayer(0,ei.ReadOnly),z=d.colorModeForRenderPass(),[N,G]=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S];for(const X of G){const Q=_.getTile(X);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&d.renderPass==="offscreen"?po(d,Q,w,M,Ci.disabled,z):d.renderPass==="translucent"&&ho(d,X,Q,w,M,N[X.overscaledZ],z)}k.viewport.set([0,0,d.width,d.height])})(e,r,a,l);break;case"raster":(function(d,_,w,S){if(d.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!S.length)return;const k=d.context,M=k.gl,z=_.getSource(),N=d.useProgram("raster"),G=d.colorModeForRenderPass(),[X,Q]=z instanceof Xn?[{},S]:d.stencilConfigForOverlap(S),se=Q[Q.length-1].overscaledZ,ae=!d.options.moving;for(const ce of Q){const $=d.depthModeForSublayer(ce.overscaledZ-se,w.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,M.LESS),fe=_.getTile(ce);fe.registerFadeDuration(w.paint.get("raster-fade-duration"));const ge=_.findLoadedParent(ce,0),Se=_.findLoadedSibling(ce),Fe=pf(fe,ge||Se||null,_,w,d.transform,d.style.map.terrain);let Ke,lt;const gt=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;k.activeTexture.set(M.TEXTURE0),fe.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(M.TEXTURE1),ge?(ge.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ke=Math.pow(2,ge.tileID.overscaledZ-fe.tileID.overscaledZ),lt=[fe.tileID.canonical.x*Ke%1,fe.tileID.canonical.y*Ke%1]):fe.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&k.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const rt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce),nt=rt?ce:null,wt=nt?nt.posMatrix:d.transform.calculatePosMatrix(ce.toUnwrapped(),ae),Zt=vy(wt,lt||[0,0],Ke||1,Fe,w);z instanceof Xn?N.draw(k,M.TRIANGLES,$,Ci.disabled,G,bi.disabled,Zt,rt,w.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments):N.draw(k,M.TRIANGLES,$,X[ce.overscaledZ],G,bi.disabled,Zt,rt,w.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(e,r,a,l);break;case"background":(function(d,_,w,S){const k=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const z=d.context,N=z.gl,G=d.transform,X=G.tileSize,Q=w.paint.get("background-pattern");if(d.isPatternMissing(Q))return;const se=!Q&&k.a===1&&M===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==se)return;const ae=Ci.disabled,ce=d.depthModeForSublayer(0,se==="opaque"?ei.ReadWrite:ei.ReadOnly),$=d.colorModeForRenderPass(),fe=d.useProgram(Q?"backgroundPattern":"background"),ge=S||G.coveringTiles({tileSize:X,terrain:d.style.map.terrain});Q&&(z.activeTexture.set(N.TEXTURE0),d.imageManager.bind(d.context));const Se=w.getCrossfadeParameters();for(const Fe of ge){const Ke=S?Fe.posMatrix:d.transform.calculatePosMatrix(Fe.toUnwrapped()),lt=Q?nu(Ke,M,d,Q,{tileID:Fe,tileSize:X},Se):rl(Ke,M,k),gt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Fe);fe.draw(z,N.TRIANGLES,ce,ae,$,bi.disabled,lt,gt,w.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(e,0,a,l);break;case"custom":(function(d,_,w){const S=d.context,k=w.implementation;if(d.renderPass==="offscreen"){const M=k.prerender;M&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),M.call(k,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(Ci.disabled);const M=k.renderingMode==="3d"?new ei(d.context.gl.LEQUAL,ei.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,ei.ReadOnly);S.setDepthMode(M),k.render(S.gl,d.transform.customLayerMatrix(),{farZ:d.transform.farZ,nearZ:d.transform.nearZ,fov:d.transform._fov,modelViewProjectionMatrix:d.transform.modelViewProjectionMatrix,projectionMatrix:d.transform.projectionMatrix}),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,r,a,l,d){if(!a[0]&&!a[1])return e;const _=d?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(_){const k=Math.sin(_),M=Math.cos(_);a=[a[0]*M-a[1]*k,a[0]*k+a[1]*M]}const w=[d?a[0]:ii(r,a[0],this.transform.zoom),d?a[1]:ii(r,a[1],this.transform.zoom),0],S=new Float32Array(16);return c.J(S,e,w),S}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!r||!a}useProgram(e,r){this.cache=this.cache||{};const a=e+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new tu(this.context,ds[e],r,ru[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}class mo{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a){const l=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=1/(w=c.af([],w,e))[3]/r*l;return c.b1(w,w,[S,S,1/w[3],S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=function(N,G){var X=G[0],Q=G[1],se=G[2],ae=X*X+Q*Q+se*se;return ae>0&&(ae=1/Math.sqrt(ae)),N[0]=G[0]*ae,N[1]=G[1]*ae,N[2]=G[2]*ae,N}([],function(N,G,X){var Q=G[0],se=G[1],ae=G[2],ce=X[0],$=X[1],fe=X[2];return N[0]=se*fe-ae*$,N[1]=ae*ce-Q*fe,N[2]=Q*$-se*ce,N}([],$e([],d[w[0]],d[w[1]]),$e([],d[w[2]],d[w[1]]))),k=-((M=S)[0]*(z=d[w[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(k)});return new mo(d,_)}}class go{constructor(e,r){this.min=e,this.max=r,this.center=function(a,l,d){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,d){return a[0]=l[0]+d[0],a[1]=l[1]+d[1],a[2]=l[2]+d[2],a}([],this.min,this.max))}quadrant(e){const r=[e%2==0,e<2],a=ze(this.min),l=ze(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],l[d]=r[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new go(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<e.planes.length;l++){const d=e.planes[l];let _=0;for(let w=0;w<r.length;w++)c.b2(d,r[w])>=0&&_++;if(_===0)return 0;_!==r.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const S=e.points[w][l]-this.min[l];d=Math.min(d,S),_=Math.max(_,S)}if(_<0||d>this.max[l]-this.min[l])return 0}return 1}}class yo{constructor(e=0,r=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=a,this.right=l}interpolate(e,r,a){return r.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,r.top,a)),r.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,r.bottom,a)),r.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,r.left,a)),r.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,r.right,a)),this}getCenter(e,r){const a=c.ac((this.left+e-this.right)/2,0,e),l=c.ac((this.top+r-this.bottom)/2,0,r);return new c.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new yo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _u=85.051129;class _o{constructor(e,r,a,l,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new yo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new _o(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const r=-c.b3(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,d){var _=l[0],w=l[1],S=l[2],k=l[3],M=Math.sin(d),z=Math.cos(d);a[0]=_*z+S*M,a[1]=w*z+k*M,a[2]=_*-M+S*z,a[3]=w*-M+k*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const r=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const r=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,a){this._unmodified=!1,this._edgeInsets.interpolate(e,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const r=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(e){const r=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),l=this.pointCoordinate(new c.P(this.width,0)),d=this.pointCoordinate(new c.P(this.width,this.height)),_=this.pointCoordinate(new c.P(0,this.height)),w=Math.floor(Math.min(a.x,l.x,d.x,_.x)),S=Math.floor(Math.max(a.x,l.x,d.x,_.x)),k=1;for(let M=w-k;M<=S+k;M++)M!==0&&r.push(new c.b4(M,e))}return r}coveringTiles(e){var r,a;let l=this.coveringZoomLevel(e);const d=l;if(e.minzoom!==void 0&&l<e.minzoom)return[];e.maxzoom!==void 0&&l>e.maxzoom&&(l=e.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),w=c.Z.fromLngLat(this.center),S=Math.pow(2,l),k=[S*_.x,S*_.y,0],M=[S*w.x,S*w.y,0],z=mo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,l);let N=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=l);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,X=$=>({aabb:new go([$*S,0,0],[($+1)*S,S,0]),zoom:0,x:0,y:0,wrap:$,fullyVisible:!1}),Q=[],se=[],ae=l,ce=e.reparseOverscaled?d:l;if(this._renderWorldCopies)for(let $=1;$<=3;$++)Q.push(X(-$)),Q.push(X($));for(Q.push(X(0));Q.length>0;){const $=Q.pop(),fe=$.x,ge=$.y;let Se=$.fullyVisible;if(!Se){const rt=$.aabb.intersects(z);if(rt===0)continue;Se=rt===2}const Fe=e.terrain?k:M,Ke=$.aabb.distanceX(Fe),lt=$.aabb.distanceY(Fe),gt=Math.max(Math.abs(Ke),Math.abs(lt));if($.zoom===ae||gt>G+(1<<ae-$.zoom)-2&&$.zoom>=N){const rt=ae-$.zoom,nt=k[0]-.5-(fe<<rt),wt=k[1]-.5-(ge<<rt);se.push({tileID:new c.S($.zoom===ae?ce:$.zoom,$.wrap,$.zoom,fe,ge),distanceSq:xt([M[0]-.5-fe,M[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(nt*nt+wt*wt)})}else for(let rt=0;rt<4;rt++){const nt=(fe<<1)+rt%2,wt=(ge<<1)+(rt>>1),Zt=$.zoom+1;let st=$.aabb.quadrant(rt);if(e.terrain){const dt=new c.S(Zt,$.wrap,Zt,nt,wt),jt=e.terrain.getMinMaxElevation(dt),Mi=(r=jt.minElevation)!==null&&r!==void 0?r:this.elevation,Jt=(a=jt.maxElevation)!==null&&a!==void 0?a:this.elevation;st=new go([st.min[0],st.min[1],Mi],[st.max[0],st.max[1],Jt])}Q.push({aabb:st,zoom:Zt,x:nt,y:wt,wrap:$.wrap,fullyVisible:Se})}}return se.sort(($,fe)=>$.distanceSq-fe.distanceSq).map($=>$.tileID)}resize(e,r){this.width=e,this.height=r,this.pixelsToGLUnits=[2/e,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const r=c.ac(e.lat,-85.051129,_u);return new c.P(c.O(e.lng)*this.worldSize,c.Q(r)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const r=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,e),d=e.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-d))return;const _=a+r-d,w=Math.cos(this._pitch)*this.cameraToCenterDistance/_/c.b5(1,l.lat),S=this.scaleZoom(w/this.tileSize);this._elevation=d,this._center=l,this.zoom=S}setLocationAtPoint(e,r){const a=this.pointCoordinate(r),l=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),_=new c.Z(d.x-(a.x-l.x),d.y-(a.y-l.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,r){return r?this.coordinatePoint(this.locationCoordinate(e),r.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,r){return this.coordinateLocation(this.pointCoordinate(e,r))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,r){if(r){const N=r.pointCoordinate(e);if(N!=null)return N}const a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(l,l,this.pixelMatrixInverse);const d=a[3],_=l[3],w=a[1]/d,S=l[1]/_,k=a[2]/d,M=l[2]/_,z=k===M?0:(0-k)/(M-k);return new c.Z(c.y.number(a[0]/d,l[0]/_,z)/this.worldSize,c.y.number(w,S,z)/this.worldSize)}coordinatePoint(e,r=0,a=this.pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,r,1];return c.af(l,l,a),new c.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new be().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new be([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_u])}calculateTileMatrix(e){const r=e.canonical,a=this.worldSize/this.zoomScale(r.z),l=r.x+Math.pow(2,r.z)*e.wrap,d=c.an(new Float64Array(16));return c.J(d,d,[l*a,r.y*a,0]),c.K(d,d,[a/c.X,a/c.X,1]),d}calculatePosMatrix(e,r=!1){const a=e.key,l=r?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const d=this.calculateTileMatrix(e);return c.L(d,r?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,d),l[a]=new Float32Array(d),l[a]}calculateFogMatrix(e){const r=e.key,a=this._fogMatrixCache;if(a[r])return a[r];const l=this.calculateTileMatrix(e);return c.L(l,this.fogMatrix,l),a[r]=new Float32Array(l),a[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,r){r=c.ac(+r,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:r};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const $=179.9999999999;l=[-$,$]}const d=this.tileSize*this.zoomScale(a.zoom);let _=0,w=d,S=0,k=d,M=0,z=0;const{x:N,y:G}=this.size;if(this.latRange){const $=this.latRange;_=c.Q($[1])*d,w=c.Q($[0])*d,w-_<G&&(M=G/(w-_))}l&&(S=c.b3(c.O(l[0])*d,0,d),k=c.b3(c.O(l[1])*d,0,d),k<S&&(k+=d),k-S<N&&(z=N/(k-S)));const{x:X,y:Q}=this.project.call({worldSize:d},e);let se,ae;const ce=Math.max(z||0,M||0);if(ce){const $=new c.P(z?(k+S)/2:X,M?(w+_)/2:Q);return a.center=this.unproject.call({worldSize:d},$).wrap(),a.zoom+=this.scaleZoom(ce),a}if(this.latRange){const $=G/2;Q-$<_&&(ae=_+$),Q+$>w&&(ae=w-$)}if(l){const $=(S+k)/2;let fe=X;this._renderWorldCopies&&(fe=c.b3(X,$-d/2,$+d/2));const ge=N/2;fe-ge<S&&(se=S+ge),fe+ge>k&&(se=k-ge)}if(se!==void 0||ae!==void 0){const $=new c.P(se??X,ae??Q);a.center=this.unproject.call({worldSize:d},$).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=r,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,r=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let l=c.an(new Float64Array(16));c.K(l,l,[this.width/2,-this.height/2,1]),c.J(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=c.an(new Float64Array(16)),c.K(l,l,[1,-1,1]),c.J(l,l,[-1,-1,0]),c.K(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this.minElevationForCurrentTile),w=d-_*this._pixelPerMeter/Math.cos(this._pitch),S=_<0?w:d,k=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(c.ac(Math.PI-k-M,.01,Math.PI-.01)),N=this.getHorizon(),G=2*Math.atan(N/this.cameraToCenterDistance)*(.5+e.y/(2*N)),X=Math.sin(G)*S/Math.sin(c.ac(Math.PI-k-G,.01,Math.PI-.01)),Q=Math.min(z,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+S),this.nearZ=this.height/50,l=new Float64Array(16),c.b6(l,this._fov,this.width/this.height,this.nearZ,this.farZ),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.projectionMatrix=c.ae(l),c.K(l,l,[1,-1,1]),c.J(l,l,[0,0,-this.cameraToCenterDistance]),c.b7(l,l,this._pitch),c.ad(l,l,this.angle),c.J(l,l,[-r,-a,0]),this.mercatorMatrix=c.K([],l,[this.worldSize,this.worldSize,this.worldSize]),c.K(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,l),c.J(l,l,[0,0,-this.elevation]),this.modelViewProjectionMatrix=l,this.invModelViewProjectionMatrix=c.as([],l),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,d,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-r,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,l);const se=this.width%2/2,ae=this.height%2/2,ce=Math.cos(this.angle),$=Math.sin(this.angle),fe=r-Math.round(r)+ce*se+$*ae,ge=a-Math.round(a)+ce*ae+$*se,Se=new Float64Array(l);if(c.J(Se,Se,[fe>.5?fe-1:fe,ge>.5?ge-1:ge,0]),this.alignedModelViewProjectionMatrix=Se,l=c.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const r=this.getCameraPoint();if(e.length===1)return[e[0],r];{let a=r.x,l=r.y,d=r.x,_=r.y;for(const w of e)a=Math.min(a,w.x),l=Math.min(l,w.y),d=Math.max(d,w.x),_=Math.max(_,w.y);return[new c.P(a,l),new c.P(d,l),new c.P(d,_),new c.P(a,_),new c.P(a,l)]}}lngLatToCameraDepth(e,r){const a=this.locationCoordinate(e),l=[a.x*this.worldSize,a.y*this.worldSize,r,1];return c.af(l,l,this.modelViewProjectionMatrix),l[2]/l[3]}}function va(p,e){let r,a=!1,l=null,d=null;const _=()=>{l=null,a&&(p.apply(d,r),l=setTimeout(_,e),a=!1)};return(...w)=>(a=!0,d=this,r=w,l||_(),l)}class ml{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:a,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const a=r.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let d=window.location.hash.replace(l,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let _=window.location.href.replace(/(#.+)?$/,d);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=va(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,l),_=Math.round(r.lng*d)/d,w=Math.round(r.lat*d)/d,S=this._map.getBearing(),k=this._map.getPitch();let M="";if(M+=e?`/${_}/${w}/${a}`:`${a}/${w}/${_}`,(S||k)&&(M+="/"+Math.round(10*S)/10),k&&(M+=`/${Math.round(k)}`),this._hashName){const z=this._hashName;let N=!1;const G=window.location.hash.slice(1).split("&").map(X=>{const Q=X.split("=")[0];return Q===z?(N=!0,`${Q}=${M}`):X}).filter(X=>X);return N||G.push(`${z}=${M}`),`#${G.join("&")}`}return`#${M}`}}const gl={linearity:.3,easing:c.b8(0,0,.3,1)},vu=c.e({deceleration:2500,maxSpeed:1400},gl),zy=c.e({deceleration:20,maxSpeed:1400},gl),_f=c.e({deceleration:1e3,maxSpeed:360},gl),yl=c.e({deceleration:1e3,maxSpeed:90},gl);class xu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:B.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=B.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)r.zoom+=d.zoomDelta||0,r.bearing+=d.bearingDelta||0,r.pitch+=d.pitchDelta||0,d.panDelta&&r.pan._add(d.panDelta),d.around&&(r.around=d.around),d.pinchAround&&(r.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(r.pan.mag()){const d=ba(r.pan.mag(),a,c.e({},vu,e||{}));l.offset=r.pan.mult(d.amount/r.pan.mag()),l.center=this._map.transform.center,xa(l,d)}if(r.zoom){const d=ba(r.zoom,a,zy);l.zoom=this._map.transform.zoom+d.amount,xa(l,d)}if(r.bearing){const d=ba(r.bearing,a,_f);l.bearing=this._map.transform.bearing+c.ac(d.amount,-179,179),xa(l,d)}if(r.pitch){const d=ba(r.pitch,a,yl);l.pitch=this._map.transform.pitch+d.amount,xa(l,d)}if(l.zoom||l.bearing){const d=r.pinchAround===void 0?r.around:r.pinchAround;l.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),c.e(l,{noMoveStart:!0})}}function xa(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function ba(p,e,r){const{maxSpeed:a,linearity:l,deceleration:d}=r,_=c.ac(p*l/(e/1e3),-a,a),w=Math.abs(_)/(d*l);return{easing:r.easing,duration:1e3*w,amount:_*(w/2)}}class An extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a,l={}){const d=V.mousePos(r.getCanvas(),a),_=r.unproject(d);super(e,c.e({point:d,lngLat:_,originalEvent:a},l)),this._defaultPrevented=!1,this.target=r}}class Vs extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a){const l=e==="touchend"?a.changedTouches:a.touches,d=V.touchPos(r.getCanvasContainer(),l),_=d.map(S=>r.unproject(S)),w=d.reduce((S,k,M,z)=>S.add(k.div(z.length)),new c.P(0,0));super(e,{points:d,point:w,lngLats:_,lngLat:r.unproject(w),originalEvent:a}),this._defaultPrevented=!1}}class vf extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class xf{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new vf(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new An(e.type,this._map,e))}mouseup(e){this._map.fire(new An(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new An(e.type,this._map,e))}dblclick(e){return this._firePreventable(new An(e.type,this._map,e))}mouseover(e){this._map.fire(new An(e.type,this._map,e))}mouseout(e){this._map.fire(new An(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Vs(e.type,this._map,e))}touchmove(e){this._map.fire(new Vs(e.type,this._map,e))}touchend(e){this._map.fire(new Vs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Vs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ji{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new An(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new An("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new An(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Er{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class ur{constructor(e,r){this._map=e,this._tr=new Er(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const a=r;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(l.x,a.x),_=Math.max(l.x,a.x),w=Math.min(l.y,a.y),S=Math.max(l.y,a.y);V.setTransform(this._box,`translate(${d}px,${w}px)`),this._box.style.width=_-d+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const a=this._startPos,l=r;if(this.reset(),V.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new c.k(e,{originalEvent:r}))}}function wa(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const r={};for(let a=0;a<p.length;a++)r[p[a].identifier]=e[a];return r}class bu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const d=new c.P(0,0);for(const _ of l)d._add(_);return d.div(l.length)}(r),this.touches=wa(a,r)))}touchmove(e,r,a){if(this.aborted||!this.centroid)return;const l=wa(a,r);for(const d in this.touches){const _=l[d];(!_||_.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,r,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class _l{constructor(e){this.singleTap=new bu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,a){this.singleTap.touchstart(e,r,a)}touchmove(e,r,a){this.singleTap.touchmove(e,r,a)}touchend(e,r,a){const l=this.singleTap.touchend(e,r,a);if(l){const d=e.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(l)<30;if(d&&_||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class vo{constructor(e){this._tr=new Er(e),this._zoomIn=new _l({numTouches:1,numTaps:2}),this._zoomOut=new _l({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,a){this._zoomIn.touchstart(e,r,a),this._zoomOut.touchstart(e,r,a)}touchmove(e,r,a){this._zoomIn.touchmove(e,r,a),this._zoomOut.touchmove(e,r,a)}touchend(e,r,a){const l=this._zoomIn.touchend(e,r,a),d=this._zoomOut.touchend(e,r,a),_=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(l)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ts{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=r.length?r[0]:r;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const wu={0:1,2:2};class vl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=V.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,a){const l=wu[a];return r.buttons===void 0||(r.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class Su{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const xl=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}},Tu=({enable:p,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const a=new vl({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new ts({clickTolerance:e,move:(l,d)=>({bearingDelta:(d.x-l.x)*r}),moveStateManager:a,enable:p,assignEvents:xl})},Pu=({enable:p,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const a=new vl({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new ts({clickTolerance:e,move:(l,d)=>({pitchDelta:(d.y-l.y)*r}),moveStateManager:a,enable:p,assignEvents:xl})};class js{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,a){return this._calculateTransform(e,r,a)}touchmove(e,r,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,r,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,a){this._calculateTransform(e,r,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,a){a.length>0&&(this._active=!0);const l=wa(a,r),d=new c.P(0,0),_=new c.P(0,0);let w=0;for(const k in l){const M=l[k],z=this._touches[k];z&&(d._add(M),_._add(M.sub(z)),w++,l[k]=M)}if(this._touches=l,this._shouldBePrevented(w)||!_.mag())return;const S=_.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,d]=this._firstTwoTouches,_=Sa(a,r,l),w=Sa(a,r,d);if(!_||!w)return;const S=this._aroundCenter?null:_.add(w).div(2);return this._move([_,w],S,e)}touchend(e,r,a){if(!this._firstTwoTouches)return;const[l,d]=this._firstTwoTouches,_=Sa(a,r,l),w=Sa(a,r,d);_&&w||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sa(p,e,r){for(let a=0;a<p.length;a++)if(p[a].identifier===r)return e[a]}function Iu(p,e){return Math.log(p/e)/Math.LN2}class Cu extends bl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Iu(this._distance,a),pinchAround:r}}}function Au(p,e){return 180*p.angleWith(e)/Math.PI}class ku extends bl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Au(this._vector,l),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,a=Au(e,this._startVector);return Math.abs(a)<r}}function wl(p){return Math.abs(p.y)>Math.abs(p.x)}class xo extends bl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,a){super.touchstart(e,r,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,wl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,d,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,d=r.mag()>=2;if(!l&&!d)return;if(!l||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const _=e.y>0==r.y>0;return wl(e)&&wl(r)&&_}}const bf={panStep:100,bearingStep:15,pitchStep:10};class _r{constructor(e){this._tr=new Er(e);const r=bf;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,a=0,l=0,d=0,_=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),_=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Hr,zoom:r?Math.round(S.zoom)+r*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+l*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hr(p){return p*(2-p)}const Eu=4.000244140625;class Mr{constructor(e,r){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new Er(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=B.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,r!==0&&r%Eu==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=V.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=r.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(r)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Eu?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*k))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,l=this._easing;let d,_=!1;const w=B.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&l&&w){const S=Math.min(w/200,1),k=l(S);d=c.y.number(a,r,k),S<1?this._frameId||(this._frameId=!0):_=!0}else d=r,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=c.b9;if(this._prevEase){const a=this._prevEase,l=(B.now()-a.start)/a.duration,d=a.easing(l+.01)-a.easing(l),_=.27/Math.sqrt(d*d+1e-4)*.01,w=Math.sqrt(.0729-_*_);r=c.b8(_,w,.25,1)}return this._prevEase={start:B.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Us{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dy{constructor(e){this._tr=new Er(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ly{constructor(){this._tap=new _l({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,a){if(!this._swipePoint)if(this._tapTime){const l=r[0],d=e.timeStamp-this._tapTime<500,_=this._tapPoint.dist(l)<30;d&&_?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,r,a)}touchmove(e,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=r[0],d=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,r,a)}touchend(e,r,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,r,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(e,r,a){this._el=e,this._mousePan=r,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sf{constructor(e,r,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mu{constructor(e,r,a,l){this._el=e,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class bo{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=r,this._container.appendChild(l);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=a,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const vr=p=>p.zoom||p.drag||p.pitch||p.rotate;class _t extends c.k{}function Sl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class zu{constructor(e,r){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,d)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=l.type==="renderFrame"?void 0:l,w={needsRenderFrame:!1},S={},k={},M=l.touches,z=M?this._getMapTouches(M):void 0,N=z?V.touchPos(this._map.getCanvas(),z):V.mousePos(this._map.getCanvas(),l);for(const{handlerName:Q,handler:se,allowed:ae}of this._handlers){if(!se.isEnabled())continue;let ce;this._blockedByActive(k,ae,Q)?se.reset():se[d||l.type]&&(ce=se[d||l.type](l,N,z),this.mergeHandlerResult(w,S,ce,Q,_),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||se.isActive())&&(k[Q]=se)}const G={};for(const Q in this._previousActiveHandlers)k[Q]||(G[Q]=_);this._previousActiveHandlers=k,(Object.keys(G).length||Sl(w))&&(this._changes.push([w,S,G]),this._triggerRenderFrame()),(Object.keys(k).length||Sl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=w;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xu(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,d,_]of this._listeners)V.addEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[e,r,a]of this._listeners)V.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new xf(r,e));const l=r.boxZoom=new ur(r,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const d=r.cooperativeGestures=new bo(r,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const _=new vo(r),w=new Dy(r);r.doubleClickZoom=new Us(w,_),this._add("tapZoom",_),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Ly;this._add("tapDragZoom",S);const k=r.touchPitch=new xo(r);this._add("touchPitch",k),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const M=Tu(e),z=Pu(e);r.dragRotate=new Sf(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const N=(({enable:ce,clickTolerance:$})=>{const fe=new vl({checkCorrectEvent:ge=>V.mouseButton(ge)===0&&!ge.ctrlKey});return new ts({clickTolerance:$,move:(ge,Se)=>({around:Se,panDelta:Se.sub(ge)}),activateOnStart:!0,moveStateManager:fe,enable:ce,assignEvents:xl})})(e),G=new js(e,r);r.dragPan=new wf(a,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const X=new ku,Q=new Cu;r.touchZoomRotate=new Mu(a,Q,X,S),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const se=r.scrollZoom=new Mr(r,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ae=r.keyboard=new _r(r);this._add("keyboard",ae),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Ji(r))}_add(e,r,a){this._handlers.push({handlerName:e,handler:r,allowed:a}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,a){for(const l in e)if(l!==a&&(!r||r.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const a of e)this._el.contains(a.target)&&r.push(a);return r}mergeHandlerResult(e,r,a,l,d){if(!a)return;c.e(e,a);const _={handlerName:l,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(r.zoom=_),a.panDelta!==void 0&&(r.drag=_),a.pitchDelta!==void 0&&(r.pitch=_),a.bearingDelta!==void 0&&(r.rotate=_)}_applyChanges(){const e={},r={},a={};for(const[l,d,_]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),c.e(r,d),c.e(a,_);this._updateMapTransform(e,r,a),this._changes=[]}_updateMapTransform(e,r,a){const l=this._map,d=l._getTransformForUpdate(),_=l.terrain;if(!(Sl(e)||_&&this._terrainMovement))return this._fireEvents(r,a,!0);let{panDelta:w,zoomDelta:S,bearingDelta:k,pitchDelta:M,around:z,pinchAround:N}=e;N!==void 0&&(z=N),l._stop(!0),z=z||l.transform.centerPoint;const G=d.pointLocation(w?z.sub(w):z);k&&(d.bearing+=k),M&&(d.pitch+=M),S&&(d.zoom+=S),_?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(w)):d.setLocationAtPoint(G,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(G,z)):d.setLocationAtPoint(G,z),l._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,a,!0)}_fireEvents(e,r,a){const l=vr(this._eventsInProgress),d=vr(e),_={};for(const z in e){const{originalEvent:N}=e[z];this._eventsInProgress[z]||(_[`${z}start`]=N),this._eventsInProgress[z]=e[z]}!l&&d&&this._fireEvent("movestart",d.originalEvent);for(const z in _)this._fireEvent(z,_[z]);d&&this._fireEvent("move",d.originalEvent);for(const z in e){const{originalEvent:N}=e[z];this._fireEvent(z,N)}const w={};let S;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],S=r[N]||G,w[`${z}end`]=S)}for(const z in w)this._fireEvent(z,w[z]);const k=vr(this._eventsInProgress),M=(l||d)&&!k;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!z||!z.essential&&B.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:S})),N(this._map.getBearing())&&this._map.resetNorth()):(N(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new c.k(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new _t("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tf extends c.E{constructor(e,r){super(),this._renderFrameCallback=()=>{const a=Math.min((B.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}panBy(e,r,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},r),a)}panTo(e,r,a){return this.easeTo(c.e({center:e},r),a)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,a){return this.easeTo(c.e({zoom:e},r),a)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,a){return this.easeTo(c.e({bearing:e},r),a)}resetNorth(e,r){return this.rotateTo(0,c.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}cameraForBounds(e,r){e=be.convert(e).adjustAntiMeridian();const a=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,r)}_cameraForBoxAndBearing(e,r,a,l){const d={top:0,bottom:0,right:0,left:0};if(typeof(l=c.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const rt=l.padding;l.padding={top:rt,bottom:rt,right:rt,left:rt}}l.padding=c.e(d,l.padding);const _=this.transform,w=_.padding,S=new be(e,r),k=_.project(S.getNorthWest()),M=_.project(S.getNorthEast()),z=_.project(S.getSouthEast()),N=_.project(S.getSouthWest()),G=c.ba(-a),X=k.rotate(G),Q=M.rotate(G),se=z.rotate(G),ae=N.rotate(G),ce=new c.P(Math.max(X.x,Q.x,ae.x,se.x),Math.max(X.y,Q.y,ae.y,se.y)),$=new c.P(Math.min(X.x,Q.x,ae.x,se.x),Math.min(X.y,Q.y,ae.y,se.y)),fe=ce.sub($),ge=(_.width-(w.left+w.right+l.padding.left+l.padding.right))/fe.x,Se=(_.height-(w.top+w.bottom+l.padding.top+l.padding.bottom))/fe.y;if(Se<0||ge<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(_.scaleZoom(_.scale*Math.min(ge,Se)),l.maxZoom),Ke=c.P.convert(l.offset),lt=new c.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(c.ba(a)),gt=Ke.add(lt).mult(_.scale/_.zoomScale(Fe));return{center:_.unproject(k.add(z).div(2).sub(gt)),zoom:Fe,bearing:a}}fitBounds(e,r,a){return this._fitInternal(this.cameraForBounds(e,r),r,a)}fitScreenCoordinates(e,r,a,l,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(r)),a,l),l,d)}_fitInternal(e,r,a){return e?(delete(r=c.e(e,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(e,r){this.stop();const a=this._getTransformForUpdate();let l=!1,d=!1,_=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(l=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(d=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(_=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",r)).fire(new c.k("move",r)),l&&this.fire(new c.k("zoomstart",r)).fire(new c.k("zoom",r)).fire(new c.k("zoomend",r)),d&&this.fire(new c.k("rotatestart",r)).fire(new c.k("rotate",r)).fire(new c.k("rotateend",r)),_&&this.fire(new c.k("pitchstart",r)).fire(new c.k("pitch",r)).fire(new c.k("pitchend",r)),this.fire(new c.k("moveend",r))}calculateCameraOptionsFromTo(e,r,a,l=0){const d=c.Z.fromLngLat(e,r),_=c.Z.fromLngLat(a,l),w=_.x-d.x,S=_.y-d.y,k=_.z-d.z,M=Math.hypot(w,S,k);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,S),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),G=180*Math.atan2(w,-S)/Math.PI;let X=180*Math.acos(z/M)/Math.PI;return X=k<0?90-X:90+X,{center:_.toLngLat(),zoom:N,pitch:X,bearing:G}}easeTo(e,r){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&B.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),d=l.zoom,_=l.bearing,w=l.pitch,S=l.padding,k="bearing"in e?this._normalizeBearing(e.bearing,_):_,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:l.padding,N=c.P.convert(e.offset);let G=l.centerPoint.add(N);const X=l.pointLocation(G),{center:Q,zoom:se}=l.getConstrained(c.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Q,l);const ae=l.project(X),ce=l.project(Q).sub(ae),$=l.zoomScale(se-d);let fe,ge;e.around&&(fe=c.N.convert(e.around),ge=l.locationPoint(fe));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==d,this._rotating=this._rotating||_!==k,this._pitching=this._pitching||M!==w,this._padding=!l.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,Se),this.terrain&&this._prepareElevation(Q),this._ease(Fe=>{if(this._zooming&&(l.zoom=c.y.number(d,se,Fe)),this._rotating&&(l.bearing=c.y.number(_,k,Fe)),this._pitching&&(l.pitch=c.y.number(w,M,Fe)),this._padding&&(l.interpolatePadding(S,z,Fe),G=l.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe),fe)l.setLocationAtPoint(fe,ge);else{const Ke=l.zoomScale(l.zoom-d),lt=se>d?Math.min(2,$):Math.max(.5,$),gt=Math.pow(lt,1-Fe),rt=l.unproject(ae.add(ce.mult(Fe*gt)).mult(Ke));l.setLocationAtPoint(l.renderWorldCopies?rt.wrap():rt,G)}this._applyUpdatedTransform(l),this._fireMoveEvents(r)},Fe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,Fe)},e),this}_prepareEase(e,r,a={}){this._moving=!0,r||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(r-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const r=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(r.lngLat,e.zoom);if(r.altitude<a){const l=this.calculateCameraOptionsFromTo(r.lngLat,a,e.center,e.elevation);return{pitch:l.pitch,zoom:l.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(this.terrain&&r.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&r.push(l=>this.transformCameraUpdate(l)),!r.length)return;const a=e.clone();for(const l of r){const d=a.clone(),{center:_,zoom:w,pitch:S,bearing:k,elevation:M}=l(d);_&&(d.center=_),w!==void 0&&(d.zoom=w),S!==void 0&&(d.pitch=S),k!==void 0&&(d.bearing=k),M!==void 0&&(d.elevation=M),a.apply(d)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const a=this._zooming,l=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),l&&this.fire(new c.k("rotateend",e)),d&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,r){var a;if(!e.essential&&B.prefersReducedMotion){const dt=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dt,r)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const l=this._getTransformForUpdate(),d=l.zoom,_=l.bearing,w=l.pitch,S=l.padding,k="bearing"in e?this._normalizeBearing(e.bearing,_):_,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:l.padding,N=c.P.convert(e.offset);let G=l.centerPoint.add(N);const X=l.pointLocation(G),{center:Q,zoom:se}=l.getConstrained(c.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Q,l);const ae=l.zoomScale(se-d),ce=l.project(X),$=l.project(Q).sub(ce);let fe=e.curve;const ge=Math.max(l.width,l.height),Se=ge/ae,Fe=$.mag();if("minZoom"in e){const dt=c.ac(Math.min(e.minZoom,d,se),l.minZoom,l.maxZoom),jt=ge/l.zoomScale(dt-d);fe=Math.sqrt(jt/Fe*2)}const Ke=fe*fe;function lt(dt){const jt=(Se*Se-ge*ge+(dt?-1:1)*Ke*Ke*Fe*Fe)/(2*(dt?Se:ge)*Ke*Fe);return Math.log(Math.sqrt(jt*jt+1)-jt)}function gt(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function rt(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const nt=lt(!1);let wt=function(dt){return rt(nt)/rt(nt+fe*dt)},Zt=function(dt){return ge*((rt(nt)*(gt(jt=nt+fe*dt)/rt(jt))-gt(nt))/Ke)/Fe;var jt},st=(lt(!0)-nt)/fe;if(Math.abs(Fe)<1e-6||!isFinite(st)){if(Math.abs(ge-Se)<1e-6)return this.easeTo(e,r);const dt=Se<ge?-1:1;st=Math.abs(Math.log(Se/ge))/fe,Zt=()=>0,wt=jt=>Math.exp(dt*fe*jt)}return e.duration="duration"in e?+e.duration:1e3*st/("screenSpeed"in e?+e.screenSpeed/fe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=_!==k,this._pitching=M!==w,this._padding=!l.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(Q),this._ease(dt=>{const jt=dt*st,Mi=1/wt(jt);l.zoom=dt===1?se:d+l.scaleZoom(Mi),this._rotating&&(l.bearing=c.y.number(_,k,dt)),this._pitching&&(l.pitch=c.y.number(w,M,dt)),this._padding&&(l.interpolatePadding(S,z,dt),G=l.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(dt);const Jt=dt===1?Q:l.unproject(ce.add($.mult(Zt(jt))).mult(Mi));l.setLocationAtPoint(l.renderWorldCopies?Jt.wrap():Jt,G),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,r)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,r,a){a.animate===!1||a.duration===0?(e(1),r()):(this._easeStart=B.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=c.b3(e,-180,180);const a=Math.abs(e-r);return Math.abs(e-360-r)<a&&(e-=360),Math.abs(e+360-r)<a&&(e+=360),e}_normalizeCenter(e,r){if(!r.renderWorldCopies||r.lngRange)return;const a=e.lng-r.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const wo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class So{constructor(e=wo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const a=this._map._getUIString(`AttributionControl.${r}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const r=this._map.style.sourceCaches;for(const l in r){const d=r[l];if(d.used||d.usedForTerrain){const _=d.getSource();_.attribution&&e.indexOf(_.attribution)<0&&e.push(_.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,d)=>l.length-d.length),e=e.filter((l,d)=>{for(let _=d+1;_<e.length;_++)if(e[_].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Du{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const r=V.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Lu=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ry extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const a={};for(const l of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),c.aP(l.posMatrix,0,c.X,0,c.X,0,1),this._tiles[l.key]=new Ir(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const r in this._tiles){const a=this._tiles[r];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const r={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16),c.aP(d.posMatrix,0,c.X,0,c.X,0,1),r[a]=d}else if(l.canonical.isChildOf(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const _=l.canonical.z-e.canonical.z,w=l.canonical.x-(l.canonical.x>>_<<_),S=l.canonical.y-(l.canonical.y>>_<<_),k=c.X>>_;c.aP(d.posMatrix,0,k,0,k,0,1),c.J(d.posMatrix,d.posMatrix,[-w*k,-S*k,0]),r[a]=d}else if(e.canonical.isChildOf(l.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const _=e.canonical.z-l.canonical.z,w=e.canonical.x-(e.canonical.x>>_<<_),S=e.canonical.y-(e.canonical.y>>_<<_),k=c.X>>_;c.aP(d.posMatrix,0,c.X,0,c.X,0,1),c.J(d.posMatrix,d.posMatrix,[w*k,S*k,0]),c.K(d.posMatrix,d.posMatrix,[1/2**_,1/2**_,0]),r[a]=d}}return r}getSourceTile(e,r){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&r)for(;l>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(l--).key);return d}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=e)}}class Ru{constructor(e,r,a){this.painter=e,this.sourceCache=new Ry(r),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,a,l=c.X){var d;if(!(r>=0&&r<l&&a>=0&&a<l))return 0;const _=this.getTerrainData(e),w=(d=_.tile)===null||d===void 0?void 0:d.dem;if(!w)return 0;const S=function(X,Q,se){var ae=Q[0],ce=Q[1];return X[0]=se[0]*ae+se[4]*ce+se[12],X[1]=se[1]*ae+se[5]*ce+se[13],X}([],[r/l*c.X,a/l*c.X],_.u_terrain_matrix),k=[S[0]*w.dim,S[1]*w.dim],M=Math.floor(k[0]),z=Math.floor(k[1]),N=k[0]-M,G=k[1]-z;return w.get(M,z)*(1-N)*(1-G)+w.get(M+1,z)*N*(1-G)+w.get(M,z+1)*(1-N)*G+w.get(M+1,z+1)*N*G}getElevationForLngLatZoom(e,r){if(!c.bb(r,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(a,l%c.X,d%c.X,c.X)}getElevation(e,r,a,l=c.X){return this.getDEMElevation(e,r,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,d=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Be(l,d,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Be(l,new c.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const l=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Be(l,r.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),r.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const a=r&&r+r.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?d=e.canonical.z-l:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=e.canonical.x-(e.canonical.x>>d<<d),w=e.canonical.y-(e.canonical.y>>d<<d),S=c.bc(new Float64Array(16),[1/(c.X<<d),1/(c.X<<d),0]);c.J(S,S,[_*c.X,w*c.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,a=r.width/devicePixelRatio,l=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Be(r.context,{width:a,height:l,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Be(r.context,{width:a,height:l,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,_=0;d<this._coordsTextureSize;d++)for(let w=0;w<this._coordsTextureSize;w++,_+=4)r[_+0]=255&w,r[_+1]=255&d,r[_+2]=w>>8<<4|d>>8,r[_+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),l=new Be(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),a=this.painter.context,l=a.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(d,w-_-1,1,1,l.RGBA,l.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),k=r[1]+((15&r[2])<<8),M=this.coordsIndex[255-r[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const N=this._coordsTextureSize,G=(1<<z.tileID.canonical.z)*N;return new c.Z((z.tileID.canonical.x*N+S)/G+z.tileID.wrap,(z.tileID.canonical.y*N+k)/G,this.getElevation(z.tileID,S,k,N))}depthAtPoint(e){const r=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,r=new c.bd,a=new c.aY,l=this.meshSize,d=c.X/l,_=l*l;for(let z=0;z<=l;z++)for(let N=0;N<=l;N++)r.emplaceBack(N*d,z*d,0);for(let z=0;z<_;z+=l+1)for(let N=0;N<l;N++)a.emplaceBack(N+z,l+N+z+1,l+N+z+2),a.emplaceBack(N+z,l+N+z+2,N+z+1);const w=r.length,S=w+2*(l+1);for(const z of[0,1])for(let N=0;N<=l;N++)for(const G of[0,1])r.emplaceBack(N*d,z*c.X,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(w+z,w+z+3,w+z+1),a.emplaceBack(w+z,w+z+2,w+z+3);const k=r.length,M=k+2*(l+1);for(const z of[0,1])for(let N=0;N<=l;N++)for(const G of[0,1])r.emplaceBack(z*c.X,N*d,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(k+z,k+z+1,k+z+3),a.emplaceBack(k+z,k+z+3,k+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new pl(e.createVertexBuffer(r,Lu.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,r.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,r){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return r&&r.dem&&(a.minElevation=r.dem.min*this.exaggeration,a.maxElevation=r.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,r){const a=c.Z.fromLngLat(e.wrap()),l=(1<<r)*c.X,d=a.x*l,_=a.y*l,w=Math.floor(d/c.X),S=Math.floor(_/c.X);return{tileID:new c.S(r,0,r,w,S),mercatorX:d,mercatorY:_}}}class Oy{constructor(e,r,a){this._context=e,this._size=r,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Be(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(a.texture),{id:e,fbo:r,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const To={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pf{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Oy(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(r)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const d of l){const _=this.terrain.sourceCache.getTerrainCoords(d);for(const w in _)this._coordsDescendingInv[a][w]||(this._coordsDescendingInv[a][w]=[]),this._coordsDescendingInv[a][w].push(_[w])}}this._coordsDescendingInvStr={};for(const a of e._order){const l=e._layers[a],d=l.source;if(To[l.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const _ in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][_]=this._coordsDescendingInv[d][_].map(w=>w.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[l][a.tileID.key];d&&d!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const r=e.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(To[r]&&(this._prevType&&To[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(e.id),!l))return!0;if(To[this._prevType]||To[r]&&l){this._prevType=r;const d=this._stacks.length-1,_=this._stacks[d]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(yf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[d]){const k=this.pool.getObjectForId(w.rtt[d].id);if(k.stamp===w.rtt[d].stamp){this.pool.useObject(k);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),w.rtt[d]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let k=0;k<_.length;k++){const M=a.style._layers[_[k]],z=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return yf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),To[r]}return!1}}const Ou={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},If=j,Fy={hash:!1,interactive:!0,bearingSnap:7,attributionControl:wo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Fu=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},By={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ny{constructor(e,r,a=!1){this.mousedown=_=>{this.startMouse(c.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),V.mousePos(this.element,_)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,V.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=e.dragRotate._mouseRotate.getClickTolerance(),d=e.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Tu({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:w,bearingDegreesPerPixelMoved:S=.8})=>{const k=new Su;return new ts({clickTolerance:w,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:k,enable:_,assignEvents:Fu})})({clickTolerance:l,enable:!0}),this.map=e,a&&(this.mousePitch=Pu({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:w,pitchDegreesPerPixelMoved:S=-.5})=>{const k=new Su;return new ts({clickTolerance:w,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:k,enable:_,assignEvents:Fu})})({clickTolerance:d,enable:!0})),V.addEventListener(r,"mousedown",this.mousedown),V.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(r,"touchcancel",this.reset)}startMouse(e,r){this.mouseRotate.dragStart(e,r),this.mousePitch&&this.mousePitch.dragStart(e,r),V.disableDrag()}startTouch(e,r){this.touchRotate.dragStart(e,r),this.touchPitch&&this.touchPitch.dragStart(e,r),V.disableDrag()}moveMouse(e,r){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(e,r)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(e,r)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(e,r){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(e,r)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(e,r)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let hr;function Ei(p,e,r){const a=new c.N(p.lng,p.lat);if(p=new c.N(p.lng,p.lat),e){const l=new c.N(p.lng-360,p.lat),d=new c.N(p.lng+360,p.lat),_=r.locationPoint(p).distSqr(e);r.locationPoint(l).distSqr(e)<_?p=l:r.locationPoint(d).distSqr(e)<_&&(p=d)}for(;Math.abs(p.lng-r.center.lng)>180;){const l=r.locationPoint(p);if(l.x>=0&&l.y>=0&&l.x<=r.width&&l.y<=r.height)break;p.lng>r.center.lng?p.lng-=360:p.lng+=360}return p.lng!==a.lng&&r.locationPoint(p).y>r.height/2-r.getHorizon()?p:a}const Po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tl(p,e,r){const a=p.classList;for(const l in Po)a.remove(`maplibregl-${r}-anchor-${l}`);a.add(`maplibregl-${r}-anchor-${e}`)}class Pl extends c.E{constructor(e){if(super(),this._onKeyPress=r=>{const a=r.code,l=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=r=>{const a=r.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=r=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ei(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Po[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),B.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const r=V.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${a}px`),r.setAttributeNS(null,"width",`${l}px`),r.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const d=V.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const _=V.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of S){const ce=V.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",ae.rx),ce.setAttributeNS(null,"ry",ae.ry),w.appendChild(ce)}const k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(M);const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=V.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const G=V.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const X=V.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=V.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const se=V.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),X.appendChild(Q),X.appendChild(se),_.appendChild(w),_.appendChild(k),_.appendChild(z),_.appendChild(G),_.appendChild(X),r.appendChild(_),r.setAttributeNS(null,"height",a*this._scale+"px"),r.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(r),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Tl(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,a;if(!(!((r=this._map)===null||r===void 0)&&r.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,d=l.terrain.depthAtPoint(this._pos),_=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,_)-d<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/l.transform._pixelPerMeter,S=Math.sin(l.getPitch()*Math.PI/180)*w,k=l.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=l.transform.lngLatToCameraDepth(this._lngLat,_+S)-k>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return e===void 0&&r===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Cf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ta=0,Pa=!1;const Xr={maxWidth:100,unit:"metric"};function Ia(p,e,r){const a=r&&r.maxWidth||100,l=p._container.clientHeight/2,d=p.unproject([0,l]),_=p.unproject([a,l]),w=d.distanceTo(_);if(r&&r.unit==="imperial"){const S=3.2808*w;S>5280?bt(e,a,S/5280,p._getUIString("ScaleControl.Miles")):bt(e,a,S,p._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?bt(e,a,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?bt(e,a,w/1e3,p._getUIString("ScaleControl.Kilometers")):bt(e,a,w,p._getUIString("ScaleControl.Meters"))}function bt(p,e,r,a){const l=function(d){const _=Math.pow(10,`${Math.floor(d)}`.length-1);let w=d/_;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const k=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*k)/k}(w),_*w}(r);p.style.width=e*(l/r)+"px",p.innerHTML=`${l}&nbsp;${a}`}const Rt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Il=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,p),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-p),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(p,0),right:new c.P(-p,0)}}if(p instanceof c.P||Array.isArray(p)){const e=c.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(p.center||[0,0]),top:c.P.convert(p.top||[0,0]),"top-left":c.P.convert(p["top-left"]||[0,0]),"top-right":c.P.convert(p["top-right"]||[0,0]),bottom:c.P.convert(p.bottom||[0,0]),"bottom-left":c.P.convert(p["bottom-left"]||[0,0]),"bottom-right":c.P.convert(p["bottom-right"]||[0,0]),left:c.P.convert(p.left||[0,0]),right:c.P.convert(p.right||[0,0])}}return Cl(new c.P(0,0))}const Bu=j;b.AJAXError=c.bh,b.Evented=c.E,b.LngLat=c.N,b.MercatorCoordinate=c.Z,b.Point=c.P,b.addProtocol=c.bi,b.config=c.a,b.removeProtocol=c.bj,b.AttributionControl=So,b.BoxZoomHandler=ur,b.CanvasSource=dn,b.CooperativeGesturesHandler=bo,b.DoubleClickZoomHandler=Us,b.DragPanHandler=wf,b.DragRotateHandler=Sf,b.EdgeInsets=yo,b.FullscreenControl=class extends c.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=sr,b.GeolocateControl=class extends c.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),d=c.e({bearing:l},this.options.fitBoundsOptions),_=be.fromLngLat(r,a);this._map.fitBounds(_,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Pa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Cf,p)}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(hr!==void 0&&!e)return hr;if(window.navigator.permissions===void 0)return hr=!!window.navigator.geolocation,hr;try{hr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{hr=!!window.navigator.geolocation}return hr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ta=0,Pa=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),r=p.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),r=p.getNorthEast(),a=e.distanceTo(r),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ta--,Pa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ta++,Ta>1?(p={maximumAge:6e5,timeout:0},Pa=!0):(p=this.options.positionOptions,Pa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.Hash=ml,b.ImageSource=Xn,b.KeyboardHandler=_r,b.LngLatBounds=be,b.LogoControl=Du,b.Map=class extends Tf{constructor(p){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},Fy),p);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _o(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new oi,this._controls=[],this._mapId=c.a4(),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ou),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ie.addThrottleControl(()=>this.isMoving()),this._requestManager=new Oe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const a=va(l=>{this._trackResize&&!this._removed&&(this.resize(l),this.redraw())},50);this._resizeObserver=new ResizeObserver(l=>{r?a(l):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zu(this,e),this._hash=e.hash&&new ml(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new So(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Du,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new c.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new c.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=p.onAdd(this);this._controls.push(p);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,r,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,r,a)}resize(p){var e;const r=this._containerDimensions(),a=r[0],l=r[1],d=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,d),this.painter.resize(a,l,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,S),this.painter.resize(a,l,S)}this.transform.resize(a,l),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l);const _=!this._moving;return _&&(this.stop(),this.fire(new c.k("movestart",p)).fire(new c.k("move",p))),this.fire(new c.k("resize",p)),_&&this.fire(new c.k("moveend",p)),this}_getClampedPixelRatio(p,e){const{0:r,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),d=p*l,_=e*l;return Math.min(d>r?r/d:1,_>a?a/_:1)*l}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(be.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(c.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(c.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,r){if(p==="mouseenter"||p==="mouseover"){let a=!1;return{layers:e,listener:r,delegates:{mousemove:d=>{const _=e.filter(S=>this.getLayer(S)),w=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];w.length?a||(a=!0,r.call(this,new An(p,this,d.originalEvent,{features:w}))):a=!1},mouseout:()=>{a=!1}}}}if(p==="mouseleave"||p==="mouseout"){let a=!1;return{layers:e,listener:r,delegates:{mousemove:_=>{const w=e.filter(S=>this.getLayer(S));(w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[]).length?a=!0:a&&(a=!1,r.call(this,new An(p,this,_.originalEvent)))},mouseout:_=>{a&&(a=!1,r.call(this,new An(p,this,_.originalEvent)))}}}}{const a=l=>{const d=e.filter(w=>this.getLayer(w)),_=d.length!==0?this.queryRenderedFeatures(l.point,{layers:d}):[];_.length&&(l.features=_,r.call(this,l),delete l.features)};return{layers:e,listener:r,delegates:{[p]:a}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,r){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const a=this._delegatedListeners[p];for(let l=0;l<a.length;l++){const d=a[l];if(d.listener===r&&d.layers.length===e.length&&d.layers.every(_=>e.includes(_))){for(const _ in d.delegates)this.off(_,d.delegates[_]);return void a.splice(l,1)}}}on(p,e,r){if(r===void 0)return super.on(p,e);const a=this._createDelegatedListener(p,typeof e=="string"?[e]:e,r);this._saveDelegatedListener(p,a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(p,e,r){if(r===void 0)return super.once(p,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(p,a,r);for(const d in l.delegates){const _=l.delegates[d];l.delegates[d]=(...w)=>{this._removeDelegatedListener(p,a,r),_(...w)}}this._saveDelegatedListener(p,l);for(const d in l.delegates)this.once(d,l.delegates[d]);return this}off(p,e,r){return r===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let r;const a=p instanceof c.P||Array.isArray(p),l=a?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:p)||{},l instanceof c.P||typeof l[0]=="number")r=[c.P.convert(l)];else{const d=c.P.convert(l[0]),_=c.P.convert(l[1]);r=[d,new c.P(_.x,d.y),_,new c.P(d.x,_.y),d]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Ya(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,r):this.style.loadJSON(p,e,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ya(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const r=this._requestManager.transformRequest(p,"Style");c.h(r,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(r){c.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const a=this.style._layers[r];a.type==="hillshade"&&a.source===p.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ru(this.painter,e,p),this.painter.renderToTexture=new Pf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const r=p[e]._tiles;for(const a in r){const l=r[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,r={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:k}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:N}=e,G=e;return this.style.addImage(p,{data:new c.R({width:M,height:z},new Uint8Array(N)),pixelRatio:a,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:k,sdf:l,version:0,userImage:G}),G.onAdd&&G.onAdd(this,p),this}}{const{width:M,height:z,data:N}=B.getImageData(e);this.style.addImage(p,{data:new c.R({width:M,height:z},N),pixelRatio:a,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:k,sdf:l,version:0})}}updateImage(p,e){const r=this.style.getImage(p);if(!r)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?B.getImageData(e):e,{width:l,height:d,data:_}=a;if(l===void 0||d===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==r.data.width||d!==r.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||c.b(e));return r.data.replace(_,w),this.style.updateImage(p,r),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return Ie.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,r){return this.style.setLayerZoomRange(p,e,r),this._update(!0)}setFilter(p,e,r={}){return this.style.setFilter(p,e,r),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,r,a={}){return this.style.setPaintProperty(p,e,r,a),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,r,a={}){return this.style.setLayoutProperty(p,e,r,a),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,r,a=>{a||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,r=>{r||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p){return this._lazyInitEmptyStyle(),this.style.setSky(p),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),a=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],a);const l=this._controlContainer=V.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=V.create("div",`maplibregl-ctrl-${_} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,r){this._canvas.width=Math.floor(r*p),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:p},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const r=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!r){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new fl(r,this.transform),oe.testSupport(r)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,d=B.now();this.style.zoomHistory.update(l,d);const _=new c.z(l,{now:d,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=_.crossFadingFactor();w===1&&w===this._crossFadingFactor||(r=!0,this._crossFadingFactor=w),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ie.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then(p=>{c.bf.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return If}getCameraTargetElevation(){return this.transform.elevation}},b.MapMouseEvent=An,b.MapTouchEvent=Vs,b.MapWheelEvent=vf,b.Marker=Pl,b.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,r)=>{const a=this._map._getUIString(`NavigationControl.${r}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},By,p),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ny(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const r=V.create("button",p,this._container);return r.type="button",r.addEventListener("click",e),r}},b.Popup=class extends c.E{constructor(p){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ei(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const d=Cl(this.options.offset);if(!l){const w=this._container.offsetWidth,S=this._container.offsetHeight;let k;k=a.y+d.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<w/2?k.push("left"):a.x>this._map.transform.width-w/2&&k.push("right"),l=k.length===0?"bottom":k.join("-")}let _=a.add(d[l]);this.options.subpixelPositioning||(_=_.round()),V.setTransform(this._container,`${Po[l]} translate(${_.x}px,${_.y}px)`),Tl(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Rt),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=c.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),r=document.createElement("body");let a;for(r.innerHTML=p;a=r.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Il);p&&p.focus()}},b.RasterDEMTileSource=li,b.RasterTileSource=Ht,b.ScaleControl=class{constructor(p){this._onMove=()=>{Ia(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ia(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xr),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Mr,b.Style=Ya,b.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=xo,b.TwoFingersTouchRotateHandler=ku,b.TwoFingersTouchZoomHandler=Cu,b.TwoFingersTouchZoomRotateHandler=Mu,b.VectorTileSource=In,b.VideoSource=Zr,b.addSourceType=(p,e)=>c._(void 0,void 0,void 0,function*(){if(Es(p))throw new Error(`A source type called "${p}" already exists.`);((r,a)=>{us[r]=a})(p,e)}),b.clearPrewarmedResources=function(){const p=Ui;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Pi),Ui=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return Pr().getRTLTextPluginStatus()},b.getVersion=function(){return Bu},b.getWorkerCount=function(){return Fi.workerCount},b.getWorkerUrl=function(){return c.a.WORKER_URL},b.importScriptInWorkers=function(p){return xi().broadcast("IS",p)},b.prewarm=function(){Fn().acquire(Pi)},b.setMaxParallelImageRequests=function(p){c.a.MAX_PARALLEL_IMAGE_REQUESTS=p},b.setRTLTextPlugin=function(p,e){return Pr().setRTLTextPlugin(p,e)},b.setWorkerCount=function(p){Fi.workerCount=p},b.setWorkerUrl=function(p){c.a.WORKER_URL=p}});var C=g;return C})}(dm)),dm.exports}var qz=Uz();const Kc=Xb(qz);var Op;class gb{constructor(s){H(this,Op,Qe());this.value=s}get value(){return L(I(this,Op))}set value(s){je(I(this,Op),qe(s))}}Op=new WeakMap;var Fp,Bp,Np,Vp;class Zz{constructor(){H(this,Fp,Qe());H(this,Bp,Qe(!1));Ge(this,"loadedImages",new nv);H(this,Np,Qe(0));H(this,Vp,Qe(24));Ge(this,"layerInfo",new Map);Ge(this,"eventTracker",new WeakMap);Ge(this,"eventTopMost");Ge(this,"markerClickManager",new Jz);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return L(I(this,Fp))}set map(s){je(I(this,Fp),qe(s))}get loaded(){return L(I(this,Bp))}set loaded(s){je(I(this,Bp),qe(s))}get minzoom(){return L(I(this,Np))}set minzoom(s){je(I(this,Np),qe(s))}get maxzoom(){return L(I(this,Vp))}set maxzoom(s){je(I(this,Vp),qe(s))}_eventTopMost(s){var C;let g=this.eventTracker.get(s.originalEvent);if(g!==void 0)return g;let T=(C=s.target.queryRenderedFeatures(s.point).find(b=>{var c;return(c=this.layerInfo.get(b.layer.id))==null?void 0:c.interactive}))==null?void 0:C.layer.id;return this.eventTracker.set(s.originalEvent,T),T}}Fp=new WeakMap,Bp=new WeakMap,Np=new WeakMap,Vp=new WeakMap;function Gz(h){jp(Hz,h)}function Wz(h){jp(Xz,h)}const Z1=Symbol.for("svelte-maplibre"),Hz=Symbol.for("svelte-maplibre.popup-target"),Xz=Symbol.for("svelte-maplibre.layer-event");function Wp(){return pv(Z1)}function Kz(){return jp(Z1,new Zz)}function $z(){const h=new gb(void 0),s=new gb(void 0);return Gz(h),Wz(s),{marker:h,layerEvent:s}}class Jz{constructor(){Ge(this,"_handlers",new Set)}add(s){this._handlers.add(s)}remove(s){this._handlers.delete(s)}handleClick(s){for(const g of this._handlers)g(s)}}function Yz(h){return Object.fromEntries(Object.entries(h).filter(([s,g])=>g!=null))}bb(["click"]);function Qz(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),b=ee(s,"container",3,void 0),c=Qe(void 0),j=Te(()=>typeof b()=="string"?document.querySelector(b())??void 0:b());Ct(()=>{L(j)&&!L(c)&&(je(c,qe(new Kc.FullscreenControl({container:L(j)}))),L(v).addControl(L(c),C()))}),qp(()=>{L(T)&&L(c)&&L(v).removeControl(L(c))}),It()}function eD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),b=ee(s,"positionOptions",3,void 0),c=ee(s,"fitBoundsOptions",3,void 0),j=ee(s,"trackUserLocation",3,!1),U=ee(s,"showAccuracyCircle",3,!0),K=ee(s,"showUserLocation",3,!0),B=ee(s,"control",15);Ct(()=>{L(v)&&!B()&&(B(new Kc.GeolocateControl({positionOptions:b(),fitBoundsOptions:c(),trackUserLocation:j(),showAccuracyCircle:U(),showUserLocation:K()})),L(v).addControl(B(),C()))}),qp(()=>{L(T)&&B()&&L(v).removeControl(B())}),It()}function tD(h){let s=h.getCenter(),g=Math.round(h.getZoom()*100)/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),C=Math.round(s.lat*T)/T,b=Math.round(s.lng*T)/T,c=`${g}/${C}/${b}`,j=h.getBearing(),U=h.getPitch();return(j||U)&&(c+=`/${Math.round(j*10)/10}`),U&&(c+=`/${Math.round(U)}`),`#${c}`}function iD(h){return h.replace("#","").split("/").map(parseFloat)}var Wl=Ov;function Ov(h,s){return h===s||h!==h&&s!==s?!0:typeof h!=typeof s||{}.toString.call(h)!={}.toString.call(s)||h!==Object(h)||!h?!1:Array.isArray(h)?yb(h,s):{}.toString.call(h)=="[object Set]"?yb(Array.from(h),Array.from(s)):{}.toString.call(h)=="[object Object]"?rD(h,s):nD(h,s)}function nD(h,s){return h.toString()===s.toString()}function yb(h,s){var g=h.length;if(g!=s.length)return!1;for(var v=0;v<g;v++)if(!Ov(h[v],s[v]))return!1;return!0}function rD(h,s){var g=Object.keys(h),v=g.length;if(v!=Object.keys(s).length)return!1;for(var T=0;T<v;T++){var C=g[T];if(!(s.hasOwnProperty(C)&&Ov(h[C],s[C])))return!1}return!0}function sD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),b=ee(s,"showCompass",3,!0),c=ee(s,"showZoom",3,!0),j=ee(s,"visualizePitch",3,!1),U=Qe(void 0);Ct(()=>{L(v)&&!L(U)&&(je(U,qe(new Kc.NavigationControl({showCompass:b(),showZoom:c(),visualizePitch:j()}))),L(v).addControl(L(U),C()))}),qp(()=>{L(T)&&L(U)&&L(v).removeControl(L(U))}),It()}function oD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ee(s,"position",3,"bottom-left"),b=ee(s,"maxWidth",3,void 0),c=ee(s,"unit",3,"metric"),j=Qe(void 0);Ct(()=>{L(v)&&!L(j)&&(je(j,qe(new Kc.ScaleControl({maxWidth:b(),unit:c()}))),L(v).addControl(L(j),C()))}),qp(()=>{L(T)&&L(j)&&L(v).removeControl(L(j))}),It()}var aD=Et("<!> <!> <!> <!>",1),lD=Et("<!> <!>",1),cD=Et('<div data-testid="map-container"><!></div>');function uD(h,s){Pt(s,!0);let g=ee(s,"map",15,void 0),v=ee(s,"mapContainer",15,void 0),T=ee(s,"class",3,void 0),C=ee(s,"diffStyleUpdates",3,!1),b=ee(s,"center",15,void 0),c=ee(s,"zoom",15,void 0),j=ee(s,"pitch",15,0),U=ee(s,"bearing",15,0),K=ee(s,"bounds",15,void 0),B=ee(s,"hash",3,!1),V=ee(s,"updateHash",3,mt=>{window.history.replaceState(window.history.state,"",mt)}),oe=ee(s,"loaded",15,!1),ie=ee(s,"minZoom",3,0),te=ee(s,"maxZoom",3,22),ue=ee(s,"minPitch",3,0),ve=ee(s,"maxPitch",3,60),pe=ee(s,"renderWorldCopies",3,void 0),Ie=ee(s,"dragPan",3,void 0),Oe=ee(s,"dragRotate",3,void 0),ze=ee(s,"pitchWithRotate",3,void 0),We=ee(s,"antialias",3,void 0),$e=ee(s,"zoomOnDoubleClick",3,!0),xt=ee(s,"locale",3,void 0),He=ee(s,"interactive",3,!0),Ye=ee(s,"attributionControl",3,void 0),Be=ee(s,"cooperativeGestures",3,!1),Me=ee(s,"preserveDrawingBuffer",3,!1),De=ee(s,"maxBounds",3,void 0),Ae=ee(s,"images",19,()=>[]),Ue=ee(s,"standardControls",3,!1),et=ee(s,"filterLayers",3,void 0),pt=ee(s,"transformRequest",3,void 0),ut=Te(()=>typeof Ue()=="boolean"?void 0:Ue());const ct=Kz();let at=Qe(qe(new Set));async function Mt(mt,Bt=!1){var be;if(g()&&!(!((be=g())!=null&&be.loaded())&&!Bt))if("url"in mt){L(at).add(mt.id);try{let ki=await g().loadImage(mt.url);g().addImage(mt.id,ki.data,mt.options),ct.loadedImages.add(mt.id)}catch(ki){s.onerror?s.onerror({error:ki}):console.error(ki)}finally{L(at).delete(mt.id)}}else g().addImage(mt.id,mt.data,mt.options),ct.loadedImages.add(mt.id)}Ct(()=>{var mt;if(oe()&&((mt=g())!=null&&mt.loaded()))for(let Bt of Ae())!ct.loadedImages.has(Bt.id)&&!L(at).has(Bt.id)&&!g().hasImage(Bt.id)&&Mt(Bt)});let Yt=Te(()=>Ae().every(mt=>ct.loadedImages.has(mt.id))),yi=Qe(void 0),Pi=Qe(void 0),Fi=Qe(void 0),sn=Qe(void 0);function Ui(mt){s.onerror?s.onerror(mt):mt.error.name!=="AbortError"&&console.error(mt.error)}function Hi(mt){return Xi(),g(ct.map=new Kc.Map(Yz({container:mt,style:s.style,locale:xt(),center:b(),zoom:c(),pitch:j(),bearing:U(),minZoom:ie(),maxZoom:te(),minPitch:ue(),maxPitch:ve(),renderWorldCopies:pe(),dragPan:Ie(),dragRotate:Oe(),pitchWithRotate:ze(),antialias:We(),interactive:He(),preserveDrawingBuffer:Me(),maxBounds:De(),bounds:K(),attributionControl:Ye(),transformRequest:pt(),cooperativeGestures:Be()}))),g().on("load",Bt=>{Bt.target.getContainer().setAttribute("data-testid","map"),Bt.target.getCanvas().setAttribute("data-testid","map-canvas"),s.onload&&s.onload(g()),ct.loaded=!0,oe(!0)}),g().on("error",Ui),s.onmovestart&&g().on("movestart",s.onmovestart),g().on("moveend",Bt=>{var be;if(b(Bt.target.getCenter()),c(Bt.target.getZoom()),j(Bt.target.getPitch()),U(Bt.target.getBearing()),K(Bt.target.getBounds()),(be=s.onmoveend)==null||be.call(s,Bt),B()){let ki=new URL(window.location.href.replace(/(#.+)?$/,tD(Bt.target)));V()(ki)}}),s.onclick&&g().on("click",s.onclick),s.ondblclick&&g().on("dblclick",s.ondblclick),s.oncontextmenu&&g().on("contextmenu",s.oncontextmenu),s.onmousemove&&g().on("mousemove",s.onmousemove),s.onzoomstart&&g().on("zoomstart",s.onzoomstart),s.onzoom&&g().on("zoom",s.onzoom),s.onzoomend&&g().on("zoomend",s.onzoomend),s.onpitch&&g().on("pitch",s.onpitch),s.onrotate&&g().on("rotate",s.onrotate),s.onwheel&&g().on("wheel",s.onwheel),s.ondata&&g().on("data",s.ondata),s.onidle&&g().on("idle",s.onidle),g().on("style.load",()=>{if(g()){const Bt=g().getStyle();if(je(yi,qe(Bt.layers.map(be=>be.id))),je(Pi,qe(Object.keys(Bt.sources))),L(sn))for(const[be,ki]of Object.entries(L(sn)))g().addSource(be,ki);if(L(Fi))for(const be of L(Fi))g().addLayer(be);for(const be of Ae())Mt(be,!0)}}),g().on("styledata",Bt=>{var be;if(g()&&et()){const ki=g().getStyle().layers;if(ki)for(let In of ki)et()(In)||g().setLayoutProperty(In.id,"visibility","none")}(be=s.onstyledata)==null||be.call(s,Bt)}),{destroy(){var Bt;oe(!1),ct.loaded=!1,(Bt=g())==null||Bt.remove()}}}let Fn=Qe(qe(s.style));Ct(()=>{if(g()&&!Wl(s.style,L(Fn))){const mt=g().getStyle();if(L(yi)&&je(Fi,qe(mt.layers.filter(Bt=>!L(yi).includes(Bt.id)))),L(Pi)){const Bt=Object.keys(mt.sources).filter(be=>!L(Pi).includes(be));je(sn,qe({}));for(const be of Bt)L(sn)[be]=mt.sources[be]}je(Fn,qe(s.style)),g().setStyle(s.style,{diff:C()}),ct.loadedImages.clear(),je(at,qe(new Set))}}),Ct(()=>{if(g()){let mt={};b()!=null&&!Wl(b(),g().getCenter())&&(mt.center=b()),c()!=null&&!Wl(c(),g().getZoom())&&(mt.zoom=c()),U()!=null&&!Wl(U(),g().getBearing())&&(mt.bearing=U()),j()!=null&&!Wl(j(),g().getPitch())&&(mt.pitch=j()),Object.keys(mt).length&&g().easeTo(mt)}}),Ct(()=>{var mt,Bt;K()&&!Wl(K(),(mt=g())==null?void 0:mt.getBounds())&&((Bt=g())==null||Bt.fitBounds(K()))}),Ct(()=>{var mt,Bt;$e()?(mt=g())==null||mt.doubleClickZoom.enable():(Bt=g())==null||Bt.doubleClickZoom.disable()});function Xi(){if(B()){let mt=iD(window.location.hash);mt.length>=3&&(c(mt[0]),b([mt[2],mt[1]])),mt.length==5&&(U(mt[3]),j(mt[4]))}}var xi=cD();H_("hashchange",fS,Xi);var cn=qt(xi);{var Ki=mt=>{var Bt=lD(),be=Le(Bt);{var ki=Ht=>{var li=aD(),sr=Le(li);sD(sr,{get position(){return L(ut)}});var _n=Wt(sr,2);eD(_n,{get position(){return L(ut)},fitBoundsOptions:{maxZoom:12}});var Xn=Wt(_n,2);Qz(Xn,{get position(){return L(ut)}});var Zr=Wt(Xn,2);oD(Zr,{get position(){return L(ut)}}),_e(Ht,li)};fi(be,Ht=>{Ue()&&Ht(ki)})}var In=Wt(be,2);Ot(In,()=>s.children??ti,()=>({map:g(),loadedImages:ct.loadedImages,allImagesLoaded:L(Yt)})),_e(mt,Bt)};fi(cn,mt=>{g()&&oe()&&mt(Ki)})}Vt(xi),Vc(xi,mt=>v(mt),()=>v()),K_(xi,mt=>Hi==null?void 0:Hi(mt)),zt(()=>{Mb(xi,`${T()??""} svelte-p00lfq`),SS(xi,"expand-map",!T())}),_e(h,xi),It()}function hD(h,s){h.key===" "&&(h.preventDefault(),h.stopPropagation(),s("click"))}var dD=(h,s)=>{h.stopPropagation(),s("click")},pD=(h,s)=>{h.stopPropagation(),s("dblclick")},fD=(h,s)=>{h.stopPropagation(),h.preventDefault(),s("contextmenu")},mD=(h,s)=>s("mousemove"),gD=Et("<div><!></div>");function yD(h,s){Pt(s,!0);let g=ee(s,"marker",15,void 0),v=ee(s,"lngLat",15),T=ee(s,"class",3,void 0),C=ee(s,"interactive",3,!0),b=ee(s,"asButton",3,!1),c=ee(s,"draggable",3,!1),j=ee(s,"feature",3,void 0),U=ee(s,"offset",3,void 0),K=ee(s,"zIndex",3,void 0),B=ee(s,"rotation",3,0),V=ee(s,"opacity",3,1),oe=Kt(s,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const ie=Te(Wp),te=Te(()=>L(ie).map),ue=Te(()=>L(ie).markerClickManager),{layerEvent:ve,marker:pe}=$z();function Ie(He){pe.value=new Kc.Marker({element:He,rotation:B(),draggable:c(),offset:U(),opacity:V().toString()}).setLngLat(v()).addTo(L(te)),g(pe.value);const Ye=()=>We("dragstart"),Be=()=>{ze(),We("drag")},Me=()=>{ze(),We("dragend")};return c()&&(pe.value.on("dragstart",Ye),pe.value.on("drag",Be),pe.value.on("dragend",Me)),{destroy(){var De,Ae,Ue,et;c()&&((De=pe.value)==null||De.off("dragstart",Ye),(Ae=pe.value)==null||Ae.off("drag",Be),(Ue=pe.value)==null||Ue.off("dragend",Me)),g(void 0),(et=pe.value)==null||et.remove()}}}function Oe(He,Ye){const Be=He.className;function Me(De){De?He.className=`${Be} ${De}`:He.className=Be}return Me(Ye),{update:Me}}Ct(()=>{var He;(He=pe.value)==null||He.setLngLat(v())}),Ct(()=>{var He;(He=pe.value)==null||He.setOffset(U()??[0,0])}),Ct(()=>{var He;(He=pe.value)==null||He.setRotation(B())}),Ct(()=>{var He;(He=pe.value)==null||He.setOpacity(V().toString())});function ze(){var Ye;let He=(Ye=pe.value)==null?void 0:Ye.getLngLat();He&&(Array.isArray(v())?v([He.lng,He.lat]):v()&&"lon"in v()?v({lon:He.lng,lat:He.lat}):v(He))}function We(He){var Ae,Ue;if(!C())return;let Ye=(Ae=pe.value)==null?void 0:Ae.getLngLat();if(!Ye)return;const Be=[Ye.lng,Ye.lat];let Me={map:L(te),marker:pe.value,lngLat:Be,features:[{type:"Feature",properties:((Ue=j())==null?void 0:Ue.properties)??{},geometry:{type:"Point",coordinates:Be}}]};(He==="click"||He==="contextmenu")&&L(ue).handleClick(Me),ve.value={...Me,layerType:"marker",type:He};const De=oe["on"+He];De==null||De(Me)}var $e=gD();$e.__click=[dD,We],$e.__dblclick=[pD,We],$e.__contextmenu=[fD,We],$e.__mousemove=[mD,We],$e.__keydown=[hD,We];var xt=qt($e);Ot(xt,()=>s.children??ti,()=>({marker:pe.value})),Vt($e),K_($e,He=>Ie==null?void 0:Ie(He)),K_($e,(He,Ye)=>Oe==null?void 0:Oe(He,Ye),T),zt(()=>{mh($e,"tabindex",b()?0:void 0),mh($e,"role",b()?"button":void 0),TS($e,"z-index",K())}),H_("mouseenter",$e,()=>{We("mouseenter")}),H_("mouseleave",$e,()=>{We("mouseleave")}),_e(h,$e),It()}bb(["click","dblclick","contextmenu","mousemove","keydown"]);var Hp=Uint8Array,G1=Uint16Array,_D=Int32Array,vD=new Hp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xD=new Hp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),W1=function(h,s){for(var g=new G1(31),v=0;v<31;++v)g[v]=s+=1<<h[v-1];for(var T=new _D(g[30]),v=1;v<30;++v)for(var C=g[v];C<g[v+1];++C)T[C]=C-g[v]<<5|v;return{b:g,r:T}},H1=W1(vD,2),bD=H1.b,wD=H1.r;bD[28]=258,wD[258]=28;W1(xD,0);var SD=new G1(32768);for(Ti=0;Ti<32768;++Ti)Ks=(Ti&43690)>>1|(Ti&21845)<<1,Ks=(Ks&52428)>>2|(Ks&13107)<<2,Ks=(Ks&61680)>>4|(Ks&3855)<<4,SD[Ti]=((Ks&65280)>>8|(Ks&255)<<8)>>1;var Ks,Ti,py=new Hp(288);for(Ti=0;Ti<144;++Ti)py[Ti]=8;var Ti;for(Ti=144;Ti<256;++Ti)py[Ti]=9;var Ti;for(Ti=256;Ti<280;++Ti)py[Ti]=7;var Ti;for(Ti=280;Ti<288;++Ti)py[Ti]=8;var Ti,TD=new Hp(32);for(Ti=0;Ti<32;++Ti)TD[Ti]=5;var Ti,PD=new Hp(0),ID=typeof TextDecoder<"u"&&new TextDecoder,CD=0;try{ID.decode(PD,{stream:!0}),CD=1}catch{}var AD=Et("<!> <!>",1),kD=Et('<!> <span class="mr-auto"><!></span>',1),ED=Et("<!> <!>",1),MD=Et("<!> <!>",1),zD=Et("<!> <!>",1),DD=Et("<!> <!>",1),LD=Et('<div class="mx-auto w-full max-w-md px-4 pb-6 md:px-0"><!> <!></div>'),RD=Et('<!> <div class="absolute left-1/2 top-2.5 z-10 -translate-x-1/2"><!></div> <!> <!>',1);function HD(h,s){Pt(s,!0);const g=vb(),v=()=>xb(xS,"$mode",g);let T=Qe(qe(new Date));const C=setInterval(()=>je(T,qe(new Date)),60*1e3);qp(()=>clearInterval(C));let b=Qe(!1),c=Qe(null);const j=new D1("campus",""),U=Te(()=>fb.find(Ye=>Ye.value===j.current));let K=Qe(null);const B=`https://api.maptiler.com/maps/topo-v2/style.json?key=${Dx}`,V=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${Dx}`,oe=Te(()=>v()==="dark"?V:B);let ie=Qe(!1),te=Qe(void 0);const ue=Te(()=>{var Ye,Be;return Vx(L(te),(Be=(Ye=L(U))==null?void 0:Ye.metadata)==null?void 0:Be.timezone,L(T))});function ve(Ye){je(ie,!0),je(te,qe(Ye))}function pe(){je(b,!1),ay().then(()=>{L(c).focus()})}Ct(()=>{var Ye;if(L(U)){const Be=(Ye=L(U).metadata)==null?void 0:Ye.display;L(K).jumpTo({center:L(U).location,zoom:(Be==null?void 0:Be.zoom)??16,pitch:(Be==null?void 0:Be.pitch)??60,bearing:(Be==null?void 0:Be.bearing)??0})}});var Ie=RD();X2(Ye=>{zt(()=>mS.title=hT())});var Oe=Le(Ie);uD(Oe,{get map(){return L(K)},set map(Ye){je(K,qe(Ye))},get style(){return L(oe)},class:"min-h-screen",standardControls:!0,children:(Ye,Be)=>{var Me=Xe(),De=Le(Me);{var Ae=Ue=>{var et=Xe(),pt=Le(et);Hl(pt,17,()=>L(U).spaces,Xl,(ut,ct)=>{yD(ut,{get lngLat(){return L(ct).location},class:"cursor-pointer",onclick:()=>ve(L(ct)),children:(at,Mt)=>{var Yt=Te(()=>{var yi;return Vx(L(ct),(yi=L(U).metadata)==null?void 0:yi.timezone,L(T))});LM(at,{get status(){return L(Yt)}})},$$slots:{default:!0}})}),_e(Ue,et)};fi(De,Ue=>{L(U)&&Ue(Ae)})}_e(Ye,Me)},$$slots:{default:!0}});var ze=Wt(Oe,2),We=qt(ze);si(We,()=>Oz,(Ye,Be)=>{Be(Ye,{get open(){return L(b)},set open(Me){je(b,qe(Me))},children:(Me,De)=>{var Ae=zD(),Ue=Le(Ae);si(Ue,()=>Fz,(pt,ut)=>{ut(pt,{get ref(){return L(c)},set ref(at){je(c,qe(at))},child:(at,Mt)=>{um(at,Gt({variant:"outline",class:"w-60 justify-between"},()=>Mt==null?void 0:Mt().props,{role:"combobox",get"aria-expanded"(){return L(b)},children:(yi,Pi)=>{var Fi=AD(),sn=Le(Fi);{var Ui=Xi=>{var xi=Xe(),cn=Le(xi);lm(cn,()=>fh(L(U).label,hi()),Ki=>{var mt=On("...");_e(Ki,mt)},(Ki,mt)=>{var Bt=On();zt(()=>Ri(Bt,L(mt))),_e(Ki,Bt)},Ki=>{var mt=On();zt(()=>Ri(mt,L(U).label)),_e(Ki,mt)}),_e(Xi,xi)},Hi=Xi=>{var xi=On();zt(()=>Ri(xi,fT())),_e(Xi,xi)};fi(sn,Xi=>{var xi;(xi=L(U))!=null&&xi.label?Xi(Ui):Xi(Hi,!1)})}var Fn=Wt(sn,2);jE(Fn,{class:"opacity-50"}),_e(yi,Fi)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var et=Wt(Ue,2);si(et,()=>Rz,(pt,ut)=>{ut(pt,{class:"w-60 p-0",children:(ct,at)=>{var Mt=Xe(),Yt=Le(Mt);si(Yt,()=>RM,(yi,Pi)=>{Pi(yi,{children:(Fi,sn)=>{var Ui=MD(),Hi=Le(Ui),Fn=Te(()=>yT());si(Hi,()=>VM,(xi,cn)=>{cn(xi,{get placeholder(){return L(Fn)}})});var Xi=Wt(Hi,2);si(Xi,()=>UM,(xi,cn)=>{cn(xi,{children:(Ki,mt)=>{var Bt=ED(),be=Le(Bt);si(be,()=>OM,(In,Ht)=>{Ht(In,{children:(li,sr)=>{ia();var _n=On();zt(()=>Ri(_n,xT())),_e(li,_n)},$$slots:{default:!0}})});var ki=Wt(be,2);si(ki,()=>BM,(In,Ht)=>{Ht(In,{children:(li,sr)=>{var _n=Xe(),Xn=Le(_n);Hl(Xn,17,()=>fb,Xl,(Zr,dn)=>{var us=Xe(),Es=Le(us);si(Es,()=>jM,(Je,mr)=>{mr(Je,{get value(){return L(dn).value},onSelect:()=>{j.current=L(dn).value,pe()},children:(vn,Pr)=>{var Ir=kD(),tt=Le(Ir),$t=Te(()=>Ni(j.current!==L(dn).value&&"text-transparent"));VE(tt,{get class(){return L($t)}});var Ft=Wt(tt,2),Cn=qt(Ft);lm(Cn,()=>fh(L(dn).label,hi()),xn=>{var Nt=On("...");_e(xn,Nt)},(xn,Nt)=>{var or=On();zt(()=>Ri(or,L(Nt))),_e(xn,or)},xn=>{var Nt=On();zt(()=>Ri(Nt,L(dn).label)),_e(xn,Nt)}),Vt(Ft),_e(vn,Ir)},$$slots:{default:!0}})}),_e(Zr,us)}),_e(li,_n)},$$slots:{default:!0}})}),_e(Ki,Bt)},$$slots:{default:!0}})}),_e(Fi,Ui)},$$slots:{default:!0}})}),_e(ct,Mt)},$$slots:{default:!0}})}),_e(Me,Ae)},$$slots:{default:!0}})}),Vt(ze);var $e=Wt(ze,2);dM($e,{});var xt=Wt($e,2);{var He=Ye=>{var Be=Xe(),Me=Le(Be);si(Me,()=>Lz,(De,Ae)=>{Ae(De,{get open(){return L(ie)},set open(Ue){je(ie,qe(Ue))},children:(Ue,et)=>{var pt=Xe(),ut=Le(pt);si(ut,()=>kz,(ct,at)=>{at(ct,{children:(Mt,Yt)=>{var yi=LD(),Pi=qt(yi);si(Pi,()=>zz,(sn,Ui)=>{Ui(sn,{children:(Hi,Fn)=>{var Xi=DD(),xi=Le(Xi);si(xi,()=>Dz,(Ki,mt)=>{mt(Ki,{children:(Bt,be)=>{var ki=Xe(),In=Le(ki);lm(In,()=>fh(L(te).label,hi()),Ht=>{var li=On("...");_e(Ht,li)},(Ht,li)=>{var sr=On();zt(()=>Ri(sr,L(li))),_e(Ht,sr)},Ht=>{var li=On();zt(()=>Ri(li,L(te).label)),_e(Ht,li)}),_e(Bt,ki)},$$slots:{default:!0}})});var cn=Wt(xi,2);si(cn,()=>Ez,(Ki,mt)=>{mt(Ki,{children:(Bt,be)=>{cm(Bt,{get status(){return L(ue)}})},$$slots:{default:!0}})}),_e(Hi,Xi)},$$slots:{default:!0}})});var Fi=Wt(Pi,2);zM(Fi,{get space(){return L(te)}}),Vt(yi),_e(Mt,yi)},$$slots:{default:!0}})}),_e(Ue,pt)},$$slots:{default:!0}})}),_e(Ye,Be)};fi(xt,Ye=>{L(te)&&Ye(He)})}_e(h,Ie),It()}export{HD as component};
