var h2=Object.defineProperty;var d2=Object.getPrototypeOf;var p2=Reflect.get;var u0=f=>{throw TypeError(f)};var f2=(f,s,g)=>s in f?h2(f,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):f[s]=g;var Oe=(f,s,g)=>f2(f,typeof s!="symbol"?s+"":s,g),Ty=(f,s,g)=>s.has(f)||u0("Cannot "+g);var T=(f,s,g)=>(Ty(f,s,"read from private field"),g?g.call(f):s.get(f)),W=(f,s,g)=>s.has(f)?u0("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(f):s.set(f,g),Le=(f,s,g,v)=>(Ty(f,s,"write to private field"),v?v.call(f,g):s.set(f,g),g),jn=(f,s,g)=>(Ty(f,s,"access private method"),g);var Iy=(f,s,g,v)=>({set _(I){Le(f,s,I,g)},get _(){return T(f,s,v)}}),h0=(f,s,g)=>p2(d2(f),g,s);import{c as m2,p as g2,l as Ke,a as Te,t as Vt,m as Aa,q as _2,g as eb,s as Vy}from"../chunks/legacy.Dm4gyfrH.js";import{a7 as y2,W as v2,a0 as x2,x as hs,j as d0,k as Ay,J as b2,K as w2,w as S2,g as P2,v as T2,e as p0,h as f0,y as I2,aR as tb,L as A2,aa as C2,aC as E2,M as k2,C as Ri,N as ib,G as M2,V as z2,aw as D2,U as Ve,p as Et,f as Ne,a as kt,c as ci,T as Xt,r as ui,t as di,F as R,I as Pe,av as Ye,B as At,au as rv,_ as Bp,aS as rb,$ as nv,A as R2,aT as L2,aU as O2,a2 as Zs,u as F2,an as $g,s as Ci,aV as Us,aW as B2,aX as N2}from"../chunks/runtime.B76Vjo_i.js";import{m as V2,u as m0,s as ah}from"../chunks/render.DC6ny83U.js";import{p as J,i as hi,r as Gt,a as Ze,o as nb,s as ri,l as Ko,b as e_}from"../chunks/index-client.BrO4ukPi.js";import{q as Ct,k as sb,e as jy,s as ja,i as Uy,r as j2,b as U2}from"../chunks/mode.CHMDlCvN.js";import{b as tm,c as Yt}from"../chunks/this.QRC2F710.js";import{s as q2,h as Z2,a as G2}from"../chunks/store.BvVuv4PB.js";import{g as t_,c as Oi,r as H2,s as qy}from"../chunks/index.DKNLSslk.js";import{i as W2}from"../chunks/lifecycle.CU51bgik.js";const X2=[];function ob(f,s=!1){return Qf(f,new Map,"",X2)}function Qf(f,s,g,v,I=null){if(typeof f=="object"&&f!==null){const w=s.get(f);if(w!==void 0)return w;if(f instanceof Map)return new Map(f);if(f instanceof Set)return new Set(f);if(y2(f)){const c=[];s.set(f,c),I!==null&&s.set(I,c);for(let U=0;U<f.length;U+=1)c.push(Qf(f[U],s,g,v));return c}if(v2(f)===x2){const c={};s.set(f,c),I!==null&&s.set(I,c);for(var E in f)c[E]=Qf(f[E],s,g,v);return c}if(f instanceof Date)return structuredClone(f);if(typeof f.toJSON=="function")return Qf(f.toJSON(),s,g,v,f)}if(f instanceof EventTarget)return f;try{return structuredClone(f)}catch{return f}}function K2(f,s,g,v,I,E){let w=hs;hs&&d0();var c,U,q=null;hs&&Ay.nodeType===1&&(q=Ay,d0());var K=hs?Ay:f,V;b2(()=>{const N=s()||null;var ie=tb;N!==c&&(V&&(N===null?A2(V,()=>{V=null,U=null}):N===U?C2(V):E2(V)),N&&N!==U&&(V=S2(()=>{if(q=hs?q:document.createElementNS(ie,N),m2(q,q),v){var te=hs?P2(q):q.appendChild(T2());hs&&(te===null?p0(!1):f0(te)),v(q,te)}I2.nodes_end=q,K.before(q)})),c=N,c&&(U=c))},w2),w&&(p0(!0),f0(K))}function Zy(f,s,g){k2(()=>{var v=Ri(()=>s(f,g==null?void 0:g())||{});if(g&&(v!=null&&v.update)){var I=!1,E={};ib(()=>{var w=g();M2(w),I&&z2(E,w)&&(E=w,v.update(w))}),I=!0}if(v!=null&&v.destroy)return()=>v.destroy()})}function J2(f,s){var g=f.__className,v=Y2(s);hs&&f.className===v?f.__className=v:(g!==v||hs&&f.className!==v)&&(s==null?f.removeAttribute("class"):f.className=v,f.__className=v)}function Y2(f){return f??""}function Q2(f,s,g){if(g){if(f.classList.contains(s))return;f.classList.add(s)}else{if(!f.classList.contains(s))return;f.classList.remove(s)}}function $2(f,s,g,v){var I=f.__styles??(f.__styles={});I[s]!==g&&(I[s]=g,g==null?f.style.removeProperty(s):f.style.setProperty(s,g,""))}function eS(f,s,g=s){var v=D2();g2(f,"input",I=>{var E=I?f.defaultValue:f.value;E=Cy(f)?Ey(E):E,g(E),v&&E!==(E=s())&&(f.value=E??"")}),(hs&&f.defaultValue!==f.value||Ri(s)==null&&f.value)&&g(Cy(f)?Ey(f.value):f.value),ib(()=>{var I=s();Cy(f)&&I===Ey(f.value)||f.type==="date"&&!I&&!f.value||I!==f.value&&(f.value=I??"")})}function Cy(f){var s=f.type;return s==="number"||s==="range"}function Ey(f){return f===""?null:+f}function Bo(f){Ve(f,f.v+1)}const g0="LYsosKTbN7Q5Pq1NzJI1";var _0=f=>typeof f=="boolean"?`${f}`:f===0?"0":f,pn=f=>!f||typeof f!="object"||Object.keys(f).length===0,tS=(f,s)=>JSON.stringify(f)===JSON.stringify(s);function ab(f,s){f.forEach(function(g){Array.isArray(g)?ab(g,s):s.push(g)})}function lb(f){let s=[];return ab(f,s),s}var cb=(...f)=>lb(f).filter(Boolean),ub=(f,s)=>{let g={},v=Object.keys(f),I=Object.keys(s);for(let E of v)if(I.includes(E)){let w=f[E],c=s[E];Array.isArray(w)||Array.isArray(c)?g[E]=cb(c,w):typeof w=="object"&&typeof c=="object"?g[E]=ub(w,c):g[E]=c+" "+w}else g[E]=f[E];for(let E of I)v.includes(E)||(g[E]=s[E]);return g},y0=f=>!f||typeof f!="string"?f:f.replace(/\s+/g," ").trim();const sv="-",iS=f=>{const s=nS(f),{conflictingClassGroups:g,conflictingClassGroupModifiers:v}=f;return{getClassGroupId:w=>{const c=w.split(sv);return c[0]===""&&c.length!==1&&c.shift(),hb(c,s)||rS(w)},getConflictingClassGroupIds:(w,c)=>{const U=g[w]||[];return c&&v[w]?[...U,...v[w]]:U}}},hb=(f,s)=>{var w;if(f.length===0)return s.classGroupId;const g=f[0],v=s.nextPart.get(g),I=v?hb(f.slice(1),v):void 0;if(I)return I;if(s.validators.length===0)return;const E=f.join(sv);return(w=s.validators.find(({validator:c})=>c(E)))==null?void 0:w.classGroupId},v0=/^\[(.+)\]$/,rS=f=>{if(v0.test(f)){const s=v0.exec(f)[1],g=s==null?void 0:s.substring(0,s.indexOf(":"));if(g)return"arbitrary.."+g}},nS=f=>{const{theme:s,prefix:g}=f,v={nextPart:new Map,validators:[]};return oS(Object.entries(f.classGroups),g).forEach(([E,w])=>{Gy(w,v,E,s)}),v},Gy=(f,s,g,v)=>{f.forEach(I=>{if(typeof I=="string"){const E=I===""?s:x0(s,I);E.classGroupId=g;return}if(typeof I=="function"){if(sS(I)){Gy(I(v),s,g,v);return}s.validators.push({validator:I,classGroupId:g});return}Object.entries(I).forEach(([E,w])=>{Gy(w,x0(s,E),g,v)})})},x0=(f,s)=>{let g=f;return s.split(sv).forEach(v=>{g.nextPart.has(v)||g.nextPart.set(v,{nextPart:new Map,validators:[]}),g=g.nextPart.get(v)}),g},sS=f=>f.isThemeGetter,oS=(f,s)=>s?f.map(([g,v])=>{const I=v.map(E=>typeof E=="string"?s+E:typeof E=="object"?Object.fromEntries(Object.entries(E).map(([w,c])=>[s+w,c])):E);return[g,I]}):f,aS=f=>{if(f<1)return{get:()=>{},set:()=>{}};let s=0,g=new Map,v=new Map;const I=(E,w)=>{g.set(E,w),s++,s>f&&(s=0,v=g,g=new Map)};return{get(E){let w=g.get(E);if(w!==void 0)return w;if((w=v.get(E))!==void 0)return I(E,w),w},set(E,w){g.has(E)?g.set(E,w):I(E,w)}}},db="!",lS=f=>{const{separator:s,experimentalParseClassName:g}=f,v=s.length===1,I=s[0],E=s.length,w=c=>{const U=[];let q=0,K=0,V;for(let ue=0;ue<c.length;ue++){let ye=c[ue];if(q===0){if(ye===I&&(v||c.slice(ue,ue+E)===s)){U.push(c.slice(K,ue)),K=ue+E;continue}if(ye==="/"){V=ue;continue}}ye==="["?q++:ye==="]"&&q--}const N=U.length===0?c:c.substring(K),ie=N.startsWith(db),te=ie?N.substring(1):N,oe=V&&V>K?V-K:void 0;return{modifiers:U,hasImportantModifier:ie,baseClassName:te,maybePostfixModifierPosition:oe}};return g?c=>g({className:c,parseClassName:w}):w},cS=f=>{if(f.length<=1)return f;const s=[];let g=[];return f.forEach(v=>{v[0]==="["?(s.push(...g.sort(),v),g=[]):g.push(v)}),s.push(...g.sort()),s},uS=f=>({cache:aS(f.cacheSize),parseClassName:lS(f),...iS(f)}),hS=/\s+/,dS=(f,s)=>{const{parseClassName:g,getClassGroupId:v,getConflictingClassGroupIds:I}=s,E=[],w=f.trim().split(hS);let c="";for(let U=w.length-1;U>=0;U-=1){const q=w[U],{modifiers:K,hasImportantModifier:V,baseClassName:N,maybePostfixModifierPosition:ie}=g(q);let te=!!ie,oe=v(te?N.substring(0,ie):N);if(!oe){if(!te){c=q+(c.length>0?" "+c:c);continue}if(oe=v(N),!oe){c=q+(c.length>0?" "+c:c);continue}te=!1}const ue=cS(K).join(":"),ye=V?ue+db:ue,pe=ye+oe;if(E.includes(pe))continue;E.push(pe);const Ae=I(oe,te);for(let ze=0;ze<Ae.length;++ze){const Me=Ae[ze];E.push(ye+Me)}c=q+(c.length>0?" "+c:c)}return c};function pS(){let f=0,s,g,v="";for(;f<arguments.length;)(s=arguments[f++])&&(g=pb(s))&&(v&&(v+=" "),v+=g);return v}const pb=f=>{if(typeof f=="string")return f;let s,g="";for(let v=0;v<f.length;v++)f[v]&&(s=pb(f[v]))&&(g&&(g+=" "),g+=s);return g};function Hy(f,...s){let g,v,I,E=w;function w(U){const q=s.reduce((K,V)=>V(K),f());return g=uS(q),v=g.cache.get,I=g.cache.set,E=c,c(U)}function c(U){const q=v(U);if(q)return q;const K=dS(U,g);return I(U,K),K}return function(){return E(pS.apply(null,arguments))}}const Zi=f=>{const s=g=>g[f]||[];return s.isThemeGetter=!0,s},fb=/^\[(?:([a-z-]+):)?(.+)\]$/i,fS=/^\d+\/\d+$/,mS=new Set(["px","full","screen"]),gS=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,_S=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,yS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,vS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Vs=f=>Nl(f)||mS.has(f)||fS.test(f),Lo=f=>Nc(f,"length",CS),Nl=f=>!!f&&!Number.isNaN(Number(f)),ky=f=>Nc(f,"number",Nl),$u=f=>!!f&&Number.isInteger(Number(f)),bS=f=>f.endsWith("%")&&Nl(f.slice(0,-1)),ei=f=>fb.test(f),Oo=f=>gS.test(f),wS=new Set(["length","size","percentage"]),SS=f=>Nc(f,wS,mb),PS=f=>Nc(f,"position",mb),TS=new Set(["image","url"]),IS=f=>Nc(f,TS,kS),AS=f=>Nc(f,"",ES),eh=()=>!0,Nc=(f,s,g)=>{const v=fb.exec(f);return v?v[1]?typeof s=="string"?v[1]===s:s.has(v[1]):g(v[2]):!1},CS=f=>_S.test(f)&&!yS.test(f),mb=()=>!1,ES=f=>vS.test(f),kS=f=>xS.test(f),Wy=()=>{const f=Zi("colors"),s=Zi("spacing"),g=Zi("blur"),v=Zi("brightness"),I=Zi("borderColor"),E=Zi("borderRadius"),w=Zi("borderSpacing"),c=Zi("borderWidth"),U=Zi("contrast"),q=Zi("grayscale"),K=Zi("hueRotate"),V=Zi("invert"),N=Zi("gap"),ie=Zi("gradientColorStops"),te=Zi("gradientColorStopPositions"),oe=Zi("inset"),ue=Zi("margin"),ye=Zi("opacity"),pe=Zi("padding"),Ae=Zi("saturate"),ze=Zi("scale"),Me=Zi("sepia"),je=Zi("skew"),Je=Zi("space"),_t=Zi("translate"),Ge=()=>["auto","contain","none"],gt=()=>["auto","hidden","clip","visible","scroll"],at=()=>["auto",ei,s],Ue=()=>[ei,s],Fe=()=>["",Vs,Lo],Ce=()=>["auto",Nl,ei],He=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],st=()=>["solid","dashed","dotted","double","none"],yt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],xt=()=>["start","end","center","between","around","evenly","stretch"],ht=()=>["","0",ei],mt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Rt=()=>[Nl,ei];return{cacheSize:500,separator:":",theme:{colors:[eh],spacing:[Vs,Lo],blur:["none","",Oo,ei],brightness:Rt(),borderColor:[f],borderRadius:["none","","full",Oo,ei],borderSpacing:Ue(),borderWidth:Fe(),contrast:Rt(),grayscale:ht(),hueRotate:Rt(),invert:ht(),gap:Ue(),gradientColorStops:[f],gradientColorStopPositions:[bS,Lo],inset:at(),margin:at(),opacity:Rt(),padding:Ue(),saturate:Rt(),scale:Rt(),sepia:ht(),skew:Rt(),space:Ue(),translate:Ue()},classGroups:{aspect:[{aspect:["auto","square","video",ei]}],container:["container"],columns:[{columns:[Oo]}],"break-after":[{"break-after":mt()}],"break-before":[{"break-before":mt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...He(),ei]}],overflow:[{overflow:gt()}],"overflow-x":[{"overflow-x":gt()}],"overflow-y":[{"overflow-y":gt()}],overscroll:[{overscroll:Ge()}],"overscroll-x":[{"overscroll-x":Ge()}],"overscroll-y":[{"overscroll-y":Ge()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[oe]}],"inset-x":[{"inset-x":[oe]}],"inset-y":[{"inset-y":[oe]}],start:[{start:[oe]}],end:[{end:[oe]}],top:[{top:[oe]}],right:[{right:[oe]}],bottom:[{bottom:[oe]}],left:[{left:[oe]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",$u,ei]}],basis:[{basis:at()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ei]}],grow:[{grow:ht()}],shrink:[{shrink:ht()}],order:[{order:["first","last","none",$u,ei]}],"grid-cols":[{"grid-cols":[eh]}],"col-start-end":[{col:["auto",{span:["full",$u,ei]},ei]}],"col-start":[{"col-start":Ce()}],"col-end":[{"col-end":Ce()}],"grid-rows":[{"grid-rows":[eh]}],"row-start-end":[{row:["auto",{span:[$u,ei]},ei]}],"row-start":[{"row-start":Ce()}],"row-end":[{"row-end":Ce()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ei]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ei]}],gap:[{gap:[N]}],"gap-x":[{"gap-x":[N]}],"gap-y":[{"gap-y":[N]}],"justify-content":[{justify:["normal",...xt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...xt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...xt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[pe]}],px:[{px:[pe]}],py:[{py:[pe]}],ps:[{ps:[pe]}],pe:[{pe:[pe]}],pt:[{pt:[pe]}],pr:[{pr:[pe]}],pb:[{pb:[pe]}],pl:[{pl:[pe]}],m:[{m:[ue]}],mx:[{mx:[ue]}],my:[{my:[ue]}],ms:[{ms:[ue]}],me:[{me:[ue]}],mt:[{mt:[ue]}],mr:[{mr:[ue]}],mb:[{mb:[ue]}],ml:[{ml:[ue]}],"space-x":[{"space-x":[Je]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Je]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ei,s]}],"min-w":[{"min-w":[ei,s,"min","max","fit"]}],"max-w":[{"max-w":[ei,s,"none","full","min","max","fit","prose",{screen:[Oo]},Oo]}],h:[{h:[ei,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ei,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ei,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ei,s,"auto","min","max","fit"]}],"font-size":[{text:["base",Oo,Lo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ky]}],"font-family":[{font:[eh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ei]}],"line-clamp":[{"line-clamp":["none",Nl,ky]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Vs,ei]}],"list-image":[{"list-image":["none",ei]}],"list-style-type":[{list:["none","disc","decimal",ei]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[f]}],"placeholder-opacity":[{"placeholder-opacity":[ye]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[f]}],"text-opacity":[{"text-opacity":[ye]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...st(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Vs,Lo]}],"underline-offset":[{"underline-offset":["auto",Vs,ei]}],"text-decoration-color":[{decoration:[f]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ue()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ei]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ei]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ye]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...He(),PS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",SS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},IS]}],"bg-color":[{bg:[f]}],"gradient-from-pos":[{from:[te]}],"gradient-via-pos":[{via:[te]}],"gradient-to-pos":[{to:[te]}],"gradient-from":[{from:[ie]}],"gradient-via":[{via:[ie]}],"gradient-to":[{to:[ie]}],rounded:[{rounded:[E]}],"rounded-s":[{"rounded-s":[E]}],"rounded-e":[{"rounded-e":[E]}],"rounded-t":[{"rounded-t":[E]}],"rounded-r":[{"rounded-r":[E]}],"rounded-b":[{"rounded-b":[E]}],"rounded-l":[{"rounded-l":[E]}],"rounded-ss":[{"rounded-ss":[E]}],"rounded-se":[{"rounded-se":[E]}],"rounded-ee":[{"rounded-ee":[E]}],"rounded-es":[{"rounded-es":[E]}],"rounded-tl":[{"rounded-tl":[E]}],"rounded-tr":[{"rounded-tr":[E]}],"rounded-br":[{"rounded-br":[E]}],"rounded-bl":[{"rounded-bl":[E]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[ye]}],"border-style":[{border:[...st(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ye]}],"divide-style":[{divide:st()}],"border-color":[{border:[I]}],"border-color-x":[{"border-x":[I]}],"border-color-y":[{"border-y":[I]}],"border-color-s":[{"border-s":[I]}],"border-color-e":[{"border-e":[I]}],"border-color-t":[{"border-t":[I]}],"border-color-r":[{"border-r":[I]}],"border-color-b":[{"border-b":[I]}],"border-color-l":[{"border-l":[I]}],"divide-color":[{divide:[I]}],"outline-style":[{outline:["",...st()]}],"outline-offset":[{"outline-offset":[Vs,ei]}],"outline-w":[{outline:[Vs,Lo]}],"outline-color":[{outline:[f]}],"ring-w":[{ring:Fe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[f]}],"ring-opacity":[{"ring-opacity":[ye]}],"ring-offset-w":[{"ring-offset":[Vs,Lo]}],"ring-offset-color":[{"ring-offset":[f]}],shadow:[{shadow:["","inner","none",Oo,AS]}],"shadow-color":[{shadow:[eh]}],opacity:[{opacity:[ye]}],"mix-blend":[{"mix-blend":[...yt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":yt()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[v]}],contrast:[{contrast:[U]}],"drop-shadow":[{"drop-shadow":["","none",Oo,ei]}],grayscale:[{grayscale:[q]}],"hue-rotate":[{"hue-rotate":[K]}],invert:[{invert:[V]}],saturate:[{saturate:[Ae]}],sepia:[{sepia:[Me]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[v]}],"backdrop-contrast":[{"backdrop-contrast":[U]}],"backdrop-grayscale":[{"backdrop-grayscale":[q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[K]}],"backdrop-invert":[{"backdrop-invert":[V]}],"backdrop-opacity":[{"backdrop-opacity":[ye]}],"backdrop-saturate":[{"backdrop-saturate":[Ae]}],"backdrop-sepia":[{"backdrop-sepia":[Me]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ei]}],duration:[{duration:Rt()}],ease:[{ease:["linear","in","out","in-out",ei]}],delay:[{delay:Rt()}],animate:[{animate:["none","spin","ping","pulse","bounce",ei]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ze]}],"scale-x":[{"scale-x":[ze]}],"scale-y":[{"scale-y":[ze]}],rotate:[{rotate:[$u,ei]}],"translate-x":[{"translate-x":[_t]}],"translate-y":[{"translate-y":[_t]}],"skew-x":[{"skew-x":[je]}],"skew-y":[{"skew-y":[je]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ei]}],accent:[{accent:["auto",f]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ei]}],"caret-color":[{caret:[f]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ue()}],"scroll-mx":[{"scroll-mx":Ue()}],"scroll-my":[{"scroll-my":Ue()}],"scroll-ms":[{"scroll-ms":Ue()}],"scroll-me":[{"scroll-me":Ue()}],"scroll-mt":[{"scroll-mt":Ue()}],"scroll-mr":[{"scroll-mr":Ue()}],"scroll-mb":[{"scroll-mb":Ue()}],"scroll-ml":[{"scroll-ml":Ue()}],"scroll-p":[{"scroll-p":Ue()}],"scroll-px":[{"scroll-px":Ue()}],"scroll-py":[{"scroll-py":Ue()}],"scroll-ps":[{"scroll-ps":Ue()}],"scroll-pe":[{"scroll-pe":Ue()}],"scroll-pt":[{"scroll-pt":Ue()}],"scroll-pr":[{"scroll-pr":Ue()}],"scroll-pb":[{"scroll-pb":Ue()}],"scroll-pl":[{"scroll-pl":Ue()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ei]}],fill:[{fill:[f,"none"]}],"stroke-w":[{stroke:[Vs,Lo,ky]}],stroke:[{stroke:[f,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},MS=(f,{cacheSize:s,prefix:g,separator:v,experimentalParseClassName:I,extend:E={},override:w={}})=>{sh(f,"cacheSize",s),sh(f,"prefix",g),sh(f,"separator",v),sh(f,"experimentalParseClassName",I);for(const c in w)zS(f[c],w[c]);for(const c in E)DS(f[c],E[c]);return f},sh=(f,s,g)=>{g!==void 0&&(f[s]=g)},zS=(f,s)=>{if(s)for(const g in s)sh(f,g,s[g])},DS=(f,s)=>{if(s)for(const g in s){const v=s[g];v!==void 0&&(f[g]=(f[g]||[]).concat(v))}},RS=(f,...s)=>typeof f=="function"?Hy(Wy,f,...s):Hy(()=>MS(Wy(),f),...s),gb=Hy(Wy);var LS={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},_b=f=>f||void 0,lh=(...f)=>_b(lb(f).filter(Boolean).join(" ")),My=null,qs={},Xy=!1,th=(...f)=>s=>s.twMerge?((!My||Xy)&&(Xy=!1,My=pn(qs)?gb:RS({...qs,extend:{theme:qs.theme,classGroups:qs.classGroups,conflictingClassGroupModifiers:qs.conflictingClassGroupModifiers,conflictingClassGroups:qs.conflictingClassGroups,...qs.extend}})),_b(My(lh(f)))):lh(f),b0=(f,s)=>{for(let g in s)f.hasOwnProperty(g)?f[g]=lh(f[g],s[g]):f[g]=s[g];return f},OS=(f,s)=>{let{extend:g=null,slots:v={},variants:I={},compoundVariants:E=[],compoundSlots:w=[],defaultVariants:c={}}=f,U={...LS,...s},q=g!=null&&g.base?lh(g.base,f==null?void 0:f.base):f==null?void 0:f.base,K=g!=null&&g.variants&&!pn(g.variants)?ub(I,g.variants):I,V=g!=null&&g.defaultVariants&&!pn(g.defaultVariants)?{...g.defaultVariants,...c}:c;!pn(U.twMergeConfig)&&!tS(U.twMergeConfig,qs)&&(Xy=!0,qs=U.twMergeConfig);let N=pn(g==null?void 0:g.slots),ie=pn(v)?{}:{base:lh(f==null?void 0:f.base,N&&(g==null?void 0:g.base)),...v},te=N?ie:b0({...g==null?void 0:g.slots},pn(ie)?{base:f==null?void 0:f.base}:ie),oe=pn(g==null?void 0:g.compoundVariants)?E:cb(g==null?void 0:g.compoundVariants,E),ue=pe=>{if(pn(K)&&pn(v)&&N)return th(q,pe==null?void 0:pe.class,pe==null?void 0:pe.className)(U);if(oe&&!Array.isArray(oe))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof oe}`);if(w&&!Array.isArray(w))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof w}`);let Ae=(Ue,Fe,Ce=[],He)=>{let st=Ce;if(typeof Fe=="string")st=st.concat(y0(Fe).split(" ").map(yt=>`${Ue}:${yt}`));else if(Array.isArray(Fe))st=st.concat(Fe.reduce((yt,xt)=>yt.concat(`${Ue}:${xt}`),[]));else if(typeof Fe=="object"&&typeof He=="string"){for(let yt in Fe)if(Fe.hasOwnProperty(yt)&&yt===He){let xt=Fe[yt];if(xt&&typeof xt=="string"){let ht=y0(xt);st[He]?st[He]=st[He].concat(ht.split(" ").map(mt=>`${Ue}:${mt}`)):st[He]=ht.split(" ").map(mt=>`${Ue}:${mt}`)}else Array.isArray(xt)&&xt.length>0&&(st[He]=xt.reduce((ht,mt)=>ht.concat(`${Ue}:${mt}`),[]))}}return st},ze=(Ue,Fe=K,Ce=null,He=null)=>{var st;let yt=Fe[Ue];if(!yt||pn(yt))return null;let xt=(st=He==null?void 0:He[Ue])!=null?st:pe==null?void 0:pe[Ue];if(xt===null)return null;let ht=_0(xt),mt=Array.isArray(U.responsiveVariants)&&U.responsiveVariants.length>0||U.responsiveVariants===!0,Rt=V==null?void 0:V[Ue],jt=[];if(typeof ht=="object"&&mt)for(let[bi,Hi]of Object.entries(ht)){let Ni=yt[Hi];if(bi==="initial"){Rt=Hi;continue}Array.isArray(U.responsiveVariants)&&!U.responsiveVariants.includes(bi)||(jt=Ae(bi,Ni,jt,Ce))}let Ti=ht!=null&&typeof ht!="object"?ht:_0(Rt),fi=yt[Ti||"false"];return typeof jt=="object"&&typeof Ce=="string"&&jt[Ce]?b0(jt,fi):jt.length>0?(jt.push(fi),Ce==="base"?jt.join(" "):jt):fi},Me=()=>K?Object.keys(K).map(Ue=>ze(Ue,K)):null,je=(Ue,Fe)=>{if(!K||typeof K!="object")return null;let Ce=new Array;for(let He in K){let st=ze(He,K,Ue,Fe),yt=Ue==="base"&&typeof st=="string"?st:st&&st[Ue];yt&&(Ce[Ce.length]=yt)}return Ce},Je={};for(let Ue in pe)pe[Ue]!==void 0&&(Je[Ue]=pe[Ue]);let _t=(Ue,Fe)=>{var Ce;let He=typeof(pe==null?void 0:pe[Ue])=="object"?{[Ue]:(Ce=pe[Ue])==null?void 0:Ce.initial}:{};return{...V,...Je,...He,...Fe}},Ge=(Ue=[],Fe)=>{let Ce=[];for(let{class:He,className:st,...yt}of Ue){let xt=!0;for(let[ht,mt]of Object.entries(yt)){let Rt=_t(ht,Fe)[ht];if(Array.isArray(mt)){if(!mt.includes(Rt)){xt=!1;break}}else{let jt=Ti=>Ti==null||Ti===!1;if(jt(mt)&&jt(Rt))continue;if(Rt!==mt){xt=!1;break}}}xt&&(He&&Ce.push(He),st&&Ce.push(st))}return Ce},gt=Ue=>{let Fe=Ge(oe,Ue);if(!Array.isArray(Fe))return Fe;let Ce={};for(let He of Fe)if(typeof He=="string"&&(Ce.base=th(Ce.base,He)(U)),typeof He=="object")for(let[st,yt]of Object.entries(He))Ce[st]=th(Ce[st],yt)(U);return Ce},at=Ue=>{if(w.length<1)return null;let Fe={};for(let{slots:Ce=[],class:He,className:st,...yt}of w){if(!pn(yt)){let xt=!0;for(let ht of Object.keys(yt)){let mt=_t(ht,Ue)[ht];if(mt===void 0||(Array.isArray(yt[ht])?!yt[ht].includes(mt):yt[ht]!==mt)){xt=!1;break}}if(!xt)continue}for(let xt of Ce)Fe[xt]=Fe[xt]||[],Fe[xt].push([He,st])}return Fe};if(!pn(v)||!N){let Ue={};if(typeof te=="object"&&!pn(te))for(let Fe of Object.keys(te))Ue[Fe]=Ce=>{var He,st;return th(te[Fe],je(Fe,Ce),((He=gt(Ce))!=null?He:[])[Fe],((st=at(Ce))!=null?st:[])[Fe],Ce==null?void 0:Ce.class,Ce==null?void 0:Ce.className)(U)};return Ue}return th(q,Me(),Ge(oe),pe==null?void 0:pe.class,pe==null?void 0:pe.className)(U)},ye=()=>{if(!(!K||typeof K!="object"))return Object.keys(K)};return ue.variantKeys=ye(),ue.extend=g,ue.base=q,ue.slots=te,ue.variants=K,ue.defaultVariants=V,ue.compoundSlots=w,ue.compoundVariants=oe,ue};function yb(f){var s,g,v="";if(typeof f=="string"||typeof f=="number")v+=f;else if(typeof f=="object")if(Array.isArray(f)){var I=f.length;for(s=0;s<I;s++)f[s]&&(g=yb(f[s]))&&(v&&(v+=" "),v+=g)}else for(g in f)f[g]&&(v&&(v+=" "),v+=g);return v}function vb(){for(var f,s,g=0,v="",I=arguments.length;g<I;g++)(f=arguments[g])&&(s=yb(f))&&(v&&(v+=" "),v+=s);return v}function Tr(...f){return gb(vb(f))}const w0=OS({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var FS=Vt("<a><!></a>"),BS=Vt("<button><!></button>");function S0(f,s){Et(s,!0);let g=J(s,"variant",3,"default"),v=J(s,"size",3,"default"),I=J(s,"ref",15,null),E=J(s,"href",3,void 0),w=J(s,"type",3,"button"),c=Gt(s,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const U=t_(),[q,K]=U;var V=Ke(),N=Ne(V);{var ie=oe=>{var ue=FS();const ye=Pe(()=>K({class:Tr(w0({variant:g(),size:v(),className:s.class})),href:E(),...c},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let pe;var Ae=ci(ue);Ct(Ae,()=>s.children??Xt),ui(ue),tm(ue,ze=>I(ze),()=>I()),di(()=>pe=Oi(ue,pe,{...R(ye)})),Te(oe,ue)},te=oe=>{var ue=BS();const ye=Pe(()=>K({class:Tr(w0({variant:g(),size:v(),className:s.class})),type:w(),...c},[{attribute_name:"formaction"}]));let pe;var Ae=ci(ue);Ct(Ae,()=>s.children??Xt),ui(ue),tm(ue,ze=>I(ze),()=>I()),di(()=>pe=Oi(ue,pe,{...R(ye)})),Te(oe,ue)};hi(N,oe=>{E()?oe(ie):oe(te,!1)})}Te(f,V),kt()}function NS(f){return typeof f=="function"}function VS(f){return f!==null&&typeof f=="object"}const ch=Symbol("box"),ov=Symbol("is-writable");function jS(f){return VS(f)&&ch in f}function US(f){return be.isBox(f)&&ov in f}function be(f){let s=Ye(Ze(f));return{[ch]:!0,[ov]:!0,get current(){return R(s)},set current(g){Ve(s,Ze(g))}}}function qS(f,s){const g=Pe(f);return s?{[ch]:!0,[ov]:!0,get current(){return R(g)},set current(v){s(v)}}:{[ch]:!0,get current(){return f()}}}function ZS(f){return be.isBox(f)?f:NS(f)?be.with(f):be(f)}function GS(f){return Object.entries(f).reduce((s,[g,v])=>be.isBox(v)?(be.isWritableBox(v)?Object.defineProperty(s,g,{get(){return v.current},set(I){v.current=I}}):Object.defineProperty(s,g,{get(){return v.current}}),s):Object.assign(s,{[g]:v}),{})}function HS(f){return be.isWritableBox(f)?{[ch]:!0,get current(){return f.current}}:f}be.from=ZS;be.with=qS;be.flatten=GS;be.readonly=HS;be.isBox=jS;be.isWritableBox=US;function xb(...f){return function(s){var g;for(const v of f)if(v){if(s.defaultPrevented)return;typeof v=="function"?v.call(this,s):(g=v.current)==null||g.call(this,s)}}}function bb(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var Fl={},zy,P0;function WS(){if(P0)return zy;P0=1;var f=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,s=/\n/g,g=/^\s*/,v=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,I=/^:\s*/,E=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,w=/^[;\s]*/,c=/^\s+|\s+$/g,U=`
`,q="/",K="*",V="",N="comment",ie="declaration";zy=function(oe,ue){if(typeof oe!="string")throw new TypeError("First argument must be a string");if(!oe)return[];ue=ue||{};var ye=1,pe=1;function Ae(Fe){var Ce=Fe.match(s);Ce&&(ye+=Ce.length);var He=Fe.lastIndexOf(U);pe=~He?Fe.length-He:pe+Fe.length}function ze(){var Fe={line:ye,column:pe};return function(Ce){return Ce.position=new Me(Fe),_t(),Ce}}function Me(Fe){this.start=Fe,this.end={line:ye,column:pe},this.source=ue.source}Me.prototype.content=oe;function je(Fe){var Ce=new Error(ue.source+":"+ye+":"+pe+": "+Fe);if(Ce.reason=Fe,Ce.filename=ue.source,Ce.line=ye,Ce.column=pe,Ce.source=oe,!ue.silent)throw Ce}function Je(Fe){var Ce=Fe.exec(oe);if(Ce){var He=Ce[0];return Ae(He),oe=oe.slice(He.length),Ce}}function _t(){Je(g)}function Ge(Fe){var Ce;for(Fe=Fe||[];Ce=gt();)Ce!==!1&&Fe.push(Ce);return Fe}function gt(){var Fe=ze();if(!(q!=oe.charAt(0)||K!=oe.charAt(1))){for(var Ce=2;V!=oe.charAt(Ce)&&(K!=oe.charAt(Ce)||q!=oe.charAt(Ce+1));)++Ce;if(Ce+=2,V===oe.charAt(Ce-1))return je("End of comment missing");var He=oe.slice(2,Ce-2);return pe+=2,Ae(He),oe=oe.slice(Ce),pe+=2,Fe({type:N,comment:He})}}function at(){var Fe=ze(),Ce=Je(v);if(Ce){if(gt(),!Je(I))return je("property missing ':'");var He=Je(E),st=Fe({type:ie,property:te(Ce[0].replace(f,V)),value:He?te(He[0].replace(f,V)):V});return Je(w),st}}function Ue(){var Fe=[];Ge(Fe);for(var Ce;Ce=at();)Ce!==!1&&(Fe.push(Ce),Ge(Fe));return Fe}return _t(),Ue()};function te(oe){return oe?oe.replace(c,V):V}return zy}var T0;function XS(){if(T0)return Fl;T0=1;var f=Fl&&Fl.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.default=g;var s=f(WS());function g(v,I){var E=null;if(!v||typeof v!="string")return E;var w=(0,s.default)(v),c=typeof I=="function";return w.forEach(function(U){if(U.type==="declaration"){var q=U.property,K=U.value;c?I(q,K,U):K&&(E=E||{},E[q]=K)}}),E}return Fl}var KS=XS();const I0=bb(KS),JS=I0.default||I0,YS=/\d/,QS=["-","_","/","."];function $S(f=""){if(!YS.test(f))return f!==f.toLowerCase()}function eP(f){const s=[];let g="",v,I;for(const E of f){const w=QS.includes(E);if(w===!0){s.push(g),g="",v=void 0;continue}const c=$S(E);if(I===!1){if(v===!1&&c===!0){s.push(g),g=E,v=c;continue}if(v===!0&&c===!1&&g.length>1){const U=g.at(-1);s.push(g.slice(0,Math.max(0,g.length-1))),g=U+E,v=c;continue}}g+=E,v=c,I=w}return s.push(g),s}function wb(f){return f?eP(f).map(s=>iP(s)).join(""):""}function tP(f){return rP(wb(f||""))}function iP(f){return f?f[0].toUpperCase()+f.slice(1):""}function rP(f){return f?f[0].toLowerCase()+f.slice(1):""}function oh(f){if(!f)return{};const s={};function g(v,I){if(v.startsWith("-moz-")||v.startsWith("-webkit-")||v.startsWith("-ms-")||v.startsWith("-o-")){s[wb(v)]=I;return}if(v.startsWith("--")){s[v]=I;return}s[tP(v)]=I}return JS(f,g),s}function Vl(...f){return(...s)=>{for(const g of f)typeof g=="function"&&g(...s)}}function nP(f,s){const g=RegExp(f,"g");return v=>{if(typeof v!="string")throw new TypeError(`expected an argument of type string, but got ${typeof v}`);return v.match(g)?v.replace(g,s):v}}const sP=nP(/[A-Z]/,f=>`-${f.toLowerCase()}`);function oP(f){if(!f||typeof f!="object"||Array.isArray(f))throw new TypeError(`expected an argument of type object, but got ${typeof f}`);return Object.keys(f).map(s=>`${sP(s)}: ${f[s]};`).join(`
`)}function av(f={}){return oP(f).replace(`
`," ")}const Sb={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};av(Sb);function aP(f){var s;return f.length>2&&f.startsWith("on")&&f[2]===((s=f[2])==null?void 0:s.toLowerCase())}function Pi(...f){const s={...f[0]};for(let g=1;g<f.length;g++){const v=f[g];for(const I in v){const E=s[I],w=v[I],c=typeof E=="function",U=typeof w=="function";if(c&&aP(I)){const q=E,K=w;s[I]=xb(q,K)}else if(c&&U)s[I]=Vl(E,w);else if(I==="class"&&typeof E=="string"&&typeof w=="string")s[I]=vb(E,w);else if(I==="style"){const q=typeof E=="object",K=typeof w=="object",V=typeof E=="string",N=typeof w=="string";if(q&&K)s[I]={...E,...w};else if(q&&N){const ie=oh(w);s[I]={...E,...ie}}else if(V&&K){const ie=oh(E);s[I]={...ie,...w}}else if(V&&N){const ie=oh(E),te=oh(w);s[I]={...ie,...te}}else q?s[I]=E:K&&(s[I]=w)}else s[I]=w!==void 0?w:E}}return typeof s.style=="object"&&(s.style=av(s.style).replaceAll(`
`," ")),s.hidden!==!0&&(s.hidden=void 0),s.disabled!==!0&&(s.disabled=void 0),s}function Bi({id:f,ref:s,deps:g=()=>!0,onRefChange:v=()=>{},getRootNode:I=()=>typeof document<"u"?document:void 0}){const E=Pe(()=>g()),w=Pe(()=>I());At(()=>(f.current,R(E),R(w),Ri(()=>{var U;const c=(U=R(w))==null?void 0:U.getElementById(f.current);c?s.current=c:s.current=null,v(s.current)}))),At(()=>()=>{s.current=null,v(null)})}function lP(f){At(()=>()=>{f()})}function Np(f,s){setTimeout(s,f)}function Na(f){rv().then(f)}function Ua(f){return f?"open":"closed"}function Pb(f){return f?"true":"false"}function lv(f){return f?"true":"false"}function Vp(f){return f?"":void 0}function cP(f){return f?"true":"false"}function uP(f){return f?"":void 0}const im="ArrowDown",cv="ArrowLeft",uv="ArrowRight",rm="ArrowUp",Tb="End",hv="Enter",hP="Escape",Ib="Home",Ab=" ",dP="Tab",pP="p",fP="n",mP="j",gP="k";function _P(f){return window.getComputedStyle(f).getPropertyValue("direction")}function yP(f="ltr",s="horizontal"){return{horizontal:f==="rtl"?cv:uv,vertical:im}[s]}function vP(f="ltr",s="horizontal"){return{horizontal:f==="rtl"?uv:cv,vertical:rm}[s]}function xP(f="ltr",s="horizontal"){return["ltr","rtl"].includes(f)||(f="ltr"),["horizontal","vertical"].includes(s)||(s="horizontal"),{nextKey:yP(f,s),prevKey:vP(f,s)}}const i_=typeof document<"u",A0=bP();function bP(){var f,s;return i_&&((f=window==null?void 0:window.navigator)==null?void 0:f.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((s=window==null?void 0:window.navigator)==null?void 0:s.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function nm(f){return f instanceof HTMLElement}function wP(f){return f instanceof Element}function SP(f){return f!==null}function PP(f){return f instanceof HTMLInputElement&&"select"in f}function TP(f,s){if(getComputedStyle(f).visibility==="hidden")return!0;for(;f;){if(s!==void 0&&f===s)return!1;if(getComputedStyle(f).display==="none")return!0;f=f.parentElement}return!1}function IP(f){const s=f.currentTabStopId?f.currentTabStopId:be(null);function g(){if(!i_)return[];const w=document.getElementById(f.rootNodeId.current);return w?f.candidateSelector?Array.from(w.querySelectorAll(f.candidateSelector)):Array.from(w.querySelectorAll(`[${f.candidateAttr}]:not([data-disabled])`)):[]}function v(){var c;const w=g();w.length&&((c=w[0])==null||c.focus())}function I(w,c,U=!1){var Ae;const q=document.getElementById(f.rootNodeId.current);if(!q||!w)return;const K=g();if(!K.length)return;const V=K.indexOf(w),N=_P(q),{nextKey:ie,prevKey:te}=xP(N,f.orientation.current),oe=f.loop.current,ue={[ie]:V+1,[te]:V-1,[Ib]:0,[Tb]:K.length-1};if(U){const ze=ie===im?uv:im,Me=te===rm?cv:rm;ue[ze]=V+1,ue[Me]=V-1}let ye=ue[c.key];if(ye===void 0)return;c.preventDefault(),ye<0&&oe?ye=K.length-1:ye===K.length&&oe&&(ye=0);const pe=K[ye];if(pe)return pe.focus(),s.current=pe.id,(Ae=f.onCandidateFocus)==null||Ae.call(f,pe),pe}function E(w){const c=g(),U=s.current!==null;return w&&!U&&c[0]===w?(s.current=w.id,0):(w==null?void 0:w.id)===s.current?0:-1}return{setCurrentTabStopId(w){s.current=w},getTabIndex:E,handleKeydown:I,focusFirstCandidate:v,currentTabStopId:s}}function C0(f,s){return Bp(f,s)}function AP(f,s){const g=f,v=typeof f=="symbol"?f.description:f;if(!rb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return nv(f)}function CP(f,s){return typeof f=="string"&&s===void 0?`${f}Context`:Array.isArray(f)&&s===void 0?`${f[0]}Context`:`${f}Context`}function $s(f,s,g=!0){const v=CP(f,s),I=Symbol.for(`bits-ui.${v}`),E=v;function w(U){const q=AP(g?I:E,U);if(q===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(f)?`one of the following components: ${f.join(", ")}`:`\`${f}\``}`);return q}function c(U){return C0(g?I:E,U)}return[c,w]}const EP="data-accordion-root",Cb="data-accordion-trigger",kP="data-accordion-content",MP="data-accordion-item",zP="data-accordion-header";var Ul,dh,ph,cm;class Eb{constructor(s){W(this,Ul);W(this,dh);Oe(this,"disabled");W(this,ph);Oe(this,"orientation");Oe(this,"rovingFocusGroup");W(this,cm,Pe(()=>({id:T(this,Ul).current,"data-orientation":this.orientation.current,"data-disabled":Vp(this.disabled.current),[EP]:""})));Le(this,Ul,s.id),this.disabled=s.disabled,Le(this,dh,s.ref),Bi({id:s.id,ref:T(this,dh)}),this.orientation=s.orientation,Le(this,ph,s.loop),this.rovingFocusGroup=IP({rootNodeId:T(this,Ul),candidateAttr:Cb,loop:T(this,ph),orientation:this.orientation})}get props(){return R(T(this,cm))}}Ul=new WeakMap,dh=new WeakMap,ph=new WeakMap,cm=new WeakMap;var ql;class DP extends Eb{constructor(g){super(g);W(this,ql);Oe(this,"isMulti",!1);Oe(this,"includesItem",g=>T(this,ql).current===g);Oe(this,"toggleItem",g=>{T(this,ql).current=this.includesItem(g)?"":g});Le(this,ql,g.value)}}ql=new WeakMap;var Gs;class RP extends Eb{constructor(g){super(g);W(this,Gs);Oe(this,"isMulti",!0);Oe(this,"includesItem",g=>T(this,Gs).current.includes(g));Oe(this,"toggleItem",g=>{this.includesItem(g)?T(this,Gs).current=T(this,Gs).current.filter(v=>v!==g):T(this,Gs).current=[...T(this,Gs).current,g]});Le(this,Gs,g.value)}}Gs=new WeakMap;var Zl,fh,um,hm,dm;class LP{constructor(s){W(this,Zl);W(this,fh);Oe(this,"value");Oe(this,"disabled");Oe(this,"root");W(this,um,Pe(()=>this.root.includesItem(this.value.current)));W(this,hm,Pe(()=>this.disabled.current||this.root.disabled.current));Oe(this,"updateValue",()=>{this.root.toggleItem(this.value.current)});W(this,dm,Pe(()=>({id:T(this,Zl).current,"data-state":Ua(this.isActive),"data-disabled":Vp(this.isDisabled),"data-orientation":this.root.orientation.current,[MP]:""})));this.value=s.value,this.disabled=s.disabled,this.root=s.rootState,Le(this,Zl,s.id),Le(this,fh,s.ref),Bi({id:T(this,Zl),ref:T(this,fh),deps:()=>this.isActive})}get isActive(){return R(T(this,um))}get isDisabled(){return R(T(this,hm))}get props(){return R(T(this,dm))}}Zl=new WeakMap,fh=new WeakMap,um=new WeakMap,hm=new WeakMap,dm=new WeakMap;var Gl,mh,gh,Ea,ds,Hs,pm,fm,mm,gm;class OP{constructor(s,g){W(this,Gl);W(this,mh);W(this,gh);W(this,Ea);W(this,ds);W(this,Hs,Pe(()=>T(this,mh).current||T(this,ds).disabled.current||T(this,Ea).disabled.current));W(this,pm,s=>{if(!R(T(this,Hs))){if(s.pointerType==="touch"||s.button!==0)return s.preventDefault();T(this,ds).updateValue()}});W(this,fm,s=>{R(T(this,Hs))||s.pointerType==="touch"&&(s.preventDefault(),T(this,ds).updateValue())});W(this,mm,s=>{if(!R(T(this,Hs))){if(s.key===Ab||s.key===hv){s.preventDefault(),T(this,ds).updateValue();return}T(this,Ea).rovingFocusGroup.handleKeydown(T(this,Gl).current,s)}});W(this,gm,Pe(()=>({id:T(this,gh).current,disabled:R(T(this,Hs)),"aria-expanded":lv(T(this,ds).isActive),"aria-disabled":Pb(R(T(this,Hs))),"data-disabled":Vp(R(T(this,Hs))),"data-state":Ua(T(this,ds).isActive),"data-orientation":T(this,Ea).orientation.current,[Cb]:"",tabindex:0,onpointerdown:T(this,pm),onpointerup:T(this,fm),onkeydown:T(this,mm)})));Le(this,mh,s.disabled),Le(this,ds,g),Le(this,Ea,g.root),Le(this,gh,s.id),Le(this,Gl,s.ref),Bi({id:s.id,ref:T(this,Gl)})}get props(){return R(T(this,gm))}}Gl=new WeakMap,mh=new WeakMap,gh=new WeakMap,Ea=new WeakMap,ds=new WeakMap,Hs=new WeakMap,pm=new WeakMap,fm=new WeakMap,mm=new WeakMap,gm=new WeakMap;var ka,Hl,Wl,Xl,_h,yh,vh,_m,ym,vm;class FP{constructor(s,g){Oe(this,"item");W(this,ka);W(this,Hl);W(this,Wl);W(this,Xl,!1);W(this,_h,Ye(0));W(this,yh,Ye(0));W(this,vh);W(this,_m,Pe(()=>T(this,vh).current||this.item.isActive));W(this,ym,Pe(()=>({open:this.item.isActive})));W(this,vm,Pe(()=>({id:T(this,Hl).current,"data-state":Ua(this.item.isActive),"data-disabled":Vp(this.item.isDisabled),"data-orientation":this.item.root.orientation.current,[kP]:"",style:{"--bits-accordion-content-height":`${R(T(this,yh))}px`,"--bits-accordion-content-width":`${R(T(this,_h))}px`}})));this.item=g,Le(this,vh,s.forceMount),Le(this,Xl,this.item.isActive),Le(this,Hl,s.id),Le(this,ka,s.ref),Bi({id:T(this,Hl),ref:T(this,ka)}),R2(()=>{const v=requestAnimationFrame(()=>{Le(this,Xl,!1)});return()=>{cancelAnimationFrame(v)}}),At(()=>{this.present;const v=T(this,ka).current;v&&Na(()=>{if(!T(this,ka).current)return;Le(this,Wl,T(this,Wl)||{transitionDuration:v.style.transitionDuration,animationName:v.style.animationName}),v.style.transitionDuration="0s",v.style.animationName="none";const I=v.getBoundingClientRect();if(Ve(T(this,yh),Ze(I.height)),Ve(T(this,_h),Ze(I.width)),!T(this,Xl)){const{animationName:E,transitionDuration:w}=T(this,Wl);v.style.transitionDuration=w,v.style.animationName=E}})})}get present(){return R(T(this,_m))}get snippetProps(){return R(T(this,ym))}get props(){return R(T(this,vm))}}ka=new WeakMap,Hl=new WeakMap,Wl=new WeakMap,Xl=new WeakMap,_h=new WeakMap,yh=new WeakMap,vh=new WeakMap,_m=new WeakMap,ym=new WeakMap,vm=new WeakMap;var Kl,xh,Jl,Yl,xm;class BP{constructor(s,g){W(this,Kl);W(this,xh);W(this,Jl);W(this,Yl);W(this,xm,Pe(()=>({id:T(this,Kl).current,role:"heading","aria-level":T(this,Jl).current,"data-heading-level":T(this,Jl).current,"data-state":Ua(T(this,Yl).isActive),"data-orientation":T(this,Yl).root.orientation.current,[zP]:""})));Le(this,Jl,s.level),Le(this,Kl,s.id),Le(this,xh,s.ref),Bi({id:T(this,Kl),ref:T(this,xh)}),Le(this,Yl,g)}get props(){return R(T(this,xm))}}Kl=new WeakMap,xh=new WeakMap,Jl=new WeakMap,Yl=new WeakMap,xm=new WeakMap;const[NP,VP]=$s("Accordion.Root"),[jP,dv]=$s("Accordion.Item");function UP(f){const{type:s,...g}=f,v=s==="single"?new DP(g):new RP(g);return NP(v)}function qP(f){const s=VP();return jP(new LP({...f,rootState:s}))}function ZP(f){const s=dv();return new OP(f,s)}function GP(f){const s=dv();return new FP(f,s)}function HP(f){const s=dv();return new BP(f,s)}let E0=0;function Gi(f="bits"){return E0++,`${f}-${E0}`}function Yi(){}var WP=Vt("<div><!></div>");function XP(f,s){Et(s,!0);let g=J(s,"disabled",3,!1),v=J(s,"value",15),I=J(s,"ref",15,null),E=J(s,"id",19,Gi),w=J(s,"onValueChange",3,Yi),c=J(s,"loop",3,!0),U=J(s,"orientation",3,"vertical"),q=J(s,"controlledValue",3,!1),K=Gt(s,["$$slots","$$events","$$legacy","disabled","children","child","type","value","ref","id","onValueChange","loop","orientation","controlledValue"]);v()===void 0&&v(s.type==="single"?"":[]);const V=UP({type:s.type,value:be.with(()=>v(),ye=>{q()||v(ye),w()(ye)}),id:be.with(()=>E()),disabled:be.with(()=>g()),loop:be.with(()=>c()),orientation:be.with(()=>U()),ref:be.with(()=>I(),ye=>I(ye))}),N=Pe(()=>Pi(K,V.props));var ie=Ke(),te=Ne(ie);{var oe=ye=>{var pe=Ke(),Ae=Ne(pe);Ct(Ae,()=>s.child,()=>({props:R(N)})),Te(ye,pe)},ue=ye=>{var pe=WP();let Ae;var ze=ci(pe);Ct(ze,()=>s.children??Xt),ui(pe),di(()=>Ae=Oi(pe,Ae,{...R(N)})),Te(ye,pe)};hi(te,ye=>{s.child?ye(oe):ye(ue,!1)})}Te(f,ie),kt()}var KP=Vt("<div><!></div>");function JP(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"disabled",3,!1),I=J(s,"value",19,Gi),E=J(s,"ref",15,null),w=Gt(s,["$$slots","$$events","$$legacy","id","disabled","value","children","child","ref"]);const c=qP({value:be.with(()=>I()),disabled:be.with(()=>v()),id:be.with(()=>g()),ref:be.with(()=>E(),ie=>E(ie))}),U=Pe(()=>Pi(w,c.props));var q=Ke(),K=Ne(q);{var V=ie=>{var te=Ke(),oe=Ne(te);Ct(oe,()=>s.child,()=>({props:R(U)})),Te(ie,te)},N=ie=>{var te=KP();let oe;var ue=ci(te);Ct(ue,()=>s.children??Xt),ui(te),di(()=>oe=Oi(te,oe,{...R(U)})),Te(ie,te)};hi(K,ie=>{s.child?ie(V):ie(N,!1)})}Te(f,q),kt()}var YP=Vt("<div><!></div>");function QP(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"level",3,2),I=J(s,"ref",15,null),E=Gt(s,["$$slots","$$events","$$legacy","id","level","children","child","ref"]);const w=HP({id:be.with(()=>g()),level:be.with(()=>v()),ref:be.with(()=>I(),N=>I(N))}),c=Pe(()=>Pi(E,w.props));var U=Ke(),q=Ne(U);{var K=N=>{var ie=Ke(),te=Ne(ie);Ct(te,()=>s.child,()=>({props:R(c)})),Te(N,ie)},V=N=>{var ie=YP();let te;var oe=ci(ie);Ct(oe,()=>s.children??Xt),ui(ie),di(()=>te=Oi(ie,te,{...R(c)})),Te(N,ie)};hi(q,N=>{s.child?N(K):N(V,!1)})}Te(f,U),kt()}var $P=Vt("<button><!></button>");function eT(f,s){Et(s,!0);let g=J(s,"disabled",3,!1),v=J(s,"ref",15,null),I=J(s,"id",19,Gi),E=Gt(s,["$$slots","$$events","$$legacy","disabled","ref","id","children","child"]);const w=ZP({disabled:be.with(()=>g()),id:be.with(()=>I()),ref:be.with(()=>v(),oe=>v(oe))}),c=Pe(()=>Pi(E,w.props)),U=t_(),[q,K]=U;var V=Ke(),N=Ne(V);{var ie=oe=>{var ue=Ke(),ye=Ne(ue);Ct(ye,()=>s.child,()=>({props:R(c)})),Te(oe,ue)},te=oe=>{var ue=$P();const ye=Pe(()=>K({type:"button",...R(c)},[{attribute_name:"formaction"}]));let pe;var Ae=ci(ue);Ct(Ae,()=>s.children??Xt),ui(ue),di(()=>pe=Oi(ue,pe,{...R(ye)})),Te(oe,ue)};hi(N,oe=>{s.child?oe(ie):oe(te,!1)})}Te(f,V),kt()}var Ql,bh,No,Ma,$o,Ky,Jy;class tT{constructor(s,g){W(this,$o);W(this,Ql,Ye());W(this,bh);W(this,No,0);W(this,Ma,null);T(this,Ql).v=Ze(s),Le(this,bh,g)}get current(){return L2()?At(()=>(Iy(this,No)._++,T(this,No)===1&&jn(this,$o,Ky).call(this,!0),()=>{rv().then(()=>{Iy(this,No)._--,T(this,No)===0&&jn(this,$o,Jy).call(this)})})):T(this,No)===0&&(jn(this,$o,Ky).call(this,!1),jn(this,$o,Jy).call(this)),R(T(this,Ql))}}Ql=new WeakMap,bh=new WeakMap,No=new WeakMap,Ma=new WeakMap,$o=new WeakSet,Ky=function(s){Le(this,Ma,T(this,bh).call(this,g=>{Ve(T(this,Ql),Ze(g))},s)??null)},Jy=function(){T(this,Ma)!==null&&(T(this,Ma).call(this),Le(this,Ma,null))};new tT(null,(f,s)=>{function g(){f(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function iT(f){return typeof f=="function"}function rT(f){return iT(f)?f():f}var Vo;class nT{constructor(s,g={box:"border-box"}){W(this,Vo,Ye(Ze({width:0,height:0})));var v,I;T(this,Vo).v=Ze({width:((v=g.initialSize)==null?void 0:v.width)??0,height:((I=g.initialSize)==null?void 0:I.height)??0}),At(()=>{const E=rT(s);if(!E)return;const w=new ResizeObserver(c=>{for(const U of c){const q=g.box==="content-box"?U.contentBoxSize:U.borderBoxSize,K=Array.isArray(q)?q:[q];R(T(this,Vo)).width=K.reduce((V,N)=>Math.max(V,N.inlineSize),0),R(T(this,Vo)).height=K.reduce((V,N)=>Math.max(V,N.blockSize),0)}});return w.observe(E),()=>{w.disconnect()}})}get width(){return R(T(this,Vo)).width}get height(){return R(T(this,Vo)).height}}Vo=new WeakMap;var wh,Sh;class sT{constructor(s){W(this,wh,Ye());W(this,Sh);At(()=>{Ve(T(this,wh),Ze(T(this,Sh))),Le(this,Sh,s())})}get current(){return R(T(this,wh))}}wh=new WeakMap,Sh=new WeakMap;function oT(f,s){const g=be(f);function v(E){return s[g.current][E]??g.current}return{state:g,dispatch:E=>{g.current=v(E)}}}function aT(f,s){let g=Ye(Ze({})),v=Ye("none");const I=f.current?"mounted":"unmounted";let E=Ye(null);const w=new sT(()=>f.current);At(()=>{s.current&&f.current&&Na(()=>{Ve(E,Ze(document.getElementById(s.current)))})});const{state:c,dispatch:U}=oT(I,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});At(()=>{const N=f.current;Ri(()=>{if(R(E)||Ve(E,Ze(document.getElementById(s.current))),!R(E)||!(N!==w.current))return;const te=R(v),oe=Wf(R(E));N?U("MOUNT"):oe==="none"||R(g).display==="none"?U("UNMOUNT"):U(w&&te!==oe?"ANIMATION_OUT":"UNMOUNT")})});function q(N){if(R(E)||Ve(E,Ze(document.getElementById(s.current))),!R(E))return;const ie=Wf(R(E)),te=ie.includes(N.animationName)||ie==="none";N.target===R(E)&&te&&U("ANIMATION_END")}function K(N){R(E)||Ve(E,Ze(document.getElementById(s.current))),R(E)&&N.target===R(E)&&Ve(v,Ze(Wf(R(E))))}At(()=>{c.current,Ri(()=>{if(R(E)||Ve(E,Ze(document.getElementById(s.current))),!R(E))return;const N=Wf(R(E));Ve(v,Ze(c.current==="mounted"?N:"none"))})}),At(()=>{if(R(E))return Ve(g,Ze(getComputedStyle(R(E)))),R(E).addEventListener("animationstart",K),R(E).addEventListener("animationcancel",q),R(E).addEventListener("animationend",q),()=>{var N,ie,te;(N=R(E))==null||N.removeEventListener("animationstart",K),(ie=R(E))==null||ie.removeEventListener("animationcancel",q),(te=R(E))==null||te.removeEventListener("animationend",q)}});const V=Pe(()=>["mounted","unmountSuspended"].includes(c.current));return{get current(){return R(V)}}}function Wf(f){return f&&getComputedStyle(f).animationName||"none"}function r_(f,s){Et(s,!0);const g=aT(be.with(()=>s.present),be.with(()=>s.id));var v=Ke(),I=Ne(v);{var E=w=>{var c=Ke(),U=Ne(c);Ct(U,()=>s.presence??Xt,()=>({present:g})),Te(w,c)};hi(I,w=>{(s.forceMount||s.present||g.current)&&w(E)})}Te(f,v),kt()}var lT=Vt("<div><!></div>");function cT(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"id",19,Gi),I=J(s,"forceMount",3,!1),E=Gt(s,["$$slots","$$events","$$legacy","child","ref","id","forceMount","children"]);const w=GP({forceMount:be.with(()=>I()),id:be.with(()=>v()),ref:be.with(()=>g(),c=>g(c))});r_(f,{forceMount:!0,get present(){return w.present},get id(){return v()},presence:(U,q)=>{let K=()=>q==null?void 0:q().present;var V=Ke();const N=Pe(()=>Pi(E,w.props,{hidden:I()?void 0:!K().current}));var ie=Ne(V);{var te=ue=>{var ye=Ke(),pe=Ne(ye);Ct(pe,()=>s.child,()=>({props:R(N),...w.snippetProps})),Te(ue,ye)},oe=ue=>{var ye=lT();let pe;var Ae=ci(ye);Ct(Ae,()=>s.children??Xt),ui(ye),di(()=>pe=Oi(ye,pe,{...R(N)})),Te(ue,ye)};hi(ie,ue=>{s.child?ue(te):ue(oe,!1)})}Te(U,V)},$$slots:{presence:!0}}),kt()}function uT(f){return{content:`data-${f}-content`,trigger:`data-${f}-trigger`,overlay:`data-${f}-overlay`,title:`data-${f}-title`,description:`data-${f}-description`,close:`data-${f}-close`,cancel:`data-${f}-cancel`,action:`data-${f}-action`}}var Ph,Th,Ih,Ah,Ch,Eh,kh,Mh,zh,bm,wm;class hT{constructor(s){Oe(this,"open");Oe(this,"variant");W(this,Ph,Ye(null));W(this,Th,Ye(null));W(this,Ih,Ye(null));W(this,Ah,Ye(null));W(this,Ch,Ye(void 0));W(this,Eh,Ye(void 0));W(this,kh,Ye(void 0));W(this,Mh,Ye(void 0));W(this,zh,Ye(null));W(this,bm,Pe(()=>uT(this.variant.current)));Oe(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});Oe(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});W(this,wm,Pe(()=>({"data-state":Ua(this.open.current)})));this.open=s.open,this.variant=s.variant}get triggerNode(){return R(T(this,Ph))}set triggerNode(s){Ve(T(this,Ph),Ze(s))}get titleNode(){return R(T(this,Th))}set titleNode(s){Ve(T(this,Th),Ze(s))}get contentNode(){return R(T(this,Ih))}set contentNode(s){Ve(T(this,Ih),Ze(s))}get descriptionNode(){return R(T(this,Ah))}set descriptionNode(s){Ve(T(this,Ah),Ze(s))}get contentId(){return R(T(this,Ch))}set contentId(s){Ve(T(this,Ch),Ze(s))}get titleId(){return R(T(this,Eh))}set titleId(s){Ve(T(this,Eh),Ze(s))}get triggerId(){return R(T(this,kh))}set triggerId(s){Ve(T(this,kh),Ze(s))}get descriptionId(){return R(T(this,Mh))}set descriptionId(s){Ve(T(this,Mh),Ze(s))}get cancelNode(){return R(T(this,zh))}set cancelNode(s){Ve(T(this,zh),Ze(s))}get attrs(){return R(T(this,bm))}get sharedProps(){return R(T(this,wm))}}Ph=new WeakMap,Th=new WeakMap,Ih=new WeakMap,Ah=new WeakMap,Ch=new WeakMap,Eh=new WeakMap,kh=new WeakMap,Mh=new WeakMap,zh=new WeakMap,bm=new WeakMap,wm=new WeakMap;var $l,Dh,Ws,Rh,Sm;class dT{constructor(s,g){W(this,$l);W(this,Dh);W(this,Ws);W(this,Rh);W(this,Sm,Pe(()=>({id:T(this,$l).current,role:"heading","aria-level":T(this,Rh).current,[T(this,Ws).attrs.title]:"",...T(this,Ws).sharedProps})));Le(this,$l,s.id),Le(this,Ws,g),Le(this,Dh,s.ref),Le(this,Rh,s.level),Bi({id:T(this,$l),ref:T(this,Dh),onRefChange:v=>{T(this,Ws).titleNode=v,T(this,Ws).titleId=v==null?void 0:v.id},deps:()=>T(this,Ws).open.current})}get props(){return R(T(this,Sm))}}$l=new WeakMap,Dh=new WeakMap,Ws=new WeakMap,Rh=new WeakMap,Sm=new WeakMap;var ec,Lh,Xs,Pm;class pT{constructor(s,g){W(this,ec);W(this,Lh);W(this,Xs);W(this,Pm,Pe(()=>({id:T(this,ec).current,[T(this,Xs).attrs.description]:"",...T(this,Xs).sharedProps})));Le(this,ec,s.id),Le(this,Xs,g),Le(this,Lh,s.ref),Bi({id:T(this,ec),ref:T(this,Lh),deps:()=>T(this,Xs).open.current,onRefChange:v=>{T(this,Xs).descriptionNode=v,T(this,Xs).descriptionId=v==null?void 0:v.id}})}get props(){return R(T(this,Pm))}}ec=new WeakMap,Lh=new WeakMap,Xs=new WeakMap,Pm=new WeakMap;var tc,Oh,Tm,Im;class fT{constructor(s,g){W(this,tc);W(this,Oh);Oe(this,"root");W(this,Tm,Pe(()=>({open:this.root.open.current})));W(this,Im,Pe(()=>({id:T(this,tc).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Le(this,tc,s.id),this.root=g,Le(this,Oh,s.ref),Bi({id:T(this,tc),ref:T(this,Oh),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return R(T(this,Tm))}get props(){return R(T(this,Im))}}tc=new WeakMap,Oh=new WeakMap,Tm=new WeakMap,Im=new WeakMap;var ic,Fh,Am,Cm;class mT{constructor(s,g){W(this,ic);W(this,Fh);Oe(this,"root");W(this,Am,Pe(()=>({open:this.root.open.current})));W(this,Cm,Pe(()=>({id:T(this,ic).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Le(this,ic,s.id),Le(this,Fh,s.ref),this.root=g,Bi({id:T(this,ic),ref:T(this,Fh),deps:()=>this.root.open.current})}get snippetProps(){return R(T(this,Am))}get props(){return R(T(this,Cm))}}ic=new WeakMap,Fh=new WeakMap,Am=new WeakMap,Cm=new WeakMap;const[gT,n_]=$s("Dialog.Root");function _T(f){return gT(new hT(f))}function yT(f){return new dT(f,n_())}function vT(f){return new fT(f,n_())}function xT(f){return new mT(f,n_())}function bT(f){return new pT(f,n_())}var wT=Vt("<div><!></div>");function ST(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"level",3,2),E=Gt(s,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const w=yT({id:be.with(()=>g()),level:be.with(()=>I()),ref:be.with(()=>v(),N=>v(N))}),c=Pe(()=>Pi(E,w.props));var U=Ke(),q=Ne(U);{var K=N=>{var ie=Ke(),te=Ne(ie);Ct(te,()=>s.child,()=>({props:R(c)})),Te(N,ie)},V=N=>{var ie=wT();let te;var oe=ci(ie);Ct(oe,()=>s.children??Xt),ui(ie),di(()=>te=Oi(ie,te,{...R(c)})),Te(N,ie)};hi(q,N=>{s.child?N(K):N(V,!1)})}Te(f,U),kt()}function PT(f,s){Et(s,!0);var g=Ke(),v=Ne(g);sb(v,()=>s.children,I=>{var E=Ke(),w=Ne(E);Ct(w,()=>s.children??Xt),Te(I,E)}),Te(f,g),kt()}function kb(f,s){Et(s,!0);let g=J(s,"to",3,"body");const v=O2();let I=Pe(E);function E(){if(!i_||s.disabled)return null;let K=null;return typeof g()=="string"?K=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(K=g()),K}let w;At(()=>{if(!R(I)||s.disabled){w&&(m0(w),w=null);return}return Ri(()=>w=V2(PT,{target:R(I),props:{children:s.children},context:v})),()=>{w&&(m0(w),w=null)}});var c=Ke(),U=Ne(c);{var q=K=>{var V=Ke(),N=Ne(V);Ct(N,()=>s.children??Xt),Te(K,V)};hi(U,K=>{s.disabled&&K(q)})}Te(f,c),kt()}function ys(f,s,g,v){const I=Array.isArray(s)?s:[s];return I.forEach(E=>f.addEventListener(E,g,v)),()=>{I.forEach(E=>f.removeEventListener(E,g,v))}}function k0(f,s=500){let g=null;const v=(...I)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{f(...I)},s)};return v.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},v}function pv(f,s){return f===s||f.contains(s)}function Mb(f){return(f==null?void 0:f.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var rc,za,jo,nc,Uo,sc,oc,Bh,Nh,Vh,Ks,Em,Bc,zb,km,ac,Mm,zm,Dm,Rm,jh,Db,Lm,Om;class TT{constructor(s){W(this,Bc);W(this,rc);W(this,za);W(this,jo,{pointerdown:!1});W(this,nc,!1);Oe(this,"node",be(null));W(this,Uo);W(this,sc);W(this,oc,Ye(!1));W(this,Bh);W(this,Nh,Ye(null));W(this,Vh);W(this,Ks,Yi);W(this,Em,s=>{s.defaultPrevented||this.currNode&&Na(()=>{var g,v;!this.currNode||T(this,Rm).call(this,s.target)||s.target&&!R(T(this,oc))&&((v=(g=T(this,Bh)).current)==null||v.call(g,s))})});W(this,km,s=>{let g=s;g.defaultPrevented&&(g=M0(s)),T(this,rc).current(s)});W(this,ac,k0(s=>{if(!this.currNode){T(this,Ks).call(this);return}const g=T(this,Vh).current(s,this.currNode)||ET(s,this.currNode);if(!T(this,nc)||jn(this,Bc,Db).call(this)||!g){T(this,Ks).call(this);return}let v=s;if(v.defaultPrevented&&(v=M0(v)),T(this,za).current!=="close"&&T(this,za).current!=="defer-otherwise-close"){T(this,Ks).call(this);return}s.pointerType==="touch"?(T(this,Ks).call(this),Le(this,Ks,ys(T(this,Uo),"click",T(this,km),{once:!0}))):T(this,rc).current(v)},10));W(this,Mm,s=>{T(this,jo)[s.type]=!0});W(this,zm,s=>{T(this,jo)[s.type]=!1});W(this,Dm,()=>{this.node.current&&Le(this,nc,CT(this.node.current))});W(this,Rm,s=>this.node.current?pv(this.node.current,s):!1);W(this,jh,k0(()=>{for(const s in T(this,jo))T(this,jo)[s]=!1;Le(this,nc,!1)},20));W(this,Lm,()=>{Ve(T(this,oc),!0)});W(this,Om,()=>{Ve(T(this,oc),!1)});Oe(this,"props",{onfocuscapture:T(this,Lm),onblurcapture:T(this,Om)});Le(this,sc,s.enabled),Le(this,Vh,s.isValidEvent),Bi({id:s.id,ref:this.node,deps:()=>T(this,sc).current,onRefChange:I=>{this.currNode=I}}),Le(this,za,s.interactOutsideBehavior),Le(this,rc,s.onInteractOutside),Le(this,Bh,s.onFocusOutside),At(()=>{Le(this,Uo,Mb(this.currNode))});let g=Yi;const v=()=>{T(this,jh).call(this),globalThis.bitsDismissableLayers.delete(this),T(this,ac).destroy(),g()};At(()=>(T(this,sc).current&&this.currNode&&Np(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,Ri(()=>T(this,za))),g(),g=jn(this,Bc,zb).call(this))}),()=>{v()})),lP(()=>{T(this,jh).destroy(),globalThis.bitsDismissableLayers.delete(this),T(this,ac).destroy(),T(this,Ks).call(this),g()})}get currNode(){return R(T(this,Nh))}set currNode(s){Ve(T(this,Nh),Ze(s))}}rc=new WeakMap,za=new WeakMap,jo=new WeakMap,nc=new WeakMap,Uo=new WeakMap,sc=new WeakMap,oc=new WeakMap,Bh=new WeakMap,Nh=new WeakMap,Vh=new WeakMap,Ks=new WeakMap,Em=new WeakMap,Bc=new WeakSet,zb=function(){return Vl(ys(T(this,Uo),"pointerdown",Vl(T(this,Mm),T(this,Dm)),!0),ys(T(this,Uo),"pointerdown",Vl(T(this,zm),T(this,ac))),ys(T(this,Uo),"focusin",T(this,Em)))},km=new WeakMap,ac=new WeakMap,Mm=new WeakMap,zm=new WeakMap,Dm=new WeakMap,Rm=new WeakMap,jh=new WeakMap,Db=function(){return Object.values(T(this,jo)).some(Boolean)},Lm=new WeakMap,Om=new WeakMap;function IT(f){return new TT(f)}function AT(f){return f.findLast(([s,{current:g}])=>g==="close"||g==="ignore")}function CT(f){const s=[...globalThis.bitsDismissableLayers],g=AT(s);if(g)return g[0].node.current===f;const[v]=s[0];return v.node.current===f}function ET(f,s){if("button"in f&&f.button>0)return!1;const g=f.target;return wP(g)?Mb(g).documentElement.contains(g)&&!pv(s,g):!1}function M0(f){const s=f.currentTarget,g=f.target;let v;f instanceof PointerEvent?v=new PointerEvent(f.type,f):v=new PointerEvent("pointerdown",f);let I=!1;return new Proxy(v,{get:(w,c)=>c==="currentTarget"?s:c==="target"?g:c==="preventDefault"?()=>{I=!0,typeof w.preventDefault=="function"&&w.preventDefault()}:c==="defaultPrevented"?I:c in w?w[c]:f[c]})}function Rb(f,s){Et(s,!0);let g=J(s,"interactOutsideBehavior",3,"close"),v=J(s,"onInteractOutside",3,Yi),I=J(s,"onFocusOutside",3,Yi),E=J(s,"isValidEvent",3,()=>!1);const w=IT({id:be.with(()=>s.id),interactOutsideBehavior:be.with(()=>g()),onInteractOutside:be.with(()=>v()),enabled:be.with(()=>s.enabled),onFocusOutside:be.with(()=>I()),isValidEvent:be.with(()=>E())});var c=Ke(),U=Ne(c);Ct(U,()=>s.children??Xt,()=>({props:w.props})),Te(f,c),kt()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var Uh,lc,qh,Fm,Bm;class kT{constructor(s){W(this,Uh);W(this,lc);W(this,qh);W(this,Fm,()=>ys(document,"keydown",T(this,Bm),{passive:!1}));W(this,Bm,s=>{if(s.key!==hP||!zT(this))return;const g=new KeyboardEvent(s.type,s);s.preventDefault();const v=T(this,lc).current;v!=="close"&&v!=="defer-otherwise-close"||T(this,Uh).current(g)});Le(this,lc,s.escapeKeydownBehavior),Le(this,Uh,s.onEscapeKeydown),Le(this,qh,s.enabled);let g=Yi;At(()=>(T(this,qh).current&&(globalThis.bitsEscapeLayers.set(this,Ri(()=>T(this,lc))),g=T(this,Fm).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}Uh=new WeakMap,lc=new WeakMap,qh=new WeakMap,Fm=new WeakMap,Bm=new WeakMap;function MT(f){return new kT(f)}function zT(f){const s=[...globalThis.bitsEscapeLayers],g=s.findLast(([I,{current:E}])=>E==="close"||E==="ignore");if(g)return g[0]===f;const[v]=s[0];return v===f}function Lb(f,s){Et(s,!0);let g=J(s,"escapeKeydownBehavior",3,"close"),v=J(s,"onEscapeKeydown",3,Yi);MT({escapeKeydownBehavior:be.with(()=>g()),onEscapeKeydown:be.with(()=>v()),enabled:be.with(()=>s.enabled)});var I=Ke(),E=Ne(I);Ct(E,()=>s.children??Xt),Te(f,I),kt()}const DT=be([]);function RT(){const f=DT;return{add(s){const g=f.current[0];s.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),f.current=z0(f.current,s),f.current.unshift(s)},remove(s){var g;f.current=z0(f.current,s),(g=f.current[0])==null||g.resume()}}}function LT(){let f=Ye(!1);return{id:Gi(),get paused(){return R(f)},pause(){Ve(f,!0)},resume(){Ve(f,!1)}}}function z0(f,s){return[...f].filter(g=>g.id!==s.id)}function OT(f){return f.filter(s=>s.tagName!=="A")}function Fo(f,{select:s=!1}={}){if(!(f&&f.focus))return;const g=document.activeElement;f.focus({preventScroll:!0}),f!==g&&PP(f)&&s&&f.select()}function FT(f,{select:s=!1}={}){const g=document.activeElement;for(const v of f)if(Fo(v,{select:s}),document.activeElement!==g)return!0}function D0(f,s){for(const g of f)if(!TP(g,s))return g}function Ob(f){const s=[],g=document.createTreeWalker(f,NodeFilter.SHOW_ELEMENT,{acceptNode:v=>{const I=v.tagName==="INPUT"&&v.type==="hidden";return v.disabled||v.hidden||I?NodeFilter.FILTER_SKIP:v.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)s.push(g.currentNode);return s}function BT(f){const s=Ob(f),g=D0(s,f),v=D0(s.reverse(),f);return[g,v]}const NT="focusScope.autoFocusOnMount",VT="focusScope.autoFocusOnDestroy",R0={bubbles:!1,cancelable:!0};function jT({id:f,loop:s,enabled:g,onOpenAutoFocus:v,onCloseAutoFocus:I,forceMount:E}){const w=RT(),c=LT(),U=be(null);Bi({id:f,ref:U,deps:()=>g.current});let q=Ye(null);At(()=>{const te=U.current;if(!te||!g.current)return;function oe(pe){if(c.paused||!te)return;const Ae=pe.target;nm(Ae)&&(te.contains(Ae)?Ve(q,Ze(Ae)):Fo(R(q),{select:!0}))}function ue(pe){if(c.paused||!te)return;const Ae=pe.relatedTarget;nm(Ae)&&Ae!==null&&(te.contains(Ae)||Fo(R(q),{select:!0}))}function ye(pe){(te==null?void 0:te.contains(R(q)))||Fo(te)}return Ri(()=>{const pe=Vl(ys(document,"focusin",oe),ys(document,"focusout",ue)),Ae=new MutationObserver(ye);return Ae.observe(te,{childList:!0,subtree:!0}),()=>{pe(),Ae.disconnect()}})}),At(()=>{if(E.current)return;let te=U.current;const oe=document.activeElement;return Ri(()=>{K(te,oe)}),()=>{te&&V(oe)}}),At(()=>{if(!E.current)return;g.current;const te=U.current,oe=document.activeElement;return Ri(()=>{K(te,oe)}),()=>{te&&V(oe)}});function K(te,oe){if(te||(te=document.getElementById(f.current)),!te)return;if(w.add(c),!te.contains(oe)){const ye=new CustomEvent(NT,R0);v.current(ye),ye.defaultPrevented||Na(()=>{te&&(FT(OT(Ob(te)),{select:!0}),document.activeElement===oe&&Fo(te))})}}function V(te){const oe=new CustomEvent(VT,R0);I.current(oe),setTimeout(()=>{!oe.defaultPrevented&&te&&Fo(te??document.body,{select:!0}),w.remove(c)},0)}function N(te){if(!g.current||!s.current&&!g.current||c.paused)return;const oe=te.key===dP&&!te.ctrlKey&&!te.altKey&&!te.metaKey,ue=document.activeElement;if(!(oe&&ue))return;const ye=U.current;if(!ye)return;const[pe,Ae]=BT(ye);pe&&Ae?!te.shiftKey&&ue===Ae?(te.preventDefault(),s.current&&Fo(pe,{select:!0})):te.shiftKey&&ue===pe&&(te.preventDefault(),s.current&&Fo(Ae,{select:!0})):ue===ye&&te.preventDefault()}const ie=Pe(()=>({id:f.current,tabindex:-1,onkeydown:N}));return{get props(){return R(ie)}}}function Fb(f,s){Et(s,!0);let g=J(s,"trapFocus",3,!1),v=J(s,"loop",3,!1),I=J(s,"onCloseAutoFocus",3,Yi),E=J(s,"onOpenAutoFocus",3,Yi),w=J(s,"forceMount",3,!1);const c=jT({enabled:be.with(()=>g()),loop:be.with(()=>v()),onCloseAutoFocus:be.with(()=>I()),onOpenAutoFocus:be.with(()=>E()),id:be.with(()=>s.id),forceMount:be.with(()=>w())});var U=Ke(),q=Ne(U);Ct(q,()=>s.focusScope??Xt,()=>({props:c.props})),Te(f,U),kt()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Zh,Gh,Hh,qo,cc,Wh,Nm,Bb,Vm,Xh;class UT{constructor(s){W(this,Nm);W(this,Zh);W(this,Gh);W(this,Hh);W(this,qo);W(this,cc,Yi);W(this,Wh,be(null));W(this,Vm,s=>{const g=T(this,Wh).current,v=s.target;!nm(g)||!nm(v)||!T(this,qo).current||!GT(this)||!pv(g,v)||(T(this,Gh).current(s),!s.defaultPrevented&&Le(this,cc,ZT(g)))});W(this,Xh,()=>{T(this,cc).call(this),Le(this,cc,Yi)});Le(this,Zh,s.id),Le(this,qo,s.preventOverflowTextSelection),Le(this,Gh,s.onPointerDown),Le(this,Hh,s.onPointerUp),Bi({id:T(this,Zh),ref:T(this,Wh),deps:()=>T(this,qo).current});let g=Yi;At(()=>(T(this,qo).current&&(globalThis.bitsTextSelectionLayers.set(this,Ri(()=>T(this,qo))),g=jn(this,Nm,Bb).call(this)),()=>{g(),T(this,Xh).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Zh=new WeakMap,Gh=new WeakMap,Hh=new WeakMap,qo=new WeakMap,cc=new WeakMap,Wh=new WeakMap,Nm=new WeakSet,Bb=function(){return Vl(ys(document,"pointerdown",T(this,Vm)),ys(document,"pointerup",xb(T(this,Xh),T(this,Hh))))},Vm=new WeakMap,Xh=new WeakMap;function qT(f){return new UT(f)}const L0=f=>f.style.userSelect||f.style.webkitUserSelect;function ZT(f){const s=document.body,g=L0(s),v=L0(f);return Xf(s,"none"),Xf(f,"text"),()=>{Xf(s,g),Xf(f,v)}}function Xf(f,s){f.style.userSelect=s,f.style.webkitUserSelect=s}function GT(f){const s=[...globalThis.bitsTextSelectionLayers];if(!s.length)return!1;const g=s.at(-1);return g?g[0]===f:!1}function Nb(f,s){Et(s,!0);let g=J(s,"preventOverflowTextSelection",3,!0),v=J(s,"onPointerDown",3,Yi),I=J(s,"onPointerUp",3,Yi);qT({id:be.with(()=>s.id),preventOverflowTextSelection:be.with(()=>g()),onPointerDown:be.with(()=>v()),onPointerUp:be.with(()=>I()),enabled:be.with(()=>s.enabled)});var E=Ke(),w=Ne(E);Ct(w,()=>s.children??Xt),Te(f,E),kt()}var HT=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],WT=["difference","intersection","symmetricDifference","union"],O0=!1,uc,Jn,Zo,jm,Vb;const Um=class Um extends Set{constructor(g){super();W(this,jm);W(this,uc,new Map);W(this,Jn,Zs(0));W(this,Zo,Zs(0));if(g){for(var v of g)super.add(v);T(this,Zo).v=super.size}O0||jn(this,jm,Vb).call(this)}has(g){var v=super.has(g),I=T(this,uc),E=I.get(g);if(E===void 0){if(!v)return R(T(this,Jn)),!1;E=Zs(!0),I.set(g,E)}return R(E),v}add(g){return super.has(g)||(super.add(g),Ve(T(this,Zo),super.size),Bo(T(this,Jn))),this}delete(g){var v=super.delete(g),I=T(this,uc),E=I.get(g);return E!==void 0&&(I.delete(g),Ve(E,!1)),v&&(Ve(T(this,Zo),super.size),Bo(T(this,Jn))),v}clear(){if(super.size!==0){super.clear();var g=T(this,uc);for(var v of g.values())Ve(v,!1);g.clear(),Ve(T(this,Zo),0),Bo(T(this,Jn))}}keys(){return this.values()}values(){return R(T(this,Jn)),super.values()}entries(){return R(T(this,Jn)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return R(T(this,Zo))}};uc=new WeakMap,Jn=new WeakMap,Zo=new WeakMap,jm=new WeakSet,Vb=function(){O0=!0;var g=Um.prototype,v=Set.prototype;for(const I of HT)g[I]=function(...E){return R(T(this,Jn)),v[I].apply(this,E)};for(const I of WT)g[I]=function(...E){R(T(this,Jn));var w=v[I].apply(this,E);return new Um(w)}};let Yy=Um;var ps,fs,Js,hc,$f;const Iv=class Iv extends Map{constructor(g){super();W(this,hc);W(this,ps,new Map);W(this,fs,Zs(0));W(this,Js,Zs(0));if(g){for(var[v,I]of g)super.set(v,I);T(this,Js).v=super.size}}has(g){var v=T(this,ps),I=v.get(g);if(I===void 0){var E=super.get(g);if(E!==void 0)I=Zs(0),v.set(g,I);else return R(T(this,fs)),!1}return R(I),!0}forEach(g,v){jn(this,hc,$f).call(this),super.forEach(g,v)}get(g){var v=T(this,ps),I=v.get(g);if(I===void 0){var E=super.get(g);if(E!==void 0)I=Zs(0),v.set(g,I);else{R(T(this,fs));return}}return R(I),super.get(g)}set(g,v){var V;var I=T(this,ps),E=I.get(g),w=super.get(g),c=super.set(g,v),U=T(this,fs);if(E===void 0)I.set(g,Zs(0)),Ve(T(this,Js),super.size),Bo(U);else if(w!==v){Bo(E);var q=U.reactions===null?null:new Set(U.reactions),K=q===null||!((V=E.reactions)!=null&&V.every(N=>q.has(N)));K&&Bo(U)}return c}delete(g){var v=T(this,ps),I=v.get(g),E=super.delete(g);return I!==void 0&&(v.delete(g),Ve(T(this,Js),super.size),Ve(I,-1),Bo(T(this,fs))),E}clear(){if(super.size!==0){super.clear();var g=T(this,ps);Ve(T(this,Js),0);for(var v of g.values())Ve(v,-1);Bo(T(this,fs)),g.clear()}}keys(){return R(T(this,fs)),super.keys()}values(){return jn(this,hc,$f).call(this),super.values()}entries(){return jn(this,hc,$f).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return R(T(this,Js)),super.size}};ps=new WeakMap,fs=new WeakMap,Js=new WeakMap,hc=new WeakSet,$f=function(){R(T(this,fs));var g=T(this,ps);if(T(this,Js).v!==g.size)for(var v of h0(Iv.prototype,this,"keys").call(this))g.has(v)||g.set(v,Zs(0));for(var[,I]of T(this,ps))R(I)};let Qy=Iv;function XT(f){let s=0,g=Ye(void 0),v;function I(){s-=1,v&&s<=0&&(v(),Ve(g,void 0),v=void 0)}return(...E)=>(s+=1,R(g)===void 0&&(v=F2(()=>{Ve(g,Ze(f(...E)))})),At(()=>()=>{I()}),R(g))}const KT=XT(()=>{const f=new Qy,s=Pe(()=>{for(const E of f.values())if(E)return!0;return!1});let g=Ze({}),v=null;function I(){i_&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",A0&&(v==null||v()))}return At(()=>{const E=R(s);return Ri(()=>{if(!E)return;const w=getComputedStyle(document.body);g.overflow=w.overflow,g.paddingRight=w.paddingRight,g.marginRight=w.marginRight,g.pointerEvents=w.pointerEvents;const c=window.innerWidth-document.documentElement.clientWidth,q={padding:Number.parseInt(g.paddingRight??"0",10)+c,margin:Number.parseInt(g.marginRight??"0",10)};c>0&&(document.body.style.paddingRight=`${q.padding}px`,document.body.style.marginRight=`${q.margin}px`,document.body.style.setProperty("--scrollbar-width",`${c}px`),document.body.style.overflow="hidden"),A0&&(v=ys(document,"touchmove",K=>{K.target===document.documentElement&&(K.touches.length>1||K.preventDefault())},{passive:!1})),Na(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),At(()=>()=>{v==null||v()}),{get map(){return f},resetBodyStyle:I}});function JT(f,s=()=>null){const g=Gi(),v=KT(),I=Pe(s);v.map.set(g,f??!1);const E=be.with(()=>v.map.get(g)??!1,w=>v.map.set(g,w));return At(()=>()=>{v.map.delete(g),!YT(v.map)&&(R(I)===null?requestAnimationFrame(()=>v.resetBodyStyle()):Np(R(I),()=>v.resetBodyStyle()))}),E}function YT(f){for(const[s,g]of f)if(g)return!0;return!1}function sm(f,s){Et(s,!0);let g=J(s,"preventScroll",3,!0),v=J(s,"restoreScrollDelay",3,null);JT(g(),()=>v()),kt()}function QT({forceMount:f,present:s,trapFocus:g,open:v}){return f?v&&g:s&&g&&v}var $T=Vt("<div><!></div>");function eI(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"forceMount",3,!1),I=J(s,"ref",15,null),E=Gt(s,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const w=xT({id:be.with(()=>g()),ref:be.with(()=>I(),q=>I(q))}),c=Pe(()=>Pi(E,w.props));var U=Pe(()=>w.root.open.current||v());r_(f,{get id(){return g()},get present(){return R(U)},presence:K=>{var V=Ke(),N=Ne(V);{var ie=oe=>{var ue=Ke(),ye=Ne(ue),pe=$g(()=>({props:Pi(R(c)),...w.snippetProps}));Ct(ye,()=>s.child,()=>R(pe)),Te(oe,ue)},te=oe=>{var ue=$T();const ye=Pe(()=>Pi(R(c)));let pe;var Ae=ci(ue);Ct(Ae,()=>s.children??Xt,()=>w.snippetProps),ui(ue),di(()=>pe=Oi(ue,pe,{...R(ye)})),Te(oe,ue)};hi(N,oe=>{s.child?oe(ie):oe(te,!1)})}Te(K,V)},$$slots:{presence:!0}}),kt()}var tI=Vt("<div><!></div>");function iI(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","children","child","ref"]);const E=bT({id:be.with(()=>g()),ref:be.with(()=>v(),V=>v(V))}),w=Pe(()=>Pi(I,E.props));var c=Ke(),U=Ne(c);{var q=V=>{var N=Ke(),ie=Ne(N);Ct(ie,()=>s.child,()=>({props:R(w)})),Te(V,N)},K=V=>{var N=tI();let ie;var te=ci(N);Ct(te,()=>s.children??Xt),ui(N),di(()=>ie=Oi(N,ie,{...R(w)})),Te(V,N)};hi(U,V=>{s.child?V(q):V(K,!1)})}Te(f,c),kt()}const rI=["top","right","bottom","left"],Jo=Math.min,Cn=Math.max,om=Math.round,Kf=Math.floor,vs=f=>({x:f,y:f}),nI={left:"right",right:"left",bottom:"top",top:"bottom"},sI={start:"end",end:"start"};function $y(f,s,g){return Cn(f,Jo(s,g))}function Ys(f,s){return typeof f=="function"?f(s):f}function Qs(f){return f.split("-")[0]}function Vc(f){return f.split("-")[1]}function fv(f){return f==="x"?"y":"x"}function mv(f){return f==="y"?"height":"width"}function Yo(f){return["top","bottom"].includes(Qs(f))?"y":"x"}function gv(f){return fv(Yo(f))}function oI(f,s,g){g===void 0&&(g=!1);const v=Vc(f),I=gv(f),E=mv(I);let w=I==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return s.reference[E]>s.floating[E]&&(w=am(w)),[w,am(w)]}function aI(f){const s=am(f);return[ev(f),s,ev(s)]}function ev(f){return f.replace(/start|end/g,s=>sI[s])}function lI(f,s,g){const v=["left","right"],I=["right","left"],E=["top","bottom"],w=["bottom","top"];switch(f){case"top":case"bottom":return g?s?I:v:s?v:I;case"left":case"right":return s?E:w;default:return[]}}function cI(f,s,g,v){const I=Vc(f);let E=lI(Qs(f),g==="start",v);return I&&(E=E.map(w=>w+"-"+I),s&&(E=E.concat(E.map(ev)))),E}function am(f){return f.replace(/left|right|bottom|top/g,s=>nI[s])}function uI(f){return{top:0,right:0,bottom:0,left:0,...f}}function jb(f){return typeof f!="number"?uI(f):{top:f,right:f,bottom:f,left:f}}function lm(f){const{x:s,y:g,width:v,height:I}=f;return{width:v,height:I,top:g,left:s,right:s+v,bottom:g+I,x:s,y:g}}function F0(f,s,g){let{reference:v,floating:I}=f;const E=Yo(s),w=gv(s),c=mv(w),U=Qs(s),q=E==="y",K=v.x+v.width/2-I.width/2,V=v.y+v.height/2-I.height/2,N=v[c]/2-I[c]/2;let ie;switch(U){case"top":ie={x:K,y:v.y-I.height};break;case"bottom":ie={x:K,y:v.y+v.height};break;case"right":ie={x:v.x+v.width,y:V};break;case"left":ie={x:v.x-I.width,y:V};break;default:ie={x:v.x,y:v.y}}switch(Vc(s)){case"start":ie[w]-=N*(g&&q?-1:1);break;case"end":ie[w]+=N*(g&&q?-1:1);break}return ie}const hI=async(f,s,g)=>{const{placement:v="bottom",strategy:I="absolute",middleware:E=[],platform:w}=g,c=E.filter(Boolean),U=await(w.isRTL==null?void 0:w.isRTL(s));let q=await w.getElementRects({reference:f,floating:s,strategy:I}),{x:K,y:V}=F0(q,v,U),N=v,ie={},te=0;for(let oe=0;oe<c.length;oe++){const{name:ue,fn:ye}=c[oe],{x:pe,y:Ae,data:ze,reset:Me}=await ye({x:K,y:V,initialPlacement:v,placement:N,strategy:I,middlewareData:ie,rects:q,platform:w,elements:{reference:f,floating:s}});K=pe??K,V=Ae??V,ie={...ie,[ue]:{...ie[ue],...ze}},Me&&te<=50&&(te++,typeof Me=="object"&&(Me.placement&&(N=Me.placement),Me.rects&&(q=Me.rects===!0?await w.getElementRects({reference:f,floating:s,strategy:I}):Me.rects),{x:K,y:V}=F0(q,N,U)),oe=-1)}return{x:K,y:V,placement:N,strategy:I,middlewareData:ie}};async function uh(f,s){var g;s===void 0&&(s={});const{x:v,y:I,platform:E,rects:w,elements:c,strategy:U}=f,{boundary:q="clippingAncestors",rootBoundary:K="viewport",elementContext:V="floating",altBoundary:N=!1,padding:ie=0}=Ys(s,f),te=jb(ie),ue=c[N?V==="floating"?"reference":"floating":V],ye=lm(await E.getClippingRect({element:(g=await(E.isElement==null?void 0:E.isElement(ue)))==null||g?ue:ue.contextElement||await(E.getDocumentElement==null?void 0:E.getDocumentElement(c.floating)),boundary:q,rootBoundary:K,strategy:U})),pe=V==="floating"?{x:v,y:I,width:w.floating.width,height:w.floating.height}:w.reference,Ae=await(E.getOffsetParent==null?void 0:E.getOffsetParent(c.floating)),ze=await(E.isElement==null?void 0:E.isElement(Ae))?await(E.getScale==null?void 0:E.getScale(Ae))||{x:1,y:1}:{x:1,y:1},Me=lm(E.convertOffsetParentRelativeRectToViewportRelativeRect?await E.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:pe,offsetParent:Ae,strategy:U}):pe);return{top:(ye.top-Me.top+te.top)/ze.y,bottom:(Me.bottom-ye.bottom+te.bottom)/ze.y,left:(ye.left-Me.left+te.left)/ze.x,right:(Me.right-ye.right+te.right)/ze.x}}const dI=f=>({name:"arrow",options:f,async fn(s){const{x:g,y:v,placement:I,rects:E,platform:w,elements:c,middlewareData:U}=s,{element:q,padding:K=0}=Ys(f,s)||{};if(q==null)return{};const V=jb(K),N={x:g,y:v},ie=gv(I),te=mv(ie),oe=await w.getDimensions(q),ue=ie==="y",ye=ue?"top":"left",pe=ue?"bottom":"right",Ae=ue?"clientHeight":"clientWidth",ze=E.reference[te]+E.reference[ie]-N[ie]-E.floating[te],Me=N[ie]-E.reference[ie],je=await(w.getOffsetParent==null?void 0:w.getOffsetParent(q));let Je=je?je[Ae]:0;(!Je||!await(w.isElement==null?void 0:w.isElement(je)))&&(Je=c.floating[Ae]||E.floating[te]);const _t=ze/2-Me/2,Ge=Je/2-oe[te]/2-1,gt=Jo(V[ye],Ge),at=Jo(V[pe],Ge),Ue=gt,Fe=Je-oe[te]-at,Ce=Je/2-oe[te]/2+_t,He=$y(Ue,Ce,Fe),st=!U.arrow&&Vc(I)!=null&&Ce!==He&&E.reference[te]/2-(Ce<Ue?gt:at)-oe[te]/2<0,yt=st?Ce<Ue?Ce-Ue:Ce-Fe:0;return{[ie]:N[ie]+yt,data:{[ie]:He,centerOffset:Ce-He-yt,...st&&{alignmentOffset:yt}},reset:st}}}),pI=function(f){return f===void 0&&(f={}),{name:"flip",options:f,async fn(s){var g,v;const{placement:I,middlewareData:E,rects:w,initialPlacement:c,platform:U,elements:q}=s,{mainAxis:K=!0,crossAxis:V=!0,fallbackPlacements:N,fallbackStrategy:ie="bestFit",fallbackAxisSideDirection:te="none",flipAlignment:oe=!0,...ue}=Ys(f,s);if((g=E.arrow)!=null&&g.alignmentOffset)return{};const ye=Qs(I),pe=Yo(c),Ae=Qs(c)===c,ze=await(U.isRTL==null?void 0:U.isRTL(q.floating)),Me=N||(Ae||!oe?[am(c)]:aI(c)),je=te!=="none";!N&&je&&Me.push(...cI(c,oe,te,ze));const Je=[c,...Me],_t=await uh(s,ue),Ge=[];let gt=((v=E.flip)==null?void 0:v.overflows)||[];if(K&&Ge.push(_t[ye]),V){const Ce=oI(I,w,ze);Ge.push(_t[Ce[0]],_t[Ce[1]])}if(gt=[...gt,{placement:I,overflows:Ge}],!Ge.every(Ce=>Ce<=0)){var at,Ue;const Ce=(((at=E.flip)==null?void 0:at.index)||0)+1,He=Je[Ce];if(He)return{data:{index:Ce,overflows:gt},reset:{placement:He}};let st=(Ue=gt.filter(yt=>yt.overflows[0]<=0).sort((yt,xt)=>yt.overflows[1]-xt.overflows[1])[0])==null?void 0:Ue.placement;if(!st)switch(ie){case"bestFit":{var Fe;const yt=(Fe=gt.filter(xt=>{if(je){const ht=Yo(xt.placement);return ht===pe||ht==="y"}return!0}).map(xt=>[xt.placement,xt.overflows.filter(ht=>ht>0).reduce((ht,mt)=>ht+mt,0)]).sort((xt,ht)=>xt[1]-ht[1])[0])==null?void 0:Fe[0];yt&&(st=yt);break}case"initialPlacement":st=c;break}if(I!==st)return{reset:{placement:st}}}return{}}}};function B0(f,s){return{top:f.top-s.height,right:f.right-s.width,bottom:f.bottom-s.height,left:f.left-s.width}}function N0(f){return rI.some(s=>f[s]>=0)}const fI=function(f){return f===void 0&&(f={}),{name:"hide",options:f,async fn(s){const{rects:g}=s,{strategy:v="referenceHidden",...I}=Ys(f,s);switch(v){case"referenceHidden":{const E=await uh(s,{...I,elementContext:"reference"}),w=B0(E,g.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:N0(w)}}}case"escaped":{const E=await uh(s,{...I,altBoundary:!0}),w=B0(E,g.floating);return{data:{escapedOffsets:w,escaped:N0(w)}}}default:return{}}}}};async function mI(f,s){const{placement:g,platform:v,elements:I}=f,E=await(v.isRTL==null?void 0:v.isRTL(I.floating)),w=Qs(g),c=Vc(g),U=Yo(g)==="y",q=["left","top"].includes(w)?-1:1,K=E&&U?-1:1,V=Ys(s,f);let{mainAxis:N,crossAxis:ie,alignmentAxis:te}=typeof V=="number"?{mainAxis:V,crossAxis:0,alignmentAxis:null}:{mainAxis:V.mainAxis||0,crossAxis:V.crossAxis||0,alignmentAxis:V.alignmentAxis};return c&&typeof te=="number"&&(ie=c==="end"?te*-1:te),U?{x:ie*K,y:N*q}:{x:N*q,y:ie*K}}const gI=function(f){return f===void 0&&(f=0),{name:"offset",options:f,async fn(s){var g,v;const{x:I,y:E,placement:w,middlewareData:c}=s,U=await mI(s,f);return w===((g=c.offset)==null?void 0:g.placement)&&(v=c.arrow)!=null&&v.alignmentOffset?{}:{x:I+U.x,y:E+U.y,data:{...U,placement:w}}}}},_I=function(f){return f===void 0&&(f={}),{name:"shift",options:f,async fn(s){const{x:g,y:v,placement:I}=s,{mainAxis:E=!0,crossAxis:w=!1,limiter:c={fn:ue=>{let{x:ye,y:pe}=ue;return{x:ye,y:pe}}},...U}=Ys(f,s),q={x:g,y:v},K=await uh(s,U),V=Yo(Qs(I)),N=fv(V);let ie=q[N],te=q[V];if(E){const ue=N==="y"?"top":"left",ye=N==="y"?"bottom":"right",pe=ie+K[ue],Ae=ie-K[ye];ie=$y(pe,ie,Ae)}if(w){const ue=V==="y"?"top":"left",ye=V==="y"?"bottom":"right",pe=te+K[ue],Ae=te-K[ye];te=$y(pe,te,Ae)}const oe=c.fn({...s,[N]:ie,[V]:te});return{...oe,data:{x:oe.x-g,y:oe.y-v,enabled:{[N]:E,[V]:w}}}}}},yI=function(f){return f===void 0&&(f={}),{options:f,fn(s){const{x:g,y:v,placement:I,rects:E,middlewareData:w}=s,{offset:c=0,mainAxis:U=!0,crossAxis:q=!0}=Ys(f,s),K={x:g,y:v},V=Yo(I),N=fv(V);let ie=K[N],te=K[V];const oe=Ys(c,s),ue=typeof oe=="number"?{mainAxis:oe,crossAxis:0}:{mainAxis:0,crossAxis:0,...oe};if(U){const Ae=N==="y"?"height":"width",ze=E.reference[N]-E.floating[Ae]+ue.mainAxis,Me=E.reference[N]+E.reference[Ae]-ue.mainAxis;ie<ze?ie=ze:ie>Me&&(ie=Me)}if(q){var ye,pe;const Ae=N==="y"?"width":"height",ze=["top","left"].includes(Qs(I)),Me=E.reference[V]-E.floating[Ae]+(ze&&((ye=w.offset)==null?void 0:ye[V])||0)+(ze?0:ue.crossAxis),je=E.reference[V]+E.reference[Ae]+(ze?0:((pe=w.offset)==null?void 0:pe[V])||0)-(ze?ue.crossAxis:0);te<Me?te=Me:te>je&&(te=je)}return{[N]:ie,[V]:te}}}},vI=function(f){return f===void 0&&(f={}),{name:"size",options:f,async fn(s){var g,v;const{placement:I,rects:E,platform:w,elements:c}=s,{apply:U=()=>{},...q}=Ys(f,s),K=await uh(s,q),V=Qs(I),N=Vc(I),ie=Yo(I)==="y",{width:te,height:oe}=E.floating;let ue,ye;V==="top"||V==="bottom"?(ue=V,ye=N===(await(w.isRTL==null?void 0:w.isRTL(c.floating))?"start":"end")?"left":"right"):(ye=V,ue=N==="end"?"top":"bottom");const pe=oe-K.top-K.bottom,Ae=te-K.left-K.right,ze=Jo(oe-K[ue],pe),Me=Jo(te-K[ye],Ae),je=!s.middlewareData.shift;let Je=ze,_t=Me;if((g=s.middlewareData.shift)!=null&&g.enabled.x&&(_t=Ae),(v=s.middlewareData.shift)!=null&&v.enabled.y&&(Je=pe),je&&!N){const gt=Cn(K.left,0),at=Cn(K.right,0),Ue=Cn(K.top,0),Fe=Cn(K.bottom,0);ie?_t=te-2*(gt!==0||at!==0?gt+at:Cn(K.left,K.right)):Je=oe-2*(Ue!==0||Fe!==0?Ue+Fe:Cn(K.top,K.bottom))}await U({...s,availableWidth:_t,availableHeight:Je});const Ge=await w.getDimensions(c.floating);return te!==Ge.width||oe!==Ge.height?{reset:{rects:!0}}:{}}}};function s_(){return typeof window<"u"}function jc(f){return Ub(f)?(f.nodeName||"").toLowerCase():"#document"}function En(f){var s;return(f==null||(s=f.ownerDocument)==null?void 0:s.defaultView)||window}function bs(f){var s;return(s=(Ub(f)?f.ownerDocument:f.document)||window.document)==null?void 0:s.documentElement}function Ub(f){return s_()?f instanceof Node||f instanceof En(f).Node:!1}function Qn(f){return s_()?f instanceof Element||f instanceof En(f).Element:!1}function xs(f){return s_()?f instanceof HTMLElement||f instanceof En(f).HTMLElement:!1}function V0(f){return!s_()||typeof ShadowRoot>"u"?!1:f instanceof ShadowRoot||f instanceof En(f).ShadowRoot}function jp(f){const{overflow:s,overflowX:g,overflowY:v,display:I}=$n(f);return/auto|scroll|overlay|hidden|clip/.test(s+v+g)&&!["inline","contents"].includes(I)}function xI(f){return["table","td","th"].includes(jc(f))}function o_(f){return[":popover-open",":modal"].some(s=>{try{return f.matches(s)}catch{return!1}})}function _v(f){const s=yv(),g=Qn(f)?$n(f):f;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!s&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!s&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(v=>(g.willChange||"").includes(v))||["paint","layout","strict","content"].some(v=>(g.contain||"").includes(v))}function bI(f){let s=Qo(f);for(;xs(s)&&!Fc(s);){if(_v(s))return s;if(o_(s))return null;s=Qo(s)}return null}function yv(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Fc(f){return["html","body","#document"].includes(jc(f))}function $n(f){return En(f).getComputedStyle(f)}function a_(f){return Qn(f)?{scrollLeft:f.scrollLeft,scrollTop:f.scrollTop}:{scrollLeft:f.scrollX,scrollTop:f.scrollY}}function Qo(f){if(jc(f)==="html")return f;const s=f.assignedSlot||f.parentNode||V0(f)&&f.host||bs(f);return V0(s)?s.host:s}function qb(f){const s=Qo(f);return Fc(s)?f.ownerDocument?f.ownerDocument.body:f.body:xs(s)&&jp(s)?s:qb(s)}function hh(f,s,g){var v;s===void 0&&(s=[]),g===void 0&&(g=!0);const I=qb(f),E=I===((v=f.ownerDocument)==null?void 0:v.body),w=En(I);if(E){const c=tv(w);return s.concat(w,w.visualViewport||[],jp(I)?I:[],c&&g?hh(c):[])}return s.concat(I,hh(I,[],g))}function tv(f){return f.parent&&Object.getPrototypeOf(f.parent)?f.frameElement:null}function Zb(f){const s=$n(f);let g=parseFloat(s.width)||0,v=parseFloat(s.height)||0;const I=xs(f),E=I?f.offsetWidth:g,w=I?f.offsetHeight:v,c=om(g)!==E||om(v)!==w;return c&&(g=E,v=w),{width:g,height:v,$:c}}function vv(f){return Qn(f)?f:f.contextElement}function jl(f){const s=vv(f);if(!xs(s))return vs(1);const g=s.getBoundingClientRect(),{width:v,height:I,$:E}=Zb(s);let w=(E?om(g.width):g.width)/v,c=(E?om(g.height):g.height)/I;return(!w||!Number.isFinite(w))&&(w=1),(!c||!Number.isFinite(c))&&(c=1),{x:w,y:c}}const wI=vs(0);function Gb(f){const s=En(f);return!yv()||!s.visualViewport?wI:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function SI(f,s,g){return s===void 0&&(s=!1),!g||s&&g!==En(f)?!1:s}function Va(f,s,g,v){s===void 0&&(s=!1),g===void 0&&(g=!1);const I=f.getBoundingClientRect(),E=vv(f);let w=vs(1);s&&(v?Qn(v)&&(w=jl(v)):w=jl(f));const c=SI(E,g,v)?Gb(E):vs(0);let U=(I.left+c.x)/w.x,q=(I.top+c.y)/w.y,K=I.width/w.x,V=I.height/w.y;if(E){const N=En(E),ie=v&&Qn(v)?En(v):v;let te=N,oe=tv(te);for(;oe&&v&&ie!==te;){const ue=jl(oe),ye=oe.getBoundingClientRect(),pe=$n(oe),Ae=ye.left+(oe.clientLeft+parseFloat(pe.paddingLeft))*ue.x,ze=ye.top+(oe.clientTop+parseFloat(pe.paddingTop))*ue.y;U*=ue.x,q*=ue.y,K*=ue.x,V*=ue.y,U+=Ae,q+=ze,te=En(oe),oe=tv(te)}}return lm({width:K,height:V,x:U,y:q})}function xv(f,s){const g=a_(f).scrollLeft;return s?s.left+g:Va(bs(f)).left+g}function Hb(f,s,g){g===void 0&&(g=!1);const v=f.getBoundingClientRect(),I=v.left+s.scrollLeft-(g?0:xv(f,v)),E=v.top+s.scrollTop;return{x:I,y:E}}function PI(f){let{elements:s,rect:g,offsetParent:v,strategy:I}=f;const E=I==="fixed",w=bs(v),c=s?o_(s.floating):!1;if(v===w||c&&E)return g;let U={scrollLeft:0,scrollTop:0},q=vs(1);const K=vs(0),V=xs(v);if((V||!V&&!E)&&((jc(v)!=="body"||jp(w))&&(U=a_(v)),xs(v))){const ie=Va(v);q=jl(v),K.x=ie.x+v.clientLeft,K.y=ie.y+v.clientTop}const N=w&&!V&&!E?Hb(w,U,!0):vs(0);return{width:g.width*q.x,height:g.height*q.y,x:g.x*q.x-U.scrollLeft*q.x+K.x+N.x,y:g.y*q.y-U.scrollTop*q.y+K.y+N.y}}function TI(f){return Array.from(f.getClientRects())}function II(f){const s=bs(f),g=a_(f),v=f.ownerDocument.body,I=Cn(s.scrollWidth,s.clientWidth,v.scrollWidth,v.clientWidth),E=Cn(s.scrollHeight,s.clientHeight,v.scrollHeight,v.clientHeight);let w=-g.scrollLeft+xv(f);const c=-g.scrollTop;return $n(v).direction==="rtl"&&(w+=Cn(s.clientWidth,v.clientWidth)-I),{width:I,height:E,x:w,y:c}}function AI(f,s){const g=En(f),v=bs(f),I=g.visualViewport;let E=v.clientWidth,w=v.clientHeight,c=0,U=0;if(I){E=I.width,w=I.height;const q=yv();(!q||q&&s==="fixed")&&(c=I.offsetLeft,U=I.offsetTop)}return{width:E,height:w,x:c,y:U}}function CI(f,s){const g=Va(f,!0,s==="fixed"),v=g.top+f.clientTop,I=g.left+f.clientLeft,E=xs(f)?jl(f):vs(1),w=f.clientWidth*E.x,c=f.clientHeight*E.y,U=I*E.x,q=v*E.y;return{width:w,height:c,x:U,y:q}}function j0(f,s,g){let v;if(s==="viewport")v=AI(f,g);else if(s==="document")v=II(bs(f));else if(Qn(s))v=CI(s,g);else{const I=Gb(f);v={x:s.x-I.x,y:s.y-I.y,width:s.width,height:s.height}}return lm(v)}function Wb(f,s){const g=Qo(f);return g===s||!Qn(g)||Fc(g)?!1:$n(g).position==="fixed"||Wb(g,s)}function EI(f,s){const g=s.get(f);if(g)return g;let v=hh(f,[],!1).filter(c=>Qn(c)&&jc(c)!=="body"),I=null;const E=$n(f).position==="fixed";let w=E?Qo(f):f;for(;Qn(w)&&!Fc(w);){const c=$n(w),U=_v(w);!U&&c.position==="fixed"&&(I=null),(E?!U&&!I:!U&&c.position==="static"&&!!I&&["absolute","fixed"].includes(I.position)||jp(w)&&!U&&Wb(f,w))?v=v.filter(K=>K!==w):I=c,w=Qo(w)}return s.set(f,v),v}function kI(f){let{element:s,boundary:g,rootBoundary:v,strategy:I}=f;const w=[...g==="clippingAncestors"?o_(s)?[]:EI(s,this._c):[].concat(g),v],c=w[0],U=w.reduce((q,K)=>{const V=j0(s,K,I);return q.top=Cn(V.top,q.top),q.right=Jo(V.right,q.right),q.bottom=Jo(V.bottom,q.bottom),q.left=Cn(V.left,q.left),q},j0(s,c,I));return{width:U.right-U.left,height:U.bottom-U.top,x:U.left,y:U.top}}function MI(f){const{width:s,height:g}=Zb(f);return{width:s,height:g}}function zI(f,s,g){const v=xs(s),I=bs(s),E=g==="fixed",w=Va(f,!0,E,s);let c={scrollLeft:0,scrollTop:0};const U=vs(0);if(v||!v&&!E)if((jc(s)!=="body"||jp(I))&&(c=a_(s)),v){const N=Va(s,!0,E,s);U.x=N.x+s.clientLeft,U.y=N.y+s.clientTop}else I&&(U.x=xv(I));const q=I&&!v&&!E?Hb(I,c):vs(0),K=w.left+c.scrollLeft-U.x-q.x,V=w.top+c.scrollTop-U.y-q.y;return{x:K,y:V,width:w.width,height:w.height}}function Dy(f){return $n(f).position==="static"}function U0(f,s){if(!xs(f)||$n(f).position==="fixed")return null;if(s)return s(f);let g=f.offsetParent;return bs(f)===g&&(g=g.ownerDocument.body),g}function Xb(f,s){const g=En(f);if(o_(f))return g;if(!xs(f)){let I=Qo(f);for(;I&&!Fc(I);){if(Qn(I)&&!Dy(I))return I;I=Qo(I)}return g}let v=U0(f,s);for(;v&&xI(v)&&Dy(v);)v=U0(v,s);return v&&Fc(v)&&Dy(v)&&!_v(v)?g:v||bI(f)||g}const DI=async function(f){const s=this.getOffsetParent||Xb,g=this.getDimensions,v=await g(f.floating);return{reference:zI(f.reference,await s(f.floating),f.strategy),floating:{x:0,y:0,width:v.width,height:v.height}}};function RI(f){return $n(f).direction==="rtl"}const LI={convertOffsetParentRelativeRectToViewportRelativeRect:PI,getDocumentElement:bs,getClippingRect:kI,getOffsetParent:Xb,getElementRects:DI,getClientRects:TI,getDimensions:MI,getScale:jl,isElement:Qn,isRTL:RI};function OI(f,s){let g=null,v;const I=bs(f);function E(){var c;clearTimeout(v),(c=g)==null||c.disconnect(),g=null}function w(c,U){c===void 0&&(c=!1),U===void 0&&(U=1),E();const{left:q,top:K,width:V,height:N}=f.getBoundingClientRect();if(c||s(),!V||!N)return;const ie=Kf(K),te=Kf(I.clientWidth-(q+V)),oe=Kf(I.clientHeight-(K+N)),ue=Kf(q),pe={rootMargin:-ie+"px "+-te+"px "+-oe+"px "+-ue+"px",threshold:Cn(0,Jo(1,U))||1};let Ae=!0;function ze(Me){const je=Me[0].intersectionRatio;if(je!==U){if(!Ae)return w();je?w(!1,je):v=setTimeout(()=>{w(!1,1e-7)},1e3)}Ae=!1}try{g=new IntersectionObserver(ze,{...pe,root:I.ownerDocument})}catch{g=new IntersectionObserver(ze,pe)}g.observe(f)}return w(!0),E}function FI(f,s,g,v){v===void 0&&(v={});const{ancestorScroll:I=!0,ancestorResize:E=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:U=!1}=v,q=vv(f),K=I||E?[...q?hh(q):[],...hh(s)]:[];K.forEach(ye=>{I&&ye.addEventListener("scroll",g,{passive:!0}),E&&ye.addEventListener("resize",g)});const V=q&&c?OI(q,g):null;let N=-1,ie=null;w&&(ie=new ResizeObserver(ye=>{let[pe]=ye;pe&&pe.target===q&&ie&&(ie.unobserve(s),cancelAnimationFrame(N),N=requestAnimationFrame(()=>{var Ae;(Ae=ie)==null||Ae.observe(s)})),g()}),q&&!U&&ie.observe(q),ie.observe(s));let te,oe=U?Va(f):null;U&&ue();function ue(){const ye=Va(f);oe&&(ye.x!==oe.x||ye.y!==oe.y||ye.width!==oe.width||ye.height!==oe.height)&&g(),oe=ye,te=requestAnimationFrame(ue)}return g(),()=>{var ye;K.forEach(pe=>{I&&pe.removeEventListener("scroll",g),E&&pe.removeEventListener("resize",g)}),V==null||V(),(ye=ie)==null||ye.disconnect(),ie=null,U&&cancelAnimationFrame(te)}}const BI=gI,NI=_I,VI=pI,jI=vI,UI=fI,qI=dI,ZI=yI,GI=(f,s,g)=>{const v=new Map,I={platform:LI,...g},E={...I.platform,_c:v};return hI(f,s,{...I,platform:E})};function ih(f){return typeof f=="function"?f():f}function Kb(f){return typeof window>"u"?1:(f.ownerDocument.defaultView||window).devicePixelRatio||1}function q0(f,s){const g=Kb(f);return Math.round(s*g)/g}function Z0(f){return{[`--bits-${f}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${f}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${f}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${f}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${f}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function HI(f){const s=f.whileElementsMounted,g=Pe(()=>ih(f.open)??!0),v=Pe(()=>ih(f.middleware)),I=Pe(()=>ih(f.transform)??!0),E=Pe(()=>ih(f.placement)??"bottom"),w=Pe(()=>ih(f.strategy)??"absolute"),c=f.reference;let U=Ye(0),q=Ye(0);const K=be(null);let V=Ye(Ze(R(w))),N=Ye(Ze(R(E))),ie=Ye(Ze({})),te=Ye(!1);const oe=Pe(()=>{const Me={position:R(V),left:"0",top:"0"};if(!K.current)return Me;const je=q0(K.current,R(U)),Je=q0(K.current,R(q));return R(I)?{...Me,transform:`translate(${je}px, ${Je}px)`,...Kb(K.current)>=1.5&&{willChange:"transform"}}:{position:R(V),left:`${je}px`,top:`${Je}px`}});let ue;function ye(){c.current===null||K.current===null||GI(c.current,K.current,{middleware:R(v),placement:R(E),strategy:R(w)}).then(Me=>{Ve(U,Ze(Me.x)),Ve(q,Ze(Me.y)),Ve(V,Ze(Me.strategy)),Ve(N,Ze(Me.placement)),Ve(ie,Ze(Me.middlewareData)),Ve(te,!0)})}function pe(){typeof ue=="function"&&(ue(),ue=void 0)}function Ae(){if(pe(),s===void 0){ye();return}c.current===null||K.current===null||(ue=s(c.current,K.current,ye))}function ze(){R(g)||Ve(te,!1)}return At(ye),At(Ae),At(ze),At(()=>pe),{floating:K,reference:c,get strategy(){return R(V)},get placement(){return R(N)},get middlewareData(){return R(ie)},get isPositioned(){return R(te)},get floatingStyles(){return R(oe)},get update(){return ye}}}const WI={top:"bottom",right:"left",bottom:"top",left:"right"};class XI{constructor(){Oe(this,"anchorNode",be(null));Oe(this,"customAnchorNode",be(null));Oe(this,"triggerNode",be(null));At(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Kh,Jh,Yh,Qh,dc,$h,ed,pc,Da,td,id,rd,nd,sd,od,qm,ad,Zm,ld,Gm,Hm,cd,ud,hd,dd,Wm,Xm,Km,Jm,Ym,Qm,pd,$m,eg,tg,ig;class KI{constructor(s,g){Oe(this,"root");Oe(this,"contentRef",be(null));Oe(this,"wrapperRef",be(null));Oe(this,"arrowRef",be(null));Oe(this,"arrowId",be(Gi()));Oe(this,"id");Oe(this,"wrapperId");Oe(this,"style");W(this,Kh,Pe(()=>{if(typeof this.style=="string")return oh(this.style);if(!this.style)return{}}));W(this,Jh);W(this,Yh);W(this,Qh);W(this,dc);W(this,$h);W(this,ed);W(this,pc);W(this,Da);W(this,td);W(this,id);W(this,rd);W(this,nd);W(this,sd);Oe(this,"onPlaced");Oe(this,"enabled");W(this,od,new nT(()=>this.arrowRef.current??void 0));W(this,qm,Pe(()=>{var s;return((s=T(this,od))==null?void 0:s.width)??0}));W(this,ad,Pe(()=>{var s;return((s=T(this,od))==null?void 0:s.height)??0}));W(this,Zm,Pe(()=>{var s;return((s=T(this,Yh))==null?void 0:s.current)+(T(this,dc).current!=="center"?`-${T(this,dc).current}`:"")}));W(this,ld,Pe(()=>Array.isArray(T(this,Da).current)?T(this,Da).current:[T(this,Da).current]));W(this,Gm,Pe(()=>R(T(this,ld)).length>0));W(this,Hm,Pe(()=>({padding:T(this,td).current,boundary:R(T(this,ld)).filter(SP),altBoundary:this.hasExplicitBoundaries})));W(this,cd,Ye(void 0));W(this,ud,Ye(void 0));W(this,hd,Ye(void 0));W(this,dd,Ye(void 0));W(this,Wm,Pe(()=>[BI({mainAxis:T(this,Qh).current+R(T(this,ad)),alignmentAxis:T(this,$h).current}),T(this,pc)&&NI({mainAxis:!0,crossAxis:!1,limiter:T(this,id).current==="partial"?ZI():void 0,...this.detectOverflowOptions}),T(this,pc)&&VI({...this.detectOverflowOptions}),jI({...this.detectOverflowOptions,apply:({rects:s,availableWidth:g,availableHeight:v})=>{const{width:I,height:E}=s.reference;Ve(T(this,cd),Ze(g)),Ve(T(this,ud),Ze(v)),Ve(T(this,hd),Ze(I)),Ve(T(this,dd),Ze(E))}}),this.arrowRef.current&&qI({element:this.arrowRef.current,padding:T(this,ed).current}),iA({arrowWidth:R(T(this,qm)),arrowHeight:R(T(this,ad))}),T(this,rd).current&&UI({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Oe(this,"floating");W(this,Xm,Pe(()=>rA(this.floating.placement)));W(this,Km,Pe(()=>nA(this.floating.placement)));W(this,Jm,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.x)??0}));W(this,Ym,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.y)??0}));W(this,Qm,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.centerOffset)!==0}));W(this,pd,Ye());W(this,$m,Pe(()=>WI[this.placedSide]));W(this,eg,Pe(()=>{var s,g,v;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(s=this.floating.middlewareData.transformOrigin)==null?void 0:s.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${R(T(this,cd))}px`,"--bits-floating-available-height":`${R(T(this,ud))}px`,"--bits-floating-anchor-width":`${R(T(this,hd))}px`,"--bits-floating-anchor-height":`${R(T(this,dd))}px`,...((v=this.floating.middlewareData.hide)==null?void 0:v.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...R(T(this,Kh))},dir:T(this,Jh).current}}));W(this,tg,Pe(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:av({...R(T(this,Kh))})})));W(this,ig,Pe(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=s.id,Le(this,Yh,s.side),Le(this,Qh,s.sideOffset),Le(this,dc,s.align),Le(this,$h,s.alignOffset),Le(this,ed,s.arrowPadding),Le(this,pc,s.avoidCollisions),Le(this,Da,s.collisionBoundary),Le(this,td,s.collisionPadding),Le(this,id,s.sticky),Le(this,rd,s.hideWhenDetached),Le(this,sd,s.updatePositionStrategy),this.onPlaced=s.onPlaced,Le(this,nd,s.strategy),Le(this,Jh,s.dir),this.style=s.style,this.root=g,this.enabled=s.enabled,this.wrapperId=s.wrapperId,s.customAnchor&&(this.root.customAnchorNode.current=s.customAnchor.current),At(()=>{s.customAnchor.current,Ri(()=>{this.root.customAnchorNode.current=s.customAnchor.current})}),Bi({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),Bi({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=HI({strategy:()=>T(this,nd).current,placement:()=>R(T(this,Zm)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...v)=>{var E;return FI(...v,{animationFrame:((E=T(this,sd))==null?void 0:E.current)==="always"})},open:()=>this.enabled.current}),At(()=>{var v;this.floating.isPositioned&&((v=this.onPlaced)==null||v.current())}),At(()=>{const v=this.contentRef.current;v&&Ri(()=>{this.contentZIndex=window.getComputedStyle(v).zIndex})}),At(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return R(T(this,Gm))}get detectOverflowOptions(){return R(T(this,Hm))}get middleware(){return R(T(this,Wm))}get placedSide(){return R(T(this,Xm))}get placedAlign(){return R(T(this,Km))}get arrowX(){return R(T(this,Jm))}get arrowY(){return R(T(this,Ym))}get cannotCenterArrow(){return R(T(this,Qm))}get contentZIndex(){return R(T(this,pd))}set contentZIndex(s){Ve(T(this,pd),Ze(s))}get arrowBaseSide(){return R(T(this,$m))}get wrapperProps(){return R(T(this,eg))}get props(){return R(T(this,tg))}get arrowStyle(){return R(T(this,ig))}}Kh=new WeakMap,Jh=new WeakMap,Yh=new WeakMap,Qh=new WeakMap,dc=new WeakMap,$h=new WeakMap,ed=new WeakMap,pc=new WeakMap,Da=new WeakMap,td=new WeakMap,id=new WeakMap,rd=new WeakMap,nd=new WeakMap,sd=new WeakMap,od=new WeakMap,qm=new WeakMap,ad=new WeakMap,Zm=new WeakMap,ld=new WeakMap,Gm=new WeakMap,Hm=new WeakMap,cd=new WeakMap,ud=new WeakMap,hd=new WeakMap,dd=new WeakMap,Wm=new WeakMap,Xm=new WeakMap,Km=new WeakMap,Jm=new WeakMap,Ym=new WeakMap,Qm=new WeakMap,pd=new WeakMap,$m=new WeakMap,eg=new WeakMap,tg=new WeakMap,ig=new WeakMap;class JI{constructor(s,g){Oe(this,"ref",be(null));s.virtualEl&&s.virtualEl.current?g.triggerNode=be.from(s.virtualEl.current):Bi({id:s.id,ref:this.ref,onRefChange:v=>{g.triggerNode.current=v}})}}const[YI,Jb]=$s("Floating.Root"),[QI,lM]=$s("Floating.Content");function $I(){return YI(new XI)}function eA(f){return QI(new KI(f,Jb()))}function tA(f){return new JI(f,Jb())}function iA(f){return{name:"transformOrigin",options:f,fn(s){var ue,ye,pe;const{placement:g,rects:v,middlewareData:I}=s,w=((ue=I.arrow)==null?void 0:ue.centerOffset)!==0,c=w?0:f.arrowWidth,U=w?0:f.arrowHeight,[q,K]=bv(g),V={start:"0%",center:"50%",end:"100%"}[K],N=(((ye=I.arrow)==null?void 0:ye.x)??0)+c/2,ie=(((pe=I.arrow)==null?void 0:pe.y)??0)+U/2;let te="",oe="";return q==="bottom"?(te=w?V:`${N}px`,oe=`${-U}px`):q==="top"?(te=w?V:`${N}px`,oe=`${v.floating.height+U}px`):q==="right"?(te=`${-U}px`,oe=w?V:`${ie}px`):q==="left"&&(te=`${v.floating.width+U}px`,oe=w?V:`${ie}px`),{data:{x:te,y:oe}}}}}function bv(f){const[s,g="center"]=f.split("-");return[s,g]}function rA(f){return bv(f)[0]}function nA(f){return bv(f)[1]}function sA(f,s){Et(s,!0),$I();var g=Ke(),v=Ne(g);Ct(v,()=>s.children??Xt),Te(f,g),kt()}function oA(f,s){Et(s,!0),tA({id:be.with(()=>s.id),virtualEl:be.with(()=>s.virtualEl)});var g=Ke(),v=Ne(g);Ct(v,()=>s.children??Xt),Te(f,g),kt()}var aA=Vt("<div><!></div>");function lA(f,s){Et(s,!0);let g=J(s,"side",3,"bottom"),v=J(s,"sideOffset",3,0),I=J(s,"align",3,"center"),E=J(s,"alignOffset",3,0),w=J(s,"arrowPadding",3,0),c=J(s,"avoidCollisions",3,!0),U=J(s,"collisionBoundary",19,()=>[]),q=J(s,"collisionPadding",3,0),K=J(s,"hideWhenDetached",3,!1),V=J(s,"onPlaced",3,()=>{}),N=J(s,"sticky",3,"partial"),ie=J(s,"updatePositionStrategy",3,"optimized"),te=J(s,"strategy",3,"fixed"),oe=J(s,"dir",3,"ltr"),ue=J(s,"style",19,()=>({})),ye=J(s,"wrapperId",19,Gi),pe=J(s,"customAnchor",3,null);const Ae=eA({side:be.with(()=>g()),sideOffset:be.with(()=>v()),align:be.with(()=>I()),alignOffset:be.with(()=>E()),id:be.with(()=>s.id),arrowPadding:be.with(()=>w()),avoidCollisions:be.with(()=>c()),collisionBoundary:be.with(()=>U()),collisionPadding:be.with(()=>q()),hideWhenDetached:be.with(()=>K()),onPlaced:be.with(()=>V()),sticky:be.with(()=>N()),updatePositionStrategy:be.with(()=>ie()),strategy:be.with(()=>te()),dir:be.with(()=>oe()),style:be.with(()=>ue()),enabled:be.with(()=>!1),wrapperId:be.with(()=>ye()),customAnchor:be.with(()=>pe())}),ze=Pe(()=>Pi(Ae.wrapperProps,{style:{pointerEvents:"auto"}}));var Me=aA();let je;var Je=ci(Me);Ct(Je,()=>s.content??Xt,()=>({props:Ae.props})),ui(Me),di(()=>je=Oi(Me,je,{...R(ze)})),Te(f,Me),kt()}function cA(f,s){Et(s,!0),nb(()=>{var I;(I=s.onPlaced)==null||I.call(s)});var g=Ke(),v=Ne(g);Ct(v,()=>s.content??Xt,()=>({props:{}})),Te(f,g),kt()}function uA(f,s){let g=J(s,"isStatic",3,!1),v=Gt(s,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var I=Ke(),E=Ne(I);{var w=U=>{cA(U,{get content(){return s.content},get onPlaced(){return s.onPlaced}})},c=U=>{lA(U,ri({get content(){return s.content},get onPlaced(){return s.onPlaced}},()=>v))};hi(E,U=>{g()?U(w):U(c,!1)})}Te(f,I)}var hA=Vt("<!> <!>",1);function Yb(f,s){Et(s,!0);let g=J(s,"interactOutsideBehavior",3,"close"),v=J(s,"trapFocus",3,!0),I=J(s,"isValidEvent",3,()=>!1),E=J(s,"customAnchor",3,null),w=J(s,"isStatic",3,!1),c=Gt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);uA(f,{get isStatic(){return w()},get id(){return s.id},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return E()},content:(q,K)=>{let V=()=>K==null?void 0:K().props;var N=hA(),ie=Ne(N);{var te=pe=>{sm(pe,{get preventScroll(){return s.preventScroll}})},oe=pe=>{var Ae=Ke(),ze=Ne(Ae);{var Me=je=>{sm(je,{get preventScroll(){return s.preventScroll}})};hi(ze,je=>{s.forceMount||je(Me)},!0)}Te(pe,Ae)};hi(ie,pe=>{s.forceMount&&s.enabled?pe(te):pe(oe,!1)})}var ue=Ci(ie,2),ye=Pe(()=>s.enabled&&v());Fb(ue,{get id(){return s.id},get onOpenAutoFocus(){return s.onOpenAutoFocus},get onCloseAutoFocus(){return s.onCloseAutoFocus},get loop(){return s.loop},get trapFocus(){return R(ye)},get forceMount(){return s.forceMount},focusScope:(Ae,ze)=>{let Me=()=>ze==null?void 0:ze().props;Lb(Ae,{get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get enabled(){return s.enabled},children:(je,Je)=>{Rb(je,{get id(){return s.id},get onInteractOutside(){return s.onInteractOutside},get onFocusOutside(){return s.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return I()},get enabled(){return s.enabled},children:(Ge,gt)=>{let at=()=>gt==null?void 0:gt().props;Nb(Ge,{get id(){return s.id},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get enabled(){return s.enabled},children:(Ue,Fe)=>{var Ce=Ke(),He=Ne(Ce),st=$g(()=>({props:Pi(c,V(),at(),Me(),{style:{pointerEvents:"auto"}})}));Ct(He,()=>s.popper??Xt,()=>R(st)),Te(Ue,Ce)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),Te(q,N)},$$slots:{content:!0}}),kt()}function dA(f,s){let g=J(s,"interactOutsideBehavior",3,"close"),v=J(s,"trapFocus",3,!0),I=J(s,"isValidEvent",3,()=>!1),E=J(s,"customAnchor",3,null),w=J(s,"isStatic",3,!1),c=Gt(s,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);r_(f,ri({get id(){return s.id},get present(){return s.present}},()=>c,{presence:(q,K)=>{let V=()=>K==null?void 0:K().present;Yb(q,ri({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return V().current},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return I()},get onFocusOutside(){return s.onFocusOutside},forceMount:!1},()=>c))},$$slots:{presence:!0}}))}function pA(f,s){let g=J(s,"interactOutsideBehavior",3,"close"),v=J(s,"trapFocus",3,!0),I=J(s,"isValidEvent",3,()=>!1),E=J(s,"customAnchor",3,null),w=J(s,"isStatic",3,!1),c=Gt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);Yb(f,ri({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return E()},get isStatic(){return w()},get enabled(){return s.enabled},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return I()},get onFocusOutside(){return s.onFocusOutside}},()=>c,{forceMount:!0}))}function fA(f,s){let g=f.nextElementSibling;for(;g;){if(g.matches(s))return g;g=g.nextElementSibling}}function mA(f,s){let g=f.previousElementSibling;for(;g;){if(g.matches(s))return g;g=g.previousElementSibling}}const G0=1,gA=.9,_A=.8,yA=.17,Ry=.1,Ly=.999,vA=.9999,xA=.99,bA=/[\\/_+.#"@[({&]/,wA=/[\\/_+.#"@[({&]/g,SA=/[\s-]/,Qb=/[\s-]/g;function iv(f,s,g,v,I,E,w){if(E===s.length)return I===f.length?G0:xA;const c=`${I},${E}`;if(w[c]!==void 0)return w[c];const U=v.charAt(E);let q=g.indexOf(U,I),K=0,V,N,ie,te;for(;q>=0;)V=iv(f,s,g,v,q+1,E+1,w),V>K&&(q===I?V*=G0:bA.test(f.charAt(q-1))?(V*=_A,ie=f.slice(I,q-1).match(wA),ie&&I>0&&(V*=Ly**ie.length)):SA.test(f.charAt(q-1))?(V*=gA,te=f.slice(I,q-1).match(Qb),te&&I>0&&(V*=Ly**te.length)):(V*=yA,I>0&&(V*=Ly**(q-I))),f.charAt(q)!==s.charAt(E)&&(V*=vA)),(V<Ry&&g.charAt(q-1)===v.charAt(E+1)||v.charAt(E+1)===v.charAt(E)&&g.charAt(q-1)!==v.charAt(E))&&(N=iv(f,s,g,v,q+1,E+2,w),N*Ry>V&&(V=N*Ry)),V>K&&(K=V),q=g.indexOf(U,q+1);return w[c]=K,K}function H0(f){return f.toLowerCase().replace(Qb," ")}function PA(f,s,g){return f=g&&g.length>0?`${`${f} ${g==null?void 0:g.join(" ")}`}`:f,iv(f,s,H0(f),H0(s),0,0,{})}function TA(f){if(!f)return null;for(const s of f.childNodes)if(s.nodeType!==Node.COMMENT_NODE)return s;return null}const IA="data-command-root",AA="data-command-list",CA="data-command-input",EA="data-command-empty",$b="data-command-group",ew="data-command-group-items",tw="data-command-group-heading",iw="data-command-item",Ca="data-value",kA="data-command-input-label",rh=`[${$b}]`,Oy=`[${ew}]`,MA=`[${tw}]`,rw=`[${iw}]`,Fy=`${rw}:not([aria-disabled="true"])`;function nw(f,s,g){return PA(f,s,g)}const[zA,Uc]=$s("Command.Root"),[DA,cM]=$s("Command.List"),[RA,l_]=$s("Command.Group");var fd,md,gd,_d,fc,yd,vd,xd,mc,gc,_c,Go,Ho,rg,yc,vc,bd,wd,Sd,Pd,ng,sg;class LA{constructor(s){Oe(this,"allItems",new Set);Oe(this,"allGroups",new Map);Oe(this,"allIds",new Map);Oe(this,"id");Oe(this,"ref");Oe(this,"filter");Oe(this,"shouldFilter");Oe(this,"loop");W(this,fd,Ye(0));W(this,md,Ye(null));W(this,gd,Ye(null));W(this,_d,Ye(null));Oe(this,"valueProp");W(this,fc);Oe(this,"disablePointerSelection");W(this,yd,Ye(null));W(this,vd,Ye(null));Oe(this,"snapshot",()=>this._commandState);Oe(this,"setState",(s,g,v)=>{Object.is(this._commandState[s],g)||(this._commandState[s]=g,s==="search"?(T(this,_c).call(this),T(this,mc).call(this),T(this,gc).call(this)):s==="value"&&(v||T(this,rg).call(this)),this.emit())});Oe(this,"emit",()=>{this.commandState=ob(this._commandState)});W(this,xd,(s,g)=>{const v=this.filter.current??nw;return s?v(s,this._commandState.search,g):0});W(this,mc,()=>{var w;if(!this._commandState.search||this.shouldFilter.current===!1)return;const s=this._commandState.filtered.items,g=[];for(const c of this._commandState.filtered.groups){const U=this.allGroups.get(c);let q=0;if(!U){g.push([c,q]);continue}for(const K of U){const V=s.get(K);q=Math.max(V??0,q)}g.push([c,q])}const v=this.viewportNode,I=T(this,Go).call(this).sort((c,U)=>{const q=c.getAttribute("id"),K=U.getAttribute("id"),V=s.get(q)??0;return(s.get(K)??0)-V});for(const c of I){const U=c.closest(Oy);if(U){const q=c.parentElement===U?c:c.closest(`${Oy} > *`);q&&U.appendChild(q)}else{const q=c.parentElement===v?c:c.closest(`${Oy} > *`);q&&(v==null||v.appendChild(q))}}const E=g.sort((c,U)=>U[1]-c[1]);for(const c of E){const U=v==null?void 0:v.querySelector(`${rh}[${Ca}="${encodeURIComponent(c[0])}"]`);(w=U==null?void 0:U.parentElement)==null||w.appendChild(U)}});Oe(this,"setValue",(s,g)=>{s!==this.valueProp.current&&s===""&&Na(()=>{this.key++}),this.setState("value",s,g),this.valueProp.current=s});W(this,gc,()=>{Na(()=>{const s=T(this,Go).call(this).find(v=>v.getAttribute("aria-disabled")!=="true"),g=s==null?void 0:s.getAttribute(Ca);this.setValue(g||"")})});W(this,_c,()=>{var g,v;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let s=0;for(const I of this.allItems){const E=((g=this.allIds.get(I))==null?void 0:g.value)??"",w=((v=this.allIds.get(I))==null?void 0:v.keywords)??[],c=T(this,xd).call(this,E,w);this._commandState.filtered.items.set(I,c),c>0&&s++}for(const[I,E]of this.allGroups)for(const w of E){const c=this._commandState.filtered.items.get(w);if(c&&c>0){this._commandState.filtered.groups.add(I);break}}this._commandState.filtered.count=s});W(this,Go,()=>{const s=this.ref.current;return s?Array.from(s.querySelectorAll(Fy)).filter(v=>!!v):[]});W(this,Ho,()=>{const s=this.ref.current;if(!s)return;const g=s.querySelector(`${Fy}[aria-selected="true"]`);if(g)return g});W(this,rg,()=>{Np(1,()=>{var I,E,w,c,U;const s=T(this,Ho).call(this);if(!s)return;const g=(I=s.parentElement)==null?void 0:I.parentElement;if(!g)return;const v=TA(g);if(v&&((E=v.dataset)==null?void 0:E.value)===((w=s.dataset)==null?void 0:w.value)){(U=(c=s==null?void 0:s.closest(rh))==null?void 0:c.querySelector(MA))==null||U.scrollIntoView({block:"nearest"});return}s.scrollIntoView({block:"nearest"})})});W(this,yc,s=>{const v=T(this,Go).call(this)[s];v&&this.setValue(v.getAttribute(Ca)??"")});W(this,vc,s=>{const g=T(this,Ho).call(this),v=T(this,Go).call(this),I=v.findIndex(w=>w===g);let E=v[I+s];this.loop.current&&(E=I+s<0?v[v.length-1]:I+s===v.length?v[0]:v[I+s]),E&&this.setValue(E.getAttribute(Ca)??"")});W(this,bd,s=>{const g=T(this,Ho).call(this);let v=g==null?void 0:g.closest(rh),I;for(;v&&!I;)v=s>0?fA(v,rh):mA(v,rh),I=v==null?void 0:v.querySelector(Fy);I?this.setValue(I.getAttribute(Ca)??""):T(this,vc).call(this,s)});Oe(this,"registerValue",(s,g,v)=>{var I;if(g!==((I=this.allIds.get(s))==null?void 0:I.value))return this.allIds.set(s,{value:g,keywords:v}),this._commandState.filtered.items.set(s,T(this,xd).call(this,g,v)),T(this,mc).call(this),this.emit(),()=>{this.allIds.delete(s)}});Oe(this,"registerItem",(s,g)=>(this.allItems.add(s),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(s):this.allGroups.set(g,new Set([s]))),T(this,_c).call(this),T(this,mc).call(this),this.commandState.value||T(this,gc).call(this),this.emit(),()=>{this.allIds.delete(s),this.allItems.delete(s),this.commandState.filtered.items.delete(s);const v=T(this,Ho).call(this);T(this,_c).call(this),(v==null?void 0:v.getAttribute("id"))===s&&T(this,gc).call(this),this.emit()}));Oe(this,"registerGroup",s=>(this.allGroups.has(s)||this.allGroups.set(s,new Set),()=>{this.allIds.delete(s),this.allGroups.delete(s)}));W(this,wd,()=>T(this,yc).call(this,T(this,Go).call(this).length-1));W(this,Sd,s=>{s.preventDefault(),s.metaKey?T(this,wd).call(this):s.altKey?T(this,bd).call(this,1):T(this,vc).call(this,1)});W(this,Pd,s=>{s.preventDefault(),s.metaKey?T(this,yc).call(this,0):s.altKey?T(this,bd).call(this,-1):T(this,vc).call(this,-1)});W(this,ng,s=>{switch(s.key){case fP:case mP:{T(this,fc).current&&s.ctrlKey&&T(this,Sd).call(this,s);break}case im:T(this,Sd).call(this,s);break;case pP:case gP:{T(this,fc).current&&s.ctrlKey&&T(this,Pd).call(this,s);break}case rm:T(this,Pd).call(this,s);break;case Ib:s.preventDefault(),T(this,yc).call(this,0);break;case Tb:s.preventDefault(),T(this,wd).call(this);break;case hv:if(!s.isComposing&&s.keyCode!==229){s.preventDefault();const g=T(this,Ho).call(this);g&&(g==null||g.click())}}});W(this,sg,Pe(()=>({id:this.id.current,role:"application",[IA]:"",tabindex:-1,onkeydown:T(this,ng)})));this.id=s.id,this.ref=s.ref,this.filter=s.filter,this.shouldFilter=s.shouldFilter,this.loop=s.loop,this.valueProp=s.value,Le(this,fc,s.vimBindings),this.disablePointerSelection=s.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,Bi({id:this.id,ref:this.ref})}get key(){return R(T(this,fd))}set key(s){Ve(T(this,fd),Ze(s))}get viewportNode(){return R(T(this,md))}set viewportNode(s){Ve(T(this,md),Ze(s))}get inputNode(){return R(T(this,gd))}set inputNode(s){Ve(T(this,gd),Ze(s))}get labelNode(){return R(T(this,_d))}set labelNode(s){Ve(T(this,_d),Ze(s))}get commandState(){return R(T(this,yd))}set commandState(s){Ve(T(this,yd),s)}get _commandState(){return R(T(this,vd))}set _commandState(s){Ve(T(this,vd),Ze(s))}get props(){return R(T(this,sg))}}fd=new WeakMap,md=new WeakMap,gd=new WeakMap,_d=new WeakMap,fc=new WeakMap,yd=new WeakMap,vd=new WeakMap,xd=new WeakMap,mc=new WeakMap,gc=new WeakMap,_c=new WeakMap,Go=new WeakMap,Ho=new WeakMap,rg=new WeakMap,yc=new WeakMap,vc=new WeakMap,bd=new WeakMap,wd=new WeakMap,Sd=new WeakMap,Pd=new WeakMap,ng=new WeakMap,sg=new WeakMap;var Td,xc,Id,Ad,Cd,og,ag;class OA{constructor(s,g){W(this,Td);W(this,xc);W(this,Id);W(this,Ad);W(this,Cd,!0);W(this,og,Pe(()=>T(this,Id)._commandState.filtered.count===0&&T(this,Cd)===!1||T(this,Ad).current));W(this,ag,Pe(()=>({id:T(this,xc).current,role:"presentation",[EA]:""})));Le(this,Td,s.ref),Le(this,xc,s.id),Le(this,Id,g),Le(this,Ad,s.forceMount),At(()=>{Le(this,Cd,!1)}),Bi({id:T(this,xc),ref:T(this,Td),deps:()=>this.shouldRender})}get shouldRender(){return R(T(this,og))}get props(){return R(T(this,ag))}}Td=new WeakMap,xc=new WeakMap,Id=new WeakMap,Ad=new WeakMap,Cd=new WeakMap,og=new WeakMap,ag=new WeakMap;var Ra,La,Yn,Ed,lg,kd,cg;class FA{constructor(s,g){W(this,Ra);Oe(this,"id");Oe(this,"forceMount");W(this,La);W(this,Yn);W(this,Ed,Ye(null));W(this,lg,Pe(()=>this.forceMount.current||T(this,Yn).shouldFilter.current===!1||!T(this,Yn).commandState.search?!0:T(this,Yn).commandState.filtered.groups.has(this.id.current)));W(this,kd,Ye(""));W(this,cg,Pe(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[$b]:""})));Le(this,Ra,s.ref),this.id=s.id,Le(this,Yn,g),this.forceMount=s.forceMount,Le(this,La,s.value),this.trueValue=s.value.current,Bi({id:this.id,ref:T(this,Ra),deps:()=>this.shouldRender}),At(()=>T(this,Yn).registerGroup(this.id.current)),At(()=>{var v;if(T(this,La).current)return this.trueValue=T(this,La).current,T(this,Yn).registerValue(this.id.current,T(this,La).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),T(this,Yn).registerValue(this.id.current,this.trueValue);if((v=T(this,Ra).current)!=null&&v.textContent)return this.trueValue=T(this,Ra).current.textContent.trim().toLowerCase(),T(this,Yn).registerValue(this.id.current,this.trueValue)})}get headingNode(){return R(T(this,Ed))}set headingNode(s){Ve(T(this,Ed),Ze(s))}get shouldRender(){return R(T(this,lg))}get trueValue(){return R(T(this,kd))}set trueValue(s){Ve(T(this,kd),Ze(s))}get props(){return R(T(this,cg))}createGroupHeading(s){return new sw(s,this)}createGroupItems(s){return new ow(s,this)}}Ra=new WeakMap,La=new WeakMap,Yn=new WeakMap,Ed=new WeakMap,lg=new WeakMap,kd=new WeakMap,cg=new WeakMap;var Md,bc,zd,ug;class sw{constructor(s,g){W(this,Md);W(this,bc);W(this,zd);W(this,ug,Pe(()=>({id:T(this,bc).current,[tw]:""})));Le(this,Md,s.ref),Le(this,bc,s.id),Le(this,zd,g),Bi({id:T(this,bc),ref:T(this,Md),onRefChange:v=>{T(this,zd).headingNode=v}})}get props(){return R(T(this,ug))}}Md=new WeakMap,bc=new WeakMap,zd=new WeakMap,ug=new WeakMap;var Dd,wc,Rd,hg;class ow{constructor(s,g){W(this,Dd);W(this,wc);W(this,Rd);W(this,hg,Pe(()=>{var s;return{id:T(this,wc).current,role:"group",[ew]:"","aria-labelledby":((s=T(this,Rd).headingNode)==null?void 0:s.id)??void 0}}));Le(this,Dd,s.ref),Le(this,wc,s.id),Le(this,Rd,g),Bi({id:T(this,wc),ref:T(this,Dd)})}get props(){return R(T(this,hg))}}Dd=new WeakMap,wc=new WeakMap,Rd=new WeakMap,hg=new WeakMap;var Sc,Pc,ms,Wo,Ld,dg,pg;class BA{constructor(s,g){W(this,Sc);W(this,Pc);W(this,ms);W(this,Wo);W(this,Ld);W(this,dg,Pe(()=>{var g;const s=(g=T(this,ms).viewportNode)==null?void 0:g.querySelector(`${rw}[${Ca}="${encodeURIComponent(T(this,Wo).current)}"]`);if(s)return(s==null?void 0:s.getAttribute("id"))??void 0}));W(this,pg,Pe(()=>{var s,g;return{id:T(this,Pc).current,type:"text",[CA]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":lv(!0),"aria-controls":((s=T(this,ms).viewportNode)==null?void 0:s.id)??void 0,"aria-labelledby":((g=T(this,ms).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":R(T(this,dg))}}));Le(this,Sc,s.ref),Le(this,Pc,s.id),Le(this,ms,g),Le(this,Wo,s.value),Le(this,Ld,s.autofocus),Bi({id:T(this,Pc),ref:T(this,Sc),onRefChange:v=>{T(this,ms).inputNode=v}}),At(()=>{const v=T(this,Sc).current;Ri(()=>{v&&T(this,Ld).current&&Np(10,()=>v.focus())})}),At(()=>{T(this,Wo).current,Ri(()=>{T(this,ms).commandState.search!==T(this,Wo).current&&T(this,ms).setState("search",T(this,Wo).current)})})}get props(){return R(T(this,pg))}}Sc=new WeakMap,Pc=new WeakMap,ms=new WeakMap,Wo=new WeakMap,Ld=new WeakMap,dg=new WeakMap,pg=new WeakMap;var Tc,Od,gs,Fd,Ic,Oa,fg,Bd,mg,gg,_g,Nd,yg,vg,xg;class NA{constructor(s,g){W(this,Tc);Oe(this,"id");Oe(this,"root");W(this,Od);W(this,gs);W(this,Fd);W(this,Ic);W(this,Oa,null);W(this,fg,Pe(()=>{var s;return T(this,Ic).current||((s=T(this,Oa))==null?void 0:s.forceMount.current)===!0}));W(this,Bd,Ye(""));W(this,mg,Pe(()=>{if(R(T(this,fg))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const s=this.root.commandState.filtered.items.get(this.id.current);return s===void 0?!1:s>0}));W(this,gg,Pe(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));W(this,_g,()=>{var s;T(this,gs).current||(T(this,Nd).call(this),(s=T(this,Fd))==null||s.current())});W(this,Nd,()=>{T(this,gs).current||this.root.setValue(this.trueValue,!0)});W(this,yg,()=>{T(this,gs).current||this.root.disablePointerSelection.current||T(this,Nd).call(this)});W(this,vg,()=>{T(this,gs).current||T(this,_g).call(this)});W(this,xg,Pe(()=>({id:this.id.current,"aria-disabled":Pb(T(this,gs).current),"aria-selected":cP(this.isSelected),"data-disabled":Vp(T(this,gs).current),"data-selected":uP(this.isSelected),[iw]:"",role:"option",onpointermove:T(this,yg),onclick:T(this,vg)})));Le(this,Tc,s.ref),this.id=s.id,this.root=g,Le(this,Od,s.value),Le(this,gs,s.disabled),Le(this,Fd,s.onSelect),Le(this,Ic,s.forceMount),Le(this,Oa,l_(null)),this.trueValue=s.value.current,Bi({id:this.id,ref:T(this,Tc),deps:()=>!!this.root.commandState.search}),At(()=>{var v;if(this.id.current,(v=T(this,Oa))==null||v.id.current,!T(this,Ic).current)return Ri(()=>{var I;return this.root.registerItem(this.id.current,(I=T(this,Oa))==null?void 0:I.id.current)})}),At(()=>{const v=T(this,Od).current,I=T(this,Tc).current;I&&(!v&&I.textContent&&(this.trueValue=I.textContent.trim()),Ri(()=>{this.root.registerValue(this.id.current,this.trueValue,s.keywords.current.map(E=>E.trim())),I.setAttribute(Ca,this.trueValue)}))})}get trueValue(){return R(T(this,Bd))}set trueValue(s){Ve(T(this,Bd),Ze(s))}get shouldRender(){return R(T(this,mg))}get isSelected(){return R(T(this,gg))}get props(){return R(T(this,xg))}}Tc=new WeakMap,Od=new WeakMap,gs=new WeakMap,Fd=new WeakMap,Ic=new WeakMap,Oa=new WeakMap,fg=new WeakMap,Bd=new WeakMap,mg=new WeakMap,gg=new WeakMap,_g=new WeakMap,Nd=new WeakMap,yg=new WeakMap,vg=new WeakMap,xg=new WeakMap;var Ac,Vd,bg;class VA{constructor(s,g){Oe(this,"ref");W(this,Ac);W(this,Vd);Oe(this,"root");W(this,bg,Pe(()=>({id:T(this,Ac).current,role:"listbox","aria-label":T(this,Vd).current,[AA]:""})));this.ref=s.ref,Le(this,Ac,s.id),this.root=g,Le(this,Vd,s.ariaLabel),Bi({id:T(this,Ac),ref:this.ref})}get props(){return R(T(this,bg))}}Ac=new WeakMap,Vd=new WeakMap,bg=new WeakMap;var jd,Cc,Ud,qd,wg;class jA{constructor(s,g){W(this,jd);W(this,Cc);W(this,Ud);W(this,qd);W(this,wg,Pe(()=>{var s;return{id:T(this,Cc).current,[kA]:"",for:(s=T(this,qd))==null?void 0:s.current,style:Sb}}));Le(this,jd,s.ref),Le(this,Cc,s.id),Le(this,Ud,g),Le(this,qd,s.for),Bi({id:T(this,Cc),ref:T(this,jd),onRefChange:v=>{T(this,Ud).labelNode=v}})}get props(){return R(T(this,wg))}}jd=new WeakMap,Cc=new WeakMap,Ud=new WeakMap,qd=new WeakMap,wg=new WeakMap;function UA(f){return zA(new LA(f))}function qA(f){const s=Uc();return new OA(f,s)}function ZA(f){const s=Uc();return new NA(f,s)}function GA(f){const s=Uc();return RA(new FA(f,s))}function HA(f){const s=l_();return new sw(f,s)}function WA(f){const s=l_();return new ow(f,s)}function XA(f){const s=Uc();return new BA(f,s)}function KA(f){const s=Uc();return DA(new VA(f,s))}function JA(f){const s=Uc();return new jA(f,s)}var YA=Vt("<label><!></label>");function QA(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const E=JA({id:be.with(()=>g()),ref:be.with(()=>v(),K=>v(K))}),w=Pe(()=>Pi(I,E.props));var c=YA();let U;var q=ci(c);Ct(q,()=>s.children??Xt),ui(c),di(()=>U=Oi(c,U,{...R(w)})),Te(f,c),kt()}var $A=Vt("<!> <!>",1),eC=Vt("<div><!> <!></div>");function tC(f,s){Et(s,!0);const g=Me=>{QA(Me,{children:(je,Je)=>{Us();var _t=Aa();di(()=>ah(_t,K())),Te(je,_t)},$$slots:{default:!0}})};let v=J(s,"id",19,Gi),I=J(s,"ref",15,null),E=J(s,"value",15,""),w=J(s,"onValueChange",3,Yi),c=J(s,"loop",3,!1),U=J(s,"shouldFilter",3,!0),q=J(s,"filter",3,nw),K=J(s,"label",3,""),V=J(s,"vimBindings",3,!0),N=J(s,"disablePointerSelection",3,!1),ie=J(s,"controlledValue",3,!1),te=Gt(s,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const oe=UA({id:be.with(()=>v()),ref:be.with(()=>I(),Me=>I(Me)),filter:be.with(()=>q()),shouldFilter:be.with(()=>U()),loop:be.with(()=>c()),value:be.with(()=>E(),Me=>{ie()||E(Me),w()(Me)}),vimBindings:be.with(()=>V()),disablePointerSelection:be.with(()=>N())}),ue=Pe(()=>Pi(te,oe.props));var ye=Ke(),pe=Ne(ye);{var Ae=Me=>{var je=$A(),Je=Ne(je);g(Je);var _t=Ci(Je,2);Ct(_t,()=>s.child,()=>({props:R(ue)})),Te(Me,je)},ze=Me=>{var je=eC();let Je;var _t=ci(je);g(_t);var Ge=Ci(_t,2);Ct(Ge,()=>s.children??Xt),ui(je),di(()=>Je=Oi(je,Je,{...R(ue)})),Te(Me,je)};hi(pe,Me=>{s.child?Me(Ae):Me(ze,!1)})}Te(f,ye),kt()}var iC=Vt("<div><!></div>");function rC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"forceMount",3,!1),E=Gt(s,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const w=qA({id:be.with(()=>g()),ref:be.with(()=>v(),V=>v(V)),forceMount:be.with(()=>I())}),c=Pe(()=>Pi(w.props,E));var U=Ke(),q=Ne(U);{var K=V=>{var N=Ke(),ie=Ne(N);{var te=ue=>{var ye=Ke(),pe=Ne(ye);Ct(pe,()=>s.child,()=>({props:R(c)})),Te(ue,ye)},oe=ue=>{var ye=iC();let pe;var Ae=ci(ye);Ct(Ae,()=>s.children??Xt),ui(ye),di(()=>pe=Oi(ye,pe,{...R(c)})),Te(ue,ye)};hi(ie,ue=>{s.child?ue(te):ue(oe,!1)})}Te(V,N)};hi(q,V=>{w.shouldRender&&V(K)})}Te(f,U),kt()}var nC=Vt("<div><!></div>");function sC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"value",3,""),E=J(s,"forceMount",3,!1),w=Gt(s,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const c=GA({id:be.with(()=>g()),ref:be.with(()=>v(),ie=>v(ie)),forceMount:be.with(()=>E()),value:be.with(()=>I())}),U=Pe(()=>Pi(w,c.props));var q=Ke(),K=Ne(q);{var V=ie=>{var te=Ke(),oe=Ne(te);Ct(oe,()=>s.child,()=>({props:R(U)})),Te(ie,te)},N=ie=>{var te=nC();let oe;var ue=ci(te);Ct(ue,()=>s.children??Xt),ui(te),di(()=>oe=Oi(te,oe,{...R(U)})),Te(ie,te)};hi(K,ie=>{s.child?ie(V):ie(N,!1)})}Te(f,q),kt()}var oC=Vt("<div><!></div>");function aC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=HA({id:be.with(()=>g()),ref:be.with(()=>v(),V=>v(V))}),w=Pe(()=>Pi(I,E.props));var c=Ke(),U=Ne(c);{var q=V=>{var N=Ke(),ie=Ne(N);Ct(ie,()=>s.child,()=>({props:R(w)})),Te(V,N)},K=V=>{var N=oC();let ie;var te=ci(N);Ct(te,()=>s.children??Xt),ui(N),di(()=>ie=Oi(N,ie,{...R(w)})),Te(V,N)};hi(U,V=>{s.child?V(q):V(K,!1)})}Te(f,c),kt()}var lC=Vt("<div><!></div>"),cC=Vt('<div style="display: contents;"><!></div>');function uC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const E=WA({id:be.with(()=>g()),ref:be.with(()=>v(),V=>v(V))}),w=Pe(()=>Pi(I,E.props));var c=cC(),U=ci(c);{var q=V=>{var N=Ke(),ie=Ne(N);Ct(ie,()=>s.child,()=>({props:R(w)})),Te(V,N)},K=V=>{var N=lC();let ie;var te=ci(N);Ct(te,()=>s.children??Xt),ui(N),di(()=>ie=Oi(N,ie,{...R(w)})),Te(V,N)};hi(U,V=>{s.child?V(q):V(K,!1)})}ui(c),Te(f,c),kt()}var hC=Vt("<input>");function dC(f,s){Et(s,!0);let g=J(s,"value",15,""),v=J(s,"autofocus",3,!1),I=J(s,"id",19,Gi),E=J(s,"ref",15,null),w=Gt(s,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const c=XA({id:be.with(()=>I()),ref:be.with(()=>E(),ie=>E(ie)),value:be.with(()=>g(),ie=>{g(ie)}),autofocus:be.with(()=>v()??!1)}),U=Pe(()=>Pi(w,c.props));var q=Ke(),K=Ne(q);{var V=ie=>{var te=Ke(),oe=Ne(te);Ct(oe,()=>s.child,()=>({props:R(U)})),Te(ie,te)},N=ie=>{var te=hC();H2(te);let oe;di(()=>oe=Oi(te,oe,{...R(U)})),eS(te,g),Te(ie,te)};hi(K,ie=>{s.child?ie(V):ie(N,!1)})}Te(f,q),kt()}var pC=Vt("<div><!></div>"),fC=Vt('<div style="display: contents;" data-item-wrapper=""><!></div>');function mC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"value",3,""),E=J(s,"disabled",3,!1),w=J(s,"onSelect",3,Yi),c=J(s,"forceMount",3,!1),U=J(s,"keywords",19,()=>[]),q=Gt(s,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=l_(null),V=ZA({id:be.with(()=>g()),ref:be.with(()=>v(),oe=>v(oe)),value:be.with(()=>I()),disabled:be.with(()=>E()),onSelect:be.with(()=>w()),forceMount:be.with(()=>c()),keywords:be.with(()=>U()),group:K}),N=Pe(()=>Pi(q,V.props));var ie=Ke(),te=Ne(ie);sb(te,()=>V.root.key,oe=>{var ue=fC(),ye=ci(ue);{var pe=Ae=>{var ze=Ke(),Me=Ne(ze);{var je=_t=>{var Ge=Ke(),gt=Ne(Ge);Ct(gt,()=>s.child,()=>({props:R(N)})),Te(_t,Ge)},Je=_t=>{var Ge=pC();let gt;var at=ci(Ge);Ct(at,()=>s.children??Xt),ui(Ge),di(()=>gt=Oi(Ge,gt,{...R(N)})),Te(_t,Ge)};hi(Me,_t=>{s.child?_t(je):_t(Je,!1)})}Te(Ae,ze)};hi(ye,Ae=>{V.shouldRender&&Ae(pe)})}ui(ue),di(()=>qy(ue,"data-value",I())),Te(oe,ue)}),Te(f,ie),kt()}var gC=Vt("<div><!></div>");function _C(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const E=KA({id:be.with(()=>g()),ref:be.with(()=>v(),V=>v(V)),ariaLabel:be.with(()=>s["aria-label"]??"Suggestions...")}),w=Pe(()=>Pi(I,E.props));var c=Ke(),U=Ne(c);{var q=V=>{var N=Ke(),ie=Ne(N);Ct(ie,()=>s.child,()=>({props:R(w)})),Te(V,N)},K=V=>{var N=gC();let ie;var te=ci(N);Ct(te,()=>s.children??Xt),ui(N),di(()=>ie=Oi(N,ie,{...R(w)})),Te(V,N)};hi(U,V=>{s.child?V(q):V(K,!1)})}Te(f,c),kt()}var Zd,Gd,Hd;class yC{constructor(s){Oe(this,"open");W(this,Zd,Ye(null));W(this,Gd,Ye(void 0));W(this,Hd,Ye(null));Oe(this,"toggleOpen",()=>{this.open.current=!this.open.current});Oe(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=s.open}get contentNode(){return R(T(this,Zd))}set contentNode(s){Ve(T(this,Zd),Ze(s))}get contentId(){return R(T(this,Gd))}set contentId(s){Ve(T(this,Gd),Ze(s))}get triggerNode(){return R(T(this,Hd))}set triggerNode(s){Ve(T(this,Hd),Ze(s))}}Zd=new WeakMap,Gd=new WeakMap,Hd=new WeakMap;var Ec,Wd,Xo,An,Sg,Pg,Tg,Ig,Ag;class vC{constructor(s,g){W(this,Ec);W(this,Wd);W(this,Xo);W(this,An);W(this,Sg,s=>{if(!T(this,Xo).current){if(s.pointerType==="touch"||s.button!==0)return s.preventDefault();T(this,An).toggleOpen()}});W(this,Pg,s=>{T(this,Xo).current||s.pointerType==="touch"&&(s.preventDefault(),T(this,An).toggleOpen())});W(this,Tg,s=>{T(this,Xo).current||(s.key===hv||s.key===Ab)&&(s.preventDefault(),T(this,An).toggleOpen())});W(this,Ig,()=>{if(T(this,An).open.current&&T(this,An).contentId)return T(this,An).contentId});W(this,Ag,Pe(()=>({id:T(this,Ec).current,"aria-haspopup":"dialog","aria-expanded":lv(T(this,An).open.current),"data-state":Ua(T(this,An).open.current),"aria-controls":T(this,Ig).call(this),"data-popover-trigger":"",disabled:T(this,Xo).current,onpointerdown:T(this,Sg),onkeydown:T(this,Tg),onpointerup:T(this,Pg)})));Le(this,Ec,s.id),Le(this,An,g),Le(this,Wd,s.ref),Le(this,Xo,s.disabled),Bi({id:T(this,Ec),ref:T(this,Wd),onRefChange:v=>{T(this,An).triggerNode=v}})}get props(){return R(T(this,Ag))}}Ec=new WeakMap,Wd=new WeakMap,Xo=new WeakMap,An=new WeakMap,Sg=new WeakMap,Pg=new WeakMap,Tg=new WeakMap,Ig=new WeakMap,Ag=new WeakMap;var kc,Xd,Cg,Eg;class xC{constructor(s,g){W(this,kc);W(this,Xd);Oe(this,"root");W(this,Cg,Pe(()=>({open:this.root.open.current})));W(this,Eg,Pe(()=>({id:T(this,kc).current,tabindex:-1,"data-state":Ua(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));Le(this,kc,s.id),this.root=g,Le(this,Xd,s.ref),Bi({id:T(this,kc),ref:T(this,Xd),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return R(T(this,Cg))}get props(){return R(T(this,Eg))}}kc=new WeakMap,Xd=new WeakMap,Cg=new WeakMap,Eg=new WeakMap;const[bC,aw]=$s("Popover.Root");function wC(f){return bC(new yC(f))}function SC(f){return new vC(f,aw())}function PC(f){return new xC(f,aw())}var TC=Vt("<div><!></div>"),IC=Vt("<div><!></div>");function AC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"id",19,Gi),I=J(s,"forceMount",3,!1),E=J(s,"onCloseAutoFocus",3,Yi),w=J(s,"onEscapeKeydown",3,Yi),c=J(s,"onInteractOutside",3,Yi),U=J(s,"trapFocus",3,!0),q=J(s,"preventScroll",3,!1),K=Gt(s,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const V=PC({id:be.with(()=>v()),ref:be.with(()=>g(),ze=>g(ze))}),N=Pe(()=>Pi(K,V.props));function ie(ze){c()(ze),!ze.defaultPrevented&&V.root.close()}function te(ze){w()(ze),!ze.defaultPrevented&&V.root.close()}function oe(ze){var Me;E()(ze),!ze.defaultPrevented&&(ze.preventDefault(),(Me=V.root.triggerNode)==null||Me.focus())}var ue=Ke(),ye=Ne(ue);{var pe=ze=>{pA(ze,ri(()=>R(N),{get enabled(){return V.root.open.current},get id(){return v()},onInteractOutside:ie,onEscapeKeydown:te,onCloseAutoFocus:oe,get trapFocus(){return U()},get preventScroll(){return q()},loop:!0,forceMount:!0,popper:(je,Je)=>{let _t=()=>Je==null?void 0:Je().props;var Ge=Ke();const gt=Pe(()=>Pi(_t(),{style:Z0("popover")}));var at=Ne(Ge);{var Ue=Ce=>{var He=Ke(),st=Ne(He);Ct(st,()=>s.child,()=>({props:R(gt),...V.snippetProps})),Te(Ce,He)},Fe=Ce=>{var He=TC();let st;var yt=ci(He);Ct(yt,()=>s.children??Xt),ui(He),di(()=>st=Oi(He,st,{...R(gt)})),Te(Ce,He)};hi(at,Ce=>{s.child?Ce(Ue):Ce(Fe,!1)})}Te(je,Ge)},$$slots:{popper:!0}}))},Ae=ze=>{var Me=Ke(),je=Ne(Me);{var Je=_t=>{dA(_t,ri(()=>R(N),{get present(){return V.root.open.current},get id(){return v()},onInteractOutside:ie,onEscapeKeydown:te,onCloseAutoFocus:oe,get trapFocus(){return U()},get preventScroll(){return q()},loop:!0,forceMount:!1,popper:(gt,at)=>{let Ue=()=>at==null?void 0:at().props;var Fe=Ke();const Ce=Pe(()=>Pi(Ue(),{style:Z0("popover")}));var He=Ne(Fe);{var st=xt=>{var ht=Ke(),mt=Ne(ht);Ct(mt,()=>s.child,()=>({props:R(Ce),...V.snippetProps})),Te(xt,ht)},yt=xt=>{var ht=IC();let mt;var Rt=ci(ht);Ct(Rt,()=>s.children??Xt),ui(ht),di(()=>mt=Oi(ht,mt,{...R(Ce)})),Te(xt,ht)};hi(He,xt=>{s.child?xt(st):xt(yt,!1)})}Te(gt,Fe)},$$slots:{popper:!0}}))};hi(je,_t=>{I()||_t(Je)},!0)}Te(ze,Me)};hi(ye,ze=>{I()?ze(pe):ze(Ae,!1)})}Te(f,ue),kt()}var CC=Vt("<button><!></button>");function EC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"type",3,"button"),E=J(s,"disabled",3,!1),w=Gt(s,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const c=SC({id:be.with(()=>g()),ref:be.with(()=>v(),N=>v(N)),disabled:be.with(()=>!!E())}),U=Pe(()=>Pi(w,c.props,{type:I()})),q=t_(),[K,V]=q;oA(f,{get id(){return g()},children:(N,ie)=>{var te=Ke(),oe=Ne(te);{var ue=pe=>{var Ae=Ke(),ze=Ne(Ae);Ct(ze,()=>s.child,()=>({props:R(U)})),Te(pe,Ae)},ye=pe=>{var Ae=CC();const ze=Pe(()=>V({...R(U)},[{attribute_name:"formaction"}]));let Me;var je=ci(Ae);Ct(je,()=>s.children??Xt),ui(Ae),di(()=>Me=Oi(Ae,Me,{...R(ze)})),Te(pe,Ae)};hi(oe,pe=>{s.child?pe(ue):pe(ye,!1)})}Te(N,te)},$$slots:{default:!0}}),kt()}function kC(f,s){Et(s,!0);let g=J(s,"open",15,!1),v=J(s,"onOpenChange",3,Yi),I=J(s,"controlledOpen",3,!1);_T({variant:be.with(()=>"dialog"),open:be.with(()=>g(),c=>{I()||g(c),v()(c)})});var E=Ke(),w=Ne(E);Ct(w,()=>s.children??Xt),Te(f,E),kt()}var MC=Vt("<!> <!>",1),zC=Vt("<!> <div><!></div>",1);function DC(f,s){Et(s,!0);let g=J(s,"id",19,Gi),v=J(s,"ref",15,null),I=J(s,"forceMount",3,!1),E=J(s,"onCloseAutoFocus",3,Yi),w=J(s,"onEscapeKeydown",3,Yi),c=J(s,"onInteractOutside",3,Yi),U=J(s,"trapFocus",3,!0),q=J(s,"preventScroll",3,!0),K=J(s,"restoreScrollDelay",3,null),V=Gt(s,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const N=vT({id:be.with(()=>g()),ref:be.with(()=>v(),oe=>v(oe))}),ie=Pe(()=>Pi(V,N.props));var te=Pe(()=>N.root.open.current||I());r_(f,ri(()=>R(ie),{get forceMount(){return I()},get present(){return R(te)},presence:(ue,ye)=>{let pe=()=>ye==null?void 0:ye().present;var Ae=Pe(()=>QT({forceMount:I(),present:pe().current,trapFocus:U(),open:N.root.open.current}));Fb(ue,ri({loop:!0,get trapFocus(){return R(Ae)}},()=>R(ie),{onCloseAutoFocus:Me=>{var je;E()(Me),!Me.defaultPrevented&&((je=N.root.triggerNode)==null||je.focus())},focusScope:(Me,je)=>{let Je=()=>je==null?void 0:je().props;Lb(Me,ri(()=>R(ie),{get enabled(){return pe().current},onEscapeKeydown:_t=>{w()(_t),!_t.defaultPrevented&&N.root.handleClose()},children:(_t,Ge)=>{Rb(_t,ri(()=>R(ie),{get enabled(){return pe().current},onInteractOutside:gt=>{c()(gt),!gt.defaultPrevented&&N.root.handleClose()},children:(gt,at)=>{Nb(gt,ri(()=>R(ie),{get enabled(){return pe().current},children:(Ue,Fe)=>{var Ce=Ke(),He=Ne(Ce);{var st=xt=>{var ht=MC(),mt=Ne(ht);{var Rt=fi=>{sm(fi,{get preventScroll(){return q()},get restoreScrollDelay(){return K()}})};hi(mt,fi=>{N.root.open.current&&fi(Rt)})}var jt=Ci(mt,2),Ti=$g(()=>({props:Pi(R(ie),Je()),...N.snippetProps}));Ct(jt,()=>s.child,()=>R(Ti)),Te(xt,ht)},yt=xt=>{var ht=zC(),mt=Ne(ht);sm(mt,{get preventScroll(){return q()}});var Rt=Ci(mt,2);const jt=Pe(()=>Pi(R(ie),Je()));let Ti;var fi=ci(Rt);Ct(fi,()=>s.children??Xt),ui(Rt),di(()=>Ti=Oi(Rt,Ti,{...R(jt)})),Te(xt,ht)};hi(He,xt=>{s.child?xt(st):xt(yt,!1)})}Te(Ue,Ce)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),kt()}function RC(f,s){Et(s,!0);let g=J(s,"open",15,!1),v=J(s,"onOpenChange",3,Yi),I=J(s,"controlledOpen",3,!1);wC({open:be.with(()=>g(),E=>{I()||g(E),v()(E)})}),sA(f,{children:(E,w)=>{var c=Ke(),U=Ne(c);Ct(U,()=>s.children??Xt),Te(E,c)},$$slots:{default:!0}}),kt()}var LC=Vt('<div class="pb-4 pt-0"><!></div>');function OC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm transition-all",s.class));Yt(E,()=>cT,(c,U)=>{U(c,ri({get ref(){return g()},set ref(q){g(q)},get class(){return R(w)}},()=>v,{children:(q,K)=>{var V=LC(),N=ci(V);Ct(N,()=>s.children??Xt),ui(V),Te(q,V)},$$slots:{default:!0}}))}),Te(f,I),kt()}function FC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("border-b",s.class));Yt(E,()=>JP,(c,U)=>{U(c,ri({get ref(){return g()},set ref(q){g(q)},get class(){return R(w)}},()=>v))}),Te(f,I),kt()}/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var NC=_2("<svg><!><!></svg>");function qc(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]),v=Ko(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Et(s,!1);let I=J(s,"name",8,void 0),E=J(s,"color",8,"currentColor"),w=J(s,"size",8,24),c=J(s,"strokeWidth",8,2),U=J(s,"absoluteStrokeWidth",8,!1),q=J(s,"iconNode",24,()=>[]);const K=(...pe)=>pe.filter((Ae,ze,Me)=>!!Ae&&Me.indexOf(Ae)===ze).join(" "),V=t_(),[N,ie]=V;W2();var te=NC();let oe;var ue=ci(te);jy(ue,1,q,Uy,(pe,Ae)=>{let ze=()=>R(Ae)[0],Me=()=>R(Ae)[1];var je=Ke(),Je=Ne(je);const _t=$g(()=>`${ze()}`=="button"?ie({...Me()},[{attribute_name:"formaction"}]):`${ze()}`=="form"?ie({...Me()},[{attribute_name:"action"}]):`${ze()}`=="a"?ie({...Me()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...Me()});K2(Je,ze,!0,(Ge,gt)=>{let at;di(()=>at=Oi(Ge,at,{...R(_t)},void 0,Ge.namespaceURI===tb,Ge.nodeName.includes("-")))}),Te(pe,je)});var ye=Ci(ue);ja(ye,s,"default",{}),ui(te),di(()=>oe=Oi(te,oe,{...BC,...v,width:w(),height:w(),stroke:E(),"stroke-width":U()?Number(c())*24/Number(w()):c(),class:K("lucide-icon","lucide",I()?`lucide-${I()}`:"",g.class)},void 0,!0)),Te(f,te),kt()}function VC(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"chevron-down"},()=>g,{iconNode:[["path",{d:"m6 9 6 6 6-6"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}var jC=Vt("<!> <!>",1);function UC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"level",3,3),I=Gt(s,["$$slots","$$events","$$legacy","ref","class","level","children"]);var E=Ke(),w=Ne(E);Yt(w,()=>QP,(c,U)=>{U(c,{get level(){return v()},class:"flex",children:(q,K)=>{var V=Ke(),N=Ne(V),ie=Pe(()=>Tr("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s.class));Yt(N,()=>eT,(te,oe)=>{oe(te,ri({get ref(){return g()},set ref(ue){g(ue)},get class(){return R(ie)}},()=>I,{children:(ue,ye)=>{var pe=jC(),Ae=Ne(pe);Ct(Ae,()=>s.children??Xt);var ze=Ci(Ae,2);VC(ze,{class:"size-4 shrink-0 transition-transform duration-200"}),Te(ue,pe)},$$slots:{default:!0}}))}),Te(q,V)},$$slots:{default:!0}})}),Te(f,E),kt()}const qC=XP;function ZC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"value",15,""),I=Gt(s,["$$slots","$$events","$$legacy","ref","value","class"]);var E=Ke(),w=Ne(E),c=Pe(()=>Tr("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",s.class));Yt(w,()=>tC,(U,q)=>{q(U,ri({get class(){return R(c)},get value(){return v()},set value(K){v(K)},get ref(){return g()},set ref(K){g(K)}},()=>I))}),Te(f,E),kt()}function GC(f,s){Et(s,!0),J(s,"ref",11,null);let g=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var v=Ke(),I=Ne(v),E=Pe(()=>Tr("py-6 text-center text-sm",s.class));Yt(I,()=>rC,(w,c)=>{c(w,ri({get class(){return R(E)}},()=>g))}),Te(f,v),kt()}var HC=Vt("<!> <!>",1);function WC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("text-foreground overflow-hidden p-1",s.class));Yt(E,()=>sC,(c,U)=>{U(c,ri({get class(){return R(w)},get ref(){return g()},set ref(q){g(q)}},()=>v,{children:(q,K)=>{var V=HC(),N=Ne(V);{var ie=oe=>{var ue=Ke(),ye=Ne(ue);Yt(ye,()=>aC,(pe,Ae)=>{Ae(pe,{class:"text-muted-foreground px-2 py-1.5 text-xs font-medium",children:(ze,Me)=>{Us();var je=Aa();di(()=>ah(je,s.heading)),Te(ze,je)},$$slots:{default:!0}})}),Te(oe,ue)};hi(N,oe=>{s.heading&&oe(ie)})}var te=Ci(N,2);Yt(te,()=>uC,(oe,ue)=>{ue(oe,{get children(){return s.children}})}),Te(q,V)},$$slots:{default:!0}}))}),Te(f,I),kt()}function XC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("aria-selected:bg-accent aria-selected:text-accent-foreground relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s.class));Yt(E,()=>mC,(c,U)=>{U(c,ri({get class(){return R(w)},get ref(){return g()},set ref(q){g(q)}},()=>v))}),Te(f,I),kt()}function KC(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}var JC=Vt('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function YC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"value",15,""),I=Gt(s,["$$slots","$$events","$$legacy","ref","class","value"]);var E=JC(),w=ci(E);KC(w,{class:"mr-2 size-4 shrink-0 opacity-50"});var c=Ci(w,2),U=Pe(()=>Tr("placeholder:text-muted-foreground flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50",s.class));Yt(c,()=>dC,(q,K)=>{K(q,ri({get class(){return R(U)},get ref(){return g()},set ref(V){g(V)}},()=>I,{get value(){return v()},set value(V){v(V)}}))}),ui(E),Te(f,E),kt()}function QC(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("max-h-[300px] overflow-y-auto overflow-x-hidden",s.class));Yt(E,()=>_C,(c,U)=>{U(c,ri({get class(){return R(w)}},()=>v,{get ref(){return g()},set ref(q){g(q)}}))}),Te(f,I),kt()}function gr(){}const $C=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),eE=typeof document<"u";function tE(f){return f instanceof HTMLInputElement&&!$C.has(f.type)||f instanceof HTMLTextAreaElement||f instanceof HTMLElement&&f.isContentEditable}function Or(f){switch(f){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return f}}const Ji={DURATION:.5,EASE:[.32,.72,0,1]},lw=.4,iE=.25,rE=100,cw=8,Ia=16,wv=26,By="vaul-dragging",uw=new WeakMap;function mr(f,s,g=!1){if(!f||!(f instanceof HTMLElement))return;const v={};Object.entries(s).forEach(([I,E])=>{if(I.startsWith("--")){f.style.setProperty(I,E);return}v[I]=f.style[I],f.style[I]=E}),!g&&uw.set(f,v)}function nE(f,s){if(!f||!(f instanceof HTMLElement))return;const g=uw.get(f);g&&(f.style[s]=g[s])}function sE(){return Sv(/^Mac/)}function Sv(f){return typeof window<"u"&&window.navigator!=null?f.test(window.navigator.platform):void 0}function oE(){return Sv(/^iPhone/)}function W0(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function aE(){return Sv(/^iPad/)||sE()&&navigator.maxTouchPoints>1}function lE(){return oE()||aE()}function X0(f){switch(f){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return f}}function Jf(f,s){if(!f)return null;const g=window.getComputedStyle(f),v=g.transform||g.webkitTransform||g.mozTransform;let I=v.match(/^matrix3d\((.+)\)$/);return I?Number.parseFloat(I[1].split(", ")[X0(s)?13:12]):(I=v.match(/^matrix\((.+)\)$/),I?Number.parseFloat(I[1].split(", ")[X0(s)?5:4]):null)}function Ny(f,s){if(!f)return()=>{};const g=f.style.cssText;return Object.assign(f.style,s),()=>{f.style.cssText=g}}let nh=null;var _s,Fa,Ba,Mc,Kd,kg,Jd,Mg,zg;class cE{constructor(s){W(this,_s);W(this,Fa,Ye(Ze(typeof window<"u"?window.location.href:"")));W(this,Ba,Ye(0));W(this,Mc,Pe(()=>T(this,_s).open.current));W(this,Kd,Pe(()=>T(this,_s).noBodyStyles.current));W(this,kg,Pe(()=>T(this,_s).preventScrollRestoration.current));W(this,Jd,Pe(()=>T(this,_s).modal.current));W(this,Mg,Pe(()=>T(this,_s).nested.current));W(this,zg,Pe(()=>T(this,_s).hasBeenOpened));Oe(this,"setPositionFixed",()=>{if(W0()&&nh===null&&R(T(this,Mc))&&!R(T(this,Kd))){nh={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:s,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-R(T(this,Ba))}px`,left:`${-s}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const v=g-window.innerHeight;v&&R(T(this,Ba))>=g&&(document.body.style.top=`${-(R(T(this,Ba))+v)}px`)}),300)}});Oe(this,"restorePositionSetting",()=>{if(W0()&&nh!==null&&!R(T(this,Kd))){const s=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,nh),window.requestAnimationFrame(()=>{if(R(T(this,kg))&&R(T(this,Fa))!==window.location.href){Ve(T(this,Fa),Ze(window.location.href));return}window.scrollTo(g,s)}),nh=null}});Le(this,_s,s),At(()=>Ri(()=>{const g=()=>{Ve(T(this,Ba),Ze(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),At(()=>{if(R(T(this,Fa)),!!R(T(this,Jd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),At(()=>{R(T(this,Mc));const g=R(T(this,Jd)),v=R(T(this,zg)),I=R(T(this,Mg));R(T(this,Fa)),Ri(()=>{I||!v||(R(T(this,Mc))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}_s=new WeakMap,Fa=new WeakMap,Ba=new WeakMap,Mc=new WeakMap,Kd=new WeakMap,kg=new WeakMap,Jd=new WeakMap,Mg=new WeakMap,zg=new WeakMap;function K0(f,s){return Bp(f,s)}function uE(f,s){const g=f,v=typeof f=="symbol"?f.description:f;if(!rb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return nv(f)}function hE(f,s){return`${f}Context`}function dE(f,s,g=!0){const v=hE(f),I=Symbol(v),E=v;function w(U){const q=uE(g?I:E,U);if(q===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(f)?`one of the following components: ${f.join(", ")}`:`\`${f}\``}`);return q}function c(U){return K0(g?I:E,U)}return[c,w]}var Xr,Rr,zc,Lr,Dg,Rg,Dc,Yd,Qd,$d,Lg,Og,Fg,Bg,Ng,ep;class pE{constructor(s){W(this,Xr);W(this,Rr,Pe(()=>T(this,Xr).direction.current));W(this,zc,Pe(()=>T(this,Xr).container.current));W(this,Lr,Pe(()=>T(this,Xr).snapPoints.current??[]));W(this,Dg,Pe(()=>T(this,Xr).activeSnapPoint.current));W(this,Rg,Pe(()=>T(this,Xr).fadeFromIndex.current));W(this,Dc,Pe(()=>T(this,Xr).overlayNode));W(this,Yd,Pe(()=>T(this,Xr).drawerNode));W(this,Qd,Pe(()=>T(this,Xr).snapToSequentialPoint.current));W(this,$d,Ye(eE?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));W(this,Lg,Pe(()=>{var s;return this.activeSnapPoint===((s=R(T(this,Lr)))==null?void 0:s[R(T(this,Lr)).length-1])||null}));W(this,Og,Pe(()=>{var s;return(s=R(T(this,Lr)))==null?void 0:s.findIndex(g=>g===this.activeSnapPoint)}));W(this,Fg,Pe(()=>R(T(this,Lr))&&R(T(this,Lr)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&R(T(this,Lr))[this.fadeFromIndex]===this.activeSnapPoint||!R(T(this,Lr))));W(this,Bg,Pe(()=>{var v;this.windowDimensions,T(this,Xr).open.current;const s=R(T(this,zc))?{width:R(T(this,zc)).getBoundingClientRect().width,height:R(T(this,zc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((v=R(T(this,Lr)))==null?void 0:v.map(I=>{const E=typeof I=="string";let w=0;if(E&&(w=Number.parseInt(I,10)),Or(R(T(this,Rr)))){const U=E?w:this.windowDimensions?I*s.height:0;return this.windowDimensions?R(T(this,Rr))==="bottom"?s.height-U:-s.height+U:U}const c=E?w:this.windowDimensions?I*s.width:0;return this.windowDimensions?R(T(this,Rr))==="right"?s.width-c:-s.width+c:c}))??[]}));W(this,Ng,Pe(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));W(this,ep,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});Oe(this,"snapToPoint",s=>{var v;const g=this.snapPointsOffset.findIndex(I=>I===s)??null;T(this,Xr).onSnapPointChange(g),mr(R(T(this,Yd)),{transition:`transform ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,transform:Or(R(T(this,Rr)))?`translate3d(0, ${s}px, 0)`:`translate3d(${s}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?mr(R(T(this,Dc)),{transition:`opacity ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,opacity:"0"}):mr(R(T(this,Dc)),{transition:`opacity ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,opacity:"1"}),T(this,Xr).setActiveSnapPoint((v=R(T(this,Lr)))==null?void 0:v[Math.max(g,0)])});Oe(this,"onRelease",s=>{var U;if(this.fadeFromIndex===void 0)return;const g=R(T(this,Rr))==="bottom"||R(T(this,Rr))==="right"?(this.activeSnapPointOffset??0)-s.draggedDistance:(this.activeSnapPointOffset??0)+s.draggedDistance,v=this.activeSnapPointIndex===this.fadeFromIndex-1,I=this.activeSnapPointIndex===0,E=s.draggedDistance>0;if(v&&mr(R(T(this,Dc)),{transition:`opacity ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`}),!R(T(this,Qd))&&s.velocity>2&&!E){s.dismissible?s.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!R(T(this,Qd))&&s.velocity>2&&E&&this.snapPointsOffset&&R(T(this,Lr))){this.snapToPoint(this.snapPointsOffset[R(T(this,Lr)).length-1]);return}const w=(U=this.snapPointsOffset)==null?void 0:U.reduce((q,K)=>typeof q!="number"||typeof K!="number"?q:Math.abs(K-g)<Math.abs(q-g)?K:q),c=Or(R(T(this,Rr)))?window.innerHeight:window.innerWidth;if(s.velocity>lw&&Math.abs(s.draggedDistance)<c*.4){const q=E?1:-1;if(q>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[R(T(this,Lr)).length-1]);return}if(I&&q<0&&s.dismissible&&T(this,Xr).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+q]);return}this.snapToPoint(w)});Oe(this,"onDrag",s=>{if(this.activeSnapPointOffset===null)return;const g=R(T(this,Rr))==="bottom"||R(T(this,Rr))==="right"?this.activeSnapPointOffset-s.draggedDistance:this.activeSnapPointOffset+s.draggedDistance;(R(T(this,Rr))==="bottom"||R(T(this,Rr))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(R(T(this,Rr))==="top"||R(T(this,Rr))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||mr(R(T(this,Yd)),{transform:Or(R(T(this,Rr)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});Oe(this,"getPercentageDragged",(s,g)=>{if(!R(T(this,Lr)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const v=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(v&&!g)return 1;if(!this.shouldFade&&!v)return null;const E=v?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,w=v?this.snapPointsOffset[E]-this.snapPointsOffset[E-1]:this.snapPointsOffset[E+1]-this.snapPointsOffset[E],c=s/Math.abs(w);return v?1-c:c});Le(this,Xr,s),At(()=>Ri(()=>(window.addEventListener("resize",T(this,ep)),()=>window.removeEventListener("resize",T(this,ep))))),At(()=>{const g=this.activeSnapPoint,v=R(T(this,Lr)),I=this.snapPointsOffset;Ri(()=>{if(g){const E=(v==null?void 0:v.findIndex(w=>w===g))??-1;I&&E!==-1&&typeof I[E]=="number"&&this.snapToPoint(I[E])}})})}get activeSnapPoint(){return R(T(this,Dg))}get fadeFromIndex(){return R(T(this,Rg))}get windowDimensions(){return R(T(this,$d))}set windowDimensions(s){Ve(T(this,$d),s)}get isLastSnapPoint(){return R(T(this,Lg))}get activeSnapPointIndex(){return R(T(this,Og))}get shouldFade(){return R(T(this,Fg))}get snapPointsOffset(){return R(T(this,Bg))}get activeSnapPointOffset(){return R(T(this,Ng))}}Xr=new WeakMap,Rr=new WeakMap,zc=new WeakMap,Lr=new WeakMap,Dg=new WeakMap,Rg=new WeakMap,Dc=new WeakMap,Yd=new WeakMap,Qd=new WeakMap,$d=new WeakMap,Lg=new WeakMap,Og=new WeakMap,Fg=new WeakMap,Bg=new WeakMap,Ng=new WeakMap,ep=new WeakMap;function fE(...f){return(...s)=>{for(const g of f)typeof g=="function"&&g(...s)}}function mE(f){const s=Pe(()=>f.direction.current),g=Pe(()=>f.open.current),v=Pe(()=>f.shouldScaleBackground.current),I=Pe(()=>f.setBackgroundColorOnScale.current),E=Pe(()=>f.noBodyStyles.current);let w=Ye(null),c=Ye("");function U(){return(window.innerWidth-wv)/window.innerWidth}At(()=>{Ri(()=>{Ve(c,Ze(document.body.style.backgroundColor))})}),At(()=>(R(g),R(v),R(I),Ri(()=>{if(R(g)&&R(v)){R(w)&&window.clearTimeout(R(w));const q=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!q)return;fE(R(I)&&!R(E)?Ny(document.body,{background:"black"}):gr,Ny(q,{transformOrigin:Or(R(s))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Ji.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Ji.EASE.join(",")})`}));const K=Ny(q,{borderRadius:`${cw}px`,overflow:"hidden",...Or(R(s))?{transform:`scale(${U()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${U()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{K(),Ve(w,Ze(window.setTimeout(()=>{R(c)?document.body.style.background=R(c):document.body.style.removeProperty("background")},Ji.DURATION*1e3)))}}})))}var tp,ip,rp,np,sp,op,ap,lp,cp,up,hp,dp,pp,fp,mp,gp,_p,Vg;class gE{constructor(s){Oe(this,"open");Oe(this,"activeSnapPoint");Oe(this,"closeThreshold");Oe(this,"shouldScaleBackground");Oe(this,"scrollLockTimeout");Oe(this,"snapPoints");Oe(this,"fadeFromIndex");Oe(this,"fixed");Oe(this,"dismissible");Oe(this,"direction");Oe(this,"onDragProp");Oe(this,"onReleaseProp");Oe(this,"nested");Oe(this,"onCloseProp");Oe(this,"backgroundColor");Oe(this,"modal");Oe(this,"handleOnly");Oe(this,"noBodyStyles");Oe(this,"preventScrollRestoration");Oe(this,"setBackgroundColorOnScale");Oe(this,"container");Oe(this,"snapToSequentialPoint");Oe(this,"repositionInputs");Oe(this,"autoFocus");W(this,tp,Ye(!1));W(this,ip,Ye(!1));W(this,rp,Ye(!1));W(this,np,Ye(null));W(this,sp,Ye(null));W(this,op,Ye(null));W(this,ap,Ye(null));W(this,lp,Ye(null));W(this,cp,Ye(!1));W(this,up,Ye(null));W(this,hp,Ye(0));W(this,dp,Ye(!1));W(this,pp,Ye(0));W(this,fp,Ye(null));W(this,mp,Ye(0));W(this,gp,Ye(0));W(this,_p,Ye(0));Oe(this,"snapPointsState");W(this,Vg,Pe(()=>this.snapPointsState.snapPointsOffset));Oe(this,"positionFixedState");Oe(this,"setActiveSnapPoint",s=>{this.activeSnapPoint.current=s});Oe(this,"onSnapPointChange",s=>{this.snapPoints.current&&s===this.snapPointsOffset.length-1&&(this.openTime=new Date)});Oe(this,"onPress",s=>{var v;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(s.target))return;const g=(v=this.drawerNode)==null?void 0:v.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,lE()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),s.target.setPointerCapture(s.pointerId),this.pointerStart=Or(this.direction.current)?s.pageY:s.pageX});Oe(this,"shouldDrag",(s,g)=>{var c;if(s===null)return!1;let v=s;const I=(c=window.getSelection())==null?void 0:c.toString(),E=this.drawerNode?Jf(this.drawerNode,this.direction.current):null,w=new Date;if(v.hasAttribute("data-vaul-no-drag")||v.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&w.getTime()-this.openTime.getTime()<500)return!1;if(E!==null&&(this.direction.current==="bottom"?E>0:E<0))return!0;if(I&&I.length>0)return!1;if(this.lastTimeDragPrevented!==null&&w.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&E===0)return this.lastTimeDragPrevented=w,!1;if(g)return this.lastTimeDragPrevented=w,!1;for(;v;){if(v.scrollHeight>v.clientHeight){if(v.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(v.getAttribute("role")==="dialog")return!0}v=v.parentNode}return!0});Oe(this,"onDrag",s=>{var N,ie;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,v=(this.pointerStart-(Or(this.direction.current)?s.pageY:s.pageX))*g,I=v>0,E=this.snapPoints.current&&!this.dismissible.current&&!I;if(E&&this.snapPointsState.activeSnapPointIndex===0)return;const w=Math.abs(v),c=document.querySelector("[data-vaul-drawer-wrapper]"),U=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let q=w/U;const K=this.snapPointsState.getPercentageDragged(w,I);if(K!==null&&(q=K),E&&q>=1||!this.isAllowedToDrag&&!this.shouldDrag(s.target,I))return;if(this.drawerNode.classList.add(By),this.isAllowedToDrag=!0,mr(this.drawerNode,{transition:"none"}),mr(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:v}),I&&!this.snapPoints.current){const te=TE(v),oe=Math.min(te*-1,0)*g;mr(this.drawerNode,{transform:Or(this.direction.current)?`translate3d(0, ${oe}px, 0)`:`translate3d(${oe}px, 0, 0)`});return}const V=1-q;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((ie=(N=this.onDragProp).current)==null||ie.call(N,s,q),mr(this.overlayNode,{opacity:`${V}`,transition:"none"},!0)),c&&this.overlayNode&&this.shouldScaleBackground.current){const te=Math.min(Yf()+q*(1-Yf()),1),oe=8-q*8,ue=Math.max(0,14-q*14);mr(c,{borderRadius:`${oe}px`,transform:Or(this.direction.current)?`scale(${te}) translate3d(0, ${ue}px, 0)`:`scale(${te}) translate3d(${ue}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const te=w*g;mr(this.drawerNode,{transform:Or(this.direction.current)?`translate3d(0, ${te}px, 0)`:`translate3d(${te}px, 0, 0)`})}});Oe(this,"closeDrawer",s=>{var g,v;this.cancelDrag(),(v=(g=this.onCloseProp).current)==null||v.call(g),s||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},Ji.DURATION*1e3)});Oe(this,"resetDrawer",()=>{if(!this.drawerNode)return;const s=document.querySelector("[data-vaul-drawer-wrapper]"),g=Jf(this.drawerNode,this.direction.current);mr(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`}),mr(this.overlayNode,{transition:`opacity ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&mr(s,{borderRadius:`${cw}px`,overflow:"hidden",...Or(this.direction.current)?{transform:`scale(${Yf()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Yf()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Ji.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Ji.EASE.join(",")})`},!0)});Oe(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(By),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});Oe(this,"onRelease",s=>{var q,K,V,N,ie,te,oe,ue,ye,pe;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(By),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=Jf(this.drawerNode,this.direction.current);if(!this.shouldDrag(s.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const v=this.dragEndTime.getTime()-this.dragStartTime.getTime(),I=this.pointerStart-(Or(this.direction.current)?s.pageY:s.pageX),E=Math.abs(I)/v;if(E>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const Ae=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:I*Ae,closeDrawer:this.closeDrawer,velocity:E,dismissible:this.dismissible.current}),(K=(q=this.onReleaseProp).current)==null||K.call(q,s,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?I>0:I<0){this.resetDrawer(),(N=(V=this.onReleaseProp).current)==null||N.call(V,s,!0);return}if(E>lw){this.closeDrawer(),(te=(ie=this.onReleaseProp).current)==null||te.call(ie,s,!1);return}const w=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),c=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),U=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(U?c:w)*this.closeThreshold.current){this.closeDrawer(),(ue=(oe=this.onReleaseProp).current)==null||ue.call(oe,s,!1);return}(pe=(ye=this.onReleaseProp).current)==null||pe.call(ye,s,!0),this.resetDrawer()});Oe(this,"onNestedOpenChange",s=>{const g=s?(window.innerWidth-Ia)/window.innerWidth:1,v=s?-Ia:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),mr(this.drawerNode,{transition:`transform ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${v}px, 0)`}),!s&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const I=Jf(this.drawerNode,this.direction.current);mr(this.drawerNode,{transition:"none",transform:Or(this.direction.current)?`translate3d(0, ${I}px, 0)`:`translate3d(${I}px, 0, 0)`})},500))});Oe(this,"onNestedDrag",(s,g)=>{if(g<0)return;const v=(window.innerWidth-Ia)/window.innerWidth,I=v+g*(1-v),E=-Ia+g*Ia;mr(this.drawerNode,{transform:Or(this.direction.current)?`scale(${I}) translate3d(0, ${E}px, 0)`:`scale(${I}) translate3d(${E}px, 0, 0)`,transition:"none"})});Oe(this,"onNestedRelease",(s,g)=>{const v=Or(this.direction.current)?window.innerHeight:window.innerWidth,I=g?(v-Ia)/v:1,E=g?-Ia:0;g&&mr(this.drawerNode,{transition:`transform ${Ji.DURATION}s cubic-bezier(${Ji.EASE.join(",")})`,transform:Or(this.direction.current)?`scale(${I}) translate3d(0, ${E}px, 0)`:`scale(${I}) translate3d(${E}px, 0, 0)`})});Oe(this,"onDialogOpenChange",s=>{!this.dismissible.current&&!this.open.current||(s?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=s)});this.open=s.open,this.activeSnapPoint=s.activeSnapPoint,this.closeThreshold=s.closeThreshold,this.shouldScaleBackground=s.shouldScaleBackground,this.scrollLockTimeout=s.scrollLockTimeout,this.snapPoints=s.snapPoints,this.fadeFromIndex=s.fadeFromIndex,this.fixed=s.fixed,this.dismissible=s.dismissible,this.direction=s.direction,this.onDragProp=s.onDrag,this.onReleaseProp=s.onRelease,this.nested=s.nested,this.onCloseProp=s.onClose,this.backgroundColor=s.backgroundColor,this.modal=s.modal,this.handleOnly=s.handleOnly,this.noBodyStyles=s.noBodyStyles,this.preventScrollRestoration=s.preventScrollRestoration,this.setBackgroundColorOnScale=s.setBackgroundColorOnScale,this.container=s.container,this.snapToSequentialPoint=s.snapToSequentialPoint,this.repositionInputs=s.repositionInputs,this.autoFocus=s.autoFocus,this.snapPointsState=new pE(this),this.positionFixedState=new cE(this),At(()=>{const g=this.snapPointsState.activeSnapPointIndex,v=this.snapPoints.current,I=this.snapPointsState.snapPointsOffset;return this.drawerNode,Ri(()=>{var w;const E=()=>{var U;if(!this.drawerNode||!this.repositionInputs.current)return;const c=document.activeElement;if(tE(c)||this.keyboardIsOpen){const q=((U=window.visualViewport)==null?void 0:U.height)||0,K=window.innerHeight;let V=K-q;const N=this.drawerNode.getBoundingClientRect().height||0,ie=N>K*.8;this.initialDrawerHeight||(this.initialDrawerHeight=N);const te=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-V)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),v&&v.length>0&&I&&g){const oe=I[g]||0;V+=oe}if(this.previousDiffFromInitial=V,N>q||this.keyboardIsOpen){const oe=this.drawerNode.getBoundingClientRect().height;let ue=oe;oe>q&&(ue=q-(ie?te:wv)),this.fixed.current?this.drawerNode.style.height=`${oe-Math.max(V,0)}px`:this.drawerNode.style.height=`${Math.max(ue,q-te)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;v&&v.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(V,0)}px`}};return(w=window.visualViewport)==null||w.addEventListener("resize",E),()=>{var c;return(c=window.visualViewport)==null?void 0:c.removeEventListener("resize",E)}})}),At(()=>{const g=this.open.current;return Ri(()=>(g&&(mr(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{nE(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return R(T(this,tp))}set hasBeenOpened(s){Ve(T(this,tp),Ze(s))}get isDragging(){return R(T(this,ip))}set isDragging(s){Ve(T(this,ip),Ze(s))}get justReleased(){return R(T(this,rp))}set justReleased(s){Ve(T(this,rp),Ze(s))}get overlayNode(){return R(T(this,np))}set overlayNode(s){Ve(T(this,np),Ze(s))}get openTime(){return R(T(this,sp))}set openTime(s){Ve(T(this,sp),Ze(s))}get dragStartTime(){return R(T(this,op))}set dragStartTime(s){Ve(T(this,op),Ze(s))}get dragEndTime(){return R(T(this,ap))}set dragEndTime(s){Ve(T(this,ap),Ze(s))}get lastTimeDragPrevented(){return R(T(this,lp))}set lastTimeDragPrevented(s){Ve(T(this,lp),Ze(s))}get isAllowedToDrag(){return R(T(this,cp))}set isAllowedToDrag(s){Ve(T(this,cp),Ze(s))}get nestedOpenChangeTimer(){return R(T(this,up))}set nestedOpenChangeTimer(s){Ve(T(this,up),Ze(s))}get pointerStart(){return R(T(this,hp))}set pointerStart(s){Ve(T(this,hp),Ze(s))}get keyboardIsOpen(){return R(T(this,dp))}set keyboardIsOpen(s){Ve(T(this,dp),Ze(s))}get previousDiffFromInitial(){return R(T(this,pp))}set previousDiffFromInitial(s){Ve(T(this,pp),Ze(s))}get drawerNode(){return R(T(this,fp))}set drawerNode(s){Ve(T(this,fp),Ze(s))}get drawerHeight(){return R(T(this,mp))}set drawerHeight(s){Ve(T(this,mp),Ze(s))}get drawerWidth(){return R(T(this,gp))}set drawerWidth(s){Ve(T(this,gp),Ze(s))}get initialDrawerHeight(){return R(T(this,_p))}set initialDrawerHeight(s){Ve(T(this,_p),Ze(s))}get snapPointsOffset(){return R(T(this,Vg))}}tp=new WeakMap,ip=new WeakMap,rp=new WeakMap,np=new WeakMap,sp=new WeakMap,op=new WeakMap,ap=new WeakMap,lp=new WeakMap,cp=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,mp=new WeakMap,gp=new WeakMap,_p=new WeakMap,Vg=new WeakMap;var Un,Rc,yp,vp,jg,Ug,qg;class _E{constructor(s,g){W(this,Un);W(this,Rc);W(this,yp);W(this,vp,Ye(!1));W(this,jg,Pe(()=>T(this,Un).snapPoints.current&&T(this,Un).snapPoints.current.length>0));W(this,Ug,s=>{T(this,Un).onRelease(s)});W(this,qg,Pe(()=>({id:T(this,Rc).current,"data-vaul-overlay":"","data-vaul-snap-points":T(this,Un).open.current&&R(T(this,jg))?"true":"false","data-vaul-snap-points-overlay":T(this,Un).open.current&&T(this,Un).snapPointsState.shouldFade?"true":"false",onmouseup:T(this,Ug)})));Le(this,Un,g),Le(this,Rc,s.id),Le(this,yp,s.ref),hw({id:T(this,Rc),ref:T(this,yp),onRefChange:v=>{this.mounted?T(this,Un).overlayNode=v:T(this,Un).overlayNode=null},deps:()=>this.mounted})}get mounted(){return R(T(this,vp))}set mounted(s){Ve(T(this,vp),Ze(s))}get props(){return R(T(this,qg))}}Un=new WeakMap,Rc=new WeakMap,yp=new WeakMap,vp=new WeakMap,jg=new WeakMap,Ug=new WeakMap,qg=new WeakMap;var Fi,Lc,xp,bp,wp,Sp,Pp,Tp,Ip,Ap,Cp,Ep,kp,Mp,Zg,zp,Gg,Hg,Wg,Xg,Kg,Jg,Yg;class yE{constructor(s,g){W(this,Fi);W(this,Lc);W(this,xp);W(this,bp);W(this,wp);W(this,Sp);W(this,Pp);W(this,Tp);W(this,Ip);W(this,Ap);W(this,Cp,Ye(!1));W(this,Ep,Ye(null));W(this,kp,Ye(null));W(this,Mp,Ye(!1));W(this,Zg,Pe(()=>T(this,Fi).snapPoints.current&&T(this,Fi).snapPoints.current.length>0));W(this,zp,Ye(!1));Oe(this,"isDeltaInDirection",(s,g,v=0)=>{if(this.wasBeyondThePoint)return!0;const I=Math.abs(s.y),E=Math.abs(s.x),w=E>I,c=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(s.x*c<0)&&E>=0&&E<=v)return w}else if(!(s.y*c<0)&&I>=0&&I<=v)return!w;return this.wasBeyondThePoint=!0,!0});Oe(this,"handleOnPointerUp",s=>{this.pointerStart=null,this.wasBeyondThePoint=!1,T(this,Fi).onRelease(s)});Oe(this,"onOpenAutoFocus",s=>{T(this,Ap).current(s)});Oe(this,"onInteractOutside",s=>{if(T(this,bp).current(s),!T(this,Fi).modal.current||s.defaultPrevented){s.preventDefault();return}T(this,Fi).keyboardIsOpen&&(T(this,Fi).keyboardIsOpen=!1)});Oe(this,"onFocusOutside",s=>{T(this,Fi).modal.current||s.preventDefault()});W(this,Gg,s=>{if(this.lastKnownPointerEvent=s,T(this,Fi).handleOnly.current||(T(this,Sp).current(s),!this.pointerStart))return;const g=s.pageY-this.pointerStart.y,v=s.pageX-this.pointerStart.x,I=s.pointerType==="touch"?10:2,E={x:v,y:g};this.isDeltaInDirection(E,T(this,Fi).direction.current,I)?T(this,Fi).onDrag(s):(Math.abs(v)>I||Math.abs(g)>I)&&(this.pointerStart=null)});W(this,Hg,s=>{T(this,Pp).current(s),this.pointerStart=null,this.wasBeyondThePoint=!1,T(this,Fi).onRelease(s)});W(this,Wg,s=>{T(this,Tp).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});W(this,Xg,s=>{T(this,Ip).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});W(this,Kg,s=>{T(this,Fi).handleOnly.current||(T(this,wp).current(s),this.pointerStart={x:s.pageX,y:s.pageY},T(this,Fi).onPress(s))});W(this,Jg,Pe(()=>ob(T(this,Fi).snapPointsState.snapPointsOffset)));W(this,Yg,Pe(()=>({id:T(this,Lc).current,"data-vaul-drawer-direction":T(this,Fi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":T(this,Fi).container.current?"true":"false","data-vaul-snap-points":T(this,Fi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:T(this,Kg),onpointermove:T(this,Gg),onpointerup:T(this,Hg),onpointerout:T(this,Wg),oncontextmenu:T(this,Xg)})));Le(this,Fi,g),Le(this,Lc,s.id),Le(this,xp,s.ref),Le(this,bp,s.onInteractOutside),Le(this,wp,s.onPointerDown),Le(this,Sp,s.onPointerMove),Le(this,Pp,s.onPointerUp),Le(this,Tp,s.onPointerOut),Le(this,Ip,s.onContextMenu),Le(this,Ap,s.onOpenAutoFocus),hw({id:T(this,Lc),ref:T(this,xp),onRefChange:v=>{this.mounted?T(this,Fi).drawerNode=v:T(this,Fi).drawerNode=null},deps:()=>this.mounted&&T(this,Fi).open.current}),mE(T(this,Fi)),At(()=>{this.hasSnapPoints&&T(this,Fi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return R(T(this,Cp))}set delayedSnapPoints(s){Ve(T(this,Cp),Ze(s))}get pointerStart(){return R(T(this,Ep))}set pointerStart(s){Ve(T(this,Ep),Ze(s))}get lastKnownPointerEvent(){return R(T(this,kp))}set lastKnownPointerEvent(s){Ve(T(this,kp),Ze(s))}get wasBeyondThePoint(){return R(T(this,Mp))}set wasBeyondThePoint(s){Ve(T(this,Mp),Ze(s))}get hasSnapPoints(){return R(T(this,Zg))}get mounted(){return R(T(this,zp))}set mounted(s){Ve(T(this,zp),Ze(s))}get snapPointsOffset(){return R(T(this,Jg))}get props(){return R(T(this,Yg))}}Fi=new WeakMap,Lc=new WeakMap,xp=new WeakMap,bp=new WeakMap,wp=new WeakMap,Sp=new WeakMap,Pp=new WeakMap,Tp=new WeakMap,Ip=new WeakMap,Ap=new WeakMap,Cp=new WeakMap,Ep=new WeakMap,kp=new WeakMap,Mp=new WeakMap,Zg=new WeakMap,zp=new WeakMap,Gg=new WeakMap,Hg=new WeakMap,Wg=new WeakMap,Xg=new WeakMap,Kg=new WeakMap,Jg=new WeakMap,Yg=new WeakMap;var Oc,Qg;class vE{constructor(s){W(this,Oc);W(this,Qg,Pe(()=>({to:T(this,Oc).container.current?T(this,Oc).container.current:void 0})));Le(this,Oc,s)}get props(){return R(T(this,Qg))}}Oc=new WeakMap,Qg=new WeakMap;const[xE,Pv]=dE("Drawer.Root");function bE(f){return xE(new gE(f))}function wE(f){const s=Pv();return new yE(f,s)}function SE(f){const s=Pv();return new _E(f,s)}function PE(){const f=Pv();return new vE(f)}function Yf(){return(window.innerWidth-wv)/window.innerWidth}function TE(f){return 8*(Math.log(f+1)-2)}function hw({id:f,ref:s,deps:g=()=>!0,onRefChange:v=()=>{}}){const I=Pe(()=>g());At(()=>(f.current,R(I),Ri(()=>{const E=document.getElementById(f.current);return s.current=E,v(s.current),()=>{v(null)}}))),At(()=>()=>{s.current=null,v(null)})}function IE(f,s){Et(s,!0);let g=J(s,"open",15,!1),v=J(s,"onOpenChange",3,gr),I=J(s,"closeThreshold",3,iE),E=J(s,"scrollLockTimeout",3,rE),w=J(s,"fadeFromIndex",19,()=>s.snapPoints&&s.snapPoints.length-1),c=J(s,"backgroundColor",3,"black"),U=J(s,"nested",3,!1),q=J(s,"shouldScaleBackground",3,!1),K=J(s,"activeSnapPoint",15,null),V=J(s,"onActiveSnapPointChange",3,gr),N=J(s,"onRelease",3,gr),ie=J(s,"onDrag",3,gr),te=J(s,"onClose",3,gr),oe=J(s,"dismissible",3,!0),ue=J(s,"direction",3,"bottom"),ye=J(s,"fixed",3,!1),pe=J(s,"handleOnly",3,!1),Ae=J(s,"noBodyStyles",3,!1),ze=J(s,"preventScrollRestoration",3,!0),Me=J(s,"setBackgroundColorOnScale",3,!0),je=J(s,"onAnimationEnd",3,gr),Je=J(s,"controlledOpen",3,!1),_t=J(s,"repositionInputs",3,!0),Ge=J(s,"autoFocus",3,!1),gt=J(s,"snapToSequentialPoint",3,!1),at=J(s,"container",3,null),Ue=J(s,"controlledActiveSnapPoint",3,!1),Fe=J(s,"modal",3,!0),Ce=Gt(s,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const He=bE({open:be.with(()=>g(),mt=>{Je()?yt(g()):(g(mt),yt(mt))}),closeThreshold:be.with(()=>I()),scrollLockTimeout:be.with(()=>E()),snapPoints:be.with(()=>s.snapPoints),fadeFromIndex:be.with(()=>w()),backgroundColor:be.with(()=>c()),nested:be.with(()=>U()),shouldScaleBackground:be.with(()=>q()),activeSnapPoint:be.with(()=>K(),mt=>{Ue()||K(mt),V()(mt)}),onRelease:be.with(()=>N()),onDrag:be.with(()=>ie()),onClose:be.with(()=>te()),dismissible:be.with(()=>oe()),direction:be.with(()=>ue()),fixed:be.with(()=>ye()),modal:be.with(()=>Fe()),handleOnly:be.with(()=>pe()),noBodyStyles:be.with(()=>Ae()),preventScrollRestoration:be.with(()=>ze()),setBackgroundColorOnScale:be.with(()=>Me()),repositionInputs:be.with(()=>_t()),autoFocus:be.with(()=>Ge()),snapToSequentialPoint:be.with(()=>gt()),container:be.with(()=>at())});let st;function yt(mt){var Rt;(Rt=v())==null||Rt(mt),mt&&!U()?st=document.body.style.cssText:!mt&&!U()&&Np(Ji.DURATION*1e3,()=>{document.body.style.cssText=st}),!mt&&!U()&&He.positionFixedState.restorePositionSetting(),setTimeout(()=>{var jt;(jt=je())==null||jt(mt)},Ji.DURATION*1e3),mt&&!Fe()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),mt||(document.body.style.pointerEvents="auto")}At(()=>()=>{U()||(document.body.style.cssText=st)});var xt=Ke(),ht=Ne(xt);Yt(ht,()=>kC,(mt,Rt)=>{Rt(mt,ri({controlledOpen:!0,get open(){return He.open.current},onOpenChange:jt=>{He.onDialogOpenChange(jt),yt(jt)}},()=>Ce))}),Te(f,xt),kt()}function dw(f,s){Et(s,!0),nb(()=>(s.onMounted(!0),()=>{s.onMounted(!1)})),kt()}class AE{constructor(s=0){Oe(this,"value",0);this.value=s}}const CE=new AE(0);function pw(){return`vaul-${CE.value++}`}var EE=Vt("<!> <!>",1);function kE(f,s){Et(s,!0);let g=J(s,"id",19,pw),v=J(s,"ref",15,null),I=J(s,"onOpenAutoFocus",3,gr),E=J(s,"onInteractOutside",3,gr),w=J(s,"oncontextmenu",3,gr),c=J(s,"onpointerdown",3,gr),U=J(s,"onpointerup",3,gr),q=J(s,"onpointerout",3,gr),K=J(s,"onpointermove",3,gr),V=J(s,"preventScroll",3,!0),N=Gt(s,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const ie=wE({id:be.with(()=>g()),ref:be.with(()=>v(),ye=>v(ye)),onContextMenu:be.with(()=>w()??gr),onInteractOutside:be.with(()=>E()),onPointerDown:be.with(()=>c()??gr),onPointerMove:be.with(()=>K()??gr),onPointerOut:be.with(()=>q()??gr),onPointerUp:be.with(()=>U()??gr),onOpenAutoFocus:be.with(()=>I())}),te=Pe(()=>Pi(N,ie.props));var oe=Ke(),ue=Ne(oe);Yt(ue,()=>DC,(ye,pe)=>{pe(ye,ri(()=>R(te),{get preventScroll(){return V()},get onInteractOutside(){return ie.onInteractOutside},get onFocusOutside(){return ie.onFocusOutside},get onOpenAutoFocus(){return ie.onOpenAutoFocus},children:(Ae,ze)=>{var Me=EE(),je=Ne(Me);Ct(je,()=>s.children??Xt);var Je=Ci(je,2);dw(Je,{onMounted:_t=>ie.mounted=_t}),Te(Ae,Me)},$$slots:{default:!0}}))}),Te(f,oe),kt()}var ME=Vt("<!> <!>",1);function zE(f,s){Et(s,!0);let g=J(s,"id",19,pw),v=J(s,"ref",15,null),I=Gt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const E=SE({id:be.with(()=>g()),ref:be.with(()=>v(),q=>v(q))}),w=Pe(()=>Pi(I,E.props));var c=Ke(),U=Ne(c);Yt(U,()=>eI,(q,K)=>{K(q,ri({get ref(){return v()},set ref(V){v(V)}},()=>R(w),{children:(V,N)=>{var ie=ME(),te=Ne(ie);dw(te,{onMounted:ue=>{E.mounted=ue}});var oe=Ci(te,2);Ct(oe,()=>s.children??Xt),Te(V,ie)},$$slots:{default:!0}}))}),Te(f,c),kt()}function DE(f,s){Et(s,!0);const g=PE();let v=J(s,"to",19,()=>g.props.to),I=Gt(s,["$$slots","$$events","$$legacy","to"]);var E=Ke(),w=Ne(E);Yt(w,()=>kb,(c,U)=>{U(c,ri({get to(){return v()}},()=>I))}),Te(f,E),kt()}const RE=ST,LE=iI;function OE(f,s){let g=J(s,"shouldScaleBackground",3,!0),v=J(s,"open",15,!1),I=J(s,"activeSnapPoint",15,null),E=Gt(s,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var w=Ke(),c=Ne(w);Yt(c,()=>IE,(U,q)=>{q(U,ri({get shouldScaleBackground(){return g()},get open(){return v()},set open(K){v(K)},get activeSnapPoint(){return I()},set activeSnapPoint(K){I(K)}},()=>E))}),Te(f,w)}function FE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("fixed inset-0 z-50 bg-black/80",s.class));Yt(E,()=>zE,(c,U)=>{U(c,ri({get ref(){return g()},set ref(q){g(q)},get class(){return R(w)}},()=>v))}),Te(f,I),kt()}var BE=Vt('<div class="bg-muted mx-auto mt-4 h-2 w-[100px] rounded-full"></div> <!>',1),NE=Vt("<!> <!>",1);function VE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var I=Ke(),E=Ne(I);Yt(E,()=>DE,(w,c)=>{c(w,ri(()=>s.portalProps,{children:(U,q)=>{var K=NE(),V=Ne(K);FE(V,{});var N=Ci(V,2),ie=Pe(()=>Tr("bg-background fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border",s.class));Yt(N,()=>kE,(te,oe)=>{oe(te,ri({get ref(){return g()},set ref(ue){g(ue)},get class(){return R(ie)}},()=>v,{children:(ue,ye)=>{var pe=BE(),Ae=Ci(Ne(pe),2);Ct(Ae,()=>s.children??Xt),Te(ue,pe)},$$slots:{default:!0}}))}),Te(U,K)},$$slots:{default:!0}}))}),Te(f,I),kt()}function jE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("text-muted-foreground text-sm",s.class));Yt(E,()=>LE,(c,U)=>{U(c,ri({get ref(){return g()},set ref(q){g(q)},get class(){return R(w)}},()=>v))}),Te(f,I),kt()}var UE=Vt("<div><!></div>");function qE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var I=UE();let E;var w=ci(I);Ct(w,()=>s.children??Xt),ui(I),tm(I,c=>g(c),()=>g()),di(()=>E=Oi(I,E,{class:Tr("grid gap-1.5 p-4 text-center sm:text-left",s.class),...v})),Te(f,I),kt()}function ZE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=Gt(s,["$$slots","$$events","$$legacy","ref","class"]);var I=Ke(),E=Ne(I),w=Pe(()=>Tr("text-lg font-semibold leading-none tracking-tight",s.class));Yt(E,()=>RE,(c,U)=>{U(c,ri({get ref(){return g()},set ref(q){g(q)},get class(){return R(w)}},()=>v))}),Te(f,I),kt()}function GE(f,s){Et(s,!0);let g=J(s,"ref",15,null),v=J(s,"sideOffset",3,4),I=J(s,"align",3,"center"),E=Gt(s,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var w=Ke(),c=Ne(w);Yt(c,()=>kb,(U,q)=>{q(U,ri(()=>s.portalProps,{children:(K,V)=>{var N=Ke(),ie=Ne(N),te=Pe(()=>Tr("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 rounded-md border p-4 shadow-md outline-none",s.class));Yt(ie,()=>AC,(oe,ue)=>{ue(oe,ri({get ref(){return g()},set ref(ye){g(ye)},get sideOffset(){return v()},get align(){return I()},get class(){return R(te)}},()=>E))}),Te(K,N)},$$slots:{default:!0}}))}),Te(f,w),kt()}const HE=RC,WE=EC;var em={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var XE=em.exports,J0;function KE(){return J0||(J0=1,function(f,s){(function(g,v){f.exports=v()})(XE,function(){var g={},v={};function I(w,c,U){if(v[w]=U,w==="index"){var q="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",K={};return v.shared(K),v.index(g,K),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([q],{type:"text/javascript"}))),g}}I("shared",["exports"],function(w){function c(i,t,r,o){return new(r||(r=Promise))(function(u,p){function m(P){try{x(o.next(P))}catch(A){p(A)}}function _(P){try{x(o.throw(P))}catch(A){p(A)}}function x(P){var A;P.done?u(P.value):(A=P.value,A instanceof r?A:new r(function(k){k(A)})).then(m,_)}x((o=o.apply(i,t||[])).next())})}function U(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var q=K;function K(i,t){this.x=i,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),o=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,t){var r=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(i){return i instanceof K?i:Array.isArray(i)?new K(i[0],i[1]):i};var V=U(q),N=ie;function ie(i,t,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=o}ie.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=u/p}var m=0,_=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));o++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var te=U(N);let oe,ue;function ye(){return oe==null&&(oe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),oe}function pe(){if(ue==null&&(ue=!1,ye())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){ue=!0;break}}}return ue||!1}function Ae(i,t,r,o){const u=new te(i,t,r,o);return p=>u.solve(p)}const ze=Ae(.25,.1,.25,1);function Me(i,t,r){return Math.min(r,Math.max(t,i))}function je(i,t,r){const o=r-t,u=((i-t)%o+o)%o+t;return u===t?r:u}function Je(i,...t){for(const r of t)for(const o in r)i[o]=r[o];return i}let _t=1;function Ge(i,t,r){const o={};for(const u in i)o[u]=t.call(this,i[u],u,i);return o}function gt(i,t,r){const o={};for(const u in i)t.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function at(i){return Array.isArray(i)?i.map(at):typeof i=="object"&&i?Ge(i,at):i}const Ue={};function Fe(i){Ue[i]||(typeof console<"u"&&console.warn(i),Ue[i]=!0)}function Ce(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function He(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let st=null;function yt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ht(i,t,r,o,u){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(i,{timestamp:0});try{const m=p==null?void 0:p.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const _=m.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield p.copyTo(x,function(P,A,k,D,F){const j=4*Math.max(-A,0),Z=(Math.max(0,k)-k)*D*4+j,Q=4*D,ne=Math.max(0,A),xe=Math.max(0,k);return{rect:{x:ne,y:xe,width:Math.min(P.width,A+D)-ne,height:Math.min(P.height,k+F)-xe},layout:[{offset:Z,stride:Q}]}}(i,t,r,o,u)),_)for(let P=0;P<x.length;P+=4){const A=x[P];x[P]=x[P+2],x[P+2]=A}return x}finally{p.close()}})}let mt,Rt;const jt="AbortError";function Ti(){return new Error(jt)}const fi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function bi(i){return fi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Hi="global-dispatcher";class Ni extends Error{constructor(t,r,o,u){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=u}}const Vi=()=>He(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,tr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=bi(i.url);if(o)return o(i,t);if(He(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Hi},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Vi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return c(this,void 0,void 0,function*(){const p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Vi(),signal:u.signal});o.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");const m=yield fetch(p);if(!m.ok){const P=yield m.blob();throw new Ni(m.status,m.statusText,o.url,P)}let _;_=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const x=yield _;if(u.signal.aborted)throw Ti();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(He(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Hi},t)}var r;return function(o,u){return new Promise((p,m)=>{var _;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const P in o.headers)x.setRequestHeader(P,o.headers[P]);o.type==="json"&&(x.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let P=x.response;if(o.type==="json")try{P=JSON.parse(x.response)}catch(A){return void m(A)}p({data:P,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const P=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new Ni(x.status,x.statusText,o.url,P))}},u.signal.addEventListener("abort",()=>{x.abort(),m(Ti())}),x.send(o.body)})}(i,t)};function Fr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Qi(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function sr(i,t,r){if(r&&r[i]){const o=r[i].indexOf(t);o!==-1&&r[i].splice(o,1)}}class ar{constructor(t,r={}){Je(this,r),this.type=t}}class vt extends ar{constructor(t,r={}){super("error",Je({error:t},r))}}class Lt{on(t,r){return this._listeners=this._listeners||{},Qi(t,r,this._listeners),this}off(t,r){return sr(t,r,this._listeners),sr(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Qi(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new ar(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,t);const p=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of p)sr(o,_,this._oneTimeListeners),_.call(this,t);const m=this._eventedParent;m&&(Je(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof vt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ji=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ir(i,t){const r={};for(const o in i)o!=="ref"&&(r[o]=i[o]);return ji.forEach(o=>{o in t&&(r[o]=t[o])}),r}function Jt(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Jt(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Jt(i[r],t[r]))return!1;return!0}return i===t}function wi(i,t){i.push(t)}function kn(i,t,r){wi(r,{command:"addSource",args:[i,t[i]]})}function Kr(i,t,r){wi(t,{command:"removeSource",args:[i]}),r[i]=!0}function Br(i,t,r,o){Kr(i,r,o),kn(i,t,r)}function qn(i,t,r){let o;for(o in i[r])if(Object.prototype.hasOwnProperty.call(i[r],o)&&o!=="data"&&!Jt(i[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!Jt(i[r][o],t[r][o]))return!1;return!0}function Ar(i,t,r,o,u,p){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Jt(i[m],t[m])||r.push({command:p,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Jt(i[m],t[m])||r.push({command:p,args:[o,m,t[m],u]}))}function es(i){return i.id}function ws(i,t){return i[t.id]=t,i}class Xe{constructor(t,r,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function Mn(i,...t){for(const r of t)for(const o in r)i[o]=r[o];return i}class Cr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class zn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(t){return new zn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ts={kind:"null"},tt={kind:"number"},Ht={kind:"string"},Ot={kind:"boolean"},Nr={kind:"color"},fn={kind:"object"},Ut={kind:"value"},Dn={kind:"collator"},Zn={kind:"formatted"},is={kind:"padding"},Rn={kind:"resolvedImage"},re={kind:"variableAnchorOffsetCollection"};function O(i,t){return{kind:"array",itemType:i,N:t}}function L(i){if(i.kind==="array"){const t=L(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const H=[ts,tt,Ht,Ot,Nr,Zn,fn,O(Ut),is,Rn,re];function $(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!$(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of H)if(!$(r,t))return null}}return`Expected ${L(i)} but found ${L(t)} instead.`}function de(i,t){return t.some(r=>r.kind===i.kind)}function me(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ve(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const le=.96422,ke=.82521,Be=4/29,Ie=6/29,Qe=3*Ie*Ie,It=Ie*Ie*Ie,Mt=Math.PI/180,ni=180/Math.PI;function qt(i){return(i%=360)<0&&(i+=360),i}function si([i,t,r,o]){let u,p;const m=ir((.2225045*(i=Qt(i))+.7168786*(t=Qt(t))+.0606169*(r=Qt(r)))/1);i===t&&t===r?u=p=m:(u=ir((.4360747*i+.3850649*t+.1430804*r)/le),p=ir((.0139322*i+.0971045*t+.7141733*r)/ke));const _=116*m-16;return[_<0?0:_,500*(u-m),200*(m-p),o]}function Qt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ir(i){return i>It?Math.pow(i,1/3):i/Qe+Be}function Ui([i,t,r,o]){let u=(i+16)/116,p=isNaN(t)?u:u+t/500,m=isNaN(r)?u:u-r/200;return u=1*mi(u),p=le*mi(p),m=ke*mi(m),[Wt(3.1338561*p-1.6168667*u-.4906146*m),Wt(-.9787684*p+1.9161415*u+.033454*m),Wt(.0719453*p-.2289914*u+1.4052427*m),o]}function Wt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function mi(i){return i>Ie?i*i*i:Qe*(i-Be)}function Li(i){return parseInt(i.padEnd(2,i),16)/255}function lr(i,t){return dr(t?i/100:i,0,1)}function dr(i,t,r){return Math.min(Math.max(t,i),r)}function Er(i){return!i.some(Number.isNaN)}const eo={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class gi{constructor(t,r,o,u=1,p=!0){this.r=t,this.g=r,this.b=o,this.a=u,p||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,r,o,u]))}static parse(t){if(t instanceof gi)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=eo[o];if(u){const[m,_,x]=u;return[m/255,_/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let _=1;return[Li(o.slice(_,_+=m)),Li(o.slice(_,_+=m)),Li(o.slice(_,_+=m)),Li(o.slice(_,_+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,x,P,A,k,D,F,j,Z,Q,ne,xe]=m,he=[A||" ",F||" ",Q].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const _e=[P,D,Z].join(""),Ee=_e==="%%%"?100:_e===""?255:0;if(Ee){const qe=[dr(+x/Ee,0,1),dr(+k/Ee,0,1),dr(+j/Ee,0,1),ne?lr(+ne,xe):1];if(Er(qe))return qe}}return}}const p=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[m,_,x,P,A,k,D,F,j]=p,Z=[x||" ",A||" ",D].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const Q=[+_,dr(+P,0,100),dr(+k,0,100),F?lr(+F,j):1];if(Er(Q))return function([ne,xe,he,_e]){function Ee(qe){const ct=(qe+ne/30)%12,zt=xe*Math.min(he,1-he);return he-zt*Math.max(-1,Math.min(ct-3,9-ct,1))}return ne=qt(ne),xe/=100,he/=100,[Ee(0),Ee(8),Ee(4),_e]}(Q)}}}(t);return r?new gi(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:u}=this,p=u||1/0;return this.overwriteGetter("rgb",[t/p,r/p,o/p,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,u,p]=si(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?qt(Math.atan2(u,o)*ni):NaN,m,r,p]}(this.rgb))}get lab(){return this.overwriteGetter("lab",si(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,u]=this.rgb;return`rgba(${[t,r,o].map(p=>Math.round(255*p)).join(",")},${u})`}}gi.black=new gi(0,0,0,1),gi.white=new gi(1,1,1,1),gi.transparent=new gi(0,0,0,0),gi.red=new gi(1,0,0,1);class Gc{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Hc{constructor(t,r,o,u,p){this.text=t,this.image=r,this.scale=o,this.fontStack=u,this.textColor=p}}class Jr{constructor(t){this.sections=t}static fromString(t){return new Jr([new Hc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Jr?t:Jr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Yr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Yr)return t;if(typeof t=="number")return new Yr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Yr(t)}}toString(){return JSON.stringify(this.values)}}const u_=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class sn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof sn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],u=t[r+1];if(typeof o!="string"||!u_.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new sn(t)}}toString(){return JSON.stringify(this.values)}}class Qr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Qr({name:t,available:!1}):null}}function to(i,t,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,r,o]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ss(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof gi||i instanceof Gc||i instanceof Jr||i instanceof Yr||i instanceof sn||i instanceof Qr)return!0;if(Array.isArray(i)){for(const t of i)if(!Ss(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ss(i[t]))return!1;return!0}return!1}function rr(i){if(i===null)return ts;if(typeof i=="string")return Ht;if(typeof i=="boolean")return Ot;if(typeof i=="number")return tt;if(i instanceof gi)return Nr;if(i instanceof Gc)return Dn;if(i instanceof Jr)return Zn;if(i instanceof Yr)return is;if(i instanceof sn)return re;if(i instanceof Qr)return Rn;if(Array.isArray(i)){const t=i.length;let r;for(const o of i){const u=rr(o);if(r){if(r===u)continue;r=Ut;break}r=u}return O(r||Ut,t)}return fn}function ea(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof gi||i instanceof Jr||i instanceof Yr||i instanceof sn||i instanceof Qr?i.toString():JSON.stringify(i)}class mn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ss(t[1]))return r.error("invalid value");const o=t[1];let u=rr(o);const p=r.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new mn(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class $i{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const qa={string:Ht,number:tt,boolean:Ot,object:fn};class gn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,u=1;const p=t[0];if(p==="array"){let _,x;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in qa)||P==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=qa[P],u++}else _=Ut;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}o=O(_,x)}else{if(!qa[p])throw new Error(`Types doesn't contain name = ${p}`);o=qa[p]}const m=[];for(;u<t.length;u++){const _=r.parse(t[u],u,Ut);if(!_)return null;m.push(_)}return new gn(o,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!$(this.type,rr(o)))return o;if(r===this.args.length-1)throw new $i(`Expected value to be of type ${L(this.type)}, but found ${L(rr(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Wc={"to-boolean":Ot,"to-color":Nr,"to-number":tt,"to-string":Ht};class _n{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Wc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const u=Wc[o],p=[];for(let m=1;m<t.length;m++){const _=r.parse(t[m],m,Ut);if(!_)return null;p.push(_)}return new _n(u,p)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(t),o=null,r instanceof gi)return r;if(typeof r=="string"){const p=t.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:to(r[0],r[1],r[2],r[3]),!o))return new gi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new $i(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const u=Yr.parse(r);if(u)return u}throw new $i(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const u=sn.parse(r);if(u)return u}throw new $i(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new $i(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Jr.fromString(ea(this.args[0].evaluate(t)));case"resolvedImage":return Qr.fromString(ea(this.args[0].evaluate(t)));default:return ea(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const h_=["Unknown","Point","LineString","Polygon"];class Za{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?h_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=gi.parse(t)),r}}class Ps{constructor(t,r,o=[],u,p=new zn,m=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=m,this.expectedType=u,this._isConstant=r}parse(t,r,o,u,p={}){return r?this.concat(r,o,u)._parse(t,p):this._parse(t,p)}_parse(t,r){function o(u,p,m){return m==="assert"?new gn(p,[u]):m==="coerce"?new _n(p,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let m=p.parse(t,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,x=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"assert")}if(!(m instanceof mn)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const _=new Za;try{m=new mn(m.type,m.evaluate(_))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const u=typeof t=="number"?this.path.concat(t):this.path,p=o?this.scope.concat(o):this.scope;return new Ps(this.registry,this._isConstant,u,r||null,p,this.errors)}error(t,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Cr(o,t))}checkSubtype(t,r){const o=$(t,r);return o&&this.error(o),o}}class rs{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let p=1;p<t.length-1;p+=2){const m=t[p];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const _=r.parse(t[p+1],p+1);if(!_)return null;o.push([m,_])}const u=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return u?new rs(o,u):null}outputDefined(){return this.result.outputDefined()}}class li{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new li(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Xc{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,tt),u=r.parse(t[2],2,O(r.expectedType||Ut));return o&&u?new Xc(u.type.itemType,o,u):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new $i(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new $i(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new $i(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Kc{constructor(t,r){this.type=Ot,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ut),u=r.parse(t[2],2,Ut);return o&&u?de(o.type,[Ot,Ht,tt,ts,Ut])?new Kc(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!me(r,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${L(rr(r))} instead.`);if(!me(o,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${L(rr(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class io{constructor(t,r,o){this.type=tt,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ut),u=r.parse(t[2],2,Ut);if(!o||!u)return null;if(!de(o.type,[Ot,Ht,tt,ts,Ut]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(o.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,tt);return p?new io(o,u,p):null}return new io(o,u)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!me(r,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${L(rr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),me(o,["string"])){const p=o.indexOf(r,u);return p===-1?-1:[...o.slice(0,p)].length}if(me(o,["array"]))return o.indexOf(r,u);throw new $i(`Expected second argument to be of type array or string, but found ${L(rr(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Jc{constructor(t,r,o,u,p,m){this.inputType=t,this.type=r,this.input=o,this.cases=u,this.outputs=p,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const p={},m=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const k=t[P+1];Array.isArray(A)||(A=[A]);const D=r.concat(P);if(A.length===0)return D.error("Expected at least one branch label.");for(const j of A){if(typeof j!="number"&&typeof j!="string")return D.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,rr(j)))return null}else o=rr(j);if(p[String(j)]!==void 0)return D.error("Branch labels must be unique.");p[String(j)]=m.length}const F=r.parse(k,P,u);if(!F)return null;u=u||F.type,m.push(F)}const _=r.parse(t[1],1,Ut);if(!_)return null;const x=r.parse(t[t.length-1],t.length-1,u);return x?_.type.kind!=="value"&&r.concat(1).checkSubtype(o,_.type)?null:new Jc(o,u,_,p,m,x):null}evaluate(t){const r=this.input.evaluate(t);return(rr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ga{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const _=r.parse(t[m],m,Ot);if(!_)return null;const x=r.parse(t[m+1],m+1,o);if(!x)return null;u.push([_,x]),o=o||x.type}const p=r.parse(t[t.length-1],t.length-1,o);if(!p)return null;if(!o)throw new Error("Can't infer output type");return new Ga(o,u,p)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ta{constructor(t,r,o,u){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ut),u=r.parse(t[2],2,tt);if(!o||!u)return null;if(!de(o.type,[O(Ut),Ht,Ut]))return r.error(`Expected first argument to be of type array or string, but found ${L(o.type)} instead`);if(t.length===4){const p=r.parse(t[3],3,tt);return p?new ta(o.type,o,u,p):null}return new ta(o.type,o,u)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),me(r,["string"]))return[...r].slice(o,u).join("");if(me(r,["array"]))return r.slice(o,u);throw new $i(`Expected first argument to be of type array or string, but found ${L(rr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ha(i,t){const r=i.length-1;let o,u,p=0,m=r,_=0;for(;p<=m;)if(_=Math.floor((p+m)/2),o=i[_],u=i[_+1],o<=t){if(_===r||t<u)return _;p=_+1}else{if(!(o>t))throw new $i("Input is not a number.");m=_-1}return 0}class ro{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[u,p]of o)this.labels.push(u),this.outputs.push(p)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,tt);if(!o)return null;const u=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let m=1;m<t.length;m+=2){const _=m===1?-1/0:t[m],x=t[m+1],P=m,A=m+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const k=r.parse(x,A,p);if(!k)return null;p=p||k.type,u.push([_,k])}return new ro(p,o,u)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const p=r.length;return u>=r[p-1]?o[p-1].evaluate(t):o[Ha(r,u)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Zp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var d_=Gp;function Gp(i,t,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=o}Gp.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var p=this.sampleCurveDerivativeX(r);if(Math.abs(p)<1e-6)break;r-=u/p}var m=0,_=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));o++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var p_=Zp(d_);function Ts(i,t,r){return i+r*(t-i)}function ia(i,t,r){return i.map((o,u)=>Ts(o,t[u],r))}const Vr={number:Ts,color:function(i,t,r,o="rgb"){switch(o){case"rgb":{const[u,p,m,_]=ia(i.rgb,t.rgb,r);return new gi(u,p,m,_,!1)}case"hcl":{const[u,p,m,_]=i.hcl,[x,P,A,k]=t.hcl;let D,F;if(isNaN(u)||isNaN(x))isNaN(u)?isNaN(x)?D=NaN:(D=x,m!==1&&m!==0||(F=P)):(D=u,A!==1&&A!==0||(F=p));else{let xe=x-u;x>u&&xe>180?xe-=360:x<u&&u-x>180&&(xe+=360),D=u+r*xe}const[j,Z,Q,ne]=function([xe,he,_e,Ee]){return xe=isNaN(xe)?0:xe*Mt,Ui([_e,Math.cos(xe)*he,Math.sin(xe)*he,Ee])}([D,F??Ts(p,P,r),Ts(m,A,r),Ts(_,k,r)]);return new gi(j,Z,Q,ne,!1)}case"lab":{const[u,p,m,_]=Ui(ia(i.lab,t.lab,r));return new gi(u,p,m,_,!1)}}},array:ia,padding:function(i,t,r){return new Yr(ia(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const o=i.values,u=t.values;if(o.length!==u.length)throw new $i(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const p=[];for(let m=0;m<o.length;m+=2){if(o[m]!==u[m])throw new $i(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${o[m]}, to[${m}]: ${u[m]}`);p.push(o[m]);const[_,x]=o[m+1],[P,A]=u[m+1];p.push([Ts(_,P,r),Ts(x,A,r)])}return new sn(p)}};class jr{constructor(t,r,o,u,p){this.type=t,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of p)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(t,r,o,u){let p=0;if(t.name==="exponential")p=Wa(r,t.base,o,u);else if(t.name==="linear")p=Wa(r,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;p=new p_(m[0],m[1],m[2],m[3]).solve(Wa(r,1,o,u))}return p}static parse(t,r){let[o,u,p,...m]=t;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const P=u[1];if(typeof P!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:P}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const P=u.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,tt),!p)return null;const _=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Nr:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let P=0;P<m.length;P+=2){const A=m[P],k=m[P+1],D=P+3,F=P+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const j=r.parse(k,F,x);if(!j)return null;x=x||j.type,_.push([A,j])}return ve(x,tt)||ve(x,Nr)||ve(x,is)||ve(x,re)||ve(x,O(tt))?new jr(x,o,u,p,_):r.error(`Type ${L(x)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const p=r.length;if(u>=r[p-1])return o[p-1].evaluate(t);const m=Ha(r,u),_=jr.interpolationFactor(this.interpolation,u,r[m],r[m+1]),x=o[m].evaluate(t),P=o[m+1].evaluate(t);switch(this.operator){case"interpolate":return Vr[this.type.kind](x,P,_);case"interpolate-hcl":return Vr.color(x,P,_,"hcl");case"interpolate-lab":return Vr.color(x,P,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Wa(i,t,r,o){const u=o-r,p=i-r;return u===0?0:t===1?p/u:(Math.pow(t,p)-1)/(Math.pow(t,u)-1)}class Xa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const p=[];for(const _ of t.slice(1)){const x=r.parse(_,1+p.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,p.push(x)}if(!o)throw new Error("No output type");const m=u&&p.some(_=>$(u,_.type));return new Xa(m?Ut:o,p)}evaluate(t){let r,o=null,u=0;for(const p of this.args)if(u++,o=p.evaluate(t),o&&o instanceof Qr&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Ka(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Hp(i,t,r,o){return o.compare(t,r)===0}function no(i,t,r){const o=i!=="=="&&i!=="!=";return class fw{constructor(p,m,_){this.type=Ot,this.lhs=p,this.rhs=m,this.collator=_,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const _=p[0];let x=m.parse(p[1],1,Ut);if(!x)return null;if(!Ka(_,x.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${L(x.type)}'.`);let P=m.parse(p[2],2,Ut);if(!P)return null;if(!Ka(_,P.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${L(P.type)}'.`);if(x.type.kind!==P.type.kind&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${L(x.type)}' and '${L(P.type)}'.`);o&&(x.type.kind==="value"&&P.type.kind!=="value"?x=new gn(P.type,[x]):x.type.kind!=="value"&&P.type.kind==="value"&&(P=new gn(x.type,[P])));let A=null;if(p.length===4){if(x.type.kind!=="string"&&P.type.kind!=="string"&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(p[3],3,Dn),!A)return null}return new fw(x,P,A)}evaluate(p){const m=this.lhs.evaluate(p),_=this.rhs.evaluate(p);if(o&&this.hasUntypedArgument){const x=rr(m),P=rr(_);if(x.kind!==P.kind||x.kind!=="string"&&x.kind!=="number")throw new $i(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=rr(m),P=rr(_);if(x.kind!=="string"||P.kind!=="string")return t(p,m,_)}return this.collator?r(p,m,_,this.collator.evaluate(p)):t(p,m,_)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const f_=no("==",function(i,t,r){return t===r},Hp),Wp=no("!=",function(i,t,r){return t!==r},function(i,t,r,o){return!Hp(0,t,r,o)}),Xp=no("<",function(i,t,r){return t<r},function(i,t,r,o){return o.compare(t,r)<0}),m_=no(">",function(i,t,r){return t>r},function(i,t,r,o){return o.compare(t,r)>0}),g_=no("<=",function(i,t,r){return t<=r},function(i,t,r,o){return o.compare(t,r)<=0}),Kp=no(">=",function(i,t,r){return t>=r},function(i,t,r,o){return o.compare(t,r)>=0});class ra{constructor(t,r,o){this.type=Dn,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ot);if(!u)return null;const p=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ot);if(!p)return null;let m=null;return o.locale&&(m=r.parse(o.locale,1,Ht),!m)?null:new ra(u,p,m)}evaluate(t){return new Gc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Yc{constructor(t,r,o,u,p){this.type=Ht,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,tt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=r.parse(u.locale,1,Ht),!p))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,Ht),!m))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,tt),!_))return null;let x=null;return u["max-fraction-digits"]&&(x=r.parse(u["max-fraction-digits"],1,tt),!x)?null:new Yc(o,p,m,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Ja{constructor(t){this.type=Zn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=t.length-1;++m){const _=t[m];if(p&&typeof _=="object"&&!Array.isArray(_)){p=!1;let x=null;if(_["font-scale"]&&(x=r.parse(_["font-scale"],1,tt),!x))return null;let P=null;if(_["text-font"]&&(P=r.parse(_["text-font"],1,O(Ht)),!P))return null;let A=null;if(_["text-color"]&&(A=r.parse(_["text-color"],1,Nr),!A))return null;const k=u[u.length-1];k.scale=x,k.font=P,k.textColor=A}else{const x=r.parse(t[m],1,Ut);if(!x)return null;const P=x.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new Ja(u)}evaluate(t){return new Jr(this.sections.map(r=>{const o=r.content.evaluate(t);return rr(o)===Rn?new Hc("",o,null,null,null):new Hc(ea(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Qc{constructor(t){this.type=Rn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ht);return o?new Qc(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=Qr.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class $c{constructor(t){this.type=tt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${L(o.type)} instead.`):new $c(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new $i(`Expected value to be of type string or array, but found ${L(rr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ln=8192;function __(i,t){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(r*u*Ln),Math.round(o*u*Ln)]}function eu(i,t){const r=Math.pow(2,t.z);return[(u=(i[0]/Ln+t.x)/r,360*u-180),(o=(i[1]/Ln+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Is(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ns(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function pi(i,t,r){const o=i[0]-t[0],u=i[1]-t[1],p=i[0]-r[0],m=i[1]-r[1];return o*m-p*u==0&&o*p<=0&&u*m<=0}function Ya(i,t,r,o){return(u=[o[0]-r[0],o[1]-r[1]])[0]*(p=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*p[0]!=0&&!(!Yp(i,t,r,o)||!Yp(r,o,i,t));var u,p}function y_(i,t,r){for(const o of r)for(let u=0;u<o.length-1;++u)if(Ya(i,t,o[u],o[u+1]))return!0;return!1}function so(i,t,r=!1){let o=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(pi(i,_[x],_[x+1]))return r;(p=_[x])[1]>(u=i)[1]!=(m=_[x+1])[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(o=!o)}var u,p,m;return o}function v_(i,t){for(const r of t)if(so(i,r))return!0;return!1}function Jp(i,t){for(const r of i)if(!so(r,t))return!1;for(let r=0;r<i.length-1;++r)if(y_(i[r],i[r+1],t))return!1;return!0}function x_(i,t){for(const r of t)if(Jp(i,r))return!0;return!1}function Yp(i,t,r,o){const u=o[0]-r[0],p=o[1]-r[1],m=(i[0]-r[0])*p-u*(i[1]-r[1]),_=(t[0]-r[0])*p-u*(t[1]-r[1]);return m>0&&_<0||m<0&&_>0}function tu(i,t,r){const o=[];for(let u=0;u<i.length;u++){const p=[];for(let m=0;m<i[u].length;m++){const _=__(i[u][m],r);Is(t,_),p.push(_)}o.push(p)}return o}function Qp(i,t,r){const o=[];for(let u=0;u<i.length;u++){const p=tu(i[u],t,r);o.push(p)}return o}function $p(i,t,r,o){if(i[0]<r[0]||i[0]>r[2]){const u=.5*o;let p=i[0]-r[0]>u?-o:r[0]-i[0]>u?o:0;p===0&&(p=i[0]-r[2]>u?-o:r[2]-i[0]>u?o:0),i[0]+=p}Is(t,i)}function ef(i,t,r,o){const u=Math.pow(2,o.z)*Ln,p=[o.x*Ln,o.y*Ln],m=[];for(const _ of i)for(const x of _){const P=[x.x+p[0],x.y+p[1]];$p(P,t,r,u),m.push(P)}return m}function tf(i,t,r,o){const u=Math.pow(2,o.z)*Ln,p=[o.x*Ln,o.y*Ln],m=[];for(const x of i){const P=[];for(const A of x){const k=[A.x+p[0],A.y+p[1]];Is(t,k),P.push(k)}m.push(P)}if(t[2]-t[0]<=u/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of m)for(const P of x)$p(P,t,r,u)}var _;return m}class As{constructor(t,r){this.type=Ot,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ss(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const p of o.features){const{type:m,coordinates:_}=p.geometry;m==="Polygon"&&u.push(_),m==="MultiPolygon"&&u.push(..._)}if(u.length)return new As(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new As(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new As(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=tu(o.coordinates,p,m),x=ef(r.geometry(),u,p,m);if(!ns(u,p))return!1;for(const P of x)if(!so(P,_))return!1}if(o.type==="MultiPolygon"){const _=Qp(o.coordinates,p,m),x=ef(r.geometry(),u,p,m);if(!ns(u,p))return!1;for(const P of x)if(!v_(P,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=tu(o.coordinates,p,m),x=tf(r.geometry(),u,p,m);if(!ns(u,p))return!1;for(const P of x)if(!Jp(P,_))return!1}if(o.type==="MultiPolygon"){const _=Qp(o.coordinates,p,m),x=tf(r.geometry(),u,p,m);if(!ns(u,p))return!1;for(const P of x)if(!x_(P,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let rf=class{constructor(i=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,o=t[i];for(;i>0;){const u=i-1>>1,p=t[u];if(r(o,p)>=0)break;t[i]=p,i=u}t[i]=o}_down(i){const{data:t,compare:r}=this,o=this.length>>1,u=t[i];for(;i<o;){let p=1+(i<<1);const m=p+1;if(m<this.length&&r(t[m],t[p])<0&&(p=m),r(t[p],u)>=0)break;t[i]=t[p],i=p}t[i]=u}};function b_(i,t,r,o,u){nf(i,t,r,o||i.length-1,u||w_)}function nf(i,t,r,o,u){for(;o>r;){if(o-r>600){var p=o-r+1,m=t-r+1,_=Math.log(p),x=.5*Math.exp(2*_/3),P=.5*Math.sqrt(_*x*(p-x)/p)*(m-p/2<0?-1:1);nf(i,t,Math.max(r,Math.floor(t-m*x/p+P)),Math.min(o,Math.floor(t+(p-m)*x/p+P)),u)}var A=i[t],k=r,D=o;for(na(i,r,t),u(i[o],A)>0&&na(i,r,o);k<D;){for(na(i,k,D),k++,D--;u(i[k],A)<0;)k++;for(;u(i[D],A)>0;)D--}u(i[r],A)===0?na(i,r,D):na(i,++D,o),D<=t&&(r=D+1),t<=D&&(o=D-1)}}function na(i,t,r){var o=i[t];i[t]=i[r],i[r]=o}function w_(i,t){return i<t?-1:i>t?1:0}function Qa(i,t){if(i.length<=1)return[i];const r=[];let o,u;for(const p of i){const m=P_(p);m!==0&&(p.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&r.push(o),o=[p]):o.push(p))}if(o&&r.push(o),t>1)for(let p=0;p<r.length;p++)r[p].length<=t||(b_(r[p],t,1,r[p].length-1,S_),r[p]=r[p].slice(0,t));return r}function S_(i,t){return t.area-i.area}function P_(i){let t=0;for(let r,o,u=0,p=i.length,m=p-1;u<p;m=u++)r=i[u],o=i[m],t+=(o.x-r.x)*(r.y+o.y);return t}const sf=1/298.257223563,of=sf*(2-sf),af=Math.PI/180;class iu{constructor(t){const r=6378.137*af*1e3,o=Math.cos(t*af),u=1/(1-of*(1-o*o)),p=Math.sqrt(u);this.kx=r*p*o,this.ky=r*p*u*(1-of)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,u=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,r){let o,u,p,m,_=1/0;for(let x=0;x<t.length-1;x++){let P=t[x][0],A=t[x][1],k=this.wrap(t[x+1][0]-P)*this.kx,D=(t[x+1][1]-A)*this.ky,F=0;k===0&&D===0||(F=(this.wrap(r[0]-P)*this.kx*k+(r[1]-A)*this.ky*D)/(k*k+D*D),F>1?(P=t[x+1][0],A=t[x+1][1]):F>0&&(P+=k/this.kx*F,A+=D/this.ky*F)),k=this.wrap(r[0]-P)*this.kx,D=(r[1]-A)*this.ky;const j=k*k+D*D;j<_&&(_=j,o=P,u=A,p=x,m=F)}return{point:[o,u],index:p,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function lf(i,t){return t[0]-i[0]}function $a(i){return i[1]-i[0]+1}function Gn(i,t){return i[1]>=i[0]&&i[1]<t}function ru(i,t){if(i[0]>i[1])return[null,null];const r=$a(i);if(t){if(r===2)return[i,null];const u=Math.floor(r/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(r===1)return[i,null];const o=Math.floor(r/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function nu(i,t){if(!Gn(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Is(r,i[o]);return r}function su(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const o of r)Is(t,o);return t}function el(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ou(i,t,r){if(!el(i)||!el(t))return NaN;let o=0,u=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),r.distance([0,0],[o,u])}function Cs(i,t,r){const o=r.pointOnLine(t,i);return r.distance(i,o.point)}function au(i,t,r,o,u){const p=Math.min(Cs(i,[r,o],u),Cs(t,[r,o],u)),m=Math.min(Cs(r,[i,t],u),Cs(o,[i,t],u));return Math.min(p,m)}function T_(i,t,r,o,u){if(!Gn(t,i.length)||!Gn(o,r.length))return 1/0;let p=1/0;for(let m=t[0];m<t[1];++m){const _=i[m],x=i[m+1];for(let P=o[0];P<o[1];++P){const A=r[P],k=r[P+1];if(Ya(_,x,A,k))return 0;p=Math.min(p,au(_,x,A,k,u))}}return p}function Wi(i,t,r,o,u){if(!Gn(t,i.length)||!Gn(o,r.length))return NaN;let p=1/0;for(let m=t[0];m<=t[1];++m)for(let _=o[0];_<=o[1];++_)if(p=Math.min(p,u.distance(i[m],r[_])),p===0)return p;return p}function I_(i,t,r){if(so(i,t,!0))return 0;let o=1/0;for(const u of t){const p=u[0],m=u[u.length-1];if(p!==m&&(o=Math.min(o,Cs(i,[m,p],r)),o===0))return o;const _=r.pointOnLine(u,i);if(o=Math.min(o,r.distance(i,_.point)),o===0)return o}return o}function Kt(i,t,r,o){if(!Gn(t,i.length))return NaN;for(let p=t[0];p<=t[1];++p)if(so(i[p],r,!0))return 0;let u=1/0;for(let p=t[0];p<t[1];++p){const m=i[p],_=i[p+1];for(const x of r)for(let P=0,A=x.length,k=A-1;P<A;k=P++){const D=x[k],F=x[P];if(Ya(m,_,D,F))return 0;u=Math.min(u,au(m,_,D,F,o))}}return u}function tl(i,t){for(const r of i)for(const o of r)if(so(o,t,!0))return!0;return!1}function Ii(i,t,r,o=1/0){const u=su(i),p=su(t);if(o!==1/0&&ou(u,p,r)>=o)return o;if(ns(u,p)){if(tl(i,t))return 0}else if(tl(t,i))return 0;let m=1/0;for(const _ of i)for(let x=0,P=_.length,A=P-1;x<P;A=x++){const k=_[A],D=_[x];for(const F of t)for(let j=0,Z=F.length,Q=Z-1;j<Z;Q=j++){const ne=F[Q],xe=F[j];if(Ya(k,D,ne,xe))return 0;m=Math.min(m,au(k,D,ne,xe,r))}}return m}function _i(i,t,r,o,u,p){if(!p)return;const m=ou(nu(o,p),u,r);m<t&&i.push([m,p,[0,0]])}function Es(i,t,r,o,u,p,m){if(!p||!m)return;const _=ou(nu(o,p),nu(u,m),r);_<t&&i.push([_,p,m])}function sa(i,t,r,o,u=1/0){let p=Math.min(o.distance(i[0],r[0][0]),u);if(p===0)return p;const m=new rf([[0,[0,i.length-1],[0,0]]],lf),_=su(r);for(;m.length>0;){const x=m.pop();if(x[0]>=p)continue;const P=x[1],A=t?50:100;if($a(P)<=A){if(!Gn(P,i.length))return NaN;if(t){const k=Kt(i,P,r,o);if(isNaN(k)||k===0)return k;p=Math.min(p,k)}else for(let k=P[0];k<=P[1];++k){const D=I_(i[k],r,o);if(p=Math.min(p,D),p===0)return 0}}else{const k=ru(P,t);_i(m,p,o,i,_,k[0]),_i(m,p,o,i,_,k[1])}}return p}function oa(i,t,r,o,u,p=1/0){let m=Math.min(p,u.distance(i[0],r[0]));if(m===0)return m;const _=new rf([[0,[0,i.length-1],[0,r.length-1]]],lf);for(;_.length>0;){const x=_.pop();if(x[0]>=m)continue;const P=x[1],A=x[2],k=t?50:100,D=o?50:100;if($a(P)<=k&&$a(A)<=D){if(!Gn(P,i.length)&&Gn(A,r.length))return NaN;let F;if(t&&o)F=T_(i,P,r,A,u),m=Math.min(m,F);else if(t&&!o){const j=i.slice(P[0],P[1]+1);for(let Z=A[0];Z<=A[1];++Z)if(F=Cs(r[Z],j,u),m=Math.min(m,F),m===0)return m}else if(!t&&o){const j=r.slice(A[0],A[1]+1);for(let Z=P[0];Z<=P[1];++Z)if(F=Cs(i[Z],j,u),m=Math.min(m,F),m===0)return m}else F=Wi(i,P,r,A,u),m=Math.min(m,F)}else{const F=ru(P,t),j=ru(A,o);Es(_,m,u,i,r,F[0],j[0]),Es(_,m,u,i,r,F[0],j[1]),Es(_,m,u,i,r,F[1],j[0]),Es(_,m,u,i,r,F[1],j[1])}}return m}function lu(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class ks{constructor(t,r){this.type=tt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ss(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new ks(o,o.features.map(u=>lu(u.geometry)).flat());if(o.type==="Feature")return new ks(o,lu(o.geometry));if("type"in o&&"coordinates"in o)return new ks(o,lu(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=r.geometry(),p=u.flat().map(x=>eu([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new iu(p[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,oa(p,!1,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,oa(p,!1,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,sa(p,!1,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=r.geometry(),p=u.flat().map(x=>eu([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new iu(p[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,oa(p,!0,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,oa(p,!0,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,sa(p,!0,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const p=Qa(u,0).map(x=>x.map(P=>P.map(A=>eu([A.x,A.y],r.canonical)))),m=new iu(p[0][0][0][1]);let _=1/0;for(const x of o)for(const P of p){switch(x.type){case"Point":_=Math.min(_,sa([x.coordinates],!1,P,m,_));break;case"LineString":_=Math.min(_,sa(x.coordinates,!0,P,m,_));break;case"Polygon":_=Math.min(_,Ii(P,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const oo={"==":f_,"!=":Wp,">":m_,"<":Xp,">=":Kp,"<=":g_,array:gn,at:Xc,boolean:gn,case:Ga,coalesce:Xa,collator:ra,format:Ja,image:Qc,in:Kc,"index-of":io,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:$c,let:rs,literal:mn,match:Jc,number:gn,"number-format":Yc,object:gn,slice:ta,step:ro,string:gn,"to-boolean":_n,"to-color":_n,"to-number":_n,"to-string":_n,var:li,within:As,distance:ks};class on{constructor(t,r,o,u){this.name=t,this.type=r,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],u=on.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=m.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let x=null;for(const[P,A]of _){x=new Ps(r.registry,aa,r.path,null,r.scope);const k=[];let D=!1;for(let F=1;F<t.length;F++){const j=t[F],Z=Array.isArray(P)?P[F-1]:P.type,Q=x.parse(j,1+k.length,Z);if(!Q){D=!0;break}k.push(Q)}if(!D)if(Array.isArray(P)&&P.length!==k.length)x.error(`Expected ${P.length} arguments, but found ${k.length} instead.`);else{for(let F=0;F<k.length;F++){const j=Array.isArray(P)?P[F]:P.type,Z=k[F];x.concat(F+1).checkSubtype(j,Z.type)}if(x.errors.length===0)return new on(o,p,A,k)}}if(_.length===1)r.errors.push(...x.errors);else{const P=(_.length?_:m).map(([k])=>{return D=k,Array.isArray(D)?`(${D.map(L).join(", ")})`:`(${L(D.type)}...)`;var D}).join(" | "),A=[];for(let k=1;k<t.length;k++){const D=r.parse(t[k],1+A.length);if(!D)return null;A.push(L(D.type))}r.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){on.definitions=r;for(const o in r)t[o]=on}}function cu(i,[t,r,o,u]){t=t.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const p=u?u.evaluate(i):1,m=to(t,r,o,p);if(m)throw new $i(m);return new gi(t/255,r/255,o/255,p,!1)}function uu(i,t){return i in t}function hu(i,t){const r=t[i];return r===void 0?null:r}function Ms(i){return{type:i}}function aa(i){if(i instanceof li)return aa(i.boundExpression);if(i instanceof on&&i.name==="error"||i instanceof ra||i instanceof As||i instanceof ks)return!1;const t=i instanceof _n||i instanceof gn;let r=!0;return i.eachChild(o=>{r=t?r&&aa(o):r&&o instanceof mn}),!!r&&la(i)&&ca(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function la(i){if(i instanceof on&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof As||i instanceof ks)return!1;let t=!0;return i.eachChild(r=>{t&&!la(r)&&(t=!1)}),t}function ao(i){if(i instanceof on&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!ao(r)&&(t=!1)}),t}function ca(i,t){if(i instanceof on&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!ca(o,t)&&(r=!1)}),r}function il(i){return{result:"success",value:i}}function lo(i){return{result:"error",value:i}}function co(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function cf(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function du(i){return!!i.expression&&i.expression.interpolated}function oi(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function rl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function A_(i){return i}function uf(i,t){const r=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),p=i.type||(du(t)?"exponential":"interval");if(r||t.type==="padding"){const A=r?gi.parse:Yr.parse;(i=Mn({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],A(k[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let _,x,P;if(p==="exponential")_=df;else if(p==="interval")_=nl;else if(p==="categorical"){_=hf,x=Object.create(null);for(const A of i.stops)x[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=pf}if(o){const A={},k=[];for(let j=0;j<i.stops.length;j++){const Z=i.stops[j],Q=Z[0].zoom;A[Q]===void 0&&(A[Q]={zoom:Q,type:i.type,property:i.property,default:i.default,stops:[]},k.push(Q)),A[Q].stops.push([Z[0].value,Z[1]])}const D=[];for(const j of k)D.push([A[j].zoom,uf(A[j],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:jr.interpolationFactor.bind(void 0,F),zoomStops:D.map(j=>j[0]),evaluate:({zoom:j},Z)=>df({stops:D,base:i.base},t,j).evaluate(j,Z)}}if(u){const A=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:jr.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(k=>k[0]),evaluate:({zoom:k})=>_(i,t,k,x,P)}}return{kind:"source",evaluate(A,k){const D=k&&k.properties?k.properties[i.property]:void 0;return D===void 0?uo(i.default,t.default):_(i,t,D,x,P)}}}function uo(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function hf(i,t,r,o,u){return uo(typeof r===u?o[r]:void 0,i.default,t.default)}function nl(i,t,r){if(oi(r)!=="number")return uo(i.default,t.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const u=Ha(i.stops.map(p=>p[0]),r);return i.stops[u][1]}function df(i,t,r){const o=i.base!==void 0?i.base:1;if(oi(r)!=="number")return uo(i.default,t.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const p=Ha(i.stops.map(A=>A[0]),r),m=function(A,k,D,F){const j=F-D,Z=A-D;return j===0?0:k===1?Z/j:(Math.pow(k,Z)-1)/(Math.pow(k,j)-1)}(r,o,i.stops[p][0],i.stops[p+1][0]),_=i.stops[p][1],x=i.stops[p+1][1],P=Vr[t.type]||A_;return typeof _.evaluate=="function"?{evaluate(...A){const k=_.evaluate.apply(void 0,A),D=x.evaluate.apply(void 0,A);if(k!==void 0&&D!==void 0)return P(k,D,m,i.colorSpace)}}:P(_,x,m,i.colorSpace)}function pf(i,t,r){switch(t.type){case"color":r=gi.parse(r);break;case"formatted":r=Jr.fromString(r.toString());break;case"resolvedImage":r=Qr.fromString(r.toString());break;case"padding":r=Yr.parse(r);break;default:oi(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return uo(r,i.default,t.default)}on.register(oo,{error:[{kind:"error"},[Ht],(i,[t])=>{throw new $i(t.evaluate(i))}],typeof:[Ht,[Ut],(i,[t])=>L(rr(t.evaluate(i)))],"to-rgba":[O(tt,4),[Nr],(i,[t])=>{const[r,o,u,p]=t.evaluate(i).rgb;return[255*r,255*o,255*u,p]}],rgb:[Nr,[tt,tt,tt],cu],rgba:[Nr,[tt,tt,tt,tt],cu],has:{type:Ot,overloads:[[[Ht],(i,[t])=>uu(t.evaluate(i),i.properties())],[[Ht,fn],(i,[t,r])=>uu(t.evaluate(i),r.evaluate(i))]]},get:{type:Ut,overloads:[[[Ht],(i,[t])=>hu(t.evaluate(i),i.properties())],[[Ht,fn],(i,[t,r])=>hu(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Ut,[Ht],(i,[t])=>hu(t.evaluate(i),i.featureState||{})],properties:[fn,[],i=>i.properties()],"geometry-type":[Ht,[],i=>i.geometryType()],id:[Ut,[],i=>i.id()],zoom:[tt,[],i=>i.globals.zoom],"heatmap-density":[tt,[],i=>i.globals.heatmapDensity||0],"line-progress":[tt,[],i=>i.globals.lineProgress||0],accumulated:[Ut,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[tt,Ms(tt),(i,t)=>{let r=0;for(const o of t)r+=o.evaluate(i);return r}],"*":[tt,Ms(tt),(i,t)=>{let r=1;for(const o of t)r*=o.evaluate(i);return r}],"-":{type:tt,overloads:[[[tt,tt],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[tt],(i,[t])=>-t.evaluate(i)]]},"/":[tt,[tt,tt],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[tt,[tt,tt],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[tt,[tt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))],log2:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[tt,[tt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[tt,[tt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[tt,[tt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[tt,[tt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[tt,[tt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[tt,[tt],(i,[t])=>Math.atan(t.evaluate(i))],min:[tt,Ms(tt),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[tt,Ms(tt),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[tt,[tt],(i,[t])=>Math.abs(t.evaluate(i))],round:[tt,[tt],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[tt,[tt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[tt,[tt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ot,[Ht,Ut],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Ot,[Ut],(i,[t])=>i.id()===t.value],"filter-type-==":[Ot,[Ht],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ot,[Ht,Ut],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Ot,[Ut],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Ot,[Ht,Ut],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[Ot,[Ut],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Ot,[Ht,Ut],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Ot,[Ut],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Ot,[Ht,Ut],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Ot,[Ut],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Ot,[Ut],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ot,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ot,[O(Ht)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ot,[O(Ut)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ot,[Ht,O(Ut)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ot,[Ht,O(Ut)],(i,[t,r])=>function(o,u,p,m){for(;p<=m;){const _=p+m>>1;if(u[_]===o)return!0;u[_]>o?m=_-1:p=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Ms(Ot),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Ms(Ot),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Ot,[Ot],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ot,[Ht],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Ht,[Ht],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ht,[Ht],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ht,Ms(Ut),(i,t)=>t.map(r=>ea(r.evaluate(i))).join("")],"resolved-locale":[Ht,[Dn],(i,[t])=>t.evaluate(i).resolvedLocale()]});class sl{constructor(t,r){var o;this.expression=t,this._warningHistory={},this._evaluator=new Za,this._defaultValue=r?(o=r).type==="color"&&rl(o.default)?new gi(0,0,0,0):o.type==="color"?gi.parse(o.default)||null:o.type==="padding"?Yr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?sn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,u,p,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,u,p,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new $i(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function ol(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in oo}function ho(i,t){const r=new Ps(oo,aa,[],t?function(u){const p={color:Nr,string:Ht,number:tt,enum:Ht,boolean:Ot,formatted:Zn,padding:is,resolvedImage:Rn,variableAnchorOffsetCollection:re};return u.type==="array"?O(p[u.value]||Ut,u.length):p[u.type]}(t):void 0),o=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?il(new sl(o,t)):lo(r.errors)}class po{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!ao(r.expression)}evaluateWithoutErrorHandling(t,r,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,p,m)}evaluate(t,r,o,u,p,m){return this._styleExpression.evaluate(t,r,o,u,p,m)}}class fo{constructor(t,r,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!ao(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,r,o,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,p,m)}evaluate(t,r,o,u,p,m){return this._styleExpression.evaluate(t,r,o,u,p,m)}interpolationFactor(t,r,o){return this.interpolationType?jr.interpolationFactor(this.interpolationType,t,r,o):0}}function pu(i,t){const r=ho(i,t);if(r.result==="error")return r;const o=r.value.expression,u=la(o);if(!u&&!co(t))return lo([new Cr("","data expressions not supported")]);const p=ca(o,["zoom"]);if(!p&&!cf(t))return lo([new Cr("","zoom expressions not supported")]);const m=ua(o);return m||p?m instanceof Cr?lo([m]):m instanceof jr&&!du(t)?lo([new Cr("",'"interpolate" expressions cannot be used with this property')]):il(m?new fo(u?"camera":"composite",r.value,m.labels,m instanceof jr?m.interpolation:void 0):new po(u?"constant":"source",r.value)):lo([new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mo{constructor(t,r){this._parameters=t,this._specification=r,Mn(this,uf(this._parameters,this._specification))}static deserialize(t){return new mo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ua(i){let t=null;if(i instanceof rs)t=ua(i.result);else if(i instanceof Xa){for(const r of i.args)if(t=ua(r),t)break}else(i instanceof ro||i instanceof jr)&&i.input instanceof on&&i.input.name==="zoom"&&(t=i);return t instanceof Cr||i.eachChild(r=>{const o=ua(r);o instanceof Cr?t=o:!t&&o?t=new Cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function al(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!al(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ll={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};al(i)||(i=cl(i));const t=ho(i,ll);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,u)=>t.value.evaluate(r,o,{},u),needGeometry:ff(i)}}function C_(i,t){return i<t?-1:i>t?1:0}function ff(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(ff(i[t]))return!0;return!1}function cl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?mu(i[1],i[2],"=="):t==="!="?_r(mu(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?mu(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(cl))):t==="all"?["all"].concat(i.slice(1).map(cl)):t==="none"?["all"].concat(i.slice(1).map(cl).map(_r)):t==="in"?ha(i[1],i.slice(2)):t==="!in"?_r(ha(i[1],i.slice(2))):t==="has"?da(i[1]):t!=="!has"||_r(da(i[1]));var r}function mu(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function ha(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(C_)]]:["filter-in-small",i,["literal",t]]}}function da(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function _r(i){return["!",i]}function zs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const p of i)u+=`${zs(p)},`;return`${u}]`}const r=Object.keys(i).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${zs(i[r[u]])},`;return`${o}}`}function mf(i){let t="";for(const r of ji)t+=`/${zs(i[r])}`;return t}function gf(i){const t=i.value;return t?[new Xe(i.key,t,"constants have been deprecated as of v8")]:[]}function Xi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function yn(i){if(Array.isArray(i))return i.map(yn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=yn(i[r]);return t}return Xi(i)}function $r(i){const t=i.key,r=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,m=i.styleSpec,_=i.validateSpec;let x=[];const P=oi(r);if(P!=="object")return[new Xe(t,r,`object expected, ${P} found`)];for(const A in r){const k=A.split(".")[0],D=o[k]||o["*"];let F;if(u[k])F=u[k];else if(o[k])F=_;else if(u["*"])F=u["*"];else{if(!o["*"]){x.push(new Xe(t,r[A],`unknown property "${A}"`));continue}F=_}x=x.concat(F({key:(t&&`${t}.`)+A,value:r[A],valueSpec:D,style:p,styleSpec:m,object:r,objectKey:A,validateSpec:_},r))}for(const A in o)u[A]||o[A].required&&o[A].default===void 0&&r[A]===void 0&&x.push(new Xe(t,r,`missing required property "${A}"`));return x}function pa(i){const t=i.value,r=i.valueSpec,o=i.style,u=i.styleSpec,p=i.key,m=i.arrayElementValidator||i.validateSpec;if(oi(t)!=="array")return[new Xe(p,t,`array expected, ${oi(t)} found`)];if(r.length&&t.length!==r.length)return[new Xe(p,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Xe(p,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),oi(r.value)==="object"&&(_=r.value);let x=[];for(let P=0;P<t.length;P++)x=x.concat(m({array:t,arrayIndex:P,value:t[P],valueSpec:_,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${p}[${P}]`}));return x}function gu(i){const t=i.key,r=i.value,o=i.valueSpec;let u=oi(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Xe(t,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new Xe(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Xe(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function ul(i){const t=i.valueSpec,r=Xi(i.value.type);let o,u,p,m={};const _=r!=="categorical"&&i.value.property===void 0,x=!_,P=oi(i.value.stops)==="array"&&oi(i.value.stops[0])==="array"&&oi(i.value.stops[0][0])==="object",A=$r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Xe(F.key,F.value,'identity function may not have a "stops" property')];let j=[];const Z=F.value;return j=j.concat(pa({key:F.key,value:Z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),oi(Z)==="array"&&Z.length===0&&j.push(new Xe(F.key,Z,"array must have at least one stop")),j},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&_&&A.push(new Xe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new Xe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!du(i.valueSpec)&&A.push(new Xe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!co(i.valueSpec)?A.push(new Xe(i.key,i.value,"property functions not supported")):_&&!cf(i.valueSpec)&&A.push(new Xe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!P||i.value.property!==void 0||A.push(new Xe(i.key,i.value,'"property" property is required')),A;function k(F){let j=[];const Z=F.value,Q=F.key;if(oi(Z)!=="array")return[new Xe(Q,Z,`array expected, ${oi(Z)} found`)];if(Z.length!==2)return[new Xe(Q,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(oi(Z[0])!=="object")return[new Xe(Q,Z,`object expected, ${oi(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Xe(Q,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Xe(Q,Z,"object stop key must have value")];if(p&&p>Xi(Z[0].zoom))return[new Xe(Q,Z[0].zoom,"stop zoom values must appear in ascending order")];Xi(Z[0].zoom)!==p&&(p=Xi(Z[0].zoom),u=void 0,m={}),j=j.concat($r({key:`${Q}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:gu,value:D}}))}else j=j.concat(D({key:`${Q}[0]`,value:Z[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},Z));return ol(yn(Z[1]))?j.concat([new Xe(`${Q}[1]`,Z[1],"expressions are not allowed in function stops.")]):j.concat(F.validateSpec({key:`${Q}[1]`,value:Z[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,j){const Z=oi(F.value),Q=Xi(F.value),ne=F.value!==null?F.value:j;if(o){if(Z!==o)return[new Xe(F.key,ne,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Xe(F.key,ne,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let xe=`number expected, ${Z} found`;return co(t)&&r===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xe(F.key,ne,xe)]}return r!=="categorical"||Z!=="number"||isFinite(Q)&&Math.floor(Q)===Q?r!=="categorical"&&Z==="number"&&u!==void 0&&Q<u?[new Xe(F.key,ne,"stop domain values must appear in ascending order")]:(u=Q,r==="categorical"&&Q in m?[new Xe(F.key,ne,"stop domain values must be unique")]:(m[Q]=!0,[])):[new Xe(F.key,ne,`integer expected, found ${Q}`)]}}function go(i){const t=(i.expressionContext==="property"?pu:ho)(yn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Xe(`${i.key}${o.key}`,i.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Xe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!ao(r))return[new Xe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!ao(r))return[new Xe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ca(r,["zoom","feature-state"]))return[new Xe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!la(r))return[new Xe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hn(i){const t=i.key,r=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Xi(r))===-1&&u.push(new Xe(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Xi(r))===-1&&u.push(new Xe(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function _u(i){return al(yn(i.value))?go(Mn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hl(i)}function hl(i){const t=i.value,r=i.key;if(oi(t)!=="array")return[new Xe(r,t,`array expected, ${oi(t)} found`)];const o=i.styleSpec;let u,p=[];if(t.length<1)return[new Xe(r,t,"filter array must have at least 1 element")];switch(p=p.concat(Hn({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Xi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Xi(t[1])==="$type"&&p.push(new Xe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&p.push(new Xe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=oi(t[1]),u!=="string"&&p.push(new Xe(`${r}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=oi(t[m]),Xi(t[1])==="$type"?p=p.concat(Hn({key:`${r}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new Xe(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)p=p.concat(hl({key:`${r}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=oi(t[1]),t.length!==2?p.push(new Xe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new Xe(`${r}[1]`,t[1],`string expected, ${u} found`))}return p}function yu(i,t){const r=i.key,o=i.validateSpec,u=i.style,p=i.styleSpec,m=i.value,_=i.objectKey,x=p[`${t}_${i.layerType}`];if(!x)return[];const P=_.match(/^(.*)-transition$/);if(t==="paint"&&P&&x[P[1]]&&x[P[1]].transition)return o({key:r,value:m,valueSpec:p.transition,style:u,styleSpec:p});const A=i.valueSpec||x[_];if(!A)return[new Xe(r,m,`unknown property "${_}"`)];let k;if(oi(m)==="string"&&co(A)&&!A.tokens&&(k=/^{([^}]+)}$/.exec(m)))return[new Xe(r,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&D.push(new Xe(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&rl(yn(m))&&Xi(m.type)==="identity"&&D.push(new Xe(r,m,'"text-font" does not support identity functions'))),D.concat(o({key:i.key,value:m,valueSpec:A,style:u,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:_}))}function dl(i){return yu(i,"paint")}function vu(i){return yu(i,"layout")}function xu(i){let t=[];const r=i.value,o=i.key,u=i.style,p=i.styleSpec;r.type||r.ref||t.push(new Xe(o,r,'either "type" or "ref" is required'));let m=Xi(r.type);const _=Xi(r.ref);if(r.id){const x=Xi(r.id);for(let P=0;P<i.arrayIndex;P++){const A=u.layers[P];Xi(A.id)===x&&t.push(new Xe(o,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new Xe(o,r[P],`"${P}" is prohibited for ref layers`))}),u.layers.forEach(P=>{Xi(P.id)===_&&(x=P)}),x?x.ref?t.push(new Xe(o,r.ref,"ref cannot reference another ref layer")):m=Xi(x.type):t.push(new Xe(o,r.ref,`ref layer "${_}" not found`))}else if(m!=="background")if(r.source){const x=u.sources&&u.sources[r.source],P=x&&Xi(x.type);x?P==="vector"&&m==="raster"?t.push(new Xe(o,r.source,`layer "${r.id}" requires a raster source`)):P!=="raster-dem"&&m==="hillshade"?t.push(new Xe(o,r.source,`layer "${r.id}" requires a raster-dem source`)):P==="raster"&&m!=="raster"?t.push(new Xe(o,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&m!=="hillshade"?t.push(new Xe(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||P==="geojson"&&x.lineMetrics||t.push(new Xe(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Xe(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Xe(o,r.source,`source "${r.source}" not found`))}else t.push(new Xe(o,r,'missing required property "source"'));return t=t.concat($r({key:o,value:r,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:r.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:_u,layout:x=>$r({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>vu(Mn({layerType:m},P))}}),paint:x=>$r({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>dl(Mn({layerType:m},P))}})}})),t}function Ds(i){const t=i.value,r=i.key,o=oi(t);return o!=="string"?[new Xe(r,t,`string expected, ${o} found`)]:[]}const pl={promoteId:function({key:i,value:t}){if(oi(t)==="string")return Ds({key:i,value:t});{const r=[];for(const o in t)r.push(...Ds({key:`${i}.${o}`,value:t[o]}));return r}}};function fa(i){const t=i.value,r=i.key,o=i.styleSpec,u=i.style,p=i.validateSpec;if(!t.type)return[new Xe(r,t,'"type" is required')];const m=Xi(t.type);let _;switch(m){case"vector":case"raster":return _=$r({key:r,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:pl,validateSpec:p}),_;case"raster-dem":return _=function(x){var P;const A=(P=x.sourceName)!==null&&P!==void 0?P:"",k=x.value,D=x.styleSpec,F=D.source_raster_dem,j=x.style;let Z=[];const Q=oi(k);if(k===void 0)return Z;if(Q!=="object")return Z.push(new Xe("source_raster_dem",k,`object expected, ${Q} found`)),Z;const ne=Xi(k.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],he=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const _e in k)!ne&&xe.includes(_e)?Z.push(new Xe(_e,k[_e],`In "${A}": "${_e}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):F[_e]?Z=Z.concat(x.validateSpec({key:_e,value:k[_e],valueSpec:F[_e],validateSpec:x.validateSpec,style:j,styleSpec:D})):Z.push(new Xe(_e,k[_e],`unknown property "${_e}"`));return Z}({sourceName:r,value:t,style:i.style,styleSpec:o,validateSpec:p}),_;case"geojson":if(_=$r({key:r,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:p,objectElementValidators:pl}),t.cluster)for(const x in t.clusterProperties){const[P,A]=t.clusterProperties[x],k=typeof P=="string"?[P,["accumulated"],["get",x]]:P;_.push(...go({key:`${r}.${x}.map`,value:A,validateSpec:p,expressionContext:"cluster-map"})),_.push(...go({key:`${r}.${x}.reduce`,value:k,validateSpec:p,expressionContext:"cluster-reduce"}))}return _;case"video":return $r({key:r,value:t,valueSpec:o.source_video,style:u,validateSpec:p,styleSpec:o});case"image":return $r({key:r,value:t,valueSpec:o.source_image,style:u,validateSpec:p,styleSpec:o});case"canvas":return[new Xe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:p,styleSpec:o})}}function bu(i){const t=i.value,r=i.styleSpec,o=r.light,u=i.style;let p=[];const m=oi(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Xe("light",t,`object expected, ${m} found`)]),p;for(const _ in t){const x=_.match(/^(.*)-transition$/);p=p.concat(x&&o[x[1]]&&o[x[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Xe(_,t[_],`unknown property "${_}"`)])}return p}function wu(i){const t=i.value,r=i.styleSpec,o=r.sky,u=i.style,p=oi(t);if(t===void 0)return[];if(p!=="object")return[new Xe("sky",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new Xe(_,t[_],`unknown property "${_}"`)]);return m}function Su(i){const t=i.value,r=i.styleSpec,o=r.terrain,u=i.style;let p=[];const m=oi(t);if(t===void 0)return p;if(m!=="object")return p=p.concat([new Xe("terrain",t,`object expected, ${m} found`)]),p;for(const _ in t)p=p.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Xe(_,t[_],`unknown property "${_}"`)]);return p}function Pu(i){let t=[];const r=i.value,o=i.key;if(Array.isArray(r)){const u=[],p=[];for(const m in r)r[m].id&&u.includes(r[m].id)&&t.push(new Xe(o,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),u.push(r[m].id),r[m].url&&p.includes(r[m].url)&&t.push(new Xe(o,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),p.push(r[m].url),t=t.concat($r({key:`${o}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Ds({key:o,value:r})}const fl={"*":()=>[],array:pa,boolean:function(i){const t=i.value,r=i.key,o=oi(t);return o!=="boolean"?[new Xe(r,t,`boolean expected, ${o} found`)]:[]},number:gu,color:function(i){const t=i.key,r=i.value,o=oi(r);return o!=="string"?[new Xe(t,r,`color expected, ${o} found`)]:gi.parse(String(r))?[]:[new Xe(t,r,`color expected, "${r}" found`)]},constants:gf,enum:Hn,filter:_u,function:ul,layer:xu,object:$r,source:fa,light:bu,sky:wu,terrain:Su,projection:function(i){const t=i.value,r=i.styleSpec,o=r.projection,u=i.style,p=oi(t);if(t===void 0)return[];if(p!=="object")return[new Xe("projection",t,`object expected, ${p} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new Xe(_,t[_],`unknown property "${_}"`)]);return m},string:Ds,formatted:function(i){return Ds(i).length===0?[]:go(i)},resolvedImage:function(i){return Ds(i).length===0?[]:go(i)},padding:function(i){const t=i.key,r=i.value;if(oi(r)==="array"){if(r.length<1||r.length>4)return[new Xe(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let p=0;p<r.length;p++)u=u.concat(i.validateSpec({key:`${t}[${p}]`,value:r[p],validateSpec:i.validateSpec,valueSpec:o}));return u}return gu({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,o=oi(r),u=i.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Xe(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let m=0;m<r.length;m+=2)p=p.concat(Hn({key:`${t}[${m}]`,value:r[m],valueSpec:u.layout_symbol["text-anchor"]})),p=p.concat(pa({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return p},sprite:Pu};function _o(i){const t=i.value,r=i.valueSpec,o=i.styleSpec;return i.validateSpec=_o,r.expression&&rl(Xi(t))?ul(i):r.expression&&ol(yn(t))?go(i):r.type&&fl[r.type]?fl[r.type](i):$r(Mn({},i,{valueSpec:r.type?o[r.type]:r}))}function _f(i){const t=i.value,r=i.key,o=Ds(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Xe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Xe(r,t,'"glyphs" url must include a "{range}" token'))),o}function an(i,t=we){let r=[];return r=r.concat(_o({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:_o,objectElementValidators:{glyphs:_f,"*":()=>[]}})),i.constants&&(r=r.concat(gf({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:_o}))),Tu(r)}function On(i){return function(t){return i({...t,validateSpec:_o})}}function Tu(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function vn(i){return function(...t){return Tu(i.apply(this,t))}}an.source=vn(On(fa)),an.sprite=vn(On(Pu)),an.glyphs=vn(On(_f)),an.light=vn(On(bu)),an.sky=vn(On(wu)),an.terrain=vn(On(Su)),an.layer=vn(On(xu)),an.filter=vn(On(_u)),an.paintProperty=vn(On(dl)),an.layoutProperty=vn(On(vu));const Rs=an,E_=Rs.light,k_=Rs.sky,yf=Rs.paintProperty,vf=Rs.layoutProperty;function Iu(i,t){let r=!1;if(t&&t.length)for(const o of t)i.fire(new vt(new Error(o.message))),r=!0;return r}class yo{constructor(t,r,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(o=m[2]);for(let x=0;x<this.d*this.d;x++){const P=m[3+x],A=m[3+x+1];u.push(P===A?null:m.subarray(P,A))}const _=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const p=o/r*t;this.min=-p,this.max=t+p}insert(t,r,o,u,p){this._forEachCell(r,o,u,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,u,p,m){this.cells[p].push(m)}query(t,r,o,u,p){const m=this.min,_=this.max;if(t<=m&&r<=m&&_<=o&&_<=u&&!p)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,r,o,u,this._queryCell,x,{},p),x}}_queryCell(t,r,o,u,p,m,_,x){const P=this.cells[p];if(P!==null){const A=this.keys,k=this.bboxes;for(let D=0;D<P.length;D++){const F=P[D];if(_[F]===void 0){const j=4*F;(x?x(k[j+0],k[j+1],k[j+2],k[j+3]):t<=k[j+2]&&r<=k[j+3]&&o>=k[j+0]&&u>=k[j+1])?(_[F]=!0,m.push(A[F])):_[F]=!1}}}}_forEachCell(t,r,o,u,p,m,_,x){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(r),k=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let F=P;F<=k;F++)for(let j=A;j<=D;j++){const Z=this.d*j+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(j),this._convertFromCellCoord(F+1),this._convertFromCellCoord(j+1)))&&p.call(this,t,r,o,u,Z,m,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let p=r;for(let m=0;m<t.length;m++){const _=t[m];u[3+m]=p,u.set(_,p),p+=_.length}return u[3+t.length]=p,u.set(this.keys,p),p+=this.keys.length,u[3+t.length+1]=p,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new yo(t.buffer)}}const ln={};function pt(i,t,r={}){if(ln[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),ln[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}pt("Object",Object),pt("TransferableGridIndex",yo),pt("Color",gi),pt("Error",Error),pt("AJAXError",Ni),pt("ResolvedImage",Qr),pt("StylePropertyFunction",mo),pt("StyleExpression",sl,{omit:["_evaluator"]}),pt("ZoomDependentExpression",fo),pt("ZoomConstantExpression",po),pt("CompoundExpression",on,{omit:["_evaluate"]});for(const i in oo)oo[i]._classRegistryKey||pt(`Expression_${i}`,oo[i]);function ml(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Au(i){return i.$name||i.constructor._classRegistryKey}function xf(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=Au(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||ml(i)||yt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function vo(i,t){if(xf(i))return(ml(i)||yt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const p=[];for(const m of i)p.push(vo(m,t));return p}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Au(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!ln[r])throw new Error(`${r} is not registered.`);const{klass:o}=ln[r],u=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in i){if(!i.hasOwnProperty(p)||ln[r].omit.indexOf(p)>=0)continue;const m=i[p];u[p]=ln[r].shallow.indexOf(p)>=0?m:vo(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function xo(i){if(xf(i))return i;if(Array.isArray(i))return i.map(xo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Au(i)||"Object";if(!ln[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=ln[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const p=i[u];o[u]=ln[t].shallow.indexOf(u)>=0?p:xo(p)}return o}class Cu{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const ti={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Eu(i){for(const t of i)if(Mu(t.charCodeAt(0)))return!0;return!1}function M_(i){for(const t of i)if(!bo(t.charCodeAt(0)))return!1;return!0}function ku(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const z_=ku(["Arab","Dupl","Mong","Ougr","Syrc"]);function bo(i){return!z_.test(String.fromCodePoint(i))}const bf=ku(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Mu(i){return!(i!==746&&i!==747&&(i<4352||!(ti["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ti["CJK Compatibility"](i)||ti["CJK Strokes"](i)||!(!ti["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ti["Enclosed CJK Letters and Months"](i)||ti["Ideographic Description Characters"](i)||ti.Kanbun(i)||ti.Katakana(i)&&i!==12540||!(!ti["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ti["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ti["Vertical Forms"](i)||ti["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||bf.test(String.fromCodePoint(i)))))}function wf(i){return!(Mu(i)||function(t){return!!(ti["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ti["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ti["Letterlike Symbols"](t)||ti["Number Forms"](t)||ti["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ti["Control Pictures"](t)&&t!==9251||ti["Optical Character Recognition"](t)||ti["Enclosed Alphanumerics"](t)||ti["Geometric Shapes"](t)||ti["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ti["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ti["CJK Symbols and Punctuation"](t)||ti.Katakana(t)||ti["Private Use Area"](t)||ti["CJK Compatibility Forms"](t)||ti["Small Form Variants"](t)||ti["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const D_=ku(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function zu(i){return D_.test(String.fromCodePoint(i))}function R_(i,t){return!(!t&&zu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ti.Khmer(i))}function L_(i){for(const t of i)if(zu(t.charCodeAt(0)))return!0;return!1}const en=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ei{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cu,this.transition={})}isSupportedScript(t){return function(r,o){for(const u of r)if(!R_(u.charCodeAt(0),o))return!1;return!0}(t,en.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class wo{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,u){if(rl(o))return new mo(o,u);if(ol(o)){const p=pu(o,u);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));return p.value}{let p=o;return u.type==="color"&&typeof o=="string"?p=gi.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(p=sn.parse(o)):p=Yr.parse(o),{kind:"constant",evaluate:()=>p}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class gl{constructor(t){this.property=t,this.value=new wo(t,void 0)}transitioned(t,r){return new Sf(this.property,this.value,r,Je({},t.transition,this.transition),t.now)}untransitioned(){return new Sf(this.property,this.value,null,{},0)}}class _l{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return at(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].value=new wo(this._values[t].property,r===null?void 0:at(r))}getTransition(t){return at(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new gl(this._values[t].property)),this._values[t].transition=at(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const u=this.getTransition(r);u!==void 0&&(t[`${r}-transition`]=u)}return t}transitioned(t,r){const o=new ma(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,r._values[u]);return o}untransitioned(){const t=new ma(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class Sf{constructor(t,r,o,u,p){this.property=t,this.value=r,this.begin=p+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const u=t.now||0,p=this.value.possiblyEvaluate(t,r,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(t,r,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,o),p,function(x){if(x<=0)return 0;if(x>=1)return 1;const P=x*x,A=P*x;return 4*(x<.5?A:3*(x-P)+A-.75)}(_))}}return p}}class ma{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const u=new _a(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,r,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ga{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return at(this._values[t].value)}setValue(t,r){this._values[t]=new wo(this._values[t].property,r===null?void 0:at(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const u=new _a(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(t,r,o);return u}}class Fn{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,u){return this.property.evaluate(this.value,this.parameters,t,r,o,u)}}class _a{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const u=Vr[this.specification.type];return u?u(t,r,o):t}}class Dt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,u){return new Fn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,u)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Fn(this,{kind:"constant",value:void 0},t.parameters);const u=Vr[this.specification.type];if(u){const p=u(t.value.value,r.value.value,o);return new Fn(this,{kind:"constant",value:p},t.parameters)}return t}evaluate(t,r,o,u,p,m){return t.kind==="constant"?t.value:t.evaluate(r,o,u,p,m)}}class yl extends Dt{possiblyEvaluate(t,r,o,u){if(t.value===void 0)return new Fn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,_=this._calculate(m,m,m,r);return new Fn(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const p=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Fn(this,{kind:"constant",value:p},r)}return new Fn(this,t.expression,r)}evaluate(t,r,o,u,p,m){if(t.kind==="source"){const _=t.evaluate(r,o,u,p,m);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,u),t.evaluate({zoom:Math.floor(r.zoom)},o,u),t.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):t.value}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class vl{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const p=t.expression.evaluate(r,null,{},o,u);return this._calculate(p,p,p,r)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ei(Math.floor(r.zoom),r)),t.expression.evaluate(new Ei(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Du{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){return!!t.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class d{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new wo(o,void 0),p=this.defaultTransitionablePropertyValues[r]=new gl(o);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}pt("DataDrivenProperty",Dt),pt("DataConstantProperty",bt),pt("CrossFadedDataDrivenProperty",yl),pt("CrossFadedProperty",vl),pt("ColorRampProperty",Du);const e="-transition";class n extends Lt{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new ga(r.layout)),r.paint)){this._transitionablePaint=new _l(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _a(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,o={}){r!=null&&this._validate(vf,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(yf,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[t],p=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||p||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),gt(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,u,p={}){return(!p||p.validate!==!1)&&Iu(this,t.call(Rs,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Fn&&co(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class h{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function y(i,t=1){let r=0,o=0;return{members:i.map(u=>{const p=a[u.type].BYTES_PER_ELEMENT,m=r=b(r,Math.max(t,p)),_=u.components||1;return o=Math.max(o,p),r+=p*_,{name:u.name,type:u.type,components:_,offset:m}}),size:b(r,Math.max(o,t)),alignment:t}}function b(i,t){return Math.ceil(i/t)*t}class S extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.int16[u+0]=r,this.int16[u+1]=o,t}}S.prototype.bytesPerElement=4,pt("StructArrayLayout2i4",S);class C extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const p=3*t;return this.int16[p+0]=r,this.int16[p+1]=o,this.int16[p+2]=u,t}}C.prototype.bytesPerElement=6,pt("StructArrayLayout3i6",C);class M extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,o,u)}emplace(t,r,o,u,p){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=p,t}}M.prototype.bytesPerElement=8,pt("StructArrayLayout4i8",M);class z extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,p,m)}emplace(t,r,o,u,p,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=m,this.int16[x+5]=_,t}}z.prototype.bytesPerElement=12,pt("StructArrayLayout2i4i12",z);class B extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,p,m)}emplace(t,r,o,u,p,m,_){const x=4*t,P=8*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.uint8[P+4]=u,this.uint8[P+5]=p,this.uint8[P+6]=m,this.uint8[P+7]=_,t}}B.prototype.bytesPerElement=8,pt("StructArrayLayout2i4ub8",B);class G extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.float32[u+0]=r,this.float32[u+1]=o,t}}G.prototype.bytesPerElement=8,pt("StructArrayLayout2f8",G);class X extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m,_,x,P,A){const k=this.length;return this.resize(k+1),this.emplace(k,t,r,o,u,p,m,_,x,P,A)}emplace(t,r,o,u,p,m,_,x,P,A,k){const D=10*t;return this.uint16[D+0]=r,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=p,this.uint16[D+4]=m,this.uint16[D+5]=_,this.uint16[D+6]=x,this.uint16[D+7]=P,this.uint16[D+8]=A,this.uint16[D+9]=k,t}}X.prototype.bytesPerElement=20,pt("StructArrayLayout10ui20",X);class ee extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m,_,x,P,A,k,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,o,u,p,m,_,x,P,A,k,D)}emplace(t,r,o,u,p,m,_,x,P,A,k,D,F){const j=12*t;return this.int16[j+0]=r,this.int16[j+1]=o,this.int16[j+2]=u,this.int16[j+3]=p,this.uint16[j+4]=m,this.uint16[j+5]=_,this.uint16[j+6]=x,this.uint16[j+7]=P,this.int16[j+8]=A,this.int16[j+9]=k,this.int16[j+10]=D,this.int16[j+11]=F,t}}ee.prototype.bytesPerElement=24,pt("StructArrayLayout4i4ui4i24",ee);class se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const p=3*t;return this.float32[p+0]=r,this.float32[p+1]=o,this.float32[p+2]=u,t}}se.prototype.bytesPerElement=12,pt("StructArrayLayout3f12",se);class ae extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}ae.prototype.bytesPerElement=4,pt("StructArrayLayout1ul4",ae);class ce extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m,_,x,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,o,u,p,m,_,x,P)}emplace(t,r,o,u,p,m,_,x,P,A){const k=10*t,D=5*t;return this.int16[k+0]=r,this.int16[k+1]=o,this.int16[k+2]=u,this.int16[k+3]=p,this.int16[k+4]=m,this.int16[k+5]=_,this.uint32[D+3]=x,this.uint16[k+8]=P,this.uint16[k+9]=A,t}}ce.prototype.bytesPerElement=20,pt("StructArrayLayout6i1ul2ui20",ce);class Y extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,p,m)}emplace(t,r,o,u,p,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=m,this.int16[x+5]=_,t}}Y.prototype.bytesPerElement=12,pt("StructArrayLayout2i2i2i12",Y);class fe extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,u,p)}emplace(t,r,o,u,p,m){const _=4*t,x=8*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[x+6]=p,this.int16[x+7]=m,t}}fe.prototype.bytesPerElement=16,pt("StructArrayLayout2f1f2i16",fe);class ge extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,p,m)}emplace(t,r,o,u,p,m,_){const x=16*t,P=4*t,A=8*t;return this.uint8[x+0]=r,this.uint8[x+1]=o,this.float32[P+1]=u,this.float32[P+2]=p,this.int16[A+6]=m,this.int16[A+7]=_,t}}ge.prototype.bytesPerElement=16,pt("StructArrayLayout2ub2f2i16",ge);class Se extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const p=3*t;return this.uint16[p+0]=r,this.uint16[p+1]=o,this.uint16[p+2]=u,t}}Se.prototype.bytesPerElement=6,pt("StructArrayLayout3ui6",Se);class Re extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne)}emplace(t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne,xe){const he=24*t,_e=12*t,Ee=48*t;return this.int16[he+0]=r,this.int16[he+1]=o,this.uint16[he+2]=u,this.uint16[he+3]=p,this.uint32[_e+2]=m,this.uint32[_e+3]=_,this.uint32[_e+4]=x,this.uint16[he+10]=P,this.uint16[he+11]=A,this.uint16[he+12]=k,this.float32[_e+7]=D,this.float32[_e+8]=F,this.uint8[Ee+36]=j,this.uint8[Ee+37]=Z,this.uint8[Ee+38]=Q,this.uint32[_e+10]=ne,this.int16[he+22]=xe,t}}Re.prototype.bytesPerElement=48,pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Re);class We extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne,xe,he,_e,Ee,qe,ct,zt,ot,rt,Pt,ft){const dt=this.length;return this.resize(dt+1),this.emplace(dt,t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne,xe,he,_e,Ee,qe,ct,zt,ot,rt,Pt,ft)}emplace(t,r,o,u,p,m,_,x,P,A,k,D,F,j,Z,Q,ne,xe,he,_e,Ee,qe,ct,zt,ot,rt,Pt,ft,dt){const De=32*t,Tt=16*t;return this.int16[De+0]=r,this.int16[De+1]=o,this.int16[De+2]=u,this.int16[De+3]=p,this.int16[De+4]=m,this.int16[De+5]=_,this.int16[De+6]=x,this.int16[De+7]=P,this.uint16[De+8]=A,this.uint16[De+9]=k,this.uint16[De+10]=D,this.uint16[De+11]=F,this.uint16[De+12]=j,this.uint16[De+13]=Z,this.uint16[De+14]=Q,this.uint16[De+15]=ne,this.uint16[De+16]=xe,this.uint16[De+17]=he,this.uint16[De+18]=_e,this.uint16[De+19]=Ee,this.uint16[De+20]=qe,this.uint16[De+21]=ct,this.uint16[De+22]=zt,this.uint32[Tt+12]=ot,this.float32[Tt+13]=rt,this.float32[Tt+14]=Pt,this.uint16[De+30]=ft,this.uint16[De+31]=dt,t}}We.prototype.bytesPerElement=64,pt("StructArrayLayout8i15ui1ul2f2ui64",We);class nt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}nt.prototype.bytesPerElement=4,pt("StructArrayLayout1f4",nt);class ut extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const p=3*t;return this.uint16[6*t+0]=r,this.float32[p+1]=o,this.float32[p+2]=u,t}}ut.prototype.bytesPerElement=12,pt("StructArrayLayout1ui2f12",ut);class et extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const p=4*t;return this.uint32[2*t+0]=r,this.uint16[p+2]=o,this.uint16[p+3]=u,t}}et.prototype.bytesPerElement=8,pt("StructArrayLayout1ul2ui8",et);class $e extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.uint16[u+0]=r,this.uint16[u+1]=o,t}}$e.prototype.bytesPerElement=4,pt("StructArrayLayout2ui4",$e);class wt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}wt.prototype.bytesPerElement=2,pt("StructArrayLayout1ui2",wt);class Nt extends h{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const p=this.length;return this.resize(p+1),this.emplace(p,t,r,o,u)}emplace(t,r,o,u,p){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=p,t}}Nt.prototype.bytesPerElement=16,pt("StructArrayLayout4f16",Nt);class it extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new V(this.anchorPointX,this.anchorPointY)}}it.prototype.size=20;class lt extends ce{get(t){return new it(this,t)}}pt("CollisionBoxArray",lt);class Ft extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ft.prototype.size=48;class ki extends Re{get(t){return new Ft(this,t)}}pt("PlacedSymbolArray",ki);class Zt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Zt.prototype.size=64;class $t extends We{get(t){return new Zt(this,t)}}pt("SymbolInstanceArray",$t);class Mi extends nt{getoffsetX(t){return this.float32[1*t+0]}}pt("GlyphOffsetArray",Mi);class yr extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}pt("SymbolLineVertexArray",yr);class xn extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}xn.prototype.size=12;class zi extends ut{get(t){return new xn(this,t)}}pt("TextAnchorOffsetArray",zi);class Ur extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ur.prototype.size=8;class kr extends et{get(t){return new Ur(this,t)}}pt("FeatureIndexArray",kr);class vr extends S{}class Mr extends S{}class Bn extends S{}class So extends z{}class xl extends B{}class Po extends G{}class cn extends X{}class bl extends ee{}class Ru extends se{}class un extends ae{}class hn extends Y{}class ss extends ge{}class bn extends Se{}class pr extends $e{}const xr=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:tn}=xr;class ii{constructor(t=[]){this.segments=t}prepareSegment(t,r,o,u){let p=this.segments[this.segments.length-1];return t>ii.MAX_VERTEX_ARRAY_LENGTH&&Fe(`Max vertices per segment is ${ii.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!p||p.vertexLength+t>ii.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,u){return new ii([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Ls(i,t){return 256*(i=Me(Math.floor(i),0,255))+Me(Math.floor(t),0,255)}ii.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pt("SegmentVector",ii);const To=y([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Io={exports:{}},Pf={exports:{}};Pf.exports=function(i,t){var r,o,u,p,m,_,x,P;for(o=i.length-(r=3&i.length),u=t,m=3432918353,_=461845907,P=0;P<o;)x=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,u=27492+(65535&(p=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&i.charCodeAt(P+2))<<16;case 2:x^=(255&i.charCodeAt(P+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(P)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var O_=Pf.exports,Tf={exports:{}};Tf.exports=function(i,t){for(var r,o=i.length,u=t^o,p=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++p;switch(o){case 3:u^=(255&i.charCodeAt(p+2))<<16;case 2:u^=(255&i.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var os=O_,If=Tf.exports;Io.exports=os,Io.exports.murmur3=os,Io.exports.murmur2=If;var wl=U(Io.exports);class ya{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,u){this.ids.push(Sl(t)),this.positions.push(r,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Sl(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=r?u=m:o=m+1}const p=[];for(;this.ids[o]===r;)p.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return p}static serialize(t,r){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Pl(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const r=new ya;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Sl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:wl(String(i))}function Pl(i,t,r,o){for(;r<o;){const u=i[r+o>>1];let p=r-1,m=o+1;for(;;){do p++;while(i[p]<u);do m--;while(i[m]>u);if(p>=m)break;Ao(i,p,m),Ao(t,3*p,3*m),Ao(t,3*p+1,3*m+1),Ao(t,3*p+2,3*m+2)}m-r<o-m?(Pl(i,t,r,m),r=m+1):(Pl(i,t,m+1,o),o=m)}}function Ao(i,t,r){const o=i[t];i[t]=i[r],i[r]=o}pt("FeaturePositionMap",ya);class va{constructor(t,r){this.gl=t.gl,this.location=r}}class Af extends va{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Av extends va{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Cv extends va{constructor(t,r){super(t,r),this.current=gi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const vw=new Float32Array(16);function F_(i){return[Ls(255*i.r,255*i.g),Ls(255*i.b,255*i.a)]}class Lu{constructor(t,r,o){this.value=t,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new Cv(t,r):new Af(t,r)}}class Tl{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,u){const p=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;p&&t.set(p)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new Av(t,r):new Af(t,r)}}class Os{constructor(t,r,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(p=>({name:`a_${p}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,r,o,u,p){const m=this.paintVertexArray.length,_=this.expression.evaluate(new Ei(0),r,{},u,[],p);this.paintVertexArray.resize(t),this._setPaintValue(m,t,_)}updatePaintArray(t,r,o,u){const p=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,r,p)}_setPaintValue(t,r,o){if(this.type==="color"){const u=F_(o);for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wn{constructor(t,r,o,u,p,m){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,o,u,p){const m=this.expression.evaluate(new Ei(this.zoom),r,{},u,[],p),_=this.expression.evaluate(new Ei(this.zoom+1),r,{},u,[],p),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,_)}updatePaintArray(t,r,o,u){const p=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,r,p,m)}_setPaintValue(t,r,o,u){if(this.type==="color"){const p=F_(o),m=F_(u);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,p[0],p[1],m[0],m[1])}else{for(let p=t;p<r;p++)this.paintVertexArray.emplace(p,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Me(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,r,o){return new Af(t,r)}}class Co{constructor(t,r,o,u,p,m){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(t,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,u,p){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(t,r,o,u){if(!u||!o)return;const{min:p,mid:m,max:_}=o,x=u[p],P=u[m],A=u[_];if(x&&P&&A)for(let k=t;k<r;k++)this.zoomInPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],P.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,To.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,To.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ev{constructor(t,r,o){this.binders={},this._buffers=[];const u=[];for(const p in t.paint._values){if(!o(p))continue;const m=t.paint.get(p);if(!(m instanceof Fn&&co(m.property.specification)))continue;const _=xw(p,t.type),x=m.value,P=m.property.specification.type,A=m.property.useIntegerZoom,k=m.property.specification["property-type"],D=k==="cross-faded"||k==="cross-faded-data-driven";if(x.kind==="constant")this.binders[p]=D?new Tl(x.value,_):new Lu(x.value,_,P),u.push(`/u_${p}`);else if(x.kind==="source"||D){const F=kv(p,P,"source");this.binders[p]=D?new Co(x,P,A,r,F,t.id):new Os(x,_,P,F),u.push(`/a_${p}`)}else{const F=kv(p,P,"composite");this.binders[p]=new Wn(x,_,P,A,r,F),u.push(`/z_${p}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Os||r instanceof Wn?r.maxValue:0}populatePaintArrays(t,r,o,u,p){for(const m in this.binders){const _=this.binders[m];(_ instanceof Os||_ instanceof Wn||_ instanceof Co)&&_.populatePaintArray(t,r,o,u,p)}}setConstantPatternPositions(t,r){for(const o in this.binders){const u=this.binders[o];u instanceof Tl&&u.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,u,p){let m=!1;for(const _ in t){const x=r.getPositions(_);for(const P of x){const A=o.feature(P.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof Os||D instanceof Wn||D instanceof Co)&&D.expression.isStateDependent===!0){const F=u.paint.get(k);D.expression=F.value,D.updatePaintArray(P.start,P.end,A,t[_],p),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Lu||o instanceof Tl)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Os||o instanceof Wn)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Co)for(let u=0;u<To.members.length;u++)t.push(To.members[u].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Lu||o instanceof Tl||o instanceof Wn)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof Lu||p instanceof Tl||p instanceof Wn){for(const m of p.uniformNames)if(r[m]){const _=p.getBinding(t,r[m],m);o.push({name:m,property:u,binding:_})}}}return o}setUniforms(t,r,o,u){for(const{name:p,property:m,binding:_}of r)this.binders[m].setUniform(_,u,o.get(m),p)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof Co){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Os||o instanceof Wn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof Os||o instanceof Wn||o instanceof Co)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Os||r instanceof Wn||r instanceof Co)&&r.destroy()}}}class xa{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Ev(u,r,o);this.needsUpload=!1,this._featureMap=new ya,this._bufferOffset=0}populatePaintArrays(t,r,o,u,p,m){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,u,p,m);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,u){for(const p of o)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(t,this._featureMap,r,p,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function xw(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function kv(i,t,r){const o={color:{source:G,composite:Nt},number:{source:nt,composite:G}},u=function(p){return{"line-pattern":{source:cn,composite:cn},"fill-pattern":{source:cn,composite:cn},"fill-extrusion-pattern":{source:cn,composite:cn}}[p]}(i);return u&&u[r]||o[t][r]}pt("ConstantBinder",Lu),pt("CrossFadedConstantBinder",Tl),pt("SourceExpressionBinder",Os),pt("CrossFadedCompositeBinder",Co),pt("CompositeExpressionBinder",Wn),pt("ProgramConfiguration",Ev,{omit:["_buffers"]}),pt("ProgramConfigurationSet",xa);const nr=8192,B_=Math.pow(2,14)-1,Mv=-B_-1;function ba(i){const t=nr/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let p=0;p<u.length;p++){const m=u[p],_=Math.round(m.x*t),x=Math.round(m.y*t);m.x=Me(_,Mv,B_),m.y=Me(x,Mv,B_),(_<m.x||_>m.x+1||x<m.y||x>m.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function wa(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?ba(i):[]}}function Cf(i,t,r,o,u){i.emplaceBack(2*t+(o+1)/2,2*r+(u+1)/2)}class N_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Mr,this.indexArray=new bn,this.segments=new ii,this.programConfigurations=new xa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const u=this.layers[0],p=[];let m=null,_=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),_=!m.isConstant());for(const{feature:x,id:P,index:A,sourceLayerIndex:k}of t){const D=this.layers[0]._featureFilter.needGeometry,F=wa(x,D);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),F,o))continue;const j=_?m.evaluate(F,{},o):void 0,Z={id:P,properties:x.properties,type:x.type,sourceLayerIndex:k,index:A,geometry:D?F.geometry:ba(x),patterns:{},sortKey:j};p.push(Z)}_&&p.sort((x,P)=>x.sortKey-P.sortKey);for(const x of p){const{geometry:P,index:A,sourceLayerIndex:k}=x,D=t[A].feature;this.addFeature(x,P,A,o),r.featureIndex.insert(D,P,A,k,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,u){for(const p of r)for(const m of p){const _=m.x,x=m.y;if(_<0||_>=nr||x<0||x>=nr)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;Cf(this.layoutVertexArray,_,x,-1,-1),Cf(this.layoutVertexArray,_,x,1,-1),Cf(this.layoutVertexArray,_,x,1,1),Cf(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function zv(i,t){for(let r=0;r<i.length;r++)if(Il(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Il(i,t[r]))return!0;return!!V_(i,t)}function bw(i,t,r){return!!Il(i,t)||!!j_(t,i,r)}function Dv(i,t){if(i.length===1)return Lv(t,i[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let u=0;u<o.length;u++)if(Il(i,o[u]))return!0}for(let r=0;r<i.length;r++)if(Lv(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(V_(i,t[r]))return!0;return!1}function ww(i,t,r){if(i.length>1){if(V_(i,t))return!0;for(let o=0;o<t.length;o++)if(j_(t[o],i,r))return!0}for(let o=0;o<i.length;o++)if(j_(i[o],t,r))return!0;return!1}function V_(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],u=i[r+1];for(let p=0;p<t.length-1;p++)if(Sw(o,u,t[p],t[p+1]))return!0}return!1}function Sw(i,t,r,o){return Ce(i,r,o)!==Ce(t,r,o)&&Ce(i,t,r)!==Ce(i,t,o)}function j_(i,t,r){const o=r*r;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Rv(i,t[u-1],t[u])<o)return!0;return!1}function Rv(i,t,r){const o=t.distSqr(r);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/o;return i.distSqr(u<0?t:u>1?r:r.sub(t)._mult(u)._add(t))}function Lv(i,t){let r,o,u,p=!1;for(let m=0;m<i.length;m++){r=i[m];for(let _=0,x=r.length-1;_<r.length;x=_++)o=r[_],u=r[x],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(p=!p)}return p}function Il(i,t){let r=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const p=i[o],m=i[u];p.y>t.y!=m.y>t.y&&t.x<(m.x-p.x)*(t.y-p.y)/(m.y-p.y)+p.x&&(r=!r)}return r}function Pw(i,t,r){const o=r[0],u=r[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const p=Ce(i,t,r[0]);return p!==Ce(i,t,r[1])||p!==Ce(i,t,r[2])||p!==Ce(i,t,r[3])}function Ou(i,t,r){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Ef(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function kf(i,t,r,o,u){if(!t[0]&&!t[1])return i;const p=V.convert(t)._mult(u);r==="viewport"&&p._rotate(-o);const m=[];for(let _=0;_<i.length;_++)m.push(i[_].sub(p));return m}let Ov,Fv;pt("CircleBucket",N_,{omit:["layers"]});var Tw={get paint(){return Fv=Fv||new d({"circle-radius":new Dt(we.paint_circle["circle-radius"]),"circle-color":new Dt(we.paint_circle["circle-color"]),"circle-blur":new Dt(we.paint_circle["circle-blur"]),"circle-opacity":new Dt(we.paint_circle["circle-opacity"]),"circle-translate":new bt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Dt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Dt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Dt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Ov=Ov||new d({"circle-sort-key":new Dt(we.layout_circle["circle-sort-key"])})}},qr=1e-6,Al=typeof Float32Array<"u"?Float32Array:Array;function U_(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Bv(i,t,r){var o=t[0],u=t[1],p=t[2],m=t[3],_=t[4],x=t[5],P=t[6],A=t[7],k=t[8],D=t[9],F=t[10],j=t[11],Z=t[12],Q=t[13],ne=t[14],xe=t[15],he=r[0],_e=r[1],Ee=r[2],qe=r[3];return i[0]=he*o+_e*_+Ee*k+qe*Z,i[1]=he*u+_e*x+Ee*D+qe*Q,i[2]=he*p+_e*P+Ee*F+qe*ne,i[3]=he*m+_e*A+Ee*j+qe*xe,i[4]=(he=r[4])*o+(_e=r[5])*_+(Ee=r[6])*k+(qe=r[7])*Z,i[5]=he*u+_e*x+Ee*D+qe*Q,i[6]=he*p+_e*P+Ee*F+qe*ne,i[7]=he*m+_e*A+Ee*j+qe*xe,i[8]=(he=r[8])*o+(_e=r[9])*_+(Ee=r[10])*k+(qe=r[11])*Z,i[9]=he*u+_e*x+Ee*D+qe*Q,i[10]=he*p+_e*P+Ee*F+qe*ne,i[11]=he*m+_e*A+Ee*j+qe*xe,i[12]=(he=r[12])*o+(_e=r[13])*_+(Ee=r[14])*k+(qe=r[15])*Z,i[13]=he*u+_e*x+Ee*D+qe*Q,i[14]=he*p+_e*P+Ee*F+qe*ne,i[15]=he*m+_e*A+Ee*j+qe*xe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Fu,Iw=Bv;function Mf(i,t,r){var o=t[0],u=t[1],p=t[2],m=t[3];return i[0]=r[0]*o+r[4]*u+r[8]*p+r[12]*m,i[1]=r[1]*o+r[5]*u+r[9]*p+r[13]*m,i[2]=r[2]*o+r[6]*u+r[10]*p+r[14]*m,i[3]=r[3]*o+r[7]*u+r[11]*p+r[15]*m,i}Fu=new Al(4),Al!=Float32Array&&(Fu[0]=0,Fu[1]=0,Fu[2]=0,Fu[3]=0);class Aw extends n{constructor(t){super(t,Tw)}createBucket(t){return new N_(t)}queryRadius(t){const r=t;return Ou("circle-radius",this,r)+Ou("circle-stroke-width",this,r)+Ef(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,o,u,p,m,_,x){const P=kf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,_),A=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),k=this.paint.get("circle-pitch-alignment")==="map",D=k?P:function(j,Z){return j.map(Q=>Nv(Q,Z))}(P,x),F=k?A*_:A;for(const j of u)for(const Z of j){const Q=k?Z:Nv(Z,x);let ne=F;const xe=Mf([],[Z.x,Z.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=xe[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=m.cameraToCenterDistance/xe[3]),bw(D,Q,ne))return!0}return!1}}function Nv(i,t){const r=Mf([],[i.x,i.y,0,1],t);return new V(r[0]/r[3],r[1]/r[3])}class Vv extends N_{}let jv;pt("HeatmapBucket",Vv,{omit:["layers"]});var Cw={get paint(){return jv=jv||new d({"heatmap-radius":new Dt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Dt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Du(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(we.paint_heatmap["heatmap-opacity"])})}};function q_(i,{width:t,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*r*o}`)}else u=new Uint8Array(t*r*o);return i.width=t,i.height=r,i.data=u,i}function Uv(i,{width:t,height:r},o){if(t===i.width&&r===i.height)return;const u=q_({},{width:t,height:r},o);Z_(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},o),i.width=t,i.height=r,i.data=u.data}function Z_(i,t,r,o,u,p){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,_=t.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const P=((r.y+x)*i.width+r.x)*p,A=((o.y+x)*t.width+o.x)*p;for(let k=0;k<u.width*p;k++)_[A+k]=m[P+k]}return t}class Bu{constructor(t,r){q_(this,t,1,r)}resize(t){Uv(this,t,1)}clone(){return new Bu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,p){Z_(t,r,o,u,p,1)}}class wn{constructor(t,r){q_(this,t,4,r)}resize(t){Uv(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,p){Z_(t,r,o,u,p,4)}}function qv(i){const t={},r=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new wn({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(m,_,x)=>{t[i.evaluationKey]=x;const P=i.expression.evaluate(t);u.data[m+_+0]=Math.floor(255*P.r/P.a),u.data[m+_+1]=Math.floor(255*P.g/P.a),u.data[m+_+2]=Math.floor(255*P.b/P.a),u.data[m+_+3]=Math.floor(255*P.a)};if(i.clips)for(let m=0,_=0;m<o;++m,_+=4*r)for(let x=0,P=0;x<r;x++,P+=4){const A=x/(r-1),{start:k,end:D}=i.clips[m];p(_,P,k*(1-A)+D*A)}else for(let m=0,_=0;m<r;m++,_+=4)p(0,_,m/(r-1));return u}pt("AlphaImage",Bu),pt("RGBAImage",wn);const G_="big-fb";class Ew extends n{createBucket(t){return new Vv(t)}constructor(t){super(t,Cw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(G_)&&this.heatmapFbos.delete(G_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Zv;var kw={get paint(){return Zv=Zv||new d({"hillshade-illumination-direction":new bt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(we.paint_hillshade["hillshade-accent-color"])})}};class Mw extends n{constructor(t){super(t,kw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const zw=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dw}=zw;function Gv(i,t,r=2){const o=t&&t.length,u=o?t[0]*r:i.length;let p=Hv(i,0,u,r,!0);const m=[];if(!p||p.next===p.prev)return m;let _,x,P;if(o&&(p=function(A,k,D,F){const j=[];for(let Z=0,Q=k.length;Z<Q;Z++){const ne=Hv(A,k[Z]*F,Z<Q-1?k[Z+1]*F:A.length,F,!1);ne===ne.next&&(ne.steiner=!0),j.push(jw(ne))}j.sort(Bw);for(let Z=0;Z<j.length;Z++)D=Nw(j[Z],D);return D}(i,t,p,r)),i.length>80*r){_=1/0,x=1/0;let A=-1/0,k=-1/0;for(let D=r;D<u;D+=r){const F=i[D],j=i[D+1];F<_&&(_=F),j<x&&(x=j),F>A&&(A=F),j>k&&(k=j)}P=Math.max(A-_,k-x),P=P!==0?32767/P:0}return Nu(p,m,r,_,x,P,0),m}function Hv(i,t,r,o,u){let p;if(u===function(m,_,x,P){let A=0;for(let k=_,D=x-P;k<x;k+=P)A+=(m[D]-m[k])*(m[k+1]+m[D+1]),D=k;return A}(i,t,r,o)>0)for(let m=t;m<r;m+=o)p=Kv(m/o|0,i[m],i[m+1],p);else for(let m=r-o;m>=t;m-=o)p=Kv(m/o|0,i[m],i[m+1],p);return p&&zf(p,p.next)&&(ju(p),p=p.next),p}function Sa(i,t){if(!i)return i;t||(t=i);let r,o=i;do if(r=!1,o.steiner||!zf(o,o.next)&&er(o.prev,o,o.next)!==0)o=o.next;else{if(ju(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function Nu(i,t,r,o,u,p,m){if(!i)return;!m&&p&&function(x,P,A,k){let D=x;do D.z===0&&(D.z=H_(D.x,D.y,P,A,k)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(F){let j,Z=1;do{let Q,ne=F;F=null;let xe=null;for(j=0;ne;){j++;let he=ne,_e=0;for(let qe=0;qe<Z&&(_e++,he=he.nextZ,he);qe++);let Ee=Z;for(;_e>0||Ee>0&&he;)_e!==0&&(Ee===0||!he||ne.z<=he.z)?(Q=ne,ne=ne.nextZ,_e--):(Q=he,he=he.nextZ,Ee--),xe?xe.nextZ=Q:F=Q,Q.prevZ=xe,xe=Q;ne=he}xe.nextZ=null,Z*=2}while(j>1)}(D)}(i,o,u,p);let _=i;for(;i.prev!==i.next;){const x=i.prev,P=i.next;if(p?Lw(i,o,u,p):Rw(i))t.push(x.i,i.i,P.i),ju(i),i=P.next,_=P.next;else if((i=P)===_){m?m===1?Nu(i=Ow(Sa(i),t),t,r,o,u,p,2):m===2&&Fw(i,t,r,o,u,p):Nu(Sa(i),t,r,o,u,p,1);break}}}function Rw(i){const t=i.prev,r=i,o=i.next;if(er(t,r,o)>=0)return!1;const u=t.x,p=r.x,m=o.x,_=t.y,x=r.y,P=o.y,A=u<p?u<m?u:m:p<m?p:m,k=_<x?_<P?_:P:x<P?x:P,D=u>p?u>m?u:m:p>m?p:m,F=_>x?_>P?_:P:x>P?x:P;let j=o.next;for(;j!==t;){if(j.x>=A&&j.x<=D&&j.y>=k&&j.y<=F&&Cl(u,_,p,x,m,P,j.x,j.y)&&er(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Lw(i,t,r,o){const u=i.prev,p=i,m=i.next;if(er(u,p,m)>=0)return!1;const _=u.x,x=p.x,P=m.x,A=u.y,k=p.y,D=m.y,F=_<x?_<P?_:P:x<P?x:P,j=A<k?A<D?A:D:k<D?k:D,Z=_>x?_>P?_:P:x>P?x:P,Q=A>k?A>D?A:D:k>D?k:D,ne=H_(F,j,t,r,o),xe=H_(Z,Q,t,r,o);let he=i.prevZ,_e=i.nextZ;for(;he&&he.z>=ne&&_e&&_e.z<=xe;){if(he.x>=F&&he.x<=Z&&he.y>=j&&he.y<=Q&&he!==u&&he!==m&&Cl(_,A,x,k,P,D,he.x,he.y)&&er(he.prev,he,he.next)>=0||(he=he.prevZ,_e.x>=F&&_e.x<=Z&&_e.y>=j&&_e.y<=Q&&_e!==u&&_e!==m&&Cl(_,A,x,k,P,D,_e.x,_e.y)&&er(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;he&&he.z>=ne;){if(he.x>=F&&he.x<=Z&&he.y>=j&&he.y<=Q&&he!==u&&he!==m&&Cl(_,A,x,k,P,D,he.x,he.y)&&er(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;_e&&_e.z<=xe;){if(_e.x>=F&&_e.x<=Z&&_e.y>=j&&_e.y<=Q&&_e!==u&&_e!==m&&Cl(_,A,x,k,P,D,_e.x,_e.y)&&er(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function Ow(i,t){let r=i;do{const o=r.prev,u=r.next.next;!zf(o,u)&&Wv(o,r,r.next,u)&&Vu(o,u)&&Vu(u,o)&&(t.push(o.i,r.i,u.i),ju(r),ju(r.next),r=i=u),r=r.next}while(r!==i);return Sa(r)}function Fw(i,t,r,o,u,p){let m=i;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&Uw(m,_)){let x=Xv(m,_);return m=Sa(m,m.next),x=Sa(x,x.next),Nu(m,t,r,o,u,p,0),void Nu(x,t,r,o,u,p,0)}_=_.next}m=m.next}while(m!==i)}function Bw(i,t){return i.x-t.x}function Nw(i,t){const r=function(u,p){let m=p;const _=u.x,x=u.y;let P,A=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const Z=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=_&&Z>A&&(A=Z,P=m.x<m.next.x?m:m.next,Z===_))return P}m=m.next}while(m!==p);if(!P)return null;const k=P,D=P.x,F=P.y;let j=1/0;m=P;do{if(_>=m.x&&m.x>=D&&_!==m.x&&Cl(x<F?_:A,x,D,F,x<F?A:_,x,m.x,m.y)){const Z=Math.abs(x-m.y)/(_-m.x);Vu(m,u)&&(Z<j||Z===j&&(m.x>P.x||m.x===P.x&&Vw(P,m)))&&(P=m,j=Z)}m=m.next}while(m!==k);return P}(i,t);if(!r)return t;const o=Xv(r,i);return Sa(o,o.next),Sa(r,r.next)}function Vw(i,t){return er(i.prev,i,t.prev)<0&&er(t.next,i,i.next)<0}function H_(i,t,r,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function jw(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Cl(i,t,r,o,u,p,m,_){return(u-m)*(t-_)>=(i-m)*(p-_)&&(i-m)*(o-_)>=(r-m)*(t-_)&&(r-m)*(p-_)>=(u-m)*(o-_)}function Uw(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,o){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&Wv(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(i,t)&&(Vu(i,t)&&Vu(t,i)&&function(r,o){let u=r,p=!1;const m=(r.x+o.x)/2,_=(r.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==r);return p}(i,t)&&(er(i.prev,i,t.prev)||er(i,t.prev,t))||zf(i,t)&&er(i.prev,i,i.next)>0&&er(t.prev,t,t.next)>0)}function er(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function zf(i,t){return i.x===t.x&&i.y===t.y}function Wv(i,t,r,o){const u=Rf(er(i,t,r)),p=Rf(er(i,t,o)),m=Rf(er(r,o,i)),_=Rf(er(r,o,t));return u!==p&&m!==_||!(u!==0||!Df(i,r,t))||!(p!==0||!Df(i,o,t))||!(m!==0||!Df(r,i,o))||!(_!==0||!Df(r,t,o))}function Df(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Rf(i){return i>0?1:i<0?-1:0}function Vu(i,t){return er(i.prev,i,i.next)<0?er(i,t,i.next)>=0&&er(i,i.prev,t)>=0:er(i,t,i.prev)<0||er(i,i.next,t)<0}function Xv(i,t){const r=W_(i.i,i.x,i.y),o=W_(t.i,t.x,t.y),u=i.next,p=t.prev;return i.next=t,t.prev=i,r.next=u,u.prev=r,o.next=r,r.prev=o,p.next=o,o.prev=p,o}function Kv(i,t,r,o){const u=W_(i,t,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function ju(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function W_(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function X_(i,t,r){const o=r.patternDependencies;let u=!1;for(const p of t){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const _=m.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function K_(i,t,r,o,u){const p=u.patternDependencies;for(const m of t){const _=m.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o-1},r,{},u.availableImages),P=_.evaluate({zoom:o},r,{},u.availableImages),A=_.evaluate({zoom:o+1},r,{},u.availableImages);x=x&&x.name?x.name:x,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,p[x]=!0,p[P]=!0,p[A]=!0,r.patterns[m.id]={min:x,mid:P,max:A}}}return r}class J_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Bn,this.indexArray=new bn,this.indexArray2=new pr,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new ii,this.segments2=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=X_("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,D=wa(_,k);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=p?u.evaluate(D,{},o,r.availableImages):void 0,j={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:k?D.geometry:ba(_),patterns:{},sortKey:F};m.push(j)}p&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const k=K_("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,x,P,o,{});r.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Dw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,u,p){for(const m of Qa(r,500)){let _=0;for(const F of m)_+=F.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),P=x.vertexLength,A=[],k=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&k.push(A.length/2);const j=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=j.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),A.push(F[0].x),A.push(F[0].y);for(let Q=1;Q<F.length;Q++)this.layoutVertexArray.emplaceBack(F[Q].x,F[Q].y),this.indexArray2.emplaceBack(Z+Q-1,Z+Q),A.push(F[Q].x),A.push(F[Q].y);j.vertexLength+=F.length,j.primitiveLength+=F.length}const D=Gv(A,k);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(P+D[F],P+D[F+1],P+D[F+2]);x.vertexLength+=_,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}}let Jv,Yv;pt("FillBucket",J_,{omit:["layers","patternFeatures"]});var qw={get paint(){return Yv=Yv||new d({"fill-antialias":new bt(we.paint_fill["fill-antialias"]),"fill-opacity":new Dt(we.paint_fill["fill-opacity"]),"fill-color":new Dt(we.paint_fill["fill-color"]),"fill-outline-color":new Dt(we.paint_fill["fill-outline-color"]),"fill-translate":new bt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new yl(we.paint_fill["fill-pattern"])})},get layout(){return Jv=Jv||new d({"fill-sort-key":new Dt(we.layout_fill["fill-sort-key"])})}};class Zw extends n{constructor(t){super(t,qw)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new J_(t)}queryRadius(){return Ef(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,o,u,p,m,_){return Dv(kf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,_),u)}isTileClipped(){return!0}}const Gw=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Hw=y([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ww}=Gw;var Eo={},Xw=q,Qv=El;function El(i,t,r,o,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(Kw,this,t)}function Kw(i,t,r){i==1?t.id=r.readVarint():i==2?function(o,u){for(var p=o.readVarint()+o.pos;o.pos<p;){var m=u._keys[o.readVarint()],_=u._values[o.readVarint()];u.properties[m]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function Jw(i){for(var t,r,o=0,u=0,p=i.length,m=p-1;u<p;m=u++)o+=((r=i[m]).x-(t=i[u]).x)*(t.y+r.y);return o}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,o=1,u=0,p=0,m=0,_=[];i.pos<r;){if(u<=0){var x=i.readVarint();o=7&x,u=x>>3}if(u--,o===1||o===2)p+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&_.push(t),t=[]),t.push(new Xw(p,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&_.push(t),_},El.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,o=0,u=0,p=0,m=1/0,_=-1/0,x=1/0,P=-1/0;i.pos<t;){if(o<=0){var A=i.readVarint();r=7&A,o=A>>3}if(o--,r===1||r===2)(u+=i.readSVarint())<m&&(m=u),u>_&&(_=u),(p+=i.readSVarint())<x&&(x=p),p>P&&(P=p);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,_,P]},El.prototype.toGeoJSON=function(i,t,r){var o,u,p=this.extent*Math.pow(2,r),m=this.extent*i,_=this.extent*t,x=this.loadGeometry(),P=El.types[this.type];function A(F){for(var j=0;j<F.length;j++){var Z=F[j];F[j]=[360*(Z.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+_)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(o=0;o<x.length;o++)k[o]=x[o][0];A(x=k);break;case 2:for(o=0;o<x.length;o++)A(x[o]);break;case 3:for(x=function(F){var j=F.length;if(j<=1)return[F];for(var Z,Q,ne=[],xe=0;xe<j;xe++){var he=Jw(F[xe]);he!==0&&(Q===void 0&&(Q=he<0),Q===he<0?(Z&&ne.push(Z),Z=[F[xe]]):Z.push(F[xe]))}return Z&&ne.push(Z),ne}(x),o=0;o<x.length;o++)for(u=0;u<x[o].length;u++)A(x[o][u])}x.length===1?x=x[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Yw=Qv,$v=ex;function ex(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Qw,this,t),this.length=this._features.length}function Qw(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(o){for(var u=null,p=o.readVarint()+o.pos;o.pos<p;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(r))}ex.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Yw(this._pbf,t,this.extent,this._keys,this._values)};var $w=$v;function e1(i,t,r){if(i===3){var o=new $w(r,r.readVarint()+r.pos);o.length&&(t[o.name]=o)}}Eo.VectorTile=function(i,t){this.layers=i.readFields(e1,{},t)},Eo.VectorTileFeature=Qv,Eo.VectorTileLayer=$v;const t1=Eo.VectorTileFeature.types,Y_=Math.pow(2,13);function Uu(i,t,r,o,u,p,m,_){i.emplaceBack(t,r,2*Math.floor(o*Y_)+m,u*Y_*2,p*Y_*2,Math.round(_))}class Q_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new So,this.centroidVertexArray=new vr,this.indexArray=new bn,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new ii,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=X_("fill-extrusion",this.layers,r);for(const{feature:u,id:p,index:m,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,P=wa(u,x);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),P,o))continue;const A={id:p,sourceLayerIndex:_,index:m,geometry:x?P.geometry:ba(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(K_("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,m,o,{}),r.featureIndex.insert(u,A.geometry,m,_,this.index,!0)}}addFeatures(t,r,o){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,r,o)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ww),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Hw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,u,p){for(const m of Qa(r,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const j of m)x+=j.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const j of m){if(j.length===0||r1(j))continue;let Z=0;for(let Q=0;Q<j.length;Q++){const ne=j[Q];if(Q>=1){const xe=j[Q-1];if(!i1(ne,xe)){P.vertexLength+4>ii.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=ne.sub(xe)._perp()._unit(),_e=xe.dist(ne);Z+_e>32768&&(Z=0),Uu(this.layoutVertexArray,ne.x,ne.y,he.x,he.y,0,0,Z),Uu(this.layoutVertexArray,ne.x,ne.y,he.x,he.y,0,1,Z),_.x+=2*ne.x,_.y+=2*ne.y,_.vertexCount+=2,Z+=_e,Uu(this.layoutVertexArray,xe.x,xe.y,he.x,he.y,0,0,Z),Uu(this.layoutVertexArray,xe.x,xe.y,he.x,he.y,0,1,Z),_.x+=2*xe.x,_.y+=2*xe.y,_.vertexCount+=2;const Ee=P.vertexLength;this.indexArray.emplaceBack(Ee,Ee+2,Ee+1),this.indexArray.emplaceBack(Ee+1,Ee+2,Ee+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+x>ii.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),t1[t.type]!=="Polygon")continue;const A=[],k=[],D=P.vertexLength;for(const j of m)if(j.length!==0){j!==m[0]&&k.push(A.length/2);for(let Z=0;Z<j.length;Z++){const Q=j[Z];Uu(this.layoutVertexArray,Q.x,Q.y,0,0,1,1,0),_.x+=Q.x,_.y+=Q.y,_.vertexCount+=1,A.push(Q.x),A.push(Q.y)}}const F=Gv(A,k);for(let j=0;j<F.length;j+=3)this.indexArray.emplaceBack(D+F[j],D+F[j+2],D+F[j+1]);P.primitiveLength+=F.length/3,P.vertexLength+=x;for(let j=0;j<_.vertexCount;j++){const Z=Math.floor(_.x/_.vertexCount),Q=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(Z,Q)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}}function i1(i,t){return i.x===t.x&&(i.x<0||i.x>nr)||i.y===t.y&&(i.y<0||i.y>nr)}function r1(i){return i.every(t=>t.x<0)||i.every(t=>t.x>nr)||i.every(t=>t.y<0)||i.every(t=>t.y>nr)}let tx;pt("FillExtrusionBucket",Q_,{omit:["layers","features"]});var n1={get paint(){return tx=tx||new d({"fill-extrusion-opacity":new bt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Dt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Dt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Dt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class s1 extends n{constructor(t){super(t,n1)}createBucket(t){return new Q_(t)}queryRadius(){return Ef(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,o,u,p,m,_,x){const P=kf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,_),A=this.paint.get("fill-extrusion-height").evaluate(r,o),k=this.paint.get("fill-extrusion-base").evaluate(r,o),D=function(j,Z,Q,ne){const xe=[];for(const he of j){const _e=[he.x,he.y,0,1];Mf(_e,_e,Z),xe.push(new V(_e[0]/_e[3],_e[1]/_e[3]))}return xe}(P,x),F=function(j,Z,Q,ne){const xe=[],he=[],_e=ne[8]*Z,Ee=ne[9]*Z,qe=ne[10]*Z,ct=ne[11]*Z,zt=ne[8]*Q,ot=ne[9]*Q,rt=ne[10]*Q,Pt=ne[11]*Q;for(const ft of j){const dt=[],De=[];for(const Tt of ft){const St=Tt.x,Bt=Tt.y,Si=ne[0]*St+ne[4]*Bt+ne[12],vi=ne[1]*St+ne[5]*Bt+ne[13],cr=ne[2]*St+ne[6]*Bt+ne[14],Nn=ne[3]*St+ne[7]*Bt+ne[15],wr=cr+qe,ur=Nn+ct,Zr=Si+zt,Gr=vi+ot,Hr=cr+rt,Ki=Nn+Pt,hr=new V((Si+_e)/ur,(vi+Ee)/ur);hr.z=wr/ur,dt.push(hr);const zr=new V(Zr/Ki,Gr/Ki);zr.z=Hr/Ki,De.push(zr)}xe.push(dt),he.push(De)}return[xe,he]}(u,k,A,x);return function(j,Z,Q){let ne=1/0;Dv(Q,Z)&&(ne=ix(Q,Z[0]));for(let xe=0;xe<Z.length;xe++){const he=Z[xe],_e=j[xe];for(let Ee=0;Ee<he.length-1;Ee++){const qe=he[Ee],ct=[qe,he[Ee+1],_e[Ee+1],_e[Ee],qe];zv(Q,ct)&&(ne=Math.min(ne,ix(Q,ct)))}}return ne!==1/0&&ne}(F[0],F[1],D)}}function qu(i,t){return i.x*t.x+i.y*t.y}function ix(i,t){if(i.length===1){let r=0;const o=t[r++];let u;for(;!u||o.equals(u);)if(u=t[r++],!u)return 1/0;for(;r<t.length;r++){const p=t[r],m=i[0],_=u.sub(o),x=p.sub(o),P=m.sub(o),A=qu(_,_),k=qu(_,x),D=qu(x,x),F=qu(P,_),j=qu(P,x),Z=A*D-k*k,Q=(D*F-k*j)/Z,ne=(A*j-k*F)/Z,xe=o.z*(1-Q-ne)+u.z*Q+p.z*ne;if(isFinite(xe))return xe}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const o1=y([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:a1}=o1,l1=y([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:c1}=l1,u1=Eo.VectorTileFeature.types,h1=Math.cos(Math.PI/180*37.5),rx=Math.pow(2,14)/.5;class $_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new xl,this.layoutVertexArray2=new Po,this.indexArray=new bn,this.programConfigurations=new xa(t.layers,t.zoom),this.segments=new ii,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=X_("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),p=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,D=wa(_,k);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=p?u.evaluate(D,{},o):void 0,j={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:k?D.geometry:ba(_),patterns:{},sortKey:F};m.push(j)}p&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const k=K_("line",this.layers,_,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(_,x,P,o,{});r.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,c1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,a1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,u,p){const m=this.layers[0].layout,_=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),P=m.get("line-miter-limit"),A=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const k of r)this.addLine(k,t,_,x,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,p,u)}addLine(t,r,o,u,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<t.length-1;ne++)this.totalDistance+=t[ne].dist(t[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=u1[r.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let P=0;for(;P<x-1&&t[P].equals(t[P+1]);)P++;if(x<(_?3:2))return;o==="bevel"&&(p=1.05);const A=this.overscaling<=16?15*nr/(512*this.overscaling):0,k=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,F,j,Z,Q;this.e1=this.e2=-1,_&&(D=t[x-2],Q=t[P].sub(D)._unit()._perp());for(let ne=P;ne<x;ne++){if(j=ne===x-1?_?t[P+1]:void 0:t[ne+1],j&&t[ne].equals(j))continue;Q&&(Z=Q),D&&(F=D),D=t[ne],Q=j?j.sub(D)._unit()._perp():Z,Z=Z||Q;let xe=Z.add(Q);xe.x===0&&xe.y===0||xe._unit();const he=Z.x*Q.x+Z.y*Q.y,_e=xe.x*Q.x+xe.y*Q.y,Ee=_e!==0?1/_e:1/0,qe=2*Math.sqrt(2-2*_e),ct=_e<h1&&F&&j,zt=Z.x*Q.y-Z.y*Q.x>0;if(ct&&ne>P){const Pt=D.dist(F);if(Pt>2*A){const ft=D.sub(D.sub(F)._mult(A/Pt)._round());this.updateDistance(F,ft),this.addCurrentVertex(ft,Z,0,0,k),F=ft}}const ot=F&&j;let rt=ot?o:_?"butt":u;if(ot&&rt==="round"&&(Ee<m?rt="miter":Ee<=2&&(rt="fakeround")),rt==="miter"&&Ee>p&&(rt="bevel"),rt==="bevel"&&(Ee>2&&(rt="flipbevel"),Ee<p&&(rt="miter")),F&&this.updateDistance(F,D),rt==="miter")xe._mult(Ee),this.addCurrentVertex(D,xe,0,0,k);else if(rt==="flipbevel"){if(Ee>100)xe=Q.mult(-1);else{const Pt=Ee*Z.add(Q).mag()/Z.sub(Q).mag();xe._perp()._mult(Pt*(zt?-1:1))}this.addCurrentVertex(D,xe,0,0,k),this.addCurrentVertex(D,xe.mult(-1),0,0,k)}else if(rt==="bevel"||rt==="fakeround"){const Pt=-Math.sqrt(Ee*Ee-1),ft=zt?Pt:0,dt=zt?0:Pt;if(F&&this.addCurrentVertex(D,Z,ft,dt,k),rt==="fakeround"){const De=Math.round(180*qe/Math.PI/20);for(let Tt=1;Tt<De;Tt++){let St=Tt/De;if(St!==.5){const Si=St-.5;St+=St*Si*(St-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Si*Si+(.848013+he*(.215638*he-1.06021)))}const Bt=Q.sub(Z)._mult(St)._add(Z)._unit()._mult(zt?-1:1);this.addHalfVertex(D,Bt.x,Bt.y,!1,zt,0,k)}}j&&this.addCurrentVertex(D,Q,-ft,-dt,k)}else if(rt==="butt")this.addCurrentVertex(D,xe,0,0,k);else if(rt==="square"){const Pt=F?1:-1;this.addCurrentVertex(D,xe,Pt,Pt,k)}else rt==="round"&&(F&&(this.addCurrentVertex(D,Z,0,0,k),this.addCurrentVertex(D,Z,1,1,k,!0)),j&&(this.addCurrentVertex(D,Q,-1,-1,k,!0),this.addCurrentVertex(D,Q,0,0,k)));if(ct&&ne<x-1){const Pt=D.dist(j);if(Pt>2*A){const ft=D.add(j.sub(D)._mult(A/Pt)._round());this.updateDistance(D,ft),this.addCurrentVertex(ft,Q,0,0,k),D=ft}}}}addCurrentVertex(t,r,o,u,p,m=!1){const _=r.y*u-r.x,x=-r.y-r.x*u;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,m,!1,o,p),this.addHalfVertex(t,_,x,m,!0,-u,p),this.distance>rx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,u,p,m))}addHalfVertex({x:t,y:r},o,u,p,m,_,x){const P=.5*(this.lineClips?this.scaledDistance*(rx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(p?1:0),(r<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),x.primitiveLength++),m?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let nx,sx;pt("LineBucket",$_,{omit:["layers","patternFeatures"]});var ox={get paint(){return sx=sx||new d({"line-opacity":new Dt(we.paint_line["line-opacity"]),"line-color":new Dt(we.paint_line["line-color"]),"line-translate":new bt(we.paint_line["line-translate"]),"line-translate-anchor":new bt(we.paint_line["line-translate-anchor"]),"line-width":new Dt(we.paint_line["line-width"]),"line-gap-width":new Dt(we.paint_line["line-gap-width"]),"line-offset":new Dt(we.paint_line["line-offset"]),"line-blur":new Dt(we.paint_line["line-blur"]),"line-dasharray":new vl(we.paint_line["line-dasharray"]),"line-pattern":new yl(we.paint_line["line-pattern"]),"line-gradient":new Du(we.paint_line["line-gradient"])})},get layout(){return nx=nx||new d({"line-cap":new bt(we.layout_line["line-cap"]),"line-join":new Dt(we.layout_line["line-join"]),"line-miter-limit":new bt(we.layout_line["line-miter-limit"]),"line-round-limit":new bt(we.layout_line["line-round-limit"]),"line-sort-key":new Dt(we.layout_line["line-sort-key"])})}};class d1 extends Dt{possiblyEvaluate(t,r){return r=new Ei(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,u){return r=Je({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,u)}}let Lf;class p1 extends n{constructor(t){super(t,ox),this.gradientVersion=0,Lf||(Lf=new d1(ox.paint.properties["line-width"].specification),Lf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ro,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Lf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new $_(t)}queryRadius(t){const r=t,o=ax(Ou("line-width",this,r),Ou("line-gap-width",this,r)),u=Ou("line-offset",this,r);return o/2+Math.abs(u)+Ef(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,o,u,p,m,_){const x=kf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,_),P=_/2*ax(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),A=this.paint.get("line-offset").evaluate(r,o);return A&&(u=function(k,D){const F=[];for(let j=0;j<k.length;j++){const Z=k[j],Q=[];for(let ne=0;ne<Z.length;ne++){const xe=Z[ne-1],he=Z[ne],_e=Z[ne+1],Ee=ne===0?new V(0,0):he.sub(xe)._unit()._perp(),qe=ne===Z.length-1?new V(0,0):_e.sub(he)._unit()._perp(),ct=Ee._add(qe)._unit(),zt=ct.x*qe.x+ct.y*qe.y;zt!==0&&ct._mult(1/zt),Q.push(ct._mult(D)._add(he))}F.push(Q)}return F}(u,A*_)),function(k,D,F){for(let j=0;j<D.length;j++){const Z=D[j];if(k.length>=3){for(let Q=0;Q<Z.length;Q++)if(Il(k,Z[Q]))return!0}if(ww(k,Z,F))return!0}return!1}(x,u,P)}isTileClipped(){return!0}}function ax(i,t){return t>0?t+2*i:i}const f1=y([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),m1=y([{name:"a_projected_pos",components:3,type:"Float32"}],4);y([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const g1=y([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);y([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lx=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_1=y([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function y1(i,t,r){return i.sections.forEach(o=>{o.text=function(u,p,m){const _=p.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),en.applyArabicShaping&&(u=en.applyArabicShaping(u)),u}(o.text,t,r)}),i}y([{name:"triangle",components:3,type:"Uint16"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),y([{type:"Float32",name:"offsetX"}]),y([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),y([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var or=24,cx=yi,ux=function(i,t,r,o,u){var p,m,_=8*u-o-1,x=(1<<_)-1,P=x>>1,A=-7,k=u-1,D=-1,F=i[t+k];for(k+=D,p=F&(1<<-A)-1,F>>=-A,A+=_;A>0;p=256*p+i[t+k],k+=D,A-=8);for(m=p&(1<<-A)-1,p>>=-A,A+=o;A>0;m=256*m+i[t+k],k+=D,A-=8);if(p===0)p=1-P;else{if(p===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,o),p-=P}return(F?-1:1)*m*Math.pow(2,p-o)},hx=function(i,t,r,o,u,p){var m,_,x,P=8*p-u-1,A=(1<<P)-1,k=A>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,j=1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,m=A):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+k>=1?D/x:D*Math.pow(2,1-k))*x>=2&&(m++,x/=2),m+k>=A?(_=0,m=A):m+k>=1?(_=(t*x-1)*Math.pow(2,u),m+=k):(_=t*Math.pow(2,k-1)*Math.pow(2,u),m=0));u>=8;i[r+F]=255&_,F+=j,_/=256,u-=8);for(m=m<<u|_,P+=u;P>0;i[r+F]=255&m,F+=j,m/=256,P-=8);i[r+F-j]|=128*Z};function yi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}yi.Varint=0,yi.Fixed64=1,yi.Bytes=2,yi.Fixed32=5;var ey=4294967296,dx=1/ey,px=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Fs(i){return i.type===yi.Bytes?i.readVarint()+i.pos:i.pos+1}function kl(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function fx(i,t,r){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(o);for(var u=r.pos-1;u>=i;u--)r.buf[u+o]=r.buf[u]}function v1(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function x1(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function b1(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function w1(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function S1(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function P1(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function T1(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function I1(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function A1(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Of(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Ml(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function mx(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}yi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),u=o>>3,p=this.pos;this.type=7&o,i(u,t,this),this.pos===p&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Of(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=mx(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Of(this.buf,this.pos)+Of(this.buf,this.pos+4)*ey;return this.pos+=8,i},readSFixed64:function(){var i=Of(this.buf,this.pos)+mx(this.buf,this.pos+4)*ey;return this.pos+=8,i},readFloat:function(){var i=ux(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ux(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,o=this.buf;return t=127&(r=o[this.pos++]),r<128?t:(t|=(127&(r=o[this.pos++]))<<7,r<128?t:(t|=(127&(r=o[this.pos++]))<<14,r<128?t:(t|=(127&(r=o[this.pos++]))<<21,r<128?t:function(u,p,m){var _,x,P=m.buf;if(_=(112&(x=P[m.pos++]))>>4,x<128||(_|=(127&(x=P[m.pos++]))<<3,x<128)||(_|=(127&(x=P[m.pos++]))<<10,x<128)||(_|=(127&(x=P[m.pos++]))<<17,x<128)||(_|=(127&(x=P[m.pos++]))<<24,x<128)||(_|=(1&(x=P[m.pos++]))<<31,x<128))return kl(u,_,p);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&px?function(r,o,u){return px.decode(r.subarray(o,u))}(this.buf,t,i):function(r,o,u){for(var p="",m=o;m<u;){var _,x,P,A=r[m],k=null,D=A>239?4:A>223?3:A>191?2:1;if(m+D>u)break;D===1?A<128&&(k=A):D===2?(192&(_=r[m+1]))==128&&(k=(31&A)<<6|63&_)<=127&&(k=null):D===3?(x=r[m+2],(192&(_=r[m+1]))==128&&(192&x)==128&&((k=(15&A)<<12|(63&_)<<6|63&x)<=2047||k>=55296&&k<=57343)&&(k=null)):D===4&&(x=r[m+2],P=r[m+3],(192&(_=r[m+1]))==128&&(192&x)==128&&(192&P)==128&&((k=(15&A)<<18|(63&_)<<12|(63&x)<<6|63&P)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,D=1):k>65535&&(k-=65536,p+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),p+=String.fromCharCode(k),m+=D}return p}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==yi.Bytes)return i.push(this.readVarint(t));var r=Fs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==yi.Bytes)return i.push(this.readSVarint());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==yi.Bytes)return i.push(this.readBoolean());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==yi.Bytes)return i.push(this.readFloat());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==yi.Bytes)return i.push(this.readDouble());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==yi.Bytes)return i.push(this.readFixed32());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==yi.Bytes)return i.push(this.readSFixed32());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==yi.Bytes)return i.push(this.readFixed64());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==yi.Bytes)return i.push(this.readSFixed64());var t=Fs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===yi.Varint)for(;this.buf[this.pos++]>127;);else if(t===yi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===yi.Fixed32)this.pos+=4;else{if(t!==yi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ml(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ml(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ml(this.buf,-1&i,this.pos),Ml(this.buf,Math.floor(i*dx),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ml(this.buf,-1&i,this.pos),Ml(this.buf,Math.floor(i*dx),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(p,m,_){_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,p>>>=7,_.buf[_.pos++]=127&p|128,_.buf[_.pos]=127&(p>>>=7)}(o,0,r),function(p,m){var _=(7&p)<<4;m.buf[m.pos++]|=_|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,p){for(var m,_,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!_){m>56319||x+1===u.length?(o[p++]=239,o[p++]=191,o[p++]=189):_=m;continue}if(m<56320){o[p++]=239,o[p++]=191,o[p++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(o[p++]=239,o[p++]=191,o[p++]=189,_=null);m<128?o[p++]=m:(m<2048?o[p++]=m>>6|192:(m<65536?o[p++]=m>>12|224:(o[p++]=m>>18|240,o[p++]=m>>12&63|128),o[p++]=m>>6&63|128),o[p++]=63&m|128)}return p}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&fx(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),hx(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),hx(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var o=this.pos-r;o>=128&&fx(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,r){this.writeTag(i,yi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,v1,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,x1,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,S1,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,b1,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,w1,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,P1,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,T1,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,I1,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,A1,t)},writeBytesField:function(i,t){this.writeTag(i,yi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,yi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,yi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,yi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,yi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,yi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,yi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,yi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,yi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,yi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var ty=U(cx);const iy=3;function C1(i,t,r){i===1&&r.readMessage(E1,t)}function E1(i,t,r){if(i===3){const{id:o,bitmap:u,width:p,height:m,left:_,top:x,advance:P}=r.readMessage(k1,{});t.push({id:o,bitmap:new Bu({width:p+2*iy,height:m+2*iy},u),metrics:{width:p,height:m,left:_,top:x,advance:P}})}}function k1(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const gx=iy;function _x(i){let t=0,r=0;for(const m of i)t+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,_)=>_.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let u=0,p=0;for(const m of i)for(let _=o.length-1;_>=0;_--){const x=o[_];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const P=o.pop();_<o.length&&(o[_]=P)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(o.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:p,fill:t/(u*p)||0}}const rn=1;class ry{constructor(t,{pixelRatio:r,version:o,stretchX:u,stretchY:p,content:m,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=u,this.stretchY=p,this.content=m,this.version=o,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+rn,this.paddedRect.y+rn]}get br(){return[this.paddedRect.x+this.paddedRect.w-rn,this.paddedRect.y+this.paddedRect.h-rn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*rn)/this.pixelRatio,(this.paddedRect.h-2*rn)/this.pixelRatio]}}class yx{constructor(t,r){const o={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(t,o,p),this.addImages(r,u,p);const{w:m,h:_}=_x(p),x=new wn({width:m||1,height:_||1});for(const P in t){const A=t[P],k=o[P].paddedRect;wn.copy(A.data,x,{x:0,y:0},{x:k.x+rn,y:k.y+rn},A.data)}for(const P in r){const A=r[P],k=u[P].paddedRect,D=k.x+rn,F=k.y+rn,j=A.data.width,Z=A.data.height;wn.copy(A.data,x,{x:0,y:0},{x:D,y:F},A.data),wn.copy(A.data,x,{x:0,y:Z-1},{x:D,y:F-1},{width:j,height:1}),wn.copy(A.data,x,{x:0,y:0},{x:D,y:F+Z},{width:j,height:1}),wn.copy(A.data,x,{x:j-1,y:0},{x:D-1,y:F},{width:1,height:Z}),wn.copy(A.data,x,{x:0,y:0},{x:D+j,y:F},{width:1,height:Z})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(t,r,o){for(const u in t){const p=t[u],m={x:0,y:0,w:p.data.width+2*rn,h:p.data.height+2*rn};o.push(m),r[u]=new ry(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[u,p]=t.tl;o.update(r.data,void 0,{x:u,y:p})}}var ko;pt("ImagePosition",ry),pt("ImageAtlas",yx),w.ah=void 0,(ko=w.ah||(w.ah={}))[ko.none=0]="none",ko[ko.horizontal=1]="horizontal",ko[ko.vertical=2]="vertical",ko[ko.horizontalOnly=3]="horizontalOnly";const Gu=-17;class Hu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const o=new Hu;return o.scale=t||1,o.fontStack=r,o}static forImage(t){const r=new Hu;return r.imageName=t,r}}class zl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new zl;for(let u=0;u<t.sections.length;u++){const p=t.sections[u];p.image?o.addImageSection(p):o.addTextSection(p,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,p=t.charCodeAt(o-1)||null;r+=u&&wf(u)&&!Zu[t[o+1]]||p&&wf(p)&&!Zu[t[o-1]]||!Zu[t[o]]?t[o]:Zu[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Bf[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Bf[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new zl;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Hu.forText(t.scale,t.fontStack||r));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Fe("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Hu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ff(i,t,r,o,u,p,m,_,x,P,A,k,D,F,j){const Z=zl.fromFeature(i,u);let Q;k===w.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:ne,processStyledBidirectionalText:xe}=en;if(ne&&Z.sections.length===1){Q=[];const Ee=ne(Z.toString(),ny(Z,P,p,t,o,F));for(const qe of Ee){const ct=new zl;ct.text=qe,ct.sections=Z.sections;for(let zt=0;zt<qe.length;zt++)ct.sectionIndex.push(0);Q.push(ct)}}else if(xe){Q=[];const Ee=xe(Z.text,Z.sectionIndex,ny(Z,P,p,t,o,F));for(const qe of Ee){const ct=new zl;ct.text=qe[0],ct.sectionIndex=qe[1],ct.sections=Z.sections,Q.push(ct)}}else Q=function(Ee,qe){const ct=[],zt=Ee.text;let ot=0;for(const rt of qe)ct.push(Ee.substring(ot,rt)),ot=rt;return ot<zt.length&&ct.push(Ee.substring(ot,zt.length)),ct}(Z,ny(Z,P,p,t,o,F));const he=[],_e={positionedLines:he,text:Z.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(Ee,qe,ct,zt,ot,rt,Pt,ft,dt,De,Tt,St){let Bt=0,Si=Gu,vi=0,cr=0;const Nn=ft==="right"?1:ft==="left"?0:.5;let wr=0;for(const Ki of ot){Ki.trim();const hr=Ki.getMaxScale(),zr=(hr-1)*or,Sr={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[wr]=Sr;const Wr=Sr.positionedGlyphs;let Pr=0;if(!Ki.length()){Si+=rt,++wr;continue}for(let nn=0;nn<Ki.length();nn++){const ai=Ki.getSection(nn),Ai=Ki.getSectionIndex(nn),Di=Ki.getCharCode(nn);let dn=0,qi=null,Ol=null,ls=null,cs=or;const Vn=!(dt===w.ah.horizontal||!Tt&&!Mu(Di)||Tt&&(Bf[Di]||(ur=Di,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ur)))));if(ai.imageName){const Tn=zt[ai.imageName];if(!Tn)continue;ls=ai.imageName,Ee.iconsInText=Ee.iconsInText||!0,Ol=Tn.paddedRect;const fr=Tn.displaySize;ai.scale=ai.scale*or/St,qi={width:fr[0],height:fr[1],left:rn,top:-gx,advance:Vn?fr[1]:fr[0]},dn=zr+(or-fr[1]*ai.scale),cs=qi.advance;const Bs=Vn?fr[0]*ai.scale-or*hr:fr[1]*ai.scale-or*hr;Bs>0&&Bs>Pr&&(Pr=Bs)}else{const Tn=ct[ai.fontStack],fr=Tn&&Tn[Di];if(fr&&fr.rect)Ol=fr.rect,qi=fr.metrics;else{const Bs=qe[ai.fontStack],Qu=Bs&&Bs[Di];if(!Qu)continue;qi=Qu.metrics}dn=(hr-ai.scale)*or}Vn?(Ee.verticalizable=!0,Wr.push({glyph:Di,imageName:ls,x:Bt,y:Si+dn,vertical:Vn,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:Ai,metrics:qi,rect:Ol}),Bt+=cs*ai.scale+De):(Wr.push({glyph:Di,imageName:ls,x:Bt,y:Si+dn,vertical:Vn,scale:ai.scale,fontStack:ai.fontStack,sectionIndex:Ai,metrics:qi,rect:Ol}),Bt+=qi.advance*ai.scale+De)}Wr.length!==0&&(vi=Math.max(Bt-De,vi),R1(Wr,0,Wr.length-1,Nn,Pr)),Bt=0;const Pn=rt*hr+Pr;Sr.lineOffset=Math.max(Pr,zr),Si+=Pn,cr=Math.max(Pn,cr),++wr}var ur;const Zr=Si-Gu,{horizontalAlign:Gr,verticalAlign:Hr}=sy(Pt);(function(Ki,hr,zr,Sr,Wr,Pr,Pn,nn,ai){const Ai=(hr-zr)*Wr;let Di=0;Di=Pr!==Pn?-nn*Sr-Gu:(-Sr*ai+.5)*Pn;for(const dn of Ki)for(const qi of dn.positionedGlyphs)qi.x+=Ai,qi.y+=Di})(Ee.positionedLines,Nn,Gr,Hr,vi,cr,rt,Zr,ot.length),Ee.top+=-Hr*Zr,Ee.bottom=Ee.top+Zr,Ee.left+=-Gr*vi,Ee.right=Ee.left+vi}(_e,t,r,o,Q,m,_,x,k,P,D,j),!function(Ee){for(const qe of Ee)if(qe.positionedGlyphs.length!==0)return!1;return!0}(he)&&_e}const Bf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},z1={40:!0};function vx(i,t,r,o,u,p){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*or/p+u:0}{const m=r[t.fontStack],_=m&&m[i];return _?_.metrics.advance*t.scale+u:0}}function xx(i,t,r,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(r)*r}function D1(i,t,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function bx(i,t,r,o,u,p){let m=null,_=xx(t,r,u,p);for(const x of o){const P=xx(t-x.x,r,u,p)+x.badness;P<=_&&(m=x,_=P)}return{index:i,x:t,priorBreak:m,badness:_}}function wx(i){return i?wx(i.priorBreak).concat(i.index):[]}function ny(i,t,r,o,u,p){if(!i)return[];const m=[],_=function(k,D,F,j,Z,Q){let ne=0;for(let xe=0;xe<k.length();xe++){const he=k.getSection(xe);ne+=vx(k.getCharCode(xe),he,j,Z,D,Q)}return ne/Math.max(1,Math.ceil(ne/F))}(i,t,r,o,u,p),x=i.text.indexOf("​")>=0;let P=0;for(let k=0;k<i.length();k++){const D=i.getSection(k),F=i.getCharCode(k);if(Bf[F]||(P+=vx(F,D,o,u,t,p)),k<i.length()-1){const j=!((A=F)<11904)&&(!!ti["CJK Compatibility Forms"](A)||!!ti["CJK Compatibility"](A)||!!ti["CJK Strokes"](A)||!!ti["CJK Symbols and Punctuation"](A)||!!ti["Enclosed CJK Letters and Months"](A)||!!ti["Halfwidth and Fullwidth Forms"](A)||!!ti["Ideographic Description Characters"](A)||!!ti["Vertical Forms"](A)||bf.test(String.fromCodePoint(A)));(M1[F]||j||D.imageName||k!==i.length()-2&&z1[i.getCharCode(k+1)])&&m.push(bx(k+1,P,_,m,D1(F,i.getCharCode(k+1),j&&x),!1))}}var A;return wx(bx(i.length(),P,_,m,0,!0))}function sy(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function R1(i,t,r,o,u){if(!o&&!u)return;const p=i[r],m=(i[r].x+p.metrics.advance*p.scale)*o;for(let _=t;_<=r;_++)i[_].x-=m,i[_].y+=u}function L1(i,t,r){const{horizontalAlign:o,verticalAlign:u}=sy(r),p=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Sx(i){var t,r;let o=i.left,u=i.top,p=i.right-o,m=i.bottom-u;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&p/m<P||_==="proportional"){const A=Math.ceil(m*P);o*=A/p,p=A}}else if(_==="proportional"&&x==="stretchOnly"&&P!==0&&p/m>P){const A=Math.ceil(p/P);u*=A/m,m=A}return{x1:o,y1:u,x2:o+p,y2:u+m}}function Px(i,t,r,o,u,p){const m=i.image;let _;if(m.content){const Q=m.content,ne=m.pixelRatio||1;_=[Q[0]/ne,Q[1]/ne,m.displaySize[0]-Q[2]/ne,m.displaySize[1]-Q[3]/ne]}const x=t.left*p,P=t.right*p;let A,k,D,F;r==="width"||r==="both"?(F=u[0]+x-o[3],k=u[0]+P+o[1]):(F=u[0]+(x+P-m.displaySize[0])/2,k=F+m.displaySize[0]);const j=t.top*p,Z=t.bottom*p;return r==="height"||r==="both"?(A=u[1]+j-o[0],D=u[1]+Z+o[2]):(A=u[1]+(j+Z-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:k,bottom:D,left:F,collisionPadding:_}}const Wu=255,as=128,Mo=Wu*as;function Tx(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ei(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let p=0;for(;p<o.length&&o[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const _=o[p],x=o[m];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:x,minSize:r.evaluate(new Ei(_)),maxSize:r.evaluate(new Ei(x)),interpolationType:u}}}function oy(i,t,r){let o="never";const u=i.get(t);return u?o=u:i.get(r)&&(o="always"),o}const O1=Eo.VectorTileFeature.types,F1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nf(i,t,r,o,u,p,m,_,x,P,A,k,D){const F=_?Math.min(Mo,Math.round(_[0])):0,j=_?Math.min(Mo,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*o),Math.round(32*u),p,m,(F<<1)+(x?1:0),j,16*P,16*A,256*k,256*D)}function ay(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function B1(i){for(const t of i.sections)if(L_(t.text))return!0;return!1}class ly{constructor(t){this.layoutVertexArray=new bl,this.indexArray=new bn,this.programConfigurations=t,this.segments=new ii,this.dynamicLayoutVertexArray=new Ru,this.opacityVertexArray=new un,this.hasVisibleVertices=!1,this.placedSymbolArray=new ki}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,f1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,m1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,F1,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}pt("SymbolBuffers",ly);class cy{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new ii,this.collisionVertexArray=new ss}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,g1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}pt("CollisionBuffers",cy);class Dl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=U_([]),this.placementViewportMatrix=U_([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tx(this.zoom,r["text-size"]),this.iconSizeData=Tx(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),p=o.get("symbol-z-order");this.canOverlap=oy(o,"text-overlap","text-allow-overlap")!=="never"||oy(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>w.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new ly(new xa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new ly(new xa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Mi,this.lineVertexArray=new yr,this.symbolInstances=new $t,this.textAnchorOffsets=new zi}calculateGlyphDependencies(t,r,o,u,p){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(o||u)&&p){const _=Zu[t.charAt(m)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,o){const u=this.layers[0],p=u.layout,m=p.get("text-font"),_=p.get("text-field"),x=p.get("icon-image"),P=(_.value.kind!=="constant"||_.value.value instanceof Jr&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),A=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,k=p.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const D=r.iconDependencies,F=r.glyphDependencies,j=r.availableImages,Z=new Ei(this.zoom);for(const{feature:Q,id:ne,index:xe,sourceLayerIndex:he}of t){const _e=u._featureFilter.needGeometry,Ee=wa(Q,_e);if(!u._featureFilter.filter(Z,Ee,o))continue;let qe,ct;if(_e||(Ee.geometry=ba(Q)),P){const ot=u.getValueAndResolveTokens("text-field",Ee,o,j),rt=Jr.factory(ot),Pt=this.hasRTLText=this.hasRTLText||B1(rt);(!Pt||en.getRTLTextPluginStatus()==="unavailable"||Pt&&en.isParsed())&&(qe=y1(rt,u,Ee))}if(A){const ot=u.getValueAndResolveTokens("icon-image",Ee,o,j);ct=ot instanceof Qr?ot:Qr.fromString(ot)}if(!qe&&!ct)continue;const zt=this.sortFeaturesByKey?k.evaluate(Ee,{},o):void 0;if(this.features.push({id:ne,text:qe,icon:ct,index:xe,sourceLayerIndex:he,geometry:Ee.geometry,properties:Q.properties,type:O1[Q.type],sortKey:zt}),ct&&(D[ct.name]=!0),qe){const ot=m.evaluate(Ee,{},o).join(","),rt=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const Pt of qe.sections)if(Pt.image)D[Pt.image.name]=!0;else{const ft=Eu(qe.toString()),dt=Pt.fontStack||ot,De=F[dt]=F[dt]||{};this.calculateGlyphDependencies(Pt.text,De,rt,this.allowVerticalPlacement,ft)}}}p.get("symbol-placement")==="line"&&(this.features=function(Q){const ne={},xe={},he=[];let _e=0;function Ee(ot){he.push(Q[ot]),_e++}function qe(ot,rt,Pt){const ft=xe[ot];return delete xe[ot],xe[rt]=ft,he[ft].geometry[0].pop(),he[ft].geometry[0]=he[ft].geometry[0].concat(Pt[0]),ft}function ct(ot,rt,Pt){const ft=ne[rt];return delete ne[rt],ne[ot]=ft,he[ft].geometry[0].shift(),he[ft].geometry[0]=Pt[0].concat(he[ft].geometry[0]),ft}function zt(ot,rt,Pt){const ft=Pt?rt[0][rt[0].length-1]:rt[0][0];return`${ot}:${ft.x}:${ft.y}`}for(let ot=0;ot<Q.length;ot++){const rt=Q[ot],Pt=rt.geometry,ft=rt.text?rt.text.toString():null;if(!ft){Ee(ot);continue}const dt=zt(ft,Pt),De=zt(ft,Pt,!0);if(dt in xe&&De in ne&&xe[dt]!==ne[De]){const Tt=ct(dt,De,Pt),St=qe(dt,De,he[Tt].geometry);delete ne[dt],delete xe[De],xe[zt(ft,he[St].geometry,!0)]=St,he[Tt].geometry=null}else dt in xe?qe(dt,De,Pt):De in ne?ct(dt,De,Pt):(Ee(ot),ne[dt]=_e-1,xe[De]=_e-1)}return he.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Q,ne)=>Q.sortKey-ne.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(r[t.segment+1]),p=t.dist(r[t.segment]);const m={};for(let _=t.segment+1;_<r.length;_++)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const x=m[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,u,p,m,_,x,P,A,k,D){const F=t.indexArray,j=t.layoutVertexArray,Z=t.segments.prepareSegment(4*r.length,j,F,this.canOverlap?m.sortKey:void 0),Q=this.glyphOffsetArray.length,ne=Z.vertexLength,xe=this.allowVerticalPlacement&&_===w.ah.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let _e=0;_e<r.length;_e++){const{tl:Ee,tr:qe,bl:ct,br:zt,tex:ot,pixelOffsetTL:rt,pixelOffsetBR:Pt,minFontScaleX:ft,minFontScaleY:dt,glyphOffset:De,isSDF:Tt,sectionIndex:St}=r[_e],Bt=Z.vertexLength,Si=De[1];Nf(j,x.x,x.y,Ee.x,Si+Ee.y,ot.x,ot.y,o,Tt,rt.x,rt.y,ft,dt),Nf(j,x.x,x.y,qe.x,Si+qe.y,ot.x+ot.w,ot.y,o,Tt,Pt.x,rt.y,ft,dt),Nf(j,x.x,x.y,ct.x,Si+ct.y,ot.x,ot.y+ot.h,o,Tt,rt.x,Pt.y,ft,dt),Nf(j,x.x,x.y,zt.x,Si+zt.y,ot.x+ot.w,ot.y+ot.h,o,Tt,Pt.x,Pt.y,ft,dt),ay(t.dynamicLayoutVertexArray,x,xe),F.emplaceBack(Bt,Bt+1,Bt+2),F.emplaceBack(Bt+1,Bt+2,Bt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(De[0]),_e!==r.length-1&&St===r[_e+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,m,m.index,{},D,he&&he[St])}t.placedSymbolArray.emplaceBack(x.x,x.y,Q,this.glyphOffsetArray.length-Q,ne,P,A,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,k)}_addCollisionDebugVertex(t,r,o,u,p,m){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,p,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,o,u,p,m,_){const x=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),P=x.vertexLength,A=p.layoutVertexArray,k=p.collisionVertexArray,D=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(A,k,m,D,F,new V(t,r)),this._addCollisionDebugVertex(A,k,m,D,F,new V(o,r)),this._addCollisionDebugVertex(A,k,m,D,F,new V(o,u)),this._addCollisionDebugVertex(A,k,m,D,F,new V(t,u)),x.vertexLength+=4;const j=p.indexArray;j.emplaceBack(P,P+1),j.emplaceBack(P+1,P+2),j.emplaceBack(P+2,P+3),j.emplaceBack(P+3,P),x.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,u){for(let p=t;p<r;p++){const m=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cy(hn,lx.members,pr),this.iconCollisionBox=new cy(hn,lx.members,pr);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,u,p,m,_,x,P){const A={};for(let k=r;k<o;k++){const D=t.get(k);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let k=u;k<p;k++){const D=t.get(k);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let k=m;k<_;k++){const D=t.get(k);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let k=x;k<P;k++){const D=t.get(k);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let p=o.vertexStartIndex;p<u;p+=4)t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),u=[],p=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const x=this.symbolInstances.get(_);u.push(0|Math.round(r*x.anchorX+o*x.anchorY)),p.push(x.featureIndex)}return m.sort((_,x)=>u[_]-u[x]||p[x]-p[_]),m}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,p,m)=>{u>=0&&m.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ix,Ax;pt("SymbolBucket",Dl,{omit:["layers","collisionBoxArray","features","compareText"]}),Dl.MAX_GLYPHS=65535,Dl.addDynamicAttributes=ay;var uy={get paint(){return Ax=Ax||new d({"icon-opacity":new Dt(we.paint_symbol["icon-opacity"]),"icon-color":new Dt(we.paint_symbol["icon-color"]),"icon-halo-color":new Dt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Dt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Dt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Dt(we.paint_symbol["text-opacity"]),"text-color":new Dt(we.paint_symbol["text-color"],{runtimeType:Nr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Dt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Dt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Dt(we.paint_symbol["text-halo-blur"]),"text-translate":new bt(we.paint_symbol["text-translate"]),"text-translate-anchor":new bt(we.paint_symbol["text-translate-anchor"])})},get layout(){return Ix=Ix||new d({"symbol-placement":new bt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Dt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Dt(we.layout_symbol["icon-size"]),"icon-text-fit":new bt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Dt(we.layout_symbol["icon-image"]),"icon-rotate":new Dt(we.layout_symbol["icon-rotate"]),"icon-padding":new Dt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Dt(we.layout_symbol["icon-offset"]),"icon-anchor":new Dt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(we.layout_symbol["text-rotation-alignment"]),"text-field":new Dt(we.layout_symbol["text-field"]),"text-font":new Dt(we.layout_symbol["text-font"]),"text-size":new Dt(we.layout_symbol["text-size"]),"text-max-width":new Dt(we.layout_symbol["text-max-width"]),"text-line-height":new bt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Dt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Dt(we.layout_symbol["text-justify"]),"text-radial-offset":new Dt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Dt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Dt(we.layout_symbol["text-anchor"]),"text-max-angle":new bt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(we.layout_symbol["text-writing-mode"]),"text-rotate":new Dt(we.layout_symbol["text-rotate"]),"text-padding":new bt(we.layout_symbol["text-padding"]),"text-keep-upright":new bt(we.layout_symbol["text-keep-upright"]),"text-transform":new Dt(we.layout_symbol["text-transform"]),"text-offset":new Dt(we.layout_symbol["text-offset"]),"text-allow-overlap":new bt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(we.layout_symbol["text-ignore-placement"]),"text-optional":new bt(we.layout_symbol["text-optional"])})}};class Cx{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ts,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}pt("FormatSectionOverride",Cx,{omit:["defaultValue"]});class Vf extends n{constructor(t){super(t,uy)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const p of o)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,u){const p=this.layout.get(t).evaluate(r,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||ol(m.value)||!p?p:function(_,x){return x.replace(/{([^{}]+)}/g,(P,A)=>_&&A in _?String(_[A]):"")}(r.properties,p)}createBucket(t){return new Dl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of uy.paint.overridableProperties){if(!Vf.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new Cx(r),u=new sl(o,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new po("source",u):new fo("composite",u,r.value.zoomStops),this.paint._values[t]=new Fn(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Vf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),u=uy.paint.properties[r];let p=!1;const m=_=>{for(const x of _)if(u.overrides&&u.overrides.hasOverride(x))return void(p=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Jr)m(o.value.value.sections);else if(o.value.kind==="source"){const _=P=>{p||(P instanceof mn&&rr(P.value)===Zn?m(P.value.sections):P instanceof Ja?m(P.sections):P.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return p}}let Ex;var N1={get paint(){return Ex=Ex||new d({"background-color":new bt(we.paint_background["background-color"]),"background-pattern":new vl(we.paint_background["background-pattern"]),"background-opacity":new bt(we.paint_background["background-opacity"])})}};class V1 extends n{constructor(t){super(t,N1)}}let kx;var j1={get paint(){return kx=kx||new d({"raster-opacity":new bt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(we.paint_raster["raster-saturation"]),"raster-contrast":new bt(we.paint_raster["raster-contrast"]),"raster-resampling":new bt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(we.paint_raster["raster-fade-duration"])})}};class U1 extends n{constructor(t){super(t,j1)}}class q1 extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Z1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const hy=63710088e-1;class zo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new zo(je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,u=t.lat*r,p=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*r);return hy*Math.acos(Math.min(p,1))}static convert(t){if(t instanceof zo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new zo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new zo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Mx=2*Math.PI*hy;function zx(i){return Mx*Math.cos(i*Math.PI/180)}function Dx(i){return(180+i)/360}function Rx(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Lx(i,t){return i/zx(t)}function dy(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Xu{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=zo.convert(t);return new Xu(Dx(o.lng),Rx(o.lat),Lx(r,o.lat))}toLngLat(){return new zo(360*this.x-180,dy(this.y))}toAltitude(){return this.z*zx(dy(this.y))}meterInMercatorCoordinateUnits(){return 1/Mx*(t=dy(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ox(i,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class py{constructor(t,r,o){if(!function(u,p,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||p<0||p>=Math.pow(2,u))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Ku(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const u=(m=this.y,_=this.z,x=Ox(256*(p=this.x),256*(m=Math.pow(2,_)-m-1),_),P=Ox(256*(p+1),256*(m+1),_),x[0]+","+x[1]+","+P[0]+","+P[1]);var p,m,_,x,P;const A=function(k,D,F){let j,Z="";for(let Q=k;Q>0;Q--)j=1<<Q-1,Z+=(D&j?1:0)+(F&j?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new V((t.x*r-this.x)*nr,(t.y*r-this.y)*nr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Fx{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Ku(t,r.z,r.z,r.x,r.y)}}class Sn{constructor(t,r,o,u,p){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new py(o,+u,+p),this.key=Ku(r,t,o,u,p)}clone(){return new Sn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Sn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Sn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Ku(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Ku(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Sn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Sn(r,this.wrap,r,o,u),new Sn(r,this.wrap,r,o+1,u),new Sn(r,this.wrap,r,o,u+1),new Sn(r,this.wrap,r,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Sn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Sn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Fx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Xu(t.x-this.wrap,t.y))}}function Ku(i,t,r,o,u){(i*=2)<0&&(i=-1*i-1);const p=1<<r;return(p*p*i+p*u+o).toString(36)+r.toString(36)+t.toString(36)}pt("CanonicalTileID",py),pt("OverscaledTileID",Sn,{omit:["posMatrix"]});class Bx{constructor(t,r,o,u=1,p=1,m=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Fe(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const x=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=p,this.blueFactor=m,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<x;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(x,P)]=this.data[this._idx(x-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,x)]=this.data[this._idx(P,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<x;P++)for(let A=0;A<x;A++){const k=this.get(P,A);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(t,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new wn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,p=r*this.dim+this.dim,m=o*this.dim,_=o*this.dim+this.dim;switch(r){case-1:u=p-1;break;case 1:p=u+1}switch(o){case-1:m=_-1;break;case 1:_=m+1}const x=-r*this.dim,P=-o*this.dim;for(let A=m;A<_;A++)for(let k=u;k<p;k++)this.data[this._idx(k,A)]=t.data[this._idx(k+x,A+P)]}}pt("DEMData",Bx);class Nx{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Vx{constructor(t,r,o,u,p){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=u,this.properties=t.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class jx{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new yo(nr,16,0),this.grid3D=new yo(nr,16,0),this.featureIndexArray=new kr,this.promoteId=r}insert(t,r,o,u,p,m){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,p);const x=m?this.grid3D:this.grid;for(let P=0;P<r.length;P++){const A=r[P],k=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const F=A[D];k[0]=Math.min(k[0],F.x),k[1]=Math.min(k[1],F.y),k[2]=Math.max(k[2],F.x),k[3]=Math.max(k[3],F.y)}k[0]<nr&&k[1]<nr&&k[2]>=0&&k[3]>=0&&x.insert(_,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Eo.VectorTile(new ty(this.rawTileData)).layers,this.sourceLayerCoder=new Nx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,u){this.loadVTLayers();const p=t.params||{},m=nr/t.tileSize/t.scale,_=fu(p.filter),x=t.queryGeometry,P=t.queryPadding*m,A=qx(x),k=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),D=qx(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(Q,ne,xe,he)=>function(_e,Ee,qe,ct,zt){for(const rt of _e)if(Ee<=rt.x&&qe<=rt.y&&ct>=rt.x&&zt>=rt.y)return!0;const ot=[new V(Ee,qe),new V(Ee,zt),new V(ct,zt),new V(ct,qe)];if(_e.length>2){for(const rt of ot)if(Il(_e,rt))return!0}for(let rt=0;rt<_e.length-1;rt++)if(Pw(_e[rt],_e[rt+1],ot))return!0;return!1}(t.cameraQueryGeometry,Q-P,ne-P,xe+P,he+P));for(const Q of F)k.push(Q);k.sort(G1);const j={};let Z;for(let Q=0;Q<k.length;Q++){const ne=k[Q];if(ne===Z)continue;Z=ne;const xe=this.featureIndexArray.get(ne);let he=null;this.loadMatchingFeature(j,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,_,p.layers,p.availableImages,r,o,u,(_e,Ee,qe)=>(he||(he=ba(_e)),Ee.queryIntersectsFeature(x,_e,qe,he,this.z,t.transform,m,t.pixelPosMatrix)))}return j}loadMatchingFeature(t,r,o,u,p,m,_,x,P,A,k){const D=this.bucketLayerIDs[r];if(m&&!function(Q,ne){for(let xe=0;xe<Q.length;xe++)if(ne.indexOf(Q[xe])>=0)return!0;return!1}(m,D))return;const F=this.sourceLayerCoder.decode(o),j=this.vtLayers[F].feature(u);if(p.needGeometry){const Q=wa(j,!0);if(!p.filter(new Ei(this.tileID.overscaledZ),Q,this.tileID.canonical))return}else if(!p.filter(new Ei(this.tileID.overscaledZ),j))return;const Z=this.getId(j,F);for(let Q=0;Q<D.length;Q++){const ne=D[Q];if(m&&m.indexOf(ne)<0)continue;const xe=x[ne];if(!xe)continue;let he={};Z&&A&&(he=A.getState(xe.sourceLayer||"_geojsonTileLayer",Z));const _e=Je({},P[ne]);_e.paint=Ux(_e.paint,xe.paint,j,he,_),_e.layout=Ux(_e.layout,xe.layout,j,he,_);const Ee=!k||k(j,xe,he);if(!Ee)continue;const qe=new Vx(j,this.z,this.x,this.y,Z);qe.layer=_e;let ct=t[ne];ct===void 0&&(ct=t[ne]=[]),ct.push({featureIndex:u,feature:qe,intersectionZ:Ee})}}lookupSymbolFeatures(t,r,o,u,p,m,_,x){const P={};this.loadVTLayers();const A=fu(p);for(const k of t)this.loadMatchingFeature(P,o,u,k,A,m,_,x,r);return P}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function Ux(i,t,r,o,u){return Ge(i,(p,m)=>{const _=t instanceof _a?t.get(m):null;return _&&_.evaluate?_.evaluate(r,o,u):_})}function qx(i){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return{minX:t,minY:r,maxX:o,maxY:u}}function G1(i,t){return t-i}function Zx(i,t,r,o,u){const p=[];for(let m=0;m<i.length;m++){const _=i[m];let x;for(let P=0;P<_.length-1;P++){let A=_[P],k=_[P+1];A.x<t&&k.x<t||(A.x<t?A=new V(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<t&&(k=new V(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<r&&k.y<r||(A.y<r?A=new V(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round():k.y<r&&(k=new V(A.x+(r-A.y)/(k.y-A.y)*(k.x-A.x),r)._round()),A.x>=o&&k.x>=o||(A.x>=o?A=new V(o,A.y+(o-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=o&&(k=new V(o,A.y+(o-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=u&&k.y>=u||(A.y>=u?A=new V(A.x+(u-A.y)/(k.y-A.y)*(k.x-A.x),u)._round():k.y>=u&&(k=new V(A.x+(u-A.y)/(k.y-A.y)*(k.x-A.x),u)._round()),x&&A.equals(x[x.length-1])||(x=[A],p.push(x)),x.push(k)))))}}return p}pt("FeatureIndex",jx,{omit:["rawTileData","sourceLayerCoder"]});class Do extends V{constructor(t,r,o,u){super(t,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Do(this.x,this.y,this.angle,this.segment)}}function Gx(i,t,r,o,u){if(t.segment===void 0||r===0)return!0;let p=t,m=t.segment+1,_=0;for(;_>-r/2;){if(m--,m<0)return!1;_-=i[m].dist(p),p=i[m]}_+=i[m].dist(i[m+1]),m++;const x=[];let P=0;for(;_<r/2;){const A=i[m],k=i[m+1];if(!k)return!1;let D=i[m-1].angleTo(A)-A.angleTo(k);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:D}),P+=D;_-x[0].distance>o;)P-=x.shift().angleDelta;if(P>u)return!1;m++,_+=A.dist(k)}return!0}function Hx(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Wx(i,t,r){return i?.6*t*r:0}function Xx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function H1(i,t,r,o,u,p){const m=Wx(r,u,p),_=Xx(r,o)*p;let x=0;const P=Hx(i)/2;for(let A=0;A<i.length-1;A++){const k=i[A],D=i[A+1],F=k.dist(D);if(x+F>P){const j=(P-x)/F,Z=Vr.number(k.x,D.x,j),Q=Vr.number(k.y,D.y,j),ne=new Do(Z,Q,D.angleTo(k),A);return ne._round(),!m||Gx(i,ne,_,m,t)?ne:void 0}x+=F}}function W1(i,t,r,o,u,p,m,_,x){const P=Wx(o,p,m),A=Xx(o,u),k=A*m,D=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-k<t/4&&(t=k+t/4),Kx(i,D?t/2*_%t:(A/2+2*p)*m*_%t,t,P,r,k,D,!1,x)}function Kx(i,t,r,o,u,p,m,_,x){const P=p/2,A=Hx(i);let k=0,D=t-r,F=[];for(let j=0;j<i.length-1;j++){const Z=i[j],Q=i[j+1],ne=Z.dist(Q),xe=Q.angleTo(Z);for(;D+r<k+ne;){D+=r;const he=(D-k)/ne,_e=Vr.number(Z.x,Q.x,he),Ee=Vr.number(Z.y,Q.y,he);if(_e>=0&&_e<x&&Ee>=0&&Ee<x&&D-P>=0&&D+P<=A){const qe=new Do(_e,Ee,xe,j);qe._round(),o&&!Gx(i,qe,p,o,u)||F.push(qe)}}k+=ne}return _||F.length||m||(F=Kx(i,k/2,r,o,u,p,m,!0,x)),F}pt("Anchor",Do);const Rl=rn;function Jx(i,t,r,o){const u=[],p=i.image,m=p.pixelRatio,_=p.paddedRect.w-2*Rl,x=p.paddedRect.h-2*Rl;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=p.stretchX||[[0,_]],k=p.stretchY||[[0,x]],D=(De,Tt)=>De+Tt[1]-Tt[0],F=A.reduce(D,0),j=k.reduce(D,0),Z=_-F,Q=x-j;let ne=0,xe=F,he=0,_e=j,Ee=0,qe=Z,ct=0,zt=Q;if(p.content&&o){const De=p.content,Tt=De[2]-De[0],St=De[3]-De[1];(p.textFitWidth||p.textFitHeight)&&(P=Sx(i)),ne=jf(A,0,De[0]),he=jf(k,0,De[1]),xe=jf(A,De[0],De[2]),_e=jf(k,De[1],De[3]),Ee=De[0]-ne,ct=De[1]-he,qe=Tt-xe,zt=St-_e}const ot=P.x1,rt=P.y1,Pt=P.x2-ot,ft=P.y2-rt,dt=(De,Tt,St,Bt)=>{const Si=Uf(De.stretch-ne,xe,Pt,ot),vi=qf(De.fixed-Ee,qe,De.stretch,F),cr=Uf(Tt.stretch-he,_e,ft,rt),Nn=qf(Tt.fixed-ct,zt,Tt.stretch,j),wr=Uf(St.stretch-ne,xe,Pt,ot),ur=qf(St.fixed-Ee,qe,St.stretch,F),Zr=Uf(Bt.stretch-he,_e,ft,rt),Gr=qf(Bt.fixed-ct,zt,Bt.stretch,j),Hr=new V(Si,cr),Ki=new V(wr,cr),hr=new V(wr,Zr),zr=new V(Si,Zr),Sr=new V(vi/m,Nn/m),Wr=new V(ur/m,Gr/m),Pr=t*Math.PI/180;if(Pr){const ai=Math.sin(Pr),Ai=Math.cos(Pr),Di=[Ai,-ai,ai,Ai];Hr._matMult(Di),Ki._matMult(Di),zr._matMult(Di),hr._matMult(Di)}const Pn=De.stretch+De.fixed,nn=Tt.stretch+Tt.fixed;return{tl:Hr,tr:Ki,bl:zr,br:hr,tex:{x:p.paddedRect.x+Rl+Pn,y:p.paddedRect.y+Rl+nn,w:St.stretch+St.fixed-Pn,h:Bt.stretch+Bt.fixed-nn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sr,pixelOffsetBR:Wr,minFontScaleX:qe/m/Pt,minFontScaleY:zt/m/ft,isSDF:r}};if(o&&(p.stretchX||p.stretchY)){const De=Yx(A,Z,F),Tt=Yx(k,Q,j);for(let St=0;St<De.length-1;St++){const Bt=De[St],Si=De[St+1];for(let vi=0;vi<Tt.length-1;vi++)u.push(dt(Bt,Tt[vi],Si,Tt[vi+1]))}}else u.push(dt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return u}function jf(i,t,r){let o=0;for(const u of i)o+=Math.max(t,Math.min(r,u[1]))-Math.max(t,Math.min(r,u[0]));return o}function Yx(i,t,r){const o=[{fixed:-Rl,stretch:0}];for(const[u,p]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return o.push({fixed:t+Rl,stretch:r}),o}function Uf(i,t,r,o){return i/t*r+o}function qf(i,t,r,o){return i-t*r/o}class Zf{constructor(t,r,o,u,p,m,_,x,P,A){var k;if(this.boxStartIndex=t.length,P){let D=m.top,F=m.bottom;const j=m.collisionPadding;j&&(D-=j[1],F+=j[3]);let Z=F-D;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const D=!((k=m.image)===null||k===void 0)&&k.content&&(m.image.textFitWidth||m.image.textFitHeight)?Sx(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*_-x[0],D.y2=D.y2*_+x[2],D.x1=D.x1*_-x[3],D.x2=D.x2*_+x[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*_,D.y1-=F[1]*_,D.x2+=F[2]*_,D.y2+=F[3]*_),A){const j=new V(D.x1,D.y1),Z=new V(D.x2,D.y1),Q=new V(D.x1,D.y2),ne=new V(D.x2,D.y2),xe=A*Math.PI/180;j._rotate(xe),Z._rotate(xe),Q._rotate(xe),ne._rotate(xe),D.x1=Math.min(j.x,Z.x,Q.x,ne.x),D.x2=Math.max(j.x,Z.x,Q.x,ne.x),D.y1=Math.min(j.y,Z.y,Q.y,ne.y),D.y2=Math.max(j.y,Z.y,Q.y,ne.y)}t.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,o,u,p)}this.boxEndIndex=t.length}}class X1{constructor(t=[],r=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,u=r[t];for(;t>0;){const p=t-1>>1,m=r[p];if(o(u,m)>=0)break;r[t]=m,t=p}r[t]=u}_down(t){const{data:r,compare:o}=this,u=this.length>>1,p=r[t];for(;t<u;){let m=1+(t<<1);const _=m+1;if(_<this.length&&o(r[_],r[m])<0&&(m=_),o(r[m],p)>=0)break;r[t]=r[m],t=m}r[t]=p}}function K1(i,t=1,r=!1){let o=1/0,u=1/0,p=-1/0,m=-1/0;const _=i[0];for(let F=0;F<_.length;F++){const j=_[F];(!F||j.x<o)&&(o=j.x),(!F||j.y<u)&&(u=j.y),(!F||j.x>p)&&(p=j.x),(!F||j.y>m)&&(m=j.y)}const x=Math.min(p-o,m-u);let P=x/2;const A=new X1([],J1);if(x===0)return new V(o,u);for(let F=o;F<p;F+=x)for(let j=u;j<m;j+=x)A.push(new Ll(F+P,j+P,P,i));let k=function(F){let j=0,Z=0,Q=0;const ne=F[0];for(let xe=0,he=ne.length,_e=he-1;xe<he;_e=xe++){const Ee=ne[xe],qe=ne[_e],ct=Ee.x*qe.y-qe.x*Ee.y;Z+=(Ee.x+qe.x)*ct,Q+=(Ee.y+qe.y)*ct,j+=3*ct}return new Ll(Z/j,Q/j,0,F)}(i),D=A.length;for(;A.length;){const F=A.pop();(F.d>k.d||!k.d)&&(k=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-k.d<=t||(P=F.h/2,A.push(new Ll(F.p.x-P,F.p.y-P,P,i)),A.push(new Ll(F.p.x+P,F.p.y-P,P,i)),A.push(new Ll(F.p.x-P,F.p.y+P,P,i)),A.push(new Ll(F.p.x+P,F.p.y+P,P,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${k.d}`)),k.p}function J1(i,t){return t.max-i.max}function Ll(i,t,r,o){this.p=new V(i,t),this.h=r,this.d=function(u,p){let m=!1,_=1/0;for(let x=0;x<p.length;x++){const P=p[x];for(let A=0,k=P.length,D=k-1;A<k;D=A++){const F=P[A],j=P[D];F.y>u.y!=j.y>u.y&&u.x<(j.x-F.x)*(u.y-F.y)/(j.y-F.y)+F.x&&(m=!m),_=Math.min(_,Rv(u,F,j))}}return(m?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var br;w.aq=void 0,(br=w.aq||(w.aq={}))[br.center=1]="center",br[br.left=2]="left",br[br.right=3]="right",br[br.top=4]="top",br[br.bottom=5]="bottom",br[br["top-left"]=6]="top-left",br[br["top-right"]=7]="top-right",br[br["bottom-left"]=8]="bottom-left",br[br["bottom-right"]=9]="bottom-right";const Ro=7,fy=Number.POSITIVE_INFINITY;function Qx(i,t){return t[1]!==fy?function(r,o,u){let p=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":m=u-Ro;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Ro}switch(r){case"top-right":case"bottom-right":case"right":p=-o;break;case"top-left":case"bottom-left":case"left":p=o}return[p,m]}(i,t[0],t[1]):function(r,o){let u=0,p=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(r){case"top-right":case"top-left":p=m-Ro;break;case"bottom-right":case"bottom-left":p=-m+Ro;break;case"bottom":p=-o+Ro;break;case"top":p=o-Ro}switch(r){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,p]}(i,t[0])}function $x(i,t,r){var o;const u=i.layout,p=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(p){const _=p.values,x=[];for(let P=0;P<_.length;P+=2){const A=x[P]=_[P],k=_[P+1].map(D=>D*or);A.startsWith("top")?k[1]-=Ro:A.startsWith("bottom")&&(k[1]+=Ro),x[P+1]=k}return new sn(x)}const m=u.get("text-variable-anchor");if(m){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},r)*or,fy]:u.get("text-offset").evaluate(t,{},r).map(P=>P*or);const x=[];for(const P of m)x.push(P,Qx(P,_));return new sn(x)}return null}function my(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Y1(i,t,r,o,u,p,m,_,x,P,A){let k=p.textMaxSize.evaluate(t,{});k===void 0&&(k=m);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},A),j=t0(r.horizontal),Z=m/24,Q=i.tilePixelRatio*Z,ne=i.tilePixelRatio*k/24,xe=i.tilePixelRatio*_,he=i.tilePixelRatio*D.get("symbol-spacing"),_e=D.get("text-padding")*i.tilePixelRatio,Ee=function(De,Tt,St,Bt=1){const Si=De.get("icon-padding").evaluate(Tt,{},St),vi=Si&&Si.values;return[vi[0]*Bt,vi[1]*Bt,vi[2]*Bt,vi[3]*Bt]}(D,t,A,i.tilePixelRatio),qe=D.get("text-max-angle")/180*Math.PI,ct=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",zt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ot=D.get("symbol-placement"),rt=he/2,Pt=D.get("icon-text-fit");let ft;o&&Pt!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ft=Px(o,r.vertical,Pt,D.get("icon-text-fit-padding"),F,Z)),j&&(o=Px(o,j,Pt,D.get("icon-text-fit-padding"),F,Z)));const dt=(De,Tt)=>{Tt.x<0||Tt.x>=nr||Tt.y<0||Tt.y>=nr||function(St,Bt,Si,vi,cr,Nn,wr,ur,Zr,Gr,Hr,Ki,hr,zr,Sr,Wr,Pr,Pn,nn,ai,Ai,Di,dn,qi,Ol){const ls=St.addToLineVertexArray(Bt,Si);let cs,Vn,Tn,fr,Bs=0,Qu=0,s0=0,o0=0,Sy=-1,Py=-1;const Ns={};let a0=wl("");if(St.allowVerticalPlacement&&vi.vertical){const Dr=ur.layout.get("text-rotate").evaluate(Ai,{},qi)+90;Tn=new Zf(Zr,Bt,Gr,Hr,Ki,vi.vertical,hr,zr,Sr,Dr),wr&&(fr=new Zf(Zr,Bt,Gr,Hr,Ki,wr,Pr,Pn,Sr,Dr))}if(cr){const Dr=ur.layout.get("icon-rotate").evaluate(Ai,{}),In=ur.layout.get("icon-text-fit")!=="none",Pa=Jx(cr,Dr,dn,In),Kn=wr?Jx(wr,Dr,dn,In):void 0;Vn=new Zf(Zr,Bt,Gr,Hr,Ki,cr,Pr,Pn,!1,Dr),Bs=4*Pa.length;const Ta=St.iconSizeData;let us=null;Ta.kind==="source"?(us=[as*ur.layout.get("icon-size").evaluate(Ai,{})],us[0]>Mo&&Fe(`${St.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)):Ta.kind==="composite"&&(us=[as*Di.compositeIconSizes[0].evaluate(Ai,{},qi),as*Di.compositeIconSizes[1].evaluate(Ai,{},qi)],(us[0]>Mo||us[1]>Mo)&&Fe(`${St.layerIds[0]}: Value for "icon-size" is >= ${Wu}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Pa,us,ai,nn,Ai,w.ah.none,Bt,ls.lineStartIndex,ls.lineLength,-1,qi),Sy=St.icon.placedSymbolArray.length-1,Kn&&(Qu=4*Kn.length,St.addSymbols(St.icon,Kn,us,ai,nn,Ai,w.ah.vertical,Bt,ls.lineStartIndex,ls.lineLength,-1,qi),Py=St.icon.placedSymbolArray.length-1)}const l0=Object.keys(vi.horizontal);for(const Dr of l0){const In=vi.horizontal[Dr];if(!cs){a0=wl(In.text);const Kn=ur.layout.get("text-rotate").evaluate(Ai,{},qi);cs=new Zf(Zr,Bt,Gr,Hr,Ki,In,hr,zr,Sr,Kn)}const Pa=In.positionedLines.length===1;if(s0+=e0(St,Bt,In,Nn,ur,Sr,Ai,Wr,ls,vi.vertical?w.ah.horizontal:w.ah.horizontalOnly,Pa?l0:[Dr],Ns,Sy,Di,qi),Pa)break}vi.vertical&&(o0+=e0(St,Bt,vi.vertical,Nn,ur,Sr,Ai,Wr,ls,w.ah.vertical,["vertical"],Ns,Py,Di,qi));const e2=cs?cs.boxStartIndex:St.collisionBoxArray.length,t2=cs?cs.boxEndIndex:St.collisionBoxArray.length,i2=Tn?Tn.boxStartIndex:St.collisionBoxArray.length,r2=Tn?Tn.boxEndIndex:St.collisionBoxArray.length,n2=Vn?Vn.boxStartIndex:St.collisionBoxArray.length,s2=Vn?Vn.boxEndIndex:St.collisionBoxArray.length,o2=fr?fr.boxStartIndex:St.collisionBoxArray.length,a2=fr?fr.boxEndIndex:St.collisionBoxArray.length;let Xn=-1;const Hf=(Dr,In)=>Dr&&Dr.circleDiameter?Math.max(Dr.circleDiameter,In):In;Xn=Hf(cs,Xn),Xn=Hf(Tn,Xn),Xn=Hf(Vn,Xn),Xn=Hf(fr,Xn);const c0=Xn>-1?1:0;c0&&(Xn*=Ol/or),St.glyphOffsetArray.length>=Dl.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ai.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Ai.sortKey);const l2=$x(ur,Ai,qi),[c2,u2]=function(Dr,In){const Pa=Dr.length,Kn=In==null?void 0:In.values;if((Kn==null?void 0:Kn.length)>0)for(let Ta=0;Ta<Kn.length;Ta+=2){const us=Kn[Ta+1];Dr.emplaceBack(w.aq[Kn[Ta]],us[0],us[1])}return[Pa,Dr.length]}(St.textAnchorOffsets,l2);St.symbolInstances.emplaceBack(Bt.x,Bt.y,Ns.right>=0?Ns.right:-1,Ns.center>=0?Ns.center:-1,Ns.left>=0?Ns.left:-1,Ns.vertical||-1,Sy,Py,a0,e2,t2,i2,r2,n2,s2,o2,a2,Gr,s0,o0,Bs,Qu,c0,0,hr,Xn,c2,u2)}(i,Tt,De,r,o,u,ft,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Q,[_e,_e,_e,_e],ct,x,xe,Ee,zt,F,t,p,P,A,m)};if(ot==="line")for(const De of Zx(t.geometry,0,0,nr,nr)){const Tt=W1(De,he,qe,r.vertical||j,o,24,ne,i.overscaling,nr);for(const St of Tt)j&&Q1(i,j.text,rt,St)||dt(De,St)}else if(ot==="line-center"){for(const De of t.geometry)if(De.length>1){const Tt=H1(De,qe,r.vertical||j,o,24,ne);Tt&&dt(De,Tt)}}else if(t.type==="Polygon")for(const De of Qa(t.geometry,0)){const Tt=K1(De,16);dt(De[0],new Do(Tt.x,Tt.y,0))}else if(t.type==="LineString")for(const De of t.geometry)dt(De,new Do(De[0].x,De[0].y,0));else if(t.type==="Point")for(const De of t.geometry)for(const Tt of De)dt([Tt],new Do(Tt.x,Tt.y,0))}function e0(i,t,r,o,u,p,m,_,x,P,A,k,D,F,j){const Z=function(xe,he,_e,Ee,qe,ct,zt,ot){const rt=Ee.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,Pt=[];for(const ft of he.positionedLines)for(const dt of ft.positionedGlyphs){if(!dt.rect)continue;const De=dt.rect||{};let Tt=gx+1,St=!0,Bt=1,Si=0;const vi=(qe||ot)&&dt.vertical,cr=dt.metrics.advance*dt.scale/2;if(ot&&he.verticalizable&&(Si=ft.lineOffset/2-(dt.imageName?-(or-dt.metrics.width*dt.scale)/2:(dt.scale-1)*or)),dt.imageName){const ai=zt[dt.imageName];St=ai.sdf,Bt=ai.pixelRatio,Tt=rn/Bt}const Nn=qe?[dt.x+cr,dt.y]:[0,0];let wr=qe?[0,0]:[dt.x+cr+_e[0],dt.y+_e[1]-Si],ur=[0,0];vi&&(ur=wr,wr=[0,0]);const Zr=dt.metrics.isDoubleResolution?2:1,Gr=(dt.metrics.left-Tt)*dt.scale-cr+wr[0],Hr=(-dt.metrics.top-Tt)*dt.scale+wr[1],Ki=Gr+De.w/Zr*dt.scale/Bt,hr=Hr+De.h/Zr*dt.scale/Bt,zr=new V(Gr,Hr),Sr=new V(Ki,Hr),Wr=new V(Gr,hr),Pr=new V(Ki,hr);if(vi){const ai=new V(-cr,cr-Gu),Ai=-Math.PI/2,Di=or/2-cr,dn=new V(5-Gu-Di,-(dt.imageName?Di:0)),qi=new V(...ur);zr._rotateAround(Ai,ai)._add(dn)._add(qi),Sr._rotateAround(Ai,ai)._add(dn)._add(qi),Wr._rotateAround(Ai,ai)._add(dn)._add(qi),Pr._rotateAround(Ai,ai)._add(dn)._add(qi)}if(rt){const ai=Math.sin(rt),Ai=Math.cos(rt),Di=[Ai,-ai,ai,Ai];zr._matMult(Di),Sr._matMult(Di),Wr._matMult(Di),Pr._matMult(Di)}const Pn=new V(0,0),nn=new V(0,0);Pt.push({tl:zr,tr:Sr,bl:Wr,br:Pr,tex:De,writingMode:he.writingMode,glyphOffset:Nn,sectionIndex:dt.sectionIndex,isSDF:St,pixelOffsetTL:Pn,pixelOffsetBR:nn,minFontScaleX:0,minFontScaleY:0})}return Pt}(0,r,_,u,p,m,o,i.allowVerticalPlacement),Q=i.textSizeData;let ne=null;Q.kind==="source"?(ne=[as*u.layout.get("text-size").evaluate(m,{})],ne[0]>Mo&&Fe(`${i.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)):Q.kind==="composite"&&(ne=[as*F.compositeTextSizes[0].evaluate(m,{},j),as*F.compositeTextSizes[1].evaluate(m,{},j)],(ne[0]>Mo||ne[1]>Mo)&&Fe(`${i.layerIds[0]}: Value for "text-size" is >= ${Wu}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,ne,_,p,m,P,t,x.lineStartIndex,x.lineLength,D,j);for(const xe of A)k[xe]=i.text.placedSymbolArray.length-1;return 4*Z.length}function t0(i){for(const t in i)return i[t];return null}function Q1(i,t,r,o){const u=i.compareText;if(t in u){const p=u[t];for(let m=p.length-1;m>=0;m--)if(o.dist(p[m])<r)return!0}else u[t]=[];return u[t].push(o),!1}const i0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gy{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=i0[15&o];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new gy(_,m,p,t)}constructor(t,r=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const p=i0.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return _y(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:_}=this,x=[0,p.length-1,0],P=[];for(;x.length;){const A=x.pop()||0,k=x.pop()||0,D=x.pop()||0;if(k-D<=_){for(let Q=D;Q<=k;Q++){const ne=m[2*Q],xe=m[2*Q+1];ne>=t&&ne<=o&&xe>=r&&xe<=u&&P.push(p[Q])}continue}const F=D+k>>1,j=m[2*F],Z=m[2*F+1];j>=t&&j<=o&&Z>=r&&Z<=u&&P.push(p[F]),(A===0?t<=j:r<=Z)&&(x.push(D),x.push(F-1),x.push(1-A)),(A===0?o>=j:u>=Z)&&(x.push(F+1),x.push(k),x.push(1-A))}return P}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,_=[0,u.length-1,0],x=[],P=o*o;for(;_.length;){const A=_.pop()||0,k=_.pop()||0,D=_.pop()||0;if(k-D<=m){for(let Q=D;Q<=k;Q++)n0(p[2*Q],p[2*Q+1],t,r)<=P&&x.push(u[Q]);continue}const F=D+k>>1,j=p[2*F],Z=p[2*F+1];n0(j,Z,t,r)<=P&&x.push(u[F]),(A===0?t-o<=j:r-o<=Z)&&(_.push(D),_.push(F-1),_.push(1-A)),(A===0?t+o>=j:r+o>=Z)&&(_.push(F+1),_.push(k),_.push(1-A))}return x}}function _y(i,t,r,o,u,p){if(u-o<=r)return;const m=o+u>>1;r0(i,t,m,o,u,p),_y(i,t,r,o,m-1,1-p),_y(i,t,r,m+1,u,1-p)}function r0(i,t,r,o,u,p){for(;u>o;){if(u-o>600){const P=u-o+1,A=r-o+1,k=Math.log(P),D=.5*Math.exp(2*k/3),F=.5*Math.sqrt(k*D*(P-D)/P)*(A-P/2<0?-1:1);r0(i,t,r,Math.max(o,Math.floor(r-A*D/P+F)),Math.min(u,Math.floor(r+(P-A)*D/P+F)),p)}const m=t[2*r+p];let _=o,x=u;for(Ju(i,t,o,r),t[2*u+p]>m&&Ju(i,t,o,u);_<x;){for(Ju(i,t,_,x),_++,x--;t[2*_+p]<m;)_++;for(;t[2*x+p]>m;)x--}t[2*o+p]===m?Ju(i,t,o,x):(x++,Ju(i,t,x,u)),x<=r&&(o=x+1),r<=x&&(u=x-1)}}function Ju(i,t,r,o){yy(i,r,o),yy(t,2*r,2*o),yy(t,2*r+1,2*o+1)}function yy(i,t,r){const o=i[t];i[t]=i[r],i[r]=o}function n0(i,t,r,o){const u=i-r,p=t-o;return u*u+p*p}var vy;w.bg=void 0,(vy=w.bg||(w.bg={})).create="create",vy.load="load",vy.fullLoad="fullLoad";let Gf=null,Yu=[];const xy=1e3/60,by="loadTime",wy="fullLoadTime",$1={mark(i){performance.mark(i)},frame(i){const t=i;Gf!=null&&Yu.push(t-Gf),Gf=t},clearMetrics(){Gf=null,Yu=[],performance.clearMeasures(by),performance.clearMeasures(wy);for(const i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(by,w.bg.create,w.bg.load),performance.measure(wy,w.bg.create,w.bg.fullLoad);const i=performance.getEntriesByName(by)[0].duration,t=performance.getEntriesByName(wy)[0].duration,r=Yu.length,o=1/(Yu.reduce((p,m)=>p+m,0)/r/1e3),u=Yu.filter(p=>p>xy).reduce((p,m)=>p+(m-xy)/xy,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};w.$=class extends M{},w.A=Al,w.B=k_,w.C=function(i){if(st==null){const t=i.navigator?i.navigator.userAgent:null;st=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return st},w.D=bt,w.E=Lt,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Z1(()=>this.process()),this.subscription=function(r,o,u,p){return r.addEventListener(o,u,!1),{unsubscribe:()=>{r.removeEventListener(o,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=He(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const p=[],m=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:vo(i.data,p)});this.target.postMessage(m,{transfer:p})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(He(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(xo(t.error)):u.resolve(xo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=xo(t.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,t,r){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?vo(t):null,data:vo(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=Hi,w.H=function(){var i=new Al(16);return Al!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=ry,w.J=function(i,t,r){var o,u,p,m,_,x,P,A,k,D,F,j,Z=r[0],Q=r[1],ne=r[2];return t===i?(i[12]=t[0]*Z+t[4]*Q+t[8]*ne+t[12],i[13]=t[1]*Z+t[5]*Q+t[9]*ne+t[13],i[14]=t[2]*Z+t[6]*Q+t[10]*ne+t[14],i[15]=t[3]*Z+t[7]*Q+t[11]*ne+t[15]):(u=t[1],p=t[2],m=t[3],_=t[4],x=t[5],P=t[6],A=t[7],k=t[8],D=t[9],F=t[10],j=t[11],i[0]=o=t[0],i[1]=u,i[2]=p,i[3]=m,i[4]=_,i[5]=x,i[6]=P,i[7]=A,i[8]=k,i[9]=D,i[10]=F,i[11]=j,i[12]=o*Z+_*Q+k*ne+t[12],i[13]=u*Z+x*Q+D*ne+t[13],i[14]=p*Z+P*Q+F*ne+t[14],i[15]=m*Z+A*Q+j*ne+t[15]),i},w.K=function(i,t,r){var o=r[0],u=r[1],p=r[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*p,i[9]=t[9]*p,i[10]=t[10]*p,i[11]=t[11]*p,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=Bv,w.M=function(i,t){const r={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(r[u]=i[u])}return r},w.N=zo,w.O=Dx,w.P=V,w.Q=Rx,w.R=wn,w.S=Sn,w.T=_l,w.U=ye,w.V=pe,w.W=ht,w.X=nr,w.Y=y,w.Z=Xu,w._=c,w.a=fi,w.a$=function(i,t){var r=i[0],o=i[1],u=i[2],p=i[3],m=i[4],_=i[5],x=i[6],P=i[7],A=i[8],k=i[9],D=i[10],F=i[11],j=i[12],Z=i[13],Q=i[14],ne=i[15],xe=t[0],he=t[1],_e=t[2],Ee=t[3],qe=t[4],ct=t[5],zt=t[6],ot=t[7],rt=t[8],Pt=t[9],ft=t[10],dt=t[11],De=t[12],Tt=t[13],St=t[14],Bt=t[15];return Math.abs(r-xe)<=qr*Math.max(1,Math.abs(r),Math.abs(xe))&&Math.abs(o-he)<=qr*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(u-_e)<=qr*Math.max(1,Math.abs(u),Math.abs(_e))&&Math.abs(p-Ee)<=qr*Math.max(1,Math.abs(p),Math.abs(Ee))&&Math.abs(m-qe)<=qr*Math.max(1,Math.abs(m),Math.abs(qe))&&Math.abs(_-ct)<=qr*Math.max(1,Math.abs(_),Math.abs(ct))&&Math.abs(x-zt)<=qr*Math.max(1,Math.abs(x),Math.abs(zt))&&Math.abs(P-ot)<=qr*Math.max(1,Math.abs(P),Math.abs(ot))&&Math.abs(A-rt)<=qr*Math.max(1,Math.abs(A),Math.abs(rt))&&Math.abs(k-Pt)<=qr*Math.max(1,Math.abs(k),Math.abs(Pt))&&Math.abs(D-ft)<=qr*Math.max(1,Math.abs(D),Math.abs(ft))&&Math.abs(F-dt)<=qr*Math.max(1,Math.abs(F),Math.abs(dt))&&Math.abs(j-De)<=qr*Math.max(1,Math.abs(j),Math.abs(De))&&Math.abs(Z-Tt)<=qr*Math.max(1,Math.abs(Z),Math.abs(Tt))&&Math.abs(Q-St)<=qr*Math.max(1,Math.abs(Q),Math.abs(St))&&Math.abs(ne-Bt)<=qr*Math.max(1,Math.abs(ne),Math.abs(Bt))},w.a0=ii,w.a1=py,w.a2=Xe,w.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of i){const u=window.document.createElement("source");Fr(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},w.a4=function(){return _t++},w.a5=lt,w.a6=Dl,w.a7=fu,w.a8=wa,w.a9=Vx,w.aA=function(i){if(i.type==="custom")return new q1(i);switch(i.type){case"background":return new V1(i);case"circle":return new Aw(i);case"fill":return new Zw(i);case"fill-extrusion":return new s1(i);case"heatmap":return new Ew(i);case"hillshade":return new Mw(i);case"line":return new p1(i);case"raster":return new U1(i);case"symbol":return new Vf(i)}},w.aB=at,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Jt(i.version,t.version))return[{command:"setStyle",args:[t]}];Jt(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Jt(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Jt(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Jt(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Jt(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Jt(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Jt(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Jt(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Jt(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Jt(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Jt(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,_,x,P){let A;for(A in _=_||{},m=m||{})Object.prototype.hasOwnProperty.call(m,A)&&(Object.prototype.hasOwnProperty.call(_,A)||Kr(A,x,P));for(A in _)Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(m,A)?Jt(m[A],_[A])||(m[A].type==="geojson"&&_[A].type==="geojson"&&qn(m,_,A)?wi(x,{command:"setGeoJSONSourceData",args:[A,_[A].data]}):Br(A,_,x,P)):kn(A,_,x))})(i.sources,t.sources,u,o);const p=[];i.layers&&i.layers.forEach(m=>{"source"in m&&o[m.source]?r.push({command:"removeLayer",args:[m.id]}):p.push(m)}),r=r.concat(u),function(m,_,x){_=_||[];const P=(m=m||[]).map(es),A=_.map(es),k=m.reduce(ws,{}),D=_.reduce(ws,{}),F=P.slice(),j=Object.create(null);let Z,Q,ne,xe,he;for(let _e=0,Ee=0;_e<P.length;_e++)Z=P[_e],Object.prototype.hasOwnProperty.call(D,Z)?Ee++:(wi(x,{command:"removeLayer",args:[Z]}),F.splice(F.indexOf(Z,Ee),1));for(let _e=0,Ee=0;_e<A.length;_e++)Z=A[A.length-1-_e],F[F.length-1-_e]!==Z&&(Object.prototype.hasOwnProperty.call(k,Z)?(wi(x,{command:"removeLayer",args:[Z]}),F.splice(F.lastIndexOf(Z,F.length-Ee),1)):Ee++,xe=F[F.length-_e],wi(x,{command:"addLayer",args:[D[Z],xe]}),F.splice(F.length-_e,0,Z),j[Z]=!0);for(let _e=0;_e<A.length;_e++)if(Z=A[_e],Q=k[Z],ne=D[Z],!j[Z]&&!Jt(Q,ne))if(Jt(Q.source,ne.source)&&Jt(Q["source-layer"],ne["source-layer"])&&Jt(Q.type,ne.type)){for(he in Ar(Q.layout,ne.layout,x,Z,null,"setLayoutProperty"),Ar(Q.paint,ne.paint,x,Z,null,"setPaintProperty"),Jt(Q.filter,ne.filter)||wi(x,{command:"setFilter",args:[Z,ne.filter]}),Jt(Q.minzoom,ne.minzoom)&&Jt(Q.maxzoom,ne.maxzoom)||wi(x,{command:"setLayerZoomRange",args:[Z,ne.minzoom,ne.maxzoom]}),Q)Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(Q[he],ne[he],x,Z,he.slice(6),"setPaintProperty"):Jt(Q[he],ne[he])||wi(x,{command:"setLayerProperty",args:[Z,he,ne[he]]}));for(he in ne)Object.prototype.hasOwnProperty.call(ne,he)&&!Object.prototype.hasOwnProperty.call(Q,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?Ar(Q[he],ne[he],x,Z,he.slice(6),"setPaintProperty"):Jt(Q[he],ne[he])||wi(x,{command:"setLayerProperty",args:[Z,he,ne[he]]}))}else wi(x,{command:"removeLayer",args:[Z]}),xe=F[F.lastIndexOf(Z)+1],wi(x,{command:"addLayer",args:[ne,xe]})}(p,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!i(t[o],r[o]))return!1;return!0}return t===r},w.aF=Ge,w.aG=gt,w.aH=class extends va{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=Af,w.aJ=class extends va{constructor(i,t){super(i,t),this.current=vw}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=Av,w.aL=Cv,w.aM=gi,w.aN=class extends va{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends va{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,o,u,p,m){var _=1/(t-r),x=1/(o-u),P=1/(p-m);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+r)*_,i[13]=(u+o)*x,i[14]=(m+p)*P,i[15]=1,i},w.aQ=Iw,w.aR=class extends fe{},w.aS=_1,w.aT=class extends Se{},w.aU=G_,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=qv,w.aX=vr,w.aY=bn,w.aZ=class extends wt{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,p)=>{const m=u||p;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){const r=[];for(const o in i)o in t||r.push(o);return r},w.ac=Me,w.ad=function(i,t,r){var o=Math.sin(r),u=Math.cos(r),p=t[0],m=t[1],_=t[2],x=t[3],P=t[4],A=t[5],k=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=p*u+P*o,i[1]=m*u+A*o,i[2]=_*u+k*o,i[3]=x*u+D*o,i[4]=P*u-p*o,i[5]=A*u-m*o,i[6]=k*u-_*o,i[7]=D*u-x*o,i},w.ae=function(i){var t=new Al(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=Mf,w.ag=function(i,t){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:m}=i,_=u?Me(jr.interpolationFactor(u,t,p,m),0,1):0;i.kind==="camera"?o=Vr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:o}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/as:i.kind==="composite"?Vr.number(o/as,u/as,r):t},w.aj=ay,w.ak=function(i,t,r,o){const u=t.y-i.y,p=t.x-i.x,m=o.y-r.y,_=o.x-r.x,x=m*p-_*u;if(x===0)return null;const P=(_*(i.y-r.y)-m*(i.x-r.x))/x;return new V(i.x+P*p,i.y+P*u)},w.al=Zx,w.am=zv,w.an=U_,w.ao=function(i){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const p of i)t=Math.min(t,p.x),r=Math.min(r,p.y),o=Math.max(o,p.x),u=Math.max(u,p.y);return[t,r,o,u]},w.ap=or,w.ar=oy,w.as=function(i,t){var r=t[0],o=t[1],u=t[2],p=t[3],m=t[4],_=t[5],x=t[6],P=t[7],A=t[8],k=t[9],D=t[10],F=t[11],j=t[12],Z=t[13],Q=t[14],ne=t[15],xe=r*_-o*m,he=r*x-u*m,_e=r*P-p*m,Ee=o*x-u*_,qe=o*P-p*_,ct=u*P-p*x,zt=A*Z-k*j,ot=A*Q-D*j,rt=A*ne-F*j,Pt=k*Q-D*Z,ft=k*ne-F*Z,dt=D*ne-F*Q,De=xe*dt-he*ft+_e*Pt+Ee*rt-qe*ot+ct*zt;return De?(i[0]=(_*dt-x*ft+P*Pt)*(De=1/De),i[1]=(u*ft-o*dt-p*Pt)*De,i[2]=(Z*ct-Q*qe+ne*Ee)*De,i[3]=(D*qe-k*ct-F*Ee)*De,i[4]=(x*rt-m*dt-P*ot)*De,i[5]=(r*dt-u*rt+p*ot)*De,i[6]=(Q*_e-j*ct-ne*he)*De,i[7]=(A*ct-D*_e+F*he)*De,i[8]=(m*ft-_*rt+P*zt)*De,i[9]=(o*rt-r*ft-p*zt)*De,i[10]=(j*qe-Z*_e+ne*xe)*De,i[11]=(k*_e-A*qe-F*xe)*De,i[12]=(_*ot-m*Pt-x*zt)*De,i[13]=(r*Pt-o*ot+u*zt)*De,i[14]=(Z*he-j*Ee-Q*xe)*De,i[15]=(A*Ee-k*he+D*xe)*De,i):null},w.at=my,w.au=sy,w.av=gy,w.aw=function(){const i={},t=we.$version;for(const r in we.$root){const o=we.$root[r];if(o.required){let u=null;u=r==="version"?t:o.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},w.ax=Cu,w.ay=Vi,w.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Ir(i[r],t[i[r].ref]));return i},w.b=yt,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=je,w.b4=Fx,w.b5=Lx,w.b6=function(i,t,r,o,u){var p,m=1/Math.tan(t/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(p=1/(o-u)),i[14]=2*u*o*p):(i[10]=-1,i[14]=-2*o),i},w.b7=function(i,t,r){var o=Math.sin(r),u=Math.cos(r),p=t[4],m=t[5],_=t[6],x=t[7],P=t[8],A=t[9],k=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=p*u+P*o,i[5]=m*u+A*o,i[6]=_*u+k*o,i[7]=x*u+D*o,i[8]=P*u-p*o,i[9]=A*u-m*o,i[10]=k*u-_*o,i[11]=D*u-x*o,i},w.b8=Ae,w.b9=ze,w.bA=cx,w.bB=function(i){return i.message===jt},w.bC=ho,w.bD=en,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){const{x:r,y:o}=Xu.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends C{},w.be=hy,w.bf=$1,w.bh=Ni,w.bi=function(i,t){fi.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete fi.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){const r={};for(let u=0;u<i.length;u++){const p=t&&t[i[u].id]||mf(i[u]);t&&(t[i[u].id]=p);let m=r[p];m||(m=r[p]=[]),m.push(i[u])}const o=[];for(const u in r)o.push(r[u]);return o},w.bl=pt,w.bm=Nx,w.bn=jx,w.bo=yx,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=nr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ei(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ei(P),i.canonical),o["text-size"].possiblyEvaluate(new Ei(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ei(P),i.canonical),o["icon-size"].possiblyEvaluate(new Ei(A),i.canonical)]}const p=r.get("text-line-height")*or,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),x=r.get("text-size");for(const P of i.bucket.features){const A=r.get("text-font").evaluate(P,{},i.canonical).join(","),k=x.evaluate(P,{},i.canonical),D=u.layoutTextSize.evaluate(P,{},i.canonical),F=u.layoutIconSize.evaluate(P,{},i.canonical),j={horizontal:{},vertical:void 0},Z=P.text;let Q,ne=[0,0];if(Z){const _e=Z.toString(),Ee=r.get("text-letter-spacing").evaluate(P,{},i.canonical)*or,qe=M_(_e)?Ee:0,ct=r.get("text-anchor").evaluate(P,{},i.canonical),zt=$x(t,P,i.canonical);if(!zt){const ft=r.get("text-radial-offset").evaluate(P,{},i.canonical);ne=ft?Qx(ct,[ft*or,fy]):r.get("text-offset").evaluate(P,{},i.canonical).map(dt=>dt*or)}let ot=m?"center":r.get("text-justify").evaluate(P,{},i.canonical);const rt=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(P,{},i.canonical)*or:1/0,Pt=()=>{i.bucket.allowVerticalPlacement&&Eu(_e)&&(j.vertical=Ff(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,rt,p,ct,"left",qe,ne,w.ah.vertical,!0,D,k))};if(!m&&zt){const ft=new Set;if(ot==="auto")for(let De=0;De<zt.values.length;De+=2)ft.add(my(zt.values[De]));else ft.add(ot);let dt=!1;for(const De of ft)if(!j.horizontal[De])if(dt)j.horizontal[De]=j.horizontal[0];else{const Tt=Ff(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,rt,p,"center",De,qe,ne,w.ah.horizontal,!1,D,k);Tt&&(j.horizontal[De]=Tt,dt=Tt.positionedLines.length===1)}Pt()}else{ot==="auto"&&(ot=my(ct));const ft=Ff(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,rt,p,ct,ot,qe,ne,w.ah.horizontal,!1,D,k);ft&&(j.horizontal[ot]=ft),Pt(),Eu(_e)&&m&&_&&(j.vertical=Ff(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,rt,p,ct,ot,qe,ne,w.ah.vertical,!1,D,k))}}let xe=!1;if(P.icon&&P.icon.name){const _e=i.imageMap[P.icon.name];_e&&(Q=L1(i.imagePositions[P.icon.name],r.get("icon-offset").evaluate(P,{},i.canonical),r.get("icon-anchor").evaluate(P,{},i.canonical)),xe=!!_e.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=xe:i.bucket.sdfIcons!==xe&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const he=t0(j.horizontal)||j.vertical;i.bucket.iconsInText=!!he&&he.iconsInText,(he||Q)&&Y1(i.bucket,P,j,Q,i.imageMap,u,D,F,ne,xe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=$_,w.br=J_,w.bs=Q_,w.bt=Eo,w.bu=ty,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,o,u){return c(this,void 0,void 0,function*(){if(pe())try{return yield ht(i,t,r,o,u)}catch{}return function(p,m,_,x,P){const A=p.width,k=p.height;mt&&Rt||(mt=new OffscreenCanvas(A,k),Rt=mt.getContext("2d",{willReadFrequently:!0})),mt.width=A,mt.height=k,Rt.drawImage(p,0,0,A,k);const D=Rt.getImageData(m,_,x,P);return Rt.clearRect(0,0,A,k),D.data}(i,t,r,o,u)})},w.bx=Bx,w.by=U,w.bz=q,w.c=Ti,w.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=Je,w.f=i=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=xt})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):xt}),w.g=bi,w.h=(i,t)=>tr(Je(i,{type:"json"}),t),w.i=He,w.j=vt,w.k=ar,w.l=(i,t)=>tr(Je(i,{type:"arrayBuffer"}),t),w.m=tr,w.n=function(i){return new ty(i).readFields(C1,[])},w.o=Bu,w.p=_x,w.q=d,w.r=E_,w.s=Fr,w.t=Iu,w.u=Rs,w.v=we,w.w=Fe,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=Vr,w.z=Ei}),I("worker",["./shared"],function(w){class c{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,L){for(const $ of O){this._layerConfigs[$.id]=$;const de=this._layers[$.id]=w.aA($);de._featureFilter=w.a7(de.filter),this.keyCache[$.id]&&delete this.keyCache[$.id]}for(const $ of L)delete this.keyCache[$],delete this._layerConfigs[$],delete this._layers[$];this.familiesBySource={};const H=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const $ of H){const de=$.map(Ie=>this._layers[Ie.id]),me=de[0];if(me.visibility==="none")continue;const ve=me.source||"";let le=this.familiesBySource[ve];le||(le=this.familiesBySource[ve]={});const ke=me.sourceLayer||"_geojsonTileLayer";let Be=le[ke];Be||(Be=le[ke]=[]),Be.push(de)}}}class U{constructor(O){const L={},H=[];for(const ve in O){const le=O[ve],ke=L[ve]={};for(const Be in le){const Ie=le[+Be];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Qe={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};H.push(Qe),ke[Be]={rect:Qe,metrics:Ie.metrics}}}const{w:$,h:de}=w.p(H),me=new w.o({width:$||1,height:de||1});for(const ve in O){const le=O[ve];for(const ke in le){const Be=le[+ke];if(!Be||Be.bitmap.width===0||Be.bitmap.height===0)continue;const Ie=L[ve][ke].rect;w.o.copy(Be.bitmap,me,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Be.bitmap)}}this.image=me,this.positions=L}}w.bl("GlyphAtlas",U);class q{constructor(O){this.tileID=new w.S(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,L,H,$){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new w.a5;const de=new w.bm(Object.keys(O.layers).sort()),me=new w.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const ve={},le={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:H},ke=L.familiesBySource[this.source];for(const Wt in ke){const mi=O.layers[Wt];if(!mi)continue;mi.version===1&&w.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Li=de.encode(Wt),lr=[];for(let dr=0;dr<mi.length;dr++){const Er=mi.feature(dr),eo=me.getId(Er,Wt);lr.push({feature:Er,id:eo,index:dr,sourceLayerIndex:Li})}for(const dr of ke[Wt]){const Er=dr[0];Er.source!==this.source&&w.w(`layer.source = ${Er.source} does not equal this.source = ${this.source}`),Er.minzoom&&this.zoom<Math.floor(Er.minzoom)||Er.maxzoom&&this.zoom>=Er.maxzoom||Er.visibility!=="none"&&(K(dr,this.zoom,H),(ve[Er.id]=Er.createBucket({index:me.bucketLayerIDs.length,layers:dr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Li,sourceID:this.source})).populate(lr,le,this.tileID.canonical),me.bucketLayerIDs.push(dr.map(eo=>eo.id)))}}const Be=w.aF(le.glyphDependencies,Wt=>Object.keys(Wt).map(Number));this.inFlightDependencies.forEach(Wt=>Wt==null?void 0:Wt.abort()),this.inFlightDependencies=[];let Ie=Promise.resolve({});if(Object.keys(Be).length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),Ie=$.sendAsync({type:"GG",data:{stacks:Be,source:this.source,tileID:this.tileID,type:"glyphs"}},Wt)}const Qe=Object.keys(le.iconDependencies);let It=Promise.resolve({});if(Qe.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),It=$.sendAsync({type:"GI",data:{icons:Qe,source:this.source,tileID:this.tileID,type:"icons"}},Wt)}const Mt=Object.keys(le.patternDependencies);let ni=Promise.resolve({});if(Mt.length){const Wt=new AbortController;this.inFlightDependencies.push(Wt),ni=$.sendAsync({type:"GI",data:{icons:Mt,source:this.source,tileID:this.tileID,type:"patterns"}},Wt)}const[qt,si,Qt]=yield Promise.all([Ie,It,ni]),ir=new U(qt),Ui=new w.bo(si,Qt);for(const Wt in ve){const mi=ve[Wt];mi instanceof w.a6?(K(mi.layers,this.zoom,H),w.bp({bucket:mi,glyphMap:qt,glyphPositions:ir.positions,imageMap:si,imagePositions:Ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):mi.hasPattern&&(mi instanceof w.bq||mi instanceof w.br||mi instanceof w.bs)&&(K(mi.layers,this.zoom,H),mi.addFeatures(le,this.tileID.canonical,Ui.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter(Wt=>!Wt.isEmpty()),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ir.image,imageAtlas:Ui,glyphMap:this.returnDependencies?qt:null,iconMap:this.returnDependencies?si:null,glyphPositions:this.returnDependencies?ir.positions:null}})}}function K(re,O,L){const H=new w.z(O);for(const $ of re)$.recalculate(H,L)}class V{constructor(O,L,H){this.actor=O,this.layerIndex=L,this.availableImages=H,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,L){return w._(this,void 0,void 0,function*(){const H=yield w.l(O.request,L);try{return{vectorTile:new w.bt.VectorTile(new w.bu(H.data)),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch($){const de=new Uint8Array(H.data);let me=`Unable to parse the tile at ${O.request.url}, `;throw me+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${$.message}`,new Error(me)}})}loadTile(O){return w._(this,void 0,void 0,function*(){const L=O.uid,H=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request),$=new q(O);this.loading[L]=$;const de=new AbortController;$.abort=de;try{const me=yield this.loadVectorTile(O,de);if(delete this.loading[L],!me)return null;const ve=me.rawData,le={};me.expires&&(le.expires=me.expires),me.cacheControl&&(le.cacheControl=me.cacheControl);const ke={};if(H){const Ie=H.finish();Ie&&(ke.resourceTiming=JSON.parse(JSON.stringify(Ie)))}$.vectorTile=me.vectorTile;const Be=$.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=$,this.fetching[L]={rawTileData:ve,cacheControl:le,resourceTiming:ke};try{const Ie=yield Be;return w.e({rawTileData:ve.slice(0)},Ie,le,ke)}finally{delete this.fetching[L]}}catch(me){throw delete this.loading[L],$.status="done",this.loaded[L]=$,me}})}reloadTile(O){return w._(this,void 0,void 0,function*(){const L=O.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[L];if(H.showCollisionBoxes=O.showCollisionBoxes,H.status==="parsing"){const $=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[L]){const{rawTileData:me,cacheControl:ve,resourceTiming:le}=this.fetching[L];delete this.fetching[L],de=w.e({rawTileData:me.slice(0)},$,ve,le)}else de=$;return de}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return w._(this,void 0,void 0,function*(){const L=this.loading,H=O.uid;L&&L[H]&&L[H].abort&&(L[H].abort.abort(),delete L[H])})}removeTile(O){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class N{constructor(){this.loaded={}}loadTile(O){return w._(this,void 0,void 0,function*(){const{uid:L,encoding:H,rawImageData:$,redFactor:de,greenFactor:me,blueFactor:ve,baseShift:le}=O,ke=$.width+2,Be=$.height+2,Ie=w.b($)?new w.R({width:ke,height:Be},yield w.bw($,-1,-1,ke,Be)):$,Qe=new w.bx(L,Ie,H,de,me,ve,le);return this.loaded=this.loaded||{},this.loaded[L]=Qe,Qe})}removeTile(O){const L=this.loaded,H=O.uid;L&&L[H]&&delete L[H]}}function ie(re,O){if(re.length!==0){te(re[0],O);for(var L=1;L<re.length;L++)te(re[L],!O)}}function te(re,O){for(var L=0,H=0,$=0,de=re.length,me=de-1;$<de;me=$++){var ve=(re[$][0]-re[me][0])*(re[me][1]+re[$][1]),le=L+ve;H+=Math.abs(L)>=Math.abs(ve)?L-le+ve:ve-le+L,L=le}L+H>=0!=!!O&&re.reverse()}var oe=w.by(function re(O,L){var H,$=O&&O.type;if($==="FeatureCollection")for(H=0;H<O.features.length;H++)re(O.features[H],L);else if($==="GeometryCollection")for(H=0;H<O.geometries.length;H++)re(O.geometries[H],L);else if($==="Feature")re(O.geometry,L);else if($==="Polygon")ie(O.coordinates,L);else if($==="MultiPolygon")for(H=0;H<O.coordinates.length;H++)ie(O.coordinates[H],L);return O});const ue=w.bt.VectorTileFeature.prototype.toGeoJSON;var ye={exports:{}},pe=w.bz,Ae=w.bt.VectorTileFeature,ze=Me;function Me(re,O){this.options=O||{},this.features=re,this.length=re.length}function je(re,O){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=O||4096}Me.prototype.feature=function(re){return new je(this.features[re],this.options.extent)},je.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var O=0;O<re.length;O++){for(var L=re[O],H=[],$=0;$<L.length;$++)H.push(new pe(L[$][0],L[$][1]));this.geometry.push(H)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,O=1/0,L=-1/0,H=1/0,$=-1/0,de=0;de<re.length;de++)for(var me=re[de],ve=0;ve<me.length;ve++){var le=me[ve];O=Math.min(O,le.x),L=Math.max(L,le.x),H=Math.min(H,le.y),$=Math.max($,le.y)}return[O,H,L,$]},je.prototype.toGeoJSON=Ae.prototype.toGeoJSON;var Je=w.bA,_t=ze;function Ge(re){var O=new Je;return function(L,H){for(var $ in L.layers)H.writeMessage(3,gt,L.layers[$])}(re,O),O.finish()}function gt(re,O){var L;O.writeVarintField(15,re.version||1),O.writeStringField(1,re.name||""),O.writeVarintField(5,re.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<re.length;L++)H.feature=re.feature(L),O.writeMessage(2,at,H);var $=H.keys;for(L=0;L<$.length;L++)O.writeStringField(3,$[L]);var de=H.values;for(L=0;L<de.length;L++)O.writeMessage(4,st,de[L])}function at(re,O){var L=re.feature;L.id!==void 0&&O.writeVarintField(1,L.id),O.writeMessage(2,Ue,re),O.writeVarintField(3,L.type),O.writeMessage(4,He,L)}function Ue(re,O){var L=re.feature,H=re.keys,$=re.values,de=re.keycache,me=re.valuecache;for(var ve in L.properties){var le=L.properties[ve],ke=de[ve];if(le!==null){ke===void 0&&(H.push(ve),de[ve]=ke=H.length-1),O.writeVarint(ke);var Be=typeof le;Be!=="string"&&Be!=="boolean"&&Be!=="number"&&(le=JSON.stringify(le));var Ie=Be+":"+le,Qe=me[Ie];Qe===void 0&&($.push(le),me[Ie]=Qe=$.length-1),O.writeVarint(Qe)}}}function Fe(re,O){return(O<<3)+(7&re)}function Ce(re){return re<<1^re>>31}function He(re,O){for(var L=re.loadGeometry(),H=re.type,$=0,de=0,me=L.length,ve=0;ve<me;ve++){var le=L[ve],ke=1;H===1&&(ke=le.length),O.writeVarint(Fe(1,ke));for(var Be=H===3?le.length-1:le.length,Ie=0;Ie<Be;Ie++){Ie===1&&H!==1&&O.writeVarint(Fe(2,Be-1));var Qe=le[Ie].x-$,It=le[Ie].y-de;O.writeVarint(Ce(Qe)),O.writeVarint(Ce(It)),$+=Qe,de+=It}H===3&&O.writeVarint(Fe(7,1))}}function st(re,O){var L=typeof re;L==="string"?O.writeStringField(1,re):L==="boolean"?O.writeBooleanField(7,re):L==="number"&&(re%1!=0?O.writeDoubleField(3,re):re<0?O.writeSVarintField(6,re):O.writeVarintField(5,re))}ye.exports=Ge,ye.exports.fromVectorTileJs=Ge,ye.exports.fromGeojsonVt=function(re,O){O=O||{};var L={};for(var H in re)L[H]=new _t(re[H].features,O),L[H].name=H,L[H].version=O.version,L[H].extent=O.extent;return Ge({layers:L})},ye.exports.GeoJSONWrapper=_t;var yt=w.by(ye.exports);const xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},ht=Math.fround||(mt=new Float32Array(1),re=>(mt[0]=+re,mt[0]));var mt;const Rt=3,jt=5,Ti=6;class fi{constructor(O){this.options=Object.assign(Object.create(xt),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:L,minZoom:H,maxZoom:$}=this.options;L&&console.time("total time");const de=`prepare ${O.length} points`;L&&console.time(de),this.points=O;const me=[];for(let le=0;le<O.length;le++){const ke=O[le];if(!ke.geometry)continue;const[Be,Ie]=ke.geometry.coordinates,Qe=ht(Ni(Be)),It=ht(Vi(Ie));me.push(Qe,It,1/0,le,-1,1),this.options.reduce&&me.push(0)}let ve=this.trees[$+1]=this._createTree(me);L&&console.timeEnd(de);for(let le=$;le>=H;le--){const ke=+Date.now();ve=this.trees[le]=this._createTree(this._cluster(ve,le)),L&&console.log("z%d: %d clusters in %dms",le,ve.numItems,+Date.now()-ke)}return L&&console.timeEnd("total time"),this}getClusters(O,L){let H=((O[0]+180)%360+360)%360-180;const $=Math.max(-90,Math.min(90,O[1]));let de=O[2]===180?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)H=-180,de=180;else if(H>de){const Ie=this.getClusters([H,$,180,me],L),Qe=this.getClusters([-180,$,de,me],L);return Ie.concat(Qe)}const ve=this.trees[this._limitZoom(L)],le=ve.range(Ni(H),Vi(me),Ni(de),Vi($)),ke=ve.data,Be=[];for(const Ie of le){const Qe=this.stride*Ie;Be.push(ke[Qe+jt]>1?bi(ke,Qe,this.clusterProps):this.points[ke[Qe+Rt]])}return Be}getChildren(O){const L=this._getOriginId(O),H=this._getOriginZoom(O),$="No cluster with the specified id.",de=this.trees[H];if(!de)throw new Error($);const me=de.data;if(L*this.stride>=me.length)throw new Error($);const ve=this.options.radius/(this.options.extent*Math.pow(2,H-1)),le=de.within(me[L*this.stride],me[L*this.stride+1],ve),ke=[];for(const Be of le){const Ie=Be*this.stride;me[Ie+4]===O&&ke.push(me[Ie+jt]>1?bi(me,Ie,this.clusterProps):this.points[me[Ie+Rt]])}if(ke.length===0)throw new Error($);return ke}getLeaves(O,L,H){const $=[];return this._appendLeaves($,O,L=L||10,H=H||0,0),$}getTile(O,L,H){const $=this.trees[this._limitZoom(O)],de=Math.pow(2,O),{extent:me,radius:ve}=this.options,le=ve/me,ke=(H-le)/de,Be=(H+1+le)/de,Ie={features:[]};return this._addTileFeatures($.range((L-le)/de,ke,(L+1+le)/de,Be),$.data,L,H,de,Ie),L===0&&this._addTileFeatures($.range(1-le/de,ke,1,Be),$.data,de,H,de,Ie),L===de-1&&this._addTileFeatures($.range(0,ke,le/de,Be),$.data,-1,H,de,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(O){let L=this._getOriginZoom(O)-1;for(;L<=this.options.maxZoom;){const H=this.getChildren(O);if(L++,H.length!==1)break;O=H[0].properties.cluster_id}return L}_appendLeaves(O,L,H,$,de){const me=this.getChildren(L);for(const ve of me){const le=ve.properties;if(le&&le.cluster?de+le.point_count<=$?de+=le.point_count:de=this._appendLeaves(O,le.cluster_id,H,$,de):de<$?de++:O.push(ve),O.length===H)break}return de}_createTree(O){const L=new w.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<O.length;H+=this.stride)L.add(O[H],O[H+1]);return L.finish(),L.data=O,L}_addTileFeatures(O,L,H,$,de,me){for(const ve of O){const le=ve*this.stride,ke=L[le+jt]>1;let Be,Ie,Qe;if(ke)Be=Hi(L,le,this.clusterProps),Ie=L[le],Qe=L[le+1];else{const ni=this.points[L[le+Rt]];Be=ni.properties;const[qt,si]=ni.geometry.coordinates;Ie=Ni(qt),Qe=Vi(si)}const It={type:1,geometry:[[Math.round(this.options.extent*(Ie*de-H)),Math.round(this.options.extent*(Qe*de-$))]],tags:Be};let Mt;Mt=ke||this.options.generateId?L[le+Rt]:this.points[L[le+Rt]].id,Mt!==void 0&&(It.id=Mt),me.features.push(It)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,L){const{radius:H,extent:$,reduce:de,minPoints:me}=this.options,ve=H/($*Math.pow(2,L)),le=O.data,ke=[],Be=this.stride;for(let Ie=0;Ie<le.length;Ie+=Be){if(le[Ie+2]<=L)continue;le[Ie+2]=L;const Qe=le[Ie],It=le[Ie+1],Mt=O.within(le[Ie],le[Ie+1],ve),ni=le[Ie+jt];let qt=ni;for(const si of Mt){const Qt=si*Be;le[Qt+2]>L&&(qt+=le[Qt+jt])}if(qt>ni&&qt>=me){let si,Qt=Qe*ni,ir=It*ni,Ui=-1;const Wt=((Ie/Be|0)<<5)+(L+1)+this.points.length;for(const mi of Mt){const Li=mi*Be;if(le[Li+2]<=L)continue;le[Li+2]=L;const lr=le[Li+jt];Qt+=le[Li]*lr,ir+=le[Li+1]*lr,le[Li+4]=Wt,de&&(si||(si=this._map(le,Ie,!0),Ui=this.clusterProps.length,this.clusterProps.push(si)),de(si,this._map(le,Li)))}le[Ie+4]=Wt,ke.push(Qt/qt,ir/qt,1/0,Wt,-1,qt),de&&ke.push(Ui)}else{for(let si=0;si<Be;si++)ke.push(le[Ie+si]);if(qt>1)for(const si of Mt){const Qt=si*Be;if(!(le[Qt+2]<=L)){le[Qt+2]=L;for(let ir=0;ir<Be;ir++)ke.push(le[Qt+ir])}}}}return ke}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,L,H){if(O[L+jt]>1){const me=this.clusterProps[O[L+Ti]];return H?Object.assign({},me):me}const $=this.points[O[L+Rt]].properties,de=this.options.map($);return H&&de===$?Object.assign({},de):de}}function bi(re,O,L){return{type:"Feature",id:re[O+Rt],properties:Hi(re,O,L),geometry:{type:"Point",coordinates:[(H=re[O],360*(H-.5)),tr(re[O+1])]}};var H}function Hi(re,O,L){const H=re[O+jt],$=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,de=re[O+Ti],me=de===-1?{}:Object.assign({},L[de]);return Object.assign(me,{cluster:!0,cluster_id:re[O+Rt],point_count:H,point_count_abbreviated:$})}function Ni(re){return re/360+.5}function Vi(re){const O=Math.sin(re*Math.PI/180),L=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return L<0?0:L>1?1:L}function tr(re){const O=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Fr(re,O,L,H){let $=H;const de=O+(L-O>>1);let me,ve=L-O;const le=re[O],ke=re[O+1],Be=re[L],Ie=re[L+1];for(let Qe=O+3;Qe<L;Qe+=3){const It=Qi(re[Qe],re[Qe+1],le,ke,Be,Ie);if(It>$)me=Qe,$=It;else if(It===$){const Mt=Math.abs(Qe-de);Mt<ve&&(me=Qe,ve=Mt)}}$>H&&(me-O>3&&Fr(re,O,me,H),re[me+2]=$,L-me>3&&Fr(re,me,L,H))}function Qi(re,O,L,H,$,de){let me=$-L,ve=de-H;if(me!==0||ve!==0){const le=((re-L)*me+(O-H)*ve)/(me*me+ve*ve);le>1?(L=$,H=de):le>0&&(L+=me*le,H+=ve*le)}return me=re-L,ve=O-H,me*me+ve*ve}function sr(re,O,L,H){const $={id:re??null,type:O,geometry:L,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")ar($,L);else if(O==="Polygon")ar($,L[0]);else if(O==="MultiLineString")for(const de of L)ar($,de);else if(O==="MultiPolygon")for(const de of L)ar($,de[0]);return $}function ar(re,O){for(let L=0;L<O.length;L+=3)re.minX=Math.min(re.minX,O[L]),re.minY=Math.min(re.minY,O[L+1]),re.maxX=Math.max(re.maxX,O[L]),re.maxY=Math.max(re.maxY,O[L+1])}function vt(re,O,L,H){if(!O.geometry)return;const $=O.geometry.coordinates;if($&&$.length===0)return;const de=O.geometry.type,me=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2);let ve=[],le=O.id;if(L.promoteId?le=O.properties[L.promoteId]:L.generateId&&(le=H||0),de==="Point")Lt($,ve);else if(de==="MultiPoint")for(const ke of $)Lt(ke,ve);else if(de==="LineString")we($,ve,me,!1);else if(de==="MultiLineString"){if(L.lineMetrics){for(const ke of $)ve=[],we(ke,ve,me,!1),re.push(sr(le,"LineString",ve,O.properties));return}ji($,ve,me,!1)}else if(de==="Polygon")ji($,ve,me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const ke of O.geometry.geometries)vt(re,{id:le,geometry:ke,properties:O.properties},L,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of $){const Be=[];ji(ke,Be,me,!0),ve.push(Be)}}re.push(sr(le,de,ve,O.properties))}function Lt(re,O){O.push(Ir(re[0]),Jt(re[1]),0)}function we(re,O,L,H){let $,de,me=0;for(let le=0;le<re.length;le++){const ke=Ir(re[le][0]),Be=Jt(re[le][1]);O.push(ke,Be,0),le>0&&(me+=H?($*Be-ke*de)/2:Math.sqrt(Math.pow(ke-$,2)+Math.pow(Be-de,2))),$=ke,de=Be}const ve=O.length-3;O[2]=1,Fr(O,0,ve,L),O[ve+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function ji(re,O,L,H){for(let $=0;$<re.length;$++){const de=[];we(re[$],de,L,H),O.push(de)}}function Ir(re){return re/360+.5}function Jt(re){const O=Math.sin(re*Math.PI/180),L=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return L<0?0:L>1?1:L}function wi(re,O,L,H,$,de,me,ve){if(H/=O,de>=(L/=O)&&me<H)return re;if(me<L||de>=H)return null;const le=[];for(const ke of re){const Be=ke.geometry;let Ie=ke.type;const Qe=$===0?ke.minX:ke.minY,It=$===0?ke.maxX:ke.maxY;if(Qe>=L&&It<H){le.push(ke);continue}if(It<L||Qe>=H)continue;let Mt=[];if(Ie==="Point"||Ie==="MultiPoint")kn(Be,Mt,L,H,$);else if(Ie==="LineString")Kr(Be,Mt,L,H,$,!1,ve.lineMetrics);else if(Ie==="MultiLineString")qn(Be,Mt,L,H,$,!1);else if(Ie==="Polygon")qn(Be,Mt,L,H,$,!0);else if(Ie==="MultiPolygon")for(const ni of Be){const qt=[];qn(ni,qt,L,H,$,!0),qt.length&&Mt.push(qt)}if(Mt.length){if(ve.lineMetrics&&Ie==="LineString"){for(const ni of Mt)le.push(sr(ke.id,Ie,ni,ke.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Mt.length===1?(Ie="LineString",Mt=Mt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Mt.length===3?"Point":"MultiPoint"),le.push(sr(ke.id,Ie,Mt,ke.tags))}}return le.length?le:null}function kn(re,O,L,H,$){for(let de=0;de<re.length;de+=3){const me=re[de+$];me>=L&&me<=H&&Ar(O,re[de],re[de+1],re[de+2])}}function Kr(re,O,L,H,$,de,me){let ve=Br(re);const le=$===0?es:ws;let ke,Be,Ie=re.start;for(let qt=0;qt<re.length-3;qt+=3){const si=re[qt],Qt=re[qt+1],ir=re[qt+2],Ui=re[qt+3],Wt=re[qt+4],mi=$===0?si:Qt,Li=$===0?Ui:Wt;let lr=!1;me&&(ke=Math.sqrt(Math.pow(si-Ui,2)+Math.pow(Qt-Wt,2))),mi<L?Li>L&&(Be=le(ve,si,Qt,Ui,Wt,L),me&&(ve.start=Ie+ke*Be)):mi>H?Li<H&&(Be=le(ve,si,Qt,Ui,Wt,H),me&&(ve.start=Ie+ke*Be)):Ar(ve,si,Qt,ir),Li<L&&mi>=L&&(Be=le(ve,si,Qt,Ui,Wt,L),lr=!0),Li>H&&mi<=H&&(Be=le(ve,si,Qt,Ui,Wt,H),lr=!0),!de&&lr&&(me&&(ve.end=Ie+ke*Be),O.push(ve),ve=Br(re)),me&&(Ie+=ke)}let Qe=re.length-3;const It=re[Qe],Mt=re[Qe+1],ni=$===0?It:Mt;ni>=L&&ni<=H&&Ar(ve,It,Mt,re[Qe+2]),Qe=ve.length-3,de&&Qe>=3&&(ve[Qe]!==ve[0]||ve[Qe+1]!==ve[1])&&Ar(ve,ve[0],ve[1],ve[2]),ve.length&&O.push(ve)}function Br(re){const O=[];return O.size=re.size,O.start=re.start,O.end=re.end,O}function qn(re,O,L,H,$,de){for(const me of re)Kr(me,O,L,H,$,de,!1)}function Ar(re,O,L,H){re.push(O,L,H)}function es(re,O,L,H,$,de){const me=(de-O)/(H-O);return Ar(re,de,L+($-L)*me,1),me}function ws(re,O,L,H,$,de){const me=(de-L)/($-L);return Ar(re,O+(H-O)*me,de,1),me}function Xe(re,O){const L=[];for(let H=0;H<re.length;H++){const $=re[H],de=$.type;let me;if(de==="Point"||de==="MultiPoint"||de==="LineString")me=Mn($.geometry,O);else if(de==="MultiLineString"||de==="Polygon"){me=[];for(const ve of $.geometry)me.push(Mn(ve,O))}else if(de==="MultiPolygon"){me=[];for(const ve of $.geometry){const le=[];for(const ke of ve)le.push(Mn(ke,O));me.push(le)}}L.push(sr($.id,de,me,$.tags))}return L}function Mn(re,O){const L=[];L.size=re.size,re.start!==void 0&&(L.start=re.start,L.end=re.end);for(let H=0;H<re.length;H+=3)L.push(re[H]+O,re[H+1],re[H+2]);return L}function Cr(re,O){if(re.transformed)return re;const L=1<<re.z,H=re.x,$=re.y;for(const de of re.features){const me=de.geometry,ve=de.type;if(de.geometry=[],ve===1)for(let le=0;le<me.length;le+=2)de.geometry.push(zn(me[le],me[le+1],O,L,H,$));else for(let le=0;le<me.length;le++){const ke=[];for(let Be=0;Be<me[le].length;Be+=2)ke.push(zn(me[le][Be],me[le][Be+1],O,L,H,$));de.geometry.push(ke)}}return re.transformed=!0,re}function zn(re,O,L,H,$,de){return[Math.round(L*(re*H-$)),Math.round(L*(O*H-de))]}function ts(re,O,L,H,$){const de=O===$.maxZoom?0:$.tolerance/((1<<O)*$.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:re.length,source:null,x:L,y:H,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of re)tt(me,ve,de,$);return me}function tt(re,O,L,H){const $=O.geometry,de=O.type,me=[];if(re.minX=Math.min(re.minX,O.minX),re.minY=Math.min(re.minY,O.minY),re.maxX=Math.max(re.maxX,O.maxX),re.maxY=Math.max(re.maxY,O.maxY),de==="Point"||de==="MultiPoint")for(let ve=0;ve<$.length;ve+=3)me.push($[ve],$[ve+1]),re.numPoints++,re.numSimplified++;else if(de==="LineString")Ht(me,$,re,L,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let ve=0;ve<$.length;ve++)Ht(me,$[ve],re,L,de==="Polygon",ve===0);else if(de==="MultiPolygon")for(let ve=0;ve<$.length;ve++){const le=$[ve];for(let ke=0;ke<le.length;ke++)Ht(me,le[ke],re,L,!0,ke===0)}if(me.length){let ve=O.tags||null;if(de==="LineString"&&H.lineMetrics){ve={};for(const ke in O.tags)ve[ke]=O.tags[ke];ve.mapbox_clip_start=$.start/$.size,ve.mapbox_clip_end=$.end/$.size}const le={geometry:me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:ve};O.id!==null&&(le.id=O.id),re.features.push(le)}}function Ht(re,O,L,H,$,de){const me=H*H;if(H>0&&O.size<($?me:H))return void(L.numPoints+=O.length/3);const ve=[];for(let le=0;le<O.length;le+=3)(H===0||O[le+2]>me)&&(L.numSimplified++,ve.push(O[le],O[le+1])),L.numPoints++;$&&function(le,ke){let Be=0;for(let Ie=0,Qe=le.length,It=Qe-2;Ie<Qe;It=Ie,Ie+=2)Be+=(le[Ie]-le[It])*(le[Ie+1]+le[It+1]);if(Be>0===ke)for(let Ie=0,Qe=le.length;Ie<Qe/2;Ie+=2){const It=le[Ie],Mt=le[Ie+1];le[Ie]=le[Qe-2-Ie],le[Ie+1]=le[Qe-1-Ie],le[Qe-2-Ie]=It,le[Qe-1-Ie]=Mt}}(ve,de),re.push(ve)}const Ot={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nr{constructor(O,L){const H=(L=this.options=function(de,me){for(const ve in me)de[ve]=me[ve];return de}(Object.create(Ot),L)).debug;if(H&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");let $=function(de,me){const ve=[];if(de.type==="FeatureCollection")for(let le=0;le<de.features.length;le++)vt(ve,de.features[le],me,le);else vt(ve,de.type==="Feature"?de:{geometry:de},me);return ve}(O,L);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(de,me){const ve=me.buffer/me.extent;let le=de;const ke=wi(de,1,-1-ve,ve,0,-1,2,me),Be=wi(de,1,1-ve,2+ve,0,-1,2,me);return(ke||Be)&&(le=wi(de,1,-ve,1+ve,0,-1,2,me)||[],ke&&(le=Xe(ke,1).concat(le)),Be&&(le=le.concat(Xe(Be,-1)))),le}($,L),$.length&&this.splitTile($,0,0,0),H&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,L,H,$,de,me,ve){const le=[O,L,H,$],ke=this.options,Be=ke.debug;for(;le.length;){$=le.pop(),H=le.pop(),L=le.pop(),O=le.pop();const Ie=1<<L,Qe=fn(L,H,$);let It=this.tiles[Qe];if(!It&&(Be>1&&console.time("creation"),It=this.tiles[Qe]=ts(O,L,H,$,ke),this.tileCoords.push({z:L,x:H,y:$}),Be)){Be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,H,$,It.numFeatures,It.numPoints,It.numSimplified),console.timeEnd("creation"));const lr=`z${L}`;this.stats[lr]=(this.stats[lr]||0)+1,this.total++}if(It.source=O,de==null){if(L===ke.indexMaxZoom||It.numPoints<=ke.indexMaxPoints)continue}else{if(L===ke.maxZoom||L===de)continue;if(de!=null){const lr=de-L;if(H!==me>>lr||$!==ve>>lr)continue}}if(It.source=null,O.length===0)continue;Be>1&&console.time("clipping");const Mt=.5*ke.buffer/ke.extent,ni=.5-Mt,qt=.5+Mt,si=1+Mt;let Qt=null,ir=null,Ui=null,Wt=null,mi=wi(O,Ie,H-Mt,H+qt,0,It.minX,It.maxX,ke),Li=wi(O,Ie,H+ni,H+si,0,It.minX,It.maxX,ke);O=null,mi&&(Qt=wi(mi,Ie,$-Mt,$+qt,1,It.minY,It.maxY,ke),ir=wi(mi,Ie,$+ni,$+si,1,It.minY,It.maxY,ke),mi=null),Li&&(Ui=wi(Li,Ie,$-Mt,$+qt,1,It.minY,It.maxY,ke),Wt=wi(Li,Ie,$+ni,$+si,1,It.minY,It.maxY,ke),Li=null),Be>1&&console.timeEnd("clipping"),le.push(Qt||[],L+1,2*H,2*$),le.push(ir||[],L+1,2*H,2*$+1),le.push(Ui||[],L+1,2*H+1,2*$),le.push(Wt||[],L+1,2*H+1,2*$+1)}}getTile(O,L,H){O=+O,L=+L,H=+H;const $=this.options,{extent:de,debug:me}=$;if(O<0||O>24)return null;const ve=1<<O,le=fn(O,L=L+ve&ve-1,H);if(this.tiles[le])return Cr(this.tiles[le],de);me>1&&console.log("drilling down to z%d-%d-%d",O,L,H);let ke,Be=O,Ie=L,Qe=H;for(;!ke&&Be>0;)Be--,Ie>>=1,Qe>>=1,ke=this.tiles[fn(Be,Ie,Qe)];return ke&&ke.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Be,Ie,Qe),console.time("drilling down")),this.splitTile(ke.source,Be,Ie,Qe,O,L,H),me>1&&console.timeEnd("drilling down"),this.tiles[le]?Cr(this.tiles[le],de):null):null}}function fn(re,O,L){return 32*((1<<re)*L+O)+re}function Ut(re,O){return O?re.properties[O]:re.id}function Dn(re,O){if(re==null)return!0;if(re.type==="Feature")return Ut(re,O)!=null;if(re.type==="FeatureCollection"){const L=new Set;for(const H of re.features){const $=Ut(H,O);if($==null||L.has($))return!1;L.add($)}return!0}return!1}function Zn(re,O){const L=new Map;if(re!=null)if(re.type==="Feature")L.set(Ut(re,O),re);else for(const H of re.features)L.set(Ut(H,O),H);return L}class is extends V{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,L){return w._(this,void 0,void 0,function*(){const H=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const $=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!$)return null;const de=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(le){this._feature=le,this.extent=w.X,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const ke of this._feature.geometry)le.push([new w.P(ke[0],ke[1])]);return le}{const le=[];for(const ke of this._feature.geometry){const Be=[];for(const Ie of ke)Be.push(new w.P(Ie[0],Ie[1]));le.push(Be)}return le}}toGeoJSON(le,ke,Be){return ue.call(this,le,ke,Be)}}(this._features[ve])}}($.features);let me=yt(de);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:de,rawData:me.buffer}})}loadData(O){return w._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const H=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest),this._geoJSONIndex=O.cluster?new fi(function({superclusterOptions:me,clusterProperties:ve}){if(!ve||!me)return me;const le={},ke={},Be={accumulated:null,zoom:0},Ie={properties:null},Qe=Object.keys(ve);for(const It of Qe){const[Mt,ni]=ve[It],qt=w.bC(ni),si=w.bC(typeof Mt=="string"?[Mt,["accumulated"],["get",It]]:Mt);le[It]=qt.value,ke[It]=si.value}return me.map=It=>{Ie.properties=It;const Mt={};for(const ni of Qe)Mt[ni]=le[ni].evaluate(Be,Ie);return Mt},me.reduce=(It,Mt)=>{Ie.properties=Mt;for(const ni of Qe)Be.accumulated=It[ni],It[ni]=ke[ni].evaluate(Be,Ie)},me}(O)).load((yield this._pendingData).features):($=yield this._pendingData,new Nr($,O.geojsonVtOptions)),this.loaded={};const de={};if(H){const me=H.finish();me&&(de.resourceTiming={},de.resourceTiming[O.source]=JSON.parse(JSON.stringify(me)))}return de}catch(de){if(delete this._pendingRequest,w.bB(de))return{abandoned:!0};throw de}var $})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){const L=this.loaded;return L&&L[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,L){return w._(this,void 0,void 0,function*(){let H=yield this.loadGeoJSON(O,L);if(delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(oe(H,!0),O.filter){const $=w.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($.result==="error")throw new Error($.value.map(me=>`${me.key}: ${me.message}`).join(", "));H={type:"FeatureCollection",features:H.features.filter(me=>$.value.evaluate({zoom:0},me))}}return H})}loadGeoJSON(O,L){return w._(this,void 0,void 0,function*(){const{promoteId:H}=O;if(O.request){const $=yield w.h(O.request,L);return this._dataUpdateable=Dn($.data,H)?Zn($.data,H):void 0,$.data}if(typeof O.data=="string")try{const $=JSON.parse(O.data);return this._dataUpdateable=Dn($,H)?Zn($,H):void 0,$}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function($,de,me){var ve,le,ke,Be;if(de.removeAll&&$.clear(),de.remove)for(const Ie of de.remove)$.delete(Ie);if(de.add)for(const Ie of de.add){const Qe=Ut(Ie,me);Qe!=null&&$.set(Qe,Ie)}if(de.update)for(const Ie of de.update){let Qe=$.get(Ie.id);if(Qe==null)continue;const It=!Ie.removeAllProperties&&(((ve=Ie.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((le=Ie.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||It)&&(Qe=Object.assign({},Qe),$.set(Ie.id,Qe),It&&(Qe.properties=Object.assign({},Qe.properties))),Ie.newGeometry&&(Qe.geometry=Ie.newGeometry),Ie.removeAllProperties)Qe.properties={};else if(((ke=Ie.removeProperties)===null||ke===void 0?void 0:ke.length)>0)for(const Mt of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Qe.properties,Mt)&&delete Qe.properties[Mt];if(((Be=Ie.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0)for(const{key:Mt,value:ni}of Ie.addOrUpdateProperties)Qe.properties[Mt]=ni}}(this._dataUpdateable,O.dataDiff,H),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Rn{constructor(O){this.self=O,this.actor=new w.F(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,H)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=H},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=L=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,H)=>this._getDEMWorkerSource(L,H.source).loadTile(H)),this.actor.registerMessageHandler("RDT",(L,H)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,H.source).removeTile(H)})),this.actor.registerMessageHandler("GCEZ",(L,H)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,H.type,H.source).getClusterExpansionZoom(H)})),this.actor.registerMessageHandler("GCC",(L,H)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,H.type,H.source).getClusterChildren(H)})),this.actor.registerMessageHandler("GCL",(L,H)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(L,H.type,H.source).getClusterLeaves(H)})),this.actor.registerMessageHandler("LD",(L,H)=>this._getWorkerSource(L,H.type,H.source).loadData(H)),this.actor.registerMessageHandler("GD",(L,H)=>this._getWorkerSource(L,H.type,H.source).getData()),this.actor.registerMessageHandler("LT",(L,H)=>this._getWorkerSource(L,H.type,H.source).loadTile(H)),this.actor.registerMessageHandler("RT",(L,H)=>this._getWorkerSource(L,H.type,H.source).reloadTile(H)),this.actor.registerMessageHandler("AT",(L,H)=>this._getWorkerSource(L,H.type,H.source).abortTile(H)),this.actor.registerMessageHandler("RMT",(L,H)=>this._getWorkerSource(L,H.type,H.source).removeTile(H)),this.actor.registerMessageHandler("RS",(L,H)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][H.type]||!this.workerSources[L][H.type][H.source])return;const $=this.workerSources[L][H.type][H.source];delete this.workerSources[L][H.type][H.source],$.removeSource!==void 0&&$.removeSource(H)})),this.actor.registerMessageHandler("RM",L=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,H)=>w._(this,void 0,void 0,function*(){this.referrer=H})),this.actor.registerMessageHandler("SRPS",(L,H)=>this._syncRTLPluginState(L,H)),this.actor.registerMessageHandler("IS",(L,H)=>w._(this,void 0,void 0,function*(){this.self.importScripts(H)})),this.actor.registerMessageHandler("SI",(L,H)=>this._setImages(L,H)),this.actor.registerMessageHandler("UL",(L,H)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(H.layers,H.removedIds)})),this.actor.registerMessageHandler("SL",(L,H)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(H)}))}_setImages(O,L){return w._(this,void 0,void 0,function*(){this.availableImages[O]=L;for(const H in this.workerSources[O]){const $=this.workerSources[O][H];for(const de in $)$[de].availableImages=L}})}_syncRTLPluginState(O,L){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(L.pluginStatus!=="loading")return w.bD.setState(L),L;const H=L.pluginURL;if(this.self.importScripts(H),w.bD.isParsed()){const $={pluginStatus:"loaded",pluginURL:H};return w.bD.setState($),$}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${H}`)})}_getAvailableImages(O){let L=this.availableImages[O];return L||(L=[]),L}_getLayerIndex(O){let L=this.layerIndexes[O];return L||(L=this.layerIndexes[O]=new c),L}_getWorkerSource(O,L,H){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][L]||(this.workerSources[O][L]={}),!this.workerSources[O][L][H]){const $={sendAsync:(de,me)=>(de.targetMapId=O,this.actor.sendAsync(de,me))};switch(L){case"vector":this.workerSources[O][L][H]=new V($,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][L][H]=new is($,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][L][H]=new this.externalWorkerSourceTypes[L]($,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][L][H]}_getDEMWorkerSource(O,L){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][L]||(this.demWorkerSources[O][L]=new N),this.demWorkerSources[O][L]}}return w.i(self)&&(self.worker=new Rn(self)),Rn}),I("index",["exports","./shared"],function(w,c){var U="4.7.1";let q,K;const V={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:d=>new Promise((e,n)=>{const a=requestAnimationFrame(e);d.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(q||(q=document.createElement("a")),q.href=d,q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class N{static testProp(e){if(!N.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in N.docStyle)return e[n];return e[0]}static create(e,n,a){const l=window.document.createElement(e);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){N.docStyle&&N.selectProp&&(N.userSelect=N.docStyle[N.selectProp],N.docStyle[N.selectProp]="none")}static enableDrag(){N.docStyle&&N.selectProp&&(N.docStyle[N.selectProp]=N.userSelect)}static setTransform(e,n){e.style[N.transformProp]=n}static addEventListener(e,n,a,l={}){e.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(e,n,a,l={}){e.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",N.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",N.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",N.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const l=n.boundingClientRect;return new c.P((a.clientX-l.left)/n.x-e.clientLeft,(a.clientY-l.top)/n.y-e.clientTop)}static mousePos(e,n){const a=N.getScale(e);return N.getPoint(e,a,n)}static touchPos(e,n){const a=[],l=N.getScale(e);for(let h=0;h<n.length;h++)a.push(N.getPoint(e,l,n[h]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}N.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,N.selectProp=N.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),N.transformProp=N.testProp(["transform","WebkitTransform"]);const ie={supported:!1,testSupport:function(d){!ue&&oe&&(ye?pe(d):te=d)}};let te,oe,ue=!1,ye=!1;function pe(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,oe),d.isContextLost())return;ie.supported=!0}catch{}d.deleteTexture(e),ue=!0}var Ae;typeof document<"u"&&(oe=document.createElement("img"),oe.onload=()=>{te&&pe(te),te=null,ye=!0},oe.onerror=()=>{ue=!0,te=null},oe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,a,l;d.resetRequestQueue=()=>{e=[],n=0,a=0,l={}},d.addThrottleControl=S=>{const C=a++;return l[C]=S,C},d.removeThrottleControl=S=>{delete l[S],y()},d.getImage=(S,C,M=!0)=>new Promise((z,B)=>{ie.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),c.e(S,{type:"image"}),e.push({abortController:C,requestParameters:S,supportImageRefresh:M,state:"queued",onError:G=>{B(G)},onSuccess:G=>{z(G)}}),y()});const h=S=>c._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:C,supportImageRefresh:M,onError:z,onSuccess:B,abortController:G}=S,X=M===!1&&!c.i(self)&&!c.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((ae,ce)=>ae&&ce==="accept",!0));n++;const ee=X?b(C,G):c.m(C,G);try{const ae=yield ee;delete S.abortController,S.state="completed",ae.data instanceof HTMLImageElement||c.b(ae.data)?B(ae):ae.data&&B({data:yield(se=ae.data,typeof createImageBitmap=="function"?c.d(se):c.f(se)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete S.abortController,z(ae)}finally{n--,y()}var se}),y=()=>{const S=(()=>{for(const C of Object.keys(l))if(l[C]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=n;C<S&&e.length>0;C++){const M=e.shift();M.abortController.signal.aborted?C--:h(M)}},b=(S,C)=>new Promise((M,z)=>{const B=new Image,G=S.url,X=S.credentials;X&&X==="include"?B.crossOrigin="use-credentials":(X&&X==="same-origin"||!c.s(G))&&(B.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{B.src="",z(c.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,M({data:B})},B.onerror=()=>{B.onerror=B.onload=null,C.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=G})}(Ae||(Ae={})),Ae.resetRequestQueue();class ze{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Me(d){var e=new c.A(3);return e[0]=d[0],e[1]=d[1],e[2]=d[2],e}var je,Je=function(d,e,n){return d[0]=e[0]-n[0],d[1]=e[1]-n[1],d[2]=e[2]-n[2],d};je=new c.A(3),c.A!=Float32Array&&(je[0]=0,je[1]=0,je[2]=0);var _t=function(d){var e=d[0],n=d[1];return e*e+n*n};function Ge(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:a,url:l}of d){const h=`${a}${l}`;n.indexOf(h)===-1&&(n.push(h),e.push({id:a,url:l}))}}return e}function gt(d,e,n){const a=d.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var d=new c.A(2);c.A!=Float32Array&&(d[0]=0,d[1]=0)})();class at{constructor(e,n,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,a){const{width:l,height:h}=e,y=!(this.size&&this.size[0]===l&&this.size[1]===h||a),{context:b}=this,{gl:S}=b;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[l,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,l,h,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:C,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,C,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,C,M,l,h,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,n,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),a!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=h.LINEAR),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Ue(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class Fe extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,h=a&&a.height||n.data.height;return!(e[0]<0||l<e[0]||e[1]<0||h<e[1]||e[2]<0||l<e[2]||e[3]<0||h<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const h of e)this.images[h]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let l=this.getImage(a);l||(this.fire(new c.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},h=new c.I(l,a);this.patterns[e]={bin:l,position:h}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new at(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const h in this.patterns)e.push(this.patterns[h].bin);const{w:n,h:a}=c.p(e),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const h in this.patterns){const{bin:y}=this.patterns[h],b=y.x+1,S=y.y+1,C=this.getImage(h).data,M=C.width,z=C.height;c.R.copy(C,l,{x:0,y:0},{x:b,y:S},{width:M,height:z}),c.R.copy(C,l,{x:0,y:z-1},{x:b,y:S-1},{width:M,height:1}),c.R.copy(C,l,{x:0,y:0},{x:b,y:S+z},{width:M,height:1}),c.R.copy(C,l,{x:M-1,y:0},{x:b-1,y:S},{width:1,height:z}),c.R.copy(C,l,{x:0,y:0},{x:b+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),Ue(a)&&this.updateImage(n,a)}}}const Ce=1e20;function He(d,e,n,a,l,h,y,b,S){for(let C=e;C<e+a;C++)st(d,n*h+C,h,l,y,b,S);for(let C=n;C<n+l;C++)st(d,C*h+e,1,a,y,b,S)}function st(d,e,n,a,l,h,y){h[0]=0,y[0]=-Ce,y[1]=Ce,l[0]=d[e];for(let b=1,S=0,C=0;b<a;b++){l[b]=d[e+b*n];const M=b*b;do{const z=h[S];C=(l[b]-l[z]+M-z*z)/(b-z)/2}while(C<=y[S]&&--S>-1);S++,h[S]=b,y[S]=C,y[S+1]=Ce}for(let b=0,S=0;b<a;b++){for(;y[S+1]<b;)S++;const C=h[S],M=b-C;d[e+b*n]=l[C]+M*M}}class yt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const h in e)for(const y of e[h])n.push(this._getAndCacheGlyphsPromise(h,y));const a=yield Promise.all(n),l={};for(const{stack:h,id:y,glyph:b}of a)l[h]||(l[h]={}),l[h][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return l})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:e,id:n,glyph:l};if(l=this._tinySDF(a,e,n),l)return a.glyphs[n]=l,{stack:e,id:n,glyph:l};const h=Math.floor(n/256);if(256*h>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[h])return{stack:e,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[h]){const b=yt.loadGlyphRange(e,h,this.url,this.requestManager);a.requests[h]=b}const y=yield a.requests[h];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(a.glyphs[+b]=y[+b]);return a.ranges[h]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let h=e.tinySDF;if(!h){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),h=e.tinySDF=new yt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:b})}const y=h.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}yt.loadGlyphRange=function(d,e,n,a){return c._(this,void 0,void 0,function*(){const l=256*e,h=l+255,y=a.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${l}-${h}`),"Glyphs"),b=yield c.l(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${h}`);const S={};for(const C of c.n(b.data))S[C.id]=C;return S})},yt.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:h="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const b=this.size=d+4*e,S=this._createCanvas(b),C=this.ctx=S.getContext("2d",{willReadFrequently:!0});C.font=`${y} ${h} ${d}px ${l}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:h}=this.ctx.measureText(d),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-l))),S=Math.min(this.size-this.buffer,y+Math.ceil(a)),C=b+2*this.buffer,M=S+2*this.buffer,z=Math.max(C*M,0),B=new Uint8ClampedArray(z),G={data:B,width:C,height:M,glyphWidth:b,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||S===0)return G;const{ctx:X,buffer:ee,gridInner:se,gridOuter:ae}=this;X.clearRect(ee,ee,b,S),X.fillText(d,ee,ee+y);const ce=X.getImageData(ee,ee,b,S);ae.fill(Ce,0,z),se.fill(0,0,z);for(let Y=0;Y<S;Y++)for(let fe=0;fe<b;fe++){const ge=ce.data[4*(Y*b+fe)+3]/255;if(ge===0)continue;const Se=(Y+ee)*C+fe+ee;if(ge===1)ae[Se]=0,se[Se]=Ce;else{const Re=.5-ge;ae[Se]=Re>0?Re*Re:0,se[Se]=Re<0?Re*Re:0}}He(ae,0,0,C,M,C,this.f,this.v,this.z),He(se,ee,ee,b,S,C,this.f,this.v,this.z);for(let Y=0;Y<z;Y++){const fe=Math.sqrt(ae[Y])-Math.sqrt(se[Y]);B[Y]=Math.round(255-255*(fe/this.radius+this.cutoff))}return G}};class xt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let ht;class mt extends c.E{constructor(e){super(),ht=ht||new c.q({anchor:new c.D(c.v.light.anchor),position:new xt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(ht),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Rt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class jt extends c.E{constructor(e){super(),this._transitionable=new c.T(Rt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ti{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const l=[];let h=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,b=!0;l.push({left:h,right:y,isDash:b,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){b=!b;const M=e[C];h=S*a,S+=M,y=S*a,l.push({left:h,right:y,isDash:b,zeroLength:M===0})}return l}addRoundDash(e,n,a){const l=n/2;for(let h=-a;h<=a;h++){const y=this.width*(this.nextRow+a+h);let b=0,S=e[b];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++b]);const M=Math.abs(C-S.left),z=Math.abs(C-S.right),B=Math.min(M,z);let G;const X=h/a*(l+1);if(S.isDash){const ee=l-Math.abs(X);G=Math.sqrt(B*B+ee*ee)}else G=l-Math.sqrt(B*B+X*X);this.data[y+C]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const S=e[b],C=e[b+1];S.zeroLength?e.splice(b,1):C&&C.isDash===S.isDash&&(C.left=S.left,e.splice(b,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let h=0,y=e[h];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++h]);const S=Math.abs(b-y.left),C=Math.abs(b-y.right),M=Math.min(S,C);this.data[l+b]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return c.w("LineAtlas out of space"),null;let h=0;for(let b=0;b<e.length;b++)h+=e[b];if(h!==0){const b=this.width/h,S=this.getDashRanges(e,this.width,b);n?this.addRoundDash(S,b,a):this.addRegularDash(S)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:h};return this.nextRow+=l,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const fi="maplibre_preloaded_worker_pool";class bi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<bi.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fi]}numActive(){return Object.keys(this.active).length}}const Hi=Math.floor(V.hardwareConcurrency/2);let Ni,Vi;function tr(){return Ni||(Ni=new bi),Ni}bi.workerCount=c.C(globalThis)?Math.max(Math.min(Hi,3),1):1;class Fr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const h=new c.F(a[l],n);h.name=`Worker ${l}`,this.actors.push(h)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function Qi(){return Vi||(Vi=new Fr(tr(),c.G),Vi.registerMessageHandler("GR",(d,e,n)=>c.m(e,n))),Vi}function sr(d,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*d.width,.5*d.height,1]),c.L(n,n,d.calculatePosMatrix(e.toUnwrapped()))}function ar(d,e,n,a,l,h){const y=function(z,B,G){if(z)for(const X of z){const ee=B[X];if(ee&&ee.source===G&&ee.type==="fill-extrusion")return!0}else for(const X in B){const ee=B[X];if(ee.source===G&&ee.type==="fill-extrusion")return!0}return!1}(l&&l.layers,e,d.id),b=h.maxPitchScaleFactor(),S=d.tilesIn(a,b,y);S.sort(vt);const C=[];for(const z of S)C.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,d._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,l,h,b,sr(d.transform,z.tileID))});const M=function(z){const B={},G={};for(const X of z){const ee=X.queryResults,se=X.wrappedTileID,ae=G[se]=G[se]||{};for(const ce in ee){const Y=ee[ce],fe=ae[ce]=ae[ce]||{},ge=B[ce]=B[ce]||[];for(const Se of Y)fe[Se.featureIndex]||(fe[Se.featureIndex]=!0,ge.push(Se))}}return B}(C);for(const z in M)M[z].forEach(B=>{const G=B.feature,X=d.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=X});return M}function vt(d,e){const n=d.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Lt(d,e,n){return c._(this,void 0,void 0,function*(){let a=d;if(d.url?a=(yield c.h(e.transformRequest(d.url,"Source"),n)).data:yield V.frameAsync(n),!a)return null;const l=c.M(c.e(a,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(h=>h.id)),l})}class we{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let l,h;if(e instanceof c.N)l=e,h=e;else{if(!(e instanceof we))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(we.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(l=e._sw,h=e._ne,!l||!h)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(h.lng,a.lng),a.lat=Math.max(h.lat,a.lat)):(this._sw=new c.N(l.lng,l.lat),this._ne=new c.N(h.lng,h.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof we?e:e&&new we(e)}static fromLngLat(e,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new we(new c.N(e.lng-l,e.lat-a),new c.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new we(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class ji{constructor(e,n,a){this.bounds=we.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),l=Math.floor(c.Q(this.bounds.getNorth())*n),h=Math.ceil(c.O(this.bounds.getEast())*n),y=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<h&&e.y>=l&&e.y<y}}class Ir extends c.E{constructor(e,n,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ji(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((h,y)=>{e.reloadPromise={resolve:h,reject:y}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const h=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,h)}catch(h){if(delete e.abortController,e.aborted)return;if(h&&h.status!==404)throw h;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Jt extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Lt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ji(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ae.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,h=l.gl,y=a.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new at(l,y,h.RGBA,{useMipmap:!0}),e.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE,h.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class wi extends Jt{constructor(e,n,a,l){super(e,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield Ae.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const h=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const y=c.b(h)&&c.U()?h:yield this.readImageNow(h),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return V.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,h=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+a)%a,b=n.x+1===a?e.wrap+1:e.wrap,S={};return S[new c.S(e.overscaledZ,h,n.z,l,n.y).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new c.S(e.overscaledZ,h,n.z,l,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(S[new c.S(e.overscaledZ,h,n.z,l,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),S}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class kn extends c.E{constructor(e,n,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const h=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*h,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*h,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*h,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(V.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const h={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&c.e(h,{resourceTiming:l}),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},h),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Kr=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Br extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(l){let h=1/0,y=1/0,b=-1/0,S=-1/0;for(const B of l)h=Math.min(h,B.x),y=Math.min(y,B.y),b=Math.max(b,B.x),S=Math.max(S,B.y);const C=Math.max(b-h,S-y),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),z=Math.pow(2,M);return new c.a1(M,Math.floor((h+b)/2*z),Math.floor((y+S)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Kr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new at(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class qn extends Br{constructor(e,n,a,l){super(e,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Kr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new at(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const h=this.tiles[l];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ar extends Br{constructor(e,n,a,l){super(e,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(h=>!Array.isArray(h)||h.length!==2||h.some(y=>typeof y!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Kr.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new at(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const h in this.tiles){const y=this.tiles[h];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,l=!0)}l&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const es={},ws=d=>{switch(d){case"geojson":return kn;case"image":return Br;case"raster":return Jt;case"raster-dem":return wi;case"vector":return Ir;case"video":return qn;case"canvas":return Ar}return es[d]},Xe="RTLPluginLoaded";class Mn extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=V.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Xe))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Cr=null;function zn(){return Cr||(Cr=new Mn),Cr}class ts{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,h){const y={};if(!h)return y;for(const b of l){const S=b.layerIds.map(C=>h.getLayer(C)).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(C=>S.filter(M=>M.id===C)[0]));for(const C of S)y[C.id]=b}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const h=this.buckets[l];if(h instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const h=this.buckets[l];if(h instanceof c.a6&&h.hasRTLText){this.hasRTLText=!0,zn().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const h=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new at(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new at(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,l,h,y,b,S,C,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:h,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:b,queryPadding:this.queryPadding*C},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),h=n&&n.sourceLayer?n.sourceLayer:"",y=l._geojsonTileLayer||l[h];if(!y)return;const b=c.a7(n&&n.filter),{z:S,x:C,y:M}=this.tileID.canonical,z={z:S,x:C,y:M};for(let B=0;B<y.length;B++){const G=y.feature(B);if(b.needGeometry){const se=c.a8(G,!0);if(!b.filter(new c.z(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!b.filter(new c.z(this.tileID.overscaledZ),G))continue;const X=a.getId(G,h),ee=new c.a9(G,S,C,M,X);ee.tile=z,e.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const h=this.expirationTime-n;h?this.expirationTime=a+Math.max(h,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const h=this.buckets[l],y=h.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],S=e[y];if(!b||!S||Object.keys(S).length===0)continue;h.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=n&&n.style&&n.style.getLayer(l);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(h)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<V.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=V.now()+e}setDependencies(e,n){const a={};for(const l of n)a[l]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const l=this.dependencies[a];if(l){for(const h of n)if(l[h])return!0}}return!1}}class tt{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:n,timeout:void 0};if(a!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},a)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),h=this.data[a][l];return this.data[a].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(h.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class Ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},c.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const h in this.state[e])h!==l&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const h in this.state[e][l])a[h]||(this.deletedStates[e][l][h]=null)}else for(const h in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][h]===null&&delete this.deletedStates[e][l][h]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),l=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const h=this.deletedStates[e][n];if(h===null)return{};for(const y in h)delete l[y]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const h={};for(const y in this.stateChanges[l])this.state[l][y]||(this.state[l][y]={}),c.e(this.state[l][y],this.stateChanges[l][y]),h[y]=this.state[l][y];a[l]=h}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const h={};if(this.deletedStates[l]===null)for(const y in this.state[l])h[y]={},this.state[l][y]={};else for(const y in this.deletedStates[l]){if(this.deletedStates[l][y]===null)this.state[l][y]={};else for(const b of Object.keys(this.deletedStates[l][y]))delete this.state[l][y][b];h[y]=this.state[l][y]}a[l]=a[l]||{},c.e(a[l],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,n)}}class Ot extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,h,y,b)=>{const S=new(ws(h.type))(l,h,y,b);if(S.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${S.id}`);return S})(e,n,a,this),this._tiles={},this._cache=new tt(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ht,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new c.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Nr).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,l)=>{const h=a.tileID,y=l.tileID,b=new c.P(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),S=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-y.overscaledZ||S.y-b.y||S.x-b.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(Nr).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=V.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const h=n[l];if(e.neighboringTiles&&e.neighboringTiles[h]){const y=this.getTileByID(h);a(e,y),a(y,e)}}function a(l,h){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let y=h.tileID.canonical.x-l.tileID.canonical.x;const b=h.tileID.canonical.y-l.tileID.canonical.y,S=Math.pow(2,l.tileID.canonical.z),C=h.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),h.dem&&l.dem&&(l.dem.backfillBorder(h.dem,y,b),l.neighboringTiles&&l.neighboringTiles[C]&&(l.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,l){for(const h in this._tiles){let y=this._tiles[h];if(l[h]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>a)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const C=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[C.key],y&&y.hasData()&&(b=C)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){l[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const l=e.scaledTo(a),h=this._getLoadedTile(l);if(h)return h}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),h=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(h)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+n),a[h.tileID.key]=h}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,n,a,l,h,y){const b={},S={},C=Object.keys(e),M=V.now();for(const z of C){const B=e[z],G=this._tiles[z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=M)continue;const X=this.findLoadedParent(B,n),ee=this.findLoadedSibling(B),se=X||ee||null;se&&(this._addTile(se.tileID),b[se.tileID.key]=se.tileID),S[z]=B}this._retainLoadedChildren(S,l,a,e);for(const z in b)e[z]||(this._coveredTiles[z]=!0,e[z]=b[z]);if(y){const z={},B={};for(const G of h)this._tiles[G.key].hasData()?z[G.key]=G:B[G.key]=G;for(const G in B){const X=B[G].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(z[X[0].key]=e[X[0].key]=X[0],z[X[1].key]=e[X[1].key]=X[1],z[X[2].key]=e[X[2].key]=X[2],z[X[3].key]=e[X[3].key]=X[3],delete B[G])}for(const G in B){const X=B[G],ee=this.findLoadedParent(X,this._source.minzoom),se=this.findLoadedSibling(X),ae=ee||se||null;if(ae){z[ae.tileID.key]=e[ae.tileID.key]=ae.tileID;for(const ce in z)z[ce].isChildOf(ae.tileID)&&delete z[ce]}}for(const G in this._tiles)z[G]||(this._coveredTiles[G]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const l=e.coveringZoomLevel(this._source),h=Math.max(l-Ot.maxOverzooming,this._source.minzoom),y=Math.max(l+Ot.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);M[B.key]=B;const G=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[G.key]=G}a=a.concat(Object.values(M))}const b=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,l);fn(this._source.type)&&this._updateCoveredAndRetainedTiles(S,h,y,l,a,n);for(const M in S)this._tiles[M].clearFadeHold();const C=c.ab(this._tiles,S);for(const M of C){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const l={},h={},y=Math.max(n-Ot.maxOverzooming,this._source.minzoom),b=Math.max(n+Ot.maxUnderzooming,this._source.minzoom),S={};for(const C of e){const M=this._addTile(C);l[C.key]=C,M.hasData()||n<this._source.maxzoom&&(S[C.key]=C)}this._retainLoadedChildren(S,n,b,l);for(const C of e){let M=this._tiles[C.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){const B=C.children(this._source.maxzoom)[0],G=this.getTile(B);if(G&&G.hasData()){l[B.key]=B;continue}}else{const B=C.children(this._source.maxzoom);if(l[B[0].key]&&l[B[1].key]&&l[B[2].key]&&l[B[3].key])continue}let z=M.wasRequested();for(let B=C.overscaledZ-1;B>=y;--B){const G=C.scaledTo(B);if(h[G.key])break;if(h[G.key]=!0,M=this.getTile(G),!M&&z&&(M=this._addTile(G)),M){const X=M.hasData();if((X||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(l[G.key]=G),z=M.wasRequested(),X)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const h=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(h),a)break;l=h}for(const h of n)this._loadedParentTiles[h]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new ts(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const l=[],h=this.transform;if(!h)return l;const y=a?h.getCameraQueryGeometry(e):e,b=e.map(X=>h.pointCoordinate(X,this.terrain)),S=y.map(X=>h.pointCoordinate(X,this.terrain)),C=this.getIds();let M=1/0,z=1/0,B=-1/0,G=-1/0;for(const X of S)M=Math.min(M,X.x),z=Math.min(z,X.y),B=Math.max(B,X.x),G=Math.max(G,X.y);for(let X=0;X<C.length;X++){const ee=this._tiles[C[X]];if(ee.holdingForFade())continue;const se=ee.tileID,ae=Math.pow(2,h.zoom-ee.tileID.overscaledZ),ce=n*ee.queryPadding*c.X/ee.tileSize/ae,Y=[se.getTilePoint(new c.Z(M,z)),se.getTilePoint(new c.Z(B,G))];if(Y[0].x-ce<c.X&&Y[0].y-ce<c.X&&Y[1].x+ce>=0&&Y[1].y+ce>=0){const fe=b.map(Se=>se.getTilePoint(Se)),ge=S.map(Se=>se.getTilePoint(Se));l.push({tile:ee,tileID:se,queryGeometry:fe,cameraQueryGeometry:ge,scale:ae})}}return l}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(fn(this._source.type)){const e=V.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const l=this._tiles[e];l&&l.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function Nr(d,e){const n=Math.abs(2*d.wrap)-+(d.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||a-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function fn(d){return d==="raster"||d==="image"||d==="video"}Ot.maxOverzooming=10,Ot.maxUnderzooming=3;class Ut{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const l=e*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const h=n-1,y=this._distances[h],b=a-y,S=b>0?(l-y)/b:0;return this.points[h].mult(1-S).add(this.points[n].mult(S))}}function Dn(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class Zn{constructor(e,n,a){const l=this.boxCells=[],h=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)l.push([]),h.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,l,h){this._forEachCell(n,a,l,h,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h)}insertCircle(e,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,n,a,l,h,y){this.boxCells[h].push(y)}_insertCircleCell(e,n,a,l,h,y){this.circleCells[h].push(y)}_query(e,n,a,l,h,y,b){if(a<0||e>this.width||l<0||n>this.height)return[];const S=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=l){if(h)return[{key:null,x1:e,y1:n,x2:a,y2:l}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const M=this.circles[3*C],z=this.circles[3*C+1],B=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:M-B,y1:z-B,x2:M+B,y2:z+B})}}else this._forEachCell(e,n,a,l,this._queryCell,S,{hitTest:h,overlapMode:y,seenUids:{box:{},circle:{}}},b);return S}query(e,n,a,l){return this._query(e,n,a,l,!1,null)}hitTest(e,n,a,l,h,y){return this._query(e,n,a,l,!0,h,y).length>0}hitTestCircle(e,n,a,l,h){const y=e-a,b=e+a,S=n-a,C=n+a;if(b<0||y>this.width||C<0||S>this.height)return!1;const M=[];return this._forEachCell(y,S,b,C,this._queryCellCircle,M,{hitTest:!0,overlapMode:l,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},h),M.length>0}_queryCell(e,n,a,l,h,y,b,S){const{seenUids:C,hitTest:M,overlapMode:z}=b,B=this.boxCells[h];if(B!==null){const X=this.bboxes;for(const ee of B)if(!C.box[ee]){C.box[ee]=!0;const se=4*ee,ae=this.boxKeys[ee];if(e<=X[se+2]&&n<=X[se+3]&&a>=X[se+0]&&l>=X[se+1]&&(!S||S(ae))&&(!M||!Dn(z,ae.overlapMode))&&(y.push({key:ae,x1:X[se],y1:X[se+1],x2:X[se+2],y2:X[se+3]}),M))return!0}}const G=this.circleCells[h];if(G!==null){const X=this.circles;for(const ee of G)if(!C.circle[ee]){C.circle[ee]=!0;const se=3*ee,ae=this.circleKeys[ee];if(this._circleAndRectCollide(X[se],X[se+1],X[se+2],e,n,a,l)&&(!S||S(ae))&&(!M||!Dn(z,ae.overlapMode))){const ce=X[se],Y=X[se+1],fe=X[se+2];if(y.push({key:ae,x1:ce-fe,y1:Y-fe,x2:ce+fe,y2:Y+fe}),M)return!0}}}return!1}_queryCellCircle(e,n,a,l,h,y,b,S){const{circle:C,seenUids:M,overlapMode:z}=b,B=this.boxCells[h];if(B!==null){const X=this.bboxes;for(const ee of B)if(!M.box[ee]){M.box[ee]=!0;const se=4*ee,ae=this.boxKeys[ee];if(this._circleAndRectCollide(C.x,C.y,C.radius,X[se+0],X[se+1],X[se+2],X[se+3])&&(!S||S(ae))&&!Dn(z,ae.overlapMode))return y.push(!0),!0}}const G=this.circleCells[h];if(G!==null){const X=this.circles;for(const ee of G)if(!M.circle[ee]){M.circle[ee]=!0;const se=3*ee,ae=this.circleKeys[ee];if(this._circlesCollide(X[se],X[se+1],X[se+2],C.x,C.y,C.radius)&&(!S||S(ae))&&!Dn(z,ae.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,a,l,h,y,b,S){const C=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),B=this._convertToYCellCoord(l);for(let G=C;G<=z;G++)for(let X=M;X<=B;X++)if(h.call(this,e,n,a,l,this.xCellCount*X+G,y,b,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,l,h,y){const b=l-e,S=h-n,C=a+y;return C*C>b*b+S*S}_circleAndRectCollide(e,n,a,l,h,y,b){const S=(y-l)/2,C=Math.abs(e-(l+S));if(C>S+a)return!1;const M=(b-h)/2,z=Math.abs(n-(h+M));if(z>M+a)return!1;if(C<=S||z<=M)return!0;const B=C-S,G=z-M;return B*B+G*G<=a*a}}function is(d,e,n,a,l){const h=c.H();return e?(c.K(h,h,[1/l,1/l,1]),n||c.ad(h,h,a.angle)):c.L(h,a.labelPlaneMatrix,d),h}function Rn(d,e,n,a,l){if(e){const h=c.ae(d);return c.K(h,h,[l,l,1]),n||c.ad(h,h,-a.angle),h}return a.glCoordMatrix}function re(d,e,n,a){let l;a?(l=[d,e,a(d,e),1],c.af(l,l,n)):(l=[d,e,0,1],ni(l,l,n));const h=l[3];return{point:new c.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function O(d,e){return .5+d/e*.5}function L(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function H(d,e,n,a,l,h,y,b,S,C,M,z,B,G,X){const ee=a?d.textSizeData:d.iconSizeData,se=c.ag(ee,n.transform.zoom),ae=[256/n.width*2+1,256/n.height*2+1],ce=a?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;ce.clear();const Y=d.lineVertexArray,fe=a?d.text.placedSymbolArray:d.icon.placedSymbolArray,ge=n.transform.width/n.transform.height;let Se=!1;for(let Re=0;Re<fe.length;Re++){const We=fe.get(Re);if(We.hidden||We.writingMode===c.ah.vertical&&!Se){Mt(We.numGlyphs,ce);continue}Se=!1;const nt=re(We.anchorX,We.anchorY,e,X);if(!L(nt.point,ae)){Mt(We.numGlyphs,ce);continue}const ut=O(n.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),et=c.ai(ee,se,We),$e=y?et/ut:et*ut,wt={getElevation:X,labelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new c.P(We.anchorX,We.anchorY),unwrappedTileID:M,width:z,height:B,translation:G},Nt=me(wt,We,$e,!1,b,e,h,d.glyphOffsetArray,ce,ge,S);Se=Nt.useVertical,(Nt.notEnoughRoom||Se||Nt.needsFlipping&&me(wt,We,$e,!0,b,e,h,d.glyphOffsetArray,ce,ge,S).notEnoughRoom)&&Mt(We.numGlyphs,ce)}a?d.text.dynamicLayoutVertexBuffer.updateData(ce):d.icon.dynamicLayoutVertexBuffer.updateData(ce)}function $(d,e,n,a,l,h,y,b){const S=h.glyphStartIndex+h.numGlyphs,C=h.lineStartIndex,M=h.lineStartIndex+h.lineLength,z=e.getoffsetX(h.glyphStartIndex),B=e.getoffsetX(S-1),G=Qe(d*z,n,a,l,h.segment,C,M,b,y);if(!G)return null;const X=Qe(d*B,n,a,l,h.segment,C,M,b,y);return X?b.projectionCache.anyProjectionOccluded?null:{first:G,last:X}:null}function de(d,e,n,a){return d===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(d===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function me(d,e,n,a,l,h,y,b,S,C,M){const z=n/24,B=e.lineOffsetX*z,G=e.lineOffsetY*z;let X;if(e.numGlyphs>1){const ee=e.glyphStartIndex+e.numGlyphs,se=e.lineStartIndex,ae=e.lineStartIndex+e.lineLength,ce=$(z,b,B,G,a,e,M,d);if(!ce)return{notEnoughRoom:!0};const Y=re(ce.first.point.x,ce.first.point.y,y,d.getElevation).point,fe=re(ce.last.point.x,ce.last.point.y,y,d.getElevation).point;if(l&&!a){const ge=de(e.writingMode,Y,fe,C);if(ge)return ge}X=[ce.first];for(let ge=e.glyphStartIndex+1;ge<ee-1;ge++)X.push(Qe(z*b.getoffsetX(ge),B,G,a,e.segment,se,ae,d,M));X.push(ce.last)}else{if(l&&!a){const se=re(d.tileAnchorPoint.x,d.tileAnchorPoint.y,h,d.getElevation).point,ae=e.lineStartIndex+e.segment+1,ce=new c.P(d.lineVertexArray.getx(ae),d.lineVertexArray.gety(ae)),Y=re(ce.x,ce.y,h,d.getElevation),fe=Y.signedDistanceFromCamera>0?Y.point:function(Se,Re,We,nt,ut,et){return ve(Se,Re,We,1,ut,et)}(d.tileAnchorPoint,ce,se,0,h,d),ge=de(e.writingMode,se,fe,C);if(ge)return ge}const ee=Qe(z*b.getoffsetX(e.glyphStartIndex),B,G,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,d,M);if(!ee||d.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[ee]}for(const ee of X)c.aj(S,ee.point,ee.angle);return{}}function ve(d,e,n,a,l,h){const y=d.add(d.sub(e)._unit()),b=l!==void 0?re(y.x,y.y,l,h.getElevation).point:ke(y.x,y.y,h).point,S=n.sub(b);return n.add(S._mult(a/S.mag()))}function le(d,e,n){const a=e.projectionCache;if(a.projections[d])return a.projections[d];const l=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),h=ke(l.x,l.y,e);if(h.signedDistanceFromCamera>0)return a.projections[d]=h.point,a.anyProjectionOccluded=a.anyProjectionOccluded||h.isOccluded,h.point;const y=d-n.direction;return function(b,S,C,M,z){return ve(b,S,C,M,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),l,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function ke(d,e,n){const a=d+n.translation[0],l=e+n.translation[1];let h;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(h=n.projection.projectTileCoordinates(a,l,n.unwrappedTileID,n.getElevation),h.point.x=(.5*h.point.x+.5)*n.width,h.point.y=(.5*-h.point.y+.5)*n.height):(h=re(a,l,n.labelPlaneMatrix,n.getElevation),h.isOccluded=!1),h}function Be(d,e,n){return d._unit()._perp()._mult(e*n)}function Ie(d,e,n,a,l,h,y,b,S){if(b.projectionCache.offsets[d])return b.projectionCache.offsets[d];const C=n.add(e);if(d+S.direction<a||d+S.direction>=l)return b.projectionCache.offsets[d]=C,C;const M=le(d+S.direction,b,S),z=Be(M.sub(n),y,S.direction),B=n.add(z),G=M.add(z);return b.projectionCache.offsets[d]=c.ak(h,C,B,G)||C,b.projectionCache.offsets[d]}function Qe(d,e,n,a,l,h,y,b,S){const C=a?d-e:d+e;let M=C>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let B,G=M>0?h+l:h+l+1;b.projectionCache.cachedAnchorPoint?B=b.projectionCache.cachedAnchorPoint:(B=ke(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=B);let X,ee,se=B,ae=B,ce=0,Y=0;const fe=Math.abs(C),ge=[];let Se;for(;ce+Y<=fe;){if(G+=M,G<h||G>=y)return null;ce+=Y,ae=se,ee=X;const nt={absOffsetX:fe,direction:M,distanceFromAnchor:ce,previousVertex:ae};if(se=le(G,b,nt),n===0)ge.push(ae),Se=se.sub(ae);else{let ut;const et=se.sub(ae);ut=et.mag()===0?Be(le(G+M,b,nt).sub(se),n,M):Be(et,n,M),ee||(ee=ae.add(ut)),X=Ie(G,ut,se,h,y,ee,n,b,nt),ge.push(ee),Se=X.sub(ee)}Y=Se.mag()}const Re=Se._mult((fe-ce)/Y)._add(ee||ae),We=z+Math.atan2(se.y-ae.y,se.x-ae.x);return ge.push(Re),{point:Re,angle:S?We:0,path:ge}}const It=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Mt(d,e){for(let n=0;n<d;n++){const a=e.length;e.resize(a+4),e.float32.set(It,3*a)}}function ni(d,e,n){const a=e[0],l=e[1];return d[0]=n[0]*a+n[4]*l+n[12],d[1]=n[1]*a+n[5]*l+n[13],d[3]=n[3]*a+n[7]*l+n[15],d}const qt=100;class si{constructor(e,n,a=new Zn(e.width+200,e.height+200,25),l=new Zn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+qt,this.screenBottomBoundary=e.height+qt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,l,h,y,b,S,C,M,z){const B=e.anchorPointX+S[0],G=e.anchorPointY+S[1],X=this.projectAndGetPerspectiveRatio(l,B,G,h,M),ee=a*X.perspectiveRatio;let se;if(y||b)se=this._projectCollisionBox(e,ee,l,h,y,b,S,X,M,z);else{const ge=X.point.x+(z?z.x*ee:0),Se=X.point.y+(z?z.y*ee:0);se={allPointsOccluded:!1,box:[ge+e.x1*ee,Se+e.y1*ee,ge+e.x2*ee,Se+e.y2*ee]}}const[ae,ce,Y,fe]=se.box;return this.mapProjection.useSpecialProjectionForSymbols&&(y?se.allPointsOccluded:this.mapProjection.isOccluded(B,G,h))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ae,ce,Y,fe)||n!=="always"&&this.grid.hitTest(ae,ce,Y,fe,n,C)?{box:[ae,ce,Y,fe],placeable:!1,offscreen:!1}:{box:[ae,ce,Y,fe],placeable:!0,offscreen:this.isOffscreen(ae,ce,Y,fe)}}placeCollisionCircles(e,n,a,l,h,y,b,S,C,M,z,B,G,X,ee,se){const ae=[],ce=new c.P(n.anchorX,n.anchorY),Y=this.getPerspectiveRatio(y,ce.x,ce.y,b,se),fe=(z?h/Y:h*Y)/c.ap,ge={getElevation:se,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:ee},Se=$(fe,l,n.lineOffsetX*fe,n.lineOffsetY*fe,!1,n,!1,ge);let Re=!1,We=!1,nt=!0;if(Se){const ut=.5*G*Y+X,et=new c.P(-100,-100),$e=new c.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new Ut,Nt=Se.first,it=Se.last;let lt=[];for(let Zt=Nt.path.length-1;Zt>=1;Zt--)lt.push(Nt.path[Zt]);for(let Zt=1;Zt<it.path.length;Zt++)lt.push(it.path[Zt]);const Ft=2.5*ut;if(C){const Zt=this.projectPathToScreenSpace(lt,ge,C);lt=Zt.some($t=>$t.signedDistanceFromCamera<=0)?[]:Zt.map($t=>$t.point)}let ki=[];if(lt.length>0){const Zt=lt[0].clone(),$t=lt[0].clone();for(let Mi=1;Mi<lt.length;Mi++)Zt.x=Math.min(Zt.x,lt[Mi].x),Zt.y=Math.min(Zt.y,lt[Mi].y),$t.x=Math.max($t.x,lt[Mi].x),$t.y=Math.max($t.y,lt[Mi].y);ki=Zt.x>=et.x&&$t.x<=$e.x&&Zt.y>=et.y&&$t.y<=$e.y?[lt]:$t.x<et.x||Zt.x>$e.x||$t.y<et.y||Zt.y>$e.y?[]:c.al([lt],et.x,et.y,$e.x,$e.y)}for(const Zt of ki){wt.reset(Zt,.25*ut);let $t=0;$t=wt.length<=.5*ut?1:Math.ceil(wt.paddedLength/Ft)+1;for(let Mi=0;Mi<$t;Mi++){const yr=Mi/Math.max($t-1,1),xn=wt.lerp(yr),zi=xn.x+qt,Ur=xn.y+qt;ae.push(zi,Ur,ut,0);const kr=zi-ut,vr=Ur-ut,Mr=zi+ut,Bn=Ur+ut;if(nt=nt&&this.isOffscreen(kr,vr,Mr,Bn),We=We||this.isInsideGrid(kr,vr,Mr,Bn),e!=="always"&&this.grid.hitTestCircle(zi,Ur,ut,e,B)&&(Re=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!M&&Re||!We||Y<this.perspectiveRatioCutoff?[]:ae,offscreen:nt,collisionDetected:Re}}projectPathToScreenSpace(e,n,a){return e.map(l=>re(l.x,l.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,h=-1/0,y=-1/0;for(const M of e){const z=new c.P(M.x+qt,M.y+qt);a=Math.min(a,z.x),l=Math.min(l,z.y),h=Math.max(h,z.x),y=Math.max(y,z.y),n.push(z)}const b=this.grid.query(a,l,h,y).concat(this.ignoredGrid.query(a,l,h,y)),S={},C={};for(const M of b){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const B=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(n,B)&&(S[z.bucketInstanceId][z.featureIndex]=!0,C[z.bucketInstanceId]===void 0&&(C[z.bucketInstanceId]=[]),C[z.bucketInstanceId].push(z.featureIndex))}return C}insertCollisionBox(e,n,a,l,h,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,l,h,y){const b=a?this.ignoredGrid:this.grid,S={bucketInstanceId:l,featureIndex:h,collisionGroupID:y,overlapMode:n};for(let C=0;C<e.length;C+=4)b.insertCircle(S,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,n,a,l,h){let y;h?(y=[n,a,h(n,a),1],c.af(y,y,e)):(y=[n,a,0,1],ni(y,y,e));const b=y[3];return{point:new c.P((y[0]/b+1)/2*this.transform.width+qt,(-y[1]/b+1)/2*this.transform.height+qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}getPerspectiveRatio(e,n,a,l,h){const y=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,h):re(n,a,e,h);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,n,a,l){return a<qt||e>=this.screenRightBoundary||l<qt||n>this.screenBottomBoundary}isInsideGrid(e,n,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,l,h,y,b,S,C,M){let z=new c.P(1,0),B=new c.P(0,1);const G=new c.P(e.anchorPointX+b[0],e.anchorPointY+b[1]);if(y&&!h){const nt=this.projectAndGetPerspectiveRatio(a,G.x+1,G.y,l,C).point.sub(S.point).unit(),ut=Math.atan(nt.y/nt.x)+(nt.x<0?Math.PI:0),et=Math.sin(ut),$e=Math.cos(ut);z=new c.P($e,et),B=new c.P(-et,$e)}else if(!y&&h){const nt=-this.transform.angle,ut=Math.sin(nt),et=Math.cos(nt);z=new c.P(et,ut),B=new c.P(-ut,et)}let X=S.point,ee=n;if(h){X=G;const nt=this.transform.zoom-Math.floor(this.transform.zoom);ee=Math.pow(2,-nt),ee*=this.mapProjection.getPitchedTextCorrection(this.transform,G,l),M||(ee*=c.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(X=X.add(z.mult(M.x*ee)).add(B.mult(M.y*ee)));const se=e.x1*ee,ae=e.x2*ee,ce=(se+ae)/2,Y=e.y1*ee,fe=e.y2*ee,ge=(Y+fe)/2,Se=[{offsetX:se,offsetY:Y},{offsetX:ce,offsetY:Y},{offsetX:ae,offsetY:Y},{offsetX:ae,offsetY:ge},{offsetX:ae,offsetY:fe},{offsetX:ce,offsetY:fe},{offsetX:se,offsetY:fe},{offsetX:se,offsetY:ge}];let Re=[];for(const{offsetX:nt,offsetY:ut}of Se)Re.push(new c.P(X.x+z.x*nt+B.x*ut,X.y+z.y*nt+B.y*ut));let We=!1;if(h){const nt=Re.map(ut=>this.projectAndGetPerspectiveRatio(a,ut.x,ut.y,l,C));We=nt.some(ut=>!ut.isOccluded),Re=nt.map(ut=>ut.point)}else We=!0;return{box:c.ao(Re),allPointsOccluded:!We}}}function Qt(d,e,n){return e*(c.X/(d.tileSize*Math.pow(2,n-d.tileID.overscaledZ)))}class ir{constructor(e,n,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Ui{constructor(e,n,a,l,h){this.text=new ir(e?e.text:null,n,a,h),this.icon=new ir(e?e.icon:null,n,l,h)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wt{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class mi{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class Li{constructor(e,n,a,l,h){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=h}}class lr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function dr(d,e,n,a,l){const{horizontalAlign:h,verticalAlign:y}=c.au(d);return new c.P(-(h-.5)*e+a[0]*l,-(y-.5)*n+a[1]*l)}class Er{constructor(e,n,a,l,h,y){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new si(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new lr(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,l)=>n.getElevation(e,a,l):null}getBucketParts(e,n,a,l){const h=a.getBucket(n),y=a.latestFeatureIndex;if(!h||!y||n.id!==h.layerIds[0])return;const b=a.collisionBoxArray,S=h.layers[0].layout,C=h.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,B=a.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(B),X=S.get("text-pitch-alignment")==="map",ee=S.get("text-rotation-alignment")==="map",se=Qt(a,1,this.transform.zoom),ae=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("text-translate"),C.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,a,C.get("icon-translate"),C.get("icon-translate-anchor")),Y=is(G,X,ee,this.transform,se);let fe=null;if(X){const Se=Rn(G,X,ee,this.transform,se);fe=c.L([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[h.bucketInstanceId]=new Li(h.bucketInstanceId,y,h.sourceLayerIndex,h.index,a.tileID);const ge={bucket:h,layout:S,translationText:ae,translationIcon:ce,posMatrix:G,unwrappedTileID:B,textLabelPlaneMatrix:Y,labelToScreenMatrix:fe,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.ag(h.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(h.sourceID)};if(l)for(const Se of h.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:We,symbolInstanceEnd:nt}=Se;e.push({sortKey:Re,symbolInstanceStart:We,symbolInstanceEnd:nt,parameters:ge})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:h.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(e,n,a,l,h,y,b,S,C,M,z,B,G,X,ee,se,ae,ce,Y){const fe=c.aq[e.textAnchor],ge=[e.textOffset0,e.textOffset1],Se=dr(fe,a,l,ge,h),Re=this.collisionIndex.placeCollisionBox(n,B,S,C,M,b,y,se,z.predicate,Y,Se);if((!ce||this.collisionIndex.placeCollisionBox(ce,B,S,C,M,b,y,ae,z.predicate,Y,Se).placeable)&&Re.placeable){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(We=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ge,width:a,height:l,anchor:fe,textBoxScale:h,prevAnchor:We},this.markUsedJustification(X,fe,G,ee),X.allowVerticalPlacement&&(this.markUsedOrientation(X,ee,G),this.placedOrientations[G.crossTileID]=ee),{shift:Se,placedGlyphBoxes:Re}}}placeLayerBucketPart(e,n,a){const{bucket:l,layout:h,translationText:y,translationIcon:b,posMatrix:S,unwrappedTileID:C,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:B,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:ee,collisionGroup:se}=e.parameters,ae=h.get("text-optional"),ce=h.get("icon-optional"),Y=c.ar(h,"text-overlap","text-allow-overlap"),fe=Y==="always",ge=c.ar(h,"icon-overlap","icon-allow-overlap"),Se=ge==="always",Re=h.get("text-rotation-alignment")==="map",We=h.get("text-pitch-alignment")==="map",nt=h.get("icon-text-fit")!=="none",ut=h.get("symbol-z-order")==="viewport-y",et=fe&&(Se||!l.hasIconData()||ce),$e=Se&&(fe||!l.hasTextData()||ae);!l.collisionArrays&&X&&l.deserializeCollisionBoxes(X);const wt=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),Nt=(it,lt,Ft)=>{var ki,Zt;if(n[it.crossTileID])return;if(G)return void(this.placements[it.crossTileID]=new Wt(!1,!1,!1));let $t=!1,Mi=!1,yr=!0,xn=null,zi={box:null,placeable:!1,offscreen:null},Ur={box:null,placeable:!1,offscreen:null},kr=null,vr=null,Mr=null,Bn=0,So=0,xl=0;lt.textFeatureIndex?Bn=lt.textFeatureIndex:it.useRuntimeCollisionCircles&&(Bn=it.featureIndex),lt.verticalTextFeatureIndex&&(So=lt.verticalTextFeatureIndex);const Po=lt.textBox;if(Po){const un=pr=>{let xr=c.ah.horizontal;if(l.allowVerticalPlacement&&!pr&&this.prevPlacement){const tn=this.prevPlacement.placedOrientations[it.crossTileID];tn&&(this.placedOrientations[it.crossTileID]=tn,xr=tn,this.markUsedOrientation(l,xr,it))}return xr},hn=(pr,xr)=>{if(l.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const tn of l.writingModes)if(tn===c.ah.vertical?(zi=xr(),Ur=zi):zi=pr(),zi&&zi.placeable)break}else zi=pr()},ss=it.textAnchorOffsetStartIndex,bn=it.textAnchorOffsetEndIndex;if(bn===ss){const pr=(xr,tn)=>{const ii=this.collisionIndex.placeCollisionBox(xr,Y,B,S,C,We,Re,y,se.predicate,wt);return ii&&ii.placeable&&(this.markUsedOrientation(l,tn,it),this.placedOrientations[it.crossTileID]=tn),ii};hn(()=>pr(Po,c.ah.horizontal),()=>{const xr=lt.verticalTextBox;return l.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&xr?pr(xr,c.ah.vertical):{box:null,offscreen:null}}),un(zi&&zi.placeable)}else{let pr=c.aq[(Zt=(ki=this.prevPlacement)===null||ki===void 0?void 0:ki.variableOffsets[it.crossTileID])===null||Zt===void 0?void 0:Zt.anchor];const xr=(ii,Ls,To)=>{const Io=ii.x2-ii.x1,Pf=ii.y2-ii.y1,O_=it.textBoxScale,Tf=nt&&ge==="never"?Ls:null;let os=null,If=Y==="never"?1:2,wl="never";pr&&If++;for(let ya=0;ya<If;ya++){for(let Sl=ss;Sl<bn;Sl++){const Pl=l.textAnchorOffsets.get(Sl);if(pr&&Pl.textAnchor!==pr)continue;const Ao=this.attemptAnchorPlacement(Pl,ii,Io,Pf,O_,Re,We,B,S,C,se,wl,it,l,To,y,b,Tf,wt);if(Ao&&(os=Ao.placedGlyphBoxes,os&&os.placeable))return $t=!0,xn=Ao.shift,os}pr?pr=null:wl=Y}return a&&!os&&(os={box:this.collisionIndex.placeCollisionBox(Po,"always",B,S,C,We,Re,y,se.predicate,wt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),os};hn(()=>xr(Po,lt.iconBox,c.ah.horizontal),()=>{const ii=lt.verticalTextBox;return l.allowVerticalPlacement&&(!zi||!zi.placeable)&&it.numVerticalGlyphVertices>0&&ii?xr(ii,lt.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),zi&&($t=zi.placeable,yr=zi.offscreen);const tn=un(zi&&zi.placeable);if(!$t&&this.prevPlacement){const ii=this.prevPlacement.variableOffsets[it.crossTileID];ii&&(this.variableOffsets[it.crossTileID]=ii,this.markUsedJustification(l,ii.anchor,it,tn))}}}if(kr=zi,$t=kr&&kr.placeable,yr=kr&&kr.offscreen,it.useRuntimeCollisionCircles){const un=l.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),hn=c.ai(l.textSizeData,ee,un),ss=h.get("text-padding");vr=this.collisionIndex.placeCollisionCircles(Y,un,l.lineVertexArray,l.glyphOffsetArray,hn,S,C,M,z,a,We,se.predicate,it.collisionCircleDiameter,ss,y,wt),vr.circles.length&&vr.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),$t=fe||vr.circles.length>0&&!vr.collisionDetected,yr=yr&&vr.offscreen}if(lt.iconFeatureIndex&&(xl=lt.iconFeatureIndex),lt.iconBox){const un=hn=>this.collisionIndex.placeCollisionBox(hn,ge,B,S,C,We,Re,b,se.predicate,wt,nt&&xn?xn:void 0);Ur&&Ur.placeable&&lt.verticalIconBox?(Mr=un(lt.verticalIconBox),Mi=Mr.placeable):(Mr=un(lt.iconBox),Mi=Mr.placeable),yr=yr&&Mr.offscreen}const cn=ae||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,bl=ce||it.numIconVertices===0;cn||bl?bl?cn||(Mi=Mi&&$t):$t=Mi&&$t:Mi=$t=Mi&&$t;const Ru=Mi&&Mr.placeable;if($t&&kr.placeable&&this.collisionIndex.insertCollisionBox(kr.box,Y,h.get("text-ignore-placement"),l.bucketInstanceId,Ur&&Ur.placeable&&So?So:Bn,se.ID),Ru&&this.collisionIndex.insertCollisionBox(Mr.box,ge,h.get("icon-ignore-placement"),l.bucketInstanceId,xl,se.ID),vr&&$t&&this.collisionIndex.insertCollisionCircles(vr.circles,Y,h.get("text-ignore-placement"),l.bucketInstanceId,Bn,se.ID),a&&this.storeCollisionData(l.bucketInstanceId,Ft,lt,kr,Mr,vr),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new Wt($t||et,Mi||$e,yr||l.justReloaded),n[it.crossTileID]=!0};if(ut){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=l.getSortedSymbolIndexes(this.transform.angle);for(let lt=it.length-1;lt>=0;--lt){const Ft=it[lt];Nt(l.symbolInstances.get(Ft),l.collisionArrays[Ft],Ft)}}else for(let it=e.symbolInstanceStart;it<e.symbolInstanceEnd;it++)Nt(l.symbolInstances.get(it),l.collisionArrays[it],it);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[l.bucketInstanceId];c.as(it.invProjMatrix,S),it.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(e,n,a,l,h,y){if(a.textBox||a.iconBox){let b,S;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(n)?S=b.get(n):(S={text:null,icon:null},b.set(n,S)),a.textBox&&(S.text=l.box),a.iconBox&&(S.icon=h.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=new mi);for(let S=0;S<y.circles.length;S+=4)b.circles.push(y.circles[S+0]),b.circles.push(y.circles[S+1]),b.circles.push(y.circles[S+2]),b.circles.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,a,l){let h;h=l===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=h>=0&&b!==h?0:a.crossTileID)}markUsedOrientation(e,n,a){const l=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,h=n===c.ah.vertical?n:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=h)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(e):1,h=n?n.opacities:{},y=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],M=h[S];M?(this.opacities[S]=new Ui(M,l,C.text,C.icon),a=a||C.text!==M.text.placed||C.icon!==M.icon.placed):(this.opacities[S]=new Ui(null,l,C.text,C.icon,C.skipFade),a=a||C.text||C.icon)}for(const S in h){const C=h[S];if(!this.opacities[S]){const M=new Ui(C,l,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||C.text.placed||C.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const l of n){const h=l.getBucket(e);h&&l.latestFeatureIndex&&e.id===h.layerIds[0]&&this.updateBucketOpacities(h,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,n,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const h=e.layers[0],y=h.layout,b=new Ui(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),C=y.get("icon-allow-overlap"),M=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",G=y.get("icon-text-fit")!=="none",X=new Ui(null,0,S&&(C||!e.hasIconData()||y.get("icon-optional")),C&&(S||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const ee=(ae,ce,Y)=>{for(let fe=0;fe<ce/4;fe++)ae.opacityVertexArray.emplaceBack(Y);ae.hasVisibleVertices=ae.hasVisibleVertices||Y!==to},se=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ae=0;ae<e.symbolInstances.length;ae++){const ce=e.symbolInstances.get(ae),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:fe,crossTileID:ge}=ce;let Se=this.opacities[ge];a[ge]?Se=b:Se||(Se=X,this.opacities[ge]=Se),a[ge]=!0;const Re=ce.numIconVertices>0,We=this.placedOrientations[ce.crossTileID],nt=We===c.ah.vertical,ut=We===c.ah.horizontal||We===c.ah.horizontalOnly;if(Y>0||fe>0){const $e=Qr(Se.text);ee(e.text,Y,nt?to:$e),ee(e.text,fe,ut?to:$e);const wt=Se.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(lt=>{lt>=0&&(e.text.placedSymbolArray.get(lt).hidden=wt||nt?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=wt||ut?1:0);const Nt=this.variableOffsets[ce.crossTileID];Nt&&this.markUsedJustification(e,Nt.anchor,ce,We);const it=this.placedOrientations[ce.crossTileID];it&&(this.markUsedJustification(e,"left",ce,it),this.markUsedOrientation(e,it,ce))}if(Re){const $e=Qr(Se.icon),wt=!(G&&ce.verticalPlacedIconSymbolIndex&&nt);ce.placedIconSymbolIndex>=0&&(ee(e.icon,ce.numIconVertices,wt?$e:to),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=Se.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(ee(e.icon,ce.numVerticalIconVertices,wt?to:$e),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}const et=se&&se.has(ae)?se.get(ae):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const $e=e.collisionArrays[ae];if($e){let wt=new c.P(0,0);if($e.textBox||$e.verticalTextBox){let Nt=!0;if(M){const it=this.variableOffsets[ge];it?(wt=dr(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),z&&wt._rotate(B?this.transform.angle:-this.transform.angle)):Nt=!1}if($e.textBox||$e.verticalTextBox){let it;$e.textBox&&(it=nt),$e.verticalTextBox&&(it=ut),eo(e.textCollisionBox.collisionVertexArray,Se.text.placed,!Nt||it,et.text,wt.x,wt.y)}}if($e.iconBox||$e.verticalIconBox){const Nt=!!(!ut&&$e.verticalIconBox);let it;$e.iconBox&&(it=Nt),$e.verticalIconBox&&(it=!Nt),eo(e.iconCollisionBox.collisionVertexArray,Se.icon.placed,it,et.icon,G?wt.x:0,G?wt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ae.invProjMatrix,e.placementViewportMatrix=ae.viewportMatrix,e.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function eo(d,e,n,a,l,h){a&&a.length!==0||(a=[0,0,0,0]);const y=a[0]-qt,b=a[1]-qt,S=a[2]-qt,C=a[3]-qt;d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,b),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,b),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,S,C),d.emplaceBack(e?1:0,n?1:0,l||0,h||0,y,C)}const gi=Math.pow(2,25),Gc=Math.pow(2,24),Hc=Math.pow(2,17),Jr=Math.pow(2,16),Yr=Math.pow(2,9),u_=Math.pow(2,8),sn=Math.pow(2,1);function Qr(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*gi+e*Gc+n*Hc+e*Jr+n*Yr+e*u_+n*sn+e}const to=0;function Ss(){return{isOccluded:(d,e,n)=>!1,getPitchedTextCorrection:(d,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(d,e,n,a){throw new Error("Not implemented.")},translatePosition:(d,e,n,a)=>function(l,h,y,b,S=!1){if(!y[0]&&!y[1])return[0,0];const C=S?b==="map"?l.angle:0:b==="viewport"?-l.angle:0;if(C){const M=Math.sin(C),z=Math.cos(C);y=[y[0]*z-y[1]*M,y[0]*M+y[1]*z]}return[S?y[0]:Qt(h,y[0],l.zoom),S?y[1]:Qt(h,y[1],l.zoom)]}(d,e,n,a),getCircleRadiusCorrection:d=>1}}class rr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,l,h){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,h())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,S)=>b.sortKey-S.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,h())return!0;return!1}}class ea{constructor(e,n,a,l,h,y,b,S){this.placement=new Er(e,Ss(),n,y,b,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const l=V.now(),h=()=>!this._forceFullPlacement&&V.now()-l>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new rr(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,h))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const mn=512/c.X/2;class $i{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let h=0;h<n.length;h++){const y=n.get(h),b=y.key,S=l.get(b);S?S.push(y):l.set(b,[y])}for(const[h,y]of l){const b={positions:y.map(S=>({x:Math.floor(S.anchorX*mn),y:Math.floor(S.anchorY*mn)})),crossTileIDs:y.map(S=>S.crossTileID)};if(b.positions.length>128){const S=new c.av(b.positions.length,16,Uint16Array);for(const{x:C,y:M}of b.positions)S.add(C,M);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[h]=b}}getScaledCoordinates(e,n){const{x:a,y:l,z:h}=this.tileID.canonical,{x:y,y:b,z:S}=n.canonical,C=mn/Math.pow(2,S-h),M=(b*c.X+e.anchorY)*C,z=l*c.X*mn;return{x:Math.floor((y*c.X+e.anchorX)*C-a*c.X*mn),y:Math.floor(M-z)}}findMatches(e,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let h=0;h<e.length;h++){const y=e.get(h);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const S=this.getScaledCoordinates(y,n);if(b.index){const C=b.index.range(S.x-l,S.y-l,S.x+l,S.y+l).sort();for(const M of C){const z=b.crossTileIDs[M];if(!a[z]){a[z]=!0,y.crossTileID=z;break}}}else if(b.positions)for(let C=0;C<b.positions.length;C++){const M=b.positions[C],z=b.crossTileIDs[C];if(Math.abs(M.x-S.x)<=l&&Math.abs(M.y-S.y)<=l&&!a[z]){a[z]=!0,y.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class qa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],h={};for(const y in l){const b=l[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),h[b.tileID.key]=b}this.indexes[a]=h}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let h=0;h<n.symbolInstances.length;h++)n.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const h in this.indexes){const y=this.indexes[h];if(Number(h)>e.overscaledZ)for(const b in y){const S=y[b];S.tileID.isChildOf(e)&&S.findMatches(n.symbolInstances,e,l)}else{const b=y[e.scaledTo(Number(h)).key];b&&b.findMatches(n.symbolInstances,e,l)}}for(let h=0;h<n.symbolInstances.length;h++){const y=n.symbolInstances.get(h);y.crossTileID||(y.crossTileID=a.generate(),l[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new $i(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const h in l)e[l[h].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[h]),delete l[h],n=!0)}return n}}class Wc{constructor(){this.layerIndexes={},this.crossTileIDs=new qa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new gn);let h=!1;const y={};l.handleWrapJump(a);for(const b of n){const S=b.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(b.tileID,S,this.crossTileIDs)&&(h=!0),y[S.bucketInstanceId]=!0)}return l.removeStaleBuckets(y)&&(h=!0),h}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const _n=(d,e)=>c.t(d,e&&e.filter(n=>n.identifier!=="source.canvas")),h_=c.aw();class Za extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Fr(tr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new Fe,this.imageManager.setEventedParent(this),this.glyphManager=new yt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ti(256,512),this.crossTileSymbolIndex=new Wc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),zn().on(Xe,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const h=l.getSource();if(h&&h.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===h.id&&this._validateLayer(b)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const h=this._loadStyleRequest;c.h(l,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,a)}).catch(y=>{this._loadStyleRequest=null,y&&!h.signal.aborted&&this.fire(new c.j(y))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,V.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(h_,{validate:!1})}_load(e,n,a){var l;const h=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!_n(this,c.u(h))){this._loaded=!0,this.stylesheet=h;for(const y in h.sources)this.addSource(y,h.sources[y],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs),this._createLayers(),this.light=new mt(this.stylesheet.light),this.sky=new jt(this.stylesheet.sky),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(h,y,b,S){return c._(this,void 0,void 0,function*(){const C=Ge(h),M=b>1?"@2x":"",z={},B={};for(const{id:G,url:X}of C){const ee=y.transformRequest(gt(X,M,".json"),"SpriteJSON");z[G]=c.h(ee,S);const se=y.transformRequest(gt(X,M,".png"),"SpriteImage");B[G]=Ae.getImage(se,S)}return yield Promise.all([...Object.values(z),...Object.values(B)]),function(G,X){return c._(this,void 0,void 0,function*(){const ee={};for(const se in G){ee[se]={};const ae=V.getImageCanvasContext((yield X[se]).data),ce=(yield G[se]).data;for(const Y in ce){const{width:fe,height:ge,x:Se,y:Re,sdf:We,pixelRatio:nt,stretchX:ut,stretchY:et,content:$e,textFitWidth:wt,textFitHeight:Nt}=ce[Y];ee[se][Y]={data:null,pixelRatio:nt,sdf:We,stretchX:ut,stretchY:et,content:$e,textFitWidth:wt,textFitHeight:Nt,spriteData:{width:fe,height:ge,x:Se,y:Re,context:ae}}}}return ee})}(z,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(h=>{if(this._spriteRequest=null,h)for(const y in h){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(S=>!(S in h)):[];for(const S of b)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in h[y]){const C=y==="default"?S:`${y}:${S}`;this._spritesImagesIds[y].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,h[y][S],!1):this.imageManager.addImage(C,h[y][S]),n&&(this._changedImages[C]=!0)}}}).catch(h=>{this._spriteRequest=null,l=h,this.fire(new c.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const l=[];for(const h of e)if(a[h]){const y=n?c.aB(a[h]):a[h];l.push(y)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const l=Object.keys(this._updatedLayers),h=Object.keys(this._removedLayers);(l.length||h.length)&&this._updateWorkerLayers(l,h);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const h=this.sourceCaches[l];a[l]=h.used,h.used=!1}for(const l of this._order){const h=this._layers[l];h.recalculate(e,this._availableImages),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}for(const l in a){const h=this.sourceCaches[l];!!a[l]!=!!h.used&&h.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const l=this.serialize();if(e=n.transformStyle?n.transformStyle(l,e):e,((a=n.validate)===null||a===void 0||a)&&_n(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const h=c.aC(l,e),y=this._getOperationsToPerform(h);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setSky":n.push(()=>this.setSky.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[e]=new Ot(e,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new c.j(new Error(`Layer "${l}" already exists on this map.`)));let h;if(e.type==="custom"){if(_n(this,c.aD(e)))return;h=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=c.aB(e),e=c.e(e,{source:l})),this._validate(c.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;h=c.aA(e),this._validateLayer(h),h.setEventedParent(this,{layer:{id:l}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,l),this._layerOrderChanged=!0,this._layers[l]=h,this._removedLayers[l]&&h.source&&h.type!=="custom"){const b=this._removedLayers[l];delete this._removedLayers[l],b.type!==h.type?this._updatedSources[h.source]="clear":(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause())}this._updateLayer(h),h.onAdd&&h.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!c.aE(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(c.u.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=c.aB(n),this._updateLayer(l)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getLayoutProperty(n),a)||(h.setLayoutProperty(n,a,l),this._updateLayer(h)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,l={}){this._checkLoaded();const h=this.getLayer(e);h?c.aE(h.getPaintProperty(n),a)||(h.setPaintProperty(n,a,l)&&this._updateLayer(h),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,l=e.sourceLayer,h=this.sourceCaches[a];if(h===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const y=h.getSource().type;y==="geojson"&&l?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||l?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),h.setFeatureState(l,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const h=l.getSource().type,y=h==="vector"?e.sourceLayer:void 0;h!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(y,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,h=>h.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return c.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:n,terrain:a},h=>h!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",a={},l=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b)){a[b]=y;for(const S of e){const C=S[b];if(C)for(const M of C)l.push(M)}}}l.sort((y,b)=>b.intersectionZ-y.intersectionZ);const h=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b))for(let S=l.length-1;S>=0;S--){const C=l[S].feature;if(a[C.layer.id]<y)break;h.push(C),l.pop()}else for(const S of e){const C=S[b];if(C)for(const M of C)h.push(M.feature)}}return h}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const b of n.layers){const S=this._layers[b];if(!S)return this.fire(new c.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];l[S.source]=!0}}const h=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers();for(const b in this.sourceCaches)n.layers&&!l[b]||h.push(ar(this.sourceCaches[b],this._layers,y,e,n,a));return this.placement&&h.push(function(b,S,C,M,z,B,G){const X={},ee=B.queryRenderedSymbols(M),se=[];for(const ae of Object.keys(ee).map(Number))se.push(G[ae]);se.sort(vt);for(const ae of se){const ce=ae.featureIndex.lookupSymbolFeatures(ee[ae.bucketInstanceId],S,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,b);for(const Y in ce){const fe=X[Y]=X[Y]||[],ge=ce[Y];ge.sort((Se,Re)=>{const We=ae.featureSortOrder;if(We){const nt=We.indexOf(Se.featureIndex);return We.indexOf(Re.featureIndex)-nt}return Re.featureIndex-Se.featureIndex});for(const Se of ge)fe.push(Se)}}for(const ae in X)X[ae].forEach(ce=>{const Y=ce.feature,fe=C[b[ae].source].getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=fe});return X}(this._layers,y,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(h)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(l,h){const y=l.getRenderableIds().map(C=>l.getTileByID(C)),b=[],S={};for(let C=0;C<y.length;C++){const M=y[C],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(b,h))}return b}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:V.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(h)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const h={now:V.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(h)}_validate(e,n,a,l,h={}){return(!h||h.validate!==!1)&&_n(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),zn().off(Xe,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,l,h=!1){let y=!1,b=!1;const S={};for(const C of this._order){const M=this._layers[C];if(M.type!=="symbol")continue;if(!S[M.source]){const B=this.sourceCaches[M.source];S[M.source]=B.getRenderableIds(!0).map(G=>B.getTileByID(G)).sort((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((h=h||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(V.now(),e.zoom))&&(this.pauseablePlacement=new ea(e,this.map.terrain,this._order,h,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(V.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const C of this._order){const M=this._layers[C];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(V.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},l){this._checkLoaded();const h=[{id:e,url:n}],y=[...Ge(this.stylesheet.sprite),...h];this._validate(c.u.sprite,"sprite",y,null,a)||(this.stylesheet.sprite=y,this._loadSprite(h,!0,l))}removeSprite(e){this._checkLoaded();const n=Ge(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ge(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Ps=c.Y([{name:"a_pos",type:"Int16",components:2}]);const rs={prelude:li(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:li(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:li(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:li(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:li(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:li(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:li("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:li("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:li("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:li("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function li(d,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),l=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),h=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=h?h.concat(l):l,b={};return{fragmentSource:d=d.replace(n,(S,C,M,z,B)=>(b[B]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(n,(S,C,M,z,B)=>{const G=z==="float"?"vec2":"vec4",X=B.match(/color/)?"color":G;return b[B]?C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${G} a_${B};
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${X}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${G} a_${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = unpack_mix_${X}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Xc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,l,h,y,b,S,C){this.context=e;let M=this.boundPaintVertexBuffers.length!==l.length;for(let z=0;!M&&z<l.length;z++)this.boundPaintVertexBuffers[z]!==l[z]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==h||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(n,a,l,h,y,b,S,C):(e.bindVertexArray.set(this.vao),b&&b.bind(),h&&h.dynamicDraw&&h.bind(),S&&S.bind(),C&&C.bind())}freshBind(e,n,a,l,h,y,b,S){const C=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=h,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,n.enableAttributes(z,e);for(const B of a)B.enableAttributes(z,e);y&&y.enableAttributes(z,e),b&&b.enableAttributes(z,e),S&&S.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,h);for(const B of a)B.bind(),B.setVertexAttribPointers(z,e,h);y&&(y.bind(),y.setVertexAttribPointers(z,e,h)),l&&l.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,e,h)),S&&(S.bind(),S.setVertexAttribPointers(z,e,h)),M.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Kc=(d,e,n,a,l)=>({u_matrix:d,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function io(d){const e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const a=d[n].split(" ");e.push(a.pop())}return e}class Jc{constructor(e,n,a,l,h,y){const b=e.gl;this.program=b.createProgram();const S=io(n.staticAttributes),C=a?a.getBinderAttributes():[],M=S.concat(C),z=rs.prelude.staticUniforms?io(rs.prelude.staticUniforms):[],B=n.staticUniforms?io(n.staticUniforms):[],G=a?a.getBinderUniforms():[],X=z.concat(B).concat(G),ee=[];for(const Se of X)ee.indexOf(Se)<0&&ee.push(Se);const se=a?a.defines():[];h&&se.push("#define OVERDRAW_INSPECTOR;"),y&&se.push("#define TERRAIN3D;");const ae=se.concat(rs.prelude.fragmentSource,n.fragmentSource).join(`
`),ce=se.concat(rs.prelude.vertexSource,n.vertexSource).join(`
`),Y=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(Y,ae),b.compileShader(Y),!b.getShaderParameter(Y,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog(Y)}`);b.attachShader(this.program,Y);const fe=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(fe,ce),b.compileShader(fe),!b.getShaderParameter(fe,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(fe)}`);b.attachShader(this.program,fe),this.attributes={};const ge={};this.numAttributes=M.length;for(let Se=0;Se<this.numAttributes;Se++)M[Se]&&(b.bindAttribLocation(this.program,Se,M[Se]),this.attributes[M[Se]]=Se);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(fe),b.deleteShader(Y);for(let Se=0;Se<ee.length;Se++){const Re=ee[Se];if(Re&&!ge[Re]){const We=b.getUniformLocation(this.program,Re);We&&(ge[Re]=We)}}this.fixedUniforms=l(e,ge),this.terrainUniforms=((Se,Re)=>({u_depth:new c.aH(Se,Re.u_depth),u_terrain:new c.aH(Se,Re.u_terrain),u_terrain_dim:new c.aI(Se,Re.u_terrain_dim),u_terrain_matrix:new c.aJ(Se,Re.u_terrain_matrix),u_terrain_unpack:new c.aK(Se,Re.u_terrain_unpack),u_terrain_exaggeration:new c.aI(Se,Re.u_terrain_exaggeration)}))(e,ge),this.binderUniforms=a?a.getUniforms(e,ge):[]}draw(e,n,a,l,h,y,b,S,C,M,z,B,G,X,ee,se,ae,ce){const Y=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(h),e.setCullFace(y),S){e.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,S.depthTexture),e.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,S.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(S[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(b[ge]);ee&&ee.setUniforms(e,this.binderUniforms,G,{zoom:X});let fe=0;switch(n){case Y.LINES:fe=2;break;case Y.TRIANGLES:fe=3;break;case Y.LINE_STRIP:fe=1}for(const ge of B.get()){const Se=ge.vaos||(ge.vaos={});(Se[C]||(Se[C]=new Xc)).bind(e,this,M,ee?ee.getPaintVertexBuffers():[],z,ge.vertexOffset,se,ae,ce),Y.drawElements(n,ge.primitiveLength*fe,Y.UNSIGNED_SHORT,ge.primitiveOffset*fe*2)}}}function Ga(d,e,n){const a=1/Qt(n,1,e.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,e.transform.tileZoom)/l,y=h*(n.tileID.canonical.x+n.tileID.wrap*l),b=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const ta=(d,e,n,a)=>{const l=e.style.light,h=l.properties.get("position"),y=[h.x,h.y,h.z],b=function(){var C=new c.A(9);return c.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();l.properties.get("anchor")==="viewport"&&function(C,M){var z=Math.sin(M),B=Math.cos(M);C[0]=B,C[1]=z,C[2]=0,C[3]=-z,C[4]=B,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(b,-e.transform.angle),function(C,M,z){var B=M[0],G=M[1],X=M[2];C[0]=B*z[0]+G*z[3]+X*z[6],C[1]=B*z[1]+G*z[4]+X*z[7],C[2]=B*z[2]+G*z[5]+X*z[8]}(y,y,b);const S=l.properties.get("color");return{u_matrix:d,u_lightpos:y,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:a}},Ha=(d,e,n,a,l,h,y)=>c.e(ta(d,e,n,a),Ga(h,e,y),{u_height_factor:-Math.pow(2,l.overscaledZ)/y.tileSize/8}),ro=d=>({u_matrix:d}),Zp=(d,e,n,a)=>c.e(ro(d),Ga(n,e,a)),d_=(d,e)=>({u_matrix:d,u_world:e}),Gp=(d,e,n,a,l)=>c.e(Zp(d,e,n,a),{u_world:l}),p_=(d,e,n,a)=>{const l=d.transform;let h,y;if(a.paint.get("circle-pitch-alignment")==="map"){const b=Qt(n,1,l.zoom);h=!0,y=[b,b]}else h=!1,y=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+h,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:y}},Ts=(d,e,n)=>({u_matrix:d,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),ia=(d,e,n=1)=>({u_matrix:d,u_color:e,u_overlay:0,u_overlay_scale:n}),Vr=d=>({u_matrix:d}),jr=(d,e,n,a)=>({u_matrix:d,u_extrude_scale:Qt(e,1,n),u_intensity:a}),Wa=(d,e,n,a)=>{const l=c.H();c.aP(l,0,d.width,d.height,0,0,1);const h=d.context.gl;return{u_matrix:l,u_world:[h.drawingBufferWidth,h.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function Xa(d,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const Ka=(d,e,n,a)=>{const l=d.transform;return{u_matrix:Xp(d,e,n,a),u_ratio:1/Qt(e,1,l.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Hp=(d,e,n,a,l)=>c.e(Ka(d,e,n,l),{u_image:0,u_image_height:a}),no=(d,e,n,a,l)=>{const h=d.transform,y=Wp(e,h);return{u_matrix:Xp(d,e,n,l),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Qt(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},f_=(d,e,n,a,l,h)=>{const y=d.lineAtlas,b=Wp(e,d.transform),S=n.layout.get("line-cap")==="round",C=y.getDash(a.from,S),M=y.getDash(a.to,S),z=C.width*l.fromScale,B=M.width*l.toScale;return c.e(Ka(d,e,n,h),{u_patternscale_a:[b/z,-C.height/2],u_patternscale_b:[b/B,-M.height/2],u_sdfgamma:y.width/(256*Math.min(z,B)*d.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:M.y,u_mix:l.t})};function Wp(d,e){return 1/Qt(d,1,e.tileZoom)}function Xp(d,e,n,a){return d.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const m_=(d,e,n,a,l)=>{return{u_matrix:d,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(h=l.paint.get("raster-contrast"),h>0?1/(1-h):1+h),u_spin_weights:g_(l.paint.get("raster-hue-rotate"))};var h,y};function g_(d){d*=Math.PI/180;const e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Kp=(d,e,n,a,l,h,y,b,S,C,M,z,B,G)=>{const X=y.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:X.width/X.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:h,u_texsize:B,u_texture:0,u_translation:M,u_pitched_scale:G}},ra=(d,e,n,a,l,h,y,b,S,C,M,z,B,G,X)=>{const ee=y.transform;return c.e(Kp(d,e,n,a,l,h,y,b,S,C,M,z,B,X),{u_gamma_scale:a?Math.cos(ee._pitch)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+G})},Yc=(d,e,n,a,l,h,y,b,S,C,M,z,B,G)=>c.e(ra(d,e,n,a,l,h,y,b,S,C,M,!0,z,!0,G),{u_texsize_icon:B,u_texture_icon:1}),Ja=(d,e,n)=>({u_matrix:d,u_opacity:e,u_color:n}),Qc=(d,e,n,a,l,h)=>c.e(function(y,b,S,C){const M=S.imageManager.getPattern(y.from.toString()),z=S.imageManager.getPattern(y.to.toString()),{width:B,height:G}=S.imageManager.getPixelSize(),X=Math.pow(2,C.tileID.overscaledZ),ee=C.tileSize*Math.pow(2,S.transform.tileZoom)/X,se=ee*(C.tileID.canonical.x+C.tileID.wrap*X),ae=ee*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,G],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/Qt(C,1,S.transform.tileZoom),u_pixel_coord_upper:[se>>16,ae>>16],u_pixel_coord_lower:[65535&se,65535&ae]}}(a,h,n,l),{u_matrix:d,u_opacity:e}),$c={fillExtrusion:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_opacity:new c.aI(d,e.u_opacity)}),fillExtrusionPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_lightpos:new c.aN(d,e.u_lightpos),u_lightintensity:new c.aI(d,e.u_lightintensity),u_lightcolor:new c.aN(d,e.u_lightcolor),u_vertical_gradient:new c.aI(d,e.u_vertical_gradient),u_height_factor:new c.aI(d,e.u_height_factor),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade),u_opacity:new c.aI(d,e.u_opacity)}),fill:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),fillPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),fillOutline:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world)}),fillOutlinePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_texsize:new c.aO(d,e.u_texsize),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),circle:(d,e)=>({u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(d,e.u_scale_with_map),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_extrude_scale:new c.aO(d,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_matrix:new c.aJ(d,e.u_matrix)}),collisionBox:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_pixel_extrude_scale:new c.aO(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_inv_matrix:new c.aJ(d,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_viewport_size:new c.aO(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.aL(d,e.u_color),u_matrix:new c.aJ(d,e.u_matrix),u_overlay:new c.aH(d,e.u_overlay),u_overlay_scale:new c.aI(d,e.u_overlay_scale)}),clippingMask:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix)}),heatmap:(d,e)=>({u_extrude_scale:new c.aI(d,e.u_extrude_scale),u_intensity:new c.aI(d,e.u_intensity),u_matrix:new c.aJ(d,e.u_matrix)}),heatmapTexture:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_world:new c.aO(d,e.u_world),u_image:new c.aH(d,e.u_image),u_color_ramp:new c.aH(d,e.u_color_ramp),u_opacity:new c.aI(d,e.u_opacity)}),hillshade:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_latrange:new c.aO(d,e.u_latrange),u_light:new c.aO(d,e.u_light),u_shadow:new c.aL(d,e.u_shadow),u_highlight:new c.aL(d,e.u_highlight),u_accent:new c.aL(d,e.u_accent)}),hillshadePrepare:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_image:new c.aH(d,e.u_image),u_dimension:new c.aO(d,e.u_dimension),u_zoom:new c.aI(d,e.u_zoom),u_unpack:new c.aK(d,e.u_unpack)}),line:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_image:new c.aH(d,e.u_image),u_image_height:new c.aI(d,e.u_image_height)}),linePattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texsize:new c.aO(d,e.u_texsize),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_image:new c.aH(d,e.u_image),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_scale:new c.aN(d,e.u_scale),u_fade:new c.aI(d,e.u_fade)}),lineSDF:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ratio:new c.aI(d,e.u_ratio),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(d,e.u_units_to_pixels),u_patternscale_a:new c.aO(d,e.u_patternscale_a),u_patternscale_b:new c.aO(d,e.u_patternscale_b),u_sdfgamma:new c.aI(d,e.u_sdfgamma),u_image:new c.aH(d,e.u_image),u_tex_y_a:new c.aI(d,e.u_tex_y_a),u_tex_y_b:new c.aI(d,e.u_tex_y_b),u_mix:new c.aI(d,e.u_mix)}),raster:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_tl_parent:new c.aO(d,e.u_tl_parent),u_scale_parent:new c.aI(d,e.u_scale_parent),u_buffer_scale:new c.aI(d,e.u_buffer_scale),u_fade_t:new c.aI(d,e.u_fade_t),u_opacity:new c.aI(d,e.u_opacity),u_image0:new c.aH(d,e.u_image0),u_image1:new c.aH(d,e.u_image1),u_brightness_low:new c.aI(d,e.u_brightness_low),u_brightness_high:new c.aI(d,e.u_brightness_high),u_saturation_factor:new c.aI(d,e.u_saturation_factor),u_contrast_factor:new c.aI(d,e.u_contrast_factor),u_spin_weights:new c.aN(d,e.u_spin_weights)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texture:new c.aH(d,e.u_texture),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.aH(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(d,e.u_is_size_feature_constant),u_size_t:new c.aI(d,e.u_size_t),u_size:new c.aI(d,e.u_size),u_camera_to_center_distance:new c.aI(d,e.u_camera_to_center_distance),u_pitch:new c.aI(d,e.u_pitch),u_rotate_symbol:new c.aH(d,e.u_rotate_symbol),u_aspect_ratio:new c.aI(d,e.u_aspect_ratio),u_fade_change:new c.aI(d,e.u_fade_change),u_matrix:new c.aJ(d,e.u_matrix),u_label_plane_matrix:new c.aJ(d,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(d,e.u_coord_matrix),u_is_text:new c.aH(d,e.u_is_text),u_pitch_with_map:new c.aH(d,e.u_pitch_with_map),u_is_along_line:new c.aH(d,e.u_is_along_line),u_is_variable_anchor:new c.aH(d,e.u_is_variable_anchor),u_texsize:new c.aO(d,e.u_texsize),u_texsize_icon:new c.aO(d,e.u_texsize_icon),u_texture:new c.aH(d,e.u_texture),u_texture_icon:new c.aH(d,e.u_texture_icon),u_gamma_scale:new c.aI(d,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(d,e.u_device_pixel_ratio),u_is_halo:new c.aH(d,e.u_is_halo),u_translation:new c.aO(d,e.u_translation),u_pitched_scale:new c.aI(d,e.u_pitched_scale)}),background:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_color:new c.aL(d,e.u_color)}),backgroundPattern:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_opacity:new c.aI(d,e.u_opacity),u_image:new c.aH(d,e.u_image),u_pattern_tl_a:new c.aO(d,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(d,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(d,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(d,e.u_pattern_br_b),u_texsize:new c.aO(d,e.u_texsize),u_mix:new c.aI(d,e.u_mix),u_pattern_size_a:new c.aO(d,e.u_pattern_size_a),u_pattern_size_b:new c.aO(d,e.u_pattern_size_b),u_scale_a:new c.aI(d,e.u_scale_a),u_scale_b:new c.aI(d,e.u_scale_b),u_pixel_coord_upper:new c.aO(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_ele_delta:new c.aI(d,e.u_ele_delta),u_fog_matrix:new c.aJ(d,e.u_fog_matrix),u_fog_color:new c.aL(d,e.u_fog_color),u_fog_ground_blend:new c.aI(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon_fog_blend:new c.aI(d,e.u_horizon_fog_blend)}),terrainDepth:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_ele_delta:new c.aI(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_matrix:new c.aJ(d,e.u_matrix),u_texture:new c.aH(d,e.u_texture),u_terrain_coords_id:new c.aI(d,e.u_terrain_coords_id),u_ele_delta:new c.aI(d,e.u_ele_delta)}),sky:(d,e)=>({u_sky_color:new c.aL(d,e.u_sky_color),u_horizon_color:new c.aL(d,e.u_horizon_color),u_horizon:new c.aI(d,e.u_horizon),u_sky_horizon_blend:new c.aI(d,e.u_sky_horizon_blend)})};class Ln{constructor(e,n,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const __={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class eu{constructor(e,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=e;const h=e.gl;this.buffer=h.createBuffer(),e.bindVertexBuffer.set(this.buffer),h.bufferData(h.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,n,a){for(let l=0;l<this.attributes.length;l++){const h=this.attributes[l],y=n.attributes[h.name];y!==void 0&&e.vertexAttribPointer(y,h.components,e[__[h.type]],!1,this.itemSize,h.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Is=new WeakMap;function ns(d){var e;if(Is.has(d))return Is.get(d);{const n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Is.set(d,n),n}}class pi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ya extends pi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class y_ extends pi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class so extends pi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class v_ extends pi{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Jp extends pi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class x_ extends pi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Yp extends pi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class tu extends pi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Qp extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class $p extends pi{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ef extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class tf extends pi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class As extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class rf extends pi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class b_ extends pi{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nf extends pi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class na extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class w_ extends pi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Qa extends pi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class S_ extends pi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class P_ extends pi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class sf extends pi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class of extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class af extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class iu extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class lf extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $a extends pi{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Gn extends pi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;ns(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class ru extends pi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class nu extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class su extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class el extends pi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class ou extends el{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Cs extends el{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class au extends el{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class T_{constructor(e,n,a,l,h){this.context=e,this.width=n,this.height=a;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new ou(e,b),l)this.depthAttachment=h?new au(e,b):new Cs(e,b);else if(h)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Wi{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}Wi.Replace=[1,0],Wi.disabled=new Wi(Wi.Replace,c.aM.transparent,[!1,!1,!1,!1]),Wi.unblended=new Wi(Wi.Replace,c.aM.transparent,[!0,!0,!0,!0]),Wi.alphaBlended=new Wi([1,771],c.aM.transparent,[!0,!0,!0,!0]);class I_{constructor(e){var n,a;if(this.gl=e,this.clearColor=new Ya(this),this.clearDepth=new y_(this),this.clearStencil=new so(this),this.colorMask=new v_(this),this.depthMask=new Jp(this),this.stencilMask=new x_(this),this.stencilFunc=new Yp(this),this.stencilOp=new tu(this),this.stencilTest=new Qp(this),this.depthRange=new $p(this),this.depthTest=new ef(this),this.depthFunc=new tf(this),this.blend=new As(this),this.blendFunc=new rf(this),this.blendColor=new b_(this),this.blendEquation=new nf(this),this.cullFace=new na(this),this.cullFaceSide=new w_(this),this.frontFace=new Qa(this),this.program=new S_(this),this.activeTexture=new P_(this),this.viewport=new sf(this),this.bindFramebuffer=new of(this),this.bindRenderbuffer=new af(this),this.bindTexture=new iu(this),this.bindVertexBuffer=new lf(this),this.bindElementBuffer=new $a(this),this.bindVertexArray=new Gn(this),this.pixelStoreUnpack=new ru(this),this.pixelStoreUnpackPremultiplyAlpha=new nu(this),this.pixelStoreUnpackFlipY=new su(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ns(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Ln(this,e,n)}createVertexBuffer(e,n,a){return new eu(this,e,n,a)}createRenderbuffer(e,n,a){const l=this.gl,h=l.createRenderbuffer();return this.bindRenderbuffer.set(h),l.renderbufferStorage(l.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),h}createFramebuffer(e,n,a,l){return new T_(this,e,n,a,l)}clear({color:e,depth:n,stencil:a}){const l=this.gl;let h=0;e&&(h|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(h|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(h|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(h)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ns(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ns(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Kt{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const tl=7680;class Ii{constructor(e,n,a,l,h,y){this.test=e,this.ref=n,this.mask=a,this.fail=l,this.depthFail=h,this.pass=y}}Ii.disabled=new Ii({func:519,mask:0},0,0,tl,tl,tl);class _i{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let Es;function sa(d,e,n,a,l){const h=d.context,y=h.gl,b=d.useProgram("collisionBox"),S=[];let C=0,M=0;for(let ae=0;ae<a.length;ae++){const ce=a[ae],Y=e.getTile(ce).getBucket(n);if(!Y)continue;const fe=l?Y.textCollisionBox:Y.iconCollisionBox,ge=Y.collisionCircleArray;if(ge.length>0){const Se=c.H();c.aQ(Se,Y.placementInvProjMatrix,d.transform.glCoordMatrix),c.aQ(Se,Se,Y.placementViewportMatrix),S.push({circleArray:ge,circleOffset:M,transform:ce.posMatrix,invTransform:Se,coord:ce}),C+=ge.length/4,M=C}fe&&b.draw(h,y.LINES,Kt.disabled,Ii.disabled,d.colorModeForRenderPass(),_i.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(z=d.transform).width,1/z.height]},d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce),n.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,d.transform.zoom,null,null,fe.collisionVertexBuffer)}var z;if(!l||!S.length)return;const B=d.useProgram("collisionCircle"),G=new c.aR;G.resize(4*C),G._trim();let X=0;for(const ae of S)for(let ce=0;ce<ae.circleArray.length/4;ce++){const Y=4*ce,fe=ae.circleArray[Y+0],ge=ae.circleArray[Y+1],Se=ae.circleArray[Y+2],Re=ae.circleArray[Y+3];G.emplace(X++,fe,ge,Se,Re,0),G.emplace(X++,fe,ge,Se,Re,1),G.emplace(X++,fe,ge,Se,Re,2),G.emplace(X++,fe,ge,Se,Re,3)}(!Es||Es.length<2*C)&&(Es=function(ae){const ce=2*ae,Y=new c.aT;Y.resize(ce),Y._trim();for(let fe=0;fe<ce;fe++){const ge=6*fe;Y.uint16[ge+0]=4*fe+0,Y.uint16[ge+1]=4*fe+1,Y.uint16[ge+2]=4*fe+2,Y.uint16[ge+3]=4*fe+2,Y.uint16[ge+4]=4*fe+3,Y.uint16[ge+5]=4*fe+0}return Y}(C));const ee=h.createIndexBuffer(Es,!0),se=h.createVertexBuffer(G,c.aS.members,!0);for(const ae of S){const ce=Ts(ae.transform,ae.invTransform,d.transform);B.draw(h,y.TRIANGLES,Kt.disabled,Ii.disabled,d.colorModeForRenderPass(),_i.disabled,ce,d.style.map.terrain&&d.style.map.terrain.getTerrainData(ae.coord),n.id,se,ee,c.a0.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,d.transform.zoom,null,null,null)}se.destroy(),ee.destroy()}_i.disabled=new _i(!1,1029,2305),_i.backCCW=new _i(!0,1029,2305);const oa=c.an(new Float32Array(16));function lu(d,e,n,a,l,h){const{horizontalAlign:y,verticalAlign:b}=c.au(d);return new c.P((-(y-.5)*e/l+a[0])*h,(-(b-.5)*n/l+a[1])*h)}function ks(d,e,n,a,l,h){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=a.mult(h);n||(b=b.rotate(-l));const S=y.add(b);return re(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const b=ke(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return d.add(a.rotate(S))}return d.add(a)}function oo(d,e,n,a,l,h,y,b,S,C,M,z,B,G){const X=d.text.placedSymbolArray,ee=d.text.dynamicLayoutVertexArray,se=d.icon.dynamicLayoutVertexArray,ae={};ee.clear();for(let ce=0;ce<X.length;ce++){const Y=X.get(ce),fe=Y.hidden||!Y.crossTileID||d.allowVerticalPlacement&&!Y.placedOrientation?null:a[Y.crossTileID];if(fe){const ge=new c.P(Y.anchorX,Y.anchorY),Se={getElevation:G,width:l.width,height:l.height,labelPlaneMatrix:h,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:ge,translation:z,unwrappedTileID:B},Re=n?re(ge.x,ge.y,y,G):ke(ge.x,ge.y,Se),We=O(l.cameraToCenterDistance,Re.signedDistanceFromCamera);let nt=c.ai(d.textSizeData,S,Y)*We/c.ap;n&&(nt*=d.tilePixelRatio/b);const{width:ut,height:et,anchor:$e,textOffset:wt,textBoxScale:Nt}=fe,it=lu($e,ut,et,wt,Nt,nt),lt=M.getPitchedTextCorrection(l,ge.add(new c.P(z[0],z[1])),B),Ft=ks(Re.point,Se,e,it,l.angle,lt),ki=d.allowVerticalPlacement&&Y.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Zt=0;Zt<Y.numGlyphs;Zt++)c.aj(ee,Ft,ki);C&&Y.associatedIconIndex>=0&&(ae[Y.associatedIconIndex]={shiftedAnchor:Ft,angle:ki})}else Mt(Y.numGlyphs,ee)}if(C){se.clear();const ce=d.icon.placedSymbolArray;for(let Y=0;Y<ce.length;Y++){const fe=ce.get(Y);if(fe.hidden)Mt(fe.numGlyphs,se);else{const ge=ae[Y];if(ge)for(let Se=0;Se<fe.numGlyphs;Se++)c.aj(se,ge.shiftedAnchor,ge.angle);else Mt(fe.numGlyphs,se)}}d.icon.dynamicLayoutVertexBuffer.updateData(se)}d.text.dynamicLayoutVertexBuffer.updateData(ee)}function on(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function cu(d,e,n,a,l,h,y,b,S,C,M,z){const B=d.context,G=B.gl,X=d.transform,ee=Ss(),se=b==="map",ae=S==="map",ce=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",Y=se&&!ae&&!ce,fe=!ae&&ce,ge=!n.layout.get("symbol-sort-key").isConstant();let Se=!1;const Re=d.depthModeForSublayer(0,Kt.ReadOnly),We=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),nt=[],ut=ee.getCircleRadiusCorrection(X);for(const et of a){const $e=e.getTile(et),wt=$e.getBucket(n);if(!wt)continue;const Nt=l?wt.text:wt.icon;if(!Nt||!Nt.segments.get().length||!Nt.hasVisibleVertices)continue;const it=Nt.programConfigurations.get(n.id),lt=l||wt.sdfIcons,Ft=l?wt.textSizeData:wt.iconSizeData,ki=ae||X.pitch!==0,Zt=d.useProgram(on(lt,l,wt),it),$t=c.ag(Ft,X.zoom),Mi=d.style.map.terrain&&d.style.map.terrain.getTerrainData(et);let yr,xn,zi,Ur,kr=[0,0],vr=null;if(l)xn=$e.glyphAtlasTexture,zi=G.LINEAR,yr=$e.glyphAtlasTexture.size,wt.iconsInText&&(kr=$e.imageAtlasTexture.size,vr=$e.imageAtlasTexture,Ur=ki||d.options.rotating||d.options.zooming||Ft.kind==="composite"||Ft.kind==="camera"?G.LINEAR:G.NEAREST);else{const ii=n.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;xn=$e.imageAtlasTexture,zi=lt||d.options.rotating||d.options.zooming||ii||ki?G.LINEAR:G.NEAREST,yr=$e.imageAtlasTexture.size}const Mr=Qt($e,1,d.transform.zoom),Bn=fe?et.posMatrix:oa,So=is(Bn,ae,se,d.transform,Mr),xl=Rn(Bn,ae,se,d.transform,Mr),Po=Rn(et.posMatrix,ae,se,d.transform,Mr),cn=ee.translatePosition(d.transform,$e,h,y),bl=We&&wt.hasTextData(),Ru=n.layout.get("icon-text-fit")!=="none"&&bl&&wt.hasIconData();if(ce){const ii=d.style.map.terrain?(To,Io)=>d.style.map.terrain.getElevation(et,To,Io):null,Ls=n.layout.get("text-rotation-alignment")==="map";H(wt,et.posMatrix,d,l,So,Po,ae,C,Ls,ee,et.toUnwrapped(),X.width,X.height,cn,ii)}const un=et.posMatrix,hn=l&&We||Ru,ss=ce||hn?oa:So,bn=xl,pr=lt&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xr;xr=lt?wt.iconsInText?Yc(Ft.kind,$t,Y,ae,ce,hn,d,un,ss,bn,cn,yr,kr,ut):ra(Ft.kind,$t,Y,ae,ce,hn,d,un,ss,bn,cn,l,yr,!0,ut):Kp(Ft.kind,$t,Y,ae,ce,hn,d,un,ss,bn,cn,l,yr,ut);const tn={program:Zt,buffers:Nt,uniformValues:xr,atlasTexture:xn,atlasTextureIcon:vr,atlasInterpolation:zi,atlasInterpolationIcon:Ur,isSDF:lt,hasHalo:pr};if(ge&&wt.canOverlap){Se=!0;const ii=Nt.segments.get();for(const Ls of ii)nt.push({segments:new c.a0([Ls]),sortKey:Ls.sortKey,state:tn,terrainData:Mi})}else nt.push({segments:Nt.segments,sortKey:0,state:tn,terrainData:Mi})}Se&&nt.sort((et,$e)=>et.sortKey-$e.sortKey);for(const et of nt){const $e=et.state;if(B.activeTexture.set(G.TEXTURE0),$e.atlasTexture.bind($e.atlasInterpolation,G.CLAMP_TO_EDGE),$e.atlasTextureIcon&&(B.activeTexture.set(G.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),$e.isSDF){const wt=$e.uniformValues;$e.hasHalo&&(wt.u_is_halo=1,uu($e.buffers,et.segments,n,d,$e.program,Re,M,z,wt,et.terrainData)),wt.u_is_halo=0}uu($e.buffers,et.segments,n,d,$e.program,Re,M,z,$e.uniformValues,et.terrainData)}}function uu(d,e,n,a,l,h,y,b,S,C){const M=a.context;l.draw(M,M.gl.TRIANGLES,h,y,b,_i.disabled,S,C,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,a.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function hu(d,e,n,a){const l=d.context,h=l.gl,y=Ii.disabled,b=new Wi([h.ONE,h.ONE],c.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(n);if(!S)return;const C=a.key;let M=n.heatmapFbos.get(C);M||(M=aa(l,e.tileSize,e.tileSize),n.heatmapFbos.set(C,M)),l.bindFramebuffer.set(M.framebuffer),l.viewport.set([0,0,e.tileSize,e.tileSize]),l.clear({color:c.aM.transparent});const z=S.programConfigurations.get(n.id),B=d.useProgram("heatmap",z),G=d.style.map.terrain.getTerrainData(a);B.draw(l,h.TRIANGLES,Kt.disabled,y,b,_i.disabled,jr(a.posMatrix,e,d.transform.zoom,n.paint.get("heatmap-intensity")),G,n.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,n.paint,d.transform.zoom,z)}function Ms(d,e,n){const a=d.context,l=a.gl;a.setColorMode(d.colorModeForRenderPass());const h=la(a,e),y=n.key,b=e.heatmapFbos.get(y);b&&(a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,b.colorAttachment.get()),a.activeTexture.set(l.TEXTURE1),h.bind(l.LINEAR,l.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(a,l.TRIANGLES,Kt.disabled,Ii.disabled,d.colorModeForRenderPass(),_i.disabled,Wa(d,e,0,1),null,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,d.transform.zoom),b.destroy(),e.heatmapFbos.delete(y))}function aa(d,e,n){var a,l;const h=d.gl,y=h.createTexture();h.bindTexture(h.TEXTURE_2D,y),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR);const b=(a=d.HALF_FLOAT)!==null&&a!==void 0?a:h.UNSIGNED_BYTE,S=(l=d.RGBA16F)!==null&&l!==void 0?l:h.RGBA;h.texImage2D(h.TEXTURE_2D,0,S,e,n,0,h.RGBA,b,null);const C=d.createFramebuffer(e,n,!1,!1);return C.colorAttachment.set(y),C}function la(d,e){return e.colorRampTexture||(e.colorRampTexture=new at(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function ao(d,e,n,a,l){if(!n||!a||!a.imageAtlas)return;const h=a.imageAtlas.patternPositions;let y=h[n.to.toString()],b=h[n.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const S=l.getPaintProperty(e);y=h[S],b=h[S]}y&&b&&d.setConstantPatternPositions(y,b)}function ca(d,e,n,a,l,h,y){const b=d.context.gl,S="fill-pattern",C=n.paint.get(S),M=C&&C.constantOr(1),z=n.getCrossfadeParameters();let B,G,X,ee,se;y?(G=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=b.LINES):(G=M?"fillPattern":"fill",B=b.TRIANGLES);const ae=C.constantOr(null);for(const ce of a){const Y=e.getTile(ce);if(M&&!Y.patternsLoaded())continue;const fe=Y.getBucket(n);if(!fe)continue;const ge=fe.programConfigurations.get(n.id),Se=d.useProgram(G,ge),Re=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce);M&&(d.context.activeTexture.set(b.TEXTURE0),Y.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ge.updatePaintBuffers(z)),ao(ge,S,ae,Y,n);const We=Re?ce:null,nt=d.translatePosMatrix(We?We.posMatrix:ce.posMatrix,Y,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(y){ee=fe.indexBuffer2,se=fe.segments2;const ut=[b.drawingBufferWidth,b.drawingBufferHeight];X=G==="fillOutlinePattern"&&M?Gp(nt,d,z,Y,ut):d_(nt,ut)}else ee=fe.indexBuffer,se=fe.segments,X=M?Zp(nt,d,z,Y):ro(nt);Se.draw(d.context,B,l,d.stencilModeForClipping(ce),h,_i.disabled,X,Re,n.id,fe.layoutVertexBuffer,ee,se,n.paint,d.transform.zoom,ge)}}function il(d,e,n,a,l,h,y){const b=d.context,S=b.gl,C="fill-extrusion-pattern",M=n.paint.get(C),z=M.constantOr(1),B=n.getCrossfadeParameters(),G=n.paint.get("fill-extrusion-opacity"),X=M.constantOr(null);for(const ee of a){const se=e.getTile(ee),ae=se.getBucket(n);if(!ae)continue;const ce=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ee),Y=ae.programConfigurations.get(n.id),fe=d.useProgram(z?"fillExtrusionPattern":"fillExtrusion",Y);z&&(d.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Y.updatePaintBuffers(B)),ao(Y,C,X,se,n);const ge=d.translatePosMatrix(ee.posMatrix,se,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Se=n.paint.get("fill-extrusion-vertical-gradient"),Re=z?Ha(ge,d,Se,G,ee,B,se):ta(ge,d,Se,G);fe.draw(b,b.gl.TRIANGLES,l,h,y,_i.backCCW,Re,ce,n.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,n.paint,d.transform.zoom,Y,d.style.map.terrain&&ae.centroidVertexBuffer)}}function lo(d,e,n,a,l,h,y){const b=d.context,S=b.gl,C=n.fbo;if(!C)return;const M=d.useProgram("hillshade"),z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(e);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,C.colorAttachment.get()),M.draw(b,S.TRIANGLES,l,h,y,_i.disabled,((B,G,X,ee)=>{const se=X.paint.get("hillshade-shadow-color"),ae=X.paint.get("hillshade-highlight-color"),ce=X.paint.get("hillshade-accent-color");let Y=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=B.transform.angle);const fe=!B.options.moving;return{u_matrix:ee?ee.posMatrix:B.transform.calculatePosMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:Xa(0,G.tileID),u_light:[X.paint.get("hillshade-exaggeration"),Y],u_shadow:se,u_highlight:ae,u_accent:ce}})(d,n,a,z?e:null),z,a.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function co(d,e,n,a,l,h){const y=d.context,b=y.gl,S=e.dem;if(S&&S.data){const C=S.dim,M=S.stride,z=S.getPixels();if(y.activeTexture.set(b.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||d.getTileTexture(M),e.demTexture){const G=e.demTexture;G.update(z,{premultiply:!1}),G.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new at(y,z,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);y.activeTexture.set(b.TEXTURE0);let B=e.fbo;if(!B){const G=new at(y,{width:C,height:C,data:null},b.RGBA);G.bind(b.LINEAR,b.CLAMP_TO_EDGE),B=e.fbo=y.createFramebuffer(C,C,!0,!1),B.colorAttachment.set(G.texture)}y.bindFramebuffer.set(B.framebuffer),y.viewport.set([0,0,C,C]),d.useProgram("hillshadePrepare").draw(y,b.TRIANGLES,a,l,h,_i.disabled,((G,X)=>{const ee=X.stride,se=c.H();return c.aP(se,0,c.X,-c.X,0,0,1),c.J(se,se,[0,-c.X,0]),{u_matrix:se,u_image:1,u_dimension:[ee,ee],u_zoom:G.overscaledZ,u_unpack:X.getUnpackVector()}})(e.tileID,S),null,n.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function cf(d,e,n,a,l,h){const y=a.paint.get("raster-fade-duration");if(!h&&y>0){const b=V.now(),S=(b-d.timeAdded)/y,C=e?(b-e.timeAdded)/y:-1,M=n.getSource(),z=l.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),G=B&&d.refreshedUponExpiration?1:c.ac(B?S:1-C,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const du=new c.aM(1,0,0,1),oi=new c.aM(0,1,0,1),rl=new c.aM(0,0,1,1),A_=new c.aM(1,0,1,1),uf=new c.aM(0,1,1,1);function uo(d,e,n,a){nl(d,0,e+n/2,d.transform.width,n,a)}function hf(d,e,n,a){nl(d,e-n/2,0,n,d.transform.height,a)}function nl(d,e,n,a,l,h){const y=d.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,n*d.pixelRatio,a*d.pixelRatio,l*d.pixelRatio),y.clear({color:h}),b.disable(b.SCISSOR_TEST)}function df(d,e,n){const a=d.context,l=a.gl,h=n.posMatrix,y=d.useProgram("debug"),b=Kt.disabled,S=Ii.disabled,C=d.colorModeForRenderPass(),M="$debug",z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const B=e.getTileByID(n.key).latestRawTileData,G=Math.floor((B&&B.byteLength||0)/1024),X=e.getTile(n).tileSize,ee=512/Math.min(X,512)*(n.overscaledZ/d.transform.zoom)*.5;let se=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(se+=` => ${n.overscaledZ}`),function(ae,ce){ae.initDebugOverlayCanvas();const Y=ae.debugOverlayCanvas,fe=ae.context.gl,ge=ae.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,Y.width,Y.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ce,5,5),ge.strokeText(ce,5,5),ae.debugOverlayTexture.update(Y),ae.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(d,`${se} ${G}kB`),y.draw(a,l.TRIANGLES,b,S,Wi.alphaBlended,_i.disabled,ia(h,c.aM.transparent,ee),null,M,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),y.draw(a,l.LINE_STRIP,b,S,C,_i.disabled,ia(h,c.aM.red),z,M,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function pf(d,e,n){const a=d.context,l=a.gl,h=d.colorModeForRenderPass(),y=new Kt(l.LEQUAL,Kt.ReadWrite,d.depthRangeFor3D),b=d.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,d.width,d.height]);for(const C of n){const M=d.renderToTexture.getTexture(C),z=e.getTerrainData(C.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,M.texture);const B=d.transform.calculatePosMatrix(C.tileID.toUnwrapped()),G=e.getMeshFrameDelta(d.transform.zoom),X=d.transform.calculateFogMatrix(C.tileID.toUnwrapped()),ee=Kc(B,G,X,d.style.sky,d.transform.pitch);b.draw(a,l.TRIANGLES,y,Ii.disabled,h,_i.backCCW,ee,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class sl{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ol{constructor(e,n){this.context=new I_(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ot.maxUnderzooming+Ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wc}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,Ps.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,Ps.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const l=new c.$;l.emplaceBack(0,0,0,0),l.emplaceBack(c.X,0,c.X,0),l.emplaceBack(0,c.X,0,c.X),l.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,Kr.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(1,0),h.emplaceBack(0,1),h.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(h,Ps.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aZ;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const b=new c.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const S=this.context.gl;this.stencilClearMode=new Ii({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Kt.disabled,this.stencilClearMode,Wi.disabled,_i.disabled,Vr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Wi.disabled),a.setDepthMode(Kt.disabled);const h=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of n){const b=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y);h.draw(a,l.TRIANGLES,Kt.disabled,new Ii({func:l.ALWAYS,mask:0},b,255,l.KEEP,l.KEEP,l.REPLACE),Wi.disabled,_i.disabled,Vr(y.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Ii({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Ii({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),l=a[a.length-1].overscaledZ,h=a[0].overscaledZ-l+1;if(h>1){this.currentStencilSource=void 0,this.nextStencilID+h>256&&this.clearStencil();const y={};for(let b=0;b<h;b++)y[b+l]=new Ii({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=h,[y,a]}return[{[l]:Ii.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Wi([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wi.unblended:Wi.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return Kt.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Kt(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(V.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,h={},y={},b={};for(const S in l){const C=l[S];C.used&&C.prepare(this.context),h[S]=C.getVisibleCoordinates(),y[S]=h[S].slice().reverse(),b[S]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const C=this.style._layers[S];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const M=y[C.source];(C.type==="custom"||M.length)&&this.renderLayer(this,l[C.source],C,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,C){const M=S.context,z=M.gl,B=((ae,ce,Y)=>({u_sky_color:ae.properties.get("sky-color"),u_horizon_color:ae.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*Y,u_sky_horizon_blend:ae.properties.get("sky-horizon-blend")*ce.height/2*Y}))(C,S.style.map.transform,S.pixelRatio),G=new Kt(z.LEQUAL,Kt.ReadWrite,[0,1]),X=Ii.disabled,ee=S.colorModeForRenderPass(),se=S.useProgram("sky");if(!C.mesh){const ae=new c.aX;ae.emplaceBack(-1,-1),ae.emplaceBack(1,-1),ae.emplaceBack(1,1),ae.emplaceBack(-1,1);const ce=new c.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),C.mesh=new sl(M.createVertexBuffer(ae,Ps.members),M.createIndexBuffer(ce),c.a0.simpleSegment(0,0,ae.length,ce.length))}se.draw(M,z.TRIANGLES,G,X,ee,_i.disabled,B,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],C=l[S.source],M=h[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,C,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],C=l[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?b:y)[S.source];this._renderTileClippingMasks(S,h[S.source]),this.renderLayer(this,C,S,M)}if(this.options.showTileBoundaries){const S=function(C,M){let z=null;const B=Object.values(C._layers).flatMap(se=>se.source&&!se.isHidden(M)?[C.sourceCaches[se.source]]:[]),G=B.filter(se=>se.getSource().type==="vector"),X=B.filter(se=>se.getSource().type!=="vector"),ee=se=>{(!z||z.getSource().maxzoom<se.getSource().maxzoom)&&(z=se)};return G.forEach(se=>ee(se)),z||X.forEach(se=>ee(se)),z}(this.style,this.transform.zoom);S&&function(C,M,z){for(let B=0;B<z.length;B++)df(C,M,z[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const C=S.transform.padding;uo(S,S.transform.height-(C.top||0),3,du),uo(S,C.bottom||0,3,oi),hf(S,C.left||0,3,rl),hf(S,S.transform.width-(C.right||0),3,A_);const M=S.transform.centerPoint;(function(z,B,G,X){nl(z,B-1,G-10,2,20,X),nl(z,B-10,G-1,20,2,X)})(S,M.x,S.transform.height-M.y,uf)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!c.a_(n,a):!c.a$(n,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(h,y){const b=h.context,S=b.gl,C=Wi.unblended,M=new Kt(S.LEQUAL,Kt.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.sourceCache.getRenderableTiles(),G=h.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1});for(const X of B){const ee=y.getTerrainData(X.tileID),se={u_matrix:h.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};G.draw(b,S.TRIANGLES,M,Ii.disabled,C,_i.backCCW,se,ee,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain),function(h,y){const b=h.context,S=b.gl,C=Wi.unblended,M=new Kt(S.LEQUAL,Kt.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.getCoordsTexture(),G=y.sourceCache.getRenderableTiles(),X=h.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,h.width/devicePixelRatio,h.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1}),y.coordsIndex=[];for(const ee of G){const se=y.getTerrainData(ee.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,B.texture);const ae={u_matrix:h.transform.calculatePosMatrix(ee.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(h.transform.zoom)};X.draw(b,S.TRIANGLES,M,Ii.disabled,C,_i.backCCW,ae,se,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),y.coordsIndex.push(ee.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,h.width,h.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(h,y,b,S,C){if(h.renderPass!=="translucent")return;const M=Ii.disabled,z=h.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,G,X,ee,se,ae,ce,Y,fe){const ge=G.transform,Se=Ss(),Re=se==="map",We=ae==="map";for(const nt of B){const ut=ee.getTile(nt),et=ut.getBucket(X);if(!et||!et.text||!et.text.segments.get().length)continue;const $e=c.ag(et.textSizeData,ge.zoom),wt=Qt(ut,1,G.transform.zoom),Nt=is(nt.posMatrix,We,Re,G.transform,wt),it=X.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if($e){const lt=Math.pow(2,ge.zoom-ut.tileID.overscaledZ),Ft=G.style.map.terrain?(Zt,$t)=>G.style.map.terrain.getElevation(nt,Zt,$t):null,ki=Se.translatePosition(ge,ut,ce,Y);oo(et,Re,We,fe,ge,Nt,nt.posMatrix,lt,$e,it,Se,ki,nt.toUnwrapped(),Ft)}}}(S,h,b,y,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),C),b.paint.get("icon-opacity").constantOr(1)!==0&&cu(h,y,b,S,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),M,z),b.paint.get("text-opacity").constantOr(1)!==0&&cu(h,y,b,S,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),M,z),y.map.showCollisionBoxes&&(sa(h,y,b,S,!0),sa(h,y,b,S,!1))})(e,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(h,y,b,S){if(h.renderPass!=="translucent")return;const C=b.paint.get("circle-opacity"),M=b.paint.get("circle-stroke-width"),z=b.paint.get("circle-stroke-opacity"),B=!b.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const G=h.context,X=G.gl,ee=h.depthModeForSublayer(0,Kt.ReadOnly),se=Ii.disabled,ae=h.colorModeForRenderPass(),ce=[];for(let Y=0;Y<S.length;Y++){const fe=S[Y],ge=y.getTile(fe),Se=ge.getBucket(b);if(!Se)continue;const Re=Se.programConfigurations.get(b.id),We=h.useProgram("circle",Re),nt=Se.layoutVertexBuffer,ut=Se.indexBuffer,et=h.style.map.terrain&&h.style.map.terrain.getTerrainData(fe),$e={programConfiguration:Re,program:We,layoutVertexBuffer:nt,indexBuffer:ut,uniformValues:p_(h,fe,ge,b),terrainData:et};if(B){const wt=Se.segments.get();for(const Nt of wt)ce.push({segments:new c.a0([Nt]),sortKey:Nt.sortKey,state:$e})}else ce.push({segments:Se.segments,sortKey:0,state:$e})}B&&ce.sort((Y,fe)=>Y.sortKey-fe.sortKey);for(const Y of ce){const{programConfiguration:fe,program:ge,layoutVertexBuffer:Se,indexBuffer:Re,uniformValues:We,terrainData:nt}=Y.state;ge.draw(G,X.TRIANGLES,ee,se,ae,_i.disabled,We,nt,b.id,Se,Re,Y.segments,b.paint,h.transform.zoom,fe)}})(e,n,a,l);break;case"heatmap":(function(h,y,b,S){if(b.paint.get("heatmap-opacity")===0)return;const C=h.context;if(h.style.map.terrain){for(const M of S){const z=y.getTile(M);y.hasRenderableParent(M)||(h.renderPass==="offscreen"?hu(h,z,b,M):h.renderPass==="translucent"&&Ms(h,b,M))}C.viewport.set([0,0,h.width,h.height])}else h.renderPass==="offscreen"?function(M,z,B,G){const X=M.context,ee=X.gl,se=Ii.disabled,ae=new Wi([ee.ONE,ee.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ce,Y,fe){const ge=ce.gl;ce.activeTexture.set(ge.TEXTURE1),ce.viewport.set([0,0,Y.width/4,Y.height/4]);let Se=fe.heatmapFbos.get(c.aU);Se?(ge.bindTexture(ge.TEXTURE_2D,Se.colorAttachment.get()),ce.bindFramebuffer.set(Se.framebuffer)):(Se=aa(ce,Y.width/4,Y.height/4),fe.heatmapFbos.set(c.aU,Se))})(X,M,B),X.clear({color:c.aM.transparent});for(let ce=0;ce<G.length;ce++){const Y=G[ce];if(z.hasRenderableParent(Y))continue;const fe=z.getTile(Y),ge=fe.getBucket(B);if(!ge)continue;const Se=ge.programConfigurations.get(B.id),Re=M.useProgram("heatmap",Se),{zoom:We}=M.transform;Re.draw(X,ee.TRIANGLES,Kt.disabled,se,ae,_i.disabled,jr(Y.posMatrix,fe,We,B.paint.get("heatmap-intensity")),null,B.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,B.paint,M.transform.zoom,Se)}X.viewport.set([0,0,M.width,M.height])}(h,y,b,S):h.renderPass==="translucent"&&function(M,z){const B=M.context,G=B.gl;B.setColorMode(M.colorModeForRenderPass());const X=z.heatmapFbos.get(c.aU);X&&(B.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,X.colorAttachment.get()),B.activeTexture.set(G.TEXTURE1),la(B,z).bind(G.LINEAR,G.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(B,G.TRIANGLES,Kt.disabled,Ii.disabled,M.colorModeForRenderPass(),_i.disabled,Wa(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(h,b)})(e,n,a,l);break;case"line":(function(h,y,b,S){if(h.renderPass!=="translucent")return;const C=b.paint.get("line-opacity"),M=b.paint.get("line-width");if(C.constantOr(1)===0||M.constantOr(1)===0)return;const z=h.depthModeForSublayer(0,Kt.ReadOnly),B=h.colorModeForRenderPass(),G=b.paint.get("line-dasharray"),X=b.paint.get("line-pattern"),ee=X.constantOr(1),se=b.paint.get("line-gradient"),ae=b.getCrossfadeParameters(),ce=ee?"linePattern":G?"lineSDF":se?"lineGradient":"line",Y=h.context,fe=Y.gl;let ge=!0;for(const Se of S){const Re=y.getTile(Se);if(ee&&!Re.patternsLoaded())continue;const We=Re.getBucket(b);if(!We)continue;const nt=We.programConfigurations.get(b.id),ut=h.context.program.get(),et=h.useProgram(ce,nt),$e=ge||et.program!==ut,wt=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Se),Nt=X.constantOr(null);if(Nt&&Re.imageAtlas){const Ft=Re.imageAtlas,ki=Ft.patternPositions[Nt.to.toString()],Zt=Ft.patternPositions[Nt.from.toString()];ki&&Zt&&nt.setConstantPatternPositions(ki,Zt)}const it=wt?Se:null,lt=ee?no(h,Re,b,ae,it):G?f_(h,Re,b,G,ae,it):se?Hp(h,Re,b,We.lineClipsArray.length,it):Ka(h,Re,b,it);if(ee)Y.activeTexture.set(fe.TEXTURE0),Re.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),nt.updatePaintBuffers(ae);else if(G&&($e||h.lineAtlas.dirty))Y.activeTexture.set(fe.TEXTURE0),h.lineAtlas.bind(Y);else if(se){const Ft=We.gradients[b.id];let ki=Ft.texture;if(b.gradientVersion!==Ft.version){let Zt=256;if(b.stepInterpolant){const $t=y.getSource().maxzoom,Mi=Se.canonical.z===$t?Math.ceil(1<<h.transform.maxZoom-Se.canonical.z):1;Zt=c.ac(c.aV(We.maxLineLength/c.X*1024*Mi),256,Y.maxTextureSize)}Ft.gradient=c.aW({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Zt,image:Ft.gradient||void 0,clips:We.lineClipsArray}),Ft.texture?Ft.texture.update(Ft.gradient):Ft.texture=new at(Y,Ft.gradient,fe.RGBA),Ft.version=b.gradientVersion,ki=Ft.texture}Y.activeTexture.set(fe.TEXTURE0),ki.bind(b.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}et.draw(Y,fe.TRIANGLES,z,h.stencilModeForClipping(Se),B,_i.disabled,lt,wt,b.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,b.paint,h.transform.zoom,nt,We.layoutVertexBuffer2),ge=!1}})(e,n,a,l);break;case"fill":(function(h,y,b,S){const C=b.paint.get("fill-color"),M=b.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=h.colorModeForRenderPass(),B=b.paint.get("fill-pattern"),G=h.opaquePassEnabledForLayer()&&!B.constantOr(1)&&C.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===G){const X=h.depthModeForSublayer(1,h.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly);ca(h,y,b,S,X,z,!1)}if(h.renderPass==="translucent"&&b.paint.get("fill-antialias")){const X=h.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly);ca(h,y,b,S,X,z,!0)}})(e,n,a,l);break;case"fill-extrusion":(function(h,y,b,S){const C=b.paint.get("fill-extrusion-opacity");if(C!==0&&h.renderPass==="translucent"){const M=new Kt(h.context.gl.LEQUAL,Kt.ReadWrite,h.depthRangeFor3D);if(C!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))il(h,y,b,S,M,Ii.disabled,Wi.disabled),il(h,y,b,S,M,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const z=h.colorModeForRenderPass();il(h,y,b,S,M,Ii.disabled,z)}}})(e,n,a,l);break;case"hillshade":(function(h,y,b,S){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const C=h.context,M=h.depthModeForSublayer(0,Kt.ReadOnly),z=h.colorModeForRenderPass(),[B,G]=h.renderPass==="translucent"?h.stencilConfigForOverlap(S):[{},S];for(const X of G){const ee=y.getTile(X);ee.needsHillshadePrepare!==void 0&&ee.needsHillshadePrepare&&h.renderPass==="offscreen"?co(h,ee,b,M,Ii.disabled,z):h.renderPass==="translucent"&&lo(h,X,ee,b,M,B[X.overscaledZ],z)}C.viewport.set([0,0,h.width,h.height])})(e,n,a,l);break;case"raster":(function(h,y,b,S){if(h.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!S.length)return;const C=h.context,M=C.gl,z=y.getSource(),B=h.useProgram("raster"),G=h.colorModeForRenderPass(),[X,ee]=z instanceof Br?[{},S]:h.stencilConfigForOverlap(S),se=ee[ee.length-1].overscaledZ,ae=!h.options.moving;for(const ce of ee){const Y=h.depthModeForSublayer(ce.overscaledZ-se,b.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,M.LESS),fe=y.getTile(ce);fe.registerFadeDuration(b.paint.get("raster-fade-duration"));const ge=y.findLoadedParent(ce,0),Se=y.findLoadedSibling(ce),Re=cf(fe,ge||Se||null,y,b,h.transform,h.style.map.terrain);let We,nt;const ut=b.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;C.activeTexture.set(M.TEXTURE0),fe.texture.bind(ut,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(M.TEXTURE1),ge?(ge.texture.bind(ut,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),We=Math.pow(2,ge.tileID.overscaledZ-fe.tileID.overscaledZ),nt=[fe.tileID.canonical.x*We%1,fe.tileID.canonical.y*We%1]):fe.texture.bind(ut,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&C.extTextureFilterAnisotropic&&h.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const et=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ce),$e=et?ce:null,wt=$e?$e.posMatrix:h.transform.calculatePosMatrix(ce.toUnwrapped(),ae),Nt=m_(wt,nt||[0,0],We||1,Re,b);z instanceof Br?B.draw(C,M.TRIANGLES,Y,Ii.disabled,G,_i.disabled,Nt,et,b.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments):B.draw(C,M.TRIANGLES,Y,X[ce.overscaledZ],G,_i.disabled,Nt,et,b.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}})(e,n,a,l);break;case"background":(function(h,y,b,S){const C=b.paint.get("background-color"),M=b.paint.get("background-opacity");if(M===0)return;const z=h.context,B=z.gl,G=h.transform,X=G.tileSize,ee=b.paint.get("background-pattern");if(h.isPatternMissing(ee))return;const se=!ee&&C.a===1&&M===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==se)return;const ae=Ii.disabled,ce=h.depthModeForSublayer(0,se==="opaque"?Kt.ReadWrite:Kt.ReadOnly),Y=h.colorModeForRenderPass(),fe=h.useProgram(ee?"backgroundPattern":"background"),ge=S||G.coveringTiles({tileSize:X,terrain:h.style.map.terrain});ee&&(z.activeTexture.set(B.TEXTURE0),h.imageManager.bind(h.context));const Se=b.getCrossfadeParameters();for(const Re of ge){const We=S?Re.posMatrix:h.transform.calculatePosMatrix(Re.toUnwrapped()),nt=ee?Qc(We,M,h,ee,{tileID:Re,tileSize:X},Se):Ja(We,M,C),ut=h.style.map.terrain&&h.style.map.terrain.getTerrainData(Re);fe.draw(z,B.TRIANGLES,ce,ae,Y,_i.disabled,nt,ut,b.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}})(e,0,a,l);break;case"custom":(function(h,y,b){const S=h.context,C=b.implementation;if(h.renderPass==="offscreen"){const M=C.prerender;M&&(h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),M.call(C,S.gl,h.transform.customLayerMatrix()),S.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),S.setColorMode(h.colorModeForRenderPass()),S.setStencilMode(Ii.disabled);const M=C.renderingMode==="3d"?new Kt(h.context.gl.LEQUAL,Kt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Kt.ReadOnly);S.setDepthMode(M),C.render(S.gl,h.transform.customLayerMatrix(),{farZ:h.transform.farZ,nearZ:h.transform.nearZ,fov:h.transform._fov,modelViewProjectionMatrix:h.transform.modelViewProjectionMatrix,projectionMatrix:h.transform.projectionMatrix}),S.setDirty(),h.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,l,h){if(!a[0]&&!a[1])return e;const y=h?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(y){const C=Math.sin(y),M=Math.cos(y);a=[a[0]*M-a[1]*C,a[0]*C+a[1]*M]}const b=[h?a[0]:Qt(n,a[0],this.transform.zoom),h?a[1]:Qt(n,a[1],this.transform.zoom),0],S=new Float32Array(16);return c.J(S,e,b),S}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Jc(this.context,rs[e],n,$c[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new at(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class ho{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const l=Math.pow(2,a),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=1/(b=c.af([],b,e))[3]/n*l;return c.b1(b,b,[S,S,1/b[3],S])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=function(B,G){var X=G[0],ee=G[1],se=G[2],ae=X*X+ee*ee+se*se;return ae>0&&(ae=1/Math.sqrt(ae)),B[0]=G[0]*ae,B[1]=G[1]*ae,B[2]=G[2]*ae,B}([],function(B,G,X){var ee=G[0],se=G[1],ae=G[2],ce=X[0],Y=X[1],fe=X[2];return B[0]=se*fe-ae*Y,B[1]=ae*ce-ee*fe,B[2]=ee*Y-se*ce,B}([],Je([],h[b[0]],h[b[1]]),Je([],h[b[2]],h[b[1]]))),C=-((M=S)[0]*(z=h[b[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(C)});return new ho(h,y)}}class po{constructor(e,n){this.min=e,this.max=n,this.center=function(a,l,h){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,h){return a[0]=l[0]+h[0],a[1]=l[1]+h[1],a[2]=l[2]+h[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=Me(this.min),l=Me(this.max);for(let h=0;h<n.length;h++)a[h]=n[h]?this.min[h]:this.center[h],l[h]=n[h]?this.center[h]:this.max[h];return l[2]=this.max[2],new po(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<e.planes.length;l++){const h=e.planes[l];let y=0;for(let b=0;b<n.length;b++)c.b2(h,n[b])>=0&&y++;if(y===0)return 0;y!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let h=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const S=e.points[b][l]-this.min[l];h=Math.min(h,S),y=Math.max(y,S)}if(y<0||h>this.max[l]-this.min[l])return 0}return 1}}class fo{constructor(e=0,n=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=l}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),l=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new fo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const pu=85.051129;class mo{constructor(e,n,a,l,h){this.tileSize=512,this._renderWorldCopies=h===void 0||!!h,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new mo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,h){var y=l[0],b=l[1],S=l[2],C=l[3],M=Math.sin(h),z=Math.cos(h);a[0]=y*z+S*M,a[1]=b*z+C*M,a[2]=y*-M+S*z,a[3]=b*-M+C*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),l=this.pointCoordinate(new c.P(this.width,0)),h=this.pointCoordinate(new c.P(this.width,this.height)),y=this.pointCoordinate(new c.P(0,this.height)),b=Math.floor(Math.min(a.x,l.x,h.x,y.x)),S=Math.floor(Math.max(a.x,l.x,h.x,y.x)),C=1;for(let M=b-C;M<=S+C;M++)M!==0&&n.push(new c.b4(M,e))}return n}coveringTiles(e){var n,a;let l=this.coveringZoomLevel(e);const h=l;if(e.minzoom!==void 0&&l<e.minzoom)return[];e.maxzoom!==void 0&&l>e.maxzoom&&(l=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),b=c.Z.fromLngLat(this.center),S=Math.pow(2,l),C=[S*y.x,S*y.y,0],M=[S*b.x,S*b.y,0],z=ho.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,l);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=l);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,X=Y=>({aabb:new po([Y*S,0,0],[(Y+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),ee=[],se=[],ae=l,ce=e.reparseOverscaled?h:l;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)ee.push(X(-Y)),ee.push(X(Y));for(ee.push(X(0));ee.length>0;){const Y=ee.pop(),fe=Y.x,ge=Y.y;let Se=Y.fullyVisible;if(!Se){const et=Y.aabb.intersects(z);if(et===0)continue;Se=et===2}const Re=e.terrain?C:M,We=Y.aabb.distanceX(Re),nt=Y.aabb.distanceY(Re),ut=Math.max(Math.abs(We),Math.abs(nt));if(Y.zoom===ae||ut>G+(1<<ae-Y.zoom)-2&&Y.zoom>=B){const et=ae-Y.zoom,$e=C[0]-.5-(fe<<et),wt=C[1]-.5-(ge<<et);se.push({tileID:new c.S(Y.zoom===ae?ce:Y.zoom,Y.wrap,Y.zoom,fe,ge),distanceSq:_t([M[0]-.5-fe,M[1]-.5-ge]),tileDistanceToCamera:Math.sqrt($e*$e+wt*wt)})}else for(let et=0;et<4;et++){const $e=(fe<<1)+et%2,wt=(ge<<1)+(et>>1),Nt=Y.zoom+1;let it=Y.aabb.quadrant(et);if(e.terrain){const lt=new c.S(Nt,Y.wrap,Nt,$e,wt),Ft=e.terrain.getMinMaxElevation(lt),ki=(n=Ft.minElevation)!==null&&n!==void 0?n:this.elevation,Zt=(a=Ft.maxElevation)!==null&&a!==void 0?a:this.elevation;it=new po([it.min[0],it.min[1],ki],[it.max[0],it.max[1],Zt])}ee.push({aabb:it,zoom:Nt,x:$e,y:wt,wrap:Y.wrap,fullyVisible:Se})}}return se.sort((Y,fe)=>Y.distanceSq-fe.distanceSq).map(Y=>Y.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,pu);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,e),h=e.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-h))return;const y=a+n-h,b=Math.cos(this._pitch)*this.cameraToCenterDistance/y/c.b5(1,l.lat),S=this.scaleZoom(b/this.tileSize);this._elevation=h,this._center=l,this.zoom=S}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),h=this.locationCoordinate(e),y=new c.Z(h.x-(a.x-l.x),h.y-(a.y-l.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const B=n.pointCoordinate(e);if(B!=null)return B}const a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(l,l,this.pixelMatrixInverse);const h=a[3],y=l[3],b=a[1]/h,S=l[1]/y,C=a[2]/h,M=l[2]/y,z=C===M?0:(0-C)/(M-C);return new c.Z(c.y.number(a[0]/h,l[0]/y,z)/this.worldSize,c.y.number(b,S,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(l,l,a),new c.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new we().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new we([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,pu])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),l=n.x+Math.pow(2,n.z)*e.wrap,h=c.an(new Float64Array(16));return c.J(h,h,[l*a,n.y*a,0]),c.K(h,h,[a/c.X,a/c.X,1]),h}calculatePosMatrix(e,n=!1){const a=e.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const h=this.calculateTileMatrix(e);return c.L(h,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,h),l[a]=new Float32Array(h),l[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const l=this.calculateTileMatrix(e);return c.L(l,this.fogMatrix,l),a[n]=new Float32Array(l),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const Y=179.9999999999;l=[-Y,Y]}const h=this.tileSize*this.zoomScale(a.zoom);let y=0,b=h,S=0,C=h,M=0,z=0;const{x:B,y:G}=this.size;if(this.latRange){const Y=this.latRange;y=c.Q(Y[1])*h,b=c.Q(Y[0])*h,b-y<G&&(M=G/(b-y))}l&&(S=c.b3(c.O(l[0])*h,0,h),C=c.b3(c.O(l[1])*h,0,h),C<S&&(C+=h),C-S<B&&(z=B/(C-S)));const{x:X,y:ee}=this.project.call({worldSize:h},e);let se,ae;const ce=Math.max(z||0,M||0);if(ce){const Y=new c.P(z?(C+S)/2:X,M?(b+y)/2:ee);return a.center=this.unproject.call({worldSize:h},Y).wrap(),a.zoom+=this.scaleZoom(ce),a}if(this.latRange){const Y=G/2;ee-Y<y&&(ae=y+Y),ee+Y>b&&(ae=b-Y)}if(l){const Y=(S+C)/2;let fe=X;this._renderWorldCopies&&(fe=c.b3(X,Y-h/2,Y+h/2));const ge=B/2;fe-ge<S&&(se=S+ge),fe+ge>C&&(se=C-ge)}if(se!==void 0||ae!==void 0){const Y=new c.P(se??X,ae??ee);a.center=this.unproject.call({worldSize:h},Y).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let l=c.an(new Float64Array(16));c.K(l,l,[this.width/2,-this.height/2,1]),c.J(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=c.an(new Float64Array(16)),c.K(l,l,[1,-1,1]),c.J(l,l,[-1,-1,0]),c.K(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const h=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),y=Math.min(this.elevation,this.minElevationForCurrentTile),b=h-y*this._pixelPerMeter/Math.cos(this._pitch),S=y<0?b:h,C=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(c.ac(Math.PI-C-M,.01,Math.PI-.01)),B=this.getHorizon(),G=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),X=Math.sin(G)*S/Math.sin(c.ac(Math.PI-C-G,.01,Math.PI-.01)),ee=Math.min(z,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ee+S),this.nearZ=this.height/50,l=new Float64Array(16),c.b6(l,this._fov,this.width/this.height,this.nearZ,this.farZ),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.projectionMatrix=c.ae(l),c.K(l,l,[1,-1,1]),c.J(l,l,[0,0,-this.cameraToCenterDistance]),c.b7(l,l,this._pitch),c.ad(l,l,this.angle),c.J(l,l,[-n,-a,0]),this.mercatorMatrix=c.K([],l,[this.worldSize,this.worldSize,this.worldSize]),c.K(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,l),c.J(l,l,[0,0,-this.elevation]),this.modelViewProjectionMatrix=l,this.invModelViewProjectionMatrix=c.as([],l),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,h,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,l);const se=this.width%2/2,ae=this.height%2/2,ce=Math.cos(this.angle),Y=Math.sin(this.angle),fe=n-Math.round(n)+ce*se+Y*ae,ge=a-Math.round(a)+ce*ae+Y*se,Se=new Float64Array(l);if(c.J(Se,Se,[fe>.5?fe-1:fe,ge>.5?ge-1:ge,0]),this.alignedModelViewProjectionMatrix=Se,l=c.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,l=n.y,h=n.x,y=n.y;for(const b of e)a=Math.min(a,b.x),l=Math.min(l,b.y),h=Math.max(h,b.x),y=Math.max(y,b.y);return[new c.P(a,l),new c.P(h,l),new c.P(h,y),new c.P(a,y),new c.P(a,l)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(l,l,this.modelViewProjectionMatrix),l[2]/l[3]}}function ua(d,e){let n,a=!1,l=null,h=null;const y=()=>{l=null,a&&(d.apply(h,n),l=setTimeout(y,e),a=!1)};return(...b)=>(a=!0,h=this,n=b,l||y(),l)}class al{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let h=window.location.hash.replace(l,"");h.startsWith("#&")?h=h.slice(0,1)+h.slice(2):h==="#"&&(h="");let y=window.location.href.replace(/(#.+)?$/,h);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=ua(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),h=Math.pow(10,l),y=Math.round(n.lng*h)/h,b=Math.round(n.lat*h)/h,S=this._map.getBearing(),C=this._map.getPitch();let M="";if(M+=e?`/${y}/${b}/${a}`:`${a}/${b}/${y}`,(S||C)&&(M+="/"+Math.round(10*S)/10),C&&(M+=`/${Math.round(C)}`),this._hashName){const z=this._hashName;let B=!1;const G=window.location.hash.slice(1).split("&").map(X=>{const ee=X.split("=")[0];return ee===z?(B=!0,`${ee}=${M}`):X}).filter(X=>X);return B||G.push(`${z}=${M}`),`#${G.join("&")}`}return`#${M}`}}const ll={linearity:.3,easing:c.b8(0,0,.3,1)},fu=c.e({deceleration:2500,maxSpeed:1400},ll),C_=c.e({deceleration:20,maxSpeed:1400},ll),ff=c.e({deceleration:1e3,maxSpeed:360},ll),cl=c.e({deceleration:1e3,maxSpeed:90},ll);class mu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:V.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=V.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:h}of this._inertiaBuffer)n.zoom+=h.zoomDelta||0,n.bearing+=h.bearingDelta||0,n.pitch+=h.pitchDelta||0,h.panDelta&&n.pan._add(h.panDelta),h.around&&(n.around=h.around),h.pinchAround&&(n.pinchAround=h.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const h=da(n.pan.mag(),a,c.e({},fu,e||{}));l.offset=n.pan.mult(h.amount/n.pan.mag()),l.center=this._map.transform.center,ha(l,h)}if(n.zoom){const h=da(n.zoom,a,C_);l.zoom=this._map.transform.zoom+h.amount,ha(l,h)}if(n.bearing){const h=da(n.bearing,a,ff);l.bearing=this._map.transform.bearing+c.ac(h.amount,-179,179),ha(l,h)}if(n.pitch){const h=da(n.pitch,a,cl);l.pitch=this._map.transform.pitch+h.amount,ha(l,h)}if(l.zoom||l.bearing){const h=n.pinchAround===void 0?n.around:n.pinchAround;l.around=h?this._map.unproject(h):this._map.getCenter()}return this.clear(),c.e(l,{noMoveStart:!0})}}function ha(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function da(d,e,n){const{maxSpeed:a,linearity:l,deceleration:h}=n,y=c.ac(d*l/(e/1e3),-a,a),b=Math.abs(y)/(h*l);return{easing:n.easing,duration:1e3*b,amount:y*(b/2)}}class _r extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,l={}){const h=N.mousePos(n.getCanvas(),a),y=n.unproject(h);super(e,c.e({point:h,lngLat:y,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class zs extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const l=e==="touchend"?a.changedTouches:a.touches,h=N.touchPos(n.getCanvasContainer(),l),y=h.map(S=>n.unproject(S)),b=h.reduce((S,C,M,z)=>S.add(C.div(z.length)),new c.P(0,0));super(e,{points:h,point:b,lngLats:y,lngLat:n.unproject(b),originalEvent:a}),this._defaultPrevented=!1}}class mf extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class gf{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new mf(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new _r(e.type,this._map,e))}mouseup(e){this._map.fire(new _r(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new _r(e.type,this._map,e))}dblclick(e){return this._firePreventable(new _r(e.type,this._map,e))}mouseover(e){this._map.fire(new _r(e.type,this._map,e))}mouseout(e){this._map.fire(new _r(e.type,this._map,e))}touchstart(e){return this._firePreventable(new zs(e.type,this._map,e))}touchmove(e){this._map.fire(new zs(e.type,this._map,e))}touchend(e){this._map.fire(new zs(e.type,this._map,e))}touchcancel(e){this._map.fire(new zs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new _r(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new _r("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new _r(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class $r{constructor(e,n){this._map=e,this._tr=new yn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(N.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=N.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const h=Math.min(l.x,a.x),y=Math.max(l.x,a.x),b=Math.min(l.y,a.y),S=Math.max(l.y,a.y);N.setTransform(this._box,`translate(${h}px,${b}px)`),this._box.style.width=y-h+"px",this._box.style.height=S-b+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,l=n;if(this.reset(),N.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:h=>h.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function pa(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const n={};for(let a=0;a<d.length;a++)n[d[a].identifier]=e[a];return n}class gu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const h=new c.P(0,0);for(const y of l)h._add(y);return h.div(l.length)}(n),this.touches=pa(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const l=pa(a,n);for(const h in this.touches){const y=l[h];(!y||y.dist(this.touches[h])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class ul{constructor(e){this.singleTap=new gu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const l=this.singleTap.touchend(e,n,a);if(l){const h=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(l)<30;if(h&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class go{constructor(e){this._tr=new yn(e),this._zoomIn=new ul({numTouches:1,numTaps:2}),this._zoomOut=new ul({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const l=this._zoomIn.touchend(e,n,a),h=this._zoomOut.touchend(e,n,a),y=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(l)},{originalEvent:e})}):h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(h)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&N.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _u={0:1,2:2};class hl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=N.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const l=_u[a];return n.buttons===void 0||(n.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return N.mouseButton(e)===this._eventButton}}class yu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const dl=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}},vu=({enable:d,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new hl({checkCorrectEvent:l=>N.mouseButton(l)===0&&l.ctrlKey||N.mouseButton(l)===2});return new Hn({clickTolerance:e,move:(l,h)=>({bearingDelta:(h.x-l.x)*n}),moveStateManager:a,enable:d,assignEvents:dl})},xu=({enable:d,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new hl({checkCorrectEvent:l=>N.mouseButton(l)===0&&l.ctrlKey||N.mouseButton(l)===2});return new Hn({clickTolerance:e,move:(l,h)=>({pitchDelta:(h.y-l.y)*n}),moveStateManager:a,enable:d,assignEvents:dl})};class Ds{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const l=pa(a,n),h=new c.P(0,0),y=new c.P(0,0);let b=0;for(const C in l){const M=l[C],z=this._touches[C];z&&(h._add(M),y._add(M.sub(z)),b++,l[C]=M)}if(this._touches=l,this._shouldBePrevented(b)||!y.mag())return;const S=y.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:h.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,h]=this._firstTwoTouches,y=fa(a,n,l),b=fa(a,n,h);if(!y||!b)return;const S=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],S,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[l,h]=this._firstTwoTouches,y=fa(a,n,l),b=fa(a,n,h);y&&b||(this._active&&N.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function fa(d,e,n){for(let a=0;a<d.length;a++)if(d[a].identifier===n)return e[a]}function bu(d,e){return Math.log(d/e)/Math.LN2}class wu extends pl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(bu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bu(this._distance,a),pinchAround:n}}}function Su(d,e){return 180*d.angleWith(e)/Math.PI}class Pu extends pl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Su(this._vector,l),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Su(e,this._startVector);return Math.abs(a)<n}}function fl(d){return Math.abs(d.y)>Math.abs(d.x)}class _o extends pl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,fl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),h=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,h,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+h.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,h=n.mag()>=2;if(!l&&!h)return;if(!l||!h)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return fl(e)&&fl(n)&&y}}const _f={panStep:100,bearingStep:15,pitchStep:10};class an{constructor(e){this._tr=new yn(e);const n=_f;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,l=0,h=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),h=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),h=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:On,zoom:n?Math.round(S.zoom)+n*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+l*this._pitchStep,offset:[-h*this._panStep,-y*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function On(d){return d*(2-d)}const Tu=4.000244140625;class vn{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new yn(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=V.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%Tu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=N.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Tu?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&C!==0&&(C=1/C);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,l=this._easing;let h,y=!1;const b=V.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&l&&b){const S=Math.min(b/200,1),C=l(S);h=c.y.number(a,n,C),S<1?this._frameId||(this._frameId=!0):y=!0}else h=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:h-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,l=(V.now()-a.start)/a.duration,h=a.easing(l+.01)-a.easing(l),y=.27/Math.sqrt(h*h+1e-4)*.01,b=Math.sqrt(.0729-y*y);n=c.b8(y,b,.25,1)}return this._prevEase={start:V.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Rs{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class E_{constructor(e){this._tr=new yn(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class k_{constructor(){this._tap=new ul({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],h=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(l)<30;h&&y?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],h=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:h/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,n,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yf{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vf{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Iu{constructor(e,n,a,l){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class yo{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=N.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const h=document.createElement("div");h.className="maplibregl-mobile-message",h.textContent=a,this._container.appendChild(h),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(N.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ln=d=>d.zoom||d.drag||d.pitch||d.rotate;class pt extends c.k{}function ml(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Au{constructor(e,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,h)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=l.type==="renderFrame"?void 0:l,b={needsRenderFrame:!1},S={},C={},M=l.touches,z=M?this._getMapTouches(M):void 0,B=z?N.touchPos(this._map.getCanvas(),z):N.mousePos(this._map.getCanvas(),l);for(const{handlerName:ee,handler:se,allowed:ae}of this._handlers){if(!se.isEnabled())continue;let ce;this._blockedByActive(C,ae,ee)?se.reset():se[h||l.type]&&(ce=se[h||l.type](l,B,z),this.mergeHandlerResult(b,S,ce,ee,y),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||se.isActive())&&(C[ee]=se)}const G={};for(const ee in this._previousActiveHandlers)C[ee]||(G[ee]=y);this._previousActiveHandlers=C,(Object.keys(G).length||ml(b))&&(this._changes.push([b,S,G]),this._triggerRenderFrame()),(Object.keys(C).length||ml(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=b;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new mu(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,h,y]of this._listeners)N.addEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,a]of this._listeners)N.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new gf(n,e));const l=n.boxZoom=new $r(n,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const h=n.cooperativeGestures=new yo(n,e.cooperativeGestures);this._add("cooperativeGestures",h),e.cooperativeGestures&&h.enable();const y=new go(n),b=new E_(n);n.doubleClickZoom=new Rs(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const S=new k_;this._add("tapDragZoom",S);const C=n.touchPitch=new _o(n);this._add("touchPitch",C),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const M=vu(e),z=xu(e);n.dragRotate=new vf(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const B=(({enable:ce,clickTolerance:Y})=>{const fe=new hl({checkCorrectEvent:ge=>N.mouseButton(ge)===0&&!ge.ctrlKey});return new Hn({clickTolerance:Y,move:(ge,Se)=>({around:Se,panDelta:Se.sub(ge)}),activateOnStart:!0,moveStateManager:fe,enable:ce,assignEvents:dl})})(e),G=new Ds(e,n);n.dragPan=new yf(a,B,G),this._add("mousePan",B),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const X=new Pu,ee=new wu;n.touchZoomRotate=new Iu(a,ee,X,S),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const se=n.scrollZoom=new vn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const ae=n.keyboard=new an(n);this._add("keyboard",ae),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Xi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ln(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const l in e)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,l,h){if(!a)return;c.e(e,a);const y={handlerName:l,originalEvent:a.originalEvent||h};a.zoomDelta!==void 0&&(n.zoom=y),a.panDelta!==void 0&&(n.drag=y),a.pitchDelta!==void 0&&(n.pitch=y),a.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},a={};for(const[l,h,y]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),c.e(n,h),c.e(a,y);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const l=this._map,h=l._getTransformForUpdate(),y=l.terrain;if(!(ml(e)||y&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:b,zoomDelta:S,bearingDelta:C,pitchDelta:M,around:z,pinchAround:B}=e;B!==void 0&&(z=B),l._stop(!0),z=z||l.transform.centerPoint;const G=h.pointLocation(b?z.sub(b):z);C&&(h.bearing+=C),M&&(h.pitch+=M),S&&(h.zoom+=S),y?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?h.center=h.pointLocation(h.centerPoint.sub(b)):h.setLocationAtPoint(G,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,h.setLocationAtPoint(G,z)):h.setLocationAtPoint(G,z),l._applyUpdatedTransform(h),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const l=ln(this._eventsInProgress),h=ln(e),y={};for(const z in e){const{originalEvent:B}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=B),this._eventsInProgress[z]=e[z]}!l&&h&&this._fireEvent("movestart",h.originalEvent);for(const z in y)this._fireEvent(z,y[z]);h&&this._fireEvent("move",h.originalEvent);for(const z in e){const{originalEvent:B}=e[z];this._fireEvent(z,B)}const b={};let S;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],S=n[B]||G,b[`${z}end`]=S)}for(const z in b)this._fireEvent(z,b[z]);const C=ln(this._eventsInProgress),M=(l||h)&&!C;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!z||!z.essential&&V.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:S})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new pt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xf extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((V.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=we.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,l){const h={top:0,bottom:0,right:0,left:0};if(typeof(l=c.e({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const et=l.padding;l.padding={top:et,bottom:et,right:et,left:et}}l.padding=c.e(h,l.padding);const y=this.transform,b=y.padding,S=new we(e,n),C=y.project(S.getNorthWest()),M=y.project(S.getNorthEast()),z=y.project(S.getSouthEast()),B=y.project(S.getSouthWest()),G=c.ba(-a),X=C.rotate(G),ee=M.rotate(G),se=z.rotate(G),ae=B.rotate(G),ce=new c.P(Math.max(X.x,ee.x,ae.x,se.x),Math.max(X.y,ee.y,ae.y,se.y)),Y=new c.P(Math.min(X.x,ee.x,ae.x,se.x),Math.min(X.y,ee.y,ae.y,se.y)),fe=ce.sub(Y),ge=(y.width-(b.left+b.right+l.padding.left+l.padding.right))/fe.x,Se=(y.height-(b.top+b.bottom+l.padding.top+l.padding.bottom))/fe.y;if(Se<0||ge<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Re=Math.min(y.scaleZoom(y.scale*Math.min(ge,Se)),l.maxZoom),We=c.P.convert(l.offset),nt=new c.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(c.ba(a)),ut=We.add(nt).mult(y.scale/y.zoomScale(Re));return{center:y.unproject(C.add(z).div(2).sub(ut)),zoom:Re,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,l,h){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,l),l,h)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let l=!1,h=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(l=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(h=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),l&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),h&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),y&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,l=0){const h=c.Z.fromLngLat(e,n),y=c.Z.fromLngLat(a,l),b=y.x-h.x,S=y.y-h.y,C=y.z-h.z,M=Math.hypot(b,S,C);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),G=180*Math.atan2(b,-S)/Math.PI;let X=180*Math.acos(z/M)/Math.PI;return X=C<0?90-X:90+X,{center:y.toLngLat(),zoom:B,pitch:X,bearing:G}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&V.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let G=l.centerPoint.add(B);const X=l.pointLocation(G),{center:ee,zoom:se}=l.getConstrained(c.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(ee,l);const ae=l.project(X),ce=l.project(ee).sub(ae),Y=l.zoomScale(se-h);let fe,ge;e.around&&(fe=c.N.convert(e.around),ge=l.locationPoint(fe));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==h,this._rotating=this._rotating||y!==C,this._pitching=this._pitching||M!==b,this._padding=!l.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,Se),this.terrain&&this._prepareElevation(ee),this._ease(Re=>{if(this._zooming&&(l.zoom=c.y.number(h,se,Re)),this._rotating&&(l.bearing=c.y.number(y,C,Re)),this._pitching&&(l.pitch=c.y.number(b,M,Re)),this._padding&&(l.interpolatePadding(S,z,Re),G=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Re),fe)l.setLocationAtPoint(fe,ge);else{const We=l.zoomScale(l.zoom-h),nt=se>h?Math.min(2,Y):Math.max(.5,Y),ut=Math.pow(nt,1-Re),et=l.unproject(ae.add(ce.mult(Re*ut)).mult(We));l.setLocationAtPoint(l.renderWorldCopies?et.wrap():et,G)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},Re=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Re)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const l=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:l.pitch,zoom:l.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&n.push(l=>this.transformCameraUpdate(l)),!n.length)return;const a=e.clone();for(const l of n){const h=a.clone(),{center:y,zoom:b,pitch:S,bearing:C,elevation:M}=l(h);y&&(h.center=y),b!==void 0&&(h.zoom=b),S!==void 0&&(h.pitch=S),C!==void 0&&(h.bearing=C),M!==void 0&&(h.elevation=M),a.apply(h)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,h=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),l&&this.fire(new c.k("rotateend",e)),h&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&V.prefersReducedMotion){const lt=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(lt,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const l=this._getTransformForUpdate(),h=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,C="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let G=l.centerPoint.add(B);const X=l.pointLocation(G),{center:ee,zoom:se}=l.getConstrained(c.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:h);this._normalizeCenter(ee,l);const ae=l.zoomScale(se-h),ce=l.project(X),Y=l.project(ee).sub(ce);let fe=e.curve;const ge=Math.max(l.width,l.height),Se=ge/ae,Re=Y.mag();if("minZoom"in e){const lt=c.ac(Math.min(e.minZoom,h,se),l.minZoom,l.maxZoom),Ft=ge/l.zoomScale(lt-h);fe=Math.sqrt(Ft/Re*2)}const We=fe*fe;function nt(lt){const Ft=(Se*Se-ge*ge+(lt?-1:1)*We*We*Re*Re)/(2*(lt?Se:ge)*We*Re);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function ut(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function et(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const $e=nt(!1);let wt=function(lt){return et($e)/et($e+fe*lt)},Nt=function(lt){return ge*((et($e)*(ut(Ft=$e+fe*lt)/et(Ft))-ut($e))/We)/Re;var Ft},it=(nt(!0)-$e)/fe;if(Math.abs(Re)<1e-6||!isFinite(it)){if(Math.abs(ge-Se)<1e-6)return this.easeTo(e,n);const lt=Se<ge?-1:1;it=Math.abs(Math.log(Se/ge))/fe,Nt=()=>0,wt=Ft=>Math.exp(lt*fe*Ft)}return e.duration="duration"in e?+e.duration:1e3*it/("screenSpeed"in e?+e.screenSpeed/fe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=y!==C,this._pitching=M!==b,this._padding=!l.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ee),this._ease(lt=>{const Ft=lt*it,ki=1/wt(Ft);l.zoom=lt===1?se:h+l.scaleZoom(ki),this._rotating&&(l.bearing=c.y.number(y,C,lt)),this._pitching&&(l.pitch=c.y.number(b,M,lt)),this._padding&&(l.interpolatePadding(S,z,lt),G=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(lt);const Zt=lt===1?ee:l.unproject(ce.add(Y.mult(Nt(Ft))).mult(ki));l.setLocationAtPoint(l.renderWorldCopies?Zt.wrap():Zt,G),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=V.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const vo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xo{constructor(e=vo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=N.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=N.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const h=n[l];if(h.used||h.usedForTerrain){const y=h.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,h)=>l.length-h.length),e=e.filter((l,h)=>{for(let y=h+1;y<e.length;y++)if(e[y].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Cu{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=N.create("div","maplibregl-ctrl");const n=N.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){N.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Eu=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class M_ extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const l of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),c.aP(l.posMatrix,0,c.X,0,c.X,0,1),this._tiles[l.key]=new ts(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16),c.aP(h.posMatrix,0,c.X,0,c.X,0,1),n[a]=h}else if(l.canonical.isChildOf(e.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=l.canonical.z-e.canonical.z,b=l.canonical.x-(l.canonical.x>>y<<y),S=l.canonical.y-(l.canonical.y>>y<<y),C=c.X>>y;c.aP(h.posMatrix,0,C,0,C,0,1),c.J(h.posMatrix,h.posMatrix,[-b*C,-S*C,0]),n[a]=h}else if(e.canonical.isChildOf(l.canonical)){const h=e.clone();h.posMatrix=new Float64Array(16);const y=e.canonical.z-l.canonical.z,b=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),C=c.X>>y;c.aP(h.posMatrix,0,c.X,0,c.X,0,1),c.J(h.posMatrix,h.posMatrix,[b*C,S*C,0]),c.K(h.posMatrix,h.posMatrix,[1/2**y,1/2**y,0]),n[a]=h}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let h=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!h||!h.dem)&&n)for(;l>=a.minzoom&&(!h||!h.dem);)h=this.sourceCache.getTileByID(e.scaledTo(l--).key);return h}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class ku{constructor(e,n,a){this.painter=e,this.sourceCache=new M_(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,l=c.X){var h;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const y=this.getTerrainData(e),b=(h=y.tile)===null||h===void 0?void 0:h.dem;if(!b)return 0;const S=function(X,ee,se){var ae=ee[0],ce=ee[1];return X[0]=se[0]*ae+se[4]*ce+se[12],X[1]=se[1]*ae+se[5]*ce+se[13],X}([],[n/l*c.X,a/l*c.X],y.u_terrain_matrix),C=[S[0]*b.dim,S[1]*b.dim],M=Math.floor(C[0]),z=Math.floor(C[1]),B=C[0]-M,G=C[1]-z;return b.get(M,z)*(1-B)*(1-G)+b.get(M+1,z)*B*(1-G)+b.get(M,z+1)*(1-B)*G+b.get(M+1,z+1)*B*G}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,l%c.X,h%c.X,c.X)}getElevation(e,n,a,l=c.X){return this.getDEMElevation(e,n,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,h=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new at(l,h,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new at(l,new c.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new at(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let h=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?h=e.canonical.z-l:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>h<<h),b=e.canonical.y-(e.canonical.y>>h<<h),S=c.bc(new Float64Array(16),[1/(c.X<<h),1/(c.X<<h),0]);c.J(S,S,[y*c.X,b*c.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new at(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new at(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let h=0,y=0;h<this._coordsTextureSize;h++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)n[y+0]=255&b,n[y+1]=255&h,n[y+2]=b>>8<<4|h>>8,n[y+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new at(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,l=a.gl,h=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(h,b-y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const S=n[0]+(n[2]>>4<<8),C=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const B=this._coordsTextureSize,G=(1<<z.tileID.canonical.z)*B;return new c.Z((z.tileID.canonical.x*B+S)/G+z.tileID.wrap,(z.tileID.canonical.y*B+C)/G,this.getElevation(z.tileID,S,C,B))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,l=this.meshSize,h=c.X/l,y=l*l;for(let z=0;z<=l;z++)for(let B=0;B<=l;B++)n.emplaceBack(B*h,z*h,0);for(let z=0;z<y;z+=l+1)for(let B=0;B<l;B++)a.emplaceBack(B+z,l+B+z+1,l+B+z+2),a.emplaceBack(B+z,l+B+z+2,B+z+1);const b=n.length,S=b+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const G of[0,1])n.emplaceBack(B*h,z*c.X,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(b+z,b+z+3,b+z+1),a.emplaceBack(b+z,b+z+2,b+z+3);const C=n.length,M=C+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const G of[0,1])n.emplaceBack(z*c.X,B*h,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(C+z,C+z+1,C+z+3),a.emplaceBack(C+z,C+z+3,C+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new sl(e.createVertexBuffer(n,Eu.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),l=(1<<n)*c.X,h=a.x*l,y=a.y*l,b=Math.floor(h/c.X),S=Math.floor(y/c.X);return{tileID:new c.S(n,0,n,b,S),mercatorX:h,mercatorY:y}}}class z_{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new at(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const bo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class bf{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new z_(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const h of l){const y=this.terrain.sourceCache.getTerrainCoords(h);for(const b in y)this._coordsDescendingInv[a][b]||(this._coordsDescendingInv[a][b]=[]),this._coordsDescendingInv[a][b].push(y[b])}}this._coordsDescendingInvStr={};for(const a of e._order){const l=e._layers[a],h=l.source;if(bo[l.type]&&!this._coordsDescendingInvStr[h]){this._coordsDescendingInvStr[h]={};for(const y in this._coordsDescendingInv[h])this._coordsDescendingInvStr[h][y]=this._coordsDescendingInv[h][y].map(b=>b.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const h=this._coordsDescendingInvStr[l][a.tileID.key];h&&h!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(bo[n]&&(this._prevType&&bo[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!l))return!0;if(bo[this._prevType]||bo[n]&&l){this._prevType=n;const h=this._stacks.length-1,y=this._stacks[h]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(pf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[h]){const C=this.pool.getObjectForId(b.rtt[h].id);if(C.stamp===b.rtt[h].stamp){this.pool.useObject(C);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),b.rtt[h]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let C=0;C<y.length;C++){const M=a.style._layers[y[C]],z=M.source?this._coordsDescendingInv[M.source][b.tileID.key]:[b.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(b.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][b.tileID.key])}}return pf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),bo[n]}return!1}}const Mu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},wf=U,D_={hash:!1,interactive:!0,bearingSnap:7,attributionControl:vo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},zu=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},R_={showCompass:!0,showZoom:!0,visualizePitch:!1};class L_{constructor(e,n,a=!1){this.mousedown=y=>{this.startMouse(c.e({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),N.mousePos(this.element,y)),N.addEventListener(window,"mousemove",this.mousemove),N.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.moveMouse(y,N.mousePos(this.element,y))},this.mouseup=y=>{this.mouseRotate.dragEnd(y),this.mousePitch&&this.mousePitch.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,y.targetTouches)[0],this.startTouch(y,this._startPos),N.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,y.targetTouches)[0],this.moveTouch(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=e.dragRotate._mouseRotate.getClickTolerance(),h=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=vu({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:y,clickTolerance:b,bearingDegreesPerPixelMoved:S=.8})=>{const C=new yu;return new Hn({clickTolerance:b,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:C,enable:y,assignEvents:zu})})({clickTolerance:l,enable:!0}),this.map=e,a&&(this.mousePitch=xu({clickTolerance:h,enable:!0}),this.touchPitch=(({enable:y,clickTolerance:b,pitchDegreesPerPixelMoved:S=-.5})=>{const C=new yu;return new Hn({clickTolerance:b,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:C,enable:y,assignEvents:zu})})({clickTolerance:h,enable:!0})),N.addEventListener(n,"mousedown",this.mousedown),N.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),N.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),N.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:h}=this.mousePitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}moveTouch(e,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:h}=this.touchPitch.dragMove(e,n)||{};h&&a.setPitch(a.getPitch()+h)}}off(){const e=this.element;N.removeEventListener(e,"mousedown",this.mousedown),N.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend),N.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){N.enableDrag(),N.removeEventListener(window,"mousemove",this.mousemove),N.removeEventListener(window,"mouseup",this.mouseup),N.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),N.removeEventListener(window,"touchend",this.touchend)}}let en;function Ei(d,e,n){const a=new c.N(d.lng,d.lat);if(d=new c.N(d.lng,d.lat),e){const l=new c.N(d.lng-360,d.lat),h=new c.N(d.lng+360,d.lat),y=n.locationPoint(d).distSqr(e);n.locationPoint(l).distSqr(e)<y?d=l:n.locationPoint(h).distSqr(e)<y&&(d=h)}for(;Math.abs(d.lng-n.center.lng)>180;){const l=n.locationPoint(d);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==a.lng&&n.locationPoint(d).y>n.height/2-n.getHorizon()?d:a}const wo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gl(d,e,n){const a=d.classList;for(const l in wo)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${e}`)}class _l extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ei(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,`${wo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${h}`),V.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div");const n=N.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const h=N.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");const y=N.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=N.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of S){const ce=N.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",ae.rx),ce.setAttributeNS(null,"ry",ae.ry),b.appendChild(ce)}const C=N.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const M=N.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(M);const z=N.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const B=N.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(B);const G=N.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const X=N.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=N.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const se=N.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),X.appendChild(ee),X.appendChild(se),y.appendChild(b),y.appendChild(C),y.appendChild(z),y.appendChild(G),y.appendChild(X),n.appendChild(y),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),gl(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,h=l.terrain.depthAtPoint(this._pos),y=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,y)-h<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/l.transform._pixelPerMeter,S=Math.sin(l.getPitch()*Math.PI/180)*b,C=l.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=l.transform.lngLatToCameraDepth(this._lngLat,y+S)-C>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Sf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,ga=!1;const Fn={maxWidth:100,unit:"metric"};function _a(d,e,n){const a=n&&n.maxWidth||100,l=d._container.clientHeight/2,h=d.unproject([0,l]),y=d.unproject([a,l]),b=h.distanceTo(y);if(n&&n.unit==="imperial"){const S=3.2808*b;S>5280?bt(e,a,S/5280,d._getUIString("ScaleControl.Miles")):bt(e,a,S,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?bt(e,a,b/1852,d._getUIString("ScaleControl.NauticalMiles")):b>=1e3?bt(e,a,b/1e3,d._getUIString("ScaleControl.Kilometers")):bt(e,a,b,d._getUIString("ScaleControl.Meters"))}function bt(d,e,n,a){const l=function(h){const y=Math.pow(10,`${Math.floor(h)}`.length-1);let b=h/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(b),y*b}(n);d.style.width=e*(l/n)+"px",d.innerHTML=`${l}&nbsp;${a}`}const Dt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vl(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){const e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return vl(new c.P(0,0))}const Du=U;w.AJAXError=c.bh,w.Evented=c.E,w.LngLat=c.N,w.MercatorCoordinate=c.Z,w.Point=c.P,w.addProtocol=c.bi,w.config=c.a,w.removeProtocol=c.bj,w.AttributionControl=xo,w.BoxZoomHandler=$r,w.CanvasSource=Ar,w.CooperativeGesturesHandler=yo,w.DoubleClickZoomHandler=Rs,w.DragPanHandler=yf,w.DragRotateHandler=vf,w.EdgeInsets=fo,w.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){N.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=N.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);N.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=kn,w.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),h=c.e({bearing:l},this.options.fitBoundsOptions),y=we.fromLngLat(n,a);this._map.fitBounds(y,h,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&ga)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=N.create("button","maplibregl-ctrl-geolocate",this._container),N.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _l({element:this._dotElement}),this._circleElement=N.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _l({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},Sf,d)}onAdd(d){return this._map=d,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(en!==void 0&&!e)return en;if(window.navigator.permissions===void 0)return en=!!window.navigator.geolocation,en;try{en=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{en=!!window.navigator.geolocation}return en})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,ga=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),a=e.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,ga=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(d={maximumAge:6e5,timeout:0},ga=!0):(d=this.options.positionOptions,ga=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=al,w.ImageSource=Br,w.KeyboardHandler=an,w.LngLatBounds=we,w.LogoControl=Cu,w.Map=class extends xf{constructor(d){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},D_),d);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new mo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ti,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Mu),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ae.addThrottleControl(()=>this.isMoving()),this._requestManager=new ze(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=ua(l=>{this._trackResize&&!this._removed&&(this.resize(l),this.redraw())},50);this._resizeObserver=new ResizeObserver(l=>{n?a(l):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Au(this,e),this._hash=e.hash&&new al(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new xo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Cu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,a)}resize(d){var e;const n=this._containerDimensions(),a=n[0],l=n[1],h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const S=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,S),this.painter.resize(a,l,S)}this.transform.resize(a,l),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l);const y=!this._moving;return y&&(this.stop(),this.fire(new c.k("movestart",d)).fire(new c.k("move",d))),this.fire(new c.k("resize",d)),y&&this.fire(new c.k("moveend",d)),this}_getClampedPixelRatio(d,e){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),h=d*l,y=e*l;return Math.min(h>n?n/h:1,y>a?a/y:1)*l}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(we.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}project(d){return this.transform.locationPoint(c.N.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:h=>{const y=e.filter(S=>this.getLayer(S)),b=y.length!==0?this.queryRenderedFeatures(h.point,{layers:y}):[];b.length?a||(a=!0,n.call(this,new _r(d,this,h.originalEvent,{features:b}))):a=!1},mouseout:()=>{a=!1}}}}if(d==="mouseleave"||d==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const b=e.filter(S=>this.getLayer(S));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?a=!0:a&&(a=!1,n.call(this,new _r(d,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,n.call(this,new _r(d,this,y.originalEvent)))}}}}{const a=l=>{const h=e.filter(b=>this.getLayer(b)),y=h.length!==0?this.queryRenderedFeatures(l.point,{layers:h}):[];y.length&&(l.features=y,n.call(this,l),delete l.features)};return{layers:e,listener:n,delegates:{[d]:a}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const a=this._delegatedListeners[d];for(let l=0;l<a.length;l++){const h=a[l];if(h.listener===n&&h.layers.length===e.length&&h.layers.every(y=>e.includes(y))){for(const y in h.delegates)this.off(y,h.delegates[y]);return void a.splice(l,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);const a=this._createDelegatedListener(d,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(d,a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(d,e,n){if(n===void 0)return super.once(d,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(d,a,n);for(const h in l.delegates){const y=l.delegates[h];l.delegates[h]=(...b)=>{this._removeDelegatedListener(d,a,n),y(...b)}}this._saveDelegatedListener(d,l);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n;const a=d instanceof c.P||Array.isArray(d),l=a?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:d)||{},l instanceof c.P||typeof l[0]=="number")n=[c.P.convert(l)];else{const h=c.P.convert(l[0]),y=c.P.convert(l[1]);n=[h,new c.P(y.x,h.y),y,new c.P(h.x,y.y),h]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Za(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,n):this.style.loadJSON(d,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Za(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ku(this.painter,e,d),this.painter.renderToTexture=new bf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const n=d[e]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,e,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:C}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:B}=e,G=e;return this.style.addImage(d,{data:new c.R({width:M,height:z},new Uint8Array(B)),pixelRatio:a,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:C,sdf:l,version:0,userImage:G}),G.onAdd&&G.onAdd(this,d),this}}{const{width:M,height:z,data:B}=V.getImageData(e);this.style.addImage(d,{data:new c.R({width:M,height:z},B),pixelRatio:a,stretchX:h,stretchY:y,content:b,textFitWidth:S,textFitHeight:C,sdf:l,version:0})}}updateImage(d,e){const n=this.style.getImage(d);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?V.getImageData(e):e,{width:l,height:h,data:y}=a;if(l===void 0||h===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||h!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,b),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Ae.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,a={}){return this.style.setPaintProperty(d,e,n,a),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,a={}){return this.style.setLayoutProperty(d,e,n,a),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,a=>{a||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d){return this._lazyInitEmptyStyle(),this.style.setSky(d),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=N.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=N.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=N.create("div","maplibregl-control-container",d),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{h[y]=N.create("div",`maplibregl-ctrl-${y} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:d},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new ol(n,this.transform),ie.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,h=V.now();this.style.zoomHistory.update(l,h);const y=new c.z(l,{now:h,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=y.crossFadingFactor();b===1&&b===this._crossFadingFactor||(n=!0,this._crossFadingFactor=b),this.style.update(y)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ae.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),N.remove(this._canvasContainer),N.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,V.frameAsync(this._frameRequest).then(d=>{c.bf.frame(d),this._frameRequest=null,this._render(d)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return wf}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=_r,w.MapTouchEvent=zs,w.MapWheelEvent=mf,w.Marker=_l,w.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},R_,d),this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),N.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=N.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new L_(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const n=N.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},w.Popup=class extends c.E{constructor(d){super(),this.remove=()=>(this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=N.create("div","maplibregl-popup",this._map.getContainer()),this._tip=N.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ei(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const h=vl(this.options.offset);if(!l){const b=this._container.offsetWidth,S=this._container.offsetHeight;let C;C=a.y+h.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<b/2?C.push("left"):a.x>this._map.transform.width-b/2&&C.push("right"),l=C.length===0?"bottom":C.join("-")}let y=a.add(h[l]);this.options.subpixelPositioning||(y=y.round()),N.setTransform(this._container,`${wo[l]} translate(${y.x}px,${y.y}px)`),gl(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Dt),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.N.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=d;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=N.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(yl);d&&d.focus()}},w.RasterDEMTileSource=wi,w.RasterTileSource=Jt,w.ScaleControl=class{constructor(d){this._onMove=()=>{_a(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,_a(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Fn),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=vn,w.Style=Za,w.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=N.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=N.create("button","maplibregl-ctrl-terrain",this._container),N.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){N.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=_o,w.TwoFingersTouchRotateHandler=Pu,w.TwoFingersTouchZoomHandler=wu,w.TwoFingersTouchZoomRotateHandler=Iu,w.VectorTileSource=Ir,w.VideoSource=qn,w.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(ws(d))throw new Error(`A source type called "${d}" already exists.`);((n,a)=>{es[n]=a})(d,e)}),w.clearPrewarmedResources=function(){const d=Ni;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(fi),Ni=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return zn().getRTLTextPluginStatus()},w.getVersion=function(){return Du},w.getWorkerCount=function(){return bi.workerCount},w.getWorkerUrl=function(){return c.a.WORKER_URL},w.importScriptInWorkers=function(d){return Qi().broadcast("IS",d)},w.prewarm=function(){tr().acquire(fi)},w.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},w.setRTLTextPlugin=function(d,e){return zn().setRTLTextPlugin(d,e)},w.setWorkerCount=function(d){bi.workerCount=d},w.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var E=g;return E})}(em)),em.exports}var JE=KE();const Zc=bb(JE);function YE(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}function QE(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}function $E(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}function ek(f,s){const g=Ko(s,["children","$$slots","$$events","$$legacy"]);qc(f,ri({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(I,E)=>{var w=Ke(),c=Ne(w);ja(c,s,"default",{}),Te(I,w)},$$slots:{default:!0}}))}var Dp;class Y0{constructor(s){W(this,Dp,Ye());this.value=s}get value(){return R(T(this,Dp))}set value(s){Ve(T(this,Dp),Ze(s))}}Dp=new WeakMap;var Rp,Lp,Op,Fp;class tk{constructor(){W(this,Rp,Ye());W(this,Lp,Ye(!1));Oe(this,"loadedImages",new Yy);W(this,Op,Ye(0));W(this,Fp,Ye(24));Oe(this,"layerInfo",new Map);Oe(this,"eventTracker",new WeakMap);Oe(this,"eventTopMost");Oe(this,"markerClickManager",new lk);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return R(T(this,Rp))}set map(s){Ve(T(this,Rp),Ze(s))}get loaded(){return R(T(this,Lp))}set loaded(s){Ve(T(this,Lp),Ze(s))}get minzoom(){return R(T(this,Op))}set minzoom(s){Ve(T(this,Op),Ze(s))}get maxzoom(){return R(T(this,Fp))}set maxzoom(s){Ve(T(this,Fp),Ze(s))}_eventTopMost(s){var E;let g=this.eventTracker.get(s.originalEvent);if(g!==void 0)return g;let I=(E=s.target.queryRenderedFeatures(s.point).find(w=>{var c;return(c=this.layerInfo.get(w.layer.id))==null?void 0:c.interactive}))==null?void 0:E.layer.id;return this.eventTracker.set(s.originalEvent,I),I}}Rp=new WeakMap,Lp=new WeakMap,Op=new WeakMap,Fp=new WeakMap;function ik(f){Bp(nk,f)}function rk(f){Bp(sk,f)}const mw=Symbol.for("svelte-maplibre"),nk=Symbol.for("svelte-maplibre.popup-target"),sk=Symbol.for("svelte-maplibre.layer-event");function Up(){return nv(mw)}function ok(){return Bp(mw,new tk)}function ak(){const f=new Y0(void 0),s=new Y0(void 0);return ik(f),rk(s),{marker:f,layerEvent:s}}class lk{constructor(){Oe(this,"_handlers",new Set)}add(s){this._handlers.add(s)}remove(s){this._handlers.delete(s)}handleClick(s){for(const g of this._handlers)g(s)}}function ck(f){return Object.fromEntries(Object.entries(f).filter(([s,g])=>g!=null))}eb(["click"]);function uk(f,s){Et(s,!0);const g=Pe(Up),v=Pe(()=>R(g).map),I=Pe(()=>R(g).loaded);let E=J(s,"position",3,"top-left"),w=J(s,"container",3,void 0),c=Ye(void 0),U=Pe(()=>typeof w()=="string"?document.querySelector(w())??void 0:w());At(()=>{R(U)&&!R(c)&&(Ve(c,Ze(new Zc.FullscreenControl({container:R(U)}))),R(v).addControl(R(c),E()))}),e_(()=>{R(I)&&R(c)&&R(v).removeControl(R(c))}),kt()}function hk(f,s){Et(s,!0);const g=Pe(Up),v=Pe(()=>R(g).map),I=Pe(()=>R(g).loaded);let E=J(s,"position",3,"top-left"),w=J(s,"positionOptions",3,void 0),c=J(s,"fitBoundsOptions",3,void 0),U=J(s,"trackUserLocation",3,!1),q=J(s,"showAccuracyCircle",3,!0),K=J(s,"showUserLocation",3,!0),V=J(s,"control",15);At(()=>{R(v)&&!V()&&(V(new Zc.GeolocateControl({positionOptions:w(),fitBoundsOptions:c(),trackUserLocation:U(),showAccuracyCircle:q(),showUserLocation:K()})),R(v).addControl(V(),E()))}),e_(()=>{R(I)&&V()&&R(v).removeControl(V())}),kt()}function dk(f){let s=f.getCenter(),g=Math.round(f.getZoom()*100)/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,v),E=Math.round(s.lat*I)/I,w=Math.round(s.lng*I)/I,c=`${g}/${E}/${w}`,U=f.getBearing(),q=f.getPitch();return(U||q)&&(c+=`/${Math.round(U*10)/10}`),q&&(c+=`/${Math.round(q)}`),`#${c}`}function pk(f){return f.replace("#","").split("/").map(parseFloat)}var Bl=Tv;function Tv(f,s){return f===s||f!==f&&s!==s?!0:typeof f!=typeof s||{}.toString.call(f)!={}.toString.call(s)||f!==Object(f)||!f?!1:Array.isArray(f)?Q0(f,s):{}.toString.call(f)=="[object Set]"?Q0(Array.from(f),Array.from(s)):{}.toString.call(f)=="[object Object]"?mk(f,s):fk(f,s)}function fk(f,s){return f.toString()===s.toString()}function Q0(f,s){var g=f.length;if(g!=s.length)return!1;for(var v=0;v<g;v++)if(!Tv(f[v],s[v]))return!1;return!0}function mk(f,s){var g=Object.keys(f),v=g.length;if(v!=Object.keys(s).length)return!1;for(var I=0;I<v;I++){var E=g[I];if(!(s.hasOwnProperty(E)&&Tv(f[E],s[E])))return!1}return!0}function gk(f,s){Et(s,!0);const g=Pe(Up),v=Pe(()=>R(g).map),I=Pe(()=>R(g).loaded);let E=J(s,"position",3,"top-left"),w=J(s,"showCompass",3,!0),c=J(s,"showZoom",3,!0),U=J(s,"visualizePitch",3,!1),q=Ye(void 0);At(()=>{R(v)&&!R(q)&&(Ve(q,Ze(new Zc.NavigationControl({showCompass:w(),showZoom:c(),visualizePitch:U()}))),R(v).addControl(R(q),E()))}),e_(()=>{R(I)&&R(q)&&R(v).removeControl(R(q))}),kt()}function _k(f,s){Et(s,!0);const g=Pe(Up),v=Pe(()=>R(g).map),I=Pe(()=>R(g).loaded);let E=J(s,"position",3,"bottom-left"),w=J(s,"maxWidth",3,void 0),c=J(s,"unit",3,"metric"),U=Ye(void 0);At(()=>{R(v)&&!R(U)&&(Ve(U,Ze(new Zc.ScaleControl({maxWidth:w(),unit:c()}))),R(v).addControl(R(U),E()))}),e_(()=>{R(I)&&R(U)&&R(v).removeControl(R(U))}),kt()}var yk=Vt("<!> <!> <!> <!>",1),vk=Vt("<!> <!>",1),xk=Vt('<div data-testid="map-container"><!></div>');function bk(f,s){Et(s,!0);let g=J(s,"map",15,void 0),v=J(s,"mapContainer",15,void 0),I=J(s,"class",3,void 0),E=J(s,"diffStyleUpdates",3,!1),w=J(s,"center",15,void 0),c=J(s,"zoom",15,void 0),U=J(s,"pitch",15,0),q=J(s,"bearing",15,0),K=J(s,"bounds",15,void 0),V=J(s,"hash",3,!1),N=J(s,"updateHash",3,vt=>{window.history.replaceState(window.history.state,"",vt)}),ie=J(s,"loaded",15,!1),te=J(s,"minZoom",3,0),oe=J(s,"maxZoom",3,22),ue=J(s,"minPitch",3,0),ye=J(s,"maxPitch",3,60),pe=J(s,"renderWorldCopies",3,void 0),Ae=J(s,"dragPan",3,void 0),ze=J(s,"dragRotate",3,void 0),Me=J(s,"pitchWithRotate",3,void 0),je=J(s,"antialias",3,void 0),Je=J(s,"zoomOnDoubleClick",3,!0),_t=J(s,"locale",3,void 0),Ge=J(s,"interactive",3,!0),gt=J(s,"attributionControl",3,void 0),at=J(s,"cooperativeGestures",3,!1),Ue=J(s,"preserveDrawingBuffer",3,!1),Fe=J(s,"maxBounds",3,void 0),Ce=J(s,"images",19,()=>[]),He=J(s,"standardControls",3,!1),st=J(s,"filterLayers",3,void 0),yt=J(s,"transformRequest",3,void 0),xt=Pe(()=>typeof He()=="boolean"?void 0:He());const ht=ok();let mt=Ye(Ze(new Set));async function Rt(vt,Lt=!1){var we;if(g()&&!(!((we=g())!=null&&we.loaded())&&!Lt))if("url"in vt){R(mt).add(vt.id);try{let ji=await g().loadImage(vt.url);g().addImage(vt.id,ji.data,vt.options),ht.loadedImages.add(vt.id)}catch(ji){s.onerror?s.onerror({error:ji}):console.error(ji)}finally{R(mt).delete(vt.id)}}else g().addImage(vt.id,vt.data,vt.options),ht.loadedImages.add(vt.id)}At(()=>{var vt;if(ie()&&((vt=g())!=null&&vt.loaded()))for(let Lt of Ce())!ht.loadedImages.has(Lt.id)&&!R(mt).has(Lt.id)&&!g().hasImage(Lt.id)&&Rt(Lt)});let jt=Pe(()=>Ce().every(vt=>ht.loadedImages.has(vt.id))),Ti=Ye(void 0),fi=Ye(void 0),bi=Ye(void 0),Hi=Ye(void 0);function Ni(vt){s.onerror?s.onerror(vt):vt.error.name!=="AbortError"&&console.error(vt.error)}function Vi(vt){return Fr(),g(ht.map=new Zc.Map(ck({container:vt,style:s.style,locale:_t(),center:w(),zoom:c(),pitch:U(),bearing:q(),minZoom:te(),maxZoom:oe(),minPitch:ue(),maxPitch:ye(),renderWorldCopies:pe(),dragPan:Ae(),dragRotate:ze(),pitchWithRotate:Me(),antialias:je(),interactive:Ge(),preserveDrawingBuffer:Ue(),maxBounds:Fe(),bounds:K(),attributionControl:gt(),transformRequest:yt(),cooperativeGestures:at()}))),g().on("load",Lt=>{Lt.target.getContainer().setAttribute("data-testid","map"),Lt.target.getCanvas().setAttribute("data-testid","map-canvas"),s.onload&&s.onload(g()),ht.loaded=!0,ie(!0)}),g().on("error",Ni),s.onmovestart&&g().on("movestart",s.onmovestart),g().on("moveend",Lt=>{var we;if(w(Lt.target.getCenter()),c(Lt.target.getZoom()),U(Lt.target.getPitch()),q(Lt.target.getBearing()),K(Lt.target.getBounds()),(we=s.onmoveend)==null||we.call(s,Lt),V()){let ji=new URL(window.location.href.replace(/(#.+)?$/,dk(Lt.target)));N()(ji)}}),s.onclick&&g().on("click",s.onclick),s.ondblclick&&g().on("dblclick",s.ondblclick),s.oncontextmenu&&g().on("contextmenu",s.oncontextmenu),s.onmousemove&&g().on("mousemove",s.onmousemove),s.onzoomstart&&g().on("zoomstart",s.onzoomstart),s.onzoom&&g().on("zoom",s.onzoom),s.onzoomend&&g().on("zoomend",s.onzoomend),s.onpitch&&g().on("pitch",s.onpitch),s.onrotate&&g().on("rotate",s.onrotate),s.onwheel&&g().on("wheel",s.onwheel),s.ondata&&g().on("data",s.ondata),s.onidle&&g().on("idle",s.onidle),g().on("style.load",()=>{if(g()){const Lt=g().getStyle();if(Ve(Ti,Ze(Lt.layers.map(we=>we.id))),Ve(fi,Ze(Object.keys(Lt.sources))),R(Hi))for(const[we,ji]of Object.entries(R(Hi)))g().addSource(we,ji);if(R(bi))for(const we of R(bi))g().addLayer(we);for(const we of Ce())Rt(we,!0)}}),g().on("styledata",Lt=>{var we;if(g()&&st()){const ji=g().getStyle().layers;if(ji)for(let Ir of ji)st()(Ir)||g().setLayoutProperty(Ir.id,"visibility","none")}(we=s.onstyledata)==null||we.call(s,Lt)}),{destroy(){var Lt;ie(!1),ht.loaded=!1,(Lt=g())==null||Lt.remove()}}}let tr=Ye(Ze(s.style));At(()=>{if(g()&&!Bl(s.style,R(tr))){const vt=g().getStyle();if(R(Ti)&&Ve(bi,Ze(vt.layers.filter(Lt=>!R(Ti).includes(Lt.id)))),R(fi)){const Lt=Object.keys(vt.sources).filter(we=>!R(fi).includes(we));Ve(Hi,Ze({}));for(const we of Lt)R(Hi)[we]=vt.sources[we]}Ve(tr,Ze(s.style)),g().setStyle(s.style,{diff:E()}),ht.loadedImages.clear(),Ve(mt,Ze(new Set))}}),At(()=>{if(g()){let vt={};w()!=null&&!Bl(w(),g().getCenter())&&(vt.center=w()),c()!=null&&!Bl(c(),g().getZoom())&&(vt.zoom=c()),q()!=null&&!Bl(q(),g().getBearing())&&(vt.bearing=q()),U()!=null&&!Bl(U(),g().getPitch())&&(vt.pitch=U()),Object.keys(vt).length&&g().easeTo(vt)}}),At(()=>{var vt,Lt;K()&&!Bl(K(),(vt=g())==null?void 0:vt.getBounds())&&((Lt=g())==null||Lt.fitBounds(K()))}),At(()=>{var vt,Lt;Je()?(vt=g())==null||vt.doubleClickZoom.enable():(Lt=g())==null||Lt.doubleClickZoom.disable()});function Fr(){if(V()){let vt=pk(window.location.hash);vt.length>=3&&(c(vt[0]),w([vt[2],vt[1]])),vt.length==5&&(q(vt[3]),U(vt[4]))}}var Qi=xk();Vy("hashchange",B2,Fr);var sr=ci(Qi);{var ar=vt=>{var Lt=vk(),we=Ne(Lt);{var ji=Jt=>{var wi=yk(),kn=Ne(wi);gk(kn,{get position(){return R(xt)}});var Kr=Ci(kn,2);hk(Kr,{get position(){return R(xt)},fitBoundsOptions:{maxZoom:12}});var Br=Ci(Kr,2);uk(Br,{get position(){return R(xt)}});var qn=Ci(Br,2);_k(qn,{get position(){return R(xt)}}),Te(Jt,wi)};hi(we,Jt=>{He()&&Jt(ji)})}var Ir=Ci(we,2);Ct(Ir,()=>s.children??Xt,()=>({map:g(),loadedImages:ht.loadedImages,allImagesLoaded:R(jt)})),Te(vt,Lt)};hi(sr,vt=>{g()&&ie()&&vt(ar)})}ui(Qi),tm(Qi,vt=>v(vt),()=>v()),Zy(Qi,vt=>Vi==null?void 0:Vi(vt)),di(()=>{J2(Qi,`${I()??""} svelte-p00lfq`),Q2(Qi,"expand-map",!I())}),Te(f,Qi),kt()}function wk(f,s){f.key===" "&&(f.preventDefault(),f.stopPropagation(),s("click"))}var Sk=(f,s)=>{f.stopPropagation(),s("click")},Pk=(f,s)=>{f.stopPropagation(),s("dblclick")},Tk=(f,s)=>{f.stopPropagation(),f.preventDefault(),s("contextmenu")},Ik=(f,s)=>s("mousemove"),Ak=Vt("<div><!></div>");function Ck(f,s){Et(s,!0);let g=J(s,"marker",15,void 0),v=J(s,"lngLat",15),I=J(s,"class",3,void 0),E=J(s,"interactive",3,!0),w=J(s,"asButton",3,!1),c=J(s,"draggable",3,!1),U=J(s,"feature",3,void 0),q=J(s,"offset",3,void 0),K=J(s,"zIndex",3,void 0),V=J(s,"rotation",3,0),N=J(s,"opacity",3,1),ie=Gt(s,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const te=Pe(Up),oe=Pe(()=>R(te).map),ue=Pe(()=>R(te).markerClickManager),{layerEvent:ye,marker:pe}=ak();function Ae(Ge){pe.value=new Zc.Marker({element:Ge,rotation:V(),draggable:c(),offset:q(),opacity:N().toString()}).setLngLat(v()).addTo(R(oe)),g(pe.value);const gt=()=>je("dragstart"),at=()=>{Me(),je("drag")},Ue=()=>{Me(),je("dragend")};return c()&&(pe.value.on("dragstart",gt),pe.value.on("drag",at),pe.value.on("dragend",Ue)),{destroy(){var Fe,Ce,He,st;c()&&((Fe=pe.value)==null||Fe.off("dragstart",gt),(Ce=pe.value)==null||Ce.off("drag",at),(He=pe.value)==null||He.off("dragend",Ue)),g(void 0),(st=pe.value)==null||st.remove()}}}function ze(Ge,gt){const at=Ge.className;function Ue(Fe){Fe?Ge.className=`${at} ${Fe}`:Ge.className=at}return Ue(gt),{update:Ue}}At(()=>{var Ge;(Ge=pe.value)==null||Ge.setLngLat(v())}),At(()=>{var Ge;(Ge=pe.value)==null||Ge.setOffset(q()??[0,0])}),At(()=>{var Ge;(Ge=pe.value)==null||Ge.setRotation(V())}),At(()=>{var Ge;(Ge=pe.value)==null||Ge.setOpacity(N().toString())});function Me(){var gt;let Ge=(gt=pe.value)==null?void 0:gt.getLngLat();Ge&&(Array.isArray(v())?v([Ge.lng,Ge.lat]):v()&&"lon"in v()?v({lon:Ge.lng,lat:Ge.lat}):v(Ge))}function je(Ge){var Ce,He;if(!E())return;let gt=(Ce=pe.value)==null?void 0:Ce.getLngLat();if(!gt)return;const at=[gt.lng,gt.lat];let Ue={map:R(oe),marker:pe.value,lngLat:at,features:[{type:"Feature",properties:((He=U())==null?void 0:He.properties)??{},geometry:{type:"Point",coordinates:at}}]};(Ge==="click"||Ge==="contextmenu")&&R(ue).handleClick(Ue),ye.value={...Ue,layerType:"marker",type:Ge};const Fe=ie["on"+Ge];Fe==null||Fe(Ue)}var Je=Ak();Je.__click=[Sk,je],Je.__dblclick=[Pk,je],Je.__contextmenu=[Tk,je],Je.__mousemove=[Ik,je],Je.__keydown=[wk,je];var _t=ci(Je);Ct(_t,()=>s.children??Xt,()=>({marker:pe.value})),ui(Je),Zy(Je,Ge=>Ae==null?void 0:Ae(Ge)),Zy(Je,(Ge,gt)=>ze==null?void 0:ze(Ge,gt),I),di(()=>{qy(Je,"tabindex",w()?0:void 0),qy(Je,"role",w()?"button":void 0),$2(Je,"z-index",K())}),Vy("mouseenter",Je,()=>{je("mouseenter")}),Vy("mouseleave",Je,()=>{je("mouseleave")}),Te(f,Je),kt()}eb(["click","dblclick","contextmenu","mousemove","keydown"]);var qp=Uint8Array,gw=Uint16Array,Ek=Int32Array,kk=new qp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Mk=new qp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),_w=function(f,s){for(var g=new gw(31),v=0;v<31;++v)g[v]=s+=1<<f[v-1];for(var I=new Ek(g[30]),v=1;v<30;++v)for(var E=g[v];E<g[v+1];++E)I[E]=E-g[v]<<5|v;return{b:g,r:I}},yw=_w(kk,2),zk=yw.b,Dk=yw.r;zk[28]=258,Dk[258]=28;_w(Mk,0);var Rk=new gw(32768);for(xi=0;xi<32768;++xi)js=(xi&43690)>>1|(xi&21845)<<1,js=(js&52428)>>2|(js&13107)<<2,js=(js&61680)>>4|(js&3855)<<4,Rk[xi]=((js&65280)>>8|(js&255)<<8)>>1;var js,xi,c_=new qp(288);for(xi=0;xi<144;++xi)c_[xi]=8;var xi;for(xi=144;xi<256;++xi)c_[xi]=9;var xi;for(xi=256;xi<280;++xi)c_[xi]=7;var xi;for(xi=280;xi<288;++xi)c_[xi]=8;var xi,Lk=new qp(32);for(xi=0;xi<32;++xi)Lk[xi]=5;var xi,Ok=new qp(0),Fk=typeof TextDecoder<"u"&&new TextDecoder,Bk=0;try{Fk.decode(Ok,{stream:!0}),Bk=1}catch{}const Nk=[{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amentities:["WiFi"]}}],Vk=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46990996120006,lng:-80.54232110658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amentities:["WiFi"]}}],$0=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.134},spaces:Nk},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:Vk}];var jk=Vt("<span> </span>"),Uk=Vt(" <!>",1),qk=Vt("<!> ",1),Zk=Vt("<!> <!>",1),Gk=Vt("<!> <!>",1),Hk=Vt("<!> <!>",1),Wk=Vt('<!> <!> <span class="sr-only">Toggle theme</span>',1),Xk=Vt("<!> <!>",1),Kk=Vt("<!> <!>",1),Jk=Vt('<div class="mx-auto w-full max-w-sm"><!> <div class="p-4 pb-0"><!></div></div>'),Yk=Vt('<!> <div class="z-10 absolute top-2.5 left-1/2 -translate-x-1/2"><!></div> <!> <!>',1);function uM(f,s){Et(s,!0);const g=q2(),v=()=>G2(U2,"$mode",g);let I=Ye(!1),E=Ye(null),w=Ye("");const c=Pe(()=>$0.find(ze=>ze.value===R(w)));let U=Ye(null);const q=`https://api.maptiler.com/maps/topo-v2/style.json?key=${g0}`,K=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${g0}`,V=Pe(()=>v()==="dark"?K:q);let N=Ye(!1);function ie(){Ve(I,!1),rv().then(()=>{R(E).focus()})}At(()=>{var ze;if(R(c)){const Me=(ze=R(c).metadata)==null?void 0:ze.display;R(U).jumpTo({center:R(c).location,zoom:(Me==null?void 0:Me.zoom)??16,pitch:(Me==null?void 0:Me.pitch)??60,bearing:(Me==null?void 0:Me.bearing)??0})}});var te=Yk();Z2(ze=>{N2.title="Campus Study Spots"});var oe=Ne(te);bk(oe,{get map(){return R(U)},set map(ze){Ve(U,Ze(ze))},get style(){return R(V)},class:"min-h-screen",standardControls:!0,children:(ze,Me)=>{var je=Ke(),Je=Ne(je);{var _t=Ge=>{var gt=Ke(),at=Ne(gt);jy(at,17,()=>R(c).spaces,Uy,(Ue,Fe)=>{Ck(Ue,{get lngLat(){return R(Fe).location},class:"cursor-pointer",onclick:()=>Ve(N,!0),children:(Ce,He)=>{var st=jk(),yt=ci(st,!0);ui(st),di(()=>ah(yt,R(Fe).label)),Te(Ce,st)},$$slots:{default:!0}})}),Te(Ge,gt)};hi(Je,Ge=>{R(c)&&Ge(_t)})}Te(ze,je)},$$slots:{default:!0}});var ue=Ci(oe,2),ye=ci(ue);Yt(ye,()=>HE,(ze,Me)=>{Me(ze,{get open(){return R(I)},set open(je){Ve(I,Ze(je))},children:(je,Je)=>{var _t=Hk(),Ge=Ne(_t);Yt(Ge,()=>WE,(at,Ue)=>{Ue(at,{get ref(){return R(E)},set ref(Ce){Ve(E,Ze(Ce))},child:(Ce,He)=>{S0(Ce,ri({variant:"outline",class:"w-52 justify-between"},()=>He==null?void 0:He().props,{role:"combobox",get"aria-expanded"(){return R(I)},children:(yt,xt)=>{Us();var ht=Uk(),mt=Ne(ht),Rt=Ci(mt);QE(Rt,{class:"opacity-50"}),di(()=>{var jt;return ah(mt,`${(((jt=R(c))==null?void 0:jt.label)||"Select a campus...")??""} `)}),Te(yt,ht)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var gt=Ci(Ge,2);Yt(gt,()=>GE,(at,Ue)=>{Ue(at,{class:"w-52 p-0",children:(Fe,Ce)=>{var He=Ke(),st=Ne(He);Yt(st,()=>ZC,(yt,xt)=>{xt(yt,{children:(ht,mt)=>{var Rt=Gk(),jt=Ne(Rt);Yt(jt,()=>YC,(fi,bi)=>{bi(fi,{placeholder:"Search campuses..."})});var Ti=Ci(jt,2);Yt(Ti,()=>QC,(fi,bi)=>{bi(fi,{children:(Hi,Ni)=>{var Vi=Zk(),tr=Ne(Vi);Yt(tr,()=>GC,(Qi,sr)=>{sr(Qi,{children:(ar,vt)=>{Us();var Lt=Aa("No campus found.");Te(ar,Lt)},$$slots:{default:!0}})});var Fr=Ci(tr,2);Yt(Fr,()=>WC,(Qi,sr)=>{sr(Qi,{children:(ar,vt)=>{var Lt=Ke(),we=Ne(Lt);jy(we,17,()=>$0,Uy,(ji,Ir)=>{var Jt=Ke(),wi=Ne(Jt);Yt(wi,()=>XC,(kn,Kr)=>{Kr(kn,{get value(){return R(Ir).value},onSelect:()=>{Ve(w,Ze(R(Ir).value)),ie()},children:(Br,qn)=>{var Ar=qk(),es=Ne(Ar),ws=Pe(()=>Tr("ml-auto",R(w)!==R(Ir).value&&"text-transparent"));YE(es,{get class(){return R(ws)}});var Xe=Ci(es);di(()=>ah(Xe,` ${R(Ir).label??""}`)),Te(Br,Ar)},$$slots:{default:!0}})}),Te(ji,Jt)}),Te(ar,Lt)},$$slots:{default:!0}})}),Te(Hi,Vi)},$$slots:{default:!0}})}),Te(ht,Rt)},$$slots:{default:!0}})}),Te(Fe,He)},$$slots:{default:!0}})}),Te(je,_t)},$$slots:{default:!0}})}),ui(ue);var pe=Ci(ue,2);S0(pe,{class:"absolute top-2.5 right-2.5 z-10",onclick:j2,variant:"outline",size:"icon",children:(ze,Me)=>{var je=Wk(),Je=Ne(je);ek(Je,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var _t=Ci(Je,2);$E(_t,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),Us(2),Te(ze,je)},$$slots:{default:!0}});var Ae=Ci(pe,2);Yt(Ae,()=>OE,(ze,Me)=>{Me(ze,{get open(){return R(N)},set open(je){Ve(N,Ze(je))},children:(je,Je)=>{var _t=Ke(),Ge=Ne(_t);Yt(Ge,()=>VE,(gt,at)=>{at(gt,{children:(Ue,Fe)=>{var Ce=Jk(),He=ci(Ce);Yt(He,()=>qE,(xt,ht)=>{ht(xt,{children:(mt,Rt)=>{var jt=Xk(),Ti=Ne(jt);Yt(Ti,()=>ZE,(bi,Hi)=>{Hi(bi,{children:(Ni,Vi)=>{Us();var tr=Aa("Move Goal");Te(Ni,tr)},$$slots:{default:!0}})});var fi=Ci(Ti,2);Yt(fi,()=>jE,(bi,Hi)=>{Hi(bi,{children:(Ni,Vi)=>{Us();var tr=Aa("Set your daily activity goal.");Te(Ni,tr)},$$slots:{default:!0}})}),Te(mt,jt)},$$slots:{default:!0}})});var st=Ci(He,2),yt=ci(st);Yt(yt,()=>qC,(xt,ht)=>{ht(xt,{type:"single",children:(mt,Rt)=>{var jt=Ke(),Ti=Ne(jt);Yt(Ti,()=>FC,(fi,bi)=>{bi(fi,{value:"item-1",children:(Hi,Ni)=>{var Vi=Kk(),tr=Ne(Vi);Yt(tr,()=>UC,(Qi,sr)=>{sr(Qi,{children:(ar,vt)=>{Us();var Lt=Aa("Is it accessible?");Te(ar,Lt)},$$slots:{default:!0}})});var Fr=Ci(tr,2);Yt(Fr,()=>OC,(Qi,sr)=>{sr(Qi,{children:(ar,vt)=>{Us();var Lt=Aa("Yes. It adheres to the WAI-ARIA design pattern.");Te(ar,Lt)},$$slots:{default:!0}})}),Te(Hi,Vi)},$$slots:{default:!0}})}),Te(mt,jt)},$$slots:{default:!0}})}),ui(st),ui(Ce),Te(Ue,Ce)},$$slots:{default:!0}})}),Te(je,_t)},$$slots:{default:!0}})}),Te(f,te),kt()}export{uM as component};
