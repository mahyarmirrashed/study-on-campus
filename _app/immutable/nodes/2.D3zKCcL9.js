var g2=Object.defineProperty;var _2=Object.getPrototypeOf;var y2=Reflect.get;var Yx=h=>{throw TypeError(h)};var v2=(h,s,g)=>s in h?g2(h,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):h[s]=g;var qe=(h,s,g)=>v2(h,typeof s!="symbol"?s+"":s,g),ly=(h,s,g)=>s.has(h)||Yx("Cannot "+g);var I=(h,s,g)=>(ly(h,s,"read from private field"),g?g.call(h):s.get(h)),X=(h,s,g)=>s.has(h)?Yx("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(h):s.set(h,g),Ze=(h,s,g,v)=>(ly(h,s,"write to private field"),v?v.call(h,g):s.set(h,g),g),Nr=(h,s,g)=>(ly(h,s,"access private method"),g);var $u=(h,s,g,v)=>({set _(T){Ze(h,s,T,g)},get _(){return I(h,s,v)}}),Qx=(h,s,g)=>y2(_2(h),g,s);import{e as x2,x as b2,f as rt,a as be,t as Et,y as w2,s as J0,b as Y0,p as S2,g as en,m as Q0,z as Iy,v as T2}from"../chunks/stores.DgQ0gFZM.js";import{$ as P2,ag as I2,aE as C2,x as Vn,j as Cy,X as eb,J as tb,aY as A2,a4 as cy,w as rh,O as k2,_ as e0,k as Wf,ab as as,U as t0,aq as i0,ap as r0,aZ as n0,a3 as Hf,L as Xf,R as E2,z as M2,K as z2,g as D2,v as L2,e as s0,h as o0,y as R2,a_ as Wy,a7 as O2,M as F2,C as Bi,N as ib,G as B2,Z as N2,Q as Be,p as Ct,f as Ve,a as At,c as Zt,af as ii,r as jt,t as Lt,F as L,I as Pe,s as Qt,aT as Ng,W as Je,a$ as rb,B as Tt,V as Vg,aC as V2,b0 as a0,b1 as j2,b2 as ta,ak as Ap,b3 as nb,al as Hy,b4 as U2,u as q2,b5 as Z2,b6 as G2}from"../chunks/entry.D0qt5YfA.js";import{s as Gi,m as W2,u as l0}from"../chunks/render.BV82Y2Yi.js";import{p as ee,b as gi,r as Kt,l as yi,d as qr,e as $t,a as je,f as H2,i as c0,o as sb,g as kp}from"../chunks/i18n.Dq4jj2NZ.js";import{w as Ep,v as Bt,x as Mi,e as ql,b as Pn,i as Zl,y as X2,s as Yf,k as ob,z as K2,g as $2}from"../chunks/mode.qgxThjTJ.js";import{b as Cs,c as ci}from"../chunks/this.B_-SOPLd.js";import{i as Xy}from"../chunks/lifecycle.C3N4iVFg.js";const J2=[];function ab(h,s=!1){return Kf(h,new Map,"",J2)}function Kf(h,s,g,v,T=null){if(typeof h=="object"&&h!==null){const w=s.get(h);if(w!==void 0)return w;if(h instanceof Map)return new Map(h);if(h instanceof Set)return new Set(h);if(P2(h)){const c=[];s.set(h,c),T!==null&&s.set(T,c);for(let j=0;j<h.length;j+=1)c.push(Kf(h[j],s,g,v));return c}if(I2(h)===C2){const c={};s.set(h,c),T!==null&&s.set(T,c);for(var C in h)c[C]=Kf(h[C],s,g,v);return c}if(h instanceof Date)return structuredClone(h);if(typeof h.toJSON=="function")return Kf(h.toJSON(),s,g,v,h)}if(h instanceof EventTarget)return h;try{return structuredClone(h)}catch{return h}}const uy=0,Bf=1,hy=2;function Ay(h,s,g,v,T){Vn&&Cy();var C=h,w=eb(),c=M2,j=e0,q,K,N,V=(w?as:t0)(void 0),se=(w?as:t0)(void 0),ie=!1;function le(Se,ge){ie=!0,ge&&(i0(fe),r0(fe),n0(c));try{Se===uy&&g&&(q?Hf(q):q=rh(()=>g(C))),Se===Bf&&v&&(K?Hf(K):K=rh(()=>v(C,V))),Se===hy&&T&&(N?Hf(N):N=rh(()=>T(C,se))),Se!==uy&&q&&Xf(q,()=>q=null),Se!==Bf&&K&&Xf(K,()=>K=null),Se!==hy&&N&&Xf(N,()=>N=null)}finally{ge&&(n0(null),r0(null),i0(null),E2())}}var fe=tb(()=>{if(j!==(j=s())){if(A2(j)){var Se=j;ie=!1,Se.then(ge=>{Se===j&&(cy(V,ge),le(Bf,!0))},ge=>{if(Se===j&&(cy(se,ge),le(hy,!0),!T))throw se.v}),Vn?g&&(q=rh(()=>g(C))):k2(()=>{ie||le(uy,!0)})}else cy(V,j),le(Bf,!1);return()=>j=e0}});Vn&&(C=Wf)}function lb(h,s,g,v,T,C){let w=Vn;Vn&&Cy();var c,j,q=null;Vn&&Wf.nodeType===1&&(q=Wf,Cy());var K=Vn?Wf:h,N;tb(()=>{const V=s()||null;var se=g||V==="svg"?Wy:null;V!==c&&(N&&(V===null?Xf(N,()=>{N=null,j=null}):V===j?Hf(N):O2(N)),V&&V!==j&&(N=rh(()=>{if(q=Vn?q:se?document.createElementNS(se,V):document.createElement(V),x2(q,q),v){var ie=Vn?D2(q):q.appendChild(L2());Vn&&(ie===null?s0(!1):o0(ie)),v(q,ie)}R2.nodes_end=q,K.before(q)})),c=V,c&&(j=c))},z2),w&&(s0(!0),o0(K))}function ky(h,s,g){F2(()=>{var v=Bi(()=>s(h,g==null?void 0:g())||{});if(g&&(v!=null&&v.update)){var T=!1,C={};ib(()=>{var w=g();B2(w),T&&N2(C,w)&&(C=w,v.update(w))}),T=!0}if(v!=null&&v.destroy)return()=>v.destroy()})}function cb(h,s){var g=h.__className,v=Y2(s);Vn&&h.className===v?h.__className=v:(g!==v||Vn&&h.className!==v)&&(s==null?h.removeAttribute("class"):h.className=v,h.__className=v)}function Y2(h){return h??""}function Q2(h,s,g){if(g){if(h.classList.contains(s))return;h.classList.add(s)}else{if(!h.classList.contains(s))return;h.classList.remove(s)}}function eS(h,s,g,v){var T=h.__styles??(h.__styles={});T[s]!==g&&(T[s]=g,g==null?h.style.removeProperty(s):h.style.setProperty(s,g,""))}function tS(h,s,g=s){var v=eb();b2(h,"input",T=>{var C=T?h.defaultValue:h.value;C=dy(h)?py(C):C,g(C),v&&C!==(C=s())&&(h.value=C??"")}),(Vn&&h.defaultValue!==h.value||Bi(s)==null&&h.value)&&g(dy(h)?py(h.value):h.value),ib(()=>{var T=s();dy(h)&&T===py(h.value)||h.type==="date"&&!T&&!h.value||T!==h.value&&(h.value=T??"")})}function dy(h){var s=h.type;return s==="number"||s==="range"}function py(h){return h===""?null:+h}function Vo(h){Be(h,h.v+1)}const u0="LYsosKTbN7Q5Pq1NzJI1";var h0=h=>typeof h=="boolean"?`${h}`:h===0?"0":h,Tn=h=>!h||typeof h!="object"||Object.keys(h).length===0,iS=(h,s)=>JSON.stringify(h)===JSON.stringify(s);function ub(h,s){h.forEach(function(g){Array.isArray(g)?ub(g,s):s.push(g)})}function hb(h){let s=[];return ub(h,s),s}var db=(...h)=>hb(h).filter(Boolean),pb=(h,s)=>{let g={},v=Object.keys(h),T=Object.keys(s);for(let C of v)if(T.includes(C)){let w=h[C],c=s[C];Array.isArray(w)||Array.isArray(c)?g[C]=db(c,w):typeof w=="object"&&typeof c=="object"?g[C]=pb(w,c):g[C]=c+" "+w}else g[C]=h[C];for(let C of T)v.includes(C)||(g[C]=s[C]);return g},d0=h=>!h||typeof h!="string"?h:h.replace(/\s+/g," ").trim();const Ky="-",rS=h=>{const s=sS(h),{conflictingClassGroups:g,conflictingClassGroupModifiers:v}=h;return{getClassGroupId:w=>{const c=w.split(Ky);return c[0]===""&&c.length!==1&&c.shift(),fb(c,s)||nS(w)},getConflictingClassGroupIds:(w,c)=>{const j=g[w]||[];return c&&v[w]?[...j,...v[w]]:j}}},fb=(h,s)=>{var w;if(h.length===0)return s.classGroupId;const g=h[0],v=s.nextPart.get(g),T=v?fb(h.slice(1),v):void 0;if(T)return T;if(s.validators.length===0)return;const C=h.join(Ky);return(w=s.validators.find(({validator:c})=>c(C)))==null?void 0:w.classGroupId},p0=/^\[(.+)\]$/,nS=h=>{if(p0.test(h)){const s=p0.exec(h)[1],g=s==null?void 0:s.substring(0,s.indexOf(":"));if(g)return"arbitrary.."+g}},sS=h=>{const{theme:s,prefix:g}=h,v={nextPart:new Map,validators:[]};return aS(Object.entries(h.classGroups),g).forEach(([C,w])=>{Ey(w,v,C,s)}),v},Ey=(h,s,g,v)=>{h.forEach(T=>{if(typeof T=="string"){const C=T===""?s:f0(s,T);C.classGroupId=g;return}if(typeof T=="function"){if(oS(T)){Ey(T(v),s,g,v);return}s.validators.push({validator:T,classGroupId:g});return}Object.entries(T).forEach(([C,w])=>{Ey(w,f0(s,C),g,v)})})},f0=(h,s)=>{let g=h;return s.split(Ky).forEach(v=>{g.nextPart.has(v)||g.nextPart.set(v,{nextPart:new Map,validators:[]}),g=g.nextPart.get(v)}),g},oS=h=>h.isThemeGetter,aS=(h,s)=>s?h.map(([g,v])=>{const T=v.map(C=>typeof C=="string"?s+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([w,c])=>[s+w,c])):C);return[g,T]}):h,lS=h=>{if(h<1)return{get:()=>{},set:()=>{}};let s=0,g=new Map,v=new Map;const T=(C,w)=>{g.set(C,w),s++,s>h&&(s=0,v=g,g=new Map)};return{get(C){let w=g.get(C);if(w!==void 0)return w;if((w=v.get(C))!==void 0)return T(C,w),w},set(C,w){g.has(C)?g.set(C,w):T(C,w)}}},mb="!",cS=h=>{const{separator:s,experimentalParseClassName:g}=h,v=s.length===1,T=s[0],C=s.length,w=c=>{const j=[];let q=0,K=0,N;for(let fe=0;fe<c.length;fe++){let Se=c[fe];if(q===0){if(Se===T&&(v||c.slice(fe,fe+C)===s)){j.push(c.slice(K,fe)),K=fe+C;continue}if(Se==="/"){N=fe;continue}}Se==="["?q++:Se==="]"&&q--}const V=j.length===0?c:c.substring(K),se=V.startsWith(mb),ie=se?V.substring(1):V,le=N&&N>K?N-K:void 0;return{modifiers:j,hasImportantModifier:se,baseClassName:ie,maybePostfixModifierPosition:le}};return g?c=>g({className:c,parseClassName:w}):w},uS=h=>{if(h.length<=1)return h;const s=[];let g=[];return h.forEach(v=>{v[0]==="["?(s.push(...g.sort(),v),g=[]):g.push(v)}),s.push(...g.sort()),s},hS=h=>({cache:lS(h.cacheSize),parseClassName:cS(h),...rS(h)}),dS=/\s+/,pS=(h,s)=>{const{parseClassName:g,getClassGroupId:v,getConflictingClassGroupIds:T}=s,C=[],w=h.trim().split(dS);let c="";for(let j=w.length-1;j>=0;j-=1){const q=w[j],{modifiers:K,hasImportantModifier:N,baseClassName:V,maybePostfixModifierPosition:se}=g(q);let ie=!!se,le=v(ie?V.substring(0,se):V);if(!le){if(!ie){c=q+(c.length>0?" "+c:c);continue}if(le=v(V),!le){c=q+(c.length>0?" "+c:c);continue}ie=!1}const fe=uS(K).join(":"),Se=N?fe+mb:fe,ge=Se+le;if(C.includes(ge))continue;C.push(ge);const Ee=T(le,ie);for(let Ne=0;Ne<Ee.length;++Ne){const Le=Ee[Ne];C.push(Se+Le)}c=q+(c.length>0?" "+c:c)}return c};function fS(){let h=0,s,g,v="";for(;h<arguments.length;)(s=arguments[h++])&&(g=gb(s))&&(v&&(v+=" "),v+=g);return v}const gb=h=>{if(typeof h=="string")return h;let s,g="";for(let v=0;v<h.length;v++)h[v]&&(s=gb(h[v]))&&(g&&(g+=" "),g+=s);return g};function My(h,...s){let g,v,T,C=w;function w(j){const q=s.reduce((K,N)=>N(K),h());return g=hS(q),v=g.cache.get,T=g.cache.set,C=c,c(j)}function c(j){const q=v(j);if(q)return q;const K=pS(j,g);return T(j,K),K}return function(){return C(fS.apply(null,arguments))}}const Ki=h=>{const s=g=>g[h]||[];return s.isThemeGetter=!0,s},_b=/^\[(?:([a-z-]+):)?(.+)\]$/i,mS=/^\d+\/\d+$/,gS=new Set(["px","full","screen"]),_S=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,yS=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,vS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,bS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Hs=h=>Gl(h)||gS.has(h)||mS.test(h),Fo=h=>Fc(h,"length",kS),Gl=h=>!!h&&!Number.isNaN(Number(h)),fy=h=>Fc(h,"number",Gl),Ju=h=>!!h&&Number.isInteger(Number(h)),wS=h=>h.endsWith("%")&&Gl(h.slice(0,-1)),oi=h=>_b.test(h),Bo=h=>_S.test(h),SS=new Set(["length","size","percentage"]),TS=h=>Fc(h,SS,yb),PS=h=>Fc(h,"position",yb),IS=new Set(["image","url"]),CS=h=>Fc(h,IS,MS),AS=h=>Fc(h,"",ES),Yu=()=>!0,Fc=(h,s,g)=>{const v=_b.exec(h);return v?v[1]?typeof s=="string"?v[1]===s:s.has(v[1]):g(v[2]):!1},kS=h=>yS.test(h)&&!vS.test(h),yb=()=>!1,ES=h=>xS.test(h),MS=h=>bS.test(h),zy=()=>{const h=Ki("colors"),s=Ki("spacing"),g=Ki("blur"),v=Ki("brightness"),T=Ki("borderColor"),C=Ki("borderRadius"),w=Ki("borderSpacing"),c=Ki("borderWidth"),j=Ki("contrast"),q=Ki("grayscale"),K=Ki("hueRotate"),N=Ki("invert"),V=Ki("gap"),se=Ki("gradientColorStops"),ie=Ki("gradientColorStopPositions"),le=Ki("inset"),fe=Ki("margin"),Se=Ki("opacity"),ge=Ki("padding"),Ee=Ki("saturate"),Ne=Ki("scale"),Le=Ki("sepia"),We=Ki("skew"),tt=Ki("space"),Pt=Ki("translate"),$e=()=>["auto","contain","none"],nt=()=>["auto","hidden","clip","visible","scroll"],Re=()=>["auto",oi,s],Me=()=>[oi,s],De=()=>["",Hs,Fo],Ae=()=>["auto",Gl,oi],Ge=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Xe=()=>["solid","dashed","dotted","double","none"],ft=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],dt=()=>["start","end","center","between","around","evenly","stretch"],at=()=>["","0",oi],ut=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[Gl,oi];return{cacheSize:500,separator:":",theme:{colors:[Yu],spacing:[Hs,Fo],blur:["none","",Bo,oi],brightness:Mt(),borderColor:[h],borderRadius:["none","","full",Bo,oi],borderSpacing:Me(),borderWidth:De(),contrast:Mt(),grayscale:at(),hueRotate:Mt(),invert:at(),gap:Me(),gradientColorStops:[h],gradientColorStopPositions:[wS,Fo],inset:Re(),margin:Re(),opacity:Mt(),padding:Me(),saturate:Mt(),scale:Mt(),sepia:at(),skew:Mt(),space:Me(),translate:Me()},classGroups:{aspect:[{aspect:["auto","square","video",oi]}],container:["container"],columns:[{columns:[Bo]}],"break-after":[{"break-after":ut()}],"break-before":[{"break-before":ut()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ge(),oi]}],overflow:[{overflow:nt()}],"overflow-x":[{"overflow-x":nt()}],"overflow-y":[{"overflow-y":nt()}],overscroll:[{overscroll:$e()}],"overscroll-x":[{"overscroll-x":$e()}],"overscroll-y":[{"overscroll-y":$e()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[le]}],"inset-x":[{"inset-x":[le]}],"inset-y":[{"inset-y":[le]}],start:[{start:[le]}],end:[{end:[le]}],top:[{top:[le]}],right:[{right:[le]}],bottom:[{bottom:[le]}],left:[{left:[le]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ju,oi]}],basis:[{basis:Re()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",oi]}],grow:[{grow:at()}],shrink:[{shrink:at()}],order:[{order:["first","last","none",Ju,oi]}],"grid-cols":[{"grid-cols":[Yu]}],"col-start-end":[{col:["auto",{span:["full",Ju,oi]},oi]}],"col-start":[{"col-start":Ae()}],"col-end":[{"col-end":Ae()}],"grid-rows":[{"grid-rows":[Yu]}],"row-start-end":[{row:["auto",{span:[Ju,oi]},oi]}],"row-start":[{"row-start":Ae()}],"row-end":[{"row-end":Ae()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",oi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",oi]}],gap:[{gap:[V]}],"gap-x":[{"gap-x":[V]}],"gap-y":[{"gap-y":[V]}],"justify-content":[{justify:["normal",...dt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...dt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...dt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[ge]}],px:[{px:[ge]}],py:[{py:[ge]}],ps:[{ps:[ge]}],pe:[{pe:[ge]}],pt:[{pt:[ge]}],pr:[{pr:[ge]}],pb:[{pb:[ge]}],pl:[{pl:[ge]}],m:[{m:[fe]}],mx:[{mx:[fe]}],my:[{my:[fe]}],ms:[{ms:[fe]}],me:[{me:[fe]}],mt:[{mt:[fe]}],mr:[{mr:[fe]}],mb:[{mb:[fe]}],ml:[{ml:[fe]}],"space-x":[{"space-x":[tt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[tt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",oi,s]}],"min-w":[{"min-w":[oi,s,"min","max","fit"]}],"max-w":[{"max-w":[oi,s,"none","full","min","max","fit","prose",{screen:[Bo]},Bo]}],h:[{h:[oi,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[oi,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[oi,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[oi,s,"auto","min","max","fit"]}],"font-size":[{text:["base",Bo,Fo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",fy]}],"font-family":[{font:[Yu]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",oi]}],"line-clamp":[{"line-clamp":["none",Gl,fy]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Hs,oi]}],"list-image":[{"list-image":["none",oi]}],"list-style-type":[{list:["none","disc","decimal",oi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[h]}],"placeholder-opacity":[{"placeholder-opacity":[Se]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[h]}],"text-opacity":[{"text-opacity":[Se]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Xe(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Hs,Fo]}],"underline-offset":[{"underline-offset":["auto",Hs,oi]}],"text-decoration-color":[{decoration:[h]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Me()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",oi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",oi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Se]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ge(),PS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",TS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},CS]}],"bg-color":[{bg:[h]}],"gradient-from-pos":[{from:[ie]}],"gradient-via-pos":[{via:[ie]}],"gradient-to-pos":[{to:[ie]}],"gradient-from":[{from:[se]}],"gradient-via":[{via:[se]}],"gradient-to":[{to:[se]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[Se]}],"border-style":[{border:[...Xe(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Se]}],"divide-style":[{divide:Xe()}],"border-color":[{border:[T]}],"border-color-x":[{"border-x":[T]}],"border-color-y":[{"border-y":[T]}],"border-color-s":[{"border-s":[T]}],"border-color-e":[{"border-e":[T]}],"border-color-t":[{"border-t":[T]}],"border-color-r":[{"border-r":[T]}],"border-color-b":[{"border-b":[T]}],"border-color-l":[{"border-l":[T]}],"divide-color":[{divide:[T]}],"outline-style":[{outline:["",...Xe()]}],"outline-offset":[{"outline-offset":[Hs,oi]}],"outline-w":[{outline:[Hs,Fo]}],"outline-color":[{outline:[h]}],"ring-w":[{ring:De()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[h]}],"ring-opacity":[{"ring-opacity":[Se]}],"ring-offset-w":[{"ring-offset":[Hs,Fo]}],"ring-offset-color":[{"ring-offset":[h]}],shadow:[{shadow:["","inner","none",Bo,AS]}],"shadow-color":[{shadow:[Yu]}],opacity:[{opacity:[Se]}],"mix-blend":[{"mix-blend":[...ft(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":ft()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[v]}],contrast:[{contrast:[j]}],"drop-shadow":[{"drop-shadow":["","none",Bo,oi]}],grayscale:[{grayscale:[q]}],"hue-rotate":[{"hue-rotate":[K]}],invert:[{invert:[N]}],saturate:[{saturate:[Ee]}],sepia:[{sepia:[Le]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[v]}],"backdrop-contrast":[{"backdrop-contrast":[j]}],"backdrop-grayscale":[{"backdrop-grayscale":[q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[K]}],"backdrop-invert":[{"backdrop-invert":[N]}],"backdrop-opacity":[{"backdrop-opacity":[Se]}],"backdrop-saturate":[{"backdrop-saturate":[Ee]}],"backdrop-sepia":[{"backdrop-sepia":[Le]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",oi]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",oi]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",oi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Ne]}],"scale-x":[{"scale-x":[Ne]}],"scale-y":[{"scale-y":[Ne]}],rotate:[{rotate:[Ju,oi]}],"translate-x":[{"translate-x":[Pt]}],"translate-y":[{"translate-y":[Pt]}],"skew-x":[{"skew-x":[We]}],"skew-y":[{"skew-y":[We]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",oi]}],accent:[{accent:["auto",h]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",oi]}],"caret-color":[{caret:[h]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Me()}],"scroll-mx":[{"scroll-mx":Me()}],"scroll-my":[{"scroll-my":Me()}],"scroll-ms":[{"scroll-ms":Me()}],"scroll-me":[{"scroll-me":Me()}],"scroll-mt":[{"scroll-mt":Me()}],"scroll-mr":[{"scroll-mr":Me()}],"scroll-mb":[{"scroll-mb":Me()}],"scroll-ml":[{"scroll-ml":Me()}],"scroll-p":[{"scroll-p":Me()}],"scroll-px":[{"scroll-px":Me()}],"scroll-py":[{"scroll-py":Me()}],"scroll-ps":[{"scroll-ps":Me()}],"scroll-pe":[{"scroll-pe":Me()}],"scroll-pt":[{"scroll-pt":Me()}],"scroll-pr":[{"scroll-pr":Me()}],"scroll-pb":[{"scroll-pb":Me()}],"scroll-pl":[{"scroll-pl":Me()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",oi]}],fill:[{fill:[h,"none"]}],"stroke-w":[{stroke:[Hs,Fo,fy]}],stroke:[{stroke:[h,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},zS=(h,{cacheSize:s,prefix:g,separator:v,experimentalParseClassName:T,extend:C={},override:w={}})=>{nh(h,"cacheSize",s),nh(h,"prefix",g),nh(h,"separator",v),nh(h,"experimentalParseClassName",T);for(const c in w)DS(h[c],w[c]);for(const c in C)LS(h[c],C[c]);return h},nh=(h,s,g)=>{g!==void 0&&(h[s]=g)},DS=(h,s)=>{if(s)for(const g in s)nh(h,g,s[g])},LS=(h,s)=>{if(s)for(const g in s){const v=s[g];v!==void 0&&(h[g]=(h[g]||[]).concat(v))}},RS=(h,...s)=>typeof h=="function"?My(zy,h,...s):My(()=>zS(zy(),h),...s),vb=My(zy);var OS={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},xb=h=>h||void 0,oh=(...h)=>xb(hb(h).filter(Boolean).join(" ")),my=null,Ks={},Dy=!1,Qu=(...h)=>s=>s.twMerge?((!my||Dy)&&(Dy=!1,my=Tn(Ks)?vb:RS({...Ks,extend:{theme:Ks.theme,classGroups:Ks.classGroups,conflictingClassGroupModifiers:Ks.conflictingClassGroupModifiers,conflictingClassGroups:Ks.conflictingClassGroups,...Ks.extend}})),xb(my(oh(h)))):oh(h),m0=(h,s)=>{for(let g in s)h.hasOwnProperty(g)?h[g]=oh(h[g],s[g]):h[g]=s[g];return h},bb=(h,s)=>{let{extend:g=null,slots:v={},variants:T={},compoundVariants:C=[],compoundSlots:w=[],defaultVariants:c={}}=h,j={...OS,...s},q=g!=null&&g.base?oh(g.base,h==null?void 0:h.base):h==null?void 0:h.base,K=g!=null&&g.variants&&!Tn(g.variants)?pb(T,g.variants):T,N=g!=null&&g.defaultVariants&&!Tn(g.defaultVariants)?{...g.defaultVariants,...c}:c;!Tn(j.twMergeConfig)&&!iS(j.twMergeConfig,Ks)&&(Dy=!0,Ks=j.twMergeConfig);let V=Tn(g==null?void 0:g.slots),se=Tn(v)?{}:{base:oh(h==null?void 0:h.base,V&&(g==null?void 0:g.base)),...v},ie=V?se:m0({...g==null?void 0:g.slots},Tn(se)?{base:h==null?void 0:h.base}:se),le=Tn(g==null?void 0:g.compoundVariants)?C:db(g==null?void 0:g.compoundVariants,C),fe=ge=>{if(Tn(K)&&Tn(v)&&V)return Qu(q,ge==null?void 0:ge.class,ge==null?void 0:ge.className)(j);if(le&&!Array.isArray(le))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof le}`);if(w&&!Array.isArray(w))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof w}`);let Ee=(Me,De,Ae=[],Ge)=>{let Xe=Ae;if(typeof De=="string")Xe=Xe.concat(d0(De).split(" ").map(ft=>`${Me}:${ft}`));else if(Array.isArray(De))Xe=Xe.concat(De.reduce((ft,dt)=>ft.concat(`${Me}:${dt}`),[]));else if(typeof De=="object"&&typeof Ge=="string"){for(let ft in De)if(De.hasOwnProperty(ft)&&ft===Ge){let dt=De[ft];if(dt&&typeof dt=="string"){let at=d0(dt);Xe[Ge]?Xe[Ge]=Xe[Ge].concat(at.split(" ").map(ut=>`${Me}:${ut}`)):Xe[Ge]=at.split(" ").map(ut=>`${Me}:${ut}`)}else Array.isArray(dt)&&dt.length>0&&(Xe[Ge]=dt.reduce((at,ut)=>at.concat(`${Me}:${ut}`),[]))}}return Xe},Ne=(Me,De=K,Ae=null,Ge=null)=>{var Xe;let ft=De[Me];if(!ft||Tn(ft))return null;let dt=(Xe=Ge==null?void 0:Ge[Me])!=null?Xe:ge==null?void 0:ge[Me];if(dt===null)return null;let at=h0(dt),ut=Array.isArray(j.responsiveVariants)&&j.responsiveVariants.length>0||j.responsiveVariants===!0,Mt=N==null?void 0:N[Me],zt=[];if(typeof at=="object"&&ut)for(let[fi,Ni]of Object.entries(at)){let Ci=ft[Ni];if(fi==="initial"){Mt=Ni;continue}Array.isArray(j.responsiveVariants)&&!j.responsiveVariants.includes(fi)||(zt=Ee(fi,Ci,zt,Ae))}let ri=at!=null&&typeof at!="object"?at:h0(Mt),Jt=ft[ri||"false"];return typeof zt=="object"&&typeof Ae=="string"&&zt[Ae]?m0(zt,Jt):zt.length>0?(zt.push(Jt),Ae==="base"?zt.join(" "):zt):Jt},Le=()=>K?Object.keys(K).map(Me=>Ne(Me,K)):null,We=(Me,De)=>{if(!K||typeof K!="object")return null;let Ae=new Array;for(let Ge in K){let Xe=Ne(Ge,K,Me,De),ft=Me==="base"&&typeof Xe=="string"?Xe:Xe&&Xe[Me];ft&&(Ae[Ae.length]=ft)}return Ae},tt={};for(let Me in ge)ge[Me]!==void 0&&(tt[Me]=ge[Me]);let Pt=(Me,De)=>{var Ae;let Ge=typeof(ge==null?void 0:ge[Me])=="object"?{[Me]:(Ae=ge[Me])==null?void 0:Ae.initial}:{};return{...N,...tt,...Ge,...De}},$e=(Me=[],De)=>{let Ae=[];for(let{class:Ge,className:Xe,...ft}of Me){let dt=!0;for(let[at,ut]of Object.entries(ft)){let Mt=Pt(at,De)[at];if(Array.isArray(ut)){if(!ut.includes(Mt)){dt=!1;break}}else{let zt=ri=>ri==null||ri===!1;if(zt(ut)&&zt(Mt))continue;if(Mt!==ut){dt=!1;break}}}dt&&(Ge&&Ae.push(Ge),Xe&&Ae.push(Xe))}return Ae},nt=Me=>{let De=$e(le,Me);if(!Array.isArray(De))return De;let Ae={};for(let Ge of De)if(typeof Ge=="string"&&(Ae.base=Qu(Ae.base,Ge)(j)),typeof Ge=="object")for(let[Xe,ft]of Object.entries(Ge))Ae[Xe]=Qu(Ae[Xe],ft)(j);return Ae},Re=Me=>{if(w.length<1)return null;let De={};for(let{slots:Ae=[],class:Ge,className:Xe,...ft}of w){if(!Tn(ft)){let dt=!0;for(let at of Object.keys(ft)){let ut=Pt(at,Me)[at];if(ut===void 0||(Array.isArray(ft[at])?!ft[at].includes(ut):ft[at]!==ut)){dt=!1;break}}if(!dt)continue}for(let dt of Ae)De[dt]=De[dt]||[],De[dt].push([Ge,Xe])}return De};if(!Tn(v)||!V){let Me={};if(typeof ie=="object"&&!Tn(ie))for(let De of Object.keys(ie))Me[De]=Ae=>{var Ge,Xe;return Qu(ie[De],We(De,Ae),((Ge=nt(Ae))!=null?Ge:[])[De],((Xe=Re(Ae))!=null?Xe:[])[De],Ae==null?void 0:Ae.class,Ae==null?void 0:Ae.className)(j)};return Me}return Qu(q,Le(),$e(le),ge==null?void 0:ge.class,ge==null?void 0:ge.className)(j)},Se=()=>{if(!(!K||typeof K!="object"))return Object.keys(K)};return fe.variantKeys=Se(),fe.extend=g,fe.base=q,fe.slots=ie,fe.variants=K,fe.defaultVariants=N,fe.compoundSlots=w,fe.compoundVariants=le,fe};function wb(h){var s,g,v="";if(typeof h=="string"||typeof h=="number")v+=h;else if(typeof h=="object")if(Array.isArray(h)){var T=h.length;for(s=0;s<T;s++)h[s]&&(g=wb(h[s]))&&(v&&(v+=" "),v+=g)}else for(g in h)h[g]&&(v&&(v+=" "),v+=g);return v}function Sb(){for(var h,s,g=0,v="",T=arguments.length;g<T;g++)(h=arguments[g])&&(s=wb(h))&&(v&&(v+=" "),v+=s);return v}const g0=30;function Ui(...h){return vb(Sb(h))}function gy(h){const[s,g]=h.split(":").map(Number);return s*60+g}function _0(h,s,g=new Date){if(h===void 0)return"Closed";if(h.alwaysOpen)return"Open";const v={weekday:"long",hour:"2-digit",minute:"2-digit",hourCycle:"h23"};s&&(v.timeZone=s);const C=new Intl.DateTimeFormat("en-US",v).formatToParts(g);let w,c,j;for(const K of C)K.type==="weekday"?w=K.value.toLowerCase():K.type==="hour"?c=K.value:K.type==="minute"&&(j=K.value);if(!w||!c||!j)throw new Error("Failed to parse current time information.");const q=gy(`${c}:${j}`);for(const K of h.hours[w]||[]){const N=gy(K.open),V=gy(K.close);if(q>=N&&q<V)return V-q<=g0?"Closing Soon":"Open";if(q<N)return N-q<=g0?"Opening Soon":"Closed"}return"Closed"}const y0=bb({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var FS=Et("<a><!></a>"),BS=Et("<button><!></button>");function Ly(h,s){Ct(s,!0);let g=ee(s,"variant",3,"default"),v=ee(s,"size",3,"default"),T=ee(s,"ref",15,null),C=ee(s,"href",3,void 0),w=ee(s,"type",3,"button"),c=Kt(s,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const j=Ep(),[q,K]=j;var N=rt(),V=Ve(N);{var se=le=>{var fe=FS();const Se=Pe(()=>K({class:Ui(y0({variant:g(),size:v(),className:s.class})),href:C(),...c},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let ge;var Ee=Zt(fe);Bt(Ee,()=>s.children??ii),jt(fe),Cs(fe,Ne=>T(Ne),()=>T()),Lt(()=>ge=Mi(fe,ge,{...L(Se)})),be(le,fe)},ie=le=>{var fe=BS();const Se=Pe(()=>K({class:Ui(y0({variant:g(),size:v(),className:s.class})),type:w(),...c},[{attribute_name:"formaction"}]));let ge;var Ee=Zt(fe);Bt(Ee,()=>s.children??ii),jt(fe),Cs(fe,Ne=>T(Ne),()=>T()),Lt(()=>ge=Mi(fe,ge,{...L(Se)})),be(le,fe)};gi(V,le=>{C()?le(se):le(ie,!1)})}be(h,N),At()}const NS=()=>"Campus Study Spots",VS=()=>"Lieux d'Étude sur le Campus",jS=(h={},s={})=>({en:NS,fr:VS})[s.languageTag??yi()](),US=()=>"Select a campus...",qS=()=>"Sélectionner un campus...",ZS=(h={},s={})=>({en:US,fr:qS})[s.languageTag??yi()](),GS=()=>"Search campuses...",WS=()=>"Rechercher des campus...",HS=(h={},s={})=>({en:GS,fr:WS})[s.languageTag??yi()](),XS=()=>"No campus found.",KS=()=>"Aucun campus trouvé.",$S=(h={},s={})=>({en:XS,fr:KS})[s.languageTag??yi()](),JS=()=>"Colors indicate open status of the spaces.",YS=()=>"Les couleurs indiquent le statut ouvert des espaces.",QS=(h={},s={})=>({en:JS,fr:YS})[s.languageTag??yi()](),eT=()=>"Legend",tT=()=>"Légende",iT=(h={},s={})=>({en:eT,fr:tT})[s.languageTag??yi()](),rT=()=>"Toggle theme",nT=()=>"Changer le thème",sT=(h={},s={})=>({en:rT,fr:nT})[s.languageTag??yi()](),oT=()=>"Toggle language",aT=()=>"Changer de langue",lT=(h={},s={})=>({en:oT,fr:aT})[s.languageTag??yi()](),cT=()=>"Open",uT=()=>"Ouvert",hT=(h={},s={})=>({en:cT,fr:uT})[s.languageTag??yi()](),dT=()=>"Closed",pT=()=>"Fermé",Tb=(h={},s={})=>({en:dT,fr:pT})[s.languageTag??yi()](),fT=()=>"Opening Soon",mT=()=>"Ouvre bientôt",gT=(h={},s={})=>({en:fT,fr:mT})[s.languageTag??yi()](),_T=()=>"Closing Soon",yT=()=>"Ferme bientôt",vT=(h={},s={})=>({en:_T,fr:yT})[s.languageTag??yi()](),xT=()=>"Included Amenities",bT=()=>"Commodités Incluses",wT=(h={},s={})=>({en:xT,fr:bT})[s.languageTag??yi()](),ST=()=>"Computers",TT=()=>"Ordinateurs",PT=(h={},s={})=>({en:ST,fr:TT})[s.languageTag??yi()](),IT=()=>"Outlets",CT=()=>"Prises",AT=(h={},s={})=>({en:IT,fr:CT})[s.languageTag??yi()](),kT=()=>"Printing",ET=()=>"Impression",MT=(h={},s={})=>({en:kT,fr:ET})[s.languageTag??yi()](),zT=()=>"Rooms",DT=()=>"Salles",LT=(h={},s={})=>({en:zT,fr:DT})[s.languageTag??yi()](),RT=()=>"Water Fountains",OT=()=>"Fontaines d'eau",FT=(h={},s={})=>({en:RT,fr:OT})[s.languageTag??yi()](),BT=()=>"WiFi",NT=()=>"Wi-Fi",VT=(h={},s={})=>({en:BT,fr:NT})[s.languageTag??yi()](),jT=()=>"Google Maps",UT=()=>"Google Maps",qT=(h={},s={})=>({en:jT,fr:UT})[s.languageTag??yi()](),ZT=()=>"Directions",GT=()=>"Directions",WT=(h={},s={})=>({en:ZT,fr:GT})[s.languageTag??yi()](),HT=()=>"Always Open!",XT=()=>"Toujours ouvert !",KT=(h={},s={})=>({en:HT,fr:XT})[s.languageTag??yi()](),$T=()=>"Hours",JT=()=>"Heures",YT=(h={},s={})=>({en:$T,fr:JT})[s.languageTag??yi()](),QT=()=>"Monday",eP=()=>"Lundi",tP=(h={},s={})=>({en:QT,fr:eP})[s.languageTag??yi()](),iP=()=>"Tuesday",rP=()=>"Mardi",nP=(h={},s={})=>({en:iP,fr:rP})[s.languageTag??yi()](),sP=()=>"Wednesday",oP=()=>"Mercredi",aP=(h={},s={})=>({en:sP,fr:oP})[s.languageTag??yi()](),lP=()=>"Thursday",cP=()=>"Jeudi",uP=(h={},s={})=>({en:lP,fr:cP})[s.languageTag??yi()](),hP=()=>"Friday",dP=()=>"Vendredi",pP=(h={},s={})=>({en:hP,fr:dP})[s.languageTag??yi()](),fP=()=>"Saturday",mP=()=>"Samedi",gP=(h={},s={})=>({en:fP,fr:mP})[s.languageTag??yi()](),_P=()=>"Sunday",yP=()=>"Dimanche",vP=(h={},s={})=>({en:_P,fr:yP})[s.languageTag??yi()]();/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xP={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var bP=w2("<svg><!><!></svg>");function qn(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]),v=qr(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ct(s,!1);let T=ee(s,"name",8,void 0),C=ee(s,"color",8,"currentColor"),w=ee(s,"size",8,24),c=ee(s,"strokeWidth",8,2),j=ee(s,"absoluteStrokeWidth",8,!1),q=ee(s,"iconNode",24,()=>[]);const K=(...ge)=>ge.filter((Ee,Ne,Le)=>!!Ee&&Le.indexOf(Ee)===Ne).join(" "),N=Ep(),[V,se]=N;Xy();var ie=bP();let le;var fe=Zt(ie);ql(fe,1,q,Zl,(ge,Ee)=>{let Ne=()=>L(Ee)[0],Le=()=>L(Ee)[1];var We=rt(),tt=Ve(We);const Pt=Ng(()=>`${Ne()}`=="button"?se({...Le()},[{attribute_name:"formaction"}]):`${Ne()}`=="form"?se({...Le()},[{attribute_name:"action"}]):`${Ne()}`=="a"?se({...Le()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...Le()});lb(tt,Ne,!0,($e,nt)=>{let Re;Lt(()=>Re=Mi($e,Re,{...L(Pt)},void 0,$e.namespaceURI===Wy,$e.nodeName.includes("-")))}),be(ge,We)});var Se=Qt(fe);Pn(Se,s,"default",{}),jt(ie),Lt(()=>le=Mi(ie,le,{...xP,...v,width:w(),height:w(),stroke:C(),"stroke-width":j()?Number(c())*24/Number(w()):c(),class:K("lucide-icon","lucide",T()?`lucide-${T()}`:"",g.class)},void 0,!0)),be(h,ie),At()}function wP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"box"},()=>g,{iconNode:[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"}],["path",{d:"m3.3 7 8.7 5 8.7-5"}],["path",{d:"M12 22V12"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function SP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function TP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function PP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"computer"},()=>g,{iconNode:[["rect",{width:"14",height:"8",x:"5",y:"2",rx:"2"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2"}],["path",{d:"M6 18h2"}],["path",{d:"M12 18h6"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function IP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"corner-down-right"},()=>g,{iconNode:[["polyline",{points:"15 10 20 15 15 20"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function CP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"droplet"},()=>g,{iconNode:[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function AP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"external-link"},()=>g,{iconNode:[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function kP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function EP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"plug"},()=>g,{iconNode:[["path",{d:"M12 22v-5"}],["path",{d:"M9 8V2"}],["path",{d:"M15 8V2"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function MP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"printer"},()=>g,{iconNode:[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function zP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function DP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}function LP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]);qn(h,$t({name:"wifi"},()=>g,{iconNode:[["path",{d:"M12 20h.01"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}]],children:(T,C)=>{var w=rt(),c=Ve(w);Pn(c,s,"default",{}),be(T,w)},$$slots:{default:!0}}))}var Xl,uh,jo,Ra,sa,Ry,Oy,$0;let RP=($0=class{constructor(s,g){X(this,sa);X(this,Xl,Je());X(this,uh);X(this,jo,0);X(this,Ra,null);I(this,Xl).v=je(s),Ze(this,uh,g)}get current(){return rb()?Tt(()=>($u(this,jo)._++,I(this,jo)===1&&Nr(this,sa,Ry).call(this,!0),()=>{Vg().then(()=>{$u(this,jo)._--,I(this,jo)===0&&Nr(this,sa,Oy).call(this)})})):I(this,jo)===0&&(Nr(this,sa,Ry).call(this,!1),Nr(this,sa,Oy).call(this)),L(I(this,Xl))}},Xl=new WeakMap,uh=new WeakMap,jo=new WeakMap,Ra=new WeakMap,sa=new WeakSet,Ry=function(s){Ze(this,Ra,I(this,uh).call(this,g=>{Be(I(this,Xl),je(g))},s)??null)},Oy=function(){I(this,Ra)!==null&&(I(this,Ra).call(this),Ze(this,Ra,null))},$0);new RP(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function OP(h,s,g,v){const T=Array.isArray(s)?s:[s];for(const C of T)h.addEventListener(C,g,v);return()=>{for(const C of T)h.removeEventListener(C,g,v)}}function v0({key:h,storage:s,serializer:g}){if(!s)return{found:!1,value:null};const v=s.getItem(h);if(v===null)return{found:!1,value:null};try{return{found:!0,value:g.deserialize(v)}}catch(T){return console.error(`Error when parsing ${v} from persisted store "${h}"`,T),{found:!1,value:null}}}function FP({key:h,value:s,storage:g,serializer:v}){if(g)try{g.setItem(h,v.serialize(s))}catch(T){console.error(`Error when writing value from persisted store "${h}" to ${g}`,T)}}function BP(h){return typeof window>"u"?null:{local:localStorage,session:sessionStorage}[h]}var Uo,qo,Zo,Oa,om,Ib;class Pb{constructor(s,g,v={}){X(this,om);X(this,Uo,Je());X(this,qo);X(this,Zo);X(this,Oa);const{storage:T="local",serializer:C={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:w=!0}=v;Ze(this,qo,s),Ze(this,Zo,BP(T)),Ze(this,Oa,C);const c=v0({key:I(this,qo),storage:I(this,Zo),serializer:I(this,Oa)});I(this,Uo).v=je(c.found?c.value:g),Tt(()=>{FP({key:I(this,qo),value:L(I(this,Uo)),storage:I(this,Zo),serializer:I(this,Oa)})}),Tt(()=>{if(w)return OP(window,"storage",Nr(this,om,Ib).bind(this))})}get current(){return L(I(this,Uo))}set current(s){Be(I(this,Uo),je(s))}}Uo=new WeakMap,qo=new WeakMap,Zo=new WeakMap,Oa=new WeakMap,om=new WeakSet,Ib=function(s){if(s.key!==I(this,qo)||!I(this,Zo))return;const g=v0({key:I(this,qo),storage:I(this,Zo),serializer:I(this,Oa)});g.found&&Be(I(this,Uo),je(g.value))};var NP=Et('<!> <!> <span class="sr-only"> </span>',1),VP=Et(' <span class="sr-only"> </span>',1),jP=Et('<div class="absolute right-2.5 top-2.5 z-10 flex flex-col gap-y-2"><!> <!></div>');function UP(h,s){Ct(s,!1);const g=J0(),v=()=>Y0(S2,"$page",g),T=V2(new Pb("language","fr"));function C(){L(T).current==="en"?a0(T,L(T).current="fr"):L(T).current==="fr"&&a0(T,L(T).current="en"),H2(L(T).current);const q=c0.route(v().url.pathname),K=c0.resolveRoute(q,L(T).current);j2(K)}Xy();var w=jP(),c=Zt(w);Ly(c,{onclick:X2,variant:"outline",size:"icon",children:(q,K)=>{var N=NP(),V=Ve(N);DP(V,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var se=Qt(V,2);kP(se,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"});var ie=Qt(se,2),le=Zt(ie,!0);Lt(()=>Gi(le,sT())),jt(ie),be(q,N)},$$slots:{default:!0}});var j=Qt(c,2);Ly(j,{onclick:C,variant:"outline",size:"icon",class:"uppercase",children:(q,K)=>{ta();var N=VP(),V=Ve(N),se=Qt(V),ie=Zt(se,!0);Lt(()=>Gi(ie,lT())),jt(se),Lt(()=>Gi(V,`${L(T).current??""} `)),be(q,N)},$$slots:{default:!0}}),jt(w),be(h,w),At()}function qP(h,s){let g=Kt(s,["$$slots","$$events","$$legacy","amenity"]);({Computers:PP,Outlets:EP,Printing:MP,Rooms:wP,"Water Fountains":CP,WiFi:LP}[s.amenity]??IP)(h,$t({class:"h-fit w-fit scale-75"},()=>g))}var ZP=Et("<div></div>");function GP(h,s){const g=qr(s,["children","$$slots","$$events","$$legacy"]),v=qr(g,["class"]);Ct(s,!1);let T=ee(s,"class",8,void 0);Xy();var C=ZP();let w;Lt(()=>w=Mi(C,w,{class:Ui("animate-pulse rounded-md bg-muted",T()),...v})),be(h,C),At()}function Cb(){var h=Object.create(null);function s(g){delete h[g]}this.set=function(g,v,T){if(T!==void 0&&(typeof T!="number"||isNaN(T)||T<=0))throw new Error("Cache timeout must be a positive number");var C=h[g];C&&clearTimeout(C.timeout);var w={value:v,expire:T+Date.now()};return isNaN(w.expire)||(w.timeout=setTimeout(()=>s(g),T)),h[g]=w,v},this.del=function(g){var v=!0,T=h[g];return T?(clearTimeout(T.timeout),!isNaN(T.expire)&&T.expire<Date.now()&&(v=!1)):v=!1,v&&s(g),v},this.clear=function(){for(var g in h)clearTimeout(h[g].timeout);h=Object.create(null)},this.get=function(g){var v=h[g];if(v!==void 0){if(isNaN(v.expire)||v.expire>=Date.now())return v.value;delete h[g]}return null}}const Fy=new Cb;Fy.Cache=Cb;const WP="https://translate.googleapis.com/translate_a/single";var HP={fetch:({key:h,from:s,to:g,text:v})=>[`${WP}?client=gtx&sl=${s}&tl=${g}&dt=t&q=${encodeURIComponent(v)}`],parse:h=>h.json().then(s=>{if(!(s=s&&s[0]&&s[0][0]&&s[0].map(g=>g[0]).join("")))throw new Error("Translation not found");return s})},XP={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://translate.yandex.net/api/v1.5/tr.json/translate?key=${h}&lang=${s}-${g}&text=${encodeURIComponent(v)}`,{method:"POST",body:""}],parse:h=>h.json().then(s=>{if(s.code!==200)throw new Error(s.message);return s.text[0]})};const KP="https://libretranslate.com/translate";var $P={needkey:!1,fetch:({url:h=KP,key:s,from:g,to:v,text:T})=>[h,{method:"POST",body:JSON.stringify({q:T,source:g,target:v,api_key:s}),headers:{"Content-Type":"application/json"}}],parse:h=>h.json().then(s=>{if(!s)throw new Error("No response found");if(s.error)throw new Error(s.error);if(!s.translatedText)throw new Error("No response found");return s.translatedText})},JP={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://api${h.endsWith(":fx")?"-free":""}.deepl.com/v2/translate?auth_key=${h}&source_lang=${s}&target_lang=${g}&text=${v=encodeURIComponent(v)}`,{method:"POST",body:""}],parse:async h=>{if(!h.ok)throw h.status===403?new Error("Auth Error, please review the key for DeepL"):new Error(`Error ${h.status}`);return h.json().then(s=>s.translations[0].text)}},YP={google:HP,yandex:XP,libre:$P,deepl:JP},Ab={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cze:"cs",dan:"da",div:"dv",dut:"nl",dzo:"dz",eng:"en",epo:"eo",est:"et",ewe:"ee",fao:"fo",fij:"fj",fin:"fi",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mlg:"mg",mlt:"mt",mon:"mn",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zul:"zu"},QP={afar:"aa",abkhazian:"ab",afrikaans:"af",akan:"ak",albanian:"sq",amharic:"am",arabic:"ar",aragonese:"an",armenian:"hy",assamese:"as",avaric:"av",avestan:"ae",aymara:"ay",azerbaijani:"az",bashkir:"ba",bambara:"bm",basque:"eu",belarusian:"be",bengali:"bn","bihari languages":"bh",bislama:"bi",tibetan:"bo",bosnian:"bs",breton:"br",bulgarian:"bg",burmese:"my",catalan:"ca",valencian:"ca",czech:"cs",chamorro:"ch",chechen:"ce",chinese:"zh","church slavic":"cu","old slavonic":"cu","church slavonic":"cu","old bulgarian":"cu","old church slavonic":"cu",chuvash:"cv",cornish:"kw",corsican:"co",cree:"cr",welsh:"cy",danish:"da",german:"de",divehi:"dv",dhivehi:"dv",maldivian:"dv",dutch:"nl",flemish:"nl",dzongkha:"dz",greek:"el",english:"en",esperanto:"eo",estonian:"et",ewe:"ee",faroese:"fo",persian:"fa",fijian:"fj",finnish:"fi",french:"fr","western frisian":"fy",fulah:"ff",georgian:"ka",gaelic:"gd","scottish gaelic":"gd",irish:"ga",galician:"gl",manx:"gv",guarani:"gn",gujarati:"gu",haitian:"ht","haitian creole":"ht",hausa:"ha",hebrew:"he",herero:"hz",hindi:"hi","hiri motu":"ho",croatian:"hr",hungarian:"hu",igbo:"ig",icelandic:"is",ido:"io","sichuan yi":"ii",nuosu:"ii",inuktitut:"iu",interlingue:"ie",occidental:"ie",interlingua:"ia",indonesian:"id",inupiaq:"ik",italian:"it",javanese:"jv",japanese:"ja",kalaallisut:"kl",greenlandic:"kl",kannada:"kn",kashmiri:"ks",kanuri:"kr",kazakh:"kk","central khmer":"km",kikuyu:"ki",gikuyu:"ki",kinyarwanda:"rw",kirghiz:"ky",kyrgyz:"ky",komi:"kv",kongo:"kg",korean:"ko",kuanyama:"kj",kwanyama:"kj",kurdish:"ku",lao:"lo",latin:"la",latvian:"lv",limburgan:"li",limburger:"li",limburgish:"li",lingala:"ln",lithuanian:"lt",luxembourgish:"lb",letzeburgesch:"lb","luba-katanga":"lu",ganda:"lg",macedonian:"mk",marshallese:"mh",malayalam:"ml",maori:"mi",marathi:"mr",malay:"ms",malagasy:"mg",maltese:"mt",mongolian:"mn",nauru:"na",navajo:"nv",navaho:"nv","ndebele, south":"nr","south ndebele":"nr","ndebele, north":"nd","north ndebele":"nd",ndonga:"ng",nepali:"ne","norwegian nynorsk":"nn","nynorsk, norwegian":"nn","norwegian bokmål":"nb","bokmål, norwegian":"nb",norwegian:"no",chichewa:"ny",chewa:"ny",nyanja:"ny",occitan:"oc",ojibwa:"oj",oriya:"or",oromo:"om",ossetian:"os",ossetic:"os",panjabi:"pa",punjabi:"pa",pali:"pi",polish:"pl",portuguese:"pt",pushto:"ps",pashto:"ps",quechua:"qu",romansh:"rm",romanian:"ro",moldavian:"ro",moldovan:"ro",rundi:"rn",russian:"ru",sango:"sg",sanskrit:"sa",sinhala:"si",sinhalese:"si",slovak:"sk",slovenian:"sl","northern sami":"se",samoan:"sm",shona:"sn",sindhi:"sd",somali:"so","sotho, southern":"st",spanish:"es",castilian:"es",sardinian:"sc",serbian:"sr",swati:"ss",sundanese:"su",swahili:"sw",swedish:"sv",tahitian:"ty",tamil:"ta",tatar:"tt",telugu:"te",tajik:"tg",tagalog:"tl",thai:"th",tigrinya:"ti",tonga:"to",tswana:"tn",tsonga:"ts",turkmen:"tk",turkish:"tr",twi:"tw",uighur:"ug",uyghur:"ug",ukrainian:"uk",urdu:"ur",uzbek:"uz",venda:"ve",vietnamese:"vi",volapük:"vo",walloon:"wa",wolof:"wo",xhosa:"xh",yiddish:"yi",yoruba:"yo",zhuang:"za",chuang:"za",zulu:"zu"};const eI=Object.values(Ab).sort();var _y=h=>{if(typeof h!="string")throw new Error('The "language" must be a string, received '+typeof h);if(h.length>100)throw new Error(`The "language" is too long at ${h.length} characters`);if(h=h.toLowerCase(),h=QP[h]||Ab[h]||h,!eI.includes(h))throw new Error(`The language "${h}" is not part of the ISO 639-1`);return h};const Qf=function(h={}){if(!(this instanceof Qf))return new Qf(h);const s={from:"en",to:"en",cache:void 0,engine:"google",key:void 0,url:void 0,languages:_y,engines:YP,keys:{}},g=async(v,T={})=>{typeof T=="string"&&(T={to:T});const C=Object.keys(T).find(q=>q!=="from"&&q!=="to");if(C)throw new Error(`Invalid option with the name '${C}'`);T.text=v,T.from=_y(T.from||g.from),T.to=_y(T.to||g.to),T.cache=g.cache,T.engine=g.engine,T.url=g.url,T.id=`${T.url}:${T.from}:${T.to}:${T.engine}:${T.text}`,T.keys=g.keys||{};for(let q in g.keys)T.keys[q]=T.keys[q]||g.keys[q];T.key=T.key||g.key||T.keys[T.engine];const w=g.engines[T.engine],c=Fy.get(T.id);if(c)return Promise.resolve(c);if(T.to===T.from)return Promise.resolve(T.text);if(w.needkey&&!T.key)throw new Error(`The engine "${T.engine}" needs a key, please provide it`);const j=w.fetch(T);return fetch(...j).then(w.parse).then(q=>Fy.set(T.id,q,T.cache))};for(let v in s)g[v]=h[v]===void 0?s[v]:h[v];return g},em=new Qf;em.Translate=Qf;var tI=Et('<div class="flex flex-col gap-y-2"></div>'),iI=Et('<li class="flex gap-x-1 ps-1"><!> <span> </span></li>'),rI=Et('<ul class="mb-3"><h2 class="mb-1 font-semibold"> </h2> <!></ul>'),nI=Et("<span> </span>"),sI=Et("<span> </span>"),oI=Et("<span> </span>"),aI=Et('<li class="flex justify-between gap-x-1"><span class="first-letter:uppercase"> </span> <!></li>'),lI=Et("<ul></ul>"),cI=Et('<div class="mb-3"><!></div> <!> <div class="mb-3"><h2 class="font-semibold"> </h2> <a class="flex gap-x-1 hover:underline" target="_blank" rel="noopener noreferrer"><span> </span> <!></a></div> <div><h2 class="font-semibold"> </h2> <!></div>',1);function uI(h,s){Ct(s,!0);const g={Computers:PT(),Outlets:AT(),Printing:MT(),Rooms:LT(),"Water Fountains":FT(),WiFi:VT()},v={monday:tP(),tuesday:nP(),wednesday:aP(),thursday:uP(),friday:pP(),saturday:gP(),sunday:vP()};function T(nt){var Re;return nt===void 0?"":((Re=nt.metadata)==null?void 0:Re.link)??`https://www.google.com/maps?q=${nt.location.lat},${nt.location.lng}`}const C=Ep(),[w,c]=C;var j=cI(),q=Ve(j),K=Zt(q);Ay(K,()=>em(s.space.description,yi()),nt=>{var Re=tI();ql(Re,20,()=>Array(3),Zl,(Me,De)=>{GP(Me,{class:"h-4 w-full"})}),jt(Re),be(nt,Re)},(nt,Re)=>{var Me=en();Lt(()=>Gi(Me,L(Re))),be(nt,Me)},nt=>{var Re=en();Lt(()=>Gi(Re,s.space.description)),be(nt,Re)}),jt(q);var N=Qt(q,2);{var V=nt=>{var Re=rI(),Me=Zt(Re),De=Zt(Me,!0);Lt(()=>Gi(De,wT())),jt(Me);var Ae=Qt(Me,2);ql(Ae,17,()=>{var Ge;return(Ge=s.space.metadata)==null?void 0:Ge.amenities.slice().sort()},Zl,(Ge,Xe)=>{var ft=iI(),dt=Zt(ft);qP(dt,{get amenity(){return L(Xe)}});var at=Qt(dt,2),ut=Zt(at,!0);jt(at),jt(ft),Lt(()=>Gi(ut,g[L(Xe)])),be(Ge,ft)}),jt(Re),be(nt,Re)};gi(N,nt=>{var Re;(Re=s.space.metadata)!=null&&Re.amenities&&nt(V)})}var se=Qt(N,2),ie=Zt(se),le=Zt(ie,!0);Lt(()=>Gi(le,WT())),jt(ie);var fe=Qt(ie,2);Lt(()=>Yf(fe,"href",w(T(s.space),void 0)));var Se=Zt(fe),ge=Zt(Se,!0);Lt(()=>Gi(ge,qT())),jt(Se);var Ee=Qt(Se,2);AP(Ee,{class:"h-fit w-fit scale-75"}),jt(fe),jt(se);var Ne=Qt(se,2),Le=Zt(Ne),We=Zt(Le,!0);Lt(()=>Gi(We,YT())),jt(Le);var tt=Qt(Le,2);{var Pt=nt=>{var Re=nI(),Me=Zt(Re,!0);Lt(()=>Gi(Me,KT())),jt(Re),be(nt,Re)},$e=nt=>{var Re=lI();ql(Re,21,()=>Object.entries(s.space.hours),Zl,(Me,De)=>{let Ae=()=>L(De)[0],Ge=()=>L(De)[1];var Xe=aI(),ft=Zt(Xe),dt=Zt(ft,!0);jt(ft);var at=Qt(ft,2);{var ut=zt=>{var ri=sI(),Jt=Zt(ri,!0);Lt(()=>Gi(Jt,Ge().map(fi=>`${fi.open} - ${fi.close}`).join(", "))),jt(ri),be(zt,ri)},Mt=zt=>{var ri=oI(),Jt=Zt(ri,!0);Lt(()=>Gi(Jt,Tb())),jt(ri),be(zt,ri)};gi(at,zt=>{Ge().length>0?zt(ut):zt(Mt,!1)})}jt(Xe),Lt(()=>Gi(dt,v[Ae()])),be(Me,Xe)}),jt(Re),be(nt,Re)};gi(tt,nt=>{s.space.alwaysOpen?nt(Pt):nt($e,!1)})}jt(Ne),be(h,j),At()}var hI=Et('<div class="group flex h-16 w-16 cursor-pointer items-center justify-center"><div>&nbsp;</div></div>');function dI(h,s){Ct(s,!0);const g={Open:"bg-green-400 shadow-green-400 group-hover:bg-green-500 group-hover:shadow-green-500",Closed:"bg-red-400 shadow-red-400 group-hover:bg-red-500 group-hover:shadow-red-500","Opening Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500","Closing Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500"};var v=hI(),T=Zt(v);const C=Pe(()=>Ui(g[s.status],"h-2 w-2 rounded-full shadow-3xl"));jt(v),Lt(()=>cb(T,L(C))),be(h,v),At()}const Nf=bb({base:"focus:ring-ring inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80 border-transparent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border-transparent",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80 border-transparent",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function pI(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"variant",3,"default"),T=Kt(s,["$$slots","$$events","$$legacy","ref","href","class","variant","children"]);const C=Ep(),[w,c]=C;var j=rt(),q=Ve(j);const K=Pe(()=>`${s.href?"a":"span"}`=="button"?c({href:s.href,class:Ui(Nf({variant:v(),className:s.class})),...T},[{attribute_name:"formaction"}]):`${s.href?"a":"span"}`=="form"?c({href:s.href,class:Ui(Nf({variant:v(),className:s.class})),...T},[{attribute_name:"action"}]):`${s.href?"a":"span"}`=="a"?c({href:s.href,class:Ui(Nf({variant:v(),className:s.class})),...T},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{href:s.href,class:Ui(Nf({variant:v(),className:s.class})),...T});lb(q,()=>s.href?"a":"span",!1,(N,V)=>{Cs(N,fe=>g(fe),()=>g());let se;Lt(()=>se=Mi(N,se,{...L(K)},void 0,N.namespaceURI===Wy,N.nodeName.includes("-")));var ie=rt(),le=Ve(ie);Bt(le,()=>s.children??ii),be(V,ie)}),be(h,j),At()}function Vf(h,s){Ct(s,!0);let g=Kt(s,["$$slots","$$events","$$legacy","status","class"]);const v={Open:hT(),Closed:Tb(),"Opening Soon":gT(),"Closing Soon":vT()},T={Open:"bg-green-400 hover:bg-green-500",Closed:"bg-red-400 hover:bg-red-500","Opening Soon":"bg-yellow-400 hover:bg-yellow-500","Closing Soon":"bg-yellow-400 hover:bg-yellow-500"};var C=Pe(()=>Ui(T[s.status],"border-transparent",s.class));pI(h,$t({get class(){return L(C)}},()=>g,{children:(w,c)=>{ta();var j=en();Lt(()=>Gi(j,v[s.status])),be(w,j)},$$slots:{default:!0}})),At()}var fI=Et("<div><!></div>");function mI(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=fI();let C;var w=Zt(T);Bt(w,()=>s.children??ii),jt(T),Cs(T,c=>g(c),()=>g()),Lt(()=>C=Mi(T,C,{class:Ui("p-6",s.class),...v})),be(h,T),At()}var gI=Et("<p><!></p>");function _I(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=gI();let C;var w=Zt(T);Bt(w,()=>s.children??ii),jt(T),Cs(T,c=>g(c),()=>g()),Lt(()=>C=Mi(T,C,{class:Ui("text-sm text-muted-foreground",s.class),...v})),be(h,T),At()}var yI=Et("<div><!></div>");function vI(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=yI();let C;var w=Zt(T);Bt(w,()=>s.children??ii),jt(T),Cs(T,c=>g(c),()=>g()),Lt(()=>C=Mi(T,C,{class:Ui("flex flex-col space-y-1.5 p-6 pb-0",s.class),...v})),be(h,T),At()}var xI=Et("<div><!></div>");function bI(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"level",3,3),T=Kt(s,["$$slots","$$events","$$legacy","ref","class","level","children"]);var C=xI();let w;var c=Zt(C);Bt(c,()=>s.children??ii),jt(C),Cs(C,j=>g(j),()=>g()),Lt(()=>w=Mi(C,w,{role:"heading","aria-level":v(),class:Ui("text-2xl font-semibold leading-none tracking-tight",s.class),...T})),be(h,C),At()}var wI=Et("<div><!></div>");function SI(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=wI();let C;var w=Zt(T);Bt(w,()=>s.children??ii),jt(T),Cs(T,c=>g(c),()=>g()),Lt(()=>C=Mi(T,C,{class:Ui("rounded-lg border bg-card text-card-foreground shadow-sm",s.class),...v})),be(h,T),At()}function TI(h){return typeof h=="function"}function PI(h){return h!==null&&typeof h=="object"}const ah=Symbol("box"),$y=Symbol("is-writable");function II(h){return PI(h)&&ah in h}function CI(h){return Te.isBox(h)&&$y in h}function Te(h){let s=Je(je(h));return{[ah]:!0,[$y]:!0,get current(){return L(s)},set current(g){Be(s,je(g))}}}function AI(h,s){const g=Pe(h);return s?{[ah]:!0,[$y]:!0,get current(){return L(g)},set current(v){s(v)}}:{[ah]:!0,get current(){return h()}}}function kI(h){return Te.isBox(h)?h:TI(h)?Te.with(h):Te(h)}function EI(h){return Object.entries(h).reduce((s,[g,v])=>Te.isBox(v)?(Te.isWritableBox(v)?Object.defineProperty(s,g,{get(){return v.current},set(T){v.current=T}}):Object.defineProperty(s,g,{get(){return v.current}}),s):Object.assign(s,{[g]:v}),{})}function MI(h){return Te.isWritableBox(h)?{[ah]:!0,get current(){return h.current}}:h}Te.from=kI;Te.with=AI;Te.flatten=EI;Te.readonly=MI;Te.isBox=II;Te.isWritableBox=CI;function kb(...h){return function(s){var g;for(const v of h)if(v){if(s.defaultPrevented)return;typeof v=="function"?v.call(this,s):(g=v.current)==null||g.call(this,s)}}}function Eb(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var jl={},yy,x0;function zI(){if(x0)return yy;x0=1;var h=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,s=/\n/g,g=/^\s*/,v=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,T=/^:\s*/,C=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,w=/^[;\s]*/,c=/^\s+|\s+$/g,j=`
`,q="/",K="*",N="",V="comment",se="declaration";yy=function(le,fe){if(typeof le!="string")throw new TypeError("First argument must be a string");if(!le)return[];fe=fe||{};var Se=1,ge=1;function Ee(De){var Ae=De.match(s);Ae&&(Se+=Ae.length);var Ge=De.lastIndexOf(j);ge=~Ge?De.length-Ge:ge+De.length}function Ne(){var De={line:Se,column:ge};return function(Ae){return Ae.position=new Le(De),Pt(),Ae}}function Le(De){this.start=De,this.end={line:Se,column:ge},this.source=fe.source}Le.prototype.content=le;function We(De){var Ae=new Error(fe.source+":"+Se+":"+ge+": "+De);if(Ae.reason=De,Ae.filename=fe.source,Ae.line=Se,Ae.column=ge,Ae.source=le,!fe.silent)throw Ae}function tt(De){var Ae=De.exec(le);if(Ae){var Ge=Ae[0];return Ee(Ge),le=le.slice(Ge.length),Ae}}function Pt(){tt(g)}function $e(De){var Ae;for(De=De||[];Ae=nt();)Ae!==!1&&De.push(Ae);return De}function nt(){var De=Ne();if(!(q!=le.charAt(0)||K!=le.charAt(1))){for(var Ae=2;N!=le.charAt(Ae)&&(K!=le.charAt(Ae)||q!=le.charAt(Ae+1));)++Ae;if(Ae+=2,N===le.charAt(Ae-1))return We("End of comment missing");var Ge=le.slice(2,Ae-2);return ge+=2,Ee(Ge),le=le.slice(Ae),ge+=2,De({type:V,comment:Ge})}}function Re(){var De=Ne(),Ae=tt(v);if(Ae){if(nt(),!tt(T))return We("property missing ':'");var Ge=tt(C),Xe=De({type:se,property:ie(Ae[0].replace(h,N)),value:Ge?ie(Ge[0].replace(h,N)):N});return tt(w),Xe}}function Me(){var De=[];$e(De);for(var Ae;Ae=Re();)Ae!==!1&&(De.push(Ae),$e(De));return De}return Pt(),Me()};function ie(le){return le?le.replace(c,N):N}return yy}var b0;function DI(){if(b0)return jl;b0=1;var h=jl&&jl.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(jl,"__esModule",{value:!0}),jl.default=g;var s=h(zI());function g(v,T){var C=null;if(!v||typeof v!="string")return C;var w=(0,s.default)(v),c=typeof T=="function";return w.forEach(function(j){if(j.type==="declaration"){var q=j.property,K=j.value;c?T(q,K,j):K&&(C=C||{},C[q]=K)}}),C}return jl}var LI=DI();const w0=Eb(LI),RI=w0.default||w0,OI=/\d/,FI=["-","_","/","."];function BI(h=""){if(!OI.test(h))return h!==h.toLowerCase()}function NI(h){const s=[];let g="",v,T;for(const C of h){const w=FI.includes(C);if(w===!0){s.push(g),g="",v=void 0;continue}const c=BI(C);if(T===!1){if(v===!1&&c===!0){s.push(g),g=C,v=c;continue}if(v===!0&&c===!1&&g.length>1){const j=g.at(-1);s.push(g.slice(0,Math.max(0,g.length-1))),g=j+C,v=c;continue}}g+=C,v=c,T=w}return s.push(g),s}function Mb(h){return h?NI(h).map(s=>jI(s)).join(""):""}function VI(h){return UI(Mb(h||""))}function jI(h){return h?h[0].toUpperCase()+h.slice(1):""}function UI(h){return h?h[0].toLowerCase()+h.slice(1):""}function sh(h){if(!h)return{};const s={};function g(v,T){if(v.startsWith("-moz-")||v.startsWith("-webkit-")||v.startsWith("-ms-")||v.startsWith("-o-")){s[Mb(v)]=T;return}if(v.startsWith("--")){s[v]=T;return}s[VI(v)]=T}return RI(h,g),s}function Wl(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function qI(h,s){const g=RegExp(h,"g");return v=>{if(typeof v!="string")throw new TypeError(`expected an argument of type string, but got ${typeof v}`);return v.match(g)?v.replace(g,s):v}}const ZI=qI(/[A-Z]/,h=>`-${h.toLowerCase()}`);function GI(h){if(!h||typeof h!="object"||Array.isArray(h))throw new TypeError(`expected an argument of type object, but got ${typeof h}`);return Object.keys(h).map(s=>`${ZI(s)}: ${h[s]};`).join(`
`)}function Jy(h={}){return GI(h).replace(`
`," ")}const zb={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};Jy(zb);function WI(h){var s;return h.length>2&&h.startsWith("on")&&h[2]===((s=h[2])==null?void 0:s.toLowerCase())}function $i(...h){const s={...h[0]};for(let g=1;g<h.length;g++){const v=h[g];for(const T in v){const C=s[T],w=v[T],c=typeof C=="function",j=typeof w=="function";if(c&&WI(T)){const q=C,K=w;s[T]=kb(q,K)}else if(c&&j)s[T]=Wl(C,w);else if(T==="class"&&typeof C=="string"&&typeof w=="string")s[T]=Sb(C,w);else if(T==="style"){const q=typeof C=="object",K=typeof w=="object",N=typeof C=="string",V=typeof w=="string";if(q&&K)s[T]={...C,...w};else if(q&&V){const se=sh(w);s[T]={...C,...se}}else if(N&&K){const se=sh(C);s[T]={...se,...w}}else if(N&&V){const se=sh(C),ie=sh(w);s[T]={...se,...ie}}else q?s[T]=C:K&&(s[T]=w)}else s[T]=w!==void 0?w:C}}return typeof s.style=="object"&&(s.style=Jy(s.style).replaceAll(`
`," ")),s.hidden!==!0&&(s.hidden=void 0),s.disabled!==!0&&(s.disabled=void 0),s}function lr({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{},getRootNode:T=()=>typeof document<"u"?document:void 0}){const C=Pe(()=>g()),w=Pe(()=>T());Tt(()=>(h.current,L(C),L(w),Bi(()=>{var j;const c=(j=L(w))==null?void 0:j.getElementById(h.current);c?s.current=c:s.current=null,v(s.current)}))),Tt(()=>()=>{s.current=null,v(null)})}function HI(h){Tt(()=>()=>{h()})}function Mp(h,s){setTimeout(s,h)}function Lc(h){Vg().then(h)}function Yy(h){return h?"open":"closed"}function XI(h){return h?"true":"false"}function Db(h){return h?"true":"false"}function KI(h){return h?"":void 0}function $I(h){return h?"true":"false"}function JI(h){return h?"":void 0}const YI="ArrowDown",QI="ArrowUp",eC="End",Lb="Enter",tC="Escape",iC="Home",rC=" ",nC="Tab",sC="p",oC="n",aC="j",lC="k",Qy=typeof document<"u",S0=cC();function cC(){var h,s;return Qy&&((h=window==null?void 0:window.navigator)==null?void 0:h.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((s=window==null?void 0:window.navigator)==null?void 0:s.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function tm(h){return h instanceof HTMLElement}function uC(h){return h instanceof Element}function hC(h){return h!==null}function dC(h){return h instanceof HTMLInputElement&&"select"in h}function pC(h,s){if(getComputedStyle(h).visibility==="hidden")return!0;for(;h;){if(s!==void 0&&h===s)return!1;if(getComputedStyle(h).display==="none")return!0;h=h.parentElement}return!1}function T0(h,s){return Ap(h,s)}function fC(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!nb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return Hy(h)}function mC(h,s){return typeof h=="string"&&s===void 0?`${h}Context`:Array.isArray(h)&&s===void 0?`${h[0]}Context`:`${h}Context`}function Wa(h,s,g=!0){const v=mC(h,s),T=Symbol.for(`bits-ui.${v}`),C=v;function w(j){const q=fC(g?T:C,j);if(q===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return q}function c(j){return T0(g?T:C,j)}return[c,w]}let P0=0;function Sr(h="bits"){return P0++,`${h}-${P0}`}function rr(){}var Kl,hh,Go,Fa,oa,By,Ny;class gC{constructor(s,g){X(this,oa);X(this,Kl,Je());X(this,hh);X(this,Go,0);X(this,Fa,null);I(this,Kl).v=je(s),Ze(this,hh,g)}get current(){return rb()?Tt(()=>($u(this,Go)._++,I(this,Go)===1&&Nr(this,oa,By).call(this,!0),()=>{Vg().then(()=>{$u(this,Go)._--,I(this,Go)===0&&Nr(this,oa,Ny).call(this)})})):I(this,Go)===0&&(Nr(this,oa,By).call(this,!1),Nr(this,oa,Ny).call(this)),L(I(this,Kl))}}Kl=new WeakMap,hh=new WeakMap,Go=new WeakMap,Fa=new WeakMap,oa=new WeakSet,By=function(s){Ze(this,Fa,I(this,hh).call(this,g=>{Be(I(this,Kl),je(g))},s)??null)},Ny=function(){I(this,Fa)!==null&&(I(this,Fa).call(this),Ze(this,Fa,null))};new gC(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function _C(h){return typeof h=="function"}function yC(h){return _C(h)?h():h}var Wo;class vC{constructor(s,g={box:"border-box"}){X(this,Wo,Je(je({width:0,height:0})));var v,T;I(this,Wo).v=je({width:((v=g.initialSize)==null?void 0:v.width)??0,height:((T=g.initialSize)==null?void 0:T.height)??0}),Tt(()=>{const C=yC(s);if(!C)return;const w=new ResizeObserver(c=>{for(const j of c){const q=g.box==="content-box"?j.contentBoxSize:j.borderBoxSize,K=Array.isArray(q)?q:[q];L(I(this,Wo)).width=K.reduce((N,V)=>Math.max(N,V.inlineSize),0),L(I(this,Wo)).height=K.reduce((N,V)=>Math.max(N,V.blockSize),0)}});return w.observe(C),()=>{w.disconnect()}})}get width(){return L(I(this,Wo)).width}get height(){return L(I(this,Wo)).height}}Wo=new WeakMap;var dh,ph;class xC{constructor(s){X(this,dh,Je());X(this,ph);Tt(()=>{Be(I(this,dh),je(I(this,ph))),Ze(this,ph,s())})}get current(){return L(I(this,dh))}}dh=new WeakMap,ph=new WeakMap;function bC(h,s){const g=Te(h);function v(C){return s[g.current][C]??g.current}return{state:g,dispatch:C=>{g.current=v(C)}}}function wC(h,s){let g=Je(je({})),v=Je("none");const T=h.current?"mounted":"unmounted";let C=Je(null);const w=new xC(()=>h.current);Tt(()=>{s.current&&h.current&&Lc(()=>{Be(C,je(document.getElementById(s.current)))})});const{state:c,dispatch:j}=bC(T,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Tt(()=>{const V=h.current;Bi(()=>{if(L(C)||Be(C,je(document.getElementById(s.current))),!L(C)||!(V!==w.current))return;const ie=L(v),le=jf(L(C));V?j("MOUNT"):le==="none"||L(g).display==="none"?j("UNMOUNT"):j(w&&ie!==le?"ANIMATION_OUT":"UNMOUNT")})});function q(V){if(L(C)||Be(C,je(document.getElementById(s.current))),!L(C))return;const se=jf(L(C)),ie=se.includes(V.animationName)||se==="none";V.target===L(C)&&ie&&j("ANIMATION_END")}function K(V){L(C)||Be(C,je(document.getElementById(s.current))),L(C)&&V.target===L(C)&&Be(v,je(jf(L(C))))}Tt(()=>{c.current,Bi(()=>{if(L(C)||Be(C,je(document.getElementById(s.current))),!L(C))return;const V=jf(L(C));Be(v,je(c.current==="mounted"?V:"none"))})}),Tt(()=>{if(L(C))return Be(g,je(getComputedStyle(L(C)))),L(C).addEventListener("animationstart",K),L(C).addEventListener("animationcancel",q),L(C).addEventListener("animationend",q),()=>{var V,se,ie;(V=L(C))==null||V.removeEventListener("animationstart",K),(se=L(C))==null||se.removeEventListener("animationcancel",q),(ie=L(C))==null||ie.removeEventListener("animationend",q)}});const N=Pe(()=>["mounted","unmountSuspended"].includes(c.current));return{get current(){return L(N)}}}function jf(h){return h&&getComputedStyle(h).animationName||"none"}function ev(h,s){Ct(s,!0);const g=wC(Te.with(()=>s.present),Te.with(()=>s.id));var v=rt(),T=Ve(v);{var C=w=>{var c=rt(),j=Ve(c);Bt(j,()=>s.presence??ii,()=>({present:g})),be(w,c)};gi(T,w=>{(s.forceMount||s.present||g.current)&&w(C)})}be(h,v),At()}function SC(h){return{content:`data-${h}-content`,trigger:`data-${h}-trigger`,overlay:`data-${h}-overlay`,title:`data-${h}-title`,description:`data-${h}-description`,close:`data-${h}-close`,cancel:`data-${h}-cancel`,action:`data-${h}-action`}}var fh,mh,gh,_h,yh,vh,xh,bh,wh,am,lm;class TC{constructor(s){qe(this,"open");qe(this,"variant");X(this,fh,Je(null));X(this,mh,Je(null));X(this,gh,Je(null));X(this,_h,Je(null));X(this,yh,Je(void 0));X(this,vh,Je(void 0));X(this,xh,Je(void 0));X(this,bh,Je(void 0));X(this,wh,Je(null));X(this,am,Pe(()=>SC(this.variant.current)));qe(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});qe(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});X(this,lm,Pe(()=>({"data-state":Yy(this.open.current)})));this.open=s.open,this.variant=s.variant}get triggerNode(){return L(I(this,fh))}set triggerNode(s){Be(I(this,fh),je(s))}get titleNode(){return L(I(this,mh))}set titleNode(s){Be(I(this,mh),je(s))}get contentNode(){return L(I(this,gh))}set contentNode(s){Be(I(this,gh),je(s))}get descriptionNode(){return L(I(this,_h))}set descriptionNode(s){Be(I(this,_h),je(s))}get contentId(){return L(I(this,yh))}set contentId(s){Be(I(this,yh),je(s))}get titleId(){return L(I(this,vh))}set titleId(s){Be(I(this,vh),je(s))}get triggerId(){return L(I(this,xh))}set triggerId(s){Be(I(this,xh),je(s))}get descriptionId(){return L(I(this,bh))}set descriptionId(s){Be(I(this,bh),je(s))}get cancelNode(){return L(I(this,wh))}set cancelNode(s){Be(I(this,wh),je(s))}get attrs(){return L(I(this,am))}get sharedProps(){return L(I(this,lm))}}fh=new WeakMap,mh=new WeakMap,gh=new WeakMap,_h=new WeakMap,yh=new WeakMap,vh=new WeakMap,xh=new WeakMap,bh=new WeakMap,wh=new WeakMap,am=new WeakMap,lm=new WeakMap;var $l,Sh,$s,Th,cm;class PC{constructor(s,g){X(this,$l);X(this,Sh);X(this,$s);X(this,Th);X(this,cm,Pe(()=>({id:I(this,$l).current,role:"heading","aria-level":I(this,Th).current,[I(this,$s).attrs.title]:"",...I(this,$s).sharedProps})));Ze(this,$l,s.id),Ze(this,$s,g),Ze(this,Sh,s.ref),Ze(this,Th,s.level),lr({id:I(this,$l),ref:I(this,Sh),onRefChange:v=>{I(this,$s).titleNode=v,I(this,$s).titleId=v==null?void 0:v.id},deps:()=>I(this,$s).open.current})}get props(){return L(I(this,cm))}}$l=new WeakMap,Sh=new WeakMap,$s=new WeakMap,Th=new WeakMap,cm=new WeakMap;var Jl,Ph,Js,um;class IC{constructor(s,g){X(this,Jl);X(this,Ph);X(this,Js);X(this,um,Pe(()=>({id:I(this,Jl).current,[I(this,Js).attrs.description]:"",...I(this,Js).sharedProps})));Ze(this,Jl,s.id),Ze(this,Js,g),Ze(this,Ph,s.ref),lr({id:I(this,Jl),ref:I(this,Ph),deps:()=>I(this,Js).open.current,onRefChange:v=>{I(this,Js).descriptionNode=v,I(this,Js).descriptionId=v==null?void 0:v.id}})}get props(){return L(I(this,um))}}Jl=new WeakMap,Ph=new WeakMap,Js=new WeakMap,um=new WeakMap;var Yl,Ih,hm,dm;class CC{constructor(s,g){X(this,Yl);X(this,Ih);qe(this,"root");X(this,hm,Pe(()=>({open:this.root.open.current})));X(this,dm,Pe(()=>({id:I(this,Yl).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ze(this,Yl,s.id),this.root=g,Ze(this,Ih,s.ref),lr({id:I(this,Yl),ref:I(this,Ih),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,hm))}get props(){return L(I(this,dm))}}Yl=new WeakMap,Ih=new WeakMap,hm=new WeakMap,dm=new WeakMap;var Ql,Ch,pm,fm;class AC{constructor(s,g){X(this,Ql);X(this,Ch);qe(this,"root");X(this,pm,Pe(()=>({open:this.root.open.current})));X(this,fm,Pe(()=>({id:I(this,Ql).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ze(this,Ql,s.id),Ze(this,Ch,s.ref),this.root=g,lr({id:I(this,Ql),ref:I(this,Ch),deps:()=>this.root.open.current})}get snippetProps(){return L(I(this,pm))}get props(){return L(I(this,fm))}}Ql=new WeakMap,Ch=new WeakMap,pm=new WeakMap,fm=new WeakMap;const[kC,jg]=Wa("Dialog.Root");function EC(h){return kC(new TC(h))}function MC(h){return new PC(h,jg())}function zC(h){return new CC(h,jg())}function DC(h){return new AC(h,jg())}function LC(h){return new IC(h,jg())}var RC=Et("<div><!></div>");function OC(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"level",3,2),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const w=MC({id:Te.with(()=>g()),level:Te.with(()=>T()),ref:Te.with(()=>v(),V=>v(V))}),c=Pe(()=>$i(C,w.props));var j=rt(),q=Ve(j);{var K=V=>{var se=rt(),ie=Ve(se);Bt(ie,()=>s.child,()=>({props:L(c)})),be(V,se)},N=V=>{var se=RC();let ie;var le=Zt(se);Bt(le,()=>s.children??ii),jt(se),Lt(()=>ie=Mi(se,ie,{...L(c)})),be(V,se)};gi(q,V=>{s.child?V(K):V(N,!1)})}be(h,j),At()}function FC(h,s){Ct(s,!0);var g=rt(),v=Ve(g);ob(v,()=>s.children,T=>{var C=rt(),w=Ve(C);Bt(w,()=>s.children??ii),be(T,C)}),be(h,g),At()}function Rb(h,s){Ct(s,!0);let g=ee(s,"to",3,"body");const v=U2();let T=Pe(C);function C(){if(!Qy||s.disabled)return null;let K=null;return typeof g()=="string"?K=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(K=g()),K}let w;Tt(()=>{if(!L(T)||s.disabled){w&&(l0(w),w=null);return}return Bi(()=>w=W2(FC,{target:L(T),props:{children:s.children},context:v})),()=>{w&&(l0(w),w=null)}});var c=rt(),j=Ve(c);{var q=K=>{var N=rt(),V=Ve(N);Bt(V,()=>s.children??ii),be(K,N)};gi(j,K=>{s.disabled&&K(q)})}be(h,c),At()}function Ps(h,s,g,v){const T=Array.isArray(s)?s:[s];return T.forEach(C=>h.addEventListener(C,g,v)),()=>{T.forEach(C=>h.removeEventListener(C,g,v))}}function I0(h,s=500){let g=null;const v=(...T)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{h(...T)},s)};return v.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},v}function tv(h,s){return h===s||h.contains(s)}function Ob(h){return(h==null?void 0:h.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var ec,Ba,Ho,tc,Xo,ic,rc,Ah,kh,Eh,Ys,mm,Oc,Fb,gm,nc,_m,ym,vm,xm,Mh,Bb,bm,wm;class BC{constructor(s){X(this,Oc);X(this,ec);X(this,Ba);X(this,Ho,{pointerdown:!1});X(this,tc,!1);qe(this,"node",Te(null));X(this,Xo);X(this,ic);X(this,rc,Je(!1));X(this,Ah);X(this,kh,Je(null));X(this,Eh);X(this,Ys,rr);X(this,mm,s=>{s.defaultPrevented||this.currNode&&Lc(()=>{var g,v;!this.currNode||I(this,xm).call(this,s.target)||s.target&&!L(I(this,rc))&&((v=(g=I(this,Ah)).current)==null||v.call(g,s))})});X(this,gm,s=>{let g=s;g.defaultPrevented&&(g=C0(s)),I(this,ec).current(s)});X(this,nc,I0(s=>{if(!this.currNode){I(this,Ys).call(this);return}const g=I(this,Eh).current(s,this.currNode)||UC(s,this.currNode);if(!I(this,tc)||Nr(this,Oc,Bb).call(this)||!g){I(this,Ys).call(this);return}let v=s;if(v.defaultPrevented&&(v=C0(v)),I(this,Ba).current!=="close"&&I(this,Ba).current!=="defer-otherwise-close"){I(this,Ys).call(this);return}s.pointerType==="touch"?(I(this,Ys).call(this),Ze(this,Ys,Ps(I(this,Xo),"click",I(this,gm),{once:!0}))):I(this,ec).current(v)},10));X(this,_m,s=>{I(this,Ho)[s.type]=!0});X(this,ym,s=>{I(this,Ho)[s.type]=!1});X(this,vm,()=>{this.node.current&&Ze(this,tc,jC(this.node.current))});X(this,xm,s=>this.node.current?tv(this.node.current,s):!1);X(this,Mh,I0(()=>{for(const s in I(this,Ho))I(this,Ho)[s]=!1;Ze(this,tc,!1)},20));X(this,bm,()=>{Be(I(this,rc),!0)});X(this,wm,()=>{Be(I(this,rc),!1)});qe(this,"props",{onfocuscapture:I(this,bm),onblurcapture:I(this,wm)});Ze(this,ic,s.enabled),Ze(this,Eh,s.isValidEvent),lr({id:s.id,ref:this.node,deps:()=>I(this,ic).current,onRefChange:T=>{this.currNode=T}}),Ze(this,Ba,s.interactOutsideBehavior),Ze(this,ec,s.onInteractOutside),Ze(this,Ah,s.onFocusOutside),Tt(()=>{Ze(this,Xo,Ob(this.currNode))});let g=rr;const v=()=>{I(this,Mh).call(this),globalThis.bitsDismissableLayers.delete(this),I(this,nc).destroy(),g()};Tt(()=>(I(this,ic).current&&this.currNode&&Mp(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,Bi(()=>I(this,Ba))),g(),g=Nr(this,Oc,Fb).call(this))}),()=>{v()})),HI(()=>{I(this,Mh).destroy(),globalThis.bitsDismissableLayers.delete(this),I(this,nc).destroy(),I(this,Ys).call(this),g()})}get currNode(){return L(I(this,kh))}set currNode(s){Be(I(this,kh),je(s))}}ec=new WeakMap,Ba=new WeakMap,Ho=new WeakMap,tc=new WeakMap,Xo=new WeakMap,ic=new WeakMap,rc=new WeakMap,Ah=new WeakMap,kh=new WeakMap,Eh=new WeakMap,Ys=new WeakMap,mm=new WeakMap,Oc=new WeakSet,Fb=function(){return Wl(Ps(I(this,Xo),"pointerdown",Wl(I(this,_m),I(this,vm)),!0),Ps(I(this,Xo),"pointerdown",Wl(I(this,ym),I(this,nc))),Ps(I(this,Xo),"focusin",I(this,mm)))},gm=new WeakMap,nc=new WeakMap,_m=new WeakMap,ym=new WeakMap,vm=new WeakMap,xm=new WeakMap,Mh=new WeakMap,Bb=function(){return Object.values(I(this,Ho)).some(Boolean)},bm=new WeakMap,wm=new WeakMap;function NC(h){return new BC(h)}function VC(h){return h.findLast(([s,{current:g}])=>g==="close"||g==="ignore")}function jC(h){const s=[...globalThis.bitsDismissableLayers],g=VC(s);if(g)return g[0].node.current===h;const[v]=s[0];return v.node.current===h}function UC(h,s){if("button"in h&&h.button>0)return!1;const g=h.target;return uC(g)?Ob(g).documentElement.contains(g)&&!tv(s,g):!1}function C0(h){const s=h.currentTarget,g=h.target;let v;h instanceof PointerEvent?v=new PointerEvent(h.type,h):v=new PointerEvent("pointerdown",h);let T=!1;return new Proxy(v,{get:(w,c)=>c==="currentTarget"?s:c==="target"?g:c==="preventDefault"?()=>{T=!0,typeof w.preventDefault=="function"&&w.preventDefault()}:c==="defaultPrevented"?T:c in w?w[c]:h[c]})}function Nb(h,s){Ct(s,!0);let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"onInteractOutside",3,rr),T=ee(s,"onFocusOutside",3,rr),C=ee(s,"isValidEvent",3,()=>!1);const w=NC({id:Te.with(()=>s.id),interactOutsideBehavior:Te.with(()=>g()),onInteractOutside:Te.with(()=>v()),enabled:Te.with(()=>s.enabled),onFocusOutside:Te.with(()=>T()),isValidEvent:Te.with(()=>C())});var c=rt(),j=Ve(c);Bt(j,()=>s.children??ii,()=>({props:w.props})),be(h,c),At()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var zh,sc,Dh,Sm,Tm;class qC{constructor(s){X(this,zh);X(this,sc);X(this,Dh);X(this,Sm,()=>Ps(document,"keydown",I(this,Tm),{passive:!1}));X(this,Tm,s=>{if(s.key!==tC||!GC(this))return;const g=new KeyboardEvent(s.type,s);s.preventDefault();const v=I(this,sc).current;v!=="close"&&v!=="defer-otherwise-close"||I(this,zh).current(g)});Ze(this,sc,s.escapeKeydownBehavior),Ze(this,zh,s.onEscapeKeydown),Ze(this,Dh,s.enabled);let g=rr;Tt(()=>(I(this,Dh).current&&(globalThis.bitsEscapeLayers.set(this,Bi(()=>I(this,sc))),g=I(this,Sm).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}zh=new WeakMap,sc=new WeakMap,Dh=new WeakMap,Sm=new WeakMap,Tm=new WeakMap;function ZC(h){return new qC(h)}function GC(h){const s=[...globalThis.bitsEscapeLayers],g=s.findLast(([T,{current:C}])=>C==="close"||C==="ignore");if(g)return g[0]===h;const[v]=s[0];return v===h}function Vb(h,s){Ct(s,!0);let g=ee(s,"escapeKeydownBehavior",3,"close"),v=ee(s,"onEscapeKeydown",3,rr);ZC({escapeKeydownBehavior:Te.with(()=>g()),onEscapeKeydown:Te.with(()=>v()),enabled:Te.with(()=>s.enabled)});var T=rt(),C=Ve(T);Bt(C,()=>s.children??ii),be(h,T),At()}const WC=Te([]);function HC(){const h=WC;return{add(s){const g=h.current[0];s.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),h.current=A0(h.current,s),h.current.unshift(s)},remove(s){var g;h.current=A0(h.current,s),(g=h.current[0])==null||g.resume()}}}function XC(){let h=Je(!1);return{id:Sr(),get paused(){return L(h)},pause(){Be(h,!0)},resume(){Be(h,!1)}}}function A0(h,s){return[...h].filter(g=>g.id!==s.id)}function KC(h){return h.filter(s=>s.tagName!=="A")}function No(h,{select:s=!1}={}){if(!(h&&h.focus))return;const g=document.activeElement;h.focus({preventScroll:!0}),h!==g&&dC(h)&&s&&h.select()}function $C(h,{select:s=!1}={}){const g=document.activeElement;for(const v of h)if(No(v,{select:s}),document.activeElement!==g)return!0}function k0(h,s){for(const g of h)if(!pC(g,s))return g}function jb(h){const s=[],g=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,{acceptNode:v=>{const T=v.tagName==="INPUT"&&v.type==="hidden";return v.disabled||v.hidden||T?NodeFilter.FILTER_SKIP:v.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)s.push(g.currentNode);return s}function JC(h){const s=jb(h),g=k0(s,h),v=k0(s.reverse(),h);return[g,v]}const YC="focusScope.autoFocusOnMount",QC="focusScope.autoFocusOnDestroy",E0={bubbles:!1,cancelable:!0};function eA({id:h,loop:s,enabled:g,onOpenAutoFocus:v,onCloseAutoFocus:T,forceMount:C}){const w=HC(),c=XC(),j=Te(null);lr({id:h,ref:j,deps:()=>g.current});let q=Je(null);Tt(()=>{const ie=j.current;if(!ie||!g.current)return;function le(ge){if(c.paused||!ie)return;const Ee=ge.target;tm(Ee)&&(ie.contains(Ee)?Be(q,je(Ee)):No(L(q),{select:!0}))}function fe(ge){if(c.paused||!ie)return;const Ee=ge.relatedTarget;tm(Ee)&&Ee!==null&&(ie.contains(Ee)||No(L(q),{select:!0}))}function Se(ge){(ie==null?void 0:ie.contains(L(q)))||No(ie)}return Bi(()=>{const ge=Wl(Ps(document,"focusin",le),Ps(document,"focusout",fe)),Ee=new MutationObserver(Se);return Ee.observe(ie,{childList:!0,subtree:!0}),()=>{ge(),Ee.disconnect()}})}),Tt(()=>{if(C.current)return;let ie=j.current;const le=document.activeElement;return Bi(()=>{K(ie,le)}),()=>{ie&&N(le)}}),Tt(()=>{if(!C.current)return;g.current;const ie=j.current,le=document.activeElement;return Bi(()=>{K(ie,le)}),()=>{ie&&N(le)}});function K(ie,le){if(ie||(ie=document.getElementById(h.current)),!ie)return;if(w.add(c),!ie.contains(le)){const Se=new CustomEvent(YC,E0);v.current(Se),Se.defaultPrevented||Lc(()=>{ie&&($C(KC(jb(ie)),{select:!0}),document.activeElement===le&&No(ie))})}}function N(ie){const le=new CustomEvent(QC,E0);T.current(le),setTimeout(()=>{!le.defaultPrevented&&ie&&No(ie??document.body,{select:!0}),w.remove(c)},0)}function V(ie){if(!g.current||!s.current&&!g.current||c.paused)return;const le=ie.key===nC&&!ie.ctrlKey&&!ie.altKey&&!ie.metaKey,fe=document.activeElement;if(!(le&&fe))return;const Se=j.current;if(!Se)return;const[ge,Ee]=JC(Se);ge&&Ee?!ie.shiftKey&&fe===Ee?(ie.preventDefault(),s.current&&No(ge,{select:!0})):ie.shiftKey&&fe===ge&&(ie.preventDefault(),s.current&&No(Ee,{select:!0})):fe===Se&&ie.preventDefault()}const se=Pe(()=>({id:h.current,tabindex:-1,onkeydown:V}));return{get props(){return L(se)}}}function Ub(h,s){Ct(s,!0);let g=ee(s,"trapFocus",3,!1),v=ee(s,"loop",3,!1),T=ee(s,"onCloseAutoFocus",3,rr),C=ee(s,"onOpenAutoFocus",3,rr),w=ee(s,"forceMount",3,!1);const c=eA({enabled:Te.with(()=>g()),loop:Te.with(()=>v()),onCloseAutoFocus:Te.with(()=>T()),onOpenAutoFocus:Te.with(()=>C()),id:Te.with(()=>s.id),forceMount:Te.with(()=>w())});var j=rt(),q=Ve(j);Bt(q,()=>s.focusScope??ii,()=>({props:c.props})),be(h,j),At()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Lh,Rh,Oh,Ko,oc,Fh,Pm,qb,Im,Bh;class tA{constructor(s){X(this,Pm);X(this,Lh);X(this,Rh);X(this,Oh);X(this,Ko);X(this,oc,rr);X(this,Fh,Te(null));X(this,Im,s=>{const g=I(this,Fh).current,v=s.target;!tm(g)||!tm(v)||!I(this,Ko).current||!nA(this)||!tv(g,v)||(I(this,Rh).current(s),!s.defaultPrevented&&Ze(this,oc,rA(g)))});X(this,Bh,()=>{I(this,oc).call(this),Ze(this,oc,rr)});Ze(this,Lh,s.id),Ze(this,Ko,s.preventOverflowTextSelection),Ze(this,Rh,s.onPointerDown),Ze(this,Oh,s.onPointerUp),lr({id:I(this,Lh),ref:I(this,Fh),deps:()=>I(this,Ko).current});let g=rr;Tt(()=>(I(this,Ko).current&&(globalThis.bitsTextSelectionLayers.set(this,Bi(()=>I(this,Ko))),g=Nr(this,Pm,qb).call(this)),()=>{g(),I(this,Bh).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Lh=new WeakMap,Rh=new WeakMap,Oh=new WeakMap,Ko=new WeakMap,oc=new WeakMap,Fh=new WeakMap,Pm=new WeakSet,qb=function(){return Wl(Ps(document,"pointerdown",I(this,Im)),Ps(document,"pointerup",kb(I(this,Bh),I(this,Oh))))},Im=new WeakMap,Bh=new WeakMap;function iA(h){return new tA(h)}const M0=h=>h.style.userSelect||h.style.webkitUserSelect;function rA(h){const s=document.body,g=M0(s),v=M0(h);return Uf(s,"none"),Uf(h,"text"),()=>{Uf(s,g),Uf(h,v)}}function Uf(h,s){h.style.userSelect=s,h.style.webkitUserSelect=s}function nA(h){const s=[...globalThis.bitsTextSelectionLayers];if(!s.length)return!1;const g=s.at(-1);return g?g[0]===h:!1}function Zb(h,s){Ct(s,!0);let g=ee(s,"preventOverflowTextSelection",3,!0),v=ee(s,"onPointerDown",3,rr),T=ee(s,"onPointerUp",3,rr);iA({id:Te.with(()=>s.id),preventOverflowTextSelection:Te.with(()=>g()),onPointerDown:Te.with(()=>v()),onPointerUp:Te.with(()=>T()),enabled:Te.with(()=>s.enabled)});var C=rt(),w=Ve(C);Bt(w,()=>s.children??ii),be(h,C),At()}var sA=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],oA=["difference","intersection","symmetricDifference","union"],z0=!1,ac,ss,$o,Cm,Gb;const Am=class Am extends Set{constructor(g){super();X(this,Cm);X(this,ac,new Map);X(this,ss,as(0));X(this,$o,as(0));if(g){for(var v of g)super.add(v);I(this,$o).v=super.size}z0||Nr(this,Cm,Gb).call(this)}has(g){var v=super.has(g),T=I(this,ac),C=T.get(g);if(C===void 0){if(!v)return L(I(this,ss)),!1;C=as(!0),T.set(g,C)}return L(C),v}add(g){return super.has(g)||(super.add(g),Be(I(this,$o),super.size),Vo(I(this,ss))),this}delete(g){var v=super.delete(g),T=I(this,ac),C=T.get(g);return C!==void 0&&(T.delete(g),Be(C,!1)),v&&(Be(I(this,$o),super.size),Vo(I(this,ss))),v}clear(){if(super.size!==0){super.clear();var g=I(this,ac);for(var v of g.values())Be(v,!1);g.clear(),Be(I(this,$o),0),Vo(I(this,ss))}}keys(){return this.values()}values(){return L(I(this,ss)),super.values()}entries(){return L(I(this,ss)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return L(I(this,$o))}};ac=new WeakMap,ss=new WeakMap,$o=new WeakMap,Cm=new WeakSet,Gb=function(){z0=!0;var g=Am.prototype,v=Set.prototype;for(const T of sA)g[T]=function(...C){return L(I(this,ss)),v[T].apply(this,C)};for(const T of oA)g[T]=function(...C){L(I(this,ss));var w=v[T].apply(this,C);return new Am(w)}};let Vy=Am;var xs,bs,Qs,lc,$f;const fv=class fv extends Map{constructor(g){super();X(this,lc);X(this,xs,new Map);X(this,bs,as(0));X(this,Qs,as(0));if(g){for(var[v,T]of g)super.set(v,T);I(this,Qs).v=super.size}}has(g){var v=I(this,xs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else return L(I(this,bs)),!1}return L(T),!0}forEach(g,v){Nr(this,lc,$f).call(this),super.forEach(g,v)}get(g){var v=I(this,xs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else{L(I(this,bs));return}}return L(T),super.get(g)}set(g,v){var N;var T=I(this,xs),C=T.get(g),w=super.get(g),c=super.set(g,v),j=I(this,bs);if(C===void 0)T.set(g,as(0)),Be(I(this,Qs),super.size),Vo(j);else if(w!==v){Vo(C);var q=j.reactions===null?null:new Set(j.reactions),K=q===null||!((N=C.reactions)!=null&&N.every(V=>q.has(V)));K&&Vo(j)}return c}delete(g){var v=I(this,xs),T=v.get(g),C=super.delete(g);return T!==void 0&&(v.delete(g),Be(I(this,Qs),super.size),Be(T,-1),Vo(I(this,bs))),C}clear(){if(super.size!==0){super.clear();var g=I(this,xs);Be(I(this,Qs),0);for(var v of g.values())Be(v,-1);Vo(I(this,bs)),g.clear()}}keys(){return L(I(this,bs)),super.keys()}values(){return Nr(this,lc,$f).call(this),super.values()}entries(){return Nr(this,lc,$f).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return L(I(this,Qs)),super.size}};xs=new WeakMap,bs=new WeakMap,Qs=new WeakMap,lc=new WeakSet,$f=function(){L(I(this,bs));var g=I(this,xs);if(I(this,Qs).v!==g.size)for(var v of Qx(fv.prototype,this,"keys").call(this))g.has(v)||g.set(v,as(0));for(var[,T]of I(this,xs))L(T)};let jy=fv;function aA(h){let s=0,g=Je(void 0),v;function T(){s-=1,v&&s<=0&&(v(),Be(g,void 0),v=void 0)}return(...C)=>(s+=1,L(g)===void 0&&(v=q2(()=>{Be(g,je(h(...C)))})),Tt(()=>()=>{T()}),L(g))}const lA=aA(()=>{const h=new jy,s=Pe(()=>{for(const C of h.values())if(C)return!0;return!1});let g=je({}),v=null;function T(){Qy&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",S0&&(v==null||v()))}return Tt(()=>{const C=L(s);return Bi(()=>{if(!C)return;const w=getComputedStyle(document.body);g.overflow=w.overflow,g.paddingRight=w.paddingRight,g.marginRight=w.marginRight,g.pointerEvents=w.pointerEvents;const c=window.innerWidth-document.documentElement.clientWidth,q={padding:Number.parseInt(g.paddingRight??"0",10)+c,margin:Number.parseInt(g.marginRight??"0",10)};c>0&&(document.body.style.paddingRight=`${q.padding}px`,document.body.style.marginRight=`${q.margin}px`,document.body.style.setProperty("--scrollbar-width",`${c}px`),document.body.style.overflow="hidden"),S0&&(v=Ps(document,"touchmove",K=>{K.target===document.documentElement&&(K.touches.length>1||K.preventDefault())},{passive:!1})),Lc(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Tt(()=>()=>{v==null||v()}),{get map(){return h},resetBodyStyle:T}});function cA(h,s=()=>null){const g=Sr(),v=lA(),T=Pe(s);v.map.set(g,h??!1);const C=Te.with(()=>v.map.get(g)??!1,w=>v.map.set(g,w));return Tt(()=>()=>{v.map.delete(g),!uA(v.map)&&(L(T)===null?requestAnimationFrame(()=>v.resetBodyStyle()):Mp(L(T),()=>v.resetBodyStyle()))}),C}function uA(h){for(const[s,g]of h)if(g)return!0;return!1}function im(h,s){Ct(s,!0);let g=ee(s,"preventScroll",3,!0),v=ee(s,"restoreScrollDelay",3,null);cA(g(),()=>v()),At()}function hA({forceMount:h,present:s,trapFocus:g,open:v}){return h?v&&g:s&&g&&v}var dA=Et("<div><!></div>");function pA(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"forceMount",3,!1),T=ee(s,"ref",15,null),C=Kt(s,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const w=DC({id:Te.with(()=>g()),ref:Te.with(()=>T(),q=>T(q))}),c=Pe(()=>$i(C,w.props));var j=Pe(()=>w.root.open.current||v());ev(h,{get id(){return g()},get present(){return L(j)},presence:K=>{var N=rt(),V=Ve(N);{var se=le=>{var fe=rt(),Se=Ve(fe),ge=Ng(()=>({props:$i(L(c)),...w.snippetProps}));Bt(Se,()=>s.child,()=>L(ge)),be(le,fe)},ie=le=>{var fe=dA();const Se=Pe(()=>$i(L(c)));let ge;var Ee=Zt(fe);Bt(Ee,()=>s.children??ii,()=>w.snippetProps),jt(fe),Lt(()=>ge=Mi(fe,ge,{...L(Se)})),be(le,fe)};gi(V,le=>{s.child?le(se):le(ie,!1)})}be(K,N)},$$slots:{presence:!0}}),At()}var fA=Et("<div><!></div>");function mA(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref"]);const C=LC({id:Te.with(()=>g()),ref:Te.with(()=>v(),N=>v(N))}),w=Pe(()=>$i(T,C.props));var c=rt(),j=Ve(c);{var q=N=>{var V=rt(),se=Ve(V);Bt(se,()=>s.child,()=>({props:L(w)})),be(N,V)},K=N=>{var V=fA();let se;var ie=Zt(V);Bt(ie,()=>s.children??ii),jt(V),Lt(()=>se=Mi(V,se,{...L(w)})),be(N,V)};gi(j,N=>{s.child?N(q):N(K,!1)})}be(h,c),At()}const gA=["top","right","bottom","left"],ia=Math.min,jn=Math.max,rm=Math.round,qf=Math.floor,Is=h=>({x:h,y:h}),_A={left:"right",right:"left",bottom:"top",top:"bottom"},yA={start:"end",end:"start"};function Uy(h,s,g){return jn(h,ia(s,g))}function eo(h,s){return typeof h=="function"?h(s):h}function to(h){return h.split("-")[0]}function Bc(h){return h.split("-")[1]}function iv(h){return h==="x"?"y":"x"}function rv(h){return h==="y"?"height":"width"}function ra(h){return["top","bottom"].includes(to(h))?"y":"x"}function nv(h){return iv(ra(h))}function vA(h,s,g){g===void 0&&(g=!1);const v=Bc(h),T=nv(h),C=rv(T);let w=T==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return s.reference[C]>s.floating[C]&&(w=nm(w)),[w,nm(w)]}function xA(h){const s=nm(h);return[qy(h),s,qy(s)]}function qy(h){return h.replace(/start|end/g,s=>yA[s])}function bA(h,s,g){const v=["left","right"],T=["right","left"],C=["top","bottom"],w=["bottom","top"];switch(h){case"top":case"bottom":return g?s?T:v:s?v:T;case"left":case"right":return s?C:w;default:return[]}}function wA(h,s,g,v){const T=Bc(h);let C=bA(to(h),g==="start",v);return T&&(C=C.map(w=>w+"-"+T),s&&(C=C.concat(C.map(qy)))),C}function nm(h){return h.replace(/left|right|bottom|top/g,s=>_A[s])}function SA(h){return{top:0,right:0,bottom:0,left:0,...h}}function Wb(h){return typeof h!="number"?SA(h):{top:h,right:h,bottom:h,left:h}}function sm(h){const{x:s,y:g,width:v,height:T}=h;return{width:v,height:T,top:g,left:s,right:s+v,bottom:g+T,x:s,y:g}}function D0(h,s,g){let{reference:v,floating:T}=h;const C=ra(s),w=nv(s),c=rv(w),j=to(s),q=C==="y",K=v.x+v.width/2-T.width/2,N=v.y+v.height/2-T.height/2,V=v[c]/2-T[c]/2;let se;switch(j){case"top":se={x:K,y:v.y-T.height};break;case"bottom":se={x:K,y:v.y+v.height};break;case"right":se={x:v.x+v.width,y:N};break;case"left":se={x:v.x-T.width,y:N};break;default:se={x:v.x,y:v.y}}switch(Bc(s)){case"start":se[w]-=V*(g&&q?-1:1);break;case"end":se[w]+=V*(g&&q?-1:1);break}return se}const TA=async(h,s,g)=>{const{placement:v="bottom",strategy:T="absolute",middleware:C=[],platform:w}=g,c=C.filter(Boolean),j=await(w.isRTL==null?void 0:w.isRTL(s));let q=await w.getElementRects({reference:h,floating:s,strategy:T}),{x:K,y:N}=D0(q,v,j),V=v,se={},ie=0;for(let le=0;le<c.length;le++){const{name:fe,fn:Se}=c[le],{x:ge,y:Ee,data:Ne,reset:Le}=await Se({x:K,y:N,initialPlacement:v,placement:V,strategy:T,middlewareData:se,rects:q,platform:w,elements:{reference:h,floating:s}});K=ge??K,N=Ee??N,se={...se,[fe]:{...se[fe],...Ne}},Le&&ie<=50&&(ie++,typeof Le=="object"&&(Le.placement&&(V=Le.placement),Le.rects&&(q=Le.rects===!0?await w.getElementRects({reference:h,floating:s,strategy:T}):Le.rects),{x:K,y:N}=D0(q,V,j)),le=-1)}return{x:K,y:N,placement:V,strategy:T,middlewareData:se}};async function lh(h,s){var g;s===void 0&&(s={});const{x:v,y:T,platform:C,rects:w,elements:c,strategy:j}=h,{boundary:q="clippingAncestors",rootBoundary:K="viewport",elementContext:N="floating",altBoundary:V=!1,padding:se=0}=eo(s,h),ie=Wb(se),fe=c[V?N==="floating"?"reference":"floating":N],Se=sm(await C.getClippingRect({element:(g=await(C.isElement==null?void 0:C.isElement(fe)))==null||g?fe:fe.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(c.floating)),boundary:q,rootBoundary:K,strategy:j})),ge=N==="floating"?{x:v,y:T,width:w.floating.width,height:w.floating.height}:w.reference,Ee=await(C.getOffsetParent==null?void 0:C.getOffsetParent(c.floating)),Ne=await(C.isElement==null?void 0:C.isElement(Ee))?await(C.getScale==null?void 0:C.getScale(Ee))||{x:1,y:1}:{x:1,y:1},Le=sm(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:c,rect:ge,offsetParent:Ee,strategy:j}):ge);return{top:(Se.top-Le.top+ie.top)/Ne.y,bottom:(Le.bottom-Se.bottom+ie.bottom)/Ne.y,left:(Se.left-Le.left+ie.left)/Ne.x,right:(Le.right-Se.right+ie.right)/Ne.x}}const PA=h=>({name:"arrow",options:h,async fn(s){const{x:g,y:v,placement:T,rects:C,platform:w,elements:c,middlewareData:j}=s,{element:q,padding:K=0}=eo(h,s)||{};if(q==null)return{};const N=Wb(K),V={x:g,y:v},se=nv(T),ie=rv(se),le=await w.getDimensions(q),fe=se==="y",Se=fe?"top":"left",ge=fe?"bottom":"right",Ee=fe?"clientHeight":"clientWidth",Ne=C.reference[ie]+C.reference[se]-V[se]-C.floating[ie],Le=V[se]-C.reference[se],We=await(w.getOffsetParent==null?void 0:w.getOffsetParent(q));let tt=We?We[Ee]:0;(!tt||!await(w.isElement==null?void 0:w.isElement(We)))&&(tt=c.floating[Ee]||C.floating[ie]);const Pt=Ne/2-Le/2,$e=tt/2-le[ie]/2-1,nt=ia(N[Se],$e),Re=ia(N[ge],$e),Me=nt,De=tt-le[ie]-Re,Ae=tt/2-le[ie]/2+Pt,Ge=Uy(Me,Ae,De),Xe=!j.arrow&&Bc(T)!=null&&Ae!==Ge&&C.reference[ie]/2-(Ae<Me?nt:Re)-le[ie]/2<0,ft=Xe?Ae<Me?Ae-Me:Ae-De:0;return{[se]:V[se]+ft,data:{[se]:Ge,centerOffset:Ae-Ge-ft,...Xe&&{alignmentOffset:ft}},reset:Xe}}}),IA=function(h){return h===void 0&&(h={}),{name:"flip",options:h,async fn(s){var g,v;const{placement:T,middlewareData:C,rects:w,initialPlacement:c,platform:j,elements:q}=s,{mainAxis:K=!0,crossAxis:N=!0,fallbackPlacements:V,fallbackStrategy:se="bestFit",fallbackAxisSideDirection:ie="none",flipAlignment:le=!0,...fe}=eo(h,s);if((g=C.arrow)!=null&&g.alignmentOffset)return{};const Se=to(T),ge=ra(c),Ee=to(c)===c,Ne=await(j.isRTL==null?void 0:j.isRTL(q.floating)),Le=V||(Ee||!le?[nm(c)]:xA(c)),We=ie!=="none";!V&&We&&Le.push(...wA(c,le,ie,Ne));const tt=[c,...Le],Pt=await lh(s,fe),$e=[];let nt=((v=C.flip)==null?void 0:v.overflows)||[];if(K&&$e.push(Pt[Se]),N){const Ae=vA(T,w,Ne);$e.push(Pt[Ae[0]],Pt[Ae[1]])}if(nt=[...nt,{placement:T,overflows:$e}],!$e.every(Ae=>Ae<=0)){var Re,Me;const Ae=(((Re=C.flip)==null?void 0:Re.index)||0)+1,Ge=tt[Ae];if(Ge)return{data:{index:Ae,overflows:nt},reset:{placement:Ge}};let Xe=(Me=nt.filter(ft=>ft.overflows[0]<=0).sort((ft,dt)=>ft.overflows[1]-dt.overflows[1])[0])==null?void 0:Me.placement;if(!Xe)switch(se){case"bestFit":{var De;const ft=(De=nt.filter(dt=>{if(We){const at=ra(dt.placement);return at===ge||at==="y"}return!0}).map(dt=>[dt.placement,dt.overflows.filter(at=>at>0).reduce((at,ut)=>at+ut,0)]).sort((dt,at)=>dt[1]-at[1])[0])==null?void 0:De[0];ft&&(Xe=ft);break}case"initialPlacement":Xe=c;break}if(T!==Xe)return{reset:{placement:Xe}}}return{}}}};function L0(h,s){return{top:h.top-s.height,right:h.right-s.width,bottom:h.bottom-s.height,left:h.left-s.width}}function R0(h){return gA.some(s=>h[s]>=0)}const CA=function(h){return h===void 0&&(h={}),{name:"hide",options:h,async fn(s){const{rects:g}=s,{strategy:v="referenceHidden",...T}=eo(h,s);switch(v){case"referenceHidden":{const C=await lh(s,{...T,elementContext:"reference"}),w=L0(C,g.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:R0(w)}}}case"escaped":{const C=await lh(s,{...T,altBoundary:!0}),w=L0(C,g.floating);return{data:{escapedOffsets:w,escaped:R0(w)}}}default:return{}}}}};async function AA(h,s){const{placement:g,platform:v,elements:T}=h,C=await(v.isRTL==null?void 0:v.isRTL(T.floating)),w=to(g),c=Bc(g),j=ra(g)==="y",q=["left","top"].includes(w)?-1:1,K=C&&j?-1:1,N=eo(s,h);let{mainAxis:V,crossAxis:se,alignmentAxis:ie}=typeof N=="number"?{mainAxis:N,crossAxis:0,alignmentAxis:null}:{mainAxis:N.mainAxis||0,crossAxis:N.crossAxis||0,alignmentAxis:N.alignmentAxis};return c&&typeof ie=="number"&&(se=c==="end"?ie*-1:ie),j?{x:se*K,y:V*q}:{x:V*q,y:se*K}}const kA=function(h){return h===void 0&&(h=0),{name:"offset",options:h,async fn(s){var g,v;const{x:T,y:C,placement:w,middlewareData:c}=s,j=await AA(s,h);return w===((g=c.offset)==null?void 0:g.placement)&&(v=c.arrow)!=null&&v.alignmentOffset?{}:{x:T+j.x,y:C+j.y,data:{...j,placement:w}}}}},EA=function(h){return h===void 0&&(h={}),{name:"shift",options:h,async fn(s){const{x:g,y:v,placement:T}=s,{mainAxis:C=!0,crossAxis:w=!1,limiter:c={fn:fe=>{let{x:Se,y:ge}=fe;return{x:Se,y:ge}}},...j}=eo(h,s),q={x:g,y:v},K=await lh(s,j),N=ra(to(T)),V=iv(N);let se=q[V],ie=q[N];if(C){const fe=V==="y"?"top":"left",Se=V==="y"?"bottom":"right",ge=se+K[fe],Ee=se-K[Se];se=Uy(ge,se,Ee)}if(w){const fe=N==="y"?"top":"left",Se=N==="y"?"bottom":"right",ge=ie+K[fe],Ee=ie-K[Se];ie=Uy(ge,ie,Ee)}const le=c.fn({...s,[V]:se,[N]:ie});return{...le,data:{x:le.x-g,y:le.y-v,enabled:{[V]:C,[N]:w}}}}}},MA=function(h){return h===void 0&&(h={}),{options:h,fn(s){const{x:g,y:v,placement:T,rects:C,middlewareData:w}=s,{offset:c=0,mainAxis:j=!0,crossAxis:q=!0}=eo(h,s),K={x:g,y:v},N=ra(T),V=iv(N);let se=K[V],ie=K[N];const le=eo(c,s),fe=typeof le=="number"?{mainAxis:le,crossAxis:0}:{mainAxis:0,crossAxis:0,...le};if(j){const Ee=V==="y"?"height":"width",Ne=C.reference[V]-C.floating[Ee]+fe.mainAxis,Le=C.reference[V]+C.reference[Ee]-fe.mainAxis;se<Ne?se=Ne:se>Le&&(se=Le)}if(q){var Se,ge;const Ee=V==="y"?"width":"height",Ne=["top","left"].includes(to(T)),Le=C.reference[N]-C.floating[Ee]+(Ne&&((Se=w.offset)==null?void 0:Se[N])||0)+(Ne?0:fe.crossAxis),We=C.reference[N]+C.reference[Ee]+(Ne?0:((ge=w.offset)==null?void 0:ge[N])||0)-(Ne?fe.crossAxis:0);ie<Le?ie=Le:ie>We&&(ie=We)}return{[V]:se,[N]:ie}}}},zA=function(h){return h===void 0&&(h={}),{name:"size",options:h,async fn(s){var g,v;const{placement:T,rects:C,platform:w,elements:c}=s,{apply:j=()=>{},...q}=eo(h,s),K=await lh(s,q),N=to(T),V=Bc(T),se=ra(T)==="y",{width:ie,height:le}=C.floating;let fe,Se;N==="top"||N==="bottom"?(fe=N,Se=V===(await(w.isRTL==null?void 0:w.isRTL(c.floating))?"start":"end")?"left":"right"):(Se=N,fe=V==="end"?"top":"bottom");const ge=le-K.top-K.bottom,Ee=ie-K.left-K.right,Ne=ia(le-K[fe],ge),Le=ia(ie-K[Se],Ee),We=!s.middlewareData.shift;let tt=Ne,Pt=Le;if((g=s.middlewareData.shift)!=null&&g.enabled.x&&(Pt=Ee),(v=s.middlewareData.shift)!=null&&v.enabled.y&&(tt=ge),We&&!V){const nt=jn(K.left,0),Re=jn(K.right,0),Me=jn(K.top,0),De=jn(K.bottom,0);se?Pt=ie-2*(nt!==0||Re!==0?nt+Re:jn(K.left,K.right)):tt=le-2*(Me!==0||De!==0?Me+De:jn(K.top,K.bottom))}await j({...s,availableWidth:Pt,availableHeight:tt});const $e=await w.getDimensions(c.floating);return ie!==$e.width||le!==$e.height?{reset:{rects:!0}}:{}}}};function Ug(){return typeof window<"u"}function Nc(h){return Hb(h)?(h.nodeName||"").toLowerCase():"#document"}function Un(h){var s;return(h==null||(s=h.ownerDocument)==null?void 0:s.defaultView)||window}function ks(h){var s;return(s=(Hb(h)?h.ownerDocument:h.document)||window.document)==null?void 0:s.documentElement}function Hb(h){return Ug()?h instanceof Node||h instanceof Un(h).Node:!1}function ls(h){return Ug()?h instanceof Element||h instanceof Un(h).Element:!1}function As(h){return Ug()?h instanceof HTMLElement||h instanceof Un(h).HTMLElement:!1}function O0(h){return!Ug()||typeof ShadowRoot>"u"?!1:h instanceof ShadowRoot||h instanceof Un(h).ShadowRoot}function zp(h){const{overflow:s,overflowX:g,overflowY:v,display:T}=cs(h);return/auto|scroll|overlay|hidden|clip/.test(s+v+g)&&!["inline","contents"].includes(T)}function DA(h){return["table","td","th"].includes(Nc(h))}function qg(h){return[":popover-open",":modal"].some(s=>{try{return h.matches(s)}catch{return!1}})}function sv(h){const s=ov(),g=ls(h)?cs(h):h;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!s&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!s&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(v=>(g.willChange||"").includes(v))||["paint","layout","strict","content"].some(v=>(g.contain||"").includes(v))}function LA(h){let s=na(h);for(;As(s)&&!Rc(s);){if(sv(s))return s;if(qg(s))return null;s=na(s)}return null}function ov(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Rc(h){return["html","body","#document"].includes(Nc(h))}function cs(h){return Un(h).getComputedStyle(h)}function Zg(h){return ls(h)?{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}:{scrollLeft:h.scrollX,scrollTop:h.scrollY}}function na(h){if(Nc(h)==="html")return h;const s=h.assignedSlot||h.parentNode||O0(h)&&h.host||ks(h);return O0(s)?s.host:s}function Xb(h){const s=na(h);return Rc(s)?h.ownerDocument?h.ownerDocument.body:h.body:As(s)&&zp(s)?s:Xb(s)}function ch(h,s,g){var v;s===void 0&&(s=[]),g===void 0&&(g=!0);const T=Xb(h),C=T===((v=h.ownerDocument)==null?void 0:v.body),w=Un(T);if(C){const c=Zy(w);return s.concat(w,w.visualViewport||[],zp(T)?T:[],c&&g?ch(c):[])}return s.concat(T,ch(T,[],g))}function Zy(h){return h.parent&&Object.getPrototypeOf(h.parent)?h.frameElement:null}function Kb(h){const s=cs(h);let g=parseFloat(s.width)||0,v=parseFloat(s.height)||0;const T=As(h),C=T?h.offsetWidth:g,w=T?h.offsetHeight:v,c=rm(g)!==C||rm(v)!==w;return c&&(g=C,v=w),{width:g,height:v,$:c}}function av(h){return ls(h)?h:h.contextElement}function Hl(h){const s=av(h);if(!As(s))return Is(1);const g=s.getBoundingClientRect(),{width:v,height:T,$:C}=Kb(s);let w=(C?rm(g.width):g.width)/v,c=(C?rm(g.height):g.height)/T;return(!w||!Number.isFinite(w))&&(w=1),(!c||!Number.isFinite(c))&&(c=1),{x:w,y:c}}const RA=Is(0);function $b(h){const s=Un(h);return!ov()||!s.visualViewport?RA:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function OA(h,s,g){return s===void 0&&(s=!1),!g||s&&g!==Un(h)?!1:s}function Ga(h,s,g,v){s===void 0&&(s=!1),g===void 0&&(g=!1);const T=h.getBoundingClientRect(),C=av(h);let w=Is(1);s&&(v?ls(v)&&(w=Hl(v)):w=Hl(h));const c=OA(C,g,v)?$b(C):Is(0);let j=(T.left+c.x)/w.x,q=(T.top+c.y)/w.y,K=T.width/w.x,N=T.height/w.y;if(C){const V=Un(C),se=v&&ls(v)?Un(v):v;let ie=V,le=Zy(ie);for(;le&&v&&se!==ie;){const fe=Hl(le),Se=le.getBoundingClientRect(),ge=cs(le),Ee=Se.left+(le.clientLeft+parseFloat(ge.paddingLeft))*fe.x,Ne=Se.top+(le.clientTop+parseFloat(ge.paddingTop))*fe.y;j*=fe.x,q*=fe.y,K*=fe.x,N*=fe.y,j+=Ee,q+=Ne,ie=Un(le),le=Zy(ie)}}return sm({width:K,height:N,x:j,y:q})}function lv(h,s){const g=Zg(h).scrollLeft;return s?s.left+g:Ga(ks(h)).left+g}function Jb(h,s,g){g===void 0&&(g=!1);const v=h.getBoundingClientRect(),T=v.left+s.scrollLeft-(g?0:lv(h,v)),C=v.top+s.scrollTop;return{x:T,y:C}}function FA(h){let{elements:s,rect:g,offsetParent:v,strategy:T}=h;const C=T==="fixed",w=ks(v),c=s?qg(s.floating):!1;if(v===w||c&&C)return g;let j={scrollLeft:0,scrollTop:0},q=Is(1);const K=Is(0),N=As(v);if((N||!N&&!C)&&((Nc(v)!=="body"||zp(w))&&(j=Zg(v)),As(v))){const se=Ga(v);q=Hl(v),K.x=se.x+v.clientLeft,K.y=se.y+v.clientTop}const V=w&&!N&&!C?Jb(w,j,!0):Is(0);return{width:g.width*q.x,height:g.height*q.y,x:g.x*q.x-j.scrollLeft*q.x+K.x+V.x,y:g.y*q.y-j.scrollTop*q.y+K.y+V.y}}function BA(h){return Array.from(h.getClientRects())}function NA(h){const s=ks(h),g=Zg(h),v=h.ownerDocument.body,T=jn(s.scrollWidth,s.clientWidth,v.scrollWidth,v.clientWidth),C=jn(s.scrollHeight,s.clientHeight,v.scrollHeight,v.clientHeight);let w=-g.scrollLeft+lv(h);const c=-g.scrollTop;return cs(v).direction==="rtl"&&(w+=jn(s.clientWidth,v.clientWidth)-T),{width:T,height:C,x:w,y:c}}function VA(h,s){const g=Un(h),v=ks(h),T=g.visualViewport;let C=v.clientWidth,w=v.clientHeight,c=0,j=0;if(T){C=T.width,w=T.height;const q=ov();(!q||q&&s==="fixed")&&(c=T.offsetLeft,j=T.offsetTop)}return{width:C,height:w,x:c,y:j}}function jA(h,s){const g=Ga(h,!0,s==="fixed"),v=g.top+h.clientTop,T=g.left+h.clientLeft,C=As(h)?Hl(h):Is(1),w=h.clientWidth*C.x,c=h.clientHeight*C.y,j=T*C.x,q=v*C.y;return{width:w,height:c,x:j,y:q}}function F0(h,s,g){let v;if(s==="viewport")v=VA(h,g);else if(s==="document")v=NA(ks(h));else if(ls(s))v=jA(s,g);else{const T=$b(h);v={x:s.x-T.x,y:s.y-T.y,width:s.width,height:s.height}}return sm(v)}function Yb(h,s){const g=na(h);return g===s||!ls(g)||Rc(g)?!1:cs(g).position==="fixed"||Yb(g,s)}function UA(h,s){const g=s.get(h);if(g)return g;let v=ch(h,[],!1).filter(c=>ls(c)&&Nc(c)!=="body"),T=null;const C=cs(h).position==="fixed";let w=C?na(h):h;for(;ls(w)&&!Rc(w);){const c=cs(w),j=sv(w);!j&&c.position==="fixed"&&(T=null),(C?!j&&!T:!j&&c.position==="static"&&!!T&&["absolute","fixed"].includes(T.position)||zp(w)&&!j&&Yb(h,w))?v=v.filter(K=>K!==w):T=c,w=na(w)}return s.set(h,v),v}function qA(h){let{element:s,boundary:g,rootBoundary:v,strategy:T}=h;const w=[...g==="clippingAncestors"?qg(s)?[]:UA(s,this._c):[].concat(g),v],c=w[0],j=w.reduce((q,K)=>{const N=F0(s,K,T);return q.top=jn(N.top,q.top),q.right=ia(N.right,q.right),q.bottom=ia(N.bottom,q.bottom),q.left=jn(N.left,q.left),q},F0(s,c,T));return{width:j.right-j.left,height:j.bottom-j.top,x:j.left,y:j.top}}function ZA(h){const{width:s,height:g}=Kb(h);return{width:s,height:g}}function GA(h,s,g){const v=As(s),T=ks(s),C=g==="fixed",w=Ga(h,!0,C,s);let c={scrollLeft:0,scrollTop:0};const j=Is(0);if(v||!v&&!C)if((Nc(s)!=="body"||zp(T))&&(c=Zg(s)),v){const V=Ga(s,!0,C,s);j.x=V.x+s.clientLeft,j.y=V.y+s.clientTop}else T&&(j.x=lv(T));const q=T&&!v&&!C?Jb(T,c):Is(0),K=w.left+c.scrollLeft-j.x-q.x,N=w.top+c.scrollTop-j.y-q.y;return{x:K,y:N,width:w.width,height:w.height}}function vy(h){return cs(h).position==="static"}function B0(h,s){if(!As(h)||cs(h).position==="fixed")return null;if(s)return s(h);let g=h.offsetParent;return ks(h)===g&&(g=g.ownerDocument.body),g}function Qb(h,s){const g=Un(h);if(qg(h))return g;if(!As(h)){let T=na(h);for(;T&&!Rc(T);){if(ls(T)&&!vy(T))return T;T=na(T)}return g}let v=B0(h,s);for(;v&&DA(v)&&vy(v);)v=B0(v,s);return v&&Rc(v)&&vy(v)&&!sv(v)?g:v||LA(h)||g}const WA=async function(h){const s=this.getOffsetParent||Qb,g=this.getDimensions,v=await g(h.floating);return{reference:GA(h.reference,await s(h.floating),h.strategy),floating:{x:0,y:0,width:v.width,height:v.height}}};function HA(h){return cs(h).direction==="rtl"}const XA={convertOffsetParentRelativeRectToViewportRelativeRect:FA,getDocumentElement:ks,getClippingRect:qA,getOffsetParent:Qb,getElementRects:WA,getClientRects:BA,getDimensions:ZA,getScale:Hl,isElement:ls,isRTL:HA};function KA(h,s){let g=null,v;const T=ks(h);function C(){var c;clearTimeout(v),(c=g)==null||c.disconnect(),g=null}function w(c,j){c===void 0&&(c=!1),j===void 0&&(j=1),C();const{left:q,top:K,width:N,height:V}=h.getBoundingClientRect();if(c||s(),!N||!V)return;const se=qf(K),ie=qf(T.clientWidth-(q+N)),le=qf(T.clientHeight-(K+V)),fe=qf(q),ge={rootMargin:-se+"px "+-ie+"px "+-le+"px "+-fe+"px",threshold:jn(0,ia(1,j))||1};let Ee=!0;function Ne(Le){const We=Le[0].intersectionRatio;if(We!==j){if(!Ee)return w();We?w(!1,We):v=setTimeout(()=>{w(!1,1e-7)},1e3)}Ee=!1}try{g=new IntersectionObserver(Ne,{...ge,root:T.ownerDocument})}catch{g=new IntersectionObserver(Ne,ge)}g.observe(h)}return w(!0),C}function $A(h,s,g,v){v===void 0&&(v={});const{ancestorScroll:T=!0,ancestorResize:C=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:c=typeof IntersectionObserver=="function",animationFrame:j=!1}=v,q=av(h),K=T||C?[...q?ch(q):[],...ch(s)]:[];K.forEach(Se=>{T&&Se.addEventListener("scroll",g,{passive:!0}),C&&Se.addEventListener("resize",g)});const N=q&&c?KA(q,g):null;let V=-1,se=null;w&&(se=new ResizeObserver(Se=>{let[ge]=Se;ge&&ge.target===q&&se&&(se.unobserve(s),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var Ee;(Ee=se)==null||Ee.observe(s)})),g()}),q&&!j&&se.observe(q),se.observe(s));let ie,le=j?Ga(h):null;j&&fe();function fe(){const Se=Ga(h);le&&(Se.x!==le.x||Se.y!==le.y||Se.width!==le.width||Se.height!==le.height)&&g(),le=Se,ie=requestAnimationFrame(fe)}return g(),()=>{var Se;K.forEach(ge=>{T&&ge.removeEventListener("scroll",g),C&&ge.removeEventListener("resize",g)}),N==null||N(),(Se=se)==null||Se.disconnect(),se=null,j&&cancelAnimationFrame(ie)}}const JA=kA,YA=EA,QA=IA,ek=zA,tk=CA,ik=PA,rk=MA,nk=(h,s,g)=>{const v=new Map,T={platform:XA,...g},C={...T.platform,_c:v};return TA(h,s,{...T,platform:C})};function eh(h){return typeof h=="function"?h():h}function ew(h){return typeof window>"u"?1:(h.ownerDocument.defaultView||window).devicePixelRatio||1}function N0(h,s){const g=ew(h);return Math.round(s*g)/g}function V0(h){return{[`--bits-${h}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${h}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${h}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${h}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${h}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function sk(h){const s=h.whileElementsMounted,g=Pe(()=>eh(h.open)??!0),v=Pe(()=>eh(h.middleware)),T=Pe(()=>eh(h.transform)??!0),C=Pe(()=>eh(h.placement)??"bottom"),w=Pe(()=>eh(h.strategy)??"absolute"),c=h.reference;let j=Je(0),q=Je(0);const K=Te(null);let N=Je(je(L(w))),V=Je(je(L(C))),se=Je(je({})),ie=Je(!1);const le=Pe(()=>{const Le={position:L(N),left:"0",top:"0"};if(!K.current)return Le;const We=N0(K.current,L(j)),tt=N0(K.current,L(q));return L(T)?{...Le,transform:`translate(${We}px, ${tt}px)`,...ew(K.current)>=1.5&&{willChange:"transform"}}:{position:L(N),left:`${We}px`,top:`${tt}px`}});let fe;function Se(){c.current===null||K.current===null||nk(c.current,K.current,{middleware:L(v),placement:L(C),strategy:L(w)}).then(Le=>{Be(j,je(Le.x)),Be(q,je(Le.y)),Be(N,je(Le.strategy)),Be(V,je(Le.placement)),Be(se,je(Le.middlewareData)),Be(ie,!0)})}function ge(){typeof fe=="function"&&(fe(),fe=void 0)}function Ee(){if(ge(),s===void 0){Se();return}c.current===null||K.current===null||(fe=s(c.current,K.current,Se))}function Ne(){L(g)||Be(ie,!1)}return Tt(Se),Tt(Ee),Tt(Ne),Tt(()=>ge),{floating:K,reference:c,get strategy(){return L(N)},get placement(){return L(V)},get middlewareData(){return L(se)},get isPositioned(){return L(ie)},get floatingStyles(){return L(le)},get update(){return Se}}}const ok={top:"bottom",right:"left",bottom:"top",left:"right"};class ak{constructor(){qe(this,"anchorNode",Te(null));qe(this,"customAnchorNode",Te(null));qe(this,"triggerNode",Te(null));Tt(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Nh,Vh,jh,Uh,cc,qh,Zh,uc,Na,Gh,Wh,Hh,Xh,Kh,$h,km,Jh,Em,Yh,Mm,zm,Qh,ed,td,id,Dm,Lm,Rm,Om,Fm,Bm,rd,Nm,Vm,jm,Um;class lk{constructor(s,g){qe(this,"root");qe(this,"contentRef",Te(null));qe(this,"wrapperRef",Te(null));qe(this,"arrowRef",Te(null));qe(this,"arrowId",Te(Sr()));qe(this,"id");qe(this,"wrapperId");qe(this,"style");X(this,Nh,Pe(()=>{if(typeof this.style=="string")return sh(this.style);if(!this.style)return{}}));X(this,Vh);X(this,jh);X(this,Uh);X(this,cc);X(this,qh);X(this,Zh);X(this,uc);X(this,Na);X(this,Gh);X(this,Wh);X(this,Hh);X(this,Xh);X(this,Kh);qe(this,"onPlaced");qe(this,"enabled");X(this,$h,new vC(()=>this.arrowRef.current??void 0));X(this,km,Pe(()=>{var s;return((s=I(this,$h))==null?void 0:s.width)??0}));X(this,Jh,Pe(()=>{var s;return((s=I(this,$h))==null?void 0:s.height)??0}));X(this,Em,Pe(()=>{var s;return((s=I(this,jh))==null?void 0:s.current)+(I(this,cc).current!=="center"?`-${I(this,cc).current}`:"")}));X(this,Yh,Pe(()=>Array.isArray(I(this,Na).current)?I(this,Na).current:[I(this,Na).current]));X(this,Mm,Pe(()=>L(I(this,Yh)).length>0));X(this,zm,Pe(()=>({padding:I(this,Gh).current,boundary:L(I(this,Yh)).filter(hC),altBoundary:this.hasExplicitBoundaries})));X(this,Qh,Je(void 0));X(this,ed,Je(void 0));X(this,td,Je(void 0));X(this,id,Je(void 0));X(this,Dm,Pe(()=>[JA({mainAxis:I(this,Uh).current+L(I(this,Jh)),alignmentAxis:I(this,qh).current}),I(this,uc)&&YA({mainAxis:!0,crossAxis:!1,limiter:I(this,Wh).current==="partial"?rk():void 0,...this.detectOverflowOptions}),I(this,uc)&&QA({...this.detectOverflowOptions}),ek({...this.detectOverflowOptions,apply:({rects:s,availableWidth:g,availableHeight:v})=>{const{width:T,height:C}=s.reference;Be(I(this,Qh),je(g)),Be(I(this,ed),je(v)),Be(I(this,td),je(T)),Be(I(this,id),je(C))}}),this.arrowRef.current&&ik({element:this.arrowRef.current,padding:I(this,Zh).current}),mk({arrowWidth:L(I(this,km)),arrowHeight:L(I(this,Jh))}),I(this,Hh).current&&tk({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));qe(this,"floating");X(this,Lm,Pe(()=>gk(this.floating.placement)));X(this,Rm,Pe(()=>_k(this.floating.placement)));X(this,Om,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.x)??0}));X(this,Fm,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.y)??0}));X(this,Bm,Pe(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.centerOffset)!==0}));X(this,rd,Je());X(this,Nm,Pe(()=>ok[this.placedSide]));X(this,Vm,Pe(()=>{var s,g,v;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(s=this.floating.middlewareData.transformOrigin)==null?void 0:s.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${L(I(this,Qh))}px`,"--bits-floating-available-height":`${L(I(this,ed))}px`,"--bits-floating-anchor-width":`${L(I(this,td))}px`,"--bits-floating-anchor-height":`${L(I(this,id))}px`,...((v=this.floating.middlewareData.hide)==null?void 0:v.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...L(I(this,Nh))},dir:I(this,Vh).current}}));X(this,jm,Pe(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:Jy({...L(I(this,Nh))})})));X(this,Um,Pe(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=s.id,Ze(this,jh,s.side),Ze(this,Uh,s.sideOffset),Ze(this,cc,s.align),Ze(this,qh,s.alignOffset),Ze(this,Zh,s.arrowPadding),Ze(this,uc,s.avoidCollisions),Ze(this,Na,s.collisionBoundary),Ze(this,Gh,s.collisionPadding),Ze(this,Wh,s.sticky),Ze(this,Hh,s.hideWhenDetached),Ze(this,Kh,s.updatePositionStrategy),this.onPlaced=s.onPlaced,Ze(this,Xh,s.strategy),Ze(this,Vh,s.dir),this.style=s.style,this.root=g,this.enabled=s.enabled,this.wrapperId=s.wrapperId,s.customAnchor&&(this.root.customAnchorNode.current=s.customAnchor.current),Tt(()=>{s.customAnchor.current,Bi(()=>{this.root.customAnchorNode.current=s.customAnchor.current})}),lr({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),lr({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=sk({strategy:()=>I(this,Xh).current,placement:()=>L(I(this,Em)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...v)=>{var C;return $A(...v,{animationFrame:((C=I(this,Kh))==null?void 0:C.current)==="always"})},open:()=>this.enabled.current}),Tt(()=>{var v;this.floating.isPositioned&&((v=this.onPlaced)==null||v.current())}),Tt(()=>{const v=this.contentRef.current;v&&Bi(()=>{this.contentZIndex=window.getComputedStyle(v).zIndex})}),Tt(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return L(I(this,Mm))}get detectOverflowOptions(){return L(I(this,zm))}get middleware(){return L(I(this,Dm))}get placedSide(){return L(I(this,Lm))}get placedAlign(){return L(I(this,Rm))}get arrowX(){return L(I(this,Om))}get arrowY(){return L(I(this,Fm))}get cannotCenterArrow(){return L(I(this,Bm))}get contentZIndex(){return L(I(this,rd))}set contentZIndex(s){Be(I(this,rd),je(s))}get arrowBaseSide(){return L(I(this,Nm))}get wrapperProps(){return L(I(this,Vm))}get props(){return L(I(this,jm))}get arrowStyle(){return L(I(this,Um))}}Nh=new WeakMap,Vh=new WeakMap,jh=new WeakMap,Uh=new WeakMap,cc=new WeakMap,qh=new WeakMap,Zh=new WeakMap,uc=new WeakMap,Na=new WeakMap,Gh=new WeakMap,Wh=new WeakMap,Hh=new WeakMap,Xh=new WeakMap,Kh=new WeakMap,$h=new WeakMap,km=new WeakMap,Jh=new WeakMap,Em=new WeakMap,Yh=new WeakMap,Mm=new WeakMap,zm=new WeakMap,Qh=new WeakMap,ed=new WeakMap,td=new WeakMap,id=new WeakMap,Dm=new WeakMap,Lm=new WeakMap,Rm=new WeakMap,Om=new WeakMap,Fm=new WeakMap,Bm=new WeakMap,rd=new WeakMap,Nm=new WeakMap,Vm=new WeakMap,jm=new WeakMap,Um=new WeakMap;class ck{constructor(s,g){qe(this,"ref",Te(null));s.virtualEl&&s.virtualEl.current?g.triggerNode=Te.from(s.virtualEl.current):lr({id:s.id,ref:this.ref,onRefChange:v=>{g.triggerNode.current=v}})}}const[uk,tw]=Wa("Floating.Root"),[hk,oD]=Wa("Floating.Content");function dk(){return uk(new ak)}function pk(h){return hk(new lk(h,tw()))}function fk(h){return new ck(h,tw())}function mk(h){return{name:"transformOrigin",options:h,fn(s){var fe,Se,ge;const{placement:g,rects:v,middlewareData:T}=s,w=((fe=T.arrow)==null?void 0:fe.centerOffset)!==0,c=w?0:h.arrowWidth,j=w?0:h.arrowHeight,[q,K]=cv(g),N={start:"0%",center:"50%",end:"100%"}[K],V=(((Se=T.arrow)==null?void 0:Se.x)??0)+c/2,se=(((ge=T.arrow)==null?void 0:ge.y)??0)+j/2;let ie="",le="";return q==="bottom"?(ie=w?N:`${V}px`,le=`${-j}px`):q==="top"?(ie=w?N:`${V}px`,le=`${v.floating.height+j}px`):q==="right"?(ie=`${-j}px`,le=w?N:`${se}px`):q==="left"&&(ie=`${v.floating.width+j}px`,le=w?N:`${se}px`),{data:{x:ie,y:le}}}}}function cv(h){const[s,g="center"]=h.split("-");return[s,g]}function gk(h){return cv(h)[0]}function _k(h){return cv(h)[1]}function yk(h,s){Ct(s,!0),dk();var g=rt(),v=Ve(g);Bt(v,()=>s.children??ii),be(h,g),At()}function vk(h,s){Ct(s,!0),fk({id:Te.with(()=>s.id),virtualEl:Te.with(()=>s.virtualEl)});var g=rt(),v=Ve(g);Bt(v,()=>s.children??ii),be(h,g),At()}var xk=Et("<div><!></div>");function bk(h,s){Ct(s,!0);let g=ee(s,"side",3,"bottom"),v=ee(s,"sideOffset",3,0),T=ee(s,"align",3,"center"),C=ee(s,"alignOffset",3,0),w=ee(s,"arrowPadding",3,0),c=ee(s,"avoidCollisions",3,!0),j=ee(s,"collisionBoundary",19,()=>[]),q=ee(s,"collisionPadding",3,0),K=ee(s,"hideWhenDetached",3,!1),N=ee(s,"onPlaced",3,()=>{}),V=ee(s,"sticky",3,"partial"),se=ee(s,"updatePositionStrategy",3,"optimized"),ie=ee(s,"strategy",3,"fixed"),le=ee(s,"dir",3,"ltr"),fe=ee(s,"style",19,()=>({})),Se=ee(s,"wrapperId",19,Sr),ge=ee(s,"customAnchor",3,null);const Ee=pk({side:Te.with(()=>g()),sideOffset:Te.with(()=>v()),align:Te.with(()=>T()),alignOffset:Te.with(()=>C()),id:Te.with(()=>s.id),arrowPadding:Te.with(()=>w()),avoidCollisions:Te.with(()=>c()),collisionBoundary:Te.with(()=>j()),collisionPadding:Te.with(()=>q()),hideWhenDetached:Te.with(()=>K()),onPlaced:Te.with(()=>N()),sticky:Te.with(()=>V()),updatePositionStrategy:Te.with(()=>se()),strategy:Te.with(()=>ie()),dir:Te.with(()=>le()),style:Te.with(()=>fe()),enabled:Te.with(()=>!1),wrapperId:Te.with(()=>Se()),customAnchor:Te.with(()=>ge())}),Ne=Pe(()=>$i(Ee.wrapperProps,{style:{pointerEvents:"auto"}}));var Le=xk();let We;var tt=Zt(Le);Bt(tt,()=>s.content??ii,()=>({props:Ee.props})),jt(Le),Lt(()=>We=Mi(Le,We,{...L(Ne)})),be(h,Le),At()}function wk(h,s){Ct(s,!0),sb(()=>{var T;(T=s.onPlaced)==null||T.call(s)});var g=rt(),v=Ve(g);Bt(v,()=>s.content??ii,()=>({props:{}})),be(h,g),At()}function Sk(h,s){let g=ee(s,"isStatic",3,!1),v=Kt(s,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var T=rt(),C=Ve(T);{var w=j=>{wk(j,{get content(){return s.content},get onPlaced(){return s.onPlaced}})},c=j=>{bk(j,$t({get content(){return s.content},get onPlaced(){return s.onPlaced}},()=>v))};gi(C,j=>{g()?j(w):j(c,!1)})}be(h,T)}var Tk=Et("<!> <!>",1);function iw(h,s){Ct(s,!0);let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),w=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);Sk(h,{get isStatic(){return w()},get id(){return s.id},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},content:(q,K)=>{let N=()=>K==null?void 0:K().props;var V=Tk(),se=Ve(V);{var ie=ge=>{im(ge,{get preventScroll(){return s.preventScroll}})},le=ge=>{var Ee=rt(),Ne=Ve(Ee);{var Le=We=>{im(We,{get preventScroll(){return s.preventScroll}})};gi(Ne,We=>{s.forceMount||We(Le)},!0)}be(ge,Ee)};gi(se,ge=>{s.forceMount&&s.enabled?ge(ie):ge(le,!1)})}var fe=Qt(se,2),Se=Pe(()=>s.enabled&&v());Ub(fe,{get id(){return s.id},get onOpenAutoFocus(){return s.onOpenAutoFocus},get onCloseAutoFocus(){return s.onCloseAutoFocus},get loop(){return s.loop},get trapFocus(){return L(Se)},get forceMount(){return s.forceMount},focusScope:(Ee,Ne)=>{let Le=()=>Ne==null?void 0:Ne().props;Vb(Ee,{get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get enabled(){return s.enabled},children:(We,tt)=>{Nb(We,{get id(){return s.id},get onInteractOutside(){return s.onInteractOutside},get onFocusOutside(){return s.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return T()},get enabled(){return s.enabled},children:($e,nt)=>{let Re=()=>nt==null?void 0:nt().props;Zb($e,{get id(){return s.id},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get enabled(){return s.enabled},children:(Me,De)=>{var Ae=rt(),Ge=Ve(Ae),Xe=Ng(()=>({props:$i(c,N(),Re(),Le(),{style:{pointerEvents:"auto"}})}));Bt(Ge,()=>s.popper??ii,()=>L(Xe)),be(Me,Ae)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),be(q,V)},$$slots:{content:!0}}),At()}function Pk(h,s){let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),w=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);ev(h,$t({get id(){return s.id},get present(){return s.present}},()=>c,{presence:(q,K)=>{let N=()=>K==null?void 0:K().present;iw(q,$t({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return w()},get enabled(){return N().current},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside},forceMount:!1},()=>c))},$$slots:{presence:!0}}))}function Ik(h,s){let g=ee(s,"interactOutsideBehavior",3,"close"),v=ee(s,"trapFocus",3,!0),T=ee(s,"isValidEvent",3,()=>!1),C=ee(s,"customAnchor",3,null),w=ee(s,"isStatic",3,!1),c=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);iw(h,$t({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return w()},get enabled(){return s.enabled},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside}},()=>c,{forceMount:!0}))}function Ck(h,s){let g=h.nextElementSibling;for(;g;){if(g.matches(s))return g;g=g.nextElementSibling}}function Ak(h,s){let g=h.previousElementSibling;for(;g;){if(g.matches(s))return g;g=g.previousElementSibling}}const j0=1,kk=.9,Ek=.8,Mk=.17,xy=.1,by=.999,zk=.9999,Dk=.99,Lk=/[\\/_+.#"@[({&]/,Rk=/[\\/_+.#"@[({&]/g,Ok=/[\s-]/,rw=/[\s-]/g;function Gy(h,s,g,v,T,C,w){if(C===s.length)return T===h.length?j0:Dk;const c=`${T},${C}`;if(w[c]!==void 0)return w[c];const j=v.charAt(C);let q=g.indexOf(j,T),K=0,N,V,se,ie;for(;q>=0;)N=Gy(h,s,g,v,q+1,C+1,w),N>K&&(q===T?N*=j0:Lk.test(h.charAt(q-1))?(N*=Ek,se=h.slice(T,q-1).match(Rk),se&&T>0&&(N*=by**se.length)):Ok.test(h.charAt(q-1))?(N*=kk,ie=h.slice(T,q-1).match(rw),ie&&T>0&&(N*=by**ie.length)):(N*=Mk,T>0&&(N*=by**(q-T))),h.charAt(q)!==s.charAt(C)&&(N*=zk)),(N<xy&&g.charAt(q-1)===v.charAt(C+1)||v.charAt(C+1)===v.charAt(C)&&g.charAt(q-1)!==v.charAt(C))&&(V=Gy(h,s,g,v,q+1,C+2,w),V*xy>N&&(N=V*xy)),N>K&&(K=N),q=g.indexOf(j,q+1);return w[c]=K,K}function U0(h){return h.toLowerCase().replace(rw," ")}function Fk(h,s,g){return h=g&&g.length>0?`${`${h} ${g==null?void 0:g.join(" ")}`}`:h,Gy(h,s,U0(h),U0(s),0,0,{})}function Bk(h){if(!h)return null;for(const s of h.childNodes)if(s.nodeType!==Node.COMMENT_NODE)return s;return null}const Nk="data-command-root",Vk="data-command-list",jk="data-command-input",Uk="data-command-empty",nw="data-command-group",sw="data-command-group-items",ow="data-command-group-heading",aw="data-command-item",La="data-value",qk="data-command-input-label",th=`[${nw}]`,wy=`[${sw}]`,Zk=`[${ow}]`,lw=`[${aw}]`,Sy=`${lw}:not([aria-disabled="true"])`;function cw(h,s,g){return Fk(h,s,g)}const[Gk,Vc]=Wa("Command.Root"),[Wk,aD]=Wa("Command.List"),[Hk,Gg]=Wa("Command.Group");var nd,sd,od,ad,hc,ld,cd,ud,dc,pc,fc,Jo,Yo,qm,mc,gc,hd,dd,pd,fd,Zm,Gm;class Xk{constructor(s){qe(this,"allItems",new Set);qe(this,"allGroups",new Map);qe(this,"allIds",new Map);qe(this,"id");qe(this,"ref");qe(this,"filter");qe(this,"shouldFilter");qe(this,"loop");X(this,nd,Je(0));X(this,sd,Je(null));X(this,od,Je(null));X(this,ad,Je(null));qe(this,"valueProp");X(this,hc);qe(this,"disablePointerSelection");X(this,ld,Je(null));X(this,cd,Je(null));qe(this,"snapshot",()=>this._commandState);qe(this,"setState",(s,g,v)=>{Object.is(this._commandState[s],g)||(this._commandState[s]=g,s==="search"?(I(this,fc).call(this),I(this,dc).call(this),I(this,pc).call(this)):s==="value"&&(v||I(this,qm).call(this)),this.emit())});qe(this,"emit",()=>{this.commandState=ab(this._commandState)});X(this,ud,(s,g)=>{const v=this.filter.current??cw;return s?v(s,this._commandState.search,g):0});X(this,dc,()=>{var w;if(!this._commandState.search||this.shouldFilter.current===!1)return;const s=this._commandState.filtered.items,g=[];for(const c of this._commandState.filtered.groups){const j=this.allGroups.get(c);let q=0;if(!j){g.push([c,q]);continue}for(const K of j){const N=s.get(K);q=Math.max(N??0,q)}g.push([c,q])}const v=this.viewportNode,T=I(this,Jo).call(this).sort((c,j)=>{const q=c.getAttribute("id"),K=j.getAttribute("id"),N=s.get(q)??0;return(s.get(K)??0)-N});for(const c of T){const j=c.closest(wy);if(j){const q=c.parentElement===j?c:c.closest(`${wy} > *`);q&&j.appendChild(q)}else{const q=c.parentElement===v?c:c.closest(`${wy} > *`);q&&(v==null||v.appendChild(q))}}const C=g.sort((c,j)=>j[1]-c[1]);for(const c of C){const j=v==null?void 0:v.querySelector(`${th}[${La}="${encodeURIComponent(c[0])}"]`);(w=j==null?void 0:j.parentElement)==null||w.appendChild(j)}});qe(this,"setValue",(s,g)=>{s!==this.valueProp.current&&s===""&&Lc(()=>{this.key++}),this.setState("value",s,g),this.valueProp.current=s});X(this,pc,()=>{Lc(()=>{const s=I(this,Jo).call(this).find(v=>v.getAttribute("aria-disabled")!=="true"),g=s==null?void 0:s.getAttribute(La);this.setValue(g||"")})});X(this,fc,()=>{var g,v;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let s=0;for(const T of this.allItems){const C=((g=this.allIds.get(T))==null?void 0:g.value)??"",w=((v=this.allIds.get(T))==null?void 0:v.keywords)??[],c=I(this,ud).call(this,C,w);this._commandState.filtered.items.set(T,c),c>0&&s++}for(const[T,C]of this.allGroups)for(const w of C){const c=this._commandState.filtered.items.get(w);if(c&&c>0){this._commandState.filtered.groups.add(T);break}}this._commandState.filtered.count=s});X(this,Jo,()=>{const s=this.ref.current;return s?Array.from(s.querySelectorAll(Sy)).filter(v=>!!v):[]});X(this,Yo,()=>{const s=this.ref.current;if(!s)return;const g=s.querySelector(`${Sy}[aria-selected="true"]`);if(g)return g});X(this,qm,()=>{Mp(1,()=>{var T,C,w,c,j;const s=I(this,Yo).call(this);if(!s)return;const g=(T=s.parentElement)==null?void 0:T.parentElement;if(!g)return;const v=Bk(g);if(v&&((C=v.dataset)==null?void 0:C.value)===((w=s.dataset)==null?void 0:w.value)){(j=(c=s==null?void 0:s.closest(th))==null?void 0:c.querySelector(Zk))==null||j.scrollIntoView({block:"nearest"});return}s.scrollIntoView({block:"nearest"})})});X(this,mc,s=>{const v=I(this,Jo).call(this)[s];v&&this.setValue(v.getAttribute(La)??"")});X(this,gc,s=>{const g=I(this,Yo).call(this),v=I(this,Jo).call(this),T=v.findIndex(w=>w===g);let C=v[T+s];this.loop.current&&(C=T+s<0?v[v.length-1]:T+s===v.length?v[0]:v[T+s]),C&&this.setValue(C.getAttribute(La)??"")});X(this,hd,s=>{const g=I(this,Yo).call(this);let v=g==null?void 0:g.closest(th),T;for(;v&&!T;)v=s>0?Ck(v,th):Ak(v,th),T=v==null?void 0:v.querySelector(Sy);T?this.setValue(T.getAttribute(La)??""):I(this,gc).call(this,s)});qe(this,"registerValue",(s,g,v)=>{var T;if(g!==((T=this.allIds.get(s))==null?void 0:T.value))return this.allIds.set(s,{value:g,keywords:v}),this._commandState.filtered.items.set(s,I(this,ud).call(this,g,v)),I(this,dc).call(this),this.emit(),()=>{this.allIds.delete(s)}});qe(this,"registerItem",(s,g)=>(this.allItems.add(s),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(s):this.allGroups.set(g,new Set([s]))),I(this,fc).call(this),I(this,dc).call(this),this.commandState.value||I(this,pc).call(this),this.emit(),()=>{this.allIds.delete(s),this.allItems.delete(s),this.commandState.filtered.items.delete(s);const v=I(this,Yo).call(this);I(this,fc).call(this),(v==null?void 0:v.getAttribute("id"))===s&&I(this,pc).call(this),this.emit()}));qe(this,"registerGroup",s=>(this.allGroups.has(s)||this.allGroups.set(s,new Set),()=>{this.allIds.delete(s),this.allGroups.delete(s)}));X(this,dd,()=>I(this,mc).call(this,I(this,Jo).call(this).length-1));X(this,pd,s=>{s.preventDefault(),s.metaKey?I(this,dd).call(this):s.altKey?I(this,hd).call(this,1):I(this,gc).call(this,1)});X(this,fd,s=>{s.preventDefault(),s.metaKey?I(this,mc).call(this,0):s.altKey?I(this,hd).call(this,-1):I(this,gc).call(this,-1)});X(this,Zm,s=>{switch(s.key){case oC:case aC:{I(this,hc).current&&s.ctrlKey&&I(this,pd).call(this,s);break}case YI:I(this,pd).call(this,s);break;case sC:case lC:{I(this,hc).current&&s.ctrlKey&&I(this,fd).call(this,s);break}case QI:I(this,fd).call(this,s);break;case iC:s.preventDefault(),I(this,mc).call(this,0);break;case eC:s.preventDefault(),I(this,dd).call(this);break;case Lb:if(!s.isComposing&&s.keyCode!==229){s.preventDefault();const g=I(this,Yo).call(this);g&&(g==null||g.click())}}});X(this,Gm,Pe(()=>({id:this.id.current,role:"application",[Nk]:"",tabindex:-1,onkeydown:I(this,Zm)})));this.id=s.id,this.ref=s.ref,this.filter=s.filter,this.shouldFilter=s.shouldFilter,this.loop=s.loop,this.valueProp=s.value,Ze(this,hc,s.vimBindings),this.disablePointerSelection=s.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,lr({id:this.id,ref:this.ref})}get key(){return L(I(this,nd))}set key(s){Be(I(this,nd),je(s))}get viewportNode(){return L(I(this,sd))}set viewportNode(s){Be(I(this,sd),je(s))}get inputNode(){return L(I(this,od))}set inputNode(s){Be(I(this,od),je(s))}get labelNode(){return L(I(this,ad))}set labelNode(s){Be(I(this,ad),je(s))}get commandState(){return L(I(this,ld))}set commandState(s){Be(I(this,ld),s)}get _commandState(){return L(I(this,cd))}set _commandState(s){Be(I(this,cd),je(s))}get props(){return L(I(this,Gm))}}nd=new WeakMap,sd=new WeakMap,od=new WeakMap,ad=new WeakMap,hc=new WeakMap,ld=new WeakMap,cd=new WeakMap,ud=new WeakMap,dc=new WeakMap,pc=new WeakMap,fc=new WeakMap,Jo=new WeakMap,Yo=new WeakMap,qm=new WeakMap,mc=new WeakMap,gc=new WeakMap,hd=new WeakMap,dd=new WeakMap,pd=new WeakMap,fd=new WeakMap,Zm=new WeakMap,Gm=new WeakMap;var md,_c,gd,_d,yd,Wm,Hm;class Kk{constructor(s,g){X(this,md);X(this,_c);X(this,gd);X(this,_d);X(this,yd,!0);X(this,Wm,Pe(()=>I(this,gd)._commandState.filtered.count===0&&I(this,yd)===!1||I(this,_d).current));X(this,Hm,Pe(()=>({id:I(this,_c).current,role:"presentation",[Uk]:""})));Ze(this,md,s.ref),Ze(this,_c,s.id),Ze(this,gd,g),Ze(this,_d,s.forceMount),Tt(()=>{Ze(this,yd,!1)}),lr({id:I(this,_c),ref:I(this,md),deps:()=>this.shouldRender})}get shouldRender(){return L(I(this,Wm))}get props(){return L(I(this,Hm))}}md=new WeakMap,_c=new WeakMap,gd=new WeakMap,_d=new WeakMap,yd=new WeakMap,Wm=new WeakMap,Hm=new WeakMap;var Va,ja,os,vd,Xm,xd,Km;class $k{constructor(s,g){X(this,Va);qe(this,"id");qe(this,"forceMount");X(this,ja);X(this,os);X(this,vd,Je(null));X(this,Xm,Pe(()=>this.forceMount.current||I(this,os).shouldFilter.current===!1||!I(this,os).commandState.search?!0:I(this,os).commandState.filtered.groups.has(this.id.current)));X(this,xd,Je(""));X(this,Km,Pe(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[nw]:""})));Ze(this,Va,s.ref),this.id=s.id,Ze(this,os,g),this.forceMount=s.forceMount,Ze(this,ja,s.value),this.trueValue=s.value.current,lr({id:this.id,ref:I(this,Va),deps:()=>this.shouldRender}),Tt(()=>I(this,os).registerGroup(this.id.current)),Tt(()=>{var v;if(I(this,ja).current)return this.trueValue=I(this,ja).current,I(this,os).registerValue(this.id.current,I(this,ja).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue);if((v=I(this,Va).current)!=null&&v.textContent)return this.trueValue=I(this,Va).current.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue)})}get headingNode(){return L(I(this,vd))}set headingNode(s){Be(I(this,vd),je(s))}get shouldRender(){return L(I(this,Xm))}get trueValue(){return L(I(this,xd))}set trueValue(s){Be(I(this,xd),je(s))}get props(){return L(I(this,Km))}createGroupHeading(s){return new uw(s,this)}createGroupItems(s){return new hw(s,this)}}Va=new WeakMap,ja=new WeakMap,os=new WeakMap,vd=new WeakMap,Xm=new WeakMap,xd=new WeakMap,Km=new WeakMap;var bd,yc,wd,$m;class uw{constructor(s,g){X(this,bd);X(this,yc);X(this,wd);X(this,$m,Pe(()=>({id:I(this,yc).current,[ow]:""})));Ze(this,bd,s.ref),Ze(this,yc,s.id),Ze(this,wd,g),lr({id:I(this,yc),ref:I(this,bd),onRefChange:v=>{I(this,wd).headingNode=v}})}get props(){return L(I(this,$m))}}bd=new WeakMap,yc=new WeakMap,wd=new WeakMap,$m=new WeakMap;var Sd,vc,Td,Jm;class hw{constructor(s,g){X(this,Sd);X(this,vc);X(this,Td);X(this,Jm,Pe(()=>{var s;return{id:I(this,vc).current,role:"group",[sw]:"","aria-labelledby":((s=I(this,Td).headingNode)==null?void 0:s.id)??void 0}}));Ze(this,Sd,s.ref),Ze(this,vc,s.id),Ze(this,Td,g),lr({id:I(this,vc),ref:I(this,Sd)})}get props(){return L(I(this,Jm))}}Sd=new WeakMap,vc=new WeakMap,Td=new WeakMap,Jm=new WeakMap;var xc,bc,ws,Qo,Pd,Ym,Qm;class Jk{constructor(s,g){X(this,xc);X(this,bc);X(this,ws);X(this,Qo);X(this,Pd);X(this,Ym,Pe(()=>{var g;const s=(g=I(this,ws).viewportNode)==null?void 0:g.querySelector(`${lw}[${La}="${encodeURIComponent(I(this,Qo).current)}"]`);if(s)return(s==null?void 0:s.getAttribute("id"))??void 0}));X(this,Qm,Pe(()=>{var s,g;return{id:I(this,bc).current,type:"text",[jk]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":Db(!0),"aria-controls":((s=I(this,ws).viewportNode)==null?void 0:s.id)??void 0,"aria-labelledby":((g=I(this,ws).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":L(I(this,Ym))}}));Ze(this,xc,s.ref),Ze(this,bc,s.id),Ze(this,ws,g),Ze(this,Qo,s.value),Ze(this,Pd,s.autofocus),lr({id:I(this,bc),ref:I(this,xc),onRefChange:v=>{I(this,ws).inputNode=v}}),Tt(()=>{const v=I(this,xc).current;Bi(()=>{v&&I(this,Pd).current&&Mp(10,()=>v.focus())})}),Tt(()=>{I(this,Qo).current,Bi(()=>{I(this,ws).commandState.search!==I(this,Qo).current&&I(this,ws).setState("search",I(this,Qo).current)})})}get props(){return L(I(this,Qm))}}xc=new WeakMap,bc=new WeakMap,ws=new WeakMap,Qo=new WeakMap,Pd=new WeakMap,Ym=new WeakMap,Qm=new WeakMap;var wc,Id,Ss,Cd,Sc,Ua,eg,Ad,tg,ig,rg,kd,ng,sg,og;class Yk{constructor(s,g){X(this,wc);qe(this,"id");qe(this,"root");X(this,Id);X(this,Ss);X(this,Cd);X(this,Sc);X(this,Ua,null);X(this,eg,Pe(()=>{var s;return I(this,Sc).current||((s=I(this,Ua))==null?void 0:s.forceMount.current)===!0}));X(this,Ad,Je(""));X(this,tg,Pe(()=>{if(L(I(this,eg))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const s=this.root.commandState.filtered.items.get(this.id.current);return s===void 0?!1:s>0}));X(this,ig,Pe(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));X(this,rg,()=>{var s;I(this,Ss).current||(I(this,kd).call(this),(s=I(this,Cd))==null||s.current())});X(this,kd,()=>{I(this,Ss).current||this.root.setValue(this.trueValue,!0)});X(this,ng,()=>{I(this,Ss).current||this.root.disablePointerSelection.current||I(this,kd).call(this)});X(this,sg,()=>{I(this,Ss).current||I(this,rg).call(this)});X(this,og,Pe(()=>({id:this.id.current,"aria-disabled":XI(I(this,Ss).current),"aria-selected":$I(this.isSelected),"data-disabled":KI(I(this,Ss).current),"data-selected":JI(this.isSelected),[aw]:"",role:"option",onpointermove:I(this,ng),onclick:I(this,sg)})));Ze(this,wc,s.ref),this.id=s.id,this.root=g,Ze(this,Id,s.value),Ze(this,Ss,s.disabled),Ze(this,Cd,s.onSelect),Ze(this,Sc,s.forceMount),Ze(this,Ua,Gg(null)),this.trueValue=s.value.current,lr({id:this.id,ref:I(this,wc),deps:()=>!!this.root.commandState.search}),Tt(()=>{var v;if(this.id.current,(v=I(this,Ua))==null||v.id.current,!I(this,Sc).current)return Bi(()=>{var T;return this.root.registerItem(this.id.current,(T=I(this,Ua))==null?void 0:T.id.current)})}),Tt(()=>{const v=I(this,Id).current,T=I(this,wc).current;T&&(!v&&T.textContent&&(this.trueValue=T.textContent.trim()),Bi(()=>{this.root.registerValue(this.id.current,this.trueValue,s.keywords.current.map(C=>C.trim())),T.setAttribute(La,this.trueValue)}))})}get trueValue(){return L(I(this,Ad))}set trueValue(s){Be(I(this,Ad),je(s))}get shouldRender(){return L(I(this,tg))}get isSelected(){return L(I(this,ig))}get props(){return L(I(this,og))}}wc=new WeakMap,Id=new WeakMap,Ss=new WeakMap,Cd=new WeakMap,Sc=new WeakMap,Ua=new WeakMap,eg=new WeakMap,Ad=new WeakMap,tg=new WeakMap,ig=new WeakMap,rg=new WeakMap,kd=new WeakMap,ng=new WeakMap,sg=new WeakMap,og=new WeakMap;var Tc,Ed,ag;class Qk{constructor(s,g){qe(this,"ref");X(this,Tc);X(this,Ed);qe(this,"root");X(this,ag,Pe(()=>({id:I(this,Tc).current,role:"listbox","aria-label":I(this,Ed).current,[Vk]:""})));this.ref=s.ref,Ze(this,Tc,s.id),this.root=g,Ze(this,Ed,s.ariaLabel),lr({id:I(this,Tc),ref:this.ref})}get props(){return L(I(this,ag))}}Tc=new WeakMap,Ed=new WeakMap,ag=new WeakMap;var Md,Pc,zd,Dd,lg;class eE{constructor(s,g){X(this,Md);X(this,Pc);X(this,zd);X(this,Dd);X(this,lg,Pe(()=>{var s;return{id:I(this,Pc).current,[qk]:"",for:(s=I(this,Dd))==null?void 0:s.current,style:zb}}));Ze(this,Md,s.ref),Ze(this,Pc,s.id),Ze(this,zd,g),Ze(this,Dd,s.for),lr({id:I(this,Pc),ref:I(this,Md),onRefChange:v=>{I(this,zd).labelNode=v}})}get props(){return L(I(this,lg))}}Md=new WeakMap,Pc=new WeakMap,zd=new WeakMap,Dd=new WeakMap,lg=new WeakMap;function tE(h){return Gk(new Xk(h))}function iE(h){const s=Vc();return new Kk(h,s)}function rE(h){const s=Vc();return new Yk(h,s)}function nE(h){const s=Vc();return Hk(new $k(h,s))}function sE(h){const s=Gg();return new uw(h,s)}function oE(h){const s=Gg();return new hw(h,s)}function aE(h){const s=Vc();return new Jk(h,s)}function lE(h){const s=Vc();return Wk(new Qk(h,s))}function cE(h){const s=Vc();return new eE(h,s)}var uE=Et("<label><!></label>");function hE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=cE({id:Te.with(()=>g()),ref:Te.with(()=>v(),K=>v(K))}),w=Pe(()=>$i(T,C.props));var c=uE();let j;var q=Zt(c);Bt(q,()=>s.children??ii),jt(c),Lt(()=>j=Mi(c,j,{...L(w)})),be(h,c),At()}var dE=Et("<!> <!>",1),pE=Et("<div><!> <!></div>");function fE(h,s){Ct(s,!0);const g=Le=>{hE(Le,{children:(We,tt)=>{ta();var Pt=en();Lt(()=>Gi(Pt,K())),be(We,Pt)},$$slots:{default:!0}})};let v=ee(s,"id",19,Sr),T=ee(s,"ref",15,null),C=ee(s,"value",15,""),w=ee(s,"onValueChange",3,rr),c=ee(s,"loop",3,!1),j=ee(s,"shouldFilter",3,!0),q=ee(s,"filter",3,cw),K=ee(s,"label",3,""),N=ee(s,"vimBindings",3,!0),V=ee(s,"disablePointerSelection",3,!1),se=ee(s,"controlledValue",3,!1),ie=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const le=tE({id:Te.with(()=>v()),ref:Te.with(()=>T(),Le=>T(Le)),filter:Te.with(()=>q()),shouldFilter:Te.with(()=>j()),loop:Te.with(()=>c()),value:Te.with(()=>C(),Le=>{se()||C(Le),w()(Le)}),vimBindings:Te.with(()=>N()),disablePointerSelection:Te.with(()=>V())}),fe=Pe(()=>$i(ie,le.props));var Se=rt(),ge=Ve(Se);{var Ee=Le=>{var We=dE(),tt=Ve(We);g(tt);var Pt=Qt(tt,2);Bt(Pt,()=>s.child,()=>({props:L(fe)})),be(Le,We)},Ne=Le=>{var We=pE();let tt;var Pt=Zt(We);g(Pt);var $e=Qt(Pt,2);Bt($e,()=>s.children??ii),jt(We),Lt(()=>tt=Mi(We,tt,{...L(fe)})),be(Le,We)};gi(ge,Le=>{s.child?Le(Ee):Le(Ne,!1)})}be(h,Se),At()}var mE=Et("<div><!></div>");function gE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"forceMount",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const w=iE({id:Te.with(()=>g()),ref:Te.with(()=>v(),N=>v(N)),forceMount:Te.with(()=>T())}),c=Pe(()=>$i(w.props,C));var j=rt(),q=Ve(j);{var K=N=>{var V=rt(),se=Ve(V);{var ie=fe=>{var Se=rt(),ge=Ve(Se);Bt(ge,()=>s.child,()=>({props:L(c)})),be(fe,Se)},le=fe=>{var Se=mE();let ge;var Ee=Zt(Se);Bt(Ee,()=>s.children??ii),jt(Se),Lt(()=>ge=Mi(Se,ge,{...L(c)})),be(fe,Se)};gi(se,fe=>{s.child?fe(ie):fe(le,!1)})}be(N,V)};gi(q,N=>{w.shouldRender&&N(K)})}be(h,j),At()}var _E=Et("<div><!></div>");function yE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"value",3,""),C=ee(s,"forceMount",3,!1),w=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const c=nE({id:Te.with(()=>g()),ref:Te.with(()=>v(),se=>v(se)),forceMount:Te.with(()=>C()),value:Te.with(()=>T())}),j=Pe(()=>$i(w,c.props));var q=rt(),K=Ve(q);{var N=se=>{var ie=rt(),le=Ve(ie);Bt(le,()=>s.child,()=>({props:L(j)})),be(se,ie)},V=se=>{var ie=_E();let le;var fe=Zt(ie);Bt(fe,()=>s.children??ii),jt(ie),Lt(()=>le=Mi(ie,le,{...L(j)})),be(se,ie)};gi(K,se=>{s.child?se(N):se(V,!1)})}be(h,q),At()}var vE=Et("<div><!></div>");function xE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=sE({id:Te.with(()=>g()),ref:Te.with(()=>v(),N=>v(N))}),w=Pe(()=>$i(T,C.props));var c=rt(),j=Ve(c);{var q=N=>{var V=rt(),se=Ve(V);Bt(se,()=>s.child,()=>({props:L(w)})),be(N,V)},K=N=>{var V=vE();let se;var ie=Zt(V);Bt(ie,()=>s.children??ii),jt(V),Lt(()=>se=Mi(V,se,{...L(w)})),be(N,V)};gi(j,N=>{s.child?N(q):N(K,!1)})}be(h,c),At()}var bE=Et("<div><!></div>"),wE=Et('<div style="display: contents;"><!></div>');function SE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=oE({id:Te.with(()=>g()),ref:Te.with(()=>v(),N=>v(N))}),w=Pe(()=>$i(T,C.props));var c=wE(),j=Zt(c);{var q=N=>{var V=rt(),se=Ve(V);Bt(se,()=>s.child,()=>({props:L(w)})),be(N,V)},K=N=>{var V=bE();let se;var ie=Zt(V);Bt(ie,()=>s.children??ii),jt(V),Lt(()=>se=Mi(V,se,{...L(w)})),be(N,V)};gi(j,N=>{s.child?N(q):N(K,!1)})}jt(c),be(h,c),At()}var TE=Et("<input>");function PE(h,s){Ct(s,!0);let g=ee(s,"value",15,""),v=ee(s,"autofocus",3,!1),T=ee(s,"id",19,Sr),C=ee(s,"ref",15,null),w=Kt(s,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const c=aE({id:Te.with(()=>T()),ref:Te.with(()=>C(),se=>C(se)),value:Te.with(()=>g(),se=>{g(se)}),autofocus:Te.with(()=>v()??!1)}),j=Pe(()=>$i(w,c.props));var q=rt(),K=Ve(q);{var N=se=>{var ie=rt(),le=Ve(ie);Bt(le,()=>s.child,()=>({props:L(j)})),be(se,ie)},V=se=>{var ie=TE();K2(ie);let le;Lt(()=>le=Mi(ie,le,{...L(j)})),tS(ie,g),be(se,ie)};gi(K,se=>{s.child?se(N):se(V,!1)})}be(h,q),At()}var IE=Et("<div><!></div>"),CE=Et('<div style="display: contents;" data-item-wrapper=""><!></div>');function AE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"value",3,""),C=ee(s,"disabled",3,!1),w=ee(s,"onSelect",3,rr),c=ee(s,"forceMount",3,!1),j=ee(s,"keywords",19,()=>[]),q=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=Gg(null),N=rE({id:Te.with(()=>g()),ref:Te.with(()=>v(),le=>v(le)),value:Te.with(()=>T()),disabled:Te.with(()=>C()),onSelect:Te.with(()=>w()),forceMount:Te.with(()=>c()),keywords:Te.with(()=>j()),group:K}),V=Pe(()=>$i(q,N.props));var se=rt(),ie=Ve(se);ob(ie,()=>N.root.key,le=>{var fe=CE(),Se=Zt(fe);{var ge=Ee=>{var Ne=rt(),Le=Ve(Ne);{var We=Pt=>{var $e=rt(),nt=Ve($e);Bt(nt,()=>s.child,()=>({props:L(V)})),be(Pt,$e)},tt=Pt=>{var $e=IE();let nt;var Re=Zt($e);Bt(Re,()=>s.children??ii),jt($e),Lt(()=>nt=Mi($e,nt,{...L(V)})),be(Pt,$e)};gi(Le,Pt=>{s.child?Pt(We):Pt(tt,!1)})}be(Ee,Ne)};gi(Se,Ee=>{N.shouldRender&&Ee(ge)})}jt(fe),Lt(()=>Yf(fe,"data-value",T())),be(le,fe)}),be(h,se),At()}var kE=Et("<div><!></div>");function EE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const C=lE({id:Te.with(()=>g()),ref:Te.with(()=>v(),N=>v(N)),ariaLabel:Te.with(()=>s["aria-label"]??"Suggestions...")}),w=Pe(()=>$i(T,C.props));var c=rt(),j=Ve(c);{var q=N=>{var V=rt(),se=Ve(V);Bt(se,()=>s.child,()=>({props:L(w)})),be(N,V)},K=N=>{var V=kE();let se;var ie=Zt(V);Bt(ie,()=>s.children??ii),jt(V),Lt(()=>se=Mi(V,se,{...L(w)})),be(N,V)};gi(j,N=>{s.child?N(q):N(K,!1)})}be(h,c),At()}var Ld,Rd,Od;class ME{constructor(s){qe(this,"open");X(this,Ld,Je(null));X(this,Rd,Je(void 0));X(this,Od,Je(null));qe(this,"toggleOpen",()=>{this.open.current=!this.open.current});qe(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=s.open}get contentNode(){return L(I(this,Ld))}set contentNode(s){Be(I(this,Ld),je(s))}get contentId(){return L(I(this,Rd))}set contentId(s){Be(I(this,Rd),je(s))}get triggerNode(){return L(I(this,Od))}set triggerNode(s){Be(I(this,Od),je(s))}}Ld=new WeakMap,Rd=new WeakMap,Od=new WeakMap;var Ic,Fd,ea,Nn,cg,ug,hg,dg,pg;class zE{constructor(s,g){X(this,Ic);X(this,Fd);X(this,ea);X(this,Nn);X(this,cg,s=>{if(!I(this,ea).current){if(s.pointerType==="touch"||s.button!==0)return s.preventDefault();I(this,Nn).toggleOpen()}});X(this,ug,s=>{I(this,ea).current||s.pointerType==="touch"&&(s.preventDefault(),I(this,Nn).toggleOpen())});X(this,hg,s=>{I(this,ea).current||(s.key===Lb||s.key===rC)&&(s.preventDefault(),I(this,Nn).toggleOpen())});X(this,dg,()=>{if(I(this,Nn).open.current&&I(this,Nn).contentId)return I(this,Nn).contentId});X(this,pg,Pe(()=>({id:I(this,Ic).current,"aria-haspopup":"dialog","aria-expanded":Db(I(this,Nn).open.current),"data-state":Yy(I(this,Nn).open.current),"aria-controls":I(this,dg).call(this),"data-popover-trigger":"",disabled:I(this,ea).current,onpointerdown:I(this,cg),onkeydown:I(this,hg),onpointerup:I(this,ug)})));Ze(this,Ic,s.id),Ze(this,Nn,g),Ze(this,Fd,s.ref),Ze(this,ea,s.disabled),lr({id:I(this,Ic),ref:I(this,Fd),onRefChange:v=>{I(this,Nn).triggerNode=v}})}get props(){return L(I(this,pg))}}Ic=new WeakMap,Fd=new WeakMap,ea=new WeakMap,Nn=new WeakMap,cg=new WeakMap,ug=new WeakMap,hg=new WeakMap,dg=new WeakMap,pg=new WeakMap;var Cc,Bd,fg,mg;class DE{constructor(s,g){X(this,Cc);X(this,Bd);qe(this,"root");X(this,fg,Pe(()=>({open:this.root.open.current})));X(this,mg,Pe(()=>({id:I(this,Cc).current,tabindex:-1,"data-state":Yy(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));Ze(this,Cc,s.id),this.root=g,Ze(this,Bd,s.ref),lr({id:I(this,Cc),ref:I(this,Bd),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,fg))}get props(){return L(I(this,mg))}}Cc=new WeakMap,Bd=new WeakMap,fg=new WeakMap,mg=new WeakMap;const[LE,dw]=Wa("Popover.Root");function RE(h){return LE(new ME(h))}function OE(h){return new zE(h,dw())}function FE(h){return new DE(h,dw())}var BE=Et("<div><!></div>"),NE=Et("<div><!></div>");function VE(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"id",19,Sr),T=ee(s,"forceMount",3,!1),C=ee(s,"onCloseAutoFocus",3,rr),w=ee(s,"onEscapeKeydown",3,rr),c=ee(s,"onInteractOutside",3,rr),j=ee(s,"trapFocus",3,!0),q=ee(s,"preventScroll",3,!1),K=Kt(s,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const N=FE({id:Te.with(()=>v()),ref:Te.with(()=>g(),Ne=>g(Ne))}),V=Pe(()=>$i(K,N.props));function se(Ne){c()(Ne),!Ne.defaultPrevented&&N.root.close()}function ie(Ne){w()(Ne),!Ne.defaultPrevented&&N.root.close()}function le(Ne){var Le;C()(Ne),!Ne.defaultPrevented&&(Ne.preventDefault(),(Le=N.root.triggerNode)==null||Le.focus())}var fe=rt(),Se=Ve(fe);{var ge=Ne=>{Ik(Ne,$t(()=>L(V),{get enabled(){return N.root.open.current},get id(){return v()},onInteractOutside:se,onEscapeKeydown:ie,onCloseAutoFocus:le,get trapFocus(){return j()},get preventScroll(){return q()},loop:!0,forceMount:!0,popper:(We,tt)=>{let Pt=()=>tt==null?void 0:tt().props;var $e=rt();const nt=Pe(()=>$i(Pt(),{style:V0("popover")}));var Re=Ve($e);{var Me=Ae=>{var Ge=rt(),Xe=Ve(Ge);Bt(Xe,()=>s.child,()=>({props:L(nt),...N.snippetProps})),be(Ae,Ge)},De=Ae=>{var Ge=BE();let Xe;var ft=Zt(Ge);Bt(ft,()=>s.children??ii),jt(Ge),Lt(()=>Xe=Mi(Ge,Xe,{...L(nt)})),be(Ae,Ge)};gi(Re,Ae=>{s.child?Ae(Me):Ae(De,!1)})}be(We,$e)},$$slots:{popper:!0}}))},Ee=Ne=>{var Le=rt(),We=Ve(Le);{var tt=Pt=>{Pk(Pt,$t(()=>L(V),{get present(){return N.root.open.current},get id(){return v()},onInteractOutside:se,onEscapeKeydown:ie,onCloseAutoFocus:le,get trapFocus(){return j()},get preventScroll(){return q()},loop:!0,forceMount:!1,popper:(nt,Re)=>{let Me=()=>Re==null?void 0:Re().props;var De=rt();const Ae=Pe(()=>$i(Me(),{style:V0("popover")}));var Ge=Ve(De);{var Xe=dt=>{var at=rt(),ut=Ve(at);Bt(ut,()=>s.child,()=>({props:L(Ae),...N.snippetProps})),be(dt,at)},ft=dt=>{var at=NE();let ut;var Mt=Zt(at);Bt(Mt,()=>s.children??ii),jt(at),Lt(()=>ut=Mi(at,ut,{...L(Ae)})),be(dt,at)};gi(Ge,dt=>{s.child?dt(Xe):dt(ft,!1)})}be(nt,De)},$$slots:{popper:!0}}))};gi(We,Pt=>{T()||Pt(tt)},!0)}be(Ne,Le)};gi(Se,Ne=>{T()?Ne(ge):Ne(Ee,!1)})}be(h,fe),At()}var jE=Et("<button><!></button>");function UE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"type",3,"button"),C=ee(s,"disabled",3,!1),w=Kt(s,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const c=OE({id:Te.with(()=>g()),ref:Te.with(()=>v(),V=>v(V)),disabled:Te.with(()=>!!C())}),j=Pe(()=>$i(w,c.props,{type:T()})),q=Ep(),[K,N]=q;vk(h,{get id(){return g()},children:(V,se)=>{var ie=rt(),le=Ve(ie);{var fe=ge=>{var Ee=rt(),Ne=Ve(Ee);Bt(Ne,()=>s.child,()=>({props:L(j)})),be(ge,Ee)},Se=ge=>{var Ee=jE();const Ne=Pe(()=>N({...L(j)},[{attribute_name:"formaction"}]));let Le;var We=Zt(Ee);Bt(We,()=>s.children??ii),jt(Ee),Lt(()=>Le=Mi(Ee,Le,{...L(Ne)})),be(ge,Ee)};gi(le,ge=>{s.child?ge(fe):ge(Se,!1)})}be(V,ie)},$$slots:{default:!0}}),At()}function qE(h,s){Ct(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,rr),T=ee(s,"controlledOpen",3,!1);EC({variant:Te.with(()=>"dialog"),open:Te.with(()=>g(),c=>{T()||g(c),v()(c)})});var C=rt(),w=Ve(C);Bt(w,()=>s.children??ii),be(h,C),At()}var ZE=Et("<!> <!>",1),GE=Et("<!> <div><!></div>",1);function WE(h,s){Ct(s,!0);let g=ee(s,"id",19,Sr),v=ee(s,"ref",15,null),T=ee(s,"forceMount",3,!1),C=ee(s,"onCloseAutoFocus",3,rr),w=ee(s,"onEscapeKeydown",3,rr),c=ee(s,"onInteractOutside",3,rr),j=ee(s,"trapFocus",3,!0),q=ee(s,"preventScroll",3,!0),K=ee(s,"restoreScrollDelay",3,null),N=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const V=zC({id:Te.with(()=>g()),ref:Te.with(()=>v(),le=>v(le))}),se=Pe(()=>$i(N,V.props));var ie=Pe(()=>V.root.open.current||T());ev(h,$t(()=>L(se),{get forceMount(){return T()},get present(){return L(ie)},presence:(fe,Se)=>{let ge=()=>Se==null?void 0:Se().present;var Ee=Pe(()=>hA({forceMount:T(),present:ge().current,trapFocus:j(),open:V.root.open.current}));Ub(fe,$t({loop:!0,get trapFocus(){return L(Ee)}},()=>L(se),{onCloseAutoFocus:Le=>{var We;C()(Le),!Le.defaultPrevented&&((We=V.root.triggerNode)==null||We.focus())},focusScope:(Le,We)=>{let tt=()=>We==null?void 0:We().props;Vb(Le,$t(()=>L(se),{get enabled(){return ge().current},onEscapeKeydown:Pt=>{w()(Pt),!Pt.defaultPrevented&&V.root.handleClose()},children:(Pt,$e)=>{Nb(Pt,$t(()=>L(se),{get enabled(){return ge().current},onInteractOutside:nt=>{c()(nt),!nt.defaultPrevented&&V.root.handleClose()},children:(nt,Re)=>{Zb(nt,$t(()=>L(se),{get enabled(){return ge().current},children:(Me,De)=>{var Ae=rt(),Ge=Ve(Ae);{var Xe=dt=>{var at=ZE(),ut=Ve(at);{var Mt=Jt=>{im(Jt,{get preventScroll(){return q()},get restoreScrollDelay(){return K()}})};gi(ut,Jt=>{V.root.open.current&&Jt(Mt)})}var zt=Qt(ut,2),ri=Ng(()=>({props:$i(L(se),tt()),...V.snippetProps}));Bt(zt,()=>s.child,()=>L(ri)),be(dt,at)},ft=dt=>{var at=GE(),ut=Ve(at);im(ut,{get preventScroll(){return q()}});var Mt=Qt(ut,2);const zt=Pe(()=>$i(L(se),tt()));let ri;var Jt=Zt(Mt);Bt(Jt,()=>s.children??ii),jt(Mt),Lt(()=>ri=Mi(Mt,ri,{...L(zt)})),be(dt,at)};gi(Ge,dt=>{s.child?dt(Xe):dt(ft,!1)})}be(Me,Ae)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),At()}function HE(h,s){Ct(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,rr),T=ee(s,"controlledOpen",3,!1);RE({open:Te.with(()=>g(),C=>{T()||g(C),v()(C)})}),yk(h,{children:(C,w)=>{var c=rt(),j=Ve(c);Bt(j,()=>s.children??ii),be(C,c)},$$slots:{default:!0}}),At()}function XE(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","value","class"]);var C=rt(),w=Ve(C),c=Pe(()=>Ui("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s.class));ci(w,()=>fE,(j,q)=>{q(j,$t({get class(){return L(c)},get value(){return v()},set value(K){v(K)},get ref(){return g()},set ref(K){g(K)}},()=>T))}),be(h,C),At()}function KE(h,s){Ct(s,!0),ee(s,"ref",11,null);let g=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var v=rt(),T=Ve(v),C=Pe(()=>Ui("py-6 text-center text-sm",s.class));ci(T,()=>gE,(w,c)=>{c(w,$t({get class(){return L(C)}},()=>g))}),be(h,v),At()}var $E=Et("<!> <!>",1);function JE(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("overflow-hidden p-1 text-foreground",s.class));ci(C,()=>yE,(c,j)=>{j(c,$t({get class(){return L(w)},get ref(){return g()},set ref(q){g(q)}},()=>v,{children:(q,K)=>{var N=$E(),V=Ve(N);{var se=le=>{var fe=rt(),Se=Ve(fe);ci(Se,()=>xE,(ge,Ee)=>{Ee(ge,{class:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:(Ne,Le)=>{ta();var We=en();Lt(()=>Gi(We,s.heading)),be(Ne,We)},$$slots:{default:!0}})}),be(le,fe)};gi(V,le=>{s.heading&&le(se)})}var ie=Qt(V,2);ci(ie,()=>SE,(le,fe)=>{fe(le,{get children(){return s.children}})}),be(q,N)},$$slots:{default:!0}}))}),be(h,T),At()}var YE=Et('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function QE(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","class","value"]);var C=YE(),w=Zt(C);zP(w,{class:"mr-2 size-4 shrink-0 opacity-50"});var c=Qt(w,2),j=Pe(()=>Ui("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s.class));ci(c,()=>PE,(q,K)=>{K(q,$t({get class(){return L(j)},get ref(){return g()},set ref(N){g(N)}},()=>T,{get value(){return v()},set value(N){v(N)}}))}),jt(C),be(h,C),At()}function eM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s.class));ci(C,()=>AE,(c,j)=>{j(c,$t({get class(){return L(w)},get ref(){return g()},set ref(q){g(q)}},()=>v))}),be(h,T),At()}function tM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("max-h-[300px] overflow-y-auto overflow-x-hidden",s.class));ci(C,()=>EE,(c,j)=>{j(c,$t({get class(){return L(w)}},()=>v,{get ref(){return g()},set ref(q){g(q)}}))}),be(h,T),At()}function wr(){}const iM=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),rM=typeof document<"u";function nM(h){return h instanceof HTMLInputElement&&!iM.has(h.type)||h instanceof HTMLTextAreaElement||h instanceof HTMLElement&&h.isContentEditable}function Ur(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}const er={DURATION:.5,EASE:[.32,.72,0,1]},pw=.4,sM=.25,oM=100,fw=8,Da=16,uv=26,Ty="vaul-dragging",mw=new WeakMap;function br(h,s,g=!1){if(!h||!(h instanceof HTMLElement))return;const v={};Object.entries(s).forEach(([T,C])=>{if(T.startsWith("--")){h.style.setProperty(T,C);return}v[T]=h.style[T],h.style[T]=C}),!g&&mw.set(h,v)}function aM(h,s){if(!h||!(h instanceof HTMLElement))return;const g=mw.get(h);g&&(h.style[s]=g[s])}function lM(){return hv(/^Mac/)}function hv(h){return typeof window<"u"&&window.navigator!=null?h.test(window.navigator.platform):void 0}function cM(){return hv(/^iPhone/)}function q0(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function uM(){return hv(/^iPad/)||lM()&&navigator.maxTouchPoints>1}function hM(){return cM()||uM()}function Z0(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}function Zf(h,s){if(!h)return null;const g=window.getComputedStyle(h),v=g.transform||g.webkitTransform||g.mozTransform;let T=v.match(/^matrix3d\((.+)\)$/);return T?Number.parseFloat(T[1].split(", ")[Z0(s)?13:12]):(T=v.match(/^matrix\((.+)\)$/),T?Number.parseFloat(T[1].split(", ")[Z0(s)?5:4]):null)}function Py(h,s){if(!h)return()=>{};const g=h.style.cssText;return Object.assign(h.style,s),()=>{h.style.cssText=g}}let ih=null;var Ts,qa,Za,Ac,Nd,gg,Vd,_g,yg;class dM{constructor(s){X(this,Ts);X(this,qa,Je(je(typeof window<"u"?window.location.href:"")));X(this,Za,Je(0));X(this,Ac,Pe(()=>I(this,Ts).open.current));X(this,Nd,Pe(()=>I(this,Ts).noBodyStyles.current));X(this,gg,Pe(()=>I(this,Ts).preventScrollRestoration.current));X(this,Vd,Pe(()=>I(this,Ts).modal.current));X(this,_g,Pe(()=>I(this,Ts).nested.current));X(this,yg,Pe(()=>I(this,Ts).hasBeenOpened));qe(this,"setPositionFixed",()=>{if(q0()&&ih===null&&L(I(this,Ac))&&!L(I(this,Nd))){ih={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:s,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-L(I(this,Za))}px`,left:`${-s}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const v=g-window.innerHeight;v&&L(I(this,Za))>=g&&(document.body.style.top=`${-(L(I(this,Za))+v)}px`)}),300)}});qe(this,"restorePositionSetting",()=>{if(q0()&&ih!==null&&!L(I(this,Nd))){const s=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,ih),window.requestAnimationFrame(()=>{if(L(I(this,gg))&&L(I(this,qa))!==window.location.href){Be(I(this,qa),je(window.location.href));return}window.scrollTo(g,s)}),ih=null}});Ze(this,Ts,s),Tt(()=>Bi(()=>{const g=()=>{Be(I(this,Za),je(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),Tt(()=>{if(L(I(this,qa)),!!L(I(this,Vd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),Tt(()=>{L(I(this,Ac));const g=L(I(this,Vd)),v=L(I(this,yg)),T=L(I(this,_g));L(I(this,qa)),Bi(()=>{T||!v||(L(I(this,Ac))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}Ts=new WeakMap,qa=new WeakMap,Za=new WeakMap,Ac=new WeakMap,Nd=new WeakMap,gg=new WeakMap,Vd=new WeakMap,_g=new WeakMap,yg=new WeakMap;function G0(h,s){return Ap(h,s)}function pM(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!nb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return Hy(h)}function fM(h,s){return`${h}Context`}function mM(h,s,g=!0){const v=fM(h),T=Symbol(v),C=v;function w(j){const q=pM(g?T:C,j);if(q===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return q}function c(j){return G0(g?T:C,j)}return[c,w]}var Qr,Vr,kc,jr,vg,xg,Ec,jd,Ud,qd,bg,wg,Sg,Tg,Pg,Zd;class gM{constructor(s){X(this,Qr);X(this,Vr,Pe(()=>I(this,Qr).direction.current));X(this,kc,Pe(()=>I(this,Qr).container.current));X(this,jr,Pe(()=>I(this,Qr).snapPoints.current??[]));X(this,vg,Pe(()=>I(this,Qr).activeSnapPoint.current));X(this,xg,Pe(()=>I(this,Qr).fadeFromIndex.current));X(this,Ec,Pe(()=>I(this,Qr).overlayNode));X(this,jd,Pe(()=>I(this,Qr).drawerNode));X(this,Ud,Pe(()=>I(this,Qr).snapToSequentialPoint.current));X(this,qd,Je(rM?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));X(this,bg,Pe(()=>{var s;return this.activeSnapPoint===((s=L(I(this,jr)))==null?void 0:s[L(I(this,jr)).length-1])||null}));X(this,wg,Pe(()=>{var s;return(s=L(I(this,jr)))==null?void 0:s.findIndex(g=>g===this.activeSnapPoint)}));X(this,Sg,Pe(()=>L(I(this,jr))&&L(I(this,jr)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&L(I(this,jr))[this.fadeFromIndex]===this.activeSnapPoint||!L(I(this,jr))));X(this,Tg,Pe(()=>{var v;this.windowDimensions,I(this,Qr).open.current;const s=L(I(this,kc))?{width:L(I(this,kc)).getBoundingClientRect().width,height:L(I(this,kc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((v=L(I(this,jr)))==null?void 0:v.map(T=>{const C=typeof T=="string";let w=0;if(C&&(w=Number.parseInt(T,10)),Ur(L(I(this,Vr)))){const j=C?w:this.windowDimensions?T*s.height:0;return this.windowDimensions?L(I(this,Vr))==="bottom"?s.height-j:-s.height+j:j}const c=C?w:this.windowDimensions?T*s.width:0;return this.windowDimensions?L(I(this,Vr))==="right"?s.width-c:-s.width+c:c}))??[]}));X(this,Pg,Pe(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));X(this,Zd,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});qe(this,"snapToPoint",s=>{var v;const g=this.snapPointsOffset.findIndex(T=>T===s)??null;I(this,Qr).onSnapPointChange(g),br(L(I(this,jd)),{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:Ur(L(I(this,Vr)))?`translate3d(0, ${s}px, 0)`:`translate3d(${s}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?br(L(I(this,Ec)),{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"0"}):br(L(I(this,Ec)),{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"1"}),I(this,Qr).setActiveSnapPoint((v=L(I(this,jr)))==null?void 0:v[Math.max(g,0)])});qe(this,"onRelease",s=>{var j;if(this.fadeFromIndex===void 0)return;const g=L(I(this,Vr))==="bottom"||L(I(this,Vr))==="right"?(this.activeSnapPointOffset??0)-s.draggedDistance:(this.activeSnapPointOffset??0)+s.draggedDistance,v=this.activeSnapPointIndex===this.fadeFromIndex-1,T=this.activeSnapPointIndex===0,C=s.draggedDistance>0;if(v&&br(L(I(this,Ec)),{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`}),!L(I(this,Ud))&&s.velocity>2&&!C){s.dismissible?s.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!L(I(this,Ud))&&s.velocity>2&&C&&this.snapPointsOffset&&L(I(this,jr))){this.snapToPoint(this.snapPointsOffset[L(I(this,jr)).length-1]);return}const w=(j=this.snapPointsOffset)==null?void 0:j.reduce((q,K)=>typeof q!="number"||typeof K!="number"?q:Math.abs(K-g)<Math.abs(q-g)?K:q),c=Ur(L(I(this,Vr)))?window.innerHeight:window.innerWidth;if(s.velocity>pw&&Math.abs(s.draggedDistance)<c*.4){const q=C?1:-1;if(q>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[L(I(this,jr)).length-1]);return}if(T&&q<0&&s.dismissible&&I(this,Qr).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+q]);return}this.snapToPoint(w)});qe(this,"onDrag",s=>{if(this.activeSnapPointOffset===null)return;const g=L(I(this,Vr))==="bottom"||L(I(this,Vr))==="right"?this.activeSnapPointOffset-s.draggedDistance:this.activeSnapPointOffset+s.draggedDistance;(L(I(this,Vr))==="bottom"||L(I(this,Vr))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(L(I(this,Vr))==="top"||L(I(this,Vr))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||br(L(I(this,jd)),{transform:Ur(L(I(this,Vr)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});qe(this,"getPercentageDragged",(s,g)=>{if(!L(I(this,jr)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const v=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(v&&!g)return 1;if(!this.shouldFade&&!v)return null;const C=v?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,w=v?this.snapPointsOffset[C]-this.snapPointsOffset[C-1]:this.snapPointsOffset[C+1]-this.snapPointsOffset[C],c=s/Math.abs(w);return v?1-c:c});Ze(this,Qr,s),Tt(()=>Bi(()=>(window.addEventListener("resize",I(this,Zd)),()=>window.removeEventListener("resize",I(this,Zd))))),Tt(()=>{const g=this.activeSnapPoint,v=L(I(this,jr)),T=this.snapPointsOffset;Bi(()=>{if(g){const C=(v==null?void 0:v.findIndex(w=>w===g))??-1;T&&C!==-1&&typeof T[C]=="number"&&this.snapToPoint(T[C])}})})}get activeSnapPoint(){return L(I(this,vg))}get fadeFromIndex(){return L(I(this,xg))}get windowDimensions(){return L(I(this,qd))}set windowDimensions(s){Be(I(this,qd),s)}get isLastSnapPoint(){return L(I(this,bg))}get activeSnapPointIndex(){return L(I(this,wg))}get shouldFade(){return L(I(this,Sg))}get snapPointsOffset(){return L(I(this,Tg))}get activeSnapPointOffset(){return L(I(this,Pg))}}Qr=new WeakMap,Vr=new WeakMap,kc=new WeakMap,jr=new WeakMap,vg=new WeakMap,xg=new WeakMap,Ec=new WeakMap,jd=new WeakMap,Ud=new WeakMap,qd=new WeakMap,bg=new WeakMap,wg=new WeakMap,Sg=new WeakMap,Tg=new WeakMap,Pg=new WeakMap,Zd=new WeakMap;function _M(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function yM(h){const s=Pe(()=>h.direction.current),g=Pe(()=>h.open.current),v=Pe(()=>h.shouldScaleBackground.current),T=Pe(()=>h.setBackgroundColorOnScale.current),C=Pe(()=>h.noBodyStyles.current);let w=Je(null),c=Je("");function j(){return(window.innerWidth-uv)/window.innerWidth}Tt(()=>{Bi(()=>{Be(c,je(document.body.style.backgroundColor))})}),Tt(()=>(L(g),L(v),L(T),Bi(()=>{if(L(g)&&L(v)){L(w)&&window.clearTimeout(L(w));const q=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!q)return;_M(L(T)&&!L(C)?Py(document.body,{background:"black"}):wr,Py(q,{transformOrigin:Ur(L(s))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${er.DURATION}s`,transitionTimingFunction:`cubic-bezier(${er.EASE.join(",")})`}));const K=Py(q,{borderRadius:`${fw}px`,overflow:"hidden",...Ur(L(s))?{transform:`scale(${j()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${j()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{K(),Be(w,je(window.setTimeout(()=>{L(c)?document.body.style.background=L(c):document.body.style.removeProperty("background")},er.DURATION*1e3)))}}})))}var Gd,Wd,Hd,Xd,Kd,$d,Jd,Yd,Qd,ep,tp,ip,rp,np,sp,op,ap,Ig;class vM{constructor(s){qe(this,"open");qe(this,"activeSnapPoint");qe(this,"closeThreshold");qe(this,"shouldScaleBackground");qe(this,"scrollLockTimeout");qe(this,"snapPoints");qe(this,"fadeFromIndex");qe(this,"fixed");qe(this,"dismissible");qe(this,"direction");qe(this,"onDragProp");qe(this,"onReleaseProp");qe(this,"nested");qe(this,"onCloseProp");qe(this,"backgroundColor");qe(this,"modal");qe(this,"handleOnly");qe(this,"noBodyStyles");qe(this,"preventScrollRestoration");qe(this,"setBackgroundColorOnScale");qe(this,"container");qe(this,"snapToSequentialPoint");qe(this,"repositionInputs");qe(this,"autoFocus");X(this,Gd,Je(!1));X(this,Wd,Je(!1));X(this,Hd,Je(!1));X(this,Xd,Je(null));X(this,Kd,Je(null));X(this,$d,Je(null));X(this,Jd,Je(null));X(this,Yd,Je(null));X(this,Qd,Je(!1));X(this,ep,Je(null));X(this,tp,Je(0));X(this,ip,Je(!1));X(this,rp,Je(0));X(this,np,Je(null));X(this,sp,Je(0));X(this,op,Je(0));X(this,ap,Je(0));qe(this,"snapPointsState");X(this,Ig,Pe(()=>this.snapPointsState.snapPointsOffset));qe(this,"positionFixedState");qe(this,"setActiveSnapPoint",s=>{this.activeSnapPoint.current=s});qe(this,"onSnapPointChange",s=>{this.snapPoints.current&&s===this.snapPointsOffset.length-1&&(this.openTime=new Date)});qe(this,"onPress",s=>{var v;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(s.target))return;const g=(v=this.drawerNode)==null?void 0:v.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,hM()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),s.target.setPointerCapture(s.pointerId),this.pointerStart=Ur(this.direction.current)?s.pageY:s.pageX});qe(this,"shouldDrag",(s,g)=>{var c;if(s===null)return!1;let v=s;const T=(c=window.getSelection())==null?void 0:c.toString(),C=this.drawerNode?Zf(this.drawerNode,this.direction.current):null,w=new Date;if(v.hasAttribute("data-vaul-no-drag")||v.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&w.getTime()-this.openTime.getTime()<500)return!1;if(C!==null&&(this.direction.current==="bottom"?C>0:C<0))return!0;if(T&&T.length>0)return!1;if(this.lastTimeDragPrevented!==null&&w.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&C===0)return this.lastTimeDragPrevented=w,!1;if(g)return this.lastTimeDragPrevented=w,!1;for(;v;){if(v.scrollHeight>v.clientHeight){if(v.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(v.getAttribute("role")==="dialog")return!0}v=v.parentNode}return!0});qe(this,"onDrag",s=>{var V,se;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,v=(this.pointerStart-(Ur(this.direction.current)?s.pageY:s.pageX))*g,T=v>0,C=this.snapPoints.current&&!this.dismissible.current&&!T;if(C&&this.snapPointsState.activeSnapPointIndex===0)return;const w=Math.abs(v),c=document.querySelector("[data-vaul-drawer-wrapper]"),j=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let q=w/j;const K=this.snapPointsState.getPercentageDragged(w,T);if(K!==null&&(q=K),C&&q>=1||!this.isAllowedToDrag&&!this.shouldDrag(s.target,T))return;if(this.drawerNode.classList.add(Ty),this.isAllowedToDrag=!0,br(this.drawerNode,{transition:"none"}),br(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:v}),T&&!this.snapPoints.current){const ie=AM(v),le=Math.min(ie*-1,0)*g;br(this.drawerNode,{transform:Ur(this.direction.current)?`translate3d(0, ${le}px, 0)`:`translate3d(${le}px, 0, 0)`});return}const N=1-q;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((se=(V=this.onDragProp).current)==null||se.call(V,s,q),br(this.overlayNode,{opacity:`${N}`,transition:"none"},!0)),c&&this.overlayNode&&this.shouldScaleBackground.current){const ie=Math.min(Gf()+q*(1-Gf()),1),le=8-q*8,fe=Math.max(0,14-q*14);br(c,{borderRadius:`${le}px`,transform:Ur(this.direction.current)?`scale(${ie}) translate3d(0, ${fe}px, 0)`:`scale(${ie}) translate3d(${fe}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const ie=w*g;br(this.drawerNode,{transform:Ur(this.direction.current)?`translate3d(0, ${ie}px, 0)`:`translate3d(${ie}px, 0, 0)`})}});qe(this,"closeDrawer",s=>{var g,v;this.cancelDrag(),(v=(g=this.onCloseProp).current)==null||v.call(g),s||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},er.DURATION*1e3)});qe(this,"resetDrawer",()=>{if(!this.drawerNode)return;const s=document.querySelector("[data-vaul-drawer-wrapper]"),g=Zf(this.drawerNode,this.direction.current);br(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`}),br(this.overlayNode,{transition:`opacity ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&br(s,{borderRadius:`${fw}px`,overflow:"hidden",...Ur(this.direction.current)?{transform:`scale(${Gf()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Gf()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${er.DURATION}s`,transitionTimingFunction:`cubic-bezier(${er.EASE.join(",")})`},!0)});qe(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(Ty),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});qe(this,"onRelease",s=>{var q,K,N,V,se,ie,le,fe,Se,ge;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(Ty),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=Zf(this.drawerNode,this.direction.current);if(!this.shouldDrag(s.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const v=this.dragEndTime.getTime()-this.dragStartTime.getTime(),T=this.pointerStart-(Ur(this.direction.current)?s.pageY:s.pageX),C=Math.abs(T)/v;if(C>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const Ee=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:T*Ee,closeDrawer:this.closeDrawer,velocity:C,dismissible:this.dismissible.current}),(K=(q=this.onReleaseProp).current)==null||K.call(q,s,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?T>0:T<0){this.resetDrawer(),(V=(N=this.onReleaseProp).current)==null||V.call(N,s,!0);return}if(C>pw){this.closeDrawer(),(ie=(se=this.onReleaseProp).current)==null||ie.call(se,s,!1);return}const w=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),c=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),j=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(j?c:w)*this.closeThreshold.current){this.closeDrawer(),(fe=(le=this.onReleaseProp).current)==null||fe.call(le,s,!1);return}(ge=(Se=this.onReleaseProp).current)==null||ge.call(Se,s,!0),this.resetDrawer()});qe(this,"onNestedOpenChange",s=>{const g=s?(window.innerWidth-Da)/window.innerWidth:1,v=s?-Da:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),br(this.drawerNode,{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${v}px, 0)`}),!s&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const T=Zf(this.drawerNode,this.direction.current);br(this.drawerNode,{transition:"none",transform:Ur(this.direction.current)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))});qe(this,"onNestedDrag",(s,g)=>{if(g<0)return;const v=(window.innerWidth-Da)/window.innerWidth,T=v+g*(1-v),C=-Da+g*Da;br(this.drawerNode,{transform:Ur(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`,transition:"none"})});qe(this,"onNestedRelease",(s,g)=>{const v=Ur(this.direction.current)?window.innerHeight:window.innerWidth,T=g?(v-Da)/v:1,C=g?-Da:0;g&&br(this.drawerNode,{transition:`transform ${er.DURATION}s cubic-bezier(${er.EASE.join(",")})`,transform:Ur(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`})});qe(this,"onDialogOpenChange",s=>{!this.dismissible.current&&!this.open.current||(s?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=s)});this.open=s.open,this.activeSnapPoint=s.activeSnapPoint,this.closeThreshold=s.closeThreshold,this.shouldScaleBackground=s.shouldScaleBackground,this.scrollLockTimeout=s.scrollLockTimeout,this.snapPoints=s.snapPoints,this.fadeFromIndex=s.fadeFromIndex,this.fixed=s.fixed,this.dismissible=s.dismissible,this.direction=s.direction,this.onDragProp=s.onDrag,this.onReleaseProp=s.onRelease,this.nested=s.nested,this.onCloseProp=s.onClose,this.backgroundColor=s.backgroundColor,this.modal=s.modal,this.handleOnly=s.handleOnly,this.noBodyStyles=s.noBodyStyles,this.preventScrollRestoration=s.preventScrollRestoration,this.setBackgroundColorOnScale=s.setBackgroundColorOnScale,this.container=s.container,this.snapToSequentialPoint=s.snapToSequentialPoint,this.repositionInputs=s.repositionInputs,this.autoFocus=s.autoFocus,this.snapPointsState=new gM(this),this.positionFixedState=new dM(this),Tt(()=>{const g=this.snapPointsState.activeSnapPointIndex,v=this.snapPoints.current,T=this.snapPointsState.snapPointsOffset;return this.drawerNode,Bi(()=>{var w;const C=()=>{var j;if(!this.drawerNode||!this.repositionInputs.current)return;const c=document.activeElement;if(nM(c)||this.keyboardIsOpen){const q=((j=window.visualViewport)==null?void 0:j.height)||0,K=window.innerHeight;let N=K-q;const V=this.drawerNode.getBoundingClientRect().height||0,se=V>K*.8;this.initialDrawerHeight||(this.initialDrawerHeight=V);const ie=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-N)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),v&&v.length>0&&T&&g){const le=T[g]||0;N+=le}if(this.previousDiffFromInitial=N,V>q||this.keyboardIsOpen){const le=this.drawerNode.getBoundingClientRect().height;let fe=le;le>q&&(fe=q-(se?ie:uv)),this.fixed.current?this.drawerNode.style.height=`${le-Math.max(N,0)}px`:this.drawerNode.style.height=`${Math.max(fe,q-ie)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;v&&v.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(N,0)}px`}};return(w=window.visualViewport)==null||w.addEventListener("resize",C),()=>{var c;return(c=window.visualViewport)==null?void 0:c.removeEventListener("resize",C)}})}),Tt(()=>{const g=this.open.current;return Bi(()=>(g&&(br(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{aM(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return L(I(this,Gd))}set hasBeenOpened(s){Be(I(this,Gd),je(s))}get isDragging(){return L(I(this,Wd))}set isDragging(s){Be(I(this,Wd),je(s))}get justReleased(){return L(I(this,Hd))}set justReleased(s){Be(I(this,Hd),je(s))}get overlayNode(){return L(I(this,Xd))}set overlayNode(s){Be(I(this,Xd),je(s))}get openTime(){return L(I(this,Kd))}set openTime(s){Be(I(this,Kd),je(s))}get dragStartTime(){return L(I(this,$d))}set dragStartTime(s){Be(I(this,$d),je(s))}get dragEndTime(){return L(I(this,Jd))}set dragEndTime(s){Be(I(this,Jd),je(s))}get lastTimeDragPrevented(){return L(I(this,Yd))}set lastTimeDragPrevented(s){Be(I(this,Yd),je(s))}get isAllowedToDrag(){return L(I(this,Qd))}set isAllowedToDrag(s){Be(I(this,Qd),je(s))}get nestedOpenChangeTimer(){return L(I(this,ep))}set nestedOpenChangeTimer(s){Be(I(this,ep),je(s))}get pointerStart(){return L(I(this,tp))}set pointerStart(s){Be(I(this,tp),je(s))}get keyboardIsOpen(){return L(I(this,ip))}set keyboardIsOpen(s){Be(I(this,ip),je(s))}get previousDiffFromInitial(){return L(I(this,rp))}set previousDiffFromInitial(s){Be(I(this,rp),je(s))}get drawerNode(){return L(I(this,np))}set drawerNode(s){Be(I(this,np),je(s))}get drawerHeight(){return L(I(this,sp))}set drawerHeight(s){Be(I(this,sp),je(s))}get drawerWidth(){return L(I(this,op))}set drawerWidth(s){Be(I(this,op),je(s))}get initialDrawerHeight(){return L(I(this,ap))}set initialDrawerHeight(s){Be(I(this,ap),je(s))}get snapPointsOffset(){return L(I(this,Ig))}}Gd=new WeakMap,Wd=new WeakMap,Hd=new WeakMap,Xd=new WeakMap,Kd=new WeakMap,$d=new WeakMap,Jd=new WeakMap,Yd=new WeakMap,Qd=new WeakMap,ep=new WeakMap,tp=new WeakMap,ip=new WeakMap,rp=new WeakMap,np=new WeakMap,sp=new WeakMap,op=new WeakMap,ap=new WeakMap,Ig=new WeakMap;var Yn,Mc,lp,cp,Cg,Ag,kg;class xM{constructor(s,g){X(this,Yn);X(this,Mc);X(this,lp);X(this,cp,Je(!1));X(this,Cg,Pe(()=>I(this,Yn).snapPoints.current&&I(this,Yn).snapPoints.current.length>0));X(this,Ag,s=>{I(this,Yn).onRelease(s)});X(this,kg,Pe(()=>({id:I(this,Mc).current,"data-vaul-overlay":"","data-vaul-snap-points":I(this,Yn).open.current&&L(I(this,Cg))?"true":"false","data-vaul-snap-points-overlay":I(this,Yn).open.current&&I(this,Yn).snapPointsState.shouldFade?"true":"false",onmouseup:I(this,Ag)})));Ze(this,Yn,g),Ze(this,Mc,s.id),Ze(this,lp,s.ref),gw({id:I(this,Mc),ref:I(this,lp),onRefChange:v=>{this.mounted?I(this,Yn).overlayNode=v:I(this,Yn).overlayNode=null},deps:()=>this.mounted})}get mounted(){return L(I(this,cp))}set mounted(s){Be(I(this,cp),je(s))}get props(){return L(I(this,kg))}}Yn=new WeakMap,Mc=new WeakMap,lp=new WeakMap,cp=new WeakMap,Cg=new WeakMap,Ag=new WeakMap,kg=new WeakMap;var Zi,zc,up,hp,dp,pp,fp,mp,gp,_p,yp,vp,xp,bp,Eg,wp,Mg,zg,Dg,Lg,Rg,Og,Fg;class bM{constructor(s,g){X(this,Zi);X(this,zc);X(this,up);X(this,hp);X(this,dp);X(this,pp);X(this,fp);X(this,mp);X(this,gp);X(this,_p);X(this,yp,Je(!1));X(this,vp,Je(null));X(this,xp,Je(null));X(this,bp,Je(!1));X(this,Eg,Pe(()=>I(this,Zi).snapPoints.current&&I(this,Zi).snapPoints.current.length>0));X(this,wp,Je(!1));qe(this,"isDeltaInDirection",(s,g,v=0)=>{if(this.wasBeyondThePoint)return!0;const T=Math.abs(s.y),C=Math.abs(s.x),w=C>T,c=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(s.x*c<0)&&C>=0&&C<=v)return w}else if(!(s.y*c<0)&&T>=0&&T<=v)return!w;return this.wasBeyondThePoint=!0,!0});qe(this,"handleOnPointerUp",s=>{this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,Zi).onRelease(s)});qe(this,"onOpenAutoFocus",s=>{I(this,_p).current(s)});qe(this,"onInteractOutside",s=>{if(I(this,hp).current(s),!I(this,Zi).modal.current||s.defaultPrevented){s.preventDefault();return}I(this,Zi).keyboardIsOpen&&(I(this,Zi).keyboardIsOpen=!1)});qe(this,"onFocusOutside",s=>{I(this,Zi).modal.current||s.preventDefault()});X(this,Mg,s=>{if(this.lastKnownPointerEvent=s,I(this,Zi).handleOnly.current||(I(this,pp).current(s),!this.pointerStart))return;const g=s.pageY-this.pointerStart.y,v=s.pageX-this.pointerStart.x,T=s.pointerType==="touch"?10:2,C={x:v,y:g};this.isDeltaInDirection(C,I(this,Zi).direction.current,T)?I(this,Zi).onDrag(s):(Math.abs(v)>T||Math.abs(g)>T)&&(this.pointerStart=null)});X(this,zg,s=>{I(this,fp).current(s),this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,Zi).onRelease(s)});X(this,Dg,s=>{I(this,mp).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,Lg,s=>{I(this,gp).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});X(this,Rg,s=>{I(this,Zi).handleOnly.current||(I(this,dp).current(s),this.pointerStart={x:s.pageX,y:s.pageY},I(this,Zi).onPress(s))});X(this,Og,Pe(()=>ab(I(this,Zi).snapPointsState.snapPointsOffset)));X(this,Fg,Pe(()=>({id:I(this,zc).current,"data-vaul-drawer-direction":I(this,Zi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":I(this,Zi).container.current?"true":"false","data-vaul-snap-points":I(this,Zi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:I(this,Rg),onpointermove:I(this,Mg),onpointerup:I(this,zg),onpointerout:I(this,Dg),oncontextmenu:I(this,Lg)})));Ze(this,Zi,g),Ze(this,zc,s.id),Ze(this,up,s.ref),Ze(this,hp,s.onInteractOutside),Ze(this,dp,s.onPointerDown),Ze(this,pp,s.onPointerMove),Ze(this,fp,s.onPointerUp),Ze(this,mp,s.onPointerOut),Ze(this,gp,s.onContextMenu),Ze(this,_p,s.onOpenAutoFocus),gw({id:I(this,zc),ref:I(this,up),onRefChange:v=>{this.mounted?I(this,Zi).drawerNode=v:I(this,Zi).drawerNode=null},deps:()=>this.mounted&&I(this,Zi).open.current}),yM(I(this,Zi)),Tt(()=>{this.hasSnapPoints&&I(this,Zi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return L(I(this,yp))}set delayedSnapPoints(s){Be(I(this,yp),je(s))}get pointerStart(){return L(I(this,vp))}set pointerStart(s){Be(I(this,vp),je(s))}get lastKnownPointerEvent(){return L(I(this,xp))}set lastKnownPointerEvent(s){Be(I(this,xp),je(s))}get wasBeyondThePoint(){return L(I(this,bp))}set wasBeyondThePoint(s){Be(I(this,bp),je(s))}get hasSnapPoints(){return L(I(this,Eg))}get mounted(){return L(I(this,wp))}set mounted(s){Be(I(this,wp),je(s))}get snapPointsOffset(){return L(I(this,Og))}get props(){return L(I(this,Fg))}}Zi=new WeakMap,zc=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,mp=new WeakMap,gp=new WeakMap,_p=new WeakMap,yp=new WeakMap,vp=new WeakMap,xp=new WeakMap,bp=new WeakMap,Eg=new WeakMap,wp=new WeakMap,Mg=new WeakMap,zg=new WeakMap,Dg=new WeakMap,Lg=new WeakMap,Rg=new WeakMap,Og=new WeakMap,Fg=new WeakMap;var Dc,Bg;class wM{constructor(s){X(this,Dc);X(this,Bg,Pe(()=>({to:I(this,Dc).container.current?I(this,Dc).container.current:void 0})));Ze(this,Dc,s)}get props(){return L(I(this,Bg))}}Dc=new WeakMap,Bg=new WeakMap;const[SM,dv]=mM("Drawer.Root");function TM(h){return SM(new vM(h))}function PM(h){const s=dv();return new bM(h,s)}function IM(h){const s=dv();return new xM(h,s)}function CM(){const h=dv();return new wM(h)}function Gf(){return(window.innerWidth-uv)/window.innerWidth}function AM(h){return 8*(Math.log(h+1)-2)}function gw({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{}}){const T=Pe(()=>g());Tt(()=>(h.current,L(T),Bi(()=>{const C=document.getElementById(h.current);return s.current=C,v(s.current),()=>{v(null)}}))),Tt(()=>()=>{s.current=null,v(null)})}function kM(h,s){Ct(s,!0);let g=ee(s,"open",15,!1),v=ee(s,"onOpenChange",3,wr),T=ee(s,"closeThreshold",3,sM),C=ee(s,"scrollLockTimeout",3,oM),w=ee(s,"fadeFromIndex",19,()=>s.snapPoints&&s.snapPoints.length-1),c=ee(s,"backgroundColor",3,"black"),j=ee(s,"nested",3,!1),q=ee(s,"shouldScaleBackground",3,!1),K=ee(s,"activeSnapPoint",15,null),N=ee(s,"onActiveSnapPointChange",3,wr),V=ee(s,"onRelease",3,wr),se=ee(s,"onDrag",3,wr),ie=ee(s,"onClose",3,wr),le=ee(s,"dismissible",3,!0),fe=ee(s,"direction",3,"bottom"),Se=ee(s,"fixed",3,!1),ge=ee(s,"handleOnly",3,!1),Ee=ee(s,"noBodyStyles",3,!1),Ne=ee(s,"preventScrollRestoration",3,!0),Le=ee(s,"setBackgroundColorOnScale",3,!0),We=ee(s,"onAnimationEnd",3,wr),tt=ee(s,"controlledOpen",3,!1),Pt=ee(s,"repositionInputs",3,!0),$e=ee(s,"autoFocus",3,!1),nt=ee(s,"snapToSequentialPoint",3,!1),Re=ee(s,"container",3,null),Me=ee(s,"controlledActiveSnapPoint",3,!1),De=ee(s,"modal",3,!0),Ae=Kt(s,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const Ge=TM({open:Te.with(()=>g(),ut=>{tt()?ft(g()):(g(ut),ft(ut))}),closeThreshold:Te.with(()=>T()),scrollLockTimeout:Te.with(()=>C()),snapPoints:Te.with(()=>s.snapPoints),fadeFromIndex:Te.with(()=>w()),backgroundColor:Te.with(()=>c()),nested:Te.with(()=>j()),shouldScaleBackground:Te.with(()=>q()),activeSnapPoint:Te.with(()=>K(),ut=>{Me()||K(ut),N()(ut)}),onRelease:Te.with(()=>V()),onDrag:Te.with(()=>se()),onClose:Te.with(()=>ie()),dismissible:Te.with(()=>le()),direction:Te.with(()=>fe()),fixed:Te.with(()=>Se()),modal:Te.with(()=>De()),handleOnly:Te.with(()=>ge()),noBodyStyles:Te.with(()=>Ee()),preventScrollRestoration:Te.with(()=>Ne()),setBackgroundColorOnScale:Te.with(()=>Le()),repositionInputs:Te.with(()=>Pt()),autoFocus:Te.with(()=>$e()),snapToSequentialPoint:Te.with(()=>nt()),container:Te.with(()=>Re())});let Xe;function ft(ut){var Mt;(Mt=v())==null||Mt(ut),ut&&!j()?Xe=document.body.style.cssText:!ut&&!j()&&Mp(er.DURATION*1e3,()=>{document.body.style.cssText=Xe}),!ut&&!j()&&Ge.positionFixedState.restorePositionSetting(),setTimeout(()=>{var zt;(zt=We())==null||zt(ut)},er.DURATION*1e3),ut&&!De()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),ut||(document.body.style.pointerEvents="auto")}Tt(()=>()=>{j()||(document.body.style.cssText=Xe)});var dt=rt(),at=Ve(dt);ci(at,()=>qE,(ut,Mt)=>{Mt(ut,$t({controlledOpen:!0,get open(){return Ge.open.current},onOpenChange:zt=>{Ge.onDialogOpenChange(zt),ft(zt)}},()=>Ae))}),be(h,dt),At()}function _w(h,s){Ct(s,!0),sb(()=>(s.onMounted(!0),()=>{s.onMounted(!1)})),At()}class EM{constructor(s=0){qe(this,"value",0);this.value=s}}const MM=new EM(0);function yw(){return`vaul-${MM.value++}`}var zM=Et("<!> <!>",1);function DM(h,s){Ct(s,!0);let g=ee(s,"id",19,yw),v=ee(s,"ref",15,null),T=ee(s,"onOpenAutoFocus",3,wr),C=ee(s,"onInteractOutside",3,wr),w=ee(s,"oncontextmenu",3,wr),c=ee(s,"onpointerdown",3,wr),j=ee(s,"onpointerup",3,wr),q=ee(s,"onpointerout",3,wr),K=ee(s,"onpointermove",3,wr),N=ee(s,"preventScroll",3,!0),V=Kt(s,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const se=PM({id:Te.with(()=>g()),ref:Te.with(()=>v(),Se=>v(Se)),onContextMenu:Te.with(()=>w()??wr),onInteractOutside:Te.with(()=>C()),onPointerDown:Te.with(()=>c()??wr),onPointerMove:Te.with(()=>K()??wr),onPointerOut:Te.with(()=>q()??wr),onPointerUp:Te.with(()=>j()??wr),onOpenAutoFocus:Te.with(()=>T())}),ie=Pe(()=>$i(V,se.props));var le=rt(),fe=Ve(le);ci(fe,()=>WE,(Se,ge)=>{ge(Se,$t(()=>L(ie),{get preventScroll(){return N()},get onInteractOutside(){return se.onInteractOutside},get onFocusOutside(){return se.onFocusOutside},get onOpenAutoFocus(){return se.onOpenAutoFocus},children:(Ee,Ne)=>{var Le=zM(),We=Ve(Le);Bt(We,()=>s.children??ii);var tt=Qt(We,2);_w(tt,{onMounted:Pt=>se.mounted=Pt}),be(Ee,Le)},$$slots:{default:!0}}))}),be(h,le),At()}var LM=Et("<!> <!>",1);function RM(h,s){Ct(s,!0);let g=ee(s,"id",19,yw),v=ee(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=IM({id:Te.with(()=>g()),ref:Te.with(()=>v(),q=>v(q))}),w=Pe(()=>$i(T,C.props));var c=rt(),j=Ve(c);ci(j,()=>pA,(q,K)=>{K(q,$t({get ref(){return v()},set ref(N){v(N)}},()=>L(w),{children:(N,V)=>{var se=LM(),ie=Ve(se);_w(ie,{onMounted:fe=>{C.mounted=fe}});var le=Qt(ie,2);Bt(le,()=>s.children??ii),be(N,se)},$$slots:{default:!0}}))}),be(h,c),At()}function OM(h,s){Ct(s,!0);const g=CM();let v=ee(s,"to",19,()=>g.props.to),T=Kt(s,["$$slots","$$events","$$legacy","to"]);var C=rt(),w=Ve(C);ci(w,()=>Rb,(c,j)=>{j(c,$t({get to(){return v()}},()=>T))}),be(h,C),At()}const FM=OC,BM=mA;function NM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("fixed inset-0 z-50 bg-black/80",s.class));ci(C,()=>RM,(c,j)=>{j(c,$t({get ref(){return g()},set ref(q){g(q)},get class(){return L(w)}},()=>v))}),be(h,T),At()}var VM=Et('<div class="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"></div> <!>',1),jM=Et("<!> <!>",1);function UM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=rt(),C=Ve(T);ci(C,()=>OM,(w,c)=>{c(w,$t(()=>s.portalProps,{children:(j,q)=>{var K=jM(),N=Ve(K);NM(N,{});var V=Qt(N,2),se=Pe(()=>Ui("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",s.class));ci(V,()=>DM,(ie,le)=>{le(ie,$t({get ref(){return g()},set ref(fe){g(fe)},get class(){return L(se)}},()=>v,{children:(fe,Se)=>{var ge=VM(),Ee=Qt(Ve(ge),2);Bt(Ee,()=>s.children??ii),be(fe,ge)},$$slots:{default:!0}}))}),be(j,K)},$$slots:{default:!0}}))}),be(h,T),At()}function qM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("text-sm text-muted-foreground",s.class));ci(C,()=>BM,(c,j)=>{j(c,$t({get ref(){return g()},set ref(q){g(q)},get class(){return L(w)}},()=>v))}),be(h,T),At()}var ZM=Et("<div><!></div>");function GM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=ZM();let C;var w=Zt(T);Bt(w,()=>s.children??ii),jt(T),Cs(T,c=>g(c),()=>g()),Lt(()=>C=Mi(T,C,{class:Ui("grid gap-1.5 p-4 text-center sm:text-left",s.class),...v})),be(h,T),At()}function WM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=rt(),C=Ve(T),w=Pe(()=>Ui("text-lg font-semibold leading-none tracking-tight",s.class));ci(C,()=>FM,(c,j)=>{j(c,$t({get ref(){return g()},set ref(q){g(q)},get class(){return L(w)}},()=>v))}),be(h,T),At()}function HM(h,s){let g=ee(s,"shouldScaleBackground",3,!0),v=ee(s,"open",15,!1),T=ee(s,"activeSnapPoint",15,null),C=Kt(s,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var w=rt(),c=Ve(w);ci(c,()=>kM,(j,q)=>{q(j,$t({get shouldScaleBackground(){return g()},get open(){return v()},set open(K){v(K)},get activeSnapPoint(){return T()},set activeSnapPoint(K){T(K)}},()=>C))}),be(h,w)}function XM(h,s){Ct(s,!0);let g=ee(s,"ref",15,null),v=ee(s,"sideOffset",3,4),T=ee(s,"align",3,"center"),C=Kt(s,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var w=rt(),c=Ve(w);ci(c,()=>Rb,(j,q)=>{q(j,$t(()=>s.portalProps,{children:(K,N)=>{var V=rt(),se=Ve(V),ie=Pe(()=>Ui("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s.class));ci(se,()=>VE,(le,fe)=>{fe(le,$t({get ref(){return g()},set ref(Se){g(Se)},get sideOffset(){return v()},get align(){return T()},get class(){return L(ie)}},()=>C))}),be(K,V)},$$slots:{default:!0}}))}),be(h,w),At()}const KM=HE,$M=UE,JM=[{value:"architecture-fine-arts-library",label:"Architecture/Fine Arts Library",description:"The Architecture/Fine Arts Library supports the teaching and research requirements of the Faculty of Architecture, which includes programs in Architecture, City Planning, Interior Design and Landscape Architecture, as well as the School of Art with programs in Fine Arts and Art History.",location:{lat:49.80815612216234,lng:-97.13530152378586},hours:{monday:[{open:"08:30",close:"17:30"}],tuesday:[{open:"08:30",close:"17:30"}],wednesday:[{open:"08:30",close:"17:30"}],thursday:[{open:"08:30",close:"17:30"}],friday:[{open:"08:30",close:"17:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/CFbxpALxC7HpwdBx8"}},{value:"donald-craik-engineering-library",label:"Donald W. Craik Engineering Library",description:"The Donald W. Craik Engineering Library serves engineeirng resources, including books, journals, and electronic databases, to support academic and research needs of students and faculty.",location:{lat:49.80835859585458,lng:-97.13445434076718},alwaysOpen:!0,metadata:{amenities:["WiFi"]}},{value:"e-k-williams-law-library",label:"E. K. Williams Law Library",description:"E.K. Williams Law Library primarily serves the teaching and research needs of the Faculty of Law and the University. The library is also an integral part of the legal resources of Manitoba, where it plays a prominent role in the delivery of legal information to the members of the legal profession, the judiciary, other professional groups, and the general public.",location:{lat:49.81194940624498,lng:-97.13047415092316},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/NzVn21YBon12p11e8"}},{value:"eckhardt-gramatte-music-library",label:"Eckhardt Gramatté Music Library",description:"The Eckhardt Gramatté Music Library supports study, research, and performance at the University of Manitoba. As a unit of the University of Manitoba Libraries, the Music Library provides a vast range of print, recorded and electronic resources to students, faculty and staff of the University as well as members of the public.",location:{lat:49.80784297695002,lng:-97.1321825540353},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/BkewBe4p6jjSWEgb7"}},{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/pq5cGKjbKwuJFan86"}},{value:"father-harold-drake-library",label:"St. Paul's College",description:"The Fr. Harold Drake Library at St. Paul's College focuses on supporting the teaching and research needs of staff and students at St. Paul's College including the Jesuit Centre for Catholic Studies and Arthur V. Mauro Institute for Peace and Justice.",location:{lat:49.81045700369361,lng:-97.13799926192738},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/JGQEwkeyEtG1cDCbA"}},{value:"jim-peebles-science-and-technology-library",label:"Jim Peebles Science and Technology Library",description:"The Jim Peebles Science and Technology Library serves the research, study, and teaching requirements of the Faculties of Science, Engineering, Agricultural and Food Sciences, and Environment, Earth, and Resources.",location:{lat:49.81121151579056,lng:-97.13336330797407},hours:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/48NVXVD6kGeSoEue9"}}],YM=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46970996120006,lng:-80.54228100658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/5xkMePMsgStWSzgF8"}},{value:"david-centre-library",label:"Davis Centre Library",description:"The Davis Centre Library houses resources for engineering, mathematics, and science.",location:{lat:43.47298768397052,lng:-80.5419473517104},hours:{monday:[{open:"08:00",close:"24:00"}],tuesday:[{open:"08:00",close:"24:00"}],wednesday:[{open:"08:00",close:"24:00"}],thursday:[{open:"08:00",close:"24:00"}],friday:[{open:"08:00",close:"24:00"}],saturday:[{open:"11:00",close:"24:00"}],sunday:[{open:"11:00",close:"24:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/Z5CsTbspAfcd8XGS7"}}],W0=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.133},spaces:JM,metadata:{timezone:"America/Winnipeg"}},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:YM,metadata:{timezone:"America/Toronto"}}];var Jf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var QM=Jf.exports,H0;function ez(){return H0||(H0=1,function(h,s){(function(g,v){h.exports=v()})(QM,function(){var g={},v={};function T(w,c,j){if(v[w]=j,w==="index"){var q="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",K={};return v.shared(K),v.index(g,K),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([q],{type:"text/javascript"}))),g}}T("shared",["exports"],function(w){function c(i,t,r,o){return new(r||(r=Promise))(function(u,f){function m(P){try{x(o.next(P))}catch(A){f(A)}}function _(P){try{x(o.throw(P))}catch(A){f(A)}}function x(P){var A;P.done?u(P.value):(A=P.value,A instanceof r?A:new r(function(E){E(A)})).then(m,_)}x((o=o.apply(i,t||[])).next())})}function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var q=K;function K(i,t){this.x=i,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),o=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=o,this},_rotateAround:function(i,t){var r=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(i){return i instanceof K?i:Array.isArray(i)?new K(i[0],i[1]):i};var N=j(q),V=se;function se(i,t,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=o}se.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var m=0,_=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));o++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ie=j(V);let le,fe;function Se(){return le==null&&(le=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),le}function ge(){if(fe==null&&(fe=!1,Se())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){fe=!0;break}}}return fe||!1}function Ee(i,t,r,o){const u=new ie(i,t,r,o);return f=>u.solve(f)}const Ne=Ee(.25,.1,.25,1);function Le(i,t,r){return Math.min(r,Math.max(t,i))}function We(i,t,r){const o=r-t,u=((i-t)%o+o)%o+t;return u===t?r:u}function tt(i,...t){for(const r of t)for(const o in r)i[o]=r[o];return i}let Pt=1;function $e(i,t,r){const o={};for(const u in i)o[u]=t.call(this,i[u],u,i);return o}function nt(i,t,r){const o={};for(const u in i)t.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function Re(i){return Array.isArray(i)?i.map(Re):typeof i=="object"&&i?$e(i,Re):i}const Me={};function De(i){Me[i]||(typeof console<"u"&&console.warn(i),Me[i]=!0)}function Ae(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Ge(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Xe=null;function ft(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function at(i,t,r,o,u){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const _=m.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,function(P,A,E,D,F){const U=4*Math.max(-A,0),Z=(Math.max(0,E)-E)*D*4+U,J=4*D,re=Math.max(0,A),xe=Math.max(0,E);return{rect:{x:re,y:xe,width:Math.min(P.width,A+D)-re,height:Math.min(P.height,E+F)-xe},layout:[{offset:Z,stride:J}]}}(i,t,r,o,u)),_)for(let P=0;P<x.length;P+=4){const A=x[P];x[P]=x[P+2],x[P+2]=A}return x}finally{f.close()}})}let ut,Mt;const zt="AbortError";function ri(){return new Error(zt)}const Jt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function fi(i){return Jt.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Ni="global-dispatcher";class Ci extends Error{constructor(t,r,o,u){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=u}}const qi=()=>Ge(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wi=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=fi(i.url);if(o)return o(i,t);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Ni},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(qi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return c(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:qi(),signal:u.signal});o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const m=yield fetch(f);if(!m.ok){const P=yield m.blob();throw new Ci(m.status,m.statusText,o.url,P)}let _;_=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const x=yield _;if(u.signal.aborted)throw ri();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Ni},t)}var r;return function(o,u){return new Promise((f,m)=>{var _;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const P in o.headers)x.setRequestHeader(P,o.headers[P]);o.type==="json"&&(x.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let P=x.response;if(o.type==="json")try{P=JSON.parse(x.response)}catch(A){return void m(A)}f({data:P,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const P=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new Ci(x.status,x.statusText,o.url,P))}},u.signal.addEventListener("abort",()=>{x.abort(),m(ri())}),x.send(o.body)})}(i,t)};function zr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Vi(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function Ai(i,t,r){if(r&&r[i]){const o=r[i].indexOf(t);o!==-1&&r[i].splice(o,1)}}class cr{constructor(t,r={}){tt(this,r),this.type=t}}class mt extends cr{constructor(t,r={}){super("error",tt({error:t},r))}}class Ot{on(t,r){return this._listeners=this._listeners||{},Vi(t,r,this._listeners),this}off(t,r){return Ai(t,r,this._listeners),Ai(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Vi(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new cr(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of u)_.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of f)Ai(o,_,this._oneTimeListeners),_.call(this,t);const m=this._eventedParent;m&&(tt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof mt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var ye={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const zi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Dr(i,t){const r={};for(const o in i)o!=="ref"&&(r[o]=i[o]);return zi.forEach(o=>{o in t&&(r[o]=t[o])}),r}function ei(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ei(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!ei(i[r],t[r]))return!1;return!0}return i===t}function vi(i,t){i.push(t)}function dn(i,t,r){vi(r,{command:"addSource",args:[i,t[i]]})}function tn(i,t,r){vi(t,{command:"removeSource",args:[i]}),r[i]=!0}function ur(i,t,r,o){tn(i,r,o),dn(i,t,r)}function Zn(i,t,r){let o;for(o in i[r])if(Object.prototype.hasOwnProperty.call(i[r],o)&&o!=="data"&&!ei(i[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!ei(i[r][o],t[r][o]))return!1;return!0}function Zr(i,t,r,o,u,f){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(ei(i[m],t[m])||r.push({command:f,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(ei(i[m],t[m])||r.push({command:f,args:[o,m,t[m],u]}))}function In(i){return i.id}function us(i,t){return i[t.id]=t,i}class Ke{constructor(t,r,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function pn(i,...t){for(const r of t)for(const o in r)i[o]=r[o];return i}class mr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class fn{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,u]of r)this.bindings[o]=u}concat(t){return new fn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Qn={kind:"null"},Ye={kind:"number"},Ht={kind:"string"},Nt={kind:"boolean"},gr={kind:"color"},rn={kind:"object"},Vt={kind:"value"},_r={kind:"collator"},mn={kind:"formatted"},hs={kind:"padding"},Gn={kind:"resolvedImage"},te={kind:"variableAnchorOffsetCollection"};function O(i,t){return{kind:"array",itemType:i,N:t}}function R(i){if(i.kind==="array"){const t=R(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const W=[Qn,Ye,Ht,Nt,gr,mn,rn,O(Vt),hs,Gn,te];function Y(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Y(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of W)if(!Y(r,t))return null}}return`Expected ${R(i)} but found ${R(t)} instead.`}function he(i,t){return t.some(r=>r.kind===i.kind)}function pe(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function ve(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const ae=.96422,ke=.82521,Fe=4/29,Ie=6/29,Qe=3*Ie*Ie,kt=Ie*Ie*Ie,Dt=Math.PI/180,ui=180/Math.PI;function Wt(i){return(i%=360)<0&&(i+=360),i}function hi([i,t,r,o]){let u,f;const m=nr((.2225045*(i=ni(i))+.7168786*(t=ni(t))+.0606169*(r=ni(r)))/1);i===t&&t===r?u=f=m:(u=nr((.4360747*i+.3850649*t+.1430804*r)/ae),f=nr((.0139322*i+.0971045*t+.7141733*r)/ke));const _=116*m-16;return[_<0?0:_,500*(u-m),200*(m-f),o]}function ni(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function nr(i){return i>kt?Math.pow(i,1/3):i/Qe+Fe}function Hi([i,t,r,o]){let u=(i+16)/116,f=isNaN(t)?u:u+t/500,m=isNaN(r)?u:u-r/200;return u=1*xi(u),f=ae*xi(f),m=ke*xi(m),[Yt(3.1338561*f-1.6168667*u-.4906146*m),Yt(-.9787684*f+1.9161415*u+.033454*m),Yt(.0719453*f-.2289914*u+1.4052427*m),o]}function Yt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function xi(i){return i>Ie?i*i*i:Qe*(i-Fe)}function ji(i){return parseInt(i.padEnd(2,i),16)/255}function hr(i,t){return yr(t?i/100:i,0,1)}function yr(i,t,r){return Math.min(Math.max(t,i),r)}function Lr(i){return!i.some(Number.isNaN)}const io={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class bi{constructor(t,r,o,u=1,f=!0){this.r=t,this.g=r,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,r,o,u]))}static parse(t){if(t instanceof bi)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=io[o];if(u){const[m,_,x]=u;return[m/255,_/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let _=1;return[ji(o.slice(_,_+=m)),ji(o.slice(_,_+=m)),ji(o.slice(_,_+=m)),ji(o.slice(_,_+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[_,x,P,A,E,D,F,U,Z,J,re,xe]=m,ue=[A||" ",F||" ",J].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const _e=[P,D,Z].join(""),Ce=_e==="%%%"?100:_e===""?255:0;if(Ce){const Ue=[yr(+x/Ce,0,1),yr(+E/Ce,0,1),yr(+U/Ce,0,1),re?hr(+re,xe):1];if(Lr(Ue))return Ue}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,_,x,P,A,E,D,F,U]=f,Z=[x||" ",A||" ",D].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const J=[+_,yr(+P,0,100),yr(+E,0,100),F?hr(+F,U):1];if(Lr(J))return function([re,xe,ue,_e]){function Ce(Ue){const pt=(Ue+re/30)%12,Rt=xe*Math.min(ue,1-ue);return ue-Rt*Math.max(-1,Math.min(pt-3,9-pt,1))}return re=Wt(re),xe/=100,ue/=100,[Ce(0),Ce(8),Ce(4),_e]}(J)}}}(t);return r?new bi(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[t/f,r/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,u,f]=hi(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?Wt(Math.atan2(u,o)*ui):NaN,m,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",hi(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,u]=this.rgb;return`rgba(${[t,r,o].map(f=>Math.round(255*f)).join(",")},${u})`}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);class Uc{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qc{constructor(t,r,o,u,f){this.text=t,this.image=r,this.scale=o,this.fontStack=u,this.textColor=f}}class nn{constructor(t){this.sections=t}static fromString(t){return new nn([new qc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof nn?t:nn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class sn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof sn)return t;if(typeof t=="number")return new sn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new sn(t)}}toString(){return JSON.stringify(this.values)}}const Hg=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],u=t[r+1];if(typeof o!="string"||!Hg.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new gn(t)}}toString(){return JSON.stringify(this.values)}}class on{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new on({name:t,available:!1}):null}}function ro(i,t,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,r,o]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Es(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof bi||i instanceof Uc||i instanceof nn||i instanceof sn||i instanceof gn||i instanceof on)return!0;if(Array.isArray(i)){for(const t of i)if(!Es(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Es(i[t]))return!1;return!0}return!1}function sr(i){if(i===null)return Qn;if(typeof i=="string")return Ht;if(typeof i=="boolean")return Nt;if(typeof i=="number")return Ye;if(i instanceof bi)return gr;if(i instanceof Uc)return _r;if(i instanceof nn)return mn;if(i instanceof sn)return hs;if(i instanceof gn)return te;if(i instanceof on)return Gn;if(Array.isArray(i)){const t=i.length;let r;for(const o of i){const u=sr(o);if(r){if(r===u)continue;r=Vt;break}r=u}return O(r||Vt,t)}return rn}function aa(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof bi||i instanceof nn||i instanceof sn||i instanceof gn||i instanceof on?i.toString():JSON.stringify(i)}class Cn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Es(t[1]))return r.error("invalid value");const o=t[1];let u=sr(o);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Cn(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class tr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ha={string:Ht,number:Ye,boolean:Nt,object:rn};class An{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,u=1;const f=t[0];if(f==="array"){let _,x;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ha)||P==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=Ha[P],u++}else _=Vt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}o=O(_,x)}else{if(!Ha[f])throw new Error(`Types doesn't contain name = ${f}`);o=Ha[f]}const m=[];for(;u<t.length;u++){const _=r.parse(t[u],u,Vt);if(!_)return null;m.push(_)}return new An(o,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!Y(this.type,sr(o)))return o;if(r===this.args.length-1)throw new tr(`Expected value to be of type ${R(this.type)}, but found ${R(sr(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Zc={"to-boolean":Nt,"to-color":gr,"to-number":Ye,"to-string":Ht};class kn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Zc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const u=Zc[o],f=[];for(let m=1;m<t.length;m++){const _=r.parse(t[m],m,Vt);if(!_)return null;f.push(_)}return new kn(u,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const u of this.args){if(r=u.evaluate(t),o=null,r instanceof bi)return r;if(typeof r=="string"){const f=t.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ro(r[0],r[1],r[2],r[3]),!o))return new bi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new tr(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const u=sn.parse(r);if(u)return u}throw new tr(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const u=gn.parse(r);if(u)return u}throw new tr(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new tr(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return nn.fromString(aa(this.args[0].evaluate(t)));case"resolvedImage":return on.fromString(aa(this.args[0].evaluate(t)));default:return aa(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Xg=["Unknown","Point","LineString","Polygon"];class Xa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xg[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=bi.parse(t)),r}}class Ms{constructor(t,r,o=[],u,f=new fn,m=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=m,this.expectedType=u,this._isConstant=r}parse(t,r,o,u,f={}){return r?this.concat(r,o,u)._parse(t,f):this._parse(t,f)}_parse(t,r){function o(u,f,m){return m==="assert"?new An(f,[u]):m==="coerce"?new kn(f,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,x=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"coerce");else m=o(m,_,r.typeAnnotation||"assert")}if(!(m instanceof Cn)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const _=new Xa;try{m=new Cn(m.type,m.evaluate(_))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const u=typeof t=="number"?this.path.concat(t):this.path,f=o?this.scope.concat(o):this.scope;return new Ms(this.registry,this._isConstant,u,r||null,f,this.errors)}error(t,...r){const o=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new mr(o,t))}checkSubtype(t,r){const o=Y(t,r);return o&&this.error(o),o}}class ds{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=r.parse(t[f+1],f+1);if(!_)return null;o.push([m,_])}const u=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return u?new ds(o,u):null}outputDefined(){return this.result.outputDefined()}}class mi{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new mi(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Gc{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Ye),u=r.parse(t[2],2,O(r.expectedType||Vt));return o&&u?new Gc(u.type.itemType,o,u):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new tr(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new tr(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new tr(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Wc{constructor(t,r){this.type=Nt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Vt),u=r.parse(t[2],2,Vt);return o&&u?he(o.type,[Nt,Ht,Ye,Qn,Vt])?new Wc(o,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!pe(r,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${R(sr(r))} instead.`);if(!pe(o,["string","array"]))throw new tr(`Expected second argument to be of type array or string, but found ${R(sr(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class no{constructor(t,r,o){this.type=Ye,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Vt),u=r.parse(t[2],2,Vt);if(!o||!u)return null;if(!he(o.type,[Nt,Ht,Ye,Qn,Vt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ye);return f?new no(o,u,f):null}return new no(o,u)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!pe(r,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${R(sr(r))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),pe(o,["string"])){const f=o.indexOf(r,u);return f===-1?-1:[...o.slice(0,f)].length}if(pe(o,["array"]))return o.indexOf(r,u);throw new tr(`Expected second argument to be of type array or string, but found ${R(sr(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Hc{constructor(t,r,o,u,f,m){this.inputType=t,this.type=r,this.input=o,this.cases=u,this.outputs=f,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},m=[];for(let P=2;P<t.length-1;P+=2){let A=t[P];const E=t[P+1];Array.isArray(A)||(A=[A]);const D=r.concat(P);if(A.length===0)return D.error("Expected at least one branch label.");for(const U of A){if(typeof U!="number"&&typeof U!="string")return D.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,sr(U)))return null}else o=sr(U);if(f[String(U)]!==void 0)return D.error("Branch labels must be unique.");f[String(U)]=m.length}const F=r.parse(E,P,u);if(!F)return null;u=u||F.type,m.push(F)}const _=r.parse(t[1],1,Vt);if(!_)return null;const x=r.parse(t[t.length-1],t.length-1,u);return x?_.type.kind!=="value"&&r.concat(1).checkSubtype(o,_.type)?null:new Hc(o,u,_,f,m,x):null}evaluate(t){const r=this.input.evaluate(t);return(sr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Ka{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const _=r.parse(t[m],m,Nt);if(!_)return null;const x=r.parse(t[m+1],m+1,o);if(!x)return null;u.push([_,x]),o=o||x.type}const f=r.parse(t[t.length-1],t.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Ka(o,u,f)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class la{constructor(t,r,o,u){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=u}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Vt),u=r.parse(t[2],2,Ye);if(!o||!u)return null;if(!he(o.type,[O(Vt),Ht,Vt]))return r.error(`Expected first argument to be of type array or string, but found ${R(o.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ye);return f?new la(o.type,o,u,f):null}return new la(o.type,o,u)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),pe(r,["string"]))return[...r].slice(o,u).join("");if(pe(r,["array"]))return r.slice(o,u);throw new tr(`Expected first argument to be of type array or string, but found ${R(sr(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function $a(i,t){const r=i.length-1;let o,u,f=0,m=r,_=0;for(;f<=m;)if(_=Math.floor((f+m)/2),o=i[_],u=i[_+1],o<=t){if(_===r||t<u)return _;f=_+1}else{if(!(o>t))throw new tr("Input is not a number.");m=_-1}return 0}class so{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,Ye);if(!o)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<t.length;m+=2){const _=m===1?-1/0:t[m],x=t[m+1],P=m,A=m+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(u.length&&u[u.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const E=r.parse(x,A,f);if(!E)return null;f=f||E.type,u.push([_,E])}return new so(f,o,u)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const f=r.length;return u>=r[f-1]?o[f-1].evaluate(t):o[$a(r,u)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Rp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Kg=Op;function Op(i,t,r,o){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=o}Op.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,o=0;o<8;o++){var u=this.sampleCurveX(r)-i;if(Math.abs(u)<t)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var m=0,_=1;for(r=i,o=0;o<20&&(u=this.sampleCurveX(r),!(Math.abs(u-i)<t));o++)i>u?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var $g=Rp(Kg);function zs(i,t,r){return i+r*(t-i)}function ca(i,t,r){return i.map((o,u)=>zs(o,t[u],r))}const Gr={number:zs,color:function(i,t,r,o="rgb"){switch(o){case"rgb":{const[u,f,m,_]=ca(i.rgb,t.rgb,r);return new bi(u,f,m,_,!1)}case"hcl":{const[u,f,m,_]=i.hcl,[x,P,A,E]=t.hcl;let D,F;if(isNaN(u)||isNaN(x))isNaN(u)?isNaN(x)?D=NaN:(D=x,m!==1&&m!==0||(F=P)):(D=u,A!==1&&A!==0||(F=f));else{let xe=x-u;x>u&&xe>180?xe-=360:x<u&&u-x>180&&(xe+=360),D=u+r*xe}const[U,Z,J,re]=function([xe,ue,_e,Ce]){return xe=isNaN(xe)?0:xe*Dt,Hi([_e,Math.cos(xe)*ue,Math.sin(xe)*ue,Ce])}([D,F??zs(f,P,r),zs(m,A,r),zs(_,E,r)]);return new bi(U,Z,J,re,!1)}case"lab":{const[u,f,m,_]=Hi(ca(i.lab,t.lab,r));return new bi(u,f,m,_,!1)}}},array:ca,padding:function(i,t,r){return new sn(ca(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const o=i.values,u=t.values;if(o.length!==u.length)throw new tr(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const f=[];for(let m=0;m<o.length;m+=2){if(o[m]!==u[m])throw new tr(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${o[m]}, to[${m}]: ${u[m]}`);f.push(o[m]);const[_,x]=o[m+1],[P,A]=u[m+1];f.push([zs(_,P,r),zs(x,A,r)])}return new gn(f)}};class Wr{constructor(t,r,o,u,f){this.type=t,this.operator=r,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of f)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(t,r,o,u){let f=0;if(t.name==="exponential")f=Ja(r,t.base,o,u);else if(t.name==="linear")f=Ja(r,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new $g(m[0],m[1],m[2],m[3]).solve(Ja(r,1,o,u))}return f}static parse(t,r){let[o,u,f,...m]=t;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const P=u[1];if(typeof P!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:P}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const P=u.slice(1);if(P.length!==4||P.some(A=>typeof A!="number"||A<0||A>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Ye),!f)return null;const _=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=gr:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let P=0;P<m.length;P+=2){const A=m[P],E=m[P+1],D=P+3,F=P+4;if(typeof A!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(_.length&&_[_.length-1][0]>=A)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const U=r.parse(E,F,x);if(!U)return null;x=x||U.type,_.push([A,U])}return ve(x,Ye)||ve(x,gr)||ve(x,hs)||ve(x,te)||ve(x,O(Ye))?new Wr(x,o,u,f,_):r.error(`Type ${R(x)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=r[0])return o[0].evaluate(t);const f=r.length;if(u>=r[f-1])return o[f-1].evaluate(t);const m=$a(r,u),_=Wr.interpolationFactor(this.interpolation,u,r[m],r[m+1]),x=o[m].evaluate(t),P=o[m+1].evaluate(t);switch(this.operator){case"interpolate":return Gr[this.type.kind](x,P,_);case"interpolate-hcl":return Gr.color(x,P,_,"hcl");case"interpolate-lab":return Gr.color(x,P,_,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ja(i,t,r,o){const u=o-r,f=i-r;return u===0?0:t===1?f/u:(Math.pow(t,f)-1)/(Math.pow(t,u)-1)}class Ya{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let o=null;const u=r.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const _ of t.slice(1)){const x=r.parse(_,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const m=u&&f.some(_=>Y(u,_.type));return new Ya(m?Vt:o,f)}evaluate(t){let r,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(t),o&&o instanceof on&&!o.available&&(r||(r=o.name),o=null,u===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Qa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Fp(i,t,r,o){return o.compare(t,r)===0}function oo(i,t,r){const o=i!=="=="&&i!=="!=";return class vw{constructor(f,m,_){this.type=Nt,this.lhs=f,this.rhs=m,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const _=f[0];let x=m.parse(f[1],1,Vt);if(!x)return null;if(!Qa(_,x.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${R(x.type)}'.`);let P=m.parse(f[2],2,Vt);if(!P)return null;if(!Qa(_,P.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${R(P.type)}'.`);if(x.type.kind!==P.type.kind&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${R(x.type)}' and '${R(P.type)}'.`);o&&(x.type.kind==="value"&&P.type.kind!=="value"?x=new An(P.type,[x]):x.type.kind!=="value"&&P.type.kind==="value"&&(P=new An(x.type,[P])));let A=null;if(f.length===4){if(x.type.kind!=="string"&&P.type.kind!=="string"&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,_r),!A)return null}return new vw(x,P,A)}evaluate(f){const m=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=sr(m),P=sr(_);if(x.kind!==P.kind||x.kind!=="string"&&x.kind!=="number")throw new tr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=sr(m),P=sr(_);if(x.kind!=="string"||P.kind!=="string")return t(f,m,_)}return this.collator?r(f,m,_,this.collator.evaluate(f)):t(f,m,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Jg=oo("==",function(i,t,r){return t===r},Fp),Bp=oo("!=",function(i,t,r){return t!==r},function(i,t,r,o){return!Fp(0,t,r,o)}),Np=oo("<",function(i,t,r){return t<r},function(i,t,r,o){return o.compare(t,r)<0}),Yg=oo(">",function(i,t,r){return t>r},function(i,t,r,o){return o.compare(t,r)>0}),Qg=oo("<=",function(i,t,r){return t<=r},function(i,t,r,o){return o.compare(t,r)<=0}),Vp=oo(">=",function(i,t,r){return t>=r},function(i,t,r,o){return o.compare(t,r)>=0});class ua{constructor(t,r,o){this.type=_r,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const u=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Nt);if(!u)return null;const f=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Nt);if(!f)return null;let m=null;return o.locale&&(m=r.parse(o.locale,1,Ht),!m)?null:new ua(u,f,m)}evaluate(t){return new Uc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Xc{constructor(t,r,o,u,f){this.type=Ht,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ye);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,Ht),!f))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,Ht),!m))return null;let _=null;if(u["min-fraction-digits"]&&(_=r.parse(u["min-fraction-digits"],1,Ye),!_))return null;let x=null;return u["max-fraction-digits"]&&(x=r.parse(u["max-fraction-digits"],1,Ye),!x)?null:new Xc(o,f,m,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(t){this.type=mn,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=t.length-1;++m){const _=t[m];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let x=null;if(_["font-scale"]&&(x=r.parse(_["font-scale"],1,Ye),!x))return null;let P=null;if(_["text-font"]&&(P=r.parse(_["text-font"],1,O(Ht)),!P))return null;let A=null;if(_["text-color"]&&(A=r.parse(_["text-color"],1,gr),!A))return null;const E=u[u.length-1];E.scale=x,E.font=P,E.textColor=A}else{const x=r.parse(t[m],1,Vt);if(!x)return null;const P=x.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new el(u)}evaluate(t){return new nn(this.sections.map(r=>{const o=r.content.evaluate(t);return sr(o)===Gn?new qc("",o,null,null,null):new qc(aa(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class Kc{constructor(t){this.type=Gn,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Ht);return o?new Kc(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=on.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class $c{constructor(t){this.type=Ye,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${R(o.type)} instead.`):new $c(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new tr(`Expected value to be of type string or array, but found ${R(sr(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Wn=8192;function e_(i,t){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(r*u*Wn),Math.round(o*u*Wn)]}function Jc(i,t){const r=Math.pow(2,t.z);return[(u=(i[0]/Wn+t.x)/r,360*u-180),(o=(i[1]/Wn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Ds(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ps(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function _i(i,t,r){const o=i[0]-t[0],u=i[1]-t[1],f=i[0]-r[0],m=i[1]-r[1];return o*m-f*u==0&&o*f<=0&&u*m<=0}function tl(i,t,r,o){return(u=[o[0]-r[0],o[1]-r[1]])[0]*(f=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*f[0]!=0&&!(!Up(i,t,r,o)||!Up(r,o,i,t));var u,f}function t_(i,t,r){for(const o of r)for(let u=0;u<o.length-1;++u)if(tl(i,t,o[u],o[u+1]))return!0;return!1}function ao(i,t,r=!1){let o=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(_i(i,_[x],_[x+1]))return r;(f=_[x])[1]>(u=i)[1]!=(m=_[x+1])[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}var u,f,m;return o}function i_(i,t){for(const r of t)if(ao(i,r))return!0;return!1}function jp(i,t){for(const r of i)if(!ao(r,t))return!1;for(let r=0;r<i.length-1;++r)if(t_(i[r],i[r+1],t))return!1;return!0}function r_(i,t){for(const r of t)if(jp(i,r))return!0;return!1}function Up(i,t,r,o){const u=o[0]-r[0],f=o[1]-r[1],m=(i[0]-r[0])*f-u*(i[1]-r[1]),_=(t[0]-r[0])*f-u*(t[1]-r[1]);return m>0&&_<0||m<0&&_>0}function Yc(i,t,r){const o=[];for(let u=0;u<i.length;u++){const f=[];for(let m=0;m<i[u].length;m++){const _=e_(i[u][m],r);Ds(t,_),f.push(_)}o.push(f)}return o}function qp(i,t,r){const o=[];for(let u=0;u<i.length;u++){const f=Yc(i[u],t,r);o.push(f)}return o}function Zp(i,t,r,o){if(i[0]<r[0]||i[0]>r[2]){const u=.5*o;let f=i[0]-r[0]>u?-o:r[0]-i[0]>u?o:0;f===0&&(f=i[0]-r[2]>u?-o:r[2]-i[0]>u?o:0),i[0]+=f}Ds(t,i)}function Gp(i,t,r,o){const u=Math.pow(2,o.z)*Wn,f=[o.x*Wn,o.y*Wn],m=[];for(const _ of i)for(const x of _){const P=[x.x+f[0],x.y+f[1]];Zp(P,t,r,u),m.push(P)}return m}function Wp(i,t,r,o){const u=Math.pow(2,o.z)*Wn,f=[o.x*Wn,o.y*Wn],m=[];for(const x of i){const P=[];for(const A of x){const E=[A.x+f[0],A.y+f[1]];Ds(t,E),P.push(E)}m.push(P)}if(t[2]-t[0]<=u/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of m)for(const P of x)Zp(P,t,r,u)}var _;return m}class Ls{constructor(t,r){this.type=Nt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:m,coordinates:_}=f.geometry;m==="Polygon"&&u.push(_),m==="MultiPolygon"&&u.push(..._)}if(u.length)return new Ls(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ls(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ls(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=Yc(o.coordinates,f,m),x=Gp(r.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!ao(P,_))return!1}if(o.type==="MultiPolygon"){const _=qp(o.coordinates,f,m),x=Gp(r.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!i_(P,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(o.type==="Polygon"){const _=Yc(o.coordinates,f,m),x=Wp(r.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!jp(P,_))return!1}if(o.type==="MultiPolygon"){const _=qp(o.coordinates,f,m),x=Wp(r.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!r_(P,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hp=class{constructor(i=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,o=t[i];for(;i>0;){const u=i-1>>1,f=t[u];if(r(o,f)>=0)break;t[i]=f,i=u}t[i]=o}_down(i){const{data:t,compare:r}=this,o=this.length>>1,u=t[i];for(;i<o;){let f=1+(i<<1);const m=f+1;if(m<this.length&&r(t[m],t[f])<0&&(f=m),r(t[f],u)>=0)break;t[i]=t[f],i=f}t[i]=u}};function n_(i,t,r,o,u){Xp(i,t,r,o||i.length-1,u||s_)}function Xp(i,t,r,o,u){for(;o>r;){if(o-r>600){var f=o-r+1,m=t-r+1,_=Math.log(f),x=.5*Math.exp(2*_/3),P=.5*Math.sqrt(_*x*(f-x)/f)*(m-f/2<0?-1:1);Xp(i,t,Math.max(r,Math.floor(t-m*x/f+P)),Math.min(o,Math.floor(t+(f-m)*x/f+P)),u)}var A=i[t],E=r,D=o;for(ha(i,r,t),u(i[o],A)>0&&ha(i,r,o);E<D;){for(ha(i,E,D),E++,D--;u(i[E],A)<0;)E++;for(;u(i[D],A)>0;)D--}u(i[r],A)===0?ha(i,r,D):ha(i,++D,o),D<=t&&(r=D+1),t<=D&&(o=D-1)}}function ha(i,t,r){var o=i[t];i[t]=i[r],i[r]=o}function s_(i,t){return i<t?-1:i>t?1:0}function il(i,t){if(i.length<=1)return[i];const r=[];let o,u;for(const f of i){const m=a_(f);m!==0&&(f.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&r.push(o),o=[f]):o.push(f))}if(o&&r.push(o),t>1)for(let f=0;f<r.length;f++)r[f].length<=t||(n_(r[f],t,1,r[f].length-1,o_),r[f]=r[f].slice(0,t));return r}function o_(i,t){return t.area-i.area}function a_(i){let t=0;for(let r,o,u=0,f=i.length,m=f-1;u<f;m=u++)r=i[u],o=i[m],t+=(o.x-r.x)*(r.y+o.y);return t}const Kp=1/298.257223563,$p=Kp*(2-Kp),Jp=Math.PI/180;class Qc{constructor(t){const r=6378.137*Jp*1e3,o=Math.cos(t*Jp),u=1/(1-$p*(1-o*o)),f=Math.sqrt(u);this.kx=r*f*o,this.ky=r*f*u*(1-$p)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,u=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,r){let o,u,f,m,_=1/0;for(let x=0;x<t.length-1;x++){let P=t[x][0],A=t[x][1],E=this.wrap(t[x+1][0]-P)*this.kx,D=(t[x+1][1]-A)*this.ky,F=0;E===0&&D===0||(F=(this.wrap(r[0]-P)*this.kx*E+(r[1]-A)*this.ky*D)/(E*E+D*D),F>1?(P=t[x+1][0],A=t[x+1][1]):F>0&&(P+=E/this.kx*F,A+=D/this.ky*F)),E=this.wrap(r[0]-P)*this.kx,D=(r[1]-A)*this.ky;const U=E*E+D*D;U<_&&(_=U,o=P,u=A,f=x,m=F)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Yp(i,t){return t[0]-i[0]}function rl(i){return i[1]-i[0]+1}function es(i,t){return i[1]>=i[0]&&i[1]<t}function eu(i,t){if(i[0]>i[1])return[null,null];const r=rl(i);if(t){if(r===2)return[i,null];const u=Math.floor(r/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(r===1)return[i,null];const o=Math.floor(r/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function tu(i,t){if(!es(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Ds(r,i[o]);return r}function iu(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const o of r)Ds(t,o);return t}function nl(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function ru(i,t,r){if(!nl(i)||!nl(t))return NaN;let o=0,u=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),r.distance([0,0],[o,u])}function Rs(i,t,r){const o=r.pointOnLine(t,i);return r.distance(i,o.point)}function nu(i,t,r,o,u){const f=Math.min(Rs(i,[r,o],u),Rs(t,[r,o],u)),m=Math.min(Rs(r,[i,t],u),Rs(o,[i,t],u));return Math.min(f,m)}function l_(i,t,r,o,u){if(!es(t,i.length)||!es(o,r.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const _=i[m],x=i[m+1];for(let P=o[0];P<o[1];++P){const A=r[P],E=r[P+1];if(tl(_,x,A,E))return 0;f=Math.min(f,nu(_,x,A,E,u))}}return f}function Ji(i,t,r,o,u){if(!es(t,i.length)||!es(o,r.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let _=o[0];_<=o[1];++_)if(f=Math.min(f,u.distance(i[m],r[_])),f===0)return f;return f}function c_(i,t,r){if(ao(i,t,!0))return 0;let o=1/0;for(const u of t){const f=u[0],m=u[u.length-1];if(f!==m&&(o=Math.min(o,Rs(i,[m,f],r)),o===0))return o;const _=r.pointOnLine(u,i);if(o=Math.min(o,r.distance(i,_.point)),o===0)return o}return o}function ti(i,t,r,o){if(!es(t,i.length))return NaN;for(let f=t[0];f<=t[1];++f)if(ao(i[f],r,!0))return 0;let u=1/0;for(let f=t[0];f<t[1];++f){const m=i[f],_=i[f+1];for(const x of r)for(let P=0,A=x.length,E=A-1;P<A;E=P++){const D=x[E],F=x[P];if(tl(m,_,D,F))return 0;u=Math.min(u,nu(m,_,D,F,o))}}return u}function sl(i,t){for(const r of i)for(const o of r)if(ao(o,t,!0))return!0;return!1}function ki(i,t,r,o=1/0){const u=iu(i),f=iu(t);if(o!==1/0&&ru(u,f,r)>=o)return o;if(ps(u,f)){if(sl(i,t))return 0}else if(sl(t,i))return 0;let m=1/0;for(const _ of i)for(let x=0,P=_.length,A=P-1;x<P;A=x++){const E=_[A],D=_[x];for(const F of t)for(let U=0,Z=F.length,J=Z-1;U<Z;J=U++){const re=F[J],xe=F[U];if(tl(E,D,re,xe))return 0;m=Math.min(m,nu(E,D,re,xe,r))}}return m}function wi(i,t,r,o,u,f){if(!f)return;const m=ru(tu(o,f),u,r);m<t&&i.push([m,f,[0,0]])}function Os(i,t,r,o,u,f,m){if(!f||!m)return;const _=ru(tu(o,f),tu(u,m),r);_<t&&i.push([_,f,m])}function da(i,t,r,o,u=1/0){let f=Math.min(o.distance(i[0],r[0][0]),u);if(f===0)return f;const m=new Hp([[0,[0,i.length-1],[0,0]]],Yp),_=iu(r);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const P=x[1],A=t?50:100;if(rl(P)<=A){if(!es(P,i.length))return NaN;if(t){const E=ti(i,P,r,o);if(isNaN(E)||E===0)return E;f=Math.min(f,E)}else for(let E=P[0];E<=P[1];++E){const D=c_(i[E],r,o);if(f=Math.min(f,D),f===0)return 0}}else{const E=eu(P,t);wi(m,f,o,i,_,E[0]),wi(m,f,o,i,_,E[1])}}return f}function pa(i,t,r,o,u,f=1/0){let m=Math.min(f,u.distance(i[0],r[0]));if(m===0)return m;const _=new Hp([[0,[0,i.length-1],[0,r.length-1]]],Yp);for(;_.length>0;){const x=_.pop();if(x[0]>=m)continue;const P=x[1],A=x[2],E=t?50:100,D=o?50:100;if(rl(P)<=E&&rl(A)<=D){if(!es(P,i.length)&&es(A,r.length))return NaN;let F;if(t&&o)F=l_(i,P,r,A,u),m=Math.min(m,F);else if(t&&!o){const U=i.slice(P[0],P[1]+1);for(let Z=A[0];Z<=A[1];++Z)if(F=Rs(r[Z],U,u),m=Math.min(m,F),m===0)return m}else if(!t&&o){const U=r.slice(A[0],A[1]+1);for(let Z=P[0];Z<=P[1];++Z)if(F=Rs(i[Z],U,u),m=Math.min(m,F),m===0)return m}else F=Ji(i,P,r,A,u),m=Math.min(m,F)}else{const F=eu(P,t),U=eu(A,o);Os(_,m,u,i,r,F[0],U[0]),Os(_,m,u,i,r,F[0],U[1]),Os(_,m,u,i,r,F[1],U[0]),Os(_,m,u,i,r,F[1],U[1])}}return m}function su(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Fs{constructor(t,r){this.type=Ye,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Es(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Fs(o,o.features.map(u=>su(u.geometry)).flat());if(o.type==="Feature")return new Fs(o,su(o.geometry));if("type"in o&&"coordinates"in o)return new Fs(o,su(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const u=r.geometry(),f=u.flat().map(x=>Jc([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new Qc(f[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,pa(f,!1,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,pa(f,!1,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,da(f,!1,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const u=r.geometry(),f=u.flat().map(x=>Jc([x.x,x.y],r.canonical));if(u.length===0)return NaN;const m=new Qc(f[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,pa(f,!0,[x.coordinates],!1,m,_));break;case"LineString":_=Math.min(_,pa(f,!0,x.coordinates,!0,m,_));break;case"Polygon":_=Math.min(_,da(f,!0,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const u=r.geometry();if(u.length===0||u[0].length===0)return NaN;const f=il(u,0).map(x=>x.map(P=>P.map(A=>Jc([A.x,A.y],r.canonical)))),m=new Qc(f[0][0][0][1]);let _=1/0;for(const x of o)for(const P of f){switch(x.type){case"Point":_=Math.min(_,da([x.coordinates],!1,P,m,_));break;case"LineString":_=Math.min(_,da(x.coordinates,!0,P,m,_));break;case"Polygon":_=Math.min(_,ki(P,x.coordinates,m,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const lo={"==":Jg,"!=":Bp,">":Yg,"<":Np,">=":Vp,"<=":Qg,array:An,at:Gc,boolean:An,case:Ka,coalesce:Ya,collator:ua,format:el,image:Kc,in:Wc,"index-of":no,interpolate:Wr,"interpolate-hcl":Wr,"interpolate-lab":Wr,length:$c,let:ds,literal:Cn,match:Hc,number:An,"number-format":Xc,object:An,slice:la,step:so,string:An,"to-boolean":kn,"to-color":kn,"to-number":kn,"to-string":kn,var:mi,within:Ls,distance:Fs};class _n{constructor(t,r,o,u){this.name=t,this.type=r,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],u=_n.definitions[o];if(!u)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=m.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let x=null;for(const[P,A]of _){x=new Ms(r.registry,fa,r.path,null,r.scope);const E=[];let D=!1;for(let F=1;F<t.length;F++){const U=t[F],Z=Array.isArray(P)?P[F-1]:P.type,J=x.parse(U,1+E.length,Z);if(!J){D=!0;break}E.push(J)}if(!D)if(Array.isArray(P)&&P.length!==E.length)x.error(`Expected ${P.length} arguments, but found ${E.length} instead.`);else{for(let F=0;F<E.length;F++){const U=Array.isArray(P)?P[F]:P.type,Z=E[F];x.concat(F+1).checkSubtype(U,Z.type)}if(x.errors.length===0)return new _n(o,f,A,E)}}if(_.length===1)r.errors.push(...x.errors);else{const P=(_.length?_:m).map(([E])=>{return D=E,Array.isArray(D)?`(${D.map(R).join(", ")})`:`(${R(D.type)}...)`;var D}).join(" | "),A=[];for(let E=1;E<t.length;E++){const D=r.parse(t[E],1+A.length);if(!D)return null;A.push(R(D.type))}r.error(`Expected arguments of type ${P}, but found (${A.join(", ")}) instead.`)}return null}static register(t,r){_n.definitions=r;for(const o in r)t[o]=_n}}function ou(i,[t,r,o,u]){t=t.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const f=u?u.evaluate(i):1,m=ro(t,r,o,f);if(m)throw new tr(m);return new bi(t/255,r/255,o/255,f,!1)}function au(i,t){return i in t}function lu(i,t){const r=t[i];return r===void 0?null:r}function Bs(i){return{type:i}}function fa(i){if(i instanceof mi)return fa(i.boundExpression);if(i instanceof _n&&i.name==="error"||i instanceof ua||i instanceof Ls||i instanceof Fs)return!1;const t=i instanceof kn||i instanceof An;let r=!0;return i.eachChild(o=>{r=t?r&&fa(o):r&&o instanceof Cn}),!!r&&ma(i)&&ga(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ma(i){if(i instanceof _n&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ls||i instanceof Fs)return!1;let t=!0;return i.eachChild(r=>{t&&!ma(r)&&(t=!1)}),t}function co(i){if(i instanceof _n&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!co(r)&&(t=!1)}),t}function ga(i,t){if(i instanceof _n&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!ga(o,t)&&(r=!1)}),r}function ol(i){return{result:"success",value:i}}function uo(i){return{result:"error",value:i}}function ho(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Qp(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function cu(i){return!!i.expression&&i.expression.interpolated}function di(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function al(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function u_(i){return i}function ef(i,t){const r=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),f=i.type||(cu(t)?"exponential":"interval");if(r||t.type==="padding"){const A=r?bi.parse:sn.parse;(i=pn({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],A(E[1])])),i.default=A(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let _,x,P;if(f==="exponential")_=rf;else if(f==="interval")_=ll;else if(f==="categorical"){_=tf,x=Object.create(null);for(const A of i.stops)x[A[0]]=A[1];P=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=nf}if(o){const A={},E=[];for(let U=0;U<i.stops.length;U++){const Z=i.stops[U],J=Z[0].zoom;A[J]===void 0&&(A[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},E.push(J)),A[J].stops.push([Z[0].value,Z[1]])}const D=[];for(const U of E)D.push([A[U].zoom,ef(A[U],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Wr.interpolationFactor.bind(void 0,F),zoomStops:D.map(U=>U[0]),evaluate:({zoom:U},Z)=>rf({stops:D,base:i.base},t,U).evaluate(U,Z)}}if(u){const A=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Wr.interpolationFactor.bind(void 0,A),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>_(i,t,E,x,P)}}return{kind:"source",evaluate(A,E){const D=E&&E.properties?E.properties[i.property]:void 0;return D===void 0?po(i.default,t.default):_(i,t,D,x,P)}}}function po(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function tf(i,t,r,o,u){return po(typeof r===u?o[r]:void 0,i.default,t.default)}function ll(i,t,r){if(di(r)!=="number")return po(i.default,t.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const u=$a(i.stops.map(f=>f[0]),r);return i.stops[u][1]}function rf(i,t,r){const o=i.base!==void 0?i.base:1;if(di(r)!=="number")return po(i.default,t.default);const u=i.stops.length;if(u===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[u-1][0])return i.stops[u-1][1];const f=$a(i.stops.map(A=>A[0]),r),m=function(A,E,D,F){const U=F-D,Z=A-D;return U===0?0:E===1?Z/U:(Math.pow(E,Z)-1)/(Math.pow(E,U)-1)}(r,o,i.stops[f][0],i.stops[f+1][0]),_=i.stops[f][1],x=i.stops[f+1][1],P=Gr[t.type]||u_;return typeof _.evaluate=="function"?{evaluate(...A){const E=_.evaluate.apply(void 0,A),D=x.evaluate.apply(void 0,A);if(E!==void 0&&D!==void 0)return P(E,D,m,i.colorSpace)}}:P(_,x,m,i.colorSpace)}function nf(i,t,r){switch(t.type){case"color":r=bi.parse(r);break;case"formatted":r=nn.fromString(r.toString());break;case"resolvedImage":r=on.fromString(r.toString());break;case"padding":r=sn.parse(r);break;default:di(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return po(r,i.default,t.default)}_n.register(lo,{error:[{kind:"error"},[Ht],(i,[t])=>{throw new tr(t.evaluate(i))}],typeof:[Ht,[Vt],(i,[t])=>R(sr(t.evaluate(i)))],"to-rgba":[O(Ye,4),[gr],(i,[t])=>{const[r,o,u,f]=t.evaluate(i).rgb;return[255*r,255*o,255*u,f]}],rgb:[gr,[Ye,Ye,Ye],ou],rgba:[gr,[Ye,Ye,Ye,Ye],ou],has:{type:Nt,overloads:[[[Ht],(i,[t])=>au(t.evaluate(i),i.properties())],[[Ht,rn],(i,[t,r])=>au(t.evaluate(i),r.evaluate(i))]]},get:{type:Vt,overloads:[[[Ht],(i,[t])=>lu(t.evaluate(i),i.properties())],[[Ht,rn],(i,[t,r])=>lu(t.evaluate(i),r.evaluate(i))]]},"feature-state":[Vt,[Ht],(i,[t])=>lu(t.evaluate(i),i.featureState||{})],properties:[rn,[],i=>i.properties()],"geometry-type":[Ht,[],i=>i.geometryType()],id:[Vt,[],i=>i.id()],zoom:[Ye,[],i=>i.globals.zoom],"heatmap-density":[Ye,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ye,[],i=>i.globals.lineProgress||0],accumulated:[Vt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ye,Bs(Ye),(i,t)=>{let r=0;for(const o of t)r+=o.evaluate(i);return r}],"*":[Ye,Bs(Ye),(i,t)=>{let r=1;for(const o of t)r*=o.evaluate(i);return r}],"-":{type:Ye,overloads:[[[Ye,Ye],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[Ye],(i,[t])=>-t.evaluate(i)]]},"/":[Ye,[Ye,Ye],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[Ye,[Ye,Ye],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[Ye,[],()=>Math.LN2],pi:[Ye,[],()=>Math.PI],e:[Ye,[],()=>Math.E],"^":[Ye,[Ye,Ye],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[Ye,[Ye],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ye,[Ye],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ye,[Ye],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ye,[Ye],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ye,[Ye],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ye,[Ye],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ye,[Ye],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ye,[Ye],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ye,[Ye],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ye,[Ye],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ye,Bs(Ye),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[Ye,Bs(Ye),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[Ye,[Ye],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ye,[Ye],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ye,[Ye],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ye,[Ye],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Nt,[Ht,Vt],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Nt,[Vt],(i,[t])=>i.id()===t.value],"filter-type-==":[Nt,[Ht],(i,[t])=>i.geometryType()===t.value],"filter-<":[Nt,[Ht,Vt],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Nt,[Vt],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Nt,[Ht,Vt],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o>u}],"filter-id->":[Nt,[Vt],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Nt,[Ht,Vt],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Nt,[Vt],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Nt,[Ht,Vt],(i,[t,r])=>{const o=i.properties()[t.value],u=r.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Nt,[Vt],(i,[t])=>{const r=i.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Nt,[Vt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Nt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Nt,[O(Ht)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Nt,[O(Vt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Nt,[Ht,O(Vt)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Nt,[Ht,O(Vt)],(i,[t,r])=>function(o,u,f,m){for(;f<=m;){const _=f+m>>1;if(u[_]===o)return!0;u[_]>o?m=_-1:f=_+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Bs(Nt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Bs(Nt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Nt,[Nt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Nt,[Ht],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Ht,[Ht],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ht,[Ht],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ht,Bs(Vt),(i,t)=>t.map(r=>aa(r.evaluate(i))).join("")],"resolved-locale":[Ht,[_r],(i,[t])=>t.evaluate(i).resolvedLocale()]});class cl{constructor(t,r){var o;this.expression=t,this._warningHistory={},this._evaluator=new Xa,this._defaultValue=r?(o=r).type==="color"&&al(o.default)?new bi(0,0,0,0):o.type==="color"?bi.parse(o.default)||null:o.type==="padding"?sn.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?gn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,u,f,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new tr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function ul(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in lo}function fo(i,t){const r=new Ms(lo,fa,[],t?function(u){const f={color:gr,string:Ht,number:Ye,enum:Ht,boolean:Nt,formatted:mn,padding:hs,resolvedImage:Gn,variableAnchorOffsetCollection:te};return u.type==="array"?O(f[u.value]||Vt,u.length):f[u.type]}(t):void 0),o=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ol(new cl(o,t)):uo(r.errors)}class mo{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!co(r.expression)}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,f,m)}evaluate(t,r,o,u,f,m){return this._styleExpression.evaluate(t,r,o,u,f,m)}}class go{constructor(t,r,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!co(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,r,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,u,f,m)}evaluate(t,r,o,u,f,m){return this._styleExpression.evaluate(t,r,o,u,f,m)}interpolationFactor(t,r,o){return this.interpolationType?Wr.interpolationFactor(this.interpolationType,t,r,o):0}}function uu(i,t){const r=fo(i,t);if(r.result==="error")return r;const o=r.value.expression,u=ma(o);if(!u&&!ho(t))return uo([new mr("","data expressions not supported")]);const f=ga(o,["zoom"]);if(!f&&!Qp(t))return uo([new mr("","zoom expressions not supported")]);const m=_a(o);return m||f?m instanceof mr?uo([m]):m instanceof Wr&&!cu(t)?uo([new mr("",'"interpolate" expressions cannot be used with this property')]):ol(m?new go(u?"camera":"composite",r.value,m.labels,m instanceof Wr?m.interpolation:void 0):new mo(u?"constant":"source",r.value)):uo([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _o{constructor(t,r){this._parameters=t,this._specification=r,pn(this,ef(this._parameters,this._specification))}static deserialize(t){return new _o(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function _a(i){let t=null;if(i instanceof ds)t=_a(i.result);else if(i instanceof Ya){for(const r of i.args)if(t=_a(r),t)break}else(i instanceof so||i instanceof Wr)&&i.input instanceof _n&&i.input.name==="zoom"&&(t=i);return t instanceof mr||i.eachChild(r=>{const o=_a(r);o instanceof mr?t=o:!t&&o?t=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function hl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!hl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const dl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function hu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};hl(i)||(i=pl(i));const t=fo(i,dl);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,u)=>t.value.evaluate(r,o,{},u),needGeometry:sf(i)}}function h_(i,t){return i<t?-1:i>t?1:0}function sf(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(sf(i[t]))return!0;return!1}function pl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?du(i[1],i[2],"=="):t==="!="?Tr(du(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?du(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(pl))):t==="all"?["all"].concat(i.slice(1).map(pl)):t==="none"?["all"].concat(i.slice(1).map(pl).map(Tr)):t==="in"?ya(i[1],i.slice(2)):t==="!in"?Tr(ya(i[1],i.slice(2))):t==="has"?va(i[1]):t!=="!has"||Tr(va(i[1]));var r}function du(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function ya(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(h_)]]:["filter-in-small",i,["literal",t]]}}function va(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Tr(i){return["!",i]}function Ns(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const f of i)u+=`${Ns(f)},`;return`${u}]`}const r=Object.keys(i).sort();let o="{";for(let u=0;u<r.length;u++)o+=`${JSON.stringify(r[u])}:${Ns(i[r[u]])},`;return`${o}}`}function of(i){let t="";for(const r of zi)t+=`/${Ns(i[r])}`;return t}function af(i){const t=i.value;return t?[new Ke(i.key,t,"constants have been deprecated as of v8")]:[]}function Yi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function En(i){if(Array.isArray(i))return i.map(En);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=En(i[r]);return t}return Yi(i)}function an(i){const t=i.key,r=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},f=i.style,m=i.styleSpec,_=i.validateSpec;let x=[];const P=di(r);if(P!=="object")return[new Ke(t,r,`object expected, ${P} found`)];for(const A in r){const E=A.split(".")[0],D=o[E]||o["*"];let F;if(u[E])F=u[E];else if(o[E])F=_;else if(u["*"])F=u["*"];else{if(!o["*"]){x.push(new Ke(t,r[A],`unknown property "${A}"`));continue}F=_}x=x.concat(F({key:(t&&`${t}.`)+A,value:r[A],valueSpec:D,style:f,styleSpec:m,object:r,objectKey:A,validateSpec:_},r))}for(const A in o)u[A]||o[A].required&&o[A].default===void 0&&r[A]===void 0&&x.push(new Ke(t,r,`missing required property "${A}"`));return x}function xa(i){const t=i.value,r=i.valueSpec,o=i.style,u=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(di(t)!=="array")return[new Ke(f,t,`array expected, ${di(t)} found`)];if(r.length&&t.length!==r.length)return[new Ke(f,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Ke(f,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let _={type:r.value,values:r.values};u.$version<7&&(_.function=r.function),di(r.value)==="object"&&(_=r.value);let x=[];for(let P=0;P<t.length;P++)x=x.concat(m({array:t,arrayIndex:P,value:t[P],valueSpec:_,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${f}[${P}]`}));return x}function pu(i){const t=i.key,r=i.value,o=i.valueSpec;let u=di(r);return u==="number"&&r!=r&&(u="NaN"),u!=="number"?[new Ke(t,r,`number expected, ${u} found`)]:"minimum"in o&&r<o.minimum?[new Ke(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new Ke(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function fl(i){const t=i.valueSpec,r=Yi(i.value.type);let o,u,f,m={};const _=r!=="categorical"&&i.value.property===void 0,x=!_,P=di(i.value.stops)==="array"&&di(i.value.stops[0])==="array"&&di(i.value.stops[0][0])==="object",A=an({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Ke(F.key,F.value,'identity function may not have a "stops" property')];let U=[];const Z=F.value;return U=U.concat(xa({key:F.key,value:Z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:E})),di(Z)==="array"&&Z.length===0&&U.push(new Ke(F.key,Z,"array must have at least one stop")),U},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&_&&A.push(new Ke(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||A.push(new Ke(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!cu(i.valueSpec)&&A.push(new Ke(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!ho(i.valueSpec)?A.push(new Ke(i.key,i.value,"property functions not supported")):_&&!Qp(i.valueSpec)&&A.push(new Ke(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!P||i.value.property!==void 0||A.push(new Ke(i.key,i.value,'"property" property is required')),A;function E(F){let U=[];const Z=F.value,J=F.key;if(di(Z)!=="array")return[new Ke(J,Z,`array expected, ${di(Z)} found`)];if(Z.length!==2)return[new Ke(J,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(di(Z[0])!=="object")return[new Ke(J,Z,`object expected, ${di(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Ke(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Ke(J,Z,"object stop key must have value")];if(f&&f>Yi(Z[0].zoom))return[new Ke(J,Z[0].zoom,"stop zoom values must appear in ascending order")];Yi(Z[0].zoom)!==f&&(f=Yi(Z[0].zoom),u=void 0,m={}),U=U.concat(an({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:pu,value:D}}))}else U=U.concat(D({key:`${J}[0]`,value:Z[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},Z));return ul(En(Z[1]))?U.concat([new Ke(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):U.concat(F.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,U){const Z=di(F.value),J=Yi(F.value),re=F.value!==null?F.value:U;if(o){if(Z!==o)return[new Ke(F.key,re,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Ke(F.key,re,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let xe=`number expected, ${Z} found`;return ho(t)&&r===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(F.key,re,xe)]}return r!=="categorical"||Z!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&Z==="number"&&u!==void 0&&J<u?[new Ke(F.key,re,"stop domain values must appear in ascending order")]:(u=J,r==="categorical"&&J in m?[new Ke(F.key,re,"stop domain values must be unique")]:(m[J]=!0,[])):[new Ke(F.key,re,`integer expected, found ${J}`)]}}function yo(i){const t=(i.expressionContext==="property"?uu:fo)(En(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Ke(`${i.key}${o.key}`,i.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ke(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!co(r))return[new Ke(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!co(r))return[new Ke(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!ga(r,["zoom","feature-state"]))return[new Ke(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ma(r))return[new Ke(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ts(i){const t=i.key,r=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Yi(r))===-1&&u.push(new Ke(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(Yi(r))===-1&&u.push(new Ke(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function fu(i){return hl(En(i.value))?yo(pn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ml(i)}function ml(i){const t=i.value,r=i.key;if(di(t)!=="array")return[new Ke(r,t,`array expected, ${di(t)} found`)];const o=i.styleSpec;let u,f=[];if(t.length<1)return[new Ke(r,t,"filter array must have at least 1 element")];switch(f=f.concat(ts({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Yi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Yi(t[1])==="$type"&&f.push(new Ke(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Ke(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=di(t[1]),u!=="string"&&f.push(new Ke(`${r}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=di(t[m]),Yi(t[1])==="$type"?f=f.concat(ts({key:`${r}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Ke(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(ml({key:`${r}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=di(t[1]),t.length!==2?f.push(new Ke(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Ke(`${r}[1]`,t[1],`string expected, ${u} found`))}return f}function mu(i,t){const r=i.key,o=i.validateSpec,u=i.style,f=i.styleSpec,m=i.value,_=i.objectKey,x=f[`${t}_${i.layerType}`];if(!x)return[];const P=_.match(/^(.*)-transition$/);if(t==="paint"&&P&&x[P[1]]&&x[P[1]].transition)return o({key:r,value:m,valueSpec:f.transition,style:u,styleSpec:f});const A=i.valueSpec||x[_];if(!A)return[new Ke(r,m,`unknown property "${_}"`)];let E;if(di(m)==="string"&&ho(A)&&!A.tokens&&(E=/^{([^}]+)}$/.exec(m)))return[new Ke(r,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(_==="text-field"&&u&&!u.glyphs&&D.push(new Ke(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&al(En(m))&&Yi(m.type)==="identity"&&D.push(new Ke(r,m,'"text-font" does not support identity functions'))),D.concat(o({key:i.key,value:m,valueSpec:A,style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:_}))}function gl(i){return mu(i,"paint")}function gu(i){return mu(i,"layout")}function _u(i){let t=[];const r=i.value,o=i.key,u=i.style,f=i.styleSpec;r.type||r.ref||t.push(new Ke(o,r,'either "type" or "ref" is required'));let m=Yi(r.type);const _=Yi(r.ref);if(r.id){const x=Yi(r.id);for(let P=0;P<i.arrayIndex;P++){const A=u.layers[P];Yi(A.id)===x&&t.push(new Ke(o,r.id,`duplicate layer id "${r.id}", previously used at line ${A.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(P=>{P in r&&t.push(new Ke(o,r[P],`"${P}" is prohibited for ref layers`))}),u.layers.forEach(P=>{Yi(P.id)===_&&(x=P)}),x?x.ref?t.push(new Ke(o,r.ref,"ref cannot reference another ref layer")):m=Yi(x.type):t.push(new Ke(o,r.ref,`ref layer "${_}" not found`))}else if(m!=="background")if(r.source){const x=u.sources&&u.sources[r.source],P=x&&Yi(x.type);x?P==="vector"&&m==="raster"?t.push(new Ke(o,r.source,`layer "${r.id}" requires a raster source`)):P!=="raster-dem"&&m==="hillshade"?t.push(new Ke(o,r.source,`layer "${r.id}" requires a raster-dem source`)):P==="raster"&&m!=="raster"?t.push(new Ke(o,r.source,`layer "${r.id}" requires a vector source`)):P!=="vector"||r["source-layer"]?P==="raster-dem"&&m!=="hillshade"?t.push(new Ke(o,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||P==="geojson"&&x.lineMetrics||t.push(new Ke(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ke(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Ke(o,r.source,`source "${r.source}" not found`))}else t.push(new Ke(o,r,'missing required property "source"'));return t=t.concat(an({key:o,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:fu,layout:x=>an({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>gu(pn({layerType:m},P))}}),paint:x=>an({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>gl(pn({layerType:m},P))}})}})),t}function Vs(i){const t=i.value,r=i.key,o=di(t);return o!=="string"?[new Ke(r,t,`string expected, ${o} found`)]:[]}const _l={promoteId:function({key:i,value:t}){if(di(t)==="string")return Vs({key:i,value:t});{const r=[];for(const o in t)r.push(...Vs({key:`${i}.${o}`,value:t[o]}));return r}}};function ba(i){const t=i.value,r=i.key,o=i.styleSpec,u=i.style,f=i.validateSpec;if(!t.type)return[new Ke(r,t,'"type" is required')];const m=Yi(t.type);let _;switch(m){case"vector":case"raster":return _=an({key:r,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:_l,validateSpec:f}),_;case"raster-dem":return _=function(x){var P;const A=(P=x.sourceName)!==null&&P!==void 0?P:"",E=x.value,D=x.styleSpec,F=D.source_raster_dem,U=x.style;let Z=[];const J=di(E);if(E===void 0)return Z;if(J!=="object")return Z.push(new Ke("source_raster_dem",E,`object expected, ${J} found`)),Z;const re=Yi(E.encoding)==="custom",xe=["redFactor","greenFactor","blueFactor","baseShift"],ue=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const _e in E)!re&&xe.includes(_e)?Z.push(new Ke(_e,E[_e],`In "${A}": "${_e}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):F[_e]?Z=Z.concat(x.validateSpec({key:_e,value:E[_e],valueSpec:F[_e],validateSpec:x.validateSpec,style:U,styleSpec:D})):Z.push(new Ke(_e,E[_e],`unknown property "${_e}"`));return Z}({sourceName:r,value:t,style:i.style,styleSpec:o,validateSpec:f}),_;case"geojson":if(_=an({key:r,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:_l}),t.cluster)for(const x in t.clusterProperties){const[P,A]=t.clusterProperties[x],E=typeof P=="string"?[P,["accumulated"],["get",x]]:P;_.push(...yo({key:`${r}.${x}.map`,value:A,validateSpec:f,expressionContext:"cluster-map"})),_.push(...yo({key:`${r}.${x}.reduce`,value:E,validateSpec:f,expressionContext:"cluster-reduce"}))}return _;case"video":return an({key:r,value:t,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return an({key:r,value:t,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new Ke(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ts({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:f,styleSpec:o})}}function yu(i){const t=i.value,r=i.styleSpec,o=r.light,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Ke("light",t,`object expected, ${m} found`)]),f;for(const _ in t){const x=_.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?i.validateSpec({key:_,value:t[_],valueSpec:r.transition,validateSpec:i.validateSpec,style:u,styleSpec:r}):o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ke(_,t[_],`unknown property "${_}"`)])}return f}function vu(i){const t=i.value,r=i.styleSpec,o=r.sky,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Ke("sky",t,`object expected, ${f} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new Ke(_,t[_],`unknown property "${_}"`)]);return m}function xu(i){const t=i.value,r=i.styleSpec,o=r.terrain,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Ke("terrain",t,`object expected, ${m} found`)]),f;for(const _ in t)f=f.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:i.validateSpec,style:u,styleSpec:r}):[new Ke(_,t[_],`unknown property "${_}"`)]);return f}function bu(i){let t=[];const r=i.value,o=i.key;if(Array.isArray(r)){const u=[],f=[];for(const m in r)r[m].id&&u.includes(r[m].id)&&t.push(new Ke(o,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),u.push(r[m].id),r[m].url&&f.includes(r[m].url)&&t.push(new Ke(o,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),t=t.concat(an({key:`${o}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return Vs({key:o,value:r})}const yl={"*":()=>[],array:xa,boolean:function(i){const t=i.value,r=i.key,o=di(t);return o!=="boolean"?[new Ke(r,t,`boolean expected, ${o} found`)]:[]},number:pu,color:function(i){const t=i.key,r=i.value,o=di(r);return o!=="string"?[new Ke(t,r,`color expected, ${o} found`)]:bi.parse(String(r))?[]:[new Ke(t,r,`color expected, "${r}" found`)]},constants:af,enum:ts,filter:fu,function:fl,layer:_u,object:an,source:ba,light:yu,sky:vu,terrain:xu,projection:function(i){const t=i.value,r=i.styleSpec,o=r.projection,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Ke("projection",t,`object expected, ${f} found`)];let m=[];for(const _ in t)m=m.concat(o[_]?i.validateSpec({key:_,value:t[_],valueSpec:o[_],style:u,styleSpec:r}):[new Ke(_,t[_],`unknown property "${_}"`)]);return m},string:Vs,formatted:function(i){return Vs(i).length===0?[]:yo(i)},resolvedImage:function(i){return Vs(i).length===0?[]:yo(i)},padding:function(i){const t=i.key,r=i.value;if(di(r)==="array"){if(r.length<1||r.length>4)return[new Ke(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<r.length;f++)u=u.concat(i.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:o}));return u}return pu({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,o=di(r),u=i.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new Ke(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(ts({key:`${t}[${m}]`,value:r[m],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(xa({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return f},sprite:bu};function vo(i){const t=i.value,r=i.valueSpec,o=i.styleSpec;return i.validateSpec=vo,r.expression&&al(Yi(t))?fl(i):r.expression&&ul(En(t))?yo(i):r.type&&yl[r.type]?yl[r.type](i):an(pn({},i,{valueSpec:r.type?o[r.type]:r}))}function lf(i){const t=i.value,r=i.key,o=Vs(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ke(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ke(r,t,'"glyphs" url must include a "{range}" token'))),o}function yn(i,t=ye){let r=[];return r=r.concat(vo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:vo,objectElementValidators:{glyphs:lf,"*":()=>[]}})),i.constants&&(r=r.concat(af({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:vo}))),wu(r)}function Hn(i){return function(t){return i({...t,validateSpec:vo})}}function wu(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function Mn(i){return function(...t){return wu(i.apply(this,t))}}yn.source=Mn(Hn(ba)),yn.sprite=Mn(Hn(bu)),yn.glyphs=Mn(Hn(lf)),yn.light=Mn(Hn(yu)),yn.sky=Mn(Hn(vu)),yn.terrain=Mn(Hn(xu)),yn.layer=Mn(Hn(_u)),yn.filter=Mn(Hn(fu)),yn.paintProperty=Mn(Hn(gl)),yn.layoutProperty=Mn(Hn(gu));const js=yn,d_=js.light,p_=js.sky,cf=js.paintProperty,uf=js.layoutProperty;function Su(i,t){let r=!1;if(t&&t.length)for(const o of t)i.fire(new mt(new Error(o.message))),r=!0;return r}class xo{constructor(t,r,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(o=m[2]);for(let x=0;x<this.d*this.d;x++){const P=m[3+x],A=m[3+x+1];u.push(P===A?null:m.subarray(P,A))}const _=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],_),this.bboxes=m.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const f=o/r*t;this.min=-f,this.max=t+f}insert(t,r,o,u,f){this._forEachCell(r,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,u,f,m){this.cells[f].push(m)}query(t,r,o,u,f){const m=this.min,_=this.max;if(t<=m&&r<=m&&_<=o&&_<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,r,o,u,this._queryCell,x,{},f),x}}_queryCell(t,r,o,u,f,m,_,x){const P=this.cells[f];if(P!==null){const A=this.keys,E=this.bboxes;for(let D=0;D<P.length;D++){const F=P[D];if(_[F]===void 0){const U=4*F;(x?x(E[U+0],E[U+1],E[U+2],E[U+3]):t<=E[U+2]&&r<=E[U+3]&&o>=E[U+0]&&u>=E[U+1])?(_[F]=!0,m.push(A[F])):_[F]=!1}}}}_forEachCell(t,r,o,u,f,m,_,x){const P=this._convertToCellCoord(t),A=this._convertToCellCoord(r),E=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let F=P;F<=E;F++)for(let U=A;U<=D;U++){const Z=this.d*U+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(U),this._convertFromCellCoord(F+1),this._convertFromCellCoord(U+1)))&&f.call(this,t,r,o,u,Z,m,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(r+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=r;for(let m=0;m<t.length;m++){const _=t[m];u[3+m]=f,u.set(_,f),f+=_.length}return u[3+t.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+t.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new xo(t.buffer)}}const vn={};function yt(i,t,r={}){if(vn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),vn[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}yt("Object",Object),yt("TransferableGridIndex",xo),yt("Color",bi),yt("Error",Error),yt("AJAXError",Ci),yt("ResolvedImage",on),yt("StylePropertyFunction",_o),yt("StyleExpression",cl,{omit:["_evaluator"]}),yt("ZoomDependentExpression",go),yt("ZoomConstantExpression",mo),yt("CompoundExpression",_n,{omit:["_evaluate"]});for(const i in lo)lo[i]._classRegistryKey||yt(`Expression_${i}`,lo[i]);function vl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Tu(i){return i.$name||i.constructor._classRegistryKey}function hf(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=Tu(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||vl(i)||ft(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function bo(i,t){if(hf(i))return(vl(i)||ft(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(bo(m,t));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Tu(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!vn[r])throw new Error(`${r} is not registered.`);const{klass:o}=vn[r],u=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||vn[r].omit.indexOf(f)>=0)continue;const m=i[f];u[f]=vn[r].shallow.indexOf(f)>=0?m:bo(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(u.$name=r),u}function wo(i){if(hf(i))return i;if(Array.isArray(i))return i.map(wo);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Tu(i)||"Object";if(!vn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=vn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const f=i[u];o[u]=vn[t].shallow.indexOf(u)>=0?f:wo(f)}return o}class Pu{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const ai={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Iu(i){for(const t of i)if(Au(t.charCodeAt(0)))return!0;return!1}function f_(i){for(const t of i)if(!So(t.charCodeAt(0)))return!1;return!0}function Cu(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const m_=Cu(["Arab","Dupl","Mong","Ougr","Syrc"]);function So(i){return!m_.test(String.fromCodePoint(i))}const df=Cu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Au(i){return!(i!==746&&i!==747&&(i<4352||!(ai["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ai["CJK Compatibility"](i)||ai["CJK Strokes"](i)||!(!ai["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ai["Enclosed CJK Letters and Months"](i)||ai["Ideographic Description Characters"](i)||ai.Kanbun(i)||ai.Katakana(i)&&i!==12540||!(!ai["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ai["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ai["Vertical Forms"](i)||ai["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||df.test(String.fromCodePoint(i)))))}function pf(i){return!(Au(i)||function(t){return!!(ai["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ai["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ai["Letterlike Symbols"](t)||ai["Number Forms"](t)||ai["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ai["Control Pictures"](t)&&t!==9251||ai["Optical Character Recognition"](t)||ai["Enclosed Alphanumerics"](t)||ai["Geometric Shapes"](t)||ai["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ai["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ai["CJK Symbols and Punctuation"](t)||ai.Katakana(t)||ai["Private Use Area"](t)||ai["CJK Compatibility Forms"](t)||ai["Small Form Variants"](t)||ai["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const g_=Cu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ku(i){return g_.test(String.fromCodePoint(i))}function __(i,t){return!(!t&&ku(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ai.Khmer(i))}function y_(i){for(const t of i)if(ku(t.charCodeAt(0)))return!0;return!1}const ln=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Di{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Pu,this.transition={})}isSupportedScript(t){return function(r,o){for(const u of r)if(!__(u.charCodeAt(0),o))return!1;return!0}(t,ln.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class To{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,u){if(al(o))return new _o(o,u);if(ul(o)){const f=uu(o,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=o;return u.type==="color"&&typeof o=="string"?f=bi.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(f=gn.parse(o)):f=sn.parse(o),{kind:"constant",evaluate:()=>f}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class xl{constructor(t){this.property=t,this.value=new To(t,void 0)}transitioned(t,r){return new ff(this.property,this.value,r,tt({},t.transition,this.transition),t.now)}untransitioned(){return new ff(this.property,this.value,null,{},0)}}class bl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Re(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xl(this._values[t].property)),this._values[t].value=new To(this._values[t].property,r===null?void 0:Re(r))}getTransition(t){return Re(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new xl(this._values[t].property)),this._values[t].transition=Re(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const u=this.getTransition(r);u!==void 0&&(t[`${r}-transition`]=u)}return t}transitioned(t,r){const o=new wa(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,r._values[u]);return o}untransitioned(){const t=new wa(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class ff{constructor(t,r,o,u,f){this.property=t,this.value=r,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const u=t.now||0,f=this.value.possiblyEvaluate(t,r,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(t,r,o);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,o),f,function(x){if(x<=0)return 0;if(x>=1)return 1;const P=x*x,A=P*x;return 4*(x<.5?A:3*(x-P)+A-.75)}(_))}}return f}}class wa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const u=new Ta(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,r,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Sa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Re(this._values[t].value)}setValue(t,r){this._values[t]=new To(this._values[t].property,r===null?void 0:Re(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const u=new Ta(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,r,o);return u}}class Xn{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,u){return this.property.evaluate(this.value,this.parameters,t,r,o,u)}}class Ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class xt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const u=Gr[this.specification.type];return u?u(t,r,o):t}}class Ft{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,u){return new Xn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,u)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Xn(this,{kind:"constant",value:void 0},t.parameters);const u=Gr[this.specification.type];if(u){const f=u(t.value.value,r.value.value,o);return new Xn(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,r,o,u,f,m){return t.kind==="constant"?t.value:t.evaluate(r,o,u,f,m)}}class wl extends Ft{possiblyEvaluate(t,r,o,u){if(t.value===void 0)return new Xn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,_=this._calculate(m,m,m,r);return new Xn(this,{kind:"constant",value:_},r)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Xn(this,{kind:"constant",value:f},r)}return new Xn(this,t.expression,r)}evaluate(t,r,o,u,f,m){if(t.kind==="source"){const _=t.evaluate(r,o,u,f,m);return this._calculate(_,_,_,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,u),t.evaluate({zoom:Math.floor(r.zoom)},o,u),t.evaluate({zoom:Math.floor(r.zoom)+1},o,u),r):t.value}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Sl{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},o,u);return this._calculate(f,f,f,r)}return this._calculate(t.expression.evaluate(new Di(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Di(Math.floor(r.zoom),r)),t.expression.evaluate(new Di(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Eu{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,u){return!!t.expression.evaluate(r,null,{},o,u)}interpolate(){return!1}}class p{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new To(o,void 0),f=this.defaultTransitionablePropertyValues[r]=new xl(o);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate({})}}}yt("DataDrivenProperty",Ft),yt("DataConstantProperty",xt),yt("CrossFadedDataDrivenProperty",wl),yt("CrossFadedProperty",Sl),yt("ColorRampProperty",Eu);const e="-transition";class n extends Ot{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new Sa(r.layout)),r.paint)){this._transitionablePaint=new bl(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ta(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,o={}){r!=null&&this._validate(uf,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(cf,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[t],f=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),_=u.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),nt(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,u,f={}){return(!f||f.validate!==!1)&&Su(this,t.call(js,{key:r,layerType:this.type,objectKey:o,value:u,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Xn&&ho(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function y(i,t=1){let r=0,o=0;return{members:i.map(u=>{const f=a[u.type].BYTES_PER_ELEMENT,m=r=b(r,Math.max(t,f)),_=u.components||1;return o=Math.max(o,f),r+=f*_,{name:u.name,type:u.type,components:_,offset:m}}),size:b(r,Math.max(o,t)),alignment:t}}function b(i,t){return Math.ceil(i/t)*t}class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.int16[u+0]=r,this.int16[u+1]=o,t}}S.prototype.bytesPerElement=4,yt("StructArrayLayout2i4",S);class k extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.int16[f+0]=r,this.int16[f+1]=o,this.int16[f+2]=u,t}}k.prototype.bytesPerElement=6,yt("StructArrayLayout3i6",k);class M extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o,u)}emplace(t,r,o,u,f){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=f,t}}M.prototype.bytesPerElement=8,yt("StructArrayLayout4i8",M);class z extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=_,t}}z.prototype.bytesPerElement=12,yt("StructArrayLayout2i4i12",z);class B extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const x=4*t,P=8*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.uint8[P+4]=u,this.uint8[P+5]=f,this.uint8[P+6]=m,this.uint8[P+7]=_,t}}B.prototype.bytesPerElement=8,yt("StructArrayLayout2i4ub8",B);class G extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.float32[u+0]=r,this.float32[u+1]=o,t}}G.prototype.bytesPerElement=8,yt("StructArrayLayout2f8",G);class H extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,x,P,A){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,o,u,f,m,_,x,P,A)}emplace(t,r,o,u,f,m,_,x,P,A,E){const D=10*t;return this.uint16[D+0]=r,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=_,this.uint16[D+6]=x,this.uint16[D+7]=P,this.uint16[D+8]=A,this.uint16[D+9]=E,t}}H.prototype.bytesPerElement=20,yt("StructArrayLayout10ui20",H);class Q extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,x,P,A,E,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,o,u,f,m,_,x,P,A,E,D)}emplace(t,r,o,u,f,m,_,x,P,A,E,D,F){const U=12*t;return this.int16[U+0]=r,this.int16[U+1]=o,this.int16[U+2]=u,this.int16[U+3]=f,this.uint16[U+4]=m,this.uint16[U+5]=_,this.uint16[U+6]=x,this.uint16[U+7]=P,this.int16[U+8]=A,this.int16[U+9]=E,this.int16[U+10]=D,this.int16[U+11]=F,t}}Q.prototype.bytesPerElement=24,yt("StructArrayLayout4i4ui4i24",Q);class ne extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.float32[f+0]=r,this.float32[f+1]=o,this.float32[f+2]=u,t}}ne.prototype.bytesPerElement=12,yt("StructArrayLayout3f12",ne);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}oe.prototype.bytesPerElement=4,yt("StructArrayLayout1ul4",oe);class ce extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,x,P){const A=this.length;return this.resize(A+1),this.emplace(A,t,r,o,u,f,m,_,x,P)}emplace(t,r,o,u,f,m,_,x,P,A){const E=10*t,D=5*t;return this.int16[E+0]=r,this.int16[E+1]=o,this.int16[E+2]=u,this.int16[E+3]=f,this.int16[E+4]=m,this.int16[E+5]=_,this.uint32[D+3]=x,this.uint16[E+8]=P,this.uint16[E+9]=A,t}}ce.prototype.bytesPerElement=20,yt("StructArrayLayout6i1ul2ui20",ce);class $ extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=_,t}}$.prototype.bytesPerElement=12,yt("StructArrayLayout2i2i2i12",$);class de extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,o,u,f)}emplace(t,r,o,u,f,m){const _=4*t,x=8*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=u,this.int16[x+6]=f,this.int16[x+7]=m,t}}de.prototype.bytesPerElement=16,yt("StructArrayLayout2f1f2i16",de);class me extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,u,f,m)}emplace(t,r,o,u,f,m,_){const x=16*t,P=4*t,A=8*t;return this.uint8[x+0]=r,this.uint8[x+1]=o,this.float32[P+1]=u,this.float32[P+2]=f,this.int16[A+6]=m,this.int16[A+7]=_,t}}me.prototype.bytesPerElement=16,yt("StructArrayLayout2ub2f2i16",me);class we extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.uint16[f+0]=r,this.uint16[f+1]=o,this.uint16[f+2]=u,t}}we.prototype.bytesPerElement=6,yt("StructArrayLayout3ui6",we);class Oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re){const xe=this.length;return this.resize(xe+1),this.emplace(xe,t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re)}emplace(t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re,xe){const ue=24*t,_e=12*t,Ce=48*t;return this.int16[ue+0]=r,this.int16[ue+1]=o,this.uint16[ue+2]=u,this.uint16[ue+3]=f,this.uint32[_e+2]=m,this.uint32[_e+3]=_,this.uint32[_e+4]=x,this.uint16[ue+10]=P,this.uint16[ue+11]=A,this.uint16[ue+12]=E,this.float32[_e+7]=D,this.float32[_e+8]=F,this.uint8[Ce+36]=U,this.uint8[Ce+37]=Z,this.uint8[Ce+38]=J,this.uint32[_e+10]=re,this.int16[ue+22]=xe,t}}Oe.prototype.bytesPerElement=48,yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Oe);class He extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re,xe,ue,_e,Ce,Ue,pt,Rt,ct,ot,St,vt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re,xe,ue,_e,Ce,Ue,pt,Rt,ct,ot,St,vt)}emplace(t,r,o,u,f,m,_,x,P,A,E,D,F,U,Z,J,re,xe,ue,_e,Ce,Ue,pt,Rt,ct,ot,St,vt,_t){const ze=32*t,It=16*t;return this.int16[ze+0]=r,this.int16[ze+1]=o,this.int16[ze+2]=u,this.int16[ze+3]=f,this.int16[ze+4]=m,this.int16[ze+5]=_,this.int16[ze+6]=x,this.int16[ze+7]=P,this.uint16[ze+8]=A,this.uint16[ze+9]=E,this.uint16[ze+10]=D,this.uint16[ze+11]=F,this.uint16[ze+12]=U,this.uint16[ze+13]=Z,this.uint16[ze+14]=J,this.uint16[ze+15]=re,this.uint16[ze+16]=xe,this.uint16[ze+17]=ue,this.uint16[ze+18]=_e,this.uint16[ze+19]=Ce,this.uint16[ze+20]=Ue,this.uint16[ze+21]=pt,this.uint16[ze+22]=Rt,this.uint32[It+12]=ct,this.float32[It+13]=ot,this.float32[It+14]=St,this.uint16[ze+30]=vt,this.uint16[ze+31]=_t,t}}He.prototype.bytesPerElement=64,yt("StructArrayLayout8i15ui1ul2f2ui64",He);class lt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}lt.prototype.bytesPerElement=4,yt("StructArrayLayout1f4",lt);class gt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=3*t;return this.uint16[6*t+0]=r,this.float32[f+1]=o,this.float32[f+2]=u,t}}gt.prototype.bytesPerElement=12,yt("StructArrayLayout1ui2f12",gt);class it extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,r,o)}emplace(t,r,o,u){const f=4*t;return this.uint32[2*t+0]=r,this.uint16[f+2]=o,this.uint16[f+3]=u,t}}it.prototype.bytesPerElement=8,yt("StructArrayLayout1ul2ui8",it);class et extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const u=2*t;return this.uint16[u+0]=r,this.uint16[u+1]=o,t}}et.prototype.bytesPerElement=4,yt("StructArrayLayout2ui4",et);class bt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}bt.prototype.bytesPerElement=2,yt("StructArrayLayout1ui2",bt);class Gt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o,u)}emplace(t,r,o,u,f){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=f,t}}Gt.prototype.bytesPerElement=16,yt("StructArrayLayout4f16",Gt);class st extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new N(this.anchorPointX,this.anchorPointY)}}st.prototype.size=20;class ht extends ce{get(t){return new st(this,t)}}yt("CollisionBoxArray",ht);class Ut extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ut.prototype.size=48;class Li extends Oe{get(t){return new Ut(this,t)}}yt("PlacedSymbolArray",Li);class Xt extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Xt.prototype.size=64;class si extends He{get(t){return new Xt(this,t)}}yt("SymbolInstanceArray",si);class Ri extends lt{getoffsetX(t){return this.float32[1*t+0]}}yt("GlyphOffsetArray",Ri);class Pr extends k{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}yt("SymbolLineVertexArray",Pr);class zn extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}zn.prototype.size=12;class Oi extends gt{get(t){return new zn(this,t)}}yt("TextAnchorOffsetArray",Oi);class Hr extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Hr.prototype.size=8;class Rr extends it{get(t){return new Hr(this,t)}}yt("FeatureIndexArray",Rr);class Ir extends S{}class Or extends S{}class Kn extends S{}class Po extends z{}class Tl extends B{}class Io extends G{}class xn extends H{}class Pl extends Q{}class Mu extends ne{}class bn extends oe{}class wn extends ${}class fs extends me{}class Dn extends we{}class vr extends et{}const Cr=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:cn}=Cr;class li{constructor(t=[]){this.segments=t}prepareSegment(t,r,o,u){let f=this.segments[this.segments.length-1];return t>li.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>li.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:r.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,u){return new li([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Us(i,t){return 256*(i=Le(Math.floor(i),0,255))+Le(Math.floor(t),0,255)}li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yt("SegmentVector",li);const Co=y([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ao={exports:{}},mf={exports:{}};mf.exports=function(i,t){var r,o,u,f,m,_,x,P;for(o=i.length-(r=3&i.length),u=t,m=3432918353,_=461845907,P=0;P<o;)x=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&i.charCodeAt(P+2))<<16;case 2:x^=(255&i.charCodeAt(P+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(P)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var v_=mf.exports,gf={exports:{}};gf.exports=function(i,t){for(var r,o=i.length,u=t^o,f=0;o>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),o-=4,++f;switch(o){case 3:u^=(255&i.charCodeAt(f+2))<<16;case 2:u^=(255&i.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var ms=v_,_f=gf.exports;Ao.exports=ms,Ao.exports.murmur3=ms,Ao.exports.murmur2=_f;var Il=j(Ao.exports);class Pa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,u){this.ids.push(Cl(t)),this.positions.push(r,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Cl(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=r?u=m:o=m+1}const f=[];for(;this.ids[o]===r;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(t,r){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Al(o,u,0,o.length-1),r&&r.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const r=new Pa;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Cl(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Il(String(i))}function Al(i,t,r,o){for(;r<o;){const u=i[r+o>>1];let f=r-1,m=o+1;for(;;){do f++;while(i[f]<u);do m--;while(i[m]>u);if(f>=m)break;ko(i,f,m),ko(t,3*f,3*m),ko(t,3*f+1,3*m+1),ko(t,3*f+2,3*m+2)}m-r<o-m?(Al(i,t,r,m),r=m+1):(Al(i,t,m+1,o),o=m)}}function ko(i,t,r){const o=i[t];i[t]=i[r],i[r]=o}yt("FeaturePositionMap",Pa);class Ia{constructor(t,r){this.gl=t.gl,this.location=r}}class yf extends Ia{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class mv extends Ia{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class gv extends Ia{constructor(t,r){super(t,r),this.current=bi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Tw=new Float32Array(16);function x_(i){return[Us(255*i.r,255*i.g),Us(255*i.b,255*i.a)]}class zu{constructor(t,r,o){this.value=t,this.uniformNames=r.map(u=>`u_${u}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new gv(t,r):new yf(t,r)}}class kl{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,u){const f=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new mv(t,r):new yf(t,r)}}class qs{constructor(t,r,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,r,o,u,f){const m=this.paintVertexArray.length,_=this.expression.evaluate(new Di(0),r,{},u,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,_)}updatePaintArray(t,r,o,u){const f=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,r,f)}_setPaintValue(t,r,o){if(this.type==="color"){const u=x_(o);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=t;u<r;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(t,r,o,u,f,m){this.expression=t,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,o,u,f){const m=this.expression.evaluate(new Di(this.zoom),r,{},u,[],f),_=this.expression.evaluate(new Di(this.zoom+1),r,{},u,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,_)}updatePaintArray(t,r,o,u){const f=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,r,f,m)}_setPaintValue(t,r,o,u){if(this.type==="color"){const f=x_(o),m=x_(u);for(let _=t;_<r;_++)this.paintVertexArray.emplace(_,f[0],f[1],m[0],m[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,u=Le(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,r,o){return new yf(t,r)}}class Eo{constructor(t,r,o,u,f,m){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,r,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,u,f){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(t,r,o,u){if(!u||!o)return;const{min:f,mid:m,max:_}=o,x=u[f],P=u[m],A=u[_];if(x&&P&&A)for(let E=t;E<r;E++)this.zoomInPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],P.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],P.pixelRatio,A.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Co.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Co.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _v{constructor(t,r,o){this.binders={},this._buffers=[];const u=[];for(const f in t.paint._values){if(!o(f))continue;const m=t.paint.get(f);if(!(m instanceof Xn&&ho(m.property.specification)))continue;const _=Pw(f,t.type),x=m.value,P=m.property.specification.type,A=m.property.useIntegerZoom,E=m.property.specification["property-type"],D=E==="cross-faded"||E==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new kl(x.value,_):new zu(x.value,_,P),u.push(`/u_${f}`);else if(x.kind==="source"||D){const F=yv(f,P,"source");this.binders[f]=D?new Eo(x,P,A,r,F,t.id):new qs(x,_,P,F),u.push(`/a_${f}`)}else{const F=yv(f,P,"composite");this.binders[f]=new is(x,_,P,A,r,F),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof qs||r instanceof is?r.maxValue:0}populatePaintArrays(t,r,o,u,f){for(const m in this.binders){const _=this.binders[m];(_ instanceof qs||_ instanceof is||_ instanceof Eo)&&_.populatePaintArray(t,r,o,u,f)}}setConstantPatternPositions(t,r){for(const o in this.binders){const u=this.binders[o];u instanceof kl&&u.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,u,f){let m=!1;for(const _ in t){const x=r.getPositions(_);for(const P of x){const A=o.feature(P.index);for(const E in this.binders){const D=this.binders[E];if((D instanceof qs||D instanceof is||D instanceof Eo)&&D.expression.isStateDependent===!0){const F=u.paint.get(E);D.expression=F.value,D.updatePaintArray(P.start,P.end,A,t[_],f),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof zu||o instanceof kl)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof qs||o instanceof is)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Eo)for(let u=0;u<Co.members.length;u++)t.push(Co.members[u].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof zu||o instanceof kl||o instanceof is)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof zu||f instanceof kl||f instanceof is){for(const m of f.uniformNames)if(r[m]){const _=f.getBinding(t,r[m],m);o.push({name:m,property:u,binding:_})}}}return o}setUniforms(t,r,o,u){for(const{name:f,property:m,binding:_}of r)this.binders[m].setUniform(_,u,o.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof Eo){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof qs||o instanceof is)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof qs||o instanceof is||o instanceof Eo)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof qs||r instanceof is||r instanceof Eo)&&r.destroy()}}}class Ca{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new _v(u,r,o);this.needsUpload=!1,this._featureMap=new Pa,this._bufferOffset=0}populatePaintArrays(t,r,o,u,f,m){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,r,u,f,m);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,r,f,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Pw(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function yv(i,t,r){const o={color:{source:G,composite:Gt},number:{source:lt,composite:G}},u=function(f){return{"line-pattern":{source:xn,composite:xn},"fill-pattern":{source:xn,composite:xn},"fill-extrusion-pattern":{source:xn,composite:xn}}[f]}(i);return u&&u[r]||o[t][r]}yt("ConstantBinder",zu),yt("CrossFadedConstantBinder",kl),yt("SourceExpressionBinder",qs),yt("CrossFadedCompositeBinder",Eo),yt("CompositeExpressionBinder",is),yt("ProgramConfiguration",_v,{omit:["_buffers"]}),yt("ProgramConfigurationSet",Ca);const or=8192,b_=Math.pow(2,14)-1,vv=-b_-1;function Aa(i){const t=or/i.extent,r=i.loadGeometry();for(let o=0;o<r.length;o++){const u=r[o];for(let f=0;f<u.length;f++){const m=u[f],_=Math.round(m.x*t),x=Math.round(m.y*t);m.x=Le(_,vv,b_),m.y=Le(x,vv,b_),(_<m.x||_>m.x+1||x<m.y||x>m.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function ka(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Aa(i):[]}}function vf(i,t,r,o,u){i.emplaceBack(2*t+(o+1)/2,2*r+(u+1)/2)}class w_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Or,this.indexArray=new Dn,this.segments=new li,this.programConfigurations=new Ca(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const u=this.layers[0],f=[];let m=null,_=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),_=!m.isConstant());for(const{feature:x,id:P,index:A,sourceLayerIndex:E}of t){const D=this.layers[0]._featureFilter.needGeometry,F=ka(x,D);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),F,o))continue;const U=_?m.evaluate(F,{},o):void 0,Z={id:P,properties:x.properties,type:x.type,sourceLayerIndex:E,index:A,geometry:D?F.geometry:Aa(x),patterns:{},sortKey:U};f.push(Z)}_&&f.sort((x,P)=>x.sortKey-P.sortKey);for(const x of f){const{geometry:P,index:A,sourceLayerIndex:E}=x,D=t[A].feature;this.addFeature(x,P,A,o),r.featureIndex.insert(D,P,A,E,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,u){for(const f of r)for(const m of f){const _=m.x,x=m.y;if(_<0||_>=or||x<0||x>=or)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),A=P.vertexLength;vf(this.layoutVertexArray,_,x,-1,-1),vf(this.layoutVertexArray,_,x,1,-1),vf(this.layoutVertexArray,_,x,1,1),vf(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+3,A+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function xv(i,t){for(let r=0;r<i.length;r++)if(El(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(El(i,t[r]))return!0;return!!S_(i,t)}function Iw(i,t,r){return!!El(i,t)||!!T_(t,i,r)}function bv(i,t){if(i.length===1)return Sv(t,i[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let u=0;u<o.length;u++)if(El(i,o[u]))return!0}for(let r=0;r<i.length;r++)if(Sv(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(S_(i,t[r]))return!0;return!1}function Cw(i,t,r){if(i.length>1){if(S_(i,t))return!0;for(let o=0;o<t.length;o++)if(T_(t[o],i,r))return!0}for(let o=0;o<i.length;o++)if(T_(i[o],t,r))return!0;return!1}function S_(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],u=i[r+1];for(let f=0;f<t.length-1;f++)if(Aw(o,u,t[f],t[f+1]))return!0}return!1}function Aw(i,t,r,o){return Ae(i,r,o)!==Ae(t,r,o)&&Ae(i,t,r)!==Ae(i,t,o)}function T_(i,t,r){const o=r*r;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(wv(i,t[u-1],t[u])<o)return!0;return!1}function wv(i,t,r){const o=t.distSqr(r);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/o;return i.distSqr(u<0?t:u>1?r:r.sub(t)._mult(u)._add(t))}function Sv(i,t){let r,o,u,f=!1;for(let m=0;m<i.length;m++){r=i[m];for(let _=0,x=r.length-1;_<r.length;x=_++)o=r[_],u=r[x],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function El(i,t){let r=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const f=i[o],m=i[u];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function kw(i,t,r){const o=r[0],u=r[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const f=Ae(i,t,r[0]);return f!==Ae(i,t,r[1])||f!==Ae(i,t,r[2])||f!==Ae(i,t,r[3])}function Du(i,t,r){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(i)}function xf(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function bf(i,t,r,o,u){if(!t[0]&&!t[1])return i;const f=N.convert(t)._mult(u);r==="viewport"&&f._rotate(-o);const m=[];for(let _=0;_<i.length;_++)m.push(i[_].sub(f));return m}let Tv,Pv;yt("CircleBucket",w_,{omit:["layers"]});var Ew={get paint(){return Pv=Pv||new p({"circle-radius":new Ft(ye.paint_circle["circle-radius"]),"circle-color":new Ft(ye.paint_circle["circle-color"]),"circle-blur":new Ft(ye.paint_circle["circle-blur"]),"circle-opacity":new Ft(ye.paint_circle["circle-opacity"]),"circle-translate":new xt(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new xt(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xt(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xt(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(ye.paint_circle["circle-stroke-opacity"])})},get layout(){return Tv=Tv||new p({"circle-sort-key":new Ft(ye.layout_circle["circle-sort-key"])})}},Xr=1e-6,Ml=typeof Float32Array<"u"?Float32Array:Array;function P_(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Iv(i,t,r){var o=t[0],u=t[1],f=t[2],m=t[3],_=t[4],x=t[5],P=t[6],A=t[7],E=t[8],D=t[9],F=t[10],U=t[11],Z=t[12],J=t[13],re=t[14],xe=t[15],ue=r[0],_e=r[1],Ce=r[2],Ue=r[3];return i[0]=ue*o+_e*_+Ce*E+Ue*Z,i[1]=ue*u+_e*x+Ce*D+Ue*J,i[2]=ue*f+_e*P+Ce*F+Ue*re,i[3]=ue*m+_e*A+Ce*U+Ue*xe,i[4]=(ue=r[4])*o+(_e=r[5])*_+(Ce=r[6])*E+(Ue=r[7])*Z,i[5]=ue*u+_e*x+Ce*D+Ue*J,i[6]=ue*f+_e*P+Ce*F+Ue*re,i[7]=ue*m+_e*A+Ce*U+Ue*xe,i[8]=(ue=r[8])*o+(_e=r[9])*_+(Ce=r[10])*E+(Ue=r[11])*Z,i[9]=ue*u+_e*x+Ce*D+Ue*J,i[10]=ue*f+_e*P+Ce*F+Ue*re,i[11]=ue*m+_e*A+Ce*U+Ue*xe,i[12]=(ue=r[12])*o+(_e=r[13])*_+(Ce=r[14])*E+(Ue=r[15])*Z,i[13]=ue*u+_e*x+Ce*D+Ue*J,i[14]=ue*f+_e*P+Ce*F+Ue*re,i[15]=ue*m+_e*A+Ce*U+Ue*xe,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Lu,Mw=Iv;function wf(i,t,r){var o=t[0],u=t[1],f=t[2],m=t[3];return i[0]=r[0]*o+r[4]*u+r[8]*f+r[12]*m,i[1]=r[1]*o+r[5]*u+r[9]*f+r[13]*m,i[2]=r[2]*o+r[6]*u+r[10]*f+r[14]*m,i[3]=r[3]*o+r[7]*u+r[11]*f+r[15]*m,i}Lu=new Ml(4),Ml!=Float32Array&&(Lu[0]=0,Lu[1]=0,Lu[2]=0,Lu[3]=0);class zw extends n{constructor(t){super(t,Ew)}createBucket(t){return new w_(t)}queryRadius(t){const r=t;return Du("circle-radius",this,r)+Du("circle-stroke-width",this,r)+xf(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,o,u,f,m,_,x){const P=bf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,_),A=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),E=this.paint.get("circle-pitch-alignment")==="map",D=E?P:function(U,Z){return U.map(J=>Cv(J,Z))}(P,x),F=E?A*_:A;for(const U of u)for(const Z of U){const J=E?Z:Cv(Z,x);let re=F;const xe=wf([],[Z.x,Z.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?re*=xe[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(re*=m.cameraToCenterDistance/xe[3]),Iw(D,J,re))return!0}return!1}}function Cv(i,t){const r=wf([],[i.x,i.y,0,1],t);return new N(r[0]/r[3],r[1]/r[3])}class Av extends w_{}let kv;yt("HeatmapBucket",Av,{omit:["layers"]});var Dw={get paint(){return kv=kv||new p({"heatmap-radius":new Ft(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xt(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eu(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xt(ye.paint_heatmap["heatmap-opacity"])})}};function I_(i,{width:t,height:r},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*r*o}`)}else u=new Uint8Array(t*r*o);return i.width=t,i.height=r,i.data=u,i}function Ev(i,{width:t,height:r},o){if(t===i.width&&r===i.height)return;const u=I_({},{width:t,height:r},o);C_(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},o),i.width=t,i.height=r,i.data=u.data}function C_(i,t,r,o,u,f){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||r.x>i.width-u.width||r.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,_=t.data;if(m===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const P=((r.y+x)*i.width+r.x)*f,A=((o.y+x)*t.width+o.x)*f;for(let E=0;E<u.width*f;E++)_[A+E]=m[P+E]}return t}class Ru{constructor(t,r){I_(this,t,1,r)}resize(t){Ev(this,t,1)}clone(){return new Ru({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,f){C_(t,r,o,u,f,1)}}class Ln{constructor(t,r){I_(this,t,4,r)}resize(t){Ev(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ln({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,u,f){C_(t,r,o,u,f,4)}}function Mv(i){const t={},r=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new Ln({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,_,x)=>{t[i.evaluationKey]=x;const P=i.expression.evaluate(t);u.data[m+_+0]=Math.floor(255*P.r/P.a),u.data[m+_+1]=Math.floor(255*P.g/P.a),u.data[m+_+2]=Math.floor(255*P.b/P.a),u.data[m+_+3]=Math.floor(255*P.a)};if(i.clips)for(let m=0,_=0;m<o;++m,_+=4*r)for(let x=0,P=0;x<r;x++,P+=4){const A=x/(r-1),{start:E,end:D}=i.clips[m];f(_,P,E*(1-A)+D*A)}else for(let m=0,_=0;m<r;m++,_+=4)f(0,_,m/(r-1));return u}yt("AlphaImage",Ru),yt("RGBAImage",Ln);const A_="big-fb";class Lw extends n{createBucket(t){return new Av(t)}constructor(t){super(t,Dw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(A_)&&this.heatmapFbos.delete(A_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let zv;var Rw={get paint(){return zv=zv||new p({"hillshade-illumination-direction":new xt(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xt(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xt(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xt(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xt(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xt(ye.paint_hillshade["hillshade-accent-color"])})}};class Ow extends n{constructor(t){super(t,Rw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Fw=y([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bw}=Fw;function Dv(i,t,r=2){const o=t&&t.length,u=o?t[0]*r:i.length;let f=Lv(i,0,u,r,!0);const m=[];if(!f||f.next===f.prev)return m;let _,x,P;if(o&&(f=function(A,E,D,F){const U=[];for(let Z=0,J=E.length;Z<J;Z++){const re=Lv(A,E[Z]*F,Z<J-1?E[Z+1]*F:A.length,F,!1);re===re.next&&(re.steiner=!0),U.push(Ww(re))}U.sort(qw);for(let Z=0;Z<U.length;Z++)D=Zw(U[Z],D);return D}(i,t,f,r)),i.length>80*r){_=1/0,x=1/0;let A=-1/0,E=-1/0;for(let D=r;D<u;D+=r){const F=i[D],U=i[D+1];F<_&&(_=F),U<x&&(x=U),F>A&&(A=F),U>E&&(E=U)}P=Math.max(A-_,E-x),P=P!==0?32767/P:0}return Ou(f,m,r,_,x,P,0),m}function Lv(i,t,r,o,u){let f;if(u===function(m,_,x,P){let A=0;for(let E=_,D=x-P;E<x;E+=P)A+=(m[D]-m[E])*(m[E+1]+m[D+1]),D=E;return A}(i,t,r,o)>0)for(let m=t;m<r;m+=o)f=Fv(m/o|0,i[m],i[m+1],f);else for(let m=r-o;m>=t;m-=o)f=Fv(m/o|0,i[m],i[m+1],f);return f&&Sf(f,f.next)&&(Bu(f),f=f.next),f}function Ea(i,t){if(!i)return i;t||(t=i);let r,o=i;do if(r=!1,o.steiner||!Sf(o,o.next)&&ir(o.prev,o,o.next)!==0)o=o.next;else{if(Bu(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function Ou(i,t,r,o,u,f,m){if(!i)return;!m&&f&&function(x,P,A,E){let D=x;do D.z===0&&(D.z=k_(D.x,D.y,P,A,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(F){let U,Z=1;do{let J,re=F;F=null;let xe=null;for(U=0;re;){U++;let ue=re,_e=0;for(let Ue=0;Ue<Z&&(_e++,ue=ue.nextZ,ue);Ue++);let Ce=Z;for(;_e>0||Ce>0&&ue;)_e!==0&&(Ce===0||!ue||re.z<=ue.z)?(J=re,re=re.nextZ,_e--):(J=ue,ue=ue.nextZ,Ce--),xe?xe.nextZ=J:F=J,J.prevZ=xe,xe=J;re=ue}xe.nextZ=null,Z*=2}while(U>1)}(D)}(i,o,u,f);let _=i;for(;i.prev!==i.next;){const x=i.prev,P=i.next;if(f?Vw(i,o,u,f):Nw(i))t.push(x.i,i.i,P.i),Bu(i),i=P.next,_=P.next;else if((i=P)===_){m?m===1?Ou(i=jw(Ea(i),t),t,r,o,u,f,2):m===2&&Uw(i,t,r,o,u,f):Ou(Ea(i),t,r,o,u,f,1);break}}}function Nw(i){const t=i.prev,r=i,o=i.next;if(ir(t,r,o)>=0)return!1;const u=t.x,f=r.x,m=o.x,_=t.y,x=r.y,P=o.y,A=u<f?u<m?u:m:f<m?f:m,E=_<x?_<P?_:P:x<P?x:P,D=u>f?u>m?u:m:f>m?f:m,F=_>x?_>P?_:P:x>P?x:P;let U=o.next;for(;U!==t;){if(U.x>=A&&U.x<=D&&U.y>=E&&U.y<=F&&zl(u,_,f,x,m,P,U.x,U.y)&&ir(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Vw(i,t,r,o){const u=i.prev,f=i,m=i.next;if(ir(u,f,m)>=0)return!1;const _=u.x,x=f.x,P=m.x,A=u.y,E=f.y,D=m.y,F=_<x?_<P?_:P:x<P?x:P,U=A<E?A<D?A:D:E<D?E:D,Z=_>x?_>P?_:P:x>P?x:P,J=A>E?A>D?A:D:E>D?E:D,re=k_(F,U,t,r,o),xe=k_(Z,J,t,r,o);let ue=i.prevZ,_e=i.nextZ;for(;ue&&ue.z>=re&&_e&&_e.z<=xe;){if(ue.x>=F&&ue.x<=Z&&ue.y>=U&&ue.y<=J&&ue!==u&&ue!==m&&zl(_,A,x,E,P,D,ue.x,ue.y)&&ir(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,_e.x>=F&&_e.x<=Z&&_e.y>=U&&_e.y<=J&&_e!==u&&_e!==m&&zl(_,A,x,E,P,D,_e.x,_e.y)&&ir(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;ue&&ue.z>=re;){if(ue.x>=F&&ue.x<=Z&&ue.y>=U&&ue.y<=J&&ue!==u&&ue!==m&&zl(_,A,x,E,P,D,ue.x,ue.y)&&ir(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;_e&&_e.z<=xe;){if(_e.x>=F&&_e.x<=Z&&_e.y>=U&&_e.y<=J&&_e!==u&&_e!==m&&zl(_,A,x,E,P,D,_e.x,_e.y)&&ir(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function jw(i,t){let r=i;do{const o=r.prev,u=r.next.next;!Sf(o,u)&&Rv(o,r,r.next,u)&&Fu(o,u)&&Fu(u,o)&&(t.push(o.i,r.i,u.i),Bu(r),Bu(r.next),r=i=u),r=r.next}while(r!==i);return Ea(r)}function Uw(i,t,r,o,u,f){let m=i;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&Hw(m,_)){let x=Ov(m,_);return m=Ea(m,m.next),x=Ea(x,x.next),Ou(m,t,r,o,u,f,0),void Ou(x,t,r,o,u,f,0)}_=_.next}m=m.next}while(m!==i)}function qw(i,t){return i.x-t.x}function Zw(i,t){const r=function(u,f){let m=f;const _=u.x,x=u.y;let P,A=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const Z=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=_&&Z>A&&(A=Z,P=m.x<m.next.x?m:m.next,Z===_))return P}m=m.next}while(m!==f);if(!P)return null;const E=P,D=P.x,F=P.y;let U=1/0;m=P;do{if(_>=m.x&&m.x>=D&&_!==m.x&&zl(x<F?_:A,x,D,F,x<F?A:_,x,m.x,m.y)){const Z=Math.abs(x-m.y)/(_-m.x);Fu(m,u)&&(Z<U||Z===U&&(m.x>P.x||m.x===P.x&&Gw(P,m)))&&(P=m,U=Z)}m=m.next}while(m!==E);return P}(i,t);if(!r)return t;const o=Ov(r,i);return Ea(o,o.next),Ea(r,r.next)}function Gw(i,t){return ir(i.prev,i,t.prev)<0&&ir(t.next,i,i.next)<0}function k_(i,t,r,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ww(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function zl(i,t,r,o,u,f,m,_){return(u-m)*(t-_)>=(i-m)*(f-_)&&(i-m)*(o-_)>=(r-m)*(t-_)&&(r-m)*(f-_)>=(u-m)*(o-_)}function Hw(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,o){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==o.i&&u.next.i!==o.i&&Rv(u,u.next,r,o))return!0;u=u.next}while(u!==r);return!1}(i,t)&&(Fu(i,t)&&Fu(t,i)&&function(r,o){let u=r,f=!1;const m=(r.x+o.x)/2,_=(r.y+o.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(i,t)&&(ir(i.prev,i,t.prev)||ir(i,t.prev,t))||Sf(i,t)&&ir(i.prev,i,i.next)>0&&ir(t.prev,t,t.next)>0)}function ir(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function Sf(i,t){return i.x===t.x&&i.y===t.y}function Rv(i,t,r,o){const u=Pf(ir(i,t,r)),f=Pf(ir(i,t,o)),m=Pf(ir(r,o,i)),_=Pf(ir(r,o,t));return u!==f&&m!==_||!(u!==0||!Tf(i,r,t))||!(f!==0||!Tf(i,o,t))||!(m!==0||!Tf(r,i,o))||!(_!==0||!Tf(r,t,o))}function Tf(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Pf(i){return i>0?1:i<0?-1:0}function Fu(i,t){return ir(i.prev,i,i.next)<0?ir(i,t,i.next)>=0&&ir(i,i.prev,t)>=0:ir(i,t,i.prev)<0||ir(i,i.next,t)<0}function Ov(i,t){const r=E_(i.i,i.x,i.y),o=E_(t.i,t.x,t.y),u=i.next,f=t.prev;return i.next=t,t.prev=i,r.next=u,u.prev=r,o.next=r,r.prev=o,f.next=o,o.prev=f,o}function Fv(i,t,r,o){const u=E_(i,t,r);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Bu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function E_(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function M_(i,t,r){const o=r.patternDependencies;let u=!1;for(const f of t){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const _=m.constantOr(null);_&&(u=!0,o[_.to]=!0,o[_.from]=!0)}return u}function z_(i,t,r,o,u){const f=u.patternDependencies;for(const m of t){const _=m.paint.get(`${i}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o-1},r,{},u.availableImages),P=_.evaluate({zoom:o},r,{},u.availableImages),A=_.evaluate({zoom:o+1},r,{},u.availableImages);x=x&&x.name?x.name:x,P=P&&P.name?P.name:P,A=A&&A.name?A.name:A,f[x]=!0,f[P]=!0,f[A]=!0,r.patterns[m.id]={min:x,mid:P,max:A}}}return r}class D_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kn,this.indexArray=new Dn,this.indexArray2=new vr,this.programConfigurations=new Ca(t.layers,t.zoom),this.segments=new li,this.segments2=new li,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=M_("fill",this.layers,r);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:A}of t){const E=this.layers[0]._featureFilter.needGeometry,D=ka(_,E);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o,r.availableImages):void 0,U={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:E?D.geometry:Aa(_),patterns:{},sortKey:F};m.push(U)}f&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const E=z_("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,x,P,o,{});r.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Bw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,u,f){for(const m of il(r,500)){let _=0;for(const F of m)_+=F.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),P=x.vertexLength,A=[],E=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&E.push(A.length/2);const U=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=U.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),A.push(F[0].x),A.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(Z+J-1,Z+J),A.push(F[J].x),A.push(F[J].y);U.vertexLength+=F.length,U.primitiveLength+=F.length}const D=Dv(A,E);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(P+D[F],P+D[F+1],P+D[F+2]);x.vertexLength+=_,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}let Bv,Nv;yt("FillBucket",D_,{omit:["layers","patternFeatures"]});var Xw={get paint(){return Nv=Nv||new p({"fill-antialias":new xt(ye.paint_fill["fill-antialias"]),"fill-opacity":new Ft(ye.paint_fill["fill-opacity"]),"fill-color":new Ft(ye.paint_fill["fill-color"]),"fill-outline-color":new Ft(ye.paint_fill["fill-outline-color"]),"fill-translate":new xt(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new xt(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new wl(ye.paint_fill["fill-pattern"])})},get layout(){return Bv=Bv||new p({"fill-sort-key":new Ft(ye.layout_fill["fill-sort-key"])})}};class Kw extends n{constructor(t){super(t,Xw)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new D_(t)}queryRadius(){return xf(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,o,u,f,m,_){return bv(bf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,_),u)}isTileClipped(){return!0}}const $w=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jw=y([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Yw}=$w;var Mo={},Qw=q,Vv=Dl;function Dl(i,t,r,o,u){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(e1,this,t)}function e1(i,t,r){i==1?t.id=r.readVarint():i==2?function(o,u){for(var f=o.readVarint()+o.pos;o.pos<f;){var m=u._keys[o.readVarint()],_=u._values[o.readVarint()];u.properties[m]=_}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function t1(i){for(var t,r,o=0,u=0,f=i.length,m=f-1;u<f;m=u++)o+=((r=i[m]).x-(t=i[u]).x)*(t.y+r.y);return o}Dl.types=["Unknown","Point","LineString","Polygon"],Dl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,o=1,u=0,f=0,m=0,_=[];i.pos<r;){if(u<=0){var x=i.readVarint();o=7&x,u=x>>3}if(u--,o===1||o===2)f+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&_.push(t),t=[]),t.push(new Qw(f,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&_.push(t),_},Dl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,o=0,u=0,f=0,m=1/0,_=-1/0,x=1/0,P=-1/0;i.pos<t;){if(o<=0){var A=i.readVarint();r=7&A,o=A>>3}if(o--,r===1||r===2)(u+=i.readSVarint())<m&&(m=u),u>_&&(_=u),(f+=i.readSVarint())<x&&(x=f),f>P&&(P=f);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,_,P]},Dl.prototype.toGeoJSON=function(i,t,r){var o,u,f=this.extent*Math.pow(2,r),m=this.extent*i,_=this.extent*t,x=this.loadGeometry(),P=Dl.types[this.type];function A(F){for(var U=0;U<F.length;U++){var Z=F[U];F[U]=[360*(Z.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+_)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(o=0;o<x.length;o++)E[o]=x[o][0];A(x=E);break;case 2:for(o=0;o<x.length;o++)A(x[o]);break;case 3:for(x=function(F){var U=F.length;if(U<=1)return[F];for(var Z,J,re=[],xe=0;xe<U;xe++){var ue=t1(F[xe]);ue!==0&&(J===void 0&&(J=ue<0),J===ue<0?(Z&&re.push(Z),Z=[F[xe]]):Z.push(F[xe]))}return Z&&re.push(Z),re}(x),o=0;o<x.length;o++)for(u=0;u<x[o].length;u++)A(x[o][u])}x.length===1?x=x[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var i1=Vv,jv=Uv;function Uv(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(r1,this,t),this.length=this._features.length}function r1(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(o){for(var u=null,f=o.readVarint()+o.pos;o.pos<f;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(r))}Uv.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new i1(this._pbf,t,this.extent,this._keys,this._values)};var n1=jv;function s1(i,t,r){if(i===3){var o=new n1(r,r.readVarint()+r.pos);o.length&&(t[o.name]=o)}}Mo.VectorTile=function(i,t){this.layers=i.readFields(s1,{},t)},Mo.VectorTileFeature=Vv,Mo.VectorTileLayer=jv;const o1=Mo.VectorTileFeature.types,L_=Math.pow(2,13);function Nu(i,t,r,o,u,f,m,_){i.emplaceBack(t,r,2*Math.floor(o*L_)+m,u*L_*2,f*L_*2,Math.round(_))}class R_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Po,this.centroidVertexArray=new Ir,this.indexArray=new Dn,this.programConfigurations=new Ca(t.layers,t.zoom),this.segments=new li,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=M_("fill-extrusion",this.layers,r);for(const{feature:u,id:f,index:m,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,P=ka(u,x);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),P,o))continue;const A={id:f,sourceLayerIndex:_,index:m,geometry:x?P.geometry:Aa(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(z_("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,m,o,{}),r.featureIndex.insert(u,A.geometry,m,_,this.index,!0)}}addFeatures(t,r,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,r,o)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Yw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Jw.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,u,f){for(const m of il(r,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const U of m)x+=U.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const U of m){if(U.length===0||l1(U))continue;let Z=0;for(let J=0;J<U.length;J++){const re=U[J];if(J>=1){const xe=U[J-1];if(!a1(re,xe)){P.vertexLength+4>li.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=re.sub(xe)._perp()._unit(),_e=xe.dist(re);Z+_e>32768&&(Z=0),Nu(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,0,Z),Nu(this.layoutVertexArray,re.x,re.y,ue.x,ue.y,0,1,Z),_.x+=2*re.x,_.y+=2*re.y,_.vertexCount+=2,Z+=_e,Nu(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,0,Z),Nu(this.layoutVertexArray,xe.x,xe.y,ue.x,ue.y,0,1,Z),_.x+=2*xe.x,_.y+=2*xe.y,_.vertexCount+=2;const Ce=P.vertexLength;this.indexArray.emplaceBack(Ce,Ce+2,Ce+1),this.indexArray.emplaceBack(Ce+1,Ce+2,Ce+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+x>li.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),o1[t.type]!=="Polygon")continue;const A=[],E=[],D=P.vertexLength;for(const U of m)if(U.length!==0){U!==m[0]&&E.push(A.length/2);for(let Z=0;Z<U.length;Z++){const J=U[Z];Nu(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),_.x+=J.x,_.y+=J.y,_.vertexCount+=1,A.push(J.x),A.push(J.y)}}const F=Dv(A,E);for(let U=0;U<F.length;U+=3)this.indexArray.emplaceBack(D+F[U],D+F[U+2],D+F[U+1]);P.primitiveLength+=F.length/3,P.vertexLength+=x;for(let U=0;U<_.vertexCount;U++){const Z=Math.floor(_.x/_.vertexCount),J=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(Z,J)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}function a1(i,t){return i.x===t.x&&(i.x<0||i.x>or)||i.y===t.y&&(i.y<0||i.y>or)}function l1(i){return i.every(t=>t.x<0)||i.every(t=>t.x>or)||i.every(t=>t.y<0)||i.every(t=>t.y>or)}let qv;yt("FillExtrusionBucket",R_,{omit:["layers","features"]});var c1={get paint(){return qv=qv||new p({"fill-extrusion-opacity":new xt(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xt(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xt(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wl(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xt(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class u1 extends n{constructor(t){super(t,c1)}createBucket(t){return new R_(t)}queryRadius(){return xf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,o,u,f,m,_,x){const P=bf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,_),A=this.paint.get("fill-extrusion-height").evaluate(r,o),E=this.paint.get("fill-extrusion-base").evaluate(r,o),D=function(U,Z,J,re){const xe=[];for(const ue of U){const _e=[ue.x,ue.y,0,1];wf(_e,_e,Z),xe.push(new N(_e[0]/_e[3],_e[1]/_e[3]))}return xe}(P,x),F=function(U,Z,J,re){const xe=[],ue=[],_e=re[8]*Z,Ce=re[9]*Z,Ue=re[10]*Z,pt=re[11]*Z,Rt=re[8]*J,ct=re[9]*J,ot=re[10]*J,St=re[11]*J;for(const vt of U){const _t=[],ze=[];for(const It of vt){const wt=It.x,qt=It.y,Ii=re[0]*wt+re[4]*qt+re[12],Ti=re[1]*wt+re[5]*qt+re[13],dr=re[2]*wt+re[6]*qt+re[14],$n=re[3]*wt+re[7]*qt+re[15],kr=dr+Ue,pr=$n+pt,Kr=Ii+Rt,$r=Ti+ct,Jr=dr+ot,Qi=$n+St,fr=new N((Ii+_e)/pr,(Ti+Ce)/pr);fr.z=kr/pr,_t.push(fr);const Fr=new N(Kr/Qi,$r/Qi);Fr.z=Jr/Qi,ze.push(Fr)}xe.push(_t),ue.push(ze)}return[xe,ue]}(u,E,A,x);return function(U,Z,J){let re=1/0;bv(J,Z)&&(re=Zv(J,Z[0]));for(let xe=0;xe<Z.length;xe++){const ue=Z[xe],_e=U[xe];for(let Ce=0;Ce<ue.length-1;Ce++){const Ue=ue[Ce],pt=[Ue,ue[Ce+1],_e[Ce+1],_e[Ce],Ue];xv(J,pt)&&(re=Math.min(re,Zv(J,pt)))}}return re!==1/0&&re}(F[0],F[1],D)}}function Vu(i,t){return i.x*t.x+i.y*t.y}function Zv(i,t){if(i.length===1){let r=0;const o=t[r++];let u;for(;!u||o.equals(u);)if(u=t[r++],!u)return 1/0;for(;r<t.length;r++){const f=t[r],m=i[0],_=u.sub(o),x=f.sub(o),P=m.sub(o),A=Vu(_,_),E=Vu(_,x),D=Vu(x,x),F=Vu(P,_),U=Vu(P,x),Z=A*D-E*E,J=(D*F-E*U)/Z,re=(A*U-E*F)/Z,xe=o.z*(1-J-re)+u.z*J+f.z*re;if(isFinite(xe))return xe}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const h1=y([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:d1}=h1,p1=y([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:f1}=p1,m1=Mo.VectorTileFeature.types,g1=Math.cos(Math.PI/180*37.5),Gv=Math.pow(2,14)/.5;class O_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Tl,this.layoutVertexArray2=new Io,this.indexArray=new Dn,this.programConfigurations=new Ca(t.layers,t.zoom),this.segments=new li,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=M_("line",this.layers,r);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),m=[];for(const{feature:_,id:x,index:P,sourceLayerIndex:A}of t){const E=this.layers[0]._featureFilter.needGeometry,D=ka(_,E);if(!this.layers[0]._featureFilter.filter(new Di(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o):void 0,U={id:x,properties:_.properties,type:_.type,sourceLayerIndex:A,index:P,geometry:E?D.geometry:Aa(_),patterns:{},sortKey:F};m.push(U)}f&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:P,sourceLayerIndex:A}=_;if(this.hasPattern){const E=z_("line",this.layers,_,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(_,x,P,o,{});r.featureIndex.insert(t[P].feature,x,P,A,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,f1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,d1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,u,f){const m=this.layers[0].layout,_=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),P=m.get("line-miter-limit"),A=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const E of r)this.addLine(E,t,_,x,P,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}addLine(t,r,o,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=m1[r.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let P=0;for(;P<x-1&&t[P].equals(t[P+1]);)P++;if(x<(_?3:2))return;o==="bevel"&&(f=1.05);const A=this.overscaling<=16?15*or/(512*this.overscaling):0,E=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,F,U,Z,J;this.e1=this.e2=-1,_&&(D=t[x-2],J=t[P].sub(D)._unit()._perp());for(let re=P;re<x;re++){if(U=re===x-1?_?t[P+1]:void 0:t[re+1],U&&t[re].equals(U))continue;J&&(Z=J),D&&(F=D),D=t[re],J=U?U.sub(D)._unit()._perp():Z,Z=Z||J;let xe=Z.add(J);xe.x===0&&xe.y===0||xe._unit();const ue=Z.x*J.x+Z.y*J.y,_e=xe.x*J.x+xe.y*J.y,Ce=_e!==0?1/_e:1/0,Ue=2*Math.sqrt(2-2*_e),pt=_e<g1&&F&&U,Rt=Z.x*J.y-Z.y*J.x>0;if(pt&&re>P){const St=D.dist(F);if(St>2*A){const vt=D.sub(D.sub(F)._mult(A/St)._round());this.updateDistance(F,vt),this.addCurrentVertex(vt,Z,0,0,E),F=vt}}const ct=F&&U;let ot=ct?o:_?"butt":u;if(ct&&ot==="round"&&(Ce<m?ot="miter":Ce<=2&&(ot="fakeround")),ot==="miter"&&Ce>f&&(ot="bevel"),ot==="bevel"&&(Ce>2&&(ot="flipbevel"),Ce<f&&(ot="miter")),F&&this.updateDistance(F,D),ot==="miter")xe._mult(Ce),this.addCurrentVertex(D,xe,0,0,E);else if(ot==="flipbevel"){if(Ce>100)xe=J.mult(-1);else{const St=Ce*Z.add(J).mag()/Z.sub(J).mag();xe._perp()._mult(St*(Rt?-1:1))}this.addCurrentVertex(D,xe,0,0,E),this.addCurrentVertex(D,xe.mult(-1),0,0,E)}else if(ot==="bevel"||ot==="fakeround"){const St=-Math.sqrt(Ce*Ce-1),vt=Rt?St:0,_t=Rt?0:St;if(F&&this.addCurrentVertex(D,Z,vt,_t,E),ot==="fakeround"){const ze=Math.round(180*Ue/Math.PI/20);for(let It=1;It<ze;It++){let wt=It/ze;if(wt!==.5){const Ii=wt-.5;wt+=wt*Ii*(wt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Ii*Ii+(.848013+ue*(.215638*ue-1.06021)))}const qt=J.sub(Z)._mult(wt)._add(Z)._unit()._mult(Rt?-1:1);this.addHalfVertex(D,qt.x,qt.y,!1,Rt,0,E)}}U&&this.addCurrentVertex(D,J,-vt,-_t,E)}else if(ot==="butt")this.addCurrentVertex(D,xe,0,0,E);else if(ot==="square"){const St=F?1:-1;this.addCurrentVertex(D,xe,St,St,E)}else ot==="round"&&(F&&(this.addCurrentVertex(D,Z,0,0,E),this.addCurrentVertex(D,Z,1,1,E,!0)),U&&(this.addCurrentVertex(D,J,-1,-1,E,!0),this.addCurrentVertex(D,J,0,0,E)));if(pt&&re<x-1){const St=D.dist(U);if(St>2*A){const vt=D.add(U.sub(D)._mult(A/St)._round());this.updateDistance(D,vt),this.addCurrentVertex(vt,J,0,0,E),D=vt}}}}addCurrentVertex(t,r,o,u,f,m=!1){const _=r.y*u-r.x,x=-r.y-r.x*u;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,m,!1,o,f),this.addHalfVertex(t,_,x,m,!0,-u,f),this.distance>Gv/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,u,f,m))}addHalfVertex({x:t,y:r},o,u,f,m,_,x){const P=.5*(this.lineClips?this.scaledDistance*(Gv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const A=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),x.primitiveLength++),m?this.e2=A:this.e1=A}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Wv,Hv;yt("LineBucket",O_,{omit:["layers","patternFeatures"]});var Xv={get paint(){return Hv=Hv||new p({"line-opacity":new Ft(ye.paint_line["line-opacity"]),"line-color":new Ft(ye.paint_line["line-color"]),"line-translate":new xt(ye.paint_line["line-translate"]),"line-translate-anchor":new xt(ye.paint_line["line-translate-anchor"]),"line-width":new Ft(ye.paint_line["line-width"]),"line-gap-width":new Ft(ye.paint_line["line-gap-width"]),"line-offset":new Ft(ye.paint_line["line-offset"]),"line-blur":new Ft(ye.paint_line["line-blur"]),"line-dasharray":new Sl(ye.paint_line["line-dasharray"]),"line-pattern":new wl(ye.paint_line["line-pattern"]),"line-gradient":new Eu(ye.paint_line["line-gradient"])})},get layout(){return Wv=Wv||new p({"line-cap":new xt(ye.layout_line["line-cap"]),"line-join":new Ft(ye.layout_line["line-join"]),"line-miter-limit":new xt(ye.layout_line["line-miter-limit"]),"line-round-limit":new xt(ye.layout_line["line-round-limit"]),"line-sort-key":new Ft(ye.layout_line["line-sort-key"])})}};class _1 extends Ft{possiblyEvaluate(t,r){return r=new Di(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,u){return r=tt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,u)}}let If;class y1 extends n{constructor(t){super(t,Xv),this.gradientVersion=0,If||(If=new _1(Xv.paint.properties["line-width"].specification),If.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof so,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=If.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new O_(t)}queryRadius(t){const r=t,o=Kv(Du("line-width",this,r),Du("line-gap-width",this,r)),u=Du("line-offset",this,r);return o/2+Math.abs(u)+xf(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,o,u,f,m,_){const x=bf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,_),P=_/2*Kv(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),A=this.paint.get("line-offset").evaluate(r,o);return A&&(u=function(E,D){const F=[];for(let U=0;U<E.length;U++){const Z=E[U],J=[];for(let re=0;re<Z.length;re++){const xe=Z[re-1],ue=Z[re],_e=Z[re+1],Ce=re===0?new N(0,0):ue.sub(xe)._unit()._perp(),Ue=re===Z.length-1?new N(0,0):_e.sub(ue)._unit()._perp(),pt=Ce._add(Ue)._unit(),Rt=pt.x*Ue.x+pt.y*Ue.y;Rt!==0&&pt._mult(1/Rt),J.push(pt._mult(D)._add(ue))}F.push(J)}return F}(u,A*_)),function(E,D,F){for(let U=0;U<D.length;U++){const Z=D[U];if(E.length>=3){for(let J=0;J<Z.length;J++)if(El(E,Z[J]))return!0}if(Cw(E,Z,F))return!0}return!1}(x,u,P)}isTileClipped(){return!0}}function Kv(i,t){return t>0?t+2*i:i}const v1=y([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),x1=y([{name:"a_projected_pos",components:3,type:"Float32"}],4);y([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const b1=y([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);y([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $v=y([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),w1=y([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function S1(i,t,r){return i.sections.forEach(o=>{o.text=function(u,f,m){const _=f.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),ln.applyArabicShaping&&(u=ln.applyArabicShaping(u)),u}(o.text,t,r)}),i}y([{name:"triangle",components:3,type:"Uint16"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),y([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),y([{type:"Float32",name:"offsetX"}]),y([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),y([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ju={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ar=24,Jv=Si,Yv=function(i,t,r,o,u){var f,m,_=8*u-o-1,x=(1<<_)-1,P=x>>1,A=-7,E=u-1,D=-1,F=i[t+E];for(E+=D,f=F&(1<<-A)-1,F>>=-A,A+=_;A>0;f=256*f+i[t+E],E+=D,A-=8);for(m=f&(1<<-A)-1,f>>=-A,A+=o;A>0;m=256*m+i[t+E],E+=D,A-=8);if(f===0)f=1-P;else{if(f===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,o),f-=P}return(F?-1:1)*m*Math.pow(2,f-o)},Qv=function(i,t,r,o,u,f){var m,_,x,P=8*f-u-1,A=(1<<P)-1,E=A>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,U=1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,m=A):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+E>=1?D/x:D*Math.pow(2,1-E))*x>=2&&(m++,x/=2),m+E>=A?(_=0,m=A):m+E>=1?(_=(t*x-1)*Math.pow(2,u),m+=E):(_=t*Math.pow(2,E-1)*Math.pow(2,u),m=0));u>=8;i[r+F]=255&_,F+=U,_/=256,u-=8);for(m=m<<u|_,P+=u;P>0;i[r+F]=255&m,F+=U,m/=256,P-=8);i[r+F-U]|=128*Z};function Si(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Si.Varint=0,Si.Fixed64=1,Si.Bytes=2,Si.Fixed32=5;var F_=4294967296,ex=1/F_,tx=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Zs(i){return i.type===Si.Bytes?i.readVarint()+i.pos:i.pos+1}function Ll(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function ix(i,t,r){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(o);for(var u=r.pos-1;u>=i;u--)r.buf[u+o]=r.buf[u]}function T1(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function P1(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function I1(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function C1(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function A1(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function k1(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function E1(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function M1(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function z1(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Cf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Rl(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function rx(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Si.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var o=this.readVarint(),u=o>>3,f=this.pos;this.type=7&o,i(u,t,this),this.pos===f&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Cf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=rx(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Cf(this.buf,this.pos)+Cf(this.buf,this.pos+4)*F_;return this.pos+=8,i},readSFixed64:function(){var i=Cf(this.buf,this.pos)+rx(this.buf,this.pos+4)*F_;return this.pos+=8,i},readFloat:function(){var i=Yv(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Yv(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,o=this.buf;return t=127&(r=o[this.pos++]),r<128?t:(t|=(127&(r=o[this.pos++]))<<7,r<128?t:(t|=(127&(r=o[this.pos++]))<<14,r<128?t:(t|=(127&(r=o[this.pos++]))<<21,r<128?t:function(u,f,m){var _,x,P=m.buf;if(_=(112&(x=P[m.pos++]))>>4,x<128||(_|=(127&(x=P[m.pos++]))<<3,x<128)||(_|=(127&(x=P[m.pos++]))<<10,x<128)||(_|=(127&(x=P[m.pos++]))<<17,x<128)||(_|=(127&(x=P[m.pos++]))<<24,x<128)||(_|=(1&(x=P[m.pos++]))<<31,x<128))return Ll(u,_,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&tx?function(r,o,u){return tx.decode(r.subarray(o,u))}(this.buf,t,i):function(r,o,u){for(var f="",m=o;m<u;){var _,x,P,A=r[m],E=null,D=A>239?4:A>223?3:A>191?2:1;if(m+D>u)break;D===1?A<128&&(E=A):D===2?(192&(_=r[m+1]))==128&&(E=(31&A)<<6|63&_)<=127&&(E=null):D===3?(x=r[m+2],(192&(_=r[m+1]))==128&&(192&x)==128&&((E=(15&A)<<12|(63&_)<<6|63&x)<=2047||E>=55296&&E<=57343)&&(E=null)):D===4&&(x=r[m+2],P=r[m+3],(192&(_=r[m+1]))==128&&(192&x)==128&&(192&P)==128&&((E=(15&A)<<18|(63&_)<<12|(63&x)<<6|63&P)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,D=1):E>65535&&(E-=65536,f+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),f+=String.fromCharCode(E),m+=D}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Si.Bytes)return i.push(this.readVarint(t));var r=Zs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Si.Bytes)return i.push(this.readSVarint());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Si.Bytes)return i.push(this.readBoolean());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Si.Bytes)return i.push(this.readFloat());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Si.Bytes)return i.push(this.readDouble());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Si.Bytes)return i.push(this.readFixed32());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Si.Bytes)return i.push(this.readSFixed32());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Si.Bytes)return i.push(this.readFixed64());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Si.Bytes)return i.push(this.readSFixed64());var t=Zs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Si.Varint)for(;this.buf[this.pos++]>127;);else if(t===Si.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Si.Fixed32)this.pos+=4;else{if(t!==Si.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Rl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Rl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Rl(this.buf,-1&i,this.pos),Rl(this.buf,Math.floor(i*ex),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Rl(this.buf,-1&i,this.pos),Rl(this.buf,Math.floor(i*ex),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,m,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(o,0,r),function(f,m){var _=(7&f)<<4;m.buf[m.pos++]|=_|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,f){for(var m,_,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!_){m>56319||x+1===u.length?(o[f++]=239,o[f++]=191,o[f++]=189):_=m;continue}if(m<56320){o[f++]=239,o[f++]=191,o[f++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(o[f++]=239,o[f++]=191,o[f++]=189,_=null);m<128?o[f++]=m:(m<2048?o[f++]=m>>6|192:(m<65536?o[f++]=m>>12|224:(o[f++]=m>>18|240,o[f++]=m>>12&63|128),o[f++]=m>>6&63|128),o[f++]=63&m|128)}return f}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&ix(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Qv(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Qv(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var o=this.pos-r;o>=128&&ix(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,r){this.writeTag(i,Si.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,T1,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,P1,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,A1,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,I1,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,C1,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,k1,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,E1,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,M1,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,z1,t)},writeBytesField:function(i,t){this.writeTag(i,Si.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Si.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Si.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Si.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Si.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Si.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Si.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Si.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Si.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Si.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var B_=j(Jv);const N_=3;function D1(i,t,r){i===1&&r.readMessage(L1,t)}function L1(i,t,r){if(i===3){const{id:o,bitmap:u,width:f,height:m,left:_,top:x,advance:P}=r.readMessage(R1,{});t.push({id:o,bitmap:new Ru({width:f+2*N_,height:m+2*N_},u),metrics:{width:f,height:m,left:_,top:x,advance:P}})}}function R1(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const nx=N_;function sx(i){let t=0,r=0;for(const m of i)t+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,_)=>_.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let u=0,f=0;for(const m of i)for(let _=o.length-1;_>=0;_--){const x=o[_];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const P=o.pop();_<o.length&&(o[_]=P)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(o.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:f,fill:t/(u*f)||0}}const un=1;class V_{constructor(t,{pixelRatio:r,version:o,stretchX:u,stretchY:f,content:m,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=m,this.version=o,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+un,this.paddedRect.y+un]}get br(){return[this.paddedRect.x+this.paddedRect.w-un,this.paddedRect.y+this.paddedRect.h-un]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*un)/this.pixelRatio,(this.paddedRect.h-2*un)/this.pixelRatio]}}class ox{constructor(t,r){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,o,f),this.addImages(r,u,f);const{w:m,h:_}=sx(f),x=new Ln({width:m||1,height:_||1});for(const P in t){const A=t[P],E=o[P].paddedRect;Ln.copy(A.data,x,{x:0,y:0},{x:E.x+un,y:E.y+un},A.data)}for(const P in r){const A=r[P],E=u[P].paddedRect,D=E.x+un,F=E.y+un,U=A.data.width,Z=A.data.height;Ln.copy(A.data,x,{x:0,y:0},{x:D,y:F},A.data),Ln.copy(A.data,x,{x:0,y:Z-1},{x:D,y:F-1},{width:U,height:1}),Ln.copy(A.data,x,{x:0,y:0},{x:D,y:F+Z},{width:U,height:1}),Ln.copy(A.data,x,{x:U-1,y:0},{x:D-1,y:F},{width:1,height:Z}),Ln.copy(A.data,x,{x:0,y:0},{x:D+U,y:F},{width:1,height:Z})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(t,r,o){for(const u in t){const f=t[u],m={x:0,y:0,w:f.data.width+2*un,h:f.data.height+2*un};o.push(m),r[u]=new V_(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[u,f]=t.tl;o.update(r.data,void 0,{x:u,y:f})}}var zo;yt("ImagePosition",V_),yt("ImageAtlas",ox),w.ah=void 0,(zo=w.ah||(w.ah={}))[zo.none=0]="none",zo[zo.horizontal=1]="horizontal",zo[zo.vertical=2]="vertical",zo[zo.horizontalOnly=3]="horizontalOnly";const Uu=-17;class qu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const o=new qu;return o.scale=t||1,o.fontStack=r,o}static forImage(t){const r=new qu;return r.imageName=t,r}}class Ol{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Ol;for(let u=0;u<t.sections.length;u++){const f=t.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,f=t.charCodeAt(o-1)||null;r+=u&&pf(u)&&!ju[t[o+1]]||f&&pf(f)&&!ju[t[o-1]]||!ju[t[o]]?t[o]:ju[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&kf[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&kf[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Ol;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(qu.forText(t.scale,t.fontStack||r));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void De("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(qu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Af(i,t,r,o,u,f,m,_,x,P,A,E,D,F,U){const Z=Ol.fromFeature(i,u);let J;E===w.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:re,processStyledBidirectionalText:xe}=ln;if(re&&Z.sections.length===1){J=[];const Ce=re(Z.toString(),j_(Z,P,f,t,o,F));for(const Ue of Ce){const pt=new Ol;pt.text=Ue,pt.sections=Z.sections;for(let Rt=0;Rt<Ue.length;Rt++)pt.sectionIndex.push(0);J.push(pt)}}else if(xe){J=[];const Ce=xe(Z.text,Z.sectionIndex,j_(Z,P,f,t,o,F));for(const Ue of Ce){const pt=new Ol;pt.text=Ue[0],pt.sectionIndex=Ue[1],pt.sections=Z.sections,J.push(pt)}}else J=function(Ce,Ue){const pt=[],Rt=Ce.text;let ct=0;for(const ot of Ue)pt.push(Ce.substring(ct,ot)),ct=ot;return ct<Rt.length&&pt.push(Ce.substring(ct,Rt.length)),pt}(Z,j_(Z,P,f,t,o,F));const ue=[],_e={positionedLines:ue,text:Z.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(Ce,Ue,pt,Rt,ct,ot,St,vt,_t,ze,It,wt){let qt=0,Ii=Uu,Ti=0,dr=0;const $n=vt==="right"?1:vt==="left"?0:.5;let kr=0;for(const Qi of ct){Qi.trim();const fr=Qi.getMaxScale(),Fr=(fr-1)*ar,Er={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[kr]=Er;const Yr=Er.positionedGlyphs;let Mr=0;if(!Qi.length()){Ii+=ot,++kr;continue}for(let hn=0;hn<Qi.length();hn++){const pi=Qi.getSection(hn),Ei=Qi.getSectionIndex(hn),Fi=Qi.getCharCode(hn);let Sn=0,Xi=null,Vl=null,_s=null,ys=ar;const Jn=!(_t===w.ah.horizontal||!It&&!Au(Fi)||It&&(kf[Fi]||(pr=Fi,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(pr)))));if(pi.imageName){const Fn=Rt[pi.imageName];if(!Fn)continue;_s=pi.imageName,Ce.iconsInText=Ce.iconsInText||!0,Vl=Fn.paddedRect;const xr=Fn.displaySize;pi.scale=pi.scale*ar/wt,Xi={width:xr[0],height:xr[1],left:un,top:-nx,advance:Jn?xr[1]:xr[0]},Sn=Fr+(ar-xr[1]*pi.scale),ys=Xi.advance;const Gs=Jn?xr[0]*pi.scale-ar*fr:xr[1]*pi.scale-ar*fr;Gs>0&&Gs>Mr&&(Mr=Gs)}else{const Fn=pt[pi.fontStack],xr=Fn&&Fn[Fi];if(xr&&xr.rect)Vl=xr.rect,Xi=xr.metrics;else{const Gs=Ue[pi.fontStack],Ku=Gs&&Gs[Fi];if(!Ku)continue;Xi=Ku.metrics}Sn=(fr-pi.scale)*ar}Jn?(Ce.verticalizable=!0,Yr.push({glyph:Fi,imageName:_s,x:qt,y:Ii+Sn,vertical:Jn,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:Ei,metrics:Xi,rect:Vl}),qt+=ys*pi.scale+ze):(Yr.push({glyph:Fi,imageName:_s,x:qt,y:Ii+Sn,vertical:Jn,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:Ei,metrics:Xi,rect:Vl}),qt+=Xi.advance*pi.scale+ze)}Yr.length!==0&&(Ti=Math.max(qt-ze,Ti),N1(Yr,0,Yr.length-1,$n,Mr)),qt=0;const On=ot*fr+Mr;Er.lineOffset=Math.max(Mr,Fr),Ii+=On,dr=Math.max(On,dr),++kr}var pr;const Kr=Ii-Uu,{horizontalAlign:$r,verticalAlign:Jr}=U_(St);(function(Qi,fr,Fr,Er,Yr,Mr,On,hn,pi){const Ei=(fr-Fr)*Yr;let Fi=0;Fi=Mr!==On?-hn*Er-Uu:(-Er*pi+.5)*On;for(const Sn of Qi)for(const Xi of Sn.positionedGlyphs)Xi.x+=Ei,Xi.y+=Fi})(Ce.positionedLines,$n,$r,Jr,Ti,dr,ot,Kr,ct.length),Ce.top+=-Jr*Kr,Ce.bottom=Ce.top+Kr,Ce.left+=-$r*Ti,Ce.right=Ce.left+Ti}(_e,t,r,o,J,m,_,x,E,P,D,U),!function(Ce){for(const Ue of Ce)if(Ue.positionedGlyphs.length!==0)return!1;return!0}(ue)&&_e}const kf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},O1={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},F1={40:!0};function ax(i,t,r,o,u,f){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*ar/f+u:0}{const m=r[t.fontStack],_=m&&m[i];return _?_.metrics.advance*t.scale+u:0}}function lx(i,t,r,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(r)*r}function B1(i,t,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function cx(i,t,r,o,u,f){let m=null,_=lx(t,r,u,f);for(const x of o){const P=lx(t-x.x,r,u,f)+x.badness;P<=_&&(m=x,_=P)}return{index:i,x:t,priorBreak:m,badness:_}}function ux(i){return i?ux(i.priorBreak).concat(i.index):[]}function j_(i,t,r,o,u,f){if(!i)return[];const m=[],_=function(E,D,F,U,Z,J){let re=0;for(let xe=0;xe<E.length();xe++){const ue=E.getSection(xe);re+=ax(E.getCharCode(xe),ue,U,Z,D,J)}return re/Math.max(1,Math.ceil(re/F))}(i,t,r,o,u,f),x=i.text.indexOf("​")>=0;let P=0;for(let E=0;E<i.length();E++){const D=i.getSection(E),F=i.getCharCode(E);if(kf[F]||(P+=ax(F,D,o,u,t,f)),E<i.length()-1){const U=!((A=F)<11904)&&(!!ai["CJK Compatibility Forms"](A)||!!ai["CJK Compatibility"](A)||!!ai["CJK Strokes"](A)||!!ai["CJK Symbols and Punctuation"](A)||!!ai["Enclosed CJK Letters and Months"](A)||!!ai["Halfwidth and Fullwidth Forms"](A)||!!ai["Ideographic Description Characters"](A)||!!ai["Vertical Forms"](A)||df.test(String.fromCodePoint(A)));(O1[F]||U||D.imageName||E!==i.length()-2&&F1[i.getCharCode(E+1)])&&m.push(cx(E+1,P,_,m,B1(F,i.getCharCode(E+1),U&&x),!1))}}var A;return ux(cx(i.length(),P,_,m,0,!0))}function U_(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function N1(i,t,r,o,u){if(!o&&!u)return;const f=i[r],m=(i[r].x+f.metrics.advance*f.scale)*o;for(let _=t;_<=r;_++)i[_].x-=m,i[_].y+=u}function V1(i,t,r){const{horizontalAlign:o,verticalAlign:u}=U_(r),f=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function hx(i){var t,r;let o=i.left,u=i.top,f=i.right-o,m=i.bottom-u;const _=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&f/m<P||_==="proportional"){const A=Math.ceil(m*P);o*=A/f,f=A}}else if(_==="proportional"&&x==="stretchOnly"&&P!==0&&f/m>P){const A=Math.ceil(f/P);u*=A/m,m=A}return{x1:o,y1:u,x2:o+f,y2:u+m}}function dx(i,t,r,o,u,f){const m=i.image;let _;if(m.content){const J=m.content,re=m.pixelRatio||1;_=[J[0]/re,J[1]/re,m.displaySize[0]-J[2]/re,m.displaySize[1]-J[3]/re]}const x=t.left*f,P=t.right*f;let A,E,D,F;r==="width"||r==="both"?(F=u[0]+x-o[3],E=u[0]+P+o[1]):(F=u[0]+(x+P-m.displaySize[0])/2,E=F+m.displaySize[0]);const U=t.top*f,Z=t.bottom*f;return r==="height"||r==="both"?(A=u[1]+U-o[0],D=u[1]+Z+o[2]):(A=u[1]+(U+Z-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:E,bottom:D,left:F,collisionPadding:_}}const Zu=255,gs=128,Do=Zu*gs;function px(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Di(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=r;let f=0;for(;f<o.length&&o[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const _=o[f],x=o[m];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:_,maxZoom:x,minSize:r.evaluate(new Di(_)),maxSize:r.evaluate(new Di(x)),interpolationType:u}}}function q_(i,t,r){let o="never";const u=i.get(t);return u?o=u:i.get(r)&&(o="always"),o}const j1=Mo.VectorTileFeature.types,U1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ef(i,t,r,o,u,f,m,_,x,P,A,E,D){const F=_?Math.min(Do,Math.round(_[0])):0,U=_?Math.min(Do,Math.round(_[1])):0;i.emplaceBack(t,r,Math.round(32*o),Math.round(32*u),f,m,(F<<1)+(x?1:0),U,16*P,16*A,256*E,256*D)}function Z_(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function q1(i){for(const t of i.sections)if(y_(t.text))return!0;return!1}class G_{constructor(t){this.layoutVertexArray=new Pl,this.indexArray=new Dn,this.programConfigurations=t,this.segments=new li,this.dynamicLayoutVertexArray=new Mu,this.opacityVertexArray=new bn,this.hasVisibleVertices=!1,this.placedSymbolArray=new Li}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,x1.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,U1,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yt("SymbolBuffers",G_);class W_{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new li,this.collisionVertexArray=new fs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,b1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}yt("CollisionBuffers",W_);class Fl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=P_([]),this.placementViewportMatrix=P_([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=px(this.zoom,r["text-size"]),this.iconSizeData=px(this.zoom,r["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=q_(o,"text-overlap","text-allow-overlap")!=="never"||q_(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>w.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new G_(new Ca(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new G_(new Ca(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Ri,this.lineVertexArray=new Pr,this.symbolInstances=new si,this.textAnchorOffsets=new Oi}calculateGlyphDependencies(t,r,o,u,f){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(o||u)&&f){const _=ju[t.charAt(m)];_&&(r[_.charCodeAt(0)]=!0)}}populate(t,r,o){const u=this.layers[0],f=u.layout,m=f.get("text-font"),_=f.get("text-field"),x=f.get("icon-image"),P=(_.value.kind!=="constant"||_.value.value instanceof nn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),A=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,E=f.get("symbol-sort-key");if(this.features=[],!P&&!A)return;const D=r.iconDependencies,F=r.glyphDependencies,U=r.availableImages,Z=new Di(this.zoom);for(const{feature:J,id:re,index:xe,sourceLayerIndex:ue}of t){const _e=u._featureFilter.needGeometry,Ce=ka(J,_e);if(!u._featureFilter.filter(Z,Ce,o))continue;let Ue,pt;if(_e||(Ce.geometry=Aa(J)),P){const ct=u.getValueAndResolveTokens("text-field",Ce,o,U),ot=nn.factory(ct),St=this.hasRTLText=this.hasRTLText||q1(ot);(!St||ln.getRTLTextPluginStatus()==="unavailable"||St&&ln.isParsed())&&(Ue=S1(ot,u,Ce))}if(A){const ct=u.getValueAndResolveTokens("icon-image",Ce,o,U);pt=ct instanceof on?ct:on.fromString(ct)}if(!Ue&&!pt)continue;const Rt=this.sortFeaturesByKey?E.evaluate(Ce,{},o):void 0;if(this.features.push({id:re,text:Ue,icon:pt,index:xe,sourceLayerIndex:ue,geometry:Ce.geometry,properties:J.properties,type:j1[J.type],sortKey:Rt}),pt&&(D[pt.name]=!0),Ue){const ct=m.evaluate(Ce,{},o).join(","),ot=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(w.ah.vertical)>=0;for(const St of Ue.sections)if(St.image)D[St.image.name]=!0;else{const vt=Iu(Ue.toString()),_t=St.fontStack||ct,ze=F[_t]=F[_t]||{};this.calculateGlyphDependencies(St.text,ze,ot,this.allowVerticalPlacement,vt)}}}f.get("symbol-placement")==="line"&&(this.features=function(J){const re={},xe={},ue=[];let _e=0;function Ce(ct){ue.push(J[ct]),_e++}function Ue(ct,ot,St){const vt=xe[ct];return delete xe[ct],xe[ot]=vt,ue[vt].geometry[0].pop(),ue[vt].geometry[0]=ue[vt].geometry[0].concat(St[0]),vt}function pt(ct,ot,St){const vt=re[ot];return delete re[ot],re[ct]=vt,ue[vt].geometry[0].shift(),ue[vt].geometry[0]=St[0].concat(ue[vt].geometry[0]),vt}function Rt(ct,ot,St){const vt=St?ot[0][ot[0].length-1]:ot[0][0];return`${ct}:${vt.x}:${vt.y}`}for(let ct=0;ct<J.length;ct++){const ot=J[ct],St=ot.geometry,vt=ot.text?ot.text.toString():null;if(!vt){Ce(ct);continue}const _t=Rt(vt,St),ze=Rt(vt,St,!0);if(_t in xe&&ze in re&&xe[_t]!==re[ze]){const It=pt(_t,ze,St),wt=Ue(_t,ze,ue[It].geometry);delete re[_t],delete xe[ze],xe[Rt(vt,ue[wt].geometry,!0)]=wt,ue[It].geometry=null}else _t in xe?Ue(_t,ze,St):ze in re?pt(_t,ze,St):(Ce(ct),re[_t]=_e-1,xe[ze]=_e-1)}return ue.filter(ct=>ct.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,re)=>J.sortKey-re.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(r[t.segment+1]),f=t.dist(r[t.segment]);const m={};for(let _=t.segment+1;_<r.length;_++)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:u},_<r.length-1&&(u+=r[_+1].dist(r[_]));for(let _=t.segment||0;_>=0;_--)m[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:f},_>0&&(f+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const x=m[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,u,f,m,_,x,P,A,E,D){const F=t.indexArray,U=t.layoutVertexArray,Z=t.segments.prepareSegment(4*r.length,U,F,this.canOverlap?m.sortKey:void 0),J=this.glyphOffsetArray.length,re=Z.vertexLength,xe=this.allowVerticalPlacement&&_===w.ah.vertical?Math.PI/2:0,ue=m.text&&m.text.sections;for(let _e=0;_e<r.length;_e++){const{tl:Ce,tr:Ue,bl:pt,br:Rt,tex:ct,pixelOffsetTL:ot,pixelOffsetBR:St,minFontScaleX:vt,minFontScaleY:_t,glyphOffset:ze,isSDF:It,sectionIndex:wt}=r[_e],qt=Z.vertexLength,Ii=ze[1];Ef(U,x.x,x.y,Ce.x,Ii+Ce.y,ct.x,ct.y,o,It,ot.x,ot.y,vt,_t),Ef(U,x.x,x.y,Ue.x,Ii+Ue.y,ct.x+ct.w,ct.y,o,It,St.x,ot.y,vt,_t),Ef(U,x.x,x.y,pt.x,Ii+pt.y,ct.x,ct.y+ct.h,o,It,ot.x,St.y,vt,_t),Ef(U,x.x,x.y,Rt.x,Ii+Rt.y,ct.x+ct.w,ct.y+ct.h,o,It,St.x,St.y,vt,_t),Z_(t.dynamicLayoutVertexArray,x,xe),F.emplaceBack(qt,qt+1,qt+2),F.emplaceBack(qt+1,qt+2,qt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),_e!==r.length-1&&wt===r[_e+1].sectionIndex||t.programConfigurations.populatePaintArrays(U.length,m,m.index,{},D,ue&&ue[wt])}t.placedSymbolArray.emplaceBack(x.x,x.y,J,this.glyphOffsetArray.length-J,re,P,A,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],_,0,!1,0,E)}_addCollisionDebugVertex(t,r,o,u,f,m){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,o,u,f,m,_){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),P=x.vertexLength,A=f.layoutVertexArray,E=f.collisionVertexArray,D=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(A,E,m,D,F,new N(t,r)),this._addCollisionDebugVertex(A,E,m,D,F,new N(o,r)),this._addCollisionDebugVertex(A,E,m,D,F,new N(o,u)),this._addCollisionDebugVertex(A,E,m,D,F,new N(t,u)),x.vertexLength+=4;const U=f.indexArray;U.emplaceBack(P,P+1),U.emplaceBack(P+1,P+2),U.emplaceBack(P+2,P+3),U.emplaceBack(P+3,P),x.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,u){for(let f=t;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new W_(wn,$v.members,vr),this.iconCollisionBox=new W_(wn,$v.members,vr);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,u,f,m,_,x,P){const A={};for(let E=r;E<o;E++){const D=t.get(E);A.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.textFeatureIndex=D.featureIndex;break}for(let E=u;E<f;E++){const D=t.get(E);A.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalTextFeatureIndex=D.featureIndex;break}for(let E=m;E<_;E++){const D=t.get(E);A.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.iconFeatureIndex=D.featureIndex;break}for(let E=x;E<P;E++){const D=t.get(E);A.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},A.verticalIconFeatureIndex=D.featureIndex;break}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),u=[],f=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const x=this.symbolInstances.get(_);u.push(0|Math.round(r*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return m.sort((_,x)=>u[_]-u[x]||f[x]-f[_]),m}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,f,m)=>{u>=0&&m.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let fx,mx;yt("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=Z_;var H_={get paint(){return mx=mx||new p({"icon-opacity":new Ft(ye.paint_symbol["icon-opacity"]),"icon-color":new Ft(ye.paint_symbol["icon-color"]),"icon-halo-color":new Ft(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new xt(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new xt(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(ye.paint_symbol["text-opacity"]),"text-color":new Ft(ye.paint_symbol["text-color"],{runtimeType:gr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Ft(ye.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(ye.paint_symbol["text-halo-blur"]),"text-translate":new xt(ye.paint_symbol["text-translate"]),"text-translate-anchor":new xt(ye.paint_symbol["text-translate-anchor"])})},get layout(){return fx=fx||new p({"symbol-placement":new xt(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new xt(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xt(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xt(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xt(ye.layout_symbol["icon-allow-overlap"]),"icon-overlap":new xt(ye.layout_symbol["icon-overlap"]),"icon-ignore-placement":new xt(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new xt(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xt(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(ye.layout_symbol["icon-size"]),"icon-text-fit":new xt(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xt(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(ye.layout_symbol["icon-image"]),"icon-rotate":new Ft(ye.layout_symbol["icon-rotate"]),"icon-padding":new Ft(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new xt(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(ye.layout_symbol["icon-offset"]),"icon-anchor":new Ft(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xt(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xt(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xt(ye.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(ye.layout_symbol["text-field"]),"text-font":new Ft(ye.layout_symbol["text-font"]),"text-size":new Ft(ye.layout_symbol["text-size"]),"text-max-width":new Ft(ye.layout_symbol["text-max-width"]),"text-line-height":new xt(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(ye.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(ye.layout_symbol["text-justify"]),"text-radial-offset":new Ft(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xt(ye.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ft(ye.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ft(ye.layout_symbol["text-anchor"]),"text-max-angle":new xt(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new xt(ye.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(ye.layout_symbol["text-rotate"]),"text-padding":new xt(ye.layout_symbol["text-padding"]),"text-keep-upright":new xt(ye.layout_symbol["text-keep-upright"]),"text-transform":new Ft(ye.layout_symbol["text-transform"]),"text-offset":new Ft(ye.layout_symbol["text-offset"]),"text-allow-overlap":new xt(ye.layout_symbol["text-allow-overlap"]),"text-overlap":new xt(ye.layout_symbol["text-overlap"]),"text-ignore-placement":new xt(ye.layout_symbol["text-ignore-placement"]),"text-optional":new xt(ye.layout_symbol["text-optional"])})}};class gx{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yt("FormatSectionOverride",gx,{omit:["defaultValue"]});class Mf extends n{constructor(t){super(t,H_)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,u){const f=this.layout.get(t).evaluate(r,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||ul(m.value)||!f?f:function(_,x){return x.replace(/{([^{}]+)}/g,(P,A)=>_&&A in _?String(_[A]):"")}(r.properties,f)}createBucket(t){return new Fl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of H_.paint.overridableProperties){if(!Mf.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new gx(r),u=new cl(o,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new mo("source",u):new go("composite",u,r.value.zoomStops),this.paint._values[t]=new Xn(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&Mf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),u=H_.paint.properties[r];let f=!1;const m=_=>{for(const x of _)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof nn)m(o.value.value.sections);else if(o.value.kind==="source"){const _=P=>{f||(P instanceof Cn&&sr(P.value)===mn?m(P.value.sections):P instanceof el?m(P.sections):P.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return f}}let _x;var Z1={get paint(){return _x=_x||new p({"background-color":new xt(ye.paint_background["background-color"]),"background-pattern":new Sl(ye.paint_background["background-pattern"]),"background-opacity":new xt(ye.paint_background["background-opacity"])})}};class G1 extends n{constructor(t){super(t,Z1)}}let yx;var W1={get paint(){return yx=yx||new p({"raster-opacity":new xt(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new xt(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xt(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xt(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new xt(ye.paint_raster["raster-saturation"]),"raster-contrast":new xt(ye.paint_raster["raster-contrast"]),"raster-resampling":new xt(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new xt(ye.paint_raster["raster-fade-duration"])})}};class H1 extends n{constructor(t){super(t,W1)}}class X1 extends n{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class K1{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const X_=63710088e-1;class Lo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Lo(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,u=t.lat*r,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*r);return X_*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Lo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Lo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Lo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vx=2*Math.PI*X_;function xx(i){return vx*Math.cos(i*Math.PI/180)}function bx(i){return(180+i)/360}function wx(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Sx(i,t){return i/xx(t)}function K_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Gu{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=Lo.convert(t);return new Gu(bx(o.lng),wx(o.lat),Sx(r,o.lat))}toLngLat(){return new Lo(360*this.x-180,K_(this.y))}toAltitude(){return this.z*xx(K_(this.y))}meterInMercatorCoordinateUnits(){return 1/vx*(t=K_(this.y),1/Math.cos(t*Math.PI/180));var t}}function Tx(i,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class $_{constructor(t,r,o){if(!function(u,f,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Wu(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const u=(m=this.y,_=this.z,x=Tx(256*(f=this.x),256*(m=Math.pow(2,_)-m-1),_),P=Tx(256*(f+1),256*(m+1),_),x[0]+","+x[1]+","+P[0]+","+P[1]);var f,m,_,x,P;const A=function(E,D,F){let U,Z="";for(let J=E;J>0;J--)U=1<<J-1,Z+=(D&U?1:0)+(F&U?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,A).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new N((t.x*r-this.x)*or,(t.y*r-this.y)*or)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Px{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Wu(t,r.z,r.z,r.x,r.y)}}class Rn{constructor(t,r,o,u,f){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new $_(o,+u,+f),this.key=Wu(r,t,o,u,f)}clone(){return new Rn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Rn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Wu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Wu(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Rn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Rn(r,this.wrap,r,o,u),new Rn(r,this.wrap,r,o+1,u),new Rn(r,this.wrap,r,o,u+1),new Rn(r,this.wrap,r,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Px(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Gu(t.x-this.wrap,t.y))}}function Wu(i,t,r,o,u){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*u+o).toString(36)+r.toString(36)+t.toString(36)}yt("CanonicalTileID",$_),yt("OverscaledTileID",Rn,{omit:["posMatrix"]});class Ix{constructor(t,r,o,u=1,f=1,m=1,_=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void De(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const x=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=m,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<x;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(x,P)]=this.data[this._idx(x-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,x)]=this.data[this._idx(P,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<x;P++)for(let A=0;A<x;A++){const E=this.get(P,A);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,r){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,r);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Ln({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,m=o*this.dim,_=o*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:m=_-1;break;case 1:_=m+1}const x=-r*this.dim,P=-o*this.dim;for(let A=m;A<_;A++)for(let E=u;E<f;E++)this.data[this._idx(E,A)]=t.data[this._idx(E+x,A+P)]}}yt("DEMData",Ix);class Cx{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Ax{constructor(t,r,o,u,f){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=u,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class kx{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xo(or,16,0),this.grid3D=new xo(or,16,0),this.featureIndexArray=new Rr,this.promoteId=r}insert(t,r,o,u,f,m){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=m?this.grid3D:this.grid;for(let P=0;P<r.length;P++){const A=r[P],E=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const F=A[D];E[0]=Math.min(E[0],F.x),E[1]=Math.min(E[1],F.y),E[2]=Math.max(E[2],F.x),E[3]=Math.max(E[3],F.y)}E[0]<or&&E[1]<or&&E[2]>=0&&E[3]>=0&&x.insert(_,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Mo.VectorTile(new B_(this.rawTileData)).layers,this.sourceLayerCoder=new Cx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,u){this.loadVTLayers();const f=t.params||{},m=or/t.tileSize/t.scale,_=hu(f.filter),x=t.queryGeometry,P=t.queryPadding*m,A=Mx(x),E=this.grid.query(A.minX-P,A.minY-P,A.maxX+P,A.maxY+P),D=Mx(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(J,re,xe,ue)=>function(_e,Ce,Ue,pt,Rt){for(const ot of _e)if(Ce<=ot.x&&Ue<=ot.y&&pt>=ot.x&&Rt>=ot.y)return!0;const ct=[new N(Ce,Ue),new N(Ce,Rt),new N(pt,Rt),new N(pt,Ue)];if(_e.length>2){for(const ot of ct)if(El(_e,ot))return!0}for(let ot=0;ot<_e.length-1;ot++)if(kw(_e[ot],_e[ot+1],ct))return!0;return!1}(t.cameraQueryGeometry,J-P,re-P,xe+P,ue+P));for(const J of F)E.push(J);E.sort($1);const U={};let Z;for(let J=0;J<E.length;J++){const re=E[J];if(re===Z)continue;Z=re;const xe=this.featureIndexArray.get(re);let ue=null;this.loadMatchingFeature(U,xe.bucketIndex,xe.sourceLayerIndex,xe.featureIndex,_,f.layers,f.availableImages,r,o,u,(_e,Ce,Ue)=>(ue||(ue=Aa(_e)),Ce.queryIntersectsFeature(x,_e,Ue,ue,this.z,t.transform,m,t.pixelPosMatrix)))}return U}loadMatchingFeature(t,r,o,u,f,m,_,x,P,A,E){const D=this.bucketLayerIDs[r];if(m&&!function(J,re){for(let xe=0;xe<J.length;xe++)if(re.indexOf(J[xe])>=0)return!0;return!1}(m,D))return;const F=this.sourceLayerCoder.decode(o),U=this.vtLayers[F].feature(u);if(f.needGeometry){const J=ka(U,!0);if(!f.filter(new Di(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!f.filter(new Di(this.tileID.overscaledZ),U))return;const Z=this.getId(U,F);for(let J=0;J<D.length;J++){const re=D[J];if(m&&m.indexOf(re)<0)continue;const xe=x[re];if(!xe)continue;let ue={};Z&&A&&(ue=A.getState(xe.sourceLayer||"_geojsonTileLayer",Z));const _e=tt({},P[re]);_e.paint=Ex(_e.paint,xe.paint,U,ue,_),_e.layout=Ex(_e.layout,xe.layout,U,ue,_);const Ce=!E||E(U,xe,ue);if(!Ce)continue;const Ue=new Ax(U,this.z,this.x,this.y,Z);Ue.layer=_e;let pt=t[re];pt===void 0&&(pt=t[re]=[]),pt.push({featureIndex:u,feature:Ue,intersectionZ:Ce})}}lookupSymbolFeatures(t,r,o,u,f,m,_,x){const P={};this.loadVTLayers();const A=hu(f);for(const E of t)this.loadMatchingFeature(P,o,u,E,A,m,_,x,r);return P}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof o=="boolean"&&(o=Number(o))),o}}function Ex(i,t,r,o,u){return $e(i,(f,m)=>{const _=t instanceof Ta?t.get(m):null;return _&&_.evaluate?_.evaluate(r,o,u):_})}function Mx(i){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return{minX:t,minY:r,maxX:o,maxY:u}}function $1(i,t){return t-i}function zx(i,t,r,o,u){const f=[];for(let m=0;m<i.length;m++){const _=i[m];let x;for(let P=0;P<_.length-1;P++){let A=_[P],E=_[P+1];A.x<t&&E.x<t||(A.x<t?A=new N(t,A.y+(t-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x<t&&(E=new N(t,A.y+(t-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y<r&&E.y<r||(A.y<r?A=new N(A.x+(r-A.y)/(E.y-A.y)*(E.x-A.x),r)._round():E.y<r&&(E=new N(A.x+(r-A.y)/(E.y-A.y)*(E.x-A.x),r)._round()),A.x>=o&&E.x>=o||(A.x>=o?A=new N(o,A.y+(o-A.x)/(E.x-A.x)*(E.y-A.y))._round():E.x>=o&&(E=new N(o,A.y+(o-A.x)/(E.x-A.x)*(E.y-A.y))._round()),A.y>=u&&E.y>=u||(A.y>=u?A=new N(A.x+(u-A.y)/(E.y-A.y)*(E.x-A.x),u)._round():E.y>=u&&(E=new N(A.x+(u-A.y)/(E.y-A.y)*(E.x-A.x),u)._round()),x&&A.equals(x[x.length-1])||(x=[A],f.push(x)),x.push(E)))))}}return f}yt("FeatureIndex",kx,{omit:["rawTileData","sourceLayerCoder"]});class Ro extends N{constructor(t,r,o,u){super(t,r),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Ro(this.x,this.y,this.angle,this.segment)}}function Dx(i,t,r,o,u){if(t.segment===void 0||r===0)return!0;let f=t,m=t.segment+1,_=0;for(;_>-r/2;){if(m--,m<0)return!1;_-=i[m].dist(f),f=i[m]}_+=i[m].dist(i[m+1]),m++;const x=[];let P=0;for(;_<r/2;){const A=i[m],E=i[m+1];if(!E)return!1;let D=i[m-1].angleTo(A)-A.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:D}),P+=D;_-x[0].distance>o;)P-=x.shift().angleDelta;if(P>u)return!1;m++,_+=A.dist(E)}return!0}function Lx(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Rx(i,t,r){return i?.6*t*r:0}function Ox(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function J1(i,t,r,o,u,f){const m=Rx(r,u,f),_=Ox(r,o)*f;let x=0;const P=Lx(i)/2;for(let A=0;A<i.length-1;A++){const E=i[A],D=i[A+1],F=E.dist(D);if(x+F>P){const U=(P-x)/F,Z=Gr.number(E.x,D.x,U),J=Gr.number(E.y,D.y,U),re=new Ro(Z,J,D.angleTo(E),A);return re._round(),!m||Dx(i,re,_,m,t)?re:void 0}x+=F}}function Y1(i,t,r,o,u,f,m,_,x){const P=Rx(o,f,m),A=Ox(o,u),E=A*m,D=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-E<t/4&&(t=E+t/4),Fx(i,D?t/2*_%t:(A/2+2*f)*m*_%t,t,P,r,E,D,!1,x)}function Fx(i,t,r,o,u,f,m,_,x){const P=f/2,A=Lx(i);let E=0,D=t-r,F=[];for(let U=0;U<i.length-1;U++){const Z=i[U],J=i[U+1],re=Z.dist(J),xe=J.angleTo(Z);for(;D+r<E+re;){D+=r;const ue=(D-E)/re,_e=Gr.number(Z.x,J.x,ue),Ce=Gr.number(Z.y,J.y,ue);if(_e>=0&&_e<x&&Ce>=0&&Ce<x&&D-P>=0&&D+P<=A){const Ue=new Ro(_e,Ce,xe,U);Ue._round(),o&&!Dx(i,Ue,f,o,u)||F.push(Ue)}}E+=re}return _||F.length||m||(F=Fx(i,E/2,r,o,u,f,m,!0,x)),F}yt("Anchor",Ro);const Bl=un;function Bx(i,t,r,o){const u=[],f=i.image,m=f.pixelRatio,_=f.paddedRect.w-2*Bl,x=f.paddedRect.h-2*Bl;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const A=f.stretchX||[[0,_]],E=f.stretchY||[[0,x]],D=(ze,It)=>ze+It[1]-It[0],F=A.reduce(D,0),U=E.reduce(D,0),Z=_-F,J=x-U;let re=0,xe=F,ue=0,_e=U,Ce=0,Ue=Z,pt=0,Rt=J;if(f.content&&o){const ze=f.content,It=ze[2]-ze[0],wt=ze[3]-ze[1];(f.textFitWidth||f.textFitHeight)&&(P=hx(i)),re=zf(A,0,ze[0]),ue=zf(E,0,ze[1]),xe=zf(A,ze[0],ze[2]),_e=zf(E,ze[1],ze[3]),Ce=ze[0]-re,pt=ze[1]-ue,Ue=It-xe,Rt=wt-_e}const ct=P.x1,ot=P.y1,St=P.x2-ct,vt=P.y2-ot,_t=(ze,It,wt,qt)=>{const Ii=Df(ze.stretch-re,xe,St,ct),Ti=Lf(ze.fixed-Ce,Ue,ze.stretch,F),dr=Df(It.stretch-ue,_e,vt,ot),$n=Lf(It.fixed-pt,Rt,It.stretch,U),kr=Df(wt.stretch-re,xe,St,ct),pr=Lf(wt.fixed-Ce,Ue,wt.stretch,F),Kr=Df(qt.stretch-ue,_e,vt,ot),$r=Lf(qt.fixed-pt,Rt,qt.stretch,U),Jr=new N(Ii,dr),Qi=new N(kr,dr),fr=new N(kr,Kr),Fr=new N(Ii,Kr),Er=new N(Ti/m,$n/m),Yr=new N(pr/m,$r/m),Mr=t*Math.PI/180;if(Mr){const pi=Math.sin(Mr),Ei=Math.cos(Mr),Fi=[Ei,-pi,pi,Ei];Jr._matMult(Fi),Qi._matMult(Fi),Fr._matMult(Fi),fr._matMult(Fi)}const On=ze.stretch+ze.fixed,hn=It.stretch+It.fixed;return{tl:Jr,tr:Qi,bl:Fr,br:fr,tex:{x:f.paddedRect.x+Bl+On,y:f.paddedRect.y+Bl+hn,w:wt.stretch+wt.fixed-On,h:qt.stretch+qt.fixed-hn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Er,pixelOffsetBR:Yr,minFontScaleX:Ue/m/St,minFontScaleY:Rt/m/vt,isSDF:r}};if(o&&(f.stretchX||f.stretchY)){const ze=Nx(A,Z,F),It=Nx(E,J,U);for(let wt=0;wt<ze.length-1;wt++){const qt=ze[wt],Ii=ze[wt+1];for(let Ti=0;Ti<It.length-1;Ti++)u.push(_t(qt,It[Ti],Ii,It[Ti+1]))}}else u.push(_t({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return u}function zf(i,t,r){let o=0;for(const u of i)o+=Math.max(t,Math.min(r,u[1]))-Math.max(t,Math.min(r,u[0]));return o}function Nx(i,t,r){const o=[{fixed:-Bl,stretch:0}];for(const[u,f]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return o.push({fixed:t+Bl,stretch:r}),o}function Df(i,t,r,o){return i/t*r+o}function Lf(i,t,r,o){return i-t*r/o}class Rf{constructor(t,r,o,u,f,m,_,x,P,A){var E;if(this.boxStartIndex=t.length,P){let D=m.top,F=m.bottom;const U=m.collisionPadding;U&&(D-=U[1],F+=U[3]);let Z=F-D;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const D=!((E=m.image)===null||E===void 0)&&E.content&&(m.image.textFitWidth||m.image.textFitHeight)?hx(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*_-x[0],D.y2=D.y2*_+x[2],D.x1=D.x1*_-x[3],D.x2=D.x2*_+x[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*_,D.y1-=F[1]*_,D.x2+=F[2]*_,D.y2+=F[3]*_),A){const U=new N(D.x1,D.y1),Z=new N(D.x2,D.y1),J=new N(D.x1,D.y2),re=new N(D.x2,D.y2),xe=A*Math.PI/180;U._rotate(xe),Z._rotate(xe),J._rotate(xe),re._rotate(xe),D.x1=Math.min(U.x,Z.x,J.x,re.x),D.x2=Math.max(U.x,Z.x,J.x,re.x),D.y1=Math.min(U.y,Z.y,J.y,re.y),D.y2=Math.max(U.y,Z.y,J.y,re.y)}t.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=t.length}}class Q1{constructor(t=[],r=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,u=r[t];for(;t>0;){const f=t-1>>1,m=r[f];if(o(u,m)>=0)break;r[t]=m,t=f}r[t]=u}_down(t){const{data:r,compare:o}=this,u=this.length>>1,f=r[t];for(;t<u;){let m=1+(t<<1);const _=m+1;if(_<this.length&&o(r[_],r[m])<0&&(m=_),o(r[m],f)>=0)break;r[t]=r[m],t=m}r[t]=f}}function e2(i,t=1,r=!1){let o=1/0,u=1/0,f=-1/0,m=-1/0;const _=i[0];for(let F=0;F<_.length;F++){const U=_[F];(!F||U.x<o)&&(o=U.x),(!F||U.y<u)&&(u=U.y),(!F||U.x>f)&&(f=U.x),(!F||U.y>m)&&(m=U.y)}const x=Math.min(f-o,m-u);let P=x/2;const A=new Q1([],t2);if(x===0)return new N(o,u);for(let F=o;F<f;F+=x)for(let U=u;U<m;U+=x)A.push(new Nl(F+P,U+P,P,i));let E=function(F){let U=0,Z=0,J=0;const re=F[0];for(let xe=0,ue=re.length,_e=ue-1;xe<ue;_e=xe++){const Ce=re[xe],Ue=re[_e],pt=Ce.x*Ue.y-Ue.x*Ce.y;Z+=(Ce.x+Ue.x)*pt,J+=(Ce.y+Ue.y)*pt,U+=3*pt}return new Nl(Z/U,J/U,0,F)}(i),D=A.length;for(;A.length;){const F=A.pop();(F.d>E.d||!E.d)&&(E=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-E.d<=t||(P=F.h/2,A.push(new Nl(F.p.x-P,F.p.y-P,P,i)),A.push(new Nl(F.p.x+P,F.p.y-P,P,i)),A.push(new Nl(F.p.x-P,F.p.y+P,P,i)),A.push(new Nl(F.p.x+P,F.p.y+P,P,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function t2(i,t){return t.max-i.max}function Nl(i,t,r,o){this.p=new N(i,t),this.h=r,this.d=function(u,f){let m=!1,_=1/0;for(let x=0;x<f.length;x++){const P=f[x];for(let A=0,E=P.length,D=E-1;A<E;D=A++){const F=P[A],U=P[D];F.y>u.y!=U.y>u.y&&u.x<(U.x-F.x)*(u.y-F.y)/(U.y-F.y)+F.x&&(m=!m),_=Math.min(_,wv(u,F,U))}}return(m?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Ar;w.aq=void 0,(Ar=w.aq||(w.aq={}))[Ar.center=1]="center",Ar[Ar.left=2]="left",Ar[Ar.right=3]="right",Ar[Ar.top=4]="top",Ar[Ar.bottom=5]="bottom",Ar[Ar["top-left"]=6]="top-left",Ar[Ar["top-right"]=7]="top-right",Ar[Ar["bottom-left"]=8]="bottom-left",Ar[Ar["bottom-right"]=9]="bottom-right";const Oo=7,J_=Number.POSITIVE_INFINITY;function Vx(i,t){return t[1]!==J_?function(r,o,u){let f=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),r){case"top-right":case"top-left":case"top":m=u-Oo;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Oo}switch(r){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,m]}(i,t[0],t[1]):function(r,o){let u=0,f=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-Oo;break;case"bottom-right":case"bottom-left":f=-m+Oo;break;case"bottom":f=-o+Oo;break;case"top":f=o-Oo}switch(r){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,f]}(i,t[0])}function jx(i,t,r){var o;const u=i.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(f){const _=f.values,x=[];for(let P=0;P<_.length;P+=2){const A=x[P]=_[P],E=_[P+1].map(D=>D*ar);A.startsWith("top")?E[1]-=Oo:A.startsWith("bottom")&&(E[1]+=Oo),x[P+1]=E}return new gn(x)}const m=u.get("text-variable-anchor");if(m){let _;_=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},r)*ar,J_]:u.get("text-offset").evaluate(t,{},r).map(P=>P*ar);const x=[];for(const P of m)x.push(P,Vx(P,_));return new gn(x)}return null}function Y_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function i2(i,t,r,o,u,f,m,_,x,P,A){let E=f.textMaxSize.evaluate(t,{});E===void 0&&(E=m);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},A),U=qx(r.horizontal),Z=m/24,J=i.tilePixelRatio*Z,re=i.tilePixelRatio*E/24,xe=i.tilePixelRatio*_,ue=i.tilePixelRatio*D.get("symbol-spacing"),_e=D.get("text-padding")*i.tilePixelRatio,Ce=function(ze,It,wt,qt=1){const Ii=ze.get("icon-padding").evaluate(It,{},wt),Ti=Ii&&Ii.values;return[Ti[0]*qt,Ti[1]*qt,Ti[2]*qt,Ti[3]*qt]}(D,t,A,i.tilePixelRatio),Ue=D.get("text-max-angle")/180*Math.PI,pt=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Rt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ct=D.get("symbol-placement"),ot=ue/2,St=D.get("icon-text-fit");let vt;o&&St!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(vt=dx(o,r.vertical,St,D.get("icon-text-fit-padding"),F,Z)),U&&(o=dx(o,U,St,D.get("icon-text-fit-padding"),F,Z)));const _t=(ze,It)=>{It.x<0||It.x>=or||It.y<0||It.y>=or||function(wt,qt,Ii,Ti,dr,$n,kr,pr,Kr,$r,Jr,Qi,fr,Fr,Er,Yr,Mr,On,hn,pi,Ei,Fi,Sn,Xi,Vl){const _s=wt.addToLineVertexArray(qt,Ii);let ys,Jn,Fn,xr,Gs=0,Ku=0,Hx=0,Xx=0,oy=-1,ay=-1;const Ws={};let Kx=Il("");if(wt.allowVerticalPlacement&&Ti.vertical){const Br=pr.layout.get("text-rotate").evaluate(Ei,{},Xi)+90;Fn=new Rf(Kr,qt,$r,Jr,Qi,Ti.vertical,fr,Fr,Er,Br),kr&&(xr=new Rf(Kr,qt,$r,Jr,Qi,kr,Mr,On,Er,Br))}if(dr){const Br=pr.layout.get("icon-rotate").evaluate(Ei,{}),Bn=pr.layout.get("icon-text-fit")!=="none",Ma=Bx(dr,Br,Sn,Bn),ns=kr?Bx(kr,Br,Sn,Bn):void 0;Jn=new Rf(Kr,qt,$r,Jr,Qi,dr,Mr,On,!1,Br),Gs=4*Ma.length;const za=wt.iconSizeData;let vs=null;za.kind==="source"?(vs=[gs*pr.layout.get("icon-size").evaluate(Ei,{})],vs[0]>Do&&De(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Zu}. Reduce your "icon-size".`)):za.kind==="composite"&&(vs=[gs*Fi.compositeIconSizes[0].evaluate(Ei,{},Xi),gs*Fi.compositeIconSizes[1].evaluate(Ei,{},Xi)],(vs[0]>Do||vs[1]>Do)&&De(`${wt.layerIds[0]}: Value for "icon-size" is >= ${Zu}. Reduce your "icon-size".`)),wt.addSymbols(wt.icon,Ma,vs,pi,hn,Ei,w.ah.none,qt,_s.lineStartIndex,_s.lineLength,-1,Xi),oy=wt.icon.placedSymbolArray.length-1,ns&&(Ku=4*ns.length,wt.addSymbols(wt.icon,ns,vs,pi,hn,Ei,w.ah.vertical,qt,_s.lineStartIndex,_s.lineLength,-1,Xi),ay=wt.icon.placedSymbolArray.length-1)}const $x=Object.keys(Ti.horizontal);for(const Br of $x){const Bn=Ti.horizontal[Br];if(!ys){Kx=Il(Bn.text);const ns=pr.layout.get("text-rotate").evaluate(Ei,{},Xi);ys=new Rf(Kr,qt,$r,Jr,Qi,Bn,fr,Fr,Er,ns)}const Ma=Bn.positionedLines.length===1;if(Hx+=Ux(wt,qt,Bn,$n,pr,Er,Ei,Yr,_s,Ti.vertical?w.ah.horizontal:w.ah.horizontalOnly,Ma?$x:[Br],Ws,oy,Fi,Xi),Ma)break}Ti.vertical&&(Xx+=Ux(wt,qt,Ti.vertical,$n,pr,Er,Ei,Yr,_s,w.ah.vertical,["vertical"],Ws,ay,Fi,Xi));const s2=ys?ys.boxStartIndex:wt.collisionBoxArray.length,o2=ys?ys.boxEndIndex:wt.collisionBoxArray.length,a2=Fn?Fn.boxStartIndex:wt.collisionBoxArray.length,l2=Fn?Fn.boxEndIndex:wt.collisionBoxArray.length,c2=Jn?Jn.boxStartIndex:wt.collisionBoxArray.length,u2=Jn?Jn.boxEndIndex:wt.collisionBoxArray.length,h2=xr?xr.boxStartIndex:wt.collisionBoxArray.length,d2=xr?xr.boxEndIndex:wt.collisionBoxArray.length;let rs=-1;const Ff=(Br,Bn)=>Br&&Br.circleDiameter?Math.max(Br.circleDiameter,Bn):Bn;rs=Ff(ys,rs),rs=Ff(Fn,rs),rs=Ff(Jn,rs),rs=Ff(xr,rs);const Jx=rs>-1?1:0;Jx&&(rs*=Vl/ar),wt.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ei.sortKey!==void 0&&wt.addToSortKeyRanges(wt.symbolInstances.length,Ei.sortKey);const p2=jx(pr,Ei,Xi),[f2,m2]=function(Br,Bn){const Ma=Br.length,ns=Bn==null?void 0:Bn.values;if((ns==null?void 0:ns.length)>0)for(let za=0;za<ns.length;za+=2){const vs=ns[za+1];Br.emplaceBack(w.aq[ns[za]],vs[0],vs[1])}return[Ma,Br.length]}(wt.textAnchorOffsets,p2);wt.symbolInstances.emplaceBack(qt.x,qt.y,Ws.right>=0?Ws.right:-1,Ws.center>=0?Ws.center:-1,Ws.left>=0?Ws.left:-1,Ws.vertical||-1,oy,ay,Kx,s2,o2,a2,l2,c2,u2,h2,d2,$r,Hx,Xx,Gs,Ku,Jx,0,fr,rs,f2,m2)}(i,It,ze,r,o,u,vt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,J,[_e,_e,_e,_e],pt,x,xe,Ce,Rt,F,t,f,P,A,m)};if(ct==="line")for(const ze of zx(t.geometry,0,0,or,or)){const It=Y1(ze,ue,Ue,r.vertical||U,o,24,re,i.overscaling,or);for(const wt of It)U&&r2(i,U.text,ot,wt)||_t(ze,wt)}else if(ct==="line-center"){for(const ze of t.geometry)if(ze.length>1){const It=J1(ze,Ue,r.vertical||U,o,24,re);It&&_t(ze,It)}}else if(t.type==="Polygon")for(const ze of il(t.geometry,0)){const It=e2(ze,16);_t(ze[0],new Ro(It.x,It.y,0))}else if(t.type==="LineString")for(const ze of t.geometry)_t(ze,new Ro(ze[0].x,ze[0].y,0));else if(t.type==="Point")for(const ze of t.geometry)for(const It of ze)_t([It],new Ro(It.x,It.y,0))}function Ux(i,t,r,o,u,f,m,_,x,P,A,E,D,F,U){const Z=function(xe,ue,_e,Ce,Ue,pt,Rt,ct){const ot=Ce.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,St=[];for(const vt of ue.positionedLines)for(const _t of vt.positionedGlyphs){if(!_t.rect)continue;const ze=_t.rect||{};let It=nx+1,wt=!0,qt=1,Ii=0;const Ti=(Ue||ct)&&_t.vertical,dr=_t.metrics.advance*_t.scale/2;if(ct&&ue.verticalizable&&(Ii=vt.lineOffset/2-(_t.imageName?-(ar-_t.metrics.width*_t.scale)/2:(_t.scale-1)*ar)),_t.imageName){const pi=Rt[_t.imageName];wt=pi.sdf,qt=pi.pixelRatio,It=un/qt}const $n=Ue?[_t.x+dr,_t.y]:[0,0];let kr=Ue?[0,0]:[_t.x+dr+_e[0],_t.y+_e[1]-Ii],pr=[0,0];Ti&&(pr=kr,kr=[0,0]);const Kr=_t.metrics.isDoubleResolution?2:1,$r=(_t.metrics.left-It)*_t.scale-dr+kr[0],Jr=(-_t.metrics.top-It)*_t.scale+kr[1],Qi=$r+ze.w/Kr*_t.scale/qt,fr=Jr+ze.h/Kr*_t.scale/qt,Fr=new N($r,Jr),Er=new N(Qi,Jr),Yr=new N($r,fr),Mr=new N(Qi,fr);if(Ti){const pi=new N(-dr,dr-Uu),Ei=-Math.PI/2,Fi=ar/2-dr,Sn=new N(5-Uu-Fi,-(_t.imageName?Fi:0)),Xi=new N(...pr);Fr._rotateAround(Ei,pi)._add(Sn)._add(Xi),Er._rotateAround(Ei,pi)._add(Sn)._add(Xi),Yr._rotateAround(Ei,pi)._add(Sn)._add(Xi),Mr._rotateAround(Ei,pi)._add(Sn)._add(Xi)}if(ot){const pi=Math.sin(ot),Ei=Math.cos(ot),Fi=[Ei,-pi,pi,Ei];Fr._matMult(Fi),Er._matMult(Fi),Yr._matMult(Fi),Mr._matMult(Fi)}const On=new N(0,0),hn=new N(0,0);St.push({tl:Fr,tr:Er,bl:Yr,br:Mr,tex:ze,writingMode:ue.writingMode,glyphOffset:$n,sectionIndex:_t.sectionIndex,isSDF:wt,pixelOffsetTL:On,pixelOffsetBR:hn,minFontScaleX:0,minFontScaleY:0})}return St}(0,r,_,u,f,m,o,i.allowVerticalPlacement),J=i.textSizeData;let re=null;J.kind==="source"?(re=[gs*u.layout.get("text-size").evaluate(m,{})],re[0]>Do&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Zu}. Reduce your "text-size".`)):J.kind==="composite"&&(re=[gs*F.compositeTextSizes[0].evaluate(m,{},U),gs*F.compositeTextSizes[1].evaluate(m,{},U)],(re[0]>Do||re[1]>Do)&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Zu}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,re,_,f,m,P,t,x.lineStartIndex,x.lineLength,D,U);for(const xe of A)E[xe]=i.text.placedSymbolArray.length-1;return 4*Z.length}function qx(i){for(const t in i)return i[t];return null}function r2(i,t,r,o){const u=i.compareText;if(t in u){const f=u[t];for(let m=f.length-1;m>=0;m--)if(o.dist(f[m])<r)return!0}else u[t]=[];return u[t].push(o),!1}const Zx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Q_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=Zx[15&o];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Q_(_,m,f,t)}constructor(t,r=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=Zx.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return ey(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:_}=this,x=[0,f.length-1,0],P=[];for(;x.length;){const A=x.pop()||0,E=x.pop()||0,D=x.pop()||0;if(E-D<=_){for(let J=D;J<=E;J++){const re=m[2*J],xe=m[2*J+1];re>=t&&re<=o&&xe>=r&&xe<=u&&P.push(f[J])}continue}const F=D+E>>1,U=m[2*F],Z=m[2*F+1];U>=t&&U<=o&&Z>=r&&Z<=u&&P.push(f[F]),(A===0?t<=U:r<=Z)&&(x.push(D),x.push(F-1),x.push(1-A)),(A===0?o>=U:u>=Z)&&(x.push(F+1),x.push(E),x.push(1-A))}return P}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,_=[0,u.length-1,0],x=[],P=o*o;for(;_.length;){const A=_.pop()||0,E=_.pop()||0,D=_.pop()||0;if(E-D<=m){for(let J=D;J<=E;J++)Wx(f[2*J],f[2*J+1],t,r)<=P&&x.push(u[J]);continue}const F=D+E>>1,U=f[2*F],Z=f[2*F+1];Wx(U,Z,t,r)<=P&&x.push(u[F]),(A===0?t-o<=U:r-o<=Z)&&(_.push(D),_.push(F-1),_.push(1-A)),(A===0?t+o>=U:r+o>=Z)&&(_.push(F+1),_.push(E),_.push(1-A))}return x}}function ey(i,t,r,o,u,f){if(u-o<=r)return;const m=o+u>>1;Gx(i,t,m,o,u,f),ey(i,t,r,o,m-1,1-f),ey(i,t,r,m+1,u,1-f)}function Gx(i,t,r,o,u,f){for(;u>o;){if(u-o>600){const P=u-o+1,A=r-o+1,E=Math.log(P),D=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*D*(P-D)/P)*(A-P/2<0?-1:1);Gx(i,t,r,Math.max(o,Math.floor(r-A*D/P+F)),Math.min(u,Math.floor(r+(P-A)*D/P+F)),f)}const m=t[2*r+f];let _=o,x=u;for(Hu(i,t,o,r),t[2*u+f]>m&&Hu(i,t,o,u);_<x;){for(Hu(i,t,_,x),_++,x--;t[2*_+f]<m;)_++;for(;t[2*x+f]>m;)x--}t[2*o+f]===m?Hu(i,t,o,x):(x++,Hu(i,t,x,u)),x<=r&&(o=x+1),r<=x&&(u=x-1)}}function Hu(i,t,r,o){ty(i,r,o),ty(t,2*r,2*o),ty(t,2*r+1,2*o+1)}function ty(i,t,r){const o=i[t];i[t]=i[r],i[r]=o}function Wx(i,t,r,o){const u=i-r,f=t-o;return u*u+f*f}var iy;w.bg=void 0,(iy=w.bg||(w.bg={})).create="create",iy.load="load",iy.fullLoad="fullLoad";let Of=null,Xu=[];const ry=1e3/60,ny="loadTime",sy="fullLoadTime",n2={mark(i){performance.mark(i)},frame(i){const t=i;Of!=null&&Xu.push(t-Of),Of=t},clearMetrics(){Of=null,Xu=[],performance.clearMeasures(ny),performance.clearMeasures(sy);for(const i in w.bg)performance.clearMarks(w.bg[i])},getPerformanceMetrics(){performance.measure(ny,w.bg.create,w.bg.load),performance.measure(sy,w.bg.create,w.bg.fullLoad);const i=performance.getEntriesByName(ny)[0].duration,t=performance.getEntriesByName(sy)[0].duration,r=Xu.length,o=1/(Xu.reduce((f,m)=>f+m,0)/r/1e3),u=Xu.filter(f=>f>ry).reduce((f,m)=>f+(m-ry)/ry,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(r+u)*100,totalFrames:r}}};w.$=class extends M{},w.A=Ml,w.B=p_,w.C=function(i){if(Xe==null){const t=i.navigator?i.navigator.userAgent:null;Xe=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Xe},w.D=xt,w.E=Ot,w.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new K1(()=>this.process()),this.subscription=function(r,o,u,f){return r.addEventListener(o,u,!1),{unsubscribe:()=>{r.removeEventListener(o,u,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=Ge(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:r,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const _={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const f=[],m=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:bo(i.data,f)});this.target.postMessage(m,{transfer:f})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(Ge(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(wo(t.error)):u.resolve(wo(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=wo(t.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,t,r){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?bo(t):null,data:bo(r,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},w.G=Ni,w.H=function(){var i=new Ml(16);return Ml!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},w.I=V_,w.J=function(i,t,r){var o,u,f,m,_,x,P,A,E,D,F,U,Z=r[0],J=r[1],re=r[2];return t===i?(i[12]=t[0]*Z+t[4]*J+t[8]*re+t[12],i[13]=t[1]*Z+t[5]*J+t[9]*re+t[13],i[14]=t[2]*Z+t[6]*J+t[10]*re+t[14],i[15]=t[3]*Z+t[7]*J+t[11]*re+t[15]):(u=t[1],f=t[2],m=t[3],_=t[4],x=t[5],P=t[6],A=t[7],E=t[8],D=t[9],F=t[10],U=t[11],i[0]=o=t[0],i[1]=u,i[2]=f,i[3]=m,i[4]=_,i[5]=x,i[6]=P,i[7]=A,i[8]=E,i[9]=D,i[10]=F,i[11]=U,i[12]=o*Z+_*J+E*re+t[12],i[13]=u*Z+x*J+D*re+t[13],i[14]=f*Z+P*J+F*re+t[14],i[15]=m*Z+A*J+U*re+t[15]),i},w.K=function(i,t,r){var o=r[0],u=r[1],f=r[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.L=Iv,w.M=function(i,t){const r={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(r[u]=i[u])}return r},w.N=Lo,w.O=bx,w.P=N,w.Q=wx,w.R=Ln,w.S=Rn,w.T=bl,w.U=Se,w.V=ge,w.W=at,w.X=or,w.Y=y,w.Z=Gu,w._=c,w.a=Jt,w.a$=function(i,t){var r=i[0],o=i[1],u=i[2],f=i[3],m=i[4],_=i[5],x=i[6],P=i[7],A=i[8],E=i[9],D=i[10],F=i[11],U=i[12],Z=i[13],J=i[14],re=i[15],xe=t[0],ue=t[1],_e=t[2],Ce=t[3],Ue=t[4],pt=t[5],Rt=t[6],ct=t[7],ot=t[8],St=t[9],vt=t[10],_t=t[11],ze=t[12],It=t[13],wt=t[14],qt=t[15];return Math.abs(r-xe)<=Xr*Math.max(1,Math.abs(r),Math.abs(xe))&&Math.abs(o-ue)<=Xr*Math.max(1,Math.abs(o),Math.abs(ue))&&Math.abs(u-_e)<=Xr*Math.max(1,Math.abs(u),Math.abs(_e))&&Math.abs(f-Ce)<=Xr*Math.max(1,Math.abs(f),Math.abs(Ce))&&Math.abs(m-Ue)<=Xr*Math.max(1,Math.abs(m),Math.abs(Ue))&&Math.abs(_-pt)<=Xr*Math.max(1,Math.abs(_),Math.abs(pt))&&Math.abs(x-Rt)<=Xr*Math.max(1,Math.abs(x),Math.abs(Rt))&&Math.abs(P-ct)<=Xr*Math.max(1,Math.abs(P),Math.abs(ct))&&Math.abs(A-ot)<=Xr*Math.max(1,Math.abs(A),Math.abs(ot))&&Math.abs(E-St)<=Xr*Math.max(1,Math.abs(E),Math.abs(St))&&Math.abs(D-vt)<=Xr*Math.max(1,Math.abs(D),Math.abs(vt))&&Math.abs(F-_t)<=Xr*Math.max(1,Math.abs(F),Math.abs(_t))&&Math.abs(U-ze)<=Xr*Math.max(1,Math.abs(U),Math.abs(ze))&&Math.abs(Z-It)<=Xr*Math.max(1,Math.abs(Z),Math.abs(It))&&Math.abs(J-wt)<=Xr*Math.max(1,Math.abs(J),Math.abs(wt))&&Math.abs(re-qt)<=Xr*Math.max(1,Math.abs(re),Math.abs(qt))},w.a0=li,w.a1=$_,w.a2=Ke,w.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of i){const u=window.document.createElement("source");zr(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},w.a4=function(){return Pt++},w.a5=ht,w.a6=Fl,w.a7=hu,w.a8=ka,w.a9=Ax,w.aA=function(i){if(i.type==="custom")return new X1(i);switch(i.type){case"background":return new G1(i);case"circle":return new zw(i);case"fill":return new Kw(i);case"fill-extrusion":return new u1(i);case"heatmap":return new Lw(i);case"hillshade":return new Ow(i);case"line":return new y1(i);case"raster":return new H1(i);case"symbol":return new Mf(i)}},w.aB=Re,w.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ei(i.version,t.version))return[{command:"setStyle",args:[t]}];ei(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ei(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ei(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ei(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ei(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ei(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ei(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ei(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),ei(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ei(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ei(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,_,x,P){let A;for(A in _=_||{},m=m||{})Object.prototype.hasOwnProperty.call(m,A)&&(Object.prototype.hasOwnProperty.call(_,A)||tn(A,x,P));for(A in _)Object.prototype.hasOwnProperty.call(_,A)&&(Object.prototype.hasOwnProperty.call(m,A)?ei(m[A],_[A])||(m[A].type==="geojson"&&_[A].type==="geojson"&&Zn(m,_,A)?vi(x,{command:"setGeoJSONSourceData",args:[A,_[A].data]}):ur(A,_,x,P)):dn(A,_,x))})(i.sources,t.sources,u,o);const f=[];i.layers&&i.layers.forEach(m=>{"source"in m&&o[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)}),r=r.concat(u),function(m,_,x){_=_||[];const P=(m=m||[]).map(In),A=_.map(In),E=m.reduce(us,{}),D=_.reduce(us,{}),F=P.slice(),U=Object.create(null);let Z,J,re,xe,ue;for(let _e=0,Ce=0;_e<P.length;_e++)Z=P[_e],Object.prototype.hasOwnProperty.call(D,Z)?Ce++:(vi(x,{command:"removeLayer",args:[Z]}),F.splice(F.indexOf(Z,Ce),1));for(let _e=0,Ce=0;_e<A.length;_e++)Z=A[A.length-1-_e],F[F.length-1-_e]!==Z&&(Object.prototype.hasOwnProperty.call(E,Z)?(vi(x,{command:"removeLayer",args:[Z]}),F.splice(F.lastIndexOf(Z,F.length-Ce),1)):Ce++,xe=F[F.length-_e],vi(x,{command:"addLayer",args:[D[Z],xe]}),F.splice(F.length-_e,0,Z),U[Z]=!0);for(let _e=0;_e<A.length;_e++)if(Z=A[_e],J=E[Z],re=D[Z],!U[Z]&&!ei(J,re))if(ei(J.source,re.source)&&ei(J["source-layer"],re["source-layer"])&&ei(J.type,re.type)){for(ue in Zr(J.layout,re.layout,x,Z,null,"setLayoutProperty"),Zr(J.paint,re.paint,x,Z,null,"setPaintProperty"),ei(J.filter,re.filter)||vi(x,{command:"setFilter",args:[Z,re.filter]}),ei(J.minzoom,re.minzoom)&&ei(J.maxzoom,re.maxzoom)||vi(x,{command:"setLayerZoomRange",args:[Z,re.minzoom,re.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Zr(J[ue],re[ue],x,Z,ue.slice(6),"setPaintProperty"):ei(J[ue],re[ue])||vi(x,{command:"setLayerProperty",args:[Z,ue,re[ue]]}));for(ue in re)Object.prototype.hasOwnProperty.call(re,ue)&&!Object.prototype.hasOwnProperty.call(J,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Zr(J[ue],re[ue],x,Z,ue.slice(6),"setPaintProperty"):ei(J[ue],re[ue])||vi(x,{command:"setLayerProperty",args:[Z,ue,re[ue]]}))}else vi(x,{command:"removeLayer",args:[Z]}),xe=F[F.lastIndexOf(Z)+1],vi(x,{command:"addLayer",args:[re,xe]})}(f,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},w.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},w.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!i(t[o],r[o]))return!1;return!0}return t===r},w.aF=$e,w.aG=nt,w.aH=class extends Ia{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},w.aI=yf,w.aJ=class extends Ia{constructor(i,t){super(i,t),this.current=Tw}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},w.aK=mv,w.aL=gv,w.aM=bi,w.aN=class extends Ia{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},w.aO=class extends Ia{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},w.aP=function(i,t,r,o,u,f,m){var _=1/(t-r),x=1/(o-u),P=1/(f-m);return i[0]=-2*_,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+r)*_,i[13]=(u+o)*x,i[14]=(m+f)*P,i[15]=1,i},w.aQ=Mw,w.aR=class extends de{},w.aS=w1,w.aT=class extends we{},w.aU=A_,w.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},w.aW=Mv,w.aX=Ir,w.aY=Dn,w.aZ=class extends bt{},w.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},w.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,u,f)=>{const m=u||f;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},w.ab=function(i,t){const r=[];for(const o in i)o in t||r.push(o);return r},w.ac=Le,w.ad=function(i,t,r){var o=Math.sin(r),u=Math.cos(r),f=t[0],m=t[1],_=t[2],x=t[3],P=t[4],A=t[5],E=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*u+P*o,i[1]=m*u+A*o,i[2]=_*u+E*o,i[3]=x*u+D*o,i[4]=P*u-f*o,i[5]=A*u-m*o,i[6]=E*u-_*o,i[7]=D*u-x*o,i},w.ae=function(i){var t=new Ml(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},w.af=wf,w.ag=function(i,t){let r=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=i,_=u?Le(Wr.interpolationFactor(u,t,f,m),0,1):0;i.kind==="camera"?o=Gr.number(i.minSize,i.maxSize,_):r=_}return{uSizeT:r,uSize:o}},w.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/gs:i.kind==="composite"?Gr.number(o/gs,u/gs,r):t},w.aj=Z_,w.ak=function(i,t,r,o){const u=t.y-i.y,f=t.x-i.x,m=o.y-r.y,_=o.x-r.x,x=m*f-_*u;if(x===0)return null;const P=(_*(i.y-r.y)-m*(i.x-r.x))/x;return new N(i.x+P*f,i.y+P*u)},w.al=zx,w.am=xv,w.an=P_,w.ao=function(i){let t=1/0,r=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[t,r,o,u]},w.ap=ar,w.ar=q_,w.as=function(i,t){var r=t[0],o=t[1],u=t[2],f=t[3],m=t[4],_=t[5],x=t[6],P=t[7],A=t[8],E=t[9],D=t[10],F=t[11],U=t[12],Z=t[13],J=t[14],re=t[15],xe=r*_-o*m,ue=r*x-u*m,_e=r*P-f*m,Ce=o*x-u*_,Ue=o*P-f*_,pt=u*P-f*x,Rt=A*Z-E*U,ct=A*J-D*U,ot=A*re-F*U,St=E*J-D*Z,vt=E*re-F*Z,_t=D*re-F*J,ze=xe*_t-ue*vt+_e*St+Ce*ot-Ue*ct+pt*Rt;return ze?(i[0]=(_*_t-x*vt+P*St)*(ze=1/ze),i[1]=(u*vt-o*_t-f*St)*ze,i[2]=(Z*pt-J*Ue+re*Ce)*ze,i[3]=(D*Ue-E*pt-F*Ce)*ze,i[4]=(x*ot-m*_t-P*ct)*ze,i[5]=(r*_t-u*ot+f*ct)*ze,i[6]=(J*_e-U*pt-re*ue)*ze,i[7]=(A*pt-D*_e+F*ue)*ze,i[8]=(m*vt-_*ot+P*Rt)*ze,i[9]=(o*ot-r*vt-f*Rt)*ze,i[10]=(U*Ue-Z*_e+re*xe)*ze,i[11]=(E*_e-A*Ue-F*xe)*ze,i[12]=(_*ct-m*St-x*Rt)*ze,i[13]=(r*St-o*ct+u*Rt)*ze,i[14]=(Z*ue-U*Ce-J*xe)*ze,i[15]=(A*Ce-E*ue+D*xe)*ze,i):null},w.at=Y_,w.au=U_,w.av=Q_,w.aw=function(){const i={},t=ye.$version;for(const r in ye.$root){const o=ye.$root[r];if(o.required){let u=null;u=r==="version"?t:o.type==="array"?[]:{},u!=null&&(i[r]=u)}}return i},w.ax=Pu,w.ay=qi,w.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Dr(i[r],t[i[r].ref]));return i},w.b=ft,w.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},w.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},w.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},w.b3=We,w.b4=Px,w.b5=Sx,w.b6=function(i,t,r,o,u){var f,m=1/Math.tan(t/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(f=1/(o-u)),i[14]=2*u*o*f):(i[10]=-1,i[14]=-2*o),i},w.b7=function(i,t,r){var o=Math.sin(r),u=Math.cos(r),f=t[4],m=t[5],_=t[6],x=t[7],P=t[8],A=t[9],E=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*u+P*o,i[5]=m*u+A*o,i[6]=_*u+E*o,i[7]=x*u+D*o,i[8]=P*u-f*o,i[9]=A*u-m*o,i[10]=E*u-_*o,i[11]=D*u-x*o,i},w.b8=Ee,w.b9=Ne,w.bA=Jv,w.bB=function(i){return i.message===zt},w.bC=fo,w.bD=ln,w.ba=function(i){return i*Math.PI/180},w.bb=function(i,t){const{x:r,y:o}=Gu.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||r<0||r>=1)},w.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},w.bd=class extends k{},w.be=X_,w.bf=n2,w.bh=Ci,w.bi=function(i,t){Jt.REGISTERED_PROTOCOLS[i]=t},w.bj=function(i){delete Jt.REGISTERED_PROTOCOLS[i]},w.bk=function(i,t){const r={};for(let u=0;u<i.length;u++){const f=t&&t[i[u].id]||of(i[u]);t&&(t[i[u].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(i[u])}const o=[];for(const u in r)o.push(r[u]);return o},w.bl=yt,w.bm=Cx,w.bn=kx,w.bo=ox,w.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=or/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Di(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Di(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Di(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Di(P),i.canonical),o["text-size"].possiblyEvaluate(new Di(A),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:A}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Di(P),i.canonical),o["icon-size"].possiblyEvaluate(new Di(A),i.canonical)]}const f=r.get("text-line-height")*ar,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),x=r.get("text-size");for(const P of i.bucket.features){const A=r.get("text-font").evaluate(P,{},i.canonical).join(","),E=x.evaluate(P,{},i.canonical),D=u.layoutTextSize.evaluate(P,{},i.canonical),F=u.layoutIconSize.evaluate(P,{},i.canonical),U={horizontal:{},vertical:void 0},Z=P.text;let J,re=[0,0];if(Z){const _e=Z.toString(),Ce=r.get("text-letter-spacing").evaluate(P,{},i.canonical)*ar,Ue=f_(_e)?Ce:0,pt=r.get("text-anchor").evaluate(P,{},i.canonical),Rt=jx(t,P,i.canonical);if(!Rt){const vt=r.get("text-radial-offset").evaluate(P,{},i.canonical);re=vt?Vx(pt,[vt*ar,J_]):r.get("text-offset").evaluate(P,{},i.canonical).map(_t=>_t*ar)}let ct=m?"center":r.get("text-justify").evaluate(P,{},i.canonical);const ot=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(P,{},i.canonical)*ar:1/0,St=()=>{i.bucket.allowVerticalPlacement&&Iu(_e)&&(U.vertical=Af(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,pt,"left",Ue,re,w.ah.vertical,!0,D,E))};if(!m&&Rt){const vt=new Set;if(ct==="auto")for(let ze=0;ze<Rt.values.length;ze+=2)vt.add(Y_(Rt.values[ze]));else vt.add(ct);let _t=!1;for(const ze of vt)if(!U.horizontal[ze])if(_t)U.horizontal[ze]=U.horizontal[0];else{const It=Af(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,"center",ze,Ue,re,w.ah.horizontal,!1,D,E);It&&(U.horizontal[ze]=It,_t=It.positionedLines.length===1)}St()}else{ct==="auto"&&(ct=Y_(pt));const vt=Af(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,pt,ct,Ue,re,w.ah.horizontal,!1,D,E);vt&&(U.horizontal[ct]=vt),St(),Iu(_e)&&m&&_&&(U.vertical=Af(Z,i.glyphMap,i.glyphPositions,i.imagePositions,A,ot,f,pt,ct,Ue,re,w.ah.vertical,!1,D,E))}}let xe=!1;if(P.icon&&P.icon.name){const _e=i.imageMap[P.icon.name];_e&&(J=V1(i.imagePositions[P.icon.name],r.get("icon-offset").evaluate(P,{},i.canonical),r.get("icon-anchor").evaluate(P,{},i.canonical)),xe=!!_e.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=xe:i.bucket.sdfIcons!==xe&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ue=qx(U.horizontal)||U.vertical;i.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||J)&&i2(i.bucket,P,U,J,i.imageMap,u,D,F,re,xe,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},w.bq=O_,w.br=D_,w.bs=R_,w.bt=Mo,w.bu=B_,w.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},w.bw=function(i,t,r,o,u){return c(this,void 0,void 0,function*(){if(ge())try{return yield at(i,t,r,o,u)}catch{}return function(f,m,_,x,P){const A=f.width,E=f.height;ut&&Mt||(ut=new OffscreenCanvas(A,E),Mt=ut.getContext("2d",{willReadFrequently:!0})),ut.width=A,ut.height=E,Mt.drawImage(f,0,0,A,E);const D=Mt.getImageData(m,_,x,P);return Mt.clearRect(0,0,A,E),D.data}(i,t,r,o,u)})},w.bx=Ix,w.by=j,w.bz=q,w.c=ri,w.d=i=>c(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),w.e=tt,w.f=i=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=dt})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):dt}),w.g=fi,w.h=(i,t)=>Wi(tt(i,{type:"json"}),t),w.i=Ge,w.j=mt,w.k=cr,w.l=(i,t)=>Wi(tt(i,{type:"arrayBuffer"}),t),w.m=Wi,w.n=function(i){return new B_(i).readFields(D1,[])},w.o=Ru,w.p=sx,w.q=p,w.r=d_,w.s=zr,w.t=Su,w.u=js,w.v=ye,w.w=De,w.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},w.y=Gr,w.z=Di}),T("worker",["./shared"],function(w){class c{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,R){for(const Y of O){this._layerConfigs[Y.id]=Y;const he=this._layers[Y.id]=w.aA(Y);he._featureFilter=w.a7(he.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const W=w.bk(Object.values(this._layerConfigs),this.keyCache);for(const Y of W){const he=Y.map(Ie=>this._layers[Ie.id]),pe=he[0];if(pe.visibility==="none")continue;const ve=pe.source||"";let ae=this.familiesBySource[ve];ae||(ae=this.familiesBySource[ve]={});const ke=pe.sourceLayer||"_geojsonTileLayer";let Fe=ae[ke];Fe||(Fe=ae[ke]=[]),Fe.push(he)}}}class j{constructor(O){const R={},W=[];for(const ve in O){const ae=O[ve],ke=R[ve]={};for(const Fe in ae){const Ie=ae[+Fe];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Qe={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};W.push(Qe),ke[Fe]={rect:Qe,metrics:Ie.metrics}}}const{w:Y,h:he}=w.p(W),pe=new w.o({width:Y||1,height:he||1});for(const ve in O){const ae=O[ve];for(const ke in ae){const Fe=ae[+ke];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Ie=R[ve][ke].rect;w.o.copy(Fe.bitmap,pe,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},Fe.bitmap)}}this.image=pe,this.positions=R}}w.bl("GlyphAtlas",j);class q{constructor(O){this.tileID=new w.S(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,R,W,Y){return w._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new w.a5;const he=new w.bm(Object.keys(O.layers).sort()),pe=new w.bn(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const ve={},ae={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},ke=R.familiesBySource[this.source];for(const Yt in ke){const xi=O.layers[Yt];if(!xi)continue;xi.version===1&&w.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ji=he.encode(Yt),hr=[];for(let yr=0;yr<xi.length;yr++){const Lr=xi.feature(yr),io=pe.getId(Lr,Yt);hr.push({feature:Lr,id:io,index:yr,sourceLayerIndex:ji})}for(const yr of ke[Yt]){const Lr=yr[0];Lr.source!==this.source&&w.w(`layer.source = ${Lr.source} does not equal this.source = ${this.source}`),Lr.minzoom&&this.zoom<Math.floor(Lr.minzoom)||Lr.maxzoom&&this.zoom>=Lr.maxzoom||Lr.visibility!=="none"&&(K(yr,this.zoom,W),(ve[Lr.id]=Lr.createBucket({index:pe.bucketLayerIDs.length,layers:yr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ji,sourceID:this.source})).populate(hr,ae,this.tileID.canonical),pe.bucketLayerIDs.push(yr.map(io=>io.id)))}}const Fe=w.aF(ae.glyphDependencies,Yt=>Object.keys(Yt).map(Number));this.inFlightDependencies.forEach(Yt=>Yt==null?void 0:Yt.abort()),this.inFlightDependencies=[];let Ie=Promise.resolve({});if(Object.keys(Fe).length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),Ie=Y.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},Yt)}const Qe=Object.keys(ae.iconDependencies);let kt=Promise.resolve({});if(Qe.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),kt=Y.sendAsync({type:"GI",data:{icons:Qe,source:this.source,tileID:this.tileID,type:"icons"}},Yt)}const Dt=Object.keys(ae.patternDependencies);let ui=Promise.resolve({});if(Dt.length){const Yt=new AbortController;this.inFlightDependencies.push(Yt),ui=Y.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Yt)}const[Wt,hi,ni]=yield Promise.all([Ie,kt,ui]),nr=new j(Wt),Hi=new w.bo(hi,ni);for(const Yt in ve){const xi=ve[Yt];xi instanceof w.a6?(K(xi.layers,this.zoom,W),w.bp({bucket:xi,glyphMap:Wt,glyphPositions:nr.positions,imageMap:hi,imagePositions:Hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):xi.hasPattern&&(xi instanceof w.bq||xi instanceof w.br||xi instanceof w.bs)&&(K(xi.layers,this.zoom,W),xi.addFeatures(ae,this.tileID.canonical,Hi.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter(Yt=>!Yt.isEmpty()),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:nr.image,imageAtlas:Hi,glyphMap:this.returnDependencies?Wt:null,iconMap:this.returnDependencies?hi:null,glyphPositions:this.returnDependencies?nr.positions:null}})}}function K(te,O,R){const W=new w.z(O);for(const Y of te)Y.recalculate(W,R)}class N{constructor(O,R,W){this.actor=O,this.layerIndex=R,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,R){return w._(this,void 0,void 0,function*(){const W=yield w.l(O.request,R);try{return{vectorTile:new w.bt.VectorTile(new w.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(Y){const he=new Uint8Array(W.data);let pe=`Unable to parse the tile at ${O.request.url}, `;throw pe+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(pe)}})}loadTile(O){return w._(this,void 0,void 0,function*(){const R=O.uid,W=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request),Y=new q(O);this.loading[R]=Y;const he=new AbortController;Y.abort=he;try{const pe=yield this.loadVectorTile(O,he);if(delete this.loading[R],!pe)return null;const ve=pe.rawData,ae={};pe.expires&&(ae.expires=pe.expires),pe.cacheControl&&(ae.cacheControl=pe.cacheControl);const ke={};if(W){const Ie=W.finish();Ie&&(ke.resourceTiming=JSON.parse(JSON.stringify(Ie)))}Y.vectorTile=pe.vectorTile;const Fe=Y.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=Y,this.fetching[R]={rawTileData:ve,cacheControl:ae,resourceTiming:ke};try{const Ie=yield Fe;return w.e({rawTileData:ve.slice(0)},Ie,ae,ke)}finally{delete this.fetching[R]}}catch(pe){throw delete this.loading[R],Y.status="done",this.loaded[R]=Y,pe}})}reloadTile(O){return w._(this,void 0,void 0,function*(){const R=O.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[R];if(W.showCollisionBoxes=O.showCollisionBoxes,W.status==="parsing"){const Y=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[R]){const{rawTileData:pe,cacheControl:ve,resourceTiming:ae}=this.fetching[R];delete this.fetching[R],he=w.e({rawTileData:pe.slice(0)},Y,ve,ae)}else he=Y;return he}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return w._(this,void 0,void 0,function*(){const R=this.loading,W=O.uid;R&&R[W]&&R[W].abort&&(R[W].abort.abort(),delete R[W])})}removeTile(O){return w._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class V{constructor(){this.loaded={}}loadTile(O){return w._(this,void 0,void 0,function*(){const{uid:R,encoding:W,rawImageData:Y,redFactor:he,greenFactor:pe,blueFactor:ve,baseShift:ae}=O,ke=Y.width+2,Fe=Y.height+2,Ie=w.b(Y)?new w.R({width:ke,height:Fe},yield w.bw(Y,-1,-1,ke,Fe)):Y,Qe=new w.bx(R,Ie,W,he,pe,ve,ae);return this.loaded=this.loaded||{},this.loaded[R]=Qe,Qe})}removeTile(O){const R=this.loaded,W=O.uid;R&&R[W]&&delete R[W]}}function se(te,O){if(te.length!==0){ie(te[0],O);for(var R=1;R<te.length;R++)ie(te[R],!O)}}function ie(te,O){for(var R=0,W=0,Y=0,he=te.length,pe=he-1;Y<he;pe=Y++){var ve=(te[Y][0]-te[pe][0])*(te[pe][1]+te[Y][1]),ae=R+ve;W+=Math.abs(R)>=Math.abs(ve)?R-ae+ve:ve-ae+R,R=ae}R+W>=0!=!!O&&te.reverse()}var le=w.by(function te(O,R){var W,Y=O&&O.type;if(Y==="FeatureCollection")for(W=0;W<O.features.length;W++)te(O.features[W],R);else if(Y==="GeometryCollection")for(W=0;W<O.geometries.length;W++)te(O.geometries[W],R);else if(Y==="Feature")te(O.geometry,R);else if(Y==="Polygon")se(O.coordinates,R);else if(Y==="MultiPolygon")for(W=0;W<O.coordinates.length;W++)se(O.coordinates[W],R);return O});const fe=w.bt.VectorTileFeature.prototype.toGeoJSON;var Se={exports:{}},ge=w.bz,Ee=w.bt.VectorTileFeature,Ne=Le;function Le(te,O){this.options=O||{},this.features=te,this.length=te.length}function We(te,O){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=O||4096}Le.prototype.feature=function(te){return new We(this.features[te],this.options.extent)},We.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var O=0;O<te.length;O++){for(var R=te[O],W=[],Y=0;Y<R.length;Y++)W.push(new ge(R[Y][0],R[Y][1]));this.geometry.push(W)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,O=1/0,R=-1/0,W=1/0,Y=-1/0,he=0;he<te.length;he++)for(var pe=te[he],ve=0;ve<pe.length;ve++){var ae=pe[ve];O=Math.min(O,ae.x),R=Math.max(R,ae.x),W=Math.min(W,ae.y),Y=Math.max(Y,ae.y)}return[O,W,R,Y]},We.prototype.toGeoJSON=Ee.prototype.toGeoJSON;var tt=w.bA,Pt=Ne;function $e(te){var O=new tt;return function(R,W){for(var Y in R.layers)W.writeMessage(3,nt,R.layers[Y])}(te,O),O.finish()}function nt(te,O){var R;O.writeVarintField(15,te.version||1),O.writeStringField(1,te.name||""),O.writeVarintField(5,te.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<te.length;R++)W.feature=te.feature(R),O.writeMessage(2,Re,W);var Y=W.keys;for(R=0;R<Y.length;R++)O.writeStringField(3,Y[R]);var he=W.values;for(R=0;R<he.length;R++)O.writeMessage(4,Xe,he[R])}function Re(te,O){var R=te.feature;R.id!==void 0&&O.writeVarintField(1,R.id),O.writeMessage(2,Me,te),O.writeVarintField(3,R.type),O.writeMessage(4,Ge,R)}function Me(te,O){var R=te.feature,W=te.keys,Y=te.values,he=te.keycache,pe=te.valuecache;for(var ve in R.properties){var ae=R.properties[ve],ke=he[ve];if(ae!==null){ke===void 0&&(W.push(ve),he[ve]=ke=W.length-1),O.writeVarint(ke);var Fe=typeof ae;Fe!=="string"&&Fe!=="boolean"&&Fe!=="number"&&(ae=JSON.stringify(ae));var Ie=Fe+":"+ae,Qe=pe[Ie];Qe===void 0&&(Y.push(ae),pe[Ie]=Qe=Y.length-1),O.writeVarint(Qe)}}}function De(te,O){return(O<<3)+(7&te)}function Ae(te){return te<<1^te>>31}function Ge(te,O){for(var R=te.loadGeometry(),W=te.type,Y=0,he=0,pe=R.length,ve=0;ve<pe;ve++){var ae=R[ve],ke=1;W===1&&(ke=ae.length),O.writeVarint(De(1,ke));for(var Fe=W===3?ae.length-1:ae.length,Ie=0;Ie<Fe;Ie++){Ie===1&&W!==1&&O.writeVarint(De(2,Fe-1));var Qe=ae[Ie].x-Y,kt=ae[Ie].y-he;O.writeVarint(Ae(Qe)),O.writeVarint(Ae(kt)),Y+=Qe,he+=kt}W===3&&O.writeVarint(De(7,1))}}function Xe(te,O){var R=typeof te;R==="string"?O.writeStringField(1,te):R==="boolean"?O.writeBooleanField(7,te):R==="number"&&(te%1!=0?O.writeDoubleField(3,te):te<0?O.writeSVarintField(6,te):O.writeVarintField(5,te))}Se.exports=$e,Se.exports.fromVectorTileJs=$e,Se.exports.fromGeojsonVt=function(te,O){O=O||{};var R={};for(var W in te)R[W]=new Pt(te[W].features,O),R[W].name=W,R[W].version=O.version,R[W].extent=O.extent;return $e({layers:R})},Se.exports.GeoJSONWrapper=Pt;var ft=w.by(Se.exports);const dt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:te=>te},at=Math.fround||(ut=new Float32Array(1),te=>(ut[0]=+te,ut[0]));var ut;const Mt=3,zt=5,ri=6;class Jt{constructor(O){this.options=Object.assign(Object.create(dt),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:R,minZoom:W,maxZoom:Y}=this.options;R&&console.time("total time");const he=`prepare ${O.length} points`;R&&console.time(he),this.points=O;const pe=[];for(let ae=0;ae<O.length;ae++){const ke=O[ae];if(!ke.geometry)continue;const[Fe,Ie]=ke.geometry.coordinates,Qe=at(Ci(Fe)),kt=at(qi(Ie));pe.push(Qe,kt,1/0,ae,-1,1),this.options.reduce&&pe.push(0)}let ve=this.trees[Y+1]=this._createTree(pe);R&&console.timeEnd(he);for(let ae=Y;ae>=W;ae--){const ke=+Date.now();ve=this.trees[ae]=this._createTree(this._cluster(ve,ae)),R&&console.log("z%d: %d clusters in %dms",ae,ve.numItems,+Date.now()-ke)}return R&&console.timeEnd("total time"),this}getClusters(O,R){let W=((O[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,O[1]));let he=O[2]===180?180:((O[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)W=-180,he=180;else if(W>he){const Ie=this.getClusters([W,Y,180,pe],R),Qe=this.getClusters([-180,Y,he,pe],R);return Ie.concat(Qe)}const ve=this.trees[this._limitZoom(R)],ae=ve.range(Ci(W),qi(pe),Ci(he),qi(Y)),ke=ve.data,Fe=[];for(const Ie of ae){const Qe=this.stride*Ie;Fe.push(ke[Qe+zt]>1?fi(ke,Qe,this.clusterProps):this.points[ke[Qe+Mt]])}return Fe}getChildren(O){const R=this._getOriginId(O),W=this._getOriginZoom(O),Y="No cluster with the specified id.",he=this.trees[W];if(!he)throw new Error(Y);const pe=he.data;if(R*this.stride>=pe.length)throw new Error(Y);const ve=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ae=he.within(pe[R*this.stride],pe[R*this.stride+1],ve),ke=[];for(const Fe of ae){const Ie=Fe*this.stride;pe[Ie+4]===O&&ke.push(pe[Ie+zt]>1?fi(pe,Ie,this.clusterProps):this.points[pe[Ie+Mt]])}if(ke.length===0)throw new Error(Y);return ke}getLeaves(O,R,W){const Y=[];return this._appendLeaves(Y,O,R=R||10,W=W||0,0),Y}getTile(O,R,W){const Y=this.trees[this._limitZoom(O)],he=Math.pow(2,O),{extent:pe,radius:ve}=this.options,ae=ve/pe,ke=(W-ae)/he,Fe=(W+1+ae)/he,Ie={features:[]};return this._addTileFeatures(Y.range((R-ae)/he,ke,(R+1+ae)/he,Fe),Y.data,R,W,he,Ie),R===0&&this._addTileFeatures(Y.range(1-ae/he,ke,1,Fe),Y.data,he,W,he,Ie),R===he-1&&this._addTileFeatures(Y.range(0,ke,ae/he,Fe),Y.data,-1,W,he,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(O){let R=this._getOriginZoom(O)-1;for(;R<=this.options.maxZoom;){const W=this.getChildren(O);if(R++,W.length!==1)break;O=W[0].properties.cluster_id}return R}_appendLeaves(O,R,W,Y,he){const pe=this.getChildren(R);for(const ve of pe){const ae=ve.properties;if(ae&&ae.cluster?he+ae.point_count<=Y?he+=ae.point_count:he=this._appendLeaves(O,ae.cluster_id,W,Y,he):he<Y?he++:O.push(ve),O.length===W)break}return he}_createTree(O){const R=new w.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<O.length;W+=this.stride)R.add(O[W],O[W+1]);return R.finish(),R.data=O,R}_addTileFeatures(O,R,W,Y,he,pe){for(const ve of O){const ae=ve*this.stride,ke=R[ae+zt]>1;let Fe,Ie,Qe;if(ke)Fe=Ni(R,ae,this.clusterProps),Ie=R[ae],Qe=R[ae+1];else{const ui=this.points[R[ae+Mt]];Fe=ui.properties;const[Wt,hi]=ui.geometry.coordinates;Ie=Ci(Wt),Qe=qi(hi)}const kt={type:1,geometry:[[Math.round(this.options.extent*(Ie*he-W)),Math.round(this.options.extent*(Qe*he-Y))]],tags:Fe};let Dt;Dt=ke||this.options.generateId?R[ae+Mt]:this.points[R[ae+Mt]].id,Dt!==void 0&&(kt.id=Dt),pe.features.push(kt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,R){const{radius:W,extent:Y,reduce:he,minPoints:pe}=this.options,ve=W/(Y*Math.pow(2,R)),ae=O.data,ke=[],Fe=this.stride;for(let Ie=0;Ie<ae.length;Ie+=Fe){if(ae[Ie+2]<=R)continue;ae[Ie+2]=R;const Qe=ae[Ie],kt=ae[Ie+1],Dt=O.within(ae[Ie],ae[Ie+1],ve),ui=ae[Ie+zt];let Wt=ui;for(const hi of Dt){const ni=hi*Fe;ae[ni+2]>R&&(Wt+=ae[ni+zt])}if(Wt>ui&&Wt>=pe){let hi,ni=Qe*ui,nr=kt*ui,Hi=-1;const Yt=((Ie/Fe|0)<<5)+(R+1)+this.points.length;for(const xi of Dt){const ji=xi*Fe;if(ae[ji+2]<=R)continue;ae[ji+2]=R;const hr=ae[ji+zt];ni+=ae[ji]*hr,nr+=ae[ji+1]*hr,ae[ji+4]=Yt,he&&(hi||(hi=this._map(ae,Ie,!0),Hi=this.clusterProps.length,this.clusterProps.push(hi)),he(hi,this._map(ae,ji)))}ae[Ie+4]=Yt,ke.push(ni/Wt,nr/Wt,1/0,Yt,-1,Wt),he&&ke.push(Hi)}else{for(let hi=0;hi<Fe;hi++)ke.push(ae[Ie+hi]);if(Wt>1)for(const hi of Dt){const ni=hi*Fe;if(!(ae[ni+2]<=R)){ae[ni+2]=R;for(let nr=0;nr<Fe;nr++)ke.push(ae[ni+nr])}}}}return ke}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,R,W){if(O[R+zt]>1){const pe=this.clusterProps[O[R+ri]];return W?Object.assign({},pe):pe}const Y=this.points[O[R+Mt]].properties,he=this.options.map(Y);return W&&he===Y?Object.assign({},he):he}}function fi(te,O,R){return{type:"Feature",id:te[O+Mt],properties:Ni(te,O,R),geometry:{type:"Point",coordinates:[(W=te[O],360*(W-.5)),Wi(te[O+1])]}};var W}function Ni(te,O,R){const W=te[O+zt],Y=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,he=te[O+ri],pe=he===-1?{}:Object.assign({},R[he]);return Object.assign(pe,{cluster:!0,cluster_id:te[O+Mt],point_count:W,point_count_abbreviated:Y})}function Ci(te){return te/360+.5}function qi(te){const O=Math.sin(te*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function Wi(te){const O=(180-360*te)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function zr(te,O,R,W){let Y=W;const he=O+(R-O>>1);let pe,ve=R-O;const ae=te[O],ke=te[O+1],Fe=te[R],Ie=te[R+1];for(let Qe=O+3;Qe<R;Qe+=3){const kt=Vi(te[Qe],te[Qe+1],ae,ke,Fe,Ie);if(kt>Y)pe=Qe,Y=kt;else if(kt===Y){const Dt=Math.abs(Qe-he);Dt<ve&&(pe=Qe,ve=Dt)}}Y>W&&(pe-O>3&&zr(te,O,pe,W),te[pe+2]=Y,R-pe>3&&zr(te,pe,R,W))}function Vi(te,O,R,W,Y,he){let pe=Y-R,ve=he-W;if(pe!==0||ve!==0){const ae=((te-R)*pe+(O-W)*ve)/(pe*pe+ve*ve);ae>1?(R=Y,W=he):ae>0&&(R+=pe*ae,W+=ve*ae)}return pe=te-R,ve=O-W,pe*pe+ve*ve}function Ai(te,O,R,W){const Y={id:te??null,type:O,geometry:R,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")cr(Y,R);else if(O==="Polygon")cr(Y,R[0]);else if(O==="MultiLineString")for(const he of R)cr(Y,he);else if(O==="MultiPolygon")for(const he of R)cr(Y,he[0]);return Y}function cr(te,O){for(let R=0;R<O.length;R+=3)te.minX=Math.min(te.minX,O[R]),te.minY=Math.min(te.minY,O[R+1]),te.maxX=Math.max(te.maxX,O[R]),te.maxY=Math.max(te.maxY,O[R+1])}function mt(te,O,R,W){if(!O.geometry)return;const Y=O.geometry.coordinates;if(Y&&Y.length===0)return;const he=O.geometry.type,pe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let ve=[],ae=O.id;if(R.promoteId?ae=O.properties[R.promoteId]:R.generateId&&(ae=W||0),he==="Point")Ot(Y,ve);else if(he==="MultiPoint")for(const ke of Y)Ot(ke,ve);else if(he==="LineString")ye(Y,ve,pe,!1);else if(he==="MultiLineString"){if(R.lineMetrics){for(const ke of Y)ve=[],ye(ke,ve,pe,!1),te.push(Ai(ae,"LineString",ve,O.properties));return}zi(Y,ve,pe,!1)}else if(he==="Polygon")zi(Y,ve,pe,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(const ke of O.geometry.geometries)mt(te,{id:ae,geometry:ke,properties:O.properties},R,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of Y){const Fe=[];zi(ke,Fe,pe,!0),ve.push(Fe)}}te.push(Ai(ae,he,ve,O.properties))}function Ot(te,O){O.push(Dr(te[0]),ei(te[1]),0)}function ye(te,O,R,W){let Y,he,pe=0;for(let ae=0;ae<te.length;ae++){const ke=Dr(te[ae][0]),Fe=ei(te[ae][1]);O.push(ke,Fe,0),ae>0&&(pe+=W?(Y*Fe-ke*he)/2:Math.sqrt(Math.pow(ke-Y,2)+Math.pow(Fe-he,2))),Y=ke,he=Fe}const ve=O.length-3;O[2]=1,zr(O,0,ve,R),O[ve+2]=1,O.size=Math.abs(pe),O.start=0,O.end=O.size}function zi(te,O,R,W){for(let Y=0;Y<te.length;Y++){const he=[];ye(te[Y],he,R,W),O.push(he)}}function Dr(te){return te/360+.5}function ei(te){const O=Math.sin(te*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function vi(te,O,R,W,Y,he,pe,ve){if(W/=O,he>=(R/=O)&&pe<W)return te;if(pe<R||he>=W)return null;const ae=[];for(const ke of te){const Fe=ke.geometry;let Ie=ke.type;const Qe=Y===0?ke.minX:ke.minY,kt=Y===0?ke.maxX:ke.maxY;if(Qe>=R&&kt<W){ae.push(ke);continue}if(kt<R||Qe>=W)continue;let Dt=[];if(Ie==="Point"||Ie==="MultiPoint")dn(Fe,Dt,R,W,Y);else if(Ie==="LineString")tn(Fe,Dt,R,W,Y,!1,ve.lineMetrics);else if(Ie==="MultiLineString")Zn(Fe,Dt,R,W,Y,!1);else if(Ie==="Polygon")Zn(Fe,Dt,R,W,Y,!0);else if(Ie==="MultiPolygon")for(const ui of Fe){const Wt=[];Zn(ui,Wt,R,W,Y,!0),Wt.length&&Dt.push(Wt)}if(Dt.length){if(ve.lineMetrics&&Ie==="LineString"){for(const ui of Dt)ae.push(Ai(ke.id,Ie,ui,ke.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(Dt.length===1?(Ie="LineString",Dt=Dt[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=Dt.length===3?"Point":"MultiPoint"),ae.push(Ai(ke.id,Ie,Dt,ke.tags))}}return ae.length?ae:null}function dn(te,O,R,W,Y){for(let he=0;he<te.length;he+=3){const pe=te[he+Y];pe>=R&&pe<=W&&Zr(O,te[he],te[he+1],te[he+2])}}function tn(te,O,R,W,Y,he,pe){let ve=ur(te);const ae=Y===0?In:us;let ke,Fe,Ie=te.start;for(let Wt=0;Wt<te.length-3;Wt+=3){const hi=te[Wt],ni=te[Wt+1],nr=te[Wt+2],Hi=te[Wt+3],Yt=te[Wt+4],xi=Y===0?hi:ni,ji=Y===0?Hi:Yt;let hr=!1;pe&&(ke=Math.sqrt(Math.pow(hi-Hi,2)+Math.pow(ni-Yt,2))),xi<R?ji>R&&(Fe=ae(ve,hi,ni,Hi,Yt,R),pe&&(ve.start=Ie+ke*Fe)):xi>W?ji<W&&(Fe=ae(ve,hi,ni,Hi,Yt,W),pe&&(ve.start=Ie+ke*Fe)):Zr(ve,hi,ni,nr),ji<R&&xi>=R&&(Fe=ae(ve,hi,ni,Hi,Yt,R),hr=!0),ji>W&&xi<=W&&(Fe=ae(ve,hi,ni,Hi,Yt,W),hr=!0),!he&&hr&&(pe&&(ve.end=Ie+ke*Fe),O.push(ve),ve=ur(te)),pe&&(Ie+=ke)}let Qe=te.length-3;const kt=te[Qe],Dt=te[Qe+1],ui=Y===0?kt:Dt;ui>=R&&ui<=W&&Zr(ve,kt,Dt,te[Qe+2]),Qe=ve.length-3,he&&Qe>=3&&(ve[Qe]!==ve[0]||ve[Qe+1]!==ve[1])&&Zr(ve,ve[0],ve[1],ve[2]),ve.length&&O.push(ve)}function ur(te){const O=[];return O.size=te.size,O.start=te.start,O.end=te.end,O}function Zn(te,O,R,W,Y,he){for(const pe of te)tn(pe,O,R,W,Y,he,!1)}function Zr(te,O,R,W){te.push(O,R,W)}function In(te,O,R,W,Y,he){const pe=(he-O)/(W-O);return Zr(te,he,R+(Y-R)*pe,1),pe}function us(te,O,R,W,Y,he){const pe=(he-R)/(Y-R);return Zr(te,O+(W-O)*pe,he,1),pe}function Ke(te,O){const R=[];for(let W=0;W<te.length;W++){const Y=te[W],he=Y.type;let pe;if(he==="Point"||he==="MultiPoint"||he==="LineString")pe=pn(Y.geometry,O);else if(he==="MultiLineString"||he==="Polygon"){pe=[];for(const ve of Y.geometry)pe.push(pn(ve,O))}else if(he==="MultiPolygon"){pe=[];for(const ve of Y.geometry){const ae=[];for(const ke of ve)ae.push(pn(ke,O));pe.push(ae)}}R.push(Ai(Y.id,he,pe,Y.tags))}return R}function pn(te,O){const R=[];R.size=te.size,te.start!==void 0&&(R.start=te.start,R.end=te.end);for(let W=0;W<te.length;W+=3)R.push(te[W]+O,te[W+1],te[W+2]);return R}function mr(te,O){if(te.transformed)return te;const R=1<<te.z,W=te.x,Y=te.y;for(const he of te.features){const pe=he.geometry,ve=he.type;if(he.geometry=[],ve===1)for(let ae=0;ae<pe.length;ae+=2)he.geometry.push(fn(pe[ae],pe[ae+1],O,R,W,Y));else for(let ae=0;ae<pe.length;ae++){const ke=[];for(let Fe=0;Fe<pe[ae].length;Fe+=2)ke.push(fn(pe[ae][Fe],pe[ae][Fe+1],O,R,W,Y));he.geometry.push(ke)}}return te.transformed=!0,te}function fn(te,O,R,W,Y,he){return[Math.round(R*(te*W-Y)),Math.round(R*(O*W-he))]}function Qn(te,O,R,W,Y){const he=O===Y.maxZoom?0:Y.tolerance/((1<<O)*Y.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:te.length,source:null,x:R,y:W,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of te)Ye(pe,ve,he,Y);return pe}function Ye(te,O,R,W){const Y=O.geometry,he=O.type,pe=[];if(te.minX=Math.min(te.minX,O.minX),te.minY=Math.min(te.minY,O.minY),te.maxX=Math.max(te.maxX,O.maxX),te.maxY=Math.max(te.maxY,O.maxY),he==="Point"||he==="MultiPoint")for(let ve=0;ve<Y.length;ve+=3)pe.push(Y[ve],Y[ve+1]),te.numPoints++,te.numSimplified++;else if(he==="LineString")Ht(pe,Y,te,R,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(let ve=0;ve<Y.length;ve++)Ht(pe,Y[ve],te,R,he==="Polygon",ve===0);else if(he==="MultiPolygon")for(let ve=0;ve<Y.length;ve++){const ae=Y[ve];for(let ke=0;ke<ae.length;ke++)Ht(pe,ae[ke],te,R,!0,ke===0)}if(pe.length){let ve=O.tags||null;if(he==="LineString"&&W.lineMetrics){ve={};for(const ke in O.tags)ve[ke]=O.tags[ke];ve.mapbox_clip_start=Y.start/Y.size,ve.mapbox_clip_end=Y.end/Y.size}const ae={geometry:pe,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:ve};O.id!==null&&(ae.id=O.id),te.features.push(ae)}}function Ht(te,O,R,W,Y,he){const pe=W*W;if(W>0&&O.size<(Y?pe:W))return void(R.numPoints+=O.length/3);const ve=[];for(let ae=0;ae<O.length;ae+=3)(W===0||O[ae+2]>pe)&&(R.numSimplified++,ve.push(O[ae],O[ae+1])),R.numPoints++;Y&&function(ae,ke){let Fe=0;for(let Ie=0,Qe=ae.length,kt=Qe-2;Ie<Qe;kt=Ie,Ie+=2)Fe+=(ae[Ie]-ae[kt])*(ae[Ie+1]+ae[kt+1]);if(Fe>0===ke)for(let Ie=0,Qe=ae.length;Ie<Qe/2;Ie+=2){const kt=ae[Ie],Dt=ae[Ie+1];ae[Ie]=ae[Qe-2-Ie],ae[Ie+1]=ae[Qe-1-Ie],ae[Qe-2-Ie]=kt,ae[Qe-1-Ie]=Dt}}(ve,he),te.push(ve)}const Nt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gr{constructor(O,R){const W=(R=this.options=function(he,pe){for(const ve in pe)he[ve]=pe[ve];return he}(Object.create(Nt),R)).debug;if(W&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(he,pe){const ve=[];if(he.type==="FeatureCollection")for(let ae=0;ae<he.features.length;ae++)mt(ve,he.features[ae],pe,ae);else mt(ve,he.type==="Feature"?he:{geometry:he},pe);return ve}(O,R);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(he,pe){const ve=pe.buffer/pe.extent;let ae=he;const ke=vi(he,1,-1-ve,ve,0,-1,2,pe),Fe=vi(he,1,1-ve,2+ve,0,-1,2,pe);return(ke||Fe)&&(ae=vi(he,1,-ve,1+ve,0,-1,2,pe)||[],ke&&(ae=Ke(ke,1).concat(ae)),Fe&&(ae=ae.concat(Ke(Fe,-1)))),ae}(Y,R),Y.length&&this.splitTile(Y,0,0,0),W&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,R,W,Y,he,pe,ve){const ae=[O,R,W,Y],ke=this.options,Fe=ke.debug;for(;ae.length;){Y=ae.pop(),W=ae.pop(),R=ae.pop(),O=ae.pop();const Ie=1<<R,Qe=rn(R,W,Y);let kt=this.tiles[Qe];if(!kt&&(Fe>1&&console.time("creation"),kt=this.tiles[Qe]=Qn(O,R,W,Y,ke),this.tileCoords.push({z:R,x:W,y:Y}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,W,Y,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));const hr=`z${R}`;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(kt.source=O,he==null){if(R===ke.indexMaxZoom||kt.numPoints<=ke.indexMaxPoints)continue}else{if(R===ke.maxZoom||R===he)continue;if(he!=null){const hr=he-R;if(W!==pe>>hr||Y!==ve>>hr)continue}}if(kt.source=null,O.length===0)continue;Fe>1&&console.time("clipping");const Dt=.5*ke.buffer/ke.extent,ui=.5-Dt,Wt=.5+Dt,hi=1+Dt;let ni=null,nr=null,Hi=null,Yt=null,xi=vi(O,Ie,W-Dt,W+Wt,0,kt.minX,kt.maxX,ke),ji=vi(O,Ie,W+ui,W+hi,0,kt.minX,kt.maxX,ke);O=null,xi&&(ni=vi(xi,Ie,Y-Dt,Y+Wt,1,kt.minY,kt.maxY,ke),nr=vi(xi,Ie,Y+ui,Y+hi,1,kt.minY,kt.maxY,ke),xi=null),ji&&(Hi=vi(ji,Ie,Y-Dt,Y+Wt,1,kt.minY,kt.maxY,ke),Yt=vi(ji,Ie,Y+ui,Y+hi,1,kt.minY,kt.maxY,ke),ji=null),Fe>1&&console.timeEnd("clipping"),ae.push(ni||[],R+1,2*W,2*Y),ae.push(nr||[],R+1,2*W,2*Y+1),ae.push(Hi||[],R+1,2*W+1,2*Y),ae.push(Yt||[],R+1,2*W+1,2*Y+1)}}getTile(O,R,W){O=+O,R=+R,W=+W;const Y=this.options,{extent:he,debug:pe}=Y;if(O<0||O>24)return null;const ve=1<<O,ae=rn(O,R=R+ve&ve-1,W);if(this.tiles[ae])return mr(this.tiles[ae],he);pe>1&&console.log("drilling down to z%d-%d-%d",O,R,W);let ke,Fe=O,Ie=R,Qe=W;for(;!ke&&Fe>0;)Fe--,Ie>>=1,Qe>>=1,ke=this.tiles[rn(Fe,Ie,Qe)];return ke&&ke.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",Fe,Ie,Qe),console.time("drilling down")),this.splitTile(ke.source,Fe,Ie,Qe,O,R,W),pe>1&&console.timeEnd("drilling down"),this.tiles[ae]?mr(this.tiles[ae],he):null):null}}function rn(te,O,R){return 32*((1<<te)*R+O)+te}function Vt(te,O){return O?te.properties[O]:te.id}function _r(te,O){if(te==null)return!0;if(te.type==="Feature")return Vt(te,O)!=null;if(te.type==="FeatureCollection"){const R=new Set;for(const W of te.features){const Y=Vt(W,O);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function mn(te,O){const R=new Map;if(te!=null)if(te.type==="Feature")R.set(Vt(te,O),te);else for(const W of te.features)R.set(Vt(W,O),W);return R}class hs extends N{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,R){return w._(this,void 0,void 0,function*(){const W=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!Y)return null;const he=new class{constructor(ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=w.X,this.length=ve.length,this._features=ve}feature(ve){return new class{constructor(ae){this._feature=ae,this.extent=w.X,this.type=ae.type,this.properties=ae.tags,"id"in ae&&!isNaN(ae.id)&&(this.id=parseInt(ae.id,10))}loadGeometry(){if(this._feature.type===1){const ae=[];for(const ke of this._feature.geometry)ae.push([new w.P(ke[0],ke[1])]);return ae}{const ae=[];for(const ke of this._feature.geometry){const Fe=[];for(const Ie of ke)Fe.push(new w.P(Ie[0],Ie[1]));ae.push(Fe)}return ae}}toGeoJSON(ae,ke,Fe){return fe.call(this,ae,ke,Fe)}}(this._features[ve])}}(Y.features);let pe=ft(he);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:he,rawData:pe.buffer}})}loadData(O){return w._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const W=!!(O&&O.request&&O.request.collectResourceTiming)&&new w.bv(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest),this._geoJSONIndex=O.cluster?new Jt(function({superclusterOptions:pe,clusterProperties:ve}){if(!ve||!pe)return pe;const ae={},ke={},Fe={accumulated:null,zoom:0},Ie={properties:null},Qe=Object.keys(ve);for(const kt of Qe){const[Dt,ui]=ve[kt],Wt=w.bC(ui),hi=w.bC(typeof Dt=="string"?[Dt,["accumulated"],["get",kt]]:Dt);ae[kt]=Wt.value,ke[kt]=hi.value}return pe.map=kt=>{Ie.properties=kt;const Dt={};for(const ui of Qe)Dt[ui]=ae[ui].evaluate(Fe,Ie);return Dt},pe.reduce=(kt,Dt)=>{Ie.properties=Dt;for(const ui of Qe)Fe.accumulated=kt[ui],kt[ui]=ke[ui].evaluate(Fe,Ie)},pe}(O)).load((yield this._pendingData).features):(Y=yield this._pendingData,new gr(Y,O.geojsonVtOptions)),this.loaded={};const he={};if(W){const pe=W.finish();pe&&(he.resourceTiming={},he.resourceTiming[O.source]=JSON.parse(JSON.stringify(pe)))}return he}catch(he){if(delete this._pendingRequest,w.bB(he))return{abandoned:!0};throw he}var Y})}getData(){return w._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){const R=this.loaded;return R&&R[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,R){return w._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(O,R);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(le(W,!0),O.filter){const Y=w.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(pe=>Y.value.evaluate({zoom:0},pe))}}return W})}loadGeoJSON(O,R){return w._(this,void 0,void 0,function*(){const{promoteId:W}=O;if(O.request){const Y=yield w.h(O.request,R);return this._dataUpdateable=_r(Y.data,W)?mn(Y.data,W):void 0,Y.data}if(typeof O.data=="string")try{const Y=JSON.parse(O.data);return this._dataUpdateable=_r(Y,W)?mn(Y,W):void 0,Y}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function(Y,he,pe){var ve,ae,ke,Fe;if(he.removeAll&&Y.clear(),he.remove)for(const Ie of he.remove)Y.delete(Ie);if(he.add)for(const Ie of he.add){const Qe=Vt(Ie,pe);Qe!=null&&Y.set(Qe,Ie)}if(he.update)for(const Ie of he.update){let Qe=Y.get(Ie.id);if(Qe==null)continue;const kt=!Ie.removeAllProperties&&(((ve=Ie.removeProperties)===null||ve===void 0?void 0:ve.length)>0||((ae=Ie.addOrUpdateProperties)===null||ae===void 0?void 0:ae.length)>0);if((Ie.newGeometry||Ie.removeAllProperties||kt)&&(Qe=Object.assign({},Qe),Y.set(Ie.id,Qe),kt&&(Qe.properties=Object.assign({},Qe.properties))),Ie.newGeometry&&(Qe.geometry=Ie.newGeometry),Ie.removeAllProperties)Qe.properties={};else if(((ke=Ie.removeProperties)===null||ke===void 0?void 0:ke.length)>0)for(const Dt of Ie.removeProperties)Object.prototype.hasOwnProperty.call(Qe.properties,Dt)&&delete Qe.properties[Dt];if(((Fe=Ie.addOrUpdateProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const{key:Dt,value:ui}of Ie.addOrUpdateProperties)Qe.properties[Dt]=ui}}(this._dataUpdateable,O.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return w._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Gn{constructor(O){this.self=O,this.actor=new w.F(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,W)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=W},this.self.addProtocol=w.bi,this.self.removeProtocol=w.bj,this.self.registerRTLTextPlugin=R=>{if(w.bD.isParsed())throw new Error("RTL text plugin already registered.");w.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,W)=>this._getDEMWorkerSource(R,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(R,W)=>w._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(R,W)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(R,W)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(R,W)=>w._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(R,W)=>this._getWorkerSource(R,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(R,W)=>this._getWorkerSource(R,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(R,W)=>this._getWorkerSource(R,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(R,W)=>this._getWorkerSource(R,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(R,W)=>w._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][W.type]||!this.workerSources[R][W.type][W.source])return;const Y=this.workerSources[R][W.type][W.source];delete this.workerSources[R][W.type][W.source],Y.removeSource!==void 0&&Y.removeSource(W)})),this.actor.registerMessageHandler("RM",R=>w._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,W)=>w._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(R,W)=>this._syncRTLPluginState(R,W)),this.actor.registerMessageHandler("IS",(R,W)=>w._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(R,W)=>this._setImages(R,W)),this.actor.registerMessageHandler("UL",(R,W)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(R,W)=>w._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(W)}))}_setImages(O,R){return w._(this,void 0,void 0,function*(){this.availableImages[O]=R;for(const W in this.workerSources[O]){const Y=this.workerSources[O][W];for(const he in Y)Y[he].availableImages=R}})}_syncRTLPluginState(O,R){return w._(this,void 0,void 0,function*(){if(w.bD.isParsed())return w.bD.getState();if(R.pluginStatus!=="loading")return w.bD.setState(R),R;const W=R.pluginURL;if(this.self.importScripts(W),w.bD.isParsed()){const Y={pluginStatus:"loaded",pluginURL:W};return w.bD.setState(Y),Y}throw w.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)})}_getAvailableImages(O){let R=this.availableImages[O];return R||(R=[]),R}_getLayerIndex(O){let R=this.layerIndexes[O];return R||(R=this.layerIndexes[O]=new c),R}_getWorkerSource(O,R,W){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][R]||(this.workerSources[O][R]={}),!this.workerSources[O][R][W]){const Y={sendAsync:(he,pe)=>(he.targetMapId=O,this.actor.sendAsync(he,pe))};switch(R){case"vector":this.workerSources[O][R][W]=new N(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][R][W]=new hs(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][R][W]=new this.externalWorkerSourceTypes[R](Y,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][R][W]}_getDEMWorkerSource(O,R){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][R]||(this.demWorkerSources[O][R]=new V),this.demWorkerSources[O][R]}}return w.i(self)&&(self.worker=new Gn(self)),Gn}),T("index",["exports","./shared"],function(w,c){var j="4.7.1";let q,K;const N={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((e,n)=>{const a=requestAnimationFrame(e);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),n(c.c())})}),getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,n.drawImage(p,0,0,p.width,p.height),n},resolveURL:p=>(q||(q=document.createElement("a")),q.href=p,q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in V.docStyle)return e[n];return e[0]}static create(e,n,a){const l=window.document.createElement(e);return n!==void 0&&(l.className=n),a&&a.appendChild(l),l}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,n){e.style[V.transformProp]=n}static addEventListener(e,n,a,l={}){e.addEventListener(n,a,"passive"in l?l:l.capture)}static removeEventListener(e,n,a,l={}){e.removeEventListener(n,a,"passive"in l?l:l.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const l=n.boundingClientRect;return new c.P((a.clientX-l.left)/n.x-e.clientLeft,(a.clientY-l.top)/n.y-e.clientTop)}static mousePos(e,n){const a=V.getScale(e);return V.getPoint(e,a,n)}static touchPos(e,n){const a=[],l=V.getScale(e);for(let d=0;d<n.length;d++)a.push(V.getPoint(e,l,n[d]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const se={supported:!1,testSupport:function(p){!fe&&le&&(Se?ge(p):ie=p)}};let ie,le,fe=!1,Se=!1;function ge(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,le),p.isContextLost())return;se.supported=!0}catch{}p.deleteTexture(e),fe=!0}var Ee;typeof document<"u"&&(le=document.createElement("img"),le.onload=()=>{ie&&ge(ie),ie=null,Se=!0},le.onerror=()=>{fe=!0,ie=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,n,a,l;p.resetRequestQueue=()=>{e=[],n=0,a=0,l={}},p.addThrottleControl=S=>{const k=a++;return l[k]=S,k},p.removeThrottleControl=S=>{delete l[S],y()},p.getImage=(S,k,M=!0)=>new Promise((z,B)=>{se.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),c.e(S,{type:"image"}),e.push({abortController:k,requestParameters:S,supportImageRefresh:M,state:"queued",onError:G=>{B(G)},onSuccess:G=>{z(G)}}),y()});const d=S=>c._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:k,supportImageRefresh:M,onError:z,onSuccess:B,abortController:G}=S,H=M===!1&&!c.i(self)&&!c.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((oe,ce)=>oe&&ce==="accept",!0));n++;const Q=H?b(k,G):c.m(k,G);try{const oe=yield Q;delete S.abortController,S.state="completed",oe.data instanceof HTMLImageElement||c.b(oe.data)?B(oe):oe.data&&B({data:yield(ne=oe.data,typeof createImageBitmap=="function"?c.d(ne):c.f(ne)),cacheControl:oe.cacheControl,expires:oe.expires})}catch(oe){delete S.abortController,z(oe)}finally{n--,y()}var ne}),y=()=>{const S=(()=>{for(const k of Object.keys(l))if(l[k]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=n;k<S&&e.length>0;k++){const M=e.shift();M.abortController.signal.aborted?k--:d(M)}},b=(S,k)=>new Promise((M,z)=>{const B=new Image,G=S.url,H=S.credentials;H&&H==="include"?B.crossOrigin="use-credentials":(H&&H==="same-origin"||!c.s(G))&&(B.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{B.src="",z(c.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,M({data:B})},B.onerror=()=>{B.onerror=B.onload=null,k.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=G})}(Ee||(Ee={})),Ee.resetRequestQueue();class Ne{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Le(p){var e=new c.A(3);return e[0]=p[0],e[1]=p[1],e[2]=p[2],e}var We,tt=function(p,e,n){return p[0]=e[0]-n[0],p[1]=e[1]-n[1],p[2]=e[2]-n[2],p};We=new c.A(3),c.A!=Float32Array&&(We[0]=0,We[1]=0,We[2]=0);var Pt=function(p){var e=p[0],n=p[1];return e*e+n*n};function $e(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const n=[];for(const{id:a,url:l}of p){const d=`${a}${l}`;n.indexOf(d)===-1&&(n.push(d),e.push({id:a,url:l}))}}return e}function nt(p,e,n){const a=p.split("?");return a[0]+=`${e}${n}`,a.join("?")}(function(){var p=new c.A(2);c.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Re{constructor(e,n,a,l){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,a){const{width:l,height:d}=e,y=!(this.size&&this.size[0]===l&&this.size[1]===d||a),{context:b}=this,{gl:S}=b;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[l,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,l,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:k,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||c.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,k,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,k,M,l,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,n,a){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Me(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class De extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new c.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const l=n.data||n.spriteData;return this._validateStretch(n.stretchX,l&&l.width)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,l&&l.height)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new c.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const l of e){if(l[0]<a||l[1]<l[0]||n<l[1])return!1;a=l[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,l=a&&a.width||n.data.width,d=a&&a.height||n.data.height;return!(e[0]<0||l<e[0]||e[1]<0||d<e[1]||e[2]<0||l<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const l=this.getImage(e);if(a&&(l.data.width!==n.data.width||l.data.height!==n.data.height))throw new Error(`size mismatch between old image (${l.data.width}x${l.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=l.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,a)=>{let l=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(l=!1);this.isLoaded()||l?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const a of e){let l=this.getImage(a);l||(this.fire(new c.k("styleimagemissing",{id:a})),l=this.getImage(a)),l?n[a]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,textFitWidth:l.textFitWidth,textFitHeight:l.textFitHeight,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:c.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const l={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new c.I(l,a);this.patterns[e]={bin:l,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Re(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:n,h:a}=c.p(e),l=this.atlasImage;l.resize({width:n||1,height:a||1});for(const d in this.patterns){const{bin:y}=this.patterns[d],b=y.x+1,S=y.y+1,k=this.getImage(d).data,M=k.width,z=k.height;c.R.copy(k,l,{x:0,y:0},{x:b,y:S},{width:M,height:z}),c.R.copy(k,l,{x:0,y:z-1},{x:b,y:S-1},{width:M,height:1}),c.R.copy(k,l,{x:0,y:0},{x:b,y:S+z},{width:M,height:1}),c.R.copy(k,l,{x:M-1,y:0},{x:b-1,y:S},{width:1,height:z}),c.R.copy(k,l,{x:0,y:0},{x:b+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||c.w(`Image with ID: "${n}" was not found`),Me(a)&&this.updateImage(n,a)}}}const Ae=1e20;function Ge(p,e,n,a,l,d,y,b,S){for(let k=e;k<e+a;k++)Xe(p,n*d+k,d,l,y,b,S);for(let k=n;k<n+l;k++)Xe(p,k*d+e,1,a,y,b,S)}function Xe(p,e,n,a,l,d,y){d[0]=0,y[0]=-Ae,y[1]=Ae,l[0]=p[e];for(let b=1,S=0,k=0;b<a;b++){l[b]=p[e+b*n];const M=b*b;do{const z=d[S];k=(l[b]-l[z]+M-z*z)/(b-z)/2}while(k<=y[S]&&--S>-1);S++,d[S]=b,y[S]=k,y[S+1]=Ae}for(let b=0,S=0;b<a;b++){for(;y[S+1]<b;)S++;const k=d[S],M=b-k;p[e+b*n]=l[k]+M*M}}class ft{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const d in e)for(const y of e[d])n.push(this._getAndCacheGlyphsPromise(d,y));const a=yield Promise.all(n),l={};for(const{stack:d,id:y,glyph:b}of a)l[d]||(l[d]={}),l[d][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return l})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let l=a.glyphs[n];if(l!==void 0)return{stack:e,id:n,glyph:l};if(l=this._tinySDF(a,e,n),l)return a.glyphs[n]=l,{stack:e,id:n,glyph:l};const d=Math.floor(n/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[d])return{stack:e,id:n,glyph:l};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[d]){const b=ft.loadGlyphRange(e,d,this.url,this.requestManager);a.requests[d]=b}const y=yield a.requests[d];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(a.glyphs[+b]=y[+b]);return a.ranges[d]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,n,a){const l=this.localIdeographFontFamily;if(!l||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),d=e.tinySDF=new ft.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:b})}const y=d.draw(String.fromCharCode(a));return{id:a,bitmap:new c.o({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}ft.loadGlyphRange=function(p,e,n,a){return c._(this,void 0,void 0,function*(){const l=256*e,d=l+255,y=a.transformRequest(n.replace("{fontstack}",p).replace("{range}",`${l}-${d}`),"Glyphs"),b=yield c.l(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${l}-${d}`);const S={};for(const k of c.n(b.data))S[k.id]=k;return S})},ft.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const b=this.size=p+4*e,S=this._createCanvas(b),k=this.ctx=S.getContext("2d",{willReadFrequently:!0});k.font=`${y} ${d} ${p}px ${l}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(p),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),S=Math.min(this.size-this.buffer,y+Math.ceil(a)),k=b+2*this.buffer,M=S+2*this.buffer,z=Math.max(k*M,0),B=new Uint8ClampedArray(z),G={data:B,width:k,height:M,glyphWidth:b,glyphHeight:S,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||S===0)return G;const{ctx:H,buffer:Q,gridInner:ne,gridOuter:oe}=this;H.clearRect(Q,Q,b,S),H.fillText(p,Q,Q+y);const ce=H.getImageData(Q,Q,b,S);oe.fill(Ae,0,z),ne.fill(0,0,z);for(let $=0;$<S;$++)for(let de=0;de<b;de++){const me=ce.data[4*($*b+de)+3]/255;if(me===0)continue;const we=($+Q)*k+de+Q;if(me===1)oe[we]=0,ne[we]=Ae;else{const Oe=.5-me;oe[we]=Oe>0?Oe*Oe:0,ne[we]=Oe<0?Oe*Oe:0}}Ge(oe,0,0,k,M,k,this.f,this.v,this.z),Ge(ne,Q,Q,b,S,k,this.f,this.v,this.z);for(let $=0;$<z;$++){const de=Math.sqrt(oe[$])-Math.sqrt(ne[$]);B[$]=Math.round(255-255*(de/this.radius+this.cutoff))}return G}};class dt{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.x(e.expression.evaluate(n))}interpolate(e,n,a){return{x:c.y.number(e.x,n.x,a),y:c.y.number(e.y,n.y,a),z:c.y.number(e.z,n.z,a)}}}let at;class ut extends c.E{constructor(e){super(),at=at||new c.q({anchor:new c.D(c.v.light.anchor),position:new dt,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(at),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.r,e,n))for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&c.t(this,e.call(c.u,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const Mt=new c.q({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class zt extends c.E{constructor(e){super(),this._transitionable=new c.T(Mt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.z(0))}setSky(e,n={}){if(!this._validate(c.B,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const l=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),l):this._transitionable.setValue(a,l)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return(a==null?void 0:a.validate)!==!1&&c.t(this,e.call(c.u,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ri{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const l=[];let d=e.length%2==1?-e[e.length-1]*a:0,y=e[0]*a,b=!0;l.push({left:d,right:y,isDash:b,zeroLength:e[0]===0});let S=e[0];for(let k=1;k<e.length;k++){b=!b;const M=e[k];d=S*a,S+=M,y=S*a,l.push({left:d,right:y,isDash:b,zeroLength:M===0})}return l}addRoundDash(e,n,a){const l=n/2;for(let d=-a;d<=a;d++){const y=this.width*(this.nextRow+a+d);let b=0,S=e[b];for(let k=0;k<this.width;k++){k/S.right>1&&(S=e[++b]);const M=Math.abs(k-S.left),z=Math.abs(k-S.right),B=Math.min(M,z);let G;const H=d/a*(l+1);if(S.isDash){const Q=l-Math.abs(H);G=Math.sqrt(B*B+Q*Q)}else G=l-Math.sqrt(B*B+H*H);this.data[y+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const S=e[b],k=e[b+1];S.zeroLength?e.splice(b,1):k&&k.isDash===S.isDash&&(k.left=S.left,e.splice(b,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const l=this.width*this.nextRow;let d=0,y=e[d];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++d]);const S=Math.abs(b-y.left),k=Math.abs(b-y.right),M=Math.min(S,k);this.data[l+b]=Math.max(0,Math.min(255,(y.isDash?M:-M)+128))}}addDash(e,n){const a=n?7:0,l=2*a+1;if(this.nextRow+l>this.height)return c.w("LineAtlas out of space"),null;let d=0;for(let b=0;b<e.length;b++)d+=e[b];if(d!==0){const b=this.width/d,S=this.getDashRanges(e,this.width,b);n?this.addRoundDash(S,b,a):this.addRegularDash(S)}const y={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=l,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const Jt="maplibre_preloaded_worker_pool";class fi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<fi.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Jt]}numActive(){return Object.keys(this.active).length}}const Ni=Math.floor(N.hardwareConcurrency/2);let Ci,qi;function Wi(){return Ci||(Ci=new fi),Ci}fi.workerCount=c.C(globalThis)?Math.max(Math.min(Ni,3),1):1;class zr{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let l=0;l<a.length;l++){const d=new c.F(a[l],n);d.name=`Worker ${l}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const l of this.actors)a.push(l.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function Vi(){return qi||(qi=new zr(Wi(),c.G),qi.registerMessageHandler("GR",(p,e,n)=>c.m(e,n))),qi}function Ai(p,e){const n=c.H();return c.J(n,n,[1,1,0]),c.K(n,n,[.5*p.width,.5*p.height,1]),c.L(n,n,p.calculatePosMatrix(e.toUnwrapped()))}function cr(p,e,n,a,l,d){const y=function(z,B,G){if(z)for(const H of z){const Q=B[H];if(Q&&Q.source===G&&Q.type==="fill-extrusion")return!0}else for(const H in B){const Q=B[H];if(Q.source===G&&Q.type==="fill-extrusion")return!0}return!1}(l&&l.layers,e,p.id),b=d.maxPitchScaleFactor(),S=p.tilesIn(a,b,y);S.sort(mt);const k=[];for(const z of S)k.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,n,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,l,d,b,Ai(p.transform,z.tileID))});const M=function(z){const B={},G={};for(const H of z){const Q=H.queryResults,ne=H.wrappedTileID,oe=G[ne]=G[ne]||{};for(const ce in Q){const $=Q[ce],de=oe[ce]=oe[ce]||{},me=B[ce]=B[ce]||[];for(const we of $)de[we.featureIndex]||(de[we.featureIndex]=!0,me.push(we))}}return B}(k);for(const z in M)M[z].forEach(B=>{const G=B.feature,H=p.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=H});return M}function mt(p,e){const n=p.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Ot(p,e,n){return c._(this,void 0,void 0,function*(){let a=p;if(p.url?a=(yield c.h(e.transformRequest(p.url,"Source"),n)).data:yield N.frameAsync(n),!a)return null;const l=c.M(c.e(a,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(l.vectorLayerIds=a.vector_layers.map(d=>d.id)),l})}class ye{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.N?new c.N(e.lng,e.lat):c.N.convert(e),this}extend(e){const n=this._sw,a=this._ne;let l,d;if(e instanceof c.N)l=e,d=e;else{if(!(e instanceof ye))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ye.convert(e)):this.extend(c.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.N.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return n||a?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new c.N(l.lng,l.lat),this._ne=new c.N(d.lng,d.lat)),this}getCenter(){return new c.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.N(this.getWest(),this.getNorth())}getSouthEast(){return new c.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=c.N.convert(e);let l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&l}static convert(e){return e instanceof ye?e:e&&new ye(e)}static fromLngLat(e,n=0){const a=360*n/40075017,l=a/Math.cos(Math.PI/180*e.lat);return new ye(new c.N(e.lng-l,e.lat-a),new c.N(e.lng+l,e.lat+a))}adjustAntiMeridian(){const e=new c.N(this._sw.lng,this._sw.lat),n=new c.N(this._ne.lng,this._ne.lat);return new ye(e,e.lng>n.lng?new c.N(n.lng+360,n.lat):n)}}class zi{constructor(e,n,a){this.bounds=ye.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(c.O(this.bounds.getWest())*n),l=Math.floor(c.Q(this.bounds.getNorth())*n),d=Math.ceil(c.O(this.bounds.getEast())*n),y=Math.ceil(c.Q(this.bounds.getSouth())*n);return e.x>=a&&e.x<d&&e.y>=l&&e.y<y}}class Dr extends c.E{constructor(e,n,a,l){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.M(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ot(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new zi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let l="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,y)=>{e.reloadPromise={resolve:d,reject:y}})}else e.actor=this.dispatcher.getActor(),l="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:l,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ei extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.setEventedParent(l),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.M(n,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ot(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(c.e(this,e),e.bounds&&(this.tileBounds=new zi(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ee.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const l=this.map.painter.context,d=l.gl,y=a.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new Re(l,y,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class vi extends ei{constructor(e,n,a,l){super(e,n,a,l),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const l=yield Ee.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){const d=l.data;this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const y=c.b(d)&&c.U()?d:yield this.readImageNow(d),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.V()){const n=e.width+2,a=e.height+2;try{return new c.R({width:n,height:a},yield c.W(e,-1,-1,n,a))}catch{}}return N.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),l=(n.x-1+a)%a,d=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+a)%a,b=n.x+1===a?e.wrap+1:e.wrap,S={};return S[new c.S(e.overscaledZ,d,n.z,l,n.y).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(S[new c.S(e.overscaledZ,d,n.z,l,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<a&&(S[new c.S(e.overscaledZ,d,n.z,l,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new c.S(e.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),S}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class dn extends c.E{constructor(e,n,a,l){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(l),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=c.X/this.tileSize;n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*d,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*d,extent:c.X,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.X,radius:(n.clusterRadius||50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(N.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let l=null;a.resourceTiming&&a.resourceTiming[this.id]&&(l=a.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&l&&l.length>0&&c.e(d,{resourceTiming:l}),this.fire(new c.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const l=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(l,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tn=c.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ur extends c.E{constructor(e,n,a,l){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(l),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Ee.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.j(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.Z.fromLngLat);this.tileID=function(l){let d=1/0,y=1/0,b=-1/0,S=-1/0;for(const B of l)d=Math.min(d,B.x),y=Math.min(y,B.y),b=Math.max(b,B.x),S=Math.max(S,B.y);const k=Math.max(b-d,S-y),M=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),z=Math.pow(2,M);return new c.a1(M,Math.floor((d+b)/2*z),Math.floor((y+S)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const a=n.map(l=>this.tileID.getTilePoint(l)._round());return this._boundsArray=new c.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,c.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,c.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,c.X,c.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Re(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zn extends ur{constructor(e,n,a,l){super(e,n,a,l),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a3(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.j(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.j(new c.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new Re(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const l in this.tiles){const d=this.tiles[l];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Zr extends ur{constructor(e,n,a,l){super(e,n,a,l),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(y=>typeof y!="number"))||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.j(new c.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Re(n,this.canvas,a.RGBA,{premultiply:!0});let l=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,l=!0)}l&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const In={},us=p=>{switch(p){case"geojson":return dn;case"image":return ur;case"raster":return ei;case"raster-dem":return vi;case"vector":return Dr;case"video":return Zn;case"canvas":return Zr}return In[p]},Ke="RTLPluginLoaded";class pn extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Vi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Ke))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let mr=null;function fn(){return mr||(mr=new pn),mr}class Qn{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a4(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,d){const y={};if(!d)return y;for(const b of l){const S=b.layerIds.map(k=>d.getLayer(k)).filter(Boolean);if(S.length!==0){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(k=>S.filter(M=>M.id===k)[0]));for(const k of S)y[k.id]=b}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a6){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const l in this.buckets){const d=this.buckets[l];if(d instanceof c.a6&&d.hasRTLText){this.hasRTLText=!0,fn().lazyLoad();break}}this.queryPadding=0;for(const l in this.buckets){const d=this.buckets[l];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(l).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const l=this.buckets[a];l.uploadPending()&&l.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Re(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Re(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,l,d,y,b,S,k,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:l,cameraQueryGeometry:d,scale:y,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:b,queryPadding:this.queryPadding*k},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const l=a.loadVTLayers(),d=n&&n.sourceLayer?n.sourceLayer:"",y=l._geojsonTileLayer||l[d];if(!y)return;const b=c.a7(n&&n.filter),{z:S,x:k,y:M}=this.tileID.canonical,z={z:S,x:k,y:M};for(let B=0;B<y.length;B++){const G=y.feature(B);if(b.needGeometry){const ne=c.a8(G,!0);if(!b.filter(new c.z(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!b.filter(new c.z(this.tileID.overscaledZ),G))continue;const H=a.getId(G,d),Q=new c.a9(G,S,k,M,H);Q.tile=z,e.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=c.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let l=!1;if(this.expirationTime>a)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{const d=this.expirationTime-n;d?this.expirationTime=a+Math.max(d,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const l in this.buckets){if(!n.style.hasLayer(l))continue;const d=this.buckets[l],y=d.layers[0].sourceLayer||"_geojsonTileLayer",b=a[y],S=e[y];if(!b||!S||Object.keys(S).length===0)continue;d.update(S,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=n&&n.style&&n.style.getLayer(l);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<N.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=N.now()+e}setDependencies(e,n){const a={};for(const l of n)a[l]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const l=this.dependencies[a];if(l){for(const d of n)if(l[d])return!0}}return!1}}class Ye{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const d={value:n,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[l].push(d),this.order.push(l),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,l=n===void 0?0:this.data[a].indexOf(n),d=this.data[a][l];return this.data[a].splice(l,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const l of this.data[a])e(l.value)||n.push(l);for(const a of n)this.remove(a.value.tileID,a)}}class Ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},c.e(this.stateChanges[e][l],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==l&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(const d in this.state[e][l])a[d]||(this.deletedStates[e][l][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][d]===null&&delete this.deletedStates[e][l][d]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(a in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][a]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),l=c.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(d===null)return{};for(const y in d)delete l[y]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const l in this.stateChanges){this.state[l]=this.state[l]||{};const d={};for(const y in this.stateChanges[l])this.state[l][y]||(this.state[l][y]={}),c.e(this.state[l][y],this.stateChanges[l][y]),d[y]=this.state[l][y];a[l]=d}for(const l in this.deletedStates){this.state[l]=this.state[l]||{};const d={};if(this.deletedStates[l]===null)for(const y in this.state[l])d[y]={},this.state[l][y]={};else for(const y in this.deletedStates[l]){if(this.deletedStates[l][y]===null)this.state[l][y]={};else for(const b of Object.keys(this.deletedStates[l][y]))delete this.state[l][y][b];d[y]=this.state[l][y]}a[l]=a[l]||{},c.e(a[l],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const l in e)e[l].setFeatureState(a,n)}}class Nt extends c.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",l=>this._dataHandler(l)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((l,d,y,b)=>{const S=new(us(d.type))(l,d,y,b);if(S.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${S.id}`);return S})(e,n,a,this),this._tiles={},this._cache=new Ye(0,l=>this._unloadTile(l)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ht,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(l){e.state="errored",l.status!==404?this._source.fire(new c.j(l,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(gr).map(e=>e.key)}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort((a,l)=>{const d=a.tileID,y=l.tileID,b=new c.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),S=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-y.overscaledZ||S.y-b.y||S.x-b.x}).map(a=>a.tileID.key):n.map(a=>a.tileID).sort(gr).map(a=>a.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))})}_tileLoaded(e,n,a){e.timeAdded=N.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let l=0;l<n.length;l++){const d=n[l];if(e.neighboringTiles&&e.neighboringTiles[d]){const y=this.getTileByID(d);a(e,y),a(y,e)}}function a(l,d){l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0;let y=d.tileID.canonical.x-l.tileID.canonical.x;const b=d.tileID.canonical.y-l.tileID.canonical.y,S=Math.pow(2,l.tileID.canonical.z),k=d.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+S)===1?y+=S:Math.abs(y-S)===1&&(y-=S)),d.dem&&l.dem&&(l.dem.backfillBorder(d.dem,y,b),l.neighboringTiles&&l.neighboringTiles[k]&&(l.neighboringTiles[k].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,l){for(const d in this._tiles){let y=this._tiles[d];if(l[d]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>a)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const k=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[k.key],y&&y.hasData()&&(b=k)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){l[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const l=e.scaledTo(a),d=this._getLoadedTile(l);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,l=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(d)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const l in this._tiles){const d=this._tiles[l];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),a[d.tileID.key]=d}this._tiles=a;for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}}_updateCoveredAndRetainedTiles(e,n,a,l,d,y){const b={},S={},k=Object.keys(e),M=N.now();for(const z of k){const B=e[z],G=this._tiles[z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=M)continue;const H=this.findLoadedParent(B,n),Q=this.findLoadedSibling(B),ne=H||Q||null;ne&&(this._addTile(ne.tileID),b[ne.tileID.key]=ne.tileID),S[z]=B}this._retainLoadedChildren(S,l,a,e);for(const z in b)e[z]||(this._coveredTiles[z]=!0,e[z]=b[z]);if(y){const z={},B={};for(const G of d)this._tiles[G.key].hasData()?z[G.key]=G:B[G.key]=G;for(const G in B){const H=B[G].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(z[H[0].key]=e[H[0].key]=H[0],z[H[1].key]=e[H[1].key]=H[1],z[H[2].key]=e[H[2].key]=H[2],z[H[3].key]=e[H[3].key]=H[3],delete B[G])}for(const G in B){const H=B[G],Q=this.findLoadedParent(H,this._source.minzoom),ne=this.findLoadedSibling(H),oe=Q||ne||null;if(oe){z[oe.tileID.key]=e[oe.tileID.key]=oe.tileID;for(const ce in z)z[ce].isChildOf(oe.tileID)&&delete z[ce]}}for(const G in this._tiles)z[G]||(this._coveredTiles[G]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new c.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const l=e.coveringZoomLevel(this._source),d=Math.max(l-Nt.maxOverzooming,this._source.minzoom),y=Math.max(l+Nt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);M[B.key]=B;const G=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[G.key]=G}a=a.concat(Object.values(M))}const b=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,l);rn(this._source.type)&&this._updateCoveredAndRetainedTiles(S,d,y,l,a,n);for(const M in S)this._tiles[M].clearFadeHold();const k=c.ab(this._tiles,S);for(const M of k){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const l={},d={},y=Math.max(n-Nt.maxOverzooming,this._source.minzoom),b=Math.max(n+Nt.maxUnderzooming,this._source.minzoom),S={};for(const k of e){const M=this._addTile(k);l[k.key]=k,M.hasData()||n<this._source.maxzoom&&(S[k.key]=k)}this._retainLoadedChildren(S,n,b,l);for(const k of e){let M=this._tiles[k.key];if(M.hasData())continue;if(n+1>this._source.maxzoom){const B=k.children(this._source.maxzoom)[0],G=this.getTile(B);if(G&&G.hasData()){l[B.key]=B;continue}}else{const B=k.children(this._source.maxzoom);if(l[B[0].key]&&l[B[1].key]&&l[B[2].key]&&l[B[3].key])continue}let z=M.wasRequested();for(let B=k.overscaledZ-1;B>=y;--B){const G=k.scaledTo(B);if(d[G.key])break;if(d[G.key]=!0,M=this.getTile(G),!M&&z&&(M=this._addTile(G)),M){const H=M.hasData();if((H||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(l[G.key]=G),z=M.wasRequested(),H)break}}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){a=this._loadedParentTiles[l.key];break}n.push(l.key);const d=l.scaledTo(l.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;l=d}for(const d of n)this._loadedParentTiles[d]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new Qn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new c.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const l=[],d=this.transform;if(!d)return l;const y=a?d.getCameraQueryGeometry(e):e,b=e.map(H=>d.pointCoordinate(H,this.terrain)),S=y.map(H=>d.pointCoordinate(H,this.terrain)),k=this.getIds();let M=1/0,z=1/0,B=-1/0,G=-1/0;for(const H of S)M=Math.min(M,H.x),z=Math.min(z,H.y),B=Math.max(B,H.x),G=Math.max(G,H.y);for(let H=0;H<k.length;H++){const Q=this._tiles[k[H]];if(Q.holdingForFade())continue;const ne=Q.tileID,oe=Math.pow(2,d.zoom-Q.tileID.overscaledZ),ce=n*Q.queryPadding*c.X/Q.tileSize/oe,$=[ne.getTilePoint(new c.Z(M,z)),ne.getTilePoint(new c.Z(B,G))];if($[0].x-ce<c.X&&$[0].y-ce<c.X&&$[1].x+ce>=0&&$[1].y+ce>=0){const de=b.map(we=>ne.getTilePoint(we)),me=S.map(we=>ne.getTilePoint(we));l.push({tile:Q,tileID:ne,queryGeometry:de,cameraQueryGeometry:me,scale:oe})}}return l}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of n)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(rn(this._source.type)){const e=N.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const l=this._tiles[e];l&&l.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,n))}}function gr(p,e){const n=Math.abs(2*p.wrap)-+(p.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||a-n||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function rn(p){return p==="raster"||p==="image"||p==="video"}Nt.maxOverzooming=10,Nt.maxUnderzooming=3;class Vt{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ac(e,0,1);let n=1,a=this._distances[n];const l=e*this.paddedLength+this.padding;for(;a<l&&n<this._distances.length;)a=this._distances[++n];const d=n-1,y=this._distances[d],b=a-y,S=b>0?(l-y)/b:0;return this.points[d].mult(1-S).add(this.points[n].mult(S))}}function _r(p,e){let n=!0;return p==="always"||p!=="never"&&e!=="never"||(n=!1),n}class mn{constructor(e,n,a){const l=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)l.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,l,d){this._forEachCell(n,a,l,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(d)}insertCircle(e,n,a,l){this._forEachCell(n-l,a-l,n+l,a+l,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(l)}_insertBoxCell(e,n,a,l,d,y){this.boxCells[d].push(y)}_insertCircleCell(e,n,a,l,d,y){this.circleCells[d].push(y)}_query(e,n,a,l,d,y,b){if(a<0||e>this.width||l<0||n>this.height)return[];const S=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=l){if(d)return[{key:null,x1:e,y1:n,x2:a,y2:l}];for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const M=this.circles[3*k],z=this.circles[3*k+1],B=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:M-B,y1:z-B,x2:M+B,y2:z+B})}}else this._forEachCell(e,n,a,l,this._queryCell,S,{hitTest:d,overlapMode:y,seenUids:{box:{},circle:{}}},b);return S}query(e,n,a,l){return this._query(e,n,a,l,!1,null)}hitTest(e,n,a,l,d,y){return this._query(e,n,a,l,!0,d,y).length>0}hitTestCircle(e,n,a,l,d){const y=e-a,b=e+a,S=n-a,k=n+a;if(b<0||y>this.width||k<0||S>this.height)return!1;const M=[];return this._forEachCell(y,S,b,k,this._queryCellCircle,M,{hitTest:!0,overlapMode:l,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},d),M.length>0}_queryCell(e,n,a,l,d,y,b,S){const{seenUids:k,hitTest:M,overlapMode:z}=b,B=this.boxCells[d];if(B!==null){const H=this.bboxes;for(const Q of B)if(!k.box[Q]){k.box[Q]=!0;const ne=4*Q,oe=this.boxKeys[Q];if(e<=H[ne+2]&&n<=H[ne+3]&&a>=H[ne+0]&&l>=H[ne+1]&&(!S||S(oe))&&(!M||!_r(z,oe.overlapMode))&&(y.push({key:oe,x1:H[ne],y1:H[ne+1],x2:H[ne+2],y2:H[ne+3]}),M))return!0}}const G=this.circleCells[d];if(G!==null){const H=this.circles;for(const Q of G)if(!k.circle[Q]){k.circle[Q]=!0;const ne=3*Q,oe=this.circleKeys[Q];if(this._circleAndRectCollide(H[ne],H[ne+1],H[ne+2],e,n,a,l)&&(!S||S(oe))&&(!M||!_r(z,oe.overlapMode))){const ce=H[ne],$=H[ne+1],de=H[ne+2];if(y.push({key:oe,x1:ce-de,y1:$-de,x2:ce+de,y2:$+de}),M)return!0}}}return!1}_queryCellCircle(e,n,a,l,d,y,b,S){const{circle:k,seenUids:M,overlapMode:z}=b,B=this.boxCells[d];if(B!==null){const H=this.bboxes;for(const Q of B)if(!M.box[Q]){M.box[Q]=!0;const ne=4*Q,oe=this.boxKeys[Q];if(this._circleAndRectCollide(k.x,k.y,k.radius,H[ne+0],H[ne+1],H[ne+2],H[ne+3])&&(!S||S(oe))&&!_r(z,oe.overlapMode))return y.push(!0),!0}}const G=this.circleCells[d];if(G!==null){const H=this.circles;for(const Q of G)if(!M.circle[Q]){M.circle[Q]=!0;const ne=3*Q,oe=this.circleKeys[Q];if(this._circlesCollide(H[ne],H[ne+1],H[ne+2],k.x,k.y,k.radius)&&(!S||S(oe))&&!_r(z,oe.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,a,l,d,y,b,S){const k=this._convertToXCellCoord(e),M=this._convertToYCellCoord(n),z=this._convertToXCellCoord(a),B=this._convertToYCellCoord(l);for(let G=k;G<=z;G++)for(let H=M;H<=B;H++)if(d.call(this,e,n,a,l,this.xCellCount*H+G,y,b,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,l,d,y){const b=l-e,S=d-n,k=a+y;return k*k>b*b+S*S}_circleAndRectCollide(e,n,a,l,d,y,b){const S=(y-l)/2,k=Math.abs(e-(l+S));if(k>S+a)return!1;const M=(b-d)/2,z=Math.abs(n-(d+M));if(z>M+a)return!1;if(k<=S||z<=M)return!0;const B=k-S,G=z-M;return B*B+G*G<=a*a}}function hs(p,e,n,a,l){const d=c.H();return e?(c.K(d,d,[1/l,1/l,1]),n||c.ad(d,d,a.angle)):c.L(d,a.labelPlaneMatrix,p),d}function Gn(p,e,n,a,l){if(e){const d=c.ae(p);return c.K(d,d,[l,l,1]),n||c.ad(d,d,-a.angle),d}return a.glCoordMatrix}function te(p,e,n,a){let l;a?(l=[p,e,a(p,e),1],c.af(l,l,n)):(l=[p,e,0,1],ui(l,l,n));const d=l[3];return{point:new c.P(l[0]/d,l[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function O(p,e){return .5+p/e*.5}function R(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function W(p,e,n,a,l,d,y,b,S,k,M,z,B,G,H){const Q=a?p.textSizeData:p.iconSizeData,ne=c.ag(Q,n.transform.zoom),oe=[256/n.width*2+1,256/n.height*2+1],ce=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ce.clear();const $=p.lineVertexArray,de=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,me=n.transform.width/n.transform.height;let we=!1;for(let Oe=0;Oe<de.length;Oe++){const He=de.get(Oe);if(He.hidden||He.writingMode===c.ah.vertical&&!we){Dt(He.numGlyphs,ce);continue}we=!1;const lt=te(He.anchorX,He.anchorY,e,H);if(!R(lt.point,oe)){Dt(He.numGlyphs,ce);continue}const gt=O(n.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),it=c.ai(Q,ne,He),et=y?it/gt:it*gt,bt={getElevation:H,labelPlaneMatrix:l,lineVertexArray:$,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:k,tileAnchorPoint:new c.P(He.anchorX,He.anchorY),unwrappedTileID:M,width:z,height:B,translation:G},Gt=pe(bt,He,et,!1,b,e,d,p.glyphOffsetArray,ce,me,S);we=Gt.useVertical,(Gt.notEnoughRoom||we||Gt.needsFlipping&&pe(bt,He,et,!0,b,e,d,p.glyphOffsetArray,ce,me,S).notEnoughRoom)&&Dt(He.numGlyphs,ce)}a?p.text.dynamicLayoutVertexBuffer.updateData(ce):p.icon.dynamicLayoutVertexBuffer.updateData(ce)}function Y(p,e,n,a,l,d,y,b){const S=d.glyphStartIndex+d.numGlyphs,k=d.lineStartIndex,M=d.lineStartIndex+d.lineLength,z=e.getoffsetX(d.glyphStartIndex),B=e.getoffsetX(S-1),G=Qe(p*z,n,a,l,d.segment,k,M,b,y);if(!G)return null;const H=Qe(p*B,n,a,l,d.segment,k,M,b,y);return H?b.projectionCache.anyProjectionOccluded?null:{first:G,last:H}:null}function he(p,e,n,a){return p===c.ah.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(p===c.ah.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function pe(p,e,n,a,l,d,y,b,S,k,M){const z=n/24,B=e.lineOffsetX*z,G=e.lineOffsetY*z;let H;if(e.numGlyphs>1){const Q=e.glyphStartIndex+e.numGlyphs,ne=e.lineStartIndex,oe=e.lineStartIndex+e.lineLength,ce=Y(z,b,B,G,a,e,M,p);if(!ce)return{notEnoughRoom:!0};const $=te(ce.first.point.x,ce.first.point.y,y,p.getElevation).point,de=te(ce.last.point.x,ce.last.point.y,y,p.getElevation).point;if(l&&!a){const me=he(e.writingMode,$,de,k);if(me)return me}H=[ce.first];for(let me=e.glyphStartIndex+1;me<Q-1;me++)H.push(Qe(z*b.getoffsetX(me),B,G,a,e.segment,ne,oe,p,M));H.push(ce.last)}else{if(l&&!a){const ne=te(p.tileAnchorPoint.x,p.tileAnchorPoint.y,d,p.getElevation).point,oe=e.lineStartIndex+e.segment+1,ce=new c.P(p.lineVertexArray.getx(oe),p.lineVertexArray.gety(oe)),$=te(ce.x,ce.y,d,p.getElevation),de=$.signedDistanceFromCamera>0?$.point:function(we,Oe,He,lt,gt,it){return ve(we,Oe,He,1,gt,it)}(p.tileAnchorPoint,ce,ne,0,d,p),me=he(e.writingMode,ne,de,k);if(me)return me}const Q=Qe(z*b.getoffsetX(e.glyphStartIndex),B,G,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,p,M);if(!Q||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[Q]}for(const Q of H)c.aj(S,Q.point,Q.angle);return{}}function ve(p,e,n,a,l,d){const y=p.add(p.sub(e)._unit()),b=l!==void 0?te(y.x,y.y,l,d.getElevation).point:ke(y.x,y.y,d).point,S=n.sub(b);return n.add(S._mult(a/S.mag()))}function ae(p,e,n){const a=e.projectionCache;if(a.projections[p])return a.projections[p];const l=new c.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=ke(l.x,l.y,e);if(d.signedDistanceFromCamera>0)return a.projections[p]=d.point,a.anyProjectionOccluded=a.anyProjectionOccluded||d.isOccluded,d.point;const y=p-n.direction;return function(b,S,k,M,z){return ve(b,S,k,M,void 0,z)}(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),l,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function ke(p,e,n){const a=p+n.translation[0],l=e+n.translation[1];let d;return!n.pitchWithMap&&n.projection.useSpecialProjectionForSymbols?(d=n.projection.projectTileCoordinates(a,l,n.unwrappedTileID,n.getElevation),d.point.x=(.5*d.point.x+.5)*n.width,d.point.y=(.5*-d.point.y+.5)*n.height):(d=te(a,l,n.labelPlaneMatrix,n.getElevation),d.isOccluded=!1),d}function Fe(p,e,n){return p._unit()._perp()._mult(e*n)}function Ie(p,e,n,a,l,d,y,b,S){if(b.projectionCache.offsets[p])return b.projectionCache.offsets[p];const k=n.add(e);if(p+S.direction<a||p+S.direction>=l)return b.projectionCache.offsets[p]=k,k;const M=ae(p+S.direction,b,S),z=Fe(M.sub(n),y,S.direction),B=n.add(z),G=M.add(z);return b.projectionCache.offsets[p]=c.ak(d,k,B,G)||k,b.projectionCache.offsets[p]}function Qe(p,e,n,a,l,d,y,b,S){const k=a?p-e:p+e;let M=k>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let B,G=M>0?d+l:d+l+1;b.projectionCache.cachedAnchorPoint?B=b.projectionCache.cachedAnchorPoint:(B=ke(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=B);let H,Q,ne=B,oe=B,ce=0,$=0;const de=Math.abs(k),me=[];let we;for(;ce+$<=de;){if(G+=M,G<d||G>=y)return null;ce+=$,oe=ne,Q=H;const lt={absOffsetX:de,direction:M,distanceFromAnchor:ce,previousVertex:oe};if(ne=ae(G,b,lt),n===0)me.push(oe),we=ne.sub(oe);else{let gt;const it=ne.sub(oe);gt=it.mag()===0?Fe(ae(G+M,b,lt).sub(ne),n,M):Fe(it,n,M),Q||(Q=oe.add(gt)),H=Ie(G,gt,ne,d,y,Q,n,b,lt),me.push(Q),we=H.sub(Q)}$=we.mag()}const Oe=we._mult((de-ce)/$)._add(Q||oe),He=z+Math.atan2(ne.y-oe.y,ne.x-oe.x);return me.push(Oe),{point:Oe,angle:S?He:0,path:me}}const kt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(p,e){for(let n=0;n<p;n++){const a=e.length;e.resize(a+4),e.float32.set(kt,3*a)}}function ui(p,e,n){const a=e[0],l=e[1];return p[0]=n[0]*a+n[4]*l+n[12],p[1]=n[1]*a+n[5]*l+n[13],p[3]=n[3]*a+n[7]*l+n[15],p}const Wt=100;class hi{constructor(e,n,a=new mn(e.width+200,e.height+200,25),l=new mn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=n,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Wt,this.screenBottomBoundary=e.height+Wt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,l,d,y,b,S,k,M,z){const B=e.anchorPointX+S[0],G=e.anchorPointY+S[1],H=this.projectAndGetPerspectiveRatio(l,B,G,d,M),Q=a*H.perspectiveRatio;let ne;if(y||b)ne=this._projectCollisionBox(e,Q,l,d,y,b,S,H,M,z);else{const me=H.point.x+(z?z.x*Q:0),we=H.point.y+(z?z.y*Q:0);ne={allPointsOccluded:!1,box:[me+e.x1*Q,we+e.y1*Q,me+e.x2*Q,we+e.y2*Q]}}const[oe,ce,$,de]=ne.box;return this.mapProjection.useSpecialProjectionForSymbols&&(y?ne.allPointsOccluded:this.mapProjection.isOccluded(B,G,d))||H.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(oe,ce,$,de)||n!=="always"&&this.grid.hitTest(oe,ce,$,de,n,k)?{box:[oe,ce,$,de],placeable:!1,offscreen:!1}:{box:[oe,ce,$,de],placeable:!0,offscreen:this.isOffscreen(oe,ce,$,de)}}placeCollisionCircles(e,n,a,l,d,y,b,S,k,M,z,B,G,H,Q,ne){const oe=[],ce=new c.P(n.anchorX,n.anchorY),$=this.getPerspectiveRatio(y,ce.x,ce.y,b,ne),de=(z?d/$:d*$)/c.ap,me={getElevation:ne,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ce,unwrappedTileID:b,width:this.transform.width,height:this.transform.height,translation:Q},we=Y(de,l,n.lineOffsetX*de,n.lineOffsetY*de,!1,n,!1,me);let Oe=!1,He=!1,lt=!0;if(we){const gt=.5*G*$+H,it=new c.P(-100,-100),et=new c.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Vt,Gt=we.first,st=we.last;let ht=[];for(let Xt=Gt.path.length-1;Xt>=1;Xt--)ht.push(Gt.path[Xt]);for(let Xt=1;Xt<st.path.length;Xt++)ht.push(st.path[Xt]);const Ut=2.5*gt;if(k){const Xt=this.projectPathToScreenSpace(ht,me,k);ht=Xt.some(si=>si.signedDistanceFromCamera<=0)?[]:Xt.map(si=>si.point)}let Li=[];if(ht.length>0){const Xt=ht[0].clone(),si=ht[0].clone();for(let Ri=1;Ri<ht.length;Ri++)Xt.x=Math.min(Xt.x,ht[Ri].x),Xt.y=Math.min(Xt.y,ht[Ri].y),si.x=Math.max(si.x,ht[Ri].x),si.y=Math.max(si.y,ht[Ri].y);Li=Xt.x>=it.x&&si.x<=et.x&&Xt.y>=it.y&&si.y<=et.y?[ht]:si.x<it.x||Xt.x>et.x||si.y<it.y||Xt.y>et.y?[]:c.al([ht],it.x,it.y,et.x,et.y)}for(const Xt of Li){bt.reset(Xt,.25*gt);let si=0;si=bt.length<=.5*gt?1:Math.ceil(bt.paddedLength/Ut)+1;for(let Ri=0;Ri<si;Ri++){const Pr=Ri/Math.max(si-1,1),zn=bt.lerp(Pr),Oi=zn.x+Wt,Hr=zn.y+Wt;oe.push(Oi,Hr,gt,0);const Rr=Oi-gt,Ir=Hr-gt,Or=Oi+gt,Kn=Hr+gt;if(lt=lt&&this.isOffscreen(Rr,Ir,Or,Kn),He=He||this.isInsideGrid(Rr,Ir,Or,Kn),e!=="always"&&this.grid.hitTestCircle(Oi,Hr,gt,e,B)&&(Oe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!M&&Oe||!He||$<this.perspectiveRatioCutoff?[]:oe,offscreen:lt,collisionDetected:Oe}}projectPathToScreenSpace(e,n,a){return e.map(l=>te(l.x,l.y,a,n.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let a=1/0,l=1/0,d=-1/0,y=-1/0;for(const M of e){const z=new c.P(M.x+Wt,M.y+Wt);a=Math.min(a,z.x),l=Math.min(l,z.y),d=Math.max(d,z.x),y=Math.max(y,z.y),n.push(z)}const b=this.grid.query(a,l,d,y).concat(this.ignoredGrid.query(a,l,d,y)),S={},k={};for(const M of b){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const B=[new c.P(M.x1,M.y1),new c.P(M.x2,M.y1),new c.P(M.x2,M.y2),new c.P(M.x1,M.y2)];c.am(n,B)&&(S[z.bucketInstanceId][z.featureIndex]=!0,k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]=[]),k[z.bucketInstanceId].push(z.featureIndex))}return k}insertCollisionBox(e,n,a,l,d,y){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:d,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,l,d,y){const b=a?this.ignoredGrid:this.grid,S={bucketInstanceId:l,featureIndex:d,collisionGroupID:y,overlapMode:n};for(let k=0;k<e.length;k+=4)b.insertCircle(S,e[k],e[k+1],e[k+2])}projectAndGetPerspectiveRatio(e,n,a,l,d){let y;d?(y=[n,a,d(n,a),1],c.af(y,y,e)):(y=[n,a,0,1],ui(y,y,e));const b=y[3];return{point:new c.P((y[0]/b+1)/2*this.transform.width+Wt,(-y[1]/b+1)/2*this.transform.height+Wt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}getPerspectiveRatio(e,n,a,l,d){const y=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,a,l,d):te(n,a,e,d);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,n,a,l){return a<Wt||e>=this.screenRightBoundary||l<Wt||n>this.screenBottomBoundary}isInsideGrid(e,n,a,l){return a>=0&&e<this.gridRightBoundary&&l>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.an([]);return c.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,l,d,y,b,S,k,M){let z=new c.P(1,0),B=new c.P(0,1);const G=new c.P(e.anchorPointX+b[0],e.anchorPointY+b[1]);if(y&&!d){const lt=this.projectAndGetPerspectiveRatio(a,G.x+1,G.y,l,k).point.sub(S.point).unit(),gt=Math.atan(lt.y/lt.x)+(lt.x<0?Math.PI:0),it=Math.sin(gt),et=Math.cos(gt);z=new c.P(et,it),B=new c.P(-it,et)}else if(!y&&d){const lt=-this.transform.angle,gt=Math.sin(lt),it=Math.cos(lt);z=new c.P(it,gt),B=new c.P(-gt,it)}let H=S.point,Q=n;if(d){H=G;const lt=this.transform.zoom-Math.floor(this.transform.zoom);Q=Math.pow(2,-lt),Q*=this.mapProjection.getPitchedTextCorrection(this.transform,G,l),M||(Q*=c.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(H=H.add(z.mult(M.x*Q)).add(B.mult(M.y*Q)));const ne=e.x1*Q,oe=e.x2*Q,ce=(ne+oe)/2,$=e.y1*Q,de=e.y2*Q,me=($+de)/2,we=[{offsetX:ne,offsetY:$},{offsetX:ce,offsetY:$},{offsetX:oe,offsetY:$},{offsetX:oe,offsetY:me},{offsetX:oe,offsetY:de},{offsetX:ce,offsetY:de},{offsetX:ne,offsetY:de},{offsetX:ne,offsetY:me}];let Oe=[];for(const{offsetX:lt,offsetY:gt}of we)Oe.push(new c.P(H.x+z.x*lt+B.x*gt,H.y+z.y*lt+B.y*gt));let He=!1;if(d){const lt=Oe.map(gt=>this.projectAndGetPerspectiveRatio(a,gt.x,gt.y,l,k));He=lt.some(gt=>!gt.isOccluded),Oe=lt.map(gt=>gt.point)}else He=!0;return{box:c.ao(Oe),allPointsOccluded:!He}}}function ni(p,e,n){return e*(c.X/(p.tileSize*Math.pow(2,n-p.tileID.overscaledZ)))}class nr{constructor(e,n,a,l){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):l&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Hi{constructor(e,n,a,l,d){this.text=new nr(e?e.text:null,n,a,d),this.icon=new nr(e?e.icon:null,n,l,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yt{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class xi{constructor(){this.invProjMatrix=c.H(),this.viewportMatrix=c.H(),this.circles=[]}}class ji{constructor(e,n,a,l,d){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=l,this.tileID=d}}class hr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function yr(p,e,n,a,l){const{horizontalAlign:d,verticalAlign:y}=c.au(p);return new c.P(-(d-.5)*e+a[0]*l,-(y-.5)*n+a[1]*l)}class Lr{constructor(e,n,a,l,d,y){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new hi(this.transform,n),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new hr(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,l)=>n.getElevation(e,a,l):null}getBucketParts(e,n,a,l){const d=a.getBucket(n),y=a.latestFeatureIndex;if(!d||!y||n.id!==d.layerIds[0])return;const b=a.collisionBoxArray,S=d.layers[0].layout,k=d.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/c.X,B=a.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(B),H=S.get("text-pitch-alignment")==="map",Q=S.get("text-rotation-alignment")==="map",ne=ni(a,1,this.transform.zoom),oe=this.collisionIndex.mapProjection.translatePosition(this.transform,a,k.get("text-translate"),k.get("text-translate-anchor")),ce=this.collisionIndex.mapProjection.translatePosition(this.transform,a,k.get("icon-translate"),k.get("icon-translate-anchor")),$=hs(G,H,Q,this.transform,ne);let de=null;if(H){const we=Gn(G,H,Q,this.transform,ne);de=c.L([],this.transform.labelPlaneMatrix,we)}this.retainedQueryData[d.bucketInstanceId]=new ji(d.bucketInstanceId,y,d.sourceLayerIndex,d.index,a.tileID);const me={bucket:d,layout:S,translationText:oe,translationIcon:ce,posMatrix:G,unwrappedTileID:B,textLabelPlaneMatrix:$,labelToScreenMatrix:de,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(l)for(const we of d.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:He,symbolInstanceEnd:lt}=we;e.push({sortKey:Oe,symbolInstanceStart:He,symbolInstanceEnd:lt,parameters:me})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:me})}attemptAnchorPlacement(e,n,a,l,d,y,b,S,k,M,z,B,G,H,Q,ne,oe,ce,$){const de=c.aq[e.textAnchor],me=[e.textOffset0,e.textOffset1],we=yr(de,a,l,me,d),Oe=this.collisionIndex.placeCollisionBox(n,B,S,k,M,b,y,ne,z.predicate,$,we);if((!ce||this.collisionIndex.placeCollisionBox(ce,B,S,k,M,b,y,oe,z.predicate,$,we).placeable)&&Oe.placeable){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(He=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:me,width:a,height:l,anchor:de,textBoxScale:d,prevAnchor:He},this.markUsedJustification(H,de,G,Q),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Q,G),this.placedOrientations[G.crossTileID]=Q),{shift:we,placedGlyphBoxes:Oe}}}placeLayerBucketPart(e,n,a){const{bucket:l,layout:d,translationText:y,translationIcon:b,posMatrix:S,unwrappedTileID:k,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:B,holdingForFade:G,collisionBoxArray:H,partiallyEvaluatedTextSize:Q,collisionGroup:ne}=e.parameters,oe=d.get("text-optional"),ce=d.get("icon-optional"),$=c.ar(d,"text-overlap","text-allow-overlap"),de=$==="always",me=c.ar(d,"icon-overlap","icon-allow-overlap"),we=me==="always",Oe=d.get("text-rotation-alignment")==="map",He=d.get("text-pitch-alignment")==="map",lt=d.get("icon-text-fit")!=="none",gt=d.get("symbol-z-order")==="viewport-y",it=de&&(we||!l.hasIconData()||ce),et=we&&(de||!l.hasTextData()||oe);!l.collisionArrays&&H&&l.deserializeCollisionBoxes(H);const bt=this._getTerrainElevationFunc(this.retainedQueryData[l.bucketInstanceId].tileID),Gt=(st,ht,Ut)=>{var Li,Xt;if(n[st.crossTileID])return;if(G)return void(this.placements[st.crossTileID]=new Yt(!1,!1,!1));let si=!1,Ri=!1,Pr=!0,zn=null,Oi={box:null,placeable:!1,offscreen:null},Hr={box:null,placeable:!1,offscreen:null},Rr=null,Ir=null,Or=null,Kn=0,Po=0,Tl=0;ht.textFeatureIndex?Kn=ht.textFeatureIndex:st.useRuntimeCollisionCircles&&(Kn=st.featureIndex),ht.verticalTextFeatureIndex&&(Po=ht.verticalTextFeatureIndex);const Io=ht.textBox;if(Io){const bn=vr=>{let Cr=c.ah.horizontal;if(l.allowVerticalPlacement&&!vr&&this.prevPlacement){const cn=this.prevPlacement.placedOrientations[st.crossTileID];cn&&(this.placedOrientations[st.crossTileID]=cn,Cr=cn,this.markUsedOrientation(l,Cr,st))}return Cr},wn=(vr,Cr)=>{if(l.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const cn of l.writingModes)if(cn===c.ah.vertical?(Oi=Cr(),Hr=Oi):Oi=vr(),Oi&&Oi.placeable)break}else Oi=vr()},fs=st.textAnchorOffsetStartIndex,Dn=st.textAnchorOffsetEndIndex;if(Dn===fs){const vr=(Cr,cn)=>{const li=this.collisionIndex.placeCollisionBox(Cr,$,B,S,k,He,Oe,y,ne.predicate,bt);return li&&li.placeable&&(this.markUsedOrientation(l,cn,st),this.placedOrientations[st.crossTileID]=cn),li};wn(()=>vr(Io,c.ah.horizontal),()=>{const Cr=ht.verticalTextBox;return l.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Cr?vr(Cr,c.ah.vertical):{box:null,offscreen:null}}),bn(Oi&&Oi.placeable)}else{let vr=c.aq[(Xt=(Li=this.prevPlacement)===null||Li===void 0?void 0:Li.variableOffsets[st.crossTileID])===null||Xt===void 0?void 0:Xt.anchor];const Cr=(li,Us,Co)=>{const Ao=li.x2-li.x1,mf=li.y2-li.y1,v_=st.textBoxScale,gf=lt&&me==="never"?Us:null;let ms=null,_f=$==="never"?1:2,Il="never";vr&&_f++;for(let Pa=0;Pa<_f;Pa++){for(let Cl=fs;Cl<Dn;Cl++){const Al=l.textAnchorOffsets.get(Cl);if(vr&&Al.textAnchor!==vr)continue;const ko=this.attemptAnchorPlacement(Al,li,Ao,mf,v_,Oe,He,B,S,k,ne,Il,st,l,Co,y,b,gf,bt);if(ko&&(ms=ko.placedGlyphBoxes,ms&&ms.placeable))return si=!0,zn=ko.shift,ms}vr?vr=null:Il=$}return a&&!ms&&(ms={box:this.collisionIndex.placeCollisionBox(Io,"always",B,S,k,He,Oe,y,ne.predicate,bt,new c.P(0,0)).box,offscreen:!1,placeable:!1}),ms};wn(()=>Cr(Io,ht.iconBox,c.ah.horizontal),()=>{const li=ht.verticalTextBox;return l.allowVerticalPlacement&&(!Oi||!Oi.placeable)&&st.numVerticalGlyphVertices>0&&li?Cr(li,ht.verticalIconBox,c.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Oi&&(si=Oi.placeable,Pr=Oi.offscreen);const cn=bn(Oi&&Oi.placeable);if(!si&&this.prevPlacement){const li=this.prevPlacement.variableOffsets[st.crossTileID];li&&(this.variableOffsets[st.crossTileID]=li,this.markUsedJustification(l,li.anchor,st,cn))}}}if(Rr=Oi,si=Rr&&Rr.placeable,Pr=Rr&&Rr.offscreen,st.useRuntimeCollisionCircles){const bn=l.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),wn=c.ai(l.textSizeData,Q,bn),fs=d.get("text-padding");Ir=this.collisionIndex.placeCollisionCircles($,bn,l.lineVertexArray,l.glyphOffsetArray,wn,S,k,M,z,a,He,ne.predicate,st.collisionCircleDiameter,fs,y,bt),Ir.circles.length&&Ir.collisionDetected&&!a&&c.w("Collisions detected, but collision boxes are not shown"),si=de||Ir.circles.length>0&&!Ir.collisionDetected,Pr=Pr&&Ir.offscreen}if(ht.iconFeatureIndex&&(Tl=ht.iconFeatureIndex),ht.iconBox){const bn=wn=>this.collisionIndex.placeCollisionBox(wn,me,B,S,k,He,Oe,b,ne.predicate,bt,lt&&zn?zn:void 0);Hr&&Hr.placeable&&ht.verticalIconBox?(Or=bn(ht.verticalIconBox),Ri=Or.placeable):(Or=bn(ht.iconBox),Ri=Or.placeable),Pr=Pr&&Or.offscreen}const xn=oe||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,Pl=ce||st.numIconVertices===0;xn||Pl?Pl?xn||(Ri=Ri&&si):si=Ri&&si:Ri=si=Ri&&si;const Mu=Ri&&Or.placeable;if(si&&Rr.placeable&&this.collisionIndex.insertCollisionBox(Rr.box,$,d.get("text-ignore-placement"),l.bucketInstanceId,Hr&&Hr.placeable&&Po?Po:Kn,ne.ID),Mu&&this.collisionIndex.insertCollisionBox(Or.box,me,d.get("icon-ignore-placement"),l.bucketInstanceId,Tl,ne.ID),Ir&&si&&this.collisionIndex.insertCollisionCircles(Ir.circles,$,d.get("text-ignore-placement"),l.bucketInstanceId,Kn,ne.ID),a&&this.storeCollisionData(l.bucketInstanceId,Ut,ht,Rr,Or,Ir),st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(l.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new Yt(si||it,Ri||et,Pr||l.justReloaded),n[st.crossTileID]=!0};if(gt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=l.getSortedSymbolIndexes(this.transform.angle);for(let ht=st.length-1;ht>=0;--ht){const Ut=st[ht];Gt(l.symbolInstances.get(Ut),l.collisionArrays[Ut],Ut)}}else for(let st=e.symbolInstanceStart;st<e.symbolInstanceEnd;st++)Gt(l.symbolInstances.get(st),l.collisionArrays[st],st);if(a&&l.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[l.bucketInstanceId];c.as(st.invProjMatrix,S),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}l.justReloaded=!1}storeCollisionData(e,n,a,l,d,y){if(a.textBox||a.iconBox){let b,S;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(n)?S=b.get(n):(S={text:null,icon:null},b.set(n,S)),a.textBox&&(S.text=l.box),a.iconBox&&(S.icon=d.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=new xi);for(let S=0;S<y.circles.length;S+=4)b.circles.push(y.circles[S+0]),b.circles.push(y.circles[S+1]),b.circles.push(y.circles[S+2]),b.circles.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,a,l){let d;d=l===c.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[c.at(n)];const y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=d>=0&&b!==d?0:a.crossTileID)}markUsedOrientation(e,n,a){const l=n===c.ah.horizontal||n===c.ah.horizontalOnly?n:0,d=n===c.ah.vertical?n:0,y=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=l;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const l=n?n.symbolFadeChange(e):1,d=n?n.opacities:{},y=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const S in this.placements){const k=this.placements[S],M=d[S];M?(this.opacities[S]=new Hi(M,l,k.text,k.icon),a=a||k.text!==M.text.placed||k.icon!==M.icon.placed):(this.opacities[S]=new Hi(null,l,k.text,k.icon,k.skipFade),a=a||k.text||k.icon)}for(const S in d){const k=d[S];if(!this.opacities[S]){const M=new Hi(k,l,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||k.text.placed||k.icon.placed)}}for(const S in y)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=y[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const l of n){const d=l.getBucket(e);d&&l.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,l.tileID,a,l.collisionBoxArray)}}updateBucketOpacities(e,n,a,l){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],y=d.layout,b=new Hi(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),k=y.get("icon-allow-overlap"),M=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",G=y.get("icon-text-fit")!=="none",H=new Hi(null,0,S&&(k||!e.hasIconData()||y.get("icon-optional")),k&&(S||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&l&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(l);const Q=(oe,ce,$)=>{for(let de=0;de<ce/4;de++)oe.opacityVertexArray.emplaceBack($);oe.hasVisibleVertices=oe.hasVisibleVertices||$!==ro},ne=this.collisionBoxArrays.get(e.bucketInstanceId);for(let oe=0;oe<e.symbolInstances.length;oe++){const ce=e.symbolInstances.get(oe),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:de,crossTileID:me}=ce;let we=this.opacities[me];a[me]?we=b:we||(we=H,this.opacities[me]=we),a[me]=!0;const Oe=ce.numIconVertices>0,He=this.placedOrientations[ce.crossTileID],lt=He===c.ah.vertical,gt=He===c.ah.horizontal||He===c.ah.horizontalOnly;if($>0||de>0){const et=on(we.text);Q(e.text,$,lt?ro:et),Q(e.text,de,gt?ro:et);const bt=we.text.isHidden();[ce.rightJustifiedTextSymbolIndex,ce.centerJustifiedTextSymbolIndex,ce.leftJustifiedTextSymbolIndex].forEach(ht=>{ht>=0&&(e.text.placedSymbolArray.get(ht).hidden=bt||lt?1:0)}),ce.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ce.verticalPlacedTextSymbolIndex).hidden=bt||gt?1:0);const Gt=this.variableOffsets[ce.crossTileID];Gt&&this.markUsedJustification(e,Gt.anchor,ce,He);const st=this.placedOrientations[ce.crossTileID];st&&(this.markUsedJustification(e,"left",ce,st),this.markUsedOrientation(e,st,ce))}if(Oe){const et=on(we.icon),bt=!(G&&ce.verticalPlacedIconSymbolIndex&&lt);ce.placedIconSymbolIndex>=0&&(Q(e.icon,ce.numIconVertices,bt?et:ro),e.icon.placedSymbolArray.get(ce.placedIconSymbolIndex).hidden=we.icon.isHidden()),ce.verticalPlacedIconSymbolIndex>=0&&(Q(e.icon,ce.numVerticalIconVertices,bt?ro:et),e.icon.placedSymbolArray.get(ce.verticalPlacedIconSymbolIndex).hidden=we.icon.isHidden())}const it=ne&&ne.has(oe)?ne.get(oe):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const et=e.collisionArrays[oe];if(et){let bt=new c.P(0,0);if(et.textBox||et.verticalTextBox){let Gt=!0;if(M){const st=this.variableOffsets[me];st?(bt=yr(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),z&&bt._rotate(B?this.transform.angle:-this.transform.angle)):Gt=!1}if(et.textBox||et.verticalTextBox){let st;et.textBox&&(st=lt),et.verticalTextBox&&(st=gt),io(e.textCollisionBox.collisionVertexArray,we.text.placed,!Gt||st,it.text,bt.x,bt.y)}}if(et.iconBox||et.verticalIconBox){const Gt=!!(!gt&&et.verticalIconBox);let st;et.iconBox&&(st=Gt),et.verticalIconBox&&(st=!Gt),io(e.iconCollisionBox.collisionVertexArray,we.icon.placed,st,it.icon,G?bt.x:0,G?bt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=oe.invProjMatrix,e.placementViewportMatrix=oe.viewportMatrix,e.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function io(p,e,n,a,l,d){a&&a.length!==0||(a=[0,0,0,0]);const y=a[0]-Wt,b=a[1]-Wt,S=a[2]-Wt,k=a[3]-Wt;p.emplaceBack(e?1:0,n?1:0,l||0,d||0,y,b),p.emplaceBack(e?1:0,n?1:0,l||0,d||0,S,b),p.emplaceBack(e?1:0,n?1:0,l||0,d||0,S,k),p.emplaceBack(e?1:0,n?1:0,l||0,d||0,y,k)}const bi=Math.pow(2,25),Uc=Math.pow(2,24),qc=Math.pow(2,17),nn=Math.pow(2,16),sn=Math.pow(2,9),Hg=Math.pow(2,8),gn=Math.pow(2,1);function on(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,n=Math.floor(127*p.opacity);return n*bi+e*Uc+n*qc+e*nn+n*sn+e*Hg+n*gn+e}const ro=0;function Es(){return{isOccluded:(p,e,n)=>!1,getPitchedTextCorrection:(p,e,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,e,n,a){throw new Error("Not implemented.")},translatePosition:(p,e,n,a)=>function(l,d,y,b,S=!1){if(!y[0]&&!y[1])return[0,0];const k=S?b==="map"?l.angle:0:b==="viewport"?-l.angle:0;if(k){const M=Math.sin(k),z=Math.cos(k);y=[y[0]*z-y[1]*M,y[0]*M+y[1]*z]}return[S?y[0]:ni(d,y[0],l.zoom),S?y[1]:ni(d,y[1],l.zoom)]}(p,e,n,a),getCircleRadiusCorrection:p=>1}}class sr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,l,d){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,l,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,S)=>b.sortKey-S.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class aa{constructor(e,n,a,l,d,y,b,S){this.placement=new Lr(e,Es(),n,y,b,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const l=N.now(),d=()=>!this._forceFullPlacement&&N.now()-l>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new sr(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Cn=512/c.X/2;class tr{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const l=new Map;for(let d=0;d<n.length;d++){const y=n.get(d),b=y.key,S=l.get(b);S?S.push(y):l.set(b,[y])}for(const[d,y]of l){const b={positions:y.map(S=>({x:Math.floor(S.anchorX*Cn),y:Math.floor(S.anchorY*Cn)})),crossTileIDs:y.map(S=>S.crossTileID)};if(b.positions.length>128){const S=new c.av(b.positions.length,16,Uint16Array);for(const{x:k,y:M}of b.positions)S.add(k,M);S.finish(),delete b.positions,b.index=S}this._symbolsByKey[d]=b}}getScaledCoordinates(e,n){const{x:a,y:l,z:d}=this.tileID.canonical,{x:y,y:b,z:S}=n.canonical,k=Cn/Math.pow(2,S-d),M=(b*c.X+e.anchorY)*k,z=l*c.X*Cn;return{x:Math.floor((y*c.X+e.anchorX)*k-a*c.X*Cn),y:Math.floor(M-z)}}findMatches(e,n,a){const l=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let d=0;d<e.length;d++){const y=e.get(d);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const S=this.getScaledCoordinates(y,n);if(b.index){const k=b.index.range(S.x-l,S.y-l,S.x+l,S.y+l).sort();for(const M of k){const z=b.crossTileIDs[M];if(!a[z]){a[z]=!0,y.crossTileID=z;break}}}else if(b.positions)for(let k=0;k<b.positions.length;k++){const M=b.positions[k],z=b.crossTileIDs[k];if(Math.abs(M.x-S.x)<=l&&Math.abs(M.y-S.y)<=l&&!a[z]){a[z]=!0,y.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ha{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class An{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const l=this.indexes[a],d={};for(const y in l){const b=l[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),d[b.tileID.key]=b}this.indexes[a]=d}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<n.symbolInstances.length;d++)n.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const l=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const y=this.indexes[d];if(Number(d)>e.overscaledZ)for(const b in y){const S=y[b];S.tileID.isChildOf(e)&&S.findMatches(n.symbolInstances,e,l)}else{const b=y[e.scaledTo(Number(d)).key];b&&b.findMatches(n.symbolInstances,e,l)}}for(let d=0;d<n.symbolInstances.length;d++){const y=n.symbolInstances.get(d);y.crossTileID||(y.crossTileID=a.generate(),l[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new tr(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const l of a)delete this.usedCrossTileIDs[e][l]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const l=this.indexes[a];for(const d in l)e[l[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,l[d]),delete l[d],n=!0)}return n}}class Zc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ha,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let l=this.layerIndexes[e.id];l===void 0&&(l=this.layerIndexes[e.id]=new An);let d=!1;const y={};l.handleWrapJump(a);for(const b of n){const S=b.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),l.addBucket(b.tileID,S,this.crossTileIDs)&&(d=!0),y[S.bucketInstanceId]=!0)}return l.removeStaleBuckets(y)&&(d=!0),d}pruneUnusedLayers(e){const n={};e.forEach(a=>{n[a]=!0});for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}const kn=(p,e)=>c.t(p,e&&e.filter(n=>n.identifier!=="source.canvas")),Xg=c.aw();class Xa extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const l=this.sourceCaches[a].getSource().type;l!=="vector"&&l!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new zr(Wi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,l)=>this.getGlyphs(a,l)),this.dispatcher.registerMessageHandler("GI",(a,l)=>this.getImages(a,l)),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new ft(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ri(256,512),this.crossTileSymbolIndex=new Zc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ay()),fn().on(Ke,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const l=this.sourceCaches[a.sourceId];if(!l)return;const d=l.getSource();if(d&&d.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===d.id&&this._validateLayer(b)}})}loadURL(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const l=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;c.h(l,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,a)}).catch(y=>{this._loadStyleRequest=null,y&&!d.signal.aborted&&this.fire(new c.j(y))})}loadJSON(e,n={},a){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Xg,{validate:!1})}_load(e,n,a){var l;const d=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!kn(this,c.u(d))){this._loaded=!0,this.stylesheet=d;for(const y in d.sources)this.addSource(y,d.sources[y],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new ut(this.stylesheet.light),this.sky=new zt(this.stylesheet.sky),this.map.setTerrain((l=this.stylesheet.terrain)!==null&&l!==void 0?l:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const e=c.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const a=c.aA(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let l;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,y,b,S){return c._(this,void 0,void 0,function*(){const k=$e(d),M=b>1?"@2x":"",z={},B={};for(const{id:G,url:H}of k){const Q=y.transformRequest(nt(H,M,".json"),"SpriteJSON");z[G]=c.h(Q,S);const ne=y.transformRequest(nt(H,M,".png"),"SpriteImage");B[G]=Ee.getImage(ne,S)}return yield Promise.all([...Object.values(z),...Object.values(B)]),function(G,H){return c._(this,void 0,void 0,function*(){const Q={};for(const ne in G){Q[ne]={};const oe=N.getImageCanvasContext((yield H[ne]).data),ce=(yield G[ne]).data;for(const $ in ce){const{width:de,height:me,x:we,y:Oe,sdf:He,pixelRatio:lt,stretchX:gt,stretchY:it,content:et,textFitWidth:bt,textFitHeight:Gt}=ce[$];Q[ne][$]={data:null,pixelRatio:lt,sdf:He,stretchX:gt,stretchY:it,content:et,textFitWidth:bt,textFitHeight:Gt,spriteData:{width:de,height:me,x:we,y:Oe,context:oe}}}}return Q})}(z,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const y in d){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(S=>!(S in d)):[];for(const S of b)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in d[y]){const k=y==="default"?S:`${y}:${S}`;this._spritesImagesIds[y].push(k),k in this.imageManager.images?this.imageManager.updateImage(k,d[y][S],!1):this.imageManager.addImage(k,d[y][S]),n&&(this._changedImages[k]=!0)}}}).catch(d=>{this._spriteRequest=null,l=d,this.fire(new c.j(l))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),a&&a(l)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const l=n.getSource();(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(a)===-1)&&this.fire(new c.j(new Error(`Source layer "${a}" does not exist on source "${l.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.aB(a):a);const l=[];for(const d of e)if(a[d]){const y=n?c.aB(a[d]):a[d];l.push(y)}return l}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const l=this._layers[a];l.type!=="custom"&&(e[a]=l.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const l=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(l.length||d.length)&&this._updateWorkerLayers(l,d);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const l in this.sourceCaches){const d=this.sourceCaches[l];a[l]=d.used,d.used=!1}for(const l of this._order){const d=this._layers[l];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const l in a){const d=this.sourceCaches[l];!!a[l]!=!!d.used&&d.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:l}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,n&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const l=this.serialize();if(e=n.transformStyle?n.transformStyle(l,e):e,((a=n.validate)===null||a===void 0||a)&&kn(this,c.u(e)))return!1;(e=c.aB(e)).layers=c.az(e.layers);const d=c.aC(l,e),y=this._getOperationsToPerform(d);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const l of e)switch(l.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,l.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,l.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,l.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,l.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,l.args));break;case"addSource":n.push(()=>this.addSource.apply(this,l.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,l.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,l.args));break;case"setLight":n.push(()=>this.setLight.apply(this,l.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,l.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,l.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,l.args));break;case"setSky":n.push(()=>this.setSky.apply(this,l.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,l.args));break;case"setTransition":n.push(()=>{});break;default:a.push(l.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.u.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const l=this.sourceCaches[e]=new Nt(e,n,this.dispatcher);l.style=this,l.setEventedParent(this,()=>({isSourceLoaded:l.loaded(),source:l.serialize(),sourceId:e})),l.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new c.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const l=e.id;if(this.getLayer(l))return void this.fire(new c.j(new Error(`Layer "${l}" already exists on this map.`)));let d;if(e.type==="custom"){if(kn(this,c.aD(e)))return;d=c.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(l,e.source),e=c.aB(e),e=c.e(e,{source:l})),this._validate(c.u.layer,`layers.${l}`,e,{arrayIndex:-1},a))return;d=c.aA(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:l}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.j(new Error(`Cannot add layer "${l}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,l),this._layerOrderChanged=!0,this._layers[l]=d,this._removedLayers[l]&&d.source&&d.type!=="custom"){const b=this._removedLayers[l];delete this._removedLayers[l],b.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const l=n?this._order.indexOf(n):this._order.length;n&&l===-1?this.fire(new c.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(l,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const l=this.getLayer(e);l?l.minzoom===n&&l.maxzoom===a||(n!=null&&(l.minzoom=n),a!=null&&(l.maxzoom=a),this._updateLayer(l)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const l=this.getLayer(e);if(l){if(!c.aE(l.filter,n))return n==null?(l.filter=void 0,void this._updateLayer(l)):void(this._validate(c.u.filter,`layers.${l.id}.filter`,n,null,a)||(l.filter=c.aB(n),this._updateLayer(l)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,a,l={}){this._checkLoaded();const d=this.getLayer(e);d?c.aE(d.getLayoutProperty(n),a)||(d.setLayoutProperty(n,a,l),this._updateLayer(d)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,l={}){this._checkLoaded();const d=this.getLayer(e);d?c.aE(d.getPaintProperty(n),a)||(d.setPaintProperty(n,a,l)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,l=e.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const y=d.getSource().type;y==="geojson"&&l?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||l?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(l,e.id,n)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,l=this.sourceCaches[a];if(l===void 0)return void this.fire(new c.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=l.getSource().type,y=d==="vector"?e.sourceLayer:void 0;d!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):l.removeFeatureState(y,e.id,n):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,l=this.sourceCaches[n];if(l!==void 0)return l.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),l.getFeatureState(a,e.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.aF(this.sourceCaches,d=>d.serialize()),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,l=this.stylesheet;return c.aG({version:l.version,name:l.name,metadata:l.metadata,light:l.light,sky:l.sky,center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,sprite:l.sprite,glyphs:l.glyphs,transition:l.transition,sources:e,layers:n,terrain:a},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",a={},l=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b)){a[b]=y;for(const S of e){const k=S[b];if(k)for(const M of k)l.push(M)}}}l.sort((y,b)=>b.intersectionZ-y.intersectionZ);const d=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b))for(let S=l.length-1;S>=0;S--){const k=l[S].feature;if(a[k.layer.id]<y)break;d.push(k),l.pop()}else for(const S of e){const k=S[b];if(k)for(const M of k)d.push(M.feature)}}return d}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(c.u.filter,"queryRenderedFeatures.filter",n.filter,null,n);const l={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const b of n.layers){const S=this._layers[b];if(!S)return this.fire(new c.j(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];l[S.source]=!0}}const d=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers();for(const b in this.sourceCaches)n.layers&&!l[b]||d.push(cr(this.sourceCaches[b],this._layers,y,e,n,a));return this.placement&&d.push(function(b,S,k,M,z,B,G){const H={},Q=B.queryRenderedSymbols(M),ne=[];for(const oe of Object.keys(Q).map(Number))ne.push(G[oe]);ne.sort(mt);for(const oe of ne){const ce=oe.featureIndex.lookupSymbolFeatures(Q[oe.bucketInstanceId],S,oe.bucketIndex,oe.sourceLayerIndex,z.filter,z.layers,z.availableImages,b);for(const $ in ce){const de=H[$]=H[$]||[],me=ce[$];me.sort((we,Oe)=>{const He=oe.featureSortOrder;if(He){const lt=He.indexOf(we.featureIndex);return He.indexOf(Oe.featureIndex)-lt}return Oe.featureIndex-we.featureIndex});for(const we of me)de.push(we)}}for(const oe in H)H[oe].forEach(ce=>{const $=ce.feature,de=k[b[oe].source].getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=de});return H}(this._layers,y,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.u.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?function(l,d){const y=l.getRenderableIds().map(k=>l.getTileByID(k)),b=[],S={};for(let k=0;k<y.length;k++){const M=y[k],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(b,d))}return b}(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let l=!1;for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const d={now:N.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(d)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){const a=this.getSky();let l=!1;if(!e&&!a)return;if(e&&!a)l=!0;else if(!e&&a)l=!0;else for(const y in e)if(!c.aE(e[y],a[y])){l=!0;break}if(!l)return;const d={now:N.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(d)}_validate(e,n,a,l,d={}){return(!d||d.validate!==!1)&&kn(this,e.call(c.u,c.e({key:n,style:this.serialize(),value:a,styleSpec:c.v},l)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),fn().off(Ke,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,l,d=!1){let y=!1,b=!1;const S={};for(const k of this._order){const M=this._layers[k];if(M.type!=="symbol")continue;if(!S[M.source]){const B=this.sourceCaches[M.source];S[M.source]=B.getRenderableIds(!0).map(G=>B.getTileByID(G)).sort((G,H)=>H.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(H.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);y=y||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(N.now(),e.zoom))&&(this.pauseablePlacement=new aa(e,this.map.terrain,this._order,d,n,a,l,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(N.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const k of this._order){const M=this._layers[k];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(N.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,n.icons),a})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),l=this.sourceCaches[n.source];return l&&l.setDependencies(n.tileID.key,n.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.u.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},l){this._checkLoaded();const d=[{id:e,url:n}],y=[...$e(this.stylesheet.sprite),...d];this._validate(c.u.sprite,"sprite",y,null,a)||(this.stylesheet.sprite=y,this._loadSprite(d,!0,l))}removeSprite(e){this._checkLoaded();const n=$e(this.stylesheet.sprite);if(n.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex(a=>a.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return $e(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(c.u.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Ms=c.Y([{name:"a_pos",type:"Int16",components:2}]);const ds={prelude:mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:mi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mi(p,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),l=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=d?d.concat(l):l,b={};return{fragmentSource:p=p.replace(n,(S,k,M,z,B)=>(b[B]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(n,(S,k,M,z,B)=>{const G=z==="float"?"vec2":"vec4",H=B.match(/color/)?"color":G;return b[B]?k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${G} a_${B};
varying ${M} ${z} ${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${M} ${G} a_${B};
#else
uniform ${M} ${z} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = a_${B};
#else
    ${M} ${z} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${M} ${z} ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${M} ${z} ${B} = u_${B};
#endif
`}),staticAttributes:a,staticUniforms:y}}class Gc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,l,d,y,b,S,k){this.context=e;let M=this.boundPaintVertexBuffers.length!==l.length;for(let z=0;!M&&z<l.length;z++)this.boundPaintVertexBuffers[z]!==l[z]&&(M=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==d||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==k?this.freshBind(n,a,l,d,y,b,S,k):(e.bindVertexArray.set(this.vao),b&&b.bind(),d&&d.dynamicDraw&&d.bind(),S&&S.bind(),k&&k.bind())}freshBind(e,n,a,l,d,y,b,S){const k=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=l,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=S,n.enableAttributes(z,e);for(const B of a)B.enableAttributes(z,e);y&&y.enableAttributes(z,e),b&&b.enableAttributes(z,e),S&&S.enableAttributes(z,e),n.bind(),n.setVertexAttribPointers(z,e,d);for(const B of a)B.bind(),B.setVertexAttribPointers(z,e,d);y&&(y.bind(),y.setVertexAttribPointers(z,e,d)),l&&l.bind(),b&&(b.bind(),b.setVertexAttribPointers(z,e,d)),S&&(S.bind(),S.setVertexAttribPointers(z,e,d)),M.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Wc=(p,e,n,a,l)=>({u_matrix:p,u_texture:0,u_ele_delta:e,u_fog_matrix:n,u_fog_color:a?a.properties.get("fog-color"):c.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):c.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function no(p){const e=[];for(let n=0;n<p.length;n++){if(p[n]===null)continue;const a=p[n].split(" ");e.push(a.pop())}return e}class Hc{constructor(e,n,a,l,d,y){const b=e.gl;this.program=b.createProgram();const S=no(n.staticAttributes),k=a?a.getBinderAttributes():[],M=S.concat(k),z=ds.prelude.staticUniforms?no(ds.prelude.staticUniforms):[],B=n.staticUniforms?no(n.staticUniforms):[],G=a?a.getBinderUniforms():[],H=z.concat(B).concat(G),Q=[];for(const we of H)Q.indexOf(we)<0&&Q.push(we);const ne=a?a.defines():[];d&&ne.push("#define OVERDRAW_INSPECTOR;"),y&&ne.push("#define TERRAIN3D;");const oe=ne.concat(ds.prelude.fragmentSource,n.fragmentSource).join(`
`),ce=ne.concat(ds.prelude.vertexSource,n.vertexSource).join(`
`),$=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource($,oe),b.compileShader($),!b.getShaderParameter($,b.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${b.getShaderInfoLog($)}`);b.attachShader(this.program,$);const de=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);if(b.shaderSource(de,ce),b.compileShader(de),!b.getShaderParameter(de,b.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${b.getShaderInfoLog(de)}`);b.attachShader(this.program,de),this.attributes={};const me={};this.numAttributes=M.length;for(let we=0;we<this.numAttributes;we++)M[we]&&(b.bindAttribLocation(this.program,we,M[we]),this.attributes[M[we]]=we);if(b.linkProgram(this.program),!b.getProgramParameter(this.program,b.LINK_STATUS))throw new Error(`Program failed to link: ${b.getProgramInfoLog(this.program)}`);b.deleteShader(de),b.deleteShader($);for(let we=0;we<Q.length;we++){const Oe=Q[we];if(Oe&&!me[Oe]){const He=b.getUniformLocation(this.program,Oe);He&&(me[Oe]=He)}}this.fixedUniforms=l(e,me),this.terrainUniforms=((we,Oe)=>({u_depth:new c.aH(we,Oe.u_depth),u_terrain:new c.aH(we,Oe.u_terrain),u_terrain_dim:new c.aI(we,Oe.u_terrain_dim),u_terrain_matrix:new c.aJ(we,Oe.u_terrain_matrix),u_terrain_unpack:new c.aK(we,Oe.u_terrain_unpack),u_terrain_exaggeration:new c.aI(we,Oe.u_terrain_exaggeration)}))(e,me),this.binderUniforms=a?a.getUniforms(e,me):[]}draw(e,n,a,l,d,y,b,S,k,M,z,B,G,H,Q,ne,oe,ce){const $=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(l),e.setColorMode(d),e.setCullFace(y),S){e.activeTexture.set($.TEXTURE2),$.bindTexture($.TEXTURE_2D,S.depthTexture),e.activeTexture.set($.TEXTURE3),$.bindTexture($.TEXTURE_2D,S.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(S[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(b[me]);Q&&Q.setUniforms(e,this.binderUniforms,G,{zoom:H});let de=0;switch(n){case $.LINES:de=2;break;case $.TRIANGLES:de=3;break;case $.LINE_STRIP:de=1}for(const me of B.get()){const we=me.vaos||(me.vaos={});(we[k]||(we[k]=new Gc)).bind(e,this,M,Q?Q.getPaintVertexBuffers():[],z,me.vertexOffset,ne,oe,ce),$.drawElements(n,me.primitiveLength*de,$.UNSIGNED_SHORT,me.primitiveOffset*de*2)}}}function Ka(p,e,n){const a=1/ni(n,1,e.transform.tileZoom),l=Math.pow(2,n.tileID.overscaledZ),d=n.tileSize*Math.pow(2,e.transform.tileZoom)/l,y=d*(n.tileID.canonical.x+n.tileID.wrap*l),b=d*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const la=(p,e,n,a)=>{const l=e.style.light,d=l.properties.get("position"),y=[d.x,d.y,d.z],b=function(){var k=new c.A(9);return c.A!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1,k}();l.properties.get("anchor")==="viewport"&&function(k,M){var z=Math.sin(M),B=Math.cos(M);k[0]=B,k[1]=z,k[2]=0,k[3]=-z,k[4]=B,k[5]=0,k[6]=0,k[7]=0,k[8]=1}(b,-e.transform.angle),function(k,M,z){var B=M[0],G=M[1],H=M[2];k[0]=B*z[0]+G*z[3]+H*z[6],k[1]=B*z[1]+G*z[4]+H*z[7],k[2]=B*z[2]+G*z[5]+H*z[8]}(y,y,b);const S=l.properties.get("color");return{u_matrix:p,u_lightpos:y,u_lightintensity:l.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:a}},$a=(p,e,n,a,l,d,y)=>c.e(la(p,e,n,a),Ka(d,e,y),{u_height_factor:-Math.pow(2,l.overscaledZ)/y.tileSize/8}),so=p=>({u_matrix:p}),Rp=(p,e,n,a)=>c.e(so(p),Ka(n,e,a)),Kg=(p,e)=>({u_matrix:p,u_world:e}),Op=(p,e,n,a,l)=>c.e(Rp(p,e,n,a),{u_world:l}),$g=(p,e,n,a)=>{const l=p.transform;let d,y;if(a.paint.get("circle-pitch-alignment")==="map"){const b=ni(n,1,l.zoom);d=!0,y=[b,b]}else d=!1,y=l.pixelsToGLUnits;return{u_camera_to_center_distance:l.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(e.posMatrix,n,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:y}},zs=(p,e,n)=>({u_matrix:p,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),ca=(p,e,n=1)=>({u_matrix:p,u_color:e,u_overlay:0,u_overlay_scale:n}),Gr=p=>({u_matrix:p}),Wr=(p,e,n,a)=>({u_matrix:p,u_extrude_scale:ni(e,1,n),u_intensity:a}),Ja=(p,e,n,a)=>{const l=c.H();c.aP(l,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:l,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function Ya(p,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new c.Z(0,a/n).toLngLat().lat,new c.Z(0,(a+1)/n).toLngLat().lat]}const Qa=(p,e,n,a)=>{const l=p.transform;return{u_matrix:Np(p,e,n,a),u_ratio:1/ni(e,1,l.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/l.pixelsToGLUnits[0],1/l.pixelsToGLUnits[1]]}},Fp=(p,e,n,a,l)=>c.e(Qa(p,e,n,l),{u_image:0,u_image_height:a}),oo=(p,e,n,a,l)=>{const d=p.transform,y=Bp(e,d);return{u_matrix:Np(p,e,n,l),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ni(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[y,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Jg=(p,e,n,a,l,d)=>{const y=p.lineAtlas,b=Bp(e,p.transform),S=n.layout.get("line-cap")==="round",k=y.getDash(a.from,S),M=y.getDash(a.to,S),z=k.width*l.fromScale,B=M.width*l.toScale;return c.e(Qa(p,e,n,d),{u_patternscale_a:[b/z,-k.height/2],u_patternscale_b:[b/B,-M.height/2],u_sdfgamma:y.width/(256*Math.min(z,B)*p.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:M.y,u_mix:l.t})};function Bp(p,e){return 1/ni(p,1,e.tileZoom)}function Np(p,e,n,a){return p.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Yg=(p,e,n,a,l)=>{return{u_matrix:p,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(d=l.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Qg(l.paint.get("raster-hue-rotate"))};var d,y};function Qg(p){p*=Math.PI/180;const e=Math.sin(p),n=Math.cos(p);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Vp=(p,e,n,a,l,d,y,b,S,k,M,z,B,G)=>{const H=y.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:H.width/H.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:l,u_is_variable_anchor:d,u_texsize:B,u_texture:0,u_translation:M,u_pitched_scale:G}},ua=(p,e,n,a,l,d,y,b,S,k,M,z,B,G,H)=>{const Q=y.transform;return c.e(Vp(p,e,n,a,l,d,y,b,S,k,M,z,B,H),{u_gamma_scale:a?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:+G})},Xc=(p,e,n,a,l,d,y,b,S,k,M,z,B,G)=>c.e(ua(p,e,n,a,l,d,y,b,S,k,M,!0,z,!0,G),{u_texsize_icon:B,u_texture_icon:1}),el=(p,e,n)=>({u_matrix:p,u_opacity:e,u_color:n}),Kc=(p,e,n,a,l,d)=>c.e(function(y,b,S,k){const M=S.imageManager.getPattern(y.from.toString()),z=S.imageManager.getPattern(y.to.toString()),{width:B,height:G}=S.imageManager.getPixelSize(),H=Math.pow(2,k.tileID.overscaledZ),Q=k.tileSize*Math.pow(2,S.transform.tileZoom)/H,ne=Q*(k.tileID.canonical.x+k.tileID.wrap*H),oe=Q*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,G],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/ni(k,1,S.transform.tileZoom),u_pixel_coord_upper:[ne>>16,oe>>16],u_pixel_coord_lower:[65535&ne,65535&oe]}}(a,d,n,l),{u_matrix:p,u_opacity:e}),$c={fillExtrusion:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_lightpos:new c.aN(p,e.u_lightpos),u_lightintensity:new c.aI(p,e.u_lightintensity),u_lightcolor:new c.aN(p,e.u_lightcolor),u_vertical_gradient:new c.aI(p,e.u_vertical_gradient),u_opacity:new c.aI(p,e.u_opacity)}),fillExtrusionPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_lightpos:new c.aN(p,e.u_lightpos),u_lightintensity:new c.aI(p,e.u_lightintensity),u_lightcolor:new c.aN(p,e.u_lightcolor),u_vertical_gradient:new c.aI(p,e.u_vertical_gradient),u_height_factor:new c.aI(p,e.u_height_factor),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade),u_opacity:new c.aI(p,e.u_opacity)}),fill:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix)}),fillPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),fillOutline:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world)}),fillOutlinePattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world),u_image:new c.aH(p,e.u_image),u_texsize:new c.aO(p,e.u_texsize),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),circle:(p,e)=>({u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_scale_with_map:new c.aH(p,e.u_scale_with_map),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_extrude_scale:new c.aO(p,e.u_extrude_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_matrix:new c.aJ(p,e.u_matrix)}),collisionBox:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_pixel_extrude_scale:new c.aO(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_inv_matrix:new c.aJ(p,e.u_inv_matrix),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_viewport_size:new c.aO(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new c.aL(p,e.u_color),u_matrix:new c.aJ(p,e.u_matrix),u_overlay:new c.aH(p,e.u_overlay),u_overlay_scale:new c.aI(p,e.u_overlay_scale)}),clippingMask:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix)}),heatmap:(p,e)=>({u_extrude_scale:new c.aI(p,e.u_extrude_scale),u_intensity:new c.aI(p,e.u_intensity),u_matrix:new c.aJ(p,e.u_matrix)}),heatmapTexture:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_world:new c.aO(p,e.u_world),u_image:new c.aH(p,e.u_image),u_color_ramp:new c.aH(p,e.u_color_ramp),u_opacity:new c.aI(p,e.u_opacity)}),hillshade:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_latrange:new c.aO(p,e.u_latrange),u_light:new c.aO(p,e.u_light),u_shadow:new c.aL(p,e.u_shadow),u_highlight:new c.aL(p,e.u_highlight),u_accent:new c.aL(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_image:new c.aH(p,e.u_image),u_dimension:new c.aO(p,e.u_dimension),u_zoom:new c.aI(p,e.u_zoom),u_unpack:new c.aK(p,e.u_unpack)}),line:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_image:new c.aH(p,e.u_image),u_image_height:new c.aI(p,e.u_image_height)}),linePattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texsize:new c.aO(p,e.u_texsize),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_image:new c.aH(p,e.u_image),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_scale:new c.aN(p,e.u_scale),u_fade:new c.aI(p,e.u_fade)}),lineSDF:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ratio:new c.aI(p,e.u_ratio),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new c.aO(p,e.u_units_to_pixels),u_patternscale_a:new c.aO(p,e.u_patternscale_a),u_patternscale_b:new c.aO(p,e.u_patternscale_b),u_sdfgamma:new c.aI(p,e.u_sdfgamma),u_image:new c.aH(p,e.u_image),u_tex_y_a:new c.aI(p,e.u_tex_y_a),u_tex_y_b:new c.aI(p,e.u_tex_y_b),u_mix:new c.aI(p,e.u_mix)}),raster:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_tl_parent:new c.aO(p,e.u_tl_parent),u_scale_parent:new c.aI(p,e.u_scale_parent),u_buffer_scale:new c.aI(p,e.u_buffer_scale),u_fade_t:new c.aI(p,e.u_fade_t),u_opacity:new c.aI(p,e.u_opacity),u_image0:new c.aH(p,e.u_image0),u_image1:new c.aH(p,e.u_image1),u_brightness_low:new c.aI(p,e.u_brightness_low),u_brightness_high:new c.aI(p,e.u_brightness_high),u_saturation_factor:new c.aI(p,e.u_saturation_factor),u_contrast_factor:new c.aI(p,e.u_contrast_factor),u_spin_weights:new c.aN(p,e.u_spin_weights)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texture:new c.aH(p,e.u_texture),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texture:new c.aH(p,e.u_texture),u_gamma_scale:new c.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_is_halo:new c.aH(p,e.u_is_halo),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new c.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aH(p,e.u_is_size_feature_constant),u_size_t:new c.aI(p,e.u_size_t),u_size:new c.aI(p,e.u_size),u_camera_to_center_distance:new c.aI(p,e.u_camera_to_center_distance),u_pitch:new c.aI(p,e.u_pitch),u_rotate_symbol:new c.aH(p,e.u_rotate_symbol),u_aspect_ratio:new c.aI(p,e.u_aspect_ratio),u_fade_change:new c.aI(p,e.u_fade_change),u_matrix:new c.aJ(p,e.u_matrix),u_label_plane_matrix:new c.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new c.aJ(p,e.u_coord_matrix),u_is_text:new c.aH(p,e.u_is_text),u_pitch_with_map:new c.aH(p,e.u_pitch_with_map),u_is_along_line:new c.aH(p,e.u_is_along_line),u_is_variable_anchor:new c.aH(p,e.u_is_variable_anchor),u_texsize:new c.aO(p,e.u_texsize),u_texsize_icon:new c.aO(p,e.u_texsize_icon),u_texture:new c.aH(p,e.u_texture),u_texture_icon:new c.aH(p,e.u_texture_icon),u_gamma_scale:new c.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new c.aI(p,e.u_device_pixel_ratio),u_is_halo:new c.aH(p,e.u_is_halo),u_translation:new c.aO(p,e.u_translation),u_pitched_scale:new c.aI(p,e.u_pitched_scale)}),background:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_opacity:new c.aI(p,e.u_opacity),u_color:new c.aL(p,e.u_color)}),backgroundPattern:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_opacity:new c.aI(p,e.u_opacity),u_image:new c.aH(p,e.u_image),u_pattern_tl_a:new c.aO(p,e.u_pattern_tl_a),u_pattern_br_a:new c.aO(p,e.u_pattern_br_a),u_pattern_tl_b:new c.aO(p,e.u_pattern_tl_b),u_pattern_br_b:new c.aO(p,e.u_pattern_br_b),u_texsize:new c.aO(p,e.u_texsize),u_mix:new c.aI(p,e.u_mix),u_pattern_size_a:new c.aO(p,e.u_pattern_size_a),u_pattern_size_b:new c.aO(p,e.u_pattern_size_b),u_scale_a:new c.aI(p,e.u_scale_a),u_scale_b:new c.aI(p,e.u_scale_b),u_pixel_coord_upper:new c.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.aO(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aI(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texture:new c.aH(p,e.u_texture),u_ele_delta:new c.aI(p,e.u_ele_delta),u_fog_matrix:new c.aJ(p,e.u_fog_matrix),u_fog_color:new c.aL(p,e.u_fog_color),u_fog_ground_blend:new c.aI(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.aI(p,e.u_fog_ground_blend_opacity),u_horizon_color:new c.aL(p,e.u_horizon_color),u_horizon_fog_blend:new c.aI(p,e.u_horizon_fog_blend)}),terrainDepth:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_ele_delta:new c.aI(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_matrix:new c.aJ(p,e.u_matrix),u_texture:new c.aH(p,e.u_texture),u_terrain_coords_id:new c.aI(p,e.u_terrain_coords_id),u_ele_delta:new c.aI(p,e.u_ele_delta)}),sky:(p,e)=>({u_sky_color:new c.aL(p,e.u_sky_color),u_horizon_color:new c.aL(p,e.u_horizon_color),u_horizon:new c.aI(p,e.u_horizon),u_sky_horizon_blend:new c.aI(p,e.u_sky_horizon_blend)})};class Wn{constructor(e,n,a){this.context=e;const l=e.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const e_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jc{constructor(e,n,a,l){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=l,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const l=n.attributes[this.attributes[a].name];l!==void 0&&e.enableVertexAttribArray(l)}}setVertexAttribPointers(e,n,a){for(let l=0;l<this.attributes.length;l++){const d=this.attributes[l],y=n.attributes[d.name];y!==void 0&&e.vertexAttribPointer(y,d.components,e[e_[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ds=new WeakMap;function ps(p){var e;if(Ds.has(p))return Ds.get(p);{const n=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ds.set(p,n),n}}class _i{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class tl extends _i{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class t_ extends _i{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class ao extends _i{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class i_ extends _i{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class jp extends _i{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class r_ extends _i{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Up extends _i{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Yc extends _i{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class qp extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class Zp extends _i{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Gp extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Wp extends _i{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ls extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Hp extends _i{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class n_ extends _i{getDefault(){return c.aM.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Xp extends _i{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ha extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class s_ extends _i{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class il extends _i{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class o_ extends _i{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class a_ extends _i{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Kp extends _i{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class $p extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Jp extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Qc extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Yp extends _i{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class rl extends _i{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class es extends _i{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;ps(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class eu extends _i{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class tu extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class iu extends _i{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class nl extends _i{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class ru extends nl{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Rs extends nl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class nu extends nl{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class l_{constructor(e,n,a,l,d){this.context=e,this.width=n,this.height=a;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new ru(e,b),l)this.depthAttachment=d?new nu(e,b):new Rs(e,b);else if(d)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Ji{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}Ji.Replace=[1,0],Ji.disabled=new Ji(Ji.Replace,c.aM.transparent,[!1,!1,!1,!1]),Ji.unblended=new Ji(Ji.Replace,c.aM.transparent,[!0,!0,!0,!0]),Ji.alphaBlended=new Ji([1,771],c.aM.transparent,[!0,!0,!0,!0]);class c_{constructor(e){var n,a;if(this.gl=e,this.clearColor=new tl(this),this.clearDepth=new t_(this),this.clearStencil=new ao(this),this.colorMask=new i_(this),this.depthMask=new jp(this),this.stencilMask=new r_(this),this.stencilFunc=new Up(this),this.stencilOp=new Yc(this),this.stencilTest=new qp(this),this.depthRange=new Zp(this),this.depthTest=new Gp(this),this.depthFunc=new Wp(this),this.blend=new Ls(this),this.blendFunc=new Hp(this),this.blendColor=new n_(this),this.blendEquation=new Xp(this),this.cullFace=new ha(this),this.cullFaceSide=new s_(this),this.frontFace=new il(this),this.program=new o_(this),this.activeTexture=new a_(this),this.viewport=new Kp(this),this.bindFramebuffer=new $p(this),this.bindRenderbuffer=new Jp(this),this.bindTexture=new Qc(this),this.bindVertexBuffer=new Yp(this),this.bindElementBuffer=new rl(this),this.bindVertexArray=new es(this),this.pixelStoreUnpack=new eu(this),this.pixelStoreUnpackPremultiplyAlpha=new tu(this),this.pixelStoreUnpackFlipY=new iu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ps(e)){this.HALF_FLOAT=e.HALF_FLOAT;const l=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:l==null?void 0:l.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:l==null?void 0:l.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const l=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=l==null?void 0:l.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new Wn(this,e,n)}createVertexBuffer(e,n,a){return new Jc(this,e,n,a)}createRenderbuffer(e,n,a){const l=this.gl,d=l.createRenderbuffer();return this.bindRenderbuffer.set(d),l.renderbufferStorage(l.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),d}createFramebuffer(e,n,a,l){return new l_(this,e,n,a,l)}clear({color:e,depth:n,stencil:a}){const l=this.gl;let d=0;e&&(d|=l.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(d|=l.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(d|=l.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),l.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.aE(e.blendFunction,Ji.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ps(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return ps(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const sl=7680;class ki{constructor(e,n,a,l,d,y){this.test=e,this.ref=n,this.mask=a,this.fail=l,this.depthFail=d,this.pass=y}}ki.disabled=new ki({func:519,mask:0},0,0,sl,sl,sl);class wi{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}let Os;function da(p,e,n,a,l){const d=p.context,y=d.gl,b=p.useProgram("collisionBox"),S=[];let k=0,M=0;for(let oe=0;oe<a.length;oe++){const ce=a[oe],$=e.getTile(ce).getBucket(n);if(!$)continue;const de=l?$.textCollisionBox:$.iconCollisionBox,me=$.collisionCircleArray;if(me.length>0){const we=c.H();c.aQ(we,$.placementInvProjMatrix,p.transform.glCoordMatrix),c.aQ(we,we,$.placementViewportMatrix),S.push({circleArray:me,circleOffset:M,transform:ce.posMatrix,invTransform:we,coord:ce}),k+=me.length/4,M=k}de&&b.draw(d,y.LINES,ti.disabled,ki.disabled,p.colorModeForRenderPass(),wi.disabled,{u_matrix:ce.posMatrix,u_pixel_extrude_scale:[1/(z=p.transform).width,1/z.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),n.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,null,p.transform.zoom,null,null,de.collisionVertexBuffer)}var z;if(!l||!S.length)return;const B=p.useProgram("collisionCircle"),G=new c.aR;G.resize(4*k),G._trim();let H=0;for(const oe of S)for(let ce=0;ce<oe.circleArray.length/4;ce++){const $=4*ce,de=oe.circleArray[$+0],me=oe.circleArray[$+1],we=oe.circleArray[$+2],Oe=oe.circleArray[$+3];G.emplace(H++,de,me,we,Oe,0),G.emplace(H++,de,me,we,Oe,1),G.emplace(H++,de,me,we,Oe,2),G.emplace(H++,de,me,we,Oe,3)}(!Os||Os.length<2*k)&&(Os=function(oe){const ce=2*oe,$=new c.aT;$.resize(ce),$._trim();for(let de=0;de<ce;de++){const me=6*de;$.uint16[me+0]=4*de+0,$.uint16[me+1]=4*de+1,$.uint16[me+2]=4*de+2,$.uint16[me+3]=4*de+2,$.uint16[me+4]=4*de+3,$.uint16[me+5]=4*de+0}return $}(k));const Q=d.createIndexBuffer(Os,!0),ne=d.createVertexBuffer(G,c.aS.members,!0);for(const oe of S){const ce=zs(oe.transform,oe.invTransform,p.transform);B.draw(d,y.TRIANGLES,ti.disabled,ki.disabled,p.colorModeForRenderPass(),wi.disabled,ce,p.style.map.terrain&&p.style.map.terrain.getTerrainData(oe.coord),n.id,ne,Q,c.a0.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,p.transform.zoom,null,null,null)}ne.destroy(),Q.destroy()}wi.disabled=new wi(!1,1029,2305),wi.backCCW=new wi(!0,1029,2305);const pa=c.an(new Float32Array(16));function su(p,e,n,a,l,d){const{horizontalAlign:y,verticalAlign:b}=c.au(p);return new c.P((-(y-.5)*e/l+a[0])*d,(-(b-.5)*n/l+a[1])*d)}function Fs(p,e,n,a,l,d){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=a.mult(d);n||(b=b.rotate(-l));const S=y.add(b);return te(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(n){const b=ke(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return p.add(a.rotate(S))}return p.add(a)}function lo(p,e,n,a,l,d,y,b,S,k,M,z,B,G){const H=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,ne=p.icon.dynamicLayoutVertexArray,oe={};Q.clear();for(let ce=0;ce<H.length;ce++){const $=H.get(ce),de=$.hidden||!$.crossTileID||p.allowVerticalPlacement&&!$.placedOrientation?null:a[$.crossTileID];if(de){const me=new c.P($.anchorX,$.anchorY),we={getElevation:G,width:l.width,height:l.height,labelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:n,projection:M,projectionCache:null,tileAnchorPoint:me,translation:z,unwrappedTileID:B},Oe=n?te(me.x,me.y,y,G):ke(me.x,me.y,we),He=O(l.cameraToCenterDistance,Oe.signedDistanceFromCamera);let lt=c.ai(p.textSizeData,S,$)*He/c.ap;n&&(lt*=p.tilePixelRatio/b);const{width:gt,height:it,anchor:et,textOffset:bt,textBoxScale:Gt}=de,st=su(et,gt,it,bt,Gt,lt),ht=M.getPitchedTextCorrection(l,me.add(new c.P(z[0],z[1])),B),Ut=Fs(Oe.point,we,e,st,l.angle,ht),Li=p.allowVerticalPlacement&&$.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Xt=0;Xt<$.numGlyphs;Xt++)c.aj(Q,Ut,Li);k&&$.associatedIconIndex>=0&&(oe[$.associatedIconIndex]={shiftedAnchor:Ut,angle:Li})}else Dt($.numGlyphs,Q)}if(k){ne.clear();const ce=p.icon.placedSymbolArray;for(let $=0;$<ce.length;$++){const de=ce.get($);if(de.hidden)Dt(de.numGlyphs,ne);else{const me=oe[$];if(me)for(let we=0;we<de.numGlyphs;we++)c.aj(ne,me.shiftedAnchor,me.angle);else Dt(de.numGlyphs,ne)}}p.icon.dynamicLayoutVertexBuffer.updateData(ne)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function _n(p,e,n){return n.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ou(p,e,n,a,l,d,y,b,S,k,M,z){const B=p.context,G=B.gl,H=p.transform,Q=Es(),ne=b==="map",oe=S==="map",ce=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",$=ne&&!oe&&!ce,de=!oe&&ce,me=!n.layout.get("symbol-sort-key").isConstant();let we=!1;const Oe=p.depthModeForSublayer(0,ti.ReadOnly),He=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],gt=Q.getCircleRadiusCorrection(H);for(const it of a){const et=e.getTile(it),bt=et.getBucket(n);if(!bt)continue;const Gt=l?bt.text:bt.icon;if(!Gt||!Gt.segments.get().length||!Gt.hasVisibleVertices)continue;const st=Gt.programConfigurations.get(n.id),ht=l||bt.sdfIcons,Ut=l?bt.textSizeData:bt.iconSizeData,Li=oe||H.pitch!==0,Xt=p.useProgram(_n(ht,l,bt),st),si=c.ag(Ut,H.zoom),Ri=p.style.map.terrain&&p.style.map.terrain.getTerrainData(it);let Pr,zn,Oi,Hr,Rr=[0,0],Ir=null;if(l)zn=et.glyphAtlasTexture,Oi=G.LINEAR,Pr=et.glyphAtlasTexture.size,bt.iconsInText&&(Rr=et.imageAtlasTexture.size,Ir=et.imageAtlasTexture,Hr=Li||p.options.rotating||p.options.zooming||Ut.kind==="composite"||Ut.kind==="camera"?G.LINEAR:G.NEAREST);else{const li=n.layout.get("icon-size").constantOr(0)!==1||bt.iconsNeedLinear;zn=et.imageAtlasTexture,Oi=ht||p.options.rotating||p.options.zooming||li||Li?G.LINEAR:G.NEAREST,Pr=et.imageAtlasTexture.size}const Or=ni(et,1,p.transform.zoom),Kn=de?it.posMatrix:pa,Po=hs(Kn,oe,ne,p.transform,Or),Tl=Gn(Kn,oe,ne,p.transform,Or),Io=Gn(it.posMatrix,oe,ne,p.transform,Or),xn=Q.translatePosition(p.transform,et,d,y),Pl=He&&bt.hasTextData(),Mu=n.layout.get("icon-text-fit")!=="none"&&Pl&&bt.hasIconData();if(ce){const li=p.style.map.terrain?(Co,Ao)=>p.style.map.terrain.getElevation(it,Co,Ao):null,Us=n.layout.get("text-rotation-alignment")==="map";W(bt,it.posMatrix,p,l,Po,Io,oe,k,Us,Q,it.toUnwrapped(),H.width,H.height,xn,li)}const bn=it.posMatrix,wn=l&&He||Mu,fs=ce||wn?pa:Po,Dn=Tl,vr=ht&&n.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=ht?bt.iconsInText?Xc(Ut.kind,si,$,oe,ce,wn,p,bn,fs,Dn,xn,Pr,Rr,gt):ua(Ut.kind,si,$,oe,ce,wn,p,bn,fs,Dn,xn,l,Pr,!0,gt):Vp(Ut.kind,si,$,oe,ce,wn,p,bn,fs,Dn,xn,l,Pr,gt);const cn={program:Xt,buffers:Gt,uniformValues:Cr,atlasTexture:zn,atlasTextureIcon:Ir,atlasInterpolation:Oi,atlasInterpolationIcon:Hr,isSDF:ht,hasHalo:vr};if(me&&bt.canOverlap){we=!0;const li=Gt.segments.get();for(const Us of li)lt.push({segments:new c.a0([Us]),sortKey:Us.sortKey,state:cn,terrainData:Ri})}else lt.push({segments:Gt.segments,sortKey:0,state:cn,terrainData:Ri})}we&&lt.sort((it,et)=>it.sortKey-et.sortKey);for(const it of lt){const et=it.state;if(B.activeTexture.set(G.TEXTURE0),et.atlasTexture.bind(et.atlasInterpolation,G.CLAMP_TO_EDGE),et.atlasTextureIcon&&(B.activeTexture.set(G.TEXTURE1),et.atlasTextureIcon&&et.atlasTextureIcon.bind(et.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),et.isSDF){const bt=et.uniformValues;et.hasHalo&&(bt.u_is_halo=1,au(et.buffers,it.segments,n,p,et.program,Oe,M,z,bt,it.terrainData)),bt.u_is_halo=0}au(et.buffers,it.segments,n,p,et.program,Oe,M,z,et.uniformValues,it.terrainData)}}function au(p,e,n,a,l,d,y,b,S,k){const M=a.context;l.draw(M,M.gl.TRIANGLES,d,y,b,wi.disabled,S,k,n.id,p.layoutVertexBuffer,p.indexBuffer,e,n.paint,a.transform.zoom,p.programConfigurations.get(n.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function lu(p,e,n,a){const l=p.context,d=l.gl,y=ki.disabled,b=new Ji([d.ONE,d.ONE],c.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(n);if(!S)return;const k=a.key;let M=n.heatmapFbos.get(k);M||(M=fa(l,e.tileSize,e.tileSize),n.heatmapFbos.set(k,M)),l.bindFramebuffer.set(M.framebuffer),l.viewport.set([0,0,e.tileSize,e.tileSize]),l.clear({color:c.aM.transparent});const z=S.programConfigurations.get(n.id),B=p.useProgram("heatmap",z),G=p.style.map.terrain.getTerrainData(a);B.draw(l,d.TRIANGLES,ti.disabled,y,b,wi.disabled,Wr(a.posMatrix,e,p.transform.zoom,n.paint.get("heatmap-intensity")),G,n.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,n.paint,p.transform.zoom,z)}function Bs(p,e,n){const a=p.context,l=a.gl;a.setColorMode(p.colorModeForRenderPass());const d=ma(a,e),y=n.key,b=e.heatmapFbos.get(y);b&&(a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,b.colorAttachment.get()),a.activeTexture.set(l.TEXTURE1),d.bind(l.LINEAR,l.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(a,l.TRIANGLES,ti.disabled,ki.disabled,p.colorModeForRenderPass(),wi.disabled,Ja(p,e,0,1),null,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,p.transform.zoom),b.destroy(),e.heatmapFbos.delete(y))}function fa(p,e,n){var a,l;const d=p.gl,y=d.createTexture();d.bindTexture(d.TEXTURE_2D,y),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const b=(a=p.HALF_FLOAT)!==null&&a!==void 0?a:d.UNSIGNED_BYTE,S=(l=p.RGBA16F)!==null&&l!==void 0?l:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,S,e,n,0,d.RGBA,b,null);const k=p.createFramebuffer(e,n,!1,!1);return k.colorAttachment.set(y),k}function ma(p,e){return e.colorRampTexture||(e.colorRampTexture=new Re(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function co(p,e,n,a,l){if(!n||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let y=d[n.to.toString()],b=d[n.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const S=l.getPaintProperty(e);y=d[S],b=d[S]}y&&b&&p.setConstantPatternPositions(y,b)}function ga(p,e,n,a,l,d,y){const b=p.context.gl,S="fill-pattern",k=n.paint.get(S),M=k&&k.constantOr(1),z=n.getCrossfadeParameters();let B,G,H,Q,ne;y?(G=M&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=b.LINES):(G=M?"fillPattern":"fill",B=b.TRIANGLES);const oe=k.constantOr(null);for(const ce of a){const $=e.getTile(ce);if(M&&!$.patternsLoaded())continue;const de=$.getBucket(n);if(!de)continue;const me=de.programConfigurations.get(n.id),we=p.useProgram(G,me),Oe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce);M&&(p.context.activeTexture.set(b.TEXTURE0),$.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),me.updatePaintBuffers(z)),co(me,S,oe,$,n);const He=Oe?ce:null,lt=p.translatePosMatrix(He?He.posMatrix:ce.posMatrix,$,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(y){Q=de.indexBuffer2,ne=de.segments2;const gt=[b.drawingBufferWidth,b.drawingBufferHeight];H=G==="fillOutlinePattern"&&M?Op(lt,p,z,$,gt):Kg(lt,gt)}else Q=de.indexBuffer,ne=de.segments,H=M?Rp(lt,p,z,$):so(lt);we.draw(p.context,B,l,p.stencilModeForClipping(ce),d,wi.disabled,H,Oe,n.id,de.layoutVertexBuffer,Q,ne,n.paint,p.transform.zoom,me)}}function ol(p,e,n,a,l,d,y){const b=p.context,S=b.gl,k="fill-extrusion-pattern",M=n.paint.get(k),z=M.constantOr(1),B=n.getCrossfadeParameters(),G=n.paint.get("fill-extrusion-opacity"),H=M.constantOr(null);for(const Q of a){const ne=e.getTile(Q),oe=ne.getBucket(n);if(!oe)continue;const ce=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),$=oe.programConfigurations.get(n.id),de=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",$);z&&(p.context.activeTexture.set(S.TEXTURE0),ne.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),$.updatePaintBuffers(B)),co($,k,H,ne,n);const me=p.translatePosMatrix(Q.posMatrix,ne,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),we=n.paint.get("fill-extrusion-vertical-gradient"),Oe=z?$a(me,p,we,G,Q,B,ne):la(me,p,we,G);de.draw(b,b.gl.TRIANGLES,l,d,y,wi.backCCW,Oe,ce,n.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,n.paint,p.transform.zoom,$,p.style.map.terrain&&oe.centroidVertexBuffer)}}function uo(p,e,n,a,l,d,y){const b=p.context,S=b.gl,k=n.fbo;if(!k)return;const M=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(e);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),M.draw(b,S.TRIANGLES,l,d,y,wi.disabled,((B,G,H,Q)=>{const ne=H.paint.get("hillshade-shadow-color"),oe=H.paint.get("hillshade-highlight-color"),ce=H.paint.get("hillshade-accent-color");let $=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&($-=B.transform.angle);const de=!B.options.moving;return{u_matrix:Q?Q.posMatrix:B.transform.calculatePosMatrix(G.tileID.toUnwrapped(),de),u_image:0,u_latrange:Ya(0,G.tileID),u_light:[H.paint.get("hillshade-exaggeration"),$],u_shadow:ne,u_highlight:oe,u_accent:ce}})(p,n,a,z?e:null),z,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function ho(p,e,n,a,l,d){const y=p.context,b=y.gl,S=e.dem;if(S&&S.data){const k=S.dim,M=S.stride,z=S.getPixels();if(y.activeTexture.set(b.TEXTURE1),y.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||p.getTileTexture(M),e.demTexture){const G=e.demTexture;G.update(z,{premultiply:!1}),G.bind(b.NEAREST,b.CLAMP_TO_EDGE)}else e.demTexture=new Re(y,z,b.RGBA,{premultiply:!1}),e.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);y.activeTexture.set(b.TEXTURE0);let B=e.fbo;if(!B){const G=new Re(y,{width:k,height:k,data:null},b.RGBA);G.bind(b.LINEAR,b.CLAMP_TO_EDGE),B=e.fbo=y.createFramebuffer(k,k,!0,!1),B.colorAttachment.set(G.texture)}y.bindFramebuffer.set(B.framebuffer),y.viewport.set([0,0,k,k]),p.useProgram("hillshadePrepare").draw(y,b.TRIANGLES,a,l,d,wi.disabled,((G,H)=>{const Q=H.stride,ne=c.H();return c.aP(ne,0,c.X,-c.X,0,0,1),c.J(ne,ne,[0,-c.X,0]),{u_matrix:ne,u_image:1,u_dimension:[Q,Q],u_zoom:G.overscaledZ,u_unpack:H.getUnpackVector()}})(e.tileID,S),null,n.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Qp(p,e,n,a,l,d){const y=a.paint.get("raster-fade-duration");if(!d&&y>0){const b=N.now(),S=(b-p.timeAdded)/y,k=e?(b-e.timeAdded)/y:-1,M=n.getSource(),z=l.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),G=B&&p.refreshedUponExpiration?1:c.ac(B?S:1-k,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const cu=new c.aM(1,0,0,1),di=new c.aM(0,1,0,1),al=new c.aM(0,0,1,1),u_=new c.aM(1,0,1,1),ef=new c.aM(0,1,1,1);function po(p,e,n,a){ll(p,0,e+n/2,p.transform.width,n,a)}function tf(p,e,n,a){ll(p,e-n/2,0,n,p.transform.height,a)}function ll(p,e,n,a,l,d){const y=p.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*p.pixelRatio,n*p.pixelRatio,a*p.pixelRatio,l*p.pixelRatio),y.clear({color:d}),b.disable(b.SCISSOR_TEST)}function rf(p,e,n){const a=p.context,l=a.gl,d=n.posMatrix,y=p.useProgram("debug"),b=ti.disabled,S=ki.disabled,k=p.colorModeForRenderPass(),M="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(n);a.activeTexture.set(l.TEXTURE0);const B=e.getTileByID(n.key).latestRawTileData,G=Math.floor((B&&B.byteLength||0)/1024),H=e.getTile(n).tileSize,Q=512/Math.min(H,512)*(n.overscaledZ/p.transform.zoom)*.5;let ne=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ne+=` => ${n.overscaledZ}`),function(oe,ce){oe.initDebugOverlayCanvas();const $=oe.debugOverlayCanvas,de=oe.context.gl,me=oe.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,$.width,$.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(ce,5,5),me.strokeText(ce,5,5),oe.debugOverlayTexture.update($),oe.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(p,`${ne} ${G}kB`),y.draw(a,l.TRIANGLES,b,S,Ji.alphaBlended,wi.disabled,ca(d,c.aM.transparent,Q),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),y.draw(a,l.LINE_STRIP,b,S,k,wi.disabled,ca(d,c.aM.red),z,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function nf(p,e,n){const a=p.context,l=a.gl,d=p.colorModeForRenderPass(),y=new ti(l.LEQUAL,ti.ReadWrite,p.depthRangeFor3D),b=p.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,p.width,p.height]);for(const k of n){const M=p.renderToTexture.getTexture(k),z=e.getTerrainData(k.tileID);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,M.texture);const B=p.transform.calculatePosMatrix(k.tileID.toUnwrapped()),G=e.getMeshFrameDelta(p.transform.zoom),H=p.transform.calculateFogMatrix(k.tileID.toUnwrapped()),Q=Wc(B,G,H,p.style.sky,p.transform.pitch);b.draw(a,l.TRIANGLES,y,ki.disabled,d,wi.backCCW,Q,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class cl{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ul{constructor(e,n){this.context=new c_(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Nt.maxUnderzooming+Nt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zc}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style._order)this.style._layers[l].resize()}setup(){const e=this.context,n=new c.aX;n.emplaceBack(0,0),n.emplaceBack(c.X,0),n.emplaceBack(0,c.X),n.emplaceBack(c.X,c.X),this.tileExtentBuffer=e.createVertexBuffer(n,Ms.members),this.tileExtentSegments=c.a0.simpleSegment(0,0,4,2);const a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.X,0),a.emplaceBack(0,c.X),a.emplaceBack(c.X,c.X),this.debugBuffer=e.createVertexBuffer(a,Ms.members),this.debugSegments=c.a0.simpleSegment(0,0,4,5);const l=new c.$;l.emplaceBack(0,0,0,0),l.emplaceBack(c.X,0,c.X,0),l.emplaceBack(0,c.X,0,c.X),l.emplaceBack(c.X,c.X,c.X,c.X),this.rasterBoundsBuffer=e.createVertexBuffer(l,tn.members),this.rasterBoundsSegments=c.a0.simpleSegment(0,0,4,2);const d=new c.aX;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(d,Ms.members),this.viewportSegments=c.a0.simpleSegment(0,0,4,2);const y=new c.aZ;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const b=new c.aY;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const S=this.context.gl;this.stencilClearMode=new ki({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=c.H();c.aP(a,0,this.width,this.height,0,0,1),c.K(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,ti.disabled,this.stencilClearMode,Ji.disabled,wi.disabled,Gr(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source;const a=this.context,l=a.gl;this.nextStencilID+n.length>256&&this.clearStencil(),a.setColorMode(Ji.disabled),a.setDepthMode(ti.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of n){const b=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(y);d.draw(a,l.TRIANGLES,ti.disabled,new ki({func:l.ALWAYS,mask:0},b,255,l.KEEP,l.KEEP,l.REPLACE),Ji.disabled,wi.disabled,Gr(y.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new ki({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new ki({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,a=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),l=a[a.length-1].overscaledZ,d=a[0].overscaledZ-l+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const y={};for(let b=0;b<d;b++)y[b+l]=new ki({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=d,[y,a]}return[{[l]:ki.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ji([e.CONSTANT_COLOR,e.ONE],new c.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ji.unblended:Ji.alphaBlended}depthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return ti.disabled;const l=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ti(a||this.context.gl.LEQUAL,n,[l,l])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(N.now()),this.imageManager.beginFrame();const a=this.style._order,l=this.style.sourceCaches,d={},y={},b={};for(const S in l){const k=l[S];k.used&&k.prepare(this.context),d[S]=k.getVisibleCoordinates(),y[S]=d[S].slice().reverse(),b[S]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const k=this.style._layers[S];if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const M=y[k.source];(k.type==="custom"||M.length)&&this.renderLayer(this,l[k.source],k,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.aM.black:c.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,k){const M=S.context,z=M.gl,B=((oe,ce,$)=>({u_sky_color:oe.properties.get("sky-color"),u_horizon_color:oe.properties.get("horizon-color"),u_horizon:(ce.height/2+ce.getHorizon())*$,u_sky_horizon_blend:oe.properties.get("sky-horizon-blend")*ce.height/2*$}))(k,S.style.map.transform,S.pixelRatio),G=new ti(z.LEQUAL,ti.ReadWrite,[0,1]),H=ki.disabled,Q=S.colorModeForRenderPass(),ne=S.useProgram("sky");if(!k.mesh){const oe=new c.aX;oe.emplaceBack(-1,-1),oe.emplaceBack(1,-1),oe.emplaceBack(1,1),oe.emplaceBack(-1,1);const ce=new c.aY;ce.emplaceBack(0,1,2),ce.emplaceBack(0,2,3),k.mesh=new cl(M.createVertexBuffer(oe,Ms.members),M.createIndexBuffer(ce),c.a0.simpleSegment(0,0,oe.length,ce.length))}ne.draw(M,z.TRIANGLES,G,H,Q,wi.disabled,B,void 0,"sky",k.mesh.vertexBuffer,k.mesh.indexBuffer,k.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],k=l[S.source],M=d[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,k,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],k=l[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?b:y)[S.source];this._renderTileClippingMasks(S,d[S.source]),this.renderLayer(this,k,S,M)}if(this.options.showTileBoundaries){const S=function(k,M){let z=null;const B=Object.values(k._layers).flatMap(ne=>ne.source&&!ne.isHidden(M)?[k.sourceCaches[ne.source]]:[]),G=B.filter(ne=>ne.getSource().type==="vector"),H=B.filter(ne=>ne.getSource().type!=="vector"),Q=ne=>{(!z||z.getSource().maxzoom<ne.getSource().maxzoom)&&(z=ne)};return G.forEach(ne=>Q(ne)),z||H.forEach(ne=>Q(ne)),z}(this.style,this.transform.zoom);S&&function(k,M,z){for(let B=0;B<z.length;B++)rf(k,M,z[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const k=S.transform.padding;po(S,S.transform.height-(k.top||0),3,cu),po(S,k.bottom||0,3,di),tf(S,k.left||0,3,al),tf(S,S.transform.width-(k.right||0),3,u_);const M=S.transform.centerPoint;(function(z,B,G,H){ll(z,B-1,G-10,2,20,H),ll(z,B-10,G-1,20,2,H)})(S,M.x,S.transform.height-M.y,ef)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let l=this.terrainFacilitator.dirty;l||(l=e?!c.a_(n,a):!c.a$(n,a)),l||(l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),l&&(c.b0(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,y){const b=d.context,S=b.gl,k=Ji.unblended,M=new ti(S.LEQUAL,ti.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.sourceCache.getRenderableTiles(),G=d.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1});for(const H of B){const Q=y.getTerrainData(H.tileID),ne={u_matrix:d.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:y.getMeshFrameDelta(d.transform.zoom)};G.draw(b,S.TRIANGLES,M,ki.disabled,k,wi.backCCW,ne,Q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,y){const b=d.context,S=b.gl,k=Ji.unblended,M=new ti(S.LEQUAL,ti.ReadWrite,[0,1]),z=y.getTerrainMesh(),B=y.getCoordsTexture(),G=y.sourceCache.getRenderableTiles(),H=d.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),b.clear({color:c.aM.transparent,depth:1}),y.coordsIndex=[];for(const Q of G){const ne=y.getTerrainData(Q.tileID);b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,B.texture);const oe={u_matrix:d.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(d.transform.zoom)};H.draw(b,S.TRIANGLES,M,ki.disabled,k,wi.backCCW,oe,ne,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),y.coordsIndex.push(Q.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,n,a,l){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(l||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,y,b,S,k){if(d.renderPass!=="translucent")return;const M=ki.disabled,z=d.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,G,H,Q,ne,oe,ce,$,de){const me=G.transform,we=Es(),Oe=ne==="map",He=oe==="map";for(const lt of B){const gt=Q.getTile(lt),it=gt.getBucket(H);if(!it||!it.text||!it.text.segments.get().length)continue;const et=c.ag(it.textSizeData,me.zoom),bt=ni(gt,1,G.transform.zoom),Gt=hs(lt.posMatrix,He,Oe,G.transform,bt),st=H.layout.get("icon-text-fit")!=="none"&&it.hasIconData();if(et){const ht=Math.pow(2,me.zoom-gt.tileID.overscaledZ),Ut=G.style.map.terrain?(Xt,si)=>G.style.map.terrain.getElevation(lt,Xt,si):null,Li=we.translatePosition(me,gt,ce,$);lo(it,Oe,He,de,me,Gt,lt.posMatrix,ht,et,st,we,Li,lt.toUnwrapped(),Ut)}}}(S,d,b,y,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),k),b.paint.get("icon-opacity").constantOr(1)!==0&&ou(d,y,b,S,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),M,z),b.paint.get("text-opacity").constantOr(1)!==0&&ou(d,y,b,S,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),M,z),y.map.showCollisionBoxes&&(da(d,y,b,S,!0),da(d,y,b,S,!1))})(e,n,a,l,this.style.placement.variableOffsets);break;case"circle":(function(d,y,b,S){if(d.renderPass!=="translucent")return;const k=b.paint.get("circle-opacity"),M=b.paint.get("circle-stroke-width"),z=b.paint.get("circle-stroke-opacity"),B=!b.layout.get("circle-sort-key").isConstant();if(k.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const G=d.context,H=G.gl,Q=d.depthModeForSublayer(0,ti.ReadOnly),ne=ki.disabled,oe=d.colorModeForRenderPass(),ce=[];for(let $=0;$<S.length;$++){const de=S[$],me=y.getTile(de),we=me.getBucket(b);if(!we)continue;const Oe=we.programConfigurations.get(b.id),He=d.useProgram("circle",Oe),lt=we.layoutVertexBuffer,gt=we.indexBuffer,it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(de),et={programConfiguration:Oe,program:He,layoutVertexBuffer:lt,indexBuffer:gt,uniformValues:$g(d,de,me,b),terrainData:it};if(B){const bt=we.segments.get();for(const Gt of bt)ce.push({segments:new c.a0([Gt]),sortKey:Gt.sortKey,state:et})}else ce.push({segments:we.segments,sortKey:0,state:et})}B&&ce.sort(($,de)=>$.sortKey-de.sortKey);for(const $ of ce){const{programConfiguration:de,program:me,layoutVertexBuffer:we,indexBuffer:Oe,uniformValues:He,terrainData:lt}=$.state;me.draw(G,H.TRIANGLES,Q,ne,oe,wi.disabled,He,lt,b.id,we,Oe,$.segments,b.paint,d.transform.zoom,de)}})(e,n,a,l);break;case"heatmap":(function(d,y,b,S){if(b.paint.get("heatmap-opacity")===0)return;const k=d.context;if(d.style.map.terrain){for(const M of S){const z=y.getTile(M);y.hasRenderableParent(M)||(d.renderPass==="offscreen"?lu(d,z,b,M):d.renderPass==="translucent"&&Bs(d,b,M))}k.viewport.set([0,0,d.width,d.height])}else d.renderPass==="offscreen"?function(M,z,B,G){const H=M.context,Q=H.gl,ne=ki.disabled,oe=new Ji([Q.ONE,Q.ONE],c.aM.transparent,[!0,!0,!0,!0]);(function(ce,$,de){const me=ce.gl;ce.activeTexture.set(me.TEXTURE1),ce.viewport.set([0,0,$.width/4,$.height/4]);let we=de.heatmapFbos.get(c.aU);we?(me.bindTexture(me.TEXTURE_2D,we.colorAttachment.get()),ce.bindFramebuffer.set(we.framebuffer)):(we=fa(ce,$.width/4,$.height/4),de.heatmapFbos.set(c.aU,we))})(H,M,B),H.clear({color:c.aM.transparent});for(let ce=0;ce<G.length;ce++){const $=G[ce];if(z.hasRenderableParent($))continue;const de=z.getTile($),me=de.getBucket(B);if(!me)continue;const we=me.programConfigurations.get(B.id),Oe=M.useProgram("heatmap",we),{zoom:He}=M.transform;Oe.draw(H,Q.TRIANGLES,ti.disabled,ne,oe,wi.disabled,Wr($.posMatrix,de,He,B.paint.get("heatmap-intensity")),null,B.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,B.paint,M.transform.zoom,we)}H.viewport.set([0,0,M.width,M.height])}(d,y,b,S):d.renderPass==="translucent"&&function(M,z){const B=M.context,G=B.gl;B.setColorMode(M.colorModeForRenderPass());const H=z.heatmapFbos.get(c.aU);H&&(B.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,H.colorAttachment.get()),B.activeTexture.set(G.TEXTURE1),ma(B,z).bind(G.LINEAR,G.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(B,G.TRIANGLES,ti.disabled,ki.disabled,M.colorModeForRenderPass(),wi.disabled,Ja(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(d,b)})(e,n,a,l);break;case"line":(function(d,y,b,S){if(d.renderPass!=="translucent")return;const k=b.paint.get("line-opacity"),M=b.paint.get("line-width");if(k.constantOr(1)===0||M.constantOr(1)===0)return;const z=d.depthModeForSublayer(0,ti.ReadOnly),B=d.colorModeForRenderPass(),G=b.paint.get("line-dasharray"),H=b.paint.get("line-pattern"),Q=H.constantOr(1),ne=b.paint.get("line-gradient"),oe=b.getCrossfadeParameters(),ce=Q?"linePattern":G?"lineSDF":ne?"lineGradient":"line",$=d.context,de=$.gl;let me=!0;for(const we of S){const Oe=y.getTile(we);if(Q&&!Oe.patternsLoaded())continue;const He=Oe.getBucket(b);if(!He)continue;const lt=He.programConfigurations.get(b.id),gt=d.context.program.get(),it=d.useProgram(ce,lt),et=me||it.program!==gt,bt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(we),Gt=H.constantOr(null);if(Gt&&Oe.imageAtlas){const Ut=Oe.imageAtlas,Li=Ut.patternPositions[Gt.to.toString()],Xt=Ut.patternPositions[Gt.from.toString()];Li&&Xt&&lt.setConstantPatternPositions(Li,Xt)}const st=bt?we:null,ht=Q?oo(d,Oe,b,oe,st):G?Jg(d,Oe,b,G,oe,st):ne?Fp(d,Oe,b,He.lineClipsArray.length,st):Qa(d,Oe,b,st);if(Q)$.activeTexture.set(de.TEXTURE0),Oe.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),lt.updatePaintBuffers(oe);else if(G&&(et||d.lineAtlas.dirty))$.activeTexture.set(de.TEXTURE0),d.lineAtlas.bind($);else if(ne){const Ut=He.gradients[b.id];let Li=Ut.texture;if(b.gradientVersion!==Ut.version){let Xt=256;if(b.stepInterpolant){const si=y.getSource().maxzoom,Ri=we.canonical.z===si?Math.ceil(1<<d.transform.maxZoom-we.canonical.z):1;Xt=c.ac(c.aV(He.maxLineLength/c.X*1024*Ri),256,$.maxTextureSize)}Ut.gradient=c.aW({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Xt,image:Ut.gradient||void 0,clips:He.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new Re($,Ut.gradient,de.RGBA),Ut.version=b.gradientVersion,Li=Ut.texture}$.activeTexture.set(de.TEXTURE0),Li.bind(b.stepInterpolant?de.NEAREST:de.LINEAR,de.CLAMP_TO_EDGE)}it.draw($,de.TRIANGLES,z,d.stencilModeForClipping(we),B,wi.disabled,ht,bt,b.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,b.paint,d.transform.zoom,lt,He.layoutVertexBuffer2),me=!1}})(e,n,a,l);break;case"fill":(function(d,y,b,S){const k=b.paint.get("fill-color"),M=b.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=d.colorModeForRenderPass(),B=b.paint.get("fill-pattern"),G=d.opaquePassEnabledForLayer()&&!B.constantOr(1)&&k.constantOr(c.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===G){const H=d.depthModeForSublayer(1,d.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);ga(d,y,b,S,H,z,!1)}if(d.renderPass==="translucent"&&b.paint.get("fill-antialias")){const H=d.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);ga(d,y,b,S,H,z,!0)}})(e,n,a,l);break;case"fill-extrusion":(function(d,y,b,S){const k=b.paint.get("fill-extrusion-opacity");if(k!==0&&d.renderPass==="translucent"){const M=new ti(d.context.gl.LEQUAL,ti.ReadWrite,d.depthRangeFor3D);if(k!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))ol(d,y,b,S,M,ki.disabled,Ji.disabled),ol(d,y,b,S,M,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const z=d.colorModeForRenderPass();ol(d,y,b,S,M,ki.disabled,z)}}})(e,n,a,l);break;case"hillshade":(function(d,y,b,S){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const k=d.context,M=d.depthModeForSublayer(0,ti.ReadOnly),z=d.colorModeForRenderPass(),[B,G]=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S];for(const H of G){const Q=y.getTile(H);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&d.renderPass==="offscreen"?ho(d,Q,b,M,ki.disabled,z):d.renderPass==="translucent"&&uo(d,H,Q,b,M,B[H.overscaledZ],z)}k.viewport.set([0,0,d.width,d.height])})(e,n,a,l);break;case"raster":(function(d,y,b,S){if(d.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!S.length)return;const k=d.context,M=k.gl,z=y.getSource(),B=d.useProgram("raster"),G=d.colorModeForRenderPass(),[H,Q]=z instanceof ur?[{},S]:d.stencilConfigForOverlap(S),ne=Q[Q.length-1].overscaledZ,oe=!d.options.moving;for(const ce of Q){const $=d.depthModeForSublayer(ce.overscaledZ-ne,b.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,M.LESS),de=y.getTile(ce);de.registerFadeDuration(b.paint.get("raster-fade-duration"));const me=y.findLoadedParent(ce,0),we=y.findLoadedSibling(ce),Oe=Qp(de,me||we||null,y,b,d.transform,d.style.map.terrain);let He,lt;const gt=b.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;k.activeTexture.set(M.TEXTURE0),de.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(M.TEXTURE1),me?(me.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),He=Math.pow(2,me.tileID.overscaledZ-de.tileID.overscaledZ),lt=[de.tileID.canonical.x*He%1,de.tileID.canonical.y*He%1]):de.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&k.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ce),et=it?ce:null,bt=et?et.posMatrix:d.transform.calculatePosMatrix(ce.toUnwrapped(),oe),Gt=Yg(bt,lt||[0,0],He||1,Oe,b);z instanceof ur?B.draw(k,M.TRIANGLES,$,ki.disabled,G,wi.disabled,Gt,it,b.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments):B.draw(k,M.TRIANGLES,$,H[ce.overscaledZ],G,wi.disabled,Gt,it,b.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(e,n,a,l);break;case"background":(function(d,y,b,S){const k=b.paint.get("background-color"),M=b.paint.get("background-opacity");if(M===0)return;const z=d.context,B=z.gl,G=d.transform,H=G.tileSize,Q=b.paint.get("background-pattern");if(d.isPatternMissing(Q))return;const ne=!Q&&k.a===1&&M===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==ne)return;const oe=ki.disabled,ce=d.depthModeForSublayer(0,ne==="opaque"?ti.ReadWrite:ti.ReadOnly),$=d.colorModeForRenderPass(),de=d.useProgram(Q?"backgroundPattern":"background"),me=S||G.coveringTiles({tileSize:H,terrain:d.style.map.terrain});Q&&(z.activeTexture.set(B.TEXTURE0),d.imageManager.bind(d.context));const we=b.getCrossfadeParameters();for(const Oe of me){const He=S?Oe.posMatrix:d.transform.calculatePosMatrix(Oe.toUnwrapped()),lt=Q?Kc(He,M,d,Q,{tileID:Oe,tileSize:H},we):el(He,M,k),gt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Oe);de.draw(z,B.TRIANGLES,ce,oe,$,wi.disabled,lt,gt,b.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(e,0,a,l);break;case"custom":(function(d,y,b){const S=d.context,k=b.implementation;if(d.renderPass==="offscreen"){const M=k.prerender;M&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),M.call(k,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(ki.disabled);const M=k.renderingMode==="3d"?new ti(d.context.gl.LEQUAL,ti.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,ti.ReadOnly);S.setDepthMode(M),k.render(S.gl,d.transform.customLayerMatrix(),{farZ:d.transform.farZ,nearZ:d.transform.nearZ,fov:d.transform._fov,modelViewProjectionMatrix:d.transform.modelViewProjectionMatrix,projectionMatrix:d.transform.projectionMatrix}),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,n,a,l,d){if(!a[0]&&!a[1])return e;const y=d?l==="map"?this.transform.angle:0:l==="viewport"?-this.transform.angle:0;if(y){const k=Math.sin(y),M=Math.cos(y);a=[a[0]*M-a[1]*k,a[0]*k+a[1]*M]}const b=[d?a[0]:ni(n,a[0],this.transform.zoom),d?a[1]:ni(n,a[1],this.transform.zoom),0],S=new Float32Array(16);return c.J(S,e,b),S}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n){this.cache=this.cache||{};const a=e+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new Hc(this.context,ds[e],n,$c[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Re(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}class fo{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,a){const l=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=1/(b=c.af([],b,e))[3]/n*l;return c.b1(b,b,[S,S,1/b[3],S])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=function(B,G){var H=G[0],Q=G[1],ne=G[2],oe=H*H+Q*Q+ne*ne;return oe>0&&(oe=1/Math.sqrt(oe)),B[0]=G[0]*oe,B[1]=G[1]*oe,B[2]=G[2]*oe,B}([],function(B,G,H){var Q=G[0],ne=G[1],oe=G[2],ce=H[0],$=H[1],de=H[2];return B[0]=ne*de-oe*$,B[1]=oe*ce-Q*de,B[2]=Q*$-ne*ce,B}([],tt([],d[b[0]],d[b[1]]),tt([],d[b[2]],d[b[1]]))),k=-((M=S)[0]*(z=d[b[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(k)});return new fo(d,y)}}class mo{constructor(e,n){this.min=e,this.max=n,this.center=function(a,l,d){return a[0]=.5*l[0],a[1]=.5*l[1],a[2]=.5*l[2],a}([],function(a,l,d){return a[0]=l[0]+d[0],a[1]=l[1]+d[1],a[2]=l[2]+d[2],a}([],this.min,this.max))}quadrant(e){const n=[e%2==0,e<2],a=Le(this.min),l=Le(this.max);for(let d=0;d<n.length;d++)a[d]=n[d]?this.min[d]:this.center[d],l[d]=n[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new mo(a,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let l=0;l<e.planes.length;l++){const d=e.planes[l];let y=0;for(let b=0;b<n.length;b++)c.b2(d,n[b])>=0&&y++;if(y===0)return 0;y!==n.length&&(a=!1)}if(a)return 2;for(let l=0;l<3;l++){let d=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const S=e.points[b][l]-this.min[l];d=Math.min(d,S),y=Math.max(y,S)}if(y<0||d>this.max[l]-this.min[l])return 0}return 1}}class go{constructor(e=0,n=0,a=0,l=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(l)||l<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=l}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=c.y.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.y.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=c.y.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=c.y.number(e.right,n.right,a)),this}getCenter(e,n){const a=c.ac((this.left+e-this.right)/2,0,e),l=c.ac((this.top+n-this.bottom)/2,0,n);return new c.P(a,l)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new go(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const uu=85.051129;class _o{constructor(e,n,a,l,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=a??0,this._maxPitch=l??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new go,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new _o(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-c.b3(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var a=new c.A(4);return c.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,l,d){var y=l[0],b=l[1],S=l[2],k=l[3],M=Math.sin(d),z=Math.cos(d);a[0]=y*z+S*M,a[1]=b*z+k*M,a[2]=y*-M+S*z,a[3]=b*-M+k*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=c.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){const n=[new c.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new c.P(0,0)),l=this.pointCoordinate(new c.P(this.width,0)),d=this.pointCoordinate(new c.P(this.width,this.height)),y=this.pointCoordinate(new c.P(0,this.height)),b=Math.floor(Math.min(a.x,l.x,d.x,y.x)),S=Math.floor(Math.max(a.x,l.x,d.x,y.x)),k=1;for(let M=b-k;M<=S+k;M++)M!==0&&n.push(new c.b4(M,e))}return n}coveringTiles(e){var n,a;let l=this.coveringZoomLevel(e);const d=l;if(e.minzoom!==void 0&&l<e.minzoom)return[];e.maxzoom!==void 0&&l>e.maxzoom&&(l=e.maxzoom);const y=this.pointCoordinate(this.getCameraPoint()),b=c.Z.fromLngLat(this.center),S=Math.pow(2,l),k=[S*y.x,S*y.y,0],M=[S*b.x,S*b.y,0],z=fo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,l);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=l);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,H=$=>({aabb:new mo([$*S,0,0],[($+1)*S,S,0]),zoom:0,x:0,y:0,wrap:$,fullyVisible:!1}),Q=[],ne=[],oe=l,ce=e.reparseOverscaled?d:l;if(this._renderWorldCopies)for(let $=1;$<=3;$++)Q.push(H(-$)),Q.push(H($));for(Q.push(H(0));Q.length>0;){const $=Q.pop(),de=$.x,me=$.y;let we=$.fullyVisible;if(!we){const it=$.aabb.intersects(z);if(it===0)continue;we=it===2}const Oe=e.terrain?k:M,He=$.aabb.distanceX(Oe),lt=$.aabb.distanceY(Oe),gt=Math.max(Math.abs(He),Math.abs(lt));if($.zoom===oe||gt>G+(1<<oe-$.zoom)-2&&$.zoom>=B){const it=oe-$.zoom,et=k[0]-.5-(de<<it),bt=k[1]-.5-(me<<it);ne.push({tileID:new c.S($.zoom===oe?ce:$.zoom,$.wrap,$.zoom,de,me),distanceSq:Pt([M[0]-.5-de,M[1]-.5-me]),tileDistanceToCamera:Math.sqrt(et*et+bt*bt)})}else for(let it=0;it<4;it++){const et=(de<<1)+it%2,bt=(me<<1)+(it>>1),Gt=$.zoom+1;let st=$.aabb.quadrant(it);if(e.terrain){const ht=new c.S(Gt,$.wrap,Gt,et,bt),Ut=e.terrain.getMinMaxElevation(ht),Li=(n=Ut.minElevation)!==null&&n!==void 0?n:this.elevation,Xt=(a=Ut.maxElevation)!==null&&a!==void 0?a:this.elevation;st=new mo([st.min[0],st.min[1],Li],[st.max[0],st.max[1],Xt])}Q.push({aabb:st,zoom:Gt,x:et,y:bt,wrap:$.wrap,fullyVisible:we})}}return ne.sort(($,de)=>$.distanceSq-de.distanceSq).map($=>$.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=c.ac(e.lat,-85.051129,uu);return new c.P(c.O(e.lng)*this.worldSize,c.Q(n)*this.worldSize)}unproject(e){return new c.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,l=this.pointLocation(this.centerPoint,e),d=e.getElevationForLngLatZoom(l,this.tileZoom);if(!(this.elevation-d))return;const y=a+n-d,b=Math.cos(this._pitch)*this.cameraToCenterDistance/y/c.b5(1,l.lat),S=this.scaleZoom(b/this.tileSize);this._elevation=d,this._center=l,this.zoom=S}setLocationAtPoint(e,n){const a=this.pointCoordinate(n),l=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),y=new c.Z(d.x-(a.x-l.x),d.y-(a.y-l.y));this.center=this.coordinateLocation(y),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,n){return n?this.coordinatePoint(this.locationCoordinate(e),n.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,n){return this.coordinateLocation(this.pointCoordinate(e,n))}locationCoordinate(e){return c.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const B=n.pointCoordinate(e);if(B!=null)return B}const a=[e.x,e.y,0,1],l=[e.x,e.y,1,1];c.af(a,a,this.pixelMatrixInverse),c.af(l,l,this.pixelMatrixInverse);const d=a[3],y=l[3],b=a[1]/d,S=l[1]/y,k=a[2]/d,M=l[2]/y,z=k===M?0:(0-k)/(M-k);return new c.Z(c.y.number(a[0]/d,l[0]/y,z)/this.worldSize,c.y.number(b,S,z)/this.worldSize)}coordinatePoint(e,n=0,a=this.pixelMatrix){const l=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.af(l,l,a),new c.P(l[0]/l[3],l[1]/l[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ye().extend(this.pointLocation(new c.P(0,e))).extend(this.pointLocation(new c.P(this.width,e))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ye([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,uu])}calculateTileMatrix(e){const n=e.canonical,a=this.worldSize/this.zoomScale(n.z),l=n.x+Math.pow(2,n.z)*e.wrap,d=c.an(new Float64Array(16));return c.J(d,d,[l*a,n.y*a,0]),c.K(d,d,[a/c.X,a/c.X,1]),d}calculatePosMatrix(e,n=!1){const a=e.key,l=n?this._alignedPosMatrixCache:this._posMatrixCache;if(l[a])return l[a];const d=this.calculateTileMatrix(e);return c.L(d,n?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,d),l[a]=new Float32Array(d),l[a]}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCache;if(a[n])return a[n];const l=this.calculateTileMatrix(e);return c.L(l,this.fogMatrix,l),a[n]=new Float32Array(l),a[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=c.ac(+n,this.minZoom,this.maxZoom);const a={center:new c.N(e.lng,e.lat),zoom:n};let l=this.lngRange;if(!this._renderWorldCopies&&l===null){const $=179.9999999999;l=[-$,$]}const d=this.tileSize*this.zoomScale(a.zoom);let y=0,b=d,S=0,k=d,M=0,z=0;const{x:B,y:G}=this.size;if(this.latRange){const $=this.latRange;y=c.Q($[1])*d,b=c.Q($[0])*d,b-y<G&&(M=G/(b-y))}l&&(S=c.b3(c.O(l[0])*d,0,d),k=c.b3(c.O(l[1])*d,0,d),k<S&&(k+=d),k-S<B&&(z=B/(k-S)));const{x:H,y:Q}=this.project.call({worldSize:d},e);let ne,oe;const ce=Math.max(z||0,M||0);if(ce){const $=new c.P(z?(k+S)/2:H,M?(b+y)/2:Q);return a.center=this.unproject.call({worldSize:d},$).wrap(),a.zoom+=this.scaleZoom(ce),a}if(this.latRange){const $=G/2;Q-$<y&&(oe=y+$),Q+$>b&&(oe=b-$)}if(l){const $=(S+k)/2;let de=H;this._renderWorldCopies&&(de=c.b3(H,$-d/2,$+d/2));const me=B/2;de-me<S&&(ne=S+me),de+me>k&&(ne=k-me)}if(ne!==void 0||oe!==void 0){const $=new c.P(ne??H,oe??Q);a.center=this.unproject.call({worldSize:d},$).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=n,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b5(1,this.center.lat)*this.worldSize;let l=c.an(new Float64Array(16));c.K(l,l,[this.width/2,-this.height/2,1]),c.J(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=c.an(new Float64Array(16)),c.K(l,l,[1,-1,1]),c.J(l,l,[-1,-1,0]),c.K(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),y=Math.min(this.elevation,this.minElevationForCurrentTile),b=d-y*this._pixelPerMeter/Math.cos(this._pitch),S=y<0?b:d,k=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(c.ac(Math.PI-k-M,.01,Math.PI-.01)),B=this.getHorizon(),G=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),H=Math.sin(G)*S/Math.sin(c.ac(Math.PI-k-G,.01,Math.PI-.01)),Q=Math.min(z,H);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+S),this.nearZ=this.height/50,l=new Float64Array(16),c.b6(l,this._fov,this.width/this.height,this.nearZ,this.farZ),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,this.projectionMatrix=c.ae(l),c.K(l,l,[1,-1,1]),c.J(l,l,[0,0,-this.cameraToCenterDistance]),c.b7(l,l,this._pitch),c.ad(l,l,this.angle),c.J(l,l,[-n,-a,0]),this.mercatorMatrix=c.K([],l,[this.worldSize,this.worldSize,this.worldSize]),c.K(l,l,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.L(new Float64Array(16),this.labelPlaneMatrix,l),c.J(l,l,[0,0,-this.elevation]),this.modelViewProjectionMatrix=l,this.invModelViewProjectionMatrix=c.as([],l),this.fogMatrix=new Float64Array(16),c.b6(this.fogMatrix,this._fov,this.width/this.height,d,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,c.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b7(this.fogMatrix,this.fogMatrix,this._pitch),c.ad(this.fogMatrix,this.fogMatrix,this.angle),c.J(this.fogMatrix,this.fogMatrix,[-n,-a,0]),c.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),c.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=c.L(new Float64Array(16),this.labelPlaneMatrix,l);const ne=this.width%2/2,oe=this.height%2/2,ce=Math.cos(this.angle),$=Math.sin(this.angle),de=n-Math.round(n)+ce*ne+$*oe,me=a-Math.round(a)+ce*oe+$*ne,we=new Float64Array(l);if(c.J(we,we,[de>.5?de-1:de,me>.5?me-1:me,0]),this.alignedModelViewProjectionMatrix=we,l=c.as(new Float64Array(16),this.pixelMatrix),!l)throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(e.length===1)return[e[0],n];{let a=n.x,l=n.y,d=n.x,y=n.y;for(const b of e)a=Math.min(a,b.x),l=Math.min(l,b.y),d=Math.max(d,b.x),y=Math.max(y,b.y);return[new c.P(a,l),new c.P(d,l),new c.P(d,y),new c.P(a,y),new c.P(a,l)]}}lngLatToCameraDepth(e,n){const a=this.locationCoordinate(e),l=[a.x*this.worldSize,a.y*this.worldSize,n,1];return c.af(l,l,this.modelViewProjectionMatrix),l[2]/l[3]}}function _a(p,e){let n,a=!1,l=null,d=null;const y=()=>{l=null,a&&(p.apply(d,n),l=setTimeout(y,e),a=!1)};return(...b)=>(a=!0,d=this,n=b,l||y(),l)}class hl{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(a=l)}),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let l=a;l.split("&").length>0&&(l=l.split("&")[0]),this._hashName&&(l=`${this._hashName}=${a}`);let d=window.location.hash.replace(l,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let y=window.location.href.replace(/(#.+)?$/,d);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=_a(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,l=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,l),y=Math.round(n.lng*d)/d,b=Math.round(n.lat*d)/d,S=this._map.getBearing(),k=this._map.getPitch();let M="";if(M+=e?`/${y}/${b}/${a}`:`${a}/${b}/${y}`,(S||k)&&(M+="/"+Math.round(10*S)/10),k&&(M+=`/${Math.round(k)}`),this._hashName){const z=this._hashName;let B=!1;const G=window.location.hash.slice(1).split("&").map(H=>{const Q=H.split("=")[0];return Q===z?(B=!0,`${Q}=${M}`):H}).filter(H=>H);return B||G.push(`${z}=${M}`),`#${G.join("&")}`}return`#${M}`}}const dl={linearity:.3,easing:c.b8(0,0,.3,1)},hu=c.e({deceleration:2500,maxSpeed:1400},dl),h_=c.e({deceleration:20,maxSpeed:1400},dl),sf=c.e({deceleration:1e3,maxSpeed:360},dl),pl=c.e({deceleration:1e3,maxSpeed:90},dl);class du{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:N.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=N.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)n.zoom+=d.zoomDelta||0,n.bearing+=d.bearingDelta||0,n.pitch+=d.pitchDelta||0,d.panDelta&&n.pan._add(d.panDelta),d.around&&(n.around=d.around),d.pinchAround&&(n.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,l={};if(n.pan.mag()){const d=va(n.pan.mag(),a,c.e({},hu,e||{}));l.offset=n.pan.mult(d.amount/n.pan.mag()),l.center=this._map.transform.center,ya(l,d)}if(n.zoom){const d=va(n.zoom,a,h_);l.zoom=this._map.transform.zoom+d.amount,ya(l,d)}if(n.bearing){const d=va(n.bearing,a,sf);l.bearing=this._map.transform.bearing+c.ac(d.amount,-179,179),ya(l,d)}if(n.pitch){const d=va(n.pitch,a,pl);l.pitch=this._map.transform.pitch+d.amount,ya(l,d)}if(l.zoom||l.bearing){const d=n.pinchAround===void 0?n.around:n.pinchAround;l.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),c.e(l,{noMoveStart:!0})}}function ya(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function va(p,e,n){const{maxSpeed:a,linearity:l,deceleration:d}=n,y=c.ac(p*l/(e/1e3),-a,a),b=Math.abs(y)/(d*l);return{easing:n.easing,duration:1e3*b,amount:y*(b/2)}}class Tr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,l={}){const d=V.mousePos(n.getCanvas(),a),y=n.unproject(d);super(e,c.e({point:d,lngLat:y,originalEvent:a},l)),this._defaultPrevented=!1,this.target=n}}class Ns extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const l=e==="touchend"?a.changedTouches:a.touches,d=V.touchPos(n.getCanvasContainer(),l),y=d.map(S=>n.unproject(S)),b=d.reduce((S,k,M,z)=>S.add(k.div(z.length)),new c.P(0,0));super(e,{points:d,point:b,lngLats:y,lngLat:n.unproject(b),originalEvent:a}),this._defaultPrevented=!1}}class of extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class af{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new of(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Tr(e.type,this._map,e))}mouseup(e){this._map.fire(new Tr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Tr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Tr(e.type,this._map,e))}mouseover(e){this._map.fire(new Tr(e.type,this._map,e))}mouseout(e){this._map.fire(new Tr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ns(e.type,this._map,e))}touchmove(e){this._map.fire(new Ns(e.type,this._map,e))}touchend(e){this._map.fire(new Ns(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ns(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Tr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class En{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(c.P.convert(e),this._map.terrain)}}class an{constructor(e,n){this._map=e,this._tr=new En(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const l=this._startPos;this._lastPos=a,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(l.x,a.x),y=Math.max(l.x,a.x),b=Math.min(l.y,a.y),S=Math.max(l.y,a.y);V.setTransform(this._box,`translate(${d}px,${b}px)`),this._box.style.width=y-d+"px",this._box.style.height=S-b+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,l=n;if(this.reset(),V.suppressClick(),a.x!==l.x||a.y!==l.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(a,l,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.k(e,{originalEvent:n}))}}function xa(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const n={};for(let a=0;a<p.length;a++)n[p[a].identifier]=e[a];return n}class pu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(l){const d=new c.P(0,0);for(const y of l)d._add(y);return d.div(l.length)}(n),this.touches=xa(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const l=xa(a,n);for(const d in this.touches){const y=l[d];(!y||y.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const l=!this.aborted&&this.centroid;if(this.reset(),l)return l}}}class fl{constructor(e){this.singleTap=new pu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const l=this.singleTap.touchend(e,n,a);if(l){const d=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(l)<30;if(d&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=l,this.count===this.numTaps)return this.reset(),l}}}class yo{constructor(e){this._tr=new En(e),this._zoomIn=new fl({numTouches:1,numTaps:2}),this._zoomOut=new fl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const l=this._zoomIn.touchend(e,n,a),d=this._zoomOut.touchend(e,n,a),y=this._tr;return l?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(l)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ts{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const l=n.length?n[0]:n;return!this._moved&&l.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=l,this._move(a,l))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const fu={0:1,2:2};class ml{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=V.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,a){const l=fu[a];return n.buttons===void 0||(n.buttons&l)!==l}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class mu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const gl=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}},gu=({enable:p,clickTolerance:e,bearingDegreesPerPixelMoved:n=.8})=>{const a=new ml({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new ts({clickTolerance:e,move:(l,d)=>({bearingDelta:(d.x-l.x)*n}),moveStateManager:a,enable:p,assignEvents:gl})},_u=({enable:p,clickTolerance:e,pitchDegreesPerPixelMoved:n=-.5})=>{const a=new ml({checkCorrectEvent:l=>V.mouseButton(l)===0&&l.ctrlKey||V.mouseButton(l)===2});return new ts({clickTolerance:e,move:(l,d)=>({pitchDelta:(d.y-l.y)*n}),moveStateManager:a,enable:p,assignEvents:gl})};class Vs{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const l=xa(a,n),d=new c.P(0,0),y=new c.P(0,0);let b=0;for(const k in l){const M=l[k],z=this._touches[k];z&&(d._add(M),y._add(M.sub(z)),b++,l[k]=M)}if(this._touches=l,this._shouldBePrevented(b)||!y.mag())return;const S=y.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _l{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[l,d]=this._firstTwoTouches,y=ba(a,n,l),b=ba(a,n,d);if(!y||!b)return;const S=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],S,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[l,d]=this._firstTwoTouches,y=ba(a,n,l),b=ba(a,n,d);y&&b||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ba(p,e,n){for(let a=0;a<p.length;a++)if(p[a].identifier===n)return e[a]}function yu(p,e){return Math.log(p/e)/Math.LN2}class vu extends _l{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(yu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yu(this._distance,a),pinchAround:n}}}function xu(p,e){return 180*p.angleWith(e)/Math.PI}class bu extends _l{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const l=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xu(this._vector,l),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=xu(e,this._startVector);return Math.abs(a)<n}}function yl(p){return Math.abs(p.y)>Math.abs(p.x)}class vo extends _l{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,yl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const l=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(l,d,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(l.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const l=e.mag()>=2,d=n.mag()>=2;if(!l&&!d)return;if(!l||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return yl(e)&&yl(n)&&y}}const lf={panStep:100,bearingStep:15,pitchStep:10};class yn{constructor(e){this._tr=new En(e);const n=lf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,l=0,d=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?l=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?l=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,l=0),{cameraAnimation:b=>{const S=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:Hn,zoom:n?Math.round(S.zoom)+n*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+l*this._pitchStep,offset:[-d*this._panStep,-y*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hn(p){return p*(2-p)}const wu=4.000244140625;class Mn{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new En(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=N.now(),l=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%wu==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":l>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(l*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=V.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=n.y>a.transform.height/2-a.transform.getHorizon()?c.N.convert(this._aroundCenter?a.center:a.unproject(n)):c.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>wu?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*k))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,l=this._easing;let d,y=!1;const b=N.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&l&&b){const S=Math.min(b/200,1),k=l(S);d=c.y.number(a,n,k),S<1?this._frameId||(this._frameId=!0):y=!0}else d=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.b9;if(this._prevEase){const a=this._prevEase,l=(N.now()-a.start)/a.duration,d=a.easing(l+.01)-a.easing(l),y=.27/Math.sqrt(d*d+1e-4)*.01,b=Math.sqrt(.0729-y*y);n=c.b8(y,b,.25,1)}return this._prevEase={start:N.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class js{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class d_{constructor(e){this._tr=new En(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class p_{constructor(){this._tap=new fl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const l=n[0],d=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(l)<30;d&&y?a.length>0&&(this._swipePoint=l,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const l=n[0],d=l.y-this._swipePoint.y;return this._swipePoint=l,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const l=this._tap.touchend(e,n,a);l&&(this._tapTime=e.timeStamp,this._tapPoint=l)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cf{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class uf{constructor(e,n,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Su{constructor(e,n,a,l){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=l,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class xo{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),l=document.createElement("div");l.className="maplibregl-desktop-message",l.textContent=n,this._container.appendChild(l);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=a,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.k("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const vn=p=>p.zoom||p.drag||p.pitch||p.rotate;class yt extends c.k{}function vl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Tu{constructor(e,n){this.handleWindowEvent=l=>{this.handleEvent(l,`${l.type}Window`)},this.handleEvent=(l,d)=>{if(l.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=l.type==="renderFrame"?void 0:l,b={needsRenderFrame:!1},S={},k={},M=l.touches,z=M?this._getMapTouches(M):void 0,B=z?V.touchPos(this._map.getCanvas(),z):V.mousePos(this._map.getCanvas(),l);for(const{handlerName:Q,handler:ne,allowed:oe}of this._handlers){if(!ne.isEnabled())continue;let ce;this._blockedByActive(k,oe,Q)?ne.reset():ne[d||l.type]&&(ce=ne[d||l.type](l,B,z),this.mergeHandlerResult(b,S,ce,Q,y),ce&&ce.needsRenderFrame&&this._triggerRenderFrame()),(ce||ne.isActive())&&(k[Q]=ne)}const G={};for(const Q in this._previousActiveHandlers)k[Q]||(G[Q]=y);this._previousActiveHandlers=k,(Object.keys(G).length||vl(b))&&(this._changes.push([b,S,G]),this._triggerRenderFrame()),(Object.keys(k).length||vl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=b;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new du(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[l,d,y]of this._listeners)V.addEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,a]of this._listeners)V.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new af(n,e));const l=n.boxZoom=new an(n,e);this._add("boxZoom",l),e.interactive&&e.boxZoom&&l.enable();const d=n.cooperativeGestures=new xo(n,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const y=new yo(n),b=new d_(n);n.doubleClickZoom=new js(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const S=new p_;this._add("tapDragZoom",S);const k=n.touchPitch=new vo(n);this._add("touchPitch",k),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const M=gu(e),z=_u(e);n.dragRotate=new uf(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const B=(({enable:ce,clickTolerance:$})=>{const de=new ml({checkCorrectEvent:me=>V.mouseButton(me)===0&&!me.ctrlKey});return new ts({clickTolerance:$,move:(me,we)=>({around:we,panDelta:we.sub(me)}),activateOnStart:!0,moveStateManager:de,enable:ce,assignEvents:gl})})(e),G=new Vs(e,n);n.dragPan=new cf(a,B,G),this._add("mousePan",B),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const H=new bu,Q=new vu;n.touchZoomRotate=new Su(a,Q,H,S),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const ne=n.scrollZoom=new Mn(n,()=>this._triggerRenderFrame());this._add("scrollZoom",ne,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const oe=n.keyboard=new yn(n);this._add("keyboard",oe),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Yi(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const l in e)if(l!==a&&(!n||n.indexOf(l)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,l,d){if(!a)return;c.e(e,a);const y={handlerName:l,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(n.zoom=y),a.panDelta!==void 0&&(n.drag=y),a.pitchDelta!==void 0&&(n.pitch=y),a.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},a={};for(const[l,d,y]of this._changes)l.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(l.panDelta)),l.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+l.zoomDelta),l.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+l.bearingDelta),l.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+l.pitchDelta),l.around!==void 0&&(e.around=l.around),l.pinchAround!==void 0&&(e.pinchAround=l.pinchAround),l.noInertia&&(e.noInertia=l.noInertia),c.e(n,d),c.e(a,y);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const l=this._map,d=l._getTransformForUpdate(),y=l.terrain;if(!(vl(e)||y&&this._terrainMovement))return this._fireEvents(n,a,!0);let{panDelta:b,zoomDelta:S,bearingDelta:k,pitchDelta:M,around:z,pinchAround:B}=e;B!==void 0&&(z=B),l._stop(!0),z=z||l.transform.centerPoint;const G=d.pointLocation(b?z.sub(b):z);k&&(d.bearing+=k),M&&(d.pitch+=M),S&&(d.zoom+=S),y?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(b)):d.setLocationAtPoint(G,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(G,z)):d.setLocationAtPoint(G,z),l._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const l=vn(this._eventsInProgress),d=vn(e),y={};for(const z in e){const{originalEvent:B}=e[z];this._eventsInProgress[z]||(y[`${z}start`]=B),this._eventsInProgress[z]=e[z]}!l&&d&&this._fireEvent("movestart",d.originalEvent);for(const z in y)this._fireEvent(z,y[z]);d&&this._fireEvent("move",d.originalEvent);for(const z in e){const{originalEvent:B}=e[z];this._fireEvent(z,B)}const b={};let S;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:G}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],S=n[B]||G,b[`${z}end`]=S)}for(const z in b)this._fireEvent(z,b[z]);const k=vn(this._eventsInProgress),M=(l||d)&&!k;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!z||!z.essential&&N.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:S})),B(this._map.getBearing())&&this._map.resetNorth()):(B(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new yt("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class hf extends c.E{constructor(e,n){super(),this._renderFrameCallback=()=>{const a=Math.min((N.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,a){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(c.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(c.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(c.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=ye.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,l){const d={top:0,bottom:0,right:0,left:0};if(typeof(l=c.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=="number"){const it=l.padding;l.padding={top:it,bottom:it,right:it,left:it}}l.padding=c.e(d,l.padding);const y=this.transform,b=y.padding,S=new ye(e,n),k=y.project(S.getNorthWest()),M=y.project(S.getNorthEast()),z=y.project(S.getSouthEast()),B=y.project(S.getSouthWest()),G=c.ba(-a),H=k.rotate(G),Q=M.rotate(G),ne=z.rotate(G),oe=B.rotate(G),ce=new c.P(Math.max(H.x,Q.x,oe.x,ne.x),Math.max(H.y,Q.y,oe.y,ne.y)),$=new c.P(Math.min(H.x,Q.x,oe.x,ne.x),Math.min(H.y,Q.y,oe.y,ne.y)),de=ce.sub($),me=(y.width-(b.left+b.right+l.padding.left+l.padding.right))/de.x,we=(y.height-(b.top+b.bottom+l.padding.top+l.padding.bottom))/de.y;if(we<0||me<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Oe=Math.min(y.scaleZoom(y.scale*Math.min(me,we)),l.maxZoom),He=c.P.convert(l.offset),lt=new c.P((l.padding.left-l.padding.right)/2,(l.padding.top-l.padding.bottom)/2).rotate(c.ba(a)),gt=He.add(lt).mult(y.scale/y.zoomScale(Oe));return{center:y.unproject(k.add(z).div(2).sub(gt)),zoom:Oe,bearing:a}}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,l,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(e)),this.transform.pointLocation(c.P.convert(n)),a,l),l,d)}_fitInternal(e,n,a){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let l=!1,d=!1,y=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(l=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=c.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(d=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(y=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new c.k("movestart",n)).fire(new c.k("move",n)),l&&this.fire(new c.k("zoomstart",n)).fire(new c.k("zoom",n)).fire(new c.k("zoomend",n)),d&&this.fire(new c.k("rotatestart",n)).fire(new c.k("rotate",n)).fire(new c.k("rotateend",n)),y&&this.fire(new c.k("pitchstart",n)).fire(new c.k("pitch",n)).fire(new c.k("pitchend",n)),this.fire(new c.k("moveend",n))}calculateCameraOptionsFromTo(e,n,a,l=0){const d=c.Z.fromLngLat(e,n),y=c.Z.fromLngLat(a,l),b=y.x-d.x,S=y.y-d.y,k=y.z-d.z,M=Math.hypot(b,S,k);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(b,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),G=180*Math.atan2(b,-S)/Math.PI;let H=180*Math.acos(z/M)/Math.PI;return H=k<0?90-H:90+H,{center:y.toLngLat(),zoom:B,pitch:H,bearing:G}}easeTo(e,n){var a;this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.b9},e)).animate===!1||!e.essential&&N.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),d=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,k="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let G=l.centerPoint.add(B);const H=l.pointLocation(G),{center:Q,zoom:ne}=l.getConstrained(c.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Q,l);const oe=l.project(H),ce=l.project(Q).sub(oe),$=l.zoomScale(ne-d);let de,me;e.around&&(de=c.N.convert(e.around),me=l.locationPoint(de));const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ne!==d,this._rotating=this._rotating||y!==k,this._pitching=this._pitching||M!==b,this._padding=!l.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,we),this.terrain&&this._prepareElevation(Q),this._ease(Oe=>{if(this._zooming&&(l.zoom=c.y.number(d,ne,Oe)),this._rotating&&(l.bearing=c.y.number(y,k,Oe)),this._pitching&&(l.pitch=c.y.number(b,M,Oe)),this._padding&&(l.interpolatePadding(S,z,Oe),G=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Oe),de)l.setLocationAtPoint(de,me);else{const He=l.zoomScale(l.zoom-d),lt=ne>d?Math.min(2,$):Math.max(.5,$),gt=Math.pow(lt,1-Oe),it=l.unproject(oe.add(ce.mult(Oe*gt)).mult(He));l.setLocationAtPoint(l.renderWorldCopies?it.wrap():it,G)}this._applyUpdatedTransform(l),this._fireMoveEvents(n)},Oe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,Oe)},e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new c.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new c.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new c.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new c.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=c.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const n=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(n.lngLat,e.zoom);if(n.altitude<a){const l=this.calculateCameraOptionsFromTo(n.lngLat,a,e.center,e.elevation);return{pitch:l.pitch,zoom:l.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(this.terrain&&n.push(l=>this._elevateCameraIfInsideTerrain(l)),this.transformCameraUpdate&&n.push(l=>this.transformCameraUpdate(l)),!n.length)return;const a=e.clone();for(const l of n){const d=a.clone(),{center:y,zoom:b,pitch:S,bearing:k,elevation:M}=l(d);y&&(d.center=y),b!==void 0&&(d.zoom=b),S!==void 0&&(d.pitch=S),k!==void 0&&(d.bearing=k),M!==void 0&&(d.elevation=M),a.apply(d)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new c.k("move",e)),this._zooming&&this.fire(new c.k("zoom",e)),this._rotating&&this.fire(new c.k("rotate",e)),this._pitching&&this.fire(new c.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,l=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new c.k("zoomend",e)),l&&this.fire(new c.k("rotateend",e)),d&&this.fire(new c.k("pitchend",e)),this.fire(new c.k("moveend",e))}flyTo(e,n){var a;if(!e.essential&&N.prefersReducedMotion){const ht=c.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ht,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b9},e);const l=this._getTransformForUpdate(),d=l.zoom,y=l.bearing,b=l.pitch,S=l.padding,k="bearing"in e?this._normalizeBearing(e.bearing,y):y,M="pitch"in e?+e.pitch:b,z="padding"in e?e.padding:l.padding,B=c.P.convert(e.offset);let G=l.centerPoint.add(B);const H=l.pointLocation(G),{center:Q,zoom:ne}=l.getConstrained(c.N.convert(e.center||H),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(Q,l);const oe=l.zoomScale(ne-d),ce=l.project(H),$=l.project(Q).sub(ce);let de=e.curve;const me=Math.max(l.width,l.height),we=me/oe,Oe=$.mag();if("minZoom"in e){const ht=c.ac(Math.min(e.minZoom,d,ne),l.minZoom,l.maxZoom),Ut=me/l.zoomScale(ht-d);de=Math.sqrt(Ut/Oe*2)}const He=de*de;function lt(ht){const Ut=(we*we-me*me+(ht?-1:1)*He*He*Oe*Oe)/(2*(ht?we:me)*He*Oe);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function gt(ht){return(Math.exp(ht)-Math.exp(-ht))/2}function it(ht){return(Math.exp(ht)+Math.exp(-ht))/2}const et=lt(!1);let bt=function(ht){return it(et)/it(et+de*ht)},Gt=function(ht){return me*((it(et)*(gt(Ut=et+de*ht)/it(Ut))-gt(et))/He)/Oe;var Ut},st=(lt(!0)-et)/de;if(Math.abs(Oe)<1e-6||!isFinite(st)){if(Math.abs(me-we)<1e-6)return this.easeTo(e,n);const ht=we<me?-1:1;st=Math.abs(Math.log(we/me))/de,Gt=()=>0,bt=Ut=>Math.exp(ht*de*Ut)}return e.duration="duration"in e?+e.duration:1e3*st/("screenSpeed"in e?+e.screenSpeed/de:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=y!==k,this._pitching=M!==b,this._padding=!l.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(Q),this._ease(ht=>{const Ut=ht*st,Li=1/bt(Ut);l.zoom=ht===1?ne:d+l.scaleZoom(Li),this._rotating&&(l.bearing=c.y.number(y,k,ht)),this._pitching&&(l.pitch=c.y.number(b,M,ht)),this._padding&&(l.interpolatePadding(S,z,ht),G=l.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(ht);const Xt=ht===1?Q:l.unproject(ce.add($.mult(Gt(Ut))).mult(Li));l.setLocationAtPoint(l.renderWorldCopies?Xt.wrap():Xt,G),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const l=this._onEaseEnd;delete this._onEaseEnd,l.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=N.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.b3(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}_normalizeCenter(e,n){if(!n.renderWorldCopies||n.lngRange)return;const a=e.lng-n.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const bo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wo{constructor(e=bo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(l=>typeof l!="string"?"":l)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const l=this._map.style.stylesheet;this.styleOwner=l.owner,this.styleId=l.id}const n=this._map.style.sourceCaches;for(const l in n){const d=n[l];if(d.used||d.usedForTerrain){const y=d.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(l=>String(l).trim()),e.sort((l,d)=>l.length-d.length),e=e.filter((l,d)=>{for(let y=d+1;y<e.length;y++)if(e[y].indexOf(l)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pu{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const n=V.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ai{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const l of a)if(l.id===e)return void(l.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Iu=c.Y([{name:"a_pos3d",type:"Int16",components:3}]);class f_ extends c.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const l of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))a[l.key]=!0,this._renderableTilesKeys.push(l.key),this._tiles[l.key]||(l.posMatrix=new Float64Array(16),c.aP(l.posMatrix,0,c.X,0,c.X,0,1),this._tiles[l.key]=new Qn(l,this.tileSize));for(const l in this._tiles)a[l]||delete this._tiles[l]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const a of this._renderableTilesKeys){const l=this._tiles[a].tileID;if(l.canonical.equals(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16),c.aP(d.posMatrix,0,c.X,0,c.X,0,1),n[a]=d}else if(l.canonical.isChildOf(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const y=l.canonical.z-e.canonical.z,b=l.canonical.x-(l.canonical.x>>y<<y),S=l.canonical.y-(l.canonical.y>>y<<y),k=c.X>>y;c.aP(d.posMatrix,0,k,0,k,0,1),c.J(d.posMatrix,d.posMatrix,[-b*k,-S*k,0]),n[a]=d}else if(e.canonical.isChildOf(l.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const y=e.canonical.z-l.canonical.z,b=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),k=c.X>>y;c.aP(d.posMatrix,0,c.X,0,c.X,0,1),c.J(d.posMatrix,d.posMatrix,[b*k,S*k,0]),c.K(d.posMatrix,d.posMatrix,[1/2**y,1/2**y,0]),n[a]=d}}return n}getSourceTile(e,n){const a=this.sourceCache._source;let l=e.overscaledZ-this.deltaZoom;if(l>a.maxzoom&&(l=a.maxzoom),l<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(l).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&n)for(;l>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(l--).key);return d}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=e)}}class Cu{constructor(e,n,a){this.painter=e,this.sourceCache=new f_(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,l=c.X){var d;if(!(n>=0&&n<l&&a>=0&&a<l))return 0;const y=this.getTerrainData(e),b=(d=y.tile)===null||d===void 0?void 0:d.dem;if(!b)return 0;const S=function(H,Q,ne){var oe=Q[0],ce=Q[1];return H[0]=ne[0]*oe+ne[4]*ce+ne[12],H[1]=ne[1]*oe+ne[5]*ce+ne[13],H}([],[n/l*c.X,a/l*c.X],y.u_terrain_matrix),k=[S[0]*b.dim,S[1]*b.dim],M=Math.floor(k[0]),z=Math.floor(k[1]),B=k[0]-M,G=k[1]-z;return b.get(M,z)*(1-B)*(1-G)+b.get(M+1,z)*B*(1-G)+b.get(M,z+1)*(1-B)*G+b.get(M+1,z+1)*B*G}getElevationForLngLatZoom(e,n){if(!c.bb(n,e.wrap()))return 0;const{tileID:a,mercatorX:l,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,l%c.X,d%c.X,c.X)}getElevation(e,n,a,l=c.X){return this.getDEMElevation(e,n,a,l)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const l=this.painter.context,d=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Re(l,d,l.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Re(l,new c.R({width:1,height:1}),l.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const l=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new Re(l,n.dem.getPixels(),l.gl.RGBA,{premultiply:!1}),n.demTexture.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const l=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=l?d=e.canonical.z-l:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>d<<d),b=e.canonical.y-(e.canonical.y>>d<<d),S=c.bc(new Float64Array(16),[1/(c.X<<d),1/(c.X<<d),0]);c.J(S,S,[y*c.X,b*c.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,l=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===l||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Re(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Re(n.context,{width:a,height:l,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,l,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,l))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,y=0;d<this._coordsTextureSize;d++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)n[y+0]=255&b,n[y+1]=255&d,n[y+2]=b>>8<<4|d>>8,n[y+3]=0;const a=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),l=new Re(e,a,e.gl.RGBA,{premultiply:!1});return l.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=l,l}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,l=a.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),l.readPixels(d,b-y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const S=n[0]+(n[2]>>4<<8),k=n[1]+((15&n[2])<<8),M=this.coordsIndex[255-n[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const B=this._coordsTextureSize,G=(1<<z.tileID.canonical.z)*B;return new c.Z((z.tileID.canonical.x*B+S)/G+z.tileID.wrap,(z.tileID.canonical.y*B+k)/G,this.getElevation(z.tileID,S,k,B))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,l=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),l.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,l.RGBA,l.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new c.bd,a=new c.aY,l=this.meshSize,d=c.X/l,y=l*l;for(let z=0;z<=l;z++)for(let B=0;B<=l;B++)n.emplaceBack(B*d,z*d,0);for(let z=0;z<y;z+=l+1)for(let B=0;B<l;B++)a.emplaceBack(B+z,l+B+z+1,l+B+z+2),a.emplaceBack(B+z,l+B+z+2,B+z+1);const b=n.length,S=b+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const G of[0,1])n.emplaceBack(B*d,z*c.X,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(b+z,b+z+3,b+z+1),a.emplaceBack(b+z,b+z+2,b+z+3);const k=n.length,M=k+2*(l+1);for(const z of[0,1])for(let B=0;B<=l;B++)for(const G of[0,1])n.emplaceBack(z*c.X,B*d,G);for(let z=0;z<2*l;z+=2)a.emplaceBack(k+z,k+z+1,k+z+3),a.emplaceBack(k+z,k+z+3,k+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new cl(e.createVertexBuffer(n,Iu.members),e.createIndexBuffer(a),c.a0.simpleSegment(0,0,n.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*c.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:l}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(l).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=c.Z.fromLngLat(e.wrap()),l=(1<<n)*c.X,d=a.x*l,y=a.y*l,b=Math.floor(d/c.X),S=Math.floor(y/c.X);return{tileID:new c.S(n,0,n,b,S),mercatorX:d,mercatorY:y}}}class m_{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Re(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const So={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class df{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new m_(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(n)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const l=e.sourceCaches[a].getVisibleCoordinates();for(const d of l){const y=this.terrain.sourceCache.getTerrainCoords(d);for(const b in y)this._coordsDescendingInv[a][b]||(this._coordsDescendingInv[a][b]=[]),this._coordsDescendingInv[a][b].push(y[b])}}this._coordsDescendingInvStr={};for(const a of e._order){const l=e._layers[a],d=l.source;if(So[l.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const y in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][y]=this._coordsDescendingInv[d][y].map(b=>b.key).sort().join()}}for(const a of this._renderableTiles)for(const l in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[l][a.tileID.key];d&&d!==a.rttCoords[l]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,a=this.painter,l=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(So[n]&&(this._prevType&&So[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!l))return!0;if(So[this._prevType]||So[n]&&l){this._prevType=n;const d=this._stacks.length-1,y=this._stacks[d]||[];for(const b of this._renderableTiles){if(this.pool.isFull()&&(nf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(b),b.rtt[d]){const k=this.pool.getObjectForId(b.rtt[d].id);if(k.stamp===b.rtt[d].stamp){this.pool.useObject(k);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),b.rtt[d]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:c.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let k=0;k<y.length;k++){const M=a.style._layers[y[k]],z=M.source?this._coordsDescendingInv[M.source][b.tileID.key]:[b.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(b.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][b.tileID.key])}}return nf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),So[n]}return!1}}const Au={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pf=j,g_={hash:!1,interactive:!0,bearingSnap:7,attributionControl:bo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},ku=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},__={showCompass:!0,showZoom:!0,visualizePitch:!1};class y_{constructor(e,n,a=!1){this.mousedown=y=>{this.startMouse(c.e({},y,{ctrlKey:!0,preventDefault:()=>y.preventDefault()}),V.mousePos(this.element,y)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.moveMouse(y,V.mousePos(this.element,y))},this.mouseup=y=>{this.mouseRotate.dragEnd(y),this.mousePitch&&this.mousePitch.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.startTouch(y,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,y.targetTouches)[0],this.moveTouch(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const l=e.dragRotate._mouseRotate.getClickTolerance(),d=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=gu({clickTolerance:l,enable:!0}),this.touchRotate=(({enable:y,clickTolerance:b,bearingDegreesPerPixelMoved:S=.8})=>{const k=new mu;return new ts({clickTolerance:b,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:k,enable:y,assignEvents:ku})})({clickTolerance:l,enable:!0}),this.map=e,a&&(this.mousePitch=_u({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:y,clickTolerance:b,pitchDegreesPerPixelMoved:S=-.5})=>{const k=new mu;return new ts({clickTolerance:b,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:k,enable:y,assignEvents:ku})})({clickTolerance:d,enable:!0})),V.addEventListener(n,"mousedown",this.mousedown),V.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(n,"touchcancel",this.reset)}startMouse(e,n){this.mouseRotate.dragStart(e,n),this.mousePitch&&this.mousePitch.dragStart(e,n),V.disableDrag()}startTouch(e,n){this.touchRotate.dragStart(e,n),this.touchPitch&&this.touchPitch.dragStart(e,n),V.disableDrag()}moveMouse(e,n){const a=this.map,{bearingDelta:l}=this.mouseRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(e,n)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(e,n){const a=this.map,{bearingDelta:l}=this.touchRotate.dragMove(e,n)||{};if(l&&a.setBearing(a.getBearing()+l),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(e,n)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let ln;function Di(p,e,n){const a=new c.N(p.lng,p.lat);if(p=new c.N(p.lng,p.lat),e){const l=new c.N(p.lng-360,p.lat),d=new c.N(p.lng+360,p.lat),y=n.locationPoint(p).distSqr(e);n.locationPoint(l).distSqr(e)<y?p=l:n.locationPoint(d).distSqr(e)<y&&(p=d)}for(;Math.abs(p.lng-n.center.lng)>180;){const l=n.locationPoint(p);if(l.x>=0&&l.y>=0&&l.x<=n.width&&l.y<=n.height)break;p.lng>n.center.lng?p.lng-=360:p.lng+=360}return p.lng!==a.lng&&n.locationPoint(p).y>n.height/2-n.getHorizon()?p:a}const To={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xl(p,e,n){const a=p.classList;for(const l in To)a.remove(`maplibregl-${n}-anchor-${l}`);a.add(`maplibregl-${n}-anchor-${e}`)}class bl extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,l=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&l!==32&&l!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,l=this._element;this._popup&&(a===l||l.contains(a))&&this.togglePopup()},this._update=n=>{var a;if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Di(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${To[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${d}`),N.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const n=V.createNS("http://www.w3.org/2000/svg","svg"),a=41,l=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${l}px`),n.setAttributeNS(null,"viewBox",`0 0 ${l} ${a}`);const d=V.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const y=V.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=V.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const oe of S){const ce=V.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",oe.rx),ce.setAttributeNS(null,"ry",oe.ry),b.appendChild(ce)}const k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(M);const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const B=V.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(B);const G=V.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const H=V.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=V.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const ne=V.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#FFFFFF"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962"),H.appendChild(Q),H.appendChild(ne),y.appendChild(b),y.appendChild(k),y.appendChild(z),y.appendChild(G),y.appendChild(H),n.appendChild(y),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",l*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),xl(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const l=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[l,-1*(38.1-13.5+l)],"bottom-right":[-l,-1*(38.1-13.5+l)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;if(!(!((n=this._map)===null||n===void 0)&&n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const l=this._map,d=l.terrain.depthAtPoint(this._pos),y=l.terrain.getElevationForLngLatZoom(this._lngLat,l.transform.tileZoom);if(l.transform.lngLatToCameraDepth(this._lngLat,y)-d<.006)return void(this._element.style.opacity=this._opacity);const b=-this._offset.y/l.transform._pixelPerMeter,S=Math.sin(l.getPitch()*Math.PI/180)*b,k=l.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),M=l.transform.lngLatToCameraDepth(this._lngLat,y+S)-k>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return e===void 0&&n===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const ff={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let wa=0,Sa=!1;const Xn={maxWidth:100,unit:"metric"};function Ta(p,e,n){const a=n&&n.maxWidth||100,l=p._container.clientHeight/2,d=p.unproject([0,l]),y=p.unproject([a,l]),b=d.distanceTo(y);if(n&&n.unit==="imperial"){const S=3.2808*b;S>5280?xt(e,a,S/5280,p._getUIString("ScaleControl.Miles")):xt(e,a,S,p._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?xt(e,a,b/1852,p._getUIString("ScaleControl.NauticalMiles")):b>=1e3?xt(e,a,b/1e3,p._getUIString("ScaleControl.Kilometers")):xt(e,a,b,p._getUIString("ScaleControl.Meters"))}function xt(p,e,n,a){const l=function(d){const y=Math.pow(10,`${Math.floor(d)}`.length-1);let b=d/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(S){const k=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*k)/k}(b),y*b}(n);p.style.width=e*(l/n)+"px",p.innerHTML=`${l}&nbsp;${a}`}const Ft={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},wl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Sl(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,p),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-p),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(p,0),right:new c.P(-p,0)}}if(p instanceof c.P||Array.isArray(p)){const e=c.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(p.center||[0,0]),top:c.P.convert(p.top||[0,0]),"top-left":c.P.convert(p["top-left"]||[0,0]),"top-right":c.P.convert(p["top-right"]||[0,0]),bottom:c.P.convert(p.bottom||[0,0]),"bottom-left":c.P.convert(p["bottom-left"]||[0,0]),"bottom-right":c.P.convert(p["bottom-right"]||[0,0]),left:c.P.convert(p.left||[0,0]),right:c.P.convert(p.right||[0,0])}}return Sl(new c.P(0,0))}const Eu=j;w.AJAXError=c.bh,w.Evented=c.E,w.LngLat=c.N,w.MercatorCoordinate=c.Z,w.Point=c.P,w.addProtocol=c.bi,w.config=c.a,w.removeProtocol=c.bj,w.AttributionControl=wo,w.BoxZoomHandler=an,w.CanvasSource=Zr,w.CooperativeGesturesHandler=xo,w.DoubleClickZoomHandler=js,w.DragPanHandler=cf,w.DragRotateHandler=uf,w.EdgeInsets=go,w.FullscreenControl=class extends c.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n==null?void 0:n.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},w.GeoJSONSource=dn,w.GeolocateControl=class extends c.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,l=this._map.getBearing(),d=c.e({bearing:l},this.options.fitBoundsOptions),y=ye.fromLngLat(n,a);this._map.fitBounds(y,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Sa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")),this.fire(new c.k("userlocationlostfocus")))})}},this.options=c.e({},ff,p)}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(ln!==void 0&&!e)return ln;if(window.navigator.permissions===void 0)return ln=!!window.navigator.geolocation,ln;try{ln=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ln=!!window.navigator.geolocation}return ln})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wa=0,Sa=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),n=p.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),n=p.getNorthEast(),a=e.distanceTo(n),l=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wa--,Sa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart")),this.fire(new c.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wa++,wa>1?(p={maximumAge:6e5,timeout:0},Sa=!0):(p=this.options.positionOptions,Sa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},w.Hash=hl,w.ImageSource=ur,w.KeyboardHandler=yn,w.LngLatBounds=ye,w.LogoControl=Pu,w.Map=class extends hf{constructor(p){c.bf.mark(c.bg.create);const e=Object.assign(Object.assign({},g_),p);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _o(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ai,this._controls=[],this._mapId=c.a4(),this._contextLost=n=>{n.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:n}))},this._contextRestored=n=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:n}))},this._onMapScroll=n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Au),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ee.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ne(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let n=!1;const a=_a(l=>{this._trackResize&&!this._removed&&(this.resize(l),this.redraw())},50);this._resizeObserver=new ResizeObserver(l=>{n?a(l):n=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Tu(this,e),this._hash=e.hash&&new hl(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,c.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new wo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Pu,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new c.k(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new c.k(`${n.dataType}dataloading`,n))}),this.on("dataabort",n=>{this.fire(new c.k("sourcedataabort",n))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=p.onAdd(this);this._controls.push(p);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,n,a)}resize(p){var e;const n=this._containerDimensions(),a=n[0],l=n[1],d=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,d),this.painter.resize(a,l,d),this.painter.overLimit()){const b=this.painter.context.gl;this._maxCanvasSize=[b.drawingBufferWidth,b.drawingBufferHeight];const S=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,S),this.painter.resize(a,l,S)}this.transform.resize(a,l),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,l);const y=!this._moving;return y&&(this.stop(),this.fire(new c.k("movestart",p)).fire(new c.k("move",p))),this.fire(new c.k("resize",p)),y&&this.fire(new c.k("moveend",p)),this}_getClampedPixelRatio(p,e){const{0:n,1:a}=this._maxCanvasSize,l=this.getPixelRatio(),d=p*l,y=e*l;return Math.min(d>n?n/d:1,y>a?a/y:1)*l}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(ye.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(c.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(c.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,n){if(p==="mouseenter"||p==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:d=>{const y=e.filter(S=>this.getLayer(S)),b=y.length!==0?this.queryRenderedFeatures(d.point,{layers:y}):[];b.length?a||(a=!0,n.call(this,new Tr(p,this,d.originalEvent,{features:b}))):a=!1},mouseout:()=>{a=!1}}}}if(p==="mouseleave"||p==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const b=e.filter(S=>this.getLayer(S));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?a=!0:a&&(a=!1,n.call(this,new Tr(p,this,y.originalEvent)))},mouseout:y=>{a&&(a=!1,n.call(this,new Tr(p,this,y.originalEvent)))}}}}{const a=l=>{const d=e.filter(b=>this.getLayer(b)),y=d.length!==0?this.queryRenderedFeatures(l.point,{layers:d}):[];y.length&&(l.features=y,n.call(this,l),delete l.features)};return{layers:e,listener:n,delegates:{[p]:a}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,n){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const a=this._delegatedListeners[p];for(let l=0;l<a.length;l++){const d=a[l];if(d.listener===n&&d.layers.length===e.length&&d.layers.every(y=>e.includes(y))){for(const y in d.delegates)this.off(y,d.delegates[y]);return void a.splice(l,1)}}}on(p,e,n){if(n===void 0)return super.on(p,e);const a=this._createDelegatedListener(p,typeof e=="string"?[e]:e,n);this._saveDelegatedListener(p,a);for(const l in a.delegates)this.on(l,a.delegates[l]);return this}once(p,e,n){if(n===void 0)return super.once(p,e);const a=typeof e=="string"?[e]:e,l=this._createDelegatedListener(p,a,n);for(const d in l.delegates){const y=l.delegates[d];l.delegates[d]=(...b)=>{this._removeDelegatedListener(p,a,n),y(...b)}}this._saveDelegatedListener(p,l);for(const d in l.delegates)this.once(d,l.delegates[d]);return this}off(p,e,n){return n===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let n;const a=p instanceof c.P||Array.isArray(p),l=a?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:p)||{},l instanceof c.P||typeof l[0]=="number")n=[c.P.convert(l)];else{const d=c.P.convert(l[0]),y=c.P.convert(l[1]);n=[d,new c.P(y.x,d.y),y,new c.P(d.x,y.y),d]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const n=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Xa(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,n):this.style.loadJSON(p,e,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const n=this._requestManager.transformRequest(p,"Style");c.h(n,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new c.j(a))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new c.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===p.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Cu(this.painter,e,p),this.painter.renderToTexture=new df(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const n=p[e]._tiles;for(const a in n){const l=n[a];if(l.state!=="loaded"&&l.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,n={}){const{pixelRatio:a=1,sdf:l=!1,stretchX:d,stretchY:y,content:b,textFitWidth:S,textFitHeight:k}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:B}=e,G=e;return this.style.addImage(p,{data:new c.R({width:M,height:z},new Uint8Array(B)),pixelRatio:a,stretchX:d,stretchY:y,content:b,textFitWidth:S,textFitHeight:k,sdf:l,version:0,userImage:G}),G.onAdd&&G.onAdd(this,p),this}}{const{width:M,height:z,data:B}=N.getImageData(e);this.style.addImage(p,{data:new c.R({width:M,height:z},B),pixelRatio:a,stretchX:d,stretchY:y,content:b,textFitWidth:S,textFitHeight:k,sdf:l,version:0})}}updateImage(p,e){const n=this.style.getImage(p);if(!n)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||c.b(e)?N.getImageData(e):e,{width:l,height:d,data:y}=a;if(l===void 0||d===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(l!==n.data.width||d!==n.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,b),this.style.updateImage(p,n),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return Ee.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,n){return this.style.setLayerZoomRange(p,e,n),this._update(!0)}setFilter(p,e,n={}){return this.style.setFilter(p,e,n),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,n,a={}){return this.style.setPaintProperty(p,e,n,a),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,n,a={}){return this.style.setLayoutProperty(p,e,n,a),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,n,a=>{a||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,n=>{n||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p){return this._lazyInitEmptyStyle(),this.style.setSky(p),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const l=this._controlContainer=V.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{d[y]=V.create("div",`maplibregl-ctrl-${y} `,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,n){this._canvas.width=Math.floor(n*p),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:p},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const n=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new ul(n,this.transform),se.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const l=this.transform.zoom,d=N.now();this.style.zoomHistory.update(l,d);const y=new c.z(l,{now:d,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),b=y.crossFadingFactor();b===1&&b===this._crossFadingFactor||(n=!0,this._crossFadingFactor=b),this.style.update(y)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bf.mark(c.bg.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,c.bf.mark(c.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ee.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bf.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frameAsync(this._frameRequest).then(p=>{c.bf.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return pf}getCameraTargetElevation(){return this.transform.elevation}},w.MapMouseEvent=Tr,w.MapTouchEvent=Ns,w.MapWheelEvent=of,w.Marker=bl,w.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=c.e({},__,p),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new y_(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const n=V.create("button",p,this._container);return n.type="button",n.addEventListener("click",e),n}},w.Popup=class extends c.E{constructor(p){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var n;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const b of this.options.className.split(" "))this._container.classList.add(b);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Di(this._lngLat,this._flatPos,this._map.transform):(n=this._lngLat)===null||n===void 0?void 0:n.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let l=this.options.anchor;const d=Sl(this.options.offset);if(!l){const b=this._container.offsetWidth,S=this._container.offsetHeight;let k;k=a.y+d.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<b/2?k.push("left"):a.x>this._map.transform.width-b/2&&k.push("right"),l=k.length===0?"bottom":k.join("-")}let y=a.add(d[l]);this.options.subpixelPositioning||(y=y.round()),V.setTransform(this._container,`${To[l]} translate(${y.x}px,${y.y}px)`),xl(this._container,l,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Ft),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=c.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=p;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(wl);p&&p.focus()}},w.RasterDEMTileSource=vi,w.RasterTileSource=ei,w.ScaleControl=class{constructor(p){this._onMove=()=>{Ta(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ta(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xn),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},w.ScrollZoomHandler=Mn,w.Style=Xa,w.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},w.TwoFingersTouchPitchHandler=vo,w.TwoFingersTouchRotateHandler=bu,w.TwoFingersTouchZoomHandler=vu,w.TwoFingersTouchZoomRotateHandler=Su,w.VectorTileSource=Dr,w.VideoSource=Zn,w.addSourceType=(p,e)=>c._(void 0,void 0,void 0,function*(){if(us(p))throw new Error(`A source type called "${p}" already exists.`);((n,a)=>{In[n]=a})(p,e)}),w.clearPrewarmedResources=function(){const p=Ci;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Jt),Ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},w.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},w.getRTLTextPluginStatus=function(){return fn().getRTLTextPluginStatus()},w.getVersion=function(){return Eu},w.getWorkerCount=function(){return fi.workerCount},w.getWorkerUrl=function(){return c.a.WORKER_URL},w.importScriptInWorkers=function(p){return Vi().broadcast("IS",p)},w.prewarm=function(){Wi().acquire(Jt)},w.setMaxParallelImageRequests=function(p){c.a.MAX_PARALLEL_IMAGE_REQUESTS=p},w.setRTLTextPlugin=function(p,e){return fn().setRTLTextPlugin(p,e)},w.setWorkerCount=function(p){fi.workerCount=p},w.setWorkerUrl=function(p){c.a.WORKER_URL=p}});var C=g;return C})}(Jf)),Jf.exports}var tz=ez();const jc=Eb(tz);var Sp;class X0{constructor(s){X(this,Sp,Je());this.value=s}get value(){return L(I(this,Sp))}set value(s){Be(I(this,Sp),je(s))}}Sp=new WeakMap;var Tp,Pp,Ip,Cp;class iz{constructor(){X(this,Tp,Je());X(this,Pp,Je(!1));qe(this,"loadedImages",new Vy);X(this,Ip,Je(0));X(this,Cp,Je(24));qe(this,"layerInfo",new Map);qe(this,"eventTracker",new WeakMap);qe(this,"eventTopMost");qe(this,"markerClickManager",new cz);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return L(I(this,Tp))}set map(s){Be(I(this,Tp),je(s))}get loaded(){return L(I(this,Pp))}set loaded(s){Be(I(this,Pp),je(s))}get minzoom(){return L(I(this,Ip))}set minzoom(s){Be(I(this,Ip),je(s))}get maxzoom(){return L(I(this,Cp))}set maxzoom(s){Be(I(this,Cp),je(s))}_eventTopMost(s){var C;let g=this.eventTracker.get(s.originalEvent);if(g!==void 0)return g;let T=(C=s.target.queryRenderedFeatures(s.point).find(w=>{var c;return(c=this.layerInfo.get(w.layer.id))==null?void 0:c.interactive}))==null?void 0:C.layer.id;return this.eventTracker.set(s.originalEvent,T),T}}Tp=new WeakMap,Pp=new WeakMap,Ip=new WeakMap,Cp=new WeakMap;function rz(h){Ap(sz,h)}function nz(h){Ap(oz,h)}const xw=Symbol.for("svelte-maplibre"),sz=Symbol.for("svelte-maplibre.popup-target"),oz=Symbol.for("svelte-maplibre.layer-event");function Dp(){return Hy(xw)}function az(){return Ap(xw,new iz)}function lz(){const h=new X0(void 0),s=new X0(void 0);return rz(h),nz(s),{marker:h,layerEvent:s}}class cz{constructor(){qe(this,"_handlers",new Set)}add(s){this._handlers.add(s)}remove(s){this._handlers.delete(s)}handleClick(s){for(const g of this._handlers)g(s)}}function uz(h){return Object.fromEntries(Object.entries(h).filter(([s,g])=>g!=null))}Q0(["click"]);function hz(h,s){Ct(s,!0);const g=Pe(Dp),v=Pe(()=>L(g).map),T=Pe(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),w=ee(s,"container",3,void 0),c=Je(void 0),j=Pe(()=>typeof w()=="string"?document.querySelector(w())??void 0:w());Tt(()=>{L(j)&&!L(c)&&(Be(c,je(new jc.FullscreenControl({container:L(j)}))),L(v).addControl(L(c),C()))}),kp(()=>{L(T)&&L(c)&&L(v).removeControl(L(c))}),At()}function dz(h,s){Ct(s,!0);const g=Pe(Dp),v=Pe(()=>L(g).map),T=Pe(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),w=ee(s,"positionOptions",3,void 0),c=ee(s,"fitBoundsOptions",3,void 0),j=ee(s,"trackUserLocation",3,!1),q=ee(s,"showAccuracyCircle",3,!0),K=ee(s,"showUserLocation",3,!0),N=ee(s,"control",15);Tt(()=>{L(v)&&!N()&&(N(new jc.GeolocateControl({positionOptions:w(),fitBoundsOptions:c(),trackUserLocation:j(),showAccuracyCircle:q(),showUserLocation:K()})),L(v).addControl(N(),C()))}),kp(()=>{L(T)&&N()&&L(v).removeControl(N())}),At()}function pz(h){let s=h.getCenter(),g=Math.round(h.getZoom()*100)/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),C=Math.round(s.lat*T)/T,w=Math.round(s.lng*T)/T,c=`${g}/${C}/${w}`,j=h.getBearing(),q=h.getPitch();return(j||q)&&(c+=`/${Math.round(j*10)/10}`),q&&(c+=`/${Math.round(q)}`),`#${c}`}function fz(h){return h.replace("#","").split("/").map(parseFloat)}var Ul=pv;function pv(h,s){return h===s||h!==h&&s!==s?!0:typeof h!=typeof s||{}.toString.call(h)!={}.toString.call(s)||h!==Object(h)||!h?!1:Array.isArray(h)?K0(h,s):{}.toString.call(h)=="[object Set]"?K0(Array.from(h),Array.from(s)):{}.toString.call(h)=="[object Object]"?gz(h,s):mz(h,s)}function mz(h,s){return h.toString()===s.toString()}function K0(h,s){var g=h.length;if(g!=s.length)return!1;for(var v=0;v<g;v++)if(!pv(h[v],s[v]))return!1;return!0}function gz(h,s){var g=Object.keys(h),v=g.length;if(v!=Object.keys(s).length)return!1;for(var T=0;T<v;T++){var C=g[T];if(!(s.hasOwnProperty(C)&&pv(h[C],s[C])))return!1}return!0}function _z(h,s){Ct(s,!0);const g=Pe(Dp),v=Pe(()=>L(g).map),T=Pe(()=>L(g).loaded);let C=ee(s,"position",3,"top-left"),w=ee(s,"showCompass",3,!0),c=ee(s,"showZoom",3,!0),j=ee(s,"visualizePitch",3,!1),q=Je(void 0);Tt(()=>{L(v)&&!L(q)&&(Be(q,je(new jc.NavigationControl({showCompass:w(),showZoom:c(),visualizePitch:j()}))),L(v).addControl(L(q),C()))}),kp(()=>{L(T)&&L(q)&&L(v).removeControl(L(q))}),At()}function yz(h,s){Ct(s,!0);const g=Pe(Dp),v=Pe(()=>L(g).map),T=Pe(()=>L(g).loaded);let C=ee(s,"position",3,"bottom-left"),w=ee(s,"maxWidth",3,void 0),c=ee(s,"unit",3,"metric"),j=Je(void 0);Tt(()=>{L(v)&&!L(j)&&(Be(j,je(new jc.ScaleControl({maxWidth:w(),unit:c()}))),L(v).addControl(L(j),C()))}),kp(()=>{L(T)&&L(j)&&L(v).removeControl(L(j))}),At()}var vz=Et("<!> <!> <!> <!>",1),xz=Et("<!> <!>",1),bz=Et('<div data-testid="map-container"><!></div>');function wz(h,s){Ct(s,!0);let g=ee(s,"map",15,void 0),v=ee(s,"mapContainer",15,void 0),T=ee(s,"class",3,void 0),C=ee(s,"diffStyleUpdates",3,!1),w=ee(s,"center",15,void 0),c=ee(s,"zoom",15,void 0),j=ee(s,"pitch",15,0),q=ee(s,"bearing",15,0),K=ee(s,"bounds",15,void 0),N=ee(s,"hash",3,!1),V=ee(s,"updateHash",3,mt=>{window.history.replaceState(window.history.state,"",mt)}),se=ee(s,"loaded",15,!1),ie=ee(s,"minZoom",3,0),le=ee(s,"maxZoom",3,22),fe=ee(s,"minPitch",3,0),Se=ee(s,"maxPitch",3,60),ge=ee(s,"renderWorldCopies",3,void 0),Ee=ee(s,"dragPan",3,void 0),Ne=ee(s,"dragRotate",3,void 0),Le=ee(s,"pitchWithRotate",3,void 0),We=ee(s,"antialias",3,void 0),tt=ee(s,"zoomOnDoubleClick",3,!0),Pt=ee(s,"locale",3,void 0),$e=ee(s,"interactive",3,!0),nt=ee(s,"attributionControl",3,void 0),Re=ee(s,"cooperativeGestures",3,!1),Me=ee(s,"preserveDrawingBuffer",3,!1),De=ee(s,"maxBounds",3,void 0),Ae=ee(s,"images",19,()=>[]),Ge=ee(s,"standardControls",3,!1),Xe=ee(s,"filterLayers",3,void 0),ft=ee(s,"transformRequest",3,void 0),dt=Pe(()=>typeof Ge()=="boolean"?void 0:Ge());const at=az();let ut=Je(je(new Set));async function Mt(mt,Ot=!1){var ye;if(g()&&!(!((ye=g())!=null&&ye.loaded())&&!Ot))if("url"in mt){L(ut).add(mt.id);try{let zi=await g().loadImage(mt.url);g().addImage(mt.id,zi.data,mt.options),at.loadedImages.add(mt.id)}catch(zi){s.onerror?s.onerror({error:zi}):console.error(zi)}finally{L(ut).delete(mt.id)}}else g().addImage(mt.id,mt.data,mt.options),at.loadedImages.add(mt.id)}Tt(()=>{var mt;if(se()&&((mt=g())!=null&&mt.loaded()))for(let Ot of Ae())!at.loadedImages.has(Ot.id)&&!L(ut).has(Ot.id)&&!g().hasImage(Ot.id)&&Mt(Ot)});let zt=Pe(()=>Ae().every(mt=>at.loadedImages.has(mt.id))),ri=Je(void 0),Jt=Je(void 0),fi=Je(void 0),Ni=Je(void 0);function Ci(mt){s.onerror?s.onerror(mt):mt.error.name!=="AbortError"&&console.error(mt.error)}function qi(mt){return zr(),g(at.map=new jc.Map(uz({container:mt,style:s.style,locale:Pt(),center:w(),zoom:c(),pitch:j(),bearing:q(),minZoom:ie(),maxZoom:le(),minPitch:fe(),maxPitch:Se(),renderWorldCopies:ge(),dragPan:Ee(),dragRotate:Ne(),pitchWithRotate:Le(),antialias:We(),interactive:$e(),preserveDrawingBuffer:Me(),maxBounds:De(),bounds:K(),attributionControl:nt(),transformRequest:ft(),cooperativeGestures:Re()}))),g().on("load",Ot=>{Ot.target.getContainer().setAttribute("data-testid","map"),Ot.target.getCanvas().setAttribute("data-testid","map-canvas"),s.onload&&s.onload(g()),at.loaded=!0,se(!0)}),g().on("error",Ci),s.onmovestart&&g().on("movestart",s.onmovestart),g().on("moveend",Ot=>{var ye;if(w(Ot.target.getCenter()),c(Ot.target.getZoom()),j(Ot.target.getPitch()),q(Ot.target.getBearing()),K(Ot.target.getBounds()),(ye=s.onmoveend)==null||ye.call(s,Ot),N()){let zi=new URL(window.location.href.replace(/(#.+)?$/,pz(Ot.target)));V()(zi)}}),s.onclick&&g().on("click",s.onclick),s.ondblclick&&g().on("dblclick",s.ondblclick),s.oncontextmenu&&g().on("contextmenu",s.oncontextmenu),s.onmousemove&&g().on("mousemove",s.onmousemove),s.onzoomstart&&g().on("zoomstart",s.onzoomstart),s.onzoom&&g().on("zoom",s.onzoom),s.onzoomend&&g().on("zoomend",s.onzoomend),s.onpitch&&g().on("pitch",s.onpitch),s.onrotate&&g().on("rotate",s.onrotate),s.onwheel&&g().on("wheel",s.onwheel),s.ondata&&g().on("data",s.ondata),s.onidle&&g().on("idle",s.onidle),g().on("style.load",()=>{if(g()){const Ot=g().getStyle();if(Be(ri,je(Ot.layers.map(ye=>ye.id))),Be(Jt,je(Object.keys(Ot.sources))),L(Ni))for(const[ye,zi]of Object.entries(L(Ni)))g().addSource(ye,zi);if(L(fi))for(const ye of L(fi))g().addLayer(ye);for(const ye of Ae())Mt(ye,!0)}}),g().on("styledata",Ot=>{var ye;if(g()&&Xe()){const zi=g().getStyle().layers;if(zi)for(let Dr of zi)Xe()(Dr)||g().setLayoutProperty(Dr.id,"visibility","none")}(ye=s.onstyledata)==null||ye.call(s,Ot)}),{destroy(){var Ot;se(!1),at.loaded=!1,(Ot=g())==null||Ot.remove()}}}let Wi=Je(je(s.style));Tt(()=>{if(g()&&!Ul(s.style,L(Wi))){const mt=g().getStyle();if(L(ri)&&Be(fi,je(mt.layers.filter(Ot=>!L(ri).includes(Ot.id)))),L(Jt)){const Ot=Object.keys(mt.sources).filter(ye=>!L(Jt).includes(ye));Be(Ni,je({}));for(const ye of Ot)L(Ni)[ye]=mt.sources[ye]}Be(Wi,je(s.style)),g().setStyle(s.style,{diff:C()}),at.loadedImages.clear(),Be(ut,je(new Set))}}),Tt(()=>{if(g()){let mt={};w()!=null&&!Ul(w(),g().getCenter())&&(mt.center=w()),c()!=null&&!Ul(c(),g().getZoom())&&(mt.zoom=c()),q()!=null&&!Ul(q(),g().getBearing())&&(mt.bearing=q()),j()!=null&&!Ul(j(),g().getPitch())&&(mt.pitch=j()),Object.keys(mt).length&&g().easeTo(mt)}}),Tt(()=>{var mt,Ot;K()&&!Ul(K(),(mt=g())==null?void 0:mt.getBounds())&&((Ot=g())==null||Ot.fitBounds(K()))}),Tt(()=>{var mt,Ot;tt()?(mt=g())==null||mt.doubleClickZoom.enable():(Ot=g())==null||Ot.doubleClickZoom.disable()});function zr(){if(N()){let mt=fz(window.location.hash);mt.length>=3&&(c(mt[0]),w([mt[2],mt[1]])),mt.length==5&&(q(mt[3]),j(mt[4]))}}var Vi=bz();Iy("hashchange",Z2,zr);var Ai=Zt(Vi);{var cr=mt=>{var Ot=xz(),ye=Ve(Ot);{var zi=ei=>{var vi=vz(),dn=Ve(vi);_z(dn,{get position(){return L(dt)}});var tn=Qt(dn,2);dz(tn,{get position(){return L(dt)},fitBoundsOptions:{maxZoom:12}});var ur=Qt(tn,2);hz(ur,{get position(){return L(dt)}});var Zn=Qt(ur,2);yz(Zn,{get position(){return L(dt)}}),be(ei,vi)};gi(ye,ei=>{Ge()&&ei(zi)})}var Dr=Qt(ye,2);Bt(Dr,()=>s.children??ii,()=>({map:g(),loadedImages:at.loadedImages,allImagesLoaded:L(zt)})),be(mt,Ot)};gi(Ai,mt=>{g()&&se()&&mt(cr)})}jt(Vi),Cs(Vi,mt=>v(mt),()=>v()),ky(Vi,mt=>qi==null?void 0:qi(mt)),Lt(()=>{cb(Vi,`${T()??""} svelte-p00lfq`),Q2(Vi,"expand-map",!T())}),be(h,Vi),At()}function Sz(h,s){h.key===" "&&(h.preventDefault(),h.stopPropagation(),s("click"))}var Tz=(h,s)=>{h.stopPropagation(),s("click")},Pz=(h,s)=>{h.stopPropagation(),s("dblclick")},Iz=(h,s)=>{h.stopPropagation(),h.preventDefault(),s("contextmenu")},Cz=(h,s)=>s("mousemove"),Az=Et("<div><!></div>");function kz(h,s){Ct(s,!0);let g=ee(s,"marker",15,void 0),v=ee(s,"lngLat",15),T=ee(s,"class",3,void 0),C=ee(s,"interactive",3,!0),w=ee(s,"asButton",3,!1),c=ee(s,"draggable",3,!1),j=ee(s,"feature",3,void 0),q=ee(s,"offset",3,void 0),K=ee(s,"zIndex",3,void 0),N=ee(s,"rotation",3,0),V=ee(s,"opacity",3,1),se=Kt(s,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const ie=Pe(Dp),le=Pe(()=>L(ie).map),fe=Pe(()=>L(ie).markerClickManager),{layerEvent:Se,marker:ge}=lz();function Ee($e){ge.value=new jc.Marker({element:$e,rotation:N(),draggable:c(),offset:q(),opacity:V().toString()}).setLngLat(v()).addTo(L(le)),g(ge.value);const nt=()=>We("dragstart"),Re=()=>{Le(),We("drag")},Me=()=>{Le(),We("dragend")};return c()&&(ge.value.on("dragstart",nt),ge.value.on("drag",Re),ge.value.on("dragend",Me)),{destroy(){var De,Ae,Ge,Xe;c()&&((De=ge.value)==null||De.off("dragstart",nt),(Ae=ge.value)==null||Ae.off("drag",Re),(Ge=ge.value)==null||Ge.off("dragend",Me)),g(void 0),(Xe=ge.value)==null||Xe.remove()}}}function Ne($e,nt){const Re=$e.className;function Me(De){De?$e.className=`${Re} ${De}`:$e.className=Re}return Me(nt),{update:Me}}Tt(()=>{var $e;($e=ge.value)==null||$e.setLngLat(v())}),Tt(()=>{var $e;($e=ge.value)==null||$e.setOffset(q()??[0,0])}),Tt(()=>{var $e;($e=ge.value)==null||$e.setRotation(N())}),Tt(()=>{var $e;($e=ge.value)==null||$e.setOpacity(V().toString())});function Le(){var nt;let $e=(nt=ge.value)==null?void 0:nt.getLngLat();$e&&(Array.isArray(v())?v([$e.lng,$e.lat]):v()&&"lon"in v()?v({lon:$e.lng,lat:$e.lat}):v($e))}function We($e){var Ae,Ge;if(!C())return;let nt=(Ae=ge.value)==null?void 0:Ae.getLngLat();if(!nt)return;const Re=[nt.lng,nt.lat];let Me={map:L(le),marker:ge.value,lngLat:Re,features:[{type:"Feature",properties:((Ge=j())==null?void 0:Ge.properties)??{},geometry:{type:"Point",coordinates:Re}}]};($e==="click"||$e==="contextmenu")&&L(fe).handleClick(Me),Se.value={...Me,layerType:"marker",type:$e};const De=se["on"+$e];De==null||De(Me)}var tt=Az();tt.__click=[Tz,We],tt.__dblclick=[Pz,We],tt.__contextmenu=[Iz,We],tt.__mousemove=[Cz,We],tt.__keydown=[Sz,We];var Pt=Zt(tt);Bt(Pt,()=>s.children??ii,()=>({marker:ge.value})),jt(tt),ky(tt,$e=>Ee==null?void 0:Ee($e)),ky(tt,($e,nt)=>Ne==null?void 0:Ne($e,nt),T),Lt(()=>{Yf(tt,"tabindex",w()?0:void 0),Yf(tt,"role",w()?"button":void 0),eS(tt,"z-index",K())}),Iy("mouseenter",tt,()=>{We("mouseenter")}),Iy("mouseleave",tt,()=>{We("mouseleave")}),be(h,tt),At()}Q0(["click","dblclick","contextmenu","mousemove","keydown"]);var Lp=Uint8Array,bw=Uint16Array,Ez=Int32Array,Mz=new Lp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zz=new Lp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ww=function(h,s){for(var g=new bw(31),v=0;v<31;++v)g[v]=s+=1<<h[v-1];for(var T=new Ez(g[30]),v=1;v<30;++v)for(var C=g[v];C<g[v+1];++C)T[C]=C-g[v]<<5|v;return{b:g,r:T}},Sw=ww(Mz,2),Dz=Sw.b,Lz=Sw.r;Dz[28]=258,Lz[258]=28;ww(zz,0);var Rz=new bw(32768);for(Pi=0;Pi<32768;++Pi)Xs=(Pi&43690)>>1|(Pi&21845)<<1,Xs=(Xs&52428)>>2|(Xs&13107)<<2,Xs=(Xs&61680)>>4|(Xs&3855)<<4,Rz[Pi]=((Xs&65280)>>8|(Xs&255)<<8)>>1;var Xs,Pi,Wg=new Lp(288);for(Pi=0;Pi<144;++Pi)Wg[Pi]=8;var Pi;for(Pi=144;Pi<256;++Pi)Wg[Pi]=9;var Pi;for(Pi=256;Pi<280;++Pi)Wg[Pi]=7;var Pi;for(Pi=280;Pi<288;++Pi)Wg[Pi]=8;var Pi,Oz=new Lp(32);for(Pi=0;Pi<32;++Pi)Oz[Pi]=5;var Pi,Fz=new Lp(0),Bz=typeof TextDecoder<"u"&&new TextDecoder,Nz=0;try{Bz.decode(Fz,{stream:!0}),Nz=1}catch{}var Vz=Et("<!> <!>",1),jz=Et('<!> <span class="mr-auto"><!></span>',1),Uz=Et("<!> <!>",1),qz=Et("<!> <!>",1),Zz=Et("<!> <!>",1),Gz=Et("<!> <!>",1),Wz=Et('<div class="flex flex-col gap-y-2"><!> <!> <!></div>'),Hz=Et("<!> <!>",1),Xz=Et("<!> <!>",1),Kz=Et('<div class="mx-auto w-full max-w-md px-4 pb-6 md:px-0"><!> <!></div>'),$z=Et('<!> <div class="absolute left-1/2 top-2.5 z-10 -translate-x-1/2"><!></div> <!> <!> <!>',1);function lD(h,s){Ct(s,!0);const g=J0(),v=()=>Y0($2,"$mode",g);let T=Je(je(new Date));const C=setInterval(()=>Be(T,je(new Date)),60*1e3);kp(()=>clearInterval(C));let w=Je(!1),c=Je(null);const j=new Pb("campus",""),q=Pe(()=>W0.find(Re=>Re.value===j.current));let K=Je(null);const N=`https://api.maptiler.com/maps/topo-v2/style.json?key=${u0}`,V=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${u0}`,se=Pe(()=>v()==="dark"?V:N);let ie=Je(!1),le=Je(void 0);const fe=Pe(()=>{var Re,Me;return _0(L(le),(Me=(Re=L(q))==null?void 0:Re.metadata)==null?void 0:Me.timezone,L(T))});function Se(Re){Be(ie,!0),Be(le,je(Re))}function ge(){Be(w,!1),Vg().then(()=>{L(c).focus()})}Tt(()=>{var Re;if(L(q)){const Me=(Re=L(q).metadata)==null?void 0:Re.display;L(K).jumpTo({center:L(q).location,zoom:(Me==null?void 0:Me.zoom)??16,pitch:(Me==null?void 0:Me.pitch)??60,bearing:(Me==null?void 0:Me.bearing)??0})}});var Ee=$z();T2(Re=>{Lt(()=>G2.title=jS())});var Ne=Ve(Ee);wz(Ne,{get map(){return L(K)},set map(Re){Be(K,je(Re))},get style(){return L(se)},class:"min-h-screen",standardControls:!0,children:(Re,Me)=>{var De=rt(),Ae=Ve(De);{var Ge=Xe=>{var ft=rt(),dt=Ve(ft);ql(dt,17,()=>L(q).spaces,Zl,(at,ut)=>{kz(at,{get lngLat(){return L(ut).location},class:"cursor-pointer",onclick:()=>Se(L(ut)),children:(Mt,zt)=>{var ri=Pe(()=>{var Jt;return _0(L(ut),(Jt=L(q).metadata)==null?void 0:Jt.timezone,L(T))});dI(Mt,{get status(){return L(ri)}})},$$slots:{default:!0}})}),be(Xe,ft)};gi(Ae,Xe=>{L(q)&&Xe(Ge)})}be(Re,De)},$$slots:{default:!0}});var Le=Qt(Ne,2),We=Zt(Le);ci(We,()=>KM,(Re,Me)=>{Me(Re,{get open(){return L(w)},set open(De){Be(w,je(De))},children:(De,Ae)=>{var Ge=Zz(),Xe=Ve(Ge);ci(Xe,()=>$M,(dt,at)=>{at(dt,{get ref(){return L(c)},set ref(Mt){Be(c,je(Mt))},child:(Mt,zt)=>{Ly(Mt,$t({variant:"outline",class:"w-60 justify-between"},()=>zt==null?void 0:zt().props,{role:"combobox",get"aria-expanded"(){return L(w)},children:(Jt,fi)=>{var Ni=Vz(),Ci=Ve(Ni);{var qi=Vi=>{var Ai=rt(),cr=Ve(Ai);Ay(cr,()=>em(L(q).label,yi()),mt=>{var Ot=en("...");be(mt,Ot)},(mt,Ot)=>{var ye=en();Lt(()=>Gi(ye,L(Ot))),be(mt,ye)},mt=>{var Ot=en();Lt(()=>Gi(Ot,L(q).label)),be(mt,Ot)}),be(Vi,Ai)},Wi=Vi=>{var Ai=en();Lt(()=>Gi(Ai,ZS())),be(Vi,Ai)};gi(Ci,Vi=>{var Ai;(Ai=L(q))!=null&&Ai.label?Vi(qi):Vi(Wi,!1)})}var zr=Qt(Ci,2);TP(zr,{class:"opacity-50"}),be(Jt,Ni)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var ft=Qt(Xe,2);ci(ft,()=>XM,(dt,at)=>{at(dt,{class:"w-60 p-0",children:(ut,Mt)=>{var zt=rt(),ri=Ve(zt);ci(ri,()=>XE,(Jt,fi)=>{fi(Jt,{children:(Ni,Ci)=>{var qi=qz(),Wi=Ve(qi),zr=Pe(()=>HS());ci(Wi,()=>QE,(Ai,cr)=>{cr(Ai,{get placeholder(){return L(zr)}})});var Vi=Qt(Wi,2);ci(Vi,()=>tM,(Ai,cr)=>{cr(Ai,{children:(mt,Ot)=>{var ye=Uz(),zi=Ve(ye);ci(zi,()=>KE,(ei,vi)=>{vi(ei,{children:(dn,tn)=>{ta();var ur=en();Lt(()=>Gi(ur,$S())),be(dn,ur)},$$slots:{default:!0}})});var Dr=Qt(zi,2);ci(Dr,()=>JE,(ei,vi)=>{vi(ei,{children:(dn,tn)=>{var ur=rt(),Zn=Ve(ur);ql(Zn,17,()=>W0,Zl,(Zr,In)=>{var us=rt(),Ke=Ve(us);ci(Ke,()=>eM,(pn,mr)=>{mr(pn,{get value(){return L(In).value},onSelect:()=>{j.current=L(In).value,ge()},children:(fn,Qn)=>{var Ye=jz(),Ht=Ve(Ye),Nt=Pe(()=>Ui(j.current!==L(In).value&&"text-transparent"));SP(Ht,{get class(){return L(Nt)}});var gr=Qt(Ht,2),rn=Zt(gr);Ay(rn,()=>em(L(In).label,yi()),Vt=>{var _r=en("...");be(Vt,_r)},(Vt,_r)=>{var mn=en();Lt(()=>Gi(mn,L(_r))),be(Vt,mn)},Vt=>{var _r=en();Lt(()=>Gi(_r,L(In).label)),be(Vt,_r)}),jt(gr),be(fn,Ye)},$$slots:{default:!0}})}),be(Zr,us)}),be(dn,ur)},$$slots:{default:!0}})}),be(mt,ye)},$$slots:{default:!0}})}),be(Ni,qi)},$$slots:{default:!0}})}),be(ut,zt)},$$slots:{default:!0}})}),be(De,Ge)},$$slots:{default:!0}})}),jt(Le);var tt=Qt(Le,2);UP(tt,{});var Pt=Qt(tt,2);ci(Pt,()=>SI,(Re,Me)=>{Me(Re,{class:"absolute bottom-10 left-2.5 z-10 w-96 max-w-full",children:(De,Ae)=>{var Ge=Hz(),Xe=Ve(Ge);ci(Xe,()=>vI,(dt,at)=>{at(dt,{children:(ut,Mt)=>{var zt=Gz(),ri=Ve(zt);ci(ri,()=>bI,(fi,Ni)=>{Ni(fi,{children:(Ci,qi)=>{ta();var Wi=en();Lt(()=>Gi(Wi,iT())),be(Ci,Wi)},$$slots:{default:!0}})});var Jt=Qt(ri,2);ci(Jt,()=>_I,(fi,Ni)=>{Ni(fi,{children:(Ci,qi)=>{ta();var Wi=en();Lt(()=>Gi(Wi,QS())),be(Ci,Wi)},$$slots:{default:!0}})}),be(ut,zt)},$$slots:{default:!0}})});var ft=Qt(Xe,2);ci(ft,()=>mI,(dt,at)=>{at(dt,{children:(ut,Mt)=>{var zt=Wz(),ri=Zt(zt);Vf(ri,{status:"Open",class:"mr-auto"});var Jt=Qt(ri,2);Vf(Jt,{status:"Closing Soon",class:"mr-auto"});var fi=Qt(Jt,2);Vf(fi,{status:"Closed",class:"mr-auto"}),jt(zt),be(ut,zt)},$$slots:{default:!0}})}),be(De,Ge)},$$slots:{default:!0}})});var $e=Qt(Pt,2);{var nt=Re=>{var Me=rt(),De=Ve(Me);ci(De,()=>HM,(Ae,Ge)=>{Ge(Ae,{get open(){return L(ie)},set open(Xe){Be(ie,je(Xe))},children:(Xe,ft)=>{var dt=rt(),at=Ve(dt);ci(at,()=>UM,(ut,Mt)=>{Mt(ut,{children:(zt,ri)=>{var Jt=Kz(),fi=Zt(Jt);ci(fi,()=>GM,(Ci,qi)=>{qi(Ci,{children:(Wi,zr)=>{var Vi=Xz(),Ai=Ve(Vi);ci(Ai,()=>WM,(mt,Ot)=>{Ot(mt,{children:(ye,zi)=>{ta();var Dr=en();Lt(()=>Gi(Dr,L(le).label)),be(ye,Dr)},$$slots:{default:!0}})});var cr=Qt(Ai,2);ci(cr,()=>qM,(mt,Ot)=>{Ot(mt,{children:(ye,zi)=>{Vf(ye,{get status(){return L(fe)}})},$$slots:{default:!0}})}),be(Wi,Vi)},$$slots:{default:!0}})});var Ni=Qt(fi,2);uI(Ni,{get space(){return L(le)}}),jt(Jt),be(zt,Jt)},$$slots:{default:!0}})}),be(Xe,dt)},$$slots:{default:!0}})}),be(Re,Me)};gi($e,Re=>{L(le)&&Re(nt)})}be(h,Ee),At()}export{lD as component};
