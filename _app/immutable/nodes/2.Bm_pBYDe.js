var j2=Object.defineProperty;var U2=Object.getPrototypeOf;var q2=Reflect.get;var bx=h=>{throw TypeError(h)};var Z2=(h,s,g)=>s in h?j2(h,s,{enumerable:!0,configurable:!0,writable:!0,value:g}):h[s]=g;var Ge=(h,s,g)=>Z2(h,typeof s!="symbol"?s+"":s,g),A_=(h,s,g)=>s.has(h)||bx("Cannot "+g);var I=(h,s,g)=>(A_(h,s,"read from private field"),g?g.call(h):s.get(h)),H=(h,s,g)=>s.has(h)?bx("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(h):s.set(h,g),Ve=(h,s,g,v)=>(A_(h,s,"write to private field"),v?v.call(h,g):s.set(h,g),g),qn=(h,s,g)=>(A_(h,s,"access private method"),g);var rh=(h,s,g,v)=>({set _(T){Ve(h,s,T,g)},get _(){return I(h,s,v)}}),wx=(h,s,g)=>q2(U2(h),g,s);import{e as G2,y as W2,f as Xe,a as ve,g as On,t as Et,z as H2,s as vb,b as xb,p as X2,m as bb,A as H_,v as K2}from"../chunks/stores.S3uHY31j.js";import{$ as $2,ag as J2,aF as Y2,x as jr,j as X_,X as wb,J as Sb,aZ as Q2,a4 as E_,w as hh,O as eS,_ as Sx,k as rm,ab as as,U as Tx,aq as Px,ap as Ix,a_ as Cx,a3 as sm,L as om,R as tS,z as iS,K as nS,g as rS,v as sS,e as kx,h as Ax,y as oS,a$ as dv,a7 as aS,M as lS,C as Oi,N as Tb,G as cS,Z as uS,Q as je,p as Pt,f as Le,a as It,t as zt,af as ti,F as L,I as Te,aE as ia,c as qt,r as Vt,W as Qe,B as Ct,V as ay,ak as jp,b0 as Pb,al as pv,b1 as Ib,b2 as hS,u as dS,aU as Up,s as Wt,aC as pS,b3 as Ex,b4 as fS,b5 as mS,b6 as gS}from"../chunks/entry.C1XatilP.js";import{s as Ri,m as yS,u as Mx}from"../chunks/render.BuOBWXQ7.js";import{p as ie,r as Kt,l as hi,d as Gt,b as fi,a as qe,o as Cb,e as yn,f as _S,i as zx,g as qp}from"../chunks/i18n.CwqKC5kT.js";import{w as la,v as Ot,x as ji,k as kb,y as vS,s as mh,e as Hl,b as Hn,i as Xl,z as xS,g as bS}from"../chunks/mode.C9P36z3k.js";import{b as Vc,c as si}from"../chunks/this.B8EnlnZB.js";import{i as fv}from"../chunks/lifecycle.C-arOSZn.js";const wS=[];function Ab(h,s=!1){return am(h,new Map,"",wS)}function am(h,s,g,v,T=null){if(typeof h=="object"&&h!==null){const b=s.get(h);if(b!==void 0)return b;if(h instanceof Map)return new Map(h);if(h instanceof Set)return new Set(h);if($2(h)){const l=[];s.set(h,l),T!==null&&s.set(T,l);for(let j=0;j<h.length;j+=1)l.push(am(h[j],s,g,v));return l}if(J2(h)===Y2){const l={};s.set(h,l),T!==null&&s.set(T,l);for(var C in h)l[C]=am(h[C],s,g,v);return l}if(h instanceof Date)return structuredClone(h);if(typeof h.toJSON=="function")return am(h.toJSON(),s,g,v,h)}if(h instanceof EventTarget)return h;try{return structuredClone(h)}catch{return h}}const M_=0,Jf=1,z_=2;function lm(h,s,g,v,T){jr&&X_();var C=h,b=wb(),l=iS,j=Sx,U,K,B,V=(b?as:Tx)(void 0),ne=(b?as:Tx)(void 0),Q=!1;function ee(ye,pe){Q=!0,pe&&(Px(ce),Ix(ce),Cx(l));try{ye===M_&&g&&(U?sm(U):U=hh(()=>g(C))),ye===Jf&&v&&(K?sm(K):K=hh(()=>v(C,V))),ye===z_&&T&&(B?sm(B):B=hh(()=>T(C,ne))),ye!==M_&&U&&om(U,()=>U=null),ye!==Jf&&K&&om(K,()=>K=null),ye!==z_&&B&&om(B,()=>B=null)}finally{pe&&(Cx(null),Ix(null),Px(null),tS())}}var ce=Sb(()=>{if(j!==(j=s())){if(Q2(j)){var ye=j;Q=!1,ye.then(pe=>{ye===j&&(E_(V,pe),ee(Jf,!0))},pe=>{if(ye===j&&(E_(ne,pe),ee(z_,!0),!T))throw ne.v}),jr?g&&(U=hh(()=>g(C))):eS(()=>{Q||ee(M_,!0)})}else E_(V,j),ee(Jf,!1);return()=>j=Sx}});jr&&(C=rm)}function Eb(h,s,g,v,T,C){let b=jr;jr&&X_();var l,j,U=null;jr&&rm.nodeType===1&&(U=rm,X_());var K=jr?rm:h,B;Sb(()=>{const V=s()||null;var ne=g||V==="svg"?dv:null;V!==l&&(B&&(V===null?om(B,()=>{B=null,j=null}):V===j?sm(B):aS(B)),V&&V!==j&&(B=hh(()=>{if(U=jr?U:ne?document.createElementNS(ne,V):document.createElement(V),G2(U,U),v){var Q=jr?rS(U):U.appendChild(sS());jr&&(Q===null?kx(!1):Ax(Q)),v(U,Q)}oS.nodes_end=U,K.before(U)})),l=V,l&&(j=l))},nS),b&&(kx(!0),Ax(K))}function K_(h,s,g){lS(()=>{var v=Oi(()=>s(h,g==null?void 0:g())||{});if(g&&(v!=null&&v.update)){var T=!1,C={};Tb(()=>{var b=g();cS(b),T&&uS(C,b)&&(C=b,v.update(b))}),T=!0}if(v!=null&&v.destroy)return()=>v.destroy()})}function Mb(h,s){var g=h.__className,v=SS(s);jr&&h.className===v?h.__className=v:(g!==v||jr&&h.className!==v)&&(s==null?h.removeAttribute("class"):h.className=v,h.__className=v)}function SS(h){return h??""}function TS(h,s,g){if(g){if(h.classList.contains(s))return;h.classList.add(s)}else{if(!h.classList.contains(s))return;h.classList.remove(s)}}function PS(h,s,g,v){var T=h.__styles??(h.__styles={});T[s]!==g&&(T[s]=g,g==null?h.style.removeProperty(s):h.style.setProperty(s,g,""))}function IS(h,s,g=s){var v=wb();W2(h,"input",T=>{var C=T?h.defaultValue:h.value;C=D_(h)?L_(C):C,g(C),v&&C!==(C=s())&&(h.value=C??"")}),(jr&&h.defaultValue!==h.value||Oi(s)==null&&h.value)&&g(D_(h)?L_(h.value):h.value),Tb(()=>{var T=s();D_(h)&&T===L_(h.value)||h.type==="date"&&!T&&!h.value||T!==h.value&&(h.value=T??"")})}function D_(h){var s=h.type;return s==="number"||s==="range"}function L_(h){return h===""?null:+h}function jo(h){je(h,h.v+1)}const CS="https://api.cors.lol/?url=https://portalapi2.uwaterloo.ca/v2/map/OpenClassrooms",kS="https://github.com/mahyarmirrashed/study-spots",Dx="LYsosKTbN7Q5Pq1NzJI1";var Lx=h=>typeof h=="boolean"?`${h}`:h===0?"0":h,Tr=h=>!h||typeof h!="object"||Object.keys(h).length===0,AS=(h,s)=>JSON.stringify(h)===JSON.stringify(s);function zb(h,s){h.forEach(function(g){Array.isArray(g)?zb(g,s):s.push(g)})}function Db(h){let s=[];return zb(h,s),s}var Lb=(...h)=>Db(h).filter(Boolean),Rb=(h,s)=>{let g={},v=Object.keys(h),T=Object.keys(s);for(let C of v)if(T.includes(C)){let b=h[C],l=s[C];Array.isArray(b)||Array.isArray(l)?g[C]=Lb(l,b):typeof b=="object"&&typeof l=="object"?g[C]=Rb(b,l):g[C]=l+" "+b}else g[C]=h[C];for(let C of T)v.includes(C)||(g[C]=s[C]);return g},Rx=h=>!h||typeof h!="string"?h:h.replace(/\s+/g," ").trim();const mv="-",ES=h=>{const s=zS(h),{conflictingClassGroups:g,conflictingClassGroupModifiers:v}=h;return{getClassGroupId:b=>{const l=b.split(mv);return l[0]===""&&l.length!==1&&l.shift(),Ob(l,s)||MS(b)},getConflictingClassGroupIds:(b,l)=>{const j=g[b]||[];return l&&v[b]?[...j,...v[b]]:j}}},Ob=(h,s)=>{var b;if(h.length===0)return s.classGroupId;const g=h[0],v=s.nextPart.get(g),T=v?Ob(h.slice(1),v):void 0;if(T)return T;if(s.validators.length===0)return;const C=h.join(mv);return(b=s.validators.find(({validator:l})=>l(C)))==null?void 0:b.classGroupId},Ox=/^\[(.+)\]$/,MS=h=>{if(Ox.test(h)){const s=Ox.exec(h)[1],g=s==null?void 0:s.substring(0,s.indexOf(":"));if(g)return"arbitrary.."+g}},zS=h=>{const{theme:s,prefix:g}=h,v={nextPart:new Map,validators:[]};return LS(Object.entries(h.classGroups),g).forEach(([C,b])=>{$_(b,v,C,s)}),v},$_=(h,s,g,v)=>{h.forEach(T=>{if(typeof T=="string"){const C=T===""?s:Fx(s,T);C.classGroupId=g;return}if(typeof T=="function"){if(DS(T)){$_(T(v),s,g,v);return}s.validators.push({validator:T,classGroupId:g});return}Object.entries(T).forEach(([C,b])=>{$_(b,Fx(s,C),g,v)})})},Fx=(h,s)=>{let g=h;return s.split(mv).forEach(v=>{g.nextPart.has(v)||g.nextPart.set(v,{nextPart:new Map,validators:[]}),g=g.nextPart.get(v)}),g},DS=h=>h.isThemeGetter,LS=(h,s)=>s?h.map(([g,v])=>{const T=v.map(C=>typeof C=="string"?s+C:typeof C=="object"?Object.fromEntries(Object.entries(C).map(([b,l])=>[s+b,l])):C);return[g,T]}):h,RS=h=>{if(h<1)return{get:()=>{},set:()=>{}};let s=0,g=new Map,v=new Map;const T=(C,b)=>{g.set(C,b),s++,s>h&&(s=0,v=g,g=new Map)};return{get(C){let b=g.get(C);if(b!==void 0)return b;if((b=v.get(C))!==void 0)return T(C,b),b},set(C,b){g.has(C)?g.set(C,b):T(C,b)}}},Fb="!",OS=h=>{const{separator:s,experimentalParseClassName:g}=h,v=s.length===1,T=s[0],C=s.length,b=l=>{const j=[];let U=0,K=0,B;for(let ce=0;ce<l.length;ce++){let ye=l[ce];if(U===0){if(ye===T&&(v||l.slice(ce,ce+C)===s)){j.push(l.slice(K,ce)),K=ce+C;continue}if(ye==="/"){B=ce;continue}}ye==="["?U++:ye==="]"&&U--}const V=j.length===0?l:l.substring(K),ne=V.startsWith(Fb),Q=ne?V.substring(1):V,ee=B&&B>K?B-K:void 0;return{modifiers:j,hasImportantModifier:ne,baseClassName:Q,maybePostfixModifierPosition:ee}};return g?l=>g({className:l,parseClassName:b}):b},FS=h=>{if(h.length<=1)return h;const s=[];let g=[];return h.forEach(v=>{v[0]==="["?(s.push(...g.sort(),v),g=[]):g.push(v)}),s.push(...g.sort()),s},BS=h=>({cache:RS(h.cacheSize),parseClassName:OS(h),...ES(h)}),NS=/\s+/,VS=(h,s)=>{const{parseClassName:g,getClassGroupId:v,getConflictingClassGroupIds:T}=s,C=[],b=h.trim().split(NS);let l="";for(let j=b.length-1;j>=0;j-=1){const U=b[j],{modifiers:K,hasImportantModifier:B,baseClassName:V,maybePostfixModifierPosition:ne}=g(U);let Q=!!ne,ee=v(Q?V.substring(0,ne):V);if(!ee){if(!Q){l=U+(l.length>0?" "+l:l);continue}if(ee=v(V),!ee){l=U+(l.length>0?" "+l:l);continue}Q=!1}const ce=FS(K).join(":"),ye=B?ce+Fb:ce,pe=ye+ee;if(C.includes(pe))continue;C.push(pe);const Ie=T(ee,Q);for(let Oe=0;Oe<Ie.length;++Oe){const ze=Ie[Oe];C.push(ye+ze)}l=U+(l.length>0?" "+l:l)}return l};function jS(){let h=0,s,g,v="";for(;h<arguments.length;)(s=arguments[h++])&&(g=Bb(s))&&(v&&(v+=" "),v+=g);return v}const Bb=h=>{if(typeof h=="string")return h;let s,g="";for(let v=0;v<h.length;v++)h[v]&&(s=Bb(h[v]))&&(g&&(g+=" "),g+=s);return g};function J_(h,...s){let g,v,T,C=b;function b(j){const U=s.reduce((K,B)=>B(K),h());return g=BS(U),v=g.cache.get,T=g.cache.set,C=l,l(j)}function l(j){const U=v(j);if(U)return U;const K=VS(j,g);return T(j,K),K}return function(){return C(jS.apply(null,arguments))}}const Wi=h=>{const s=g=>g[h]||[];return s.isThemeGetter=!0,s},Nb=/^\[(?:([a-z-]+):)?(.+)\]$/i,US=/^\d+\/\d+$/,qS=new Set(["px","full","screen"]),ZS=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,GS=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,WS=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,HS=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,XS=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Xs=h=>Kl(h)||qS.has(h)||US.test(h),Bo=h=>Zc(h,"length",iT),Kl=h=>!!h&&!Number.isNaN(Number(h)),R_=h=>Zc(h,"number",Kl),sh=h=>!!h&&Number.isInteger(Number(h)),KS=h=>h.endsWith("%")&&Kl(h.slice(0,-1)),ri=h=>Nb.test(h),No=h=>ZS.test(h),$S=new Set(["length","size","percentage"]),JS=h=>Zc(h,$S,Vb),YS=h=>Zc(h,"position",Vb),QS=new Set(["image","url"]),eT=h=>Zc(h,QS,rT),tT=h=>Zc(h,"",nT),oh=()=>!0,Zc=(h,s,g)=>{const v=Nb.exec(h);return v?v[1]?typeof s=="string"?v[1]===s:s.has(v[1]):g(v[2]):!1},iT=h=>GS.test(h)&&!WS.test(h),Vb=()=>!1,nT=h=>HS.test(h),rT=h=>XS.test(h),Y_=()=>{const h=Wi("colors"),s=Wi("spacing"),g=Wi("blur"),v=Wi("brightness"),T=Wi("borderColor"),C=Wi("borderRadius"),b=Wi("borderSpacing"),l=Wi("borderWidth"),j=Wi("contrast"),U=Wi("grayscale"),K=Wi("hueRotate"),B=Wi("invert"),V=Wi("gap"),ne=Wi("gradientColorStops"),Q=Wi("gradientColorStopPositions"),ee=Wi("inset"),ce=Wi("margin"),ye=Wi("opacity"),pe=Wi("padding"),Ie=Wi("saturate"),Oe=Wi("scale"),ze=Wi("sepia"),We=Wi("skew"),$e=Wi("space"),xt=Wi("translate"),He=()=>["auto","contain","none"],Ye=()=>["auto","hidden","clip","visible","scroll"],Be=()=>["auto",ri,s],Me=()=>[ri,s],De=()=>["",Xs,Bo],ke=()=>["auto",Kl,ri],Ue=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],et=()=>["solid","dashed","dotted","double","none"],pt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ut=()=>["start","end","center","between","around","evenly","stretch"],ct=()=>["","0",ri],at=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Mt=()=>[Kl,ri];return{cacheSize:500,separator:":",theme:{colors:[oh],spacing:[Xs,Bo],blur:["none","",No,ri],brightness:Mt(),borderColor:[h],borderRadius:["none","","full",No,ri],borderSpacing:Me(),borderWidth:De(),contrast:Mt(),grayscale:ct(),hueRotate:Mt(),invert:ct(),gap:Me(),gradientColorStops:[h],gradientColorStopPositions:[KS,Bo],inset:Be(),margin:Be(),opacity:Mt(),padding:Me(),saturate:Mt(),scale:Mt(),sepia:ct(),skew:Mt(),space:Me(),translate:Me()},classGroups:{aspect:[{aspect:["auto","square","video",ri]}],container:["container"],columns:[{columns:[No]}],"break-after":[{"break-after":at()}],"break-before":[{"break-before":at()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ue(),ri]}],overflow:[{overflow:Ye()}],"overflow-x":[{"overflow-x":Ye()}],"overflow-y":[{"overflow-y":Ye()}],overscroll:[{overscroll:He()}],"overscroll-x":[{"overscroll-x":He()}],"overscroll-y":[{"overscroll-y":He()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ee]}],"inset-x":[{"inset-x":[ee]}],"inset-y":[{"inset-y":[ee]}],start:[{start:[ee]}],end:[{end:[ee]}],top:[{top:[ee]}],right:[{right:[ee]}],bottom:[{bottom:[ee]}],left:[{left:[ee]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",sh,ri]}],basis:[{basis:Be()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ri]}],grow:[{grow:ct()}],shrink:[{shrink:ct()}],order:[{order:["first","last","none",sh,ri]}],"grid-cols":[{"grid-cols":[oh]}],"col-start-end":[{col:["auto",{span:["full",sh,ri]},ri]}],"col-start":[{"col-start":ke()}],"col-end":[{"col-end":ke()}],"grid-rows":[{"grid-rows":[oh]}],"row-start-end":[{row:["auto",{span:[sh,ri]},ri]}],"row-start":[{"row-start":ke()}],"row-end":[{"row-end":ke()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ri]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ri]}],gap:[{gap:[V]}],"gap-x":[{"gap-x":[V]}],"gap-y":[{"gap-y":[V]}],"justify-content":[{justify:["normal",...ut()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ut(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ut(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[pe]}],px:[{px:[pe]}],py:[{py:[pe]}],ps:[{ps:[pe]}],pe:[{pe:[pe]}],pt:[{pt:[pe]}],pr:[{pr:[pe]}],pb:[{pb:[pe]}],pl:[{pl:[pe]}],m:[{m:[ce]}],mx:[{mx:[ce]}],my:[{my:[ce]}],ms:[{ms:[ce]}],me:[{me:[ce]}],mt:[{mt:[ce]}],mr:[{mr:[ce]}],mb:[{mb:[ce]}],ml:[{ml:[ce]}],"space-x":[{"space-x":[$e]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[$e]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ri,s]}],"min-w":[{"min-w":[ri,s,"min","max","fit"]}],"max-w":[{"max-w":[ri,s,"none","full","min","max","fit","prose",{screen:[No]},No]}],h:[{h:[ri,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ri,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ri,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ri,s,"auto","min","max","fit"]}],"font-size":[{text:["base",No,Bo]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",R_]}],"font-family":[{font:[oh]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ri]}],"line-clamp":[{"line-clamp":["none",Kl,R_]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Xs,ri]}],"list-image":[{"list-image":["none",ri]}],"list-style-type":[{list:["none","disc","decimal",ri]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[h]}],"placeholder-opacity":[{"placeholder-opacity":[ye]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[h]}],"text-opacity":[{"text-opacity":[ye]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...et(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Xs,Bo]}],"underline-offset":[{"underline-offset":["auto",Xs,ri]}],"text-decoration-color":[{decoration:[h]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Me()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ri]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ri]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ye]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ue(),YS]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",JS]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},eT]}],"bg-color":[{bg:[h]}],"gradient-from-pos":[{from:[Q]}],"gradient-via-pos":[{via:[Q]}],"gradient-to-pos":[{to:[Q]}],"gradient-from":[{from:[ne]}],"gradient-via":[{via:[ne]}],"gradient-to":[{to:[ne]}],rounded:[{rounded:[C]}],"rounded-s":[{"rounded-s":[C]}],"rounded-e":[{"rounded-e":[C]}],"rounded-t":[{"rounded-t":[C]}],"rounded-r":[{"rounded-r":[C]}],"rounded-b":[{"rounded-b":[C]}],"rounded-l":[{"rounded-l":[C]}],"rounded-ss":[{"rounded-ss":[C]}],"rounded-se":[{"rounded-se":[C]}],"rounded-ee":[{"rounded-ee":[C]}],"rounded-es":[{"rounded-es":[C]}],"rounded-tl":[{"rounded-tl":[C]}],"rounded-tr":[{"rounded-tr":[C]}],"rounded-br":[{"rounded-br":[C]}],"rounded-bl":[{"rounded-bl":[C]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[ye]}],"border-style":[{border:[...et(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ye]}],"divide-style":[{divide:et()}],"border-color":[{border:[T]}],"border-color-x":[{"border-x":[T]}],"border-color-y":[{"border-y":[T]}],"border-color-s":[{"border-s":[T]}],"border-color-e":[{"border-e":[T]}],"border-color-t":[{"border-t":[T]}],"border-color-r":[{"border-r":[T]}],"border-color-b":[{"border-b":[T]}],"border-color-l":[{"border-l":[T]}],"divide-color":[{divide:[T]}],"outline-style":[{outline:["",...et()]}],"outline-offset":[{"outline-offset":[Xs,ri]}],"outline-w":[{outline:[Xs,Bo]}],"outline-color":[{outline:[h]}],"ring-w":[{ring:De()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[h]}],"ring-opacity":[{"ring-opacity":[ye]}],"ring-offset-w":[{"ring-offset":[Xs,Bo]}],"ring-offset-color":[{"ring-offset":[h]}],shadow:[{shadow:["","inner","none",No,tT]}],"shadow-color":[{shadow:[oh]}],opacity:[{opacity:[ye]}],"mix-blend":[{"mix-blend":[...pt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":pt()}],filter:[{filter:["","none"]}],blur:[{blur:[g]}],brightness:[{brightness:[v]}],contrast:[{contrast:[j]}],"drop-shadow":[{"drop-shadow":["","none",No,ri]}],grayscale:[{grayscale:[U]}],"hue-rotate":[{"hue-rotate":[K]}],invert:[{invert:[B]}],saturate:[{saturate:[Ie]}],sepia:[{sepia:[ze]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[g]}],"backdrop-brightness":[{"backdrop-brightness":[v]}],"backdrop-contrast":[{"backdrop-contrast":[j]}],"backdrop-grayscale":[{"backdrop-grayscale":[U]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[K]}],"backdrop-invert":[{"backdrop-invert":[B]}],"backdrop-opacity":[{"backdrop-opacity":[ye]}],"backdrop-saturate":[{"backdrop-saturate":[Ie]}],"backdrop-sepia":[{"backdrop-sepia":[ze]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[b]}],"border-spacing-x":[{"border-spacing-x":[b]}],"border-spacing-y":[{"border-spacing-y":[b]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ri]}],duration:[{duration:Mt()}],ease:[{ease:["linear","in","out","in-out",ri]}],delay:[{delay:Mt()}],animate:[{animate:["none","spin","ping","pulse","bounce",ri]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Oe]}],"scale-x":[{"scale-x":[Oe]}],"scale-y":[{"scale-y":[Oe]}],rotate:[{rotate:[sh,ri]}],"translate-x":[{"translate-x":[xt]}],"translate-y":[{"translate-y":[xt]}],"skew-x":[{"skew-x":[We]}],"skew-y":[{"skew-y":[We]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ri]}],accent:[{accent:["auto",h]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ri]}],"caret-color":[{caret:[h]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Me()}],"scroll-mx":[{"scroll-mx":Me()}],"scroll-my":[{"scroll-my":Me()}],"scroll-ms":[{"scroll-ms":Me()}],"scroll-me":[{"scroll-me":Me()}],"scroll-mt":[{"scroll-mt":Me()}],"scroll-mr":[{"scroll-mr":Me()}],"scroll-mb":[{"scroll-mb":Me()}],"scroll-ml":[{"scroll-ml":Me()}],"scroll-p":[{"scroll-p":Me()}],"scroll-px":[{"scroll-px":Me()}],"scroll-py":[{"scroll-py":Me()}],"scroll-ps":[{"scroll-ps":Me()}],"scroll-pe":[{"scroll-pe":Me()}],"scroll-pt":[{"scroll-pt":Me()}],"scroll-pr":[{"scroll-pr":Me()}],"scroll-pb":[{"scroll-pb":Me()}],"scroll-pl":[{"scroll-pl":Me()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ri]}],fill:[{fill:[h,"none"]}],"stroke-w":[{stroke:[Xs,Bo,R_]}],stroke:[{stroke:[h,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},sT=(h,{cacheSize:s,prefix:g,separator:v,experimentalParseClassName:T,extend:C={},override:b={}})=>{dh(h,"cacheSize",s),dh(h,"prefix",g),dh(h,"separator",v),dh(h,"experimentalParseClassName",T);for(const l in b)oT(h[l],b[l]);for(const l in C)aT(h[l],C[l]);return h},dh=(h,s,g)=>{g!==void 0&&(h[s]=g)},oT=(h,s)=>{if(s)for(const g in s)dh(h,g,s[g])},aT=(h,s)=>{if(s)for(const g in s){const v=s[g];v!==void 0&&(h[g]=(h[g]||[]).concat(v))}},lT=(h,...s)=>typeof h=="function"?J_(Y_,h,...s):J_(()=>sT(Y_(),h),...s),jb=J_(Y_);var cT={twMerge:!0,twMergeConfig:{},responsiveVariants:!1},Ub=h=>h||void 0,gh=(...h)=>Ub(Db(h).filter(Boolean).join(" ")),O_=null,$s={},Q_=!1,ah=(...h)=>s=>s.twMerge?((!O_||Q_)&&(Q_=!1,O_=Tr($s)?jb:lT({...$s,extend:{theme:$s.theme,classGroups:$s.classGroups,conflictingClassGroupModifiers:$s.conflictingClassGroupModifiers,conflictingClassGroups:$s.conflictingClassGroups,...$s.extend}})),Ub(O_(gh(h)))):gh(h),Bx=(h,s)=>{for(let g in s)h.hasOwnProperty(g)?h[g]=gh(h[g],s[g]):h[g]=s[g];return h},qb=(h,s)=>{let{extend:g=null,slots:v={},variants:T={},compoundVariants:C=[],compoundSlots:b=[],defaultVariants:l={}}=h,j={...cT,...s},U=g!=null&&g.base?gh(g.base,h==null?void 0:h.base):h==null?void 0:h.base,K=g!=null&&g.variants&&!Tr(g.variants)?Rb(T,g.variants):T,B=g!=null&&g.defaultVariants&&!Tr(g.defaultVariants)?{...g.defaultVariants,...l}:l;!Tr(j.twMergeConfig)&&!AS(j.twMergeConfig,$s)&&(Q_=!0,$s=j.twMergeConfig);let V=Tr(g==null?void 0:g.slots),ne=Tr(v)?{}:{base:gh(h==null?void 0:h.base,V&&(g==null?void 0:g.base)),...v},Q=V?ne:Bx({...g==null?void 0:g.slots},Tr(ne)?{base:h==null?void 0:h.base}:ne),ee=Tr(g==null?void 0:g.compoundVariants)?C:Lb(g==null?void 0:g.compoundVariants,C),ce=pe=>{if(Tr(K)&&Tr(v)&&V)return ah(U,pe==null?void 0:pe.class,pe==null?void 0:pe.className)(j);if(ee&&!Array.isArray(ee))throw new TypeError(`The "compoundVariants" prop must be an array. Received: ${typeof ee}`);if(b&&!Array.isArray(b))throw new TypeError(`The "compoundSlots" prop must be an array. Received: ${typeof b}`);let Ie=(Me,De,ke=[],Ue)=>{let et=ke;if(typeof De=="string")et=et.concat(Rx(De).split(" ").map(pt=>`${Me}:${pt}`));else if(Array.isArray(De))et=et.concat(De.reduce((pt,ut)=>pt.concat(`${Me}:${ut}`),[]));else if(typeof De=="object"&&typeof Ue=="string"){for(let pt in De)if(De.hasOwnProperty(pt)&&pt===Ue){let ut=De[pt];if(ut&&typeof ut=="string"){let ct=Rx(ut);et[Ue]?et[Ue]=et[Ue].concat(ct.split(" ").map(at=>`${Me}:${at}`)):et[Ue]=ct.split(" ").map(at=>`${Me}:${at}`)}else Array.isArray(ut)&&ut.length>0&&(et[Ue]=ut.reduce((ct,at)=>ct.concat(`${Me}:${at}`),[]))}}return et},Oe=(Me,De=K,ke=null,Ue=null)=>{var et;let pt=De[Me];if(!pt||Tr(pt))return null;let ut=(et=Ue==null?void 0:Ue[Me])!=null?et:pe==null?void 0:pe[Me];if(ut===null)return null;let ct=Lx(ut),at=Array.isArray(j.responsiveVariants)&&j.responsiveVariants.length>0||j.responsiveVariants===!0,Mt=B==null?void 0:B[Me],Yt=[];if(typeof ct=="object"&&at)for(let[Fi,sn]of Object.entries(ct)){let Ui=pt[sn];if(Fi==="initial"){Mt=sn;continue}Array.isArray(j.responsiveVariants)&&!j.responsiveVariants.includes(Fi)||(Yt=Ie(Fi,Ui,Yt,ke))}let yi=ct!=null&&typeof ct!="object"?ct:Lx(Mt),Pi=pt[yi||"false"];return typeof Yt=="object"&&typeof ke=="string"&&Yt[ke]?Bx(Yt,Pi):Yt.length>0?(Yt.push(Pi),ke==="base"?Yt.join(" "):Yt):Pi},ze=()=>K?Object.keys(K).map(Me=>Oe(Me,K)):null,We=(Me,De)=>{if(!K||typeof K!="object")return null;let ke=new Array;for(let Ue in K){let et=Oe(Ue,K,Me,De),pt=Me==="base"&&typeof et=="string"?et:et&&et[Me];pt&&(ke[ke.length]=pt)}return ke},$e={};for(let Me in pe)pe[Me]!==void 0&&($e[Me]=pe[Me]);let xt=(Me,De)=>{var ke;let Ue=typeof(pe==null?void 0:pe[Me])=="object"?{[Me]:(ke=pe[Me])==null?void 0:ke.initial}:{};return{...B,...$e,...Ue,...De}},He=(Me=[],De)=>{let ke=[];for(let{class:Ue,className:et,...pt}of Me){let ut=!0;for(let[ct,at]of Object.entries(pt)){let Mt=xt(ct,De)[ct];if(Array.isArray(at)){if(!at.includes(Mt)){ut=!1;break}}else{let Yt=yi=>yi==null||yi===!1;if(Yt(at)&&Yt(Mt))continue;if(Mt!==at){ut=!1;break}}}ut&&(Ue&&ke.push(Ue),et&&ke.push(et))}return ke},Ye=Me=>{let De=He(ee,Me);if(!Array.isArray(De))return De;let ke={};for(let Ue of De)if(typeof Ue=="string"&&(ke.base=ah(ke.base,Ue)(j)),typeof Ue=="object")for(let[et,pt]of Object.entries(Ue))ke[et]=ah(ke[et],pt)(j);return ke},Be=Me=>{if(b.length<1)return null;let De={};for(let{slots:ke=[],class:Ue,className:et,...pt}of b){if(!Tr(pt)){let ut=!0;for(let ct of Object.keys(pt)){let at=xt(ct,Me)[ct];if(at===void 0||(Array.isArray(pt[ct])?!pt[ct].includes(at):pt[ct]!==at)){ut=!1;break}}if(!ut)continue}for(let ut of ke)De[ut]=De[ut]||[],De[ut].push([Ue,et])}return De};if(!Tr(v)||!V){let Me={};if(typeof Q=="object"&&!Tr(Q))for(let De of Object.keys(Q))Me[De]=ke=>{var Ue,et;return ah(Q[De],We(De,ke),((Ue=Ye(ke))!=null?Ue:[])[De],((et=Be(ke))!=null?et:[])[De],ke==null?void 0:ke.class,ke==null?void 0:ke.className)(j)};return Me}return ah(U,ze(),He(ee),pe==null?void 0:pe.class,pe==null?void 0:pe.className)(j)},ye=()=>{if(!(!K||typeof K!="object"))return Object.keys(K)};return ce.variantKeys=ye(),ce.extend=g,ce.base=U,ce.slots=Q,ce.variants=K,ce.defaultVariants=B,ce.compoundSlots=b,ce.compoundVariants=ee,ce};function Zb(h){var s,g,v="";if(typeof h=="string"||typeof h=="number")v+=h;else if(typeof h=="object")if(Array.isArray(h)){var T=h.length;for(s=0;s<T;s++)h[s]&&(g=Zb(h[s]))&&(v&&(v+=" "),v+=g)}else for(g in h)h[g]&&(v&&(v+=" "),v+=g);return v}function Gb(){for(var h,s,g=0,v="",T=arguments.length;g<T;g++)(h=arguments[g])&&(s=Zb(h))&&(v&&(v+=" "),v+=s);return v}const Nx=30;function Ni(...h){return jb(Gb(h))}function F_(h){const[s,g]=h.split(":").map(Number);return s*60+g}function Vx(h,s,g=new Date){if(h===void 0)return"Closed";if(h.alwaysOpen)return"Open";const v={weekday:"long",hour:"2-digit",minute:"2-digit",hourCycle:"h23"};s&&(v.timeZone=s);const C=new Intl.DateTimeFormat("en-US",v).formatToParts(g);let b,l,j;for(const K of C)K.type==="weekday"?b=K.value.toLowerCase():K.type==="hour"?l=K.value:K.type==="minute"&&(j=K.value);if(!b||!l||!j)throw new Error("Failed to parse current time information.");const U=F_(`${l}:${j}`);for(const K of h.hours[b]||[]){const B=F_(K.open),V=F_(K.close);if(U>=B&&U<V)return V-U<=Nx?"Closing Soon":"Open";if(U<B)return B-U<=Nx?"Opening Soon":"Closed"}return"Closed"}const Yf=qb({base:"focus:ring-ring inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/80 border-transparent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 border-transparent",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/80 border-transparent",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function uT(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=ie(s,"variant",3,"default"),T=Kt(s,["$$slots","$$events","$$legacy","ref","href","class","variant","children"]);const C=la(),[b,l]=C;var j=Xe(),U=Le(j);const K=Te(()=>`${s.href?"a":"span"}`=="button"?l({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"formaction"}]):`${s.href?"a":"span"}`=="form"?l({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"action"}]):`${s.href?"a":"span"}`=="a"?l({href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{href:s.href,class:Ni(Yf({variant:v(),className:s.class})),...T});Eb(U,()=>s.href?"a":"span",!1,(B,V)=>{Vc(B,ce=>g(ce),()=>g());let ne;zt(()=>ne=ji(B,ne,{...L(K)},void 0,B.namespaceURI===dv,B.nodeName.includes("-")));var Q=Xe(),ee=Le(Q);Ot(ee,()=>s.children??ti),ve(V,Q)}),ve(h,j),It()}const hT=()=>"Campus Study Spots",dT=()=>"Lieux d'Étude sur le Campus",pT=(h={},s={})=>({en:hT,fr:dT})[s.languageTag??hi()](),fT=()=>"Select a campus...",mT=()=>"Sélectionner un campus...",gT=(h={},s={})=>({en:fT,fr:mT})[s.languageTag??hi()](),yT=()=>"Search campuses...",_T=()=>"Rechercher des campus...",vT=(h={},s={})=>({en:yT,fr:_T})[s.languageTag??hi()](),xT=()=>"No campus found.",bT=()=>"Aucun campus trouvé.",wT=(h={},s={})=>({en:xT,fr:bT})[s.languageTag??hi()](),ST=()=>"Colors indicate open status of the spaces.",TT=()=>"Les couleurs indiquent le statut ouvert des espaces.",PT=(h={},s={})=>({en:ST,fr:TT})[s.languageTag??hi()](),IT=()=>"Legend",CT=()=>"Légende",kT=(h={},s={})=>({en:IT,fr:CT})[s.languageTag??hi()](),AT=()=>"Toggle theme",ET=()=>"Changer le thème",MT=(h={},s={})=>({en:AT,fr:ET})[s.languageTag??hi()](),zT=()=>"Toggle language",DT=()=>"Changer de langue",LT=(h={},s={})=>({en:zT,fr:DT})[s.languageTag??hi()](),RT=()=>"Visit source",OT=()=>"Visiter la source",FT=(h={},s={})=>({en:RT,fr:OT})[s.languageTag??hi()](),BT=()=>"Get help",NT=()=>"Obtenir de l'aide",VT=(h={},s={})=>({en:BT,fr:NT})[s.languageTag??hi()](),jT=()=>"Open",UT=()=>"Ouvert",qT=(h={},s={})=>({en:jT,fr:UT})[s.languageTag??hi()](),ZT=()=>"Closed",GT=()=>"Fermé",Wb=(h={},s={})=>({en:ZT,fr:GT})[s.languageTag??hi()](),WT=()=>"Opening Soon",HT=()=>"Ouvre bientôt",XT=(h={},s={})=>({en:WT,fr:HT})[s.languageTag??hi()](),KT=()=>"Closing Soon",$T=()=>"Ferme bientôt",JT=(h={},s={})=>({en:KT,fr:$T})[s.languageTag??hi()](),YT=()=>"Included Amenities",QT=()=>"Commodités Incluses",eP=(h={},s={})=>({en:YT,fr:QT})[s.languageTag??hi()](),tP=()=>"Computers",iP=()=>"Ordinateurs",nP=(h={},s={})=>({en:tP,fr:iP})[s.languageTag??hi()](),rP=()=>"Outlets",sP=()=>"Prises",oP=(h={},s={})=>({en:rP,fr:sP})[s.languageTag??hi()](),aP=()=>"Printing",lP=()=>"Impression",cP=(h={},s={})=>({en:aP,fr:lP})[s.languageTag??hi()](),uP=()=>"Rooms",hP=()=>"Salles",dP=(h={},s={})=>({en:uP,fr:hP})[s.languageTag??hi()](),pP=()=>"Water Fountains",fP=()=>"Fontaines d'eau",mP=(h={},s={})=>({en:pP,fr:fP})[s.languageTag??hi()](),gP=()=>"WiFi",yP=()=>"Wi-Fi",_P=(h={},s={})=>({en:gP,fr:yP})[s.languageTag??hi()](),vP=()=>"Google Maps",xP=()=>"Google Maps",bP=(h={},s={})=>({en:vP,fr:xP})[s.languageTag??hi()](),wP=()=>"Directions",SP=()=>"Directions",TP=(h={},s={})=>({en:wP,fr:SP})[s.languageTag??hi()](),PP=()=>"Always Open!",IP=()=>"Toujours ouvert !",CP=(h={},s={})=>({en:PP,fr:IP})[s.languageTag??hi()](),kP=()=>"Hours",AP=()=>"Heures",EP=(h={},s={})=>({en:kP,fr:AP})[s.languageTag??hi()](),MP=()=>"Monday",zP=()=>"Lundi",DP=(h={},s={})=>({en:MP,fr:zP})[s.languageTag??hi()](),LP=()=>"Tuesday",RP=()=>"Mardi",OP=(h={},s={})=>({en:LP,fr:RP})[s.languageTag??hi()](),FP=()=>"Wednesday",BP=()=>"Mercredi",NP=(h={},s={})=>({en:FP,fr:BP})[s.languageTag??hi()](),VP=()=>"Thursday",jP=()=>"Jeudi",UP=(h={},s={})=>({en:VP,fr:jP})[s.languageTag??hi()](),qP=()=>"Friday",ZP=()=>"Vendredi",GP=(h={},s={})=>({en:qP,fr:ZP})[s.languageTag??hi()](),WP=()=>"Saturday",HP=()=>"Samedi",XP=(h={},s={})=>({en:WP,fr:HP})[s.languageTag??hi()](),KP=()=>"Sunday",$P=()=>"Dimanche",JP=(h={},s={})=>({en:KP,fr:$P})[s.languageTag??hi()]();function cm(h,s){Pt(s,!0);let g=Kt(s,["$$slots","$$events","$$legacy","status","class"]);const v={Open:qT(),Closed:Wb(),"Opening Soon":XT(),"Closing Soon":JT()},T={Open:"bg-green-400 hover:bg-green-500",Closed:"bg-red-400 hover:bg-red-500","Opening Soon":"bg-yellow-400 hover:bg-yellow-500","Closing Soon":"bg-yellow-400 hover:bg-yellow-500"};var C=Te(()=>Ni(T[s.status],"border-transparent",s.class));uT(h,Gt({get class(){return L(C)}},()=>g,{children:(b,l)=>{ia();var j=On();zt(()=>Ri(j,v[s.status])),ve(b,j)},$$slots:{default:!0}})),It()}const ev=qb({base:"ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border-input bg-background hover:bg-accent hover:text-accent-foreground border",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}});var YP=Et("<a><!></a>"),QP=Et("<button><!></button>");function um(h,s){Pt(s,!0);let g=ie(s,"variant",3,"default"),v=ie(s,"size",3,"default"),T=ie(s,"ref",15,null),C=ie(s,"href",3,void 0),b=ie(s,"type",3,"button"),l=Kt(s,["$$slots","$$events","$$legacy","class","variant","size","ref","href","type","children"]);const j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var ne=ee=>{var ce=YP();const ye=Te(()=>K({class:Ni(ev({variant:g(),size:v(),className:s.class})),href:C(),...l},[{attribute_name:"href",lang_attribute_name:"hreflang"}]));let pe;var Ie=qt(ce);Ot(Ie,()=>s.children??ti),Vt(ce),Vc(ce,Oe=>T(Oe),()=>T()),zt(()=>pe=ji(ce,pe,{...L(ye)})),ve(ee,ce)},Q=ee=>{var ce=QP();const ye=Te(()=>K({class:Ni(ev({variant:g(),size:v(),className:s.class})),type:b(),...l},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ce);Ot(Ie,()=>s.children??ti),Vt(ce),Vc(ce,Oe=>T(Oe),()=>T()),zt(()=>pe=ji(ce,pe,{...L(ye)})),ve(ee,ce)};fi(V,ee=>{C()?ee(ne):ee(Q,!1)})}ve(h,B),It()}function eI(h){return typeof h=="function"}function tI(h){return h!==null&&typeof h=="object"}const yh=Symbol("box"),gv=Symbol("is-writable");function iI(h){return tI(h)&&yh in h}function nI(h){return Pe.isBox(h)&&gv in h}function Pe(h){let s=Qe(qe(h));return{[yh]:!0,[gv]:!0,get current(){return L(s)},set current(g){je(s,qe(g))}}}function rI(h,s){const g=Te(h);return s?{[yh]:!0,[gv]:!0,get current(){return L(g)},set current(v){s(v)}}:{[yh]:!0,get current(){return h()}}}function sI(h){return Pe.isBox(h)?h:eI(h)?Pe.with(h):Pe(h)}function oI(h){return Object.entries(h).reduce((s,[g,v])=>Pe.isBox(v)?(Pe.isWritableBox(v)?Object.defineProperty(s,g,{get(){return v.current},set(T){v.current=T}}):Object.defineProperty(s,g,{get(){return v.current}}),s):Object.assign(s,{[g]:v}),{})}function aI(h){return Pe.isWritableBox(h)?{[yh]:!0,get current(){return h.current}}:h}Pe.from=sI;Pe.with=rI;Pe.flatten=oI;Pe.readonly=aI;Pe.isBox=iI;Pe.isWritableBox=nI;function Hb(...h){return function(s){var g;for(const v of h)if(v){if(s.defaultPrevented)return;typeof v=="function"?v.call(this,s):(g=v.current)==null||g.call(this,s)}}}function Xb(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Gl={},B_,jx;function lI(){if(jx)return B_;jx=1;var h=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,s=/\n/g,g=/^\s*/,v=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,T=/^:\s*/,C=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,b=/^[;\s]*/,l=/^\s+|\s+$/g,j=`
`,U="/",K="*",B="",V="comment",ne="declaration";B_=function(ee,ce){if(typeof ee!="string")throw new TypeError("First argument must be a string");if(!ee)return[];ce=ce||{};var ye=1,pe=1;function Ie(De){var ke=De.match(s);ke&&(ye+=ke.length);var Ue=De.lastIndexOf(j);pe=~Ue?De.length-Ue:pe+De.length}function Oe(){var De={line:ye,column:pe};return function(ke){return ke.position=new ze(De),xt(),ke}}function ze(De){this.start=De,this.end={line:ye,column:pe},this.source=ce.source}ze.prototype.content=ee;function We(De){var ke=new Error(ce.source+":"+ye+":"+pe+": "+De);if(ke.reason=De,ke.filename=ce.source,ke.line=ye,ke.column=pe,ke.source=ee,!ce.silent)throw ke}function $e(De){var ke=De.exec(ee);if(ke){var Ue=ke[0];return Ie(Ue),ee=ee.slice(Ue.length),ke}}function xt(){$e(g)}function He(De){var ke;for(De=De||[];ke=Ye();)ke!==!1&&De.push(ke);return De}function Ye(){var De=Oe();if(!(U!=ee.charAt(0)||K!=ee.charAt(1))){for(var ke=2;B!=ee.charAt(ke)&&(K!=ee.charAt(ke)||U!=ee.charAt(ke+1));)++ke;if(ke+=2,B===ee.charAt(ke-1))return We("End of comment missing");var Ue=ee.slice(2,ke-2);return pe+=2,Ie(Ue),ee=ee.slice(ke),pe+=2,De({type:V,comment:Ue})}}function Be(){var De=Oe(),ke=$e(v);if(ke){if(Ye(),!$e(T))return We("property missing ':'");var Ue=$e(C),et=De({type:ne,property:Q(ke[0].replace(h,B)),value:Ue?Q(Ue[0].replace(h,B)):B});return $e(b),et}}function Me(){var De=[];He(De);for(var ke;ke=Be();)ke!==!1&&(De.push(ke),He(De));return De}return xt(),Me()};function Q(ee){return ee?ee.replace(l,B):B}return B_}var Ux;function cI(){if(Ux)return Gl;Ux=1;var h=Gl&&Gl.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(Gl,"__esModule",{value:!0}),Gl.default=g;var s=h(lI());function g(v,T){var C=null;if(!v||typeof v!="string")return C;var b=(0,s.default)(v),l=typeof T=="function";return b.forEach(function(j){if(j.type==="declaration"){var U=j.property,K=j.value;l?T(U,K,j):K&&(C=C||{},C[U]=K)}}),C}return Gl}var uI=cI();const qx=Xb(uI),hI=qx.default||qx,dI=/\d/,pI=["-","_","/","."];function fI(h=""){if(!dI.test(h))return h!==h.toLowerCase()}function mI(h){const s=[];let g="",v,T;for(const C of h){const b=pI.includes(C);if(b===!0){s.push(g),g="",v=void 0;continue}const l=fI(C);if(T===!1){if(v===!1&&l===!0){s.push(g),g=C,v=l;continue}if(v===!0&&l===!1&&g.length>1){const j=g.at(-1);s.push(g.slice(0,Math.max(0,g.length-1))),g=j+C,v=l;continue}}g+=C,v=l,T=b}return s.push(g),s}function Kb(h){return h?mI(h).map(s=>yI(s)).join(""):""}function gI(h){return _I(Kb(h||""))}function yI(h){return h?h[0].toUpperCase()+h.slice(1):""}function _I(h){return h?h[0].toLowerCase()+h.slice(1):""}function ph(h){if(!h)return{};const s={};function g(v,T){if(v.startsWith("-moz-")||v.startsWith("-webkit-")||v.startsWith("-ms-")||v.startsWith("-o-")){s[Kb(v)]=T;return}if(v.startsWith("--")){s[v]=T;return}s[gI(v)]=T}return hI(h,g),s}function $l(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function vI(h,s){const g=RegExp(h,"g");return v=>{if(typeof v!="string")throw new TypeError(`expected an argument of type string, but got ${typeof v}`);return v.match(g)?v.replace(g,s):v}}const xI=vI(/[A-Z]/,h=>`-${h.toLowerCase()}`);function bI(h){if(!h||typeof h!="object"||Array.isArray(h))throw new TypeError(`expected an argument of type object, but got ${typeof h}`);return Object.keys(h).map(s=>`${xI(s)}: ${h[s]};`).join(`
`)}function yv(h={}){return bI(h).replace(`
`," ")}const $b={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",transform:"translateX(-100%)"};yv($b);function wI(h){var s;return h.length>2&&h.startsWith("on")&&h[2]===((s=h[2])==null?void 0:s.toLowerCase())}function Vi(...h){const s={...h[0]};for(let g=1;g<h.length;g++){const v=h[g];for(const T in v){const C=s[T],b=v[T],l=typeof C=="function",j=typeof b=="function";if(l&&wI(T)){const U=C,K=b;s[T]=Hb(U,K)}else if(l&&j)s[T]=$l(C,b);else if(T==="class"&&typeof C=="string"&&typeof b=="string")s[T]=Gb(C,b);else if(T==="style"){const U=typeof C=="object",K=typeof b=="object",B=typeof C=="string",V=typeof b=="string";if(U&&K)s[T]={...C,...b};else if(U&&V){const ne=ph(b);s[T]={...C,...ne}}else if(B&&K){const ne=ph(C);s[T]={...ne,...b}}else if(B&&V){const ne=ph(C),Q=ph(b);s[T]={...ne,...Q}}else U?s[T]=C:K&&(s[T]=b)}else s[T]=b!==void 0?b:C}}return typeof s.style=="object"&&(s.style=yv(s.style).replaceAll(`
`," ")),s.hidden!==!0&&(s.hidden=void 0),s.disabled!==!0&&(s.disabled=void 0),s}function rn({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{},getRootNode:T=()=>typeof document<"u"?document:void 0}){const C=Te(()=>g()),b=Te(()=>T());Ct(()=>(h.current,L(C),L(b),Oi(()=>{var j;const l=(j=L(b))==null?void 0:j.getElementById(h.current);l?s.current=l:s.current=null,v(s.current)}))),Ct(()=>()=>{s.current=null,v(null)})}function SI(h){Ct(()=>()=>{h()})}function Zp(h,s){setTimeout(s,h)}function jc(h){ay().then(h)}function _v(h){return h?"open":"closed"}function TI(h){return h?"true":"false"}function vv(h){return h?"true":"false"}function PI(h){return h?"":void 0}function II(h){return h?"true":"false"}function CI(h){return h?"":void 0}const kI="ArrowDown",AI="ArrowUp",EI="End",ly="Enter",MI="Escape",zI="Home",xv=" ",DI="Tab",LI="p",RI="n",OI="j",FI="k",bv=typeof document<"u",Zx=BI();function BI(){var h,s;return bv&&((h=window==null?void 0:window.navigator)==null?void 0:h.userAgent)&&(/iP(ad|hone|od)/.test(window.navigator.userAgent)||((s=window==null?void 0:window.navigator)==null?void 0:s.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function pm(h){return h instanceof HTMLElement}function NI(h){return h instanceof Element}function VI(h){return h!==null}function jI(h){return h instanceof HTMLInputElement&&"select"in h}function UI(h,s){if(getComputedStyle(h).visibility==="hidden")return!0;for(;h;){if(s!==void 0&&h===s)return!1;if(getComputedStyle(h).display==="none")return!0;h=h.parentElement}return!1}function Gx(h,s){return jp(h,s)}function qI(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!Pb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return pv(h)}function ZI(h,s){return typeof h=="string"&&s===void 0?`${h}Context`:Array.isArray(h)&&s===void 0?`${h[0]}Context`:`${h}Context`}function $a(h,s,g=!0){const v=ZI(h,s),T=Symbol.for(`bits-ui.${v}`),C=v;function b(j){const U=qI(g?T:C,j);if(U===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return U}function l(j){return Gx(g?T:C,j)}return[l,b]}let Wx=0;function hn(h="bits"){return Wx++,`${h}-${Wx}`}function nn(){}var Yl,xh,Uo,Fa,oa,tv,iv,_b;let GI=(_b=class{constructor(s,g){H(this,oa);H(this,Yl,Qe());H(this,xh);H(this,Uo,0);H(this,Fa,null);I(this,Yl).v=qe(s),Ve(this,xh,g)}get current(){return Ib()?Ct(()=>(rh(this,Uo)._++,I(this,Uo)===1&&qn(this,oa,tv).call(this,!0),()=>{ay().then(()=>{rh(this,Uo)._--,I(this,Uo)===0&&qn(this,oa,iv).call(this)})})):I(this,Uo)===0&&(qn(this,oa,tv).call(this,!1),qn(this,oa,iv).call(this)),L(I(this,Yl))}},Yl=new WeakMap,xh=new WeakMap,Uo=new WeakMap,Fa=new WeakMap,oa=new WeakSet,tv=function(s){Ve(this,Fa,I(this,xh).call(this,g=>{je(I(this,Yl),qe(g))},s)??null)},iv=function(){I(this,Fa)!==null&&(I(this,Fa).call(this),Ve(this,Fa,null))},_b);new GI(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function WI(h){return typeof h=="function"}function HI(h){return WI(h)?h():h}var qo;class XI{constructor(s,g={box:"border-box"}){H(this,qo,Qe(qe({width:0,height:0})));var v,T;I(this,qo).v=qe({width:((v=g.initialSize)==null?void 0:v.width)??0,height:((T=g.initialSize)==null?void 0:T.height)??0}),Ct(()=>{const C=HI(s);if(!C)return;const b=new ResizeObserver(l=>{for(const j of l){const U=g.box==="content-box"?j.contentBoxSize:j.borderBoxSize,K=Array.isArray(U)?U:[U];L(I(this,qo)).width=K.reduce((B,V)=>Math.max(B,V.inlineSize),0),L(I(this,qo)).height=K.reduce((B,V)=>Math.max(B,V.blockSize),0)}});return b.observe(C),()=>{b.disconnect()}})}get width(){return L(I(this,qo)).width}get height(){return L(I(this,qo)).height}}qo=new WeakMap;var bh,wh;class KI{constructor(s){H(this,bh,Qe());H(this,wh);Ct(()=>{je(I(this,bh),qe(I(this,wh))),Ve(this,wh,s())})}get current(){return L(I(this,bh))}}bh=new WeakMap,wh=new WeakMap;function $I(h,s){const g=Pe(h);function v(C){return s[g.current][C]??g.current}return{state:g,dispatch:C=>{g.current=v(C)}}}function JI(h,s){let g=Qe(qe({})),v=Qe("none");const T=h.current?"mounted":"unmounted";let C=Qe(null);const b=new KI(()=>h.current);Ct(()=>{s.current&&h.current&&jc(()=>{je(C,qe(document.getElementById(s.current)))})});const{state:l,dispatch:j}=$I(T,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});Ct(()=>{const V=h.current;Oi(()=>{if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C)||!(V!==b.current))return;const Q=L(v),ee=Qf(L(C));V?j("MOUNT"):ee==="none"||L(g).display==="none"?j("UNMOUNT"):j(b&&Q!==ee?"ANIMATION_OUT":"UNMOUNT")})});function U(V){if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C))return;const ne=Qf(L(C)),Q=ne.includes(V.animationName)||ne==="none";V.target===L(C)&&Q&&j("ANIMATION_END")}function K(V){L(C)||je(C,qe(document.getElementById(s.current))),L(C)&&V.target===L(C)&&je(v,qe(Qf(L(C))))}Ct(()=>{l.current,Oi(()=>{if(L(C)||je(C,qe(document.getElementById(s.current))),!L(C))return;const V=Qf(L(C));je(v,qe(l.current==="mounted"?V:"none"))})}),Ct(()=>{if(L(C))return je(g,qe(getComputedStyle(L(C)))),L(C).addEventListener("animationstart",K),L(C).addEventListener("animationcancel",U),L(C).addEventListener("animationend",U),()=>{var V,ne,Q;(V=L(C))==null||V.removeEventListener("animationstart",K),(ne=L(C))==null||ne.removeEventListener("animationcancel",U),(Q=L(C))==null||Q.removeEventListener("animationend",U)}});const B=Te(()=>["mounted","unmountSuspended"].includes(l.current));return{get current(){return L(B)}}}function Qf(h){return h&&getComputedStyle(h).animationName||"none"}function wv(h,s){Pt(s,!0);const g=JI(Pe.with(()=>s.present),Pe.with(()=>s.id));var v=Xe(),T=Le(v);{var C=b=>{var l=Xe(),j=Le(l);Ot(j,()=>s.presence??ti,()=>({present:g})),ve(b,l)};fi(T,b=>{(s.forceMount||s.present||g.current)&&b(C)})}ve(h,v),It()}function YI(h){return{content:`data-${h}-content`,trigger:`data-${h}-trigger`,overlay:`data-${h}-overlay`,title:`data-${h}-title`,description:`data-${h}-description`,close:`data-${h}-close`,cancel:`data-${h}-cancel`,action:`data-${h}-action`}}var Sh,Th,Ph,Ih,Ch,kh,Ah,Eh,Mh,vm,xm;class QI{constructor(s){Ge(this,"open");Ge(this,"variant");H(this,Sh,Qe(null));H(this,Th,Qe(null));H(this,Ph,Qe(null));H(this,Ih,Qe(null));H(this,Ch,Qe(void 0));H(this,kh,Qe(void 0));H(this,Ah,Qe(void 0));H(this,Eh,Qe(void 0));H(this,Mh,Qe(null));H(this,vm,Te(()=>YI(this.variant.current)));Ge(this,"handleOpen",()=>{this.open.current||(this.open.current=!0)});Ge(this,"handleClose",()=>{this.open.current&&(this.open.current=!1)});H(this,xm,Te(()=>({"data-state":_v(this.open.current)})));this.open=s.open,this.variant=s.variant}get triggerNode(){return L(I(this,Sh))}set triggerNode(s){je(I(this,Sh),qe(s))}get titleNode(){return L(I(this,Th))}set titleNode(s){je(I(this,Th),qe(s))}get contentNode(){return L(I(this,Ph))}set contentNode(s){je(I(this,Ph),qe(s))}get descriptionNode(){return L(I(this,Ih))}set descriptionNode(s){je(I(this,Ih),qe(s))}get contentId(){return L(I(this,Ch))}set contentId(s){je(I(this,Ch),qe(s))}get titleId(){return L(I(this,kh))}set titleId(s){je(I(this,kh),qe(s))}get triggerId(){return L(I(this,Ah))}set triggerId(s){je(I(this,Ah),qe(s))}get descriptionId(){return L(I(this,Eh))}set descriptionId(s){je(I(this,Eh),qe(s))}get cancelNode(){return L(I(this,Mh))}set cancelNode(s){je(I(this,Mh),qe(s))}get attrs(){return L(I(this,vm))}get sharedProps(){return L(I(this,xm))}}Sh=new WeakMap,Th=new WeakMap,Ph=new WeakMap,Ih=new WeakMap,Ch=new WeakMap,kh=new WeakMap,Ah=new WeakMap,Eh=new WeakMap,Mh=new WeakMap,vm=new WeakMap,xm=new WeakMap;var Ql,zh,Nr,Ba,bm,wm,Sm,Tm;class eC{constructor(s,g){H(this,Ql);H(this,zh);H(this,Nr);H(this,Ba);H(this,bm,s=>{I(this,Ba).current||s.button>0||I(this,Nr).handleOpen()});H(this,wm,s=>{if(!I(this,Ba).current){if(s.pointerType==="touch")return s.preventDefault();s.button>0||(s.preventDefault(),I(this,Nr).handleOpen())}});H(this,Sm,s=>{I(this,Ba).current||(s.key===xv||s.key===ly)&&(s.preventDefault(),I(this,Nr).handleOpen())});H(this,Tm,Te(()=>({id:I(this,Ql).current,"aria-haspopup":"dialog","aria-expanded":vv(I(this,Nr).open.current),"aria-controls":I(this,Nr).contentId,[I(this,Nr).attrs.trigger]:"",onpointerdown:I(this,wm),onkeydown:I(this,Sm),onclick:I(this,bm),...I(this,Nr).sharedProps})));Ve(this,Ql,s.id),Ve(this,Nr,g),Ve(this,zh,s.ref),Ve(this,Ba,s.disabled),rn({id:I(this,Ql),ref:I(this,zh),onRefChange:v=>{I(this,Nr).triggerNode=v,I(this,Nr).triggerId=v==null?void 0:v.id}})}get props(){return L(I(this,Tm))}}Ql=new WeakMap,zh=new WeakMap,Nr=new WeakMap,Ba=new WeakMap,bm=new WeakMap,wm=new WeakMap,Sm=new WeakMap,Tm=new WeakMap;var ec,Dh,xs,Lh,Na,Pm,Im,Cm,km,Am;class tC{constructor(s,g){H(this,ec);H(this,Dh);H(this,xs);H(this,Lh);H(this,Na);H(this,Pm,Te(()=>I(this,xs).attrs[I(this,Lh).current]));H(this,Im,s=>{I(this,Na).current||s.button>0||I(this,xs).handleClose()});H(this,Cm,s=>{if(!I(this,Na).current){if(s.pointerType==="touch")return s.preventDefault();s.button>0||(s.preventDefault(),I(this,xs).handleClose())}});H(this,km,s=>{I(this,Na).current||(s.key===xv||s.key===ly)&&(s.preventDefault(),I(this,xs).handleClose())});H(this,Am,Te(()=>({id:I(this,ec).current,[L(I(this,Pm))]:"",onpointerdown:I(this,Cm),onclick:I(this,Im),onkeydown:I(this,km),...I(this,xs).sharedProps})));Ve(this,xs,g),Ve(this,Dh,s.ref),Ve(this,ec,s.id),Ve(this,Lh,s.variant),Ve(this,Na,s.disabled),rn({id:I(this,ec),ref:I(this,Dh),deps:()=>I(this,xs).open.current})}get props(){return L(I(this,Am))}}ec=new WeakMap,Dh=new WeakMap,xs=new WeakMap,Lh=new WeakMap,Na=new WeakMap,Pm=new WeakMap,Im=new WeakMap,Cm=new WeakMap,km=new WeakMap,Am=new WeakMap;var tc,Rh,Js,Oh,Em;class iC{constructor(s,g){H(this,tc);H(this,Rh);H(this,Js);H(this,Oh);H(this,Em,Te(()=>({id:I(this,tc).current,role:"heading","aria-level":I(this,Oh).current,[I(this,Js).attrs.title]:"",...I(this,Js).sharedProps})));Ve(this,tc,s.id),Ve(this,Js,g),Ve(this,Rh,s.ref),Ve(this,Oh,s.level),rn({id:I(this,tc),ref:I(this,Rh),onRefChange:v=>{I(this,Js).titleNode=v,I(this,Js).titleId=v==null?void 0:v.id},deps:()=>I(this,Js).open.current})}get props(){return L(I(this,Em))}}tc=new WeakMap,Rh=new WeakMap,Js=new WeakMap,Oh=new WeakMap,Em=new WeakMap;var ic,Fh,Ys,Mm;class nC{constructor(s,g){H(this,ic);H(this,Fh);H(this,Ys);H(this,Mm,Te(()=>({id:I(this,ic).current,[I(this,Ys).attrs.description]:"",...I(this,Ys).sharedProps})));Ve(this,ic,s.id),Ve(this,Ys,g),Ve(this,Fh,s.ref),rn({id:I(this,ic),ref:I(this,Fh),deps:()=>I(this,Ys).open.current,onRefChange:v=>{I(this,Ys).descriptionNode=v,I(this,Ys).descriptionId=v==null?void 0:v.id}})}get props(){return L(I(this,Mm))}}ic=new WeakMap,Fh=new WeakMap,Ys=new WeakMap,Mm=new WeakMap;var nc,Bh,zm,Dm;class rC{constructor(s,g){H(this,nc);H(this,Bh);Ge(this,"root");H(this,zm,Te(()=>({open:this.root.open.current})));H(this,Dm,Te(()=>({id:I(this,nc).current,role:this.root.variant.current==="alert-dialog"?"alertdialog":"dialog","aria-describedby":this.root.descriptionId,"aria-labelledby":this.root.titleId,[this.root.attrs.content]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ve(this,nc,s.id),this.root=g,Ve(this,Bh,s.ref),rn({id:I(this,nc),ref:I(this,Bh),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,zm))}get props(){return L(I(this,Dm))}}nc=new WeakMap,Bh=new WeakMap,zm=new WeakMap,Dm=new WeakMap;var rc,Nh,Lm,Rm;class sC{constructor(s,g){H(this,rc);H(this,Nh);Ge(this,"root");H(this,Lm,Te(()=>({open:this.root.open.current})));H(this,Rm,Te(()=>({id:I(this,rc).current,[this.root.attrs.overlay]:"",style:{pointerEvents:"auto"},...this.root.sharedProps})));Ve(this,rc,s.id),Ve(this,Nh,s.ref),this.root=g,rn({id:I(this,rc),ref:I(this,Nh),deps:()=>this.root.open.current})}get snippetProps(){return L(I(this,Lm))}get props(){return L(I(this,Rm))}}rc=new WeakMap,Nh=new WeakMap,Lm=new WeakMap,Rm=new WeakMap;const[oC,Gc]=$a("Dialog.Root");function aC(h){return oC(new QI(h))}function lC(h){const s=Gc();return new eC(h,s)}function cC(h){return new iC(h,Gc())}function uC(h){return new rC(h,Gc())}function hC(h){return new sC(h,Gc())}function dC(h){return new nC(h,Gc())}function pC(h){return new tC(h,Gc())}var fC=Et("<div><!></div>");function Jb(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"level",3,2),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","level"]);const b=cC({id:Pe.with(()=>g()),level:Pe.with(()=>T()),ref:Pe.with(()=>v(),V=>v(V))}),l=Te(()=>Vi(C,b.props));var j=Xe(),U=Le(j);{var K=V=>{var ne=Xe(),Q=Le(ne);Ot(Q,()=>s.child,()=>({props:L(l)})),ve(V,ne)},B=V=>{var ne=fC();let Q;var ee=qt(ne);Ot(ee,()=>s.children??ti),Vt(ne),zt(()=>Q=ji(ne,Q,{...L(l)})),ve(V,ne)};fi(U,V=>{s.child?V(K):V(B,!1)})}ve(h,j),It()}function mC(h,s){Pt(s,!0);var g=Xe(),v=Le(g);kb(v,()=>s.children,T=>{var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),ve(T,C)}),ve(h,g),It()}function Sv(h,s){Pt(s,!0);let g=ie(s,"to",3,"body");const v=hS();let T=Te(C);function C(){if(!bv||s.disabled)return null;let K=null;return typeof g()=="string"?K=document.querySelector(g()):(g()instanceof HTMLElement||g()instanceof DocumentFragment)&&(K=g()),K}let b;Ct(()=>{if(!L(T)||s.disabled){b&&(Mx(b),b=null);return}return Oi(()=>b=yS(mC,{target:L(T),props:{children:s.children},context:v})),()=>{b&&(Mx(b),b=null)}});var l=Xe(),j=Le(l);{var U=K=>{var B=Xe(),V=Le(B);Ot(V,()=>s.children??ti),ve(K,B)};fi(j,K=>{s.disabled&&K(U)})}ve(h,l),It()}function Is(h,s,g,v){const T=Array.isArray(s)?s:[s];return T.forEach(C=>h.addEventListener(C,g,v)),()=>{T.forEach(C=>h.removeEventListener(C,g,v))}}function Hx(h,s=500){let g=null;const v=(...T)=>{g!==null&&clearTimeout(g),g=setTimeout(()=>{h(...T)},s)};return v.destroy=()=>{g!==null&&(clearTimeout(g),g=null)},v}function Tv(h,s){return h===s||h.contains(s)}function Yb(h){return(h==null?void 0:h.ownerDocument)??document}globalThis.bitsDismissableLayers??(globalThis.bitsDismissableLayers=new Map);var sc,Va,Zo,oc,Go,ac,lc,Vh,jh,Uh,Qs,Om,qc,Qb,Fm,cc,Bm,Nm,Vm,jm,qh,e1,Um,qm;class gC{constructor(s){H(this,qc);H(this,sc);H(this,Va);H(this,Zo,{pointerdown:!1});H(this,oc,!1);Ge(this,"node",Pe(null));H(this,Go);H(this,ac);H(this,lc,Qe(!1));H(this,Vh);H(this,jh,Qe(null));H(this,Uh);H(this,Qs,nn);H(this,Om,s=>{s.defaultPrevented||this.currNode&&jc(()=>{var g,v;!this.currNode||I(this,jm).call(this,s.target)||s.target&&!L(I(this,lc))&&((v=(g=I(this,Vh)).current)==null||v.call(g,s))})});H(this,Fm,s=>{let g=s;g.defaultPrevented&&(g=Xx(s)),I(this,sc).current(s)});H(this,cc,Hx(s=>{if(!this.currNode){I(this,Qs).call(this);return}const g=I(this,Uh).current(s,this.currNode)||xC(s,this.currNode);if(!I(this,oc)||qn(this,qc,e1).call(this)||!g){I(this,Qs).call(this);return}let v=s;if(v.defaultPrevented&&(v=Xx(v)),I(this,Va).current!=="close"&&I(this,Va).current!=="defer-otherwise-close"){I(this,Qs).call(this);return}s.pointerType==="touch"?(I(this,Qs).call(this),Ve(this,Qs,Is(I(this,Go),"click",I(this,Fm),{once:!0}))):I(this,sc).current(v)},10));H(this,Bm,s=>{I(this,Zo)[s.type]=!0});H(this,Nm,s=>{I(this,Zo)[s.type]=!1});H(this,Vm,()=>{this.node.current&&Ve(this,oc,vC(this.node.current))});H(this,jm,s=>this.node.current?Tv(this.node.current,s):!1);H(this,qh,Hx(()=>{for(const s in I(this,Zo))I(this,Zo)[s]=!1;Ve(this,oc,!1)},20));H(this,Um,()=>{je(I(this,lc),!0)});H(this,qm,()=>{je(I(this,lc),!1)});Ge(this,"props",{onfocuscapture:I(this,Um),onblurcapture:I(this,qm)});Ve(this,ac,s.enabled),Ve(this,Uh,s.isValidEvent),rn({id:s.id,ref:this.node,deps:()=>I(this,ac).current,onRefChange:T=>{this.currNode=T}}),Ve(this,Va,s.interactOutsideBehavior),Ve(this,sc,s.onInteractOutside),Ve(this,Vh,s.onFocusOutside),Ct(()=>{Ve(this,Go,Yb(this.currNode))});let g=nn;const v=()=>{I(this,qh).call(this),globalThis.bitsDismissableLayers.delete(this),I(this,cc).destroy(),g()};Ct(()=>(I(this,ac).current&&this.currNode&&Zp(1,()=>{this.currNode&&(globalThis.bitsDismissableLayers.set(this,Oi(()=>I(this,Va))),g(),g=qn(this,qc,Qb).call(this))}),()=>{v()})),SI(()=>{I(this,qh).destroy(),globalThis.bitsDismissableLayers.delete(this),I(this,cc).destroy(),I(this,Qs).call(this),g()})}get currNode(){return L(I(this,jh))}set currNode(s){je(I(this,jh),qe(s))}}sc=new WeakMap,Va=new WeakMap,Zo=new WeakMap,oc=new WeakMap,Go=new WeakMap,ac=new WeakMap,lc=new WeakMap,Vh=new WeakMap,jh=new WeakMap,Uh=new WeakMap,Qs=new WeakMap,Om=new WeakMap,qc=new WeakSet,Qb=function(){return $l(Is(I(this,Go),"pointerdown",$l(I(this,Bm),I(this,Vm)),!0),Is(I(this,Go),"pointerdown",$l(I(this,Nm),I(this,cc))),Is(I(this,Go),"focusin",I(this,Om)))},Fm=new WeakMap,cc=new WeakMap,Bm=new WeakMap,Nm=new WeakMap,Vm=new WeakMap,jm=new WeakMap,qh=new WeakMap,e1=function(){return Object.values(I(this,Zo)).some(Boolean)},Um=new WeakMap,qm=new WeakMap;function yC(h){return new gC(h)}function _C(h){return h.findLast(([s,{current:g}])=>g==="close"||g==="ignore")}function vC(h){const s=[...globalThis.bitsDismissableLayers],g=_C(s);if(g)return g[0].node.current===h;const[v]=s[0];return v.node.current===h}function xC(h,s){if("button"in h&&h.button>0)return!1;const g=h.target;return NI(g)?Yb(g).documentElement.contains(g)&&!Tv(s,g):!1}function Xx(h){const s=h.currentTarget,g=h.target;let v;h instanceof PointerEvent?v=new PointerEvent(h.type,h):v=new PointerEvent("pointerdown",h);let T=!1;return new Proxy(v,{get:(b,l)=>l==="currentTarget"?s:l==="target"?g:l==="preventDefault"?()=>{T=!0,typeof b.preventDefault=="function"&&b.preventDefault()}:l==="defaultPrevented"?T:l in b?b[l]:h[l]})}function t1(h,s){Pt(s,!0);let g=ie(s,"interactOutsideBehavior",3,"close"),v=ie(s,"onInteractOutside",3,nn),T=ie(s,"onFocusOutside",3,nn),C=ie(s,"isValidEvent",3,()=>!1);const b=yC({id:Pe.with(()=>s.id),interactOutsideBehavior:Pe.with(()=>g()),onInteractOutside:Pe.with(()=>v()),enabled:Pe.with(()=>s.enabled),onFocusOutside:Pe.with(()=>T()),isValidEvent:Pe.with(()=>C())});var l=Xe(),j=Le(l);Ot(j,()=>s.children??ti,()=>({props:b.props})),ve(h,l),It()}globalThis.bitsEscapeLayers??(globalThis.bitsEscapeLayers=new Map);var Zh,uc,Gh,Zm,Gm;class bC{constructor(s){H(this,Zh);H(this,uc);H(this,Gh);H(this,Zm,()=>Is(document,"keydown",I(this,Gm),{passive:!1}));H(this,Gm,s=>{if(s.key!==MI||!SC(this))return;const g=new KeyboardEvent(s.type,s);s.preventDefault();const v=I(this,uc).current;v!=="close"&&v!=="defer-otherwise-close"||I(this,Zh).current(g)});Ve(this,uc,s.escapeKeydownBehavior),Ve(this,Zh,s.onEscapeKeydown),Ve(this,Gh,s.enabled);let g=nn;Ct(()=>(I(this,Gh).current&&(globalThis.bitsEscapeLayers.set(this,Oi(()=>I(this,uc))),g=I(this,Zm).call(this)),()=>{g(),globalThis.bitsEscapeLayers.delete(this)}))}}Zh=new WeakMap,uc=new WeakMap,Gh=new WeakMap,Zm=new WeakMap,Gm=new WeakMap;function wC(h){return new bC(h)}function SC(h){const s=[...globalThis.bitsEscapeLayers],g=s.findLast(([T,{current:C}])=>C==="close"||C==="ignore");if(g)return g[0]===h;const[v]=s[0];return v===h}function i1(h,s){Pt(s,!0);let g=ie(s,"escapeKeydownBehavior",3,"close"),v=ie(s,"onEscapeKeydown",3,nn);wC({escapeKeydownBehavior:Pe.with(()=>g()),onEscapeKeydown:Pe.with(()=>v()),enabled:Pe.with(()=>s.enabled)});var T=Xe(),C=Le(T);Ot(C,()=>s.children??ti),ve(h,T),It()}const TC=Pe([]);function PC(){const h=TC;return{add(s){const g=h.current[0];s.id!==(g==null?void 0:g.id)&&(g==null||g.pause()),h.current=Kx(h.current,s),h.current.unshift(s)},remove(s){var g;h.current=Kx(h.current,s),(g=h.current[0])==null||g.resume()}}}function IC(){let h=Qe(!1);return{id:hn(),get paused(){return L(h)},pause(){je(h,!0)},resume(){je(h,!1)}}}function Kx(h,s){return[...h].filter(g=>g.id!==s.id)}function CC(h){return h.filter(s=>s.tagName!=="A")}function Vo(h,{select:s=!1}={}){if(!(h&&h.focus))return;const g=document.activeElement;h.focus({preventScroll:!0}),h!==g&&jI(h)&&s&&h.select()}function kC(h,{select:s=!1}={}){const g=document.activeElement;for(const v of h)if(Vo(v,{select:s}),document.activeElement!==g)return!0}function $x(h,s){for(const g of h)if(!UI(g,s))return g}function n1(h){const s=[],g=document.createTreeWalker(h,NodeFilter.SHOW_ELEMENT,{acceptNode:v=>{const T=v.tagName==="INPUT"&&v.type==="hidden";return v.disabled||v.hidden||T?NodeFilter.FILTER_SKIP:v.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;g.nextNode();)s.push(g.currentNode);return s}function AC(h){const s=n1(h),g=$x(s,h),v=$x(s.reverse(),h);return[g,v]}const EC="focusScope.autoFocusOnMount",MC="focusScope.autoFocusOnDestroy",Jx={bubbles:!1,cancelable:!0};function zC({id:h,loop:s,enabled:g,onOpenAutoFocus:v,onCloseAutoFocus:T,forceMount:C}){const b=PC(),l=IC(),j=Pe(null);rn({id:h,ref:j,deps:()=>g.current});let U=Qe(null);Ct(()=>{const Q=j.current;if(!Q||!g.current)return;function ee(pe){if(l.paused||!Q)return;const Ie=pe.target;pm(Ie)&&(Q.contains(Ie)?je(U,qe(Ie)):Vo(L(U),{select:!0}))}function ce(pe){if(l.paused||!Q)return;const Ie=pe.relatedTarget;pm(Ie)&&Ie!==null&&(Q.contains(Ie)||Vo(L(U),{select:!0}))}function ye(pe){(Q==null?void 0:Q.contains(L(U)))||Vo(Q)}return Oi(()=>{const pe=$l(Is(document,"focusin",ee),Is(document,"focusout",ce)),Ie=new MutationObserver(ye);return Ie.observe(Q,{childList:!0,subtree:!0}),()=>{pe(),Ie.disconnect()}})}),Ct(()=>{if(C.current)return;let Q=j.current;const ee=document.activeElement;return Oi(()=>{K(Q,ee)}),()=>{Q&&B(ee)}}),Ct(()=>{if(!C.current)return;g.current;const Q=j.current,ee=document.activeElement;return Oi(()=>{K(Q,ee)}),()=>{Q&&B(ee)}});function K(Q,ee){if(Q||(Q=document.getElementById(h.current)),!Q)return;if(b.add(l),!Q.contains(ee)){const ye=new CustomEvent(EC,Jx);v.current(ye),ye.defaultPrevented||jc(()=>{Q&&(kC(CC(n1(Q)),{select:!0}),document.activeElement===ee&&Vo(Q))})}}function B(Q){const ee=new CustomEvent(MC,Jx);T.current(ee),setTimeout(()=>{!ee.defaultPrevented&&Q&&Vo(Q??document.body,{select:!0}),b.remove(l)},0)}function V(Q){if(!g.current||!s.current&&!g.current||l.paused)return;const ee=Q.key===DI&&!Q.ctrlKey&&!Q.altKey&&!Q.metaKey,ce=document.activeElement;if(!(ee&&ce))return;const ye=j.current;if(!ye)return;const[pe,Ie]=AC(ye);pe&&Ie?!Q.shiftKey&&ce===Ie?(Q.preventDefault(),s.current&&Vo(pe,{select:!0})):Q.shiftKey&&ce===pe&&(Q.preventDefault(),s.current&&Vo(Ie,{select:!0})):ce===ye&&Q.preventDefault()}const ne=Te(()=>({id:h.current,tabindex:-1,onkeydown:V}));return{get props(){return L(ne)}}}function r1(h,s){Pt(s,!0);let g=ie(s,"trapFocus",3,!1),v=ie(s,"loop",3,!1),T=ie(s,"onCloseAutoFocus",3,nn),C=ie(s,"onOpenAutoFocus",3,nn),b=ie(s,"forceMount",3,!1);const l=zC({enabled:Pe.with(()=>g()),loop:Pe.with(()=>v()),onCloseAutoFocus:Pe.with(()=>T()),onOpenAutoFocus:Pe.with(()=>C()),id:Pe.with(()=>s.id),forceMount:Pe.with(()=>b())});var j=Xe(),U=Le(j);Ot(U,()=>s.focusScope??ti,()=>({props:l.props})),ve(h,j),It()}globalThis.bitsTextSelectionLayers??(globalThis.bitsTextSelectionLayers=new Map);var Wh,Hh,Xh,Wo,hc,Kh,Wm,s1,Hm,$h;class DC{constructor(s){H(this,Wm);H(this,Wh);H(this,Hh);H(this,Xh);H(this,Wo);H(this,hc,nn);H(this,Kh,Pe(null));H(this,Hm,s=>{const g=I(this,Kh).current,v=s.target;!pm(g)||!pm(v)||!I(this,Wo).current||!OC(this)||!Tv(g,v)||(I(this,Hh).current(s),!s.defaultPrevented&&Ve(this,hc,RC(g)))});H(this,$h,()=>{I(this,hc).call(this),Ve(this,hc,nn)});Ve(this,Wh,s.id),Ve(this,Wo,s.preventOverflowTextSelection),Ve(this,Hh,s.onPointerDown),Ve(this,Xh,s.onPointerUp),rn({id:I(this,Wh),ref:I(this,Kh),deps:()=>I(this,Wo).current});let g=nn;Ct(()=>(I(this,Wo).current&&(globalThis.bitsTextSelectionLayers.set(this,Oi(()=>I(this,Wo))),g=qn(this,Wm,s1).call(this)),()=>{g(),I(this,$h).call(this),globalThis.bitsTextSelectionLayers.delete(this)}))}}Wh=new WeakMap,Hh=new WeakMap,Xh=new WeakMap,Wo=new WeakMap,hc=new WeakMap,Kh=new WeakMap,Wm=new WeakSet,s1=function(){return $l(Is(document,"pointerdown",I(this,Hm)),Is(document,"pointerup",Hb(I(this,$h),I(this,Xh))))},Hm=new WeakMap,$h=new WeakMap;function LC(h){return new DC(h)}const Yx=h=>h.style.userSelect||h.style.webkitUserSelect;function RC(h){const s=document.body,g=Yx(s),v=Yx(h);return em(s,"none"),em(h,"text"),()=>{em(s,g),em(h,v)}}function em(h,s){h.style.userSelect=s,h.style.webkitUserSelect=s}function OC(h){const s=[...globalThis.bitsTextSelectionLayers];if(!s.length)return!1;const g=s.at(-1);return g?g[0]===h:!1}function o1(h,s){Pt(s,!0);let g=ie(s,"preventOverflowTextSelection",3,!0),v=ie(s,"onPointerDown",3,nn),T=ie(s,"onPointerUp",3,nn);LC({id:Pe.with(()=>s.id),preventOverflowTextSelection:Pe.with(()=>g()),onPointerDown:Pe.with(()=>v()),onPointerUp:Pe.with(()=>T()),enabled:Pe.with(()=>s.enabled)});var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),ve(h,C),It()}var FC=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],BC=["difference","intersection","symmetricDifference","union"],Qx=!1,dc,ss,Ho,Xm,a1;const Km=class Km extends Set{constructor(g){super();H(this,Xm);H(this,dc,new Map);H(this,ss,as(0));H(this,Ho,as(0));if(g){for(var v of g)super.add(v);I(this,Ho).v=super.size}Qx||qn(this,Xm,a1).call(this)}has(g){var v=super.has(g),T=I(this,dc),C=T.get(g);if(C===void 0){if(!v)return L(I(this,ss)),!1;C=as(!0),T.set(g,C)}return L(C),v}add(g){return super.has(g)||(super.add(g),je(I(this,Ho),super.size),jo(I(this,ss))),this}delete(g){var v=super.delete(g),T=I(this,dc),C=T.get(g);return C!==void 0&&(T.delete(g),je(C,!1)),v&&(je(I(this,Ho),super.size),jo(I(this,ss))),v}clear(){if(super.size!==0){super.clear();var g=I(this,dc);for(var v of g.values())je(v,!1);g.clear(),je(I(this,Ho),0),jo(I(this,ss))}}keys(){return this.values()}values(){return L(I(this,ss)),super.values()}entries(){return L(I(this,ss)),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return L(I(this,Ho))}};dc=new WeakMap,ss=new WeakMap,Ho=new WeakMap,Xm=new WeakSet,a1=function(){Qx=!0;var g=Km.prototype,v=Set.prototype;for(const T of FC)g[T]=function(...C){return L(I(this,ss)),v[T].apply(this,C)};for(const T of BC)g[T]=function(...C){L(I(this,ss));var b=v[T].apply(this,C);return new Km(b)}};let nv=Km;var bs,ws,eo,pc,hm;const Fv=class Fv extends Map{constructor(g){super();H(this,pc);H(this,bs,new Map);H(this,ws,as(0));H(this,eo,as(0));if(g){for(var[v,T]of g)super.set(v,T);I(this,eo).v=super.size}}has(g){var v=I(this,bs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else return L(I(this,ws)),!1}return L(T),!0}forEach(g,v){qn(this,pc,hm).call(this),super.forEach(g,v)}get(g){var v=I(this,bs),T=v.get(g);if(T===void 0){var C=super.get(g);if(C!==void 0)T=as(0),v.set(g,T);else{L(I(this,ws));return}}return L(T),super.get(g)}set(g,v){var B;var T=I(this,bs),C=T.get(g),b=super.get(g),l=super.set(g,v),j=I(this,ws);if(C===void 0)T.set(g,as(0)),je(I(this,eo),super.size),jo(j);else if(b!==v){jo(C);var U=j.reactions===null?null:new Set(j.reactions),K=U===null||!((B=C.reactions)!=null&&B.every(V=>U.has(V)));K&&jo(j)}return l}delete(g){var v=I(this,bs),T=v.get(g),C=super.delete(g);return T!==void 0&&(v.delete(g),je(I(this,eo),super.size),je(T,-1),jo(I(this,ws))),C}clear(){if(super.size!==0){super.clear();var g=I(this,bs);je(I(this,eo),0);for(var v of g.values())je(v,-1);jo(I(this,ws)),g.clear()}}keys(){return L(I(this,ws)),super.keys()}values(){return qn(this,pc,hm).call(this),super.values()}entries(){return qn(this,pc,hm).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return L(I(this,eo)),super.size}};bs=new WeakMap,ws=new WeakMap,eo=new WeakMap,pc=new WeakSet,hm=function(){L(I(this,ws));var g=I(this,bs);if(I(this,eo).v!==g.size)for(var v of wx(Fv.prototype,this,"keys").call(this))g.has(v)||g.set(v,as(0));for(var[,T]of I(this,bs))L(T)};let rv=Fv;function NC(h){let s=0,g=Qe(void 0),v;function T(){s-=1,v&&s<=0&&(v(),je(g,void 0),v=void 0)}return(...C)=>(s+=1,L(g)===void 0&&(v=dS(()=>{je(g,qe(h(...C)))})),Ct(()=>()=>{T()}),L(g))}const VC=NC(()=>{const h=new rv,s=Te(()=>{for(const C of h.values())if(C)return!0;return!1});let g=qe({}),v=null;function T(){bv&&(document.body.style.paddingRight=g.paddingRight??"",document.body.style.marginRight=g.marginRight??"",document.body.style.pointerEvents=g.pointerEvents??"",document.body.style.removeProperty("--scrollbar-width"),document.body.style.overflow=g.overflow??"",Zx&&(v==null||v()))}return Ct(()=>{const C=L(s);return Oi(()=>{if(!C)return;const b=getComputedStyle(document.body);g.overflow=b.overflow,g.paddingRight=b.paddingRight,g.marginRight=b.marginRight,g.pointerEvents=b.pointerEvents;const l=window.innerWidth-document.documentElement.clientWidth,U={padding:Number.parseInt(g.paddingRight??"0",10)+l,margin:Number.parseInt(g.marginRight??"0",10)};l>0&&(document.body.style.paddingRight=`${U.padding}px`,document.body.style.marginRight=`${U.margin}px`,document.body.style.setProperty("--scrollbar-width",`${l}px`),document.body.style.overflow="hidden"),Zx&&(v=Is(document,"touchmove",K=>{K.target===document.documentElement&&(K.touches.length>1||K.preventDefault())},{passive:!1})),jc(()=>{document.body.style.pointerEvents="none",document.body.style.overflow="hidden"})})}),Ct(()=>()=>{v==null||v()}),{get map(){return h},resetBodyStyle:T}});function jC(h,s=()=>null){const g=hn(),v=VC(),T=Te(s);v.map.set(g,h??!1);const C=Pe.with(()=>v.map.get(g)??!1,b=>v.map.set(g,b));return Ct(()=>()=>{v.map.delete(g),!UC(v.map)&&(L(T)===null?requestAnimationFrame(()=>v.resetBodyStyle()):Zp(L(T),()=>v.resetBodyStyle()))}),C}function UC(h){for(const[s,g]of h)if(g)return!0;return!1}function fm(h,s){Pt(s,!0);let g=ie(s,"preventScroll",3,!0),v=ie(s,"restoreScrollDelay",3,null);jC(g(),()=>v()),It()}function qC({forceMount:h,present:s,trapFocus:g,open:v}){return h?v&&g:s&&g&&v}var ZC=Et("<div><!></div>");function l1(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"forceMount",3,!1),T=ie(s,"ref",15,null),C=Kt(s,["$$slots","$$events","$$legacy","id","forceMount","child","children","ref"]);const b=hC({id:Pe.with(()=>g()),ref:Pe.with(()=>T(),U=>T(U))}),l=Te(()=>Vi(C,b.props));var j=Te(()=>b.root.open.current||v());wv(h,{get id(){return g()},get present(){return L(j)},presence:K=>{var B=Xe(),V=Le(B);{var ne=ee=>{var ce=Xe(),ye=Le(ce),pe=Up(()=>({props:Vi(L(l)),...b.snippetProps}));Ot(ye,()=>s.child,()=>L(pe)),ve(ee,ce)},Q=ee=>{var ce=ZC();const ye=Te(()=>Vi(L(l)));let pe;var Ie=qt(ce);Ot(Ie,()=>s.children??ti,()=>b.snippetProps),Vt(ce),zt(()=>pe=ji(ce,pe,{...L(ye)})),ve(ee,ce)};fi(V,ee=>{s.child?ee(ne):ee(Q,!1)})}ve(K,B)},$$slots:{presence:!0}}),It()}var GC=Et("<button><!></button>");function WC(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"disabled",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const b=lC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ee=>v(ee)),disabled:Pe.with(()=>!!T())}),l=Te(()=>Vi(C,b.props)),j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var ne=ee=>{var ce=Xe(),ye=Le(ce);Ot(ye,()=>s.child,()=>({props:L(l)})),ve(ee,ce)},Q=ee=>{var ce=GC();const ye=Te(()=>K({...L(l)},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ce);Ot(Ie,()=>s.children??ti),Vt(ce),zt(()=>pe=ji(ce,pe,{...L(ye)})),ve(ee,ce)};fi(V,ee=>{s.child?ee(ne):ee(Q,!1)})}ve(h,B),It()}var HC=Et("<div><!></div>");function c1(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref"]);const C=dC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var l=Xe(),j=Le(l);{var U=B=>{var V=Xe(),ne=Le(V);Ot(ne,()=>s.child,()=>({props:L(b)})),ve(B,V)},K=B=>{var V=HC();let ne;var Q=qt(V);Ot(Q,()=>s.children??ti),Vt(V),zt(()=>ne=ji(V,ne,{...L(b)})),ve(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}ve(h,l),It()}const XC=["top","right","bottom","left"],na=Math.min,Ur=Math.max,mm=Math.round,tm=Math.floor,Cs=h=>({x:h,y:h}),KC={left:"right",right:"left",bottom:"top",top:"bottom"},$C={start:"end",end:"start"};function sv(h,s,g){return Ur(h,na(s,g))}function to(h,s){return typeof h=="function"?h(s):h}function io(h){return h.split("-")[0]}function Wc(h){return h.split("-")[1]}function Pv(h){return h==="x"?"y":"x"}function Iv(h){return h==="y"?"height":"width"}function ra(h){return["top","bottom"].includes(io(h))?"y":"x"}function Cv(h){return Pv(ra(h))}function JC(h,s,g){g===void 0&&(g=!1);const v=Wc(h),T=Cv(h),C=Iv(T);let b=T==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return s.reference[C]>s.floating[C]&&(b=gm(b)),[b,gm(b)]}function YC(h){const s=gm(h);return[ov(h),s,ov(s)]}function ov(h){return h.replace(/start|end/g,s=>$C[s])}function QC(h,s,g){const v=["left","right"],T=["right","left"],C=["top","bottom"],b=["bottom","top"];switch(h){case"top":case"bottom":return g?s?T:v:s?v:T;case"left":case"right":return s?C:b;default:return[]}}function ek(h,s,g,v){const T=Wc(h);let C=QC(io(h),g==="start",v);return T&&(C=C.map(b=>b+"-"+T),s&&(C=C.concat(C.map(ov)))),C}function gm(h){return h.replace(/left|right|bottom|top/g,s=>KC[s])}function tk(h){return{top:0,right:0,bottom:0,left:0,...h}}function u1(h){return typeof h!="number"?tk(h):{top:h,right:h,bottom:h,left:h}}function ym(h){const{x:s,y:g,width:v,height:T}=h;return{width:v,height:T,top:g,left:s,right:s+v,bottom:g+T,x:s,y:g}}function eb(h,s,g){let{reference:v,floating:T}=h;const C=ra(s),b=Cv(s),l=Iv(b),j=io(s),U=C==="y",K=v.x+v.width/2-T.width/2,B=v.y+v.height/2-T.height/2,V=v[l]/2-T[l]/2;let ne;switch(j){case"top":ne={x:K,y:v.y-T.height};break;case"bottom":ne={x:K,y:v.y+v.height};break;case"right":ne={x:v.x+v.width,y:B};break;case"left":ne={x:v.x-T.width,y:B};break;default:ne={x:v.x,y:v.y}}switch(Wc(s)){case"start":ne[b]-=V*(g&&U?-1:1);break;case"end":ne[b]+=V*(g&&U?-1:1);break}return ne}const ik=async(h,s,g)=>{const{placement:v="bottom",strategy:T="absolute",middleware:C=[],platform:b}=g,l=C.filter(Boolean),j=await(b.isRTL==null?void 0:b.isRTL(s));let U=await b.getElementRects({reference:h,floating:s,strategy:T}),{x:K,y:B}=eb(U,v,j),V=v,ne={},Q=0;for(let ee=0;ee<l.length;ee++){const{name:ce,fn:ye}=l[ee],{x:pe,y:Ie,data:Oe,reset:ze}=await ye({x:K,y:B,initialPlacement:v,placement:V,strategy:T,middlewareData:ne,rects:U,platform:b,elements:{reference:h,floating:s}});K=pe??K,B=Ie??B,ne={...ne,[ce]:{...ne[ce],...Oe}},ze&&Q<=50&&(Q++,typeof ze=="object"&&(ze.placement&&(V=ze.placement),ze.rects&&(U=ze.rects===!0?await b.getElementRects({reference:h,floating:s,strategy:T}):ze.rects),{x:K,y:B}=eb(U,V,j)),ee=-1)}return{x:K,y:B,placement:V,strategy:T,middlewareData:ne}};async function _h(h,s){var g;s===void 0&&(s={});const{x:v,y:T,platform:C,rects:b,elements:l,strategy:j}=h,{boundary:U="clippingAncestors",rootBoundary:K="viewport",elementContext:B="floating",altBoundary:V=!1,padding:ne=0}=to(s,h),Q=u1(ne),ce=l[V?B==="floating"?"reference":"floating":B],ye=ym(await C.getClippingRect({element:(g=await(C.isElement==null?void 0:C.isElement(ce)))==null||g?ce:ce.contextElement||await(C.getDocumentElement==null?void 0:C.getDocumentElement(l.floating)),boundary:U,rootBoundary:K,strategy:j})),pe=B==="floating"?{x:v,y:T,width:b.floating.width,height:b.floating.height}:b.reference,Ie=await(C.getOffsetParent==null?void 0:C.getOffsetParent(l.floating)),Oe=await(C.isElement==null?void 0:C.isElement(Ie))?await(C.getScale==null?void 0:C.getScale(Ie))||{x:1,y:1}:{x:1,y:1},ze=ym(C.convertOffsetParentRelativeRectToViewportRelativeRect?await C.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:pe,offsetParent:Ie,strategy:j}):pe);return{top:(ye.top-ze.top+Q.top)/Oe.y,bottom:(ze.bottom-ye.bottom+Q.bottom)/Oe.y,left:(ye.left-ze.left+Q.left)/Oe.x,right:(ze.right-ye.right+Q.right)/Oe.x}}const nk=h=>({name:"arrow",options:h,async fn(s){const{x:g,y:v,placement:T,rects:C,platform:b,elements:l,middlewareData:j}=s,{element:U,padding:K=0}=to(h,s)||{};if(U==null)return{};const B=u1(K),V={x:g,y:v},ne=Cv(T),Q=Iv(ne),ee=await b.getDimensions(U),ce=ne==="y",ye=ce?"top":"left",pe=ce?"bottom":"right",Ie=ce?"clientHeight":"clientWidth",Oe=C.reference[Q]+C.reference[ne]-V[ne]-C.floating[Q],ze=V[ne]-C.reference[ne],We=await(b.getOffsetParent==null?void 0:b.getOffsetParent(U));let $e=We?We[Ie]:0;(!$e||!await(b.isElement==null?void 0:b.isElement(We)))&&($e=l.floating[Ie]||C.floating[Q]);const xt=Oe/2-ze/2,He=$e/2-ee[Q]/2-1,Ye=na(B[ye],He),Be=na(B[pe],He),Me=Ye,De=$e-ee[Q]-Be,ke=$e/2-ee[Q]/2+xt,Ue=sv(Me,ke,De),et=!j.arrow&&Wc(T)!=null&&ke!==Ue&&C.reference[Q]/2-(ke<Me?Ye:Be)-ee[Q]/2<0,pt=et?ke<Me?ke-Me:ke-De:0;return{[ne]:V[ne]+pt,data:{[ne]:Ue,centerOffset:ke-Ue-pt,...et&&{alignmentOffset:pt}},reset:et}}}),rk=function(h){return h===void 0&&(h={}),{name:"flip",options:h,async fn(s){var g,v;const{placement:T,middlewareData:C,rects:b,initialPlacement:l,platform:j,elements:U}=s,{mainAxis:K=!0,crossAxis:B=!0,fallbackPlacements:V,fallbackStrategy:ne="bestFit",fallbackAxisSideDirection:Q="none",flipAlignment:ee=!0,...ce}=to(h,s);if((g=C.arrow)!=null&&g.alignmentOffset)return{};const ye=io(T),pe=ra(l),Ie=io(l)===l,Oe=await(j.isRTL==null?void 0:j.isRTL(U.floating)),ze=V||(Ie||!ee?[gm(l)]:YC(l)),We=Q!=="none";!V&&We&&ze.push(...ek(l,ee,Q,Oe));const $e=[l,...ze],xt=await _h(s,ce),He=[];let Ye=((v=C.flip)==null?void 0:v.overflows)||[];if(K&&He.push(xt[ye]),B){const ke=JC(T,b,Oe);He.push(xt[ke[0]],xt[ke[1]])}if(Ye=[...Ye,{placement:T,overflows:He}],!He.every(ke=>ke<=0)){var Be,Me;const ke=(((Be=C.flip)==null?void 0:Be.index)||0)+1,Ue=$e[ke];if(Ue)return{data:{index:ke,overflows:Ye},reset:{placement:Ue}};let et=(Me=Ye.filter(pt=>pt.overflows[0]<=0).sort((pt,ut)=>pt.overflows[1]-ut.overflows[1])[0])==null?void 0:Me.placement;if(!et)switch(ne){case"bestFit":{var De;const pt=(De=Ye.filter(ut=>{if(We){const ct=ra(ut.placement);return ct===pe||ct==="y"}return!0}).map(ut=>[ut.placement,ut.overflows.filter(ct=>ct>0).reduce((ct,at)=>ct+at,0)]).sort((ut,ct)=>ut[1]-ct[1])[0])==null?void 0:De[0];pt&&(et=pt);break}case"initialPlacement":et=l;break}if(T!==et)return{reset:{placement:et}}}return{}}}};function tb(h,s){return{top:h.top-s.height,right:h.right-s.width,bottom:h.bottom-s.height,left:h.left-s.width}}function ib(h){return XC.some(s=>h[s]>=0)}const sk=function(h){return h===void 0&&(h={}),{name:"hide",options:h,async fn(s){const{rects:g}=s,{strategy:v="referenceHidden",...T}=to(h,s);switch(v){case"referenceHidden":{const C=await _h(s,{...T,elementContext:"reference"}),b=tb(C,g.reference);return{data:{referenceHiddenOffsets:b,referenceHidden:ib(b)}}}case"escaped":{const C=await _h(s,{...T,altBoundary:!0}),b=tb(C,g.floating);return{data:{escapedOffsets:b,escaped:ib(b)}}}default:return{}}}}};async function ok(h,s){const{placement:g,platform:v,elements:T}=h,C=await(v.isRTL==null?void 0:v.isRTL(T.floating)),b=io(g),l=Wc(g),j=ra(g)==="y",U=["left","top"].includes(b)?-1:1,K=C&&j?-1:1,B=to(s,h);let{mainAxis:V,crossAxis:ne,alignmentAxis:Q}=typeof B=="number"?{mainAxis:B,crossAxis:0,alignmentAxis:null}:{mainAxis:B.mainAxis||0,crossAxis:B.crossAxis||0,alignmentAxis:B.alignmentAxis};return l&&typeof Q=="number"&&(ne=l==="end"?Q*-1:Q),j?{x:ne*K,y:V*U}:{x:V*U,y:ne*K}}const ak=function(h){return h===void 0&&(h=0),{name:"offset",options:h,async fn(s){var g,v;const{x:T,y:C,placement:b,middlewareData:l}=s,j=await ok(s,h);return b===((g=l.offset)==null?void 0:g.placement)&&(v=l.arrow)!=null&&v.alignmentOffset?{}:{x:T+j.x,y:C+j.y,data:{...j,placement:b}}}}},lk=function(h){return h===void 0&&(h={}),{name:"shift",options:h,async fn(s){const{x:g,y:v,placement:T}=s,{mainAxis:C=!0,crossAxis:b=!1,limiter:l={fn:ce=>{let{x:ye,y:pe}=ce;return{x:ye,y:pe}}},...j}=to(h,s),U={x:g,y:v},K=await _h(s,j),B=ra(io(T)),V=Pv(B);let ne=U[V],Q=U[B];if(C){const ce=V==="y"?"top":"left",ye=V==="y"?"bottom":"right",pe=ne+K[ce],Ie=ne-K[ye];ne=sv(pe,ne,Ie)}if(b){const ce=B==="y"?"top":"left",ye=B==="y"?"bottom":"right",pe=Q+K[ce],Ie=Q-K[ye];Q=sv(pe,Q,Ie)}const ee=l.fn({...s,[V]:ne,[B]:Q});return{...ee,data:{x:ee.x-g,y:ee.y-v,enabled:{[V]:C,[B]:b}}}}}},ck=function(h){return h===void 0&&(h={}),{options:h,fn(s){const{x:g,y:v,placement:T,rects:C,middlewareData:b}=s,{offset:l=0,mainAxis:j=!0,crossAxis:U=!0}=to(h,s),K={x:g,y:v},B=ra(T),V=Pv(B);let ne=K[V],Q=K[B];const ee=to(l,s),ce=typeof ee=="number"?{mainAxis:ee,crossAxis:0}:{mainAxis:0,crossAxis:0,...ee};if(j){const Ie=V==="y"?"height":"width",Oe=C.reference[V]-C.floating[Ie]+ce.mainAxis,ze=C.reference[V]+C.reference[Ie]-ce.mainAxis;ne<Oe?ne=Oe:ne>ze&&(ne=ze)}if(U){var ye,pe;const Ie=V==="y"?"width":"height",Oe=["top","left"].includes(io(T)),ze=C.reference[B]-C.floating[Ie]+(Oe&&((ye=b.offset)==null?void 0:ye[B])||0)+(Oe?0:ce.crossAxis),We=C.reference[B]+C.reference[Ie]+(Oe?0:((pe=b.offset)==null?void 0:pe[B])||0)-(Oe?ce.crossAxis:0);Q<ze?Q=ze:Q>We&&(Q=We)}return{[V]:ne,[B]:Q}}}},uk=function(h){return h===void 0&&(h={}),{name:"size",options:h,async fn(s){var g,v;const{placement:T,rects:C,platform:b,elements:l}=s,{apply:j=()=>{},...U}=to(h,s),K=await _h(s,U),B=io(T),V=Wc(T),ne=ra(T)==="y",{width:Q,height:ee}=C.floating;let ce,ye;B==="top"||B==="bottom"?(ce=B,ye=V===(await(b.isRTL==null?void 0:b.isRTL(l.floating))?"start":"end")?"left":"right"):(ye=B,ce=V==="end"?"top":"bottom");const pe=ee-K.top-K.bottom,Ie=Q-K.left-K.right,Oe=na(ee-K[ce],pe),ze=na(Q-K[ye],Ie),We=!s.middlewareData.shift;let $e=Oe,xt=ze;if((g=s.middlewareData.shift)!=null&&g.enabled.x&&(xt=Ie),(v=s.middlewareData.shift)!=null&&v.enabled.y&&($e=pe),We&&!V){const Ye=Ur(K.left,0),Be=Ur(K.right,0),Me=Ur(K.top,0),De=Ur(K.bottom,0);ne?xt=Q-2*(Ye!==0||Be!==0?Ye+Be:Ur(K.left,K.right)):$e=ee-2*(Me!==0||De!==0?Me+De:Ur(K.top,K.bottom))}await j({...s,availableWidth:xt,availableHeight:$e});const He=await b.getDimensions(l.floating);return Q!==He.width||ee!==He.height?{reset:{rects:!0}}:{}}}};function cy(){return typeof window<"u"}function Hc(h){return h1(h)?(h.nodeName||"").toLowerCase():"#document"}function qr(h){var s;return(h==null||(s=h.ownerDocument)==null?void 0:s.defaultView)||window}function As(h){var s;return(s=(h1(h)?h.ownerDocument:h.document)||window.document)==null?void 0:s.documentElement}function h1(h){return cy()?h instanceof Node||h instanceof qr(h).Node:!1}function ls(h){return cy()?h instanceof Element||h instanceof qr(h).Element:!1}function ks(h){return cy()?h instanceof HTMLElement||h instanceof qr(h).HTMLElement:!1}function nb(h){return!cy()||typeof ShadowRoot>"u"?!1:h instanceof ShadowRoot||h instanceof qr(h).ShadowRoot}function Gp(h){const{overflow:s,overflowX:g,overflowY:v,display:T}=cs(h);return/auto|scroll|overlay|hidden|clip/.test(s+v+g)&&!["inline","contents"].includes(T)}function hk(h){return["table","td","th"].includes(Hc(h))}function uy(h){return[":popover-open",":modal"].some(s=>{try{return h.matches(s)}catch{return!1}})}function kv(h){const s=Av(),g=ls(h)?cs(h):h;return g.transform!=="none"||g.perspective!=="none"||(g.containerType?g.containerType!=="normal":!1)||!s&&(g.backdropFilter?g.backdropFilter!=="none":!1)||!s&&(g.filter?g.filter!=="none":!1)||["transform","perspective","filter"].some(v=>(g.willChange||"").includes(v))||["paint","layout","strict","content"].some(v=>(g.contain||"").includes(v))}function dk(h){let s=sa(h);for(;ks(s)&&!Uc(s);){if(kv(s))return s;if(uy(s))return null;s=sa(s)}return null}function Av(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Uc(h){return["html","body","#document"].includes(Hc(h))}function cs(h){return qr(h).getComputedStyle(h)}function hy(h){return ls(h)?{scrollLeft:h.scrollLeft,scrollTop:h.scrollTop}:{scrollLeft:h.scrollX,scrollTop:h.scrollY}}function sa(h){if(Hc(h)==="html")return h;const s=h.assignedSlot||h.parentNode||nb(h)&&h.host||As(h);return nb(s)?s.host:s}function d1(h){const s=sa(h);return Uc(s)?h.ownerDocument?h.ownerDocument.body:h.body:ks(s)&&Gp(s)?s:d1(s)}function vh(h,s,g){var v;s===void 0&&(s=[]),g===void 0&&(g=!0);const T=d1(h),C=T===((v=h.ownerDocument)==null?void 0:v.body),b=qr(T);if(C){const l=av(b);return s.concat(b,b.visualViewport||[],Gp(T)?T:[],l&&g?vh(l):[])}return s.concat(T,vh(T,[],g))}function av(h){return h.parent&&Object.getPrototypeOf(h.parent)?h.frameElement:null}function p1(h){const s=cs(h);let g=parseFloat(s.width)||0,v=parseFloat(s.height)||0;const T=ks(h),C=T?h.offsetWidth:g,b=T?h.offsetHeight:v,l=mm(g)!==C||mm(v)!==b;return l&&(g=C,v=b),{width:g,height:v,$:l}}function Ev(h){return ls(h)?h:h.contextElement}function Jl(h){const s=Ev(h);if(!ks(s))return Cs(1);const g=s.getBoundingClientRect(),{width:v,height:T,$:C}=p1(s);let b=(C?mm(g.width):g.width)/v,l=(C?mm(g.height):g.height)/T;return(!b||!Number.isFinite(b))&&(b=1),(!l||!Number.isFinite(l))&&(l=1),{x:b,y:l}}const pk=Cs(0);function f1(h){const s=qr(h);return!Av()||!s.visualViewport?pk:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function fk(h,s,g){return s===void 0&&(s=!1),!g||s&&g!==qr(h)?!1:s}function Ka(h,s,g,v){s===void 0&&(s=!1),g===void 0&&(g=!1);const T=h.getBoundingClientRect(),C=Ev(h);let b=Cs(1);s&&(v?ls(v)&&(b=Jl(v)):b=Jl(h));const l=fk(C,g,v)?f1(C):Cs(0);let j=(T.left+l.x)/b.x,U=(T.top+l.y)/b.y,K=T.width/b.x,B=T.height/b.y;if(C){const V=qr(C),ne=v&&ls(v)?qr(v):v;let Q=V,ee=av(Q);for(;ee&&v&&ne!==Q;){const ce=Jl(ee),ye=ee.getBoundingClientRect(),pe=cs(ee),Ie=ye.left+(ee.clientLeft+parseFloat(pe.paddingLeft))*ce.x,Oe=ye.top+(ee.clientTop+parseFloat(pe.paddingTop))*ce.y;j*=ce.x,U*=ce.y,K*=ce.x,B*=ce.y,j+=Ie,U+=Oe,Q=qr(ee),ee=av(Q)}}return ym({width:K,height:B,x:j,y:U})}function Mv(h,s){const g=hy(h).scrollLeft;return s?s.left+g:Ka(As(h)).left+g}function m1(h,s,g){g===void 0&&(g=!1);const v=h.getBoundingClientRect(),T=v.left+s.scrollLeft-(g?0:Mv(h,v)),C=v.top+s.scrollTop;return{x:T,y:C}}function mk(h){let{elements:s,rect:g,offsetParent:v,strategy:T}=h;const C=T==="fixed",b=As(v),l=s?uy(s.floating):!1;if(v===b||l&&C)return g;let j={scrollLeft:0,scrollTop:0},U=Cs(1);const K=Cs(0),B=ks(v);if((B||!B&&!C)&&((Hc(v)!=="body"||Gp(b))&&(j=hy(v)),ks(v))){const ne=Ka(v);U=Jl(v),K.x=ne.x+v.clientLeft,K.y=ne.y+v.clientTop}const V=b&&!B&&!C?m1(b,j,!0):Cs(0);return{width:g.width*U.x,height:g.height*U.y,x:g.x*U.x-j.scrollLeft*U.x+K.x+V.x,y:g.y*U.y-j.scrollTop*U.y+K.y+V.y}}function gk(h){return Array.from(h.getClientRects())}function yk(h){const s=As(h),g=hy(h),v=h.ownerDocument.body,T=Ur(s.scrollWidth,s.clientWidth,v.scrollWidth,v.clientWidth),C=Ur(s.scrollHeight,s.clientHeight,v.scrollHeight,v.clientHeight);let b=-g.scrollLeft+Mv(h);const l=-g.scrollTop;return cs(v).direction==="rtl"&&(b+=Ur(s.clientWidth,v.clientWidth)-T),{width:T,height:C,x:b,y:l}}function _k(h,s){const g=qr(h),v=As(h),T=g.visualViewport;let C=v.clientWidth,b=v.clientHeight,l=0,j=0;if(T){C=T.width,b=T.height;const U=Av();(!U||U&&s==="fixed")&&(l=T.offsetLeft,j=T.offsetTop)}return{width:C,height:b,x:l,y:j}}function vk(h,s){const g=Ka(h,!0,s==="fixed"),v=g.top+h.clientTop,T=g.left+h.clientLeft,C=ks(h)?Jl(h):Cs(1),b=h.clientWidth*C.x,l=h.clientHeight*C.y,j=T*C.x,U=v*C.y;return{width:b,height:l,x:j,y:U}}function rb(h,s,g){let v;if(s==="viewport")v=_k(h,g);else if(s==="document")v=yk(As(h));else if(ls(s))v=vk(s,g);else{const T=f1(h);v={x:s.x-T.x,y:s.y-T.y,width:s.width,height:s.height}}return ym(v)}function g1(h,s){const g=sa(h);return g===s||!ls(g)||Uc(g)?!1:cs(g).position==="fixed"||g1(g,s)}function xk(h,s){const g=s.get(h);if(g)return g;let v=vh(h,[],!1).filter(l=>ls(l)&&Hc(l)!=="body"),T=null;const C=cs(h).position==="fixed";let b=C?sa(h):h;for(;ls(b)&&!Uc(b);){const l=cs(b),j=kv(b);!j&&l.position==="fixed"&&(T=null),(C?!j&&!T:!j&&l.position==="static"&&!!T&&["absolute","fixed"].includes(T.position)||Gp(b)&&!j&&g1(h,b))?v=v.filter(K=>K!==b):T=l,b=sa(b)}return s.set(h,v),v}function bk(h){let{element:s,boundary:g,rootBoundary:v,strategy:T}=h;const b=[...g==="clippingAncestors"?uy(s)?[]:xk(s,this._c):[].concat(g),v],l=b[0],j=b.reduce((U,K)=>{const B=rb(s,K,T);return U.top=Ur(B.top,U.top),U.right=na(B.right,U.right),U.bottom=na(B.bottom,U.bottom),U.left=Ur(B.left,U.left),U},rb(s,l,T));return{width:j.right-j.left,height:j.bottom-j.top,x:j.left,y:j.top}}function wk(h){const{width:s,height:g}=p1(h);return{width:s,height:g}}function Sk(h,s,g){const v=ks(s),T=As(s),C=g==="fixed",b=Ka(h,!0,C,s);let l={scrollLeft:0,scrollTop:0};const j=Cs(0);if(v||!v&&!C)if((Hc(s)!=="body"||Gp(T))&&(l=hy(s)),v){const V=Ka(s,!0,C,s);j.x=V.x+s.clientLeft,j.y=V.y+s.clientTop}else T&&(j.x=Mv(T));const U=T&&!v&&!C?m1(T,l):Cs(0),K=b.left+l.scrollLeft-j.x-U.x,B=b.top+l.scrollTop-j.y-U.y;return{x:K,y:B,width:b.width,height:b.height}}function N_(h){return cs(h).position==="static"}function sb(h,s){if(!ks(h)||cs(h).position==="fixed")return null;if(s)return s(h);let g=h.offsetParent;return As(h)===g&&(g=g.ownerDocument.body),g}function y1(h,s){const g=qr(h);if(uy(h))return g;if(!ks(h)){let T=sa(h);for(;T&&!Uc(T);){if(ls(T)&&!N_(T))return T;T=sa(T)}return g}let v=sb(h,s);for(;v&&hk(v)&&N_(v);)v=sb(v,s);return v&&Uc(v)&&N_(v)&&!kv(v)?g:v||dk(h)||g}const Tk=async function(h){const s=this.getOffsetParent||y1,g=this.getDimensions,v=await g(h.floating);return{reference:Sk(h.reference,await s(h.floating),h.strategy),floating:{x:0,y:0,width:v.width,height:v.height}}};function Pk(h){return cs(h).direction==="rtl"}const Ik={convertOffsetParentRelativeRectToViewportRelativeRect:mk,getDocumentElement:As,getClippingRect:bk,getOffsetParent:y1,getElementRects:Tk,getClientRects:gk,getDimensions:wk,getScale:Jl,isElement:ls,isRTL:Pk};function Ck(h,s){let g=null,v;const T=As(h);function C(){var l;clearTimeout(v),(l=g)==null||l.disconnect(),g=null}function b(l,j){l===void 0&&(l=!1),j===void 0&&(j=1),C();const{left:U,top:K,width:B,height:V}=h.getBoundingClientRect();if(l||s(),!B||!V)return;const ne=tm(K),Q=tm(T.clientWidth-(U+B)),ee=tm(T.clientHeight-(K+V)),ce=tm(U),pe={rootMargin:-ne+"px "+-Q+"px "+-ee+"px "+-ce+"px",threshold:Ur(0,na(1,j))||1};let Ie=!0;function Oe(ze){const We=ze[0].intersectionRatio;if(We!==j){if(!Ie)return b();We?b(!1,We):v=setTimeout(()=>{b(!1,1e-7)},1e3)}Ie=!1}try{g=new IntersectionObserver(Oe,{...pe,root:T.ownerDocument})}catch{g=new IntersectionObserver(Oe,pe)}g.observe(h)}return b(!0),C}function kk(h,s,g,v){v===void 0&&(v={});const{ancestorScroll:T=!0,ancestorResize:C=!0,elementResize:b=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:j=!1}=v,U=Ev(h),K=T||C?[...U?vh(U):[],...vh(s)]:[];K.forEach(ye=>{T&&ye.addEventListener("scroll",g,{passive:!0}),C&&ye.addEventListener("resize",g)});const B=U&&l?Ck(U,g):null;let V=-1,ne=null;b&&(ne=new ResizeObserver(ye=>{let[pe]=ye;pe&&pe.target===U&&ne&&(ne.unobserve(s),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var Ie;(Ie=ne)==null||Ie.observe(s)})),g()}),U&&!j&&ne.observe(U),ne.observe(s));let Q,ee=j?Ka(h):null;j&&ce();function ce(){const ye=Ka(h);ee&&(ye.x!==ee.x||ye.y!==ee.y||ye.width!==ee.width||ye.height!==ee.height)&&g(),ee=ye,Q=requestAnimationFrame(ce)}return g(),()=>{var ye;K.forEach(pe=>{T&&pe.removeEventListener("scroll",g),C&&pe.removeEventListener("resize",g)}),B==null||B(),(ye=ne)==null||ye.disconnect(),ne=null,j&&cancelAnimationFrame(Q)}}const Ak=ak,Ek=lk,Mk=rk,zk=uk,Dk=sk,Lk=nk,Rk=ck,Ok=(h,s,g)=>{const v=new Map,T={platform:Ik,...g},C={...T.platform,_c:v};return ik(h,s,{...T,platform:C})};function lh(h){return typeof h=="function"?h():h}function _1(h){return typeof window>"u"?1:(h.ownerDocument.defaultView||window).devicePixelRatio||1}function ob(h,s){const g=_1(h);return Math.round(s*g)/g}function ab(h){return{[`--bits-${h}-content-transform-origin`]:"var(--bits-floating-transform-origin)",[`--bits-${h}-content-available-width`]:"var(--bits-floating-available-width)",[`--bits-${h}-content-available-height`]:"var(--bits-floating-available-height)",[`--bits-${h}-anchor-width`]:"var(--bits-floating-anchor-width)",[`--bits-${h}-anchor-height`]:"var(--bits-floating-anchor-height)"}}function Fk(h){const s=h.whileElementsMounted,g=Te(()=>lh(h.open)??!0),v=Te(()=>lh(h.middleware)),T=Te(()=>lh(h.transform)??!0),C=Te(()=>lh(h.placement)??"bottom"),b=Te(()=>lh(h.strategy)??"absolute"),l=h.reference;let j=Qe(0),U=Qe(0);const K=Pe(null);let B=Qe(qe(L(b))),V=Qe(qe(L(C))),ne=Qe(qe({})),Q=Qe(!1);const ee=Te(()=>{const ze={position:L(B),left:"0",top:"0"};if(!K.current)return ze;const We=ob(K.current,L(j)),$e=ob(K.current,L(U));return L(T)?{...ze,transform:`translate(${We}px, ${$e}px)`,..._1(K.current)>=1.5&&{willChange:"transform"}}:{position:L(B),left:`${We}px`,top:`${$e}px`}});let ce;function ye(){l.current===null||K.current===null||Ok(l.current,K.current,{middleware:L(v),placement:L(C),strategy:L(b)}).then(ze=>{je(j,qe(ze.x)),je(U,qe(ze.y)),je(B,qe(ze.strategy)),je(V,qe(ze.placement)),je(ne,qe(ze.middlewareData)),je(Q,!0)})}function pe(){typeof ce=="function"&&(ce(),ce=void 0)}function Ie(){if(pe(),s===void 0){ye();return}l.current===null||K.current===null||(ce=s(l.current,K.current,ye))}function Oe(){L(g)||je(Q,!1)}return Ct(ye),Ct(Ie),Ct(Oe),Ct(()=>pe),{floating:K,reference:l,get strategy(){return L(B)},get placement(){return L(V)},get middlewareData(){return L(ne)},get isPositioned(){return L(Q)},get floatingStyles(){return L(ee)},get update(){return ye}}}const Bk={top:"bottom",right:"left",bottom:"top",left:"right"};class Nk{constructor(){Ge(this,"anchorNode",Pe(null));Ge(this,"customAnchorNode",Pe(null));Ge(this,"triggerNode",Pe(null));Ct(()=>{this.customAnchorNode.current?typeof this.customAnchorNode.current=="string"?this.anchorNode.current=document.querySelector(this.customAnchorNode.current):this.anchorNode.current=this.customAnchorNode.current:this.anchorNode.current=this.triggerNode.current})}}var Jh,Yh,Qh,ed,fc,td,id,mc,ja,nd,rd,sd,od,ad,ld,$m,cd,Jm,ud,Ym,Qm,hd,dd,pd,fd,eg,tg,ig,ng,rg,sg,md,og,ag,lg,cg;class Vk{constructor(s,g){Ge(this,"root");Ge(this,"contentRef",Pe(null));Ge(this,"wrapperRef",Pe(null));Ge(this,"arrowRef",Pe(null));Ge(this,"arrowId",Pe(hn()));Ge(this,"id");Ge(this,"wrapperId");Ge(this,"style");H(this,Jh,Te(()=>{if(typeof this.style=="string")return ph(this.style);if(!this.style)return{}}));H(this,Yh);H(this,Qh);H(this,ed);H(this,fc);H(this,td);H(this,id);H(this,mc);H(this,ja);H(this,nd);H(this,rd);H(this,sd);H(this,od);H(this,ad);Ge(this,"onPlaced");Ge(this,"enabled");H(this,ld,new XI(()=>this.arrowRef.current??void 0));H(this,$m,Te(()=>{var s;return((s=I(this,ld))==null?void 0:s.width)??0}));H(this,cd,Te(()=>{var s;return((s=I(this,ld))==null?void 0:s.height)??0}));H(this,Jm,Te(()=>{var s;return((s=I(this,Qh))==null?void 0:s.current)+(I(this,fc).current!=="center"?`-${I(this,fc).current}`:"")}));H(this,ud,Te(()=>Array.isArray(I(this,ja).current)?I(this,ja).current:[I(this,ja).current]));H(this,Ym,Te(()=>L(I(this,ud)).length>0));H(this,Qm,Te(()=>({padding:I(this,nd).current,boundary:L(I(this,ud)).filter(VI),altBoundary:this.hasExplicitBoundaries})));H(this,hd,Qe(void 0));H(this,dd,Qe(void 0));H(this,pd,Qe(void 0));H(this,fd,Qe(void 0));H(this,eg,Te(()=>[Ak({mainAxis:I(this,ed).current+L(I(this,cd)),alignmentAxis:I(this,td).current}),I(this,mc)&&Ek({mainAxis:!0,crossAxis:!1,limiter:I(this,rd).current==="partial"?Rk():void 0,...this.detectOverflowOptions}),I(this,mc)&&Mk({...this.detectOverflowOptions}),zk({...this.detectOverflowOptions,apply:({rects:s,availableWidth:g,availableHeight:v})=>{const{width:T,height:C}=s.reference;je(I(this,hd),qe(g)),je(I(this,dd),qe(v)),je(I(this,pd),qe(T)),je(I(this,fd),qe(C))}}),this.arrowRef.current&&Lk({element:this.arrowRef.current,padding:I(this,id).current}),Hk({arrowWidth:L(I(this,$m)),arrowHeight:L(I(this,cd))}),I(this,sd).current&&Dk({strategy:"referenceHidden",...this.detectOverflowOptions})].filter(Boolean)));Ge(this,"floating");H(this,tg,Te(()=>Xk(this.floating.placement)));H(this,ig,Te(()=>Kk(this.floating.placement)));H(this,ng,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.x)??0}));H(this,rg,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.y)??0}));H(this,sg,Te(()=>{var s;return((s=this.floating.middlewareData.arrow)==null?void 0:s.centerOffset)!==0}));H(this,md,Qe());H(this,og,Te(()=>Bk[this.placedSide]));H(this,ag,Te(()=>{var s,g,v;return{id:this.wrapperId.current,"data-bits-floating-content-wrapper":"",style:{...this.floating.floatingStyles,transform:this.floating.isPositioned?this.floating.floatingStyles.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:this.contentZIndex,"--bits-floating-transform-origin":`${(s=this.floating.middlewareData.transformOrigin)==null?void 0:s.x} ${(g=this.floating.middlewareData.transformOrigin)==null?void 0:g.y}`,"--bits-floating-available-width":`${L(I(this,hd))}px`,"--bits-floating-available-height":`${L(I(this,dd))}px`,"--bits-floating-anchor-width":`${L(I(this,pd))}px`,"--bits-floating-anchor-height":`${L(I(this,fd))}px`,...((v=this.floating.middlewareData.hide)==null?void 0:v.referenceHidden)&&{visibility:"hidden","pointer-events":"none"},...L(I(this,Jh))},dir:I(this,Yh).current}}));H(this,lg,Te(()=>({"data-side":this.placedSide,"data-align":this.placedAlign,style:yv({...L(I(this,Jh))})})));H(this,cg,Te(()=>({position:"absolute",left:this.arrowX?`${this.arrowX}px`:void 0,top:this.arrowY?`${this.arrowY}px`:void 0,[this.arrowBaseSide]:0,"transform-origin":{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[this.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[this.placedSide],visibility:this.cannotCenterArrow?"hidden":void 0})));this.id=s.id,Ve(this,Qh,s.side),Ve(this,ed,s.sideOffset),Ve(this,fc,s.align),Ve(this,td,s.alignOffset),Ve(this,id,s.arrowPadding),Ve(this,mc,s.avoidCollisions),Ve(this,ja,s.collisionBoundary),Ve(this,nd,s.collisionPadding),Ve(this,rd,s.sticky),Ve(this,sd,s.hideWhenDetached),Ve(this,ad,s.updatePositionStrategy),this.onPlaced=s.onPlaced,Ve(this,od,s.strategy),Ve(this,Yh,s.dir),this.style=s.style,this.root=g,this.enabled=s.enabled,this.wrapperId=s.wrapperId,s.customAnchor&&(this.root.customAnchorNode.current=s.customAnchor.current),Ct(()=>{s.customAnchor.current,Oi(()=>{this.root.customAnchorNode.current=s.customAnchor.current})}),rn({id:this.wrapperId,ref:this.wrapperRef,deps:()=>this.enabled.current}),rn({id:this.id,ref:this.contentRef,deps:()=>this.enabled.current}),this.floating=Fk({strategy:()=>I(this,od).current,placement:()=>L(I(this,Jm)),middleware:()=>this.middleware,reference:this.root.anchorNode,whileElementsMounted:(...v)=>{var C;return kk(...v,{animationFrame:((C=I(this,ad))==null?void 0:C.current)==="always"})},open:()=>this.enabled.current}),Ct(()=>{var v;this.floating.isPositioned&&((v=this.onPlaced)==null||v.current())}),Ct(()=>{const v=this.contentRef.current;v&&Oi(()=>{this.contentZIndex=window.getComputedStyle(v).zIndex})}),Ct(()=>{this.floating.floating.current=this.wrapperRef.current})}get hasExplicitBoundaries(){return L(I(this,Ym))}get detectOverflowOptions(){return L(I(this,Qm))}get middleware(){return L(I(this,eg))}get placedSide(){return L(I(this,tg))}get placedAlign(){return L(I(this,ig))}get arrowX(){return L(I(this,ng))}get arrowY(){return L(I(this,rg))}get cannotCenterArrow(){return L(I(this,sg))}get contentZIndex(){return L(I(this,md))}set contentZIndex(s){je(I(this,md),qe(s))}get arrowBaseSide(){return L(I(this,og))}get wrapperProps(){return L(I(this,ag))}get props(){return L(I(this,lg))}get arrowStyle(){return L(I(this,cg))}}Jh=new WeakMap,Yh=new WeakMap,Qh=new WeakMap,ed=new WeakMap,fc=new WeakMap,td=new WeakMap,id=new WeakMap,mc=new WeakMap,ja=new WeakMap,nd=new WeakMap,rd=new WeakMap,sd=new WeakMap,od=new WeakMap,ad=new WeakMap,ld=new WeakMap,$m=new WeakMap,cd=new WeakMap,Jm=new WeakMap,ud=new WeakMap,Ym=new WeakMap,Qm=new WeakMap,hd=new WeakMap,dd=new WeakMap,pd=new WeakMap,fd=new WeakMap,eg=new WeakMap,tg=new WeakMap,ig=new WeakMap,ng=new WeakMap,rg=new WeakMap,sg=new WeakMap,md=new WeakMap,og=new WeakMap,ag=new WeakMap,lg=new WeakMap,cg=new WeakMap;class jk{constructor(s,g){Ge(this,"ref",Pe(null));s.virtualEl&&s.virtualEl.current?g.triggerNode=Pe.from(s.virtualEl.current):rn({id:s.id,ref:this.ref,onRefChange:v=>{g.triggerNode.current=v}})}}const[Uk,v1]=$a("Floating.Root"),[qk,WD]=$a("Floating.Content");function Zk(){return Uk(new Nk)}function Gk(h){return qk(new Vk(h,v1()))}function Wk(h){return new jk(h,v1())}function Hk(h){return{name:"transformOrigin",options:h,fn(s){var ce,ye,pe;const{placement:g,rects:v,middlewareData:T}=s,b=((ce=T.arrow)==null?void 0:ce.centerOffset)!==0,l=b?0:h.arrowWidth,j=b?0:h.arrowHeight,[U,K]=zv(g),B={start:"0%",center:"50%",end:"100%"}[K],V=(((ye=T.arrow)==null?void 0:ye.x)??0)+l/2,ne=(((pe=T.arrow)==null?void 0:pe.y)??0)+j/2;let Q="",ee="";return U==="bottom"?(Q=b?B:`${V}px`,ee=`${-j}px`):U==="top"?(Q=b?B:`${V}px`,ee=`${v.floating.height+j}px`):U==="right"?(Q=`${-j}px`,ee=b?B:`${ne}px`):U==="left"&&(Q=`${v.floating.width+j}px`,ee=b?B:`${ne}px`),{data:{x:Q,y:ee}}}}}function zv(h){const[s,g="center"]=h.split("-");return[s,g]}function Xk(h){return zv(h)[0]}function Kk(h){return zv(h)[1]}function $k(h,s){Pt(s,!0),Zk();var g=Xe(),v=Le(g);Ot(v,()=>s.children??ti),ve(h,g),It()}function Jk(h,s){Pt(s,!0),Wk({id:Pe.with(()=>s.id),virtualEl:Pe.with(()=>s.virtualEl)});var g=Xe(),v=Le(g);Ot(v,()=>s.children??ti),ve(h,g),It()}var Yk=Et("<div><!></div>");function Qk(h,s){Pt(s,!0);let g=ie(s,"side",3,"bottom"),v=ie(s,"sideOffset",3,0),T=ie(s,"align",3,"center"),C=ie(s,"alignOffset",3,0),b=ie(s,"arrowPadding",3,0),l=ie(s,"avoidCollisions",3,!0),j=ie(s,"collisionBoundary",19,()=>[]),U=ie(s,"collisionPadding",3,0),K=ie(s,"hideWhenDetached",3,!1),B=ie(s,"onPlaced",3,()=>{}),V=ie(s,"sticky",3,"partial"),ne=ie(s,"updatePositionStrategy",3,"optimized"),Q=ie(s,"strategy",3,"fixed"),ee=ie(s,"dir",3,"ltr"),ce=ie(s,"style",19,()=>({})),ye=ie(s,"wrapperId",19,hn),pe=ie(s,"customAnchor",3,null);const Ie=Gk({side:Pe.with(()=>g()),sideOffset:Pe.with(()=>v()),align:Pe.with(()=>T()),alignOffset:Pe.with(()=>C()),id:Pe.with(()=>s.id),arrowPadding:Pe.with(()=>b()),avoidCollisions:Pe.with(()=>l()),collisionBoundary:Pe.with(()=>j()),collisionPadding:Pe.with(()=>U()),hideWhenDetached:Pe.with(()=>K()),onPlaced:Pe.with(()=>B()),sticky:Pe.with(()=>V()),updatePositionStrategy:Pe.with(()=>ne()),strategy:Pe.with(()=>Q()),dir:Pe.with(()=>ee()),style:Pe.with(()=>ce()),enabled:Pe.with(()=>!1),wrapperId:Pe.with(()=>ye()),customAnchor:Pe.with(()=>pe())}),Oe=Te(()=>Vi(Ie.wrapperProps,{style:{pointerEvents:"auto"}}));var ze=Yk();let We;var $e=qt(ze);Ot($e,()=>s.content??ti,()=>({props:Ie.props})),Vt(ze),zt(()=>We=ji(ze,We,{...L(Oe)})),ve(h,ze),It()}function eA(h,s){Pt(s,!0),Cb(()=>{var T;(T=s.onPlaced)==null||T.call(s)});var g=Xe(),v=Le(g);Ot(v,()=>s.content??ti,()=>({props:{}})),ve(h,g),It()}function tA(h,s){let g=ie(s,"isStatic",3,!1),v=Kt(s,["$$slots","$$events","$$legacy","content","isStatic","onPlaced"]);var T=Xe(),C=Le(T);{var b=j=>{eA(j,{get content(){return s.content},get onPlaced(){return s.onPlaced}})},l=j=>{Qk(j,Gt({get content(){return s.content},get onPlaced(){return s.onPlaced}},()=>v))};fi(C,j=>{g()?j(b):j(l,!1)})}ve(h,T)}var iA=Et("<!> <!>",1);function x1(h,s){Pt(s,!0);let g=ie(s,"interactOutsideBehavior",3,"close"),v=ie(s,"trapFocus",3,!0),T=ie(s,"isValidEvent",3,()=>!1),C=ie(s,"customAnchor",3,null),b=ie(s,"isStatic",3,!1),l=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);tA(h,{get isStatic(){return b()},get id(){return s.id},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},content:(U,K)=>{let B=()=>K==null?void 0:K().props;var V=iA(),ne=Le(V);{var Q=pe=>{fm(pe,{get preventScroll(){return s.preventScroll}})},ee=pe=>{var Ie=Xe(),Oe=Le(Ie);{var ze=We=>{fm(We,{get preventScroll(){return s.preventScroll}})};fi(Oe,We=>{s.forceMount||We(ze)},!0)}ve(pe,Ie)};fi(ne,pe=>{s.forceMount&&s.enabled?pe(Q):pe(ee,!1)})}var ce=Wt(ne,2),ye=Te(()=>s.enabled&&v());r1(ce,{get id(){return s.id},get onOpenAutoFocus(){return s.onOpenAutoFocus},get onCloseAutoFocus(){return s.onCloseAutoFocus},get loop(){return s.loop},get trapFocus(){return L(ye)},get forceMount(){return s.forceMount},focusScope:(Ie,Oe)=>{let ze=()=>Oe==null?void 0:Oe().props;i1(Ie,{get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get enabled(){return s.enabled},children:(We,$e)=>{t1(We,{get id(){return s.id},get onInteractOutside(){return s.onInteractOutside},get onFocusOutside(){return s.onFocusOutside},get interactOutsideBehavior(){return g()},get isValidEvent(){return T()},get enabled(){return s.enabled},children:(He,Ye)=>{let Be=()=>Ye==null?void 0:Ye().props;o1(He,{get id(){return s.id},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get enabled(){return s.enabled},children:(Me,De)=>{var ke=Xe(),Ue=Le(ke),et=Up(()=>({props:Vi(l,B(),Be(),ze(),{style:{pointerEvents:"auto"}})}));Ot(Ue,()=>s.popper??ti,()=>L(et)),ve(Me,ke)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{focusScope:!0}}),ve(U,V)},$$slots:{content:!0}}),It()}function nA(h,s){let g=ie(s,"interactOutsideBehavior",3,"close"),v=ie(s,"trapFocus",3,!0),T=ie(s,"isValidEvent",3,()=>!1),C=ie(s,"customAnchor",3,null),b=ie(s,"isStatic",3,!1),l=Kt(s,["$$slots","$$events","$$legacy","popper","present","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic"]);wv(h,Gt({get id(){return s.id},get present(){return s.present}},()=>l,{presence:(U,K)=>{let B=()=>K==null?void 0:K().present;x1(U,Gt({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return b()},get enabled(){return B().current},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside},forceMount:!1},()=>l))},$$slots:{presence:!0}}))}function rA(h,s){let g=ie(s,"interactOutsideBehavior",3,"close"),v=ie(s,"trapFocus",3,!0),T=ie(s,"isValidEvent",3,()=>!1),C=ie(s,"customAnchor",3,null),b=ie(s,"isStatic",3,!1),l=Kt(s,["$$slots","$$events","$$legacy","popper","onEscapeKeydown","escapeKeydownBehavior","preventOverflowTextSelection","id","onPointerDown","onPointerUp","side","sideOffset","align","alignOffset","arrowPadding","avoidCollisions","collisionBoundary","collisionPadding","sticky","hideWhenDetached","updatePositionStrategy","strategy","dir","preventScroll","wrapperId","style","onPlaced","onInteractOutside","onCloseAutoFocus","onOpenAutoFocus","onFocusOutside","interactOutsideBehavior","loop","trapFocus","isValidEvent","customAnchor","isStatic","enabled"]);x1(h,Gt({get popper(){return s.popper},get onEscapeKeydown(){return s.onEscapeKeydown},get escapeKeydownBehavior(){return s.escapeKeydownBehavior},get preventOverflowTextSelection(){return s.preventOverflowTextSelection},get id(){return s.id},get onPointerDown(){return s.onPointerDown},get onPointerUp(){return s.onPointerUp},get side(){return s.side},get sideOffset(){return s.sideOffset},get align(){return s.align},get alignOffset(){return s.alignOffset},get arrowPadding(){return s.arrowPadding},get avoidCollisions(){return s.avoidCollisions},get collisionBoundary(){return s.collisionBoundary},get collisionPadding(){return s.collisionPadding},get sticky(){return s.sticky},get hideWhenDetached(){return s.hideWhenDetached},get updatePositionStrategy(){return s.updatePositionStrategy},get strategy(){return s.strategy},get dir(){return s.dir},get preventScroll(){return s.preventScroll},get wrapperId(){return s.wrapperId},get style(){return s.style},get onPlaced(){return s.onPlaced},get customAnchor(){return C()},get isStatic(){return b()},get enabled(){return s.enabled},get onInteractOutside(){return s.onInteractOutside},get onCloseAutoFocus(){return s.onCloseAutoFocus},get onOpenAutoFocus(){return s.onOpenAutoFocus},get interactOutsideBehavior(){return g()},get loop(){return s.loop},get trapFocus(){return v()},get isValidEvent(){return T()},get onFocusOutside(){return s.onFocusOutside}},()=>l,{forceMount:!0}))}function sA(h,s){let g=h.nextElementSibling;for(;g;){if(g.matches(s))return g;g=g.nextElementSibling}}function oA(h,s){let g=h.previousElementSibling;for(;g;){if(g.matches(s))return g;g=g.previousElementSibling}}const lb=1,aA=.9,lA=.8,cA=.17,V_=.1,j_=.999,uA=.9999,hA=.99,dA=/[\\/_+.#"@[({&]/,pA=/[\\/_+.#"@[({&]/g,fA=/[\s-]/,b1=/[\s-]/g;function lv(h,s,g,v,T,C,b){if(C===s.length)return T===h.length?lb:hA;const l=`${T},${C}`;if(b[l]!==void 0)return b[l];const j=v.charAt(C);let U=g.indexOf(j,T),K=0,B,V,ne,Q;for(;U>=0;)B=lv(h,s,g,v,U+1,C+1,b),B>K&&(U===T?B*=lb:dA.test(h.charAt(U-1))?(B*=lA,ne=h.slice(T,U-1).match(pA),ne&&T>0&&(B*=j_**ne.length)):fA.test(h.charAt(U-1))?(B*=aA,Q=h.slice(T,U-1).match(b1),Q&&T>0&&(B*=j_**Q.length)):(B*=cA,T>0&&(B*=j_**(U-T))),h.charAt(U)!==s.charAt(C)&&(B*=uA)),(B<V_&&g.charAt(U-1)===v.charAt(C+1)||v.charAt(C+1)===v.charAt(C)&&g.charAt(U-1)!==v.charAt(C))&&(V=lv(h,s,g,v,U+1,C+2,b),V*V_>B&&(B=V*V_)),B>K&&(K=B),U=g.indexOf(j,U+1);return b[l]=K,K}function cb(h){return h.toLowerCase().replace(b1," ")}function mA(h,s,g){return h=g&&g.length>0?`${`${h} ${g==null?void 0:g.join(" ")}`}`:h,lv(h,s,cb(h),cb(s),0,0,{})}function gA(h){if(!h)return null;for(const s of h.childNodes)if(s.nodeType!==Node.COMMENT_NODE)return s;return null}const yA="data-command-root",_A="data-command-list",vA="data-command-input",xA="data-command-empty",w1="data-command-group",S1="data-command-group-items",T1="data-command-group-heading",P1="data-command-item",Oa="data-value",bA="data-command-input-label",ch=`[${w1}]`,U_=`[${S1}]`,wA=`[${T1}]`,I1=`[${P1}]`,q_=`${I1}:not([aria-disabled="true"])`;function C1(h,s,g){return mA(h,s,g)}const[SA,Xc]=$a("Command.Root"),[TA,HD]=$a("Command.List"),[PA,dy]=$a("Command.Group");var gd,yd,_d,vd,gc,xd,bd,wd,yc,_c,vc,Xo,Ko,ug,xc,bc,Sd,Td,Pd,Id,hg,dg;class IA{constructor(s){Ge(this,"allItems",new Set);Ge(this,"allGroups",new Map);Ge(this,"allIds",new Map);Ge(this,"id");Ge(this,"ref");Ge(this,"filter");Ge(this,"shouldFilter");Ge(this,"loop");H(this,gd,Qe(0));H(this,yd,Qe(null));H(this,_d,Qe(null));H(this,vd,Qe(null));Ge(this,"valueProp");H(this,gc);Ge(this,"disablePointerSelection");H(this,xd,Qe(null));H(this,bd,Qe(null));Ge(this,"snapshot",()=>this._commandState);Ge(this,"setState",(s,g,v)=>{Object.is(this._commandState[s],g)||(this._commandState[s]=g,s==="search"?(I(this,vc).call(this),I(this,yc).call(this),I(this,_c).call(this)):s==="value"&&(v||I(this,ug).call(this)),this.emit())});Ge(this,"emit",()=>{this.commandState=Ab(this._commandState)});H(this,wd,(s,g)=>{const v=this.filter.current??C1;return s?v(s,this._commandState.search,g):0});H(this,yc,()=>{var b;if(!this._commandState.search||this.shouldFilter.current===!1)return;const s=this._commandState.filtered.items,g=[];for(const l of this._commandState.filtered.groups){const j=this.allGroups.get(l);let U=0;if(!j){g.push([l,U]);continue}for(const K of j){const B=s.get(K);U=Math.max(B??0,U)}g.push([l,U])}const v=this.viewportNode,T=I(this,Xo).call(this).sort((l,j)=>{const U=l.getAttribute("id"),K=j.getAttribute("id"),B=s.get(U)??0;return(s.get(K)??0)-B});for(const l of T){const j=l.closest(U_);if(j){const U=l.parentElement===j?l:l.closest(`${U_} > *`);U&&j.appendChild(U)}else{const U=l.parentElement===v?l:l.closest(`${U_} > *`);U&&(v==null||v.appendChild(U))}}const C=g.sort((l,j)=>j[1]-l[1]);for(const l of C){const j=v==null?void 0:v.querySelector(`${ch}[${Oa}="${encodeURIComponent(l[0])}"]`);(b=j==null?void 0:j.parentElement)==null||b.appendChild(j)}});Ge(this,"setValue",(s,g)=>{s!==this.valueProp.current&&s===""&&jc(()=>{this.key++}),this.setState("value",s,g),this.valueProp.current=s});H(this,_c,()=>{jc(()=>{const s=I(this,Xo).call(this).find(v=>v.getAttribute("aria-disabled")!=="true"),g=s==null?void 0:s.getAttribute(Oa);this.setValue(g||"")})});H(this,vc,()=>{var g,v;if(!this._commandState.search||this.shouldFilter.current===!1){this._commandState.filtered.count=this.allItems.size;return}this._commandState.filtered.groups=new Set;let s=0;for(const T of this.allItems){const C=((g=this.allIds.get(T))==null?void 0:g.value)??"",b=((v=this.allIds.get(T))==null?void 0:v.keywords)??[],l=I(this,wd).call(this,C,b);this._commandState.filtered.items.set(T,l),l>0&&s++}for(const[T,C]of this.allGroups)for(const b of C){const l=this._commandState.filtered.items.get(b);if(l&&l>0){this._commandState.filtered.groups.add(T);break}}this._commandState.filtered.count=s});H(this,Xo,()=>{const s=this.ref.current;return s?Array.from(s.querySelectorAll(q_)).filter(v=>!!v):[]});H(this,Ko,()=>{const s=this.ref.current;if(!s)return;const g=s.querySelector(`${q_}[aria-selected="true"]`);if(g)return g});H(this,ug,()=>{Zp(1,()=>{var T,C,b,l,j;const s=I(this,Ko).call(this);if(!s)return;const g=(T=s.parentElement)==null?void 0:T.parentElement;if(!g)return;const v=gA(g);if(v&&((C=v.dataset)==null?void 0:C.value)===((b=s.dataset)==null?void 0:b.value)){(j=(l=s==null?void 0:s.closest(ch))==null?void 0:l.querySelector(wA))==null||j.scrollIntoView({block:"nearest"});return}s.scrollIntoView({block:"nearest"})})});H(this,xc,s=>{const v=I(this,Xo).call(this)[s];v&&this.setValue(v.getAttribute(Oa)??"")});H(this,bc,s=>{const g=I(this,Ko).call(this),v=I(this,Xo).call(this),T=v.findIndex(b=>b===g);let C=v[T+s];this.loop.current&&(C=T+s<0?v[v.length-1]:T+s===v.length?v[0]:v[T+s]),C&&this.setValue(C.getAttribute(Oa)??"")});H(this,Sd,s=>{const g=I(this,Ko).call(this);let v=g==null?void 0:g.closest(ch),T;for(;v&&!T;)v=s>0?sA(v,ch):oA(v,ch),T=v==null?void 0:v.querySelector(q_);T?this.setValue(T.getAttribute(Oa)??""):I(this,bc).call(this,s)});Ge(this,"registerValue",(s,g,v)=>{var T;if(g!==((T=this.allIds.get(s))==null?void 0:T.value))return this.allIds.set(s,{value:g,keywords:v}),this._commandState.filtered.items.set(s,I(this,wd).call(this,g,v)),I(this,yc).call(this),this.emit(),()=>{this.allIds.delete(s)}});Ge(this,"registerItem",(s,g)=>(this.allItems.add(s),g&&(this.allGroups.has(g)?this.allGroups.get(g).add(s):this.allGroups.set(g,new Set([s]))),I(this,vc).call(this),I(this,yc).call(this),this.commandState.value||I(this,_c).call(this),this.emit(),()=>{this.allIds.delete(s),this.allItems.delete(s),this.commandState.filtered.items.delete(s);const v=I(this,Ko).call(this);I(this,vc).call(this),(v==null?void 0:v.getAttribute("id"))===s&&I(this,_c).call(this),this.emit()}));Ge(this,"registerGroup",s=>(this.allGroups.has(s)||this.allGroups.set(s,new Set),()=>{this.allIds.delete(s),this.allGroups.delete(s)}));H(this,Td,()=>I(this,xc).call(this,I(this,Xo).call(this).length-1));H(this,Pd,s=>{s.preventDefault(),s.metaKey?I(this,Td).call(this):s.altKey?I(this,Sd).call(this,1):I(this,bc).call(this,1)});H(this,Id,s=>{s.preventDefault(),s.metaKey?I(this,xc).call(this,0):s.altKey?I(this,Sd).call(this,-1):I(this,bc).call(this,-1)});H(this,hg,s=>{switch(s.key){case RI:case OI:{I(this,gc).current&&s.ctrlKey&&I(this,Pd).call(this,s);break}case kI:I(this,Pd).call(this,s);break;case LI:case FI:{I(this,gc).current&&s.ctrlKey&&I(this,Id).call(this,s);break}case AI:I(this,Id).call(this,s);break;case zI:s.preventDefault(),I(this,xc).call(this,0);break;case EI:s.preventDefault(),I(this,Td).call(this);break;case ly:if(!s.isComposing&&s.keyCode!==229){s.preventDefault();const g=I(this,Ko).call(this);g&&(g==null||g.click())}}});H(this,dg,Te(()=>({id:this.id.current,role:"application",[yA]:"",tabindex:-1,onkeydown:I(this,hg)})));this.id=s.id,this.ref=s.ref,this.filter=s.filter,this.shouldFilter=s.shouldFilter,this.loop=s.loop,this.valueProp=s.value,Ve(this,gc,s.vimBindings),this.disablePointerSelection=s.disablePointerSelection;const g={search:"",value:this.valueProp.current??"",filtered:{count:0,items:new Map,groups:new Set}};this._commandState=g,this.commandState=g,rn({id:this.id,ref:this.ref})}get key(){return L(I(this,gd))}set key(s){je(I(this,gd),qe(s))}get viewportNode(){return L(I(this,yd))}set viewportNode(s){je(I(this,yd),qe(s))}get inputNode(){return L(I(this,_d))}set inputNode(s){je(I(this,_d),qe(s))}get labelNode(){return L(I(this,vd))}set labelNode(s){je(I(this,vd),qe(s))}get commandState(){return L(I(this,xd))}set commandState(s){je(I(this,xd),s)}get _commandState(){return L(I(this,bd))}set _commandState(s){je(I(this,bd),qe(s))}get props(){return L(I(this,dg))}}gd=new WeakMap,yd=new WeakMap,_d=new WeakMap,vd=new WeakMap,gc=new WeakMap,xd=new WeakMap,bd=new WeakMap,wd=new WeakMap,yc=new WeakMap,_c=new WeakMap,vc=new WeakMap,Xo=new WeakMap,Ko=new WeakMap,ug=new WeakMap,xc=new WeakMap,bc=new WeakMap,Sd=new WeakMap,Td=new WeakMap,Pd=new WeakMap,Id=new WeakMap,hg=new WeakMap,dg=new WeakMap;var Cd,wc,kd,Ad,Ed,pg,fg;class CA{constructor(s,g){H(this,Cd);H(this,wc);H(this,kd);H(this,Ad);H(this,Ed,!0);H(this,pg,Te(()=>I(this,kd)._commandState.filtered.count===0&&I(this,Ed)===!1||I(this,Ad).current));H(this,fg,Te(()=>({id:I(this,wc).current,role:"presentation",[xA]:""})));Ve(this,Cd,s.ref),Ve(this,wc,s.id),Ve(this,kd,g),Ve(this,Ad,s.forceMount),Ct(()=>{Ve(this,Ed,!1)}),rn({id:I(this,wc),ref:I(this,Cd),deps:()=>this.shouldRender})}get shouldRender(){return L(I(this,pg))}get props(){return L(I(this,fg))}}Cd=new WeakMap,wc=new WeakMap,kd=new WeakMap,Ad=new WeakMap,Ed=new WeakMap,pg=new WeakMap,fg=new WeakMap;var Ua,qa,os,Md,mg,zd,gg;class kA{constructor(s,g){H(this,Ua);Ge(this,"id");Ge(this,"forceMount");H(this,qa);H(this,os);H(this,Md,Qe(null));H(this,mg,Te(()=>this.forceMount.current||I(this,os).shouldFilter.current===!1||!I(this,os).commandState.search?!0:I(this,os).commandState.filtered.groups.has(this.id.current)));H(this,zd,Qe(""));H(this,gg,Te(()=>({id:this.id.current,role:"presentation",hidden:this.shouldRender?void 0:!0,"data-value":this.trueValue,[w1]:""})));Ve(this,Ua,s.ref),this.id=s.id,Ve(this,os,g),this.forceMount=s.forceMount,Ve(this,qa,s.value),this.trueValue=s.value.current,rn({id:this.id,ref:I(this,Ua),deps:()=>this.shouldRender}),Ct(()=>I(this,os).registerGroup(this.id.current)),Ct(()=>{var v;if(I(this,qa).current)return this.trueValue=I(this,qa).current,I(this,os).registerValue(this.id.current,I(this,qa).current);if(this.headingNode&&this.headingNode.textContent)return this.trueValue=this.headingNode.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue);if((v=I(this,Ua).current)!=null&&v.textContent)return this.trueValue=I(this,Ua).current.textContent.trim().toLowerCase(),I(this,os).registerValue(this.id.current,this.trueValue)})}get headingNode(){return L(I(this,Md))}set headingNode(s){je(I(this,Md),qe(s))}get shouldRender(){return L(I(this,mg))}get trueValue(){return L(I(this,zd))}set trueValue(s){je(I(this,zd),qe(s))}get props(){return L(I(this,gg))}createGroupHeading(s){return new k1(s,this)}createGroupItems(s){return new A1(s,this)}}Ua=new WeakMap,qa=new WeakMap,os=new WeakMap,Md=new WeakMap,mg=new WeakMap,zd=new WeakMap,gg=new WeakMap;var Dd,Sc,Ld,yg;class k1{constructor(s,g){H(this,Dd);H(this,Sc);H(this,Ld);H(this,yg,Te(()=>({id:I(this,Sc).current,[T1]:""})));Ve(this,Dd,s.ref),Ve(this,Sc,s.id),Ve(this,Ld,g),rn({id:I(this,Sc),ref:I(this,Dd),onRefChange:v=>{I(this,Ld).headingNode=v}})}get props(){return L(I(this,yg))}}Dd=new WeakMap,Sc=new WeakMap,Ld=new WeakMap,yg=new WeakMap;var Rd,Tc,Od,_g;class A1{constructor(s,g){H(this,Rd);H(this,Tc);H(this,Od);H(this,_g,Te(()=>{var s;return{id:I(this,Tc).current,role:"group",[S1]:"","aria-labelledby":((s=I(this,Od).headingNode)==null?void 0:s.id)??void 0}}));Ve(this,Rd,s.ref),Ve(this,Tc,s.id),Ve(this,Od,g),rn({id:I(this,Tc),ref:I(this,Rd)})}get props(){return L(I(this,_g))}}Rd=new WeakMap,Tc=new WeakMap,Od=new WeakMap,_g=new WeakMap;var Pc,Ic,Ss,$o,Fd,vg,xg;class AA{constructor(s,g){H(this,Pc);H(this,Ic);H(this,Ss);H(this,$o);H(this,Fd);H(this,vg,Te(()=>{var g;const s=(g=I(this,Ss).viewportNode)==null?void 0:g.querySelector(`${I1}[${Oa}="${encodeURIComponent(I(this,$o).current)}"]`);if(s)return(s==null?void 0:s.getAttribute("id"))??void 0}));H(this,xg,Te(()=>{var s,g;return{id:I(this,Ic).current,type:"text",[vA]:"",autocomplete:"off",autocorrect:"off",spellcheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":vv(!0),"aria-controls":((s=I(this,Ss).viewportNode)==null?void 0:s.id)??void 0,"aria-labelledby":((g=I(this,Ss).labelNode)==null?void 0:g.id)??void 0,"aria-activedescendant":L(I(this,vg))}}));Ve(this,Pc,s.ref),Ve(this,Ic,s.id),Ve(this,Ss,g),Ve(this,$o,s.value),Ve(this,Fd,s.autofocus),rn({id:I(this,Ic),ref:I(this,Pc),onRefChange:v=>{I(this,Ss).inputNode=v}}),Ct(()=>{const v=I(this,Pc).current;Oi(()=>{v&&I(this,Fd).current&&Zp(10,()=>v.focus())})}),Ct(()=>{I(this,$o).current,Oi(()=>{I(this,Ss).commandState.search!==I(this,$o).current&&I(this,Ss).setState("search",I(this,$o).current)})})}get props(){return L(I(this,xg))}}Pc=new WeakMap,Ic=new WeakMap,Ss=new WeakMap,$o=new WeakMap,Fd=new WeakMap,vg=new WeakMap,xg=new WeakMap;var Cc,Bd,Ts,Nd,kc,Za,bg,Vd,wg,Sg,Tg,jd,Pg,Ig,Cg;class EA{constructor(s,g){H(this,Cc);Ge(this,"id");Ge(this,"root");H(this,Bd);H(this,Ts);H(this,Nd);H(this,kc);H(this,Za,null);H(this,bg,Te(()=>{var s;return I(this,kc).current||((s=I(this,Za))==null?void 0:s.forceMount.current)===!0}));H(this,Vd,Qe(""));H(this,wg,Te(()=>{if(L(I(this,bg))||this.root.shouldFilter.current===!1||!this.root.commandState.search)return!0;const s=this.root.commandState.filtered.items.get(this.id.current);return s===void 0?!1:s>0}));H(this,Sg,Te(()=>this.root.valueProp.current===this.trueValue&&this.trueValue!==""));H(this,Tg,()=>{var s;I(this,Ts).current||(I(this,jd).call(this),(s=I(this,Nd))==null||s.current())});H(this,jd,()=>{I(this,Ts).current||this.root.setValue(this.trueValue,!0)});H(this,Pg,()=>{I(this,Ts).current||this.root.disablePointerSelection.current||I(this,jd).call(this)});H(this,Ig,()=>{I(this,Ts).current||I(this,Tg).call(this)});H(this,Cg,Te(()=>({id:this.id.current,"aria-disabled":TI(I(this,Ts).current),"aria-selected":II(this.isSelected),"data-disabled":PI(I(this,Ts).current),"data-selected":CI(this.isSelected),[P1]:"",role:"option",onpointermove:I(this,Pg),onclick:I(this,Ig)})));Ve(this,Cc,s.ref),this.id=s.id,this.root=g,Ve(this,Bd,s.value),Ve(this,Ts,s.disabled),Ve(this,Nd,s.onSelect),Ve(this,kc,s.forceMount),Ve(this,Za,dy(null)),this.trueValue=s.value.current,rn({id:this.id,ref:I(this,Cc),deps:()=>!!this.root.commandState.search}),Ct(()=>{var v;if(this.id.current,(v=I(this,Za))==null||v.id.current,!I(this,kc).current)return Oi(()=>{var T;return this.root.registerItem(this.id.current,(T=I(this,Za))==null?void 0:T.id.current)})}),Ct(()=>{const v=I(this,Bd).current,T=I(this,Cc).current;T&&(!v&&T.textContent&&(this.trueValue=T.textContent.trim()),Oi(()=>{this.root.registerValue(this.id.current,this.trueValue,s.keywords.current.map(C=>C.trim())),T.setAttribute(Oa,this.trueValue)}))})}get trueValue(){return L(I(this,Vd))}set trueValue(s){je(I(this,Vd),qe(s))}get shouldRender(){return L(I(this,wg))}get isSelected(){return L(I(this,Sg))}get props(){return L(I(this,Cg))}}Cc=new WeakMap,Bd=new WeakMap,Ts=new WeakMap,Nd=new WeakMap,kc=new WeakMap,Za=new WeakMap,bg=new WeakMap,Vd=new WeakMap,wg=new WeakMap,Sg=new WeakMap,Tg=new WeakMap,jd=new WeakMap,Pg=new WeakMap,Ig=new WeakMap,Cg=new WeakMap;var Ac,Ud,kg;class MA{constructor(s,g){Ge(this,"ref");H(this,Ac);H(this,Ud);Ge(this,"root");H(this,kg,Te(()=>({id:I(this,Ac).current,role:"listbox","aria-label":I(this,Ud).current,[_A]:""})));this.ref=s.ref,Ve(this,Ac,s.id),this.root=g,Ve(this,Ud,s.ariaLabel),rn({id:I(this,Ac),ref:this.ref})}get props(){return L(I(this,kg))}}Ac=new WeakMap,Ud=new WeakMap,kg=new WeakMap;var qd,Ec,Zd,Gd,Ag;class zA{constructor(s,g){H(this,qd);H(this,Ec);H(this,Zd);H(this,Gd);H(this,Ag,Te(()=>{var s;return{id:I(this,Ec).current,[bA]:"",for:(s=I(this,Gd))==null?void 0:s.current,style:$b}}));Ve(this,qd,s.ref),Ve(this,Ec,s.id),Ve(this,Zd,g),Ve(this,Gd,s.for),rn({id:I(this,Ec),ref:I(this,qd),onRefChange:v=>{I(this,Zd).labelNode=v}})}get props(){return L(I(this,Ag))}}qd=new WeakMap,Ec=new WeakMap,Zd=new WeakMap,Gd=new WeakMap,Ag=new WeakMap;function DA(h){return SA(new IA(h))}function LA(h){const s=Xc();return new CA(h,s)}function RA(h){const s=Xc();return new EA(h,s)}function OA(h){const s=Xc();return PA(new kA(h,s))}function FA(h){const s=dy();return new k1(h,s)}function BA(h){const s=dy();return new A1(h,s)}function NA(h){const s=Xc();return new AA(h,s)}function VA(h){const s=Xc();return TA(new MA(h,s))}function jA(h){const s=Xc();return new zA(h,s)}var UA=Et("<label><!></label>");function qA(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=jA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),K=>v(K))}),b=Te(()=>Vi(T,C.props));var l=UA();let j;var U=qt(l);Ot(U,()=>s.children??ti),Vt(l),zt(()=>j=ji(l,j,{...L(b)})),ve(h,l),It()}var ZA=Et("<!> <!>",1),GA=Et("<div><!> <!></div>");function WA(h,s){Pt(s,!0);const g=ze=>{qA(ze,{children:(We,$e)=>{ia();var xt=On();zt(()=>Ri(xt,K())),ve(We,xt)},$$slots:{default:!0}})};let v=ie(s,"id",19,hn),T=ie(s,"ref",15,null),C=ie(s,"value",15,""),b=ie(s,"onValueChange",3,nn),l=ie(s,"loop",3,!1),j=ie(s,"shouldFilter",3,!0),U=ie(s,"filter",3,C1),K=ie(s,"label",3,""),B=ie(s,"vimBindings",3,!0),V=ie(s,"disablePointerSelection",3,!1),ne=ie(s,"controlledValue",3,!1),Q=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","loop","shouldFilter","filter","label","vimBindings","disablePointerSelection","controlledValue","children","child"]);const ee=DA({id:Pe.with(()=>v()),ref:Pe.with(()=>T(),ze=>T(ze)),filter:Pe.with(()=>U()),shouldFilter:Pe.with(()=>j()),loop:Pe.with(()=>l()),value:Pe.with(()=>C(),ze=>{ne()||C(ze),b()(ze)}),vimBindings:Pe.with(()=>B()),disablePointerSelection:Pe.with(()=>V())}),ce=Te(()=>Vi(Q,ee.props));var ye=Xe(),pe=Le(ye);{var Ie=ze=>{var We=ZA(),$e=Le(We);g($e);var xt=Wt($e,2);Ot(xt,()=>s.child,()=>({props:L(ce)})),ve(ze,We)},Oe=ze=>{var We=GA();let $e;var xt=qt(We);g(xt);var He=Wt(xt,2);Ot(He,()=>s.children??ti),Vt(We),zt(()=>$e=ji(We,$e,{...L(ce)})),ve(ze,We)};fi(pe,ze=>{s.child?ze(Ie):ze(Oe,!1)})}ve(h,ye),It()}var HA=Et("<div><!></div>");function XA(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"forceMount",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child","forceMount"]);const b=LA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B)),forceMount:Pe.with(()=>T())}),l=Te(()=>Vi(b.props,C));var j=Xe(),U=Le(j);{var K=B=>{var V=Xe(),ne=Le(V);{var Q=ce=>{var ye=Xe(),pe=Le(ye);Ot(pe,()=>s.child,()=>({props:L(l)})),ve(ce,ye)},ee=ce=>{var ye=HA();let pe;var Ie=qt(ye);Ot(Ie,()=>s.children??ti),Vt(ye),zt(()=>pe=ji(ye,pe,{...L(l)})),ve(ce,ye)};fi(ne,ce=>{s.child?ce(Q):ce(ee,!1)})}ve(B,V)};fi(U,B=>{b.shouldRender&&B(K)})}ve(h,j),It()}var KA=Et("<div><!></div>");function $A(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"value",3,""),C=ie(s,"forceMount",3,!1),b=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","forceMount","children","child"]);const l=OA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ne=>v(ne)),forceMount:Pe.with(()=>C()),value:Pe.with(()=>T())}),j=Te(()=>Vi(b,l.props));var U=Xe(),K=Le(U);{var B=ne=>{var Q=Xe(),ee=Le(Q);Ot(ee,()=>s.child,()=>({props:L(j)})),ve(ne,Q)},V=ne=>{var Q=KA();let ee;var ce=qt(Q);Ot(ce,()=>s.children??ti),Vt(Q),zt(()=>ee=ji(Q,ee,{...L(j)})),ve(ne,Q)};fi(K,ne=>{s.child?ne(B):ne(V,!1)})}ve(h,U),It()}var JA=Et("<div><!></div>");function YA(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=FA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var l=Xe(),j=Le(l);{var U=B=>{var V=Xe(),ne=Le(V);Ot(ne,()=>s.child,()=>({props:L(b)})),ve(B,V)},K=B=>{var V=JA();let ne;var Q=qt(V);Ot(Q,()=>s.children??ti),Vt(V),zt(()=>ne=ji(V,ne,{...L(b)})),ve(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}ve(h,l),It()}var QA=Et("<div><!></div>"),eE=Et('<div style="display: contents;"><!></div>');function tE(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children","child"]);const C=BA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B))}),b=Te(()=>Vi(T,C.props));var l=eE(),j=qt(l);{var U=B=>{var V=Xe(),ne=Le(V);Ot(ne,()=>s.child,()=>({props:L(b)})),ve(B,V)},K=B=>{var V=QA();let ne;var Q=qt(V);Ot(Q,()=>s.children??ti),Vt(V),zt(()=>ne=ji(V,ne,{...L(b)})),ve(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}Vt(l),ve(h,l),It()}var iE=Et("<input>");function nE(h,s){Pt(s,!0);let g=ie(s,"value",15,""),v=ie(s,"autofocus",3,!1),T=ie(s,"id",19,hn),C=ie(s,"ref",15,null),b=Kt(s,["$$slots","$$events","$$legacy","value","autofocus","id","ref","child"]);const l=NA({id:Pe.with(()=>T()),ref:Pe.with(()=>C(),ne=>C(ne)),value:Pe.with(()=>g(),ne=>{g(ne)}),autofocus:Pe.with(()=>v()??!1)}),j=Te(()=>Vi(b,l.props));var U=Xe(),K=Le(U);{var B=ne=>{var Q=Xe(),ee=Le(Q);Ot(ee,()=>s.child,()=>({props:L(j)})),ve(ne,Q)},V=ne=>{var Q=iE();vS(Q);let ee;zt(()=>ee=ji(Q,ee,{...L(j)})),IS(Q,g),ve(ne,Q)};fi(K,ne=>{s.child?ne(B):ne(V,!1)})}ve(h,U),It()}var rE=Et("<div><!></div>"),sE=Et('<div style="display: contents;" data-item-wrapper=""><!></div>');function oE(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"value",3,""),C=ie(s,"disabled",3,!1),b=ie(s,"onSelect",3,nn),l=ie(s,"forceMount",3,!1),j=ie(s,"keywords",19,()=>[]),U=Kt(s,["$$slots","$$events","$$legacy","id","ref","value","disabled","children","child","onSelect","forceMount","keywords"]);const K=dy(null),B=RA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ee=>v(ee)),value:Pe.with(()=>T()),disabled:Pe.with(()=>C()),onSelect:Pe.with(()=>b()),forceMount:Pe.with(()=>l()),keywords:Pe.with(()=>j()),group:K}),V=Te(()=>Vi(U,B.props));var ne=Xe(),Q=Le(ne);kb(Q,()=>B.root.key,ee=>{var ce=sE(),ye=qt(ce);{var pe=Ie=>{var Oe=Xe(),ze=Le(Oe);{var We=xt=>{var He=Xe(),Ye=Le(He);Ot(Ye,()=>s.child,()=>({props:L(V)})),ve(xt,He)},$e=xt=>{var He=rE();let Ye;var Be=qt(He);Ot(Be,()=>s.children??ti),Vt(He),zt(()=>Ye=ji(He,Ye,{...L(V)})),ve(xt,He)};fi(ze,xt=>{s.child?xt(We):xt($e,!1)})}ve(Ie,Oe)};fi(ye,Ie=>{B.shouldRender&&Ie(pe)})}Vt(ce),zt(()=>mh(ce,"data-value",T())),ve(ee,ce)}),ve(h,ne),It()}var aE=Et("<div><!></div>");function lE(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","child","children","aria-label"]);const C=VA({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),B=>v(B)),ariaLabel:Pe.with(()=>s["aria-label"]??"Suggestions...")}),b=Te(()=>Vi(T,C.props));var l=Xe(),j=Le(l);{var U=B=>{var V=Xe(),ne=Le(V);Ot(ne,()=>s.child,()=>({props:L(b)})),ve(B,V)},K=B=>{var V=aE();let ne;var Q=qt(V);Ot(Q,()=>s.children??ti),Vt(V),zt(()=>ne=ji(V,ne,{...L(b)})),ve(B,V)};fi(j,B=>{s.child?B(U):B(K,!1)})}ve(h,l),It()}var Wd,Hd,Xd;class cE{constructor(s){Ge(this,"open");H(this,Wd,Qe(null));H(this,Hd,Qe(void 0));H(this,Xd,Qe(null));Ge(this,"toggleOpen",()=>{this.open.current=!this.open.current});Ge(this,"close",()=>{this.open.current&&(this.open.current=!1)});this.open=s.open}get contentNode(){return L(I(this,Wd))}set contentNode(s){je(I(this,Wd),qe(s))}get contentId(){return L(I(this,Hd))}set contentId(s){je(I(this,Hd),qe(s))}get triggerNode(){return L(I(this,Xd))}set triggerNode(s){je(I(this,Xd),qe(s))}}Wd=new WeakMap,Hd=new WeakMap,Xd=new WeakMap;var Mc,Kd,Jo,Vr,Eg,Mg,zg,Dg,Lg;class uE{constructor(s,g){H(this,Mc);H(this,Kd);H(this,Jo);H(this,Vr);H(this,Eg,s=>{if(!I(this,Jo).current){if(s.pointerType==="touch"||s.button!==0)return s.preventDefault();I(this,Vr).toggleOpen()}});H(this,Mg,s=>{I(this,Jo).current||s.pointerType==="touch"&&(s.preventDefault(),I(this,Vr).toggleOpen())});H(this,zg,s=>{I(this,Jo).current||(s.key===ly||s.key===xv)&&(s.preventDefault(),I(this,Vr).toggleOpen())});H(this,Dg,()=>{if(I(this,Vr).open.current&&I(this,Vr).contentId)return I(this,Vr).contentId});H(this,Lg,Te(()=>({id:I(this,Mc).current,"aria-haspopup":"dialog","aria-expanded":vv(I(this,Vr).open.current),"data-state":_v(I(this,Vr).open.current),"aria-controls":I(this,Dg).call(this),"data-popover-trigger":"",disabled:I(this,Jo).current,onpointerdown:I(this,Eg),onkeydown:I(this,zg),onpointerup:I(this,Mg)})));Ve(this,Mc,s.id),Ve(this,Vr,g),Ve(this,Kd,s.ref),Ve(this,Jo,s.disabled),rn({id:I(this,Mc),ref:I(this,Kd),onRefChange:v=>{I(this,Vr).triggerNode=v}})}get props(){return L(I(this,Lg))}}Mc=new WeakMap,Kd=new WeakMap,Jo=new WeakMap,Vr=new WeakMap,Eg=new WeakMap,Mg=new WeakMap,zg=new WeakMap,Dg=new WeakMap,Lg=new WeakMap;var zc,$d,Rg,Og;class hE{constructor(s,g){H(this,zc);H(this,$d);Ge(this,"root");H(this,Rg,Te(()=>({open:this.root.open.current})));H(this,Og,Te(()=>({id:I(this,zc).current,tabindex:-1,"data-state":_v(this.root.open.current),"data-popover-content":"",style:{pointerEvents:"auto"}})));Ve(this,zc,s.id),this.root=g,Ve(this,$d,s.ref),rn({id:I(this,zc),ref:I(this,$d),deps:()=>this.root.open.current,onRefChange:v=>{this.root.contentNode=v,this.root.contentId=v==null?void 0:v.id}})}get snippetProps(){return L(I(this,Rg))}get props(){return L(I(this,Og))}}zc=new WeakMap,$d=new WeakMap,Rg=new WeakMap,Og=new WeakMap;const[dE,E1]=$a("Popover.Root");function pE(h){return dE(new cE(h))}function fE(h){return new uE(h,E1())}function mE(h){return new hE(h,E1())}var gE=Et("<div><!></div>"),yE=Et("<div><!></div>");function _E(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=ie(s,"id",19,hn),T=ie(s,"forceMount",3,!1),C=ie(s,"onCloseAutoFocus",3,nn),b=ie(s,"onEscapeKeydown",3,nn),l=ie(s,"onInteractOutside",3,nn),j=ie(s,"trapFocus",3,!0),U=ie(s,"preventScroll",3,!1),K=Kt(s,["$$slots","$$events","$$legacy","child","children","ref","id","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll"]);const B=mE({id:Pe.with(()=>v()),ref:Pe.with(()=>g(),Oe=>g(Oe))}),V=Te(()=>Vi(K,B.props));function ne(Oe){l()(Oe),!Oe.defaultPrevented&&B.root.close()}function Q(Oe){b()(Oe),!Oe.defaultPrevented&&B.root.close()}function ee(Oe){var ze;C()(Oe),!Oe.defaultPrevented&&(Oe.preventDefault(),(ze=B.root.triggerNode)==null||ze.focus())}var ce=Xe(),ye=Le(ce);{var pe=Oe=>{rA(Oe,Gt(()=>L(V),{get enabled(){return B.root.open.current},get id(){return v()},onInteractOutside:ne,onEscapeKeydown:Q,onCloseAutoFocus:ee,get trapFocus(){return j()},get preventScroll(){return U()},loop:!0,forceMount:!0,popper:(We,$e)=>{let xt=()=>$e==null?void 0:$e().props;var He=Xe();const Ye=Te(()=>Vi(xt(),{style:ab("popover")}));var Be=Le(He);{var Me=ke=>{var Ue=Xe(),et=Le(Ue);Ot(et,()=>s.child,()=>({props:L(Ye),...B.snippetProps})),ve(ke,Ue)},De=ke=>{var Ue=gE();let et;var pt=qt(Ue);Ot(pt,()=>s.children??ti),Vt(Ue),zt(()=>et=ji(Ue,et,{...L(Ye)})),ve(ke,Ue)};fi(Be,ke=>{s.child?ke(Me):ke(De,!1)})}ve(We,He)},$$slots:{popper:!0}}))},Ie=Oe=>{var ze=Xe(),We=Le(ze);{var $e=xt=>{nA(xt,Gt(()=>L(V),{get present(){return B.root.open.current},get id(){return v()},onInteractOutside:ne,onEscapeKeydown:Q,onCloseAutoFocus:ee,get trapFocus(){return j()},get preventScroll(){return U()},loop:!0,forceMount:!1,popper:(Ye,Be)=>{let Me=()=>Be==null?void 0:Be().props;var De=Xe();const ke=Te(()=>Vi(Me(),{style:ab("popover")}));var Ue=Le(De);{var et=ut=>{var ct=Xe(),at=Le(ct);Ot(at,()=>s.child,()=>({props:L(ke),...B.snippetProps})),ve(ut,ct)},pt=ut=>{var ct=yE();let at;var Mt=qt(ct);Ot(Mt,()=>s.children??ti),Vt(ct),zt(()=>at=ji(ct,at,{...L(ke)})),ve(ut,ct)};fi(Ue,ut=>{s.child?ut(et):ut(pt,!1)})}ve(Ye,De)},$$slots:{popper:!0}}))};fi(We,xt=>{T()||xt($e)},!0)}ve(Oe,ze)};fi(ye,Oe=>{T()?Oe(pe):Oe(Ie,!1)})}ve(h,ce),It()}var vE=Et("<button><!></button>");function xE(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"type",3,"button"),C=ie(s,"disabled",3,!1),b=Kt(s,["$$slots","$$events","$$legacy","children","child","id","ref","type","disabled"]);const l=fE({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),V=>v(V)),disabled:Pe.with(()=>!!C())}),j=Te(()=>Vi(b,l.props,{type:T()})),U=la(),[K,B]=U;Jk(h,{get id(){return g()},children:(V,ne)=>{var Q=Xe(),ee=Le(Q);{var ce=pe=>{var Ie=Xe(),Oe=Le(Ie);Ot(Oe,()=>s.child,()=>({props:L(j)})),ve(pe,Ie)},ye=pe=>{var Ie=vE();const Oe=Te(()=>B({...L(j)},[{attribute_name:"formaction"}]));let ze;var We=qt(Ie);Ot(We,()=>s.children??ti),Vt(Ie),zt(()=>ze=ji(Ie,ze,{...L(Oe)})),ve(pe,Ie)};fi(ee,pe=>{s.child?pe(ce):pe(ye,!1)})}ve(V,Q)},$$slots:{default:!0}}),It()}function M1(h,s){Pt(s,!0);let g=ie(s,"open",15,!1),v=ie(s,"onOpenChange",3,nn),T=ie(s,"controlledOpen",3,!1);aC({variant:Pe.with(()=>"dialog"),open:Pe.with(()=>g(),l=>{T()||g(l),v()(l)})});var C=Xe(),b=Le(C);Ot(b,()=>s.children??ti),ve(h,C),It()}var bE=Et("<button><!></button>");function wE(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"disabled",3,!1),C=Kt(s,["$$slots","$$events","$$legacy","children","child","id","ref","disabled"]);const b=pC({variant:Pe.with(()=>"close"),id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ee=>v(ee)),disabled:Pe.with(()=>!!T())}),l=Te(()=>Vi(C,b.props)),j=la(),[U,K]=j;var B=Xe(),V=Le(B);{var ne=ee=>{var ce=Xe(),ye=Le(ce);Ot(ye,()=>s.child,()=>({props:L(l)})),ve(ee,ce)},Q=ee=>{var ce=bE();const ye=Te(()=>K({...L(l)},[{attribute_name:"formaction"}]));let pe;var Ie=qt(ce);Ot(Ie,()=>s.children??ti),Vt(ce),zt(()=>pe=ji(ce,pe,{...L(ye)})),ve(ee,ce)};fi(V,ee=>{s.child?ee(ne):ee(Q,!1)})}ve(h,B),It()}var SE=Et("<!> <!>",1),TE=Et("<!> <div><!></div>",1);function z1(h,s){Pt(s,!0);let g=ie(s,"id",19,hn),v=ie(s,"ref",15,null),T=ie(s,"forceMount",3,!1),C=ie(s,"onCloseAutoFocus",3,nn),b=ie(s,"onEscapeKeydown",3,nn),l=ie(s,"onInteractOutside",3,nn),j=ie(s,"trapFocus",3,!0),U=ie(s,"preventScroll",3,!0),K=ie(s,"restoreScrollDelay",3,null),B=Kt(s,["$$slots","$$events","$$legacy","id","children","child","ref","forceMount","onCloseAutoFocus","onEscapeKeydown","onInteractOutside","trapFocus","preventScroll","restoreScrollDelay"]);const V=uC({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ee=>v(ee))}),ne=Te(()=>Vi(B,V.props));var Q=Te(()=>V.root.open.current||T());wv(h,Gt(()=>L(ne),{get forceMount(){return T()},get present(){return L(Q)},presence:(ce,ye)=>{let pe=()=>ye==null?void 0:ye().present;var Ie=Te(()=>qC({forceMount:T(),present:pe().current,trapFocus:j(),open:V.root.open.current}));r1(ce,Gt({loop:!0,get trapFocus(){return L(Ie)}},()=>L(ne),{onCloseAutoFocus:ze=>{var We;C()(ze),!ze.defaultPrevented&&((We=V.root.triggerNode)==null||We.focus())},focusScope:(ze,We)=>{let $e=()=>We==null?void 0:We().props;i1(ze,Gt(()=>L(ne),{get enabled(){return pe().current},onEscapeKeydown:xt=>{b()(xt),!xt.defaultPrevented&&V.root.handleClose()},children:(xt,He)=>{t1(xt,Gt(()=>L(ne),{get enabled(){return pe().current},onInteractOutside:Ye=>{l()(Ye),!Ye.defaultPrevented&&V.root.handleClose()},children:(Ye,Be)=>{o1(Ye,Gt(()=>L(ne),{get enabled(){return pe().current},children:(Me,De)=>{var ke=Xe(),Ue=Le(ke);{var et=ut=>{var ct=SE(),at=Le(ct);{var Mt=Pi=>{fm(Pi,{get preventScroll(){return U()},get restoreScrollDelay(){return K()}})};fi(at,Pi=>{V.root.open.current&&Pi(Mt)})}var Yt=Wt(at,2),yi=Up(()=>({props:Vi(L(ne),$e()),...V.snippetProps}));Ot(Yt,()=>s.child,()=>L(yi)),ve(ut,ct)},pt=ut=>{var ct=TE(),at=Le(ct);fm(at,{get preventScroll(){return U()}});var Mt=Wt(at,2);const Yt=Te(()=>Vi(L(ne),$e()));let yi;var Pi=qt(Mt);Ot(Pi,()=>s.children??ti),Vt(Mt),zt(()=>yi=ji(Mt,yi,{...L(Yt)})),ve(ut,ct)};fi(Ue,ut=>{s.child?ut(et):ut(pt,!1)})}ve(Me,ke)},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{default:!0}}))},$$slots:{focusScope:!0}}))},$$slots:{presence:!0}})),It()}function PE(h,s){Pt(s,!0);let g=ie(s,"open",15,!1),v=ie(s,"onOpenChange",3,nn),T=ie(s,"controlledOpen",3,!1);pE({open:Pe.with(()=>g(),C=>{T()||g(C),v()(C)})}),$k(h,{children:(C,b)=>{var l=Xe(),j=Le(l);Ot(j,()=>s.children??ti),ve(C,l)},$$slots:{default:!0}}),It()}/**
 * @license lucide-svelte v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IE={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var CE=H2("<svg><!><!></svg>");function rr(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]),v=yn(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Pt(s,!1);let T=ie(s,"name",8,void 0),C=ie(s,"color",8,"currentColor"),b=ie(s,"size",8,24),l=ie(s,"strokeWidth",8,2),j=ie(s,"absoluteStrokeWidth",8,!1),U=ie(s,"iconNode",24,()=>[]);const K=(...pe)=>pe.filter((Ie,Oe,ze)=>!!Ie&&ze.indexOf(Ie)===Oe).join(" "),B=la(),[V,ne]=B;fv();var Q=CE();let ee;var ce=qt(Q);Hl(ce,1,U,Xl,(pe,Ie)=>{let Oe=()=>L(Ie)[0],ze=()=>L(Ie)[1];var We=Xe(),$e=Le(We);const xt=Up(()=>`${Oe()}`=="button"?ne({...ze()},[{attribute_name:"formaction"}]):`${Oe()}`=="form"?ne({...ze()},[{attribute_name:"action"}]):`${Oe()}`=="a"?ne({...ze()},[{attribute_name:"href",lang_attribute_name:"hreflang"}]):{...ze()});Eb($e,Oe,!0,(He,Ye)=>{let Be;zt(()=>Be=ji(He,Be,{...L(xt)},void 0,He.namespaceURI===dv,He.nodeName.includes("-")))}),ve(pe,We)});var ye=Wt(ce);Hn(ye,s,"default",{}),Vt(Q),zt(()=>ee=ji(Q,ee,{...IE,...v,width:b(),height:b(),stroke:C(),"stroke-width":j()?Number(l())*24/Number(b()):l(),class:K("lucide-icon","lucide",T()?`lucide-${T()}`:"",g.class)},void 0,!0)),ve(h,Q),It()}function kE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"x"},()=>g,{iconNode:[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}var AE=Et('<!> <span class="sr-only">Close</span>',1),EE=Et("<!> <!>",1),ME=Et("<!> <!>",1);function zE(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=Xe(),C=Le(T);si(C,()=>VE,(b,l)=>{l(b,Gt(()=>s.portalProps,{children:(j,U)=>{var K=ME(),B=Le(K);si(B,()=>OE,(Q,ee)=>{ee(Q,{})});var V=Wt(B,2),ne=Te(()=>Ni("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s.class));si(V,()=>z1,(Q,ee)=>{ee(Q,Gt({get ref(){return g()},set ref(ce){g(ce)},get class(){return L(ne)}},()=>v,{children:(ce,ye)=>{var pe=EE(),Ie=Le(pe);Ot(Ie,()=>s.children??ti);var Oe=Wt(Ie,2);si(Oe,()=>wE,(ze,We)=>{We(ze,{class:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:($e,xt)=>{var He=AE(),Ye=Le(He);kE(Ye,{class:"size-4"}),ia(2),ve($e,He)},$$slots:{default:!0}})}),ve(ce,pe)},$$slots:{default:!0}}))}),ve(j,K)},$$slots:{default:!0}}))}),ve(h,T),It()}function DE(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-sm text-muted-foreground",s.class));si(C,()=>c1,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}var LE=Et("<div><!></div>");function RE(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=LE();let C;var b=qt(T);Ot(b,()=>s.children??ti),Vt(T),Vc(T,l=>g(l),()=>g()),zt(()=>C=ji(T,C,{class:Ni("flex flex-col space-y-1.5 text-center sm:text-left",s.class),...v})),ve(h,T),It()}function OE(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s.class));si(C,()=>l1,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}function FE(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-lg font-semibold leading-none tracking-tight",s.class));si(C,()=>Jb,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}const BE=M1,NE=WC,VE=Sv;function jE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"box"},()=>g,{iconNode:[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"}],["path",{d:"m3.3 7 8.7 5 8.7-5"}],["path",{d:"M12 22V12"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function UE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"check"},()=>g,{iconNode:[["path",{d:"M20 6 9 17l-5-5"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function qE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"chevrons-up-down"},()=>g,{iconNode:[["path",{d:"m7 15 5 5 5-5"}],["path",{d:"m7 9 5-5 5 5"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function ZE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"circle-help"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function GE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"computer"},()=>g,{iconNode:[["rect",{width:"14",height:"8",x:"5",y:"2",rx:"2"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2"}],["path",{d:"M6 18h2"}],["path",{d:"M12 18h6"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function WE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"corner-down-right"},()=>g,{iconNode:[["polyline",{points:"15 10 20 15 15 20"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function HE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"droplet"},()=>g,{iconNode:[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function XE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"external-link"},()=>g,{iconNode:[["path",{d:"M15 3h6v6"}],["path",{d:"M10 14 21 3"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function KE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"github"},()=>g,{iconNode:[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["path",{d:"M9 18c-4.51 2-5-2-7-2"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function $E(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"moon"},()=>g,{iconNode:[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function JE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"plug"},()=>g,{iconNode:[["path",{d:"M12 22v-5"}],["path",{d:"M9 8V2"}],["path",{d:"M15 8V2"}],["path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8Z"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function YE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"printer"},()=>g,{iconNode:[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function QE(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"search"},()=>g,{iconNode:[["circle",{cx:"11",cy:"11",r:"8"}],["path",{d:"m21 21-4.3-4.3"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function eM(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"sun"},()=>g,{iconNode:[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}function tM(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]);rr(h,Gt({name:"wifi"},()=>g,{iconNode:[["path",{d:"M12 20h.01"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0"}]],children:(T,C)=>{var b=Xe(),l=Le(b);Hn(l,s,"default",{}),ve(T,b)},$$slots:{default:!0}}))}var Dc,Jd,Yo,Ga,aa,cv,uv;class iM{constructor(s,g){H(this,aa);H(this,Dc,Qe());H(this,Jd);H(this,Yo,0);H(this,Ga,null);I(this,Dc).v=qe(s),Ve(this,Jd,g)}get current(){return Ib()?Ct(()=>(rh(this,Yo)._++,I(this,Yo)===1&&qn(this,aa,cv).call(this,!0),()=>{ay().then(()=>{rh(this,Yo)._--,I(this,Yo)===0&&qn(this,aa,uv).call(this)})})):I(this,Yo)===0&&(qn(this,aa,cv).call(this,!1),qn(this,aa,uv).call(this)),L(I(this,Dc))}}Dc=new WeakMap,Jd=new WeakMap,Yo=new WeakMap,Ga=new WeakMap,aa=new WeakSet,cv=function(s){Ve(this,Ga,I(this,Jd).call(this,g=>{je(I(this,Dc),qe(g))},s)??null)},uv=function(){I(this,Ga)!==null&&(I(this,Ga).call(this),Ve(this,Ga,null))};new iM(null,(h,s)=>{function g(){h(document.activeElement)}if(g(),!!s)return document.addEventListener("focusin",g),document.addEventListener("focusout",g),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",g)}});function nM(h,s,g,v){const T=Array.isArray(s)?s:[s];for(const C of T)h.addEventListener(C,g,v);return()=>{for(const C of T)h.removeEventListener(C,g,v)}}function ub({key:h,storage:s,serializer:g}){if(!s)return{found:!1,value:null};const v=s.getItem(h);if(v===null)return{found:!1,value:null};try{return{found:!0,value:g.deserialize(v)}}catch(T){return console.error(`Error when parsing ${v} from persisted store "${h}"`,T),{found:!1,value:null}}}function rM({key:h,value:s,storage:g,serializer:v}){if(g)try{g.setItem(h,v.serialize(s))}catch(T){console.error(`Error when writing value from persisted store "${h}" to ${g}`,T)}}function sM(h){return typeof window>"u"?null:{local:localStorage,session:sessionStorage}[h]}var Qo,ea,ta,Wa,Fg,L1;class D1{constructor(s,g,v={}){H(this,Fg);H(this,Qo,Qe());H(this,ea);H(this,ta);H(this,Wa);const{storage:T="local",serializer:C={serialize:JSON.stringify,deserialize:JSON.parse},syncTabs:b=!0}=v;Ve(this,ea,s),Ve(this,ta,sM(T)),Ve(this,Wa,C);const l=ub({key:I(this,ea),storage:I(this,ta),serializer:I(this,Wa)});I(this,Qo).v=qe(l.found?l.value:g),Ct(()=>{rM({key:I(this,ea),value:L(I(this,Qo)),storage:I(this,ta),serializer:I(this,Wa)})}),Ct(()=>{if(b)return nM(window,"storage",qn(this,Fg,L1).bind(this))})}get current(){return L(I(this,Qo))}set current(s){je(I(this,Qo),qe(s))}}Qo=new WeakMap,ea=new WeakMap,ta=new WeakMap,Wa=new WeakMap,Fg=new WeakSet,L1=function(s){if(s.key!==I(this,ea)||!I(this,ta))return;const g=ub({key:I(this,ea),storage:I(this,ta),serializer:I(this,Wa)});g.found&&je(I(this,Qo),qe(g.value))};var oM=Et('<!> <!> <span class="sr-only"> </span>',1),aM=Et(' <span class="sr-only"> </span>',1),lM=Et('<!> <span class="sr-only"> </span>',1),cM=Et('<!> <span class="sr-only"> </span>',1),uM=Et("<!> <!>",1),hM=Et('<!> <div class="flex flex-col gap-y-2"><!> <!> <!></div>',1),dM=Et("<!> <!>",1),pM=Et('<div class="absolute right-2.5 top-2.5 z-10 flex flex-col gap-y-2"><!> <!> <a target="_blank" rel="noopener noreferrer"><!></a> <!></div>');function fM(h,s){Pt(s,!1);const g=vb(),v=()=>xb(X2,"$page",g),T=pS(new D1("language","en"));function C(){L(T).current==="en"?Ex(T,L(T).current="fr"):L(T).current==="fr"&&Ex(T,L(T).current="en"),_S(L(T).current);const ee=zx.route(v().url.pathname),ce=zx.resolveRoute(ee,L(T).current);fS(ce)}const b=la(),[l,j]=b;fv();var U=pM(),K=qt(U);um(K,{onclick:xS,variant:"outline",size:"icon",children:(ee,ce)=>{var ye=oM(),pe=Le(ye);eM(pe,{class:"h-fit w-fit rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"});var Ie=Wt(pe,2);$E(Ie,{class:"absolute h-fit w-fit rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"});var Oe=Wt(Ie,2),ze=qt(Oe,!0);zt(()=>Ri(ze,MT())),Vt(Oe),ve(ee,ye)},$$slots:{default:!0}});var B=Wt(K,2);um(B,{onclick:C,variant:"outline",size:"icon",class:"uppercase",children:(ee,ce)=>{ia();var ye=aM(),pe=Le(ye),Ie=Wt(pe),Oe=qt(Ie,!0);zt(()=>Ri(Oe,LT())),Vt(Ie),zt(()=>Ri(pe,`${L(T).current??""} `)),ve(ee,ye)},$$slots:{default:!0}});var V=Wt(B,2);zt(()=>mh(V,"href",l(kS,void 0)));var ne=qt(V);um(ne,{variant:"outline",size:"icon",class:"uppercase",children:(ee,ce)=>{var ye=lM(),pe=Le(ye);KE(pe,{class:"h-fit w-fit scale-100 "});var Ie=Wt(pe,2),Oe=qt(Ie,!0);zt(()=>Ri(Oe,FT())),Vt(Ie),ve(ee,ye)},$$slots:{default:!0}}),Vt(V);var Q=Wt(V,2);BE(Q,{children:(ee,ce)=>{var ye=dM(),pe=Le(ye),Ie=Up(()=>ev({variant:"outline",size:"icon"}));NE(pe,{get class(){return L(Ie)},children:(ze,We)=>{var $e=cM(),xt=Le($e);ZE(xt,{class:"h-fit w-fit scale-100 "});var He=Wt(xt,2),Ye=qt(He,!0);zt(()=>Ri(Ye,VT())),Vt(He),ve(ze,$e)},$$slots:{default:!0}});var Oe=Wt(pe,2);zE(Oe,{children:(ze,We)=>{var $e=hM(),xt=Le($e);RE(xt,{children:(De,ke)=>{var Ue=uM(),et=Le(Ue);FE(et,{children:(ut,ct)=>{ia();var at=On();zt(()=>Ri(at,kT())),ve(ut,at)},$$slots:{default:!0}});var pt=Wt(et,2);DE(pt,{children:(ut,ct)=>{ia();var at=On();zt(()=>Ri(at,PT())),ve(ut,at)},$$slots:{default:!0}}),ve(De,Ue)},$$slots:{default:!0}});var He=Wt(xt,2),Ye=qt(He);cm(Ye,{status:"Open",class:"mr-auto"});var Be=Wt(Ye,2);cm(Be,{status:"Closing Soon",class:"mr-auto"});var Me=Wt(Be,2);cm(Me,{status:"Closed",class:"mr-auto"}),Vt(He),ve(ze,$e)},$$slots:{default:!0}}),ve(ee,ye)},$$slots:{default:!0}}),Vt(U),ve(h,U),It()}function mM(h,s){let g=Kt(s,["$$slots","$$events","$$legacy","amenity"]);({Computers:GE,Outlets:JE,Printing:YE,Rooms:jE,"Water Fountains":HE,WiFi:tM}[s.amenity]??WE)(h,Gt({class:"h-fit w-fit scale-75"},()=>g))}var gM=Et("<div></div>");function yM(h,s){const g=yn(s,["children","$$slots","$$events","$$legacy"]),v=yn(g,["class"]);Pt(s,!1);let T=ie(s,"class",8,void 0);fv();var C=gM();let b;zt(()=>b=ji(C,b,{class:Ni("animate-pulse rounded-md bg-muted",T()),...v})),ve(h,C),It()}function R1(){var h=Object.create(null);function s(g){delete h[g]}this.set=function(g,v,T){if(T!==void 0&&(typeof T!="number"||isNaN(T)||T<=0))throw new Error("Cache timeout must be a positive number");var C=h[g];C&&clearTimeout(C.timeout);var b={value:v,expire:T+Date.now()};return isNaN(b.expire)||(b.timeout=setTimeout(()=>s(g),T)),h[g]=b,v},this.del=function(g){var v=!0,T=h[g];return T?(clearTimeout(T.timeout),!isNaN(T.expire)&&T.expire<Date.now()&&(v=!1)):v=!1,v&&s(g),v},this.clear=function(){for(var g in h)clearTimeout(h[g].timeout);h=Object.create(null)},this.get=function(g){var v=h[g];if(v!==void 0){if(isNaN(v.expire)||v.expire>=Date.now())return v.value;delete h[g]}return null}}const hv=new R1;hv.Cache=R1;const _M="https://translate.googleapis.com/translate_a/single";var vM={fetch:({key:h,from:s,to:g,text:v})=>[`${_M}?client=gtx&sl=${s}&tl=${g}&dt=t&q=${encodeURIComponent(v)}`],parse:h=>h.json().then(s=>{if(!(s=s&&s[0]&&s[0][0]&&s[0].map(g=>g[0]).join("")))throw new Error("Translation not found");return s})},xM={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://translate.yandex.net/api/v1.5/tr.json/translate?key=${h}&lang=${s}-${g}&text=${encodeURIComponent(v)}`,{method:"POST",body:""}],parse:h=>h.json().then(s=>{if(s.code!==200)throw new Error(s.message);return s.text[0]})};const bM="https://libretranslate.com/translate";var wM={needkey:!1,fetch:({url:h=bM,key:s,from:g,to:v,text:T})=>[h,{method:"POST",body:JSON.stringify({q:T,source:g,target:v,api_key:s}),headers:{"Content-Type":"application/json"}}],parse:h=>h.json().then(s=>{if(!s)throw new Error("No response found");if(s.error)throw new Error(s.error);if(!s.translatedText)throw new Error("No response found");return s.translatedText})},SM={needkey:!0,fetch:({key:h,from:s,to:g,text:v})=>[`https://api${h.endsWith(":fx")?"-free":""}.deepl.com/v2/translate?auth_key=${h}&source_lang=${s}&target_lang=${g}&text=${v=encodeURIComponent(v)}`,{method:"POST",body:""}],parse:async h=>{if(!h.ok)throw h.status===403?new Error("Auth Error, please review the key for DeepL"):new Error(`Error ${h.status}`);return h.json().then(s=>s.translations[0].text)}},TM={google:vM,yandex:xM,libre:wM,deepl:SM},O1={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cze:"cs",dan:"da",div:"dv",dut:"nl",dzo:"dz",eng:"en",epo:"eo",est:"et",ewe:"ee",fao:"fo",fij:"fj",fin:"fi",fre:"fr",fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mlg:"mg",mlt:"mt",mon:"mn",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zul:"zu"},PM={afar:"aa",abkhazian:"ab",afrikaans:"af",akan:"ak",albanian:"sq",amharic:"am",arabic:"ar",aragonese:"an",armenian:"hy",assamese:"as",avaric:"av",avestan:"ae",aymara:"ay",azerbaijani:"az",bashkir:"ba",bambara:"bm",basque:"eu",belarusian:"be",bengali:"bn","bihari languages":"bh",bislama:"bi",tibetan:"bo",bosnian:"bs",breton:"br",bulgarian:"bg",burmese:"my",catalan:"ca",valencian:"ca",czech:"cs",chamorro:"ch",chechen:"ce",chinese:"zh","church slavic":"cu","old slavonic":"cu","church slavonic":"cu","old bulgarian":"cu","old church slavonic":"cu",chuvash:"cv",cornish:"kw",corsican:"co",cree:"cr",welsh:"cy",danish:"da",german:"de",divehi:"dv",dhivehi:"dv",maldivian:"dv",dutch:"nl",flemish:"nl",dzongkha:"dz",greek:"el",english:"en",esperanto:"eo",estonian:"et",ewe:"ee",faroese:"fo",persian:"fa",fijian:"fj",finnish:"fi",french:"fr","western frisian":"fy",fulah:"ff",georgian:"ka",gaelic:"gd","scottish gaelic":"gd",irish:"ga",galician:"gl",manx:"gv",guarani:"gn",gujarati:"gu",haitian:"ht","haitian creole":"ht",hausa:"ha",hebrew:"he",herero:"hz",hindi:"hi","hiri motu":"ho",croatian:"hr",hungarian:"hu",igbo:"ig",icelandic:"is",ido:"io","sichuan yi":"ii",nuosu:"ii",inuktitut:"iu",interlingue:"ie",occidental:"ie",interlingua:"ia",indonesian:"id",inupiaq:"ik",italian:"it",javanese:"jv",japanese:"ja",kalaallisut:"kl",greenlandic:"kl",kannada:"kn",kashmiri:"ks",kanuri:"kr",kazakh:"kk","central khmer":"km",kikuyu:"ki",gikuyu:"ki",kinyarwanda:"rw",kirghiz:"ky",kyrgyz:"ky",komi:"kv",kongo:"kg",korean:"ko",kuanyama:"kj",kwanyama:"kj",kurdish:"ku",lao:"lo",latin:"la",latvian:"lv",limburgan:"li",limburger:"li",limburgish:"li",lingala:"ln",lithuanian:"lt",luxembourgish:"lb",letzeburgesch:"lb","luba-katanga":"lu",ganda:"lg",macedonian:"mk",marshallese:"mh",malayalam:"ml",maori:"mi",marathi:"mr",malay:"ms",malagasy:"mg",maltese:"mt",mongolian:"mn",nauru:"na",navajo:"nv",navaho:"nv","ndebele, south":"nr","south ndebele":"nr","ndebele, north":"nd","north ndebele":"nd",ndonga:"ng",nepali:"ne","norwegian nynorsk":"nn","nynorsk, norwegian":"nn","norwegian bokmål":"nb","bokmål, norwegian":"nb",norwegian:"no",chichewa:"ny",chewa:"ny",nyanja:"ny",occitan:"oc",ojibwa:"oj",oriya:"or",oromo:"om",ossetian:"os",ossetic:"os",panjabi:"pa",punjabi:"pa",pali:"pi",polish:"pl",portuguese:"pt",pushto:"ps",pashto:"ps",quechua:"qu",romansh:"rm",romanian:"ro",moldavian:"ro",moldovan:"ro",rundi:"rn",russian:"ru",sango:"sg",sanskrit:"sa",sinhala:"si",sinhalese:"si",slovak:"sk",slovenian:"sl","northern sami":"se",samoan:"sm",shona:"sn",sindhi:"sd",somali:"so","sotho, southern":"st",spanish:"es",castilian:"es",sardinian:"sc",serbian:"sr",swati:"ss",sundanese:"su",swahili:"sw",swedish:"sv",tahitian:"ty",tamil:"ta",tatar:"tt",telugu:"te",tajik:"tg",tagalog:"tl",thai:"th",tigrinya:"ti",tonga:"to",tswana:"tn",tsonga:"ts",turkmen:"tk",turkish:"tr",twi:"tw",uighur:"ug",uyghur:"ug",ukrainian:"uk",urdu:"ur",uzbek:"uz",venda:"ve",vietnamese:"vi",volapük:"vo",walloon:"wa",wolof:"wo",xhosa:"xh",yiddish:"yi",yoruba:"yo",zhuang:"za",chuang:"za",zulu:"zu"};const IM=Object.values(O1).sort();var Z_=h=>{if(typeof h!="string")throw new Error('The "language" must be a string, received '+typeof h);if(h.length>100)throw new Error(`The "language" is too long at ${h.length} characters`);if(h=h.toLowerCase(),h=PM[h]||O1[h]||h,!IM.includes(h))throw new Error(`The language "${h}" is not part of the ISO 639-1`);return h};const _m=function(h={}){if(!(this instanceof _m))return new _m(h);const s={from:"en",to:"en",cache:void 0,engine:"google",key:void 0,url:void 0,languages:Z_,engines:TM,keys:{}},g=async(v,T={})=>{typeof T=="string"&&(T={to:T});const C=Object.keys(T).find(U=>U!=="from"&&U!=="to");if(C)throw new Error(`Invalid option with the name '${C}'`);T.text=v,T.from=Z_(T.from||g.from),T.to=Z_(T.to||g.to),T.cache=g.cache,T.engine=g.engine,T.url=g.url,T.id=`${T.url}:${T.from}:${T.to}:${T.engine}:${T.text}`,T.keys=g.keys||{};for(let U in g.keys)T.keys[U]=T.keys[U]||g.keys[U];T.key=T.key||g.key||T.keys[T.engine];const b=g.engines[T.engine],l=hv.get(T.id);if(l)return Promise.resolve(l);if(T.to===T.from)return Promise.resolve(T.text);if(b.needkey&&!T.key)throw new Error(`The engine "${T.engine}" needs a key, please provide it`);const j=b.fetch(T);return fetch(...j).then(b.parse).then(U=>hv.set(T.id,U,T.cache))};for(let v in s)g[v]=h[v]===void 0?s[v]:h[v];return g},fh=new _m;fh.Translate=_m;var CM=Et('<div class="flex flex-col gap-y-2"></div>'),kM=Et('<li class="flex gap-x-1 ps-1"><!> <span> </span></li>'),AM=Et('<ul class="mb-3"><h2 class="mb-1 font-semibold"> </h2> <!></ul>'),EM=Et("<span> </span>"),MM=Et('<li class="flex justify-between gap-x-1"><span class="first-letter:uppercase"> </span> <span> </span></li>'),zM=Et("<ul></ul>"),DM=Et('<div class="mb-3"><!></div> <!> <div class="mb-3"><h2 class="font-semibold"> </h2> <a class="flex gap-x-1 hover:underline" target="_blank" rel="noopener noreferrer"><span> </span> <!></a></div> <div><h2 class="font-semibold"> </h2> <!></div>',1);function LM(h,s){Pt(s,!0);const g={Computers:nP(),Outlets:oP(),Printing:cP(),Rooms:dP(),"Water Fountains":mP(),WiFi:_P()},v={monday:DP(),tuesday:OP(),wednesday:NP(),thursday:UP(),friday:GP(),saturday:XP(),sunday:JP()};function T(Be){var Me;return Be===void 0?"":((Me=Be.metadata)==null?void 0:Me.link)??`https://www.google.com/maps?q=${Be.location.lat},${Be.location.lng}`}function C(Be,Me){if(Be.length===0)return Wb();const De=Ue=>Ue.replace(/\:/g,"h"),ke=Be.map(Ue=>`${Ue.open} - ${Ue.close}`).join(", ");return["fr"].includes(Me)?De(ke):ke}const b=la(),[l,j]=b;var U=DM(),K=Le(U),B=qt(K);lm(B,()=>fh(s.space.description,hi()),Be=>{var Me=CM();Hl(Me,20,()=>Array(3),Xl,(De,ke)=>{yM(De,{class:"h-4 w-full"})}),Vt(Me),ve(Be,Me)},(Be,Me)=>{var De=On();zt(()=>Ri(De,L(Me))),ve(Be,De)},Be=>{var Me=On();zt(()=>Ri(Me,s.space.description)),ve(Be,Me)}),Vt(K);var V=Wt(K,2);{var ne=Be=>{var Me=AM(),De=qt(Me),ke=qt(De,!0);zt(()=>Ri(ke,eP())),Vt(De);var Ue=Wt(De,2);Hl(Ue,17,()=>{var et;return(et=s.space.metadata)==null?void 0:et.amenities.slice().sort()},Xl,(et,pt)=>{var ut=kM(),ct=qt(ut);mM(ct,{get amenity(){return L(pt)}});var at=Wt(ct,2),Mt=qt(at,!0);Vt(at),Vt(ut),zt(()=>Ri(Mt,g[L(pt)])),ve(et,ut)}),Vt(Me),ve(Be,Me)};fi(V,Be=>{var Me;(Me=s.space.metadata)!=null&&Me.amenities&&Be(ne)})}var Q=Wt(V,2),ee=qt(Q),ce=qt(ee,!0);zt(()=>Ri(ce,TP())),Vt(ee);var ye=Wt(ee,2);zt(()=>mh(ye,"href",l(T(s.space),void 0)));var pe=qt(ye),Ie=qt(pe,!0);zt(()=>Ri(Ie,bP())),Vt(pe);var Oe=Wt(pe,2);XE(Oe,{class:"h-fit w-fit scale-75"}),Vt(ye),Vt(Q);var ze=Wt(Q,2),We=qt(ze),$e=qt(We,!0);zt(()=>Ri($e,EP())),Vt(We);var xt=Wt(We,2);{var He=Be=>{var Me=EM(),De=qt(Me,!0);zt(()=>Ri(De,CP())),Vt(Me),ve(Be,Me)},Ye=Be=>{var Me=zM();Hl(Me,21,()=>Object.entries(s.space.hours),Xl,(De,ke)=>{let Ue=()=>L(ke)[0],et=()=>L(ke)[1];var pt=MM(),ut=qt(pt),ct=qt(ut,!0);Vt(ut);var at=Wt(ut,2),Mt=qt(at,!0);zt(()=>Ri(Mt,C(et(),hi()))),Vt(at),Vt(pt),zt(()=>Ri(ct,v[Ue()])),ve(De,pt)}),Vt(Me),ve(Be,Me)};fi(xt,Be=>{s.space.alwaysOpen?Be(He):Be(Ye,!1)})}Vt(ze),ve(h,U),It()}var RM=Et('<div class="group flex h-16 w-16 cursor-pointer items-center justify-center"><div>&nbsp;</div></div>');function OM(h,s){Pt(s,!0);const g={Open:"bg-green-400 shadow-green-400 group-hover:bg-green-500 group-hover:shadow-green-500",Closed:"bg-red-400 shadow-red-400 group-hover:bg-red-500 group-hover:shadow-red-500","Opening Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500","Closing Soon":"bg-yellow-400 shadow-yellow-400 group-hover:bg-yellow-500 group-hover:shadow-yellow-500"};var v=RM(),T=qt(v);const C=Te(()=>Ni(g[s.status],"h-2 w-2 rounded-full shadow-3xl"));Vt(v),zt(()=>Mb(T,L(C))),ve(h,v),It()}function FM(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=ie(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","value","class"]);var C=Xe(),b=Le(C),l=Te(()=>Ni("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s.class));si(b,()=>WA,(j,U)=>{U(j,Gt({get class(){return L(l)},get value(){return v()},set value(K){v(K)},get ref(){return g()},set ref(K){g(K)}},()=>T))}),ve(h,C),It()}function BM(h,s){Pt(s,!0),ie(s,"ref",11,null);let g=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var v=Xe(),T=Le(v),C=Te(()=>Ni("py-6 text-center text-sm",s.class));si(T,()=>XA,(b,l)=>{l(b,Gt({get class(){return L(C)}},()=>g))}),ve(h,v),It()}var NM=Et("<!> <!>",1);function VM(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children","heading"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("overflow-hidden p-1 text-foreground",s.class));si(C,()=>$A,(l,j)=>{j(l,Gt({get class(){return L(b)},get ref(){return g()},set ref(U){g(U)}},()=>v,{children:(U,K)=>{var B=NM(),V=Le(B);{var ne=ee=>{var ce=Xe(),ye=Le(ce);si(ye,()=>YA,(pe,Ie)=>{Ie(pe,{class:"px-2 py-1.5 text-xs font-medium text-muted-foreground",children:(Oe,ze)=>{ia();var We=On();zt(()=>Ri(We,s.heading)),ve(Oe,We)},$$slots:{default:!0}})}),ve(ee,ce)};fi(V,ee=>{s.heading&&ee(ne)})}var Q=Wt(V,2);si(Q,()=>tE,(ee,ce)=>{ce(ee,{get children(){return s.children}})}),ve(U,B)},$$slots:{default:!0}}))}),ve(h,T),It()}var jM=Et('<div class="flex items-center border-b px-2" data-command-input-wrapper=""><!> <!></div>');function UM(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=ie(s,"value",15,""),T=Kt(s,["$$slots","$$events","$$legacy","ref","class","value"]);var C=jM(),b=qt(C);QE(b,{class:"mr-2 size-4 shrink-0 opacity-50"});var l=Wt(b,2),j=Te(()=>Ni("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s.class));si(l,()=>nE,(U,K)=>{K(U,Gt({get class(){return L(j)},get ref(){return g()},set ref(B){g(B)}},()=>T,{get value(){return v()},set value(B){v(B)}}))}),Vt(C),ve(h,C),It()}function qM(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s.class));si(C,()=>oE,(l,j)=>{j(l,Gt({get class(){return L(b)},get ref(){return g()},set ref(U){g(U)}},()=>v))}),ve(h,T),It()}function ZM(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("max-h-[300px] overflow-y-auto overflow-x-hidden",s.class));si(C,()=>lE,(l,j)=>{j(l,Gt({get class(){return L(b)}},()=>v,{get ref(){return g()},set ref(U){g(U)}}))}),ve(h,T),It()}function Pn(){}const GM=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),WM=typeof document<"u";function HM(h){return h instanceof HTMLInputElement&&!GM.has(h.type)||h instanceof HTMLTextAreaElement||h instanceof HTMLElement&&h.isContentEditable}function Wn(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}const Qi={DURATION:.5,EASE:[.32,.72,0,1]},F1=.4,XM=.25,KM=100,B1=8,Ra=16,Dv=26,G_="vaul-dragging",N1=new WeakMap;function Tn(h,s,g=!1){if(!h||!(h instanceof HTMLElement))return;const v={};Object.entries(s).forEach(([T,C])=>{if(T.startsWith("--")){h.style.setProperty(T,C);return}v[T]=h.style[T],h.style[T]=C}),!g&&N1.set(h,v)}function $M(h,s){if(!h||!(h instanceof HTMLElement))return;const g=N1.get(h);g&&(h.style[s]=g[s])}function JM(){return Lv(/^Mac/)}function Lv(h){return typeof window<"u"&&window.navigator!=null?h.test(window.navigator.platform):void 0}function YM(){return Lv(/^iPhone/)}function hb(){return/^(?:(?!chrome|android).)*safari/i.test(navigator.userAgent)}function QM(){return Lv(/^iPad/)||JM()&&navigator.maxTouchPoints>1}function ez(){return YM()||QM()}function db(h){switch(h){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return h}}function im(h,s){if(!h)return null;const g=window.getComputedStyle(h),v=g.transform||g.webkitTransform||g.mozTransform;let T=v.match(/^matrix3d\((.+)\)$/);return T?Number.parseFloat(T[1].split(", ")[db(s)?13:12]):(T=v.match(/^matrix\((.+)\)$/),T?Number.parseFloat(T[1].split(", ")[db(s)?5:4]):null)}function W_(h,s){if(!h)return()=>{};const g=h.style.cssText;return Object.assign(h.style,s),()=>{h.style.cssText=g}}let uh=null;var Ps,Ha,Xa,Lc,Yd,Bg,Qd,Ng,Vg;class tz{constructor(s){H(this,Ps);H(this,Ha,Qe(qe(typeof window<"u"?window.location.href:"")));H(this,Xa,Qe(0));H(this,Lc,Te(()=>I(this,Ps).open.current));H(this,Yd,Te(()=>I(this,Ps).noBodyStyles.current));H(this,Bg,Te(()=>I(this,Ps).preventScrollRestoration.current));H(this,Qd,Te(()=>I(this,Ps).modal.current));H(this,Ng,Te(()=>I(this,Ps).nested.current));H(this,Vg,Te(()=>I(this,Ps).hasBeenOpened));Ge(this,"setPositionFixed",()=>{if(hb()&&uh===null&&L(I(this,Lc))&&!L(I(this,Yd))){uh={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:s,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-L(I(this,Xa))}px`,left:`${-s}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const v=g-window.innerHeight;v&&L(I(this,Xa))>=g&&(document.body.style.top=`${-(L(I(this,Xa))+v)}px`)}),300)}});Ge(this,"restorePositionSetting",()=>{if(hb()&&uh!==null&&!L(I(this,Yd))){const s=-Number.parseInt(document.body.style.top,10),g=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,uh),window.requestAnimationFrame(()=>{if(L(I(this,Bg))&&L(I(this,Ha))!==window.location.href){je(I(this,Ha),qe(window.location.href));return}window.scrollTo(g,s)}),uh=null}});Ve(this,Ps,s),Ct(()=>Oi(()=>{const g=()=>{je(I(this,Xa),qe(window.scrollY))};return g(),window.addEventListener("scroll",g),()=>{window.removeEventListener("scroll",g)}})),Ct(()=>{if(L(I(this,Ha)),!!L(I(this,Qd)))return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||this.restorePositionSetting()}}),Ct(()=>{L(I(this,Lc));const g=L(I(this,Qd)),v=L(I(this,Vg)),T=L(I(this,Ng));L(I(this,Ha)),Oi(()=>{T||!v||(L(I(this,Lc))?(!window.matchMedia("(display-mode: standalone)").matches&&this.setPositionFixed(),g||window.setTimeout(()=>{this.restorePositionSetting()},500)):this.restorePositionSetting())})})}}Ps=new WeakMap,Ha=new WeakMap,Xa=new WeakMap,Lc=new WeakMap,Yd=new WeakMap,Bg=new WeakMap,Qd=new WeakMap,Ng=new WeakMap,Vg=new WeakMap;function pb(h,s){return jp(h,s)}function iz(h,s){const g=h,v=typeof h=="symbol"?h.description:h;if(!Pb(g)){if(s===void 0)throw new Error(`Missing context dependency: ${v} and no fallback was provided.`);return s}return pv(h)}function nz(h,s){return`${h}Context`}function rz(h,s,g=!0){const v=nz(h),T=Symbol(v),C=v;function b(j){const U=iz(g?T:C,j);if(U===void 0)throw new Error(`Context \`${v}\` not found. Component must be used within ${Array.isArray(h)?`one of the following components: ${h.join(", ")}`:`\`${h}\``}`);return U}function l(j){return pb(g?T:C,j)}return[l,b]}var nr,Zn,Rc,Gn,jg,Ug,Oc,ep,tp,ip,qg,Zg,Gg,Wg,Hg,np;class sz{constructor(s){H(this,nr);H(this,Zn,Te(()=>I(this,nr).direction.current));H(this,Rc,Te(()=>I(this,nr).container.current));H(this,Gn,Te(()=>I(this,nr).snapPoints.current??[]));H(this,jg,Te(()=>I(this,nr).activeSnapPoint.current));H(this,Ug,Te(()=>I(this,nr).fadeFromIndex.current));H(this,Oc,Te(()=>I(this,nr).overlayNode));H(this,ep,Te(()=>I(this,nr).drawerNode));H(this,tp,Te(()=>I(this,nr).snapToSequentialPoint.current));H(this,ip,Qe(WM?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0));H(this,qg,Te(()=>{var s;return this.activeSnapPoint===((s=L(I(this,Gn)))==null?void 0:s[L(I(this,Gn)).length-1])||null}));H(this,Zg,Te(()=>{var s;return(s=L(I(this,Gn)))==null?void 0:s.findIndex(g=>g===this.activeSnapPoint)}));H(this,Gg,Te(()=>L(I(this,Gn))&&L(I(this,Gn)).length>0&&(this.fadeFromIndex||this.fadeFromIndex===0)&&!Number.isNaN(this.fadeFromIndex)&&L(I(this,Gn))[this.fadeFromIndex]===this.activeSnapPoint||!L(I(this,Gn))));H(this,Wg,Te(()=>{var v;this.windowDimensions,I(this,nr).open.current;const s=L(I(this,Rc))?{width:L(I(this,Rc)).getBoundingClientRect().width,height:L(I(this,Rc)).getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};return((v=L(I(this,Gn)))==null?void 0:v.map(T=>{const C=typeof T=="string";let b=0;if(C&&(b=Number.parseInt(T,10)),Wn(L(I(this,Zn)))){const j=C?b:this.windowDimensions?T*s.height:0;return this.windowDimensions?L(I(this,Zn))==="bottom"?s.height-j:-s.height+j:j}const l=C?b:this.windowDimensions?T*s.width:0;return this.windowDimensions?L(I(this,Zn))==="right"?s.width-l:-s.width+l:l}))??[]}));H(this,Hg,Te(()=>this.activeSnapPointIndex!==null&&this.activeSnapPointIndex!==void 0?this.snapPointsOffset[this.activeSnapPointIndex]:null));H(this,np,()=>{this.windowDimensions={innerWidth:window.innerWidth,innerHeight:window.innerHeight}});Ge(this,"snapToPoint",s=>{var v;const g=this.snapPointsOffset.findIndex(T=>T===s)??null;I(this,nr).onSnapPointChange(g),Tn(L(I(this,ep)),{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:Wn(L(I(this,Zn)))?`translate3d(0, ${s}px, 0)`:`translate3d(${s}px, 0, 0)`}),this.snapPointsOffset&&g!==this.snapPointsOffset.length-1&&g!==this.fadeFromIndex&&this.fadeFromIndex!==void 0&&g<this.fadeFromIndex?Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"0"}):Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"1"}),I(this,nr).setActiveSnapPoint((v=L(I(this,Gn)))==null?void 0:v[Math.max(g,0)])});Ge(this,"onRelease",s=>{var j;if(this.fadeFromIndex===void 0)return;const g=L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right"?(this.activeSnapPointOffset??0)-s.draggedDistance:(this.activeSnapPointOffset??0)+s.draggedDistance,v=this.activeSnapPointIndex===this.fadeFromIndex-1,T=this.activeSnapPointIndex===0,C=s.draggedDistance>0;if(v&&Tn(L(I(this,Oc)),{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`}),!L(I(this,tp))&&s.velocity>2&&!C){s.dismissible?s.closeDrawer():this.snapToPoint(this.snapPointsOffset[0]);return}if(!L(I(this,tp))&&s.velocity>2&&C&&this.snapPointsOffset&&L(I(this,Gn))){this.snapToPoint(this.snapPointsOffset[L(I(this,Gn)).length-1]);return}const b=(j=this.snapPointsOffset)==null?void 0:j.reduce((U,K)=>typeof U!="number"||typeof K!="number"?U:Math.abs(K-g)<Math.abs(U-g)?K:U),l=Wn(L(I(this,Zn)))?window.innerHeight:window.innerWidth;if(s.velocity>F1&&Math.abs(s.draggedDistance)<l*.4){const U=C?1:-1;if(U>0&&this.isLastSnapPoint){this.snapToPoint(this.snapPointsOffset[L(I(this,Gn)).length-1]);return}if(T&&U<0&&s.dismissible&&I(this,nr).closeDrawer(),this.activeSnapPointIndex===null)return;this.snapToPoint(this.snapPointsOffset[this.activeSnapPointIndex+U]);return}this.snapToPoint(b)});Ge(this,"onDrag",s=>{if(this.activeSnapPointOffset===null)return;const g=L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right"?this.activeSnapPointOffset-s.draggedDistance:this.activeSnapPointOffset+s.draggedDistance;(L(I(this,Zn))==="bottom"||L(I(this,Zn))==="right")&&g<this.snapPointsOffset[this.snapPointsOffset.length-1]||(L(I(this,Zn))==="top"||L(I(this,Zn))==="left")&&g>this.snapPointsOffset[this.snapPointsOffset.length-1]||Tn(L(I(this,ep)),{transform:Wn(L(I(this,Zn)))?`translate3d(0, ${g}px, 0)`:`translate3d(${g}px, 0, 0)`})});Ge(this,"getPercentageDragged",(s,g)=>{if(!L(I(this,Gn)).length||typeof this.activeSnapPointIndex!="number"||!this.snapPointsOffset.length||this.fadeFromIndex===void 0)return null;const v=this.activeSnapPointIndex===this.fadeFromIndex-1;if(this.activeSnapPointIndex>=this.fadeFromIndex&&g)return 0;if(v&&!g)return 1;if(!this.shouldFade&&!v)return null;const C=v?this.activeSnapPointIndex+1:this.activeSnapPointIndex-1,b=v?this.snapPointsOffset[C]-this.snapPointsOffset[C-1]:this.snapPointsOffset[C+1]-this.snapPointsOffset[C],l=s/Math.abs(b);return v?1-l:l});Ve(this,nr,s),Ct(()=>Oi(()=>(window.addEventListener("resize",I(this,np)),()=>window.removeEventListener("resize",I(this,np))))),Ct(()=>{const g=this.activeSnapPoint,v=L(I(this,Gn)),T=this.snapPointsOffset;Oi(()=>{if(g){const C=(v==null?void 0:v.findIndex(b=>b===g))??-1;T&&C!==-1&&typeof T[C]=="number"&&this.snapToPoint(T[C])}})})}get activeSnapPoint(){return L(I(this,jg))}get fadeFromIndex(){return L(I(this,Ug))}get windowDimensions(){return L(I(this,ip))}set windowDimensions(s){je(I(this,ip),s)}get isLastSnapPoint(){return L(I(this,qg))}get activeSnapPointIndex(){return L(I(this,Zg))}get shouldFade(){return L(I(this,Gg))}get snapPointsOffset(){return L(I(this,Wg))}get activeSnapPointOffset(){return L(I(this,Hg))}}nr=new WeakMap,Zn=new WeakMap,Rc=new WeakMap,Gn=new WeakMap,jg=new WeakMap,Ug=new WeakMap,Oc=new WeakMap,ep=new WeakMap,tp=new WeakMap,ip=new WeakMap,qg=new WeakMap,Zg=new WeakMap,Gg=new WeakMap,Wg=new WeakMap,Hg=new WeakMap,np=new WeakMap;function oz(...h){return(...s)=>{for(const g of h)typeof g=="function"&&g(...s)}}function az(h){const s=Te(()=>h.direction.current),g=Te(()=>h.open.current),v=Te(()=>h.shouldScaleBackground.current),T=Te(()=>h.setBackgroundColorOnScale.current),C=Te(()=>h.noBodyStyles.current);let b=Qe(null),l=Qe("");function j(){return(window.innerWidth-Dv)/window.innerWidth}Ct(()=>{Oi(()=>{je(l,qe(document.body.style.backgroundColor))})}),Ct(()=>(L(g),L(v),L(T),Oi(()=>{if(L(g)&&L(v)){L(b)&&window.clearTimeout(L(b));const U=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!U)return;oz(L(T)&&!L(C)?W_(document.body,{background:"black"}):Pn,W_(U,{transformOrigin:Wn(L(s))?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Qi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qi.EASE.join(",")})`}));const K=W_(U,{borderRadius:`${B1}px`,overflow:"hidden",...Wn(L(s))?{transform:`scale(${j()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${j()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{K(),je(b,qe(window.setTimeout(()=>{L(l)?document.body.style.background=L(l):document.body.style.removeProperty("background")},Qi.DURATION*1e3)))}}})))}var rp,sp,op,ap,lp,cp,up,hp,dp,pp,fp,mp,gp,yp,_p,vp,xp,Xg;class lz{constructor(s){Ge(this,"open");Ge(this,"activeSnapPoint");Ge(this,"closeThreshold");Ge(this,"shouldScaleBackground");Ge(this,"scrollLockTimeout");Ge(this,"snapPoints");Ge(this,"fadeFromIndex");Ge(this,"fixed");Ge(this,"dismissible");Ge(this,"direction");Ge(this,"onDragProp");Ge(this,"onReleaseProp");Ge(this,"nested");Ge(this,"onCloseProp");Ge(this,"backgroundColor");Ge(this,"modal");Ge(this,"handleOnly");Ge(this,"noBodyStyles");Ge(this,"preventScrollRestoration");Ge(this,"setBackgroundColorOnScale");Ge(this,"container");Ge(this,"snapToSequentialPoint");Ge(this,"repositionInputs");Ge(this,"autoFocus");H(this,rp,Qe(!1));H(this,sp,Qe(!1));H(this,op,Qe(!1));H(this,ap,Qe(null));H(this,lp,Qe(null));H(this,cp,Qe(null));H(this,up,Qe(null));H(this,hp,Qe(null));H(this,dp,Qe(!1));H(this,pp,Qe(null));H(this,fp,Qe(0));H(this,mp,Qe(!1));H(this,gp,Qe(0));H(this,yp,Qe(null));H(this,_p,Qe(0));H(this,vp,Qe(0));H(this,xp,Qe(0));Ge(this,"snapPointsState");H(this,Xg,Te(()=>this.snapPointsState.snapPointsOffset));Ge(this,"positionFixedState");Ge(this,"setActiveSnapPoint",s=>{this.activeSnapPoint.current=s});Ge(this,"onSnapPointChange",s=>{this.snapPoints.current&&s===this.snapPointsOffset.length-1&&(this.openTime=new Date)});Ge(this,"onPress",s=>{var v;if(!this.dismissible.current&&!this.snapPoints.current||this.drawerNode&&!this.drawerNode.contains(s.target))return;const g=(v=this.drawerNode)==null?void 0:v.getBoundingClientRect();this.drawerHeight=(g==null?void 0:g.height)||0,this.drawerWidth=(g==null?void 0:g.width)||0,this.isDragging=!0,this.dragStartTime=new Date,ez()&&window.addEventListener("touchend",()=>this.isAllowedToDrag=!1,{once:!0}),s.target.setPointerCapture(s.pointerId),this.pointerStart=Wn(this.direction.current)?s.pageY:s.pageX});Ge(this,"shouldDrag",(s,g)=>{var l;if(s===null)return!1;let v=s;const T=(l=window.getSelection())==null?void 0:l.toString(),C=this.drawerNode?im(this.drawerNode,this.direction.current):null,b=new Date;if(v.hasAttribute("data-vaul-no-drag")||v.closest("[data-vaul-no-drag]"))return!1;if(this.direction.current==="right"||this.direction.current==="left")return!0;if(this.openTime&&b.getTime()-this.openTime.getTime()<500)return!1;if(C!==null&&(this.direction.current==="bottom"?C>0:C<0))return!0;if(T&&T.length>0)return!1;if(this.lastTimeDragPrevented!==null&&b.getTime()-this.lastTimeDragPrevented.getTime()<this.scrollLockTimeout.current&&C===0)return this.lastTimeDragPrevented=b,!1;if(g)return this.lastTimeDragPrevented=b,!1;for(;v;){if(v.scrollHeight>v.clientHeight){if(v.scrollTop!==0)return this.lastTimeDragPrevented=new Date,!1;if(v.getAttribute("role")==="dialog")return!0}v=v.parentNode}return!0});Ge(this,"onDrag",s=>{var V,ne;if(!this.drawerNode||!this.isDragging)return;const g=this.direction.current==="bottom"||this.direction.current==="right"?1:-1,v=(this.pointerStart-(Wn(this.direction.current)?s.pageY:s.pageX))*g,T=v>0,C=this.snapPoints.current&&!this.dismissible.current&&!T;if(C&&this.snapPointsState.activeSnapPointIndex===0)return;const b=Math.abs(v),l=document.querySelector("[data-vaul-drawer-wrapper]"),j=this.direction.current==="bottom"||this.direction.current==="top"?this.drawerHeight:this.drawerWidth;let U=b/j;const K=this.snapPointsState.getPercentageDragged(b,T);if(K!==null&&(U=K),C&&U>=1||!this.isAllowedToDrag&&!this.shouldDrag(s.target,T))return;if(this.drawerNode.classList.add(G_),this.isAllowedToDrag=!0,Tn(this.drawerNode,{transition:"none"}),Tn(this.overlayNode,{transition:"none"}),this.snapPoints.current&&this.snapPoints.current.length>0&&this.snapPointsState.onDrag({draggedDistance:v}),T&&!this.snapPoints.current){const Q=yz(v),ee=Math.min(Q*-1,0)*g;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`translate3d(0, ${ee}px, 0)`:`translate3d(${ee}px, 0, 0)`});return}const B=1-U;if((this.snapPointsState.shouldFade||this.snapPointsState.fadeFromIndex&&this.snapPointsState.activeSnapPointIndex===this.snapPointsState.fadeFromIndex-1)&&((ne=(V=this.onDragProp).current)==null||ne.call(V,s,U),Tn(this.overlayNode,{opacity:`${B}`,transition:"none"},!0)),l&&this.overlayNode&&this.shouldScaleBackground.current){const Q=Math.min(nm()+U*(1-nm()),1),ee=8-U*8,ce=Math.max(0,14-U*14);Tn(l,{borderRadius:`${ee}px`,transform:Wn(this.direction.current)?`scale(${Q}) translate3d(0, ${ce}px, 0)`:`scale(${Q}) translate3d(${ce}px, 0, 0)`,transition:"none"},!0)}if(!this.snapPoints.current){const Q=b*g;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`translate3d(0, ${Q}px, 0)`:`translate3d(${Q}px, 0, 0)`})}});Ge(this,"closeDrawer",s=>{var g,v;this.cancelDrag(),(v=(g=this.onCloseProp).current)==null||v.call(g),s||(this.open.current=!1),window.setTimeout(()=>{this.snapPoints.current&&this.snapPoints.current.length>0&&(this.activeSnapPoint.current=this.snapPoints.current[0])},Qi.DURATION*1e3)});Ge(this,"resetDrawer",()=>{if(!this.drawerNode)return;const s=document.querySelector("[data-vaul-drawer-wrapper]"),g=im(this.drawerNode,this.direction.current);Tn(this.drawerNode,{transform:"translate3d(0, 0, 0)",transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`}),Tn(this.overlayNode,{transition:`opacity ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,opacity:"1"}),this.shouldScaleBackground.current&&g&&g>0&&this.open.current&&Tn(s,{borderRadius:`${B1}px`,overflow:"hidden",...Wn(this.direction.current)?{transform:`scale(${nm()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${nm()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Qi.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Qi.EASE.join(",")})`},!0)});Ge(this,"cancelDrag",()=>{!this.isDragging||!this.drawerNode||(this.drawerNode.classList.remove(G_),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date)});Ge(this,"onRelease",s=>{var U,K,B,V,ne,Q,ee,ce,ye,pe;if(!this.isDragging||!this.drawerNode)return;this.drawerNode.classList.remove(G_),this.isAllowedToDrag=!1,this.isDragging=!1,this.dragEndTime=new Date;const g=im(this.drawerNode,this.direction.current);if(!this.shouldDrag(s.target,!1)||!g||Number.isNaN(g)||this.dragStartTime===null)return;const v=this.dragEndTime.getTime()-this.dragStartTime.getTime(),T=this.pointerStart-(Wn(this.direction.current)?s.pageY:s.pageX),C=Math.abs(T)/v;if(C>.05&&(this.justReleased=!0,setTimeout(()=>{this.justReleased=!1},200)),this.snapPoints.current){const Ie=this.direction.current==="bottom"||this.direction.current==="right"?1:-1;this.snapPointsState.onRelease({draggedDistance:T*Ie,closeDrawer:this.closeDrawer,velocity:C,dismissible:this.dismissible.current}),(K=(U=this.onReleaseProp).current)==null||K.call(U,s,!0);return}if(this.direction.current==="bottom"||this.direction.current==="right"?T>0:T<0){this.resetDrawer(),(V=(B=this.onReleaseProp).current)==null||V.call(B,s,!0);return}if(C>F1){this.closeDrawer(),(Q=(ne=this.onReleaseProp).current)==null||Q.call(ne,s,!1);return}const b=Math.min(this.drawerNode.getBoundingClientRect().height??0,window.innerHeight),l=Math.min(this.drawerNode.getBoundingClientRect().width??0,window.innerWidth),j=this.direction.current==="left"||this.direction.current==="right";if(Math.abs(g)>=(j?l:b)*this.closeThreshold.current){this.closeDrawer(),(ce=(ee=this.onReleaseProp).current)==null||ce.call(ee,s,!1);return}(pe=(ye=this.onReleaseProp).current)==null||pe.call(ye,s,!0),this.resetDrawer()});Ge(this,"onNestedOpenChange",s=>{const g=s?(window.innerWidth-Ra)/window.innerWidth:1,v=s?-Ra:0;this.nestedOpenChangeTimer&&window.clearTimeout(this.nestedOpenChangeTimer),Tn(this.drawerNode,{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:`scale(${g}) translate3d(0, ${v}px, 0)`}),!s&&this.drawerNode&&(this.nestedOpenChangeTimer=window.setTimeout(()=>{const T=im(this.drawerNode,this.direction.current);Tn(this.drawerNode,{transition:"none",transform:Wn(this.direction.current)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`})},500))});Ge(this,"onNestedDrag",(s,g)=>{if(g<0)return;const v=(window.innerWidth-Ra)/window.innerWidth,T=v+g*(1-v),C=-Ra+g*Ra;Tn(this.drawerNode,{transform:Wn(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`,transition:"none"})});Ge(this,"onNestedRelease",(s,g)=>{const v=Wn(this.direction.current)?window.innerHeight:window.innerWidth,T=g?(v-Ra)/v:1,C=g?-Ra:0;g&&Tn(this.drawerNode,{transition:`transform ${Qi.DURATION}s cubic-bezier(${Qi.EASE.join(",")})`,transform:Wn(this.direction.current)?`scale(${T}) translate3d(0, ${C}px, 0)`:`scale(${T}) translate3d(${C}px, 0, 0)`})});Ge(this,"onDialogOpenChange",s=>{!this.dismissible.current&&!this.open.current||(s?this.hasBeenOpened=!0:this.closeDrawer(!0),this.open.current=s)});this.open=s.open,this.activeSnapPoint=s.activeSnapPoint,this.closeThreshold=s.closeThreshold,this.shouldScaleBackground=s.shouldScaleBackground,this.scrollLockTimeout=s.scrollLockTimeout,this.snapPoints=s.snapPoints,this.fadeFromIndex=s.fadeFromIndex,this.fixed=s.fixed,this.dismissible=s.dismissible,this.direction=s.direction,this.onDragProp=s.onDrag,this.onReleaseProp=s.onRelease,this.nested=s.nested,this.onCloseProp=s.onClose,this.backgroundColor=s.backgroundColor,this.modal=s.modal,this.handleOnly=s.handleOnly,this.noBodyStyles=s.noBodyStyles,this.preventScrollRestoration=s.preventScrollRestoration,this.setBackgroundColorOnScale=s.setBackgroundColorOnScale,this.container=s.container,this.snapToSequentialPoint=s.snapToSequentialPoint,this.repositionInputs=s.repositionInputs,this.autoFocus=s.autoFocus,this.snapPointsState=new sz(this),this.positionFixedState=new tz(this),Ct(()=>{const g=this.snapPointsState.activeSnapPointIndex,v=this.snapPoints.current,T=this.snapPointsState.snapPointsOffset;return this.drawerNode,Oi(()=>{var b;const C=()=>{var j;if(!this.drawerNode||!this.repositionInputs.current)return;const l=document.activeElement;if(HM(l)||this.keyboardIsOpen){const U=((j=window.visualViewport)==null?void 0:j.height)||0,K=window.innerHeight;let B=K-U;const V=this.drawerNode.getBoundingClientRect().height||0,ne=V>K*.8;this.initialDrawerHeight||(this.initialDrawerHeight=V);const Q=this.drawerNode.getBoundingClientRect().top;if(Math.abs(this.previousDiffFromInitial-B)>60&&(this.keyboardIsOpen=!this.keyboardIsOpen),v&&v.length>0&&T&&g){const ee=T[g]||0;B+=ee}if(this.previousDiffFromInitial=B,V>U||this.keyboardIsOpen){const ee=this.drawerNode.getBoundingClientRect().height;let ce=ee;ee>U&&(ce=U-(ne?Q:Dv)),this.fixed.current?this.drawerNode.style.height=`${ee-Math.max(B,0)}px`:this.drawerNode.style.height=`${Math.max(ce,U-Q)}px`}else this.drawerNode.style.height=`${this.initialDrawerHeight}px`;v&&v.length>0&&!this.keyboardIsOpen?this.drawerNode.style.bottom="0px":this.drawerNode.style.bottom=`${Math.max(B,0)}px`}};return(b=window.visualViewport)==null||b.addEventListener("resize",C),()=>{var l;return(l=window.visualViewport)==null?void 0:l.removeEventListener("resize",C)}})}),Ct(()=>{const g=this.open.current;return Oi(()=>(g&&(Tn(document.documentElement,{scrollBehavior:"auto"}),this.openTime=new Date),()=>{$M(document.documentElement,"scrollBehavior")}))})}get hasBeenOpened(){return L(I(this,rp))}set hasBeenOpened(s){je(I(this,rp),qe(s))}get isDragging(){return L(I(this,sp))}set isDragging(s){je(I(this,sp),qe(s))}get justReleased(){return L(I(this,op))}set justReleased(s){je(I(this,op),qe(s))}get overlayNode(){return L(I(this,ap))}set overlayNode(s){je(I(this,ap),qe(s))}get openTime(){return L(I(this,lp))}set openTime(s){je(I(this,lp),qe(s))}get dragStartTime(){return L(I(this,cp))}set dragStartTime(s){je(I(this,cp),qe(s))}get dragEndTime(){return L(I(this,up))}set dragEndTime(s){je(I(this,up),qe(s))}get lastTimeDragPrevented(){return L(I(this,hp))}set lastTimeDragPrevented(s){je(I(this,hp),qe(s))}get isAllowedToDrag(){return L(I(this,dp))}set isAllowedToDrag(s){je(I(this,dp),qe(s))}get nestedOpenChangeTimer(){return L(I(this,pp))}set nestedOpenChangeTimer(s){je(I(this,pp),qe(s))}get pointerStart(){return L(I(this,fp))}set pointerStart(s){je(I(this,fp),qe(s))}get keyboardIsOpen(){return L(I(this,mp))}set keyboardIsOpen(s){je(I(this,mp),qe(s))}get previousDiffFromInitial(){return L(I(this,gp))}set previousDiffFromInitial(s){je(I(this,gp),qe(s))}get drawerNode(){return L(I(this,yp))}set drawerNode(s){je(I(this,yp),qe(s))}get drawerHeight(){return L(I(this,_p))}set drawerHeight(s){je(I(this,_p),qe(s))}get drawerWidth(){return L(I(this,vp))}set drawerWidth(s){je(I(this,vp),qe(s))}get initialDrawerHeight(){return L(I(this,xp))}set initialDrawerHeight(s){je(I(this,xp),qe(s))}get snapPointsOffset(){return L(I(this,Xg))}}rp=new WeakMap,sp=new WeakMap,op=new WeakMap,ap=new WeakMap,lp=new WeakMap,cp=new WeakMap,up=new WeakMap,hp=new WeakMap,dp=new WeakMap,pp=new WeakMap,fp=new WeakMap,mp=new WeakMap,gp=new WeakMap,yp=new WeakMap,_p=new WeakMap,vp=new WeakMap,xp=new WeakMap,Xg=new WeakMap;var Yr,Fc,bp,wp,Kg,$g,Jg;class cz{constructor(s,g){H(this,Yr);H(this,Fc);H(this,bp);H(this,wp,Qe(!1));H(this,Kg,Te(()=>I(this,Yr).snapPoints.current&&I(this,Yr).snapPoints.current.length>0));H(this,$g,s=>{I(this,Yr).onRelease(s)});H(this,Jg,Te(()=>({id:I(this,Fc).current,"data-vaul-overlay":"","data-vaul-snap-points":I(this,Yr).open.current&&L(I(this,Kg))?"true":"false","data-vaul-snap-points-overlay":I(this,Yr).open.current&&I(this,Yr).snapPointsState.shouldFade?"true":"false",onmouseup:I(this,$g)})));Ve(this,Yr,g),Ve(this,Fc,s.id),Ve(this,bp,s.ref),V1({id:I(this,Fc),ref:I(this,bp),onRefChange:v=>{this.mounted?I(this,Yr).overlayNode=v:I(this,Yr).overlayNode=null},deps:()=>this.mounted})}get mounted(){return L(I(this,wp))}set mounted(s){je(I(this,wp),qe(s))}get props(){return L(I(this,Jg))}}Yr=new WeakMap,Fc=new WeakMap,bp=new WeakMap,wp=new WeakMap,Kg=new WeakMap,$g=new WeakMap,Jg=new WeakMap;var qi,Bc,Sp,Tp,Pp,Ip,Cp,kp,Ap,Ep,Mp,zp,Dp,Lp,Yg,Rp,Qg,ey,ty,iy,ny,ry,sy;class uz{constructor(s,g){H(this,qi);H(this,Bc);H(this,Sp);H(this,Tp);H(this,Pp);H(this,Ip);H(this,Cp);H(this,kp);H(this,Ap);H(this,Ep);H(this,Mp,Qe(!1));H(this,zp,Qe(null));H(this,Dp,Qe(null));H(this,Lp,Qe(!1));H(this,Yg,Te(()=>I(this,qi).snapPoints.current&&I(this,qi).snapPoints.current.length>0));H(this,Rp,Qe(!1));Ge(this,"isDeltaInDirection",(s,g,v=0)=>{if(this.wasBeyondThePoint)return!0;const T=Math.abs(s.y),C=Math.abs(s.x),b=C>T,l=["bottom","right"].includes(g)?1:-1;if(g==="left"||g==="right"){if(!(s.x*l<0)&&C>=0&&C<=v)return b}else if(!(s.y*l<0)&&T>=0&&T<=v)return!b;return this.wasBeyondThePoint=!0,!0});Ge(this,"handleOnPointerUp",s=>{this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,qi).onRelease(s)});Ge(this,"onOpenAutoFocus",s=>{I(this,Ep).current(s)});Ge(this,"onInteractOutside",s=>{if(I(this,Tp).current(s),!I(this,qi).modal.current||s.defaultPrevented){s.preventDefault();return}I(this,qi).keyboardIsOpen&&(I(this,qi).keyboardIsOpen=!1)});Ge(this,"onFocusOutside",s=>{I(this,qi).modal.current||s.preventDefault()});H(this,Qg,s=>{if(this.lastKnownPointerEvent=s,I(this,qi).handleOnly.current||(I(this,Ip).current(s),!this.pointerStart))return;const g=s.pageY-this.pointerStart.y,v=s.pageX-this.pointerStart.x,T=s.pointerType==="touch"?10:2,C={x:v,y:g};this.isDeltaInDirection(C,I(this,qi).direction.current,T)?I(this,qi).onDrag(s):(Math.abs(v)>T||Math.abs(g)>T)&&(this.pointerStart=null)});H(this,ey,s=>{I(this,Cp).current(s),this.pointerStart=null,this.wasBeyondThePoint=!1,I(this,qi).onRelease(s)});H(this,ty,s=>{I(this,kp).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});H(this,iy,s=>{I(this,Ap).current(s),this.lastKnownPointerEvent&&this.handleOnPointerUp(this.lastKnownPointerEvent)});H(this,ny,s=>{I(this,qi).handleOnly.current||(I(this,Pp).current(s),this.pointerStart={x:s.pageX,y:s.pageY},I(this,qi).onPress(s))});H(this,ry,Te(()=>Ab(I(this,qi).snapPointsState.snapPointsOffset)));H(this,sy,Te(()=>({id:I(this,Bc).current,"data-vaul-drawer-direction":I(this,qi).direction.current,"data-vaul-drawer":"","data-vaul-delayed-snap-points":this.delayedSnapPoints?"true":"false","data-vaul-custom-container":I(this,qi).container.current?"true":"false","data-vaul-snap-points":I(this,qi).open.current&&this.hasSnapPoints?"true":"false",style:this.snapPointsOffset&&this.snapPointsOffset.length>0?{"--snap-point-height":`${this.snapPointsOffset[0]}px`}:void 0,onpointerdown:I(this,ny),onpointermove:I(this,Qg),onpointerup:I(this,ey),onpointerout:I(this,ty),oncontextmenu:I(this,iy)})));Ve(this,qi,g),Ve(this,Bc,s.id),Ve(this,Sp,s.ref),Ve(this,Tp,s.onInteractOutside),Ve(this,Pp,s.onPointerDown),Ve(this,Ip,s.onPointerMove),Ve(this,Cp,s.onPointerUp),Ve(this,kp,s.onPointerOut),Ve(this,Ap,s.onContextMenu),Ve(this,Ep,s.onOpenAutoFocus),V1({id:I(this,Bc),ref:I(this,Sp),onRefChange:v=>{this.mounted?I(this,qi).drawerNode=v:I(this,qi).drawerNode=null},deps:()=>this.mounted&&I(this,qi).open.current}),az(I(this,qi)),Ct(()=>{this.hasSnapPoints&&I(this,qi).open.current?window.requestAnimationFrame(()=>{this.delayedSnapPoints=!0}):this.delayedSnapPoints=!1})}get delayedSnapPoints(){return L(I(this,Mp))}set delayedSnapPoints(s){je(I(this,Mp),qe(s))}get pointerStart(){return L(I(this,zp))}set pointerStart(s){je(I(this,zp),qe(s))}get lastKnownPointerEvent(){return L(I(this,Dp))}set lastKnownPointerEvent(s){je(I(this,Dp),qe(s))}get wasBeyondThePoint(){return L(I(this,Lp))}set wasBeyondThePoint(s){je(I(this,Lp),qe(s))}get hasSnapPoints(){return L(I(this,Yg))}get mounted(){return L(I(this,Rp))}set mounted(s){je(I(this,Rp),qe(s))}get snapPointsOffset(){return L(I(this,ry))}get props(){return L(I(this,sy))}}qi=new WeakMap,Bc=new WeakMap,Sp=new WeakMap,Tp=new WeakMap,Pp=new WeakMap,Ip=new WeakMap,Cp=new WeakMap,kp=new WeakMap,Ap=new WeakMap,Ep=new WeakMap,Mp=new WeakMap,zp=new WeakMap,Dp=new WeakMap,Lp=new WeakMap,Yg=new WeakMap,Rp=new WeakMap,Qg=new WeakMap,ey=new WeakMap,ty=new WeakMap,iy=new WeakMap,ny=new WeakMap,ry=new WeakMap,sy=new WeakMap;var Nc,oy;class hz{constructor(s){H(this,Nc);H(this,oy,Te(()=>({to:I(this,Nc).container.current?I(this,Nc).container.current:void 0})));Ve(this,Nc,s)}get props(){return L(I(this,oy))}}Nc=new WeakMap,oy=new WeakMap;const[dz,Rv]=rz("Drawer.Root");function pz(h){return dz(new lz(h))}function fz(h){const s=Rv();return new uz(h,s)}function mz(h){const s=Rv();return new cz(h,s)}function gz(){const h=Rv();return new hz(h)}function nm(){return(window.innerWidth-Dv)/window.innerWidth}function yz(h){return 8*(Math.log(h+1)-2)}function V1({id:h,ref:s,deps:g=()=>!0,onRefChange:v=()=>{}}){const T=Te(()=>g());Ct(()=>(h.current,L(T),Oi(()=>{const C=document.getElementById(h.current);return s.current=C,v(s.current),()=>{v(null)}}))),Ct(()=>()=>{s.current=null,v(null)})}function _z(h,s){Pt(s,!0);let g=ie(s,"open",15,!1),v=ie(s,"onOpenChange",3,Pn),T=ie(s,"closeThreshold",3,XM),C=ie(s,"scrollLockTimeout",3,KM),b=ie(s,"fadeFromIndex",19,()=>s.snapPoints&&s.snapPoints.length-1),l=ie(s,"backgroundColor",3,"black"),j=ie(s,"nested",3,!1),U=ie(s,"shouldScaleBackground",3,!1),K=ie(s,"activeSnapPoint",15,null),B=ie(s,"onActiveSnapPointChange",3,Pn),V=ie(s,"onRelease",3,Pn),ne=ie(s,"onDrag",3,Pn),Q=ie(s,"onClose",3,Pn),ee=ie(s,"dismissible",3,!0),ce=ie(s,"direction",3,"bottom"),ye=ie(s,"fixed",3,!1),pe=ie(s,"handleOnly",3,!1),Ie=ie(s,"noBodyStyles",3,!1),Oe=ie(s,"preventScrollRestoration",3,!0),ze=ie(s,"setBackgroundColorOnScale",3,!0),We=ie(s,"onAnimationEnd",3,Pn),$e=ie(s,"controlledOpen",3,!1),xt=ie(s,"repositionInputs",3,!0),He=ie(s,"autoFocus",3,!1),Ye=ie(s,"snapToSequentialPoint",3,!1),Be=ie(s,"container",3,null),Me=ie(s,"controlledActiveSnapPoint",3,!1),De=ie(s,"modal",3,!0),ke=Kt(s,["$$slots","$$events","$$legacy","open","onOpenChange","closeThreshold","scrollLockTimeout","snapPoints","fadeFromIndex","backgroundColor","nested","shouldScaleBackground","activeSnapPoint","onActiveSnapPointChange","onRelease","onDrag","onClose","dismissible","direction","fixed","handleOnly","noBodyStyles","preventScrollRestoration","setBackgroundColorOnScale","onAnimationEnd","controlledOpen","repositionInputs","autoFocus","snapToSequentialPoint","container","controlledActiveSnapPoint","modal"]);const Ue=pz({open:Pe.with(()=>g(),at=>{$e()?pt(g()):(g(at),pt(at))}),closeThreshold:Pe.with(()=>T()),scrollLockTimeout:Pe.with(()=>C()),snapPoints:Pe.with(()=>s.snapPoints),fadeFromIndex:Pe.with(()=>b()),backgroundColor:Pe.with(()=>l()),nested:Pe.with(()=>j()),shouldScaleBackground:Pe.with(()=>U()),activeSnapPoint:Pe.with(()=>K(),at=>{Me()||K(at),B()(at)}),onRelease:Pe.with(()=>V()),onDrag:Pe.with(()=>ne()),onClose:Pe.with(()=>Q()),dismissible:Pe.with(()=>ee()),direction:Pe.with(()=>ce()),fixed:Pe.with(()=>ye()),modal:Pe.with(()=>De()),handleOnly:Pe.with(()=>pe()),noBodyStyles:Pe.with(()=>Ie()),preventScrollRestoration:Pe.with(()=>Oe()),setBackgroundColorOnScale:Pe.with(()=>ze()),repositionInputs:Pe.with(()=>xt()),autoFocus:Pe.with(()=>He()),snapToSequentialPoint:Pe.with(()=>Ye()),container:Pe.with(()=>Be())});let et;function pt(at){var Mt;(Mt=v())==null||Mt(at),at&&!j()?et=document.body.style.cssText:!at&&!j()&&Zp(Qi.DURATION*1e3,()=>{document.body.style.cssText=et}),!at&&!j()&&Ue.positionFixedState.restorePositionSetting(),setTimeout(()=>{var Yt;(Yt=We())==null||Yt(at)},Qi.DURATION*1e3),at&&!De()&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),at||(document.body.style.pointerEvents="auto")}Ct(()=>()=>{j()||(document.body.style.cssText=et)});var ut=Xe(),ct=Le(ut);si(ct,()=>M1,(at,Mt)=>{Mt(at,Gt({controlledOpen:!0,get open(){return Ue.open.current},onOpenChange:Yt=>{Ue.onDialogOpenChange(Yt),pt(Yt)}},()=>ke))}),ve(h,ut),It()}function j1(h,s){Pt(s,!0),Cb(()=>(s.onMounted(!0),()=>{s.onMounted(!1)})),It()}class vz{constructor(s=0){Ge(this,"value",0);this.value=s}}const xz=new vz(0);function U1(){return`vaul-${xz.value++}`}var bz=Et("<!> <!>",1);function wz(h,s){Pt(s,!0);let g=ie(s,"id",19,U1),v=ie(s,"ref",15,null),T=ie(s,"onOpenAutoFocus",3,Pn),C=ie(s,"onInteractOutside",3,Pn),b=ie(s,"oncontextmenu",3,Pn),l=ie(s,"onpointerdown",3,Pn),j=ie(s,"onpointerup",3,Pn),U=ie(s,"onpointerout",3,Pn),K=ie(s,"onpointermove",3,Pn),B=ie(s,"preventScroll",3,!0),V=Kt(s,["$$slots","$$events","$$legacy","id","ref","onOpenAutoFocus","onInteractOutside","oncontextmenu","onpointerdown","onpointerup","onpointerout","onpointermove","children","preventScroll"]);const ne=fz({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),ye=>v(ye)),onContextMenu:Pe.with(()=>b()??Pn),onInteractOutside:Pe.with(()=>C()),onPointerDown:Pe.with(()=>l()??Pn),onPointerMove:Pe.with(()=>K()??Pn),onPointerOut:Pe.with(()=>U()??Pn),onPointerUp:Pe.with(()=>j()??Pn),onOpenAutoFocus:Pe.with(()=>T())}),Q=Te(()=>Vi(V,ne.props));var ee=Xe(),ce=Le(ee);si(ce,()=>z1,(ye,pe)=>{pe(ye,Gt(()=>L(Q),{get preventScroll(){return B()},get onInteractOutside(){return ne.onInteractOutside},get onFocusOutside(){return ne.onFocusOutside},get onOpenAutoFocus(){return ne.onOpenAutoFocus},children:(Ie,Oe)=>{var ze=bz(),We=Le(ze);Ot(We,()=>s.children??ti);var $e=Wt(We,2);j1($e,{onMounted:xt=>ne.mounted=xt}),ve(Ie,ze)},$$slots:{default:!0}}))}),ve(h,ee),It()}var Sz=Et("<!> <!>",1);function Tz(h,s){Pt(s,!0);let g=ie(s,"id",19,U1),v=ie(s,"ref",15,null),T=Kt(s,["$$slots","$$events","$$legacy","id","ref","children"]);const C=mz({id:Pe.with(()=>g()),ref:Pe.with(()=>v(),U=>v(U))}),b=Te(()=>Vi(T,C.props));var l=Xe(),j=Le(l);si(j,()=>l1,(U,K)=>{K(U,Gt({get ref(){return v()},set ref(B){v(B)}},()=>L(b),{children:(B,V)=>{var ne=Sz(),Q=Le(ne);j1(Q,{onMounted:ce=>{C.mounted=ce}});var ee=Wt(Q,2);Ot(ee,()=>s.children??ti),ve(B,ne)},$$slots:{default:!0}}))}),ve(h,l),It()}function Pz(h,s){Pt(s,!0);const g=gz();let v=ie(s,"to",19,()=>g.props.to),T=Kt(s,["$$slots","$$events","$$legacy","to"]);var C=Xe(),b=Le(C);si(b,()=>Sv,(l,j)=>{j(l,Gt({get to(){return v()}},()=>T))}),ve(h,C),It()}const Iz=Jb,Cz=c1;function kz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("fixed inset-0 z-50 bg-black/80",s.class));si(C,()=>Tz,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}var Az=Et('<div class="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"></div> <!>',1),Ez=Et("<!> <!>",1);function Mz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","portalProps","children"]);var T=Xe(),C=Le(T);si(C,()=>Pz,(b,l)=>{l(b,Gt(()=>s.portalProps,{children:(j,U)=>{var K=Ez(),B=Le(K);kz(B,{});var V=Wt(B,2),ne=Te(()=>Ni("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",s.class));si(V,()=>wz,(Q,ee)=>{ee(Q,Gt({get ref(){return g()},set ref(ce){g(ce)},get class(){return L(ne)}},()=>v,{children:(ce,ye)=>{var pe=Az(),Ie=Wt(Le(pe),2);Ot(Ie,()=>s.children??ti),ve(ce,pe)},$$slots:{default:!0}}))}),ve(j,K)},$$slots:{default:!0}}))}),ve(h,T),It()}function zz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-sm text-muted-foreground",s.class));si(C,()=>Cz,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}var Dz=Et("<div><!></div>");function Lz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class","children"]);var T=Dz();let C;var b=qt(T);Ot(b,()=>s.children??ti),Vt(T),Vc(T,l=>g(l),()=>g()),zt(()=>C=ji(T,C,{class:Ni("grid gap-1.5 p-4 text-center sm:text-left",s.class),...v})),ve(h,T),It()}function Rz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=Kt(s,["$$slots","$$events","$$legacy","ref","class"]);var T=Xe(),C=Le(T),b=Te(()=>Ni("text-lg font-semibold leading-none tracking-tight",s.class));si(C,()=>Iz,(l,j)=>{j(l,Gt({get ref(){return g()},set ref(U){g(U)},get class(){return L(b)}},()=>v))}),ve(h,T),It()}function Oz(h,s){let g=ie(s,"shouldScaleBackground",3,!0),v=ie(s,"open",15,!1),T=ie(s,"activeSnapPoint",15,null),C=Kt(s,["$$slots","$$events","$$legacy","shouldScaleBackground","open","activeSnapPoint"]);var b=Xe(),l=Le(b);si(l,()=>_z,(j,U)=>{U(j,Gt({get shouldScaleBackground(){return g()},get open(){return v()},set open(K){v(K)},get activeSnapPoint(){return T()},set activeSnapPoint(K){T(K)}},()=>C))}),ve(h,b)}function Fz(h,s){Pt(s,!0);let g=ie(s,"ref",15,null),v=ie(s,"sideOffset",3,4),T=ie(s,"align",3,"center"),C=Kt(s,["$$slots","$$events","$$legacy","ref","class","sideOffset","align","portalProps"]);var b=Xe(),l=Le(b);si(l,()=>Sv,(j,U)=>{U(j,Gt(()=>s.portalProps,{children:(K,B)=>{var V=Xe(),ne=Le(V),Q=Te(()=>Ni("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s.class));si(ne,()=>_E,(ee,ce)=>{ce(ee,Gt({get ref(){return g()},set ref(ye){g(ye)},get sideOffset(){return v()},get align(){return T()},get class(){return L(Q)}},()=>C))}),ve(K,V)},$$slots:{default:!0}}))}),ve(h,b),It()}const Bz=PE,Nz=xE,Vz=[{value:"architecture-fine-arts-library",label:"Architecture/Fine Arts Library",description:"The Architecture/Fine Arts Library supports the teaching and research requirements of the Faculty of Architecture, which includes programs in Architecture, City Planning, Interior Design and Landscape Architecture, as well as the School of Art with programs in Fine Arts and Art History.",location:{lat:49.80815612216234,lng:-97.13530152378586},hours:{monday:[{open:"08:30",close:"17:30"}],tuesday:[{open:"08:30",close:"17:30"}],wednesday:[{open:"08:30",close:"17:30"}],thursday:[{open:"08:30",close:"17:30"}],friday:[{open:"08:30",close:"17:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/CFbxpALxC7HpwdBx8"}},{value:"donald-craik-engineering-library",label:"Donald W. Craik Engineering Library",description:"The Donald W. Craik Engineering Library serves engineeirng resources, including books, journals, and electronic databases, to support academic and research needs of students and faculty.",location:{lat:49.80835859585458,lng:-97.13445434076718},alwaysOpen:!0,metadata:{amenities:["WiFi"]}},{value:"e-k-williams-law-library",label:"E. K. Williams Law Library",description:"E.K. Williams Law Library primarily serves the teaching and research needs of the Faculty of Law and the University. The library is also an integral part of the legal resources of Manitoba, where it plays a prominent role in the delivery of legal information to the members of the legal profession, the judiciary, other professional groups, and the general public.",location:{lat:49.81194940624498,lng:-97.13047415092316},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Computers","Printing"],link:"https://maps.app.goo.gl/NzVn21YBon12p11e8"}},{value:"eckhardt-gramatte-music-library",label:"Eckhardt Gramatté Music Library",description:"The Eckhardt Gramatté Music Library supports study, research, and performance at the University of Manitoba. As a unit of the University of Manitoba Libraries, the Music Library provides a vast range of print, recorded and electronic resources to students, faculty and staff of the University as well as members of the public.",location:{lat:49.80784297695002,lng:-97.1321825540353},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/BkewBe4p6jjSWEgb7"}},{value:"elizabeth-dafoe-library",label:"Elizabeth Dafoe Library",description:"The Elizabeth Dafoe Library is University of Manitoba's largest library, supporting research and teaching primarily in the Faculties of Arts, Education, Kinesiology and Recreation Management, Social Work, and Graduate Studies, as well as University 1.",location:{lat:49.81037245765845,lng:-97.13158463047291},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"10:00",close:"18:00"}],sunday:[{open:"10:00",close:"18:00"}]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/pq5cGKjbKwuJFan86"}},{value:"father-harold-drake-library",label:"St. Paul's College",description:"The Fr. Harold Drake Library at St. Paul's College focuses on supporting the teaching and research needs of staff and students at St. Paul's College including the Jesuit Centre for Catholic Studies and Arthur V. Mauro Institute for Peace and Justice.",location:{lat:49.81045700369361,lng:-97.13799926192738},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Printing"],link:"https://maps.app.goo.gl/JGQEwkeyEtG1cDCbA"}},{value:"jim-peebles-science-and-technology-library",label:"Jim Peebles Science and Technology Library",description:"The Jim Peebles Science and Technology Library serves the research, study, and teaching requirements of the Faculties of Science, Engineering, Agricultural and Food Sciences, and Environment, Earth, and Resources.",location:{lat:49.81121151579056,lng:-97.13336330797407},hours:{monday:[],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Rooms","Computers","Printing"],link:"https://maps.app.goo.gl/48NVXVD6kGeSoEue9"}}],jz=[{value:"john-p-robarts-research-library",label:"John P. Robarts Research Library",description:"Massive research center at the University of Toronto, focused on arts, social sciences & government.",location:{lat:43.66446804156252,lng:-79.3995157978792},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"23:00"}],saturday:[{open:"09:00",close:"22:00"}],sunday:[{open:"10:00",close:"22:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/zVf6CFQA5SnRtxNW7"}},{value:"e-j-pratt-library",label:"E. J. Pratt Library",description:"Supports undergraduate programs in the humanities and social sciences, including specialized Victoria College programs.",location:{lat:43.666364235118486,lng:-79.39129020831867},hours:{monday:[{open:"09:00",close:"23:45"}],tuesday:[{open:"09:00",close:"23:45"}],wednesday:[{open:"09:00",close:"23:45"}],thursday:[{open:"09:00",close:"23:45"}],friday:[{open:"09:00",close:"18:45"}],saturday:[{open:"10:00",close:"23:45"}],sunday:[{open:"10:00",close:"23:45"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/YuWigtdeDz7ETeBq6"}},{value:"gerstein-science-information-centre",label:"Gerstein Science Information Centre",description:"The largest science and health science academic library with a collection consisting primarily of material on the sciences.",location:{lat:43.66207857639802,lng:-79.39370214277896},hours:{monday:[{open:"08:30",close:"23:00"}],tuesday:[{open:"08:30",close:"23:00"}],wednesday:[{open:"08:30",close:"23:00"}],thursday:[{open:"08:30",close:"23:00"}],friday:[{open:"08:30",close:"22:00"}],saturday:[{open:"09:00",close:"22:00"}],sunday:[{open:"10:00",close:"22:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/ZXPQSTgZTcYmQAm6A"}},{value:"knox-college",label:"Knox College",description:"Knox College is a diverse community committed to the ideals of intellectual engagement, critical inquiry, and integrity, as well as to the principles of excellence, fairness, and respect for all people.",location:{lat:43.66132661472304,lng:-79.39707027756067},hours:{monday:[{open:"08:00",close:"16:30"}],tuesday:[{open:"08:00",close:"16:30"}],wednesday:[{open:"08:00",close:"16:30"}],thursday:[{open:"08:00",close:"16:30"}],friday:[{open:"08:00",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/fPj3gTJWDYjevyCV9"}},{value:"university-college-library",label:"University College Library",description:"The University College Library offers a large study space with lots of natural light, 20 computers, a group study room, and is also the home of the UC Writing Centre.",location:{lat:43.66295474108995,lng:-79.39540967937556},hours:{monday:[{open:"09:00",close:"20:00"}],tuesday:[{open:"09:00",close:"20:00"}],wednesday:[{open:"09:00",close:"20:00"}],thursday:[{open:"09:00",close:"20:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"13:00",close:"17:00"}],sunday:[{open:"13:00",close:"17:00"}]},metadata:{amenities:["WiFi","Outlets","Printing","Water Fountains","Computers"],link:"https://maps.app.goo.gl/ZGF3MEeBhrcLDmbt9"}},{value:"myhal-centre-for-engineering",label:"Myhal Centre for Engineering Innovation and Entrepreneurship",description:"The Myhal Centre is designed to foster collaboration between researchers, students, industry partners and alumni, sparking the exchange of new ideas and catalyzing innovation.",location:{lat:43.660773623027836,lng:-79.39671147994689},hours:{monday:[{open:"07:00",close:"23:00"}],tuesday:[{open:"07:00",close:"23:00"}],wednesday:[{open:"07:00",close:"23:00"}],thursday:[{open:"07:00",close:"23:00"}],friday:[{open:"07:00",close:"23:00"}],saturday:[{open:"08:30",close:"20:00"}],sunday:[{open:"08:30",close:"20:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/zvgpytTr524PNFYt8"}},{value:"bahen-centre-for-information-technology",label:"Bahen Centre for Information Technology",description:"The Bahen Centre for Information Technology in Toronto, ON is a facility dedicated to advancing research and education in the field of information technology.",location:{lat:43.659955698049664,lng:-79.3972051681471},hours:{monday:[{open:"08:30",close:"21:00"}],tuesday:[{open:"08:30",close:"21:00"}],wednesday:[{open:"08:30",close:"21:00"}],thursday:[{open:"08:30",close:"21:00"}],friday:[{open:"08:30",close:"18:00"}],saturday:[],sunday:[{open:"08:30",close:"21:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/LTRHuzjD4QxYuiJKA"}},{value:"sidney-smith-hall",label:"Sidney Smith Hall",description:"The Sidney Smith Commons is a an academic resource to help Arts & Science students through their undergraduate journey.",location:{lat:43.66271896031365,lng:-79.39855745074708},hours:{monday:[{open:"10:00",close:"18:30"}],tuesday:[{open:"10:00",close:"18:30"}],wednesday:[{open:"10:00",close:"18:30"}],thursday:[{open:"10:00",close:"18:30"}],friday:[{open:"10:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Hgzsqy7pbPqYGrHj9"}},{value:"medical-sciences-building",label:"Medical Sciences Building",description:"The Temerty Faculty of Medicine at the University of Toronto is at the centre of one of North America’s largest biomedical research, education and clinical care networks.",location:{lat:43.66093893044146,lng:-79.39343029804239},hours:{monday:[{open:"08:45",close:"17:00"}],tuesday:[{open:"08:45",close:"17:00"}],wednesday:[{open:"08:45",close:"17:00"}],thursday:[{open:"08:45",close:"17:00"}],friday:[{open:"08:45",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets","Water Fountains"],link:"https://maps.app.goo.gl/Dv6dvftxwTD2hHLT9"}},{value:"music-library",label:"Music Library",description:"The Music Library features articles, scores, encyclopedias, dissertations, and streaming media related to the study of music.",location:{lat:43.666597437748635,lng:-79.39435735738708},hours:{monday:[{open:"08:30",close:"19:00"}],tuesday:[{open:"08:30",close:"19:00"}],wednesday:[{open:"08:30",close:"19:00"}],thursday:[{open:"08:30",close:"19:00"}],friday:[{open:"08:30",close:"18:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/CxKfwqXP62PHbHKAA"}},{value:"gail-brooker-library",label:"Gail Brooker Library",description:"The library has collections covering the decorative arts as they relate to ceramic objects manufactured in England, France, Italy, Austria and Germany.",location:{lat:43.66819955524035,lng:-79.39308239668598},hours:{monday:[{open:"13:00",close:"16:00"}],tuesday:[],wednesday:[],thursday:[],friday:[],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/AKdVpGR55NJu5e98A"}},{value:"rotman-school-of-management",label:"Rotman School of Management",description:"Rotman School of Management in Toronto offers innovative business education, integrative thinking, leadership development, and prime access to networking in Canada’s dynamic economic and cultural hub.",location:{lat:43.66539062727333,lng:-79.39854570027774},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/yVbwJV4Le6tS3mzc9"}},{value:"emmanuel-college-library",label:"Emmanuel College Library",description:"Emmanuel College, within the University of Toronto, offers theological education emphasizing social justice, interfaith dialogue, and access to rich academic and urban resources.",location:{lat:43.66683513656461,lng:-79.39286966347382},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"13:00",close:"17:00"}],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/GrMVn3G9JXVa9Htz5"}},{value:"ivey-library",label:"Ivey Library",description:"Ivey Library, at Emmanuel College in the University of Toronto, provides specialized theological resources, study spaces, and support, fostering academic excellence in a vibrant environment.",location:{lat:43.66195183556734,lng:-79.40017968749},alwaysOpen:!0,metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/jsJNhaiQ1QXie69H8"}},{value:"eberhard-zeidler-library",label:"Eberhard Zeidler Library",description:"The Eberhard Zeidler Library, located within the University of Toronto’s Daniels Building, offers extensive resources in architecture, landscape architecture, and urban design, supporting academic excellence.",location:{lat:43.65948402826712,lng:-79.4006472022839},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"19:00"}],saturday:[{open:"12:00",close:"17:00"}],sunday:[{open:"12:00",close:"17:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/azSiqBsWBNNGk2mx6"}},{value:"earth-sciences-library",label:"Earth Sciences Library",description:"The Noranda Earth Sciences Library at the University of Toronto offers extensive resources in geology and environmental science, supporting research and learning in Earth Sciences.",location:{lat:43.66057710831297,lng:-79.39973551814924},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"18:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/vzitf925LX81BHj8A"}},{value:"engineering-and-computer-science-library",label:"Engineering and Computer Science Library",description:"The Engineering and Computer Science Library at the University of Toronto offers extensive resources and study spaces, supporting engineering and computer science research and education.",location:{lat:43.660274633220986,lng:-79.3948690894763},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[{open:"10:00",close:"17:00"}],sunday:[{open:"13:00",close:"18:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/hFNNWom4EfdPZzhu8"}},{value:"john-m-kelly-library",label:"John M. Kelly Library",description:"The John M. Kelly Library at the University of St. Michael’s College, University of Toronto, offers extensive humanities and social sciences collections, supporting diverse academic programs.",location:{lat:43.665375420435694,lng:-79.38947345882741},hours:{monday:[{open:"08:30",close:"23:30"}],tuesday:[{open:"08:30",close:"23:30"}],wednesday:[{open:"08:30",close:"23:30"}],thursday:[{open:"08:30",close:"23:30"}],friday:[{open:"08:30",close:"23:30"}],saturday:[{open:"10:00",close:"23:30"}],sunday:[{open:"13:00",close:"23:30"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/7m9AsVYX1swhaqTk6"}},{value:"a-d-allen-chemistry-library",label:"A. D. Allen Chemistry Library",description:"The A.D. Allen Chemistry Library at the University of Toronto offers extensive resources and study spaces, supporting chemistry research and education.",location:{lat:43.66179180735074,lng:-79.39779551746699},hours:{monday:[{open:"10:00",close:"19:00"}],tuesday:[{open:"10:00",close:"19:00"}],wednesday:[{open:"10:00",close:"19:00"}],thursday:[{open:"10:00",close:"19:00"}],friday:[{open:"10:00",close:"19:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/yDvihnazaA8s8hsT6"}},{value:"mathematical-sciences-library",label:"Mathematical Sciences Library",description:"The Mathematical Sciences Library at the University of Toronto offers extensive resources and study spaces, supporting research and education in mathematics and statistical sciences.",location:{lat:43.6597359794816,lng:-79.39706012591914},hours:{monday:[{open:"09:00",close:"17:00"}],tuesday:[{open:"09:00",close:"17:00"}],wednesday:[{open:"09:00",close:"17:00"}],thursday:[{open:"09:00",close:"17:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/2WRmtdVU4rT5yZAj9"}},{value:"innis-college",label:"Innis College",description:"Innis College, established in 1964 at the University of Toronto, offers programs in Cinema Studies, Urban Studies, and Writing and Rhetoric, fostering a vibrant academic community.",location:{lat:43.66573524927401,lng:-79.39961603167595},hours:{monday:[{open:"08:00",close:"21:00"}],tuesday:[{open:"08:00",close:"21:00"}],wednesday:[{open:"08:00",close:"21:00"}],thursday:[{open:"08:00",close:"21:00"}],friday:[{open:"08:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/5tSLpqGGv14qguu7A"}},{value:"john-w-graham-library",label:"John W. Graham Library",description:"The John W. Graham Library, serving Trinity and Wycliffe Colleges at the University of Toronto, offers extensive theological resources and study spaces, supporting academic excellence.",location:{lat:43.665259408603106,lng:-79.39633787389684},hours:{monday:[{open:"08:30",close:"23:45"}],tuesday:[{open:"08:30",close:"23:45"}],wednesday:[{open:"08:30",close:"23:45"}],thursday:[{open:"08:30",close:"23:45"}],friday:[{open:"08:30",close:"19:45"}],saturday:[{open:"09:15",close:"19:45"}],sunday:[{open:"13:15",close:"23:45"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/jzi12m7qvCDYWqMM9"}},{value:"regis-college",label:"Regis College",description:"Regis College, the Jesuit Faculty of Theology at the University of Toronto, offers programs in theology and ministry, emphasizing Jesuit traditions and academic excellence.",location:{lat:43.664229501433454,lng:-79.38998668479978},hours:{monday:[{open:"08:30",close:"16:30"}],tuesday:[{open:"08:30",close:"16:30"}],wednesday:[{open:"08:30",close:"16:30"}],thursday:[{open:"08:30",close:"16:30"}],friday:[{open:"08:30",close:"16:30"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Ad87rAjcvttdiRkv6"}},{value:"bora-laskin-law-library",label:"Bora Laskin Law Library",description:"The Bora Laskin Law Library at the University of Toronto supports legal research and education with extensive collections and study spaces.",location:{lat:43.666186648399915,lng:-79.3938063340236},hours:{monday:[{open:"08:45",close:"23:00"}],tuesday:[{open:"08:45",close:"23:00"}],wednesday:[{open:"08:45",close:"23:00"}],thursday:[{open:"08:45",close:"23:00"}],friday:[{open:"08:45",close:"20:00"}],saturday:[{open:"10:00",close:"20:00"}],sunday:[{open:"10:00",close:"20:00"}]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/Q8Yuvam1aLqhPuBf7"}},{value:"dentistry-library",label:"Dentistry Library",description:"The Dentistry Library at the University of Toronto offers extensive dental resources and study spaces, supporting research and education in dental sciences.",location:{lat:43.656384016321454,lng:-79.38703499453736},hours:{monday:[{open:"09:00",close:"17:00"}],tuesday:[{open:"09:00",close:"17:00"}],wednesday:[{open:"09:00",close:"17:00"}],thursday:[{open:"09:00",close:"17:00"}],friday:[{open:"09:00",close:"17:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/3J7bHokjDudEZiG56"}},{value:"utsu-student-commons",label:"UTSU Student Commons",description:"The UTSU Student Commons, located at 230 College Street, serves as a central hub for University of Toronto students. It offers study spaces, meeting rooms, lounges, and a café, fostering community engagement and providing resources for student activities.",location:{lat:43.65867796664493,lng:-79.3978822751627},hours:{monday:[{open:"09:00",close:"21:00"}],tuesday:[{open:"09:00",close:"21:00"}],wednesday:[{open:"09:00",close:"21:00"}],thursday:[{open:"09:00",close:"21:00"}],friday:[{open:"09:00",close:"21:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/eAYLPrwRvF4h8avk8"}},{value:"oise-library",label:"OISE Library",description:"The OISE Library at the University of Toronto is Canada’s largest academic education library, supporting teacher training, graduate studies, and research in education.",location:{lat:43.66803443817239,lng:-79.39858835469845},hours:{monday:[{open:"09:00",close:"16:00"}],tuesday:[{open:"09:00",close:"16:00"}],wednesday:[{open:"09:00",close:"16:00"}],thursday:[{open:"09:00",close:"16:00"}],friday:[{open:"09:00",close:"16:00"}],saturday:[],sunday:[]},metadata:{amenities:["WiFi","Outlets"],link:"https://maps.app.goo.gl/6fg5ikSrUb1zav2G9"}}],q1=[{value:"dana-porter-library",label:"Dana Porter Library",description:"Built in 1965, the Dana Porter Library is home to a large collection of books focused on the Arts, Humanities and Social Sciences.",location:{lat:43.46970996120006,lng:-80.54228100658808},hours:{monday:[{open:"08:00",close:"23:00"}],tuesday:[{open:"08:00",close:"23:00"}],wednesday:[{open:"08:00",close:"23:00"}],thursday:[{open:"08:00",close:"23:00"}],friday:[{open:"08:00",close:"23:00"}],saturday:[{open:"11:00",close:"23:00"}],sunday:[{open:"11:00",close:"23:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/5xkMePMsgStWSzgF8"}},{value:"david-centre-library",label:"Davis Centre Library",description:"The Davis Centre Library houses resources for engineering, mathematics, and science.",location:{lat:43.47298768397052,lng:-80.5419473517104},hours:{monday:[{open:"08:00",close:"24:00"}],tuesday:[{open:"08:00",close:"24:00"}],wednesday:[{open:"08:00",close:"24:00"}],thursday:[{open:"08:00",close:"24:00"}],friday:[{open:"08:00",close:"24:00"}],saturday:[{open:"11:00",close:"24:00"}],sunday:[{open:"11:00",close:"24:00"}]},metadata:{amenities:["WiFi","Water Fountains","Outlets"],link:"https://maps.app.goo.gl/Z5CsTbspAfcd8XGS7"}}];(async function(){try{const s=await(await fetch(CS)).json(),g=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],v=s.data.features.map(T=>{const{buildingName:C,openClassroomSlots:b}=T.properties,[l,j]=T.geometry.coordinates,U=b?JSON.parse(b):{data:[]},K=g.reduce((ne,Q)=>(ne[Q]={earliest:"23:59",latest:"00:00"},ne),{});for(const ne of U.data)for(const Q of ne.Schedule){const ee=Q.Weekday.toLowerCase();for(const ce of Q.Slots){const ye=ce.StartTime.substring(0,5),pe=ce.EndTime.substring(0,5);ye<K[ee].earliest&&(K[ee].earliest=ye),pe>K[ee].latest&&(K[ee].latest=pe)}}const B=({earliest:ne,latest:Q})=>ne==="23:59"?[]:[{open:ne,close:Q}],V=g.reduce((ne,Q)=>(ne[Q]=B(K[Q]),ne),{});return{value:(C==null?void 0:C.toLowerCase().replace(/\s+/g,"-"))||"",label:C||"Unknown Building",description:"No description available.",location:{lat:j,lng:l},hours:V,metadata:{amenities:["WiFi","Outlets"],link:""}}});q1.push(...v)}catch(h){console.error("Failed to fetch Waterloo classrooms:",h)}})();const fb=[{value:"university-of-manitoba",label:"University of Manitoba",location:{lat:49.808,lng:-97.133},spaces:Vz,metadata:{timezone:"America/Winnipeg"}},{value:"university-of-toronto",label:"University of Toronto",location:{lat:43.662,lng:-79.398},spaces:jz,metadata:{timezone:"America/Toronto",display:{bearing:45,zoom:15.5}}},{value:"university-of-waterloo",label:"University of Waterloo",location:{lat:43.469,lng:-80.542},spaces:q1,metadata:{timezone:"America/Toronto"}}];var dm={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var Uz=dm.exports,mb;function qz(){return mb||(mb=1,function(h,s){(function(g,v){h.exports=v()})(Uz,function(){var g={},v={};function T(b,l,j){if(v[b]=j,b==="index"){var U="var sharedModule = {}; ("+v.shared+")(sharedModule); ("+v.worker+")(sharedModule);",K={};return v.shared(K),v.index(g,K),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([U],{type:"text/javascript"}))),g}}T("shared",["exports"],function(b){function l(i,t,n,o){return new(n||(n=Promise))(function(u,f){function m(P){try{x(o.next(P))}catch(k){f(k)}}function y(P){try{x(o.throw(P))}catch(k){f(k)}}function x(P){var k;P.done?u(P.value):(k=P.value,k instanceof n?k:new n(function(E){E(k)})).then(m,y)}x((o=o.apply(i,t||[])).next())})}function j(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var U=K;function K(i,t){this.x=i,this.y=t}K.prototype={clone:function(){return new K(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},K.convert=function(i){return i instanceof K?i:Array.isArray(i)?new K(i[0],i[1]):i};var B=j(U),V=ne;function ne(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}ne.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var m=0,y=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Q=j(V);let ee,ce;function ye(){return ee==null&&(ee=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ee}function pe(){if(ce==null&&(ce=!1,ye())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ce=!0;break}}}return ce||!1}function Ie(i,t,n,o){const u=new Q(i,t,n,o);return f=>u.solve(f)}const Oe=Ie(.25,.1,.25,1);function ze(i,t,n){return Math.min(n,Math.max(t,i))}function We(i,t,n){const o=n-t,u=((i-t)%o+o)%o+t;return u===t?n:u}function $e(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let xt=1;function He(i,t,n){const o={};for(const u in i)o[u]=t.call(this,i[u],u,i);return o}function Ye(i,t,n){const o={};for(const u in i)t.call(this,i[u],u,i)&&(o[u]=i[u]);return o}function Be(i){return Array.isArray(i)?i.map(Be):typeof i=="object"&&i?He(i,Be):i}const Me={};function De(i){Me[i]||(typeof console<"u"&&console.warn(i),Me[i]=!0)}function ke(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Ue(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let et=null;function pt(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ct(i,t,n,o,u){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,function(P,k,E,D,F){const q=4*Math.max(-k,0),Z=(Math.max(0,E)-E)*D*4+q,J=4*D,se=Math.max(0,k),we=Math.max(0,E);return{rect:{x:se,y:we,width:Math.min(P.width,k+D)-se,height:Math.min(P.height,E+F)-we},layout:[{offset:Z,stride:J}]}}(i,t,n,o,u)),y)for(let P=0;P<x.length;P+=4){const k=x[P];x[P]=x[P+2],x[P+2]=k}return x}finally{f.close()}})}let at,Mt;const Yt="AbortError";function yi(){return new Error(Yt)}const Pi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Fi(i){return Pi.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const sn="global-dispatcher";class Ui extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const Hi=()=>Ue(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=Fi(i.url);if(o)return o(i,t);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:sn},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Hi())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return l(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Hi(),signal:u.signal});o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const m=yield fetch(f);if(!m.ok){const P=yield m.blob();throw new Ui(m.status,m.statusText,o.url,P)}let y;y=o.type==="arrayBuffer"||o.type==="image"?m.arrayBuffer():o.type==="json"?m.json():m.text();const x=yield y;if(u.signal.aborted)throw yi();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:sn},t)}var n;return function(o,u){return new Promise((f,m)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const P in o.headers)x.setRequestHeader(P,o.headers[P]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let P=x.response;if(o.type==="json")try{P=JSON.parse(x.response)}catch(k){return void m(k)}f({data:P,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const P=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new Ui(x.status,x.statusText,o.url,P))}},u.signal.addEventListener("abort",()=>{x.abort(),m(yi())}),x.send(o.body)})}(i,t)};function Xi(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function xi(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function cn(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class Ki{constructor(t,n={}){$e(this,n),this.type=t}}class mt extends Ki{constructor(t,n={}){super("error",$e({error:t},n))}}class Bt{on(t,n){return this._listeners=this._listeners||{},xi(t,n,this._listeners),this}off(t,n){return cn(t,n,this._listeners),cn(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xi(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Ki(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)cn(o,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&($e(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof mt&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ai=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function In(i,t){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return Ai.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Ht(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!Ht(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!Ht(i[n],t[n]))return!1;return!0}return i===t}function li(i,t){i.push(t)}function sr(i,t,n){li(n,{command:"addSource",args:[i,t[i]]})}function _n(i,t,n){li(t,{command:"removeSource",args:[i]}),n[i]=!0}function Xn(i,t,n,o){_n(i,n,o),sr(i,t,n)}function Zr(i,t,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!Ht(i[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Ht(i[n][o],t[n][o]))return!1;return!0}function dn(i,t,n,o,u,f){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||n.push({command:f,args:[o,m,t[m],u]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Ht(i[m],t[m])||n.push({command:f,args:[o,m,t[m],u]}))}function us(i){return i.id}function Es(i,t){return i[t.id]=t,i}class Je{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function mr(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}class vn extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Pr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new Pr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ir={kind:"null"},tt={kind:"number"},$t={kind:"string"},Ft={kind:"boolean"},Cn={kind:"color"},xn={kind:"object"},Nt={kind:"value"},or={kind:"collator"},Qr={kind:"formatted"},hs={kind:"padding"},Gr={kind:"resolvedImage"},re={kind:"variableAnchorOffsetCollection"};function O(i,t){return{kind:"array",itemType:i,N:t}}function R(i){if(i.kind==="array"){const t=R(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const W=[Ir,tt,$t,Ft,Cn,Qr,xn,O(Nt),hs,Gr,re];function Y(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Y(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of W)if(!Y(n,t))return null}}return`Expected ${R(i)} but found ${R(t)} instead.`}function de(i,t){return t.some(n=>n.kind===i.kind)}function me(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function xe(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const le=.96422,Ee=.82521,Ne=4/29,Ce=6/29,it=3*Ce*Ce,At=Ce*Ce*Ce,Dt=Math.PI/180,ci=180/Math.PI;function Xt(i){return(i%=360)<0&&(i+=360),i}function ui([i,t,n,o]){let u,f;const m=on((.2225045*(i=ii(i))+.7168786*(t=ii(t))+.0606169*(n=ii(n)))/1);i===t&&t===n?u=f=m:(u=on((.4360747*i+.3850649*t+.1430804*n)/le),f=on((.0139322*i+.0971045*t+.7141733*n)/Ee));const y=116*m-16;return[y<0?0:y,500*(u-m),200*(m-f),o]}function ii(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function on(i){return i>At?Math.pow(i,1/3):i/it+Ne}function Zi([i,t,n,o]){let u=(i+16)/116,f=isNaN(t)?u:u+t/500,m=isNaN(n)?u:u-n/200;return u=1*_i(u),f=le*_i(f),m=Ee*_i(m),[Qt(3.1338561*f-1.6168667*u-.4906146*m),Qt(-.9787684*f+1.9161415*u+.033454*m),Qt(.0719453*f-.2289914*u+1.4052427*m),o]}function Qt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function _i(i){return i>Ce?i*i*i:it*(i-Ne)}function Bi(i){return parseInt(i.padEnd(2,i),16)/255}function pn(i,t){return bn(t?i/100:i,0,1)}function bn(i,t,n){return Math.min(Math.max(t,i),n)}function Bn(i){return!i.some(Number.isNaN)}const no={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class vi{constructor(t,n,o,u=1,f=!0){this.r=t,this.g=n,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof vi)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=no[o];if(u){const[m,y,x]=u;return[m/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const m=o.length<6?1:2;let y=1;return[Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+=m)),Bi(o.slice(y,y+m)||"ff")]}if(o.startsWith("rgb")){const m=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,P,k,E,D,F,q,Z,J,se,we]=m,he=[k||" ",F||" ",J].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const _e=[P,D,Z].join(""),Ae=_e==="%%%"?100:_e===""?255:0;if(Ae){const Ze=[bn(+x/Ae,0,1),bn(+E/Ae,0,1),bn(+q/Ae,0,1),se?pn(+se,we):1];if(Bn(Ze))return Ze}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,x,P,k,E,D,F,q]=f,Z=[x||" ",k||" ",D].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const J=[+y,bn(+P,0,100),bn(+E,0,100),F?pn(+F,q):1];if(Bn(J))return function([se,we,he,_e]){function Ae(Ze){const ft=(Ze+se/30)%12,Lt=we*Math.min(he,1-he);return he-Lt*Math.max(-1,Math.min(ft-3,9-ft,1))}return se=Xt(se),we/=100,he/=100,[Ae(0),Ae(8),Ae(4),_e]}(J)}}}(t);return n?new vi(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[t/f,n/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,u,f]=ui(t),m=Math.sqrt(o*o+u*u);return[Math.round(1e4*m)?Xt(Math.atan2(u,o)*ci):NaN,m,n,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ui(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map(f=>Math.round(255*f)).join(",")},${u})`}}vi.black=new vi(0,0,0,1),vi.white=new vi(1,1,1,1),vi.transparent=new vi(0,0,0,0),vi.red=new vi(1,0,0,1);class $c{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jc{constructor(t,n,o,u,f){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=f}}class ar{constructor(t){this.sections=t}static fromString(t){return new ar([new Jc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ar?t:ar.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class lr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof lr)return t;if(typeof t=="number")return new lr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new lr(t)}}toString(){return JSON.stringify(this.values)}}const fy=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gr)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!fy.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new gr(t)}}toString(){return JSON.stringify(this.values)}}class cr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new cr({name:t,available:!1}):null}}function ro(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ms(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof vi||i instanceof $c||i instanceof ar||i instanceof lr||i instanceof gr||i instanceof cr)return!0;if(Array.isArray(i)){for(const t of i)if(!Ms(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ms(i[t]))return!1;return!0}return!1}function an(i){if(i===null)return Ir;if(typeof i=="string")return $t;if(typeof i=="boolean")return Ft;if(typeof i=="number")return tt;if(i instanceof vi)return Cn;if(i instanceof $c)return or;if(i instanceof ar)return Qr;if(i instanceof lr)return hs;if(i instanceof gr)return re;if(i instanceof cr)return Gr;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const u=an(o);if(n){if(n===u)continue;n=Nt;break}n=u}return O(n||Nt,t)}return xn}function ca(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof vi||i instanceof ar||i instanceof lr||i instanceof gr||i instanceof cr?i.toString():JSON.stringify(i)}class Cr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ms(t[1]))return n.error("invalid value");const o=t[1];let u=an(o);const f=n.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Cr(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class en{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Ja={string:$t,number:tt,boolean:Ft,object:xn};class kr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Ja)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ja[P],u++}else y=Nt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}o=O(y,x)}else{if(!Ja[f])throw new Error(`Types doesn't contain name = ${f}`);o=Ja[f]}const m=[];for(;u<t.length;u++){const y=n.parse(t[u],u,Nt);if(!y)return null;m.push(y)}return new kr(o,m)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Y(this.type,an(o)))return o;if(n===this.args.length-1)throw new en(`Expected value to be of type ${R(this.type)}, but found ${R(an(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Yc={"to-boolean":Ft,"to-color":Cn,"to-number":tt,"to-string":$t};class Ar{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Yc[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=Yc[o],f=[];for(let m=1;m<t.length;m++){const y=n.parse(t[m],m,Nt);if(!y)return null;f.push(y)}return new Ar(u,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof vi)return n;if(typeof n=="string"){const f=t.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ro(n[0],n[1],n[2],n[3]),!o))return new vi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new en(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=lr.parse(n);if(u)return u}throw new en(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=gr.parse(n);if(u)return u}throw new en(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new en(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return ar.fromString(ca(this.args[0].evaluate(t)));case"resolvedImage":return cr.fromString(ca(this.args[0].evaluate(t)));default:return ca(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const my=["Unknown","Point","LineString","Polygon"];class Ya{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?my[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=vi.parse(t)),n}}class zs{constructor(t,n,o=[],u,f=new Pr,m=[]){this.registry=t,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=m,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,f={}){return n?this.concat(n,o,u)._parse(t,f):this._parse(t,f)}_parse(t,n){function o(u,f,m){return m==="assert"?new kr(f,[u]):m==="coerce"?new Ar(f,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"coerce");else m=o(m,y,n.typeAnnotation||"assert")}if(!(m instanceof Cr)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new Ya;try{m=new Cr(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,f=o?this.scope.concat(o):this.scope;return new zs(this.registry,this._isConstant,u,n||null,f,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new vn(o,t))}checkSubtype(t,n){const o=Y(t,n);return o&&this.error(o),o}}class ds{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=n.parse(t[f+1],f+1);if(!y)return null;o.push([m,y])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new ds(o,u):null}outputDefined(){return this.result.outputDefined()}}class mi{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new mi(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Qc{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,tt),u=n.parse(t[2],2,O(n.expectedType||Nt));return o&&u?new Qc(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new en(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new en(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new en(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class eu{constructor(t,n){this.type=Ft,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,Nt);return o&&u?de(o.type,[Ft,$t,tt,Ir,Nt])?new eu(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!me(n,["boolean","string","number","null"]))throw new en(`Expected first argument to be of type boolean, string, number or null, but found ${R(an(n))} instead.`);if(!me(o,["string","array"]))throw new en(`Expected second argument to be of type array or string, but found ${R(an(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class so{constructor(t,n,o){this.type=tt,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,Nt);if(!o||!u)return null;if(!de(o.type,[Ft,$t,tt,Ir,Nt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${R(o.type)} instead`);if(t.length===4){const f=n.parse(t[3],3,tt);return f?new so(o,u,f):null}return new so(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!me(n,["boolean","string","number","null"]))throw new en(`Expected first argument to be of type boolean, string, number or null, but found ${R(an(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),me(o,["string"])){const f=o.indexOf(n,u);return f===-1?-1:[...o.slice(0,f)].length}if(me(o,["array"]))return o.indexOf(n,u);throw new en(`Expected second argument to be of type array or string, but found ${R(an(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class tu{constructor(t,n,o,u,f,m){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=f,this.otherwise=m}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const f={},m=[];for(let P=2;P<t.length-1;P+=2){let k=t[P];const E=t[P+1];Array.isArray(k)||(k=[k]);const D=n.concat(P);if(k.length===0)return D.error("Expected at least one branch label.");for(const q of k){if(typeof q!="number"&&typeof q!="string")return D.error("Branch labels must be numbers or strings.");if(typeof q=="number"&&Math.abs(q)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof q=="number"&&Math.floor(q)!==q)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,an(q)))return null}else o=an(q);if(f[String(q)]!==void 0)return D.error("Branch labels must be unique.");f[String(q)]=m.length}const F=n.parse(E,P,u);if(!F)return null;u=u||F.type,m.push(F)}const y=n.parse(t[1],1,Nt);if(!y)return null;const x=n.parse(t[t.length-1],t.length-1,u);return x?y.type.kind!=="value"&&n.concat(1).checkSubtype(o,y.type)?null:new tu(o,u,y,f,m,x):null}evaluate(t){const n=this.input.evaluate(t);return(an(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Qa{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let m=1;m<t.length-1;m+=2){const y=n.parse(t[m],m,Ft);if(!y)return null;const x=n.parse(t[m+1],m+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=n.parse(t[t.length-1],t.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Qa(o,u,f)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class ua{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Nt),u=n.parse(t[2],2,tt);if(!o||!u)return null;if(!de(o.type,[O(Nt),$t,Nt]))return n.error(`Expected first argument to be of type array or string, but found ${R(o.type)} instead`);if(t.length===4){const f=n.parse(t[3],3,tt);return f?new ua(o.type,o,u,f):null}return new ua(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),me(n,["string"]))return[...n].slice(o,u).join("");if(me(n,["array"]))return n.slice(o,u);throw new en(`Expected first argument to be of type array or string, but found ${R(an(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function el(i,t){const n=i.length-1;let o,u,f=0,m=n,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),o=i[y],u=i[y+1],o<=t){if(y===n||t<u)return y;f=y+1}else{if(!(o>t))throw new en("Input is not a number.");m=y-1}return 0}class oo{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const u=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],P=m,k=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const E=n.parse(x,k,f);if(!E)return null;f=f||E.type,u.push([y,E])}return new oo(f,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const f=n.length;return u>=n[f-1]?o[f-1].evaluate(t):o[el(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Xp(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var gy=Kp;function Kp(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}Kp.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var u=this.sampleCurveX(n)-i;if(Math.abs(u)<t)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var m=0,y=1;for(n=i,o=0;o<20&&(u=this.sampleCurveX(n),!(Math.abs(u-i)<t));o++)i>u?m=n:y=n,n=.5*(y-m)+m;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var yy=Xp(gy);function Ds(i,t,n){return i+n*(t-i)}function ha(i,t,n){return i.map((o,u)=>Ds(o,t[u],n))}const Kn={number:Ds,color:function(i,t,n,o="rgb"){switch(o){case"rgb":{const[u,f,m,y]=ha(i.rgb,t.rgb,n);return new vi(u,f,m,y,!1)}case"hcl":{const[u,f,m,y]=i.hcl,[x,P,k,E]=t.hcl;let D,F;if(isNaN(u)||isNaN(x))isNaN(u)?isNaN(x)?D=NaN:(D=x,m!==1&&m!==0||(F=P)):(D=u,k!==1&&k!==0||(F=f));else{let we=x-u;x>u&&we>180?we-=360:x<u&&u-x>180&&(we+=360),D=u+n*we}const[q,Z,J,se]=function([we,he,_e,Ae]){return we=isNaN(we)?0:we*Dt,Zi([_e,Math.cos(we)*he,Math.sin(we)*he,Ae])}([D,F??Ds(f,P,n),Ds(m,k,n),Ds(y,E,n)]);return new vi(q,Z,J,se,!1)}case"lab":{const[u,f,m,y]=Zi(ha(i.lab,t.lab,n));return new vi(u,f,m,y,!1)}}},array:ha,padding:function(i,t,n){return new lr(ha(i.values,t.values,n))},variableAnchorOffsetCollection:function(i,t,n){const o=i.values,u=t.values;if(o.length!==u.length)throw new en(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const f=[];for(let m=0;m<o.length;m+=2){if(o[m]!==u[m])throw new en(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${o[m]}, to[${m}]: ${u[m]}`);f.push(o[m]);const[y,x]=o[m+1],[P,k]=u[m+1];f.push([Ds(y,P,n),Ds(x,k,n)])}return new gr(f)}};class $n{constructor(t,n,o,u,f){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,n,o,u){let f=0;if(t.name==="exponential")f=tl(n,t.base,o,u);else if(t.name==="linear")f=tl(n,1,o,u);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new yy(m[0],m[1],m[2],m[3]).solve(tl(n,1,o,u))}return f}static parse(t,n){let[o,u,f,...m]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const P=u[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:P}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const P=u.slice(1);if(P.length!==4||P.some(k=>typeof k!="number"||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,tt),!f)return null;const y=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Cn:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let P=0;P<m.length;P+=2){const k=m[P],E=m[P+1],D=P+3,F=P+4;if(typeof k!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const q=n.parse(E,F,x);if(!q)return null;x=x||q.type,y.push([k,q])}return xe(x,tt)||xe(x,Cn)||xe(x,hs)||xe(x,re)||xe(x,O(tt))?new $n(x,o,u,f,y):n.error(`Type ${R(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const f=n.length;if(u>=n[f-1])return o[f-1].evaluate(t);const m=el(n,u),y=$n.interpolationFactor(this.interpolation,u,n[m],n[m+1]),x=o[m].evaluate(t),P=o[m+1].evaluate(t);switch(this.operator){case"interpolate":return Kn[this.type.kind](x,P,y);case"interpolate-hcl":return Kn.color(x,P,y,"hcl");case"interpolate-lab":return Kn.color(x,P,y,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function tl(i,t,n,o){const u=o-n,f=i-n;return u===0?0:t===1?f/u:(Math.pow(t,f)-1)/(Math.pow(t,u)-1)}class il{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of t.slice(1)){const x=n.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const m=u&&f.some(y=>Y(u,y.type));return new il(m?Nt:o,f)}evaluate(t){let n,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(t),o&&o instanceof cr&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function nl(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function $p(i,t,n,o){return o.compare(t,n)===0}function ao(i,t,n){const o=i!=="=="&&i!=="!=";return class Z1{constructor(f,m,y){this.type=Ft,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Nt);if(!x)return null;if(!nl(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${R(x.type)}'.`);let P=m.parse(f[2],2,Nt);if(!P)return null;if(!nl(y,P.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${R(P.type)}'.`);if(x.type.kind!==P.type.kind&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error(`Cannot compare types '${R(x.type)}' and '${R(P.type)}'.`);o&&(x.type.kind==="value"&&P.type.kind!=="value"?x=new kr(P.type,[x]):x.type.kind!=="value"&&P.type.kind==="value"&&(P=new kr(x.type,[P])));let k=null;if(f.length===4){if(x.type.kind!=="string"&&P.type.kind!=="string"&&x.type.kind!=="value"&&P.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(k=m.parse(f[3],3,or),!k)return null}return new Z1(x,P,k)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=an(m),P=an(y);if(x.kind!==P.kind||x.kind!=="string"&&x.kind!=="number")throw new en(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${P.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=an(m),P=an(y);if(x.kind!=="string"||P.kind!=="string")return t(f,m,y)}return this.collator?n(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const _y=ao("==",function(i,t,n){return t===n},$p),Jp=ao("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!$p(0,t,n,o)}),Yp=ao("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),vy=ao(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),xy=ao("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),Qp=ao(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class da{constructor(t,n,o){this.type=or,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ft);if(!u)return null;const f=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ft);if(!f)return null;let m=null;return o.locale&&(m=n.parse(o.locale,1,$t),!m)?null:new da(u,f,m)}evaluate(t){return new $c(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class iu{constructor(t,n,o,u,f){this.type=$t,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,tt);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,$t),!f))return null;let m=null;if(u.currency&&(m=n.parse(u.currency,1,$t),!m))return null;let y=null;if(u["min-fraction-digits"]&&(y=n.parse(u["min-fraction-digits"],1,tt),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=n.parse(u["max-fraction-digits"],1,tt),!x)?null:new iu(o,f,m,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class rl{constructor(t){this.type=Qr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=n.parse(y["font-scale"],1,tt),!x))return null;let P=null;if(y["text-font"]&&(P=n.parse(y["text-font"],1,O($t)),!P))return null;let k=null;if(y["text-color"]&&(k=n.parse(y["text-color"],1,Cn),!k))return null;const E=u[u.length-1];E.scale=x,E.font=P,E.textColor=k}else{const x=n.parse(t[m],1,Nt);if(!x)return null;const P=x.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new rl(u)}evaluate(t){return new ar(this.sections.map(n=>{const o=n.content.evaluate(t);return an(o)===Gr?new Jc("",o,null,null,null):new Jc(ca(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class nu{constructor(t){this.type=Gr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,$t);return o?new nu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=cr.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class ru{constructor(t){this.type=tt,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${R(o.type)} instead.`):new ru(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new en(`Expected value to be of type string or array, but found ${R(an(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Wr=8192;function by(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*Wr),Math.round(o*u*Wr)]}function su(i,t){const n=Math.pow(2,t.z);return[(u=(i[0]/Wr+t.x)/n,360*u-180),(o=(i[1]/Wr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Ls(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function ps(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function gi(i,t,n){const o=i[0]-t[0],u=i[1]-t[1],f=i[0]-n[0],m=i[1]-n[1];return o*m-f*u==0&&o*f<=0&&u*m<=0}function sl(i,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(f=[t[0]-i[0],t[1]-i[1]])[1]-u[1]*f[0]!=0&&!(!tf(i,t,n,o)||!tf(n,o,i,t));var u,f}function wy(i,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(sl(i,t,o[u],o[u+1]))return!0;return!1}function lo(i,t,n=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(gi(i,y[x],y[x+1]))return n;(f=y[x])[1]>(u=i)[1]!=(m=y[x+1])[1]>u[1]&&u[0]<(m[0]-f[0])*(u[1]-f[1])/(m[1]-f[1])+f[0]&&(o=!o)}var u,f,m;return o}function Sy(i,t){for(const n of t)if(lo(i,n))return!0;return!1}function ef(i,t){for(const n of i)if(!lo(n,t))return!1;for(let n=0;n<i.length-1;++n)if(wy(i[n],i[n+1],t))return!1;return!0}function Ty(i,t){for(const n of t)if(ef(i,n))return!0;return!1}function tf(i,t,n,o){const u=o[0]-n[0],f=o[1]-n[1],m=(i[0]-n[0])*f-u*(i[1]-n[1]),y=(t[0]-n[0])*f-u*(t[1]-n[1]);return m>0&&y<0||m<0&&y>0}function ou(i,t,n){const o=[];for(let u=0;u<i.length;u++){const f=[];for(let m=0;m<i[u].length;m++){const y=by(i[u][m],n);Ls(t,y),f.push(y)}o.push(f)}return o}function nf(i,t,n){const o=[];for(let u=0;u<i.length;u++){const f=ou(i[u],t,n);o.push(f)}return o}function rf(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const u=.5*o;let f=i[0]-n[0]>u?-o:n[0]-i[0]>u?o:0;f===0&&(f=i[0]-n[2]>u?-o:n[2]-i[0]>u?o:0),i[0]+=f}Ls(t,i)}function sf(i,t,n,o){const u=Math.pow(2,o.z)*Wr,f=[o.x*Wr,o.y*Wr],m=[];for(const y of i)for(const x of y){const P=[x.x+f[0],x.y+f[1]];rf(P,t,n,u),m.push(P)}return m}function of(i,t,n,o){const u=Math.pow(2,o.z)*Wr,f=[o.x*Wr,o.y*Wr],m=[];for(const x of i){const P=[];for(const k of x){const E=[k.x+f[0],k.y+f[1]];Ls(t,E),P.push(E)}m.push(P)}if(t[2]-t[0]<=u/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const P of x)rf(P,t,n,u)}var y;return m}class Rs{constructor(t,n){this.type=Ft,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&u.push(y),m==="MultiPolygon"&&u.push(...y)}if(u.length)return new Rs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Rs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Rs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const y=ou(o.coordinates,f,m),x=sf(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!lo(P,y))return!1}if(o.type==="MultiPolygon"){const y=nf(o.coordinates,f,m),x=sf(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!Sy(P,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(o.type==="Polygon"){const y=ou(o.coordinates,f,m),x=of(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!ef(P,y))return!1}if(o.type==="MultiPolygon"){const y=nf(o.coordinates,f,m),x=of(n.geometry(),u,f,m);if(!ps(u,f))return!1;for(const P of x)if(!Ty(P,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let af=class{constructor(i=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,o=t[i];for(;i>0;){const u=i-1>>1,f=t[u];if(n(o,f)>=0)break;t[i]=f,i=u}t[i]=o}_down(i){const{data:t,compare:n}=this,o=this.length>>1,u=t[i];for(;i<o;){let f=1+(i<<1);const m=f+1;if(m<this.length&&n(t[m],t[f])<0&&(f=m),n(t[f],u)>=0)break;t[i]=t[f],i=f}t[i]=u}};function Py(i,t,n,o,u){lf(i,t,n,o||i.length-1,u||Iy)}function lf(i,t,n,o,u){for(;o>n;){if(o-n>600){var f=o-n+1,m=t-n+1,y=Math.log(f),x=.5*Math.exp(2*y/3),P=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);lf(i,t,Math.max(n,Math.floor(t-m*x/f+P)),Math.min(o,Math.floor(t+(f-m)*x/f+P)),u)}var k=i[t],E=n,D=o;for(pa(i,n,t),u(i[o],k)>0&&pa(i,n,o);E<D;){for(pa(i,E,D),E++,D--;u(i[E],k)<0;)E++;for(;u(i[D],k)>0;)D--}u(i[n],k)===0?pa(i,n,D):pa(i,++D,o),D<=t&&(n=D+1),t<=D&&(o=D-1)}}function pa(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function Iy(i,t){return i<t?-1:i>t?1:0}function ol(i,t){if(i.length<=1)return[i];const n=[];let o,u;for(const f of i){const m=ky(f);m!==0&&(f.area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(o&&n.push(o),o=[f]):o.push(f))}if(o&&n.push(o),t>1)for(let f=0;f<n.length;f++)n[f].length<=t||(Py(n[f],t,1,n[f].length-1,Cy),n[f]=n[f].slice(0,t));return n}function Cy(i,t){return t.area-i.area}function ky(i){let t=0;for(let n,o,u=0,f=i.length,m=f-1;u<f;m=u++)n=i[u],o=i[m],t+=(o.x-n.x)*(n.y+o.y);return t}const cf=1/298.257223563,uf=cf*(2-cf),hf=Math.PI/180;class au{constructor(t){const n=6378.137*hf*1e3,o=Math.cos(t*hf),u=1/(1-uf*(1-o*o)),f=Math.sqrt(u);this.kx=n*f*o,this.ky=n*f*u*(1-uf)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,f,m,y=1/0;for(let x=0;x<t.length-1;x++){let P=t[x][0],k=t[x][1],E=this.wrap(t[x+1][0]-P)*this.kx,D=(t[x+1][1]-k)*this.ky,F=0;E===0&&D===0||(F=(this.wrap(n[0]-P)*this.kx*E+(n[1]-k)*this.ky*D)/(E*E+D*D),F>1?(P=t[x+1][0],k=t[x+1][1]):F>0&&(P+=E/this.kx*F,k+=D/this.ky*F)),E=this.wrap(n[0]-P)*this.kx,D=(n[1]-k)*this.ky;const q=E*E+D*D;q<y&&(y=q,o=P,u=k,f=x,m=F)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function df(i,t){return t[0]-i[0]}function al(i){return i[1]-i[0]+1}function es(i,t){return i[1]>=i[0]&&i[1]<t}function lu(i,t){if(i[0]>i[1])return[null,null];const n=al(i);if(t){if(n===2)return[i,null];const u=Math.floor(n/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function cu(i,t){if(!es(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Ls(n,i[o]);return n}function uu(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Ls(t,o);return t}function ll(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function hu(i,t,n){if(!ll(i)||!ll(t))return NaN;let o=0,u=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(u=i[1]-t[3]),i[3]<t[1]&&(u=t[1]-i[3]),n.distance([0,0],[o,u])}function Os(i,t,n){const o=n.pointOnLine(t,i);return n.distance(i,o.point)}function du(i,t,n,o,u){const f=Math.min(Os(i,[n,o],u),Os(t,[n,o],u)),m=Math.min(Os(n,[i,t],u),Os(o,[i,t],u));return Math.min(f,m)}function Ay(i,t,n,o,u){if(!es(t,i.length)||!es(o,n.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=i[m],x=i[m+1];for(let P=o[0];P<o[1];++P){const k=n[P],E=n[P+1];if(sl(y,x,k,E))return 0;f=Math.min(f,du(y,x,k,E,u))}}return f}function $i(i,t,n,o,u){if(!es(t,i.length)||!es(o,n.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(i[m],n[y])),f===0)return f;return f}function Ey(i,t,n){if(lo(i,t,!0))return 0;let o=1/0;for(const u of t){const f=u[0],m=u[u.length-1];if(f!==m&&(o=Math.min(o,Os(i,[m,f],n)),o===0))return o;const y=n.pointOnLine(u,i);if(o=Math.min(o,n.distance(i,y.point)),o===0)return o}return o}function ei(i,t,n,o){if(!es(t,i.length))return NaN;for(let f=t[0];f<=t[1];++f)if(lo(i[f],n,!0))return 0;let u=1/0;for(let f=t[0];f<t[1];++f){const m=i[f],y=i[f+1];for(const x of n)for(let P=0,k=x.length,E=k-1;P<k;E=P++){const D=x[E],F=x[P];if(sl(m,y,D,F))return 0;u=Math.min(u,du(m,y,D,F,o))}}return u}function cl(i,t){for(const n of i)for(const o of n)if(lo(o,t,!0))return!0;return!1}function Ci(i,t,n,o=1/0){const u=uu(i),f=uu(t);if(o!==1/0&&hu(u,f,n)>=o)return o;if(ps(u,f)){if(cl(i,t))return 0}else if(cl(t,i))return 0;let m=1/0;for(const y of i)for(let x=0,P=y.length,k=P-1;x<P;k=x++){const E=y[k],D=y[x];for(const F of t)for(let q=0,Z=F.length,J=Z-1;q<Z;J=q++){const se=F[J],we=F[q];if(sl(E,D,se,we))return 0;m=Math.min(m,du(E,D,se,we,n))}}return m}function bi(i,t,n,o,u,f){if(!f)return;const m=hu(cu(o,f),u,n);m<t&&i.push([m,f,[0,0]])}function Fs(i,t,n,o,u,f,m){if(!f||!m)return;const y=hu(cu(o,f),cu(u,m),n);y<t&&i.push([y,f,m])}function fa(i,t,n,o,u=1/0){let f=Math.min(o.distance(i[0],n[0][0]),u);if(f===0)return f;const m=new af([[0,[0,i.length-1],[0,0]]],df),y=uu(n);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const P=x[1],k=t?50:100;if(al(P)<=k){if(!es(P,i.length))return NaN;if(t){const E=ei(i,P,n,o);if(isNaN(E)||E===0)return E;f=Math.min(f,E)}else for(let E=P[0];E<=P[1];++E){const D=Ey(i[E],n,o);if(f=Math.min(f,D),f===0)return 0}}else{const E=lu(P,t);bi(m,f,o,i,y,E[0]),bi(m,f,o,i,y,E[1])}}return f}function ma(i,t,n,o,u,f=1/0){let m=Math.min(f,u.distance(i[0],n[0]));if(m===0)return m;const y=new af([[0,[0,i.length-1],[0,n.length-1]]],df);for(;y.length>0;){const x=y.pop();if(x[0]>=m)continue;const P=x[1],k=x[2],E=t?50:100,D=o?50:100;if(al(P)<=E&&al(k)<=D){if(!es(P,i.length)&&es(k,n.length))return NaN;let F;if(t&&o)F=Ay(i,P,n,k,u),m=Math.min(m,F);else if(t&&!o){const q=i.slice(P[0],P[1]+1);for(let Z=k[0];Z<=k[1];++Z)if(F=Os(n[Z],q,u),m=Math.min(m,F),m===0)return m}else if(!t&&o){const q=n.slice(k[0],k[1]+1);for(let Z=P[0];Z<=P[1];++Z)if(F=Os(i[Z],q,u),m=Math.min(m,F),m===0)return m}else F=$i(i,P,n,k,u),m=Math.min(m,F)}else{const F=lu(P,t),q=lu(k,o);Fs(y,m,u,i,n,F[0],q[0]),Fs(y,m,u,i,n,F[0],q[1]),Fs(y,m,u,i,n,F[1],q[0]),Fs(y,m,u,i,n,F[1],q[1])}}return m}function pu(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class Bs{constructor(t,n){this.type=tt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ms(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Bs(o,o.features.map(u=>pu(u.geometry)).flat());if(o.type==="Feature")return new Bs(o,pu(o.geometry));if("type"in o&&"coordinates"in o)return new Bs(o,pu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=n.geometry(),f=u.flat().map(x=>su([x.x,x.y],n.canonical));if(u.length===0)return NaN;const m=new au(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,ma(f,!1,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ma(f,!1,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,fa(f,!1,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=n.geometry(),f=u.flat().map(x=>su([x.x,x.y],n.canonical));if(u.length===0)return NaN;const m=new au(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,ma(f,!0,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ma(f,!0,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,fa(f,!0,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const f=ol(u,0).map(x=>x.map(P=>P.map(k=>su([k.x,k.y],n.canonical)))),m=new au(f[0][0][0][1]);let y=1/0;for(const x of o)for(const P of f){switch(x.type){case"Point":y=Math.min(y,fa([x.coordinates],!1,P,m,y));break;case"LineString":y=Math.min(y,fa(x.coordinates,!0,P,m,y));break;case"Polygon":y=Math.min(y,Ci(P,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const co={"==":_y,"!=":Jp,">":vy,"<":Yp,">=":Qp,"<=":xy,array:kr,at:Qc,boolean:kr,case:Qa,coalesce:il,collator:da,format:rl,image:nu,in:eu,"index-of":so,interpolate:$n,"interpolate-hcl":$n,"interpolate-lab":$n,length:ru,let:ds,literal:Cr,match:tu,number:kr,"number-format":iu,object:kr,slice:ua,step:oo,string:kr,"to-boolean":Ar,"to-color":Ar,"to-number":Ar,"to-string":Ar,var:mi,within:Rs,distance:Bs};class yr{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=yr.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([P])=>!Array.isArray(P)||P.length===t.length-1);let x=null;for(const[P,k]of y){x=new zs(n.registry,ga,n.path,null,n.scope);const E=[];let D=!1;for(let F=1;F<t.length;F++){const q=t[F],Z=Array.isArray(P)?P[F-1]:P.type,J=x.parse(q,1+E.length,Z);if(!J){D=!0;break}E.push(J)}if(!D)if(Array.isArray(P)&&P.length!==E.length)x.error(`Expected ${P.length} arguments, but found ${E.length} instead.`);else{for(let F=0;F<E.length;F++){const q=Array.isArray(P)?P[F]:P.type,Z=E[F];x.concat(F+1).checkSubtype(q,Z.type)}if(x.errors.length===0)return new yr(o,f,k,E)}}if(y.length===1)n.errors.push(...x.errors);else{const P=(y.length?y:m).map(([E])=>{return D=E,Array.isArray(D)?`(${D.map(R).join(", ")})`:`(${R(D.type)}...)`;var D}).join(" | "),k=[];for(let E=1;E<t.length;E++){const D=n.parse(t[E],1+k.length);if(!D)return null;k.push(R(D.type))}n.error(`Expected arguments of type ${P}, but found (${k.join(", ")}) instead.`)}return null}static register(t,n){yr.definitions=n;for(const o in n)t[o]=yr}}function fu(i,[t,n,o,u]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const f=u?u.evaluate(i):1,m=ro(t,n,o,f);if(m)throw new en(m);return new vi(t/255,n/255,o/255,f,!1)}function mu(i,t){return i in t}function gu(i,t){const n=t[i];return n===void 0?null:n}function Ns(i){return{type:i}}function ga(i){if(i instanceof mi)return ga(i.boundExpression);if(i instanceof yr&&i.name==="error"||i instanceof da||i instanceof Rs||i instanceof Bs)return!1;const t=i instanceof Ar||i instanceof kr;let n=!0;return i.eachChild(o=>{n=t?n&&ga(o):n&&o instanceof Cr}),!!n&&ya(i)&&_a(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ya(i){if(i instanceof yr&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Rs||i instanceof Bs)return!1;let t=!0;return i.eachChild(n=>{t&&!ya(n)&&(t=!1)}),t}function uo(i){if(i instanceof yr&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!uo(n)&&(t=!1)}),t}function _a(i,t){if(i instanceof yr&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!_a(o,t)&&(n=!1)}),n}function ul(i){return{result:"success",value:i}}function ho(i){return{result:"error",value:i}}function po(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function pf(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function yu(i){return!!i.expression&&i.expression.interpolated}function di(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function My(i){return i}function ff(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",u=o||!(o||i.property!==void 0),f=i.type||(yu(t)?"exponential":"interval");if(n||t.type==="padding"){const k=n?vi.parse:lr.parse;(i=mr({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],k(E[1])])),i.default=k(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let y,x,P;if(f==="exponential")y=gf;else if(f==="interval")y=dl;else if(f==="categorical"){y=mf,x=Object.create(null);for(const k of i.stops)x[k[0]]=k[1];P=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=yf}if(o){const k={},E=[];for(let q=0;q<i.stops.length;q++){const Z=i.stops[q],J=Z[0].zoom;k[J]===void 0&&(k[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},E.push(J)),k[J].stops.push([Z[0].value,Z[1]])}const D=[];for(const q of E)D.push([k[q].zoom,ff(k[q],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:$n.interpolationFactor.bind(void 0,F),zoomStops:D.map(q=>q[0]),evaluate:({zoom:q},Z)=>gf({stops:D,base:i.base},t,q).evaluate(q,Z)}}if(u){const k=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:$n.interpolationFactor.bind(void 0,k),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>y(i,t,E,x,P)}}return{kind:"source",evaluate(k,E){const D=E&&E.properties?E.properties[i.property]:void 0;return D===void 0?fo(i.default,t.default):y(i,t,D,x,P)}}}function fo(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function mf(i,t,n,o,u){return fo(typeof n===u?o[n]:void 0,i.default,t.default)}function dl(i,t,n){if(di(n)!=="number")return fo(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const u=el(i.stops.map(f=>f[0]),n);return i.stops[u][1]}function gf(i,t,n){const o=i.base!==void 0?i.base:1;if(di(n)!=="number")return fo(i.default,t.default);const u=i.stops.length;if(u===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[u-1][0])return i.stops[u-1][1];const f=el(i.stops.map(k=>k[0]),n),m=function(k,E,D,F){const q=F-D,Z=k-D;return q===0?0:E===1?Z/q:(Math.pow(E,Z)-1)/(Math.pow(E,q)-1)}(n,o,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],x=i.stops[f+1][1],P=Kn[t.type]||My;return typeof y.evaluate=="function"?{evaluate(...k){const E=y.evaluate.apply(void 0,k),D=x.evaluate.apply(void 0,k);if(E!==void 0&&D!==void 0)return P(E,D,m,i.colorSpace)}}:P(y,x,m,i.colorSpace)}function yf(i,t,n){switch(t.type){case"color":n=vi.parse(n);break;case"formatted":n=ar.fromString(n.toString());break;case"resolvedImage":n=cr.fromString(n.toString());break;case"padding":n=lr.parse(n);break;default:di(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return fo(n,i.default,t.default)}yr.register(co,{error:[{kind:"error"},[$t],(i,[t])=>{throw new en(t.evaluate(i))}],typeof:[$t,[Nt],(i,[t])=>R(an(t.evaluate(i)))],"to-rgba":[O(tt,4),[Cn],(i,[t])=>{const[n,o,u,f]=t.evaluate(i).rgb;return[255*n,255*o,255*u,f]}],rgb:[Cn,[tt,tt,tt],fu],rgba:[Cn,[tt,tt,tt,tt],fu],has:{type:Ft,overloads:[[[$t],(i,[t])=>mu(t.evaluate(i),i.properties())],[[$t,xn],(i,[t,n])=>mu(t.evaluate(i),n.evaluate(i))]]},get:{type:Nt,overloads:[[[$t],(i,[t])=>gu(t.evaluate(i),i.properties())],[[$t,xn],(i,[t,n])=>gu(t.evaluate(i),n.evaluate(i))]]},"feature-state":[Nt,[$t],(i,[t])=>gu(t.evaluate(i),i.featureState||{})],properties:[xn,[],i=>i.properties()],"geometry-type":[$t,[],i=>i.geometryType()],id:[Nt,[],i=>i.id()],zoom:[tt,[],i=>i.globals.zoom],"heatmap-density":[tt,[],i=>i.globals.heatmapDensity||0],"line-progress":[tt,[],i=>i.globals.lineProgress||0],accumulated:[Nt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[tt,Ns(tt),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[tt,Ns(tt),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:tt,overloads:[[[tt,tt],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[tt],(i,[t])=>-t.evaluate(i)]]},"/":[tt,[tt,tt],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[tt,[tt,tt],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[tt,[],()=>Math.LN2],pi:[tt,[],()=>Math.PI],e:[tt,[],()=>Math.E],"^":[tt,[tt,tt],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[tt,[tt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))],log2:[tt,[tt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[tt,[tt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[tt,[tt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[tt,[tt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[tt,[tt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[tt,[tt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[tt,[tt],(i,[t])=>Math.atan(t.evaluate(i))],min:[tt,Ns(tt),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[tt,Ns(tt),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[tt,[tt],(i,[t])=>Math.abs(t.evaluate(i))],round:[tt,[tt],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[tt,[tt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[tt,[tt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ft,[$t,Nt],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[Ft,[Nt],(i,[t])=>i.id()===t.value],"filter-type-==":[Ft,[$t],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Ft,[$t,Nt],(i,[t,n])=>{const o=i.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Ft,[Nt],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Ft,[Nt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ft,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ft,[O($t)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ft,[O(Nt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ft,[$t,O(Nt)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ft,[$t,O(Nt)],(i,[t,n])=>function(o,u,f,m){for(;f<=m;){const y=f+m>>1;if(u[y]===o)return!0;u[y]>o?m=y-1:f=y+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Ft,overloads:[[[Ft,Ft],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[Ns(Ft),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[Ns(Ft),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[Ft,[Ft],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ft,[$t],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[$t,[$t],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[$t,[$t],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[$t,Ns(Nt),(i,t)=>t.map(n=>ca(n.evaluate(i))).join("")],"resolved-locale":[$t,[or],(i,[t])=>t.evaluate(i).resolvedLocale()]});class pl{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Ya,this._defaultValue=n?(o=n).type==="color"&&hl(o.default)?new vi(0,0,0,0):o.type==="color"?vi.parse(o.default)||null:o.type==="padding"?lr.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?gr.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,f,m){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new en(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function fl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in co}function mo(i,t){const n=new zs(co,ga,[],t?function(u){const f={color:Cn,string:$t,number:tt,enum:$t,boolean:Ft,formatted:Qr,padding:hs,resolvedImage:Gr,variableAnchorOffsetCollection:re};return u.type==="array"?O(f[u.value]||Nt,u.length):f[u.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?ul(new pl(o,t)):ho(n.errors)}class go{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!uo(n.expression)}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,f,m)}evaluate(t,n,o,u,f,m){return this._styleExpression.evaluate(t,n,o,u,f,m)}}class yo{constructor(t,n,o,u){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!uo(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(t,n,o,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,f,m)}evaluate(t,n,o,u,f,m){return this._styleExpression.evaluate(t,n,o,u,f,m)}interpolationFactor(t,n,o){return this.interpolationType?$n.interpolationFactor(this.interpolationType,t,n,o):0}}function _u(i,t){const n=mo(i,t);if(n.result==="error")return n;const o=n.value.expression,u=ya(o);if(!u&&!po(t))return ho([new vn("","data expressions not supported")]);const f=_a(o,["zoom"]);if(!f&&!pf(t))return ho([new vn("","zoom expressions not supported")]);const m=va(o);return m||f?m instanceof vn?ho([m]):m instanceof $n&&!yu(t)?ho([new vn("",'"interpolate" expressions cannot be used with this property')]):ul(m?new yo(u?"camera":"composite",n.value,m.labels,m instanceof $n?m.interpolation:void 0):new go(u?"constant":"source",n.value)):ho([new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _o{constructor(t,n){this._parameters=t,this._specification=n,mr(this,ff(this._parameters,this._specification))}static deserialize(t){return new _o(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function va(i){let t=null;if(i instanceof ds)t=va(i.result);else if(i instanceof il){for(const n of i.args)if(t=va(n),t)break}else(i instanceof oo||i instanceof $n)&&i.input instanceof yr&&i.input.name==="zoom"&&(t=i);return t instanceof vn||i.eachChild(n=>{const o=va(n);o instanceof vn?t=o:!t&&o?t=new vn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new vn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ml(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!ml(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const gl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vu(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ml(i)||(i=yl(i));const t=mo(i,gl);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,u)=>t.value.evaluate(n,o,{},u),needGeometry:_f(i)}}function zy(i,t){return i<t?-1:i>t?1:0}function _f(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(_f(i[t]))return!0;return!1}function yl(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?xu(i[1],i[2],"=="):t==="!="?kn(xu(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?xu(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(yl))):t==="all"?["all"].concat(i.slice(1).map(yl)):t==="none"?["all"].concat(i.slice(1).map(yl).map(kn)):t==="in"?xa(i[1],i.slice(2)):t==="!in"?kn(xa(i[1],i.slice(2))):t==="has"?ba(i[1]):t!=="!has"||kn(ba(i[1]));var n}function xu(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function xa(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort(zy)]]:["filter-in-small",i,["literal",t]]}}function ba(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function kn(i){return["!",i]}function Vs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let u="[";for(const f of i)u+=`${Vs(f)},`;return`${u}]`}const n=Object.keys(i).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${Vs(i[n[u]])},`;return`${o}}`}function vf(i){let t="";for(const n of Ai)t+=`/${Vs(i[n])}`;return t}function xf(i){const t=i.value;return t?[new Je(i.key,t,"constants have been deprecated as of v8")]:[]}function Ji(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Er(i){if(Array.isArray(i))return i.map(Er);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=Er(i[n]);return t}return Ji(i)}function ur(i){const t=i.key,n=i.value,o=i.valueSpec||{},u=i.objectElementValidators||{},f=i.style,m=i.styleSpec,y=i.validateSpec;let x=[];const P=di(n);if(P!=="object")return[new Je(t,n,`object expected, ${P} found`)];for(const k in n){const E=k.split(".")[0],D=o[E]||o["*"];let F;if(u[E])F=u[E];else if(o[E])F=y;else if(u["*"])F=u["*"];else{if(!o["*"]){x.push(new Je(t,n[k],`unknown property "${k}"`));continue}F=y}x=x.concat(F({key:(t&&`${t}.`)+k,value:n[k],valueSpec:D,style:f,styleSpec:m,object:n,objectKey:k,validateSpec:y},n))}for(const k in o)u[k]||o[k].required&&o[k].default===void 0&&n[k]===void 0&&x.push(new Je(t,n,`missing required property "${k}"`));return x}function wa(i){const t=i.value,n=i.valueSpec,o=i.style,u=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(di(t)!=="array")return[new Je(f,t,`array expected, ${di(t)} found`)];if(n.length&&t.length!==n.length)return[new Je(f,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Je(f,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let y={type:n.value,values:n.values};u.$version<7&&(y.function=n.function),di(n.value)==="object"&&(y=n.value);let x=[];for(let P=0;P<t.length;P++)x=x.concat(m({array:t,arrayIndex:P,value:t[P],valueSpec:y,validateSpec:i.validateSpec,style:o,styleSpec:u,key:`${f}[${P}]`}));return x}function bu(i){const t=i.key,n=i.value,o=i.valueSpec;let u=di(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Je(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Je(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Je(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function _l(i){const t=i.valueSpec,n=Ji(i.value.type);let o,u,f,m={};const y=n!=="categorical"&&i.value.property===void 0,x=!y,P=di(i.value.stops)==="array"&&di(i.value.stops[0])==="array"&&di(i.value.stops[0][0])==="object",k=ur({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Je(F.key,F.value,'identity function may not have a "stops" property')];let q=[];const Z=F.value;return q=q.concat(wa({key:F.key,value:Z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:E})),di(Z)==="array"&&Z.length===0&&q.push(new Je(F.key,Z,"array must have at least one stop")),q},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&y&&k.push(new Je(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||k.push(new Je(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!yu(i.valueSpec)&&k.push(new Je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!po(i.valueSpec)?k.push(new Je(i.key,i.value,"property functions not supported")):y&&!pf(i.valueSpec)&&k.push(new Je(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!P||i.value.property!==void 0||k.push(new Je(i.key,i.value,'"property" property is required')),k;function E(F){let q=[];const Z=F.value,J=F.key;if(di(Z)!=="array")return[new Je(J,Z,`array expected, ${di(Z)} found`)];if(Z.length!==2)return[new Je(J,Z,`array length 2 expected, length ${Z.length} found`)];if(P){if(di(Z[0])!=="object")return[new Je(J,Z,`object expected, ${di(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Je(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Je(J,Z,"object stop key must have value")];if(f&&f>Ji(Z[0].zoom))return[new Je(J,Z[0].zoom,"stop zoom values must appear in ascending order")];Ji(Z[0].zoom)!==f&&(f=Ji(Z[0].zoom),u=void 0,m={}),q=q.concat(ur({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:bu,value:D}}))}else q=q.concat(D({key:`${J}[0]`,value:Z[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},Z));return fl(Er(Z[1]))?q.concat([new Je(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):q.concat(F.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function D(F,q){const Z=di(F.value),J=Ji(F.value),se=F.value!==null?F.value:q;if(o){if(Z!==o)return[new Je(F.key,se,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Je(F.key,se,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&n!=="categorical"){let we=`number expected, ${Z} found`;return po(t)&&n===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(F.key,se,we)]}return n!=="categorical"||Z!=="number"||isFinite(J)&&Math.floor(J)===J?n!=="categorical"&&Z==="number"&&u!==void 0&&J<u?[new Je(F.key,se,"stop domain values must appear in ascending order")]:(u=J,n==="categorical"&&J in m?[new Je(F.key,se,"stop domain values must be unique")]:(m[J]=!0,[])):[new Je(F.key,se,`integer expected, found ${J}`)]}}function vo(i){const t=(i.expressionContext==="property"?_u:mo)(Er(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Je(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!uo(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!uo(n))return[new Je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!_a(n,["zoom","feature-state"]))return[new Je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ya(n))return[new Je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ts(i){const t=i.key,n=i.value,o=i.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Ji(n))===-1&&u.push(new Je(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Ji(n))===-1&&u.push(new Je(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function wu(i){return ml(Er(i.value))?vo(mr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vl(i)}function vl(i){const t=i.value,n=i.key;if(di(t)!=="array")return[new Je(n,t,`array expected, ${di(t)} found`)];const o=i.styleSpec;let u,f=[];if(t.length<1)return[new Je(n,t,"filter array must have at least 1 element")];switch(f=f.concat(ts({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ji(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ji(t[1])==="$type"&&f.push(new Je(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Je(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=di(t[1]),u!=="string"&&f.push(new Je(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let m=2;m<t.length;m++)u=di(t[m]),Ji(t[1])==="$type"?f=f.concat(ts({key:`${n}[${m}]`,value:t[m],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Je(`${n}[${m}]`,t[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(vl({key:`${n}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=di(t[1]),t.length!==2?f.push(new Je(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Je(`${n}[1]`,t[1],`string expected, ${u} found`))}return f}function Su(i,t){const n=i.key,o=i.validateSpec,u=i.style,f=i.styleSpec,m=i.value,y=i.objectKey,x=f[`${t}_${i.layerType}`];if(!x)return[];const P=y.match(/^(.*)-transition$/);if(t==="paint"&&P&&x[P[1]]&&x[P[1]].transition)return o({key:n,value:m,valueSpec:f.transition,style:u,styleSpec:f});const k=i.valueSpec||x[y];if(!k)return[new Je(n,m,`unknown property "${y}"`)];let E;if(di(m)==="string"&&po(k)&&!k.tokens&&(E=/^{([^}]+)}$/.exec(m)))return[new Je(n,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(y==="text-field"&&u&&!u.glyphs&&D.push(new Je(n,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&hl(Er(m))&&Ji(m.type)==="identity"&&D.push(new Je(n,m,'"text-font" does not support identity functions'))),D.concat(o({key:i.key,value:m,valueSpec:k,style:u,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function xl(i){return Su(i,"paint")}function Tu(i){return Su(i,"layout")}function Pu(i){let t=[];const n=i.value,o=i.key,u=i.style,f=i.styleSpec;n.type||n.ref||t.push(new Je(o,n,'either "type" or "ref" is required'));let m=Ji(n.type);const y=Ji(n.ref);if(n.id){const x=Ji(n.id);for(let P=0;P<i.arrayIndex;P++){const k=u.layers[P];Ji(k.id)===x&&t.push(new Je(o,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(P=>{P in n&&t.push(new Je(o,n[P],`"${P}" is prohibited for ref layers`))}),u.layers.forEach(P=>{Ji(P.id)===y&&(x=P)}),x?x.ref?t.push(new Je(o,n.ref,"ref cannot reference another ref layer")):m=Ji(x.type):t.push(new Je(o,n.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(n.source){const x=u.sources&&u.sources[n.source],P=x&&Ji(x.type);x?P==="vector"&&m==="raster"?t.push(new Je(o,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&m==="hillshade"?t.push(new Je(o,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&m!=="raster"?t.push(new Je(o,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&m!=="hillshade"?t.push(new Je(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&x.lineMetrics||t.push(new Je(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Je(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Je(o,n.source,`source "${n.source}" not found`))}else t.push(new Je(o,n,'missing required property "source"'));return t=t.concat(ur({key:o,value:n,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:wu,layout:x=>ur({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>Tu(mr({layerType:m},P))}}),paint:x=>ur({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":P=>xl(mr({layerType:m},P))}})}})),t}function js(i){const t=i.value,n=i.key,o=di(t);return o!=="string"?[new Je(n,t,`string expected, ${o} found`)]:[]}const bl={promoteId:function({key:i,value:t}){if(di(t)==="string")return js({key:i,value:t});{const n=[];for(const o in t)n.push(...js({key:`${i}.${o}`,value:t[o]}));return n}}};function Sa(i){const t=i.value,n=i.key,o=i.styleSpec,u=i.style,f=i.validateSpec;if(!t.type)return[new Je(n,t,'"type" is required')];const m=Ji(t.type);let y;switch(m){case"vector":case"raster":return y=ur({key:n,value:t,valueSpec:o[`source_${m.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:bl,validateSpec:f}),y;case"raster-dem":return y=function(x){var P;const k=(P=x.sourceName)!==null&&P!==void 0?P:"",E=x.value,D=x.styleSpec,F=D.source_raster_dem,q=x.style;let Z=[];const J=di(E);if(E===void 0)return Z;if(J!=="object")return Z.push(new Je("source_raster_dem",E,`object expected, ${J} found`)),Z;const se=Ji(E.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],he=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const _e in E)!se&&we.includes(_e)?Z.push(new Je(_e,E[_e],`In "${k}": "${_e}" is only valid when "encoding" is set to "custom". ${he} encoding found`)):F[_e]?Z=Z.concat(x.validateSpec({key:_e,value:E[_e],valueSpec:F[_e],validateSpec:x.validateSpec,style:q,styleSpec:D})):Z.push(new Je(_e,E[_e],`unknown property "${_e}"`));return Z}({sourceName:n,value:t,style:i.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=ur({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:bl}),t.cluster)for(const x in t.clusterProperties){const[P,k]=t.clusterProperties[x],E=typeof P=="string"?[P,["accumulated"],["get",x]]:P;y.push(...vo({key:`${n}.${x}.map`,value:k,validateSpec:f,expressionContext:"cluster-map"})),y.push(...vo({key:`${n}.${x}.reduce`,value:E,validateSpec:f,expressionContext:"cluster-reduce"}))}return y;case"video":return ur({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return ur({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new Je(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ts({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,validateSpec:f,styleSpec:o})}}function Iu(i){const t=i.value,n=i.styleSpec,o=n.light,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Je("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:n.transition,validateSpec:i.validateSpec,style:u,styleSpec:n}):o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)])}return f}function Cu(i){const t=i.value,n=i.styleSpec,o=n.sky,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Je("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return m}function ku(i){const t=i.value,n=i.styleSpec,o=n.terrain,u=i.style;let f=[];const m=di(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Je("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:i.validateSpec,style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return f}function Au(i){let t=[];const n=i.value,o=i.key;if(Array.isArray(n)){const u=[],f=[];for(const m in n)n[m].id&&u.includes(n[m].id)&&t.push(new Je(o,n,`all the sprites' ids must be unique, but ${n[m].id} is duplicated`)),u.push(n[m].id),n[m].url&&f.includes(n[m].url)&&t.push(new Je(o,n,`all the sprites' URLs must be unique, but ${n[m].url} is duplicated`)),f.push(n[m].url),t=t.concat(ur({key:`${o}[${m}]`,value:n[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return js({key:o,value:n})}const wl={"*":()=>[],array:wa,boolean:function(i){const t=i.value,n=i.key,o=di(t);return o!=="boolean"?[new Je(n,t,`boolean expected, ${o} found`)]:[]},number:bu,color:function(i){const t=i.key,n=i.value,o=di(n);return o!=="string"?[new Je(t,n,`color expected, ${o} found`)]:vi.parse(String(n))?[]:[new Je(t,n,`color expected, "${n}" found`)]},constants:xf,enum:ts,filter:wu,function:_l,layer:Pu,object:ur,source:Sa,light:Iu,sky:Cu,terrain:ku,projection:function(i){const t=i.value,n=i.styleSpec,o=n.projection,u=i.style,f=di(t);if(t===void 0)return[];if(f!=="object")return[new Je("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(o[y]?i.validateSpec({key:y,value:t[y],valueSpec:o[y],style:u,styleSpec:n}):[new Je(y,t[y],`unknown property "${y}"`)]);return m},string:js,formatted:function(i){return js(i).length===0?[]:vo(i)},resolvedImage:function(i){return js(i).length===0?[]:vo(i)},padding:function(i){const t=i.key,n=i.value;if(di(n)==="array"){if(n.length<1||n.length>4)return[new Je(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<n.length;f++)u=u.concat(i.validateSpec({key:`${t}[${f}]`,value:n[f],validateSpec:i.validateSpec,valueSpec:o}));return u}return bu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,o=di(n),u=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Je(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<n.length;m+=2)f=f.concat(ts({key:`${t}[${m}]`,value:n[m],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(wa({key:`${t}[${m+1}]`,value:n[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:u}));return f},sprite:Au};function xo(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=xo,n.expression&&hl(Ji(t))?_l(i):n.expression&&fl(Er(t))?vo(i):n.type&&wl[n.type]?wl[n.type](i):ur(mr({},i,{valueSpec:n.type?o[n.type]:n}))}function bf(i){const t=i.value,n=i.key,o=js(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Je(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Je(n,t,'"glyphs" url must include a "{range}" token'))),o}function _r(i,t=be){let n=[];return n=n.concat(xo({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:xo,objectElementValidators:{glyphs:bf,"*":()=>[]}})),i.constants&&(n=n.concat(xf({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:xo}))),Eu(n)}function Hr(i){return function(t){return i({...t,validateSpec:xo})}}function Eu(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function Mr(i){return function(...t){return Eu(i.apply(this,t))}}_r.source=Mr(Hr(Sa)),_r.sprite=Mr(Hr(Au)),_r.glyphs=Mr(Hr(bf)),_r.light=Mr(Hr(Iu)),_r.sky=Mr(Hr(Cu)),_r.terrain=Mr(Hr(ku)),_r.layer=Mr(Hr(Pu)),_r.filter=Mr(Hr(wu)),_r.paintProperty=Mr(Hr(xl)),_r.layoutProperty=Mr(Hr(Tu));const Us=_r,Dy=Us.light,Ly=Us.sky,wf=Us.paintProperty,Sf=Us.layoutProperty;function Mu(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new mt(new Error(o.message))),n=!0;return n}class bo{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(n=m[1])+2*(o=m[2]);for(let x=0;x<this.d*this.d;x++){const P=m[3+x],k=m[3+x+1];u.push(P===k?null:m.subarray(P,k))}const y=m[3+u.length+1];this.keys=m.subarray(m[3+u.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let m=0;m<this.d*this.d;m++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const f=o/n*t;this.min=-f,this.max=t+f}insert(t,n,o,u,f){this._forEachCell(n,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,f,m){this.cells[f].push(m)}query(t,n,o,u,f){const m=this.min,y=this.max;if(t<=m&&n<=m&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,u,this._queryCell,x,{},f),x}}_queryCell(t,n,o,u,f,m,y,x){const P=this.cells[f];if(P!==null){const k=this.keys,E=this.bboxes;for(let D=0;D<P.length;D++){const F=P[D];if(y[F]===void 0){const q=4*F;(x?x(E[q+0],E[q+1],E[q+2],E[q+3]):t<=E[q+2]&&n<=E[q+3]&&o>=E[q+0]&&u>=E[q+1])?(y[F]=!0,m.push(k[F])):y[F]=!1}}}}_forEachCell(t,n,o,u,f,m,y,x){const P=this._convertToCellCoord(t),k=this._convertToCellCoord(n),E=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let F=P;F<=E;F++)for(let q=k;q<=D;q++){const Z=this.d*q+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(q),this._convertFromCellCoord(F+1),this._convertFromCellCoord(q+1)))&&f.call(this,t,n,o,u,Z,m,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let m=0;m<this.cells.length;m++)o+=this.cells[m].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=n;for(let m=0;m<t.length;m++){const y=t[m];u[3+m]=f,u.set(y,f),f+=y.length}return u[3+t.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+t.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new bo(t.buffer)}}const vr={};function _t(i,t,n={}){if(vr[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),vr[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}_t("Object",Object),_t("TransferableGridIndex",bo),_t("Color",vi),_t("Error",Error),_t("AJAXError",Ui),_t("ResolvedImage",cr),_t("StylePropertyFunction",_o),_t("StyleExpression",pl,{omit:["_evaluator"]}),_t("ZoomDependentExpression",yo),_t("ZoomConstantExpression",go),_t("CompoundExpression",yr,{omit:["_evaluate"]});for(const i in co)co[i]._classRegistryKey||_t(`Expression_${i}`,co[i]);function Sl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function zu(i){return i.$name||i.constructor._classRegistryKey}function Tf(i){return!function(t){if(t===null||typeof t!="object")return!1;const n=zu(t);return!(!n||n==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Sl(i)||pt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function wo(i,t){if(Tf(i))return(Sl(i)||pt(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(wo(m,t));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=zu(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!vr[n])throw new Error(`${n} is not registered.`);const{klass:o}=vr[n],u=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||vr[n].omit.indexOf(f)>=0)continue;const m=i[f];u[f]=vr[n].shallow.indexOf(f)>=0?m:wo(m,t)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function So(i){if(Tf(i))return i;if(Array.isArray(i))return i.map(So);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=zu(i)||"Object";if(!vr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=vr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const u of Object.keys(i)){if(u==="$name")continue;const f=i[u];o[u]=vr[t].shallow.indexOf(u)>=0?f:So(f)}return o}class Du{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const oi={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Lu(i){for(const t of i)if(Ou(t.charCodeAt(0)))return!0;return!1}function Ry(i){for(const t of i)if(!To(t.charCodeAt(0)))return!1;return!0}function Ru(i){const t=i.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Oy=Ru(["Arab","Dupl","Mong","Ougr","Syrc"]);function To(i){return!Oy.test(String.fromCodePoint(i))}const Pf=Ru(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Ou(i){return!(i!==746&&i!==747&&(i<4352||!(oi["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||oi["CJK Compatibility"](i)||oi["CJK Strokes"](i)||!(!oi["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||oi["Enclosed CJK Letters and Months"](i)||oi["Ideographic Description Characters"](i)||oi.Kanbun(i)||oi.Katakana(i)&&i!==12540||!(!oi["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!oi["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||oi["Vertical Forms"](i)||oi["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Pf.test(String.fromCodePoint(i)))))}function If(i){return!(Ou(i)||function(t){return!!(oi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||oi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||oi["Letterlike Symbols"](t)||oi["Number Forms"](t)||oi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||oi["Control Pictures"](t)&&t!==9251||oi["Optical Character Recognition"](t)||oi["Enclosed Alphanumerics"](t)||oi["Geometric Shapes"](t)||oi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||oi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||oi["CJK Symbols and Punctuation"](t)||oi.Katakana(t)||oi["Private Use Area"](t)||oi["CJK Compatibility Forms"](t)||oi["Small Form Variants"](t)||oi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Fy=Ru(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Fu(i){return Fy.test(String.fromCodePoint(i))}function By(i,t){return!(!t&&Fu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||oi.Khmer(i))}function Ny(i){for(const t of i)if(Fu(t.charCodeAt(0)))return!0;return!1}const hr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ei{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Du,this.transition={})}isSupportedScript(t){return function(n,o){for(const u of n)if(!By(u.charCodeAt(0),o))return!1;return!0}(t,hr.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Po{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,u){if(hl(o))return new _o(o,u);if(fl(o)){const f=_u(o,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=o;return u.type==="color"&&typeof o=="string"?f=vi.parse(o):u.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?u.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(f=gr.parse(o)):f=lr.parse(o),{kind:"constant",evaluate:()=>f}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Tl{constructor(t){this.property=t,this.value=new Po(t,void 0)}transitioned(t,n){return new Cf(this.property,this.value,n,$e({},t.transition,this.transition),t.now)}untransitioned(){return new Cf(this.property,this.value,null,{},0)}}class Pl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Be(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Tl(this._values[t].property)),this._values[t].value=new Po(this._values[t].property,n===null?void 0:Be(n))}getTransition(t){return Be(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Tl(this._values[t].property)),this._values[t].transition=Be(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new Ta(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new Ta(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Cf{constructor(t,n,o,u,f){this.property=t,this.value=n,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,f=this.value.possiblyEvaluate(t,n,o),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(t,n,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,n,o),f,function(x){if(x<=0)return 0;if(x>=1)return 1;const P=x*x,k=P*x;return 4*(x<.5?k:3*(x-P)+k-.75)}(y))}}return f}}class Ta{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new Ia(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Pa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Be(this._values[t].value)}setValue(t,n){this._values[t]=new Po(this._values[t].property,n===null?void 0:Be(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new Ia(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(t,n,o);return u}}class Xr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class Ia{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class bt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=Kn[this.specification.type];return u?u(t,n,o):t}}class Rt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new Xr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Xr(this,{kind:"constant",value:void 0},t.parameters);const u=Kn[this.specification.type];if(u){const f=u(t.value.value,n.value.value,o);return new Xr(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,n,o,u,f,m){return t.kind==="constant"?t.value:t.evaluate(n,o,u,f,m)}}class Il extends Rt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new Xr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const f=t.expression.evaluate(n,null,{},o,u),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,n);return new Xr(this,{kind:"constant",value:y},n)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Xr(this,{kind:"constant",value:f},n)}return new Xr(this,t.expression,n)}evaluate(t,n,o,u,f,m){if(t.kind==="source"){const y=t.evaluate(n,o,u,f,m);return this._calculate(y,y,y,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Cl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(n,null,{},o,u);return this._calculate(f,f,f,n)}return this._calculate(t.expression.evaluate(new Ei(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Ei(Math.floor(n.zoom),n)),t.expression.evaluate(new Ei(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Bu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class p{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new Po(o,void 0),f=this.defaultTransitionablePropertyValues[n]=new Tl(o);this.defaultTransitioningPropertyValues[n]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}_t("DataDrivenProperty",Rt),_t("DataConstantProperty",bt),_t("CrossFadedDataDrivenProperty",Il),_t("CrossFadedProperty",Cl),_t("ColorRampProperty",Bu);const e="-transition";class r extends Bt{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new Pa(n.layout)),n.paint)){this._transitionablePaint=new Pl(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ia(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Sf,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(wf,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],f=u.property.specification["property-type"]==="cross-faded-data-driven",m=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ye(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,f={}){return(!f||f.validate!==!1)&&Mu(this,t.call(Us,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Xr&&po(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const a={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class d{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function _(i,t=1){let n=0,o=0;return{members:i.map(u=>{const f=a[u.type].BYTES_PER_ELEMENT,m=n=w(n,Math.max(t,f)),y=u.components||1;return o=Math.max(o,f),n+=f*y,{name:u.name,type:u.type,components:y,offset:m}}),size:w(n,Math.max(o,t)),alignment:t}}function w(i,t){return Math.ceil(i/t)*t}class S extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}S.prototype.bytesPerElement=4,_t("StructArrayLayout2i4",S);class A extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=u,t}}A.prototype.bytesPerElement=6,_t("StructArrayLayout3i6",A);class M extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o,u)}emplace(t,n,o,u,f){const m=4*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=u,this.int16[m+3]=f,t}}M.prototype.bytesPerElement=8,_t("StructArrayLayout4i8",M);class z extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}z.prototype.bytesPerElement=12,_t("StructArrayLayout2i4i12",z);class N extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=4*t,P=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[P+4]=u,this.uint8[P+5]=f,this.uint8[P+6]=m,this.uint8[P+7]=y,t}}N.prototype.bytesPerElement=8,_t("StructArrayLayout2i4ub8",N);class G extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}G.prototype.bytesPerElement=8,_t("StructArrayLayout2f8",G);class X extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,k){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,u,f,m,y,x,P,k)}emplace(t,n,o,u,f,m,y,x,P,k,E){const D=10*t;return this.uint16[D+0]=n,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=P,this.uint16[D+8]=k,this.uint16[D+9]=E,t}}X.prototype.bytesPerElement=20,_t("StructArrayLayout10ui20",X);class te extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,k,E,D){const F=this.length;return this.resize(F+1),this.emplace(F,t,n,o,u,f,m,y,x,P,k,E,D)}emplace(t,n,o,u,f,m,y,x,P,k,E,D,F){const q=12*t;return this.int16[q+0]=n,this.int16[q+1]=o,this.int16[q+2]=u,this.int16[q+3]=f,this.uint16[q+4]=m,this.uint16[q+5]=y,this.uint16[q+6]=x,this.uint16[q+7]=P,this.int16[q+8]=k,this.int16[q+9]=E,this.int16[q+10]=D,this.int16[q+11]=F,t}}te.prototype.bytesPerElement=24,_t("StructArrayLayout4i4ui4i24",te);class oe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=u,t}}oe.prototype.bytesPerElement=12,_t("StructArrayLayout3f12",oe);class ae extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}ae.prototype.bytesPerElement=4,_t("StructArrayLayout1ul4",ae);class ue extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P){const k=this.length;return this.resize(k+1),this.emplace(k,t,n,o,u,f,m,y,x,P)}emplace(t,n,o,u,f,m,y,x,P,k){const E=10*t,D=5*t;return this.int16[E+0]=n,this.int16[E+1]=o,this.int16[E+2]=u,this.int16[E+3]=f,this.int16[E+4]=m,this.int16[E+5]=y,this.uint32[D+3]=x,this.uint16[E+8]=P,this.uint16[E+9]=k,t}}ue.prototype.bytesPerElement=20,_t("StructArrayLayout6i1ul2ui20",ue);class $ extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}$.prototype.bytesPerElement=12,_t("StructArrayLayout2i2i2i12",$);class fe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,u,f)}emplace(t,n,o,u,f,m){const y=4*t,x=8*t;return this.float32[y+0]=n,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=m,t}}fe.prototype.bytesPerElement=16,_t("StructArrayLayout2f1f2i16",fe);class ge extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,n,o,u,f,m)}emplace(t,n,o,u,f,m,y){const x=16*t,P=4*t,k=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[P+1]=u,this.float32[P+2]=f,this.int16[k+6]=m,this.int16[k+7]=y,t}}ge.prototype.bytesPerElement=16,_t("StructArrayLayout2ub2f2i16",ge);class Se extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.uint16[f+0]=n,this.uint16[f+1]=o,this.uint16[f+2]=u,t}}Se.prototype.bytesPerElement=6,_t("StructArrayLayout3ui6",Se);class Fe extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se){const we=this.length;return this.resize(we+1),this.emplace(we,t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se)}emplace(t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se,we){const he=24*t,_e=12*t,Ae=48*t;return this.int16[he+0]=n,this.int16[he+1]=o,this.uint16[he+2]=u,this.uint16[he+3]=f,this.uint32[_e+2]=m,this.uint32[_e+3]=y,this.uint32[_e+4]=x,this.uint16[he+10]=P,this.uint16[he+11]=k,this.uint16[he+12]=E,this.float32[_e+7]=D,this.float32[_e+8]=F,this.uint8[Ae+36]=q,this.uint8[Ae+37]=Z,this.uint8[Ae+38]=J,this.uint32[_e+10]=se,this.int16[he+22]=we,t}}Fe.prototype.bytesPerElement=48,_t("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Fe);class Ke extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se,we,he,_e,Ae,Ze,ft,Lt,ht,ot,Tt,vt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se,we,he,_e,Ae,Ze,ft,Lt,ht,ot,Tt,vt)}emplace(t,n,o,u,f,m,y,x,P,k,E,D,F,q,Z,J,se,we,he,_e,Ae,Ze,ft,Lt,ht,ot,Tt,vt,yt){const Re=32*t,kt=16*t;return this.int16[Re+0]=n,this.int16[Re+1]=o,this.int16[Re+2]=u,this.int16[Re+3]=f,this.int16[Re+4]=m,this.int16[Re+5]=y,this.int16[Re+6]=x,this.int16[Re+7]=P,this.uint16[Re+8]=k,this.uint16[Re+9]=E,this.uint16[Re+10]=D,this.uint16[Re+11]=F,this.uint16[Re+12]=q,this.uint16[Re+13]=Z,this.uint16[Re+14]=J,this.uint16[Re+15]=se,this.uint16[Re+16]=we,this.uint16[Re+17]=he,this.uint16[Re+18]=_e,this.uint16[Re+19]=Ae,this.uint16[Re+20]=Ze,this.uint16[Re+21]=ft,this.uint16[Re+22]=Lt,this.uint32[kt+12]=ht,this.float32[kt+13]=ot,this.float32[kt+14]=Tt,this.uint16[Re+30]=vt,this.uint16[Re+31]=yt,t}}Ke.prototype.bytesPerElement=64,_t("StructArrayLayout8i15ui1ul2f2ui64",Ke);class lt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}lt.prototype.bytesPerElement=4,_t("StructArrayLayout1f4",lt);class gt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=3*t;return this.uint16[6*t+0]=n,this.float32[f+1]=o,this.float32[f+2]=u,t}}gt.prototype.bytesPerElement=12,_t("StructArrayLayout1ui2f12",gt);class rt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const f=4*t;return this.uint32[2*t+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=u,t}}rt.prototype.bytesPerElement=8,_t("StructArrayLayout1ul2ui8",rt);class nt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}nt.prototype.bytesPerElement=4,_t("StructArrayLayout2ui4",nt);class wt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}wt.prototype.bytesPerElement=2,_t("StructArrayLayout1ui2",wt);class Zt extends d{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,t,n,o,u)}emplace(t,n,o,u,f){const m=4*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=u,this.float32[m+3]=f,t}}Zt.prototype.bytesPerElement=16,_t("StructArrayLayout4f16",Zt);class st extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}st.prototype.size=20;class dt extends ue{get(t){return new st(this,t)}}_t("CollisionBoxArray",dt);class jt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}jt.prototype.size=48;class Mi extends Fe{get(t){return new jt(this,t)}}_t("PlacedSymbolArray",Mi);class Jt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Jt.prototype.size=64;class ni extends Ke{get(t){return new Jt(this,t)}}_t("SymbolInstanceArray",ni);class zi extends lt{getoffsetX(t){return this.float32[1*t+0]}}_t("GlyphOffsetArray",zi);class An extends A{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}_t("SymbolLineVertexArray",An);class zr extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}zr.prototype.size=12;class Di extends gt{get(t){return new zr(this,t)}}_t("TextAnchorOffsetArray",Di);class Jn extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Jn.prototype.size=8;class Nn extends rt{get(t){return new Jn(this,t)}}_t("FeatureIndexArray",Nn);class En extends S{}class Vn extends S{}class Kr extends S{}class Io extends z{}class kl extends N{}class Co extends G{}class xr extends X{}class Al extends te{}class Nu extends oe{}class br extends ae{}class wr extends ${}class fs extends ge{}class Dr extends Se{}class wn extends nt{}const Mn=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:dr}=Mn;class ai{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,u){let f=this.segments[this.segments.length-1];return t>ai.MAX_VERTEX_ARRAY_LENGTH&&De(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>ai.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new ai([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function qs(i,t){return 256*(i=ze(Math.floor(i),0,255))+ze(Math.floor(t),0,255)}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_t("SegmentVector",ai);const ko=_([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ao={exports:{}},kf={exports:{}};kf.exports=function(i,t){var n,o,u,f,m,y,x,P;for(o=i.length-(n=3&i.length),u=t,m=3432918353,y=461845907,P=0;P<o;)x=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&i.charCodeAt(P+2))<<16;case 2:x^=(255&i.charCodeAt(P+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(P)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=i.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Vy=kf.exports,Af={exports:{}};Af.exports=function(i,t){for(var n,o=i.length,u=t^o,f=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++f;switch(o){case 3:u^=(255&i.charCodeAt(f+2))<<16;case 2:u^=(255&i.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&i.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var ms=Vy,Ef=Af.exports;Ao.exports=ms,Ao.exports.murmur3=ms,Ao.exports.murmur2=Ef;var El=j(Ao.exports);class Ca{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(Ml(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ml(t);let o=0,u=this.ids.length-1;for(;o<u;){const m=o+u>>1;this.ids[m]>=n?u=m:o=m+1}const f=[];for(;this.ids[o]===n;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return zl(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new Ca;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Ml(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:El(String(i))}function zl(i,t,n,o){for(;n<o;){const u=i[n+o>>1];let f=n-1,m=o+1;for(;;){do f++;while(i[f]<u);do m--;while(i[m]>u);if(f>=m)break;Eo(i,f,m),Eo(t,3*f,3*m),Eo(t,3*f+1,3*m+1),Eo(t,3*f+2,3*m+2)}m-n<o-m?(zl(i,t,n,m),n=m+1):(zl(i,t,m+1,o),o=m)}}function Eo(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}_t("FeaturePositionMap",Ca);class ka{constructor(t,n){this.gl=t.gl,this.location=n}}class Mf extends ka{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Bv extends ka{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Nv extends ka{constructor(t,n){super(t,n),this.current=vi.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const K1=new Float32Array(16);function jy(i){return[qs(255*i.r,255*i.g),qs(255*i.b,255*i.a)]}class Vu{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Nv(t,n):new Mf(t,n)}}class Dl{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,u){const f=u==="u_pattern_to"?this.patternTo:u==="u_pattern_from"?this.patternFrom:u==="u_pixel_ratio_to"?this.pixelRatioTo:u==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Bv(t,n):new Mf(t,n)}}class Zs{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o,u,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Ei(0),n,{},u,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,n,o,u){const f=this.expression.evaluate({zoom:0},o,u);this._setPaintValue(t,n,f)}_setPaintValue(t,n,o){if(this.type==="color"){const u=jy(o);for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class is{constructor(t,n,o,u,f,m){this.expression=t,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,n,o,u,f){const m=this.expression.evaluate(new Ei(this.zoom),n,{},u,[],f),y=this.expression.evaluate(new Ei(this.zoom+1),n,{},u,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,y)}updatePaintArray(t,n,o,u){const f=this.expression.evaluate({zoom:this.zoom},o,u),m=this.expression.evaluate({zoom:this.zoom+1},o,u);this._setPaintValue(t,n,f,m)}_setPaintValue(t,n,o,u){if(this.type==="color"){const f=jy(o),m=jy(u);for(let y=t;y<n;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<n;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=ze(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new Mf(t,n)}}class Mo{constructor(t,n,o,u,f,m){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,u,f){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(t,n,o,u){if(!u||!o)return;const{min:f,mid:m,max:y}=o,x=u[f],P=u[m],k=u[y];if(x&&P&&k)for(let E=t;E<n;E++)this.zoomInPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],P.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,P.tl[0],P.tl[1],P.br[0],P.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],P.pixelRatio,k.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ko.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ko.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Vv{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const f in t.paint._values){if(!o(f))continue;const m=t.paint.get(f);if(!(m instanceof Xr&&po(m.property.specification)))continue;const y=$1(f,t.type),x=m.value,P=m.property.specification.type,k=m.property.useIntegerZoom,E=m.property.specification["property-type"],D=E==="cross-faded"||E==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new Dl(x.value,y):new Vu(x.value,y,P),u.push(`/u_${f}`);else if(x.kind==="source"||D){const F=jv(f,P,"source");this.binders[f]=D?new Mo(x,P,k,n,F,t.id):new Zs(x,y,P,F),u.push(`/a_${f}`)}else{const F=jv(f,P,"composite");this.binders[f]=new is(x,y,P,k,n,F),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Zs||n instanceof is?n.maxValue:0}populatePaintArrays(t,n,o,u,f){for(const m in this.binders){const y=this.binders[m];(y instanceof Zs||y instanceof is||y instanceof Mo)&&y.populatePaintArray(t,n,o,u,f)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Dl&&u.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,u,f){let m=!1;for(const y in t){const x=n.getPositions(y);for(const P of x){const k=o.feature(P.index);for(const E in this.binders){const D=this.binders[E];if((D instanceof Zs||D instanceof is||D instanceof Mo)&&D.expression.isStateDependent===!0){const F=u.paint.get(E);D.expression=F.value,D.updatePaintArray(P.start,P.end,k,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Vu||o instanceof Dl)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Zs||o instanceof is)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Mo)for(let u=0;u<ko.members.length;u++)t.push(ko.members[u].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Vu||o instanceof Dl||o instanceof is)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Vu||f instanceof Dl||f instanceof is){for(const m of f.uniformNames)if(n[m]){const y=f.getBinding(t,n[m],m);o.push({name:m,property:u,binding:y})}}}return o}setUniforms(t,n,o,u){for(const{name:f,property:m,binding:y}of n)this.binders[m].setUniform(y,u,o.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Mo){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Zs||o instanceof is)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Zs||o instanceof is||o instanceof Mo)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Zs||n instanceof is||n instanceof Mo)&&n.destroy()}}}class Aa{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new Vv(u,n,o);this.needsUpload=!1,this._featureMap=new Ca,this._bufferOffset=0}populatePaintArrays(t,n,o,u,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,n,u,f,m);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,n,f,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function $1(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function jv(i,t,n){const o={color:{source:G,composite:Zt},number:{source:lt,composite:G}},u=function(f){return{"line-pattern":{source:xr,composite:xr},"fill-pattern":{source:xr,composite:xr},"fill-extrusion-pattern":{source:xr,composite:xr}}[f]}(i);return u&&u[n]||o[t][n]}_t("ConstantBinder",Vu),_t("CrossFadedConstantBinder",Dl),_t("SourceExpressionBinder",Zs),_t("CrossFadedCompositeBinder",Mo),_t("CompositeExpressionBinder",is),_t("ProgramConfiguration",Vv,{omit:["_buffers"]}),_t("ProgramConfigurationSet",Aa);const ln=8192,Uy=Math.pow(2,14)-1,Uv=-Uy-1;function Ea(i){const t=ln/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let f=0;f<u.length;f++){const m=u[f],y=Math.round(m.x*t),x=Math.round(m.y*t);m.x=ze(y,Uv,Uy),m.y=ze(x,Uv,Uy),(y<m.x||y>m.x+1||x<m.y||x>m.y+1)&&De("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Ma(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Ea(i):[]}}function zf(i,t,n,o,u){i.emplaceBack(2*t+(o+1)/2,2*n+(u+1)/2)}class qy{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Vn,this.indexArray=new Dr,this.segments=new ai,this.programConfigurations=new Aa(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],f=[];let m=null,y=!1;u.type==="circle"&&(m=u.layout.get("circle-sort-key"),y=!m.isConstant());for(const{feature:x,id:P,index:k,sourceLayerIndex:E}of t){const D=this.layers[0]._featureFilter.needGeometry,F=Ma(x,D);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),F,o))continue;const q=y?m.evaluate(F,{},o):void 0,Z={id:P,properties:x.properties,type:x.type,sourceLayerIndex:E,index:k,geometry:D?F.geometry:Ea(x),patterns:{},sortKey:q};f.push(Z)}y&&f.sort((x,P)=>x.sortKey-P.sortKey);for(const x of f){const{geometry:P,index:k,sourceLayerIndex:E}=x,D=t[k].feature;this.addFeature(x,P,k,o),n.featureIndex.insert(D,P,k,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u){for(const f of n)for(const m of f){const y=m.x,x=m.y;if(y<0||y>=ln||x<0||x>=ln)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),k=P.vertexLength;zf(this.layoutVertexArray,y,x,-1,-1),zf(this.layoutVertexArray,y,x,1,-1),zf(this.layoutVertexArray,y,x,1,1),zf(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+3,k+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},u)}}function qv(i,t){for(let n=0;n<i.length;n++)if(Ll(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Ll(i,t[n]))return!0;return!!Zy(i,t)}function J1(i,t,n){return!!Ll(i,t)||!!Gy(t,i,n)}function Zv(i,t){if(i.length===1)return Wv(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(Ll(i,o[u]))return!0}for(let n=0;n<i.length;n++)if(Wv(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Zy(i,t[n]))return!0;return!1}function Y1(i,t,n){if(i.length>1){if(Zy(i,t))return!0;for(let o=0;o<t.length;o++)if(Gy(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Gy(i[o],t,n))return!0;return!1}function Zy(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],u=i[n+1];for(let f=0;f<t.length-1;f++)if(Q1(o,u,t[f],t[f+1]))return!0}return!1}function Q1(i,t,n,o){return ke(i,n,o)!==ke(t,n,o)&&ke(i,t,n)!==ke(i,t,o)}function Gy(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(Gv(i,t[u-1],t[u])<o)return!0;return!1}function Gv(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const u=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Wv(i,t){let n,o,u,f=!1;for(let m=0;m<i.length;m++){n=i[m];for(let y=0,x=n.length-1;y<n.length;x=y++)o=n[y],u=n[x],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function Ll(i,t){let n=!1;for(let o=0,u=i.length-1;o<i.length;u=o++){const f=i[o],m=i[u];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(n=!n)}return n}function ew(i,t,n){const o=n[0],u=n[2];if(i.x<o.x&&t.x<o.x||i.x>u.x&&t.x>u.x||i.y<o.y&&t.y<o.y||i.y>u.y&&t.y>u.y)return!1;const f=ke(i,t,n[0]);return f!==ke(i,t,n[1])||f!==ke(i,t,n[2])||f!==ke(i,t,n[3])}function ju(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Df(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Lf(i,t,n,o,u){if(!t[0]&&!t[1])return i;const f=B.convert(t)._mult(u);n==="viewport"&&f._rotate(-o);const m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(f));return m}let Hv,Xv;_t("CircleBucket",qy,{omit:["layers"]});var tw={get paint(){return Xv=Xv||new p({"circle-radius":new Rt(be.paint_circle["circle-radius"]),"circle-color":new Rt(be.paint_circle["circle-color"]),"circle-blur":new Rt(be.paint_circle["circle-blur"]),"circle-opacity":new Rt(be.paint_circle["circle-opacity"]),"circle-translate":new bt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Rt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Rt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Rt(be.paint_circle["circle-stroke-opacity"])})},get layout(){return Hv=Hv||new p({"circle-sort-key":new Rt(be.layout_circle["circle-sort-key"])})}},Yn=1e-6,Rl=typeof Float32Array<"u"?Float32Array:Array;function Wy(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Kv(i,t,n){var o=t[0],u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],P=t[6],k=t[7],E=t[8],D=t[9],F=t[10],q=t[11],Z=t[12],J=t[13],se=t[14],we=t[15],he=n[0],_e=n[1],Ae=n[2],Ze=n[3];return i[0]=he*o+_e*y+Ae*E+Ze*Z,i[1]=he*u+_e*x+Ae*D+Ze*J,i[2]=he*f+_e*P+Ae*F+Ze*se,i[3]=he*m+_e*k+Ae*q+Ze*we,i[4]=(he=n[4])*o+(_e=n[5])*y+(Ae=n[6])*E+(Ze=n[7])*Z,i[5]=he*u+_e*x+Ae*D+Ze*J,i[6]=he*f+_e*P+Ae*F+Ze*se,i[7]=he*m+_e*k+Ae*q+Ze*we,i[8]=(he=n[8])*o+(_e=n[9])*y+(Ae=n[10])*E+(Ze=n[11])*Z,i[9]=he*u+_e*x+Ae*D+Ze*J,i[10]=he*f+_e*P+Ae*F+Ze*se,i[11]=he*m+_e*k+Ae*q+Ze*we,i[12]=(he=n[12])*o+(_e=n[13])*y+(Ae=n[14])*E+(Ze=n[15])*Z,i[13]=he*u+_e*x+Ae*D+Ze*J,i[14]=he*f+_e*P+Ae*F+Ze*se,i[15]=he*m+_e*k+Ae*q+Ze*we,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Uu,iw=Kv;function Rf(i,t,n){var o=t[0],u=t[1],f=t[2],m=t[3];return i[0]=n[0]*o+n[4]*u+n[8]*f+n[12]*m,i[1]=n[1]*o+n[5]*u+n[9]*f+n[13]*m,i[2]=n[2]*o+n[6]*u+n[10]*f+n[14]*m,i[3]=n[3]*o+n[7]*u+n[11]*f+n[15]*m,i}Uu=new Rl(4),Rl!=Float32Array&&(Uu[0]=0,Uu[1]=0,Uu[2]=0,Uu[3]=0);class nw extends r{constructor(t){super(t,tw)}createBucket(t){return new qy(t)}queryRadius(t){const n=t;return ju("circle-radius",this,n)+ju("circle-stroke-width",this,n)+Df(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y,x){const P=Lf(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),k=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),E=this.paint.get("circle-pitch-alignment")==="map",D=E?P:function(q,Z){return q.map(J=>$v(J,Z))}(P,x),F=E?k*y:k;for(const q of u)for(const Z of q){const J=E?Z:$v(Z,x);let se=F;const we=Rf([],[Z.x,Z.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=we[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=m.cameraToCenterDistance/we[3]),J1(D,J,se))return!0}return!1}}function $v(i,t){const n=Rf([],[i.x,i.y,0,1],t);return new B(n[0]/n[3],n[1]/n[3])}class Jv extends qy{}let Yv;_t("HeatmapBucket",Jv,{omit:["layers"]});var rw={get paint(){return Yv=Yv||new p({"heatmap-radius":new Rt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Rt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bu(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(be.paint_heatmap["heatmap-opacity"])})}};function Hy(i,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=u,i}function Qv(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const u=Hy({},{width:t,height:n},o);Xy(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=u.data}function Xy(i,t,n,o,u,f){if(u.width===0||u.height===0)return t;if(u.width>i.width||u.height>i.height||n.x>i.width-u.width||n.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const P=((n.y+x)*i.width+n.x)*f,k=((o.y+x)*t.width+o.x)*f;for(let E=0;E<u.width*f;E++)y[k+E]=m[P+E]}return t}class qu{constructor(t,n){Hy(this,t,1,n)}resize(t){Qv(this,t,1)}clone(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,f){Xy(t,n,o,u,f,1)}}class Lr{constructor(t,n){Hy(this,t,4,n)}resize(t){Qv(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Lr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,f){Xy(t,n,o,u,f,4)}}function e0(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,u=i.image||new Lr({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const f=(m,y,x)=>{t[i.evaluationKey]=x;const P=i.expression.evaluate(t);u.data[m+y+0]=Math.floor(255*P.r/P.a),u.data[m+y+1]=Math.floor(255*P.g/P.a),u.data[m+y+2]=Math.floor(255*P.b/P.a),u.data[m+y+3]=Math.floor(255*P.a)};if(i.clips)for(let m=0,y=0;m<o;++m,y+=4*n)for(let x=0,P=0;x<n;x++,P+=4){const k=x/(n-1),{start:E,end:D}=i.clips[m];f(y,P,E*(1-k)+D*k)}else for(let m=0,y=0;m<n;m++,y+=4)f(0,y,m/(n-1));return u}_t("AlphaImage",qu),_t("RGBAImage",Lr);const Ky="big-fb";class sw extends r{createBucket(t){return new Jv(t)}constructor(t){super(t,rw),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=e0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Ky)&&this.heatmapFbos.delete(Ky)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let t0;var ow={get paint(){return t0=t0||new p({"hillshade-illumination-direction":new bt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(be.paint_hillshade["hillshade-accent-color"])})}};class aw extends r{constructor(t){super(t,ow)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const lw=_([{name:"a_pos",components:2,type:"Int16"}],4),{members:cw}=lw;function i0(i,t,n=2){const o=t&&t.length,u=o?t[0]*n:i.length;let f=n0(i,0,u,n,!0);const m=[];if(!f||f.next===f.prev)return m;let y,x,P;if(o&&(f=function(k,E,D,F){const q=[];for(let Z=0,J=E.length;Z<J;Z++){const se=n0(k,E[Z]*F,Z<J-1?E[Z+1]*F:k.length,F,!1);se===se.next&&(se.steiner=!0),q.push(yw(se))}q.sort(fw);for(let Z=0;Z<q.length;Z++)D=mw(q[Z],D);return D}(i,t,f,n)),i.length>80*n){y=1/0,x=1/0;let k=-1/0,E=-1/0;for(let D=n;D<u;D+=n){const F=i[D],q=i[D+1];F<y&&(y=F),q<x&&(x=q),F>k&&(k=F),q>E&&(E=q)}P=Math.max(k-y,E-x),P=P!==0?32767/P:0}return Zu(f,m,n,y,x,P,0),m}function n0(i,t,n,o,u){let f;if(u===function(m,y,x,P){let k=0;for(let E=y,D=x-P;E<x;E+=P)k+=(m[D]-m[E])*(m[E+1]+m[D+1]),D=E;return k}(i,t,n,o)>0)for(let m=t;m<n;m+=o)f=o0(m/o|0,i[m],i[m+1],f);else for(let m=n-o;m>=t;m-=o)f=o0(m/o|0,i[m],i[m+1],f);return f&&Of(f,f.next)&&(Wu(f),f=f.next),f}function za(i,t){if(!i)return i;t||(t=i);let n,o=i;do if(n=!1,o.steiner||!Of(o,o.next)&&tn(o.prev,o,o.next)!==0)o=o.next;else{if(Wu(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Zu(i,t,n,o,u,f,m){if(!i)return;!m&&f&&function(x,P,k,E){let D=x;do D.z===0&&(D.z=$y(D.x,D.y,P,k,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(F){let q,Z=1;do{let J,se=F;F=null;let we=null;for(q=0;se;){q++;let he=se,_e=0;for(let Ze=0;Ze<Z&&(_e++,he=he.nextZ,he);Ze++);let Ae=Z;for(;_e>0||Ae>0&&he;)_e!==0&&(Ae===0||!he||se.z<=he.z)?(J=se,se=se.nextZ,_e--):(J=he,he=he.nextZ,Ae--),we?we.nextZ=J:F=J,J.prevZ=we,we=J;se=he}we.nextZ=null,Z*=2}while(q>1)}(D)}(i,o,u,f);let y=i;for(;i.prev!==i.next;){const x=i.prev,P=i.next;if(f?hw(i,o,u,f):uw(i))t.push(x.i,i.i,P.i),Wu(i),i=P.next,y=P.next;else if((i=P)===y){m?m===1?Zu(i=dw(za(i),t),t,n,o,u,f,2):m===2&&pw(i,t,n,o,u,f):Zu(za(i),t,n,o,u,f,1);break}}}function uw(i){const t=i.prev,n=i,o=i.next;if(tn(t,n,o)>=0)return!1;const u=t.x,f=n.x,m=o.x,y=t.y,x=n.y,P=o.y,k=u<f?u<m?u:m:f<m?f:m,E=y<x?y<P?y:P:x<P?x:P,D=u>f?u>m?u:m:f>m?f:m,F=y>x?y>P?y:P:x>P?x:P;let q=o.next;for(;q!==t;){if(q.x>=k&&q.x<=D&&q.y>=E&&q.y<=F&&Ol(u,y,f,x,m,P,q.x,q.y)&&tn(q.prev,q,q.next)>=0)return!1;q=q.next}return!0}function hw(i,t,n,o){const u=i.prev,f=i,m=i.next;if(tn(u,f,m)>=0)return!1;const y=u.x,x=f.x,P=m.x,k=u.y,E=f.y,D=m.y,F=y<x?y<P?y:P:x<P?x:P,q=k<E?k<D?k:D:E<D?E:D,Z=y>x?y>P?y:P:x>P?x:P,J=k>E?k>D?k:D:E>D?E:D,se=$y(F,q,t,n,o),we=$y(Z,J,t,n,o);let he=i.prevZ,_e=i.nextZ;for(;he&&he.z>=se&&_e&&_e.z<=we;){if(he.x>=F&&he.x<=Z&&he.y>=q&&he.y<=J&&he!==u&&he!==m&&Ol(y,k,x,E,P,D,he.x,he.y)&&tn(he.prev,he,he.next)>=0||(he=he.prevZ,_e.x>=F&&_e.x<=Z&&_e.y>=q&&_e.y<=J&&_e!==u&&_e!==m&&Ol(y,k,x,E,P,D,_e.x,_e.y)&&tn(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;he&&he.z>=se;){if(he.x>=F&&he.x<=Z&&he.y>=q&&he.y<=J&&he!==u&&he!==m&&Ol(y,k,x,E,P,D,he.x,he.y)&&tn(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;_e&&_e.z<=we;){if(_e.x>=F&&_e.x<=Z&&_e.y>=q&&_e.y<=J&&_e!==u&&_e!==m&&Ol(y,k,x,E,P,D,_e.x,_e.y)&&tn(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function dw(i,t){let n=i;do{const o=n.prev,u=n.next.next;!Of(o,u)&&r0(o,n,n.next,u)&&Gu(o,u)&&Gu(u,o)&&(t.push(o.i,n.i,u.i),Wu(n),Wu(n.next),n=i=u),n=n.next}while(n!==i);return za(n)}function pw(i,t,n,o,u,f){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&_w(m,y)){let x=s0(m,y);return m=za(m,m.next),x=za(x,x.next),Zu(m,t,n,o,u,f,0),void Zu(x,t,n,o,u,f,0)}y=y.next}m=m.next}while(m!==i)}function fw(i,t){return i.x-t.x}function mw(i,t){const n=function(u,f){let m=f;const y=u.x,x=u.y;let P,k=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const Z=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(Z<=y&&Z>k&&(k=Z,P=m.x<m.next.x?m:m.next,Z===y))return P}m=m.next}while(m!==f);if(!P)return null;const E=P,D=P.x,F=P.y;let q=1/0;m=P;do{if(y>=m.x&&m.x>=D&&y!==m.x&&Ol(x<F?y:k,x,D,F,x<F?k:y,x,m.x,m.y)){const Z=Math.abs(x-m.y)/(y-m.x);Gu(m,u)&&(Z<q||Z===q&&(m.x>P.x||m.x===P.x&&gw(P,m)))&&(P=m,q=Z)}m=m.next}while(m!==E);return P}(i,t);if(!n)return t;const o=s0(n,i);return za(o,o.next),za(n,n.next)}function gw(i,t){return tn(i.prev,i,t.prev)<0&&tn(t.next,i,i.next)<0}function $y(i,t,n,o,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*u|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function yw(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Ol(i,t,n,o,u,f,m,y){return(u-m)*(t-y)>=(i-m)*(f-y)&&(i-m)*(o-y)>=(n-m)*(t-y)&&(n-m)*(f-y)>=(u-m)*(o-y)}function _w(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&r0(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(i,t)&&(Gu(i,t)&&Gu(t,i)&&function(n,o){let u=n,f=!1;const m=(n.x+o.x)/2,y=(n.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==n);return f}(i,t)&&(tn(i.prev,i,t.prev)||tn(i,t.prev,t))||Of(i,t)&&tn(i.prev,i,i.next)>0&&tn(t.prev,t,t.next)>0)}function tn(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function Of(i,t){return i.x===t.x&&i.y===t.y}function r0(i,t,n,o){const u=Bf(tn(i,t,n)),f=Bf(tn(i,t,o)),m=Bf(tn(n,o,i)),y=Bf(tn(n,o,t));return u!==f&&m!==y||!(u!==0||!Ff(i,n,t))||!(f!==0||!Ff(i,o,t))||!(m!==0||!Ff(n,i,o))||!(y!==0||!Ff(n,t,o))}function Ff(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function Bf(i){return i>0?1:i<0?-1:0}function Gu(i,t){return tn(i.prev,i,i.next)<0?tn(i,t,i.next)>=0&&tn(i,i.prev,t)>=0:tn(i,t,i.prev)<0||tn(i,i.next,t)<0}function s0(i,t){const n=Jy(i.i,i.x,i.y),o=Jy(t.i,t.x,t.y),u=i.next,f=t.prev;return i.next=t,t.prev=i,n.next=u,u.prev=n,o.next=n,n.prev=o,f.next=o,o.prev=f,o}function o0(i,t,n,o){const u=Jy(i,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Wu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Jy(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Yy(i,t,n){const o=n.patternDependencies;let u=!1;for(const f of t){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Qy(i,t,n,o,u){const f=u.patternDependencies;for(const m of t){const y=m.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o-1},n,{},u.availableImages),P=y.evaluate({zoom:o},n,{},u.availableImages),k=y.evaluate({zoom:o+1},n,{},u.availableImages);x=x&&x.name?x.name:x,P=P&&P.name?P.name:P,k=k&&k.name?k.name:k,f[x]=!0,f[P]=!0,f[k]=!0,n.patterns[m.id]={min:x,mid:P,max:k}}}return n}class e_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kr,this.indexArray=new Dr,this.indexArray2=new wn,this.programConfigurations=new Aa(t.layers,t.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Yy("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),m=[];for(const{feature:y,id:x,index:P,sourceLayerIndex:k}of t){const E=this.layers[0]._featureFilter.needGeometry,D=Ma(y,E);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o,n.availableImages):void 0,q={id:x,properties:y.properties,type:y.type,sourceLayerIndex:k,index:P,geometry:E?D.geometry:Ea(y),patterns:{},sortKey:F};m.push(q)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:P,sourceLayerIndex:k}=y;if(this.hasPattern){const E=Qy("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(y,x,P,o,{});n.featureIndex.insert(t[P].feature,x,P,k,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,cw),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,f){for(const m of ol(n,500)){let y=0;for(const F of m)y+=F.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),P=x.vertexLength,k=[],E=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&E.push(k.length/2);const q=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),Z=q.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(Z+F.length-1,Z),k.push(F[0].x),k.push(F[0].y);for(let J=1;J<F.length;J++)this.layoutVertexArray.emplaceBack(F[J].x,F[J].y),this.indexArray2.emplaceBack(Z+J-1,Z+J),k.push(F[J].x),k.push(F[J].y);q.vertexLength+=F.length,q.primitiveLength+=F.length}const D=i0(k,E);for(let F=0;F<D.length;F+=3)this.indexArray.emplaceBack(P+D[F],P+D[F+1],P+D[F+2]);x.vertexLength+=y,x.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}let a0,l0;_t("FillBucket",e_,{omit:["layers","patternFeatures"]});var vw={get paint(){return l0=l0||new p({"fill-antialias":new bt(be.paint_fill["fill-antialias"]),"fill-opacity":new Rt(be.paint_fill["fill-opacity"]),"fill-color":new Rt(be.paint_fill["fill-color"]),"fill-outline-color":new Rt(be.paint_fill["fill-outline-color"]),"fill-translate":new bt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Il(be.paint_fill["fill-pattern"])})},get layout(){return a0=a0||new p({"fill-sort-key":new Rt(be.layout_fill["fill-sort-key"])})}};class xw extends r{constructor(t){super(t,vw)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new e_(t)}queryRadius(){return Df(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y){return Zv(Lf(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),u)}isTileClipped(){return!0}}const bw=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ww=_([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Sw}=bw;var zo={},Tw=U,c0=Fl;function Fl(i,t,n,o,u){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=u,i.readFields(Pw,this,t)}function Pw(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,u){for(var f=o.readVarint()+o.pos;o.pos<f;){var m=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[m]=y}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function Iw(i){for(var t,n,o=0,u=0,f=i.length,m=f-1;u<f;m=u++)o+=((n=i[m]).x-(t=i[u]).x)*(t.y+n.y);return o}Fl.types=["Unknown","Point","LineString","Polygon"],Fl.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,u=0,f=0,m=0,y=[];i.pos<n;){if(u<=0){var x=i.readVarint();o=7&x,u=x>>3}if(u--,o===1||o===2)f+=i.readSVarint(),m+=i.readSVarint(),o===1&&(t&&y.push(t),t=[]),t.push(new Tw(f,m));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&y.push(t),y},Fl.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,u=0,f=0,m=1/0,y=-1/0,x=1/0,P=-1/0;i.pos<t;){if(o<=0){var k=i.readVarint();n=7&k,o=k>>3}if(o--,n===1||n===2)(u+=i.readSVarint())<m&&(m=u),u>y&&(y=u),(f+=i.readSVarint())<x&&(x=f),f>P&&(P=f);else if(n!==7)throw new Error("unknown command "+n)}return[m,x,y,P]},Fl.prototype.toGeoJSON=function(i,t,n){var o,u,f=this.extent*Math.pow(2,n),m=this.extent*i,y=this.extent*t,x=this.loadGeometry(),P=Fl.types[this.type];function k(F){for(var q=0;q<F.length;q++){var Z=F[q];F[q]=[360*(Z.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(o=0;o<x.length;o++)E[o]=x[o][0];k(x=E);break;case 2:for(o=0;o<x.length;o++)k(x[o]);break;case 3:for(x=function(F){var q=F.length;if(q<=1)return[F];for(var Z,J,se=[],we=0;we<q;we++){var he=Iw(F[we]);he!==0&&(J===void 0&&(J=he<0),J===he<0?(Z&&se.push(Z),Z=[F[we]]):Z.push(F[we]))}return Z&&se.push(Z),se}(x),o=0;o<x.length;o++)for(u=0;u<x[o].length;u++)k(x[o][u])}x.length===1?x=x[0]:P="Multi"+P;var D={type:"Feature",geometry:{type:P,coordinates:x},properties:this.properties};return"id"in this&&(D.id=this.id),D};var Cw=c0,u0=h0;function h0(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(kw,this,t),this.length=this._features.length}function kw(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var u=null,f=o.readVarint()+o.pos;o.pos<f;){var m=o.readVarint()>>3;u=m===1?o.readString():m===2?o.readFloat():m===3?o.readDouble():m===4?o.readVarint64():m===5?o.readVarint():m===6?o.readSVarint():m===7?o.readBoolean():null}return u}(n))}h0.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Cw(this._pbf,t,this.extent,this._keys,this._values)};var Aw=u0;function Ew(i,t,n){if(i===3){var o=new Aw(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}zo.VectorTile=function(i,t){this.layers=i.readFields(Ew,{},t)},zo.VectorTileFeature=c0,zo.VectorTileLayer=u0;const Mw=zo.VectorTileFeature.types,t_=Math.pow(2,13);function Hu(i,t,n,o,u,f,m,y){i.emplaceBack(t,n,2*Math.floor(o*t_)+m,u*t_*2,f*t_*2,Math.round(y))}class i_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Io,this.centroidVertexArray=new En,this.indexArray=new Dr,this.programConfigurations=new Aa(t.layers,t.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=Yy("fill-extrusion",this.layers,n);for(const{feature:u,id:f,index:m,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,P=Ma(u,x);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),P,o))continue;const k={id:f,sourceLayerIndex:y,index:m,geometry:x?P.geometry:Ea(u),properties:u.properties,type:u.type,patterns:{}};this.hasPattern?this.features.push(Qy("fill-extrusion",this.layers,k,this.zoom,n)):this.addFeature(k,k.geometry,m,o,{}),n.featureIndex.insert(u,k.geometry,m,y,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sw),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ww.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,f){for(const m of ol(n,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const q of m)x+=q.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const q of m){if(q.length===0||Dw(q))continue;let Z=0;for(let J=0;J<q.length;J++){const se=q[J];if(J>=1){const we=q[J-1];if(!zw(se,we)){P.vertexLength+4>ai.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const he=se.sub(we)._perp()._unit(),_e=we.dist(se);Z+_e>32768&&(Z=0),Hu(this.layoutVertexArray,se.x,se.y,he.x,he.y,0,0,Z),Hu(this.layoutVertexArray,se.x,se.y,he.x,he.y,0,1,Z),y.x+=2*se.x,y.y+=2*se.y,y.vertexCount+=2,Z+=_e,Hu(this.layoutVertexArray,we.x,we.y,he.x,he.y,0,0,Z),Hu(this.layoutVertexArray,we.x,we.y,he.x,he.y,0,1,Z),y.x+=2*we.x,y.y+=2*we.y,y.vertexCount+=2;const Ae=P.vertexLength;this.indexArray.emplaceBack(Ae,Ae+2,Ae+1),this.indexArray.emplaceBack(Ae+1,Ae+2,Ae+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+x>ai.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Mw[t.type]!=="Polygon")continue;const k=[],E=[],D=P.vertexLength;for(const q of m)if(q.length!==0){q!==m[0]&&E.push(k.length/2);for(let Z=0;Z<q.length;Z++){const J=q[Z];Hu(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),y.x+=J.x,y.y+=J.y,y.vertexCount+=1,k.push(J.x),k.push(J.y)}}const F=i0(k,E);for(let q=0;q<F.length;q+=3)this.indexArray.emplaceBack(D+F[q],D+F[q+2],D+F[q+1]);P.primitiveLength+=F.length/3,P.vertexLength+=x;for(let q=0;q<y.vertexCount;q++){const Z=Math.floor(y.x/y.vertexCount),J=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(Z,J)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}}function zw(i,t){return i.x===t.x&&(i.x<0||i.x>ln)||i.y===t.y&&(i.y<0||i.y>ln)}function Dw(i){return i.every(t=>t.x<0)||i.every(t=>t.x>ln)||i.every(t=>t.y<0)||i.every(t=>t.y>ln)}let d0;_t("FillExtrusionBucket",i_,{omit:["layers","features"]});var Lw={get paint(){return d0=d0||new p({"fill-extrusion-opacity":new bt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Rt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Il(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Rt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Rt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Rw extends r{constructor(t){super(t,Lw)}createBucket(t){return new i_(t)}queryRadius(){return Df(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,u,f,m,y,x){const P=Lf(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),k=this.paint.get("fill-extrusion-height").evaluate(n,o),E=this.paint.get("fill-extrusion-base").evaluate(n,o),D=function(q,Z,J,se){const we=[];for(const he of q){const _e=[he.x,he.y,0,1];Rf(_e,_e,Z),we.push(new B(_e[0]/_e[3],_e[1]/_e[3]))}return we}(P,x),F=function(q,Z,J,se){const we=[],he=[],_e=se[8]*Z,Ae=se[9]*Z,Ze=se[10]*Z,ft=se[11]*Z,Lt=se[8]*J,ht=se[9]*J,ot=se[10]*J,Tt=se[11]*J;for(const vt of q){const yt=[],Re=[];for(const kt of vt){const St=kt.x,Ut=kt.y,Ii=se[0]*St+se[4]*Ut+se[12],Si=se[1]*St+se[5]*Ut+se[13],fn=se[2]*St+se[6]*Ut+se[14],$r=se[3]*St+se[7]*Ut+se[15],Dn=fn+Ze,mn=$r+ft,Qn=Ii+Lt,er=Si+ht,tr=fn+ot,Yi=$r+Tt,gn=new B((Ii+_e)/mn,(Si+Ae)/mn);gn.z=Dn/mn,yt.push(gn);const jn=new B(Qn/Yi,er/Yi);jn.z=tr/Yi,Re.push(jn)}we.push(yt),he.push(Re)}return[we,he]}(u,E,k,x);return function(q,Z,J){let se=1/0;Zv(J,Z)&&(se=p0(J,Z[0]));for(let we=0;we<Z.length;we++){const he=Z[we],_e=q[we];for(let Ae=0;Ae<he.length-1;Ae++){const Ze=he[Ae],ft=[Ze,he[Ae+1],_e[Ae+1],_e[Ae],Ze];qv(J,ft)&&(se=Math.min(se,p0(J,ft)))}}return se!==1/0&&se}(F[0],F[1],D)}}function Xu(i,t){return i.x*t.x+i.y*t.y}function p0(i,t){if(i.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const f=t[n],m=i[0],y=u.sub(o),x=f.sub(o),P=m.sub(o),k=Xu(y,y),E=Xu(y,x),D=Xu(x,x),F=Xu(P,y),q=Xu(P,x),Z=k*D-E*E,J=(D*F-E*q)/Z,se=(k*q-E*F)/Z,we=o.z*(1-J-se)+u.z*J+f.z*se;if(isFinite(we))return we}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Ow=_([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Fw}=Ow,Bw=_([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Nw}=Bw,Vw=zo.VectorTileFeature.types,jw=Math.cos(Math.PI/180*37.5),f0=Math.pow(2,14)/.5;class n_{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new kl,this.layoutVertexArray2=new Co,this.indexArray=new Dr,this.programConfigurations=new Aa(t.layers,t.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=Yy("line",this.layers,n);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),m=[];for(const{feature:y,id:x,index:P,sourceLayerIndex:k}of t){const E=this.layers[0]._featureFilter.needGeometry,D=Ma(y,E);if(!this.layers[0]._featureFilter.filter(new Ei(this.zoom),D,o))continue;const F=f?u.evaluate(D,{},o):void 0,q={id:x,properties:y.properties,type:y.type,sourceLayerIndex:k,index:P,geometry:E?D.geometry:Ea(y),patterns:{},sortKey:F};m.push(q)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:P,sourceLayerIndex:k}=y;if(this.hasPattern){const E=Qy("line",this.layers,y,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(y,x,P,o,{});n.featureIndex.insert(t[P].feature,x,P,k,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Nw)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fw),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,f){const m=this.layers[0].layout,y=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),P=m.get("line-miter-limit"),k=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const E of n)this.addLine(E,t,y,x,P,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,f,u)}addLine(t,n,o,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<t.length-1;se++)this.totalDistance+=t[se].dist(t[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Vw[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let P=0;for(;P<x-1&&t[P].equals(t[P+1]);)P++;if(x<(y?3:2))return;o==="bevel"&&(f=1.05);const k=this.overscaling<=16?15*ln/(512*this.overscaling):0,E=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let D,F,q,Z,J;this.e1=this.e2=-1,y&&(D=t[x-2],J=t[P].sub(D)._unit()._perp());for(let se=P;se<x;se++){if(q=se===x-1?y?t[P+1]:void 0:t[se+1],q&&t[se].equals(q))continue;J&&(Z=J),D&&(F=D),D=t[se],J=q?q.sub(D)._unit()._perp():Z,Z=Z||J;let we=Z.add(J);we.x===0&&we.y===0||we._unit();const he=Z.x*J.x+Z.y*J.y,_e=we.x*J.x+we.y*J.y,Ae=_e!==0?1/_e:1/0,Ze=2*Math.sqrt(2-2*_e),ft=_e<jw&&F&&q,Lt=Z.x*J.y-Z.y*J.x>0;if(ft&&se>P){const Tt=D.dist(F);if(Tt>2*k){const vt=D.sub(D.sub(F)._mult(k/Tt)._round());this.updateDistance(F,vt),this.addCurrentVertex(vt,Z,0,0,E),F=vt}}const ht=F&&q;let ot=ht?o:y?"butt":u;if(ht&&ot==="round"&&(Ae<m?ot="miter":Ae<=2&&(ot="fakeround")),ot==="miter"&&Ae>f&&(ot="bevel"),ot==="bevel"&&(Ae>2&&(ot="flipbevel"),Ae<f&&(ot="miter")),F&&this.updateDistance(F,D),ot==="miter")we._mult(Ae),this.addCurrentVertex(D,we,0,0,E);else if(ot==="flipbevel"){if(Ae>100)we=J.mult(-1);else{const Tt=Ae*Z.add(J).mag()/Z.sub(J).mag();we._perp()._mult(Tt*(Lt?-1:1))}this.addCurrentVertex(D,we,0,0,E),this.addCurrentVertex(D,we.mult(-1),0,0,E)}else if(ot==="bevel"||ot==="fakeround"){const Tt=-Math.sqrt(Ae*Ae-1),vt=Lt?Tt:0,yt=Lt?0:Tt;if(F&&this.addCurrentVertex(D,Z,vt,yt,E),ot==="fakeround"){const Re=Math.round(180*Ze/Math.PI/20);for(let kt=1;kt<Re;kt++){let St=kt/Re;if(St!==.5){const Ii=St-.5;St+=St*Ii*(St-1)*((1.0904+he*(he*(3.55645-1.43519*he)-3.2452))*Ii*Ii+(.848013+he*(.215638*he-1.06021)))}const Ut=J.sub(Z)._mult(St)._add(Z)._unit()._mult(Lt?-1:1);this.addHalfVertex(D,Ut.x,Ut.y,!1,Lt,0,E)}}q&&this.addCurrentVertex(D,J,-vt,-yt,E)}else if(ot==="butt")this.addCurrentVertex(D,we,0,0,E);else if(ot==="square"){const Tt=F?1:-1;this.addCurrentVertex(D,we,Tt,Tt,E)}else ot==="round"&&(F&&(this.addCurrentVertex(D,Z,0,0,E),this.addCurrentVertex(D,Z,1,1,E,!0)),q&&(this.addCurrentVertex(D,J,-1,-1,E,!0),this.addCurrentVertex(D,J,0,0,E)));if(ft&&se<x-1){const Tt=D.dist(q);if(Tt>2*k){const vt=D.add(q.sub(D)._mult(k/Tt)._round());this.updateDistance(D,vt),this.addCurrentVertex(vt,J,0,0,E),D=vt}}}}addCurrentVertex(t,n,o,u,f,m=!1){const y=n.y*u-n.x,x=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,m,!1,o,f),this.addHalfVertex(t,y,x,m,!0,-u,f),this.distance>f0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,f,m))}addHalfVertex({x:t,y:n},o,u,f,m,y,x){const P=.5*(this.lineClips?this.scaledDistance*(f0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(n<<1)+(m?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const k=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),x.primitiveLength++),m?this.e2=k:this.e1=k}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let m0,g0;_t("LineBucket",n_,{omit:["layers","patternFeatures"]});var y0={get paint(){return g0=g0||new p({"line-opacity":new Rt(be.paint_line["line-opacity"]),"line-color":new Rt(be.paint_line["line-color"]),"line-translate":new bt(be.paint_line["line-translate"]),"line-translate-anchor":new bt(be.paint_line["line-translate-anchor"]),"line-width":new Rt(be.paint_line["line-width"]),"line-gap-width":new Rt(be.paint_line["line-gap-width"]),"line-offset":new Rt(be.paint_line["line-offset"]),"line-blur":new Rt(be.paint_line["line-blur"]),"line-dasharray":new Cl(be.paint_line["line-dasharray"]),"line-pattern":new Il(be.paint_line["line-pattern"]),"line-gradient":new Bu(be.paint_line["line-gradient"])})},get layout(){return m0=m0||new p({"line-cap":new bt(be.layout_line["line-cap"]),"line-join":new Rt(be.layout_line["line-join"]),"line-miter-limit":new bt(be.layout_line["line-miter-limit"]),"line-round-limit":new bt(be.layout_line["line-round-limit"]),"line-sort-key":new Rt(be.layout_line["line-sort-key"])})}};class Uw extends Rt{possiblyEvaluate(t,n){return n=new Ei(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=$e({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Nf;class qw extends r{constructor(t){super(t,y0),this.gradientVersion=0,Nf||(Nf=new Uw(y0.paint.properties["line-width"].specification),Nf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof oo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Nf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new n_(t)}queryRadius(t){const n=t,o=_0(ju("line-width",this,n),ju("line-gap-width",this,n)),u=ju("line-offset",this,n);return o/2+Math.abs(u)+Df(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,u,f,m,y){const x=Lf(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),P=y/2*_0(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),k=this.paint.get("line-offset").evaluate(n,o);return k&&(u=function(E,D){const F=[];for(let q=0;q<E.length;q++){const Z=E[q],J=[];for(let se=0;se<Z.length;se++){const we=Z[se-1],he=Z[se],_e=Z[se+1],Ae=se===0?new B(0,0):he.sub(we)._unit()._perp(),Ze=se===Z.length-1?new B(0,0):_e.sub(he)._unit()._perp(),ft=Ae._add(Ze)._unit(),Lt=ft.x*Ze.x+ft.y*Ze.y;Lt!==0&&ft._mult(1/Lt),J.push(ft._mult(D)._add(he))}F.push(J)}return F}(u,k*y)),function(E,D,F){for(let q=0;q<D.length;q++){const Z=D[q];if(E.length>=3){for(let J=0;J<Z.length;J++)if(Ll(E,Z[J]))return!0}if(Y1(E,Z,F))return!0}return!1}(x,u,P)}isTileClipped(){return!0}}function _0(i,t){return t>0?t+2*i:i}const Zw=_([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gw=_([{name:"a_projected_pos",components:3,type:"Float32"}],4);_([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ww=_([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);_([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const v0=_([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hw=_([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xw(i,t,n){return i.sections.forEach(o=>{o.text=function(u,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),hr.applyArabicShaping&&(u=hr.applyArabicShaping(u)),u}(o.text,t,n)}),i}_([{name:"triangle",components:3,type:"Uint16"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),_([{type:"Float32",name:"offsetX"}]),_([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),_([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Ku={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var un=24,x0=wi,b0=function(i,t,n,o,u){var f,m,y=8*u-o-1,x=(1<<y)-1,P=x>>1,k=-7,E=u-1,D=-1,F=i[t+E];for(E+=D,f=F&(1<<-k)-1,F>>=-k,k+=y;k>0;f=256*f+i[t+E],E+=D,k-=8);for(m=f&(1<<-k)-1,f>>=-k,k+=o;k>0;m=256*m+i[t+E],E+=D,k-=8);if(f===0)f=1-P;else{if(f===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,o),f-=P}return(F?-1:1)*m*Math.pow(2,f-o)},w0=function(i,t,n,o,u,f){var m,y,x,P=8*f-u-1,k=(1<<P)-1,E=k>>1,D=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,q=1,Z=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=k):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+E>=1?D/x:D*Math.pow(2,1-E))*x>=2&&(m++,x/=2),m+E>=k?(y=0,m=k):m+E>=1?(y=(t*x-1)*Math.pow(2,u),m+=E):(y=t*Math.pow(2,E-1)*Math.pow(2,u),m=0));u>=8;i[n+F]=255&y,F+=q,y/=256,u-=8);for(m=m<<u|y,P+=u;P>0;i[n+F]=255&m,F+=q,m/=256,P-=8);i[n+F-q]|=128*Z};function wi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}wi.Varint=0,wi.Fixed64=1,wi.Bytes=2,wi.Fixed32=5;var r_=4294967296,S0=1/r_,T0=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function Gs(i){return i.type===wi.Bytes?i.readVarint()+i.pos:i.pos+1}function Bl(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function P0(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var u=n.pos-1;u>=i;u--)n.buf[u+o]=n.buf[u]}function Kw(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function $w(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function Jw(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function Yw(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function Qw(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function e2(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function t2(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function i2(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function n2(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function Vf(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Nl(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function I0(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}wi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),u=o>>3,f=this.pos;this.type=7&o,i(u,t,this),this.pos===f&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Vf(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=I0(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Vf(this.buf,this.pos)+Vf(this.buf,this.pos+4)*r_;return this.pos+=8,i},readSFixed64:function(){var i=Vf(this.buf,this.pos)+I0(this.buf,this.pos+4)*r_;return this.pos+=8,i},readFloat:function(){var i=b0(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=b0(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(u,f,m){var y,x,P=m.buf;if(y=(112&(x=P[m.pos++]))>>4,x<128||(y|=(127&(x=P[m.pos++]))<<3,x<128)||(y|=(127&(x=P[m.pos++]))<<10,x<128)||(y|=(127&(x=P[m.pos++]))<<17,x<128)||(y|=(127&(x=P[m.pos++]))<<24,x<128)||(y|=(1&(x=P[m.pos++]))<<31,x<128))return Bl(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&T0?function(n,o,u){return T0.decode(n.subarray(o,u))}(this.buf,t,i):function(n,o,u){for(var f="",m=o;m<u;){var y,x,P,k=n[m],E=null,D=k>239?4:k>223?3:k>191?2:1;if(m+D>u)break;D===1?k<128&&(E=k):D===2?(192&(y=n[m+1]))==128&&(E=(31&k)<<6|63&y)<=127&&(E=null):D===3?(x=n[m+2],(192&(y=n[m+1]))==128&&(192&x)==128&&((E=(15&k)<<12|(63&y)<<6|63&x)<=2047||E>=55296&&E<=57343)&&(E=null)):D===4&&(x=n[m+2],P=n[m+3],(192&(y=n[m+1]))==128&&(192&x)==128&&(192&P)==128&&((E=(15&k)<<18|(63&y)<<12|(63&x)<<6|63&P)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,D=1):E>65535&&(E-=65536,f+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),f+=String.fromCharCode(E),m+=D}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==wi.Bytes)return i.push(this.readVarint(t));var n=Gs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==wi.Bytes)return i.push(this.readSVarint());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==wi.Bytes)return i.push(this.readBoolean());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==wi.Bytes)return i.push(this.readFloat());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==wi.Bytes)return i.push(this.readDouble());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed32());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed32());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readFixed64());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==wi.Bytes)return i.push(this.readSFixed64());var t=Gs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===wi.Varint)for(;this.buf[this.pos++]>127;);else if(t===wi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===wi.Fixed32)this.pos+=4;else{if(t!==wi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Nl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Nl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Nl(this.buf,-1&i,this.pos),Nl(this.buf,Math.floor(i*S0),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Nl(this.buf,-1&i,this.pos),Nl(this.buf,Math.floor(i*S0),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,u;if(t>=0?(o=t%4294967296|0,u=t/4294967296|0):(u=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,u=u+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(o,0,n),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,u,f){for(var m,y,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===u.length?(o[f++]=239,o[f++]=191,o[f++]=189):y=m;continue}if(m<56320){o[f++]=239,o[f++]=191,o[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(o[f++]=239,o[f++]=191,o[f++]=189,y=null);m<128?o[f++]=m:(m<2048?o[f++]=m>>6|192:(m<65536?o[f++]=m>>12|224:(o[f++]=m>>18|240,o[f++]=m>>12&63|128),o[f++]=m>>6&63|128),o[f++]=63&m|128)}return f}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&P0(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),w0(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),w0(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&P0(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,wi.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Kw,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,$w,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Qw,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,Jw,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Yw,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,e2,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,t2,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,i2,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,n2,t)},writeBytesField:function(i,t){this.writeTag(i,wi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,wi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,wi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,wi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,wi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,wi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,wi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,wi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,wi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,wi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var s_=j(x0);const o_=3;function r2(i,t,n){i===1&&n.readMessage(s2,t)}function s2(i,t,n){if(i===3){const{id:o,bitmap:u,width:f,height:m,left:y,top:x,advance:P}=n.readMessage(o2,{});t.push({id:o,bitmap:new qu({width:f+2*o_,height:m+2*o_},u),metrics:{width:f,height:m,left:y,top:x,advance:P}})}}function o2(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const C0=o_;function k0(i){let t=0,n=0;for(const m of i)t+=m.w*m.h,n=Math.max(n,m.w);i.sort((m,y)=>y.h-m.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,f=0;for(const m of i)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const P=o.pop();y<o.length&&(o[y]=P)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(o.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:f,fill:t/(u*f)||0}}const pr=1;class a_{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:f,content:m,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=m,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+pr,this.paddedRect.y+pr]}get br(){return[this.paddedRect.x+this.paddedRect.w-pr,this.paddedRect.y+this.paddedRect.h-pr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*pr)/this.pixelRatio,(this.paddedRect.h-2*pr)/this.pixelRatio]}}class A0{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,o,f),this.addImages(n,u,f);const{w:m,h:y}=k0(f),x=new Lr({width:m||1,height:y||1});for(const P in t){const k=t[P],E=o[P].paddedRect;Lr.copy(k.data,x,{x:0,y:0},{x:E.x+pr,y:E.y+pr},k.data)}for(const P in n){const k=n[P],E=u[P].paddedRect,D=E.x+pr,F=E.y+pr,q=k.data.width,Z=k.data.height;Lr.copy(k.data,x,{x:0,y:0},{x:D,y:F},k.data),Lr.copy(k.data,x,{x:0,y:Z-1},{x:D,y:F-1},{width:q,height:1}),Lr.copy(k.data,x,{x:0,y:0},{x:D,y:F+Z},{width:q,height:1}),Lr.copy(k.data,x,{x:q-1,y:0},{x:D-1,y:F},{width:1,height:Z}),Lr.copy(k.data,x,{x:0,y:0},{x:D+q,y:F},{width:1,height:Z})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const f=t[u],m={x:0,y:0,w:f.data.width+2*pr,h:f.data.height+2*pr};o.push(m),n[u]=new a_(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,f]=t.tl;o.update(n.data,void 0,{x:u,y:f})}}var Do;_t("ImagePosition",a_),_t("ImageAtlas",A0),b.ah=void 0,(Do=b.ah||(b.ah={}))[Do.none=0]="none",Do[Do.horizontal=1]="horizontal",Do[Do.vertical=2]="vertical",Do[Do.horizontalOnly=3]="horizontalOnly";const $u=-17;class Ju{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new Ju;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new Ju;return n.imageName=t,n}}class Vl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Vl;for(let u=0;u<t.sections.length;u++){const f=t.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,f=t.charCodeAt(o-1)||null;n+=u&&If(u)&&!Ku[t[o+1]]||f&&If(f)&&!Ku[t[o-1]]||!Ku[t[o]]?t[o]:Ku[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Uf[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Uf[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Vl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(Ju.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void De("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Ju.forImage(n)),this.sectionIndex.push(this.sections.length-1)):De("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jf(i,t,n,o,u,f,m,y,x,P,k,E,D,F,q){const Z=Vl.fromFeature(i,u);let J;E===b.ah.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:se,processStyledBidirectionalText:we}=hr;if(se&&Z.sections.length===1){J=[];const Ae=se(Z.toString(),l_(Z,P,f,t,o,F));for(const Ze of Ae){const ft=new Vl;ft.text=Ze,ft.sections=Z.sections;for(let Lt=0;Lt<Ze.length;Lt++)ft.sectionIndex.push(0);J.push(ft)}}else if(we){J=[];const Ae=we(Z.text,Z.sectionIndex,l_(Z,P,f,t,o,F));for(const Ze of Ae){const ft=new Vl;ft.text=Ze[0],ft.sectionIndex=Ze[1],ft.sections=Z.sections,J.push(ft)}}else J=function(Ae,Ze){const ft=[],Lt=Ae.text;let ht=0;for(const ot of Ze)ft.push(Ae.substring(ht,ot)),ht=ot;return ht<Lt.length&&ft.push(Ae.substring(ht,Lt.length)),ft}(Z,l_(Z,P,f,t,o,F));const he=[],_e={positionedLines:he,text:Z.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:E,iconsInText:!1,verticalizable:!1};return function(Ae,Ze,ft,Lt,ht,ot,Tt,vt,yt,Re,kt,St){let Ut=0,Ii=$u,Si=0,fn=0;const $r=vt==="right"?1:vt==="left"?0:.5;let Dn=0;for(const Yi of ht){Yi.trim();const gn=Yi.getMaxScale(),jn=(gn-1)*un,Ln={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[Dn]=Ln;const ir=Ln.positionedGlyphs;let Rn=0;if(!Yi.length()){Ii+=ot,++Dn;continue}for(let fr=0;fr<Yi.length();fr++){const pi=Yi.getSection(fr),ki=Yi.getSectionIndex(fr),Li=Yi.getCharCode(fr);let Sr=0,Gi=null,Zl=null,ys=null,_s=un;const Jr=!(yt===b.ah.horizontal||!kt&&!Ou(Li)||kt&&(Uf[Li]||(mn=Li,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(mn)))));if(pi.imageName){const Fr=Lt[pi.imageName];if(!Fr)continue;ys=pi.imageName,Ae.iconsInText=Ae.iconsInText||!0,Zl=Fr.paddedRect;const Sn=Fr.displaySize;pi.scale=pi.scale*un/St,Gi={width:Sn[0],height:Sn[1],left:pr,top:-C0,advance:Jr?Sn[1]:Sn[0]},Sr=jn+(un-Sn[1]*pi.scale),_s=Gi.advance;const Ws=Jr?Sn[0]*pi.scale-un*gn:Sn[1]*pi.scale-un*gn;Ws>0&&Ws>Rn&&(Rn=Ws)}else{const Fr=ft[pi.fontStack],Sn=Fr&&Fr[Li];if(Sn&&Sn.rect)Zl=Sn.rect,Gi=Sn.metrics;else{const Ws=Ze[pi.fontStack],nh=Ws&&Ws[Li];if(!nh)continue;Gi=nh.metrics}Sr=(gn-pi.scale)*un}Jr?(Ae.verticalizable=!0,ir.push({glyph:Li,imageName:ys,x:Ut,y:Ii+Sr,vertical:Jr,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:ki,metrics:Gi,rect:Zl}),Ut+=_s*pi.scale+Re):(ir.push({glyph:Li,imageName:ys,x:Ut,y:Ii+Sr,vertical:Jr,scale:pi.scale,fontStack:pi.fontStack,sectionIndex:ki,metrics:Gi,rect:Zl}),Ut+=Gi.advance*pi.scale+Re)}ir.length!==0&&(Si=Math.max(Ut-Re,Si),u2(ir,0,ir.length-1,$r,Rn)),Ut=0;const Or=ot*gn+Rn;Ln.lineOffset=Math.max(Rn,jn),Ii+=Or,fn=Math.max(Or,fn),++Dn}var mn;const Qn=Ii-$u,{horizontalAlign:er,verticalAlign:tr}=c_(Tt);(function(Yi,gn,jn,Ln,ir,Rn,Or,fr,pi){const ki=(gn-jn)*ir;let Li=0;Li=Rn!==Or?-fr*Ln-$u:(-Ln*pi+.5)*Or;for(const Sr of Yi)for(const Gi of Sr.positionedGlyphs)Gi.x+=ki,Gi.y+=Li})(Ae.positionedLines,$r,er,tr,Si,fn,ot,Qn,ht.length),Ae.top+=-tr*Qn,Ae.bottom=Ae.top+Qn,Ae.left+=-er*Si,Ae.right=Ae.left+Si}(_e,t,n,o,J,m,y,x,E,P,D,q),!function(Ae){for(const Ze of Ae)if(Ze.positionedGlyphs.length!==0)return!1;return!0}(he)&&_e}const Uf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a2={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},l2={40:!0};function E0(i,t,n,o,u,f){if(t.imageName){const m=o[t.imageName];return m?m.displaySize[0]*t.scale*un/f+u:0}{const m=n[t.fontStack],y=m&&m[i];return y?y.metrics.advance*t.scale+u:0}}function M0(i,t,n,o){const u=Math.pow(i-t,2);return o?i<t?u/2:2*u:u+Math.abs(n)*n}function c2(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function z0(i,t,n,o,u,f){let m=null,y=M0(t,n,u,f);for(const x of o){const P=M0(t-x.x,n,u,f)+x.badness;P<=y&&(m=x,y=P)}return{index:i,x:t,priorBreak:m,badness:y}}function D0(i){return i?D0(i.priorBreak).concat(i.index):[]}function l_(i,t,n,o,u,f){if(!i)return[];const m=[],y=function(E,D,F,q,Z,J){let se=0;for(let we=0;we<E.length();we++){const he=E.getSection(we);se+=E0(E.getCharCode(we),he,q,Z,D,J)}return se/Math.max(1,Math.ceil(se/F))}(i,t,n,o,u,f),x=i.text.indexOf("​")>=0;let P=0;for(let E=0;E<i.length();E++){const D=i.getSection(E),F=i.getCharCode(E);if(Uf[F]||(P+=E0(F,D,o,u,t,f)),E<i.length()-1){const q=!((k=F)<11904)&&(!!oi["CJK Compatibility Forms"](k)||!!oi["CJK Compatibility"](k)||!!oi["CJK Strokes"](k)||!!oi["CJK Symbols and Punctuation"](k)||!!oi["Enclosed CJK Letters and Months"](k)||!!oi["Halfwidth and Fullwidth Forms"](k)||!!oi["Ideographic Description Characters"](k)||!!oi["Vertical Forms"](k)||Pf.test(String.fromCodePoint(k)));(a2[F]||q||D.imageName||E!==i.length()-2&&l2[i.getCharCode(E+1)])&&m.push(z0(E+1,P,y,m,c2(F,i.getCharCode(E+1),q&&x),!1))}}var k;return D0(z0(i.length(),P,y,m,0,!0))}function c_(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function u2(i,t,n,o,u){if(!o&&!u)return;const f=i[n],m=(i[n].x+f.metrics.advance*f.scale)*o;for(let y=t;y<=n;y++)i[y].x-=m,i[y].y+=u}function h2(i,t,n){const{horizontalAlign:o,verticalAlign:u}=c_(n),f=t[0]-i.displaySize[0]*o,m=t[1]-i.displaySize[1]*u;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function L0(i){var t,n;let o=i.left,u=i.top,f=i.right-o,m=i.bottom-u;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/m<P||y==="proportional"){const k=Math.ceil(m*P);o*=k/f,f=k}}else if(y==="proportional"&&x==="stretchOnly"&&P!==0&&f/m>P){const k=Math.ceil(f/P);u*=k/m,m=k}return{x1:o,y1:u,x2:o+f,y2:u+m}}function R0(i,t,n,o,u,f){const m=i.image;let y;if(m.content){const J=m.content,se=m.pixelRatio||1;y=[J[0]/se,J[1]/se,m.displaySize[0]-J[2]/se,m.displaySize[1]-J[3]/se]}const x=t.left*f,P=t.right*f;let k,E,D,F;n==="width"||n==="both"?(F=u[0]+x-o[3],E=u[0]+P+o[1]):(F=u[0]+(x+P-m.displaySize[0])/2,E=F+m.displaySize[0]);const q=t.top*f,Z=t.bottom*f;return n==="height"||n==="both"?(k=u[1]+q-o[0],D=u[1]+Z+o[2]):(k=u[1]+(q+Z-m.displaySize[1])/2,D=k+m.displaySize[1]),{image:m,top:k,right:E,bottom:D,left:F,collisionPadding:y}}const Yu=255,gs=128,Lo=Yu*gs;function O0(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Ei(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let f=0;for(;f<o.length&&o[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<o.length&&o[m]<i+1;)m++;m=Math.min(o.length-1,m);const y=o[f],x=o[m];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:n.evaluate(new Ei(y)),maxSize:n.evaluate(new Ei(x)),interpolationType:u}}}function u_(i,t,n){let o="never";const u=i.get(t);return u?o=u:i.get(n)&&(o="always"),o}const d2=zo.VectorTileFeature.types,p2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qf(i,t,n,o,u,f,m,y,x,P,k,E,D){const F=y?Math.min(Lo,Math.round(y[0])):0,q=y?Math.min(Lo,Math.round(y[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),f,m,(F<<1)+(x?1:0),q,16*P,16*k,256*E,256*D)}function h_(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function f2(i){for(const t of i.sections)if(Ny(t.text))return!0;return!1}class d_{constructor(t){this.layoutVertexArray=new Al,this.indexArray=new Dr,this.programConfigurations=t,this.segments=new ai,this.dynamicLayoutVertexArray=new Nu,this.opacityVertexArray=new br,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mi}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zw.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Gw.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,p2,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}_t("SymbolBuffers",d_);class p_{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new ai,this.collisionVertexArray=new fs}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ww.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}_t("CollisionBuffers",p_);class jl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wy([]),this.placementViewportMatrix=Wy([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=O0(this.zoom,n["text-size"]),this.iconSizeData=O0(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=u_(o,"text-overlap","text-allow-overlap")!=="never"||u_(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(m=>b.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new d_(new Aa(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new d_(new Aa(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new zi,this.lineVertexArray=new An,this.symbolInstances=new ni,this.textAnchorOffsets=new Di}calculateGlyphDependencies(t,n,o,u,f){for(let m=0;m<t.length;m++)if(n[t.charCodeAt(m)]=!0,(o||u)&&f){const y=Ku[t.charAt(m)];y&&(n[y.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],f=u.layout,m=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),P=(y.value.kind!=="constant"||y.value.value instanceof ar&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),k=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,E=f.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const D=n.iconDependencies,F=n.glyphDependencies,q=n.availableImages,Z=new Ei(this.zoom);for(const{feature:J,id:se,index:we,sourceLayerIndex:he}of t){const _e=u._featureFilter.needGeometry,Ae=Ma(J,_e);if(!u._featureFilter.filter(Z,Ae,o))continue;let Ze,ft;if(_e||(Ae.geometry=Ea(J)),P){const ht=u.getValueAndResolveTokens("text-field",Ae,o,q),ot=ar.factory(ht),Tt=this.hasRTLText=this.hasRTLText||f2(ot);(!Tt||hr.getRTLTextPluginStatus()==="unavailable"||Tt&&hr.isParsed())&&(Ze=Xw(ot,u,Ae))}if(k){const ht=u.getValueAndResolveTokens("icon-image",Ae,o,q);ft=ht instanceof cr?ht:cr.fromString(ht)}if(!Ze&&!ft)continue;const Lt=this.sortFeaturesByKey?E.evaluate(Ae,{},o):void 0;if(this.features.push({id:se,text:Ze,icon:ft,index:we,sourceLayerIndex:he,geometry:Ae.geometry,properties:J.properties,type:d2[J.type],sortKey:Lt}),ft&&(D[ft.name]=!0),Ze){const ht=m.evaluate(Ae,{},o).join(","),ot=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(b.ah.vertical)>=0;for(const Tt of Ze.sections)if(Tt.image)D[Tt.image.name]=!0;else{const vt=Lu(Ze.toString()),yt=Tt.fontStack||ht,Re=F[yt]=F[yt]||{};this.calculateGlyphDependencies(Tt.text,Re,ot,this.allowVerticalPlacement,vt)}}}f.get("symbol-placement")==="line"&&(this.features=function(J){const se={},we={},he=[];let _e=0;function Ae(ht){he.push(J[ht]),_e++}function Ze(ht,ot,Tt){const vt=we[ht];return delete we[ht],we[ot]=vt,he[vt].geometry[0].pop(),he[vt].geometry[0]=he[vt].geometry[0].concat(Tt[0]),vt}function ft(ht,ot,Tt){const vt=se[ot];return delete se[ot],se[ht]=vt,he[vt].geometry[0].shift(),he[vt].geometry[0]=Tt[0].concat(he[vt].geometry[0]),vt}function Lt(ht,ot,Tt){const vt=Tt?ot[0][ot[0].length-1]:ot[0][0];return`${ht}:${vt.x}:${vt.y}`}for(let ht=0;ht<J.length;ht++){const ot=J[ht],Tt=ot.geometry,vt=ot.text?ot.text.toString():null;if(!vt){Ae(ht);continue}const yt=Lt(vt,Tt),Re=Lt(vt,Tt,!0);if(yt in we&&Re in se&&we[yt]!==se[Re]){const kt=ft(yt,Re,Tt),St=Ze(yt,Re,he[kt].geometry);delete se[yt],delete we[Re],we[Lt(vt,he[St].geometry,!0)]=St,he[kt].geometry=null}else yt in we?Ze(yt,Re,Tt):Re in se?ft(yt,Re,Tt):(Ae(ht),se[yt]=_e-1,we[Re]=_e-1)}return he.filter(ht=>ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,se)=>J.sortKey-se.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),f=t.dist(n[t.segment]);const m={};for(let y=t.segment+1;y<n.length;y++)m[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:u},y<n.length-1&&(u+=n[y+1].dist(n[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:n[y].x,y:n[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=n[y-1].dist(n[y]));for(let y=0;y<n.length;y++){const x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,f,m,y,x,P,k,E,D){const F=t.indexArray,q=t.layoutVertexArray,Z=t.segments.prepareSegment(4*n.length,q,F,this.canOverlap?m.sortKey:void 0),J=this.glyphOffsetArray.length,se=Z.vertexLength,we=this.allowVerticalPlacement&&y===b.ah.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let _e=0;_e<n.length;_e++){const{tl:Ae,tr:Ze,bl:ft,br:Lt,tex:ht,pixelOffsetTL:ot,pixelOffsetBR:Tt,minFontScaleX:vt,minFontScaleY:yt,glyphOffset:Re,isSDF:kt,sectionIndex:St}=n[_e],Ut=Z.vertexLength,Ii=Re[1];qf(q,x.x,x.y,Ae.x,Ii+Ae.y,ht.x,ht.y,o,kt,ot.x,ot.y,vt,yt),qf(q,x.x,x.y,Ze.x,Ii+Ze.y,ht.x+ht.w,ht.y,o,kt,Tt.x,ot.y,vt,yt),qf(q,x.x,x.y,ft.x,Ii+ft.y,ht.x,ht.y+ht.h,o,kt,ot.x,Tt.y,vt,yt),qf(q,x.x,x.y,Lt.x,Ii+Lt.y,ht.x+ht.w,ht.y+ht.h,o,kt,Tt.x,Tt.y,vt,yt),h_(t.dynamicLayoutVertexArray,x,we),F.emplaceBack(Ut,Ut+1,Ut+2),F.emplaceBack(Ut+1,Ut+2,Ut+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Re[0]),_e!==n.length-1&&St===n[_e+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,m,m.index,{},D,he&&he[St])}t.placedSymbolArray.emplaceBack(x.x,x.y,J,this.glyphOffsetArray.length-J,se,P,k,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,E)}_addCollisionDebugVertex(t,n,o,u,f,m){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,n,o,u,f,m,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),P=x.vertexLength,k=f.layoutVertexArray,E=f.collisionVertexArray,D=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(k,E,m,D,F,new B(t,n)),this._addCollisionDebugVertex(k,E,m,D,F,new B(o,n)),this._addCollisionDebugVertex(k,E,m,D,F,new B(o,u)),this._addCollisionDebugVertex(k,E,m,D,F,new B(t,u)),x.vertexLength+=4;const q=f.indexArray;q.emplaceBack(P,P+1),q.emplaceBack(P+1,P+2),q.emplaceBack(P+2,P+3),q.emplaceBack(P+3,P),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let f=t;f<n;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,u?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new p_(wr,v0.members,wn),this.iconCollisionBox=new p_(wr,v0.members,wn);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,f,m,y,x,P){const k={};for(let E=n;E<o;E++){const D=t.get(E);k.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.textFeatureIndex=D.featureIndex;break}for(let E=u;E<f;E++){const D=t.get(E);k.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.verticalTextFeatureIndex=D.featureIndex;break}for(let E=m;E<y;E++){const D=t.get(E);k.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.iconFeatureIndex=D.featureIndex;break}for(let E=x;E<P;E++){const D=t.get(E);k.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},k.verticalIconFeatureIndex=D.featureIndex;break}return k}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(n*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>u[y]-u[x]||f[x]-f[y]),m}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,f,m)=>{u>=0&&m.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let F0,B0;_t("SymbolBucket",jl,{omit:["layers","collisionBoxArray","features","compareText"]}),jl.MAX_GLYPHS=65535,jl.addDynamicAttributes=h_;var f_={get paint(){return B0=B0||new p({"icon-opacity":new Rt(be.paint_symbol["icon-opacity"]),"icon-color":new Rt(be.paint_symbol["icon-color"]),"icon-halo-color":new Rt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Rt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Rt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Rt(be.paint_symbol["text-opacity"]),"text-color":new Rt(be.paint_symbol["text-color"],{runtimeType:Cn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new Rt(be.paint_symbol["text-halo-color"]),"text-halo-width":new Rt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Rt(be.paint_symbol["text-halo-blur"]),"text-translate":new bt(be.paint_symbol["text-translate"]),"text-translate-anchor":new bt(be.paint_symbol["text-translate-anchor"])})},get layout(){return F0=F0||new p({"symbol-placement":new bt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Rt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Rt(be.layout_symbol["icon-size"]),"icon-text-fit":new bt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Rt(be.layout_symbol["icon-image"]),"icon-rotate":new Rt(be.layout_symbol["icon-rotate"]),"icon-padding":new Rt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Rt(be.layout_symbol["icon-offset"]),"icon-anchor":new Rt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(be.layout_symbol["text-rotation-alignment"]),"text-field":new Rt(be.layout_symbol["text-field"]),"text-font":new Rt(be.layout_symbol["text-font"]),"text-size":new Rt(be.layout_symbol["text-size"]),"text-max-width":new Rt(be.layout_symbol["text-max-width"]),"text-line-height":new bt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Rt(be.layout_symbol["text-letter-spacing"]),"text-justify":new Rt(be.layout_symbol["text-justify"]),"text-radial-offset":new Rt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Rt(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Rt(be.layout_symbol["text-anchor"]),"text-max-angle":new bt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(be.layout_symbol["text-writing-mode"]),"text-rotate":new Rt(be.layout_symbol["text-rotate"]),"text-padding":new bt(be.layout_symbol["text-padding"]),"text-keep-upright":new bt(be.layout_symbol["text-keep-upright"]),"text-transform":new Rt(be.layout_symbol["text-transform"]),"text-offset":new Rt(be.layout_symbol["text-offset"]),"text-allow-overlap":new bt(be.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(be.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(be.layout_symbol["text-ignore-placement"]),"text-optional":new bt(be.layout_symbol["text-optional"])})}};class N0{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ir,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}_t("FormatSectionOverride",N0,{omit:["defaultValue"]});class Zf extends r{constructor(t){super(t,f_)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const f=this.layout.get(t).evaluate(n,{},o,u),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||fl(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(P,k)=>y&&k in y?String(y[k]):"")}(n.properties,f)}createBucket(t){return new jl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of f_.paint.overridableProperties){if(!Zf.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new N0(n),u=new pl(o,n.property.specification);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new go("source",u):new yo("composite",u,n.value.zoomStops),this.paint._values[t]=new Xr(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Zf.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=f_.paint.properties[n];let f=!1;const m=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof ar)m(o.value.value.sections);else if(o.value.kind==="source"){const y=P=>{f||(P instanceof Cr&&an(P.value)===Qr?m(P.value.sections):P instanceof rl?m(P.sections):P.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let V0;var m2={get paint(){return V0=V0||new p({"background-color":new bt(be.paint_background["background-color"]),"background-pattern":new Cl(be.paint_background["background-pattern"]),"background-opacity":new bt(be.paint_background["background-opacity"])})}};class g2 extends r{constructor(t){super(t,m2)}}let j0;var y2={get paint(){return j0=j0||new p({"raster-opacity":new bt(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(be.paint_raster["raster-saturation"]),"raster-contrast":new bt(be.paint_raster["raster-contrast"]),"raster-resampling":new bt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(be.paint_raster["raster-fade-duration"])})}};class _2 extends r{constructor(t){super(t,y2)}}class v2 extends r{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class x2{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const m_=63710088e-1;class Ro{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ro(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return m_*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Ro)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ro(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ro(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const U0=2*Math.PI*m_;function q0(i){return U0*Math.cos(i*Math.PI/180)}function Z0(i){return(180+i)/360}function G0(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function W0(i,t){return i/q0(t)}function g_(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Qu{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=Ro.convert(t);return new Qu(Z0(o.lng),G0(o.lat),W0(n,o.lat))}toLngLat(){return new Ro(360*this.x-180,g_(this.y))}toAltitude(){return this.z*q0(g_(this.y))}meterInMercatorCoordinateUnits(){return 1/U0*(t=g_(this.y),1/Math.cos(t*Math.PI/180));var t}}function H0(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class y_{constructor(t,n,o){if(!function(u,f,m){return!(u<0||u>25||m<0||m>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=eh(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(m=this.y,y=this.z,x=H0(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),P=H0(256*(f+1),256*(m+1),y),x[0]+","+x[1]+","+P[0]+","+P[1]);var f,m,y,x,P;const k=function(E,D,F){let q,Z="";for(let J=E;J>0;J--)q=1<<J-1,Z+=(D&q?1:0)+(F&q?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,k).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new B((t.x*n-this.x)*ln,(t.y*n-this.y)*ln)}toString(){return`${this.z}/${this.x}/${this.y}`}}class X0{constructor(t,n){this.wrap=t,this.canonical=n,this.key=eh(t,n.z,n.z,n.x,n.y)}}class Rr{constructor(t,n,o,u,f){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new y_(o,+u,+f),this.key=eh(n,t,o,u,f)}clone(){return new Rr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Rr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Rr(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?eh(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):eh(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Rr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Rr(n,this.wrap,n,o,u),new Rr(n,this.wrap,n,o+1,u),new Rr(n,this.wrap,n,o,u+1),new Rr(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Rr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Rr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new X0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Qu(t.x-this.wrap,t.y))}}function eh(i,t,n,o,u){(i*=2)<0&&(i=-1*i-1);const f=1<<n;return(f*f*i+f*u+o).toString(36)+n.toString(36)+t.toString(36)}_t("CanonicalTileID",y_),_t("OverscaledTileID",Rr,{omit:["posMatrix"]});class K0{constructor(t,n,o,u=1,f=1,m=1,y=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void De(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<x;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(x,P)]=this.data[this._idx(x-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,x)]=this.data[this._idx(P,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<x;P++)for(let k=0;k<x;k++){const E=this.get(P,k);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Lr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,m=o*this.dim,y=o*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:m=y-1;break;case 1:y=m+1}const x=-n*this.dim,P=-o*this.dim;for(let k=m;k<y;k++)for(let E=u;E<f;E++)this.data[this._idx(E,k)]=t.data[this._idx(E+x,k+P)]}}_t("DEMData",K0);class $0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class J0{constructor(t,n,o,u,f){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Y0{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new bo(ln,16,0),this.grid3D=new bo(ln,16,0),this.featureIndexArray=new Nn,this.promoteId=n}insert(t,n,o,u,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=m?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const k=n[P],E=[1/0,1/0,-1/0,-1/0];for(let D=0;D<k.length;D++){const F=k[D];E[0]=Math.min(E[0],F.x),E[1]=Math.min(E[1],F.y),E[2]=Math.max(E[2],F.x),E[3]=Math.max(E[3],F.y)}E[0]<ln&&E[1]<ln&&E[2]>=0&&E[3]>=0&&x.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zo.VectorTile(new s_(this.rawTileData)).layers,this.sourceLayerCoder=new $0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const f=t.params||{},m=ln/t.tileSize/t.scale,y=vu(f.filter),x=t.queryGeometry,P=t.queryPadding*m,k=ex(x),E=this.grid.query(k.minX-P,k.minY-P,k.maxX+P,k.maxY+P),D=ex(t.cameraQueryGeometry),F=this.grid3D.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P,(J,se,we,he)=>function(_e,Ae,Ze,ft,Lt){for(const ot of _e)if(Ae<=ot.x&&Ze<=ot.y&&ft>=ot.x&&Lt>=ot.y)return!0;const ht=[new B(Ae,Ze),new B(Ae,Lt),new B(ft,Lt),new B(ft,Ze)];if(_e.length>2){for(const ot of ht)if(Ll(_e,ot))return!0}for(let ot=0;ot<_e.length-1;ot++)if(ew(_e[ot],_e[ot+1],ht))return!0;return!1}(t.cameraQueryGeometry,J-P,se-P,we+P,he+P));for(const J of F)E.push(J);E.sort(b2);const q={};let Z;for(let J=0;J<E.length;J++){const se=E[J];if(se===Z)continue;Z=se;const we=this.featureIndexArray.get(se);let he=null;this.loadMatchingFeature(q,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,y,f.layers,f.availableImages,n,o,u,(_e,Ae,Ze)=>(he||(he=Ea(_e)),Ae.queryIntersectsFeature(x,_e,Ze,he,this.z,t.transform,m,t.pixelPosMatrix)))}return q}loadMatchingFeature(t,n,o,u,f,m,y,x,P,k,E){const D=this.bucketLayerIDs[n];if(m&&!function(J,se){for(let we=0;we<J.length;we++)if(se.indexOf(J[we])>=0)return!0;return!1}(m,D))return;const F=this.sourceLayerCoder.decode(o),q=this.vtLayers[F].feature(u);if(f.needGeometry){const J=Ma(q,!0);if(!f.filter(new Ei(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!f.filter(new Ei(this.tileID.overscaledZ),q))return;const Z=this.getId(q,F);for(let J=0;J<D.length;J++){const se=D[J];if(m&&m.indexOf(se)<0)continue;const we=x[se];if(!we)continue;let he={};Z&&k&&(he=k.getState(we.sourceLayer||"_geojsonTileLayer",Z));const _e=$e({},P[se]);_e.paint=Q0(_e.paint,we.paint,q,he,y),_e.layout=Q0(_e.layout,we.layout,q,he,y);const Ae=!E||E(q,we,he);if(!Ae)continue;const Ze=new J0(q,this.z,this.x,this.y,Z);Ze.layer=_e;let ft=t[se];ft===void 0&&(ft=t[se]=[]),ft.push({featureIndex:u,feature:Ze,intersectionZ:Ae})}}lookupSymbolFeatures(t,n,o,u,f,m,y,x){const P={};this.loadVTLayers();const k=vu(f);for(const E of t)this.loadMatchingFeature(P,o,u,E,k,m,y,x,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Q0(i,t,n,o,u){return He(i,(f,m)=>{const y=t instanceof Ia?t.get(m):null;return y&&y.evaluate?y.evaluate(n,o,u):y})}function ex(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return{minX:t,minY:n,maxX:o,maxY:u}}function b2(i,t){return t-i}function tx(i,t,n,o,u){const f=[];for(let m=0;m<i.length;m++){const y=i[m];let x;for(let P=0;P<y.length-1;P++){let k=y[P],E=y[P+1];k.x<t&&E.x<t||(k.x<t?k=new B(t,k.y+(t-k.x)/(E.x-k.x)*(E.y-k.y))._round():E.x<t&&(E=new B(t,k.y+(t-k.x)/(E.x-k.x)*(E.y-k.y))._round()),k.y<n&&E.y<n||(k.y<n?k=new B(k.x+(n-k.y)/(E.y-k.y)*(E.x-k.x),n)._round():E.y<n&&(E=new B(k.x+(n-k.y)/(E.y-k.y)*(E.x-k.x),n)._round()),k.x>=o&&E.x>=o||(k.x>=o?k=new B(o,k.y+(o-k.x)/(E.x-k.x)*(E.y-k.y))._round():E.x>=o&&(E=new B(o,k.y+(o-k.x)/(E.x-k.x)*(E.y-k.y))._round()),k.y>=u&&E.y>=u||(k.y>=u?k=new B(k.x+(u-k.y)/(E.y-k.y)*(E.x-k.x),u)._round():E.y>=u&&(E=new B(k.x+(u-k.y)/(E.y-k.y)*(E.x-k.x),u)._round()),x&&k.equals(x[x.length-1])||(x=[k],f.push(x)),x.push(E)))))}}return f}_t("FeatureIndex",Y0,{omit:["rawTileData","sourceLayerCoder"]});class Oo extends B{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new Oo(this.x,this.y,this.angle,this.segment)}}function ix(i,t,n,o,u){if(t.segment===void 0||n===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=i[m].dist(f),f=i[m]}y+=i[m].dist(i[m+1]),m++;const x=[];let P=0;for(;y<n/2;){const k=i[m],E=i[m+1];if(!E)return!1;let D=i[m-1].angleTo(k)-k.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),P+=D;y-x[0].distance>o;)P-=x.shift().angleDelta;if(P>u)return!1;m++,y+=k.dist(E)}return!0}function nx(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function rx(i,t,n){return i?.6*t*n:0}function sx(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function w2(i,t,n,o,u,f){const m=rx(n,u,f),y=sx(n,o)*f;let x=0;const P=nx(i)/2;for(let k=0;k<i.length-1;k++){const E=i[k],D=i[k+1],F=E.dist(D);if(x+F>P){const q=(P-x)/F,Z=Kn.number(E.x,D.x,q),J=Kn.number(E.y,D.y,q),se=new Oo(Z,J,D.angleTo(E),k);return se._round(),!m||ix(i,se,y,m,t)?se:void 0}x+=F}}function S2(i,t,n,o,u,f,m,y,x){const P=rx(o,f,m),k=sx(o,u),E=k*m,D=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-E<t/4&&(t=E+t/4),ox(i,D?t/2*y%t:(k/2+2*f)*m*y%t,t,P,n,E,D,!1,x)}function ox(i,t,n,o,u,f,m,y,x){const P=f/2,k=nx(i);let E=0,D=t-n,F=[];for(let q=0;q<i.length-1;q++){const Z=i[q],J=i[q+1],se=Z.dist(J),we=J.angleTo(Z);for(;D+n<E+se;){D+=n;const he=(D-E)/se,_e=Kn.number(Z.x,J.x,he),Ae=Kn.number(Z.y,J.y,he);if(_e>=0&&_e<x&&Ae>=0&&Ae<x&&D-P>=0&&D+P<=k){const Ze=new Oo(_e,Ae,we,q);Ze._round(),o&&!ix(i,Ze,f,o,u)||F.push(Ze)}}E+=se}return y||F.length||m||(F=ox(i,E/2,n,o,u,f,m,!0,x)),F}_t("Anchor",Oo);const Ul=pr;function ax(i,t,n,o){const u=[],f=i.image,m=f.pixelRatio,y=f.paddedRect.w-2*Ul,x=f.paddedRect.h-2*Ul;let P={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const k=f.stretchX||[[0,y]],E=f.stretchY||[[0,x]],D=(Re,kt)=>Re+kt[1]-kt[0],F=k.reduce(D,0),q=E.reduce(D,0),Z=y-F,J=x-q;let se=0,we=F,he=0,_e=q,Ae=0,Ze=Z,ft=0,Lt=J;if(f.content&&o){const Re=f.content,kt=Re[2]-Re[0],St=Re[3]-Re[1];(f.textFitWidth||f.textFitHeight)&&(P=L0(i)),se=Gf(k,0,Re[0]),he=Gf(E,0,Re[1]),we=Gf(k,Re[0],Re[2]),_e=Gf(E,Re[1],Re[3]),Ae=Re[0]-se,ft=Re[1]-he,Ze=kt-we,Lt=St-_e}const ht=P.x1,ot=P.y1,Tt=P.x2-ht,vt=P.y2-ot,yt=(Re,kt,St,Ut)=>{const Ii=Wf(Re.stretch-se,we,Tt,ht),Si=Hf(Re.fixed-Ae,Ze,Re.stretch,F),fn=Wf(kt.stretch-he,_e,vt,ot),$r=Hf(kt.fixed-ft,Lt,kt.stretch,q),Dn=Wf(St.stretch-se,we,Tt,ht),mn=Hf(St.fixed-Ae,Ze,St.stretch,F),Qn=Wf(Ut.stretch-he,_e,vt,ot),er=Hf(Ut.fixed-ft,Lt,Ut.stretch,q),tr=new B(Ii,fn),Yi=new B(Dn,fn),gn=new B(Dn,Qn),jn=new B(Ii,Qn),Ln=new B(Si/m,$r/m),ir=new B(mn/m,er/m),Rn=t*Math.PI/180;if(Rn){const pi=Math.sin(Rn),ki=Math.cos(Rn),Li=[ki,-pi,pi,ki];tr._matMult(Li),Yi._matMult(Li),jn._matMult(Li),gn._matMult(Li)}const Or=Re.stretch+Re.fixed,fr=kt.stretch+kt.fixed;return{tl:tr,tr:Yi,bl:jn,br:gn,tex:{x:f.paddedRect.x+Ul+Or,y:f.paddedRect.y+Ul+fr,w:St.stretch+St.fixed-Or,h:Ut.stretch+Ut.fixed-fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ln,pixelOffsetBR:ir,minFontScaleX:Ze/m/Tt,minFontScaleY:Lt/m/vt,isSDF:n}};if(o&&(f.stretchX||f.stretchY)){const Re=lx(k,Z,F),kt=lx(E,J,q);for(let St=0;St<Re.length-1;St++){const Ut=Re[St],Ii=Re[St+1];for(let Si=0;Si<kt.length-1;Si++)u.push(yt(Ut,kt[Si],Ii,kt[Si+1]))}}else u.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Gf(i,t,n){let o=0;for(const u of i)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function lx(i,t,n){const o=[{fixed:-Ul,stretch:0}];for(const[u,f]of i){const m=o[o.length-1];o.push({fixed:u-m.stretch,stretch:m.stretch}),o.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return o.push({fixed:t+Ul,stretch:n}),o}function Wf(i,t,n,o){return i/t*n+o}function Hf(i,t,n,o){return i-t*n/o}class Xf{constructor(t,n,o,u,f,m,y,x,P,k){var E;if(this.boxStartIndex=t.length,P){let D=m.top,F=m.bottom;const q=m.collisionPadding;q&&(D-=q[1],F+=q[3]);let Z=F-D;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const D=!((E=m.image)===null||E===void 0)&&E.content&&(m.image.textFitWidth||m.image.textFitHeight)?L0(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const F=m.collisionPadding;if(F&&(D.x1-=F[0]*y,D.y1-=F[1]*y,D.x2+=F[2]*y,D.y2+=F[3]*y),k){const q=new B(D.x1,D.y1),Z=new B(D.x2,D.y1),J=new B(D.x1,D.y2),se=new B(D.x2,D.y2),we=k*Math.PI/180;q._rotate(we),Z._rotate(we),J._rotate(we),se._rotate(we),D.x1=Math.min(q.x,Z.x,J.x,se.x),D.x2=Math.max(q.x,Z.x,J.x,se.x),D.y1=Math.min(q.y,Z.y,J.y,se.y),D.y2=Math.max(q.y,Z.y,J.y,se.y)}t.emplaceBack(n.x,n.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=t.length}}class T2{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const f=t-1>>1,m=n[f];if(o(u,m)>=0)break;n[t]=m,t=f}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,f=n[t];for(;t<u;){let m=1+(t<<1);const y=m+1;if(y<this.length&&o(n[y],n[m])<0&&(m=y),o(n[m],f)>=0)break;n[t]=n[m],t=m}n[t]=f}}function P2(i,t=1,n=!1){let o=1/0,u=1/0,f=-1/0,m=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const q=y[F];(!F||q.x<o)&&(o=q.x),(!F||q.y<u)&&(u=q.y),(!F||q.x>f)&&(f=q.x),(!F||q.y>m)&&(m=q.y)}const x=Math.min(f-o,m-u);let P=x/2;const k=new T2([],I2);if(x===0)return new B(o,u);for(let F=o;F<f;F+=x)for(let q=u;q<m;q+=x)k.push(new ql(F+P,q+P,P,i));let E=function(F){let q=0,Z=0,J=0;const se=F[0];for(let we=0,he=se.length,_e=he-1;we<he;_e=we++){const Ae=se[we],Ze=se[_e],ft=Ae.x*Ze.y-Ze.x*Ae.y;Z+=(Ae.x+Ze.x)*ft,J+=(Ae.y+Ze.y)*ft,q+=3*ft}return new ql(Z/q,J/q,0,F)}(i),D=k.length;for(;k.length;){const F=k.pop();(F.d>E.d||!E.d)&&(E=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,D)),F.max-E.d<=t||(P=F.h/2,k.push(new ql(F.p.x-P,F.p.y-P,P,i)),k.push(new ql(F.p.x+P,F.p.y-P,P,i)),k.push(new ql(F.p.x-P,F.p.y+P,P,i)),k.push(new ql(F.p.x+P,F.p.y+P,P,i)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function I2(i,t){return t.max-i.max}function ql(i,t,n,o){this.p=new B(i,t),this.h=n,this.d=function(u,f){let m=!1,y=1/0;for(let x=0;x<f.length;x++){const P=f[x];for(let k=0,E=P.length,D=E-1;k<E;D=k++){const F=P[k],q=P[D];F.y>u.y!=q.y>u.y&&u.x<(q.x-F.x)*(u.y-F.y)/(q.y-F.y)+F.x&&(m=!m),y=Math.min(y,Gv(u,F,q))}}return(m?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var zn;b.aq=void 0,(zn=b.aq||(b.aq={}))[zn.center=1]="center",zn[zn.left=2]="left",zn[zn.right=3]="right",zn[zn.top=4]="top",zn[zn.bottom=5]="bottom",zn[zn["top-left"]=6]="top-left",zn[zn["top-right"]=7]="top-right",zn[zn["bottom-left"]=8]="bottom-left",zn[zn["bottom-right"]=9]="bottom-right";const Fo=7,__=Number.POSITIVE_INFINITY;function cx(i,t){return t[1]!==__?function(n,o,u){let f=0,m=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":m=u-Fo;break;case"bottom-right":case"bottom-left":case"bottom":m=-u+Fo}switch(n){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,m]}(i,t[0],t[1]):function(n,o){let u=0,f=0;o<0&&(o=0);const m=o/Math.SQRT2;switch(n){case"top-right":case"top-left":f=m-Fo;break;case"bottom-right":case"bottom-left":f=-m+Fo;break;case"bottom":f=-o+Fo;break;case"top":f=o-Fo}switch(n){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=o;break;case"right":u=-o}return[u,f]}(i,t[0])}function ux(i,t,n){var o;const u=i.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(f){const y=f.values,x=[];for(let P=0;P<y.length;P+=2){const k=x[P]=y[P],E=y[P+1].map(D=>D*un);k.startsWith("top")?E[1]-=Fo:k.startsWith("bottom")&&(E[1]+=Fo),x[P+1]=E}return new gr(x)}const m=u.get("text-variable-anchor");if(m){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*un,__]:u.get("text-offset").evaluate(t,{},n).map(P=>P*un);const x=[];for(const P of m)x.push(P,cx(P,y));return new gr(x)}return null}function v_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function C2(i,t,n,o,u,f,m,y,x,P,k){let E=f.textMaxSize.evaluate(t,{});E===void 0&&(E=m);const D=i.layers[0].layout,F=D.get("icon-offset").evaluate(t,{},k),q=dx(n.horizontal),Z=m/24,J=i.tilePixelRatio*Z,se=i.tilePixelRatio*E/24,we=i.tilePixelRatio*y,he=i.tilePixelRatio*D.get("symbol-spacing"),_e=D.get("text-padding")*i.tilePixelRatio,Ae=function(Re,kt,St,Ut=1){const Ii=Re.get("icon-padding").evaluate(kt,{},St),Si=Ii&&Ii.values;return[Si[0]*Ut,Si[1]*Ut,Si[2]*Ut,Si[3]*Ut]}(D,t,k,i.tilePixelRatio),Ze=D.get("text-max-angle")/180*Math.PI,ft=D.get("text-rotation-alignment")!=="viewport"&&D.get("symbol-placement")!=="point",Lt=D.get("icon-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",ht=D.get("symbol-placement"),ot=he/2,Tt=D.get("icon-text-fit");let vt;o&&Tt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(vt=R0(o,n.vertical,Tt,D.get("icon-text-fit-padding"),F,Z)),q&&(o=R0(o,q,Tt,D.get("icon-text-fit-padding"),F,Z)));const yt=(Re,kt)=>{kt.x<0||kt.x>=ln||kt.y<0||kt.y>=ln||function(St,Ut,Ii,Si,fn,$r,Dn,mn,Qn,er,tr,Yi,gn,jn,Ln,ir,Rn,Or,fr,pi,ki,Li,Sr,Gi,Zl){const ys=St.addToLineVertexArray(Ut,Ii);let _s,Jr,Fr,Sn,Ws=0,nh=0,gx=0,yx=0,C_=-1,k_=-1;const Hs={};let _x=El("");if(St.allowVerticalPlacement&&Si.vertical){const Un=mn.layout.get("text-rotate").evaluate(ki,{},Gi)+90;Fr=new Xf(Qn,Ut,er,tr,Yi,Si.vertical,gn,jn,Ln,Un),Dn&&(Sn=new Xf(Qn,Ut,er,tr,Yi,Dn,Rn,Or,Ln,Un))}if(fn){const Un=mn.layout.get("icon-rotate").evaluate(ki,{}),Br=mn.layout.get("icon-text-fit")!=="none",Da=ax(fn,Un,Sr,Br),rs=Dn?ax(Dn,Un,Sr,Br):void 0;Jr=new Xf(Qn,Ut,er,tr,Yi,fn,Rn,Or,!1,Un),Ws=4*Da.length;const La=St.iconSizeData;let vs=null;La.kind==="source"?(vs=[gs*mn.layout.get("icon-size").evaluate(ki,{})],vs[0]>Lo&&De(`${St.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)):La.kind==="composite"&&(vs=[gs*Li.compositeIconSizes[0].evaluate(ki,{},Gi),gs*Li.compositeIconSizes[1].evaluate(ki,{},Gi)],(vs[0]>Lo||vs[1]>Lo)&&De(`${St.layerIds[0]}: Value for "icon-size" is >= ${Yu}. Reduce your "icon-size".`)),St.addSymbols(St.icon,Da,vs,pi,fr,ki,b.ah.none,Ut,ys.lineStartIndex,ys.lineLength,-1,Gi),C_=St.icon.placedSymbolArray.length-1,rs&&(nh=4*rs.length,St.addSymbols(St.icon,rs,vs,pi,fr,ki,b.ah.vertical,Ut,ys.lineStartIndex,ys.lineLength,-1,Gi),k_=St.icon.placedSymbolArray.length-1)}const vx=Object.keys(Si.horizontal);for(const Un of vx){const Br=Si.horizontal[Un];if(!_s){_x=El(Br.text);const rs=mn.layout.get("text-rotate").evaluate(ki,{},Gi);_s=new Xf(Qn,Ut,er,tr,Yi,Br,gn,jn,Ln,rs)}const Da=Br.positionedLines.length===1;if(gx+=hx(St,Ut,Br,$r,mn,Ln,ki,ir,ys,Si.vertical?b.ah.horizontal:b.ah.horizontalOnly,Da?vx:[Un],Hs,C_,Li,Gi),Da)break}Si.vertical&&(yx+=hx(St,Ut,Si.vertical,$r,mn,Ln,ki,ir,ys,b.ah.vertical,["vertical"],Hs,k_,Li,Gi));const E2=_s?_s.boxStartIndex:St.collisionBoxArray.length,M2=_s?_s.boxEndIndex:St.collisionBoxArray.length,z2=Fr?Fr.boxStartIndex:St.collisionBoxArray.length,D2=Fr?Fr.boxEndIndex:St.collisionBoxArray.length,L2=Jr?Jr.boxStartIndex:St.collisionBoxArray.length,R2=Jr?Jr.boxEndIndex:St.collisionBoxArray.length,O2=Sn?Sn.boxStartIndex:St.collisionBoxArray.length,F2=Sn?Sn.boxEndIndex:St.collisionBoxArray.length;let ns=-1;const $f=(Un,Br)=>Un&&Un.circleDiameter?Math.max(Un.circleDiameter,Br):Br;ns=$f(_s,ns),ns=$f(Fr,ns),ns=$f(Jr,ns),ns=$f(Sn,ns);const xx=ns>-1?1:0;xx&&(ns*=Zl/un),St.glyphOffsetArray.length>=jl.MAX_GLYPHS&&De("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ki.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,ki.sortKey);const B2=ux(mn,ki,Gi),[N2,V2]=function(Un,Br){const Da=Un.length,rs=Br==null?void 0:Br.values;if((rs==null?void 0:rs.length)>0)for(let La=0;La<rs.length;La+=2){const vs=rs[La+1];Un.emplaceBack(b.aq[rs[La]],vs[0],vs[1])}return[Da,Un.length]}(St.textAnchorOffsets,B2);St.symbolInstances.emplaceBack(Ut.x,Ut.y,Hs.right>=0?Hs.right:-1,Hs.center>=0?Hs.center:-1,Hs.left>=0?Hs.left:-1,Hs.vertical||-1,C_,k_,_x,E2,M2,z2,D2,L2,R2,O2,F2,er,gx,yx,Ws,nh,xx,0,gn,ns,N2,V2)}(i,kt,Re,n,o,u,vt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,J,[_e,_e,_e,_e],ft,x,we,Ae,Lt,F,t,f,P,k,m)};if(ht==="line")for(const Re of tx(t.geometry,0,0,ln,ln)){const kt=S2(Re,he,Ze,n.vertical||q,o,24,se,i.overscaling,ln);for(const St of kt)q&&k2(i,q.text,ot,St)||yt(Re,St)}else if(ht==="line-center"){for(const Re of t.geometry)if(Re.length>1){const kt=w2(Re,Ze,n.vertical||q,o,24,se);kt&&yt(Re,kt)}}else if(t.type==="Polygon")for(const Re of ol(t.geometry,0)){const kt=P2(Re,16);yt(Re[0],new Oo(kt.x,kt.y,0))}else if(t.type==="LineString")for(const Re of t.geometry)yt(Re,new Oo(Re[0].x,Re[0].y,0));else if(t.type==="Point")for(const Re of t.geometry)for(const kt of Re)yt([kt],new Oo(kt.x,kt.y,0))}function hx(i,t,n,o,u,f,m,y,x,P,k,E,D,F,q){const Z=function(we,he,_e,Ae,Ze,ft,Lt,ht){const ot=Ae.layout.get("text-rotate").evaluate(ft,{})*Math.PI/180,Tt=[];for(const vt of he.positionedLines)for(const yt of vt.positionedGlyphs){if(!yt.rect)continue;const Re=yt.rect||{};let kt=C0+1,St=!0,Ut=1,Ii=0;const Si=(Ze||ht)&&yt.vertical,fn=yt.metrics.advance*yt.scale/2;if(ht&&he.verticalizable&&(Ii=vt.lineOffset/2-(yt.imageName?-(un-yt.metrics.width*yt.scale)/2:(yt.scale-1)*un)),yt.imageName){const pi=Lt[yt.imageName];St=pi.sdf,Ut=pi.pixelRatio,kt=pr/Ut}const $r=Ze?[yt.x+fn,yt.y]:[0,0];let Dn=Ze?[0,0]:[yt.x+fn+_e[0],yt.y+_e[1]-Ii],mn=[0,0];Si&&(mn=Dn,Dn=[0,0]);const Qn=yt.metrics.isDoubleResolution?2:1,er=(yt.metrics.left-kt)*yt.scale-fn+Dn[0],tr=(-yt.metrics.top-kt)*yt.scale+Dn[1],Yi=er+Re.w/Qn*yt.scale/Ut,gn=tr+Re.h/Qn*yt.scale/Ut,jn=new B(er,tr),Ln=new B(Yi,tr),ir=new B(er,gn),Rn=new B(Yi,gn);if(Si){const pi=new B(-fn,fn-$u),ki=-Math.PI/2,Li=un/2-fn,Sr=new B(5-$u-Li,-(yt.imageName?Li:0)),Gi=new B(...mn);jn._rotateAround(ki,pi)._add(Sr)._add(Gi),Ln._rotateAround(ki,pi)._add(Sr)._add(Gi),ir._rotateAround(ki,pi)._add(Sr)._add(Gi),Rn._rotateAround(ki,pi)._add(Sr)._add(Gi)}if(ot){const pi=Math.sin(ot),ki=Math.cos(ot),Li=[ki,-pi,pi,ki];jn._matMult(Li),Ln._matMult(Li),ir._matMult(Li),Rn._matMult(Li)}const Or=new B(0,0),fr=new B(0,0);Tt.push({tl:jn,tr:Ln,bl:ir,br:Rn,tex:Re,writingMode:he.writingMode,glyphOffset:$r,sectionIndex:yt.sectionIndex,isSDF:St,pixelOffsetTL:Or,pixelOffsetBR:fr,minFontScaleX:0,minFontScaleY:0})}return Tt}(0,n,y,u,f,m,o,i.allowVerticalPlacement),J=i.textSizeData;let se=null;J.kind==="source"?(se=[gs*u.layout.get("text-size").evaluate(m,{})],se[0]>Lo&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)):J.kind==="composite"&&(se=[gs*F.compositeTextSizes[0].evaluate(m,{},q),gs*F.compositeTextSizes[1].evaluate(m,{},q)],(se[0]>Lo||se[1]>Lo)&&De(`${i.layerIds[0]}: Value for "text-size" is >= ${Yu}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,se,y,f,m,P,t,x.lineStartIndex,x.lineLength,D,q);for(const we of k)E[we]=i.text.placedSymbolArray.length-1;return 4*Z.length}function dx(i){for(const t in i)return i[t];return null}function k2(i,t,n,o){const u=i.compareText;if(t in u){const f=u[t];for(let m=f.length-1;m>=0;m--)if(o.dist(f[m])<n)return!0}else u[t]=[];return u[t].push(o),!1}const px=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class x_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=px[15&o];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new x_(y,m,f,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=px.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return b_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],P=[];for(;x.length;){const k=x.pop()||0,E=x.pop()||0,D=x.pop()||0;if(E-D<=y){for(let J=D;J<=E;J++){const se=m[2*J],we=m[2*J+1];se>=t&&se<=o&&we>=n&&we<=u&&P.push(f[J])}continue}const F=D+E>>1,q=m[2*F],Z=m[2*F+1];q>=t&&q<=o&&Z>=n&&Z<=u&&P.push(f[F]),(k===0?t<=q:n<=Z)&&(x.push(D),x.push(F-1),x.push(1-k)),(k===0?o>=q:u>=Z)&&(x.push(F+1),x.push(E),x.push(1-k))}return P}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,y=[0,u.length-1,0],x=[],P=o*o;for(;y.length;){const k=y.pop()||0,E=y.pop()||0,D=y.pop()||0;if(E-D<=m){for(let J=D;J<=E;J++)mx(f[2*J],f[2*J+1],t,n)<=P&&x.push(u[J]);continue}const F=D+E>>1,q=f[2*F],Z=f[2*F+1];mx(q,Z,t,n)<=P&&x.push(u[F]),(k===0?t-o<=q:n-o<=Z)&&(y.push(D),y.push(F-1),y.push(1-k)),(k===0?t+o>=q:n+o>=Z)&&(y.push(F+1),y.push(E),y.push(1-k))}return x}}function b_(i,t,n,o,u,f){if(u-o<=n)return;const m=o+u>>1;fx(i,t,m,o,u,f),b_(i,t,n,o,m-1,1-f),b_(i,t,n,m+1,u,1-f)}function fx(i,t,n,o,u,f){for(;u>o;){if(u-o>600){const P=u-o+1,k=n-o+1,E=Math.log(P),D=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*D*(P-D)/P)*(k-P/2<0?-1:1);fx(i,t,n,Math.max(o,Math.floor(n-k*D/P+F)),Math.min(u,Math.floor(n+(P-k)*D/P+F)),f)}const m=t[2*n+f];let y=o,x=u;for(th(i,t,o,n),t[2*u+f]>m&&th(i,t,o,u);y<x;){for(th(i,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*o+f]===m?th(i,t,o,x):(x++,th(i,t,x,u)),x<=n&&(o=x+1),n<=x&&(u=x-1)}}function th(i,t,n,o){w_(i,n,o),w_(t,2*n,2*o),w_(t,2*n+1,2*o+1)}function w_(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function mx(i,t,n,o){const u=i-n,f=t-o;return u*u+f*f}var S_;b.bg=void 0,(S_=b.bg||(b.bg={})).create="create",S_.load="load",S_.fullLoad="fullLoad";let Kf=null,ih=[];const T_=1e3/60,P_="loadTime",I_="fullLoadTime",A2={mark(i){performance.mark(i)},frame(i){const t=i;Kf!=null&&ih.push(t-Kf),Kf=t},clearMetrics(){Kf=null,ih=[],performance.clearMeasures(P_),performance.clearMeasures(I_);for(const i in b.bg)performance.clearMarks(b.bg[i])},getPerformanceMetrics(){performance.measure(P_,b.bg.create,b.bg.load),performance.measure(I_,b.bg.create,b.bg.fullLoad);const i=performance.getEntriesByName(P_)[0].duration,t=performance.getEntriesByName(I_)[0].duration,n=ih.length,o=1/(ih.reduce((f,m)=>f+m,0)/n/1e3),u=ih.filter(f=>f>T_).reduce((f,m)=>f+(m-T_)/T_,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};b.$=class extends M{},b.A=Rl,b.B=Ly,b.C=function(i){if(et==null){const t=i.navigator?i.navigator.userAgent:null;et=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return et},b.D=bt,b.E=Bt,b.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new x2(()=>this.process()),this.subscription=function(n,o,u,f){return n.addEventListener(o,u,!1),{unsubscribe:()=>{n.removeEventListener(o,u,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Ue(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[u]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[u];const y={id:u,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const f=[],m=Object.assign(Object.assign({},i),{id:u,sourceMapId:this.mapId,origin:location.origin,data:wo(i.data,f)});this.target.postMessage(m,{transfer:f})})}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ue(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return l(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[i];return delete this.resolveRejects[i],u?void(t.error?u.reject(So(t.error)):u.resolve(So(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=So(t.data),o=new AbortController;this.abortControllers[i]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(i,null,u)}catch(u){this.completeTask(i,u)}})}completeTask(i,t,n){const o=[];delete this.abortControllers[i];const u={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?wo(t):null,data:wo(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},b.G=sn,b.H=function(){var i=new Rl(16);return Rl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},b.I=a_,b.J=function(i,t,n){var o,u,f,m,y,x,P,k,E,D,F,q,Z=n[0],J=n[1],se=n[2];return t===i?(i[12]=t[0]*Z+t[4]*J+t[8]*se+t[12],i[13]=t[1]*Z+t[5]*J+t[9]*se+t[13],i[14]=t[2]*Z+t[6]*J+t[10]*se+t[14],i[15]=t[3]*Z+t[7]*J+t[11]*se+t[15]):(u=t[1],f=t[2],m=t[3],y=t[4],x=t[5],P=t[6],k=t[7],E=t[8],D=t[9],F=t[10],q=t[11],i[0]=o=t[0],i[1]=u,i[2]=f,i[3]=m,i[4]=y,i[5]=x,i[6]=P,i[7]=k,i[8]=E,i[9]=D,i[10]=F,i[11]=q,i[12]=o*Z+y*J+E*se+t[12],i[13]=u*Z+x*J+D*se+t[13],i[14]=f*Z+P*J+F*se+t[14],i[15]=m*Z+k*J+q*se+t[15]),i},b.K=function(i,t,n){var o=n[0],u=n[1],f=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*u,i[5]=t[5]*u,i[6]=t[6]*u,i[7]=t[7]*u,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.L=Kv,b.M=function(i,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in i&&(n[u]=i[u])}return n},b.N=Ro,b.O=Z0,b.P=B,b.Q=G0,b.R=Lr,b.S=Rr,b.T=Pl,b.U=ye,b.V=pe,b.W=ct,b.X=ln,b.Y=_,b.Z=Qu,b._=l,b.a=Pi,b.a$=function(i,t){var n=i[0],o=i[1],u=i[2],f=i[3],m=i[4],y=i[5],x=i[6],P=i[7],k=i[8],E=i[9],D=i[10],F=i[11],q=i[12],Z=i[13],J=i[14],se=i[15],we=t[0],he=t[1],_e=t[2],Ae=t[3],Ze=t[4],ft=t[5],Lt=t[6],ht=t[7],ot=t[8],Tt=t[9],vt=t[10],yt=t[11],Re=t[12],kt=t[13],St=t[14],Ut=t[15];return Math.abs(n-we)<=Yn*Math.max(1,Math.abs(n),Math.abs(we))&&Math.abs(o-he)<=Yn*Math.max(1,Math.abs(o),Math.abs(he))&&Math.abs(u-_e)<=Yn*Math.max(1,Math.abs(u),Math.abs(_e))&&Math.abs(f-Ae)<=Yn*Math.max(1,Math.abs(f),Math.abs(Ae))&&Math.abs(m-Ze)<=Yn*Math.max(1,Math.abs(m),Math.abs(Ze))&&Math.abs(y-ft)<=Yn*Math.max(1,Math.abs(y),Math.abs(ft))&&Math.abs(x-Lt)<=Yn*Math.max(1,Math.abs(x),Math.abs(Lt))&&Math.abs(P-ht)<=Yn*Math.max(1,Math.abs(P),Math.abs(ht))&&Math.abs(k-ot)<=Yn*Math.max(1,Math.abs(k),Math.abs(ot))&&Math.abs(E-Tt)<=Yn*Math.max(1,Math.abs(E),Math.abs(Tt))&&Math.abs(D-vt)<=Yn*Math.max(1,Math.abs(D),Math.abs(vt))&&Math.abs(F-yt)<=Yn*Math.max(1,Math.abs(F),Math.abs(yt))&&Math.abs(q-Re)<=Yn*Math.max(1,Math.abs(q),Math.abs(Re))&&Math.abs(Z-kt)<=Yn*Math.max(1,Math.abs(Z),Math.abs(kt))&&Math.abs(J-St)<=Yn*Math.max(1,Math.abs(J),Math.abs(St))&&Math.abs(se-Ut)<=Yn*Math.max(1,Math.abs(se),Math.abs(Ut))},b.a0=ai,b.a1=y_,b.a2=Je,b.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of i){const u=window.document.createElement("source");Xi(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},b.a4=function(){return xt++},b.a5=dt,b.a6=jl,b.a7=vu,b.a8=Ma,b.a9=J0,b.aA=function(i){if(i.type==="custom")return new v2(i);switch(i.type){case"background":return new g2(i);case"circle":return new nw(i);case"fill":return new xw(i);case"fill-extrusion":return new Rw(i);case"heatmap":return new sw(i);case"hillshade":return new aw(i);case"line":return new qw(i);case"raster":return new _2(i);case"symbol":return new Zf(i)}},b.aB=Be,b.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Ht(i.version,t.version))return[{command:"setStyle",args:[t]}];Ht(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Ht(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Ht(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Ht(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Ht(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Ht(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Ht(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Ht(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),Ht(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Ht(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Ht(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(m,y,x,P){let k;for(k in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,k)&&(Object.prototype.hasOwnProperty.call(y,k)||_n(k,x,P));for(k in y)Object.prototype.hasOwnProperty.call(y,k)&&(Object.prototype.hasOwnProperty.call(m,k)?Ht(m[k],y[k])||(m[k].type==="geojson"&&y[k].type==="geojson"&&Zr(m,y,k)?li(x,{command:"setGeoJSONSourceData",args:[k,y[k].data]}):Xn(k,y,x,P)):sr(k,y,x))})(i.sources,t.sources,u,o);const f=[];i.layers&&i.layers.forEach(m=>{"source"in m&&o[m.source]?n.push({command:"removeLayer",args:[m.id]}):f.push(m)}),n=n.concat(u),function(m,y,x){y=y||[];const P=(m=m||[]).map(us),k=y.map(us),E=m.reduce(Es,{}),D=y.reduce(Es,{}),F=P.slice(),q=Object.create(null);let Z,J,se,we,he;for(let _e=0,Ae=0;_e<P.length;_e++)Z=P[_e],Object.prototype.hasOwnProperty.call(D,Z)?Ae++:(li(x,{command:"removeLayer",args:[Z]}),F.splice(F.indexOf(Z,Ae),1));for(let _e=0,Ae=0;_e<k.length;_e++)Z=k[k.length-1-_e],F[F.length-1-_e]!==Z&&(Object.prototype.hasOwnProperty.call(E,Z)?(li(x,{command:"removeLayer",args:[Z]}),F.splice(F.lastIndexOf(Z,F.length-Ae),1)):Ae++,we=F[F.length-_e],li(x,{command:"addLayer",args:[D[Z],we]}),F.splice(F.length-_e,0,Z),q[Z]=!0);for(let _e=0;_e<k.length;_e++)if(Z=k[_e],J=E[Z],se=D[Z],!q[Z]&&!Ht(J,se))if(Ht(J.source,se.source)&&Ht(J["source-layer"],se["source-layer"])&&Ht(J.type,se.type)){for(he in dn(J.layout,se.layout,x,Z,null,"setLayoutProperty"),dn(J.paint,se.paint,x,Z,null,"setPaintProperty"),Ht(J.filter,se.filter)||li(x,{command:"setFilter",args:[Z,se.filter]}),Ht(J.minzoom,se.minzoom)&&Ht(J.maxzoom,se.maxzoom)||li(x,{command:"setLayerZoomRange",args:[Z,se.minzoom,se.maxzoom]}),J)Object.prototype.hasOwnProperty.call(J,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?dn(J[he],se[he],x,Z,he.slice(6),"setPaintProperty"):Ht(J[he],se[he])||li(x,{command:"setLayerProperty",args:[Z,he,se[he]]}));for(he in se)Object.prototype.hasOwnProperty.call(se,he)&&!Object.prototype.hasOwnProperty.call(J,he)&&he!=="layout"&&he!=="paint"&&he!=="filter"&&he!=="metadata"&&he!=="minzoom"&&he!=="maxzoom"&&(he.indexOf("paint.")===0?dn(J[he],se[he],x,Z,he.slice(6),"setPaintProperty"):Ht(J[he],se[he])||li(x,{command:"setLayerProperty",args:[Z,he,se[he]]}))}else li(x,{command:"removeLayer",args:[Z]}),we=F[F.lastIndexOf(Z)+1],li(x,{command:"addLayer",args:[se,we]})}(f,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},b.aD=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},b.aE=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!i(t[o],n[o]))return!1;return!0}return t===n},b.aF=He,b.aG=Ye,b.aH=class extends ka{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},b.aI=Mf,b.aJ=class extends ka{constructor(i,t){super(i,t),this.current=K1}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},b.aK=Bv,b.aL=Nv,b.aM=vi,b.aN=class extends ka{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},b.aO=class extends ka{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},b.aP=function(i,t,n,o,u,f,m){var y=1/(t-n),x=1/(o-u),P=1/(f-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*P,i[11]=0,i[12]=(t+n)*y,i[13]=(u+o)*x,i[14]=(m+f)*P,i[15]=1,i},b.aQ=iw,b.aR=class extends fe{},b.aS=Hw,b.aT=class extends Se{},b.aU=Ky,b.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},b.aW=e0,b.aX=En,b.aY=Dr,b.aZ=class extends wt{},b.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},b.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,f)=>{const m=u||f;return t[o]=!m||m.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},b.ab=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},b.ac=ze,b.ad=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),f=t[0],m=t[1],y=t[2],x=t[3],P=t[4],k=t[5],E=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*u+P*o,i[1]=m*u+k*o,i[2]=y*u+E*o,i[3]=x*u+D*o,i[4]=P*u-f*o,i[5]=k*u-m*o,i[6]=E*u-y*o,i[7]=D*u-x*o,i},b.ae=function(i){var t=new Rl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},b.af=Rf,b.ag=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=i,y=u?ze($n.interpolationFactor(u,t,f,m),0,1):0;i.kind==="camera"?o=Kn.number(i.minSize,i.maxSize,y):n=y}return{uSizeT:n,uSize:o}},b.ai=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return i.kind==="source"?o/gs:i.kind==="composite"?Kn.number(o/gs,u/gs,n):t},b.aj=h_,b.ak=function(i,t,n,o){const u=t.y-i.y,f=t.x-i.x,m=o.y-n.y,y=o.x-n.x,x=m*f-y*u;if(x===0)return null;const P=(y*(i.y-n.y)-m*(i.x-n.x))/x;return new B(i.x+P*f,i.y+P*u)},b.al=tx,b.am=qv,b.an=Wy,b.ao=function(i){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const f of i)t=Math.min(t,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[t,n,o,u]},b.ap=un,b.ar=u_,b.as=function(i,t){var n=t[0],o=t[1],u=t[2],f=t[3],m=t[4],y=t[5],x=t[6],P=t[7],k=t[8],E=t[9],D=t[10],F=t[11],q=t[12],Z=t[13],J=t[14],se=t[15],we=n*y-o*m,he=n*x-u*m,_e=n*P-f*m,Ae=o*x-u*y,Ze=o*P-f*y,ft=u*P-f*x,Lt=k*Z-E*q,ht=k*J-D*q,ot=k*se-F*q,Tt=E*J-D*Z,vt=E*se-F*Z,yt=D*se-F*J,Re=we*yt-he*vt+_e*Tt+Ae*ot-Ze*ht+ft*Lt;return Re?(i[0]=(y*yt-x*vt+P*Tt)*(Re=1/Re),i[1]=(u*vt-o*yt-f*Tt)*Re,i[2]=(Z*ft-J*Ze+se*Ae)*Re,i[3]=(D*Ze-E*ft-F*Ae)*Re,i[4]=(x*ot-m*yt-P*ht)*Re,i[5]=(n*yt-u*ot+f*ht)*Re,i[6]=(J*_e-q*ft-se*he)*Re,i[7]=(k*ft-D*_e+F*he)*Re,i[8]=(m*vt-y*ot+P*Lt)*Re,i[9]=(o*ot-n*vt-f*Lt)*Re,i[10]=(q*Ze-Z*_e+se*we)*Re,i[11]=(E*_e-k*Ze-F*we)*Re,i[12]=(y*ht-m*Tt-x*Lt)*Re,i[13]=(n*Tt-o*ht+u*Lt)*Re,i[14]=(Z*he-q*Ae-J*we)*Re,i[15]=(k*Ae-E*he+D*we)*Re,i):null},b.at=v_,b.au=c_,b.av=x_,b.aw=function(){const i={},t=be.$version;for(const n in be.$root){const o=be.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(i[n]=u)}}return i},b.ax=Du,b.ay=Hi,b.az=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=In(i[n],t[i[n].ref]));return i},b.b=pt,b.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},b.b1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},b.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},b.b3=We,b.b4=X0,b.b5=W0,b.b6=function(i,t,n,o,u){var f,m=1/Math.tan(t/2);return i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,u!=null&&u!==1/0?(i[10]=(u+o)*(f=1/(o-u)),i[14]=2*u*o*f):(i[10]=-1,i[14]=-2*o),i},b.b7=function(i,t,n){var o=Math.sin(n),u=Math.cos(n),f=t[4],m=t[5],y=t[6],x=t[7],P=t[8],k=t[9],E=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*u+P*o,i[5]=m*u+k*o,i[6]=y*u+E*o,i[7]=x*u+D*o,i[8]=P*u-f*o,i[9]=k*u-m*o,i[10]=E*u-y*o,i[11]=D*u-x*o,i},b.b8=Ie,b.b9=Oe,b.bA=x0,b.bB=function(i){return i.message===Yt},b.bC=mo,b.bD=hr,b.ba=function(i){return i*Math.PI/180},b.bb=function(i,t){const{x:n,y:o}=Qu.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},b.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},b.bd=class extends A{},b.be=m_,b.bf=A2,b.bh=Ui,b.bi=function(i,t){Pi.REGISTERED_PROTOCOLS[i]=t},b.bj=function(i){delete Pi.REGISTERED_PROTOCOLS[i]},b.bk=function(i,t){const n={};for(let u=0;u<i.length;u++){const f=t&&t[i[u].id]||vf(i[u]);t&&(t[i[u].id]=f);let m=n[f];m||(m=n[f]=[]),m.push(i[u])}const o=[];for(const u in n)o.push(n[u]);return o},b.bl=_t,b.bm=$0,b.bn=Y0,b.bo=A0,b.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ln/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ei(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ei(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=i.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ei(P),i.canonical),o["text-size"].possiblyEvaluate(new Ei(k),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:k}=i.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ei(P),i.canonical),o["icon-size"].possiblyEvaluate(new Ei(k),i.canonical)]}const f=n.get("text-line-height")*un,m=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",y=n.get("text-keep-upright"),x=n.get("text-size");for(const P of i.bucket.features){const k=n.get("text-font").evaluate(P,{},i.canonical).join(","),E=x.evaluate(P,{},i.canonical),D=u.layoutTextSize.evaluate(P,{},i.canonical),F=u.layoutIconSize.evaluate(P,{},i.canonical),q={horizontal:{},vertical:void 0},Z=P.text;let J,se=[0,0];if(Z){const _e=Z.toString(),Ae=n.get("text-letter-spacing").evaluate(P,{},i.canonical)*un,Ze=Ry(_e)?Ae:0,ft=n.get("text-anchor").evaluate(P,{},i.canonical),Lt=ux(t,P,i.canonical);if(!Lt){const vt=n.get("text-radial-offset").evaluate(P,{},i.canonical);se=vt?cx(ft,[vt*un,__]):n.get("text-offset").evaluate(P,{},i.canonical).map(yt=>yt*un)}let ht=m?"center":n.get("text-justify").evaluate(P,{},i.canonical);const ot=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},i.canonical)*un:1/0,Tt=()=>{i.bucket.allowVerticalPlacement&&Lu(_e)&&(q.vertical=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,k,ot,f,ft,"left",Ze,se,b.ah.vertical,!0,D,E))};if(!m&&Lt){const vt=new Set;if(ht==="auto")for(let Re=0;Re<Lt.values.length;Re+=2)vt.add(v_(Lt.values[Re]));else vt.add(ht);let yt=!1;for(const Re of vt)if(!q.horizontal[Re])if(yt)q.horizontal[Re]=q.horizontal[0];else{const kt=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,k,ot,f,"center",Re,Ze,se,b.ah.horizontal,!1,D,E);kt&&(q.horizontal[Re]=kt,yt=kt.positionedLines.length===1)}Tt()}else{ht==="auto"&&(ht=v_(ft));const vt=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,k,ot,f,ft,ht,Ze,se,b.ah.horizontal,!1,D,E);vt&&(q.horizontal[ht]=vt),Tt(),Lu(_e)&&m&&y&&(q.vertical=jf(Z,i.glyphMap,i.glyphPositions,i.imagePositions,k,ot,f,ft,ht,Ze,se,b.ah.vertical,!1,D,E))}}let we=!1;if(P.icon&&P.icon.name){const _e=i.imageMap[P.icon.name];_e&&(J=h2(i.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},i.canonical),n.get("icon-anchor").evaluate(P,{},i.canonical)),we=!!_e.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=we:i.bucket.sdfIcons!==we&&De("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const he=dx(q.horizontal)||q.vertical;i.bucket.iconsInText=!!he&&he.iconsInText,(he||J)&&C2(i.bucket,P,q,J,i.imageMap,u,D,F,se,we,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},b.bq=n_,b.br=e_,b.bs=i_,b.bt=zo,b.bu=s_,b.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},b.bw=function(i,t,n,o,u){return l(this,void 0,void 0,function*(){if(pe())try{return yield ct(i,t,n,o,u)}catch{}return function(f,m,y,x,P){const k=f.width,E=f.height;at&&Mt||(at=new OffscreenCanvas(k,E),Mt=at.getContext("2d",{willReadFrequently:!0})),at.width=k,at.height=E,Mt.drawImage(f,0,0,k,E);const D=Mt.getImageData(m,y,x,P);return Mt.clearRect(0,0,k,E),D.data}(i,t,n,o,u)})},b.bx=K0,b.by=j,b.bz=U,b.c=yi,b.d=i=>l(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),b.e=$e,b.f=i=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ut})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(u):ut}),b.g=Fi,b.h=(i,t)=>Fn($e(i,{type:"json"}),t),b.i=Ue,b.j=mt,b.k=Ki,b.l=(i,t)=>Fn($e(i,{type:"arrayBuffer"}),t),b.m=Fn,b.n=function(i){return new s_(i).readFields(r2,[])},b.o=qu,b.p=k0,b.q=p,b.r=Dy,b.s=Xi,b.t=Mu,b.u=Us,b.v=be,b.w=De,b.x=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},b.y=Kn,b.z=Ei}),T("worker",["./shared"],function(b){class l{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,R){for(const Y of O){this._layerConfigs[Y.id]=Y;const de=this._layers[Y.id]=b.aA(Y);de._featureFilter=b.a7(de.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const W=b.bk(Object.values(this._layerConfigs),this.keyCache);for(const Y of W){const de=Y.map(Ce=>this._layers[Ce.id]),me=de[0];if(me.visibility==="none")continue;const xe=me.source||"";let le=this.familiesBySource[xe];le||(le=this.familiesBySource[xe]={});const Ee=me.sourceLayer||"_geojsonTileLayer";let Ne=le[Ee];Ne||(Ne=le[Ee]=[]),Ne.push(de)}}}class j{constructor(O){const R={},W=[];for(const xe in O){const le=O[xe],Ee=R[xe]={};for(const Ne in le){const Ce=le[+Ne];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;const it={x:0,y:0,w:Ce.bitmap.width+2,h:Ce.bitmap.height+2};W.push(it),Ee[Ne]={rect:it,metrics:Ce.metrics}}}const{w:Y,h:de}=b.p(W),me=new b.o({width:Y||1,height:de||1});for(const xe in O){const le=O[xe];for(const Ee in le){const Ne=le[+Ee];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ce=R[xe][Ee].rect;b.o.copy(Ne.bitmap,me,{x:0,y:0},{x:Ce.x+1,y:Ce.y+1},Ne.bitmap)}}this.image=me,this.positions=R}}b.bl("GlyphAtlas",j);class U{constructor(O){this.tileID=new b.S(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,R,W,Y){return b._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new b.a5;const de=new b.bm(Object.keys(O.layers).sort()),me=new b.bn(this.tileID,this.promoteId);me.bucketLayerIDs=[];const xe={},le={featureIndex:me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},Ee=R.familiesBySource[this.source];for(const Qt in Ee){const _i=O.layers[Qt];if(!_i)continue;_i.version===1&&b.w(`Vector tile source "${this.source}" layer "${Qt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bi=de.encode(Qt),pn=[];for(let bn=0;bn<_i.length;bn++){const Bn=_i.feature(bn),no=me.getId(Bn,Qt);pn.push({feature:Bn,id:no,index:bn,sourceLayerIndex:Bi})}for(const bn of Ee[Qt]){const Bn=bn[0];Bn.source!==this.source&&b.w(`layer.source = ${Bn.source} does not equal this.source = ${this.source}`),Bn.minzoom&&this.zoom<Math.floor(Bn.minzoom)||Bn.maxzoom&&this.zoom>=Bn.maxzoom||Bn.visibility!=="none"&&(K(bn,this.zoom,W),(xe[Bn.id]=Bn.createBucket({index:me.bucketLayerIDs.length,layers:bn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bi,sourceID:this.source})).populate(pn,le,this.tileID.canonical),me.bucketLayerIDs.push(bn.map(no=>no.id)))}}const Ne=b.aF(le.glyphDependencies,Qt=>Object.keys(Qt).map(Number));this.inFlightDependencies.forEach(Qt=>Qt==null?void 0:Qt.abort()),this.inFlightDependencies=[];let Ce=Promise.resolve({});if(Object.keys(Ne).length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),Ce=Y.sendAsync({type:"GG",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},Qt)}const it=Object.keys(le.iconDependencies);let At=Promise.resolve({});if(it.length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),At=Y.sendAsync({type:"GI",data:{icons:it,source:this.source,tileID:this.tileID,type:"icons"}},Qt)}const Dt=Object.keys(le.patternDependencies);let ci=Promise.resolve({});if(Dt.length){const Qt=new AbortController;this.inFlightDependencies.push(Qt),ci=Y.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Qt)}const[Xt,ui,ii]=yield Promise.all([Ce,At,ci]),on=new j(Xt),Zi=new b.bo(ui,ii);for(const Qt in xe){const _i=xe[Qt];_i instanceof b.a6?(K(_i.layers,this.zoom,W),b.bp({bucket:_i,glyphMap:Xt,glyphPositions:on.positions,imageMap:ui,imagePositions:Zi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):_i.hasPattern&&(_i instanceof b.bq||_i instanceof b.br||_i instanceof b.bs)&&(K(_i.layers,this.zoom,W),_i.addFeatures(le,this.tileID.canonical,Zi.patternPositions))}return this.status="done",{buckets:Object.values(xe).filter(Qt=>!Qt.isEmpty()),featureIndex:me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,imageAtlas:Zi,glyphMap:this.returnDependencies?Xt:null,iconMap:this.returnDependencies?ui:null,glyphPositions:this.returnDependencies?on.positions:null}})}}function K(re,O,R){const W=new b.z(O);for(const Y of re)Y.recalculate(W,R)}class B{constructor(O,R,W){this.actor=O,this.layerIndex=R,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,R){return b._(this,void 0,void 0,function*(){const W=yield b.l(O.request,R);try{return{vectorTile:new b.bt.VectorTile(new b.bu(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(Y){const de=new Uint8Array(W.data);let me=`Unable to parse the tile at ${O.request.url}, `;throw me+=de[0]===31&&de[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.message}`,new Error(me)}})}loadTile(O){return b._(this,void 0,void 0,function*(){const R=O.uid,W=!!(O&&O.request&&O.request.collectResourceTiming)&&new b.bv(O.request),Y=new U(O);this.loading[R]=Y;const de=new AbortController;Y.abort=de;try{const me=yield this.loadVectorTile(O,de);if(delete this.loading[R],!me)return null;const xe=me.rawData,le={};me.expires&&(le.expires=me.expires),me.cacheControl&&(le.cacheControl=me.cacheControl);const Ee={};if(W){const Ce=W.finish();Ce&&(Ee.resourceTiming=JSON.parse(JSON.stringify(Ce)))}Y.vectorTile=me.vectorTile;const Ne=Y.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[R]=Y,this.fetching[R]={rawTileData:xe,cacheControl:le,resourceTiming:Ee};try{const Ce=yield Ne;return b.e({rawTileData:xe.slice(0)},Ce,le,Ee)}finally{delete this.fetching[R]}}catch(me){throw delete this.loading[R],Y.status="done",this.loaded[R]=Y,me}})}reloadTile(O){return b._(this,void 0,void 0,function*(){const R=O.uid;if(!this.loaded||!this.loaded[R])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[R];if(W.showCollisionBoxes=O.showCollisionBoxes,W.status==="parsing"){const Y=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor);let de;if(this.fetching[R]){const{rawTileData:me,cacheControl:xe,resourceTiming:le}=this.fetching[R];delete this.fetching[R],de=b.e({rawTileData:me.slice(0)},Y,xe,le)}else de=Y;return de}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return b._(this,void 0,void 0,function*(){const R=this.loading,W=O.uid;R&&R[W]&&R[W].abort&&(R[W].abort.abort(),delete R[W])})}removeTile(O){return b._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class V{constructor(){this.loaded={}}loadTile(O){return b._(this,void 0,void 0,function*(){const{uid:R,encoding:W,rawImageData:Y,redFactor:de,greenFactor:me,blueFactor:xe,baseShift:le}=O,Ee=Y.width+2,Ne=Y.height+2,Ce=b.b(Y)?new b.R({width:Ee,height:Ne},yield b.bw(Y,-1,-1,Ee,Ne)):Y,it=new b.bx(R,Ce,W,de,me,xe,le);return this.loaded=this.loaded||{},this.loaded[R]=it,it})}removeTile(O){const R=this.loaded,W=O.uid;R&&R[W]&&delete R[W]}}function ne(re,O){if(re.length!==0){Q(re[0],O);for(var R=1;R<re.length;R++)Q(re[R],!O)}}function Q(re,O){for(var R=0,W=0,Y=0,de=re.length,me=de-1;Y<de;me=Y++){var xe=(re[Y][0]-re[me][0])*(re[me][1]+re[Y][1]),le=R+xe;W+=Math.abs(R)>=Math.abs(xe)?R-le+xe:xe-le+R,R=le}R+W>=0!=!!O&&re.reverse()}var ee=b.by(function re(O,R){var W,Y=O&&O.type;if(Y==="FeatureCollection")for(W=0;W<O.features.length;W++)re(O.features[W],R);else if(Y==="GeometryCollection")for(W=0;W<O.geometries.length;W++)re(O.geometries[W],R);else if(Y==="Feature")re(O.geometry,R);else if(Y==="Polygon")ne(O.coordinates,R);else if(Y==="MultiPolygon")for(W=0;W<O.coordinates.length;W++)ne(O.coordinates[W],R);return O});const ce=b.bt.VectorTileFeature.prototype.toGeoJSON;var ye={exports:{}},pe=b.bz,Ie=b.bt.VectorTileFeature,Oe=ze;function ze(re,O){this.options=O||{},this.features=re,this.length=re.length}function We(re,O){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=O||4096}ze.prototype.feature=function(re){return new We(this.features[re],this.options.extent)},We.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var O=0;O<re.length;O++){for(var R=re[O],W=[],Y=0;Y<R.length;Y++)W.push(new pe(R[Y][0],R[Y][1]));this.geometry.push(W)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,O=1/0,R=-1/0,W=1/0,Y=-1/0,de=0;de<re.length;de++)for(var me=re[de],xe=0;xe<me.length;xe++){var le=me[xe];O=Math.min(O,le.x),R=Math.max(R,le.x),W=Math.min(W,le.y),Y=Math.max(Y,le.y)}return[O,W,R,Y]},We.prototype.toGeoJSON=Ie.prototype.toGeoJSON;var $e=b.bA,xt=Oe;function He(re){var O=new $e;return function(R,W){for(var Y in R.layers)W.writeMessage(3,Ye,R.layers[Y])}(re,O),O.finish()}function Ye(re,O){var R;O.writeVarintField(15,re.version||1),O.writeStringField(1,re.name||""),O.writeVarintField(5,re.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<re.length;R++)W.feature=re.feature(R),O.writeMessage(2,Be,W);var Y=W.keys;for(R=0;R<Y.length;R++)O.writeStringField(3,Y[R]);var de=W.values;for(R=0;R<de.length;R++)O.writeMessage(4,et,de[R])}function Be(re,O){var R=re.feature;R.id!==void 0&&O.writeVarintField(1,R.id),O.writeMessage(2,Me,re),O.writeVarintField(3,R.type),O.writeMessage(4,Ue,R)}function Me(re,O){var R=re.feature,W=re.keys,Y=re.values,de=re.keycache,me=re.valuecache;for(var xe in R.properties){var le=R.properties[xe],Ee=de[xe];if(le!==null){Ee===void 0&&(W.push(xe),de[xe]=Ee=W.length-1),O.writeVarint(Ee);var Ne=typeof le;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(le=JSON.stringify(le));var Ce=Ne+":"+le,it=me[Ce];it===void 0&&(Y.push(le),me[Ce]=it=Y.length-1),O.writeVarint(it)}}}function De(re,O){return(O<<3)+(7&re)}function ke(re){return re<<1^re>>31}function Ue(re,O){for(var R=re.loadGeometry(),W=re.type,Y=0,de=0,me=R.length,xe=0;xe<me;xe++){var le=R[xe],Ee=1;W===1&&(Ee=le.length),O.writeVarint(De(1,Ee));for(var Ne=W===3?le.length-1:le.length,Ce=0;Ce<Ne;Ce++){Ce===1&&W!==1&&O.writeVarint(De(2,Ne-1));var it=le[Ce].x-Y,At=le[Ce].y-de;O.writeVarint(ke(it)),O.writeVarint(ke(At)),Y+=it,de+=At}W===3&&O.writeVarint(De(7,1))}}function et(re,O){var R=typeof re;R==="string"?O.writeStringField(1,re):R==="boolean"?O.writeBooleanField(7,re):R==="number"&&(re%1!=0?O.writeDoubleField(3,re):re<0?O.writeSVarintField(6,re):O.writeVarintField(5,re))}ye.exports=He,ye.exports.fromVectorTileJs=He,ye.exports.fromGeojsonVt=function(re,O){O=O||{};var R={};for(var W in re)R[W]=new xt(re[W].features,O),R[W].name=W,R[W].version=O.version,R[W].extent=O.extent;return He({layers:R})},ye.exports.GeoJSONWrapper=xt;var pt=b.by(ye.exports);const ut={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:re=>re},ct=Math.fround||(at=new Float32Array(1),re=>(at[0]=+re,at[0]));var at;const Mt=3,Yt=5,yi=6;class Pi{constructor(O){this.options=Object.assign(Object.create(ut),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:R,minZoom:W,maxZoom:Y}=this.options;R&&console.time("total time");const de=`prepare ${O.length} points`;R&&console.time(de),this.points=O;const me=[];for(let le=0;le<O.length;le++){const Ee=O[le];if(!Ee.geometry)continue;const[Ne,Ce]=Ee.geometry.coordinates,it=ct(Ui(Ne)),At=ct(Hi(Ce));me.push(it,At,1/0,le,-1,1),this.options.reduce&&me.push(0)}let xe=this.trees[Y+1]=this._createTree(me);R&&console.timeEnd(de);for(let le=Y;le>=W;le--){const Ee=+Date.now();xe=this.trees[le]=this._createTree(this._cluster(xe,le)),R&&console.log("z%d: %d clusters in %dms",le,xe.numItems,+Date.now()-Ee)}return R&&console.timeEnd("total time"),this}getClusters(O,R){let W=((O[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,O[1]));let de=O[2]===180?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)W=-180,de=180;else if(W>de){const Ce=this.getClusters([W,Y,180,me],R),it=this.getClusters([-180,Y,de,me],R);return Ce.concat(it)}const xe=this.trees[this._limitZoom(R)],le=xe.range(Ui(W),Hi(me),Ui(de),Hi(Y)),Ee=xe.data,Ne=[];for(const Ce of le){const it=this.stride*Ce;Ne.push(Ee[it+Yt]>1?Fi(Ee,it,this.clusterProps):this.points[Ee[it+Mt]])}return Ne}getChildren(O){const R=this._getOriginId(O),W=this._getOriginZoom(O),Y="No cluster with the specified id.",de=this.trees[W];if(!de)throw new Error(Y);const me=de.data;if(R*this.stride>=me.length)throw new Error(Y);const xe=this.options.radius/(this.options.extent*Math.pow(2,W-1)),le=de.within(me[R*this.stride],me[R*this.stride+1],xe),Ee=[];for(const Ne of le){const Ce=Ne*this.stride;me[Ce+4]===O&&Ee.push(me[Ce+Yt]>1?Fi(me,Ce,this.clusterProps):this.points[me[Ce+Mt]])}if(Ee.length===0)throw new Error(Y);return Ee}getLeaves(O,R,W){const Y=[];return this._appendLeaves(Y,O,R=R||10,W=W||0,0),Y}getTile(O,R,W){const Y=this.trees[this._limitZoom(O)],de=Math.pow(2,O),{extent:me,radius:xe}=this.options,le=xe/me,Ee=(W-le)/de,Ne=(W+1+le)/de,Ce={features:[]};return this._addTileFeatures(Y.range((R-le)/de,Ee,(R+1+le)/de,Ne),Y.data,R,W,de,Ce),R===0&&this._addTileFeatures(Y.range(1-le/de,Ee,1,Ne),Y.data,de,W,de,Ce),R===de-1&&this._addTileFeatures(Y.range(0,Ee,le/de,Ne),Y.data,-1,W,de,Ce),Ce.features.length?Ce:null}getClusterExpansionZoom(O){let R=this._getOriginZoom(O)-1;for(;R<=this.options.maxZoom;){const W=this.getChildren(O);if(R++,W.length!==1)break;O=W[0].properties.cluster_id}return R}_appendLeaves(O,R,W,Y,de){const me=this.getChildren(R);for(const xe of me){const le=xe.properties;if(le&&le.cluster?de+le.point_count<=Y?de+=le.point_count:de=this._appendLeaves(O,le.cluster_id,W,Y,de):de<Y?de++:O.push(xe),O.length===W)break}return de}_createTree(O){const R=new b.av(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<O.length;W+=this.stride)R.add(O[W],O[W+1]);return R.finish(),R.data=O,R}_addTileFeatures(O,R,W,Y,de,me){for(const xe of O){const le=xe*this.stride,Ee=R[le+Yt]>1;let Ne,Ce,it;if(Ee)Ne=sn(R,le,this.clusterProps),Ce=R[le],it=R[le+1];else{const ci=this.points[R[le+Mt]];Ne=ci.properties;const[Xt,ui]=ci.geometry.coordinates;Ce=Ui(Xt),it=Hi(ui)}const At={type:1,geometry:[[Math.round(this.options.extent*(Ce*de-W)),Math.round(this.options.extent*(it*de-Y))]],tags:Ne};let Dt;Dt=Ee||this.options.generateId?R[le+Mt]:this.points[R[le+Mt]].id,Dt!==void 0&&(At.id=Dt),me.features.push(At)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,R){const{radius:W,extent:Y,reduce:de,minPoints:me}=this.options,xe=W/(Y*Math.pow(2,R)),le=O.data,Ee=[],Ne=this.stride;for(let Ce=0;Ce<le.length;Ce+=Ne){if(le[Ce+2]<=R)continue;le[Ce+2]=R;const it=le[Ce],At=le[Ce+1],Dt=O.within(le[Ce],le[Ce+1],xe),ci=le[Ce+Yt];let Xt=ci;for(const ui of Dt){const ii=ui*Ne;le[ii+2]>R&&(Xt+=le[ii+Yt])}if(Xt>ci&&Xt>=me){let ui,ii=it*ci,on=At*ci,Zi=-1;const Qt=((Ce/Ne|0)<<5)+(R+1)+this.points.length;for(const _i of Dt){const Bi=_i*Ne;if(le[Bi+2]<=R)continue;le[Bi+2]=R;const pn=le[Bi+Yt];ii+=le[Bi]*pn,on+=le[Bi+1]*pn,le[Bi+4]=Qt,de&&(ui||(ui=this._map(le,Ce,!0),Zi=this.clusterProps.length,this.clusterProps.push(ui)),de(ui,this._map(le,Bi)))}le[Ce+4]=Qt,Ee.push(ii/Xt,on/Xt,1/0,Qt,-1,Xt),de&&Ee.push(Zi)}else{for(let ui=0;ui<Ne;ui++)Ee.push(le[Ce+ui]);if(Xt>1)for(const ui of Dt){const ii=ui*Ne;if(!(le[ii+2]<=R)){le[ii+2]=R;for(let on=0;on<Ne;on++)Ee.push(le[ii+on])}}}}return Ee}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,R,W){if(O[R+Yt]>1){const me=this.clusterProps[O[R+yi]];return W?Object.assign({},me):me}const Y=this.points[O[R+Mt]].properties,de=this.options.map(Y);return W&&de===Y?Object.assign({},de):de}}function Fi(re,O,R){return{type:"Feature",id:re[O+Mt],properties:sn(re,O,R),geometry:{type:"Point",coordinates:[(W=re[O],360*(W-.5)),Fn(re[O+1])]}};var W}function sn(re,O,R){const W=re[O+Yt],Y=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,de=re[O+yi],me=de===-1?{}:Object.assign({},R[de]);return Object.assign(me,{cluster:!0,cluster_id:re[O+Mt],point_count:W,point_count_abbreviated:Y})}function Ui(re){return re/360+.5}function Hi(re){const O=Math.sin(re*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function Fn(re){const O=(180-360*re)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function Xi(re,O,R,W){let Y=W;const de=O+(R-O>>1);let me,xe=R-O;const le=re[O],Ee=re[O+1],Ne=re[R],Ce=re[R+1];for(let it=O+3;it<R;it+=3){const At=xi(re[it],re[it+1],le,Ee,Ne,Ce);if(At>Y)me=it,Y=At;else if(At===Y){const Dt=Math.abs(it-de);Dt<xe&&(me=it,xe=Dt)}}Y>W&&(me-O>3&&Xi(re,O,me,W),re[me+2]=Y,R-me>3&&Xi(re,me,R,W))}function xi(re,O,R,W,Y,de){let me=Y-R,xe=de-W;if(me!==0||xe!==0){const le=((re-R)*me+(O-W)*xe)/(me*me+xe*xe);le>1?(R=Y,W=de):le>0&&(R+=me*le,W+=xe*le)}return me=re-R,xe=O-W,me*me+xe*xe}function cn(re,O,R,W){const Y={id:re??null,type:O,geometry:R,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(O==="Point"||O==="MultiPoint"||O==="LineString")Ki(Y,R);else if(O==="Polygon")Ki(Y,R[0]);else if(O==="MultiLineString")for(const de of R)Ki(Y,de);else if(O==="MultiPolygon")for(const de of R)Ki(Y,de[0]);return Y}function Ki(re,O){for(let R=0;R<O.length;R+=3)re.minX=Math.min(re.minX,O[R]),re.minY=Math.min(re.minY,O[R+1]),re.maxX=Math.max(re.maxX,O[R]),re.maxY=Math.max(re.maxY,O[R+1])}function mt(re,O,R,W){if(!O.geometry)return;const Y=O.geometry.coordinates;if(Y&&Y.length===0)return;const de=O.geometry.type,me=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2);let xe=[],le=O.id;if(R.promoteId?le=O.properties[R.promoteId]:R.generateId&&(le=W||0),de==="Point")Bt(Y,xe);else if(de==="MultiPoint")for(const Ee of Y)Bt(Ee,xe);else if(de==="LineString")be(Y,xe,me,!1);else if(de==="MultiLineString"){if(R.lineMetrics){for(const Ee of Y)xe=[],be(Ee,xe,me,!1),re.push(cn(le,"LineString",xe,O.properties));return}Ai(Y,xe,me,!1)}else if(de==="Polygon")Ai(Y,xe,me,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Ee of O.geometry.geometries)mt(re,{id:le,geometry:Ee,properties:O.properties},R,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ee of Y){const Ne=[];Ai(Ee,Ne,me,!0),xe.push(Ne)}}re.push(cn(le,de,xe,O.properties))}function Bt(re,O){O.push(In(re[0]),Ht(re[1]),0)}function be(re,O,R,W){let Y,de,me=0;for(let le=0;le<re.length;le++){const Ee=In(re[le][0]),Ne=Ht(re[le][1]);O.push(Ee,Ne,0),le>0&&(me+=W?(Y*Ne-Ee*de)/2:Math.sqrt(Math.pow(Ee-Y,2)+Math.pow(Ne-de,2))),Y=Ee,de=Ne}const xe=O.length-3;O[2]=1,Xi(O,0,xe,R),O[xe+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function Ai(re,O,R,W){for(let Y=0;Y<re.length;Y++){const de=[];be(re[Y],de,R,W),O.push(de)}}function In(re){return re/360+.5}function Ht(re){const O=Math.sin(re*Math.PI/180),R=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return R<0?0:R>1?1:R}function li(re,O,R,W,Y,de,me,xe){if(W/=O,de>=(R/=O)&&me<W)return re;if(me<R||de>=W)return null;const le=[];for(const Ee of re){const Ne=Ee.geometry;let Ce=Ee.type;const it=Y===0?Ee.minX:Ee.minY,At=Y===0?Ee.maxX:Ee.maxY;if(it>=R&&At<W){le.push(Ee);continue}if(At<R||it>=W)continue;let Dt=[];if(Ce==="Point"||Ce==="MultiPoint")sr(Ne,Dt,R,W,Y);else if(Ce==="LineString")_n(Ne,Dt,R,W,Y,!1,xe.lineMetrics);else if(Ce==="MultiLineString")Zr(Ne,Dt,R,W,Y,!1);else if(Ce==="Polygon")Zr(Ne,Dt,R,W,Y,!0);else if(Ce==="MultiPolygon")for(const ci of Ne){const Xt=[];Zr(ci,Xt,R,W,Y,!0),Xt.length&&Dt.push(Xt)}if(Dt.length){if(xe.lineMetrics&&Ce==="LineString"){for(const ci of Dt)le.push(cn(Ee.id,Ce,ci,Ee.tags));continue}Ce!=="LineString"&&Ce!=="MultiLineString"||(Dt.length===1?(Ce="LineString",Dt=Dt[0]):Ce="MultiLineString"),Ce!=="Point"&&Ce!=="MultiPoint"||(Ce=Dt.length===3?"Point":"MultiPoint"),le.push(cn(Ee.id,Ce,Dt,Ee.tags))}}return le.length?le:null}function sr(re,O,R,W,Y){for(let de=0;de<re.length;de+=3){const me=re[de+Y];me>=R&&me<=W&&dn(O,re[de],re[de+1],re[de+2])}}function _n(re,O,R,W,Y,de,me){let xe=Xn(re);const le=Y===0?us:Es;let Ee,Ne,Ce=re.start;for(let Xt=0;Xt<re.length-3;Xt+=3){const ui=re[Xt],ii=re[Xt+1],on=re[Xt+2],Zi=re[Xt+3],Qt=re[Xt+4],_i=Y===0?ui:ii,Bi=Y===0?Zi:Qt;let pn=!1;me&&(Ee=Math.sqrt(Math.pow(ui-Zi,2)+Math.pow(ii-Qt,2))),_i<R?Bi>R&&(Ne=le(xe,ui,ii,Zi,Qt,R),me&&(xe.start=Ce+Ee*Ne)):_i>W?Bi<W&&(Ne=le(xe,ui,ii,Zi,Qt,W),me&&(xe.start=Ce+Ee*Ne)):dn(xe,ui,ii,on),Bi<R&&_i>=R&&(Ne=le(xe,ui,ii,Zi,Qt,R),pn=!0),Bi>W&&_i<=W&&(Ne=le(xe,ui,ii,Zi,Qt,W),pn=!0),!de&&pn&&(me&&(xe.end=Ce+Ee*Ne),O.push(xe),xe=Xn(re)),me&&(Ce+=Ee)}let it=re.length-3;const At=re[it],Dt=re[it+1],ci=Y===0?At:Dt;ci>=R&&ci<=W&&dn(xe,At,Dt,re[it+2]),it=xe.length-3,de&&it>=3&&(xe[it]!==xe[0]||xe[it+1]!==xe[1])&&dn(xe,xe[0],xe[1],xe[2]),xe.length&&O.push(xe)}function Xn(re){const O=[];return O.size=re.size,O.start=re.start,O.end=re.end,O}function Zr(re,O,R,W,Y,de){for(const me of re)_n(me,O,R,W,Y,de,!1)}function dn(re,O,R,W){re.push(O,R,W)}function us(re,O,R,W,Y,de){const me=(de-O)/(W-O);return dn(re,de,R+(Y-R)*me,1),me}function Es(re,O,R,W,Y,de){const me=(de-R)/(Y-R);return dn(re,O+(W-O)*me,de,1),me}function Je(re,O){const R=[];for(let W=0;W<re.length;W++){const Y=re[W],de=Y.type;let me;if(de==="Point"||de==="MultiPoint"||de==="LineString")me=mr(Y.geometry,O);else if(de==="MultiLineString"||de==="Polygon"){me=[];for(const xe of Y.geometry)me.push(mr(xe,O))}else if(de==="MultiPolygon"){me=[];for(const xe of Y.geometry){const le=[];for(const Ee of xe)le.push(mr(Ee,O));me.push(le)}}R.push(cn(Y.id,de,me,Y.tags))}return R}function mr(re,O){const R=[];R.size=re.size,re.start!==void 0&&(R.start=re.start,R.end=re.end);for(let W=0;W<re.length;W+=3)R.push(re[W]+O,re[W+1],re[W+2]);return R}function vn(re,O){if(re.transformed)return re;const R=1<<re.z,W=re.x,Y=re.y;for(const de of re.features){const me=de.geometry,xe=de.type;if(de.geometry=[],xe===1)for(let le=0;le<me.length;le+=2)de.geometry.push(Pr(me[le],me[le+1],O,R,W,Y));else for(let le=0;le<me.length;le++){const Ee=[];for(let Ne=0;Ne<me[le].length;Ne+=2)Ee.push(Pr(me[le][Ne],me[le][Ne+1],O,R,W,Y));de.geometry.push(Ee)}}return re.transformed=!0,re}function Pr(re,O,R,W,Y,de){return[Math.round(R*(re*W-Y)),Math.round(R*(O*W-de))]}function Ir(re,O,R,W,Y){const de=O===Y.maxZoom?0:Y.tolerance/((1<<O)*Y.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:re.length,source:null,x:R,y:W,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xe of re)tt(me,xe,de,Y);return me}function tt(re,O,R,W){const Y=O.geometry,de=O.type,me=[];if(re.minX=Math.min(re.minX,O.minX),re.minY=Math.min(re.minY,O.minY),re.maxX=Math.max(re.maxX,O.maxX),re.maxY=Math.max(re.maxY,O.maxY),de==="Point"||de==="MultiPoint")for(let xe=0;xe<Y.length;xe+=3)me.push(Y[xe],Y[xe+1]),re.numPoints++,re.numSimplified++;else if(de==="LineString")$t(me,Y,re,R,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let xe=0;xe<Y.length;xe++)$t(me,Y[xe],re,R,de==="Polygon",xe===0);else if(de==="MultiPolygon")for(let xe=0;xe<Y.length;xe++){const le=Y[xe];for(let Ee=0;Ee<le.length;Ee++)$t(me,le[Ee],re,R,!0,Ee===0)}if(me.length){let xe=O.tags||null;if(de==="LineString"&&W.lineMetrics){xe={};for(const Ee in O.tags)xe[Ee]=O.tags[Ee];xe.mapbox_clip_start=Y.start/Y.size,xe.mapbox_clip_end=Y.end/Y.size}const le={geometry:me,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:xe};O.id!==null&&(le.id=O.id),re.features.push(le)}}function $t(re,O,R,W,Y,de){const me=W*W;if(W>0&&O.size<(Y?me:W))return void(R.numPoints+=O.length/3);const xe=[];for(let le=0;le<O.length;le+=3)(W===0||O[le+2]>me)&&(R.numSimplified++,xe.push(O[le],O[le+1])),R.numPoints++;Y&&function(le,Ee){let Ne=0;for(let Ce=0,it=le.length,At=it-2;Ce<it;At=Ce,Ce+=2)Ne+=(le[Ce]-le[At])*(le[Ce+1]+le[At+1]);if(Ne>0===Ee)for(let Ce=0,it=le.length;Ce<it/2;Ce+=2){const At=le[Ce],Dt=le[Ce+1];le[Ce]=le[it-2-Ce],le[Ce+1]=le[it-1-Ce],le[it-2-Ce]=At,le[it-1-Ce]=Dt}}(xe,de),re.push(xe)}const Ft={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Cn{constructor(O,R){const W=(R=this.options=function(de,me){for(const xe in me)de[xe]=me[xe];return de}(Object.create(Ft),R)).debug;if(W&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");let Y=function(de,me){const xe=[];if(de.type==="FeatureCollection")for(let le=0;le<de.features.length;le++)mt(xe,de.features[le],me,le);else mt(xe,de.type==="Feature"?de:{geometry:de},me);return xe}(O,R);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Y=function(de,me){const xe=me.buffer/me.extent;let le=de;const Ee=li(de,1,-1-xe,xe,0,-1,2,me),Ne=li(de,1,1-xe,2+xe,0,-1,2,me);return(Ee||Ne)&&(le=li(de,1,-xe,1+xe,0,-1,2,me)||[],Ee&&(le=Je(Ee,1).concat(le)),Ne&&(le=le.concat(Je(Ne,-1)))),le}(Y,R),Y.length&&this.splitTile(Y,0,0,0),W&&(Y.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(O,R,W,Y,de,me,xe){const le=[O,R,W,Y],Ee=this.options,Ne=Ee.debug;for(;le.length;){Y=le.pop(),W=le.pop(),R=le.pop(),O=le.pop();const Ce=1<<R,it=xn(R,W,Y);let At=this.tiles[it];if(!At&&(Ne>1&&console.time("creation"),At=this.tiles[it]=Ir(O,R,W,Y,Ee),this.tileCoords.push({z:R,x:W,y:Y}),Ne)){Ne>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,W,Y,At.numFeatures,At.numPoints,At.numSimplified),console.timeEnd("creation"));const pn=`z${R}`;this.stats[pn]=(this.stats[pn]||0)+1,this.total++}if(At.source=O,de==null){if(R===Ee.indexMaxZoom||At.numPoints<=Ee.indexMaxPoints)continue}else{if(R===Ee.maxZoom||R===de)continue;if(de!=null){const pn=de-R;if(W!==me>>pn||Y!==xe>>pn)continue}}if(At.source=null,O.length===0)continue;Ne>1&&console.time("clipping");const Dt=.5*Ee.buffer/Ee.extent,ci=.5-Dt,Xt=.5+Dt,ui=1+Dt;let ii=null,on=null,Zi=null,Qt=null,_i=li(O,Ce,W-Dt,W+Xt,0,At.minX,At.maxX,Ee),Bi=li(O,Ce,W+ci,W+ui,0,At.minX,At.maxX,Ee);O=null,_i&&(ii=li(_i,Ce,Y-Dt,Y+Xt,1,At.minY,At.maxY,Ee),on=li(_i,Ce,Y+ci,Y+ui,1,At.minY,At.maxY,Ee),_i=null),Bi&&(Zi=li(Bi,Ce,Y-Dt,Y+Xt,1,At.minY,At.maxY,Ee),Qt=li(Bi,Ce,Y+ci,Y+ui,1,At.minY,At.maxY,Ee),Bi=null),Ne>1&&console.timeEnd("clipping"),le.push(ii||[],R+1,2*W,2*Y),le.push(on||[],R+1,2*W,2*Y+1),le.push(Zi||[],R+1,2*W+1,2*Y),le.push(Qt||[],R+1,2*W+1,2*Y+1)}}getTile(O,R,W){O=+O,R=+R,W=+W;const Y=this.options,{extent:de,debug:me}=Y;if(O<0||O>24)return null;const xe=1<<O,le=xn(O,R=R+xe&xe-1,W);if(this.tiles[le])return vn(this.tiles[le],de);me>1&&console.log("drilling down to z%d-%d-%d",O,R,W);let Ee,Ne=O,Ce=R,it=W;for(;!Ee&&Ne>0;)Ne--,Ce>>=1,it>>=1,Ee=this.tiles[xn(Ne,Ce,it)];return Ee&&Ee.source?(me>1&&(console.log("found parent tile z%d-%d-%d",Ne,Ce,it),console.time("drilling down")),this.splitTile(Ee.source,Ne,Ce,it,O,R,W),me>1&&console.timeEnd("drilling down"),this.tiles[le]?vn(this.tiles[le],de):null):null}}function xn(re,O,R){return 32*((1<<re)*R+O)+re}function Nt(re,O){return O?re.properties[O]:re.id}function or(re,O){if(re==null)return!0;if(re.type==="Feature")return Nt(re,O)!=null;if(re.type==="FeatureCollection"){const R=new Set;for(const W of re.features){const Y=Nt(W,O);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Qr(re,O){const R=new Map;if(re!=null)if(re.type==="Feature")R.set(Nt(re,O),re);else for(const W of re.features)R.set(Nt(W,O),W);return R}class hs extends B{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,R){return b._(this,void 0,void 0,function*(){const W=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!Y)return null;const de=new class{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=b.X,this.length=xe.length,this._features=xe}feature(xe){return new class{constructor(le){this._feature=le,this.extent=b.X,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Ee of this._feature.geometry)le.push([new b.P(Ee[0],Ee[1])]);return le}{const le=[];for(const Ee of this._feature.geometry){const Ne=[];for(const Ce of Ee)Ne.push(new b.P(Ce[0],Ce[1]));le.push(Ne)}return le}}toGeoJSON(le,Ee,Ne){return ce.call(this,le,Ee,Ne)}}(this._features[xe])}}(Y.features);let me=pt(de);return me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),{vectorTile:de,rawData:me.buffer}})}loadData(O){return b._(this,void 0,void 0,function*(){var R;(R=this._pendingRequest)===null||R===void 0||R.abort();const W=!!(O&&O.request&&O.request.collectResourceTiming)&&new b.bv(O.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(O,this._pendingRequest),this._geoJSONIndex=O.cluster?new Pi(function({superclusterOptions:me,clusterProperties:xe}){if(!xe||!me)return me;const le={},Ee={},Ne={accumulated:null,zoom:0},Ce={properties:null},it=Object.keys(xe);for(const At of it){const[Dt,ci]=xe[At],Xt=b.bC(ci),ui=b.bC(typeof Dt=="string"?[Dt,["accumulated"],["get",At]]:Dt);le[At]=Xt.value,Ee[At]=ui.value}return me.map=At=>{Ce.properties=At;const Dt={};for(const ci of it)Dt[ci]=le[ci].evaluate(Ne,Ce);return Dt},me.reduce=(At,Dt)=>{Ce.properties=Dt;for(const ci of it)Ne.accumulated=At[ci],At[ci]=Ee[ci].evaluate(Ne,Ce)},me}(O)).load((yield this._pendingData).features):(Y=yield this._pendingData,new Cn(Y,O.geojsonVtOptions)),this.loaded={};const de={};if(W){const me=W.finish();me&&(de.resourceTiming={},de.resourceTiming[O.source]=JSON.parse(JSON.stringify(me)))}return de}catch(de){if(delete this._pendingRequest,b.bB(de))return{abandoned:!0};throw de}var Y})}getData(){return b._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(O){const R=this.loaded;return R&&R[O.uid]?super.reloadTile(O):this.loadTile(O)}loadAndProcessGeoJSON(O,R){return b._(this,void 0,void 0,function*(){let W=yield this.loadGeoJSON(O,R);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(ee(W,!0),O.filter){const Y=b.bC(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(me=>`${me.key}: ${me.message}`).join(", "));W={type:"FeatureCollection",features:W.features.filter(me=>Y.value.evaluate({zoom:0},me))}}return W})}loadGeoJSON(O,R){return b._(this,void 0,void 0,function*(){const{promoteId:W}=O;if(O.request){const Y=yield b.h(O.request,R);return this._dataUpdateable=or(Y.data,W)?Qr(Y.data,W):void 0,Y.data}if(typeof O.data=="string")try{const Y=JSON.parse(O.data);return this._dataUpdateable=or(Y,W)?Qr(Y,W):void 0,Y}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function(Y,de,me){var xe,le,Ee,Ne;if(de.removeAll&&Y.clear(),de.remove)for(const Ce of de.remove)Y.delete(Ce);if(de.add)for(const Ce of de.add){const it=Nt(Ce,me);it!=null&&Y.set(it,Ce)}if(de.update)for(const Ce of de.update){let it=Y.get(Ce.id);if(it==null)continue;const At=!Ce.removeAllProperties&&(((xe=Ce.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((le=Ce.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((Ce.newGeometry||Ce.removeAllProperties||At)&&(it=Object.assign({},it),Y.set(Ce.id,it),At&&(it.properties=Object.assign({},it.properties))),Ce.newGeometry&&(it.geometry=Ce.newGeometry),Ce.removeAllProperties)it.properties={};else if(((Ee=Ce.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const Dt of Ce.removeProperties)Object.prototype.hasOwnProperty.call(it.properties,Dt)&&delete it.properties[Dt];if(((Ne=Ce.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:Dt,value:ci}of Ce.addOrUpdateProperties)it.properties[Dt]=ci}}(this._dataUpdateable,O.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return b._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class Gr{constructor(O){this.self=O,this.actor=new b.F(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(R,W)=>{if(this.externalWorkerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.externalWorkerSourceTypes[R]=W},this.self.addProtocol=b.bi,this.self.removeProtocol=b.bj,this.self.registerRTLTextPlugin=R=>{if(b.bD.isParsed())throw new Error("RTL text plugin already registered.");b.bD.setMethods(R)},this.actor.registerMessageHandler("LDT",(R,W)=>this._getDEMWorkerSource(R,W.source).loadTile(W)),this.actor.registerMessageHandler("RDT",(R,W)=>b._(this,void 0,void 0,function*(){this._getDEMWorkerSource(R,W.source).removeTile(W)})),this.actor.registerMessageHandler("GCEZ",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterExpansionZoom(W)})),this.actor.registerMessageHandler("GCC",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterChildren(W)})),this.actor.registerMessageHandler("GCL",(R,W)=>b._(this,void 0,void 0,function*(){return this._getWorkerSource(R,W.type,W.source).getClusterLeaves(W)})),this.actor.registerMessageHandler("LD",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadData(W)),this.actor.registerMessageHandler("GD",(R,W)=>this._getWorkerSource(R,W.type,W.source).getData()),this.actor.registerMessageHandler("LT",(R,W)=>this._getWorkerSource(R,W.type,W.source).loadTile(W)),this.actor.registerMessageHandler("RT",(R,W)=>this._getWorkerSource(R,W.type,W.source).reloadTile(W)),this.actor.registerMessageHandler("AT",(R,W)=>this._getWorkerSource(R,W.type,W.source).abortTile(W)),this.actor.registerMessageHandler("RMT",(R,W)=>this._getWorkerSource(R,W.type,W.source).removeTile(W)),this.actor.registerMessageHandler("RS",(R,W)=>b._(this,void 0,void 0,function*(){if(!this.workerSources[R]||!this.workerSources[R][W.type]||!this.workerSources[R][W.type][W.source])return;const Y=this.workerSources[R][W.type][W.source];delete this.workerSources[R][W.type][W.source],Y.removeSource!==void 0&&Y.removeSource(W)})),this.actor.registerMessageHandler("RM",R=>b._(this,void 0,void 0,function*(){delete this.layerIndexes[R],delete this.availableImages[R],delete this.workerSources[R],delete this.demWorkerSources[R]})),this.actor.registerMessageHandler("SR",(R,W)=>b._(this,void 0,void 0,function*(){this.referrer=W})),this.actor.registerMessageHandler("SRPS",(R,W)=>this._syncRTLPluginState(R,W)),this.actor.registerMessageHandler("IS",(R,W)=>b._(this,void 0,void 0,function*(){this.self.importScripts(W)})),this.actor.registerMessageHandler("SI",(R,W)=>this._setImages(R,W)),this.actor.registerMessageHandler("UL",(R,W)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(R).update(W.layers,W.removedIds)})),this.actor.registerMessageHandler("SL",(R,W)=>b._(this,void 0,void 0,function*(){this._getLayerIndex(R).replace(W)}))}_setImages(O,R){return b._(this,void 0,void 0,function*(){this.availableImages[O]=R;for(const W in this.workerSources[O]){const Y=this.workerSources[O][W];for(const de in Y)Y[de].availableImages=R}})}_syncRTLPluginState(O,R){return b._(this,void 0,void 0,function*(){if(b.bD.isParsed())return b.bD.getState();if(R.pluginStatus!=="loading")return b.bD.setState(R),R;const W=R.pluginURL;if(this.self.importScripts(W),b.bD.isParsed()){const Y={pluginStatus:"loaded",pluginURL:W};return b.bD.setState(Y),Y}throw b.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${W}`)})}_getAvailableImages(O){let R=this.availableImages[O];return R||(R=[]),R}_getLayerIndex(O){let R=this.layerIndexes[O];return R||(R=this.layerIndexes[O]=new l),R}_getWorkerSource(O,R,W){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][R]||(this.workerSources[O][R]={}),!this.workerSources[O][R][W]){const Y={sendAsync:(de,me)=>(de.targetMapId=O,this.actor.sendAsync(de,me))};switch(R){case"vector":this.workerSources[O][R][W]=new B(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][R][W]=new hs(Y,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][R][W]=new this.externalWorkerSourceTypes[R](Y,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][R][W]}_getDEMWorkerSource(O,R){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][R]||(this.demWorkerSources[O][R]=new V),this.demWorkerSources[O][R]}}return b.i(self)&&(self.worker=new Gr(self)),Gr}),T("index",["exports","./shared"],function(b,l){var j="4.7.1";let U,K;const B={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((e,r)=>{const a=requestAnimationFrame(e);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(a),r(l.c())})}),getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,r.drawImage(p,0,0,p.width,p.height),r},resolveURL:p=>(U||(U=document.createElement("a")),U.href=p,U.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(K==null&&(K=matchMedia("(prefers-reduced-motion: reduce)")),K.matches)}};class V{static testProp(e){if(!V.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in V.docStyle)return e[r];return e[0]}static create(e,r,a){const c=window.document.createElement(e);return r!==void 0&&(c.className=r),a&&a.appendChild(c),c}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){V.docStyle&&V.selectProp&&(V.userSelect=V.docStyle[V.selectProp],V.docStyle[V.selectProp]="none")}static enableDrag(){V.docStyle&&V.selectProp&&(V.docStyle[V.selectProp]=V.userSelect)}static setTransform(e,r){e.style[V.transformProp]=r}static addEventListener(e,r,a,c={}){e.addEventListener(r,a,"passive"in c?c:c.capture)}static removeEventListener(e,r,a,c={}){e.removeEventListener(r,a,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",V.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",V.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",V.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,a){const c=r.boundingClientRect;return new l.P((a.clientX-c.left)/r.x-e.clientLeft,(a.clientY-c.top)/r.y-e.clientTop)}static mousePos(e,r){const a=V.getScale(e);return V.getPoint(e,a,r)}static touchPos(e,r){const a=[],c=V.getScale(e);for(let d=0;d<r.length;d++)a.push(V.getPoint(e,c,r[d]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}V.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,V.selectProp=V.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),V.transformProp=V.testProp(["transform","WebkitTransform"]);const ne={supported:!1,testSupport:function(p){!ce&&ee&&(ye?pe(p):Q=p)}};let Q,ee,ce=!1,ye=!1;function pe(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,ee),p.isContextLost())return;ne.supported=!0}catch{}p.deleteTexture(e),ce=!0}var Ie;typeof document<"u"&&(ee=document.createElement("img"),ee.onload=()=>{Q&&pe(Q),Q=null,ye=!0},ee.onerror=()=>{ce=!0,Q=null},ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,r,a,c;p.resetRequestQueue=()=>{e=[],r=0,a=0,c={}},p.addThrottleControl=S=>{const A=a++;return c[A]=S,A},p.removeThrottleControl=S=>{delete c[S],_()},p.getImage=(S,A,M=!0)=>new Promise((z,N)=>{ne.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),l.e(S,{type:"image"}),e.push({abortController:A,requestParameters:S,supportImageRefresh:M,state:"queued",onError:G=>{N(G)},onSuccess:G=>{z(G)}}),_()});const d=S=>l._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:A,supportImageRefresh:M,onError:z,onSuccess:N,abortController:G}=S,X=M===!1&&!l.i(self)&&!l.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((ae,ue)=>ae&&ue==="accept",!0));r++;const te=X?w(A,G):l.m(A,G);try{const ae=yield te;delete S.abortController,S.state="completed",ae.data instanceof HTMLImageElement||l.b(ae.data)?N(ae):ae.data&&N({data:yield(oe=ae.data,typeof createImageBitmap=="function"?l.d(oe):l.f(oe)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete S.abortController,z(ae)}finally{r--,_()}var oe}),_=()=>{const S=(()=>{for(const A of Object.keys(c))if(c[A]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=r;A<S&&e.length>0;A++){const M=e.shift();M.abortController.signal.aborted?A--:d(M)}},w=(S,A)=>new Promise((M,z)=>{const N=new Image,G=S.url,X=S.credentials;X&&X==="include"?N.crossOrigin="use-credentials":(X&&X==="same-origin"||!l.s(G))&&(N.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{N.src="",z(l.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,M({data:N})},N.onerror=()=>{N.onerror=N.onload=null,A.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=G})}(Ie||(Ie={})),Ie.resetRequestQueue();class Oe{constructor(e){this._transformRequestFn=e}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ze(p){var e=new l.A(3);return e[0]=p[0],e[1]=p[1],e[2]=p[2],e}var We,$e=function(p,e,r){return p[0]=e[0]-r[0],p[1]=e[1]-r[1],p[2]=e[2]-r[2],p};We=new l.A(3),l.A!=Float32Array&&(We[0]=0,We[1]=0,We[2]=0);var xt=function(p){var e=p[0],r=p[1];return e*e+r*r};function He(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const r=[];for(const{id:a,url:c}of p){const d=`${a}${c}`;r.indexOf(d)===-1&&(r.push(d),e.push({id:a,url:c}))}}return e}function Ye(p,e,r){const a=p.split("?");return a[0]+=`${e}${r}`,a.join("?")}(function(){var p=new l.A(2);l.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Be{constructor(e,r,a,c){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,a){const{width:c,height:d}=e,_=!(this.size&&this.size[0]===c&&this.size[1]===d||a),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(r&&r.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[c,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,c,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:A,y:M}=a||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||l.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,A,M,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,A,M,c,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,r,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function Me(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class De extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:a}of this.requestors)a(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const a=r.spriteData;r.data=new l.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let a=!0;const c=r.data||r.spriteData;return this._validateStretch(r.stretchX,c&&c.width)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(r.stretchY,c&&c.height)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(r.content,r)||(this.fire(new l.j(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,r){if(!e)return!0;let a=0;for(const c of e){if(c[0]<a||c[1]<c[0]||r<c[1])return!1;a=c[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const a=r.spriteData,c=a&&a.width||r.data.width,d=a&&a.height||r.data.height;return!(e[0]<0||c<e[0]||e[1]<0||d<e[1]||e[2]<0||c<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,a=!0){const c=this.getImage(e);if(a&&(c.data.width!==r.data.width||c.data.height!==r.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=c.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,a)=>{let c=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(c=!1);this.isLoaded()||c?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const a of e){let c=this.getImage(a);c||(this.fire(new l.k("styleimagemissing",{id:a})),c=this.getImage(a)),c?r[a]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:l.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],a=this.getImage(e);if(!a)return null;if(r&&r.position.version===a.version)return r.position;if(r)r.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new l.I(c,a);this.patterns[e]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Be(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:r,h:a}=l.p(e),c=this.atlasImage;c.resize({width:r||1,height:a||1});for(const d in this.patterns){const{bin:_}=this.patterns[d],w=_.x+1,S=_.y+1,A=this.getImage(d).data,M=A.width,z=A.height;l.R.copy(A,c,{x:0,y:0},{x:w,y:S},{width:M,height:z}),l.R.copy(A,c,{x:0,y:z-1},{x:w,y:S-1},{width:M,height:1}),l.R.copy(A,c,{x:0,y:0},{x:w,y:S+z},{width:M,height:1}),l.R.copy(A,c,{x:M-1,y:0},{x:w-1,y:S},{width:1,height:z}),l.R.copy(A,c,{x:0,y:0},{x:w+M,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const a=this.getImage(r);a||l.w(`Image with ID: "${r}" was not found`),Me(a)&&this.updateImage(r,a)}}}const ke=1e20;function Ue(p,e,r,a,c,d,_,w,S){for(let A=e;A<e+a;A++)et(p,r*d+A,d,c,_,w,S);for(let A=r;A<r+c;A++)et(p,A*d+e,1,a,_,w,S)}function et(p,e,r,a,c,d,_){d[0]=0,_[0]=-ke,_[1]=ke,c[0]=p[e];for(let w=1,S=0,A=0;w<a;w++){c[w]=p[e+w*r];const M=w*w;do{const z=d[S];A=(c[w]-c[z]+M-z*z)/(w-z)/2}while(A<=_[S]&&--S>-1);S++,d[S]=w,_[S]=A,_[S+1]=ke}for(let w=0,S=0;w<a;w++){for(;_[S+1]<w;)S++;const A=d[S],M=w-A;p[e+w*r]=c[A]+M*M}}class pt{constructor(e,r){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,function*(){const r=[];for(const d in e)for(const _ of e[d])r.push(this._getAndCacheGlyphsPromise(d,_));const a=yield Promise.all(r),c={};for(const{stack:d,id:_,glyph:w}of a)c[d]||(c[d]={}),c[d][_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return c})}_getAndCacheGlyphsPromise(e,r){return l._(this,void 0,void 0,function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=a.glyphs[r];if(c!==void 0)return{stack:e,id:r,glyph:c};if(c=this._tinySDF(a,e,r),c)return a.glyphs[r]=c,{stack:e,id:r,glyph:c};const d=Math.floor(r/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[d])return{stack:e,id:r,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[d]){const w=pt.loadGlyphRange(e,d,this.url,this.requestManager);a.requests[d]=w}const _=yield a.requests[d];for(const w in _)this._doesCharSupportLocalGlyph(+w)||(a.glyphs[+w]=_[+w]);return a.ranges[d]=!0,{stack:e,id:r,glyph:_[r]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,r,a){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let d=e.tinySDF;if(!d){let w="400";/bold/i.test(r)?w="900":/medium/i.test(r)?w="500":/light/i.test(r)&&(w="200"),d=e.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:w})}const _=d.draw(String.fromCharCode(a));return{id:a,bitmap:new l.o({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(p,e,r,a){return l._(this,void 0,void 0,function*(){const c=256*e,d=c+255,_=a.transformRequest(r.replace("{fontstack}",p).replace("{range}",`${c}-${d}`),"Glyphs"),w=yield l.l(_,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${d}`);const S={};for(const A of l.n(w.data))S[A.id]=A;return S})},pt.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const w=this.size=p+4*e,S=this._createCanvas(w),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${_} ${d} ${p}px ${c}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(p),_=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),S=Math.min(this.size-this.buffer,_+Math.ceil(a)),A=w+2*this.buffer,M=S+2*this.buffer,z=Math.max(A*M,0),N=new Uint8ClampedArray(z),G={data:N,width:A,height:M,glyphWidth:w,glyphHeight:S,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return G;const{ctx:X,buffer:te,gridInner:oe,gridOuter:ae}=this;X.clearRect(te,te,w,S),X.fillText(p,te,te+_);const ue=X.getImageData(te,te,w,S);ae.fill(ke,0,z),oe.fill(0,0,z);for(let $=0;$<S;$++)for(let fe=0;fe<w;fe++){const ge=ue.data[4*($*w+fe)+3]/255;if(ge===0)continue;const Se=($+te)*A+fe+te;if(ge===1)ae[Se]=0,oe[Se]=ke;else{const Fe=.5-ge;ae[Se]=Fe>0?Fe*Fe:0,oe[Se]=Fe<0?Fe*Fe:0}}Ue(ae,0,0,A,M,A,this.f,this.v,this.z),Ue(oe,te,te,w,S,A,this.f,this.v,this.z);for(let $=0;$<z;$++){const fe=Math.sqrt(ae[$])-Math.sqrt(oe[$]);N[$]=Math.round(255-255*(fe/this.radius+this.cutoff))}return G}};class ut{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,r){return l.x(e.expression.evaluate(r))}interpolate(e,r,a){return{x:l.y.number(e.x,r.x,a),y:l.y.number(e.y,r.y,a),z:l.y.number(e.z,r.z,a)}}}let ct;class at extends l.E{constructor(e){super(),ct=ct||new l.q({anchor:new l.D(l.v.light.anchor),position:new ut,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(l.r,e,r))for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,a){return(!a||a.validate!==!1)&&l.t(this,e.call(l.u,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Mt=new l.q({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class Yt extends l.E{constructor(e){super(),this._transitionable=new l.T(Mt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.z(0))}setSky(e,r={}){if(!this._validate(l.B,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,a={}){return(a==null?void 0:a.validate)!==!1&&l.t(this,e.call(l.u,l.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class yi{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const a=e.join(",")+String(r);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,r)),this.dashEntry[a]}getDashRanges(e,r,a){const c=[];let d=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,w=!0;c.push({left:d,right:_,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let A=1;A<e.length;A++){w=!w;const M=e[A];d=S*a,S+=M,_=S*a,c.push({left:d,right:_,isDash:w,zeroLength:M===0})}return c}addRoundDash(e,r,a){const c=r/2;for(let d=-a;d<=a;d++){const _=this.width*(this.nextRow+a+d);let w=0,S=e[w];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++w]);const M=Math.abs(A-S.left),z=Math.abs(A-S.right),N=Math.min(M,z);let G;const X=d/a*(c+1);if(S.isDash){const te=c-Math.abs(X);G=Math.sqrt(N*N+te*te)}else G=c-Math.sqrt(N*N+X*X);this.data[_+A]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],A=e[w+1];S.zeroLength?e.splice(w,1):A&&A.isDash===S.isDash&&(A.left=S.left,e.splice(w,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const c=this.width*this.nextRow;let d=0,_=e[d];for(let w=0;w<this.width;w++){w/_.right>1&&(_=e[++d]);const S=Math.abs(w-_.left),A=Math.abs(w-_.right),M=Math.min(S,A);this.data[c+w]=Math.max(0,Math.min(255,(_.isDash?M:-M)+128))}}addDash(e,r){const a=r?7:0,c=2*a+1;if(this.nextRow+c>this.height)return l.w("LineAtlas out of space"),null;let d=0;for(let w=0;w<e.length;w++)d+=e[w];if(d!==0){const w=this.width/d,S=this.getDashRanges(e,this.width,w);r?this.addRoundDash(S,w,a):this.addRegularDash(S)}const _={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:d};return this.nextRow+=c,this.dirty=!0,_}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const Pi="maplibre_preloaded_worker_pool";class Fi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Fi.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pi]}numActive(){return Object.keys(this.active).length}}const sn=Math.floor(B.hardwareConcurrency/2);let Ui,Hi;function Fn(){return Ui||(Ui=new Fi),Ui}Fi.workerCount=l.C(globalThis)?Math.max(Math.min(sn,3),1):1;class Xi{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const a=this.workerPool.acquire(r);for(let c=0;c<a.length;c++){const d=new l.F(a[c],r);d.name=`Worker ${c}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const a=[];for(const c of this.actors)a.push(c.sendAsync({type:e,data:r}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const a of this.actors)a.registerMessageHandler(e,r)}}function xi(){return Hi||(Hi=new Xi(Fn(),l.G),Hi.registerMessageHandler("GR",(p,e,r)=>l.m(e,r))),Hi}function cn(p,e){const r=l.H();return l.J(r,r,[1,1,0]),l.K(r,r,[.5*p.width,.5*p.height,1]),l.L(r,r,p.calculatePosMatrix(e.toUnwrapped()))}function Ki(p,e,r,a,c,d){const _=function(z,N,G){if(z)for(const X of z){const te=N[X];if(te&&te.source===G&&te.type==="fill-extrusion")return!0}else for(const X in N){const te=N[X];if(te.source===G&&te.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,p.id),w=d.maxPitchScaleFactor(),S=p.tilesIn(a,w,_);S.sort(mt);const A=[];for(const z of S)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(e,r,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,c,d,w,cn(p.transform,z.tileID))});const M=function(z){const N={},G={};for(const X of z){const te=X.queryResults,oe=X.wrappedTileID,ae=G[oe]=G[oe]||{};for(const ue in te){const $=te[ue],fe=ae[ue]=ae[ue]||{},ge=N[ue]=N[ue]||[];for(const Se of $)fe[Se.featureIndex]||(fe[Se.featureIndex]=!0,ge.push(Se))}}return N}(A);for(const z in M)M[z].forEach(N=>{const G=N.feature,X=p.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=X});return M}function mt(p,e){const r=p.tileID,a=e.tileID;return r.overscaledZ-a.overscaledZ||r.canonical.y-a.canonical.y||r.wrap-a.wrap||r.canonical.x-a.canonical.x}function Bt(p,e,r){return l._(this,void 0,void 0,function*(){let a=p;if(p.url?a=(yield l.h(e.transformRequest(p.url,"Source"),r)).data:yield B.frameAsync(r),!a)return null;const c=l.M(l.e(a,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(c.vectorLayerIds=a.vector_layers.map(d=>d.id)),c})}class be{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.N?new l.N(e.lng,e.lat):l.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.N?new l.N(e.lng,e.lat):l.N.convert(e),this}extend(e){const r=this._sw,a=this._ne;let c,d;if(e instanceof l.N)c=e,d=e;else{if(!(e instanceof be))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(be.convert(e)):this.extend(l.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.N.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return r||a?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),a.lng=Math.max(d.lng,a.lng),a.lat=Math.max(d.lat,a.lat)):(this._sw=new l.N(c.lng,c.lat),this._ne=new l.N(d.lng,d.lat)),this}getCenter(){return new l.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.N(this.getWest(),this.getNorth())}getSouthEast(){return new l.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=l.N.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return e instanceof be?e:e&&new be(e)}static fromLngLat(e,r=0){const a=360*r/40075017,c=a/Math.cos(Math.PI/180*e.lat);return new be(new l.N(e.lng-c,e.lat-a),new l.N(e.lng+c,e.lat+a))}adjustAntiMeridian(){const e=new l.N(this._sw.lng,this._sw.lat),r=new l.N(this._ne.lng,this._ne.lat);return new be(e,e.lng>r.lng?new l.N(r.lng+360,r.lat):r)}}class Ai{constructor(e,r,a){this.bounds=be.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),a=Math.floor(l.O(this.bounds.getWest())*r),c=Math.floor(l.Q(this.bounds.getNorth())*r),d=Math.ceil(l.O(this.bounds.getEast())*r),_=Math.ceil(l.Q(this.bounds.getSouth())*r);return e.x>=a&&e.x<d&&e.y>=c&&e.y<_}}class In extends l.E{constructor(e,r,a,c){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.M(r,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new Ai(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,_)=>{e.reloadPromise={resolve:d,reject:_}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:c,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ht extends l.E{constructor(e,r,a,c){super(),this.id=e,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},r),l.e(this,l.M(r,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Bt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(l.e(this,e),e.bounds&&(this.tileBounds=new Ai(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield Ie.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&a.cacheControl&&a.expires&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const c=this.map.painter.context,d=c.gl,_=a.data;e.texture=this.map.painter.getTileTexture(_.width),e.texture?e.texture.update(_,{useMipmap:!0}):(e.texture=new Be(c,_,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class li extends Ht{constructor(e,r,a,c){super(e,r,a,c),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield Ie.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const d=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const _=l.b(d)&&l.U()?d:yield this.readImageNow(d),w={type:this.type,uid:e.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.V()){const r=e.width+2,a=e.height+2;try{return new l.R({width:r,height:a},yield l.W(e,-1,-1,r,a))}catch{}}return B.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,a=Math.pow(2,r.z),c=(r.x-1+a)%a,d=r.x===0?e.wrap-1:e.wrap,_=(r.x+1+a)%a,w=r.x+1===a?e.wrap+1:e.wrap,S={};return S[new l.S(e.overscaledZ,d,r.z,c,r.y).key]={backfilled:!1},S[new l.S(e.overscaledZ,w,r.z,_,r.y).key]={backfilled:!1},r.y>0&&(S[new l.S(e.overscaledZ,d,r.z,c,r.y-1).key]={backfilled:!1},S[new l.S(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new l.S(e.overscaledZ,w,r.z,_,r.y-1).key]={backfilled:!1}),r.y+1<a&&(S[new l.S(e.overscaledZ,d,r.z,c,r.y+1).key]={backfilled:!1},S[new l.S(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new l.S(e.overscaledZ,w,r.z,_,r.y+1).key]={backfilled:!1}),S}unloadTile(e){return l._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class sr extends l.E{constructor(e,r,a,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=a.getActor(),this.setEventedParent(c),this._data=r.data,this._options=l.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const d=l.X/this.tileSize;r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*d,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*d,extent:l.X,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:l.X,radius:(r.clusterRadius||50)*d,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return l._(this,void 0,void 0,function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:a}})}_updateWorkerData(e){return l._(this,void 0,void 0,function*(){const r=l.e({type:this.type},this.workerOptions);e?r.dataDiff=e:typeof this._data=="string"?(r.request=this.map._requestManager.transformRequest(B.resolveURL(this._data),"Source"),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const a=yield this.actor.sendAsync({type:"LD",data:r});if(this._pendingLoads--,this._removed||a.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let c=null;a.resourceTiming&&a.resourceTiming[this.id]&&(c=a.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&l.e(d,{resourceTiming:c}),this.fire(new l.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(a){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(a))}})}loaded(){return this._pendingLoads===0}loadTile(e){return l._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:r,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,r==="RT")})}abortTile(e){return l._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return l._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var _n=l.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Xn extends l.E{constructor(e,r,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=r}load(e){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield Ie.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new l.j(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(l.Z.fromLngLat);this.tileID=function(c){let d=1/0,_=1/0,w=-1/0,S=-1/0;for(const N of c)d=Math.min(d,N.x),_=Math.min(_,N.y),w=Math.max(w,N.x),S=Math.max(S,N.y);const A=Math.max(w-d,S-_),M=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,M);return new l.a1(M,Math.floor((d+w)/2*z),Math.floor((_+S)/2*z))}(r),this.minzoom=this.maxzoom=this.tileID.z;const a=r.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new l.$,this._boundsArray.emplaceBack(a[0].x,a[0].y,0,0),this._boundsArray.emplaceBack(a[1].x,a[1].y,l.X,0),this._boundsArray.emplaceBack(a[3].x,a[3].y,0,l.X),this._boundsArray.emplaceBack(a[2].x,a[2].y,l.X,l.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Be(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Zr extends Xn{constructor(e,r,a,c){super(e,r,a,c),this.roundZoom=!0,this.type="video",this.options=r}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield l.a3(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new l.j(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new l.j(new l.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new Be(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,a=!0)}a&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class dn extends Xn{constructor(e,r,a,c){super(e,r,a,c),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(_=>typeof _!="number"))||this.fire(new l.j(new l.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a2(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new l.j(new l.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,a=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,_n.members)),this.boundsSegments||(this.boundsSegments=l.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Be(r,this.canvas,a.RGBA,{premultiply:!0});let c=!1;for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const us={},Es=p=>{switch(p){case"geojson":return sr;case"image":return Xn;case"raster":return Ht;case"raster-dem":return li;case"vector":return In;case"video":return Zr;case"canvas":return dn}return us[p]},Je="RTLPluginLoaded";class mr extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,function*(r,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=B.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Je))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let vn=null;function Pr(){return vn||(vn=new mr),vn}class Ir{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a4(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const r=e+this.timeAdded;r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const _={};if(!d)return _;for(const w of c){const S=w.layerIds.map(A=>d.getLayer(A)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>S.filter(M=>M.id===A)[0]));for(const A of S)_[A.id]=w}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof l.a6){if(this.hasSymbolBuckets=!0,!a)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof l.a6&&d.hasRTLText){this.hasRTLText=!0,Pr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Be(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Be(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,c,d,_,w,S,A,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:_,tileSize:this.tileSize,pixelPosMatrix:M,transform:S,params:w,queryPadding:this.queryPadding*A},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),d=r&&r.sourceLayer?r.sourceLayer:"",_=c._geojsonTileLayer||c[d];if(!_)return;const w=l.a7(r&&r.filter),{z:S,x:A,y:M}=this.tileID.canonical,z={z:S,x:A,y:M};for(let N=0;N<_.length;N++){const G=_.feature(N);if(w.needGeometry){const oe=l.a8(G,!0);if(!w.filter(new l.z(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!w.filter(new l.z(this.tileID.overscaledZ),G))continue;const X=a.getId(G,d),te=new l.a9(G,S,A,M,X);te.tile=z,e.push(te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=l.aa(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const d=this.expirationTime-r;d?this.expirationTime=a+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!r.style.hasLayer(c))continue;const d=this.buckets[c],_=d.layers[0].sourceLayer||"_geojsonTileLayer",w=a[_],S=e[_];if(!w||!S||Object.keys(S).length===0)continue;d.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=r&&r.style&&r.style.getLayer(c);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=B.now()+e}setDependencies(e,r){const a={};for(const c of r)a[c]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const c=this.dependencies[a];if(c){for(const d of r)if(c[d])return!0}}return!1}}class tt{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:r,timeout:void 0};if(a!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},a)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,c=r===void 0?0:this.data[a].indexOf(r),d=this.data[a][c];return this.data[a].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(d.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const c of this.data[a])e(c.value)||r.push(c);for(const a of r)this.remove(a.value.tileID,a)}}class $t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},l.e(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])a[d]||(this.deletedStates[e][c][d]=null)}else for(const d in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),c=l.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const _ in d)delete c[_]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),l.e(this.state[c][_],this.stateChanges[c][_]),d[_]=this.state[c][_];a[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const _ in this.state[c])d[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const w of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][w];d[_]=this.state[c][_]}a[c]=a[c]||{},l.e(a[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in e)e[c].setFeatureState(a,r)}}class Ft extends l.E{constructor(e,r,a){super(),this.id=e,this.dispatcher=a,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,d,_,w)=>{const S=new(Es(d.type))(c,d,_,w);if(S.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${S.id}`);return S})(e,r,a,this),this._tiles={},this._cache=new tt(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,a){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,a)}catch(c){e.state="errored",c.status!==404?this._source.fire(new l.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Cn).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&r.push(this._tiles[a]);return e?r.sort((a,c)=>{const d=a.tileID,_=c.tileID,w=new l.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),S=new l.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-_.overscaledZ||S.y-w.y||S.x-w.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(Cn).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,r){return l._(this,void 0,void 0,function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),yield this._loadTile(a,e,r))})}_tileLoaded(e,r,a){e.timeAdded=B.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const d=r[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const _=this.getTileByID(d);a(e,_),a(_,e)}}function a(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let _=d.tileID.canonical.x-c.tileID.canonical.x;const w=d.tileID.canonical.y-c.tileID.canonical.y,S=Math.pow(2,c.tileID.canonical.z),A=d.tileID.key;_===0&&w===0||Math.abs(w)>1||(Math.abs(_)>1&&(Math.abs(_+S)===1?_+=S:Math.abs(_-S)===1&&(_-=S)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,_,w),c.neighboringTiles&&c.neighboringTiles[A]&&(c.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,c){for(const d in this._tiles){let _=this._tiles[d];if(c[d]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>a)continue;let w=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const A=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[A.key],_&&_.hasData()&&(w=A)}let S=w;for(;S.overscaledZ>r;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){c[w.key]=w;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const c=e.scaledTo(a),d=this._getLoadedTile(c);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(r*a*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),a[d.tileID.key]=d}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,r,a,c,d,_){const w={},S={},A=Object.keys(e),M=B.now();for(const z of A){const N=e[z],G=this._tiles[z];if(!G||G.fadeEndTime!==0&&G.fadeEndTime<=M)continue;const X=this.findLoadedParent(N,r),te=this.findLoadedSibling(N),oe=X||te||null;oe&&(this._addTile(oe.tileID),w[oe.tileID.key]=oe.tileID),S[z]=N}this._retainLoadedChildren(S,c,a,e);for(const z in w)e[z]||(this._coveredTiles[z]=!0,e[z]=w[z]);if(_){const z={},N={};for(const G of d)this._tiles[G.key].hasData()?z[G.key]=G:N[G.key]=G;for(const G in N){const X=N[G].children(this._source.maxzoom);this._tiles[X[0].key]&&this._tiles[X[1].key]&&this._tiles[X[2].key]&&this._tiles[X[3].key]&&(z[X[0].key]=e[X[0].key]=X[0],z[X[1].key]=e[X[1].key]=X[1],z[X[2].key]=e[X[2].key]=X[2],z[X[3].key]=e[X[3].key]=X[3],delete N[G])}for(const G in N){const X=N[G],te=this.findLoadedParent(X,this._source.minzoom),oe=this.findLoadedSibling(X),ae=te||oe||null;if(ae){z[ae.tileID.key]=e[ae.tileID.key]=ae.tileID;for(const ue in z)z[ue].isChildOf(ae.tileID)&&delete z[ue]}}for(const G in this._tiles)z[G]||(this._coveredTiles[G]=!0)}}update(e,r){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new l.S(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(a=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r}),this._source.hasTile&&(a=a.filter(M=>this._source.hasTile(M)))):a=[];const c=e.coveringZoomLevel(this._source),d=Math.max(c-Ft.maxOverzooming,this._source.minzoom),_=Math.max(c+Ft.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of a)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);M[N.key]=N;const G=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[G.key]=G}a=a.concat(Object.values(M))}const w=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(a,c);xn(this._source.type)&&this._updateCoveredAndRetainedTiles(S,d,_,c,a,r);for(const M in S)this._tiles[M].clearFadeHold();const A=l.ab(this._tiles,S);for(const M of A){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var a;const c={},d={},_=Math.max(r-Ft.maxOverzooming,this._source.minzoom),w=Math.max(r+Ft.maxUnderzooming,this._source.minzoom),S={};for(const A of e){const M=this._addTile(A);c[A.key]=A,M.hasData()||r<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,r,w,c);for(const A of e){let M=this._tiles[A.key];if(M.hasData())continue;if(r+1>this._source.maxzoom){const N=A.children(this._source.maxzoom)[0],G=this.getTile(N);if(G&&G.hasData()){c[N.key]=N;continue}}else{const N=A.children(this._source.maxzoom);if(c[N[0].key]&&c[N[1].key]&&c[N[2].key]&&c[N[3].key])continue}let z=M.wasRequested();for(let N=A.overscaledZ-1;N>=_;--N){const G=A.scaledTo(N);if(d[G.key])break;if(d[G.key]=!0,M=this.getTile(G),!M&&z&&(M=this._addTile(G)),M){const X=M.hasData();if((X||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||z)&&(c[G.key]=G),z=M.wasRequested(),X)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}r.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(d),a)break;c=d}for(const d of r)this._loadedParentTiles[d]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const r=this._tiles[e].tileID,a=this._getLoadedTile(r);this._loadedSiblingTiles[r.key]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=r;return r||(r=new Ir(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,a||this._source.fire(new l.k("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){const r=e.sourceDataType;e.dataType==="source"&&r==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&r==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,a){const c=[],d=this.transform;if(!d)return c;const _=a?d.getCameraQueryGeometry(e):e,w=e.map(X=>d.pointCoordinate(X,this.terrain)),S=_.map(X=>d.pointCoordinate(X,this.terrain)),A=this.getIds();let M=1/0,z=1/0,N=-1/0,G=-1/0;for(const X of S)M=Math.min(M,X.x),z=Math.min(z,X.y),N=Math.max(N,X.x),G=Math.max(G,X.y);for(let X=0;X<A.length;X++){const te=this._tiles[A[X]];if(te.holdingForFade())continue;const oe=te.tileID,ae=Math.pow(2,d.zoom-te.tileID.overscaledZ),ue=r*te.queryPadding*l.X/te.tileSize/ae,$=[oe.getTilePoint(new l.Z(M,z)),oe.getTilePoint(new l.Z(N,G))];if($[0].x-ue<l.X&&$[0].y-ue<l.X&&$[1].x+ue>=0&&$[1].y+ue>=0){const fe=w.map(Se=>oe.getTilePoint(Se)),ge=S.map(Se=>oe.getTilePoint(Se));c.push({tile:te,tileID:oe,queryGeometry:fe,cameraQueryGeometry:ge,scale:ae})}}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(xn(this._source.type)){const e=B.now();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const c=this._tiles[e];c&&c.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}}function Cn(p,e){const r=Math.abs(2*p.wrap)-+(p.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||a-r||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function xn(p){return p==="raster"||p==="image"||p==="video"}Ft.maxOverzooming=10,Ft.maxUnderzooming=3;class Nt{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ac(e,0,1);let r=1,a=this._distances[r];const c=e*this.paddedLength+this.padding;for(;a<c&&r<this._distances.length;)a=this._distances[++r];const d=r-1,_=this._distances[d],w=a-_,S=w>0?(c-_)/w:0;return this.points[d].mult(1-S).add(this.points[r].mult(S))}}function or(p,e){let r=!0;return p==="always"||p!=="never"&&e!=="never"||(r=!1),r}class Qr{constructor(e,r,a){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(r/a);for(let _=0;_<this.xCellCount*this.yCellCount;_++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,a,c,d){this._forEachCell(r,a,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(e,r,a,c){this._forEachCell(r-c,a-c,r+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(a),this.circles.push(c)}_insertBoxCell(e,r,a,c,d,_){this.boxCells[d].push(_)}_insertCircleCell(e,r,a,c,d,_){this.circleCells[d].push(_)}_query(e,r,a,c,d,_,w){if(a<0||e>this.width||c<0||r>this.height)return[];const S=[];if(e<=0&&r<=0&&this.width<=a&&this.height<=c){if(d)return[{key:null,x1:e,y1:r,x2:a,y2:c}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const M=this.circles[3*A],z=this.circles[3*A+1],N=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:M-N,y1:z-N,x2:M+N,y2:z+N})}}else this._forEachCell(e,r,a,c,this._queryCell,S,{hitTest:d,overlapMode:_,seenUids:{box:{},circle:{}}},w);return S}query(e,r,a,c){return this._query(e,r,a,c,!1,null)}hitTest(e,r,a,c,d,_){return this._query(e,r,a,c,!0,d,_).length>0}hitTestCircle(e,r,a,c,d){const _=e-a,w=e+a,S=r-a,A=r+a;if(w<0||_>this.width||A<0||S>this.height)return!1;const M=[];return this._forEachCell(_,S,w,A,this._queryCellCircle,M,{hitTest:!0,overlapMode:c,circle:{x:e,y:r,radius:a},seenUids:{box:{},circle:{}}},d),M.length>0}_queryCell(e,r,a,c,d,_,w,S){const{seenUids:A,hitTest:M,overlapMode:z}=w,N=this.boxCells[d];if(N!==null){const X=this.bboxes;for(const te of N)if(!A.box[te]){A.box[te]=!0;const oe=4*te,ae=this.boxKeys[te];if(e<=X[oe+2]&&r<=X[oe+3]&&a>=X[oe+0]&&c>=X[oe+1]&&(!S||S(ae))&&(!M||!or(z,ae.overlapMode))&&(_.push({key:ae,x1:X[oe],y1:X[oe+1],x2:X[oe+2],y2:X[oe+3]}),M))return!0}}const G=this.circleCells[d];if(G!==null){const X=this.circles;for(const te of G)if(!A.circle[te]){A.circle[te]=!0;const oe=3*te,ae=this.circleKeys[te];if(this._circleAndRectCollide(X[oe],X[oe+1],X[oe+2],e,r,a,c)&&(!S||S(ae))&&(!M||!or(z,ae.overlapMode))){const ue=X[oe],$=X[oe+1],fe=X[oe+2];if(_.push({key:ae,x1:ue-fe,y1:$-fe,x2:ue+fe,y2:$+fe}),M)return!0}}}return!1}_queryCellCircle(e,r,a,c,d,_,w,S){const{circle:A,seenUids:M,overlapMode:z}=w,N=this.boxCells[d];if(N!==null){const X=this.bboxes;for(const te of N)if(!M.box[te]){M.box[te]=!0;const oe=4*te,ae=this.boxKeys[te];if(this._circleAndRectCollide(A.x,A.y,A.radius,X[oe+0],X[oe+1],X[oe+2],X[oe+3])&&(!S||S(ae))&&!or(z,ae.overlapMode))return _.push(!0),!0}}const G=this.circleCells[d];if(G!==null){const X=this.circles;for(const te of G)if(!M.circle[te]){M.circle[te]=!0;const oe=3*te,ae=this.circleKeys[te];if(this._circlesCollide(X[oe],X[oe+1],X[oe+2],A.x,A.y,A.radius)&&(!S||S(ae))&&!or(z,ae.overlapMode))return _.push(!0),!0}}}_forEachCell(e,r,a,c,d,_,w,S){const A=this._convertToXCellCoord(e),M=this._convertToYCellCoord(r),z=this._convertToXCellCoord(a),N=this._convertToYCellCoord(c);for(let G=A;G<=z;G++)for(let X=M;X<=N;X++)if(d.call(this,e,r,a,c,this.xCellCount*X+G,_,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,a,c,d,_){const w=c-e,S=d-r,A=a+_;return A*A>w*w+S*S}_circleAndRectCollide(e,r,a,c,d,_,w){const S=(_-c)/2,A=Math.abs(e-(c+S));if(A>S+a)return!1;const M=(w-d)/2,z=Math.abs(r-(d+M));if(z>M+a)return!1;if(A<=S||z<=M)return!0;const N=A-S,G=z-M;return N*N+G*G<=a*a}}function hs(p,e,r,a,c){const d=l.H();return e?(l.K(d,d,[1/c,1/c,1]),r||l.ad(d,d,a.angle)):l.L(d,a.labelPlaneMatrix,p),d}function Gr(p,e,r,a,c){if(e){const d=l.ae(p);return l.K(d,d,[c,c,1]),r||l.ad(d,d,-a.angle),d}return a.glCoordMatrix}function re(p,e,r,a){let c;a?(c=[p,e,a(p,e),1],l.af(c,c,r)):(c=[p,e,0,1],ci(c,c,r));const d=c[3];return{point:new l.P(c[0]/d,c[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function O(p,e){return .5+p/e*.5}function R(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function W(p,e,r,a,c,d,_,w,S,A,M,z,N,G,X){const te=a?p.textSizeData:p.iconSizeData,oe=l.ag(te,r.transform.zoom),ae=[256/r.width*2+1,256/r.height*2+1],ue=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ue.clear();const $=p.lineVertexArray,fe=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,ge=r.transform.width/r.transform.height;let Se=!1;for(let Fe=0;Fe<fe.length;Fe++){const Ke=fe.get(Fe);if(Ke.hidden||Ke.writingMode===l.ah.vertical&&!Se){Dt(Ke.numGlyphs,ue);continue}Se=!1;const lt=re(Ke.anchorX,Ke.anchorY,e,X);if(!R(lt.point,ae)){Dt(Ke.numGlyphs,ue);continue}const gt=O(r.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),rt=l.ai(te,oe,Ke),nt=_?rt/gt:rt*gt,wt={getElevation:X,labelPlaneMatrix:c,lineVertexArray:$,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:A,tileAnchorPoint:new l.P(Ke.anchorX,Ke.anchorY),unwrappedTileID:M,width:z,height:N,translation:G},Zt=me(wt,Ke,nt,!1,w,e,d,p.glyphOffsetArray,ue,ge,S);Se=Zt.useVertical,(Zt.notEnoughRoom||Se||Zt.needsFlipping&&me(wt,Ke,nt,!0,w,e,d,p.glyphOffsetArray,ue,ge,S).notEnoughRoom)&&Dt(Ke.numGlyphs,ue)}a?p.text.dynamicLayoutVertexBuffer.updateData(ue):p.icon.dynamicLayoutVertexBuffer.updateData(ue)}function Y(p,e,r,a,c,d,_,w){const S=d.glyphStartIndex+d.numGlyphs,A=d.lineStartIndex,M=d.lineStartIndex+d.lineLength,z=e.getoffsetX(d.glyphStartIndex),N=e.getoffsetX(S-1),G=it(p*z,r,a,c,d.segment,A,M,w,_);if(!G)return null;const X=it(p*N,r,a,c,d.segment,A,M,w,_);return X?w.projectionCache.anyProjectionOccluded?null:{first:G,last:X}:null}function de(p,e,r,a){return p===l.ah.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*a?{useVertical:!0}:(p===l.ah.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function me(p,e,r,a,c,d,_,w,S,A,M){const z=r/24,N=e.lineOffsetX*z,G=e.lineOffsetY*z;let X;if(e.numGlyphs>1){const te=e.glyphStartIndex+e.numGlyphs,oe=e.lineStartIndex,ae=e.lineStartIndex+e.lineLength,ue=Y(z,w,N,G,a,e,M,p);if(!ue)return{notEnoughRoom:!0};const $=re(ue.first.point.x,ue.first.point.y,_,p.getElevation).point,fe=re(ue.last.point.x,ue.last.point.y,_,p.getElevation).point;if(c&&!a){const ge=de(e.writingMode,$,fe,A);if(ge)return ge}X=[ue.first];for(let ge=e.glyphStartIndex+1;ge<te-1;ge++)X.push(it(z*w.getoffsetX(ge),N,G,a,e.segment,oe,ae,p,M));X.push(ue.last)}else{if(c&&!a){const oe=re(p.tileAnchorPoint.x,p.tileAnchorPoint.y,d,p.getElevation).point,ae=e.lineStartIndex+e.segment+1,ue=new l.P(p.lineVertexArray.getx(ae),p.lineVertexArray.gety(ae)),$=re(ue.x,ue.y,d,p.getElevation),fe=$.signedDistanceFromCamera>0?$.point:function(Se,Fe,Ke,lt,gt,rt){return xe(Se,Fe,Ke,1,gt,rt)}(p.tileAnchorPoint,ue,oe,0,d,p),ge=de(e.writingMode,oe,fe,A);if(ge)return ge}const te=it(z*w.getoffsetX(e.glyphStartIndex),N,G,a,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,p,M);if(!te||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};X=[te]}for(const te of X)l.aj(S,te.point,te.angle);return{}}function xe(p,e,r,a,c,d){const _=p.add(p.sub(e)._unit()),w=c!==void 0?re(_.x,_.y,c,d.getElevation).point:Ee(_.x,_.y,d).point,S=r.sub(w);return r.add(S._mult(a/S.mag()))}function le(p,e,r){const a=e.projectionCache;if(a.projections[p])return a.projections[p];const c=new l.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=Ee(c.x,c.y,e);if(d.signedDistanceFromCamera>0)return a.projections[p]=d.point,a.anyProjectionOccluded=a.anyProjectionOccluded||d.isOccluded,d.point;const _=p-r.direction;return function(w,S,A,M,z){return xe(w,S,A,M,void 0,z)}(r.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),c,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function Ee(p,e,r){const a=p+r.translation[0],c=e+r.translation[1];let d;return!r.pitchWithMap&&r.projection.useSpecialProjectionForSymbols?(d=r.projection.projectTileCoordinates(a,c,r.unwrappedTileID,r.getElevation),d.point.x=(.5*d.point.x+.5)*r.width,d.point.y=(.5*-d.point.y+.5)*r.height):(d=re(a,c,r.labelPlaneMatrix,r.getElevation),d.isOccluded=!1),d}function Ne(p,e,r){return p._unit()._perp()._mult(e*r)}function Ce(p,e,r,a,c,d,_,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const A=r.add(e);if(p+S.direction<a||p+S.direction>=c)return w.projectionCache.offsets[p]=A,A;const M=le(p+S.direction,w,S),z=Ne(M.sub(r),_,S.direction),N=r.add(z),G=M.add(z);return w.projectionCache.offsets[p]=l.ak(d,A,N,G)||A,w.projectionCache.offsets[p]}function it(p,e,r,a,c,d,_,w,S){const A=a?p-e:p+e;let M=A>0?1:-1,z=0;a&&(M*=-1,z=Math.PI),M<0&&(z+=Math.PI);let N,G=M>0?d+c:d+c+1;w.projectionCache.cachedAnchorPoint?N=w.projectionCache.cachedAnchorPoint:(N=Ee(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=N);let X,te,oe=N,ae=N,ue=0,$=0;const fe=Math.abs(A),ge=[];let Se;for(;ue+$<=fe;){if(G+=M,G<d||G>=_)return null;ue+=$,ae=oe,te=X;const lt={absOffsetX:fe,direction:M,distanceFromAnchor:ue,previousVertex:ae};if(oe=le(G,w,lt),r===0)ge.push(ae),Se=oe.sub(ae);else{let gt;const rt=oe.sub(ae);gt=rt.mag()===0?Ne(le(G+M,w,lt).sub(oe),r,M):Ne(rt,r,M),te||(te=ae.add(gt)),X=Ce(G,gt,oe,d,_,te,r,w,lt),ge.push(te),Se=X.sub(te)}$=Se.mag()}const Fe=Se._mult((fe-ue)/$)._add(te||ae),Ke=z+Math.atan2(oe.y-ae.y,oe.x-ae.x);return ge.push(Fe),{point:Fe,angle:S?Ke:0,path:ge}}const At=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Dt(p,e){for(let r=0;r<p;r++){const a=e.length;e.resize(a+4),e.float32.set(At,3*a)}}function ci(p,e,r){const a=e[0],c=e[1];return p[0]=r[0]*a+r[4]*c+r[12],p[1]=r[1]*a+r[5]*c+r[13],p[3]=r[3]*a+r[7]*c+r[15],p}const Xt=100;class ui{constructor(e,r,a=new Qr(e.width+200,e.height+200,25),c=new Qr(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=r,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Xt,this.screenBottomBoundary=e.height+Xt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,a,c,d,_,w,S,A,M,z){const N=e.anchorPointX+S[0],G=e.anchorPointY+S[1],X=this.projectAndGetPerspectiveRatio(c,N,G,d,M),te=a*X.perspectiveRatio;let oe;if(_||w)oe=this._projectCollisionBox(e,te,c,d,_,w,S,X,M,z);else{const ge=X.point.x+(z?z.x*te:0),Se=X.point.y+(z?z.y*te:0);oe={allPointsOccluded:!1,box:[ge+e.x1*te,Se+e.y1*te,ge+e.x2*te,Se+e.y2*te]}}const[ae,ue,$,fe]=oe.box;return this.mapProjection.useSpecialProjectionForSymbols&&(_?oe.allPointsOccluded:this.mapProjection.isOccluded(N,G,d))||X.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ae,ue,$,fe)||r!=="always"&&this.grid.hitTest(ae,ue,$,fe,r,A)?{box:[ae,ue,$,fe],placeable:!1,offscreen:!1}:{box:[ae,ue,$,fe],placeable:!0,offscreen:this.isOffscreen(ae,ue,$,fe)}}placeCollisionCircles(e,r,a,c,d,_,w,S,A,M,z,N,G,X,te,oe){const ae=[],ue=new l.P(r.anchorX,r.anchorY),$=this.getPerspectiveRatio(_,ue.x,ue.y,w,oe),fe=(z?d/$:d*$)/l.ap,ge={getElevation:oe,labelPlaneMatrix:S,lineVertexArray:a,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ue,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:te},Se=Y(fe,c,r.lineOffsetX*fe,r.lineOffsetY*fe,!1,r,!1,ge);let Fe=!1,Ke=!1,lt=!0;if(Se){const gt=.5*G*$+X,rt=new l.P(-100,-100),nt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new Nt,Zt=Se.first,st=Se.last;let dt=[];for(let Jt=Zt.path.length-1;Jt>=1;Jt--)dt.push(Zt.path[Jt]);for(let Jt=1;Jt<st.path.length;Jt++)dt.push(st.path[Jt]);const jt=2.5*gt;if(A){const Jt=this.projectPathToScreenSpace(dt,ge,A);dt=Jt.some(ni=>ni.signedDistanceFromCamera<=0)?[]:Jt.map(ni=>ni.point)}let Mi=[];if(dt.length>0){const Jt=dt[0].clone(),ni=dt[0].clone();for(let zi=1;zi<dt.length;zi++)Jt.x=Math.min(Jt.x,dt[zi].x),Jt.y=Math.min(Jt.y,dt[zi].y),ni.x=Math.max(ni.x,dt[zi].x),ni.y=Math.max(ni.y,dt[zi].y);Mi=Jt.x>=rt.x&&ni.x<=nt.x&&Jt.y>=rt.y&&ni.y<=nt.y?[dt]:ni.x<rt.x||Jt.x>nt.x||ni.y<rt.y||Jt.y>nt.y?[]:l.al([dt],rt.x,rt.y,nt.x,nt.y)}for(const Jt of Mi){wt.reset(Jt,.25*gt);let ni=0;ni=wt.length<=.5*gt?1:Math.ceil(wt.paddedLength/jt)+1;for(let zi=0;zi<ni;zi++){const An=zi/Math.max(ni-1,1),zr=wt.lerp(An),Di=zr.x+Xt,Jn=zr.y+Xt;ae.push(Di,Jn,gt,0);const Nn=Di-gt,En=Jn-gt,Vn=Di+gt,Kr=Jn+gt;if(lt=lt&&this.isOffscreen(Nn,En,Vn,Kr),Ke=Ke||this.isInsideGrid(Nn,En,Vn,Kr),e!=="always"&&this.grid.hitTestCircle(Di,Jn,gt,e,N)&&(Fe=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Fe}}}}return{circles:!M&&Fe||!Ke||$<this.perspectiveRatioCutoff?[]:ae,offscreen:lt,collisionDetected:Fe}}projectPathToScreenSpace(e,r,a){return e.map(c=>re(c.x,c.y,a,r.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let a=1/0,c=1/0,d=-1/0,_=-1/0;for(const M of e){const z=new l.P(M.x+Xt,M.y+Xt);a=Math.min(a,z.x),c=Math.min(c,z.y),d=Math.max(d,z.x),_=Math.max(_,z.y),r.push(z)}const w=this.grid.query(a,c,d,_).concat(this.ignoredGrid.query(a,c,d,_)),S={},A={};for(const M of w){const z=M.key;if(S[z.bucketInstanceId]===void 0&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const N=[new l.P(M.x1,M.y1),new l.P(M.x2,M.y1),new l.P(M.x2,M.y2),new l.P(M.x1,M.y2)];l.am(r,N)&&(S[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(e,r,a,c,d,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,a,c,d,_){const w=a?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:d,collisionGroupID:_,overlapMode:r};for(let A=0;A<e.length;A+=4)w.insertCircle(S,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,r,a,c,d){let _;d?(_=[r,a,d(r,a),1],l.af(_,_,e)):(_=[r,a,0,1],ci(_,_,e));const w=_[3];return{point:new l.P((_[0]/w+1)/2*this.transform.width+Xt,(-_[1]/w+1)/2*this.transform.height+Xt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,r,a,c,d){const _=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(r,a,c,d):re(r,a,e,d);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,r,a,c){return a<Xt||e>=this.screenRightBoundary||c<Xt||r>this.screenBottomBoundary}isInsideGrid(e,r,a,c){return a>=0&&e<this.gridRightBoundary&&c>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=l.an([]);return l.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,a,c,d,_,w,S,A,M){let z=new l.P(1,0),N=new l.P(0,1);const G=new l.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(_&&!d){const lt=this.projectAndGetPerspectiveRatio(a,G.x+1,G.y,c,A).point.sub(S.point).unit(),gt=Math.atan(lt.y/lt.x)+(lt.x<0?Math.PI:0),rt=Math.sin(gt),nt=Math.cos(gt);z=new l.P(nt,rt),N=new l.P(-rt,nt)}else if(!_&&d){const lt=-this.transform.angle,gt=Math.sin(lt),rt=Math.cos(lt);z=new l.P(rt,gt),N=new l.P(-gt,rt)}let X=S.point,te=r;if(d){X=G;const lt=this.transform.zoom-Math.floor(this.transform.zoom);te=Math.pow(2,-lt),te*=this.mapProjection.getPitchedTextCorrection(this.transform,G,c),M||(te*=l.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}M&&(X=X.add(z.mult(M.x*te)).add(N.mult(M.y*te)));const oe=e.x1*te,ae=e.x2*te,ue=(oe+ae)/2,$=e.y1*te,fe=e.y2*te,ge=($+fe)/2,Se=[{offsetX:oe,offsetY:$},{offsetX:ue,offsetY:$},{offsetX:ae,offsetY:$},{offsetX:ae,offsetY:ge},{offsetX:ae,offsetY:fe},{offsetX:ue,offsetY:fe},{offsetX:oe,offsetY:fe},{offsetX:oe,offsetY:ge}];let Fe=[];for(const{offsetX:lt,offsetY:gt}of Se)Fe.push(new l.P(X.x+z.x*lt+N.x*gt,X.y+z.y*lt+N.y*gt));let Ke=!1;if(d){const lt=Fe.map(gt=>this.projectAndGetPerspectiveRatio(a,gt.x,gt.y,c,A));Ke=lt.some(gt=>!gt.isOccluded),Fe=lt.map(gt=>gt.point)}else Ke=!0;return{box:l.ao(Fe),allPointsOccluded:!Ke}}}function ii(p,e,r){return e*(l.X/(p.tileSize*Math.pow(2,r-p.tileID.overscaledZ)))}class on{constructor(e,r,a,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class Zi{constructor(e,r,a,c,d){this.text=new on(e?e.text:null,r,a,d),this.icon=new on(e?e.icon:null,r,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qt{constructor(e,r,a){this.text=e,this.icon=r,this.skipFade=a}}class _i{constructor(){this.invProjMatrix=l.H(),this.viewportMatrix=l.H(),this.circles=[]}}class Bi{constructor(e,r,a,c,d){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=d}}class pn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:a=>a.collisionGroupID===r}}return this.collisionGroups[e]}}function bn(p,e,r,a,c){const{horizontalAlign:d,verticalAlign:_}=l.au(p);return new l.P(-(d-.5)*e+a[0]*c,-(_-.5)*r+a[1]*c)}class Bn{constructor(e,r,a,c,d,_){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new ui(this.transform,r),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new pn(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(a,c)=>r.getElevation(e,a,c):null}getBucketParts(e,r,a,c){const d=a.getBucket(r),_=a.latestFeatureIndex;if(!d||!_||r.id!==d.layerIds[0])return;const w=a.collisionBoxArray,S=d.layers[0].layout,A=d.layers[0].paint,M=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),z=a.tileSize/l.X,N=a.tileID.toUnwrapped(),G=this.transform.calculatePosMatrix(N),X=S.get("text-pitch-alignment")==="map",te=S.get("text-rotation-alignment")==="map",oe=ii(a,1,this.transform.zoom),ae=this.collisionIndex.mapProjection.translatePosition(this.transform,a,A.get("text-translate"),A.get("text-translate-anchor")),ue=this.collisionIndex.mapProjection.translatePosition(this.transform,a,A.get("icon-translate"),A.get("icon-translate-anchor")),$=hs(G,X,te,this.transform,oe);let fe=null;if(X){const Se=Gr(G,X,te,this.transform,oe);fe=l.L([],this.transform.labelPlaneMatrix,Se)}this.retainedQueryData[d.bucketInstanceId]=new Bi(d.bucketInstanceId,_,d.sourceLayerIndex,d.index,a.tileID);const ge={bucket:d,layout:S,translationText:ae,translationIcon:ue,posMatrix:G,unwrappedTileID:N,textLabelPlaneMatrix:$,labelToScreenMatrix:fe,scale:M,textPixelRatio:z,holdingForFade:a.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:l.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const Se of d.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Ke,symbolInstanceEnd:lt}=Se;e.push({sortKey:Fe,symbolInstanceStart:Ke,symbolInstanceEnd:lt,parameters:ge})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ge})}attemptAnchorPlacement(e,r,a,c,d,_,w,S,A,M,z,N,G,X,te,oe,ae,ue,$){const fe=l.aq[e.textAnchor],ge=[e.textOffset0,e.textOffset1],Se=bn(fe,a,c,ge,d),Fe=this.collisionIndex.placeCollisionBox(r,N,S,A,M,w,_,oe,z.predicate,$,Se);if((!ue||this.collisionIndex.placeCollisionBox(ue,N,S,A,M,w,_,ae,z.predicate,$,Se).placeable)&&Fe.placeable){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID]&&this.prevPlacement.placements[G.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[G.crossTileID].anchor),G.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[G.crossTileID]={textOffset:ge,width:a,height:c,anchor:fe,textBoxScale:d,prevAnchor:Ke},this.markUsedJustification(X,fe,G,te),X.allowVerticalPlacement&&(this.markUsedOrientation(X,te,G),this.placedOrientations[G.crossTileID]=te),{shift:Se,placedGlyphBoxes:Fe}}}placeLayerBucketPart(e,r,a){const{bucket:c,layout:d,translationText:_,translationIcon:w,posMatrix:S,unwrappedTileID:A,textLabelPlaneMatrix:M,labelToScreenMatrix:z,textPixelRatio:N,holdingForFade:G,collisionBoxArray:X,partiallyEvaluatedTextSize:te,collisionGroup:oe}=e.parameters,ae=d.get("text-optional"),ue=d.get("icon-optional"),$=l.ar(d,"text-overlap","text-allow-overlap"),fe=$==="always",ge=l.ar(d,"icon-overlap","icon-allow-overlap"),Se=ge==="always",Fe=d.get("text-rotation-alignment")==="map",Ke=d.get("text-pitch-alignment")==="map",lt=d.get("icon-text-fit")!=="none",gt=d.get("symbol-z-order")==="viewport-y",rt=fe&&(Se||!c.hasIconData()||ue),nt=Se&&(fe||!c.hasTextData()||ae);!c.collisionArrays&&X&&c.deserializeCollisionBoxes(X);const wt=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),Zt=(st,dt,jt)=>{var Mi,Jt;if(r[st.crossTileID])return;if(G)return void(this.placements[st.crossTileID]=new Qt(!1,!1,!1));let ni=!1,zi=!1,An=!0,zr=null,Di={box:null,placeable:!1,offscreen:null},Jn={box:null,placeable:!1,offscreen:null},Nn=null,En=null,Vn=null,Kr=0,Io=0,kl=0;dt.textFeatureIndex?Kr=dt.textFeatureIndex:st.useRuntimeCollisionCircles&&(Kr=st.featureIndex),dt.verticalTextFeatureIndex&&(Io=dt.verticalTextFeatureIndex);const Co=dt.textBox;if(Co){const br=wn=>{let Mn=l.ah.horizontal;if(c.allowVerticalPlacement&&!wn&&this.prevPlacement){const dr=this.prevPlacement.placedOrientations[st.crossTileID];dr&&(this.placedOrientations[st.crossTileID]=dr,Mn=dr,this.markUsedOrientation(c,Mn,st))}return Mn},wr=(wn,Mn)=>{if(c.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(const dr of c.writingModes)if(dr===l.ah.vertical?(Di=Mn(),Jn=Di):Di=wn(),Di&&Di.placeable)break}else Di=wn()},fs=st.textAnchorOffsetStartIndex,Dr=st.textAnchorOffsetEndIndex;if(Dr===fs){const wn=(Mn,dr)=>{const ai=this.collisionIndex.placeCollisionBox(Mn,$,N,S,A,Ke,Fe,_,oe.predicate,wt);return ai&&ai.placeable&&(this.markUsedOrientation(c,dr,st),this.placedOrientations[st.crossTileID]=dr),ai};wr(()=>wn(Co,l.ah.horizontal),()=>{const Mn=dt.verticalTextBox;return c.allowVerticalPlacement&&st.numVerticalGlyphVertices>0&&Mn?wn(Mn,l.ah.vertical):{box:null,offscreen:null}}),br(Di&&Di.placeable)}else{let wn=l.aq[(Jt=(Mi=this.prevPlacement)===null||Mi===void 0?void 0:Mi.variableOffsets[st.crossTileID])===null||Jt===void 0?void 0:Jt.anchor];const Mn=(ai,qs,ko)=>{const Ao=ai.x2-ai.x1,kf=ai.y2-ai.y1,Vy=st.textBoxScale,Af=lt&&ge==="never"?qs:null;let ms=null,Ef=$==="never"?1:2,El="never";wn&&Ef++;for(let Ca=0;Ca<Ef;Ca++){for(let Ml=fs;Ml<Dr;Ml++){const zl=c.textAnchorOffsets.get(Ml);if(wn&&zl.textAnchor!==wn)continue;const Eo=this.attemptAnchorPlacement(zl,ai,Ao,kf,Vy,Fe,Ke,N,S,A,oe,El,st,c,ko,_,w,Af,wt);if(Eo&&(ms=Eo.placedGlyphBoxes,ms&&ms.placeable))return ni=!0,zr=Eo.shift,ms}wn?wn=null:El=$}return a&&!ms&&(ms={box:this.collisionIndex.placeCollisionBox(Co,"always",N,S,A,Ke,Fe,_,oe.predicate,wt,new l.P(0,0)).box,offscreen:!1,placeable:!1}),ms};wr(()=>Mn(Co,dt.iconBox,l.ah.horizontal),()=>{const ai=dt.verticalTextBox;return c.allowVerticalPlacement&&(!Di||!Di.placeable)&&st.numVerticalGlyphVertices>0&&ai?Mn(ai,dt.verticalIconBox,l.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Di&&(ni=Di.placeable,An=Di.offscreen);const dr=br(Di&&Di.placeable);if(!ni&&this.prevPlacement){const ai=this.prevPlacement.variableOffsets[st.crossTileID];ai&&(this.variableOffsets[st.crossTileID]=ai,this.markUsedJustification(c,ai.anchor,st,dr))}}}if(Nn=Di,ni=Nn&&Nn.placeable,An=Nn&&Nn.offscreen,st.useRuntimeCollisionCircles){const br=c.text.placedSymbolArray.get(st.centerJustifiedTextSymbolIndex),wr=l.ai(c.textSizeData,te,br),fs=d.get("text-padding");En=this.collisionIndex.placeCollisionCircles($,br,c.lineVertexArray,c.glyphOffsetArray,wr,S,A,M,z,a,Ke,oe.predicate,st.collisionCircleDiameter,fs,_,wt),En.circles.length&&En.collisionDetected&&!a&&l.w("Collisions detected, but collision boxes are not shown"),ni=fe||En.circles.length>0&&!En.collisionDetected,An=An&&En.offscreen}if(dt.iconFeatureIndex&&(kl=dt.iconFeatureIndex),dt.iconBox){const br=wr=>this.collisionIndex.placeCollisionBox(wr,ge,N,S,A,Ke,Fe,w,oe.predicate,wt,lt&&zr?zr:void 0);Jn&&Jn.placeable&&dt.verticalIconBox?(Vn=br(dt.verticalIconBox),zi=Vn.placeable):(Vn=br(dt.iconBox),zi=Vn.placeable),An=An&&Vn.offscreen}const xr=ae||st.numHorizontalGlyphVertices===0&&st.numVerticalGlyphVertices===0,Al=ue||st.numIconVertices===0;xr||Al?Al?xr||(zi=zi&&ni):ni=zi&&ni:zi=ni=zi&&ni;const Nu=zi&&Vn.placeable;if(ni&&Nn.placeable&&this.collisionIndex.insertCollisionBox(Nn.box,$,d.get("text-ignore-placement"),c.bucketInstanceId,Jn&&Jn.placeable&&Io?Io:Kr,oe.ID),Nu&&this.collisionIndex.insertCollisionBox(Vn.box,ge,d.get("icon-ignore-placement"),c.bucketInstanceId,kl,oe.ID),En&&ni&&this.collisionIndex.insertCollisionCircles(En.circles,$,d.get("text-ignore-placement"),c.bucketInstanceId,Kr,oe.ID),a&&this.storeCollisionData(c.bucketInstanceId,jt,dt,Nn,Vn,En),st.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[st.crossTileID]=new Qt(ni||rt,zi||nt,An||c.justReloaded),r[st.crossTileID]=!0};if(gt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const st=c.getSortedSymbolIndexes(this.transform.angle);for(let dt=st.length-1;dt>=0;--dt){const jt=st[dt];Zt(c.symbolInstances.get(jt),c.collisionArrays[jt],jt)}}else for(let st=e.symbolInstanceStart;st<e.symbolInstanceEnd;st++)Zt(c.symbolInstances.get(st),c.collisionArrays[st],st);if(a&&c.bucketInstanceId in this.collisionCircleArrays){const st=this.collisionCircleArrays[c.bucketInstanceId];l.as(st.invProjMatrix,S),st.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,r,a,c,d,_){if(a.textBox||a.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?S=w.get(r):(S={text:null,icon:null},w.set(r,S)),a.textBox&&(S.text=c.box),a.iconBox&&(S.icon=d.box)}if(_){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new _i);for(let S=0;S<_.circles.length;S+=4)w.circles.push(_.circles[S+0]),w.circles.push(_.circles[S+1]),w.circles.push(_.circles[S+2]),w.circles.push(_.collisionDetected?1:0)}}markUsedJustification(e,r,a,c){let d;d=c===l.ah.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[l.at(r)];const _=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const w of _)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=d>=0&&w!==d?0:a.crossTileID)}markUsedOrientation(e,r,a){const c=r===l.ah.horizontal||r===l.ah.horizontalOnly?r:0,d=r===l.ah.vertical?r:0,_=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const w of _)e.text.placedSymbolArray.get(w).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let a=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const c=r?r.symbolFadeChange(e):1,d=r?r.opacities:{},_=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],M=d[S];M?(this.opacities[S]=new Zi(M,c,A.text,A.icon),a=a||A.text!==M.text.placed||A.icon!==M.icon.placed):(this.opacities[S]=new Zi(null,c,A.text,A.icon,A.skipFade),a=a||A.text||A.icon)}for(const S in d){const A=d[S];if(!this.opacities[S]){const M=new Zi(A,c,!1,!1);M.isHidden()||(this.opacities[S]=M,a=a||A.text.placed||A.icon.placed)}}for(const S in _)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=_[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const a={};for(const c of r){const d=c.getBucket(e);d&&c.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,c.tileID,a,c.collisionBoxArray)}}updateBucketOpacities(e,r,a,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],_=d.layout,w=new Zi(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),M=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=_.get("text-rotation-alignment")==="map",N=_.get("text-pitch-alignment")==="map",G=_.get("icon-text-fit")!=="none",X=new Zi(null,0,S&&(A||!e.hasIconData()||_.get("icon-optional")),A&&(S||!e.hasTextData()||_.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const te=(ae,ue,$)=>{for(let fe=0;fe<ue/4;fe++)ae.opacityVertexArray.emplaceBack($);ae.hasVisibleVertices=ae.hasVisibleVertices||$!==ro},oe=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ae=0;ae<e.symbolInstances.length;ae++){const ue=e.symbolInstances.get(ae),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:fe,crossTileID:ge}=ue;let Se=this.opacities[ge];a[ge]?Se=w:Se||(Se=X,this.opacities[ge]=Se),a[ge]=!0;const Fe=ue.numIconVertices>0,Ke=this.placedOrientations[ue.crossTileID],lt=Ke===l.ah.vertical,gt=Ke===l.ah.horizontal||Ke===l.ah.horizontalOnly;if($>0||fe>0){const nt=cr(Se.text);te(e.text,$,lt?ro:nt),te(e.text,fe,gt?ro:nt);const wt=Se.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(e.text.placedSymbolArray.get(dt).hidden=wt||lt?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=wt||gt?1:0);const Zt=this.variableOffsets[ue.crossTileID];Zt&&this.markUsedJustification(e,Zt.anchor,ue,Ke);const st=this.placedOrientations[ue.crossTileID];st&&(this.markUsedJustification(e,"left",ue,st),this.markUsedOrientation(e,st,ue))}if(Fe){const nt=cr(Se.icon),wt=!(G&&ue.verticalPlacedIconSymbolIndex&&lt);ue.placedIconSymbolIndex>=0&&(te(e.icon,ue.numIconVertices,wt?nt:ro),e.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Se.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(te(e.icon,ue.numVerticalIconVertices,wt?ro:nt),e.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}const rt=oe&&oe.has(ae)?oe.get(ae):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const nt=e.collisionArrays[ae];if(nt){let wt=new l.P(0,0);if(nt.textBox||nt.verticalTextBox){let Zt=!0;if(M){const st=this.variableOffsets[ge];st?(wt=bn(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale),z&&wt._rotate(N?this.transform.angle:-this.transform.angle)):Zt=!1}if(nt.textBox||nt.verticalTextBox){let st;nt.textBox&&(st=lt),nt.verticalTextBox&&(st=gt),no(e.textCollisionBox.collisionVertexArray,Se.text.placed,!Zt||st,rt.text,wt.x,wt.y)}}if(nt.iconBox||nt.verticalIconBox){const Zt=!!(!gt&&nt.verticalIconBox);let st;nt.iconBox&&(st=Zt),nt.verticalIconBox&&(st=!Zt),no(e.iconCollisionBox.collisionVertexArray,Se.icon.placed,st,rt.icon,G?wt.x:0,G?wt.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ae.invProjMatrix,e.placementViewportMatrix=ae.viewportMatrix,e.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const a=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function no(p,e,r,a,c,d){a&&a.length!==0||(a=[0,0,0,0]);const _=a[0]-Xt,w=a[1]-Xt,S=a[2]-Xt,A=a[3]-Xt;p.emplaceBack(e?1:0,r?1:0,c||0,d||0,_,w),p.emplaceBack(e?1:0,r?1:0,c||0,d||0,S,w),p.emplaceBack(e?1:0,r?1:0,c||0,d||0,S,A),p.emplaceBack(e?1:0,r?1:0,c||0,d||0,_,A)}const vi=Math.pow(2,25),$c=Math.pow(2,24),Jc=Math.pow(2,17),ar=Math.pow(2,16),lr=Math.pow(2,9),fy=Math.pow(2,8),gr=Math.pow(2,1);function cr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,r=Math.floor(127*p.opacity);return r*vi+e*$c+r*Jc+e*ar+r*lr+e*fy+r*gr+e}const ro=0;function Ms(){return{isOccluded:(p,e,r)=>!1,getPitchedTextCorrection:(p,e,r)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,e,r,a){throw new Error("Not implemented.")},translatePosition:(p,e,r,a)=>function(c,d,_,w,S=!1){if(!_[0]&&!_[1])return[0,0];const A=S?w==="map"?c.angle:0:w==="viewport"?-c.angle:0;if(A){const M=Math.sin(A),z=Math.cos(A);_=[_[0]*z-_[1]*M,_[0]*M+_[1]*z]}return[S?_[0]:ii(d,_[0],c.zoom),S?_[1]:ii(d,_[1],c.zoom)]}(p,e,r,a),getCircleRadiusCorrection:p=>1}}class an{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,a,c,d){const _=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(_,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<_.length;)if(r.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,d())return!0;return!1}}class ca{constructor(e,r,a,c,d,_,w,S){this.placement=new Bn(e,Ms(),r,_,w,S),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,r,a){const c=B.now(),d=()=>!this._forceFullPlacement&&B.now()-c>2;for(;this._currentPlacementIndex>=0;){const _=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=w)&&(!_.maxzoom||_.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new an(_)),this._inProgressLayer.continuePlacement(a[_.source],this.placement,this._showCollisionBoxes,_,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Cr=512/l.X/2;class en{constructor(e,r,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let d=0;d<r.length;d++){const _=r.get(d),w=_.key,S=c.get(w);S?S.push(_):c.set(w,[_])}for(const[d,_]of c){const w={positions:_.map(S=>({x:Math.floor(S.anchorX*Cr),y:Math.floor(S.anchorY*Cr)})),crossTileIDs:_.map(S=>S.crossTileID)};if(w.positions.length>128){const S=new l.av(w.positions.length,16,Uint16Array);for(const{x:A,y:M}of w.positions)S.add(A,M);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[d]=w}}getScaledCoordinates(e,r){const{x:a,y:c,z:d}=this.tileID.canonical,{x:_,y:w,z:S}=r.canonical,A=Cr/Math.pow(2,S-d),M=(w*l.X+e.anchorY)*A,z=c*l.X*Cr;return{x:Math.floor((_*l.X+e.anchorX)*A-a*l.X*Cr),y:Math.floor(M-z)}}findMatches(e,r,a){const c=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let d=0;d<e.length;d++){const _=e.get(d);if(_.crossTileID)continue;const w=this._symbolsByKey[_.key];if(!w)continue;const S=this.getScaledCoordinates(_,r);if(w.index){const A=w.index.range(S.x-c,S.y-c,S.x+c,S.y+c).sort();for(const M of A){const z=w.crossTileIDs[M];if(!a[z]){a[z]=!0,_.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const M=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(M.x-S.x)<=c&&Math.abs(M.y-S.y)<=c&&!a[z]){a[z]=!0,_.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Ja{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const a in this.indexes){const c=this.indexes[a],d={};for(const _ in c){const w=c[_];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),d[w.tileID.key]=w}this.indexes[a]=d}this.lng=e}addBucket(e,r,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<r.symbolInstances.length;d++)r.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const _=this.indexes[d];if(Number(d)>e.overscaledZ)for(const w in _){const S=_[w];S.tileID.isChildOf(e)&&S.findMatches(r.symbolInstances,e,c)}else{const w=_[e.scaledTo(Number(d)).key];w&&w.findMatches(r.symbolInstances,e,c)}}for(let d=0;d<r.symbolInstances.length;d++){const _=r.symbolInstances.get(d);_.crossTileID||(_.crossTileID=a.generate(),c[_.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new en(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const a of r.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let r=!1;for(const a in this.indexes){const c=this.indexes[a];for(const d in c)e[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[d]),delete c[d],r=!0)}return r}}class Yc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ja,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,a){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new kr);let d=!1;const _={};c.handleWrapJump(a);for(const w of r){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(w.tileID,S,this.crossTileIDs)&&(d=!0),_[S.bucketInstanceId]=!0)}return c.removeStaleBuckets(_)&&(d=!0),d}pruneUnusedLayers(e){const r={};e.forEach(a=>{r[a]=!0});for(const a in this.layerIndexes)r[a]||delete this.layerIndexes[a]}}const Ar=(p,e)=>l.t(p,e&&e.filter(r=>r.identifier!=="source.canvas")),my=l.aw();class Ya extends l.E{constructor(e,r={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const c=this.sourceCaches[a].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Xi(Fn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(a,c)=>this.getGlyphs(a,c)),this.dispatcher.registerMessageHandler("GI",(a,c)=>this.getImages(a,c)),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new pt(e._requestManager,r.localIdeographFontFamily),this.lineAtlas=new yi(256,512),this.crossTileSymbolIndex=new Yc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",l.ay()),Pr().on(Je,this._rtlPluginLoaded),this.on("data",a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const c=this.sourceCaches[a.sourceId];if(!c)return;const d=c.getSource();if(d&&d.vectorLayerIds)for(const _ in this._layers){const w=this._layers[_];w.source===d.id&&this._validateLayer(w)}})}loadURL(e,r={},a){this.fire(new l.k("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;l.h(c,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,r,a)}).catch(_=>{this._loadStyleRequest=null,_&&!d.signal.aborted&&this.fire(new l.j(_))})}loadJSON(e,r={},a){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,a)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(my,{validate:!1})}_load(e,r,a){var c;const d=r.transformStyle?r.transformStyle(a,e):e;if(!r.validate||!Ar(this,l.u(d))){this._loaded=!0,this.stylesheet=d;for(const _ in d.sources)this.addSource(_,d.sources[_],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new at(this.stylesheet.light),this.sky=new Yt(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const e=l.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(r=>r.id),this._layers={},this._serializedLayers=null;for(const r of e){const a=l.aA(r);a.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=a}}_loadSprite(e,r=!1,a=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,_,w,S){return l._(this,void 0,void 0,function*(){const A=He(d),M=w>1?"@2x":"",z={},N={};for(const{id:G,url:X}of A){const te=_.transformRequest(Ye(X,M,".json"),"SpriteJSON");z[G]=l.h(te,S);const oe=_.transformRequest(Ye(X,M,".png"),"SpriteImage");N[G]=Ie.getImage(oe,S)}return yield Promise.all([...Object.values(z),...Object.values(N)]),function(G,X){return l._(this,void 0,void 0,function*(){const te={};for(const oe in G){te[oe]={};const ae=B.getImageCanvasContext((yield X[oe]).data),ue=(yield G[oe]).data;for(const $ in ue){const{width:fe,height:ge,x:Se,y:Fe,sdf:Ke,pixelRatio:lt,stretchX:gt,stretchY:rt,content:nt,textFitWidth:wt,textFitHeight:Zt}=ue[$];te[oe][$]={data:null,pixelRatio:lt,sdf:Ke,stretchX:gt,stretchY:rt,content:nt,textFitWidth:wt,textFitHeight:Zt,spriteData:{width:fe,height:ge,x:Se,y:Fe,context:ae}}}}return te})}(z,N)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const _ in d){this._spritesImagesIds[_]=[];const w=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter(S=>!(S in d)):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in d[_]){const A=_==="default"?S:`${_}:${S}`;this._spritesImagesIds[_].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,d[_][S],!1):this.imageManager.addImage(A,d[_][S]),r&&(this._changedImages[A]=!0)}}}).catch(d=>{this._spriteRequest=null,c=d,this.fire(new l.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),a&&a(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(e){const r=this.sourceCaches[e.source];if(!r)return;const a=e.sourceLayer;if(!a)return;const c=r.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new l.j(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?l.aB(a):a);const c=[];for(const d of e)if(a[d]){const _=r?l.aB(a[d]):a[d];c.push(_)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const a of r){const c=this._layers[a];c.type!=="custom"&&(e[a]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const _ in this._updatedSources){const w=this._updatedSources[_];if(w==="reload")this._reloadSource(_);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];a[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in a){const d=this.sourceCaches[c];!!a[c]!=!!d.used&&d.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,r&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var a;this._checkLoaded();const c=this.serialize();if(e=r.transformStyle?r.transformStyle(c,e):e,((a=r.validate)===null||a===void 0||a)&&Ar(this,l.u(e)))return!1;(e=l.aB(e)).layers=l.az(e.layers);const d=l.aC(c,e),_=this._getOperationsToPerform(d);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const w of _.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],a=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":r.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":r.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":r.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":r.push(()=>{});break;default:a.push(c.command)}return{operations:r,unimplemented:a}}addImage(e,r){if(this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(l.u.source,`sources.${e}`,r,null,a))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const c=this.sourceCaches[e]=new Ft(e,r,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new l.j(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(r),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,r,a={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new l.j(new Error(`Layer "${c}" already exists on this map.`)));let d;if(e.type==="custom"){if(Ar(this,l.aD(e)))return;d=l.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=l.aB(e),e=l.e(e,{source:c})),this._validate(l.u.layer,`layers.${c}`,e,{arrayIndex:-1},a))return;d=l.aA(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const _=r?this._order.indexOf(r):this._order.length;if(r&&_===-1)this.fire(new l.j(new Error(`Cannot add layer "${c}" before non-existing layer "${r}".`)));else{if(this._order.splice(_,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const w=this._removedLayers[c];delete this._removedLayers[c],w.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const a=this._order.indexOf(e);this._order.splice(a,1);const c=r?this._order.indexOf(r):this._order.length;r&&c===-1?this.fire(new l.j(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,a){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===r&&c.maxzoom===a||(r!=null&&(c.minzoom=r),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,a={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!l.aE(c.filter,r))return r==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(l.u.filter,`layers.${c.id}.filter`,r,null,a)||(c.filter=l.aB(r),this._updateLayer(c)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.aB(this.getLayer(e).filter)}setLayoutProperty(e,r,a,c={}){this._checkLoaded();const d=this.getLayer(e);d?l.aE(d.getLayoutProperty(r),a)||(d.setLayoutProperty(r,a,c),this._updateLayer(d)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const a=this.getLayer(e);if(a)return a.getLayoutProperty(r);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,a,c={}){this._checkLoaded();const d=this.getLayer(e);d?l.aE(d.getPaintProperty(r),a)||(d.setPaintProperty(r,a,c)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const a=e.source,c=e.sourceLayer,d=this.sourceCaches[a];if(d===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const _=d.getSource().type;_==="geojson"&&c?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||c?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,e.id,r)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const a=e.source,c=this.sourceCaches[a];if(c===void 0)return void this.fire(new l.j(new Error(`The source '${a}' does not exist in the map's style.`)));const d=c.getSource().type,_=d==="vector"?e.sourceLayer:void 0;d!=="vector"||_?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(_,e.id,r):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,a=e.sourceLayer,c=this.sourceCaches[r];if(c!==void 0)return c.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,e.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.aF(this.sourceCaches,d=>d.serialize()),r=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,c=this.stylesheet;return l.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:r,terrain:a},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=_=>this._layers[_].type==="fill-extrusion",a={},c=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(r(w)){a[w]=_;for(const S of e){const A=S[w];if(A)for(const M of A)c.push(M)}}}c.sort((_,w)=>w.intersectionZ-_.intersectionZ);const d=[];for(let _=this._order.length-1;_>=0;_--){const w=this._order[_];if(r(w))for(let S=c.length-1;S>=0;S--){const A=c[S].feature;if(a[A.layer.id]<_)break;d.push(A),c.pop()}else for(const S of e){const A=S[w];if(A)for(const M of A)d.push(M.feature)}}return d}queryRenderedFeatures(e,r,a){r&&r.filter&&this._validate(l.u.filter,"queryRenderedFeatures.filter",r.filter,null,r);const c={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const w of r.layers){const S=this._layers[w];if(!S)return this.fire(new l.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];c[S.source]=!0}}const d=[];r.availableImages=this._availableImages;const _=this._serializedAllLayers();for(const w in this.sourceCaches)r.layers&&!c[w]||d.push(Ki(this.sourceCaches[w],this._layers,_,e,r,a));return this.placement&&d.push(function(w,S,A,M,z,N,G){const X={},te=N.queryRenderedSymbols(M),oe=[];for(const ae of Object.keys(te).map(Number))oe.push(G[ae]);oe.sort(mt);for(const ae of oe){const ue=ae.featureIndex.lookupSymbolFeatures(te[ae.bucketInstanceId],S,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const $ in ue){const fe=X[$]=X[$]||[],ge=ue[$];ge.sort((Se,Fe)=>{const Ke=ae.featureSortOrder;if(Ke){const lt=Ke.indexOf(Se.featureIndex);return Ke.indexOf(Fe.featureIndex)-lt}return Fe.featureIndex-Se.featureIndex});for(const Se of ge)fe.push(Se)}}for(const ae in X)X[ae].forEach(ue=>{const $=ue.feature,fe=A[w[ae].source].getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=fe});return X}(this._layers,_,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,r){r&&r.filter&&this._validate(l.u.filter,"querySourceFeatures.filter",r.filter,null,r);const a=this.sourceCaches[e];return a?function(c,d){const _=c.getRenderableIds().map(A=>c.getTileByID(A)),w=[],S={};for(let A=0;A<_.length;A++){const M=_[A],z=M.tileID.canonical.key;S[z]||(S[z]=!0,M.querySourceFeatures(w,d))}return w}(a,r):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const _ in e)if(!l.aE(e[_],a[_])){c=!0;break}if(!c)return;const d={now:B.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(d)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){const a=this.getSky();let c=!1;if(!e&&!a)return;if(e&&!a)c=!0;else if(!e&&a)c=!0;else for(const _ in e)if(!l.aE(e[_],a[_])){c=!0;break}if(!c)return;const d={now:B.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(d)}_validate(e,r,a,c,d={}){return(!d||d.validate!==!1)&&Ar(this,e.call(l.u,l.e({key:r,style:this.serialize(),value:a,styleSpec:l.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Pr().off(Je,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.sourceCaches){const a=this.sourceCaches[r];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const r in this.sourceCaches)this.sourceCaches[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,r,a,c,d=!1){let _=!1,w=!1;const S={};for(const A of this._order){const M=this._layers[A];if(M.type!=="symbol")continue;if(!S[M.source]){const N=this.sourceCaches[M.source];S[M.source]=N.getRenderableIds(!0).map(G=>N.getTileByID(G)).sort((G,X)=>X.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan(X.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(M,S[M.source],e.center.lng);_=_||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(B.now(),e.zoom))&&(this.pauseablePlacement=new ca(e,this.map.terrain,this._order,d,r,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(B.now()),w=!0),_&&this.pauseablePlacement.placement.setStale()),w||_)for(const A of this._order){const M=this._layers[A];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(B.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,r){return l._(this,void 0,void 0,function*(){const a=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,r.icons),a})}getGlyphs(e,r){return l._(this,void 0,void 0,function*(){const a=yield this.glyphManager.getGlyphs(r.stacks),c=this.sourceCaches[r.source];return c&&c.setDependencies(r.tileID.key,r.type,[""]),a})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(l.u.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,r,a={},c){this._checkLoaded();const d=[{id:e,url:r}],_=[...He(this.stylesheet.sprite),...d];this._validate(l.u.sprite,"sprite",_,null,a)||(this.stylesheet.sprite=_,this._loadSprite(d,!0,c))}removeSprite(e){this._checkLoaded();const r=He(this.stylesheet.sprite);if(r.find(a=>a.id===e)){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;r.splice(r.findIndex(a=>a.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return He(this.stylesheet.sprite)}setSprite(e,r={},a){this._checkLoaded(),e&&this._validate(l.u.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var zs=l.Y([{name:"a_pos",type:"Int16",components:2}]);const ds={prelude:mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:mi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mi(p,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/attribute ([\w]+) ([\w]+)/g),c=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=d?d.concat(c):c,w={};return{fragmentSource:p=p.replace(r,(S,A,M,z,N)=>(w[N]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${M} ${z} ${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = u_${N};
#endif
`)),vertexSource:e=e.replace(r,(S,A,M,z,N)=>{const G=z==="float"?"vec2":"vec4",X=N.match(/color/)?"color":G;return w[N]?A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${M} ${G} a_${N};
varying ${M} ${z} ${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${M} ${G} a_${N};
#else
uniform ${M} ${z} u_${N};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = a_${N};
#else
    ${M} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${M} ${z} ${N} = unpack_mix_${X}(a_${N}, u_${N}_t);
#else
    ${M} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:a,staticUniforms:_}}class Qc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,a,c,d,_,w,S,A){this.context=e;let M=this.boundPaintVertexBuffers.length!==c.length;for(let z=0;!M&&z<c.length;z++)this.boundPaintVertexBuffers[z]!==c[z]&&(M=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==a||M||this.boundIndexBuffer!==d||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,a,c,d,_,w,S,A):(e.bindVertexArray.set(this.vao),w&&w.bind(),d&&d.dynamicDraw&&d.bind(),S&&S.bind(),A&&A.bind())}freshBind(e,r,a,c,d,_,w,S){const A=e.numAttributes,M=this.context,z=M.gl;this.vao&&this.destroy(),this.vao=M.createVertexArray(),M.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,r.enableAttributes(z,e);for(const N of a)N.enableAttributes(z,e);_&&_.enableAttributes(z,e),w&&w.enableAttributes(z,e),S&&S.enableAttributes(z,e),r.bind(),r.setVertexAttribPointers(z,e,d);for(const N of a)N.bind(),N.setVertexAttribPointers(z,e,d);_&&(_.bind(),_.setVertexAttribPointers(z,e,d)),c&&c.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,e,d)),S&&(S.bind(),S.setVertexAttribPointers(z,e,d)),M.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const eu=(p,e,r,a,c)=>({u_matrix:p,u_texture:0,u_ele_delta:e,u_fog_matrix:r,u_fog_color:a?a.properties.get("fog-color"):l.aM.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):l.aM.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1});function so(p){const e=[];for(let r=0;r<p.length;r++){if(p[r]===null)continue;const a=p[r].split(" ");e.push(a.pop())}return e}class tu{constructor(e,r,a,c,d,_){const w=e.gl;this.program=w.createProgram();const S=so(r.staticAttributes),A=a?a.getBinderAttributes():[],M=S.concat(A),z=ds.prelude.staticUniforms?so(ds.prelude.staticUniforms):[],N=r.staticUniforms?so(r.staticUniforms):[],G=a?a.getBinderUniforms():[],X=z.concat(N).concat(G),te=[];for(const Se of X)te.indexOf(Se)<0&&te.push(Se);const oe=a?a.defines():[];d&&oe.push("#define OVERDRAW_INSPECTOR;"),_&&oe.push("#define TERRAIN3D;");const ae=oe.concat(ds.prelude.fragmentSource,r.fragmentSource).join(`
`),ue=oe.concat(ds.prelude.vertexSource,r.vertexSource).join(`
`),$=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource($,ae),w.compileShader($),!w.getShaderParameter($,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog($)}`);w.attachShader(this.program,$);const fe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(fe,ue),w.compileShader(fe),!w.getShaderParameter(fe,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(fe)}`);w.attachShader(this.program,fe),this.attributes={};const ge={};this.numAttributes=M.length;for(let Se=0;Se<this.numAttributes;Se++)M[Se]&&(w.bindAttribLocation(this.program,Se,M[Se]),this.attributes[M[Se]]=Se);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(fe),w.deleteShader($);for(let Se=0;Se<te.length;Se++){const Fe=te[Se];if(Fe&&!ge[Fe]){const Ke=w.getUniformLocation(this.program,Fe);Ke&&(ge[Fe]=Ke)}}this.fixedUniforms=c(e,ge),this.terrainUniforms=((Se,Fe)=>({u_depth:new l.aH(Se,Fe.u_depth),u_terrain:new l.aH(Se,Fe.u_terrain),u_terrain_dim:new l.aI(Se,Fe.u_terrain_dim),u_terrain_matrix:new l.aJ(Se,Fe.u_terrain_matrix),u_terrain_unpack:new l.aK(Se,Fe.u_terrain_unpack),u_terrain_exaggeration:new l.aI(Se,Fe.u_terrain_exaggeration)}))(e,ge),this.binderUniforms=a?a.getUniforms(e,ge):[]}draw(e,r,a,c,d,_,w,S,A,M,z,N,G,X,te,oe,ae,ue){const $=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(c),e.setColorMode(d),e.setCullFace(_),S){e.activeTexture.set($.TEXTURE2),$.bindTexture($.TEXTURE_2D,S.depthTexture),e.activeTexture.set($.TEXTURE3),$.bindTexture($.TEXTURE_2D,S.texture);for(const ge in this.terrainUniforms)this.terrainUniforms[ge].set(S[ge])}for(const ge in this.fixedUniforms)this.fixedUniforms[ge].set(w[ge]);te&&te.setUniforms(e,this.binderUniforms,G,{zoom:X});let fe=0;switch(r){case $.LINES:fe=2;break;case $.TRIANGLES:fe=3;break;case $.LINE_STRIP:fe=1}for(const ge of N.get()){const Se=ge.vaos||(ge.vaos={});(Se[A]||(Se[A]=new Qc)).bind(e,this,M,te?te.getPaintVertexBuffers():[],z,ge.vertexOffset,oe,ae,ue),$.drawElements(r,ge.primitiveLength*fe,$.UNSIGNED_SHORT,ge.primitiveOffset*fe*2)}}}function Qa(p,e,r){const a=1/ii(r,1,e.transform.tileZoom),c=Math.pow(2,r.tileID.overscaledZ),d=r.tileSize*Math.pow(2,e.transform.tileZoom)/c,_=d*(r.tileID.canonical.x+r.tileID.wrap*c),w=d*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[a,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[_>>16,w>>16],u_pixel_coord_lower:[65535&_,65535&w]}}const ua=(p,e,r,a)=>{const c=e.style.light,d=c.properties.get("position"),_=[d.x,d.y,d.z],w=function(){var A=new l.A(9);return l.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();c.properties.get("anchor")==="viewport"&&function(A,M){var z=Math.sin(M),N=Math.cos(M);A[0]=N,A[1]=z,A[2]=0,A[3]=-z,A[4]=N,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-e.transform.angle),function(A,M,z){var N=M[0],G=M[1],X=M[2];A[0]=N*z[0]+G*z[3]+X*z[6],A[1]=N*z[1]+G*z[4]+X*z[7],A[2]=N*z[2]+G*z[5]+X*z[8]}(_,_,w);const S=c.properties.get("color");return{u_matrix:p,u_lightpos:_,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+r,u_opacity:a}},el=(p,e,r,a,c,d,_)=>l.e(ua(p,e,r,a),Qa(d,e,_),{u_height_factor:-Math.pow(2,c.overscaledZ)/_.tileSize/8}),oo=p=>({u_matrix:p}),Xp=(p,e,r,a)=>l.e(oo(p),Qa(r,e,a)),gy=(p,e)=>({u_matrix:p,u_world:e}),Kp=(p,e,r,a,c)=>l.e(Xp(p,e,r,a),{u_world:c}),yy=(p,e,r,a)=>{const c=p.transform;let d,_;if(a.paint.get("circle-pitch-alignment")==="map"){const w=ii(r,1,c.zoom);d=!0,_=[w,w]}else d=!1,_=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(e.posMatrix,r,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:_}},Ds=(p,e,r)=>({u_matrix:p,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}),ha=(p,e,r=1)=>({u_matrix:p,u_color:e,u_overlay:0,u_overlay_scale:r}),Kn=p=>({u_matrix:p}),$n=(p,e,r,a)=>({u_matrix:p,u_extrude_scale:ii(e,1,r),u_intensity:a}),tl=(p,e,r,a)=>{const c=l.H();l.aP(c,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:c,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:r,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}};function il(p,e){const r=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new l.Z(0,a/r).toLngLat().lat,new l.Z(0,(a+1)/r).toLngLat().lat]}const nl=(p,e,r,a)=>{const c=p.transform;return{u_matrix:Yp(p,e,r,a),u_ratio:1/ii(e,1,c.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},$p=(p,e,r,a,c)=>l.e(nl(p,e,r,c),{u_image:0,u_image_height:a}),ao=(p,e,r,a,c)=>{const d=p.transform,_=Jp(e,d);return{u_matrix:Yp(p,e,r,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/ii(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[_,a.fromScale,a.toScale],u_fade:a.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},_y=(p,e,r,a,c,d)=>{const _=p.lineAtlas,w=Jp(e,p.transform),S=r.layout.get("line-cap")==="round",A=_.getDash(a.from,S),M=_.getDash(a.to,S),z=A.width*c.fromScale,N=M.width*c.toScale;return l.e(nl(p,e,r,d),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/N,-M.height/2],u_sdfgamma:_.width/(256*Math.min(z,N)*p.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:M.y,u_mix:c.t})};function Jp(p,e){return 1/ii(p,1,e.tileZoom)}function Yp(p,e,r,a){return p.translatePosMatrix(a?a.posMatrix:e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const vy=(p,e,r,a,c)=>{return{u_matrix:p,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(_=c.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(d=c.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:xy(c.paint.get("raster-hue-rotate"))};var d,_};function xy(p){p*=Math.PI/180;const e=Math.sin(p),r=Math.cos(p);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const Qp=(p,e,r,a,c,d,_,w,S,A,M,z,N,G)=>{const X=_.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:X.width/X.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+z,u_pitch_with_map:+a,u_is_along_line:c,u_is_variable_anchor:d,u_texsize:N,u_texture:0,u_translation:M,u_pitched_scale:G}},da=(p,e,r,a,c,d,_,w,S,A,M,z,N,G,X)=>{const te=_.transform;return l.e(Qp(p,e,r,a,c,d,_,w,S,A,M,z,N,X),{u_gamma_scale:a?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+G})},iu=(p,e,r,a,c,d,_,w,S,A,M,z,N,G)=>l.e(da(p,e,r,a,c,d,_,w,S,A,M,!0,z,!0,G),{u_texsize_icon:N,u_texture_icon:1}),rl=(p,e,r)=>({u_matrix:p,u_opacity:e,u_color:r}),nu=(p,e,r,a,c,d)=>l.e(function(_,w,S,A){const M=S.imageManager.getPattern(_.from.toString()),z=S.imageManager.getPattern(_.to.toString()),{width:N,height:G}=S.imageManager.getPixelSize(),X=Math.pow(2,A.tileID.overscaledZ),te=A.tileSize*Math.pow(2,S.transform.tileZoom)/X,oe=te*(A.tileID.canonical.x+A.tileID.wrap*X),ae=te*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,G],u_mix:w.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ii(A,1,S.transform.tileZoom),u_pixel_coord_upper:[oe>>16,ae>>16],u_pixel_coord_lower:[65535&oe,65535&ae]}}(a,d,r,c),{u_matrix:p,u_opacity:e}),ru={fillExtrusion:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_lightpos:new l.aN(p,e.u_lightpos),u_lightintensity:new l.aI(p,e.u_lightintensity),u_lightcolor:new l.aN(p,e.u_lightcolor),u_vertical_gradient:new l.aI(p,e.u_vertical_gradient),u_opacity:new l.aI(p,e.u_opacity)}),fillExtrusionPattern:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_lightpos:new l.aN(p,e.u_lightpos),u_lightintensity:new l.aI(p,e.u_lightintensity),u_lightcolor:new l.aN(p,e.u_lightcolor),u_vertical_gradient:new l.aI(p,e.u_vertical_gradient),u_height_factor:new l.aI(p,e.u_height_factor),u_image:new l.aH(p,e.u_image),u_texsize:new l.aO(p,e.u_texsize),u_pixel_coord_upper:new l.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(p,e.u_pixel_coord_lower),u_scale:new l.aN(p,e.u_scale),u_fade:new l.aI(p,e.u_fade),u_opacity:new l.aI(p,e.u_opacity)}),fill:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix)}),fillPattern:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_image:new l.aH(p,e.u_image),u_texsize:new l.aO(p,e.u_texsize),u_pixel_coord_upper:new l.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(p,e.u_pixel_coord_lower),u_scale:new l.aN(p,e.u_scale),u_fade:new l.aI(p,e.u_fade)}),fillOutline:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_world:new l.aO(p,e.u_world)}),fillOutlinePattern:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_world:new l.aO(p,e.u_world),u_image:new l.aH(p,e.u_image),u_texsize:new l.aO(p,e.u_texsize),u_pixel_coord_upper:new l.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(p,e.u_pixel_coord_lower),u_scale:new l.aN(p,e.u_scale),u_fade:new l.aI(p,e.u_fade)}),circle:(p,e)=>({u_camera_to_center_distance:new l.aI(p,e.u_camera_to_center_distance),u_scale_with_map:new l.aH(p,e.u_scale_with_map),u_pitch_with_map:new l.aH(p,e.u_pitch_with_map),u_extrude_scale:new l.aO(p,e.u_extrude_scale),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_matrix:new l.aJ(p,e.u_matrix)}),collisionBox:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_pixel_extrude_scale:new l.aO(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_inv_matrix:new l.aJ(p,e.u_inv_matrix),u_camera_to_center_distance:new l.aI(p,e.u_camera_to_center_distance),u_viewport_size:new l.aO(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new l.aL(p,e.u_color),u_matrix:new l.aJ(p,e.u_matrix),u_overlay:new l.aH(p,e.u_overlay),u_overlay_scale:new l.aI(p,e.u_overlay_scale)}),clippingMask:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix)}),heatmap:(p,e)=>({u_extrude_scale:new l.aI(p,e.u_extrude_scale),u_intensity:new l.aI(p,e.u_intensity),u_matrix:new l.aJ(p,e.u_matrix)}),heatmapTexture:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_world:new l.aO(p,e.u_world),u_image:new l.aH(p,e.u_image),u_color_ramp:new l.aH(p,e.u_color_ramp),u_opacity:new l.aI(p,e.u_opacity)}),hillshade:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_image:new l.aH(p,e.u_image),u_latrange:new l.aO(p,e.u_latrange),u_light:new l.aO(p,e.u_light),u_shadow:new l.aL(p,e.u_shadow),u_highlight:new l.aL(p,e.u_highlight),u_accent:new l.aL(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_image:new l.aH(p,e.u_image),u_dimension:new l.aO(p,e.u_dimension),u_zoom:new l.aI(p,e.u_zoom),u_unpack:new l.aK(p,e.u_unpack)}),line:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_ratio:new l.aI(p,e.u_ratio),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new l.aO(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_ratio:new l.aI(p,e.u_ratio),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new l.aO(p,e.u_units_to_pixels),u_image:new l.aH(p,e.u_image),u_image_height:new l.aI(p,e.u_image_height)}),linePattern:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_texsize:new l.aO(p,e.u_texsize),u_ratio:new l.aI(p,e.u_ratio),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_image:new l.aH(p,e.u_image),u_units_to_pixels:new l.aO(p,e.u_units_to_pixels),u_scale:new l.aN(p,e.u_scale),u_fade:new l.aI(p,e.u_fade)}),lineSDF:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_ratio:new l.aI(p,e.u_ratio),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new l.aO(p,e.u_units_to_pixels),u_patternscale_a:new l.aO(p,e.u_patternscale_a),u_patternscale_b:new l.aO(p,e.u_patternscale_b),u_sdfgamma:new l.aI(p,e.u_sdfgamma),u_image:new l.aH(p,e.u_image),u_tex_y_a:new l.aI(p,e.u_tex_y_a),u_tex_y_b:new l.aI(p,e.u_tex_y_b),u_mix:new l.aI(p,e.u_mix)}),raster:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_tl_parent:new l.aO(p,e.u_tl_parent),u_scale_parent:new l.aI(p,e.u_scale_parent),u_buffer_scale:new l.aI(p,e.u_buffer_scale),u_fade_t:new l.aI(p,e.u_fade_t),u_opacity:new l.aI(p,e.u_opacity),u_image0:new l.aH(p,e.u_image0),u_image1:new l.aH(p,e.u_image1),u_brightness_low:new l.aI(p,e.u_brightness_low),u_brightness_high:new l.aI(p,e.u_brightness_high),u_saturation_factor:new l.aI(p,e.u_saturation_factor),u_contrast_factor:new l.aI(p,e.u_contrast_factor),u_spin_weights:new l.aN(p,e.u_spin_weights)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new l.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(p,e.u_is_size_feature_constant),u_size_t:new l.aI(p,e.u_size_t),u_size:new l.aI(p,e.u_size),u_camera_to_center_distance:new l.aI(p,e.u_camera_to_center_distance),u_pitch:new l.aI(p,e.u_pitch),u_rotate_symbol:new l.aH(p,e.u_rotate_symbol),u_aspect_ratio:new l.aI(p,e.u_aspect_ratio),u_fade_change:new l.aI(p,e.u_fade_change),u_matrix:new l.aJ(p,e.u_matrix),u_label_plane_matrix:new l.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new l.aJ(p,e.u_coord_matrix),u_is_text:new l.aH(p,e.u_is_text),u_pitch_with_map:new l.aH(p,e.u_pitch_with_map),u_is_along_line:new l.aH(p,e.u_is_along_line),u_is_variable_anchor:new l.aH(p,e.u_is_variable_anchor),u_texsize:new l.aO(p,e.u_texsize),u_texture:new l.aH(p,e.u_texture),u_translation:new l.aO(p,e.u_translation),u_pitched_scale:new l.aI(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new l.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(p,e.u_is_size_feature_constant),u_size_t:new l.aI(p,e.u_size_t),u_size:new l.aI(p,e.u_size),u_camera_to_center_distance:new l.aI(p,e.u_camera_to_center_distance),u_pitch:new l.aI(p,e.u_pitch),u_rotate_symbol:new l.aH(p,e.u_rotate_symbol),u_aspect_ratio:new l.aI(p,e.u_aspect_ratio),u_fade_change:new l.aI(p,e.u_fade_change),u_matrix:new l.aJ(p,e.u_matrix),u_label_plane_matrix:new l.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new l.aJ(p,e.u_coord_matrix),u_is_text:new l.aH(p,e.u_is_text),u_pitch_with_map:new l.aH(p,e.u_pitch_with_map),u_is_along_line:new l.aH(p,e.u_is_along_line),u_is_variable_anchor:new l.aH(p,e.u_is_variable_anchor),u_texsize:new l.aO(p,e.u_texsize),u_texture:new l.aH(p,e.u_texture),u_gamma_scale:new l.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_is_halo:new l.aH(p,e.u_is_halo),u_translation:new l.aO(p,e.u_translation),u_pitched_scale:new l.aI(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new l.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aH(p,e.u_is_size_feature_constant),u_size_t:new l.aI(p,e.u_size_t),u_size:new l.aI(p,e.u_size),u_camera_to_center_distance:new l.aI(p,e.u_camera_to_center_distance),u_pitch:new l.aI(p,e.u_pitch),u_rotate_symbol:new l.aH(p,e.u_rotate_symbol),u_aspect_ratio:new l.aI(p,e.u_aspect_ratio),u_fade_change:new l.aI(p,e.u_fade_change),u_matrix:new l.aJ(p,e.u_matrix),u_label_plane_matrix:new l.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new l.aJ(p,e.u_coord_matrix),u_is_text:new l.aH(p,e.u_is_text),u_pitch_with_map:new l.aH(p,e.u_pitch_with_map),u_is_along_line:new l.aH(p,e.u_is_along_line),u_is_variable_anchor:new l.aH(p,e.u_is_variable_anchor),u_texsize:new l.aO(p,e.u_texsize),u_texsize_icon:new l.aO(p,e.u_texsize_icon),u_texture:new l.aH(p,e.u_texture),u_texture_icon:new l.aH(p,e.u_texture_icon),u_gamma_scale:new l.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new l.aI(p,e.u_device_pixel_ratio),u_is_halo:new l.aH(p,e.u_is_halo),u_translation:new l.aO(p,e.u_translation),u_pitched_scale:new l.aI(p,e.u_pitched_scale)}),background:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_opacity:new l.aI(p,e.u_opacity),u_color:new l.aL(p,e.u_color)}),backgroundPattern:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_opacity:new l.aI(p,e.u_opacity),u_image:new l.aH(p,e.u_image),u_pattern_tl_a:new l.aO(p,e.u_pattern_tl_a),u_pattern_br_a:new l.aO(p,e.u_pattern_br_a),u_pattern_tl_b:new l.aO(p,e.u_pattern_tl_b),u_pattern_br_b:new l.aO(p,e.u_pattern_br_b),u_texsize:new l.aO(p,e.u_texsize),u_mix:new l.aI(p,e.u_mix),u_pattern_size_a:new l.aO(p,e.u_pattern_size_a),u_pattern_size_b:new l.aO(p,e.u_pattern_size_b),u_scale_a:new l.aI(p,e.u_scale_a),u_scale_b:new l.aI(p,e.u_scale_b),u_pixel_coord_upper:new l.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.aO(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aI(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_texture:new l.aH(p,e.u_texture),u_ele_delta:new l.aI(p,e.u_ele_delta),u_fog_matrix:new l.aJ(p,e.u_fog_matrix),u_fog_color:new l.aL(p,e.u_fog_color),u_fog_ground_blend:new l.aI(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.aI(p,e.u_fog_ground_blend_opacity),u_horizon_color:new l.aL(p,e.u_horizon_color),u_horizon_fog_blend:new l.aI(p,e.u_horizon_fog_blend)}),terrainDepth:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_ele_delta:new l.aI(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_matrix:new l.aJ(p,e.u_matrix),u_texture:new l.aH(p,e.u_texture),u_terrain_coords_id:new l.aI(p,e.u_terrain_coords_id),u_ele_delta:new l.aI(p,e.u_ele_delta)}),sky:(p,e)=>({u_sky_color:new l.aL(p,e.u_sky_color),u_horizon_color:new l.aL(p,e.u_horizon_color),u_horizon:new l.aI(p,e.u_horizon),u_sky_horizon_blend:new l.aI(p,e.u_sky_horizon_blend)})};class Wr{constructor(e,r,a){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const by={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class su{constructor(e,r,a,c){this.length=r.length,this.attributes=a,this.itemSize=r.bytesPerElement,this.dynamicDraw=c,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let a=0;a<this.attributes.length;a++){const c=r.attributes[this.attributes[a].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,r,a){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],_=r.attributes[d.name];_!==void 0&&e.vertexAttribPointer(_,d.components,e[by[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ls=new WeakMap;function ps(p){var e;if(Ls.has(p))return Ls.get(p);{const r=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ls.set(p,r),r}}class gi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class sl extends gi{getDefault(){return l.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class wy extends gi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class lo extends gi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Sy extends gi{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ef extends gi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ty extends gi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class tf extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ou extends gi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class nf extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class rf extends gi{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class sf extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class of extends gi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Rs extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class af extends gi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Py extends gi{getDefault(){return l.aM.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class lf extends gi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class pa extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class Iy extends gi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ol extends gi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Cy extends gi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class ky extends gi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class cf extends gi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class uf extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class hf extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class au extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class df extends gi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class al extends gi{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class es extends gi{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const a=this.gl;ps(a)?a.bindVertexArray(e):(r=a.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class lu extends gi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class cu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class uu extends gi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ll extends gi{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class hu extends ll{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Os extends ll{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class du extends ll{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ay{constructor(e,r,a,c,d){this.context=e,this.width=r,this.height=a;const _=e.gl,w=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new hu(e,w),c)this.depthAttachment=d?new du(e,w):new Os(e,w);else if(d)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class $i{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}$i.Replace=[1,0],$i.disabled=new $i($i.Replace,l.aM.transparent,[!1,!1,!1,!1]),$i.unblended=new $i($i.Replace,l.aM.transparent,[!0,!0,!0,!0]),$i.alphaBlended=new $i([1,771],l.aM.transparent,[!0,!0,!0,!0]);class Ey{constructor(e){var r,a;if(this.gl=e,this.clearColor=new sl(this),this.clearDepth=new wy(this),this.clearStencil=new lo(this),this.colorMask=new Sy(this),this.depthMask=new ef(this),this.stencilMask=new Ty(this),this.stencilFunc=new tf(this),this.stencilOp=new ou(this),this.stencilTest=new nf(this),this.depthRange=new rf(this),this.depthTest=new sf(this),this.depthFunc=new of(this),this.blend=new Rs(this),this.blendFunc=new af(this),this.blendColor=new Py(this),this.blendEquation=new lf(this),this.cullFace=new pa(this),this.cullFaceSide=new Iy(this),this.frontFace=new ol(this),this.program=new Cy(this),this.activeTexture=new ky(this),this.viewport=new cf(this),this.bindFramebuffer=new uf(this),this.bindRenderbuffer=new hf(this),this.bindTexture=new au(this),this.bindVertexBuffer=new df(this),this.bindElementBuffer=new al(this),this.bindVertexArray=new es(this),this.pixelStoreUnpack=new lu(this),this.pixelStoreUnpackPremultiplyAlpha=new cu(this),this.pixelStoreUnpackFlipY=new uu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ps(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:c==null?void 0:c.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:c==null?void 0:c.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c==null?void 0:c.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Wr(this,e,r)}createVertexBuffer(e,r,a){return new su(this,e,r,a)}createRenderbuffer(e,r,a){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,e,r,a),this.bindRenderbuffer.set(null),d}createFramebuffer(e,r,a,c){return new Ay(this,e,r,a,c)}clear({color:e,depth:r,stencil:a}){const c=this.gl;let d=0;e&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),a!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.aE(e.blendFunction,$i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ps(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return ps(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class ei{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const cl=7680;class Ci{constructor(e,r,a,c,d,_){this.test=e,this.ref=r,this.mask=a,this.fail=c,this.depthFail=d,this.pass=_}}Ci.disabled=new Ci({func:519,mask:0},0,0,cl,cl,cl);class bi{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}let Fs;function fa(p,e,r,a,c){const d=p.context,_=d.gl,w=p.useProgram("collisionBox"),S=[];let A=0,M=0;for(let ae=0;ae<a.length;ae++){const ue=a[ae],$=e.getTile(ue).getBucket(r);if(!$)continue;const fe=c?$.textCollisionBox:$.iconCollisionBox,ge=$.collisionCircleArray;if(ge.length>0){const Se=l.H();l.aQ(Se,$.placementInvProjMatrix,p.transform.glCoordMatrix),l.aQ(Se,Se,$.placementViewportMatrix),S.push({circleArray:ge,circleOffset:M,transform:ue.posMatrix,invTransform:Se,coord:ue}),A+=ge.length/4,M=A}fe&&w.draw(d,_.LINES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,{u_matrix:ue.posMatrix,u_pixel_extrude_scale:[1/(z=p.transform).width,1/z.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(ue),r.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,null,p.transform.zoom,null,null,fe.collisionVertexBuffer)}var z;if(!c||!S.length)return;const N=p.useProgram("collisionCircle"),G=new l.aR;G.resize(4*A),G._trim();let X=0;for(const ae of S)for(let ue=0;ue<ae.circleArray.length/4;ue++){const $=4*ue,fe=ae.circleArray[$+0],ge=ae.circleArray[$+1],Se=ae.circleArray[$+2],Fe=ae.circleArray[$+3];G.emplace(X++,fe,ge,Se,Fe,0),G.emplace(X++,fe,ge,Se,Fe,1),G.emplace(X++,fe,ge,Se,Fe,2),G.emplace(X++,fe,ge,Se,Fe,3)}(!Fs||Fs.length<2*A)&&(Fs=function(ae){const ue=2*ae,$=new l.aT;$.resize(ue),$._trim();for(let fe=0;fe<ue;fe++){const ge=6*fe;$.uint16[ge+0]=4*fe+0,$.uint16[ge+1]=4*fe+1,$.uint16[ge+2]=4*fe+2,$.uint16[ge+3]=4*fe+2,$.uint16[ge+4]=4*fe+3,$.uint16[ge+5]=4*fe+0}return $}(A));const te=d.createIndexBuffer(Fs,!0),oe=d.createVertexBuffer(G,l.aS.members,!0);for(const ae of S){const ue=Ds(ae.transform,ae.invTransform,p.transform);N.draw(d,_.TRIANGLES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,ue,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae.coord),r.id,oe,te,l.a0.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,p.transform.zoom,null,null,null)}oe.destroy(),te.destroy()}bi.disabled=new bi(!1,1029,2305),bi.backCCW=new bi(!0,1029,2305);const ma=l.an(new Float32Array(16));function pu(p,e,r,a,c,d){const{horizontalAlign:_,verticalAlign:w}=l.au(p);return new l.P((-(_-.5)*e/c+a[0])*d,(-(w-.5)*r/c+a[1])*d)}function Bs(p,e,r,a,c,d){const _=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=a.mult(d);r||(w=w.rotate(-c));const S=_.add(w);return re(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(r){const w=Ee(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(a.rotate(S))}return p.add(a)}function co(p,e,r,a,c,d,_,w,S,A,M,z,N,G){const X=p.text.placedSymbolArray,te=p.text.dynamicLayoutVertexArray,oe=p.icon.dynamicLayoutVertexArray,ae={};te.clear();for(let ue=0;ue<X.length;ue++){const $=X.get(ue),fe=$.hidden||!$.crossTileID||p.allowVerticalPlacement&&!$.placedOrientation?null:a[$.crossTileID];if(fe){const ge=new l.P($.anchorX,$.anchorY),Se={getElevation:G,width:c.width,height:c.height,labelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:r,projection:M,projectionCache:null,tileAnchorPoint:ge,translation:z,unwrappedTileID:N},Fe=r?re(ge.x,ge.y,_,G):Ee(ge.x,ge.y,Se),Ke=O(c.cameraToCenterDistance,Fe.signedDistanceFromCamera);let lt=l.ai(p.textSizeData,S,$)*Ke/l.ap;r&&(lt*=p.tilePixelRatio/w);const{width:gt,height:rt,anchor:nt,textOffset:wt,textBoxScale:Zt}=fe,st=pu(nt,gt,rt,wt,Zt,lt),dt=M.getPitchedTextCorrection(c,ge.add(new l.P(z[0],z[1])),N),jt=Bs(Fe.point,Se,e,st,c.angle,dt),Mi=p.allowVerticalPlacement&&$.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Jt=0;Jt<$.numGlyphs;Jt++)l.aj(te,jt,Mi);A&&$.associatedIconIndex>=0&&(ae[$.associatedIconIndex]={shiftedAnchor:jt,angle:Mi})}else Dt($.numGlyphs,te)}if(A){oe.clear();const ue=p.icon.placedSymbolArray;for(let $=0;$<ue.length;$++){const fe=ue.get($);if(fe.hidden)Dt(fe.numGlyphs,oe);else{const ge=ae[$];if(ge)for(let Se=0;Se<fe.numGlyphs;Se++)l.aj(oe,ge.shiftedAnchor,ge.angle);else Dt(fe.numGlyphs,oe)}}p.icon.dynamicLayoutVertexBuffer.updateData(oe)}p.text.dynamicLayoutVertexBuffer.updateData(te)}function yr(p,e,r){return r.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function fu(p,e,r,a,c,d,_,w,S,A,M,z){const N=p.context,G=N.gl,X=p.transform,te=Ms(),oe=w==="map",ae=S==="map",ue=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",$=oe&&!ae&&!ue,fe=!ae&&ue,ge=!r.layout.get("symbol-sort-key").isConstant();let Se=!1;const Fe=p.depthModeForSublayer(0,ei.ReadOnly),Ke=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],gt=te.getCircleRadiusCorrection(X);for(const rt of a){const nt=e.getTile(rt),wt=nt.getBucket(r);if(!wt)continue;const Zt=c?wt.text:wt.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const st=Zt.programConfigurations.get(r.id),dt=c||wt.sdfIcons,jt=c?wt.textSizeData:wt.iconSizeData,Mi=ae||X.pitch!==0,Jt=p.useProgram(yr(dt,c,wt),st),ni=l.ag(jt,X.zoom),zi=p.style.map.terrain&&p.style.map.terrain.getTerrainData(rt);let An,zr,Di,Jn,Nn=[0,0],En=null;if(c)zr=nt.glyphAtlasTexture,Di=G.LINEAR,An=nt.glyphAtlasTexture.size,wt.iconsInText&&(Nn=nt.imageAtlasTexture.size,En=nt.imageAtlasTexture,Jn=Mi||p.options.rotating||p.options.zooming||jt.kind==="composite"||jt.kind==="camera"?G.LINEAR:G.NEAREST);else{const ai=r.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;zr=nt.imageAtlasTexture,Di=dt||p.options.rotating||p.options.zooming||ai||Mi?G.LINEAR:G.NEAREST,An=nt.imageAtlasTexture.size}const Vn=ii(nt,1,p.transform.zoom),Kr=fe?rt.posMatrix:ma,Io=hs(Kr,ae,oe,p.transform,Vn),kl=Gr(Kr,ae,oe,p.transform,Vn),Co=Gr(rt.posMatrix,ae,oe,p.transform,Vn),xr=te.translatePosition(p.transform,nt,d,_),Al=Ke&&wt.hasTextData(),Nu=r.layout.get("icon-text-fit")!=="none"&&Al&&wt.hasIconData();if(ue){const ai=p.style.map.terrain?(ko,Ao)=>p.style.map.terrain.getElevation(rt,ko,Ao):null,qs=r.layout.get("text-rotation-alignment")==="map";W(wt,rt.posMatrix,p,c,Io,Co,ae,A,qs,te,rt.toUnwrapped(),X.width,X.height,xr,ai)}const br=rt.posMatrix,wr=c&&Ke||Nu,fs=ue||wr?ma:Io,Dr=kl,wn=dt&&r.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mn;Mn=dt?wt.iconsInText?iu(jt.kind,ni,$,ae,ue,wr,p,br,fs,Dr,xr,An,Nn,gt):da(jt.kind,ni,$,ae,ue,wr,p,br,fs,Dr,xr,c,An,!0,gt):Qp(jt.kind,ni,$,ae,ue,wr,p,br,fs,Dr,xr,c,An,gt);const dr={program:Jt,buffers:Zt,uniformValues:Mn,atlasTexture:zr,atlasTextureIcon:En,atlasInterpolation:Di,atlasInterpolationIcon:Jn,isSDF:dt,hasHalo:wn};if(ge&&wt.canOverlap){Se=!0;const ai=Zt.segments.get();for(const qs of ai)lt.push({segments:new l.a0([qs]),sortKey:qs.sortKey,state:dr,terrainData:zi})}else lt.push({segments:Zt.segments,sortKey:0,state:dr,terrainData:zi})}Se&&lt.sort((rt,nt)=>rt.sortKey-nt.sortKey);for(const rt of lt){const nt=rt.state;if(N.activeTexture.set(G.TEXTURE0),nt.atlasTexture.bind(nt.atlasInterpolation,G.CLAMP_TO_EDGE),nt.atlasTextureIcon&&(N.activeTexture.set(G.TEXTURE1),nt.atlasTextureIcon&&nt.atlasTextureIcon.bind(nt.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),nt.isSDF){const wt=nt.uniformValues;nt.hasHalo&&(wt.u_is_halo=1,mu(nt.buffers,rt.segments,r,p,nt.program,Fe,M,z,wt,rt.terrainData)),wt.u_is_halo=0}mu(nt.buffers,rt.segments,r,p,nt.program,Fe,M,z,nt.uniformValues,rt.terrainData)}}function mu(p,e,r,a,c,d,_,w,S,A){const M=a.context;c.draw(M,M.gl.TRIANGLES,d,_,w,bi.disabled,S,A,r.id,p.layoutVertexBuffer,p.indexBuffer,e,r.paint,a.transform.zoom,p.programConfigurations.get(r.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function gu(p,e,r,a){const c=p.context,d=c.gl,_=Ci.disabled,w=new $i([d.ONE,d.ONE],l.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(r);if(!S)return;const A=a.key;let M=r.heatmapFbos.get(A);M||(M=ga(c,e.tileSize,e.tileSize),r.heatmapFbos.set(A,M)),c.bindFramebuffer.set(M.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:l.aM.transparent});const z=S.programConfigurations.get(r.id),N=p.useProgram("heatmap",z),G=p.style.map.terrain.getTerrainData(a);N.draw(c,d.TRIANGLES,ei.disabled,_,w,bi.disabled,$n(a.posMatrix,e,p.transform.zoom,r.paint.get("heatmap-intensity")),G,r.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,r.paint,p.transform.zoom,z)}function Ns(p,e,r){const a=p.context,c=a.gl;a.setColorMode(p.colorModeForRenderPass());const d=ya(a,e),_=r.key,w=e.heatmapFbos.get(_);w&&(a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,w.colorAttachment.get()),a.activeTexture.set(c.TEXTURE1),d.bind(c.LINEAR,c.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(a,c.TRIANGLES,ei.disabled,Ci.disabled,p.colorModeForRenderPass(),bi.disabled,tl(p,e,0,1),null,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,p.transform.zoom),w.destroy(),e.heatmapFbos.delete(_))}function ga(p,e,r){var a,c;const d=p.gl,_=d.createTexture();d.bindTexture(d.TEXTURE_2D,_),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const w=(a=p.HALF_FLOAT)!==null&&a!==void 0?a:d.UNSIGNED_BYTE,S=(c=p.RGBA16F)!==null&&c!==void 0?c:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,S,e,r,0,d.RGBA,w,null);const A=p.createFramebuffer(e,r,!1,!1);return A.colorAttachment.set(_),A}function ya(p,e){return e.colorRampTexture||(e.colorRampTexture=new Be(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function uo(p,e,r,a,c){if(!r||!a||!a.imageAtlas)return;const d=a.imageAtlas.patternPositions;let _=d[r.to.toString()],w=d[r.from.toString()];if(!_&&w&&(_=w),!w&&_&&(w=_),!_||!w){const S=c.getPaintProperty(e);_=d[S],w=d[S]}_&&w&&p.setConstantPatternPositions(_,w)}function _a(p,e,r,a,c,d,_){const w=p.context.gl,S="fill-pattern",A=r.paint.get(S),M=A&&A.constantOr(1),z=r.getCrossfadeParameters();let N,G,X,te,oe;_?(G=M&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=w.LINES):(G=M?"fillPattern":"fill",N=w.TRIANGLES);const ae=A.constantOr(null);for(const ue of a){const $=e.getTile(ue);if(M&&!$.patternsLoaded())continue;const fe=$.getBucket(r);if(!fe)continue;const ge=fe.programConfigurations.get(r.id),Se=p.useProgram(G,ge),Fe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ue);M&&(p.context.activeTexture.set(w.TEXTURE0),$.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ge.updatePaintBuffers(z)),uo(ge,S,ae,$,r);const Ke=Fe?ue:null,lt=p.translatePosMatrix(Ke?Ke.posMatrix:ue.posMatrix,$,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(_){te=fe.indexBuffer2,oe=fe.segments2;const gt=[w.drawingBufferWidth,w.drawingBufferHeight];X=G==="fillOutlinePattern"&&M?Kp(lt,p,z,$,gt):gy(lt,gt)}else te=fe.indexBuffer,oe=fe.segments,X=M?Xp(lt,p,z,$):oo(lt);Se.draw(p.context,N,c,p.stencilModeForClipping(ue),d,bi.disabled,X,Fe,r.id,fe.layoutVertexBuffer,te,oe,r.paint,p.transform.zoom,ge)}}function ul(p,e,r,a,c,d,_){const w=p.context,S=w.gl,A="fill-extrusion-pattern",M=r.paint.get(A),z=M.constantOr(1),N=r.getCrossfadeParameters(),G=r.paint.get("fill-extrusion-opacity"),X=M.constantOr(null);for(const te of a){const oe=e.getTile(te),ae=oe.getBucket(r);if(!ae)continue;const ue=p.style.map.terrain&&p.style.map.terrain.getTerrainData(te),$=ae.programConfigurations.get(r.id),fe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",$);z&&(p.context.activeTexture.set(S.TEXTURE0),oe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),$.updatePaintBuffers(N)),uo($,A,X,oe,r);const ge=p.translatePosMatrix(te.posMatrix,oe,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Se=r.paint.get("fill-extrusion-vertical-gradient"),Fe=z?el(ge,p,Se,G,te,N,oe):ua(ge,p,Se,G);fe.draw(w,w.gl.TRIANGLES,c,d,_,bi.backCCW,Fe,ue,r.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,r.paint,p.transform.zoom,$,p.style.map.terrain&&ae.centroidVertexBuffer)}}function ho(p,e,r,a,c,d,_){const w=p.context,S=w.gl,A=r.fbo;if(!A)return;const M=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(e);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),M.draw(w,S.TRIANGLES,c,d,_,bi.disabled,((N,G,X,te)=>{const oe=X.paint.get("hillshade-shadow-color"),ae=X.paint.get("hillshade-highlight-color"),ue=X.paint.get("hillshade-accent-color");let $=X.paint.get("hillshade-illumination-direction")*(Math.PI/180);X.paint.get("hillshade-illumination-anchor")==="viewport"&&($-=N.transform.angle);const fe=!N.options.moving;return{u_matrix:te?te.posMatrix:N.transform.calculatePosMatrix(G.tileID.toUnwrapped(),fe),u_image:0,u_latrange:il(0,G.tileID),u_light:[X.paint.get("hillshade-exaggeration"),$],u_shadow:oe,u_highlight:ae,u_accent:ue}})(p,r,a,z?e:null),z,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function po(p,e,r,a,c,d){const _=p.context,w=_.gl,S=e.dem;if(S&&S.data){const A=S.dim,M=S.stride,z=S.getPixels();if(_.activeTexture.set(w.TEXTURE1),_.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||p.getTileTexture(M),e.demTexture){const G=e.demTexture;G.update(z,{premultiply:!1}),G.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new Be(_,z,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);_.activeTexture.set(w.TEXTURE0);let N=e.fbo;if(!N){const G=new Be(_,{width:A,height:A,data:null},w.RGBA);G.bind(w.LINEAR,w.CLAMP_TO_EDGE),N=e.fbo=_.createFramebuffer(A,A,!0,!1),N.colorAttachment.set(G.texture)}_.bindFramebuffer.set(N.framebuffer),_.viewport.set([0,0,A,A]),p.useProgram("hillshadePrepare").draw(_,w.TRIANGLES,a,c,d,bi.disabled,((G,X)=>{const te=X.stride,oe=l.H();return l.aP(oe,0,l.X,-l.X,0,0,1),l.J(oe,oe,[0,-l.X,0]),{u_matrix:oe,u_image:1,u_dimension:[te,te],u_zoom:G.overscaledZ,u_unpack:X.getUnpackVector()}})(e.tileID,S),null,r.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function pf(p,e,r,a,c,d){const _=a.paint.get("raster-fade-duration");if(!d&&_>0){const w=B.now(),S=(w-p.timeAdded)/_,A=e?(w-e.timeAdded)/_:-1,M=r.getSource(),z=c.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),N=!e||Math.abs(e.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),G=N&&p.refreshedUponExpiration?1:l.ac(N?S:1-A,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const yu=new l.aM(1,0,0,1),di=new l.aM(0,1,0,1),hl=new l.aM(0,0,1,1),My=new l.aM(1,0,1,1),ff=new l.aM(0,1,1,1);function fo(p,e,r,a){dl(p,0,e+r/2,p.transform.width,r,a)}function mf(p,e,r,a){dl(p,e-r/2,0,r,p.transform.height,a)}function dl(p,e,r,a,c,d){const _=p.context,w=_.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,r*p.pixelRatio,a*p.pixelRatio,c*p.pixelRatio),_.clear({color:d}),w.disable(w.SCISSOR_TEST)}function gf(p,e,r){const a=p.context,c=a.gl,d=r.posMatrix,_=p.useProgram("debug"),w=ei.disabled,S=Ci.disabled,A=p.colorModeForRenderPass(),M="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(r);a.activeTexture.set(c.TEXTURE0);const N=e.getTileByID(r.key).latestRawTileData,G=Math.floor((N&&N.byteLength||0)/1024),X=e.getTile(r).tileSize,te=512/Math.min(X,512)*(r.overscaledZ/p.transform.zoom)*.5;let oe=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(oe+=` => ${r.overscaledZ}`),function(ae,ue){ae.initDebugOverlayCanvas();const $=ae.debugOverlayCanvas,fe=ae.context.gl,ge=ae.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,$.width,$.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(ue,5,5),ge.strokeText(ue,5,5),ae.debugOverlayTexture.update($),ae.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(p,`${oe} ${G}kB`),_.draw(a,c.TRIANGLES,w,S,$i.alphaBlended,bi.disabled,ha(d,l.aM.transparent,te),null,M,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),_.draw(a,c.LINE_STRIP,w,S,A,bi.disabled,ha(d,l.aM.red),z,M,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function yf(p,e,r){const a=p.context,c=a.gl,d=p.colorModeForRenderPass(),_=new ei(c.LEQUAL,ei.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),S=e.getTerrainMesh();a.bindFramebuffer.set(null),a.viewport.set([0,0,p.width,p.height]);for(const A of r){const M=p.renderToTexture.getTexture(A),z=e.getTerrainData(A.tileID);a.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,M.texture);const N=p.transform.calculatePosMatrix(A.tileID.toUnwrapped()),G=e.getMeshFrameDelta(p.transform.zoom),X=p.transform.calculateFogMatrix(A.tileID.toUnwrapped()),te=eu(N,G,X,p.style.sky,p.transform.pitch);w.draw(a,c.TRIANGLES,_,Ci.disabled,d,bi.backCCW,te,z,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class pl{constructor(e,r,a){this.vertexBuffer=e,this.indexBuffer=r,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class fl{constructor(e,r){this.context=new Ey(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ft.maxUnderzooming+Ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yc}resize(e,r,a){if(this.width=Math.floor(e*a),this.height=Math.floor(r*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,r=new l.aX;r.emplaceBack(0,0),r.emplaceBack(l.X,0),r.emplaceBack(0,l.X),r.emplaceBack(l.X,l.X),this.tileExtentBuffer=e.createVertexBuffer(r,zs.members),this.tileExtentSegments=l.a0.simpleSegment(0,0,4,2);const a=new l.aX;a.emplaceBack(0,0),a.emplaceBack(l.X,0),a.emplaceBack(0,l.X),a.emplaceBack(l.X,l.X),this.debugBuffer=e.createVertexBuffer(a,zs.members),this.debugSegments=l.a0.simpleSegment(0,0,4,5);const c=new l.$;c.emplaceBack(0,0,0,0),c.emplaceBack(l.X,0,l.X,0),c.emplaceBack(0,l.X,0,l.X),c.emplaceBack(l.X,l.X,l.X,l.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,_n.members),this.rasterBoundsSegments=l.a0.simpleSegment(0,0,4,2);const d=new l.aX;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(d,zs.members),this.viewportSegments=l.a0.simpleSegment(0,0,4,2);const _=new l.aZ;_.emplaceBack(0),_.emplaceBack(1),_.emplaceBack(3),_.emplaceBack(2),_.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(_);const w=new l.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const S=this.context.gl;this.stencilClearMode=new Ci({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=l.H();l.aP(a,0,this.width,this.height,0,0,1),l.K(a,a,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,ei.disabled,this.stencilClearMode,$i.disabled,bi.disabled,Kn(a),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source;const a=this.context,c=a.gl;this.nextStencilID+r.length>256&&this.clearStencil(),a.setColorMode($i.disabled),a.setDepthMode(ei.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const _ of r){const w=this._tileClippingMaskIDs[_.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(_);d.draw(a,c.TRIANGLES,ei.disabled,new Ci({func:c.ALWAYS,mask:0},w,255,c.KEEP,c.KEEP,c.REPLACE),$i.disabled,bi.disabled,Kn(_.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new Ci({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new Ci({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(e){const r=this.context.gl,a=e.sort((_,w)=>w.overscaledZ-_.overscaledZ),c=a[a.length-1].overscaledZ,d=a[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const _={};for(let w=0;w<d;w++)_[w+c]=new Ci({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=d,[_,a]}return[{[c]:Ci.disabled},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new $i([e.CONSTANT_COLOR,e.ONE],new l.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$i.unblended:$i.alphaBlended}depthModeForSublayer(e,r,a){if(!this.opaquePassEnabledForLayer())return ei.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new ei(a||this.context.gl.LEQUAL,r,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(B.now()),this.imageManager.beginFrame();const a=this.style._order,c=this.style.sourceCaches,d={},_={},w={};for(const S in c){const A=c[S];A.used&&A.prepare(this.context),d[S]=A.getVisibleCoordinates(),_[S]=d[S].slice().reverse(),w[S]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<a.length;S++)if(this.style._layers[a[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of a){const A=this.style._layers[S];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const M=_[A.source];(A.type==="custom"||M.length)&&this.renderLayer(this,c[A.source],A,M)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?l.aM.black:l.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,A){const M=S.context,z=M.gl,N=((ae,ue,$)=>({u_sky_color:ae.properties.get("sky-color"),u_horizon_color:ae.properties.get("horizon-color"),u_horizon:(ue.height/2+ue.getHorizon())*$,u_sky_horizon_blend:ae.properties.get("sky-horizon-blend")*ue.height/2*$}))(A,S.style.map.transform,S.pixelRatio),G=new ei(z.LEQUAL,ei.ReadWrite,[0,1]),X=Ci.disabled,te=S.colorModeForRenderPass(),oe=S.useProgram("sky");if(!A.mesh){const ae=new l.aX;ae.emplaceBack(-1,-1),ae.emplaceBack(1,-1),ae.emplaceBack(1,1),ae.emplaceBack(-1,1);const ue=new l.aY;ue.emplaceBack(0,1,2),ue.emplaceBack(0,2,3),A.mesh=new pl(M.createVertexBuffer(ae,zs.members),M.createIndexBuffer(ue),l.a0.simpleSegment(0,0,ae.length,ue.length))}oe.draw(M,z.TRIANGLES,G,X,te,bi.disabled,N,void 0,"sky",A.mesh.vertexBuffer,A.mesh.indexBuffer,A.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[a[this.currentLayer]],A=c[S.source],M=d[S.source];this._renderTileClippingMasks(S,M),this.renderLayer(this,A,S,M)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const S=this.style._layers[a[this.currentLayer]],A=c[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const M=(S.type==="symbol"?w:_)[S.source];this._renderTileClippingMasks(S,d[S.source]),this.renderLayer(this,A,S,M)}if(this.options.showTileBoundaries){const S=function(A,M){let z=null;const N=Object.values(A._layers).flatMap(oe=>oe.source&&!oe.isHidden(M)?[A.sourceCaches[oe.source]]:[]),G=N.filter(oe=>oe.getSource().type==="vector"),X=N.filter(oe=>oe.getSource().type!=="vector"),te=oe=>{(!z||z.getSource().maxzoom<oe.getSource().maxzoom)&&(z=oe)};return G.forEach(oe=>te(oe)),z||X.forEach(oe=>te(oe)),z}(this.style,this.transform.zoom);S&&function(A,M,z){for(let N=0;N<z.length;N++)gf(A,M,z[N])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const A=S.transform.padding;fo(S,S.transform.height-(A.top||0),3,yu),fo(S,A.bottom||0,3,di),mf(S,A.left||0,3,hl),mf(S,S.transform.width-(A.right||0),3,My);const M=S.transform.centerPoint;(function(z,N,G,X){dl(z,N-1,G-10,2,20,X),dl(z,N-10,G-1,20,2,X)})(S,M.x,S.transform.height-M.y,ff)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!l.a_(r,a):!l.a$(r,a)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(l.b0(r,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,_){const w=d.context,S=w.gl,A=$i.unblended,M=new ei(S.LEQUAL,ei.ReadWrite,[0,1]),z=_.getTerrainMesh(),N=_.sourceCache.getRenderableTiles(),G=d.useProgram("terrainDepth");w.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:l.aM.transparent,depth:1});for(const X of N){const te=_.getTerrainData(X.tileID),oe={u_matrix:d.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};G.draw(w,S.TRIANGLES,M,Ci.disabled,A,bi.backCCW,oe,te,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,_){const w=d.context,S=w.gl,A=$i.unblended,M=new ei(S.LEQUAL,ei.ReadWrite,[0,1]),z=_.getTerrainMesh(),N=_.getCoordsTexture(),G=_.sourceCache.getRenderableTiles(),X=d.useProgram("terrainCoords");w.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:l.aM.transparent,depth:1}),_.coordsIndex=[];for(const te of G){const oe=_.getTerrainData(te.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,N.texture);const ae={u_matrix:d.transform.calculatePosMatrix(te.tileID.toUnwrapped()),u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(d.transform.zoom)};X.draw(w,S.TRIANGLES,M,Ci.disabled,A,bi.backCCW,ae,oe,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),_.coordsIndex.push(te.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,r,a,c){if(!a.isHidden(this.transform.zoom)&&(a.type==="background"||a.type==="custom"||(c||[]).length))switch(this.id=a.id,a.type){case"symbol":(function(d,_,w,S,A){if(d.renderPass!=="translucent")return;const M=Ci.disabled,z=d.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,G,X,te,oe,ae,ue,$,fe){const ge=G.transform,Se=Ms(),Fe=oe==="map",Ke=ae==="map";for(const lt of N){const gt=te.getTile(lt),rt=gt.getBucket(X);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const nt=l.ag(rt.textSizeData,ge.zoom),wt=ii(gt,1,G.transform.zoom),Zt=hs(lt.posMatrix,Ke,Fe,G.transform,wt),st=X.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(nt){const dt=Math.pow(2,ge.zoom-gt.tileID.overscaledZ),jt=G.style.map.terrain?(Jt,ni)=>G.style.map.terrain.getElevation(lt,Jt,ni):null,Mi=Se.translatePosition(ge,gt,ue,$);co(rt,Fe,Ke,fe,ge,Zt,lt.posMatrix,dt,nt,st,Se,Mi,lt.toUnwrapped(),jt)}}}(S,d,w,_,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&fu(d,_,w,S,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),M,z),w.paint.get("text-opacity").constantOr(1)!==0&&fu(d,_,w,S,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),M,z),_.map.showCollisionBoxes&&(fa(d,_,w,S,!0),fa(d,_,w,S,!1))})(e,r,a,c,this.style.placement.variableOffsets);break;case"circle":(function(d,_,w,S){if(d.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),M=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),N=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(M.constantOr(1)===0||z.constantOr(1)===0))return;const G=d.context,X=G.gl,te=d.depthModeForSublayer(0,ei.ReadOnly),oe=Ci.disabled,ae=d.colorModeForRenderPass(),ue=[];for(let $=0;$<S.length;$++){const fe=S[$],ge=_.getTile(fe),Se=ge.getBucket(w);if(!Se)continue;const Fe=Se.programConfigurations.get(w.id),Ke=d.useProgram("circle",Fe),lt=Se.layoutVertexBuffer,gt=Se.indexBuffer,rt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(fe),nt={programConfiguration:Fe,program:Ke,layoutVertexBuffer:lt,indexBuffer:gt,uniformValues:yy(d,fe,ge,w),terrainData:rt};if(N){const wt=Se.segments.get();for(const Zt of wt)ue.push({segments:new l.a0([Zt]),sortKey:Zt.sortKey,state:nt})}else ue.push({segments:Se.segments,sortKey:0,state:nt})}N&&ue.sort(($,fe)=>$.sortKey-fe.sortKey);for(const $ of ue){const{programConfiguration:fe,program:ge,layoutVertexBuffer:Se,indexBuffer:Fe,uniformValues:Ke,terrainData:lt}=$.state;ge.draw(G,X.TRIANGLES,te,oe,ae,bi.disabled,Ke,lt,w.id,Se,Fe,$.segments,w.paint,d.transform.zoom,fe)}})(e,r,a,c);break;case"heatmap":(function(d,_,w,S){if(w.paint.get("heatmap-opacity")===0)return;const A=d.context;if(d.style.map.terrain){for(const M of S){const z=_.getTile(M);_.hasRenderableParent(M)||(d.renderPass==="offscreen"?gu(d,z,w,M):d.renderPass==="translucent"&&Ns(d,w,M))}A.viewport.set([0,0,d.width,d.height])}else d.renderPass==="offscreen"?function(M,z,N,G){const X=M.context,te=X.gl,oe=Ci.disabled,ae=new $i([te.ONE,te.ONE],l.aM.transparent,[!0,!0,!0,!0]);(function(ue,$,fe){const ge=ue.gl;ue.activeTexture.set(ge.TEXTURE1),ue.viewport.set([0,0,$.width/4,$.height/4]);let Se=fe.heatmapFbos.get(l.aU);Se?(ge.bindTexture(ge.TEXTURE_2D,Se.colorAttachment.get()),ue.bindFramebuffer.set(Se.framebuffer)):(Se=ga(ue,$.width/4,$.height/4),fe.heatmapFbos.set(l.aU,Se))})(X,M,N),X.clear({color:l.aM.transparent});for(let ue=0;ue<G.length;ue++){const $=G[ue];if(z.hasRenderableParent($))continue;const fe=z.getTile($),ge=fe.getBucket(N);if(!ge)continue;const Se=ge.programConfigurations.get(N.id),Fe=M.useProgram("heatmap",Se),{zoom:Ke}=M.transform;Fe.draw(X,te.TRIANGLES,ei.disabled,oe,ae,bi.disabled,$n($.posMatrix,fe,Ke,N.paint.get("heatmap-intensity")),null,N.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,N.paint,M.transform.zoom,Se)}X.viewport.set([0,0,M.width,M.height])}(d,_,w,S):d.renderPass==="translucent"&&function(M,z){const N=M.context,G=N.gl;N.setColorMode(M.colorModeForRenderPass());const X=z.heatmapFbos.get(l.aU);X&&(N.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,X.colorAttachment.get()),N.activeTexture.set(G.TEXTURE1),ya(N,z).bind(G.LINEAR,G.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(N,G.TRIANGLES,ei.disabled,Ci.disabled,M.colorModeForRenderPass(),bi.disabled,tl(M,z,0,1),null,z.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,z.paint,M.transform.zoom))}(d,w)})(e,r,a,c);break;case"line":(function(d,_,w,S){if(d.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),M=w.paint.get("line-width");if(A.constantOr(1)===0||M.constantOr(1)===0)return;const z=d.depthModeForSublayer(0,ei.ReadOnly),N=d.colorModeForRenderPass(),G=w.paint.get("line-dasharray"),X=w.paint.get("line-pattern"),te=X.constantOr(1),oe=w.paint.get("line-gradient"),ae=w.getCrossfadeParameters(),ue=te?"linePattern":G?"lineSDF":oe?"lineGradient":"line",$=d.context,fe=$.gl;let ge=!0;for(const Se of S){const Fe=_.getTile(Se);if(te&&!Fe.patternsLoaded())continue;const Ke=Fe.getBucket(w);if(!Ke)continue;const lt=Ke.programConfigurations.get(w.id),gt=d.context.program.get(),rt=d.useProgram(ue,lt),nt=ge||rt.program!==gt,wt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Se),Zt=X.constantOr(null);if(Zt&&Fe.imageAtlas){const jt=Fe.imageAtlas,Mi=jt.patternPositions[Zt.to.toString()],Jt=jt.patternPositions[Zt.from.toString()];Mi&&Jt&&lt.setConstantPatternPositions(Mi,Jt)}const st=wt?Se:null,dt=te?ao(d,Fe,w,ae,st):G?_y(d,Fe,w,G,ae,st):oe?$p(d,Fe,w,Ke.lineClipsArray.length,st):nl(d,Fe,w,st);if(te)$.activeTexture.set(fe.TEXTURE0),Fe.imageAtlasTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),lt.updatePaintBuffers(ae);else if(G&&(nt||d.lineAtlas.dirty))$.activeTexture.set(fe.TEXTURE0),d.lineAtlas.bind($);else if(oe){const jt=Ke.gradients[w.id];let Mi=jt.texture;if(w.gradientVersion!==jt.version){let Jt=256;if(w.stepInterpolant){const ni=_.getSource().maxzoom,zi=Se.canonical.z===ni?Math.ceil(1<<d.transform.maxZoom-Se.canonical.z):1;Jt=l.ac(l.aV(Ke.maxLineLength/l.X*1024*zi),256,$.maxTextureSize)}jt.gradient=l.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Jt,image:jt.gradient||void 0,clips:Ke.lineClipsArray}),jt.texture?jt.texture.update(jt.gradient):jt.texture=new Be($,jt.gradient,fe.RGBA),jt.version=w.gradientVersion,Mi=jt.texture}$.activeTexture.set(fe.TEXTURE0),Mi.bind(w.stepInterpolant?fe.NEAREST:fe.LINEAR,fe.CLAMP_TO_EDGE)}rt.draw($,fe.TRIANGLES,z,d.stencilModeForClipping(Se),N,bi.disabled,dt,wt,w.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,w.paint,d.transform.zoom,lt,Ke.layoutVertexBuffer2),ge=!1}})(e,r,a,c);break;case"fill":(function(d,_,w,S){const A=w.paint.get("fill-color"),M=w.paint.get("fill-opacity");if(M.constantOr(1)===0)return;const z=d.colorModeForRenderPass(),N=w.paint.get("fill-pattern"),G=d.opaquePassEnabledForLayer()&&!N.constantOr(1)&&A.constantOr(l.aM.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===G){const X=d.depthModeForSublayer(1,d.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly);_a(d,_,w,S,X,z,!1)}if(d.renderPass==="translucent"&&w.paint.get("fill-antialias")){const X=d.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly);_a(d,_,w,S,X,z,!0)}})(e,r,a,c);break;case"fill-extrusion":(function(d,_,w,S){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&d.renderPass==="translucent"){const M=new ei(d.context.gl.LEQUAL,ei.ReadWrite,d.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))ul(d,_,w,S,M,Ci.disabled,$i.disabled),ul(d,_,w,S,M,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const z=d.colorModeForRenderPass();ul(d,_,w,S,M,Ci.disabled,z)}}})(e,r,a,c);break;case"hillshade":(function(d,_,w,S){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const A=d.context,M=d.depthModeForSublayer(0,ei.ReadOnly),z=d.colorModeForRenderPass(),[N,G]=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S];for(const X of G){const te=_.getTile(X);te.needsHillshadePrepare!==void 0&&te.needsHillshadePrepare&&d.renderPass==="offscreen"?po(d,te,w,M,Ci.disabled,z):d.renderPass==="translucent"&&ho(d,X,te,w,M,N[X.overscaledZ],z)}A.viewport.set([0,0,d.width,d.height])})(e,r,a,c);break;case"raster":(function(d,_,w,S){if(d.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!S.length)return;const A=d.context,M=A.gl,z=_.getSource(),N=d.useProgram("raster"),G=d.colorModeForRenderPass(),[X,te]=z instanceof Xn?[{},S]:d.stencilConfigForOverlap(S),oe=te[te.length-1].overscaledZ,ae=!d.options.moving;for(const ue of te){const $=d.depthModeForSublayer(ue.overscaledZ-oe,w.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,M.LESS),fe=_.getTile(ue);fe.registerFadeDuration(w.paint.get("raster-fade-duration"));const ge=_.findLoadedParent(ue,0),Se=_.findLoadedSibling(ue),Fe=pf(fe,ge||Se||null,_,w,d.transform,d.style.map.terrain);let Ke,lt;const gt=w.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;A.activeTexture.set(M.TEXTURE0),fe.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(M.TEXTURE1),ge?(ge.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Ke=Math.pow(2,ge.tileID.overscaledZ-fe.tileID.overscaledZ),lt=[fe.tileID.canonical.x*Ke%1,fe.tileID.canonical.y*Ke%1]):fe.texture.bind(gt,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&A.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const rt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ue),nt=rt?ue:null,wt=nt?nt.posMatrix:d.transform.calculatePosMatrix(ue.toUnwrapped(),ae),Zt=vy(wt,lt||[0,0],Ke||1,Fe,w);z instanceof Xn?N.draw(A,M.TRIANGLES,$,Ci.disabled,G,bi.disabled,Zt,rt,w.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments):N.draw(A,M.TRIANGLES,$,X[ue.overscaledZ],G,bi.disabled,Zt,rt,w.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(e,r,a,c);break;case"background":(function(d,_,w,S){const A=w.paint.get("background-color"),M=w.paint.get("background-opacity");if(M===0)return;const z=d.context,N=z.gl,G=d.transform,X=G.tileSize,te=w.paint.get("background-pattern");if(d.isPatternMissing(te))return;const oe=!te&&A.a===1&&M===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==oe)return;const ae=Ci.disabled,ue=d.depthModeForSublayer(0,oe==="opaque"?ei.ReadWrite:ei.ReadOnly),$=d.colorModeForRenderPass(),fe=d.useProgram(te?"backgroundPattern":"background"),ge=S||G.coveringTiles({tileSize:X,terrain:d.style.map.terrain});te&&(z.activeTexture.set(N.TEXTURE0),d.imageManager.bind(d.context));const Se=w.getCrossfadeParameters();for(const Fe of ge){const Ke=S?Fe.posMatrix:d.transform.calculatePosMatrix(Fe.toUnwrapped()),lt=te?nu(Ke,M,d,te,{tileID:Fe,tileSize:X},Se):rl(Ke,M,A),gt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Fe);fe.draw(z,N.TRIANGLES,ue,ae,$,bi.disabled,lt,gt,w.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(e,0,a,c);break;case"custom":(function(d,_,w){const S=d.context,A=w.implementation;if(d.renderPass==="offscreen"){const M=A.prerender;M&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),M.call(A,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(Ci.disabled);const M=A.renderingMode==="3d"?new ei(d.context.gl.LEQUAL,ei.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,ei.ReadOnly);S.setDepthMode(M),A.render(S.gl,d.transform.customLayerMatrix(),{farZ:d.transform.farZ,nearZ:d.transform.nearZ,fov:d.transform._fov,modelViewProjectionMatrix:d.transform.modelViewProjectionMatrix,projectionMatrix:d.transform.projectionMatrix}),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,a)}}translatePosMatrix(e,r,a,c,d){if(!a[0]&&!a[1])return e;const _=d?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(_){const A=Math.sin(_),M=Math.cos(_);a=[a[0]*M-a[1]*A,a[0]*A+a[1]*M]}const w=[d?a[0]:ii(r,a[0],this.transform.zoom),d?a[1]:ii(r,a[1],this.transform.zoom),0],S=new Float32Array(16);return l.J(S,e,w),S}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!r||!a}useProgram(e,r){this.cache=this.cache||{};const a=e+(r?r.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[a]||(this.cache[a]=new tu(this.context,ds[e],r,ru[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}class mo{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a){const c=Math.pow(2,a),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=1/(w=l.af([],w,e))[3]/r*c;return l.b1(w,w,[S,S,1/w[3],S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=function(N,G){var X=G[0],te=G[1],oe=G[2],ae=X*X+te*te+oe*oe;return ae>0&&(ae=1/Math.sqrt(ae)),N[0]=G[0]*ae,N[1]=G[1]*ae,N[2]=G[2]*ae,N}([],function(N,G,X){var te=G[0],oe=G[1],ae=G[2],ue=X[0],$=X[1],fe=X[2];return N[0]=oe*fe-ae*$,N[1]=ae*ue-te*fe,N[2]=te*$-oe*ue,N}([],$e([],d[w[0]],d[w[1]]),$e([],d[w[2]],d[w[1]]))),A=-((M=S)[0]*(z=d[w[1]])[0]+M[1]*z[1]+M[2]*z[2]);var M,z;return S.concat(A)});return new mo(d,_)}}class go{constructor(e,r){this.min=e,this.max=r,this.center=function(a,c,d){return a[0]=.5*c[0],a[1]=.5*c[1],a[2]=.5*c[2],a}([],function(a,c,d){return a[0]=c[0]+d[0],a[1]=c[1]+d[1],a[2]=c[2]+d[2],a}([],this.min,this.max))}quadrant(e){const r=[e%2==0,e<2],a=ze(this.min),c=ze(this.max);for(let d=0;d<r.length;d++)a[d]=r[d]?this.min[d]:this.center[d],c[d]=r[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new go(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let a=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let _=0;for(let w=0;w<r.length;w++)l.b2(d,r[w])>=0&&_++;if(_===0)return 0;_!==r.length&&(a=!1)}if(a)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const S=e.points[w][c]-this.min[c];d=Math.min(d,S),_=Math.max(_,S)}if(_<0||d>this.max[c]-this.min[c])return 0}return 1}}class yo{constructor(e=0,r=0,a=0,c=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=a,this.right=c}interpolate(e,r,a){return r.top!=null&&e.top!=null&&(this.top=l.y.number(e.top,r.top,a)),r.bottom!=null&&e.bottom!=null&&(this.bottom=l.y.number(e.bottom,r.bottom,a)),r.left!=null&&e.left!=null&&(this.left=l.y.number(e.left,r.left,a)),r.right!=null&&e.right!=null&&(this.right=l.y.number(e.right,r.right,a)),this}getCenter(e,r){const a=l.ac((this.left+e-this.right)/2,0,e),c=l.ac((this.top+r-this.bottom)/2,0,r);return new l.P(a,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new yo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _u=85.051129;class _o{constructor(e,r,a,c,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=a??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new yo,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new _o(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const r=-l.b3(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=function(){var a=new l.A(4);return l.A!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a}(),function(a,c,d){var _=c[0],w=c[1],S=c[2],A=c[3],M=Math.sin(d),z=Math.cos(d);a[0]=_*z+S*M,a[1]=w*z+A*M,a[2]=_*-M+S*z,a[3]=w*-M+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const r=l.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const r=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,a){this._unmodified=!1,this._edgeInsets.interpolate(e,r,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const r=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(e){const r=[new l.b4(0,e)];if(this._renderWorldCopies){const a=this.pointCoordinate(new l.P(0,0)),c=this.pointCoordinate(new l.P(this.width,0)),d=this.pointCoordinate(new l.P(this.width,this.height)),_=this.pointCoordinate(new l.P(0,this.height)),w=Math.floor(Math.min(a.x,c.x,d.x,_.x)),S=Math.floor(Math.max(a.x,c.x,d.x,_.x)),A=1;for(let M=w-A;M<=S+A;M++)M!==0&&r.push(new l.b4(M,e))}return r}coveringTiles(e){var r,a;let c=this.coveringZoomLevel(e);const d=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const _=this.pointCoordinate(this.getCameraPoint()),w=l.Z.fromLngLat(this.center),S=Math.pow(2,c),A=[S*_.x,S*_.y,0],M=[S*w.x,S*w.y,0],z=mo.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let N=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=c);const G=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,X=$=>({aabb:new go([$*S,0,0],[($+1)*S,S,0]),zoom:0,x:0,y:0,wrap:$,fullyVisible:!1}),te=[],oe=[],ae=c,ue=e.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let $=1;$<=3;$++)te.push(X(-$)),te.push(X($));for(te.push(X(0));te.length>0;){const $=te.pop(),fe=$.x,ge=$.y;let Se=$.fullyVisible;if(!Se){const rt=$.aabb.intersects(z);if(rt===0)continue;Se=rt===2}const Fe=e.terrain?A:M,Ke=$.aabb.distanceX(Fe),lt=$.aabb.distanceY(Fe),gt=Math.max(Math.abs(Ke),Math.abs(lt));if($.zoom===ae||gt>G+(1<<ae-$.zoom)-2&&$.zoom>=N){const rt=ae-$.zoom,nt=A[0]-.5-(fe<<rt),wt=A[1]-.5-(ge<<rt);oe.push({tileID:new l.S($.zoom===ae?ue:$.zoom,$.wrap,$.zoom,fe,ge),distanceSq:xt([M[0]-.5-fe,M[1]-.5-ge]),tileDistanceToCamera:Math.sqrt(nt*nt+wt*wt)})}else for(let rt=0;rt<4;rt++){const nt=(fe<<1)+rt%2,wt=(ge<<1)+(rt>>1),Zt=$.zoom+1;let st=$.aabb.quadrant(rt);if(e.terrain){const dt=new l.S(Zt,$.wrap,Zt,nt,wt),jt=e.terrain.getMinMaxElevation(dt),Mi=(r=jt.minElevation)!==null&&r!==void 0?r:this.elevation,Jt=(a=jt.maxElevation)!==null&&a!==void 0?a:this.elevation;st=new go([st.min[0],st.min[1],Mi],[st.max[0],st.max[1],Jt])}te.push({aabb:st,zoom:Zt,x:nt,y:wt,wrap:$.wrap,fullyVisible:Se})}}return oe.sort(($,fe)=>$.distanceSq-fe.distanceSq).map($=>$.tileID)}resize(e,r){this.width=e,this.height=r,this.pixelsToGLUnits=[2/e,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const r=l.ac(e.lat,-85.051129,_u);return new l.P(l.O(e.lng)*this.worldSize,l.Q(r)*this.worldSize)}unproject(e){return new l.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const r=this.elevation,a=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),d=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-d))return;const _=a+r-d,w=Math.cos(this._pitch)*this.cameraToCenterDistance/_/l.b5(1,c.lat),S=this.scaleZoom(w/this.tileSize);this._elevation=d,this._center=c,this.zoom=S}setLocationAtPoint(e,r){const a=this.pointCoordinate(r),c=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),_=new l.Z(d.x-(a.x-c.x),d.y-(a.y-c.y));this.center=this.coordinateLocation(_),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,r){return r?this.coordinatePoint(this.locationCoordinate(e),r.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,r){return this.coordinateLocation(this.pointCoordinate(e,r))}locationCoordinate(e){return l.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,r){if(r){const N=r.pointCoordinate(e);if(N!=null)return N}const a=[e.x,e.y,0,1],c=[e.x,e.y,1,1];l.af(a,a,this.pixelMatrixInverse),l.af(c,c,this.pixelMatrixInverse);const d=a[3],_=c[3],w=a[1]/d,S=c[1]/_,A=a[2]/d,M=c[2]/_,z=A===M?0:(0-A)/(M-A);return new l.Z(l.y.number(a[0]/d,c[0]/_,z)/this.worldSize,l.y.number(w,S,z)/this.worldSize)}coordinatePoint(e,r=0,a=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,r,1];return l.af(c,c,a),new l.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new be().extend(this.pointLocation(new l.P(0,e))).extend(this.pointLocation(new l.P(this.width,e))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new be([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_u])}calculateTileMatrix(e){const r=e.canonical,a=this.worldSize/this.zoomScale(r.z),c=r.x+Math.pow(2,r.z)*e.wrap,d=l.an(new Float64Array(16));return l.J(d,d,[c*a,r.y*a,0]),l.K(d,d,[a/l.X,a/l.X,1]),d}calculatePosMatrix(e,r=!1){const a=e.key,c=r?this._alignedPosMatrixCache:this._posMatrixCache;if(c[a])return c[a];const d=this.calculateTileMatrix(e);return l.L(d,r?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,d),c[a]=new Float32Array(d),c[a]}calculateFogMatrix(e){const r=e.key,a=this._fogMatrixCache;if(a[r])return a[r];const c=this.calculateTileMatrix(e);return l.L(c,this.fogMatrix,c),a[r]=new Float32Array(c),a[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,r){r=l.ac(+r,this.minZoom,this.maxZoom);const a={center:new l.N(e.lng,e.lat),zoom:r};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const $=179.9999999999;c=[-$,$]}const d=this.tileSize*this.zoomScale(a.zoom);let _=0,w=d,S=0,A=d,M=0,z=0;const{x:N,y:G}=this.size;if(this.latRange){const $=this.latRange;_=l.Q($[1])*d,w=l.Q($[0])*d,w-_<G&&(M=G/(w-_))}c&&(S=l.b3(l.O(c[0])*d,0,d),A=l.b3(l.O(c[1])*d,0,d),A<S&&(A+=d),A-S<N&&(z=N/(A-S)));const{x:X,y:te}=this.project.call({worldSize:d},e);let oe,ae;const ue=Math.max(z||0,M||0);if(ue){const $=new l.P(z?(A+S)/2:X,M?(w+_)/2:te);return a.center=this.unproject.call({worldSize:d},$).wrap(),a.zoom+=this.scaleZoom(ue),a}if(this.latRange){const $=G/2;te-$<_&&(ae=_+$),te+$>w&&(ae=w-$)}if(c){const $=(S+A)/2;let fe=X;this._renderWorldCopies&&(fe=l.b3(X,$-d/2,$+d/2));const ge=N/2;fe-ge<S&&(oe=S+ge),fe+ge>A&&(oe=A-ge)}if(oe!==void 0||ae!==void 0){const $=new l.P(oe??X,ae??te);a.center=this.unproject.call({worldSize:d},$).wrap()}return a}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:a}=this.getConstrained(this.center,this.zoom);this.center=r,this.zoom=a,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,r=this.point.x,a=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b5(1,this.center.lat)*this.worldSize;let c=l.an(new Float64Array(16));l.K(c,c,[this.width/2,-this.height/2,1]),l.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=l.an(new Float64Array(16)),l.K(c,c,[1,-1,1]),l.J(c,c,[-1,-1,0]),l.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),_=Math.min(this.elevation,this.minElevationForCurrentTile),w=d-_*this._pixelPerMeter/Math.cos(this._pitch),S=_<0?w:d,A=Math.PI/2+this._pitch,M=this._fov*(.5+e.y/this.height),z=Math.sin(M)*S/Math.sin(l.ac(Math.PI-A-M,.01,Math.PI-.01)),N=this.getHorizon(),G=2*Math.atan(N/this.cameraToCenterDistance)*(.5+e.y/(2*N)),X=Math.sin(G)*S/Math.sin(l.ac(Math.PI-A-G,.01,Math.PI-.01)),te=Math.min(z,X);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*te+S),this.nearZ=this.height/50,c=new Float64Array(16),l.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=l.ae(c),l.K(c,c,[1,-1,1]),l.J(c,c,[0,0,-this.cameraToCenterDistance]),l.b7(c,c,this._pitch),l.ad(c,c,this.angle),l.J(c,c,[-r,-a,0]),this.mercatorMatrix=l.K([],c,[this.worldSize,this.worldSize,this.worldSize]),l.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.L(new Float64Array(16),this.labelPlaneMatrix,c),l.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=l.as([],c),this.fogMatrix=new Float64Array(16),l.b6(this.fogMatrix,this._fov,this.width/this.height,d,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,l.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b7(this.fogMatrix,this.fogMatrix,this._pitch),l.ad(this.fogMatrix,this.fogMatrix,this.angle),l.J(this.fogMatrix,this.fogMatrix,[-r,-a,0]),l.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),l.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=l.L(new Float64Array(16),this.labelPlaneMatrix,c);const oe=this.width%2/2,ae=this.height%2/2,ue=Math.cos(this.angle),$=Math.sin(this.angle),fe=r-Math.round(r)+ue*oe+$*ae,ge=a-Math.round(a)+ue*ae+$*oe,Se=new Float64Array(c);if(l.J(Se,Se,[fe>.5?fe-1:fe,ge>.5?ge-1:ge,0]),this.alignedModelViewProjectionMatrix=Se,c=l.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new l.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.af(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,e))}getCameraQueryGeometry(e){const r=this.getCameraPoint();if(e.length===1)return[e[0],r];{let a=r.x,c=r.y,d=r.x,_=r.y;for(const w of e)a=Math.min(a,w.x),c=Math.min(c,w.y),d=Math.max(d,w.x),_=Math.max(_,w.y);return[new l.P(a,c),new l.P(d,c),new l.P(d,_),new l.P(a,_),new l.P(a,c)]}}lngLatToCameraDepth(e,r){const a=this.locationCoordinate(e),c=[a.x*this.worldSize,a.y*this.worldSize,r,1];return l.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function va(p,e){let r,a=!1,c=null,d=null;const _=()=>{c=null,a&&(p.apply(d,r),c=setTimeout(_,e),a=!1)};return(...w)=>(a=!0,d=this,r=w,c||_(),c)}class ml{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let a;return r.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(a=c)}),(a&&a[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(r.length>=3&&!r.some(a=>isNaN(a))){const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:a,pitch:+(r[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const a=r.join("/");let c=a;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${a}`);let d=window.location.hash.replace(c,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let _=window.location.href.replace(/(#.+)?$/,d);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=va(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),_=Math.round(r.lng*d)/d,w=Math.round(r.lat*d)/d,S=this._map.getBearing(),A=this._map.getPitch();let M="";if(M+=e?`/${_}/${w}/${a}`:`${a}/${w}/${_}`,(S||A)&&(M+="/"+Math.round(10*S)/10),A&&(M+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let N=!1;const G=window.location.hash.slice(1).split("&").map(X=>{const te=X.split("=")[0];return te===z?(N=!0,`${te}=${M}`):X}).filter(X=>X);return N||G.push(`${z}=${M}`),`#${G.join("&")}`}return`#${M}`}}const gl={linearity:.3,easing:l.b8(0,0,.3,1)},vu=l.e({deceleration:2500,maxSpeed:1400},gl),zy=l.e({deceleration:20,maxSpeed:1400},gl),_f=l.e({deceleration:1e3,maxSpeed:360},gl),yl=l.e({deceleration:1e3,maxSpeed:90},gl);class xu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:B.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=B.now();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)r.zoom+=d.zoomDelta||0,r.bearing+=d.bearingDelta||0,r.pitch+=d.pitchDelta||0,d.panDelta&&r.pan._add(d.panDelta),d.around&&(r.around=d.around),d.pinchAround&&(r.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(r.pan.mag()){const d=ba(r.pan.mag(),a,l.e({},vu,e||{}));c.offset=r.pan.mult(d.amount/r.pan.mag()),c.center=this._map.transform.center,xa(c,d)}if(r.zoom){const d=ba(r.zoom,a,zy);c.zoom=this._map.transform.zoom+d.amount,xa(c,d)}if(r.bearing){const d=ba(r.bearing,a,_f);c.bearing=this._map.transform.bearing+l.ac(d.amount,-179,179),xa(c,d)}if(r.pitch){const d=ba(r.pitch,a,yl);c.pitch=this._map.transform.pitch+d.amount,xa(c,d)}if(c.zoom||c.bearing){const d=r.pinchAround===void 0?r.around:r.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),l.e(c,{noMoveStart:!0})}}function xa(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function ba(p,e,r){const{maxSpeed:a,linearity:c,deceleration:d}=r,_=l.ac(p*c/(e/1e3),-a,a),w=Math.abs(_)/(d*c);return{easing:r.easing,duration:1e3*w,amount:_*(w/2)}}class kn extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a,c={}){const d=V.mousePos(r.getCanvas(),a),_=r.unproject(d);super(e,l.e({point:d,lngLat:_,originalEvent:a},c)),this._defaultPrevented=!1,this.target=r}}class Vs extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a){const c=e==="touchend"?a.changedTouches:a.touches,d=V.touchPos(r.getCanvasContainer(),c),_=d.map(S=>r.unproject(S)),w=d.reduce((S,A,M,z)=>S.add(A.div(z.length)),new l.P(0,0));super(e,{points:d,point:w,lngLats:_,lngLat:r.unproject(w),originalEvent:a}),this._defaultPrevented=!1}}class vf extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class xf{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new vf(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new kn(e.type,this._map,e))}mouseup(e){this._map.fire(new kn(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new kn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new kn(e.type,this._map,e))}mouseover(e){this._map.fire(new kn(e.type,this._map,e))}mouseout(e){this._map.fire(new kn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Vs(e.type,this._map,e))}touchmove(e){this._map.fire(new Vs(e.type,this._map,e))}touchend(e){this._map.fire(new Vs(e.type,this._map,e))}touchcancel(e){this._map.fire(new Vs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ji{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new kn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new kn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Er{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(l.P.convert(e),this._map.terrain)}}class ur{constructor(e,r){this._map=e,this._tr=new Er(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(V.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const a=r;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=V.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(c.x,a.x),_=Math.max(c.x,a.x),w=Math.min(c.y,a.y),S=Math.max(c.y,a.y);V.setTransform(this._box,`translate(${d}px,${w}px)`),this._box.style.width=_-d+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const a=this._startPos,c=r;if(this.reset(),V.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new l.k(e,{originalEvent:r}))}}function wa(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const r={};for(let a=0;a<p.length;a++)r[p[a].identifier]=e[a];return r}class bu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=function(c){const d=new l.P(0,0);for(const _ of c)d._add(_);return d.div(c.length)}(r),this.touches=wa(a,r)))}touchmove(e,r,a){if(this.aborted||!this.centroid)return;const c=wa(a,r);for(const d in this.touches){const _=c[d];(!_||_.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,r,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class _l{constructor(e){this.singleTap=new bu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,a){this.singleTap.touchstart(e,r,a)}touchmove(e,r,a){this.singleTap.touchmove(e,r,a)}touchend(e,r,a){const c=this.singleTap.touchend(e,r,a);if(c){const d=e.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(c)<30;if(d&&_||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class vo{constructor(e){this._tr=new Er(e),this._zoomIn=new _l({numTouches:1,numTaps:2}),this._zoomOut=new _l({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,a){this._zoomIn.touchstart(e,r,a),this._zoomOut.touchstart(e,r,a)}touchmove(e,r,a){this._zoomIn.touchmove(e,r,a),this._zoomOut.touchmove(e,r,a)}touchend(e,r,a){const c=this._zoomIn.touchend(e,r,a),d=this._zoomOut.touchend(e,r,a),_=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(c)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ts{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=r.length?r[0]:r;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&V.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const wu={0:1,2:2};class vl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=V.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,a){const c=wu[a];return r.buttons===void 0||(r.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return V.mouseButton(e)===this._eventButton}}class Su{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const xl=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}},Tu=({enable:p,clickTolerance:e,bearingDegreesPerPixelMoved:r=.8})=>{const a=new vl({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new ts({clickTolerance:e,move:(c,d)=>({bearingDelta:(d.x-c.x)*r}),moveStateManager:a,enable:p,assignEvents:xl})},Pu=({enable:p,clickTolerance:e,pitchDegreesPerPixelMoved:r=-.5})=>{const a=new vl({checkCorrectEvent:c=>V.mouseButton(c)===0&&c.ctrlKey||V.mouseButton(c)===2});return new ts({clickTolerance:e,move:(c,d)=>({pitchDelta:(d.y-c.y)*r}),moveStateManager:a,enable:p,assignEvents:xl})};class js{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,a){return this._calculateTransform(e,r,a)}touchmove(e,r,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,r,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,a){this._calculateTransform(e,r,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,a){a.length>0&&(this._active=!0);const c=wa(a,r),d=new l.P(0,0),_=new l.P(0,0);let w=0;for(const A in c){const M=c[A],z=this._touches[A];z&&(d._add(M),_._add(M.sub(z)),w++,c[A]=M)}if(this._touches=c,this._shouldBePrevented(w)||!_.mag())return;const S=_.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,a){if(!this._firstTwoTouches)return;e.preventDefault();const[c,d]=this._firstTwoTouches,_=Sa(a,r,c),w=Sa(a,r,d);if(!_||!w)return;const S=this._aroundCenter?null:_.add(w).div(2);return this._move([_,w],S,e)}touchend(e,r,a){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,_=Sa(a,r,c),w=Sa(a,r,d);_&&w||(this._active&&V.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sa(p,e,r){for(let a=0;a<p.length;a++)if(p[a].identifier===r)return e[a]}function Iu(p,e){return Math.log(p/e)/Math.LN2}class Cu extends bl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Iu(this._distance,a),pinchAround:r}}}function ku(p,e){return 180*p.angleWith(e)/Math.PI}class Au extends bl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,a){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ku(this._vector,c),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,a=ku(e,this._startVector);return Math.abs(a)<r}}function wl(p){return Math.abs(p.y)>Math.abs(p.x)}class xo extends bl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,a){super.touchstart(e,r,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,wl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,a){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,d=r.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const _=e.y>0==r.y>0;return wl(e)&&wl(r)&&_}}const bf={panStep:100,bearingStep:15,pitchStep:10};class _r{constructor(e){this._tr=new Er(e);const r=bf;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,a=0,c=0,d=0,_=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),_=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Hr,zoom:r?Math.round(S.zoom)+r*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+a*this._bearingStep,pitch:S.pitch+c*this._pitchStep,offset:[-d*this._panStep,-_*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hr(p){return p*(2-p)}const Eu=4.000244140625;class Mr{constructor(e,r){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new Er(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=B.now(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,r!==0&&r%Eu==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=V.mousePos(this._map.getCanvas(),e),a=this._tr;this._around=r.y>a.transform.height/2-a.transform.getHorizon()?l.N.convert(this._aroundCenter?a.center:a.unproject(r)):l.N.convert(a.center),this._aroundPoint=a.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Eu?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const M=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(M*A))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,a=this._startZoom,c=this._easing;let d,_=!1;const w=B.now()-this._lastWheelEventTime;if(this._type==="wheel"&&a&&c&&w){const S=Math.min(w/200,1),A=c(S);d=l.y.number(a,r,A),S<1?this._frameId||(this._frameId=!0):_=!0}else d=r,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!_,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=l.b9;if(this._prevEase){const a=this._prevEase,c=(B.now()-a.start)/a.duration,d=a.easing(c+.01)-a.easing(c),_=.27/Math.sqrt(d*d+1e-4)*.01,w=Math.sqrt(.0729-_*_);r=l.b8(_,w,.25,1)}return this._prevEase={start:B.now(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Us{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dy{constructor(e){this._tr=new Er(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ly{constructor(){this._tap=new _l({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,a){if(!this._swipePoint)if(this._tapTime){const c=r[0],d=e.timeStamp-this._tapTime<500,_=this._tapPoint.dist(c)<30;d&&_?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,r,a)}touchmove(e,r,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=r[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,r,a)}touchend(e,r,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(e,r,a);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wf{constructor(e,r,a){this._el=e,this._mousePan=r,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sf{constructor(e,r,a){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=r,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Mu{constructor(e,r,a,c){this._el=e,this._touchZoom=r,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class bo{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=V.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=r,this._container.appendChild(c);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=a,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(V.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new l.k("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const vr=p=>p.zoom||p.drag||p.pitch||p.rotate;class _t extends l.k{}function Sl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class zu{constructor(e,r){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=c.type==="renderFrame"?void 0:c,w={needsRenderFrame:!1},S={},A={},M=c.touches,z=M?this._getMapTouches(M):void 0,N=z?V.touchPos(this._map.getCanvas(),z):V.mousePos(this._map.getCanvas(),c);for(const{handlerName:te,handler:oe,allowed:ae}of this._handlers){if(!oe.isEnabled())continue;let ue;this._blockedByActive(A,ae,te)?oe.reset():oe[d||c.type]&&(ue=oe[d||c.type](c,N,z),this.mergeHandlerResult(w,S,ue,te,_),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||oe.isActive())&&(A[te]=oe)}const G={};for(const te in this._previousActiveHandlers)A[te]||(G[te]=_);this._previousActiveHandlers=A,(Object.keys(G).length||Sl(w))&&(this._changes.push([w,S,G]),this._triggerRenderFrame()),(Object.keys(A).length||Sl(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=w;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xu(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,_]of this._listeners)V.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[e,r,a]of this._listeners)V.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const r=this._map,a=r.getCanvasContainer();this._add("mapEvent",new xf(r,e));const c=r.boxZoom=new ur(r,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const d=r.cooperativeGestures=new bo(r,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const _=new vo(r),w=new Dy(r);r.doubleClickZoom=new Us(w,_),this._add("tapZoom",_),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const S=new Ly;this._add("tapDragZoom",S);const A=r.touchPitch=new xo(r);this._add("touchPitch",A),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const M=Tu(e),z=Pu(e);r.dragRotate=new Sf(e,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const N=(({enable:ue,clickTolerance:$})=>{const fe=new vl({checkCorrectEvent:ge=>V.mouseButton(ge)===0&&!ge.ctrlKey});return new ts({clickTolerance:$,move:(ge,Se)=>({around:Se,panDelta:Se.sub(ge)}),activateOnStart:!0,moveStateManager:fe,enable:ue,assignEvents:xl})})(e),G=new js(e,r);r.dragPan=new wf(a,N,G),this._add("mousePan",N),this._add("touchPan",G,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const X=new Au,te=new Cu;r.touchZoomRotate=new Mu(a,te,X,S),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate);const oe=r.scrollZoom=new Mr(r,()=>this._triggerRenderFrame());this._add("scrollZoom",oe,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const ae=r.keyboard=new _r(r);this._add("keyboard",ae),e.interactive&&e.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new Ji(r))}_add(e,r,a){this._handlers.push({handlerName:e,handler:r,allowed:a}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,a){for(const c in e)if(c!==a&&(!r||r.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const a of e)this._el.contains(a.target)&&r.push(a);return r}mergeHandlerResult(e,r,a,c,d){if(!a)return;l.e(e,a);const _={handlerName:c,originalEvent:a.originalEvent||d};a.zoomDelta!==void 0&&(r.zoom=_),a.panDelta!==void 0&&(r.drag=_),a.pitchDelta!==void 0&&(r.pitch=_),a.bearingDelta!==void 0&&(r.rotate=_)}_applyChanges(){const e={},r={},a={};for(const[c,d,_]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),l.e(r,d),l.e(a,_);this._updateMapTransform(e,r,a),this._changes=[]}_updateMapTransform(e,r,a){const c=this._map,d=c._getTransformForUpdate(),_=c.terrain;if(!(Sl(e)||_&&this._terrainMovement))return this._fireEvents(r,a,!0);let{panDelta:w,zoomDelta:S,bearingDelta:A,pitchDelta:M,around:z,pinchAround:N}=e;N!==void 0&&(z=N),c._stop(!0),z=z||c.transform.centerPoint;const G=d.pointLocation(w?z.sub(w):z);A&&(d.bearing+=A),M&&(d.pitch+=M),S&&(d.zoom+=S),_?this._terrainMovement||!r.drag&&!r.zoom?r.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(w)):d.setLocationAtPoint(G,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(G,z)):d.setLocationAtPoint(G,z),c._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,a,!0)}_fireEvents(e,r,a){const c=vr(this._eventsInProgress),d=vr(e),_={};for(const z in e){const{originalEvent:N}=e[z];this._eventsInProgress[z]||(_[`${z}start`]=N),this._eventsInProgress[z]=e[z]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const z in _)this._fireEvent(z,_[z]);d&&this._fireEvent("move",d.originalEvent);for(const z in e){const{originalEvent:N}=e[z];this._fireEvent(z,N)}const w={};let S;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:G}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],S=r[N]||G,w[`${z}end`]=S)}for(const z in w)this._fireEvent(z,w[z]);const A=vr(this._eventsInProgress),M=(c||d)&&!A;if(M&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const z=this._map._getTransformForUpdate();z.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(z)}if(a&&M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=G=>G!==0&&-this._bearingSnap<G&&G<this._bearingSnap;!z||!z.essential&&B.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:S})),N(this._map.getBearing())&&this._map.resetNorth()):(N(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new l.k(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new _t("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Tf extends l.E{constructor(e,r){super(),this._renderFrameCallback=()=>{const a=Math.min((B.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}panBy(e,r,a){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},r),a)}panTo(e,r,a){return this.easeTo(l.e({center:e},r),a)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,a){return this.easeTo(l.e({zoom:e},r),a)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,a){return this.easeTo(l.e({bearing:e},r),a)}resetNorth(e,r){return this.rotateTo(0,l.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}cameraForBounds(e,r){e=be.convert(e).adjustAntiMeridian();const a=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,r)}_cameraForBoxAndBearing(e,r,a,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=l.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const rt=c.padding;c.padding={top:rt,bottom:rt,right:rt,left:rt}}c.padding=l.e(d,c.padding);const _=this.transform,w=_.padding,S=new be(e,r),A=_.project(S.getNorthWest()),M=_.project(S.getNorthEast()),z=_.project(S.getSouthEast()),N=_.project(S.getSouthWest()),G=l.ba(-a),X=A.rotate(G),te=M.rotate(G),oe=z.rotate(G),ae=N.rotate(G),ue=new l.P(Math.max(X.x,te.x,ae.x,oe.x),Math.max(X.y,te.y,ae.y,oe.y)),$=new l.P(Math.min(X.x,te.x,ae.x,oe.x),Math.min(X.y,te.y,ae.y,oe.y)),fe=ue.sub($),ge=(_.width-(w.left+w.right+c.padding.left+c.padding.right))/fe.x,Se=(_.height-(w.top+w.bottom+c.padding.top+c.padding.bottom))/fe.y;if(Se<0||ge<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(_.scaleZoom(_.scale*Math.min(ge,Se)),c.maxZoom),Ke=l.P.convert(c.offset),lt=new l.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(l.ba(a)),gt=Ke.add(lt).mult(_.scale/_.zoomScale(Fe));return{center:_.unproject(A.add(z).div(2).sub(gt)),zoom:Fe,bearing:a}}fitBounds(e,r,a){return this._fitInternal(this.cameraForBounds(e,r),r,a)}fitScreenCoordinates(e,r,a,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(e)),this.transform.pointLocation(l.P.convert(r)),a,c),c,d)}_fitInternal(e,r,a){return e?(delete(r=l.e(e,r)).padding,r.linear?this.easeTo(r,a):this.flyTo(r,a)):this}jumpTo(e,r){this.stop();const a=this._getTransformForUpdate();let c=!1,d=!1,_=!1;return"zoom"in e&&a.zoom!==+e.zoom&&(c=!0,a.zoom=+e.zoom),e.center!==void 0&&(a.center=l.N.convert(e.center)),"bearing"in e&&a.bearing!==+e.bearing&&(d=!0,a.bearing=+e.bearing),"pitch"in e&&a.pitch!==+e.pitch&&(_=!0,a.pitch=+e.pitch),e.padding==null||a.isPaddingEqual(e.padding)||(a.padding=e.padding),this._applyUpdatedTransform(a),this.fire(new l.k("movestart",r)).fire(new l.k("move",r)),c&&this.fire(new l.k("zoomstart",r)).fire(new l.k("zoom",r)).fire(new l.k("zoomend",r)),d&&this.fire(new l.k("rotatestart",r)).fire(new l.k("rotate",r)).fire(new l.k("rotateend",r)),_&&this.fire(new l.k("pitchstart",r)).fire(new l.k("pitch",r)).fire(new l.k("pitchend",r)),this.fire(new l.k("moveend",r))}calculateCameraOptionsFromTo(e,r,a,c=0){const d=l.Z.fromLngLat(e,r),_=l.Z.fromLngLat(a,c),w=_.x-d.x,S=_.y-d.y,A=_.z-d.z,M=Math.hypot(w,S,A);if(M===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,S),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/M/this.transform.tileSize),G=180*Math.atan2(w,-S)/Math.PI;let X=180*Math.acos(z/M)/Math.PI;return X=A<0?90-X:90+X,{center:_.toLngLat(),zoom:N,pitch:X,bearing:G}}easeTo(e,r){var a;this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.b9},e)).animate===!1||!e.essential&&B.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),d=c.zoom,_=c.bearing,w=c.pitch,S=c.padding,A="bearing"in e?this._normalizeBearing(e.bearing,_):_,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:c.padding,N=l.P.convert(e.offset);let G=c.centerPoint.add(N);const X=c.pointLocation(G),{center:te,zoom:oe}=c.getConstrained(l.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(te,c);const ae=c.project(X),ue=c.project(te).sub(ae),$=c.zoomScale(oe-d);let fe,ge;e.around&&(fe=l.N.convert(e.around),ge=c.locationPoint(fe));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==d,this._rotating=this._rotating||_!==A,this._pitching=this._pitching||M!==w,this._padding=!c.isPaddingEqual(z),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,Se),this.terrain&&this._prepareElevation(te),this._ease(Fe=>{if(this._zooming&&(c.zoom=l.y.number(d,oe,Fe)),this._rotating&&(c.bearing=l.y.number(_,A,Fe)),this._pitching&&(c.pitch=l.y.number(w,M,Fe)),this._padding&&(c.interpolatePadding(S,z,Fe),G=c.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe),fe)c.setLocationAtPoint(fe,ge);else{const Ke=c.zoomScale(c.zoom-d),lt=oe>d?Math.min(2,$):Math.max(.5,$),gt=Math.pow(lt,1-Fe),rt=c.unproject(ae.add(ue.mult(Fe*gt)).mult(Ke));c.setLocationAtPoint(c.renderWorldCopies?rt.wrap():rt,G)}this._applyUpdatedTransform(c),this._fireMoveEvents(r)},Fe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,Fe)},e),this}_prepareEase(e,r,a={}){this._moving=!0,r||a.moving||this.fire(new l.k("movestart",e)),this._zooming&&!a.zooming&&this.fire(new l.k("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new l.k("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new l.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(r-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.elevation=l.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const r=e.getCameraPosition(),a=this.terrain.getElevationForLngLatZoom(r.lngLat,e.zoom);if(r.altitude<a){const c=this.calculateCameraOptionsFromTo(r.lngLat,a,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(this.terrain&&r.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&r.push(c=>this.transformCameraUpdate(c)),!r.length)return;const a=e.clone();for(const c of r){const d=a.clone(),{center:_,zoom:w,pitch:S,bearing:A,elevation:M}=c(d);_&&(d.center=_),w!==void 0&&(d.zoom=w),S!==void 0&&(d.pitch=S),A!==void 0&&(d.bearing=A),M!==void 0&&(d.elevation=M),a.apply(d)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new l.k("move",e)),this._zooming&&this.fire(new l.k("zoom",e)),this._rotating&&this.fire(new l.k("rotate",e)),this._pitching&&this.fire(new l.k("pitch",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const a=this._zooming,c=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new l.k("zoomend",e)),c&&this.fire(new l.k("rotateend",e)),d&&this.fire(new l.k("pitchend",e)),this.fire(new l.k("moveend",e))}flyTo(e,r){var a;if(!e.essential&&B.prefersReducedMotion){const dt=l.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(dt,r)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b9},e);const c=this._getTransformForUpdate(),d=c.zoom,_=c.bearing,w=c.pitch,S=c.padding,A="bearing"in e?this._normalizeBearing(e.bearing,_):_,M="pitch"in e?+e.pitch:w,z="padding"in e?e.padding:c.padding,N=l.P.convert(e.offset);let G=c.centerPoint.add(N);const X=c.pointLocation(G),{center:te,zoom:oe}=c.getConstrained(l.N.convert(e.center||X),(a=e.zoom)!==null&&a!==void 0?a:d);this._normalizeCenter(te,c);const ae=c.zoomScale(oe-d),ue=c.project(X),$=c.project(te).sub(ue);let fe=e.curve;const ge=Math.max(c.width,c.height),Se=ge/ae,Fe=$.mag();if("minZoom"in e){const dt=l.ac(Math.min(e.minZoom,d,oe),c.minZoom,c.maxZoom),jt=ge/c.zoomScale(dt-d);fe=Math.sqrt(jt/Fe*2)}const Ke=fe*fe;function lt(dt){const jt=(Se*Se-ge*ge+(dt?-1:1)*Ke*Ke*Fe*Fe)/(2*(dt?Se:ge)*Ke*Fe);return Math.log(Math.sqrt(jt*jt+1)-jt)}function gt(dt){return(Math.exp(dt)-Math.exp(-dt))/2}function rt(dt){return(Math.exp(dt)+Math.exp(-dt))/2}const nt=lt(!1);let wt=function(dt){return rt(nt)/rt(nt+fe*dt)},Zt=function(dt){return ge*((rt(nt)*(gt(jt=nt+fe*dt)/rt(jt))-gt(nt))/Ke)/Fe;var jt},st=(lt(!0)-nt)/fe;if(Math.abs(Fe)<1e-6||!isFinite(st)){if(Math.abs(ge-Se)<1e-6)return this.easeTo(e,r);const dt=Se<ge?-1:1;st=Math.abs(Math.log(Se/ge))/fe,Zt=()=>0,wt=jt=>Math.exp(dt*fe*jt)}return e.duration="duration"in e?+e.duration:1e3*st/("screenSpeed"in e?+e.screenSpeed/fe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=_!==A,this._pitching=M!==w,this._padding=!c.isPaddingEqual(z),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(te),this._ease(dt=>{const jt=dt*st,Mi=1/wt(jt);c.zoom=dt===1?oe:d+c.scaleZoom(Mi),this._rotating&&(c.bearing=l.y.number(_,A,dt)),this._pitching&&(c.pitch=l.y.number(w,M,dt)),this._padding&&(c.interpolatePadding(S,z,dt),G=c.centerPoint.add(N)),this.terrain&&!e.freezeElevation&&this._updateElevation(dt);const Jt=dt===1?te:c.unproject(ue.add($.mult(Zt(jt))).mult(Mi));c.setLocationAtPoint(c.renderWorldCopies?Jt.wrap():Jt,G),this._applyUpdatedTransform(c),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,r)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,r,a){a.animate===!1||a.duration===0?(e(1),r()):(this._easeStart=B.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=l.b3(e,-180,180);const a=Math.abs(e-r);return Math.abs(e-360-r)<a&&(e-=360),Math.abs(e+360-r)<a&&(e+=360),e}_normalizeCenter(e,r){if(!r.renderWorldCopies||r.lngRange)return;const a=e.lng-r.center.lng;e.lng+=a>180?-360:a<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const wo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class So{constructor(e=wo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=V.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=V.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const a=this._map._getUIString(`AttributionControl.${r}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const r=this._map.style.sourceCaches;for(const c in r){const d=r[c];if(d.used||d.usedForTerrain){const _=d.getSource();_.attribution&&e.indexOf(_.attribution)<0&&e.push(_.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,d)=>c.length-d.length),e=e.filter((c,d)=>{for(let _=d+1;_<e.length;_++)if(e[_].indexOf(c)>=0)return!1;return!0});const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Du{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const a=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=V.create("div","maplibregl-ctrl");const r=V.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){V.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,a=r?this._queue.concat(r):this._queue;for(const c of a)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const a of r)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Lu=l.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ry extends l.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,r){this.sourceCache.update(e,r),this._renderableTilesKeys=[];const a={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),l.aP(c.posMatrix,0,l.X,0,l.X,0,1),this._tiles[c.key]=new Ir(c,this.tileSize));for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(e){for(const r in this._tiles){const a=this._tiles[r];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const r={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID;if(c.canonical.equals(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16),l.aP(d.posMatrix,0,l.X,0,l.X,0,1),r[a]=d}else if(c.canonical.isChildOf(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const _=c.canonical.z-e.canonical.z,w=c.canonical.x-(c.canonical.x>>_<<_),S=c.canonical.y-(c.canonical.y>>_<<_),A=l.X>>_;l.aP(d.posMatrix,0,A,0,A,0,1),l.J(d.posMatrix,d.posMatrix,[-w*A,-S*A,0]),r[a]=d}else if(e.canonical.isChildOf(c.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const _=e.canonical.z-c.canonical.z,w=e.canonical.x-(e.canonical.x>>_<<_),S=e.canonical.y-(e.canonical.y>>_<<_),A=l.X>>_;l.aP(d.posMatrix,0,l.X,0,l.X,0,1),l.J(d.posMatrix,d.posMatrix,[w*A,S*A,0]),l.K(d.posMatrix,d.posMatrix,[1/2**_,1/2**_,0]),r[a]=d}}return r}getSourceTile(e,r){const a=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&r)for(;c>=a.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(c--).key);return d}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(r=>r.timeAdded>=e)}}class Ru{constructor(e,r,a){this.painter=e,this.sourceCache=new Ry(r),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,a,c=l.X){var d;if(!(r>=0&&r<c&&a>=0&&a<c))return 0;const _=this.getTerrainData(e),w=(d=_.tile)===null||d===void 0?void 0:d.dem;if(!w)return 0;const S=function(X,te,oe){var ae=te[0],ue=te[1];return X[0]=oe[0]*ae+oe[4]*ue+oe[12],X[1]=oe[1]*ae+oe[5]*ue+oe[13],X}([],[r/c*l.X,a/c*l.X],_.u_terrain_matrix),A=[S[0]*w.dim,S[1]*w.dim],M=Math.floor(A[0]),z=Math.floor(A[1]),N=A[0]-M,G=A[1]-z;return w.get(M,z)*(1-N)*(1-G)+w.get(M+1,z)*N*(1-G)+w.get(M,z+1)*(1-N)*G+w.get(M+1,z+1)*N*G}getElevationForLngLatZoom(e,r){if(!l.bb(r,e.wrap()))return 0;const{tileID:a,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(a,c%l.X,d%l.X,l.X)}getElevation(e,r,a,c=l.X){return this.getDEMElevation(e,r,a,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,d=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Be(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Be(c,new l.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const r=this.sourceCache.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const c=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new Be(c,r.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),r.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const a=r&&r+r.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?d=e.canonical.z-c:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=e.canonical.x-(e.canonical.x>>d<<d),w=e.canonical.y-(e.canonical.y>>d<<d),S=l.bc(new Float64Array(16),[1/(l.X<<d),1/(l.X<<d),0]);l.J(S,S,[_*l.X,w*l.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,a=r.width/devicePixelRatio,c=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Be(r.context,{width:a,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Be(r.context,{width:a,height:c,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,_=0;d<this._coordsTextureSize;d++)for(let w=0;w<this._coordsTextureSize;w++,_+=4)r[_+0]=255&w,r[_+1]=255&d,r[_+2]=w>>8<<4|d>>8,r[_+3]=0;const a=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),c=new Be(e,a,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),a=this.painter.context,c=a.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(d,w-_-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null);const S=r[0]+(r[2]>>4<<8),A=r[1]+((15&r[2])<<8),M=this.coordsIndex[255-r[3]],z=M&&this.sourceCache.getTileByID(M);if(!z)return null;const N=this._coordsTextureSize,G=(1<<z.tileID.canonical.z)*N;return new l.Z((z.tileID.canonical.x*N+S)/G+z.tileID.wrap,(z.tileID.canonical.y*N+A)/G,this.getElevation(z.tileID,S,A,N))}depthAtPoint(e){const r=new Uint8Array(4),a=this.painter.context,c=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,r),a.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,r=new l.bd,a=new l.aY,c=this.meshSize,d=l.X/c,_=c*c;for(let z=0;z<=c;z++)for(let N=0;N<=c;N++)r.emplaceBack(N*d,z*d,0);for(let z=0;z<_;z+=c+1)for(let N=0;N<c;N++)a.emplaceBack(N+z,c+N+z+1,c+N+z+2),a.emplaceBack(N+z,c+N+z+2,N+z+1);const w=r.length,S=w+2*(c+1);for(const z of[0,1])for(let N=0;N<=c;N++)for(const G of[0,1])r.emplaceBack(N*d,z*l.X,G);for(let z=0;z<2*c;z+=2)a.emplaceBack(S+z,S+z+1,S+z+3),a.emplaceBack(S+z,S+z+3,S+z+2),a.emplaceBack(w+z,w+z+3,w+z+1),a.emplaceBack(w+z,w+z+2,w+z+3);const A=r.length,M=A+2*(c+1);for(const z of[0,1])for(let N=0;N<=c;N++)for(const G of[0,1])r.emplaceBack(z*l.X,N*d,G);for(let z=0;z<2*c;z+=2)a.emplaceBack(A+z,A+z+1,A+z+3),a.emplaceBack(A+z,A+z+3,A+z+2),a.emplaceBack(M+z,M+z+3,M+z+1),a.emplaceBack(M+z,M+z+2,M+z+3);return this._mesh=new pl(e.createVertexBuffer(r,Lu.members),e.createIndexBuffer(a),l.a0.simpleSegment(0,0,r.length,a.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*l.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,r){var a;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return r&&r.dem&&(a.minElevation=r.dem.min*this.exaggeration,a.maxElevation=r.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,r){const a=l.Z.fromLngLat(e.wrap()),c=(1<<r)*l.X,d=a.x*c,_=a.y*c,w=Math.floor(d/l.X),S=Math.floor(_/l.X);return{tileID:new l.S(r,0,r,w,S),mercatorX:d,mercatorY:_}}}class Oy{constructor(e,r,a){this._context=e,this._size=r,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new Be(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(a.texture),{id:e,fbo:r,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const To={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Pf{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new Oy(e.context,30,r.sourceCache.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(a=>!e._layers[a].isHidden(r)),this._coordsDescendingInv={};for(const a in e.sourceCaches){this._coordsDescendingInv[a]={};const c=e.sourceCaches[a].getVisibleCoordinates();for(const d of c){const _=this.terrain.sourceCache.getTerrainCoords(d);for(const w in _)this._coordsDescendingInv[a][w]||(this._coordsDescendingInv[a][w]=[]),this._coordsDescendingInv[a][w].push(_[w])}}this._coordsDescendingInvStr={};for(const a of e._order){const c=e._layers[a],d=c.source;if(To[c.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const _ in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][_]=this._coordsDescendingInv[d][_].map(w=>w.key).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[c][a.tileID.key];d&&d!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const r=e.type,a=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(To[r]&&(this._prevType&&To[this._prevType]||this._stacks.push([]),this._prevType=r,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(To[this._prevType]||To[r]&&c){this._prevType=r;const d=this._stacks.length-1,_=this._stacks[d]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(yf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[d]){const A=this.pool.getObjectForId(w.rtt[d].id);if(A.stamp===w.rtt[d].stamp){this.pool.useObject(A);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),w.rtt[d]={id:S.id,stamp:S.stamp},a.context.bindFramebuffer.set(S.fbo.framebuffer),a.context.clear({color:l.aM.transparent,stencil:0}),a.currentStencilSource=void 0;for(let A=0;A<_.length;A++){const M=a.style._layers[_[A]],z=M.source?this._coordsDescendingInv[M.source][w.tileID.key]:[w.tileID];a.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),a._renderTileClippingMasks(M,z),a.renderLayer(a,a.style.sourceCaches[M.source],M,z),M.source&&(w.rttCoords[M.source]=this._coordsDescendingInvStr[M.source][w.tileID.key])}}return yf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),To[r]}return!1}}const Ou={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},If=j,Fy={hash:!1,interactive:!0,bearingSnap:7,attributionControl:wo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Fu=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},By={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ny{constructor(e,r,a=!1){this.mousedown=_=>{this.startMouse(l.e({},_,{ctrlKey:!0,preventDefault:()=>_.preventDefault()}),V.mousePos(this.element,_)),V.addEventListener(window,"mousemove",this.mousemove),V.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.moveMouse(_,V.mousePos(this.element,_))},this.mouseup=_=>{this.mouseRotate.dragEnd(_),this.mousePitch&&this.mousePitch.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,_.targetTouches)[0],this.startTouch(_,this._startPos),V.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,_.targetTouches)[0],this.moveTouch(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),d=e.dragRotate._mousePitch.getClickTolerance();this.element=r,this.mouseRotate=Tu({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:_,clickTolerance:w,bearingDegreesPerPixelMoved:S=.8})=>{const A=new Su;return new ts({clickTolerance:w,move:(M,z)=>({bearingDelta:(z.x-M.x)*S}),moveStateManager:A,enable:_,assignEvents:Fu})})({clickTolerance:c,enable:!0}),this.map=e,a&&(this.mousePitch=Pu({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:_,clickTolerance:w,pitchDegreesPerPixelMoved:S=-.5})=>{const A=new Su;return new ts({clickTolerance:w,move:(M,z)=>({pitchDelta:(z.y-M.y)*S}),moveStateManager:A,enable:_,assignEvents:Fu})})({clickTolerance:d,enable:!0})),V.addEventListener(r,"mousedown",this.mousedown),V.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(r,"touchcancel",this.reset)}startMouse(e,r){this.mouseRotate.dragStart(e,r),this.mousePitch&&this.mousePitch.dragStart(e,r),V.disableDrag()}startTouch(e,r){this.touchRotate.dragStart(e,r),this.touchPitch&&this.touchPitch.dragStart(e,r),V.disableDrag()}moveMouse(e,r){const a=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,r)||{};if(c&&a.setBearing(a.getBearing()+c),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(e,r)||{};d&&a.setPitch(a.getPitch()+d)}}moveTouch(e,r){const a=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,r)||{};if(c&&a.setBearing(a.getBearing()+c),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(e,r)||{};d&&a.setPitch(a.getPitch()+d)}}off(){const e=this.element;V.removeEventListener(e,"mousedown",this.mousedown),V.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend),V.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){V.enableDrag(),V.removeEventListener(window,"mousemove",this.mousemove),V.removeEventListener(window,"mouseup",this.mouseup),V.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),V.removeEventListener(window,"touchend",this.touchend)}}let hr;function Ei(p,e,r){const a=new l.N(p.lng,p.lat);if(p=new l.N(p.lng,p.lat),e){const c=new l.N(p.lng-360,p.lat),d=new l.N(p.lng+360,p.lat),_=r.locationPoint(p).distSqr(e);r.locationPoint(c).distSqr(e)<_?p=c:r.locationPoint(d).distSqr(e)<_&&(p=d)}for(;Math.abs(p.lng-r.center.lng)>180;){const c=r.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=r.width&&c.y<=r.height)break;p.lng>r.center.lng?p.lng-=360:p.lng+=360}return p.lng!==a.lng&&r.locationPoint(p).y>r.height/2-r.getHorizon()?p:a}const Po={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Tl(p,e,r){const a=p.classList;for(const c in Po)a.remove(`maplibregl-${r}-anchor-${c}`);a.add(`maplibregl-${r}-anchor-${e}`)}class Pl extends l.E{constructor(e){if(super(),this._onKeyPress=r=>{const a=r.code,c=r.charCode||r.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=r=>{const a=r.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=r=>{var a;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();((r==null?void 0:r.type)==="terrain"||(r==null?void 0:r.type)==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ei(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,`${Po[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${d}`),B.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div");const r=V.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${a}px`),r.setAttributeNS(null,"width",`${c}px`),r.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const d=V.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const _=V.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of S){const ue=V.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",ae.rx),ue.setAttributeNS(null,"ry",ae.ry),w.appendChild(ue)}const A=V.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const M=V.createNS("http://www.w3.org/2000/svg","path");M.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(M);const z=V.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=V.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const G=V.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const X=V.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(8.0, 8.0)");const te=V.createNS("http://www.w3.org/2000/svg","circle");te.setAttributeNS(null,"fill","#000000"),te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"cx","5.5"),te.setAttributeNS(null,"cy","5.5"),te.setAttributeNS(null,"r","5.4999962");const oe=V.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),X.appendChild(te),X.appendChild(oe),_.appendChild(w),_.appendChild(A),_.appendChild(z),_.appendChild(G),_.appendChild(X),r.appendChild(_),r.setAttributeNS(null,"height",a*this._scale+"px"),r.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(r),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Tl(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,a;if(!(!((r=this._map)===null||r===void 0)&&r.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,d=c.terrain.depthAtPoint(this._pos),_=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,_)-d<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/c.transform._pixelPerMeter,S=Math.sin(c.getPitch()*Math.PI/180)*w,A=c.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),M=c.transform.lngLatToCameraDepth(this._lngLat,_+S)-A>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&M&&this._popup.remove(),this._element.style.opacity=M?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return e===void 0&&r===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const Cf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ta=0,Pa=!1;const Xr={maxWidth:100,unit:"metric"};function Ia(p,e,r){const a=r&&r.maxWidth||100,c=p._container.clientHeight/2,d=p.unproject([0,c]),_=p.unproject([a,c]),w=d.distanceTo(_);if(r&&r.unit==="imperial"){const S=3.2808*w;S>5280?bt(e,a,S/5280,p._getUIString("ScaleControl.Miles")):bt(e,a,S,p._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?bt(e,a,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?bt(e,a,w/1e3,p._getUIString("ScaleControl.Kilometers")):bt(e,a,w,p._getUIString("ScaleControl.Meters"))}function bt(p,e,r,a){const c=function(d){const _=Math.pow(10,`${Math.floor(d)}`.length-1);let w=d/_;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A}(w),_*w}(r);p.style.width=e*(c/r)+"px",p.innerHTML=`${c}&nbsp;${a}`}const Rt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Il=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,p),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-p),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(p,0),right:new l.P(-p,0)}}if(p instanceof l.P||Array.isArray(p)){const e=l.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(p.center||[0,0]),top:l.P.convert(p.top||[0,0]),"top-left":l.P.convert(p["top-left"]||[0,0]),"top-right":l.P.convert(p["top-right"]||[0,0]),bottom:l.P.convert(p.bottom||[0,0]),"bottom-left":l.P.convert(p["bottom-left"]||[0,0]),"bottom-right":l.P.convert(p["bottom-right"]||[0,0]),left:l.P.convert(p.left||[0,0]),right:l.P.convert(p.right||[0,0])}}return Cl(new l.P(0,0))}const Bu=j;b.AJAXError=l.bh,b.Evented=l.E,b.LngLat=l.N,b.MercatorCoordinate=l.Z,b.Point=l.P,b.addProtocol=l.bi,b.config=l.a,b.removeProtocol=l.bj,b.AttributionControl=So,b.BoxZoomHandler=ur,b.CanvasSource=dn,b.CooperativeGesturesHandler=bo,b.DoubleClickZoomHandler=Us,b.DragPanHandler=wf,b.DragRotateHandler=Sf,b.EdgeInsets=yo,b.FullscreenControl=class extends l.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r==null?void 0:r.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){V.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=V.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);V.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},b.GeoJSONSource=sr,b.GeolocateControl=class extends l.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new l.N(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,c=this._map.getBearing(),d=l.e({bearing:c},this.options.fitBoundsOptions),_=be.fromLngLat(r,a);this._map.fitBounds(_,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new l.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Pa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=V.create("button","maplibregl-ctrl-geolocate",this._container),V.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Pl({element:this._dotElement}),this._circleElement=V.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")),this.fire(new l.k("userlocationlostfocus")))})}},this.options=l.e({},Cf,p)}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return l._(this,arguments,void 0,function*(e=!1){if(hr!==void 0&&!e)return hr;if(window.navigator.permissions===void 0)return hr=!!window.navigator.geolocation,hr;try{hr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{hr=!!window.navigator.geolocation}return hr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ta=0,Pa=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),r=p.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),r=p.getNorthEast(),a=e.distanceTo(r),c=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ta--,Pa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart")),this.fire(new l.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ta++,Ta>1?(p={maximumAge:6e5,timeout:0},Pa=!0):(p=this.options.positionOptions,Pa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},b.Hash=ml,b.ImageSource=Xn,b.KeyboardHandler=_r,b.LngLatBounds=be,b.LogoControl=Du,b.Map=class extends Tf{constructor(p){l.bf.mark(l.bg.create);const e=Object.assign(Object.assign({},Fy),p);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new _o(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new oi,this._controls=[],this._mapId=l.a4(),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ou),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ie.addThrottleControl(()=>this.isMoving()),this._requestManager=new Oe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const a=va(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{r?a(c):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zu(this,e),this._hash=e.hash&&new ml(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,l.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new So(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Du,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new l.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new l.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new l.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=p.onAdd(this);this._controls.push(p);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(r,a.firstChild):a.appendChild(r),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,r,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,r,a)}resize(p){var e;const r=this._containerDimensions(),a=r[0],c=r[1],d=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,d),this.painter.resize(a,c,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,S),this.painter.resize(a,c,S)}this.transform.resize(a,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,c);const _=!this._moving;return _&&(this.stop(),this.fire(new l.k("movestart",p)).fire(new l.k("move",p))),this.fire(new l.k("resize",p)),_&&this.fire(new l.k("moveend",p)),this}_getClampedPixelRatio(p,e){const{0:r,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),d=p*c,_=e*c;return Math.min(d>r?r/d:1,_>a?a/_:1)*c}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(be.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(l.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(l.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,r){if(p==="mouseenter"||p==="mouseover"){let a=!1;return{layers:e,listener:r,delegates:{mousemove:d=>{const _=e.filter(S=>this.getLayer(S)),w=_.length!==0?this.queryRenderedFeatures(d.point,{layers:_}):[];w.length?a||(a=!0,r.call(this,new kn(p,this,d.originalEvent,{features:w}))):a=!1},mouseout:()=>{a=!1}}}}if(p==="mouseleave"||p==="mouseout"){let a=!1;return{layers:e,listener:r,delegates:{mousemove:_=>{const w=e.filter(S=>this.getLayer(S));(w.length!==0?this.queryRenderedFeatures(_.point,{layers:w}):[]).length?a=!0:a&&(a=!1,r.call(this,new kn(p,this,_.originalEvent)))},mouseout:_=>{a&&(a=!1,r.call(this,new kn(p,this,_.originalEvent)))}}}}{const a=c=>{const d=e.filter(w=>this.getLayer(w)),_=d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[];_.length&&(c.features=_,r.call(this,c),delete c.features)};return{layers:e,listener:r,delegates:{[p]:a}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,r){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const a=this._delegatedListeners[p];for(let c=0;c<a.length;c++){const d=a[c];if(d.listener===r&&d.layers.length===e.length&&d.layers.every(_=>e.includes(_))){for(const _ in d.delegates)this.off(_,d.delegates[_]);return void a.splice(c,1)}}}on(p,e,r){if(r===void 0)return super.on(p,e);const a=this._createDelegatedListener(p,typeof e=="string"?[e]:e,r);this._saveDelegatedListener(p,a);for(const c in a.delegates)this.on(c,a.delegates[c]);return this}once(p,e,r){if(r===void 0)return super.once(p,e);const a=typeof e=="string"?[e]:e,c=this._createDelegatedListener(p,a,r);for(const d in c.delegates){const _=c.delegates[d];c.delegates[d]=(...w)=>{this._removeDelegatedListener(p,a,r),_(...w)}}this._saveDelegatedListener(p,c);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(p,e,r){return r===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let r;const a=p instanceof l.P||Array.isArray(p),c=a?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:p)||{},c instanceof l.P||typeof c[0]=="number")r=[l.P.convert(c)];else{const d=l.P.convert(c[0]),_=l.P.convert(c[1]);r=[d,new l.P(_.x,d.y),_,new l.P(d.x,_.y),d]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const r=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Ya(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,r):this.style.loadJSON(p,e,r),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ya(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const r=this._requestManager.transformRequest(p,"Style");l.h(r,new AbortController).then(a=>{this._updateDiff(a.data,e)}).catch(a=>{a&&this.fire(new l.j(a))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(r){l.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new l.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const a=this.style._layers[r];a.type==="hillshade"&&a.source===p.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ru(this.painter,e,p),this.painter.renderToTexture=new Pf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=r=>{r.dataType==="style"?this.terrain.sourceCache.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const r=p[e]._tiles;for(const a in r){const c=r[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,r={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:A}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:M,height:z,data:N}=e,G=e;return this.style.addImage(p,{data:new l.R({width:M,height:z},new Uint8Array(N)),pixelRatio:a,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:A,sdf:c,version:0,userImage:G}),G.onAdd&&G.onAdd(this,p),this}}{const{width:M,height:z,data:N}=B.getImageData(e);this.style.addImage(p,{data:new l.R({width:M,height:z},N),pixelRatio:a,stretchX:d,stretchY:_,content:w,textFitWidth:S,textFitHeight:A,sdf:c,version:0})}}updateImage(p,e){const r=this.style.getImage(p);if(!r)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||l.b(e)?B.getImageData(e):e,{width:c,height:d,data:_}=a;if(c===void 0||d===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==r.data.width||d!==r.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||l.b(e));return r.data.replace(_,w),this.style.updateImage(p,r),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return Ie.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,r){return this.style.setLayerZoomRange(p,e,r),this._update(!0)}setFilter(p,e,r={}){return this.style.setFilter(p,e,r),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,r,a={}){return this.style.setPaintProperty(p,e,r,a),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,r,a={}){return this.style.setLayoutProperty(p,e,r,a),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,r,a=>{a||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,r=>{r||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p){return this._lazyInitEmptyStyle(),this.style.setSky(p),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=V.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=V.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),a=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],a);const c=this._controlContainer=V.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{d[_]=V.create("div",`maplibregl-ctrl-${_} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,r){this._canvas.width=Math.floor(r*p),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",a=>{e={requestedAttributes:p},a&&(e.statusMessage=a.statusMessage,e.type=a.type)},{once:!0});const r=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!r){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new fl(r,this.transform),ne.testSupport(r)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let r=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,d=B.now();this.style.zoomHistory.update(c,d);const _=new l.z(c,{now:d,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=_.crossFadingFactor();w===1&&w===this._crossFadingFactor||(r=!0,this._crossFadingFactor=w),this.style.update(_)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bf.mark(l.bg.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||r)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const a=this._sourcesDirty||this._styleDirty||this._placementDirty;return a||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||a||(this._fullyLoaded=!0,l.bf.mark(l.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ie.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),V.remove(this._canvasContainer),V.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bf.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,B.frameAsync(this._frameRequest).then(p=>{l.bf.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return If}getCameraTargetElevation(){return this.transform.elevation}},b.MapMouseEvent=kn,b.MapTouchEvent=Vs,b.MapWheelEvent=vf,b.Marker=Pl,b.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,r)=>{const a=this._map._getUIString(`NavigationControl.${r}`);e.title=a,e.setAttribute("aria-label",a)},this.options=l.e({},By,p),this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),V.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=V.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ny(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const r=V.create("button",p,this._container);return r.type="button",r.addEventListener("click",e),r}},b.Popup=class extends l.E{constructor(p){super(),this.remove=()=>(this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var r;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=V.create("div","maplibregl-popup",this._map.getContainer()),this._tip=V.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ei(this._lngLat,this._flatPos,this._map.transform):(r=this._lngLat)===null||r===void 0?void 0:r.wrap(),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const d=Cl(this.options.offset);if(!c){const w=this._container.offsetWidth,S=this._container.offsetHeight;let A;A=a.y+d.bottom.y<S?["top"]:a.y>this._map.transform.height-S?["bottom"]:[],a.x<w/2?A.push("left"):a.x>this._map.transform.width-w/2&&A.push("right"),c=A.length===0?"bottom":A.join("-")}let _=a.add(d[c]);this.options.subpixelPositioning||(_=_.round()),V.setTransform(this._container,`${Po[c]} translate(${_.x}px,${_.y}px)`),Tl(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Rt),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=l.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),r=document.createElement("body");let a;for(r.innerHTML=p;a=r.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=V.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Il);p&&p.focus()}},b.RasterDEMTileSource=li,b.RasterTileSource=Ht,b.ScaleControl=class{constructor(p){this._onMove=()=>{Ia(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ia(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xr),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},b.ScrollZoomHandler=Mr,b.Style=Ya,b.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=V.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=V.create("button","maplibregl-ctrl-terrain",this._container),V.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){V.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},b.TwoFingersTouchPitchHandler=xo,b.TwoFingersTouchRotateHandler=Au,b.TwoFingersTouchZoomHandler=Cu,b.TwoFingersTouchZoomRotateHandler=Mu,b.VectorTileSource=In,b.VideoSource=Zr,b.addSourceType=(p,e)=>l._(void 0,void 0,void 0,function*(){if(Es(p))throw new Error(`A source type called "${p}" already exists.`);((r,a)=>{us[r]=a})(p,e)}),b.clearPrewarmedResources=function(){const p=Ui;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Pi),Ui=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},b.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},b.getRTLTextPluginStatus=function(){return Pr().getRTLTextPluginStatus()},b.getVersion=function(){return Bu},b.getWorkerCount=function(){return Fi.workerCount},b.getWorkerUrl=function(){return l.a.WORKER_URL},b.importScriptInWorkers=function(p){return xi().broadcast("IS",p)},b.prewarm=function(){Fn().acquire(Pi)},b.setMaxParallelImageRequests=function(p){l.a.MAX_PARALLEL_IMAGE_REQUESTS=p},b.setRTLTextPlugin=function(p,e){return Pr().setRTLTextPlugin(p,e)},b.setWorkerCount=function(p){Fi.workerCount=p},b.setWorkerUrl=function(p){l.a.WORKER_URL=p}});var C=g;return C})}(dm)),dm.exports}var Zz=qz();const Kc=Xb(Zz);var Op;class gb{constructor(s){H(this,Op,Qe());this.value=s}get value(){return L(I(this,Op))}set value(s){je(I(this,Op),qe(s))}}Op=new WeakMap;var Fp,Bp,Np,Vp;class Gz{constructor(){H(this,Fp,Qe());H(this,Bp,Qe(!1));Ge(this,"loadedImages",new nv);H(this,Np,Qe(0));H(this,Vp,Qe(24));Ge(this,"layerInfo",new Map);Ge(this,"eventTracker",new WeakMap);Ge(this,"eventTopMost");Ge(this,"markerClickManager",new Yz);this.eventTopMost=this._eventTopMost.bind(this)}get map(){return L(I(this,Fp))}set map(s){je(I(this,Fp),qe(s))}get loaded(){return L(I(this,Bp))}set loaded(s){je(I(this,Bp),qe(s))}get minzoom(){return L(I(this,Np))}set minzoom(s){je(I(this,Np),qe(s))}get maxzoom(){return L(I(this,Vp))}set maxzoom(s){je(I(this,Vp),qe(s))}_eventTopMost(s){var C;let g=this.eventTracker.get(s.originalEvent);if(g!==void 0)return g;let T=(C=s.target.queryRenderedFeatures(s.point).find(b=>{var l;return(l=this.layerInfo.get(b.layer.id))==null?void 0:l.interactive}))==null?void 0:C.layer.id;return this.eventTracker.set(s.originalEvent,T),T}}Fp=new WeakMap,Bp=new WeakMap,Np=new WeakMap,Vp=new WeakMap;function Wz(h){jp(Xz,h)}function Hz(h){jp(Kz,h)}const G1=Symbol.for("svelte-maplibre"),Xz=Symbol.for("svelte-maplibre.popup-target"),Kz=Symbol.for("svelte-maplibre.layer-event");function Wp(){return pv(G1)}function $z(){return jp(G1,new Gz)}function Jz(){const h=new gb(void 0),s=new gb(void 0);return Wz(h),Hz(s),{marker:h,layerEvent:s}}class Yz{constructor(){Ge(this,"_handlers",new Set)}add(s){this._handlers.add(s)}remove(s){this._handlers.delete(s)}handleClick(s){for(const g of this._handlers)g(s)}}function Qz(h){return Object.fromEntries(Object.entries(h).filter(([s,g])=>g!=null))}bb(["click"]);function eD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ie(s,"position",3,"top-left"),b=ie(s,"container",3,void 0),l=Qe(void 0),j=Te(()=>typeof b()=="string"?document.querySelector(b())??void 0:b());Ct(()=>{L(j)&&!L(l)&&(je(l,qe(new Kc.FullscreenControl({container:L(j)}))),L(v).addControl(L(l),C()))}),qp(()=>{L(T)&&L(l)&&L(v).removeControl(L(l))}),It()}function tD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ie(s,"position",3,"top-left"),b=ie(s,"positionOptions",3,void 0),l=ie(s,"fitBoundsOptions",3,void 0),j=ie(s,"trackUserLocation",3,!1),U=ie(s,"showAccuracyCircle",3,!0),K=ie(s,"showUserLocation",3,!0),B=ie(s,"control",15);Ct(()=>{L(v)&&!B()&&(B(new Kc.GeolocateControl({positionOptions:b(),fitBoundsOptions:l(),trackUserLocation:j(),showAccuracyCircle:U(),showUserLocation:K()})),L(v).addControl(B(),C()))}),qp(()=>{L(T)&&B()&&L(v).removeControl(B())}),It()}function iD(h){let s=h.getCenter(),g=Math.round(h.getZoom()*100)/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),C=Math.round(s.lat*T)/T,b=Math.round(s.lng*T)/T,l=`${g}/${C}/${b}`,j=h.getBearing(),U=h.getPitch();return(j||U)&&(l+=`/${Math.round(j*10)/10}`),U&&(l+=`/${Math.round(U)}`),`#${l}`}function nD(h){return h.replace("#","").split("/").map(parseFloat)}var Wl=Ov;function Ov(h,s){return h===s||h!==h&&s!==s?!0:typeof h!=typeof s||{}.toString.call(h)!={}.toString.call(s)||h!==Object(h)||!h?!1:Array.isArray(h)?yb(h,s):{}.toString.call(h)=="[object Set]"?yb(Array.from(h),Array.from(s)):{}.toString.call(h)=="[object Object]"?sD(h,s):rD(h,s)}function rD(h,s){return h.toString()===s.toString()}function yb(h,s){var g=h.length;if(g!=s.length)return!1;for(var v=0;v<g;v++)if(!Ov(h[v],s[v]))return!1;return!0}function sD(h,s){var g=Object.keys(h),v=g.length;if(v!=Object.keys(s).length)return!1;for(var T=0;T<v;T++){var C=g[T];if(!(s.hasOwnProperty(C)&&Ov(h[C],s[C])))return!1}return!0}function oD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ie(s,"position",3,"top-left"),b=ie(s,"showCompass",3,!0),l=ie(s,"showZoom",3,!0),j=ie(s,"visualizePitch",3,!1),U=Qe(void 0);Ct(()=>{L(v)&&!L(U)&&(je(U,qe(new Kc.NavigationControl({showCompass:b(),showZoom:l(),visualizePitch:j()}))),L(v).addControl(L(U),C()))}),qp(()=>{L(T)&&L(U)&&L(v).removeControl(L(U))}),It()}function aD(h,s){Pt(s,!0);const g=Te(Wp),v=Te(()=>L(g).map),T=Te(()=>L(g).loaded);let C=ie(s,"position",3,"bottom-left"),b=ie(s,"maxWidth",3,void 0),l=ie(s,"unit",3,"metric"),j=Qe(void 0);Ct(()=>{L(v)&&!L(j)&&(je(j,qe(new Kc.ScaleControl({maxWidth:b(),unit:l()}))),L(v).addControl(L(j),C()))}),qp(()=>{L(T)&&L(j)&&L(v).removeControl(L(j))}),It()}var lD=Et("<!> <!> <!> <!>",1),cD=Et("<!> <!>",1),uD=Et('<div data-testid="map-container"><!></div>');function hD(h,s){Pt(s,!0);let g=ie(s,"map",15,void 0),v=ie(s,"mapContainer",15,void 0),T=ie(s,"class",3,void 0),C=ie(s,"diffStyleUpdates",3,!1),b=ie(s,"center",15,void 0),l=ie(s,"zoom",15,void 0),j=ie(s,"pitch",15,0),U=ie(s,"bearing",15,0),K=ie(s,"bounds",15,void 0),B=ie(s,"hash",3,!1),V=ie(s,"updateHash",3,mt=>{window.history.replaceState(window.history.state,"",mt)}),ne=ie(s,"loaded",15,!1),Q=ie(s,"minZoom",3,0),ee=ie(s,"maxZoom",3,22),ce=ie(s,"minPitch",3,0),ye=ie(s,"maxPitch",3,60),pe=ie(s,"renderWorldCopies",3,void 0),Ie=ie(s,"dragPan",3,void 0),Oe=ie(s,"dragRotate",3,void 0),ze=ie(s,"pitchWithRotate",3,void 0),We=ie(s,"antialias",3,void 0),$e=ie(s,"zoomOnDoubleClick",3,!0),xt=ie(s,"locale",3,void 0),He=ie(s,"interactive",3,!0),Ye=ie(s,"attributionControl",3,void 0),Be=ie(s,"cooperativeGestures",3,!1),Me=ie(s,"preserveDrawingBuffer",3,!1),De=ie(s,"maxBounds",3,void 0),ke=ie(s,"images",19,()=>[]),Ue=ie(s,"standardControls",3,!1),et=ie(s,"filterLayers",3,void 0),pt=ie(s,"transformRequest",3,void 0),ut=Te(()=>typeof Ue()=="boolean"?void 0:Ue());const ct=$z();let at=Qe(qe(new Set));async function Mt(mt,Bt=!1){var be;if(g()&&!(!((be=g())!=null&&be.loaded())&&!Bt))if("url"in mt){L(at).add(mt.id);try{let Ai=await g().loadImage(mt.url);g().addImage(mt.id,Ai.data,mt.options),ct.loadedImages.add(mt.id)}catch(Ai){s.onerror?s.onerror({error:Ai}):console.error(Ai)}finally{L(at).delete(mt.id)}}else g().addImage(mt.id,mt.data,mt.options),ct.loadedImages.add(mt.id)}Ct(()=>{var mt;if(ne()&&((mt=g())!=null&&mt.loaded()))for(let Bt of ke())!ct.loadedImages.has(Bt.id)&&!L(at).has(Bt.id)&&!g().hasImage(Bt.id)&&Mt(Bt)});let Yt=Te(()=>ke().every(mt=>ct.loadedImages.has(mt.id))),yi=Qe(void 0),Pi=Qe(void 0),Fi=Qe(void 0),sn=Qe(void 0);function Ui(mt){s.onerror?s.onerror(mt):mt.error.name!=="AbortError"&&console.error(mt.error)}function Hi(mt){return Xi(),g(ct.map=new Kc.Map(Qz({container:mt,style:s.style,locale:xt(),center:b(),zoom:l(),pitch:j(),bearing:U(),minZoom:Q(),maxZoom:ee(),minPitch:ce(),maxPitch:ye(),renderWorldCopies:pe(),dragPan:Ie(),dragRotate:Oe(),pitchWithRotate:ze(),antialias:We(),interactive:He(),preserveDrawingBuffer:Me(),maxBounds:De(),bounds:K(),attributionControl:Ye(),transformRequest:pt(),cooperativeGestures:Be()}))),g().on("load",Bt=>{Bt.target.getContainer().setAttribute("data-testid","map"),Bt.target.getCanvas().setAttribute("data-testid","map-canvas"),s.onload&&s.onload(g()),ct.loaded=!0,ne(!0)}),g().on("error",Ui),s.onmovestart&&g().on("movestart",s.onmovestart),g().on("moveend",Bt=>{var be;if(b(Bt.target.getCenter()),l(Bt.target.getZoom()),j(Bt.target.getPitch()),U(Bt.target.getBearing()),K(Bt.target.getBounds()),(be=s.onmoveend)==null||be.call(s,Bt),B()){let Ai=new URL(window.location.href.replace(/(#.+)?$/,iD(Bt.target)));V()(Ai)}}),s.onclick&&g().on("click",s.onclick),s.ondblclick&&g().on("dblclick",s.ondblclick),s.oncontextmenu&&g().on("contextmenu",s.oncontextmenu),s.onmousemove&&g().on("mousemove",s.onmousemove),s.onzoomstart&&g().on("zoomstart",s.onzoomstart),s.onzoom&&g().on("zoom",s.onzoom),s.onzoomend&&g().on("zoomend",s.onzoomend),s.onpitch&&g().on("pitch",s.onpitch),s.onrotate&&g().on("rotate",s.onrotate),s.onwheel&&g().on("wheel",s.onwheel),s.ondata&&g().on("data",s.ondata),s.onidle&&g().on("idle",s.onidle),g().on("style.load",()=>{if(g()){const Bt=g().getStyle();if(je(yi,qe(Bt.layers.map(be=>be.id))),je(Pi,qe(Object.keys(Bt.sources))),L(sn))for(const[be,Ai]of Object.entries(L(sn)))g().addSource(be,Ai);if(L(Fi))for(const be of L(Fi))g().addLayer(be);for(const be of ke())Mt(be,!0)}}),g().on("styledata",Bt=>{var be;if(g()&&et()){const Ai=g().getStyle().layers;if(Ai)for(let In of Ai)et()(In)||g().setLayoutProperty(In.id,"visibility","none")}(be=s.onstyledata)==null||be.call(s,Bt)}),{destroy(){var Bt;ne(!1),ct.loaded=!1,(Bt=g())==null||Bt.remove()}}}let Fn=Qe(qe(s.style));Ct(()=>{if(g()&&!Wl(s.style,L(Fn))){const mt=g().getStyle();if(L(yi)&&je(Fi,qe(mt.layers.filter(Bt=>!L(yi).includes(Bt.id)))),L(Pi)){const Bt=Object.keys(mt.sources).filter(be=>!L(Pi).includes(be));je(sn,qe({}));for(const be of Bt)L(sn)[be]=mt.sources[be]}je(Fn,qe(s.style)),g().setStyle(s.style,{diff:C()}),ct.loadedImages.clear(),je(at,qe(new Set))}}),Ct(()=>{if(g()){let mt={};b()!=null&&!Wl(b(),g().getCenter())&&(mt.center=b()),l()!=null&&!Wl(l(),g().getZoom())&&(mt.zoom=l()),U()!=null&&!Wl(U(),g().getBearing())&&(mt.bearing=U()),j()!=null&&!Wl(j(),g().getPitch())&&(mt.pitch=j()),Object.keys(mt).length&&g().easeTo(mt)}}),Ct(()=>{var mt,Bt;K()&&!Wl(K(),(mt=g())==null?void 0:mt.getBounds())&&((Bt=g())==null||Bt.fitBounds(K()))}),Ct(()=>{var mt,Bt;$e()?(mt=g())==null||mt.doubleClickZoom.enable():(Bt=g())==null||Bt.doubleClickZoom.disable()});function Xi(){if(B()){let mt=nD(window.location.hash);mt.length>=3&&(l(mt[0]),b([mt[2],mt[1]])),mt.length==5&&(U(mt[3]),j(mt[4]))}}var xi=uD();H_("hashchange",mS,Xi);var cn=qt(xi);{var Ki=mt=>{var Bt=cD(),be=Le(Bt);{var Ai=Ht=>{var li=lD(),sr=Le(li);oD(sr,{get position(){return L(ut)}});var _n=Wt(sr,2);tD(_n,{get position(){return L(ut)},fitBoundsOptions:{maxZoom:12}});var Xn=Wt(_n,2);eD(Xn,{get position(){return L(ut)}});var Zr=Wt(Xn,2);aD(Zr,{get position(){return L(ut)}}),ve(Ht,li)};fi(be,Ht=>{Ue()&&Ht(Ai)})}var In=Wt(be,2);Ot(In,()=>s.children??ti,()=>({map:g(),loadedImages:ct.loadedImages,allImagesLoaded:L(Yt)})),ve(mt,Bt)};fi(cn,mt=>{g()&&ne()&&mt(Ki)})}Vt(xi),Vc(xi,mt=>v(mt),()=>v()),K_(xi,mt=>Hi==null?void 0:Hi(mt)),zt(()=>{Mb(xi,`${T()??""} svelte-p00lfq`),TS(xi,"expand-map",!T())}),ve(h,xi),It()}function dD(h,s){h.key===" "&&(h.preventDefault(),h.stopPropagation(),s("click"))}var pD=(h,s)=>{h.stopPropagation(),s("click")},fD=(h,s)=>{h.stopPropagation(),s("dblclick")},mD=(h,s)=>{h.stopPropagation(),h.preventDefault(),s("contextmenu")},gD=(h,s)=>s("mousemove"),yD=Et("<div><!></div>");function _D(h,s){Pt(s,!0);let g=ie(s,"marker",15,void 0),v=ie(s,"lngLat",15),T=ie(s,"class",3,void 0),C=ie(s,"interactive",3,!0),b=ie(s,"asButton",3,!1),l=ie(s,"draggable",3,!1),j=ie(s,"feature",3,void 0),U=ie(s,"offset",3,void 0),K=ie(s,"zIndex",3,void 0),B=ie(s,"rotation",3,0),V=ie(s,"opacity",3,1),ne=Kt(s,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","children"]);const Q=Te(Wp),ee=Te(()=>L(Q).map),ce=Te(()=>L(Q).markerClickManager),{layerEvent:ye,marker:pe}=Jz();function Ie(He){pe.value=new Kc.Marker({element:He,rotation:B(),draggable:l(),offset:U(),opacity:V().toString()}).setLngLat(v()).addTo(L(ee)),g(pe.value);const Ye=()=>We("dragstart"),Be=()=>{ze(),We("drag")},Me=()=>{ze(),We("dragend")};return l()&&(pe.value.on("dragstart",Ye),pe.value.on("drag",Be),pe.value.on("dragend",Me)),{destroy(){var De,ke,Ue,et;l()&&((De=pe.value)==null||De.off("dragstart",Ye),(ke=pe.value)==null||ke.off("drag",Be),(Ue=pe.value)==null||Ue.off("dragend",Me)),g(void 0),(et=pe.value)==null||et.remove()}}}function Oe(He,Ye){const Be=He.className;function Me(De){De?He.className=`${Be} ${De}`:He.className=Be}return Me(Ye),{update:Me}}Ct(()=>{var He;(He=pe.value)==null||He.setLngLat(v())}),Ct(()=>{var He;(He=pe.value)==null||He.setOffset(U()??[0,0])}),Ct(()=>{var He;(He=pe.value)==null||He.setRotation(B())}),Ct(()=>{var He;(He=pe.value)==null||He.setOpacity(V().toString())});function ze(){var Ye;let He=(Ye=pe.value)==null?void 0:Ye.getLngLat();He&&(Array.isArray(v())?v([He.lng,He.lat]):v()&&"lon"in v()?v({lon:He.lng,lat:He.lat}):v(He))}function We(He){var ke,Ue;if(!C())return;let Ye=(ke=pe.value)==null?void 0:ke.getLngLat();if(!Ye)return;const Be=[Ye.lng,Ye.lat];let Me={map:L(ee),marker:pe.value,lngLat:Be,features:[{type:"Feature",properties:((Ue=j())==null?void 0:Ue.properties)??{},geometry:{type:"Point",coordinates:Be}}]};(He==="click"||He==="contextmenu")&&L(ce).handleClick(Me),ye.value={...Me,layerType:"marker",type:He};const De=ne["on"+He];De==null||De(Me)}var $e=yD();$e.__click=[pD,We],$e.__dblclick=[fD,We],$e.__contextmenu=[mD,We],$e.__mousemove=[gD,We],$e.__keydown=[dD,We];var xt=qt($e);Ot(xt,()=>s.children??ti,()=>({marker:pe.value})),Vt($e),K_($e,He=>Ie==null?void 0:Ie(He)),K_($e,(He,Ye)=>Oe==null?void 0:Oe(He,Ye),T),zt(()=>{mh($e,"tabindex",b()?0:void 0),mh($e,"role",b()?"button":void 0),PS($e,"z-index",K())}),H_("mouseenter",$e,()=>{We("mouseenter")}),H_("mouseleave",$e,()=>{We("mouseleave")}),ve(h,$e),It()}bb(["click","dblclick","contextmenu","mousemove","keydown"]);var Hp=Uint8Array,W1=Uint16Array,vD=Int32Array,xD=new Hp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bD=new Hp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),H1=function(h,s){for(var g=new W1(31),v=0;v<31;++v)g[v]=s+=1<<h[v-1];for(var T=new vD(g[30]),v=1;v<30;++v)for(var C=g[v];C<g[v+1];++C)T[C]=C-g[v]<<5|v;return{b:g,r:T}},X1=H1(xD,2),wD=X1.b,SD=X1.r;wD[28]=258,SD[258]=28;H1(bD,0);var TD=new W1(32768);for(Ti=0;Ti<32768;++Ti)Ks=(Ti&43690)>>1|(Ti&21845)<<1,Ks=(Ks&52428)>>2|(Ks&13107)<<2,Ks=(Ks&61680)>>4|(Ks&3855)<<4,TD[Ti]=((Ks&65280)>>8|(Ks&255)<<8)>>1;var Ks,Ti,py=new Hp(288);for(Ti=0;Ti<144;++Ti)py[Ti]=8;var Ti;for(Ti=144;Ti<256;++Ti)py[Ti]=9;var Ti;for(Ti=256;Ti<280;++Ti)py[Ti]=7;var Ti;for(Ti=280;Ti<288;++Ti)py[Ti]=8;var Ti,PD=new Hp(32);for(Ti=0;Ti<32;++Ti)PD[Ti]=5;var Ti,ID=new Hp(0),CD=typeof TextDecoder<"u"&&new TextDecoder,kD=0;try{CD.decode(ID,{stream:!0}),kD=1}catch{}var AD=Et("<!> <!>",1),ED=Et('<!> <span class="mr-auto"><!></span>',1),MD=Et("<!> <!>",1),zD=Et("<!> <!>",1),DD=Et("<!> <!>",1),LD=Et("<!> <!>",1),RD=Et('<div class="mx-auto w-full max-w-md px-4 pb-6 md:px-0"><!> <!></div>'),OD=Et('<!> <div class="absolute left-1/2 top-2.5 z-10 -translate-x-1/2"><!></div> <!> <!>',1);function XD(h,s){Pt(s,!0);const g=vb(),v=()=>xb(bS,"$mode",g);let T=Qe(qe(new Date));const C=setInterval(()=>je(T,qe(new Date)),60*1e3);qp(()=>clearInterval(C));let b=Qe(!1),l=Qe(null);const j=new D1("campus",""),U=Te(()=>fb.find(Ye=>Ye.value===j.current));let K=Qe(null);const B=`https://api.maptiler.com/maps/topo-v2/style.json?key=${Dx}`,V=`https://api.maptiler.com/maps/topo-v2-dark/style.json?key=${Dx}`,ne=Te(()=>v()==="dark"?V:B);let Q=Qe(!1),ee=Qe(void 0);const ce=Te(()=>{var Ye,Be;return Vx(L(ee),(Be=(Ye=L(U))==null?void 0:Ye.metadata)==null?void 0:Be.timezone,L(T))});function ye(Ye){je(Q,!0),je(ee,qe(Ye))}function pe(){je(b,!1),ay().then(()=>{L(l).focus()})}Ct(()=>{var Ye;if(L(U)){const Be=(Ye=L(U).metadata)==null?void 0:Ye.display;L(K).jumpTo({center:L(U).location,zoom:(Be==null?void 0:Be.zoom)??16,pitch:(Be==null?void 0:Be.pitch)??60,bearing:(Be==null?void 0:Be.bearing)??0})}});var Ie=OD();K2(Ye=>{zt(()=>gS.title=pT())});var Oe=Le(Ie);hD(Oe,{get map(){return L(K)},set map(Ye){je(K,qe(Ye))},get style(){return L(ne)},class:"min-h-screen",standardControls:!0,children:(Ye,Be)=>{var Me=Xe(),De=Le(Me);{var ke=Ue=>{var et=Xe(),pt=Le(et);Hl(pt,17,()=>L(U).spaces,Xl,(ut,ct)=>{_D(ut,{get lngLat(){return L(ct).location},class:"cursor-pointer",onclick:()=>ye(L(ct)),children:(at,Mt)=>{var Yt=Te(()=>{var yi;return Vx(L(ct),(yi=L(U).metadata)==null?void 0:yi.timezone,L(T))});OM(at,{get status(){return L(Yt)}})},$$slots:{default:!0}})}),ve(Ue,et)};fi(De,Ue=>{L(U)&&Ue(ke)})}ve(Ye,Me)},$$slots:{default:!0}});var ze=Wt(Oe,2),We=qt(ze);si(We,()=>Bz,(Ye,Be)=>{Be(Ye,{get open(){return L(b)},set open(Me){je(b,qe(Me))},children:(Me,De)=>{var ke=DD(),Ue=Le(ke);si(Ue,()=>Nz,(pt,ut)=>{ut(pt,{get ref(){return L(l)},set ref(at){je(l,qe(at))},child:(at,Mt)=>{um(at,Gt({variant:"outline",class:"w-60 justify-between"},()=>Mt==null?void 0:Mt().props,{role:"combobox",get"aria-expanded"(){return L(b)},children:(yi,Pi)=>{var Fi=AD(),sn=Le(Fi);{var Ui=Xi=>{var xi=Xe(),cn=Le(xi);lm(cn,()=>fh(L(U).label,hi()),Ki=>{var mt=On("...");ve(Ki,mt)},(Ki,mt)=>{var Bt=On();zt(()=>Ri(Bt,L(mt))),ve(Ki,Bt)},Ki=>{var mt=On();zt(()=>Ri(mt,L(U).label)),ve(Ki,mt)}),ve(Xi,xi)},Hi=Xi=>{var xi=On();zt(()=>Ri(xi,gT())),ve(Xi,xi)};fi(sn,Xi=>{var xi;(xi=L(U))!=null&&xi.label?Xi(Ui):Xi(Hi,!1)})}var Fn=Wt(sn,2);qE(Fn,{class:"opacity-50"}),ve(yi,Fi)},$$slots:{default:!0}}))},$$slots:{child:!0}})});var et=Wt(Ue,2);si(et,()=>Fz,(pt,ut)=>{ut(pt,{class:"w-60 p-0",children:(ct,at)=>{var Mt=Xe(),Yt=Le(Mt);si(Yt,()=>FM,(yi,Pi)=>{Pi(yi,{children:(Fi,sn)=>{var Ui=zD(),Hi=Le(Ui),Fn=Te(()=>vT());si(Hi,()=>UM,(xi,cn)=>{cn(xi,{get placeholder(){return L(Fn)}})});var Xi=Wt(Hi,2);si(Xi,()=>ZM,(xi,cn)=>{cn(xi,{children:(Ki,mt)=>{var Bt=MD(),be=Le(Bt);si(be,()=>BM,(In,Ht)=>{Ht(In,{children:(li,sr)=>{ia();var _n=On();zt(()=>Ri(_n,wT())),ve(li,_n)},$$slots:{default:!0}})});var Ai=Wt(be,2);si(Ai,()=>VM,(In,Ht)=>{Ht(In,{children:(li,sr)=>{var _n=Xe(),Xn=Le(_n);Hl(Xn,17,()=>fb,Xl,(Zr,dn)=>{var us=Xe(),Es=Le(us);si(Es,()=>qM,(Je,mr)=>{mr(Je,{get value(){return L(dn).value},onSelect:()=>{j.current=L(dn).value,pe()},children:(vn,Pr)=>{var Ir=ED(),tt=Le(Ir),$t=Te(()=>Ni(j.current!==L(dn).value&&"text-transparent"));UE(tt,{get class(){return L($t)}});var Ft=Wt(tt,2),Cn=qt(Ft);lm(Cn,()=>fh(L(dn).label,hi()),xn=>{var Nt=On("...");ve(xn,Nt)},(xn,Nt)=>{var or=On();zt(()=>Ri(or,L(Nt))),ve(xn,or)},xn=>{var Nt=On();zt(()=>Ri(Nt,L(dn).label)),ve(xn,Nt)}),Vt(Ft),ve(vn,Ir)},$$slots:{default:!0}})}),ve(Zr,us)}),ve(li,_n)},$$slots:{default:!0}})}),ve(Ki,Bt)},$$slots:{default:!0}})}),ve(Fi,Ui)},$$slots:{default:!0}})}),ve(ct,Mt)},$$slots:{default:!0}})}),ve(Me,ke)},$$slots:{default:!0}})}),Vt(ze);var $e=Wt(ze,2);fM($e,{});var xt=Wt($e,2);{var He=Ye=>{var Be=Xe(),Me=Le(Be);si(Me,()=>Oz,(De,ke)=>{ke(De,{get open(){return L(Q)},set open(Ue){je(Q,qe(Ue))},children:(Ue,et)=>{var pt=Xe(),ut=Le(pt);si(ut,()=>Mz,(ct,at)=>{at(ct,{children:(Mt,Yt)=>{var yi=RD(),Pi=qt(yi);si(Pi,()=>Lz,(sn,Ui)=>{Ui(sn,{children:(Hi,Fn)=>{var Xi=LD(),xi=Le(Xi);si(xi,()=>Rz,(Ki,mt)=>{mt(Ki,{children:(Bt,be)=>{var Ai=Xe(),In=Le(Ai);lm(In,()=>fh(L(ee).label,hi()),Ht=>{var li=On("...");ve(Ht,li)},(Ht,li)=>{var sr=On();zt(()=>Ri(sr,L(li))),ve(Ht,sr)},Ht=>{var li=On();zt(()=>Ri(li,L(ee).label)),ve(Ht,li)}),ve(Bt,Ai)},$$slots:{default:!0}})});var cn=Wt(xi,2);si(cn,()=>zz,(Ki,mt)=>{mt(Ki,{children:(Bt,be)=>{cm(Bt,{get status(){return L(ce)}})},$$slots:{default:!0}})}),ve(Hi,Xi)},$$slots:{default:!0}})});var Fi=Wt(Pi,2);LM(Fi,{get space(){return L(ee)}}),Vt(yi),ve(Mt,yi)},$$slots:{default:!0}})}),ve(Ue,pt)},$$slots:{default:!0}})}),ve(Ye,Be)};fi(xt,Ye=>{L(ee)&&Ye(He)})}ve(h,Ie),It()}export{XD as component};
